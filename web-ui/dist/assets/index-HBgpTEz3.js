const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ddsTextureLoader-C3zeYfiC.js","assets/dds-BWCiKDbG.js","assets/cubemapToSphericalPolynomial-Cmh_FA48.js","assets/envTextureLoader-BMDptslG.js","assets/default.vertex-B1XsCRxi.js","assets/mainUVVaryingDeclaration-CXE6mQua.js","assets/bonesVertex-DGiBIWuk.js","assets/clipPlaneVertex-l4mbAsOC.js","assets/vertexColorMixing-D-vtr_XD.js","assets/morphTargetsVertex-olIegrWc.js","assets/logDepthDeclaration-xdBkMRkJ.js","assets/logDepthVertex-zVThCKtB.js","assets/default.fragment-DUQEnaKN.js","assets/clipPlaneFragment-HVW9w2vg.js","assets/fogFragment-CebpXk7O.js","assets/logDepthFragment-WP-ZvKup.js","assets/default.vertex-P1fku4YL.js","assets/mainUVVaryingDeclaration-CLoXG_bl.js","assets/meshUboDeclaration-DtPgCHF_.js","assets/helperFunctions-X73izsFK.js","assets/bakedVertexAnimation-CDAZ1x0M.js","assets/morphTargetsVertex-DlcpDy0P.js","assets/vertexColorMixing-DQl1kl19.js","assets/default.fragment-CDqUmta-.js","assets/color.vertex-BEpqgzdD.js","assets/color.fragment-Di-XzAkI.js","assets/color.vertex-DI0fiEKS.js","assets/line.vertex-CR9xK3r9.js","assets/line.fragment-CRlNXNNe.js","assets/line.vertex-BiwKpHgo.js","assets/kernelBlur.fragment-BhqP3nMH.js","assets/kernelBlurVaryingDeclaration-DXpBRI4C.js","assets/kernelBlur.vertex-CYaH3h2O.js","assets/kernelBlur.fragment-Co0W9BfG.js","assets/kernelBlurVaryingDeclaration-8ltgb689.js","assets/kernelBlur.vertex-rUs1cgim.js","assets/glowMapGeneration.vertex-CkMxMiUB.js","assets/glowMapGeneration.fragment-BRebCg6z.js","assets/glowMapGeneration.vertex-00l4OXPB.js","assets/glowMapGeneration.fragment-DJZRbsyI.js"])))=>i.map(i=>d[i]);
(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function t(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=t(s);fetch(s.href,r)}})();function Mx(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var F1={exports:{}},Jl={},L1={exports:{}},$e={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var e0=Symbol.for("react.element"),Px=Symbol.for("react.portal"),wx=Symbol.for("react.fragment"),Dx=Symbol.for("react.strict_mode"),Ox=Symbol.for("react.profiler"),Fx=Symbol.for("react.provider"),Lx=Symbol.for("react.context"),Bx=Symbol.for("react.forward_ref"),Nx=Symbol.for("react.suspense"),Ux=Symbol.for("react.memo"),kx=Symbol.for("react.lazy"),Jd=Symbol.iterator;function Vx(n){return n===null||typeof n!="object"?null:(n=Jd&&n[Jd]||n["@@iterator"],typeof n=="function"?n:null)}var B1={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},N1=Object.assign,U1={};function Ba(n,e,t){this.props=n,this.context=e,this.refs=U1,this.updater=t||B1}Ba.prototype.isReactComponent={};Ba.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,e,"setState")};Ba.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function k1(){}k1.prototype=Ba.prototype;function tf(n,e,t){this.props=n,this.context=e,this.refs=U1,this.updater=t||B1}var sf=tf.prototype=new k1;sf.constructor=tf;N1(sf,Ba.prototype);sf.isPureReactComponent=!0;var e_=Array.isArray,V1=Object.prototype.hasOwnProperty,nf={current:null},G1={key:!0,ref:!0,__self:!0,__source:!0};function z1(n,e,t){var i,s={},r=null,a=null;if(e!=null)for(i in e.ref!==void 0&&(a=e.ref),e.key!==void 0&&(r=""+e.key),e)V1.call(e,i)&&!G1.hasOwnProperty(i)&&(s[i]=e[i]);var o=arguments.length-2;if(o===1)s.children=t;else if(1<o){for(var l=Array(o),h=0;h<o;h++)l[h]=arguments[h+2];s.children=l}if(n&&n.defaultProps)for(i in o=n.defaultProps,o)s[i]===void 0&&(s[i]=o[i]);return{$$typeof:e0,type:n,key:r,ref:a,props:s,_owner:nf.current}}function Gx(n,e){return{$$typeof:e0,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function rf(n){return typeof n=="object"&&n!==null&&n.$$typeof===e0}function zx(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var t_=/\/+/g;function zh(n,e){return typeof n=="object"&&n!==null&&n.key!=null?zx(""+n.key):e.toString(36)}function H0(n,e,t,i,s){var r=typeof n;(r==="undefined"||r==="boolean")&&(n=null);var a=!1;if(n===null)a=!0;else switch(r){case"string":case"number":a=!0;break;case"object":switch(n.$$typeof){case e0:case Px:a=!0}}if(a)return a=n,s=s(a),n=i===""?"."+zh(a,0):i,e_(s)?(t="",n!=null&&(t=n.replace(t_,"$&/")+"/"),H0(s,e,t,"",function(h){return h})):s!=null&&(rf(s)&&(s=Gx(s,t+(!s.key||a&&a.key===s.key?"":(""+s.key).replace(t_,"$&/")+"/")+n)),e.push(s)),1;if(a=0,i=i===""?".":i+":",e_(n))for(var o=0;o<n.length;o++){r=n[o];var l=i+zh(r,o);a+=H0(r,e,t,l,s)}else if(l=Vx(n),typeof l=="function")for(n=l.call(n),o=0;!(r=n.next()).done;)r=r.value,l=i+zh(r,o++),a+=H0(r,e,t,l,s);else if(r==="object")throw e=String(n),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return a}function m0(n,e,t){if(n==null)return n;var i=[],s=0;return H0(n,i,"","",function(r){return e.call(t,r,s++)}),i}function Wx(n){if(n._status===-1){var e=n._result;e=e(),e.then(function(t){(n._status===0||n._status===-1)&&(n._status=1,n._result=t)},function(t){(n._status===0||n._status===-1)&&(n._status=2,n._result=t)}),n._status===-1&&(n._status=0,n._result=e)}if(n._status===1)return n._result.default;throw n._result}var Ei={current:null},K0={transition:null},Hx={ReactCurrentDispatcher:Ei,ReactCurrentBatchConfig:K0,ReactCurrentOwner:nf};function W1(){throw Error("act(...) is not supported in production builds of React.")}$e.Children={map:m0,forEach:function(n,e,t){m0(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return m0(n,function(){e++}),e},toArray:function(n){return m0(n,function(e){return e})||[]},only:function(n){if(!rf(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};$e.Component=Ba;$e.Fragment=wx;$e.Profiler=Ox;$e.PureComponent=tf;$e.StrictMode=Dx;$e.Suspense=Nx;$e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Hx;$e.act=W1;$e.cloneElement=function(n,e,t){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var i=N1({},n.props),s=n.key,r=n.ref,a=n._owner;if(e!=null){if(e.ref!==void 0&&(r=e.ref,a=nf.current),e.key!==void 0&&(s=""+e.key),n.type&&n.type.defaultProps)var o=n.type.defaultProps;for(l in e)V1.call(e,l)&&!G1.hasOwnProperty(l)&&(i[l]=e[l]===void 0&&o!==void 0?o[l]:e[l])}var l=arguments.length-2;if(l===1)i.children=t;else if(1<l){o=Array(l);for(var h=0;h<l;h++)o[h]=arguments[h+2];i.children=o}return{$$typeof:e0,type:n.type,key:s,ref:r,props:i,_owner:a}};$e.createContext=function(n){return n={$$typeof:Lx,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:Fx,_context:n},n.Consumer=n};$e.createElement=z1;$e.createFactory=function(n){var e=z1.bind(null,n);return e.type=n,e};$e.createRef=function(){return{current:null}};$e.forwardRef=function(n){return{$$typeof:Bx,render:n}};$e.isValidElement=rf;$e.lazy=function(n){return{$$typeof:kx,_payload:{_status:-1,_result:n},_init:Wx}};$e.memo=function(n,e){return{$$typeof:Ux,type:n,compare:e===void 0?null:e}};$e.startTransition=function(n){var e=K0.transition;K0.transition={};try{n()}finally{K0.transition=e}};$e.unstable_act=W1;$e.useCallback=function(n,e){return Ei.current.useCallback(n,e)};$e.useContext=function(n){return Ei.current.useContext(n)};$e.useDebugValue=function(){};$e.useDeferredValue=function(n){return Ei.current.useDeferredValue(n)};$e.useEffect=function(n,e){return Ei.current.useEffect(n,e)};$e.useId=function(){return Ei.current.useId()};$e.useImperativeHandle=function(n,e,t){return Ei.current.useImperativeHandle(n,e,t)};$e.useInsertionEffect=function(n,e){return Ei.current.useInsertionEffect(n,e)};$e.useLayoutEffect=function(n,e){return Ei.current.useLayoutEffect(n,e)};$e.useMemo=function(n,e){return Ei.current.useMemo(n,e)};$e.useReducer=function(n,e,t){return Ei.current.useReducer(n,e,t)};$e.useRef=function(n){return Ei.current.useRef(n)};$e.useState=function(n){return Ei.current.useState(n)};$e.useSyncExternalStore=function(n,e,t){return Ei.current.useSyncExternalStore(n,e,t)};$e.useTransition=function(){return Ei.current.useTransition()};$e.version="18.3.1";L1.exports=$e;var Ne=L1.exports;const Kx=Mx(Ne);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Xx=Ne,Yx=Symbol.for("react.element"),jx=Symbol.for("react.fragment"),qx=Object.prototype.hasOwnProperty,$x=Xx.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Zx={key:!0,ref:!0,__self:!0,__source:!0};function H1(n,e,t){var i,s={},r=null,a=null;t!==void 0&&(r=""+t),e.key!==void 0&&(r=""+e.key),e.ref!==void 0&&(a=e.ref);for(i in e)qx.call(e,i)&&!Zx.hasOwnProperty(i)&&(s[i]=e[i]);if(n&&n.defaultProps)for(i in e=n.defaultProps,e)s[i]===void 0&&(s[i]=e[i]);return{$$typeof:Yx,type:n,key:r,ref:a,props:s,_owner:$x.current}}Jl.Fragment=jx;Jl.jsx=H1;Jl.jsxs=H1;F1.exports=Jl;var J=F1.exports,K1={exports:{}},qi={},X1={exports:{}},Y1={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e(H,G){var k=H.length;H.push(G);e:for(;0<k;){var M=k-1>>>1,V=H[M];if(0<s(V,G))H[M]=G,H[k]=V,k=M;else break e}}function t(H){return H.length===0?null:H[0]}function i(H){if(H.length===0)return null;var G=H[0],k=H.pop();if(k!==G){H[0]=k;e:for(var M=0,V=H.length,j=V>>>1;M<j;){var ae=2*(M+1)-1,ge=H[ae],$=ae+1,le=H[$];if(0>s(ge,k))$<V&&0>s(le,ge)?(H[M]=le,H[$]=k,M=$):(H[M]=ge,H[ae]=k,M=ae);else if($<V&&0>s(le,k))H[M]=le,H[$]=k,M=$;else break e}}return G}function s(H,G){var k=H.sortIndex-G.sortIndex;return k!==0?k:H.id-G.id}if(typeof performance=="object"&&typeof performance.now=="function"){var r=performance;n.unstable_now=function(){return r.now()}}else{var a=Date,o=a.now();n.unstable_now=function(){return a.now()-o}}var l=[],h=[],u=1,c=null,f=3,d=!1,_=!1,p=!1,g=typeof setTimeout=="function"?setTimeout:null,m=typeof clearTimeout=="function"?clearTimeout:null,v=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function T(H){for(var G=t(h);G!==null;){if(G.callback===null)i(h);else if(G.startTime<=H)i(h),G.sortIndex=G.expirationTime,e(l,G);else break;G=t(h)}}function A(H){if(p=!1,T(H),!_)if(t(l)!==null)_=!0,X(b);else{var G=t(h);G!==null&&he(A,G.startTime-H)}}function b(H,G){_=!1,p&&(p=!1,m(R),R=-1),d=!0;var k=f;try{for(T(G),c=t(l);c!==null&&(!(c.expirationTime>G)||H&&!D());){var M=c.callback;if(typeof M=="function"){c.callback=null,f=c.priorityLevel;var V=M(c.expirationTime<=G);G=n.unstable_now(),typeof V=="function"?c.callback=V:c===t(l)&&i(l),T(G)}else i(l);c=t(l)}if(c!==null)var j=!0;else{var ae=t(h);ae!==null&&he(A,ae.startTime-G),j=!1}return j}finally{c=null,f=k,d=!1}}var x=!1,E=null,R=-1,C=5,I=-1;function D(){return!(n.unstable_now()-I<C)}function w(){if(E!==null){var H=n.unstable_now();I=H;var G=!0;try{G=E(!0,H)}finally{G?z():(x=!1,E=null)}}else x=!1}var z;if(typeof v=="function")z=function(){v(w)};else if(typeof MessageChannel<"u"){var F=new MessageChannel,W=F.port2;F.port1.onmessage=w,z=function(){W.postMessage(null)}}else z=function(){g(w,0)};function X(H){E=H,x||(x=!0,z())}function he(H,G){R=g(function(){H(n.unstable_now())},G)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(H){H.callback=null},n.unstable_continueExecution=function(){_||d||(_=!0,X(b))},n.unstable_forceFrameRate=function(H){0>H||125<H?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):C=0<H?Math.floor(1e3/H):5},n.unstable_getCurrentPriorityLevel=function(){return f},n.unstable_getFirstCallbackNode=function(){return t(l)},n.unstable_next=function(H){switch(f){case 1:case 2:case 3:var G=3;break;default:G=f}var k=f;f=G;try{return H()}finally{f=k}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(H,G){switch(H){case 1:case 2:case 3:case 4:case 5:break;default:H=3}var k=f;f=H;try{return G()}finally{f=k}},n.unstable_scheduleCallback=function(H,G,k){var M=n.unstable_now();switch(typeof k=="object"&&k!==null?(k=k.delay,k=typeof k=="number"&&0<k?M+k:M):k=M,H){case 1:var V=-1;break;case 2:V=250;break;case 5:V=1073741823;break;case 4:V=1e4;break;default:V=5e3}return V=k+V,H={id:u++,callback:G,priorityLevel:H,startTime:k,expirationTime:V,sortIndex:-1},k>M?(H.sortIndex=k,e(h,H),t(l)===null&&H===t(h)&&(p?(m(R),R=-1):p=!0,he(A,k-M))):(H.sortIndex=V,e(l,H),_||d||(_=!0,X(b))),H},n.unstable_shouldYield=D,n.unstable_wrapCallback=function(H){var G=f;return function(){var k=f;f=G;try{return H.apply(this,arguments)}finally{f=k}}}})(Y1);X1.exports=Y1;var Qx=X1.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Jx=Ne,Xi=Qx;function _e(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var j1=new Set,Ao={};function Br(n,e){ya(n,e),ya(n+"Capture",e)}function ya(n,e){for(Ao[n]=e,n=0;n<e.length;n++)j1.add(e[n])}var pn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Ou=Object.prototype.hasOwnProperty,e3=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,i_={},s_={};function t3(n){return Ou.call(s_,n)?!0:Ou.call(i_,n)?!1:e3.test(n)?s_[n]=!0:(i_[n]=!0,!1)}function i3(n,e,t,i){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return i?!1:t!==null?!t.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function s3(n,e,t,i){if(e===null||typeof e>"u"||i3(n,e,t,i))return!0;if(i)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Si(n,e,t,i,s,r,a){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=i,this.attributeNamespace=s,this.mustUseProperty=t,this.propertyName=n,this.type=e,this.sanitizeURL=r,this.removeEmptyString=a}var ai={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){ai[n]=new Si(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var e=n[0];ai[e]=new Si(e,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){ai[n]=new Si(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){ai[n]=new Si(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){ai[n]=new Si(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){ai[n]=new Si(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){ai[n]=new Si(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){ai[n]=new Si(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){ai[n]=new Si(n,5,!1,n.toLowerCase(),null,!1,!1)});var af=/[\-:]([a-z])/g;function of(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var e=n.replace(af,of);ai[e]=new Si(e,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var e=n.replace(af,of);ai[e]=new Si(e,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var e=n.replace(af,of);ai[e]=new Si(e,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){ai[n]=new Si(n,1,!1,n.toLowerCase(),null,!1,!1)});ai.xlinkHref=new Si("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){ai[n]=new Si(n,1,!1,n.toLowerCase(),null,!0,!0)});function lf(n,e,t,i){var s=ai.hasOwnProperty(e)?ai[e]:null;(s!==null?s.type!==0:i||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(s3(e,t,s,i)&&(t=null),i||s===null?t3(e)&&(t===null?n.removeAttribute(e):n.setAttribute(e,""+t)):s.mustUseProperty?n[s.propertyName]=t===null?s.type===3?!1:"":t:(e=s.attributeName,i=s.attributeNamespace,t===null?n.removeAttribute(e):(s=s.type,t=s===3||s===4&&t===!0?"":""+t,i?n.setAttributeNS(i,e,t):n.setAttribute(e,t))))}var An=Jx.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,v0=Symbol.for("react.element"),Yr=Symbol.for("react.portal"),jr=Symbol.for("react.fragment"),hf=Symbol.for("react.strict_mode"),Fu=Symbol.for("react.profiler"),q1=Symbol.for("react.provider"),$1=Symbol.for("react.context"),uf=Symbol.for("react.forward_ref"),Lu=Symbol.for("react.suspense"),Bu=Symbol.for("react.suspense_list"),cf=Symbol.for("react.memo"),Dn=Symbol.for("react.lazy"),Z1=Symbol.for("react.offscreen"),n_=Symbol.iterator;function Ha(n){return n===null||typeof n!="object"?null:(n=n_&&n[n_]||n["@@iterator"],typeof n=="function"?n:null)}var Nt=Object.assign,Wh;function to(n){if(Wh===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);Wh=e&&e[1]||""}return`
`+Wh+n}var Hh=!1;function Kh(n,e){if(!n||Hh)return"";Hh=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(h){var i=h}Reflect.construct(n,[],e)}else{try{e.call()}catch(h){i=h}n.call(e.prototype)}else{try{throw Error()}catch(h){i=h}n()}}catch(h){if(h&&i&&typeof h.stack=="string"){for(var s=h.stack.split(`
`),r=i.stack.split(`
`),a=s.length-1,o=r.length-1;1<=a&&0<=o&&s[a]!==r[o];)o--;for(;1<=a&&0<=o;a--,o--)if(s[a]!==r[o]){if(a!==1||o!==1)do if(a--,o--,0>o||s[a]!==r[o]){var l=`
`+s[a].replace(" at new "," at ");return n.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",n.displayName)),l}while(1<=a&&0<=o);break}}}finally{Hh=!1,Error.prepareStackTrace=t}return(n=n?n.displayName||n.name:"")?to(n):""}function n3(n){switch(n.tag){case 5:return to(n.type);case 16:return to("Lazy");case 13:return to("Suspense");case 19:return to("SuspenseList");case 0:case 2:case 15:return n=Kh(n.type,!1),n;case 11:return n=Kh(n.type.render,!1),n;case 1:return n=Kh(n.type,!0),n;default:return""}}function Nu(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case jr:return"Fragment";case Yr:return"Portal";case Fu:return"Profiler";case hf:return"StrictMode";case Lu:return"Suspense";case Bu:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case $1:return(n.displayName||"Context")+".Consumer";case q1:return(n._context.displayName||"Context")+".Provider";case uf:var e=n.render;return n=n.displayName,n||(n=e.displayName||e.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case cf:return e=n.displayName||null,e!==null?e:Nu(n.type)||"Memo";case Dn:e=n._payload,n=n._init;try{return Nu(n(e))}catch{}}return null}function r3(n){var e=n.type;switch(n.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=e.render,n=n.displayName||n.name||"",e.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Nu(e);case 8:return e===hf?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function qn(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function Q1(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function a3(n){var e=Q1(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),i=""+n[e];if(!n.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var s=t.get,r=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return s.call(this)},set:function(a){i=""+a,r.call(this,a)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return i},setValue:function(a){i=""+a},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function y0(n){n._valueTracker||(n._valueTracker=a3(n))}function J1(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),i="";return n&&(i=Q1(n)?n.checked?"true":"false":n.value),n=i,n!==t?(e.setValue(n),!0):!1}function ll(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function Uu(n,e){var t=e.checked;return Nt({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??n._wrapperState.initialChecked})}function r_(n,e){var t=e.defaultValue==null?"":e.defaultValue,i=e.checked!=null?e.checked:e.defaultChecked;t=qn(e.value!=null?e.value:t),n._wrapperState={initialChecked:i,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function em(n,e){e=e.checked,e!=null&&lf(n,"checked",e,!1)}function ku(n,e){em(n,e);var t=qn(e.value),i=e.type;if(t!=null)i==="number"?(t===0&&n.value===""||n.value!=t)&&(n.value=""+t):n.value!==""+t&&(n.value=""+t);else if(i==="submit"||i==="reset"){n.removeAttribute("value");return}e.hasOwnProperty("value")?Vu(n,e.type,t):e.hasOwnProperty("defaultValue")&&Vu(n,e.type,qn(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(n.defaultChecked=!!e.defaultChecked)}function a_(n,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var i=e.type;if(!(i!=="submit"&&i!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+n._wrapperState.initialValue,t||e===n.value||(n.value=e),n.defaultValue=e}t=n.name,t!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,t!==""&&(n.name=t)}function Vu(n,e,t){(e!=="number"||ll(n.ownerDocument)!==n)&&(t==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+t&&(n.defaultValue=""+t))}var io=Array.isArray;function la(n,e,t,i){if(n=n.options,e){e={};for(var s=0;s<t.length;s++)e["$"+t[s]]=!0;for(t=0;t<n.length;t++)s=e.hasOwnProperty("$"+n[t].value),n[t].selected!==s&&(n[t].selected=s),s&&i&&(n[t].defaultSelected=!0)}else{for(t=""+qn(t),e=null,s=0;s<n.length;s++){if(n[s].value===t){n[s].selected=!0,i&&(n[s].defaultSelected=!0);return}e!==null||n[s].disabled||(e=n[s])}e!==null&&(e.selected=!0)}}function Gu(n,e){if(e.dangerouslySetInnerHTML!=null)throw Error(_e(91));return Nt({},e,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function o_(n,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(_e(92));if(io(t)){if(1<t.length)throw Error(_e(93));t=t[0]}e=t}e==null&&(e=""),t=e}n._wrapperState={initialValue:qn(t)}}function tm(n,e){var t=qn(e.value),i=qn(e.defaultValue);t!=null&&(t=""+t,t!==n.value&&(n.value=t),e.defaultValue==null&&n.defaultValue!==t&&(n.defaultValue=t)),i!=null&&(n.defaultValue=""+i)}function l_(n){var e=n.textContent;e===n._wrapperState.initialValue&&e!==""&&e!==null&&(n.value=e)}function im(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function zu(n,e){return n==null||n==="http://www.w3.org/1999/xhtml"?im(e):n==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var x0,sm=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,i,s){MSApp.execUnsafeLocalFunction(function(){return n(e,t,i,s)})}:n}(function(n,e){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=e;else{for(x0=x0||document.createElement("div"),x0.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=x0.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;e.firstChild;)n.appendChild(e.firstChild)}});function Eo(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var ho={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},o3=["Webkit","ms","Moz","O"];Object.keys(ho).forEach(function(n){o3.forEach(function(e){e=e+n.charAt(0).toUpperCase()+n.substring(1),ho[e]=ho[n]})});function nm(n,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||ho.hasOwnProperty(n)&&ho[n]?(""+e).trim():e+"px"}function rm(n,e){n=n.style;for(var t in e)if(e.hasOwnProperty(t)){var i=t.indexOf("--")===0,s=nm(t,e[t],i);t==="float"&&(t="cssFloat"),i?n.setProperty(t,s):n[t]=s}}var l3=Nt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Wu(n,e){if(e){if(l3[n]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(_e(137,n));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(_e(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(_e(61))}if(e.style!=null&&typeof e.style!="object")throw Error(_e(62))}}function Hu(n,e){if(n.indexOf("-")===-1)return typeof e.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ku=null;function ff(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var Xu=null,ha=null,ua=null;function h_(n){if(n=s0(n)){if(typeof Xu!="function")throw Error(_e(280));var e=n.stateNode;e&&(e=nh(e),Xu(n.stateNode,n.type,e))}}function am(n){ha?ua?ua.push(n):ua=[n]:ha=n}function om(){if(ha){var n=ha,e=ua;if(ua=ha=null,h_(n),e)for(n=0;n<e.length;n++)h_(e[n])}}function lm(n,e){return n(e)}function hm(){}var Xh=!1;function um(n,e,t){if(Xh)return n(e,t);Xh=!0;try{return lm(n,e,t)}finally{Xh=!1,(ha!==null||ua!==null)&&(hm(),om())}}function So(n,e){var t=n.stateNode;if(t===null)return null;var i=nh(t);if(i===null)return null;t=i[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(n=n.type,i=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!i;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error(_e(231,e,typeof t));return t}var Yu=!1;if(pn)try{var Ka={};Object.defineProperty(Ka,"passive",{get:function(){Yu=!0}}),window.addEventListener("test",Ka,Ka),window.removeEventListener("test",Ka,Ka)}catch{Yu=!1}function h3(n,e,t,i,s,r,a,o,l){var h=Array.prototype.slice.call(arguments,3);try{e.apply(t,h)}catch(u){this.onError(u)}}var uo=!1,hl=null,ul=!1,ju=null,u3={onError:function(n){uo=!0,hl=n}};function c3(n,e,t,i,s,r,a,o,l){uo=!1,hl=null,h3.apply(u3,arguments)}function f3(n,e,t,i,s,r,a,o,l){if(c3.apply(this,arguments),uo){if(uo){var h=hl;uo=!1,hl=null}else throw Error(_e(198));ul||(ul=!0,ju=h)}}function Nr(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,e.flags&4098&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function cm(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function u_(n){if(Nr(n)!==n)throw Error(_e(188))}function d3(n){var e=n.alternate;if(!e){if(e=Nr(n),e===null)throw Error(_e(188));return e!==n?null:n}for(var t=n,i=e;;){var s=t.return;if(s===null)break;var r=s.alternate;if(r===null){if(i=s.return,i!==null){t=i;continue}break}if(s.child===r.child){for(r=s.child;r;){if(r===t)return u_(s),n;if(r===i)return u_(s),e;r=r.sibling}throw Error(_e(188))}if(t.return!==i.return)t=s,i=r;else{for(var a=!1,o=s.child;o;){if(o===t){a=!0,t=s,i=r;break}if(o===i){a=!0,i=s,t=r;break}o=o.sibling}if(!a){for(o=r.child;o;){if(o===t){a=!0,t=r,i=s;break}if(o===i){a=!0,i=r,t=s;break}o=o.sibling}if(!a)throw Error(_e(189))}}if(t.alternate!==i)throw Error(_e(190))}if(t.tag!==3)throw Error(_e(188));return t.stateNode.current===t?n:e}function fm(n){return n=d3(n),n!==null?dm(n):null}function dm(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var e=dm(n);if(e!==null)return e;n=n.sibling}return null}var _m=Xi.unstable_scheduleCallback,c_=Xi.unstable_cancelCallback,_3=Xi.unstable_shouldYield,p3=Xi.unstable_requestPaint,Ht=Xi.unstable_now,g3=Xi.unstable_getCurrentPriorityLevel,df=Xi.unstable_ImmediatePriority,pm=Xi.unstable_UserBlockingPriority,cl=Xi.unstable_NormalPriority,m3=Xi.unstable_LowPriority,gm=Xi.unstable_IdlePriority,eh=null,Gs=null;function v3(n){if(Gs&&typeof Gs.onCommitFiberRoot=="function")try{Gs.onCommitFiberRoot(eh,n,void 0,(n.current.flags&128)===128)}catch{}}var Es=Math.clz32?Math.clz32:b3,y3=Math.log,x3=Math.LN2;function b3(n){return n>>>=0,n===0?32:31-(y3(n)/x3|0)|0}var b0=64,T0=4194304;function so(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function fl(n,e){var t=n.pendingLanes;if(t===0)return 0;var i=0,s=n.suspendedLanes,r=n.pingedLanes,a=t&268435455;if(a!==0){var o=a&~s;o!==0?i=so(o):(r&=a,r!==0&&(i=so(r)))}else a=t&~s,a!==0?i=so(a):r!==0&&(i=so(r));if(i===0)return 0;if(e!==0&&e!==i&&!(e&s)&&(s=i&-i,r=e&-e,s>=r||s===16&&(r&4194240)!==0))return e;if(i&4&&(i|=t&16),e=n.entangledLanes,e!==0)for(n=n.entanglements,e&=i;0<e;)t=31-Es(e),s=1<<t,i|=n[t],e&=~s;return i}function T3(n,e){switch(n){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function A3(n,e){for(var t=n.suspendedLanes,i=n.pingedLanes,s=n.expirationTimes,r=n.pendingLanes;0<r;){var a=31-Es(r),o=1<<a,l=s[a];l===-1?(!(o&t)||o&i)&&(s[a]=T3(o,e)):l<=e&&(n.expiredLanes|=o),r&=~o}}function qu(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function mm(){var n=b0;return b0<<=1,!(b0&4194240)&&(b0=64),n}function Yh(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function t0(n,e,t){n.pendingLanes|=e,e!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,e=31-Es(e),n[e]=t}function E3(n,e){var t=n.pendingLanes&~e;n.pendingLanes=e,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=e,n.mutableReadLanes&=e,n.entangledLanes&=e,e=n.entanglements;var i=n.eventTimes;for(n=n.expirationTimes;0<t;){var s=31-Es(t),r=1<<s;e[s]=0,i[s]=-1,n[s]=-1,t&=~r}}function _f(n,e){var t=n.entangledLanes|=e;for(n=n.entanglements;t;){var i=31-Es(t),s=1<<i;s&e|n[i]&e&&(n[i]|=e),t&=~s}}var ct=0;function vm(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var ym,pf,xm,bm,Tm,$u=!1,A0=[],Gn=null,zn=null,Wn=null,Ro=new Map,Io=new Map,Ln=[],S3="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function f_(n,e){switch(n){case"focusin":case"focusout":Gn=null;break;case"dragenter":case"dragleave":zn=null;break;case"mouseover":case"mouseout":Wn=null;break;case"pointerover":case"pointerout":Ro.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Io.delete(e.pointerId)}}function Xa(n,e,t,i,s,r){return n===null||n.nativeEvent!==r?(n={blockedOn:e,domEventName:t,eventSystemFlags:i,nativeEvent:r,targetContainers:[s]},e!==null&&(e=s0(e),e!==null&&pf(e)),n):(n.eventSystemFlags|=i,e=n.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),n)}function R3(n,e,t,i,s){switch(e){case"focusin":return Gn=Xa(Gn,n,e,t,i,s),!0;case"dragenter":return zn=Xa(zn,n,e,t,i,s),!0;case"mouseover":return Wn=Xa(Wn,n,e,t,i,s),!0;case"pointerover":var r=s.pointerId;return Ro.set(r,Xa(Ro.get(r)||null,n,e,t,i,s)),!0;case"gotpointercapture":return r=s.pointerId,Io.set(r,Xa(Io.get(r)||null,n,e,t,i,s)),!0}return!1}function Am(n){var e=pr(n.target);if(e!==null){var t=Nr(e);if(t!==null){if(e=t.tag,e===13){if(e=cm(t),e!==null){n.blockedOn=e,Tm(n.priority,function(){xm(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function X0(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=Zu(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t===null){t=n.nativeEvent;var i=new t.constructor(t.type,t);Ku=i,t.target.dispatchEvent(i),Ku=null}else return e=s0(t),e!==null&&pf(e),n.blockedOn=t,!1;e.shift()}return!0}function d_(n,e,t){X0(n)&&t.delete(e)}function I3(){$u=!1,Gn!==null&&X0(Gn)&&(Gn=null),zn!==null&&X0(zn)&&(zn=null),Wn!==null&&X0(Wn)&&(Wn=null),Ro.forEach(d_),Io.forEach(d_)}function Ya(n,e){n.blockedOn===e&&(n.blockedOn=null,$u||($u=!0,Xi.unstable_scheduleCallback(Xi.unstable_NormalPriority,I3)))}function Co(n){function e(s){return Ya(s,n)}if(0<A0.length){Ya(A0[0],n);for(var t=1;t<A0.length;t++){var i=A0[t];i.blockedOn===n&&(i.blockedOn=null)}}for(Gn!==null&&Ya(Gn,n),zn!==null&&Ya(zn,n),Wn!==null&&Ya(Wn,n),Ro.forEach(e),Io.forEach(e),t=0;t<Ln.length;t++)i=Ln[t],i.blockedOn===n&&(i.blockedOn=null);for(;0<Ln.length&&(t=Ln[0],t.blockedOn===null);)Am(t),t.blockedOn===null&&Ln.shift()}var ca=An.ReactCurrentBatchConfig,dl=!0;function C3(n,e,t,i){var s=ct,r=ca.transition;ca.transition=null;try{ct=1,gf(n,e,t,i)}finally{ct=s,ca.transition=r}}function M3(n,e,t,i){var s=ct,r=ca.transition;ca.transition=null;try{ct=4,gf(n,e,t,i)}finally{ct=s,ca.transition=r}}function gf(n,e,t,i){if(dl){var s=Zu(n,e,t,i);if(s===null)su(n,e,i,_l,t),f_(n,i);else if(R3(s,n,e,t,i))i.stopPropagation();else if(f_(n,i),e&4&&-1<S3.indexOf(n)){for(;s!==null;){var r=s0(s);if(r!==null&&ym(r),r=Zu(n,e,t,i),r===null&&su(n,e,i,_l,t),r===s)break;s=r}s!==null&&i.stopPropagation()}else su(n,e,i,null,t)}}var _l=null;function Zu(n,e,t,i){if(_l=null,n=ff(i),n=pr(n),n!==null)if(e=Nr(n),e===null)n=null;else if(t=e.tag,t===13){if(n=cm(e),n!==null)return n;n=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;n=null}else e!==n&&(n=null);return _l=n,null}function Em(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(g3()){case df:return 1;case pm:return 4;case cl:case m3:return 16;case gm:return 536870912;default:return 16}default:return 16}}var Un=null,mf=null,Y0=null;function Sm(){if(Y0)return Y0;var n,e=mf,t=e.length,i,s="value"in Un?Un.value:Un.textContent,r=s.length;for(n=0;n<t&&e[n]===s[n];n++);var a=t-n;for(i=1;i<=a&&e[t-i]===s[r-i];i++);return Y0=s.slice(n,1<i?1-i:void 0)}function j0(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function E0(){return!0}function __(){return!1}function $i(n){function e(t,i,s,r,a){this._reactName=t,this._targetInst=s,this.type=i,this.nativeEvent=r,this.target=a,this.currentTarget=null;for(var o in n)n.hasOwnProperty(o)&&(t=n[o],this[o]=t?t(r):r[o]);return this.isDefaultPrevented=(r.defaultPrevented!=null?r.defaultPrevented:r.returnValue===!1)?E0:__,this.isPropagationStopped=__,this}return Nt(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=E0)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=E0)},persist:function(){},isPersistent:E0}),e}var Na={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},vf=$i(Na),i0=Nt({},Na,{view:0,detail:0}),P3=$i(i0),jh,qh,ja,th=Nt({},i0,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:yf,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==ja&&(ja&&n.type==="mousemove"?(jh=n.screenX-ja.screenX,qh=n.screenY-ja.screenY):qh=jh=0,ja=n),jh)},movementY:function(n){return"movementY"in n?n.movementY:qh}}),p_=$i(th),w3=Nt({},th,{dataTransfer:0}),D3=$i(w3),O3=Nt({},i0,{relatedTarget:0}),$h=$i(O3),F3=Nt({},Na,{animationName:0,elapsedTime:0,pseudoElement:0}),L3=$i(F3),B3=Nt({},Na,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),N3=$i(B3),U3=Nt({},Na,{data:0}),g_=$i(U3),k3={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},V3={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},G3={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function z3(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=G3[n])?!!e[n]:!1}function yf(){return z3}var W3=Nt({},i0,{key:function(n){if(n.key){var e=k3[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=j0(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?V3[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:yf,charCode:function(n){return n.type==="keypress"?j0(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?j0(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),H3=$i(W3),K3=Nt({},th,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),m_=$i(K3),X3=Nt({},i0,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:yf}),Y3=$i(X3),j3=Nt({},Na,{propertyName:0,elapsedTime:0,pseudoElement:0}),q3=$i(j3),$3=Nt({},th,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),Z3=$i($3),Q3=[9,13,27,32],xf=pn&&"CompositionEvent"in window,co=null;pn&&"documentMode"in document&&(co=document.documentMode);var J3=pn&&"TextEvent"in window&&!co,Rm=pn&&(!xf||co&&8<co&&11>=co),v_=" ",y_=!1;function Im(n,e){switch(n){case"keyup":return Q3.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Cm(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var qr=!1;function eb(n,e){switch(n){case"compositionend":return Cm(e);case"keypress":return e.which!==32?null:(y_=!0,v_);case"textInput":return n=e.data,n===v_&&y_?null:n;default:return null}}function tb(n,e){if(qr)return n==="compositionend"||!xf&&Im(n,e)?(n=Sm(),Y0=mf=Un=null,qr=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return Rm&&e.locale!=="ko"?null:e.data;default:return null}}var ib={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function x_(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!ib[n.type]:e==="textarea"}function Mm(n,e,t,i){am(i),e=pl(e,"onChange"),0<e.length&&(t=new vf("onChange","change",null,t,i),n.push({event:t,listeners:e}))}var fo=null,Mo=null;function sb(n){Vm(n,0)}function ih(n){var e=Qr(n);if(J1(e))return n}function nb(n,e){if(n==="change")return e}var Pm=!1;if(pn){var Zh;if(pn){var Qh="oninput"in document;if(!Qh){var b_=document.createElement("div");b_.setAttribute("oninput","return;"),Qh=typeof b_.oninput=="function"}Zh=Qh}else Zh=!1;Pm=Zh&&(!document.documentMode||9<document.documentMode)}function T_(){fo&&(fo.detachEvent("onpropertychange",wm),Mo=fo=null)}function wm(n){if(n.propertyName==="value"&&ih(Mo)){var e=[];Mm(e,Mo,n,ff(n)),um(sb,e)}}function rb(n,e,t){n==="focusin"?(T_(),fo=e,Mo=t,fo.attachEvent("onpropertychange",wm)):n==="focusout"&&T_()}function ab(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return ih(Mo)}function ob(n,e){if(n==="click")return ih(e)}function lb(n,e){if(n==="input"||n==="change")return ih(e)}function hb(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var Is=typeof Object.is=="function"?Object.is:hb;function Po(n,e){if(Is(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),i=Object.keys(e);if(t.length!==i.length)return!1;for(i=0;i<t.length;i++){var s=t[i];if(!Ou.call(e,s)||!Is(n[s],e[s]))return!1}return!0}function A_(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function E_(n,e){var t=A_(n);n=0;for(var i;t;){if(t.nodeType===3){if(i=n+t.textContent.length,n<=e&&i>=e)return{node:t,offset:e-n};n=i}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=A_(t)}}function Dm(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?Dm(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function Om(){for(var n=window,e=ll();e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=ll(n.document)}return e}function bf(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}function ub(n){var e=Om(),t=n.focusedElem,i=n.selectionRange;if(e!==t&&t&&t.ownerDocument&&Dm(t.ownerDocument.documentElement,t)){if(i!==null&&bf(t)){if(e=i.start,n=i.end,n===void 0&&(n=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(n,t.value.length);else if(n=(e=t.ownerDocument||document)&&e.defaultView||window,n.getSelection){n=n.getSelection();var s=t.textContent.length,r=Math.min(i.start,s);i=i.end===void 0?r:Math.min(i.end,s),!n.extend&&r>i&&(s=i,i=r,r=s),s=E_(t,r);var a=E_(t,i);s&&a&&(n.rangeCount!==1||n.anchorNode!==s.node||n.anchorOffset!==s.offset||n.focusNode!==a.node||n.focusOffset!==a.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),n.removeAllRanges(),r>i?(n.addRange(e),n.extend(a.node,a.offset)):(e.setEnd(a.node,a.offset),n.addRange(e)))}}for(e=[],n=t;n=n.parentNode;)n.nodeType===1&&e.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)n=e[t],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var cb=pn&&"documentMode"in document&&11>=document.documentMode,$r=null,Qu=null,_o=null,Ju=!1;function S_(n,e,t){var i=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;Ju||$r==null||$r!==ll(i)||(i=$r,"selectionStart"in i&&bf(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),_o&&Po(_o,i)||(_o=i,i=pl(Qu,"onSelect"),0<i.length&&(e=new vf("onSelect","select",null,e,t),n.push({event:e,listeners:i}),e.target=$r)))}function S0(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var Zr={animationend:S0("Animation","AnimationEnd"),animationiteration:S0("Animation","AnimationIteration"),animationstart:S0("Animation","AnimationStart"),transitionend:S0("Transition","TransitionEnd")},Jh={},Fm={};pn&&(Fm=document.createElement("div").style,"AnimationEvent"in window||(delete Zr.animationend.animation,delete Zr.animationiteration.animation,delete Zr.animationstart.animation),"TransitionEvent"in window||delete Zr.transitionend.transition);function sh(n){if(Jh[n])return Jh[n];if(!Zr[n])return n;var e=Zr[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in Fm)return Jh[n]=e[t];return n}var Lm=sh("animationend"),Bm=sh("animationiteration"),Nm=sh("animationstart"),Um=sh("transitionend"),km=new Map,R_="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function er(n,e){km.set(n,e),Br(e,[n])}for(var eu=0;eu<R_.length;eu++){var tu=R_[eu],fb=tu.toLowerCase(),db=tu[0].toUpperCase()+tu.slice(1);er(fb,"on"+db)}er(Lm,"onAnimationEnd");er(Bm,"onAnimationIteration");er(Nm,"onAnimationStart");er("dblclick","onDoubleClick");er("focusin","onFocus");er("focusout","onBlur");er(Um,"onTransitionEnd");ya("onMouseEnter",["mouseout","mouseover"]);ya("onMouseLeave",["mouseout","mouseover"]);ya("onPointerEnter",["pointerout","pointerover"]);ya("onPointerLeave",["pointerout","pointerover"]);Br("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Br("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Br("onBeforeInput",["compositionend","keypress","textInput","paste"]);Br("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Br("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Br("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var no="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),_b=new Set("cancel close invalid load scroll toggle".split(" ").concat(no));function I_(n,e,t){var i=n.type||"unknown-event";n.currentTarget=t,f3(i,e,void 0,n),n.currentTarget=null}function Vm(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var i=n[t],s=i.event;i=i.listeners;e:{var r=void 0;if(e)for(var a=i.length-1;0<=a;a--){var o=i[a],l=o.instance,h=o.currentTarget;if(o=o.listener,l!==r&&s.isPropagationStopped())break e;I_(s,o,h),r=l}else for(a=0;a<i.length;a++){if(o=i[a],l=o.instance,h=o.currentTarget,o=o.listener,l!==r&&s.isPropagationStopped())break e;I_(s,o,h),r=l}}}if(ul)throw n=ju,ul=!1,ju=null,n}function At(n,e){var t=e[nc];t===void 0&&(t=e[nc]=new Set);var i=n+"__bubble";t.has(i)||(Gm(e,n,2,!1),t.add(i))}function iu(n,e,t){var i=0;e&&(i|=4),Gm(t,n,i,e)}var R0="_reactListening"+Math.random().toString(36).slice(2);function wo(n){if(!n[R0]){n[R0]=!0,j1.forEach(function(t){t!=="selectionchange"&&(_b.has(t)||iu(t,!1,n),iu(t,!0,n))});var e=n.nodeType===9?n:n.ownerDocument;e===null||e[R0]||(e[R0]=!0,iu("selectionchange",!1,e))}}function Gm(n,e,t,i){switch(Em(e)){case 1:var s=C3;break;case 4:s=M3;break;default:s=gf}t=s.bind(null,e,t,n),s=void 0,!Yu||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),i?s!==void 0?n.addEventListener(e,t,{capture:!0,passive:s}):n.addEventListener(e,t,!0):s!==void 0?n.addEventListener(e,t,{passive:s}):n.addEventListener(e,t,!1)}function su(n,e,t,i,s){var r=i;if(!(e&1)&&!(e&2)&&i!==null)e:for(;;){if(i===null)return;var a=i.tag;if(a===3||a===4){var o=i.stateNode.containerInfo;if(o===s||o.nodeType===8&&o.parentNode===s)break;if(a===4)for(a=i.return;a!==null;){var l=a.tag;if((l===3||l===4)&&(l=a.stateNode.containerInfo,l===s||l.nodeType===8&&l.parentNode===s))return;a=a.return}for(;o!==null;){if(a=pr(o),a===null)return;if(l=a.tag,l===5||l===6){i=r=a;continue e}o=o.parentNode}}i=i.return}um(function(){var h=r,u=ff(t),c=[];e:{var f=km.get(n);if(f!==void 0){var d=vf,_=n;switch(n){case"keypress":if(j0(t)===0)break e;case"keydown":case"keyup":d=H3;break;case"focusin":_="focus",d=$h;break;case"focusout":_="blur",d=$h;break;case"beforeblur":case"afterblur":d=$h;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":d=p_;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":d=D3;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":d=Y3;break;case Lm:case Bm:case Nm:d=L3;break;case Um:d=q3;break;case"scroll":d=P3;break;case"wheel":d=Z3;break;case"copy":case"cut":case"paste":d=N3;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":d=m_}var p=(e&4)!==0,g=!p&&n==="scroll",m=p?f!==null?f+"Capture":null:f;p=[];for(var v=h,T;v!==null;){T=v;var A=T.stateNode;if(T.tag===5&&A!==null&&(T=A,m!==null&&(A=So(v,m),A!=null&&p.push(Do(v,A,T)))),g)break;v=v.return}0<p.length&&(f=new d(f,_,null,t,u),c.push({event:f,listeners:p}))}}if(!(e&7)){e:{if(f=n==="mouseover"||n==="pointerover",d=n==="mouseout"||n==="pointerout",f&&t!==Ku&&(_=t.relatedTarget||t.fromElement)&&(pr(_)||_[gn]))break e;if((d||f)&&(f=u.window===u?u:(f=u.ownerDocument)?f.defaultView||f.parentWindow:window,d?(_=t.relatedTarget||t.toElement,d=h,_=_?pr(_):null,_!==null&&(g=Nr(_),_!==g||_.tag!==5&&_.tag!==6)&&(_=null)):(d=null,_=h),d!==_)){if(p=p_,A="onMouseLeave",m="onMouseEnter",v="mouse",(n==="pointerout"||n==="pointerover")&&(p=m_,A="onPointerLeave",m="onPointerEnter",v="pointer"),g=d==null?f:Qr(d),T=_==null?f:Qr(_),f=new p(A,v+"leave",d,t,u),f.target=g,f.relatedTarget=T,A=null,pr(u)===h&&(p=new p(m,v+"enter",_,t,u),p.target=T,p.relatedTarget=g,A=p),g=A,d&&_)t:{for(p=d,m=_,v=0,T=p;T;T=Gr(T))v++;for(T=0,A=m;A;A=Gr(A))T++;for(;0<v-T;)p=Gr(p),v--;for(;0<T-v;)m=Gr(m),T--;for(;v--;){if(p===m||m!==null&&p===m.alternate)break t;p=Gr(p),m=Gr(m)}p=null}else p=null;d!==null&&C_(c,f,d,p,!1),_!==null&&g!==null&&C_(c,g,_,p,!0)}}e:{if(f=h?Qr(h):window,d=f.nodeName&&f.nodeName.toLowerCase(),d==="select"||d==="input"&&f.type==="file")var b=nb;else if(x_(f))if(Pm)b=lb;else{b=ab;var x=rb}else(d=f.nodeName)&&d.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(b=ob);if(b&&(b=b(n,h))){Mm(c,b,t,u);break e}x&&x(n,f,h),n==="focusout"&&(x=f._wrapperState)&&x.controlled&&f.type==="number"&&Vu(f,"number",f.value)}switch(x=h?Qr(h):window,n){case"focusin":(x_(x)||x.contentEditable==="true")&&($r=x,Qu=h,_o=null);break;case"focusout":_o=Qu=$r=null;break;case"mousedown":Ju=!0;break;case"contextmenu":case"mouseup":case"dragend":Ju=!1,S_(c,t,u);break;case"selectionchange":if(cb)break;case"keydown":case"keyup":S_(c,t,u)}var E;if(xf)e:{switch(n){case"compositionstart":var R="onCompositionStart";break e;case"compositionend":R="onCompositionEnd";break e;case"compositionupdate":R="onCompositionUpdate";break e}R=void 0}else qr?Im(n,t)&&(R="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&(R="onCompositionStart");R&&(Rm&&t.locale!=="ko"&&(qr||R!=="onCompositionStart"?R==="onCompositionEnd"&&qr&&(E=Sm()):(Un=u,mf="value"in Un?Un.value:Un.textContent,qr=!0)),x=pl(h,R),0<x.length&&(R=new g_(R,n,null,t,u),c.push({event:R,listeners:x}),E?R.data=E:(E=Cm(t),E!==null&&(R.data=E)))),(E=J3?eb(n,t):tb(n,t))&&(h=pl(h,"onBeforeInput"),0<h.length&&(u=new g_("onBeforeInput","beforeinput",null,t,u),c.push({event:u,listeners:h}),u.data=E))}Vm(c,e)})}function Do(n,e,t){return{instance:n,listener:e,currentTarget:t}}function pl(n,e){for(var t=e+"Capture",i=[];n!==null;){var s=n,r=s.stateNode;s.tag===5&&r!==null&&(s=r,r=So(n,t),r!=null&&i.unshift(Do(n,r,s)),r=So(n,e),r!=null&&i.push(Do(n,r,s))),n=n.return}return i}function Gr(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function C_(n,e,t,i,s){for(var r=e._reactName,a=[];t!==null&&t!==i;){var o=t,l=o.alternate,h=o.stateNode;if(l!==null&&l===i)break;o.tag===5&&h!==null&&(o=h,s?(l=So(t,r),l!=null&&a.unshift(Do(t,l,o))):s||(l=So(t,r),l!=null&&a.push(Do(t,l,o)))),t=t.return}a.length!==0&&n.push({event:e,listeners:a})}var pb=/\r\n?/g,gb=/\u0000|\uFFFD/g;function M_(n){return(typeof n=="string"?n:""+n).replace(pb,`
`).replace(gb,"")}function I0(n,e,t){if(e=M_(e),M_(n)!==e&&t)throw Error(_e(425))}function gl(){}var ec=null,tc=null;function ic(n,e){return n==="textarea"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var sc=typeof setTimeout=="function"?setTimeout:void 0,mb=typeof clearTimeout=="function"?clearTimeout:void 0,P_=typeof Promise=="function"?Promise:void 0,vb=typeof queueMicrotask=="function"?queueMicrotask:typeof P_<"u"?function(n){return P_.resolve(null).then(n).catch(yb)}:sc;function yb(n){setTimeout(function(){throw n})}function nu(n,e){var t=e,i=0;do{var s=t.nextSibling;if(n.removeChild(t),s&&s.nodeType===8)if(t=s.data,t==="/$"){if(i===0){n.removeChild(s),Co(e);return}i--}else t!=="$"&&t!=="$?"&&t!=="$!"||i++;t=s}while(t);Co(e)}function Hn(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break;if(e===8){if(e=n.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return n}function w_(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}var Ua=Math.random().toString(36).slice(2),Ns="__reactFiber$"+Ua,Oo="__reactProps$"+Ua,gn="__reactContainer$"+Ua,nc="__reactEvents$"+Ua,xb="__reactListeners$"+Ua,bb="__reactHandles$"+Ua;function pr(n){var e=n[Ns];if(e)return e;for(var t=n.parentNode;t;){if(e=t[gn]||t[Ns]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=w_(n);n!==null;){if(t=n[Ns])return t;n=w_(n)}return e}n=t,t=n.parentNode}return null}function s0(n){return n=n[Ns]||n[gn],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function Qr(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(_e(33))}function nh(n){return n[Oo]||null}var rc=[],Jr=-1;function tr(n){return{current:n}}function St(n){0>Jr||(n.current=rc[Jr],rc[Jr]=null,Jr--)}function bt(n,e){Jr++,rc[Jr]=n.current,n.current=e}var $n={},gi=tr($n),Li=tr(!1),Ir=$n;function xa(n,e){var t=n.type.contextTypes;if(!t)return $n;var i=n.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===e)return i.__reactInternalMemoizedMaskedChildContext;var s={},r;for(r in t)s[r]=e[r];return i&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=s),s}function Bi(n){return n=n.childContextTypes,n!=null}function ml(){St(Li),St(gi)}function D_(n,e,t){if(gi.current!==$n)throw Error(_e(168));bt(gi,e),bt(Li,t)}function zm(n,e,t){var i=n.stateNode;if(e=e.childContextTypes,typeof i.getChildContext!="function")return t;i=i.getChildContext();for(var s in i)if(!(s in e))throw Error(_e(108,r3(n)||"Unknown",s));return Nt({},t,i)}function vl(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||$n,Ir=gi.current,bt(gi,n),bt(Li,Li.current),!0}function O_(n,e,t){var i=n.stateNode;if(!i)throw Error(_e(169));t?(n=zm(n,e,Ir),i.__reactInternalMemoizedMergedChildContext=n,St(Li),St(gi),bt(gi,n)):St(Li),bt(Li,t)}var hn=null,rh=!1,ru=!1;function Wm(n){hn===null?hn=[n]:hn.push(n)}function Tb(n){rh=!0,Wm(n)}function ir(){if(!ru&&hn!==null){ru=!0;var n=0,e=ct;try{var t=hn;for(ct=1;n<t.length;n++){var i=t[n];do i=i(!0);while(i!==null)}hn=null,rh=!1}catch(s){throw hn!==null&&(hn=hn.slice(n+1)),_m(df,ir),s}finally{ct=e,ru=!1}}return null}var ea=[],ta=0,yl=null,xl=0,es=[],ts=0,Cr=null,cn=1,fn="";function hr(n,e){ea[ta++]=xl,ea[ta++]=yl,yl=n,xl=e}function Hm(n,e,t){es[ts++]=cn,es[ts++]=fn,es[ts++]=Cr,Cr=n;var i=cn;n=fn;var s=32-Es(i)-1;i&=~(1<<s),t+=1;var r=32-Es(e)+s;if(30<r){var a=s-s%5;r=(i&(1<<a)-1).toString(32),i>>=a,s-=a,cn=1<<32-Es(e)+s|t<<s|i,fn=r+n}else cn=1<<r|t<<s|i,fn=n}function Tf(n){n.return!==null&&(hr(n,1),Hm(n,1,0))}function Af(n){for(;n===yl;)yl=ea[--ta],ea[ta]=null,xl=ea[--ta],ea[ta]=null;for(;n===Cr;)Cr=es[--ts],es[ts]=null,fn=es[--ts],es[ts]=null,cn=es[--ts],es[ts]=null}var Ki=null,Wi=null,Pt=!1,xs=null;function Km(n,e){var t=is(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=n,e=n.deletions,e===null?(n.deletions=[t],n.flags|=16):e.push(t)}function F_(n,e){switch(n.tag){case 5:var t=n.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(n.stateNode=e,Ki=n,Wi=Hn(e.firstChild),!0):!1;case 6:return e=n.pendingProps===""||e.nodeType!==3?null:e,e!==null?(n.stateNode=e,Ki=n,Wi=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=Cr!==null?{id:cn,overflow:fn}:null,n.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=is(18,null,null,0),t.stateNode=e,t.return=n,n.child=t,Ki=n,Wi=null,!0):!1;default:return!1}}function ac(n){return(n.mode&1)!==0&&(n.flags&128)===0}function oc(n){if(Pt){var e=Wi;if(e){var t=e;if(!F_(n,e)){if(ac(n))throw Error(_e(418));e=Hn(t.nextSibling);var i=Ki;e&&F_(n,e)?Km(i,t):(n.flags=n.flags&-4097|2,Pt=!1,Ki=n)}}else{if(ac(n))throw Error(_e(418));n.flags=n.flags&-4097|2,Pt=!1,Ki=n}}}function L_(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;Ki=n}function C0(n){if(n!==Ki)return!1;if(!Pt)return L_(n),Pt=!0,!1;var e;if((e=n.tag!==3)&&!(e=n.tag!==5)&&(e=n.type,e=e!=="head"&&e!=="body"&&!ic(n.type,n.memoizedProps)),e&&(e=Wi)){if(ac(n))throw Xm(),Error(_e(418));for(;e;)Km(n,e),e=Hn(e.nextSibling)}if(L_(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(_e(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="/$"){if(e===0){Wi=Hn(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}n=n.nextSibling}Wi=null}}else Wi=Ki?Hn(n.stateNode.nextSibling):null;return!0}function Xm(){for(var n=Wi;n;)n=Hn(n.nextSibling)}function ba(){Wi=Ki=null,Pt=!1}function Ef(n){xs===null?xs=[n]:xs.push(n)}var Ab=An.ReactCurrentBatchConfig;function qa(n,e,t){if(n=t.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(_e(309));var i=t.stateNode}if(!i)throw Error(_e(147,n));var s=i,r=""+n;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===r?e.ref:(e=function(a){var o=s.refs;a===null?delete o[r]:o[r]=a},e._stringRef=r,e)}if(typeof n!="string")throw Error(_e(284));if(!t._owner)throw Error(_e(290,n))}return n}function M0(n,e){throw n=Object.prototype.toString.call(e),Error(_e(31,n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n))}function B_(n){var e=n._init;return e(n._payload)}function Ym(n){function e(m,v){if(n){var T=m.deletions;T===null?(m.deletions=[v],m.flags|=16):T.push(v)}}function t(m,v){if(!n)return null;for(;v!==null;)e(m,v),v=v.sibling;return null}function i(m,v){for(m=new Map;v!==null;)v.key!==null?m.set(v.key,v):m.set(v.index,v),v=v.sibling;return m}function s(m,v){return m=jn(m,v),m.index=0,m.sibling=null,m}function r(m,v,T){return m.index=T,n?(T=m.alternate,T!==null?(T=T.index,T<v?(m.flags|=2,v):T):(m.flags|=2,v)):(m.flags|=1048576,v)}function a(m){return n&&m.alternate===null&&(m.flags|=2),m}function o(m,v,T,A){return v===null||v.tag!==6?(v=fu(T,m.mode,A),v.return=m,v):(v=s(v,T),v.return=m,v)}function l(m,v,T,A){var b=T.type;return b===jr?u(m,v,T.props.children,A,T.key):v!==null&&(v.elementType===b||typeof b=="object"&&b!==null&&b.$$typeof===Dn&&B_(b)===v.type)?(A=s(v,T.props),A.ref=qa(m,v,T),A.return=m,A):(A=tl(T.type,T.key,T.props,null,m.mode,A),A.ref=qa(m,v,T),A.return=m,A)}function h(m,v,T,A){return v===null||v.tag!==4||v.stateNode.containerInfo!==T.containerInfo||v.stateNode.implementation!==T.implementation?(v=du(T,m.mode,A),v.return=m,v):(v=s(v,T.children||[]),v.return=m,v)}function u(m,v,T,A,b){return v===null||v.tag!==7?(v=Tr(T,m.mode,A,b),v.return=m,v):(v=s(v,T),v.return=m,v)}function c(m,v,T){if(typeof v=="string"&&v!==""||typeof v=="number")return v=fu(""+v,m.mode,T),v.return=m,v;if(typeof v=="object"&&v!==null){switch(v.$$typeof){case v0:return T=tl(v.type,v.key,v.props,null,m.mode,T),T.ref=qa(m,null,v),T.return=m,T;case Yr:return v=du(v,m.mode,T),v.return=m,v;case Dn:var A=v._init;return c(m,A(v._payload),T)}if(io(v)||Ha(v))return v=Tr(v,m.mode,T,null),v.return=m,v;M0(m,v)}return null}function f(m,v,T,A){var b=v!==null?v.key:null;if(typeof T=="string"&&T!==""||typeof T=="number")return b!==null?null:o(m,v,""+T,A);if(typeof T=="object"&&T!==null){switch(T.$$typeof){case v0:return T.key===b?l(m,v,T,A):null;case Yr:return T.key===b?h(m,v,T,A):null;case Dn:return b=T._init,f(m,v,b(T._payload),A)}if(io(T)||Ha(T))return b!==null?null:u(m,v,T,A,null);M0(m,T)}return null}function d(m,v,T,A,b){if(typeof A=="string"&&A!==""||typeof A=="number")return m=m.get(T)||null,o(v,m,""+A,b);if(typeof A=="object"&&A!==null){switch(A.$$typeof){case v0:return m=m.get(A.key===null?T:A.key)||null,l(v,m,A,b);case Yr:return m=m.get(A.key===null?T:A.key)||null,h(v,m,A,b);case Dn:var x=A._init;return d(m,v,T,x(A._payload),b)}if(io(A)||Ha(A))return m=m.get(T)||null,u(v,m,A,b,null);M0(v,A)}return null}function _(m,v,T,A){for(var b=null,x=null,E=v,R=v=0,C=null;E!==null&&R<T.length;R++){E.index>R?(C=E,E=null):C=E.sibling;var I=f(m,E,T[R],A);if(I===null){E===null&&(E=C);break}n&&E&&I.alternate===null&&e(m,E),v=r(I,v,R),x===null?b=I:x.sibling=I,x=I,E=C}if(R===T.length)return t(m,E),Pt&&hr(m,R),b;if(E===null){for(;R<T.length;R++)E=c(m,T[R],A),E!==null&&(v=r(E,v,R),x===null?b=E:x.sibling=E,x=E);return Pt&&hr(m,R),b}for(E=i(m,E);R<T.length;R++)C=d(E,m,R,T[R],A),C!==null&&(n&&C.alternate!==null&&E.delete(C.key===null?R:C.key),v=r(C,v,R),x===null?b=C:x.sibling=C,x=C);return n&&E.forEach(function(D){return e(m,D)}),Pt&&hr(m,R),b}function p(m,v,T,A){var b=Ha(T);if(typeof b!="function")throw Error(_e(150));if(T=b.call(T),T==null)throw Error(_e(151));for(var x=b=null,E=v,R=v=0,C=null,I=T.next();E!==null&&!I.done;R++,I=T.next()){E.index>R?(C=E,E=null):C=E.sibling;var D=f(m,E,I.value,A);if(D===null){E===null&&(E=C);break}n&&E&&D.alternate===null&&e(m,E),v=r(D,v,R),x===null?b=D:x.sibling=D,x=D,E=C}if(I.done)return t(m,E),Pt&&hr(m,R),b;if(E===null){for(;!I.done;R++,I=T.next())I=c(m,I.value,A),I!==null&&(v=r(I,v,R),x===null?b=I:x.sibling=I,x=I);return Pt&&hr(m,R),b}for(E=i(m,E);!I.done;R++,I=T.next())I=d(E,m,R,I.value,A),I!==null&&(n&&I.alternate!==null&&E.delete(I.key===null?R:I.key),v=r(I,v,R),x===null?b=I:x.sibling=I,x=I);return n&&E.forEach(function(w){return e(m,w)}),Pt&&hr(m,R),b}function g(m,v,T,A){if(typeof T=="object"&&T!==null&&T.type===jr&&T.key===null&&(T=T.props.children),typeof T=="object"&&T!==null){switch(T.$$typeof){case v0:e:{for(var b=T.key,x=v;x!==null;){if(x.key===b){if(b=T.type,b===jr){if(x.tag===7){t(m,x.sibling),v=s(x,T.props.children),v.return=m,m=v;break e}}else if(x.elementType===b||typeof b=="object"&&b!==null&&b.$$typeof===Dn&&B_(b)===x.type){t(m,x.sibling),v=s(x,T.props),v.ref=qa(m,x,T),v.return=m,m=v;break e}t(m,x);break}else e(m,x);x=x.sibling}T.type===jr?(v=Tr(T.props.children,m.mode,A,T.key),v.return=m,m=v):(A=tl(T.type,T.key,T.props,null,m.mode,A),A.ref=qa(m,v,T),A.return=m,m=A)}return a(m);case Yr:e:{for(x=T.key;v!==null;){if(v.key===x)if(v.tag===4&&v.stateNode.containerInfo===T.containerInfo&&v.stateNode.implementation===T.implementation){t(m,v.sibling),v=s(v,T.children||[]),v.return=m,m=v;break e}else{t(m,v);break}else e(m,v);v=v.sibling}v=du(T,m.mode,A),v.return=m,m=v}return a(m);case Dn:return x=T._init,g(m,v,x(T._payload),A)}if(io(T))return _(m,v,T,A);if(Ha(T))return p(m,v,T,A);M0(m,T)}return typeof T=="string"&&T!==""||typeof T=="number"?(T=""+T,v!==null&&v.tag===6?(t(m,v.sibling),v=s(v,T),v.return=m,m=v):(t(m,v),v=fu(T,m.mode,A),v.return=m,m=v),a(m)):t(m,v)}return g}var Ta=Ym(!0),jm=Ym(!1),bl=tr(null),Tl=null,ia=null,Sf=null;function Rf(){Sf=ia=Tl=null}function If(n){var e=bl.current;St(bl),n._currentValue=e}function lc(n,e,t){for(;n!==null;){var i=n.alternate;if((n.childLanes&e)!==e?(n.childLanes|=e,i!==null&&(i.childLanes|=e)):i!==null&&(i.childLanes&e)!==e&&(i.childLanes|=e),n===t)break;n=n.return}}function fa(n,e){Tl=n,Sf=ia=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&e&&(wi=!0),n.firstContext=null)}function ls(n){var e=n._currentValue;if(Sf!==n)if(n={context:n,memoizedValue:e,next:null},ia===null){if(Tl===null)throw Error(_e(308));ia=n,Tl.dependencies={lanes:0,firstContext:n}}else ia=ia.next=n;return e}var gr=null;function Cf(n){gr===null?gr=[n]:gr.push(n)}function qm(n,e,t,i){var s=e.interleaved;return s===null?(t.next=t,Cf(e)):(t.next=s.next,s.next=t),e.interleaved=t,mn(n,i)}function mn(n,e){n.lanes|=e;var t=n.alternate;for(t!==null&&(t.lanes|=e),t=n,n=n.return;n!==null;)n.childLanes|=e,t=n.alternate,t!==null&&(t.childLanes|=e),t=n,n=n.return;return t.tag===3?t.stateNode:null}var On=!1;function Mf(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function $m(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function _n(n,e){return{eventTime:n,lane:e,tag:0,payload:null,callback:null,next:null}}function Kn(n,e,t){var i=n.updateQueue;if(i===null)return null;if(i=i.shared,nt&2){var s=i.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),i.pending=e,mn(n,t)}return s=i.interleaved,s===null?(e.next=e,Cf(i)):(e.next=s.next,s.next=e),i.interleaved=e,mn(n,t)}function q0(n,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var i=e.lanes;i&=n.pendingLanes,t|=i,e.lanes=t,_f(n,t)}}function N_(n,e){var t=n.updateQueue,i=n.alternate;if(i!==null&&(i=i.updateQueue,t===i)){var s=null,r=null;if(t=t.firstBaseUpdate,t!==null){do{var a={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};r===null?s=r=a:r=r.next=a,t=t.next}while(t!==null);r===null?s=r=e:r=r.next=e}else s=r=e;t={baseState:i.baseState,firstBaseUpdate:s,lastBaseUpdate:r,shared:i.shared,effects:i.effects},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}function Al(n,e,t,i){var s=n.updateQueue;On=!1;var r=s.firstBaseUpdate,a=s.lastBaseUpdate,o=s.shared.pending;if(o!==null){s.shared.pending=null;var l=o,h=l.next;l.next=null,a===null?r=h:a.next=h,a=l;var u=n.alternate;u!==null&&(u=u.updateQueue,o=u.lastBaseUpdate,o!==a&&(o===null?u.firstBaseUpdate=h:o.next=h,u.lastBaseUpdate=l))}if(r!==null){var c=s.baseState;a=0,u=h=l=null,o=r;do{var f=o.lane,d=o.eventTime;if((i&f)===f){u!==null&&(u=u.next={eventTime:d,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var _=n,p=o;switch(f=e,d=t,p.tag){case 1:if(_=p.payload,typeof _=="function"){c=_.call(d,c,f);break e}c=_;break e;case 3:_.flags=_.flags&-65537|128;case 0:if(_=p.payload,f=typeof _=="function"?_.call(d,c,f):_,f==null)break e;c=Nt({},c,f);break e;case 2:On=!0}}o.callback!==null&&o.lane!==0&&(n.flags|=64,f=s.effects,f===null?s.effects=[o]:f.push(o))}else d={eventTime:d,lane:f,tag:o.tag,payload:o.payload,callback:o.callback,next:null},u===null?(h=u=d,l=c):u=u.next=d,a|=f;if(o=o.next,o===null){if(o=s.shared.pending,o===null)break;f=o,o=f.next,f.next=null,s.lastBaseUpdate=f,s.shared.pending=null}}while(!0);if(u===null&&(l=c),s.baseState=l,s.firstBaseUpdate=h,s.lastBaseUpdate=u,e=s.shared.interleaved,e!==null){s=e;do a|=s.lane,s=s.next;while(s!==e)}else r===null&&(s.shared.lanes=0);Pr|=a,n.lanes=a,n.memoizedState=c}}function U_(n,e,t){if(n=e.effects,e.effects=null,n!==null)for(e=0;e<n.length;e++){var i=n[e],s=i.callback;if(s!==null){if(i.callback=null,i=t,typeof s!="function")throw Error(_e(191,s));s.call(i)}}}var n0={},zs=tr(n0),Fo=tr(n0),Lo=tr(n0);function mr(n){if(n===n0)throw Error(_e(174));return n}function Pf(n,e){switch(bt(Lo,e),bt(Fo,n),bt(zs,n0),n=e.nodeType,n){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:zu(null,"");break;default:n=n===8?e.parentNode:e,e=n.namespaceURI||null,n=n.tagName,e=zu(e,n)}St(zs),bt(zs,e)}function Aa(){St(zs),St(Fo),St(Lo)}function Zm(n){mr(Lo.current);var e=mr(zs.current),t=zu(e,n.type);e!==t&&(bt(Fo,n),bt(zs,t))}function wf(n){Fo.current===n&&(St(zs),St(Fo))}var Lt=tr(0);function El(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var au=[];function Df(){for(var n=0;n<au.length;n++)au[n]._workInProgressVersionPrimary=null;au.length=0}var $0=An.ReactCurrentDispatcher,ou=An.ReactCurrentBatchConfig,Mr=0,Bt=null,jt=null,ei=null,Sl=!1,po=!1,Bo=0,Eb=0;function ci(){throw Error(_e(321))}function Of(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!Is(n[t],e[t]))return!1;return!0}function Ff(n,e,t,i,s,r){if(Mr=r,Bt=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,$0.current=n===null||n.memoizedState===null?Cb:Mb,n=t(i,s),po){r=0;do{if(po=!1,Bo=0,25<=r)throw Error(_e(301));r+=1,ei=jt=null,e.updateQueue=null,$0.current=Pb,n=t(i,s)}while(po)}if($0.current=Rl,e=jt!==null&&jt.next!==null,Mr=0,ei=jt=Bt=null,Sl=!1,e)throw Error(_e(300));return n}function Lf(){var n=Bo!==0;return Bo=0,n}function Ls(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ei===null?Bt.memoizedState=ei=n:ei=ei.next=n,ei}function hs(){if(jt===null){var n=Bt.alternate;n=n!==null?n.memoizedState:null}else n=jt.next;var e=ei===null?Bt.memoizedState:ei.next;if(e!==null)ei=e,jt=n;else{if(n===null)throw Error(_e(310));jt=n,n={memoizedState:jt.memoizedState,baseState:jt.baseState,baseQueue:jt.baseQueue,queue:jt.queue,next:null},ei===null?Bt.memoizedState=ei=n:ei=ei.next=n}return ei}function No(n,e){return typeof e=="function"?e(n):e}function lu(n){var e=hs(),t=e.queue;if(t===null)throw Error(_e(311));t.lastRenderedReducer=n;var i=jt,s=i.baseQueue,r=t.pending;if(r!==null){if(s!==null){var a=s.next;s.next=r.next,r.next=a}i.baseQueue=s=r,t.pending=null}if(s!==null){r=s.next,i=i.baseState;var o=a=null,l=null,h=r;do{var u=h.lane;if((Mr&u)===u)l!==null&&(l=l.next={lane:0,action:h.action,hasEagerState:h.hasEagerState,eagerState:h.eagerState,next:null}),i=h.hasEagerState?h.eagerState:n(i,h.action);else{var c={lane:u,action:h.action,hasEagerState:h.hasEagerState,eagerState:h.eagerState,next:null};l===null?(o=l=c,a=i):l=l.next=c,Bt.lanes|=u,Pr|=u}h=h.next}while(h!==null&&h!==r);l===null?a=i:l.next=o,Is(i,e.memoizedState)||(wi=!0),e.memoizedState=i,e.baseState=a,e.baseQueue=l,t.lastRenderedState=i}if(n=t.interleaved,n!==null){s=n;do r=s.lane,Bt.lanes|=r,Pr|=r,s=s.next;while(s!==n)}else s===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function hu(n){var e=hs(),t=e.queue;if(t===null)throw Error(_e(311));t.lastRenderedReducer=n;var i=t.dispatch,s=t.pending,r=e.memoizedState;if(s!==null){t.pending=null;var a=s=s.next;do r=n(r,a.action),a=a.next;while(a!==s);Is(r,e.memoizedState)||(wi=!0),e.memoizedState=r,e.baseQueue===null&&(e.baseState=r),t.lastRenderedState=r}return[r,i]}function Qm(){}function Jm(n,e){var t=Bt,i=hs(),s=e(),r=!Is(i.memoizedState,s);if(r&&(i.memoizedState=s,wi=!0),i=i.queue,Bf(i2.bind(null,t,i,n),[n]),i.getSnapshot!==e||r||ei!==null&&ei.memoizedState.tag&1){if(t.flags|=2048,Uo(9,t2.bind(null,t,i,s,e),void 0,null),ii===null)throw Error(_e(349));Mr&30||e2(t,e,s)}return s}function e2(n,e,t){n.flags|=16384,n={getSnapshot:e,value:t},e=Bt.updateQueue,e===null?(e={lastEffect:null,stores:null},Bt.updateQueue=e,e.stores=[n]):(t=e.stores,t===null?e.stores=[n]:t.push(n))}function t2(n,e,t,i){e.value=t,e.getSnapshot=i,s2(e)&&n2(n)}function i2(n,e,t){return t(function(){s2(e)&&n2(n)})}function s2(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!Is(n,t)}catch{return!0}}function n2(n){var e=mn(n,1);e!==null&&Ss(e,n,1,-1)}function k_(n){var e=Ls();return typeof n=="function"&&(n=n()),e.memoizedState=e.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:No,lastRenderedState:n},e.queue=n,n=n.dispatch=Ib.bind(null,Bt,n),[e.memoizedState,n]}function Uo(n,e,t,i){return n={tag:n,create:e,destroy:t,deps:i,next:null},e=Bt.updateQueue,e===null?(e={lastEffect:null,stores:null},Bt.updateQueue=e,e.lastEffect=n.next=n):(t=e.lastEffect,t===null?e.lastEffect=n.next=n:(i=t.next,t.next=n,n.next=i,e.lastEffect=n)),n}function r2(){return hs().memoizedState}function Z0(n,e,t,i){var s=Ls();Bt.flags|=n,s.memoizedState=Uo(1|e,t,void 0,i===void 0?null:i)}function ah(n,e,t,i){var s=hs();i=i===void 0?null:i;var r=void 0;if(jt!==null){var a=jt.memoizedState;if(r=a.destroy,i!==null&&Of(i,a.deps)){s.memoizedState=Uo(e,t,r,i);return}}Bt.flags|=n,s.memoizedState=Uo(1|e,t,r,i)}function V_(n,e){return Z0(8390656,8,n,e)}function Bf(n,e){return ah(2048,8,n,e)}function a2(n,e){return ah(4,2,n,e)}function o2(n,e){return ah(4,4,n,e)}function l2(n,e){if(typeof e=="function")return n=n(),e(n),function(){e(null)};if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function h2(n,e,t){return t=t!=null?t.concat([n]):null,ah(4,4,l2.bind(null,e,n),t)}function Nf(){}function u2(n,e){var t=hs();e=e===void 0?null:e;var i=t.memoizedState;return i!==null&&e!==null&&Of(e,i[1])?i[0]:(t.memoizedState=[n,e],n)}function c2(n,e){var t=hs();e=e===void 0?null:e;var i=t.memoizedState;return i!==null&&e!==null&&Of(e,i[1])?i[0]:(n=n(),t.memoizedState=[n,e],n)}function f2(n,e,t){return Mr&21?(Is(t,e)||(t=mm(),Bt.lanes|=t,Pr|=t,n.baseState=!0),e):(n.baseState&&(n.baseState=!1,wi=!0),n.memoizedState=t)}function Sb(n,e){var t=ct;ct=t!==0&&4>t?t:4,n(!0);var i=ou.transition;ou.transition={};try{n(!1),e()}finally{ct=t,ou.transition=i}}function d2(){return hs().memoizedState}function Rb(n,e,t){var i=Yn(n);if(t={lane:i,action:t,hasEagerState:!1,eagerState:null,next:null},_2(n))p2(e,t);else if(t=qm(n,e,t,i),t!==null){var s=Ai();Ss(t,n,i,s),g2(t,e,i)}}function Ib(n,e,t){var i=Yn(n),s={lane:i,action:t,hasEagerState:!1,eagerState:null,next:null};if(_2(n))p2(e,s);else{var r=n.alternate;if(n.lanes===0&&(r===null||r.lanes===0)&&(r=e.lastRenderedReducer,r!==null))try{var a=e.lastRenderedState,o=r(a,t);if(s.hasEagerState=!0,s.eagerState=o,Is(o,a)){var l=e.interleaved;l===null?(s.next=s,Cf(e)):(s.next=l.next,l.next=s),e.interleaved=s;return}}catch{}finally{}t=qm(n,e,s,i),t!==null&&(s=Ai(),Ss(t,n,i,s),g2(t,e,i))}}function _2(n){var e=n.alternate;return n===Bt||e!==null&&e===Bt}function p2(n,e){po=Sl=!0;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}function g2(n,e,t){if(t&4194240){var i=e.lanes;i&=n.pendingLanes,t|=i,e.lanes=t,_f(n,t)}}var Rl={readContext:ls,useCallback:ci,useContext:ci,useEffect:ci,useImperativeHandle:ci,useInsertionEffect:ci,useLayoutEffect:ci,useMemo:ci,useReducer:ci,useRef:ci,useState:ci,useDebugValue:ci,useDeferredValue:ci,useTransition:ci,useMutableSource:ci,useSyncExternalStore:ci,useId:ci,unstable_isNewReconciler:!1},Cb={readContext:ls,useCallback:function(n,e){return Ls().memoizedState=[n,e===void 0?null:e],n},useContext:ls,useEffect:V_,useImperativeHandle:function(n,e,t){return t=t!=null?t.concat([n]):null,Z0(4194308,4,l2.bind(null,e,n),t)},useLayoutEffect:function(n,e){return Z0(4194308,4,n,e)},useInsertionEffect:function(n,e){return Z0(4,2,n,e)},useMemo:function(n,e){var t=Ls();return e=e===void 0?null:e,n=n(),t.memoizedState=[n,e],n},useReducer:function(n,e,t){var i=Ls();return e=t!==void 0?t(e):e,i.memoizedState=i.baseState=e,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:e},i.queue=n,n=n.dispatch=Rb.bind(null,Bt,n),[i.memoizedState,n]},useRef:function(n){var e=Ls();return n={current:n},e.memoizedState=n},useState:k_,useDebugValue:Nf,useDeferredValue:function(n){return Ls().memoizedState=n},useTransition:function(){var n=k_(!1),e=n[0];return n=Sb.bind(null,n[1]),Ls().memoizedState=n,[e,n]},useMutableSource:function(){},useSyncExternalStore:function(n,e,t){var i=Bt,s=Ls();if(Pt){if(t===void 0)throw Error(_e(407));t=t()}else{if(t=e(),ii===null)throw Error(_e(349));Mr&30||e2(i,e,t)}s.memoizedState=t;var r={value:t,getSnapshot:e};return s.queue=r,V_(i2.bind(null,i,r,n),[n]),i.flags|=2048,Uo(9,t2.bind(null,i,r,t,e),void 0,null),t},useId:function(){var n=Ls(),e=ii.identifierPrefix;if(Pt){var t=fn,i=cn;t=(i&~(1<<32-Es(i)-1)).toString(32)+t,e=":"+e+"R"+t,t=Bo++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=Eb++,e=":"+e+"r"+t.toString(32)+":";return n.memoizedState=e},unstable_isNewReconciler:!1},Mb={readContext:ls,useCallback:u2,useContext:ls,useEffect:Bf,useImperativeHandle:h2,useInsertionEffect:a2,useLayoutEffect:o2,useMemo:c2,useReducer:lu,useRef:r2,useState:function(){return lu(No)},useDebugValue:Nf,useDeferredValue:function(n){var e=hs();return f2(e,jt.memoizedState,n)},useTransition:function(){var n=lu(No)[0],e=hs().memoizedState;return[n,e]},useMutableSource:Qm,useSyncExternalStore:Jm,useId:d2,unstable_isNewReconciler:!1},Pb={readContext:ls,useCallback:u2,useContext:ls,useEffect:Bf,useImperativeHandle:h2,useInsertionEffect:a2,useLayoutEffect:o2,useMemo:c2,useReducer:hu,useRef:r2,useState:function(){return hu(No)},useDebugValue:Nf,useDeferredValue:function(n){var e=hs();return jt===null?e.memoizedState=n:f2(e,jt.memoizedState,n)},useTransition:function(){var n=hu(No)[0],e=hs().memoizedState;return[n,e]},useMutableSource:Qm,useSyncExternalStore:Jm,useId:d2,unstable_isNewReconciler:!1};function ms(n,e){if(n&&n.defaultProps){e=Nt({},e),n=n.defaultProps;for(var t in n)e[t]===void 0&&(e[t]=n[t]);return e}return e}function hc(n,e,t,i){e=n.memoizedState,t=t(i,e),t=t==null?e:Nt({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var oh={isMounted:function(n){return(n=n._reactInternals)?Nr(n)===n:!1},enqueueSetState:function(n,e,t){n=n._reactInternals;var i=Ai(),s=Yn(n),r=_n(i,s);r.payload=e,t!=null&&(r.callback=t),e=Kn(n,r,s),e!==null&&(Ss(e,n,s,i),q0(e,n,s))},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var i=Ai(),s=Yn(n),r=_n(i,s);r.tag=1,r.payload=e,t!=null&&(r.callback=t),e=Kn(n,r,s),e!==null&&(Ss(e,n,s,i),q0(e,n,s))},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=Ai(),i=Yn(n),s=_n(t,i);s.tag=2,e!=null&&(s.callback=e),e=Kn(n,s,i),e!==null&&(Ss(e,n,i,t),q0(e,n,i))}};function G_(n,e,t,i,s,r,a){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(i,r,a):e.prototype&&e.prototype.isPureReactComponent?!Po(t,i)||!Po(s,r):!0}function m2(n,e,t){var i=!1,s=$n,r=e.contextType;return typeof r=="object"&&r!==null?r=ls(r):(s=Bi(e)?Ir:gi.current,i=e.contextTypes,r=(i=i!=null)?xa(n,s):$n),e=new e(t,r),n.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=oh,n.stateNode=e,e._reactInternals=n,i&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=s,n.__reactInternalMemoizedMaskedChildContext=r),e}function z_(n,e,t,i){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,i),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,i),e.state!==n&&oh.enqueueReplaceState(e,e.state,null)}function uc(n,e,t,i){var s=n.stateNode;s.props=t,s.state=n.memoizedState,s.refs={},Mf(n);var r=e.contextType;typeof r=="object"&&r!==null?s.context=ls(r):(r=Bi(e)?Ir:gi.current,s.context=xa(n,r)),s.state=n.memoizedState,r=e.getDerivedStateFromProps,typeof r=="function"&&(hc(n,e,r,t),s.state=n.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&oh.enqueueReplaceState(s,s.state,null),Al(n,t,s,i),s.state=n.memoizedState),typeof s.componentDidMount=="function"&&(n.flags|=4194308)}function Ea(n,e){try{var t="",i=e;do t+=n3(i),i=i.return;while(i);var s=t}catch(r){s=`
Error generating stack: `+r.message+`
`+r.stack}return{value:n,source:e,stack:s,digest:null}}function uu(n,e,t){return{value:n,source:null,stack:t??null,digest:e??null}}function cc(n,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var wb=typeof WeakMap=="function"?WeakMap:Map;function v2(n,e,t){t=_n(-1,t),t.tag=3,t.payload={element:null};var i=e.value;return t.callback=function(){Cl||(Cl=!0,bc=i),cc(n,e)},t}function y2(n,e,t){t=_n(-1,t),t.tag=3;var i=n.type.getDerivedStateFromError;if(typeof i=="function"){var s=e.value;t.payload=function(){return i(s)},t.callback=function(){cc(n,e)}}var r=n.stateNode;return r!==null&&typeof r.componentDidCatch=="function"&&(t.callback=function(){cc(n,e),typeof i!="function"&&(Xn===null?Xn=new Set([this]):Xn.add(this));var a=e.stack;this.componentDidCatch(e.value,{componentStack:a!==null?a:""})}),t}function W_(n,e,t){var i=n.pingCache;if(i===null){i=n.pingCache=new wb;var s=new Set;i.set(e,s)}else s=i.get(e),s===void 0&&(s=new Set,i.set(e,s));s.has(t)||(s.add(t),n=Kb.bind(null,n,e,t),e.then(n,n))}function H_(n){do{var e;if((e=n.tag===13)&&(e=n.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return n;n=n.return}while(n!==null);return null}function K_(n,e,t,i,s){return n.mode&1?(n.flags|=65536,n.lanes=s,n):(n===e?n.flags|=65536:(n.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=_n(-1,1),e.tag=2,Kn(t,e,1))),t.lanes|=1),n)}var Db=An.ReactCurrentOwner,wi=!1;function yi(n,e,t,i){e.child=n===null?jm(e,null,t,i):Ta(e,n.child,t,i)}function X_(n,e,t,i,s){t=t.render;var r=e.ref;return fa(e,s),i=Ff(n,e,t,i,r,s),t=Lf(),n!==null&&!wi?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~s,vn(n,e,s)):(Pt&&t&&Tf(e),e.flags|=1,yi(n,e,i,s),e.child)}function Y_(n,e,t,i,s){if(n===null){var r=t.type;return typeof r=="function"&&!Kf(r)&&r.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=r,x2(n,e,r,i,s)):(n=tl(t.type,null,i,e,e.mode,s),n.ref=e.ref,n.return=e,e.child=n)}if(r=n.child,!(n.lanes&s)){var a=r.memoizedProps;if(t=t.compare,t=t!==null?t:Po,t(a,i)&&n.ref===e.ref)return vn(n,e,s)}return e.flags|=1,n=jn(r,i),n.ref=e.ref,n.return=e,e.child=n}function x2(n,e,t,i,s){if(n!==null){var r=n.memoizedProps;if(Po(r,i)&&n.ref===e.ref)if(wi=!1,e.pendingProps=i=r,(n.lanes&s)!==0)n.flags&131072&&(wi=!0);else return e.lanes=n.lanes,vn(n,e,s)}return fc(n,e,t,i,s)}function b2(n,e,t){var i=e.pendingProps,s=i.children,r=n!==null?n.memoizedState:null;if(i.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},bt(na,ki),ki|=t;else{if(!(t&1073741824))return n=r!==null?r.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:n,cachePool:null,transitions:null},e.updateQueue=null,bt(na,ki),ki|=n,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=r!==null?r.baseLanes:t,bt(na,ki),ki|=i}else r!==null?(i=r.baseLanes|t,e.memoizedState=null):i=t,bt(na,ki),ki|=i;return yi(n,e,s,t),e.child}function T2(n,e){var t=e.ref;(n===null&&t!==null||n!==null&&n.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function fc(n,e,t,i,s){var r=Bi(t)?Ir:gi.current;return r=xa(e,r),fa(e,s),t=Ff(n,e,t,i,r,s),i=Lf(),n!==null&&!wi?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~s,vn(n,e,s)):(Pt&&i&&Tf(e),e.flags|=1,yi(n,e,t,s),e.child)}function j_(n,e,t,i,s){if(Bi(t)){var r=!0;vl(e)}else r=!1;if(fa(e,s),e.stateNode===null)Q0(n,e),m2(e,t,i),uc(e,t,i,s),i=!0;else if(n===null){var a=e.stateNode,o=e.memoizedProps;a.props=o;var l=a.context,h=t.contextType;typeof h=="object"&&h!==null?h=ls(h):(h=Bi(t)?Ir:gi.current,h=xa(e,h));var u=t.getDerivedStateFromProps,c=typeof u=="function"||typeof a.getSnapshotBeforeUpdate=="function";c||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==i||l!==h)&&z_(e,a,i,h),On=!1;var f=e.memoizedState;a.state=f,Al(e,i,a,s),l=e.memoizedState,o!==i||f!==l||Li.current||On?(typeof u=="function"&&(hc(e,t,u,i),l=e.memoizedState),(o=On||G_(e,t,o,i,f,l,h))?(c||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(e.flags|=4194308)):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=l),a.props=i,a.state=l,a.context=h,i=o):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),i=!1)}else{a=e.stateNode,$m(n,e),o=e.memoizedProps,h=e.type===e.elementType?o:ms(e.type,o),a.props=h,c=e.pendingProps,f=a.context,l=t.contextType,typeof l=="object"&&l!==null?l=ls(l):(l=Bi(t)?Ir:gi.current,l=xa(e,l));var d=t.getDerivedStateFromProps;(u=typeof d=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==c||f!==l)&&z_(e,a,i,l),On=!1,f=e.memoizedState,a.state=f,Al(e,i,a,s);var _=e.memoizedState;o!==c||f!==_||Li.current||On?(typeof d=="function"&&(hc(e,t,d,i),_=e.memoizedState),(h=On||G_(e,t,h,i,f,_,l)||!1)?(u||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(i,_,l),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(i,_,l)),typeof a.componentDidUpdate=="function"&&(e.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof a.componentDidUpdate!="function"||o===n.memoizedProps&&f===n.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===n.memoizedProps&&f===n.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=_),a.props=i,a.state=_,a.context=l,i=h):(typeof a.componentDidUpdate!="function"||o===n.memoizedProps&&f===n.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===n.memoizedProps&&f===n.memoizedState||(e.flags|=1024),i=!1)}return dc(n,e,t,i,r,s)}function dc(n,e,t,i,s,r){T2(n,e);var a=(e.flags&128)!==0;if(!i&&!a)return s&&O_(e,t,!1),vn(n,e,r);i=e.stateNode,Db.current=e;var o=a&&typeof t.getDerivedStateFromError!="function"?null:i.render();return e.flags|=1,n!==null&&a?(e.child=Ta(e,n.child,null,r),e.child=Ta(e,null,o,r)):yi(n,e,o,r),e.memoizedState=i.state,s&&O_(e,t,!0),e.child}function A2(n){var e=n.stateNode;e.pendingContext?D_(n,e.pendingContext,e.pendingContext!==e.context):e.context&&D_(n,e.context,!1),Pf(n,e.containerInfo)}function q_(n,e,t,i,s){return ba(),Ef(s),e.flags|=256,yi(n,e,t,i),e.child}var _c={dehydrated:null,treeContext:null,retryLane:0};function pc(n){return{baseLanes:n,cachePool:null,transitions:null}}function E2(n,e,t){var i=e.pendingProps,s=Lt.current,r=!1,a=(e.flags&128)!==0,o;if((o=a)||(o=n!==null&&n.memoizedState===null?!1:(s&2)!==0),o?(r=!0,e.flags&=-129):(n===null||n.memoizedState!==null)&&(s|=1),bt(Lt,s&1),n===null)return oc(e),n=e.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(e.mode&1?n.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(a=i.children,n=i.fallback,r?(i=e.mode,r=e.child,a={mode:"hidden",children:a},!(i&1)&&r!==null?(r.childLanes=0,r.pendingProps=a):r=uh(a,i,0,null),n=Tr(n,i,t,null),r.return=e,n.return=e,r.sibling=n,e.child=r,e.child.memoizedState=pc(t),e.memoizedState=_c,n):Uf(e,a));if(s=n.memoizedState,s!==null&&(o=s.dehydrated,o!==null))return Ob(n,e,a,i,o,s,t);if(r){r=i.fallback,a=e.mode,s=n.child,o=s.sibling;var l={mode:"hidden",children:i.children};return!(a&1)&&e.child!==s?(i=e.child,i.childLanes=0,i.pendingProps=l,e.deletions=null):(i=jn(s,l),i.subtreeFlags=s.subtreeFlags&14680064),o!==null?r=jn(o,r):(r=Tr(r,a,t,null),r.flags|=2),r.return=e,i.return=e,i.sibling=r,e.child=i,i=r,r=e.child,a=n.child.memoizedState,a=a===null?pc(t):{baseLanes:a.baseLanes|t,cachePool:null,transitions:a.transitions},r.memoizedState=a,r.childLanes=n.childLanes&~t,e.memoizedState=_c,i}return r=n.child,n=r.sibling,i=jn(r,{mode:"visible",children:i.children}),!(e.mode&1)&&(i.lanes=t),i.return=e,i.sibling=null,n!==null&&(t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)),e.child=i,e.memoizedState=null,i}function Uf(n,e){return e=uh({mode:"visible",children:e},n.mode,0,null),e.return=n,n.child=e}function P0(n,e,t,i){return i!==null&&Ef(i),Ta(e,n.child,null,t),n=Uf(e,e.pendingProps.children),n.flags|=2,e.memoizedState=null,n}function Ob(n,e,t,i,s,r,a){if(t)return e.flags&256?(e.flags&=-257,i=uu(Error(_e(422))),P0(n,e,a,i)):e.memoizedState!==null?(e.child=n.child,e.flags|=128,null):(r=i.fallback,s=e.mode,i=uh({mode:"visible",children:i.children},s,0,null),r=Tr(r,s,a,null),r.flags|=2,i.return=e,r.return=e,i.sibling=r,e.child=i,e.mode&1&&Ta(e,n.child,null,a),e.child.memoizedState=pc(a),e.memoizedState=_c,r);if(!(e.mode&1))return P0(n,e,a,null);if(s.data==="$!"){if(i=s.nextSibling&&s.nextSibling.dataset,i)var o=i.dgst;return i=o,r=Error(_e(419)),i=uu(r,i,void 0),P0(n,e,a,i)}if(o=(a&n.childLanes)!==0,wi||o){if(i=ii,i!==null){switch(a&-a){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(i.suspendedLanes|a)?0:s,s!==0&&s!==r.retryLane&&(r.retryLane=s,mn(n,s),Ss(i,n,s,-1))}return Hf(),i=uu(Error(_e(421))),P0(n,e,a,i)}return s.data==="$?"?(e.flags|=128,e.child=n.child,e=Xb.bind(null,n),s._reactRetry=e,null):(n=r.treeContext,Wi=Hn(s.nextSibling),Ki=e,Pt=!0,xs=null,n!==null&&(es[ts++]=cn,es[ts++]=fn,es[ts++]=Cr,cn=n.id,fn=n.overflow,Cr=e),e=Uf(e,i.children),e.flags|=4096,e)}function $_(n,e,t){n.lanes|=e;var i=n.alternate;i!==null&&(i.lanes|=e),lc(n.return,e,t)}function cu(n,e,t,i,s){var r=n.memoizedState;r===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:t,tailMode:s}:(r.isBackwards=e,r.rendering=null,r.renderingStartTime=0,r.last=i,r.tail=t,r.tailMode=s)}function S2(n,e,t){var i=e.pendingProps,s=i.revealOrder,r=i.tail;if(yi(n,e,i.children,t),i=Lt.current,i&2)i=i&1|2,e.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&$_(n,t,e);else if(n.tag===19)$_(n,t,e);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}i&=1}if(bt(Lt,i),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(t=e.child,s=null;t!==null;)n=t.alternate,n!==null&&El(n)===null&&(s=t),t=t.sibling;t=s,t===null?(s=e.child,e.child=null):(s=t.sibling,t.sibling=null),cu(e,!1,s,t,r);break;case"backwards":for(t=null,s=e.child,e.child=null;s!==null;){if(n=s.alternate,n!==null&&El(n)===null){e.child=s;break}n=s.sibling,s.sibling=t,t=s,s=n}cu(e,!0,t,null,r);break;case"together":cu(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Q0(n,e){!(e.mode&1)&&n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2)}function vn(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),Pr|=e.lanes,!(t&e.childLanes))return null;if(n!==null&&e.child!==n.child)throw Error(_e(153));if(e.child!==null){for(n=e.child,t=jn(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=jn(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}function Fb(n,e,t){switch(e.tag){case 3:A2(e),ba();break;case 5:Zm(e);break;case 1:Bi(e.type)&&vl(e);break;case 4:Pf(e,e.stateNode.containerInfo);break;case 10:var i=e.type._context,s=e.memoizedProps.value;bt(bl,i._currentValue),i._currentValue=s;break;case 13:if(i=e.memoizedState,i!==null)return i.dehydrated!==null?(bt(Lt,Lt.current&1),e.flags|=128,null):t&e.child.childLanes?E2(n,e,t):(bt(Lt,Lt.current&1),n=vn(n,e,t),n!==null?n.sibling:null);bt(Lt,Lt.current&1);break;case 19:if(i=(t&e.childLanes)!==0,n.flags&128){if(i)return S2(n,e,t);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),bt(Lt,Lt.current),i)break;return null;case 22:case 23:return e.lanes=0,b2(n,e,t)}return vn(n,e,t)}var R2,gc,I2,C2;R2=function(n,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)n.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};gc=function(){};I2=function(n,e,t,i){var s=n.memoizedProps;if(s!==i){n=e.stateNode,mr(zs.current);var r=null;switch(t){case"input":s=Uu(n,s),i=Uu(n,i),r=[];break;case"select":s=Nt({},s,{value:void 0}),i=Nt({},i,{value:void 0}),r=[];break;case"textarea":s=Gu(n,s),i=Gu(n,i),r=[];break;default:typeof s.onClick!="function"&&typeof i.onClick=="function"&&(n.onclick=gl)}Wu(t,i);var a;t=null;for(h in s)if(!i.hasOwnProperty(h)&&s.hasOwnProperty(h)&&s[h]!=null)if(h==="style"){var o=s[h];for(a in o)o.hasOwnProperty(a)&&(t||(t={}),t[a]="")}else h!=="dangerouslySetInnerHTML"&&h!=="children"&&h!=="suppressContentEditableWarning"&&h!=="suppressHydrationWarning"&&h!=="autoFocus"&&(Ao.hasOwnProperty(h)?r||(r=[]):(r=r||[]).push(h,null));for(h in i){var l=i[h];if(o=s!=null?s[h]:void 0,i.hasOwnProperty(h)&&l!==o&&(l!=null||o!=null))if(h==="style")if(o){for(a in o)!o.hasOwnProperty(a)||l&&l.hasOwnProperty(a)||(t||(t={}),t[a]="");for(a in l)l.hasOwnProperty(a)&&o[a]!==l[a]&&(t||(t={}),t[a]=l[a])}else t||(r||(r=[]),r.push(h,t)),t=l;else h==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,o=o?o.__html:void 0,l!=null&&o!==l&&(r=r||[]).push(h,l)):h==="children"?typeof l!="string"&&typeof l!="number"||(r=r||[]).push(h,""+l):h!=="suppressContentEditableWarning"&&h!=="suppressHydrationWarning"&&(Ao.hasOwnProperty(h)?(l!=null&&h==="onScroll"&&At("scroll",n),r||o===l||(r=[])):(r=r||[]).push(h,l))}t&&(r=r||[]).push("style",t);var h=r;(e.updateQueue=h)&&(e.flags|=4)}};C2=function(n,e,t,i){t!==i&&(e.flags|=4)};function $a(n,e){if(!Pt)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var i=null;t!==null;)t.alternate!==null&&(i=t),t=t.sibling;i===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:i.sibling=null}}function fi(n){var e=n.alternate!==null&&n.alternate.child===n.child,t=0,i=0;if(e)for(var s=n.child;s!==null;)t|=s.lanes|s.childLanes,i|=s.subtreeFlags&14680064,i|=s.flags&14680064,s.return=n,s=s.sibling;else for(s=n.child;s!==null;)t|=s.lanes|s.childLanes,i|=s.subtreeFlags,i|=s.flags,s.return=n,s=s.sibling;return n.subtreeFlags|=i,n.childLanes=t,e}function Lb(n,e,t){var i=e.pendingProps;switch(Af(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return fi(e),null;case 1:return Bi(e.type)&&ml(),fi(e),null;case 3:return i=e.stateNode,Aa(),St(Li),St(gi),Df(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(n===null||n.child===null)&&(C0(e)?e.flags|=4:n===null||n.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,xs!==null&&(Ec(xs),xs=null))),gc(n,e),fi(e),null;case 5:wf(e);var s=mr(Lo.current);if(t=e.type,n!==null&&e.stateNode!=null)I2(n,e,t,i,s),n.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!i){if(e.stateNode===null)throw Error(_e(166));return fi(e),null}if(n=mr(zs.current),C0(e)){i=e.stateNode,t=e.type;var r=e.memoizedProps;switch(i[Ns]=e,i[Oo]=r,n=(e.mode&1)!==0,t){case"dialog":At("cancel",i),At("close",i);break;case"iframe":case"object":case"embed":At("load",i);break;case"video":case"audio":for(s=0;s<no.length;s++)At(no[s],i);break;case"source":At("error",i);break;case"img":case"image":case"link":At("error",i),At("load",i);break;case"details":At("toggle",i);break;case"input":r_(i,r),At("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!r.multiple},At("invalid",i);break;case"textarea":o_(i,r),At("invalid",i)}Wu(t,r),s=null;for(var a in r)if(r.hasOwnProperty(a)){var o=r[a];a==="children"?typeof o=="string"?i.textContent!==o&&(r.suppressHydrationWarning!==!0&&I0(i.textContent,o,n),s=["children",o]):typeof o=="number"&&i.textContent!==""+o&&(r.suppressHydrationWarning!==!0&&I0(i.textContent,o,n),s=["children",""+o]):Ao.hasOwnProperty(a)&&o!=null&&a==="onScroll"&&At("scroll",i)}switch(t){case"input":y0(i),a_(i,r,!0);break;case"textarea":y0(i),l_(i);break;case"select":case"option":break;default:typeof r.onClick=="function"&&(i.onclick=gl)}i=s,e.updateQueue=i,i!==null&&(e.flags|=4)}else{a=s.nodeType===9?s:s.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=im(t)),n==="http://www.w3.org/1999/xhtml"?t==="script"?(n=a.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof i.is=="string"?n=a.createElement(t,{is:i.is}):(n=a.createElement(t),t==="select"&&(a=n,i.multiple?a.multiple=!0:i.size&&(a.size=i.size))):n=a.createElementNS(n,t),n[Ns]=e,n[Oo]=i,R2(n,e,!1,!1),e.stateNode=n;e:{switch(a=Hu(t,i),t){case"dialog":At("cancel",n),At("close",n),s=i;break;case"iframe":case"object":case"embed":At("load",n),s=i;break;case"video":case"audio":for(s=0;s<no.length;s++)At(no[s],n);s=i;break;case"source":At("error",n),s=i;break;case"img":case"image":case"link":At("error",n),At("load",n),s=i;break;case"details":At("toggle",n),s=i;break;case"input":r_(n,i),s=Uu(n,i),At("invalid",n);break;case"option":s=i;break;case"select":n._wrapperState={wasMultiple:!!i.multiple},s=Nt({},i,{value:void 0}),At("invalid",n);break;case"textarea":o_(n,i),s=Gu(n,i),At("invalid",n);break;default:s=i}Wu(t,s),o=s;for(r in o)if(o.hasOwnProperty(r)){var l=o[r];r==="style"?rm(n,l):r==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&sm(n,l)):r==="children"?typeof l=="string"?(t!=="textarea"||l!=="")&&Eo(n,l):typeof l=="number"&&Eo(n,""+l):r!=="suppressContentEditableWarning"&&r!=="suppressHydrationWarning"&&r!=="autoFocus"&&(Ao.hasOwnProperty(r)?l!=null&&r==="onScroll"&&At("scroll",n):l!=null&&lf(n,r,l,a))}switch(t){case"input":y0(n),a_(n,i,!1);break;case"textarea":y0(n),l_(n);break;case"option":i.value!=null&&n.setAttribute("value",""+qn(i.value));break;case"select":n.multiple=!!i.multiple,r=i.value,r!=null?la(n,!!i.multiple,r,!1):i.defaultValue!=null&&la(n,!!i.multiple,i.defaultValue,!0);break;default:typeof s.onClick=="function"&&(n.onclick=gl)}switch(t){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return fi(e),null;case 6:if(n&&e.stateNode!=null)C2(n,e,n.memoizedProps,i);else{if(typeof i!="string"&&e.stateNode===null)throw Error(_e(166));if(t=mr(Lo.current),mr(zs.current),C0(e)){if(i=e.stateNode,t=e.memoizedProps,i[Ns]=e,(r=i.nodeValue!==t)&&(n=Ki,n!==null))switch(n.tag){case 3:I0(i.nodeValue,t,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&I0(i.nodeValue,t,(n.mode&1)!==0)}r&&(e.flags|=4)}else i=(t.nodeType===9?t:t.ownerDocument).createTextNode(i),i[Ns]=e,e.stateNode=i}return fi(e),null;case 13:if(St(Lt),i=e.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(Pt&&Wi!==null&&e.mode&1&&!(e.flags&128))Xm(),ba(),e.flags|=98560,r=!1;else if(r=C0(e),i!==null&&i.dehydrated!==null){if(n===null){if(!r)throw Error(_e(318));if(r=e.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(_e(317));r[Ns]=e}else ba(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;fi(e),r=!1}else xs!==null&&(Ec(xs),xs=null),r=!0;if(!r)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(i=i!==null,i!==(n!==null&&n.memoizedState!==null)&&i&&(e.child.flags|=8192,e.mode&1&&(n===null||Lt.current&1?$t===0&&($t=3):Hf())),e.updateQueue!==null&&(e.flags|=4),fi(e),null);case 4:return Aa(),gc(n,e),n===null&&wo(e.stateNode.containerInfo),fi(e),null;case 10:return If(e.type._context),fi(e),null;case 17:return Bi(e.type)&&ml(),fi(e),null;case 19:if(St(Lt),r=e.memoizedState,r===null)return fi(e),null;if(i=(e.flags&128)!==0,a=r.rendering,a===null)if(i)$a(r,!1);else{if($t!==0||n!==null&&n.flags&128)for(n=e.child;n!==null;){if(a=El(n),a!==null){for(e.flags|=128,$a(r,!1),i=a.updateQueue,i!==null&&(e.updateQueue=i,e.flags|=4),e.subtreeFlags=0,i=t,t=e.child;t!==null;)r=t,n=i,r.flags&=14680066,a=r.alternate,a===null?(r.childLanes=0,r.lanes=n,r.child=null,r.subtreeFlags=0,r.memoizedProps=null,r.memoizedState=null,r.updateQueue=null,r.dependencies=null,r.stateNode=null):(r.childLanes=a.childLanes,r.lanes=a.lanes,r.child=a.child,r.subtreeFlags=0,r.deletions=null,r.memoizedProps=a.memoizedProps,r.memoizedState=a.memoizedState,r.updateQueue=a.updateQueue,r.type=a.type,n=a.dependencies,r.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t=t.sibling;return bt(Lt,Lt.current&1|2),e.child}n=n.sibling}r.tail!==null&&Ht()>Sa&&(e.flags|=128,i=!0,$a(r,!1),e.lanes=4194304)}else{if(!i)if(n=El(a),n!==null){if(e.flags|=128,i=!0,t=n.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),$a(r,!0),r.tail===null&&r.tailMode==="hidden"&&!a.alternate&&!Pt)return fi(e),null}else 2*Ht()-r.renderingStartTime>Sa&&t!==1073741824&&(e.flags|=128,i=!0,$a(r,!1),e.lanes=4194304);r.isBackwards?(a.sibling=e.child,e.child=a):(t=r.last,t!==null?t.sibling=a:e.child=a,r.last=a)}return r.tail!==null?(e=r.tail,r.rendering=e,r.tail=e.sibling,r.renderingStartTime=Ht(),e.sibling=null,t=Lt.current,bt(Lt,i?t&1|2:t&1),e):(fi(e),null);case 22:case 23:return Wf(),i=e.memoizedState!==null,n!==null&&n.memoizedState!==null!==i&&(e.flags|=8192),i&&e.mode&1?ki&1073741824&&(fi(e),e.subtreeFlags&6&&(e.flags|=8192)):fi(e),null;case 24:return null;case 25:return null}throw Error(_e(156,e.tag))}function Bb(n,e){switch(Af(e),e.tag){case 1:return Bi(e.type)&&ml(),n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 3:return Aa(),St(Li),St(gi),Df(),n=e.flags,n&65536&&!(n&128)?(e.flags=n&-65537|128,e):null;case 5:return wf(e),null;case 13:if(St(Lt),n=e.memoizedState,n!==null&&n.dehydrated!==null){if(e.alternate===null)throw Error(_e(340));ba()}return n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 19:return St(Lt),null;case 4:return Aa(),null;case 10:return If(e.type._context),null;case 22:case 23:return Wf(),null;case 24:return null;default:return null}}var w0=!1,di=!1,Nb=typeof WeakSet=="function"?WeakSet:Set,Ce=null;function sa(n,e){var t=n.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(i){Ut(n,e,i)}else t.current=null}function mc(n,e,t){try{t()}catch(i){Ut(n,e,i)}}var Z_=!1;function Ub(n,e){if(ec=dl,n=Om(),bf(n)){if("selectionStart"in n)var t={start:n.selectionStart,end:n.selectionEnd};else e:{t=(t=n.ownerDocument)&&t.defaultView||window;var i=t.getSelection&&t.getSelection();if(i&&i.rangeCount!==0){t=i.anchorNode;var s=i.anchorOffset,r=i.focusNode;i=i.focusOffset;try{t.nodeType,r.nodeType}catch{t=null;break e}var a=0,o=-1,l=-1,h=0,u=0,c=n,f=null;t:for(;;){for(var d;c!==t||s!==0&&c.nodeType!==3||(o=a+s),c!==r||i!==0&&c.nodeType!==3||(l=a+i),c.nodeType===3&&(a+=c.nodeValue.length),(d=c.firstChild)!==null;)f=c,c=d;for(;;){if(c===n)break t;if(f===t&&++h===s&&(o=a),f===r&&++u===i&&(l=a),(d=c.nextSibling)!==null)break;c=f,f=c.parentNode}c=d}t=o===-1||l===-1?null:{start:o,end:l}}else t=null}t=t||{start:0,end:0}}else t=null;for(tc={focusedElem:n,selectionRange:t},dl=!1,Ce=e;Ce!==null;)if(e=Ce,n=e.child,(e.subtreeFlags&1028)!==0&&n!==null)n.return=e,Ce=n;else for(;Ce!==null;){e=Ce;try{var _=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(_!==null){var p=_.memoizedProps,g=_.memoizedState,m=e.stateNode,v=m.getSnapshotBeforeUpdate(e.elementType===e.type?p:ms(e.type,p),g);m.__reactInternalSnapshotBeforeUpdate=v}break;case 3:var T=e.stateNode.containerInfo;T.nodeType===1?T.textContent="":T.nodeType===9&&T.documentElement&&T.removeChild(T.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(_e(163))}}catch(A){Ut(e,e.return,A)}if(n=e.sibling,n!==null){n.return=e.return,Ce=n;break}Ce=e.return}return _=Z_,Z_=!1,_}function go(n,e,t){var i=e.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var s=i=i.next;do{if((s.tag&n)===n){var r=s.destroy;s.destroy=void 0,r!==void 0&&mc(e,t,r)}s=s.next}while(s!==i)}}function lh(n,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&n)===n){var i=t.create;t.destroy=i()}t=t.next}while(t!==e)}}function vc(n){var e=n.ref;if(e!==null){var t=n.stateNode;switch(n.tag){case 5:n=t;break;default:n=t}typeof e=="function"?e(n):e.current=n}}function M2(n){var e=n.alternate;e!==null&&(n.alternate=null,M2(e)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(e=n.stateNode,e!==null&&(delete e[Ns],delete e[Oo],delete e[nc],delete e[xb],delete e[bb])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function P2(n){return n.tag===5||n.tag===3||n.tag===4}function Q_(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||P2(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function yc(n,e,t){var i=n.tag;if(i===5||i===6)n=n.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(n,e):t.insertBefore(n,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(n,t)):(e=t,e.appendChild(n)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=gl));else if(i!==4&&(n=n.child,n!==null))for(yc(n,e,t),n=n.sibling;n!==null;)yc(n,e,t),n=n.sibling}function xc(n,e,t){var i=n.tag;if(i===5||i===6)n=n.stateNode,e?t.insertBefore(n,e):t.appendChild(n);else if(i!==4&&(n=n.child,n!==null))for(xc(n,e,t),n=n.sibling;n!==null;)xc(n,e,t),n=n.sibling}var si=null,ys=!1;function Cn(n,e,t){for(t=t.child;t!==null;)w2(n,e,t),t=t.sibling}function w2(n,e,t){if(Gs&&typeof Gs.onCommitFiberUnmount=="function")try{Gs.onCommitFiberUnmount(eh,t)}catch{}switch(t.tag){case 5:di||sa(t,e);case 6:var i=si,s=ys;si=null,Cn(n,e,t),si=i,ys=s,si!==null&&(ys?(n=si,t=t.stateNode,n.nodeType===8?n.parentNode.removeChild(t):n.removeChild(t)):si.removeChild(t.stateNode));break;case 18:si!==null&&(ys?(n=si,t=t.stateNode,n.nodeType===8?nu(n.parentNode,t):n.nodeType===1&&nu(n,t),Co(n)):nu(si,t.stateNode));break;case 4:i=si,s=ys,si=t.stateNode.containerInfo,ys=!0,Cn(n,e,t),si=i,ys=s;break;case 0:case 11:case 14:case 15:if(!di&&(i=t.updateQueue,i!==null&&(i=i.lastEffect,i!==null))){s=i=i.next;do{var r=s,a=r.destroy;r=r.tag,a!==void 0&&(r&2||r&4)&&mc(t,e,a),s=s.next}while(s!==i)}Cn(n,e,t);break;case 1:if(!di&&(sa(t,e),i=t.stateNode,typeof i.componentWillUnmount=="function"))try{i.props=t.memoizedProps,i.state=t.memoizedState,i.componentWillUnmount()}catch(o){Ut(t,e,o)}Cn(n,e,t);break;case 21:Cn(n,e,t);break;case 22:t.mode&1?(di=(i=di)||t.memoizedState!==null,Cn(n,e,t),di=i):Cn(n,e,t);break;default:Cn(n,e,t)}}function J_(n){var e=n.updateQueue;if(e!==null){n.updateQueue=null;var t=n.stateNode;t===null&&(t=n.stateNode=new Nb),e.forEach(function(i){var s=Yb.bind(null,n,i);t.has(i)||(t.add(i),i.then(s,s))})}}function _s(n,e){var t=e.deletions;if(t!==null)for(var i=0;i<t.length;i++){var s=t[i];try{var r=n,a=e,o=a;e:for(;o!==null;){switch(o.tag){case 5:si=o.stateNode,ys=!1;break e;case 3:si=o.stateNode.containerInfo,ys=!0;break e;case 4:si=o.stateNode.containerInfo,ys=!0;break e}o=o.return}if(si===null)throw Error(_e(160));w2(r,a,s),si=null,ys=!1;var l=s.alternate;l!==null&&(l.return=null),s.return=null}catch(h){Ut(s,e,h)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)D2(e,n),e=e.sibling}function D2(n,e){var t=n.alternate,i=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(_s(e,n),Ds(n),i&4){try{go(3,n,n.return),lh(3,n)}catch(p){Ut(n,n.return,p)}try{go(5,n,n.return)}catch(p){Ut(n,n.return,p)}}break;case 1:_s(e,n),Ds(n),i&512&&t!==null&&sa(t,t.return);break;case 5:if(_s(e,n),Ds(n),i&512&&t!==null&&sa(t,t.return),n.flags&32){var s=n.stateNode;try{Eo(s,"")}catch(p){Ut(n,n.return,p)}}if(i&4&&(s=n.stateNode,s!=null)){var r=n.memoizedProps,a=t!==null?t.memoizedProps:r,o=n.type,l=n.updateQueue;if(n.updateQueue=null,l!==null)try{o==="input"&&r.type==="radio"&&r.name!=null&&em(s,r),Hu(o,a);var h=Hu(o,r);for(a=0;a<l.length;a+=2){var u=l[a],c=l[a+1];u==="style"?rm(s,c):u==="dangerouslySetInnerHTML"?sm(s,c):u==="children"?Eo(s,c):lf(s,u,c,h)}switch(o){case"input":ku(s,r);break;case"textarea":tm(s,r);break;case"select":var f=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!r.multiple;var d=r.value;d!=null?la(s,!!r.multiple,d,!1):f!==!!r.multiple&&(r.defaultValue!=null?la(s,!!r.multiple,r.defaultValue,!0):la(s,!!r.multiple,r.multiple?[]:"",!1))}s[Oo]=r}catch(p){Ut(n,n.return,p)}}break;case 6:if(_s(e,n),Ds(n),i&4){if(n.stateNode===null)throw Error(_e(162));s=n.stateNode,r=n.memoizedProps;try{s.nodeValue=r}catch(p){Ut(n,n.return,p)}}break;case 3:if(_s(e,n),Ds(n),i&4&&t!==null&&t.memoizedState.isDehydrated)try{Co(e.containerInfo)}catch(p){Ut(n,n.return,p)}break;case 4:_s(e,n),Ds(n);break;case 13:_s(e,n),Ds(n),s=n.child,s.flags&8192&&(r=s.memoizedState!==null,s.stateNode.isHidden=r,!r||s.alternate!==null&&s.alternate.memoizedState!==null||(Gf=Ht())),i&4&&J_(n);break;case 22:if(u=t!==null&&t.memoizedState!==null,n.mode&1?(di=(h=di)||u,_s(e,n),di=h):_s(e,n),Ds(n),i&8192){if(h=n.memoizedState!==null,(n.stateNode.isHidden=h)&&!u&&n.mode&1)for(Ce=n,u=n.child;u!==null;){for(c=Ce=u;Ce!==null;){switch(f=Ce,d=f.child,f.tag){case 0:case 11:case 14:case 15:go(4,f,f.return);break;case 1:sa(f,f.return);var _=f.stateNode;if(typeof _.componentWillUnmount=="function"){i=f,t=f.return;try{e=i,_.props=e.memoizedProps,_.state=e.memoizedState,_.componentWillUnmount()}catch(p){Ut(i,t,p)}}break;case 5:sa(f,f.return);break;case 22:if(f.memoizedState!==null){tp(c);continue}}d!==null?(d.return=f,Ce=d):tp(c)}u=u.sibling}e:for(u=null,c=n;;){if(c.tag===5){if(u===null){u=c;try{s=c.stateNode,h?(r=s.style,typeof r.setProperty=="function"?r.setProperty("display","none","important"):r.display="none"):(o=c.stateNode,l=c.memoizedProps.style,a=l!=null&&l.hasOwnProperty("display")?l.display:null,o.style.display=nm("display",a))}catch(p){Ut(n,n.return,p)}}}else if(c.tag===6){if(u===null)try{c.stateNode.nodeValue=h?"":c.memoizedProps}catch(p){Ut(n,n.return,p)}}else if((c.tag!==22&&c.tag!==23||c.memoizedState===null||c===n)&&c.child!==null){c.child.return=c,c=c.child;continue}if(c===n)break e;for(;c.sibling===null;){if(c.return===null||c.return===n)break e;u===c&&(u=null),c=c.return}u===c&&(u=null),c.sibling.return=c.return,c=c.sibling}}break;case 19:_s(e,n),Ds(n),i&4&&J_(n);break;case 21:break;default:_s(e,n),Ds(n)}}function Ds(n){var e=n.flags;if(e&2){try{e:{for(var t=n.return;t!==null;){if(P2(t)){var i=t;break e}t=t.return}throw Error(_e(160))}switch(i.tag){case 5:var s=i.stateNode;i.flags&32&&(Eo(s,""),i.flags&=-33);var r=Q_(n);xc(n,r,s);break;case 3:case 4:var a=i.stateNode.containerInfo,o=Q_(n);yc(n,o,a);break;default:throw Error(_e(161))}}catch(l){Ut(n,n.return,l)}n.flags&=-3}e&4096&&(n.flags&=-4097)}function kb(n,e,t){Ce=n,O2(n)}function O2(n,e,t){for(var i=(n.mode&1)!==0;Ce!==null;){var s=Ce,r=s.child;if(s.tag===22&&i){var a=s.memoizedState!==null||w0;if(!a){var o=s.alternate,l=o!==null&&o.memoizedState!==null||di;o=w0;var h=di;if(w0=a,(di=l)&&!h)for(Ce=s;Ce!==null;)a=Ce,l=a.child,a.tag===22&&a.memoizedState!==null?ip(s):l!==null?(l.return=a,Ce=l):ip(s);for(;r!==null;)Ce=r,O2(r),r=r.sibling;Ce=s,w0=o,di=h}ep(n)}else s.subtreeFlags&8772&&r!==null?(r.return=s,Ce=r):ep(n)}}function ep(n){for(;Ce!==null;){var e=Ce;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:di||lh(5,e);break;case 1:var i=e.stateNode;if(e.flags&4&&!di)if(t===null)i.componentDidMount();else{var s=e.elementType===e.type?t.memoizedProps:ms(e.type,t.memoizedProps);i.componentDidUpdate(s,t.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var r=e.updateQueue;r!==null&&U_(e,r,i);break;case 3:var a=e.updateQueue;if(a!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}U_(e,a,t)}break;case 5:var o=e.stateNode;if(t===null&&e.flags&4){t=o;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&t.focus();break;case"img":l.src&&(t.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var h=e.alternate;if(h!==null){var u=h.memoizedState;if(u!==null){var c=u.dehydrated;c!==null&&Co(c)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(_e(163))}di||e.flags&512&&vc(e)}catch(f){Ut(e,e.return,f)}}if(e===n){Ce=null;break}if(t=e.sibling,t!==null){t.return=e.return,Ce=t;break}Ce=e.return}}function tp(n){for(;Ce!==null;){var e=Ce;if(e===n){Ce=null;break}var t=e.sibling;if(t!==null){t.return=e.return,Ce=t;break}Ce=e.return}}function ip(n){for(;Ce!==null;){var e=Ce;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{lh(4,e)}catch(l){Ut(e,t,l)}break;case 1:var i=e.stateNode;if(typeof i.componentDidMount=="function"){var s=e.return;try{i.componentDidMount()}catch(l){Ut(e,s,l)}}var r=e.return;try{vc(e)}catch(l){Ut(e,r,l)}break;case 5:var a=e.return;try{vc(e)}catch(l){Ut(e,a,l)}}}catch(l){Ut(e,e.return,l)}if(e===n){Ce=null;break}var o=e.sibling;if(o!==null){o.return=e.return,Ce=o;break}Ce=e.return}}var Vb=Math.ceil,Il=An.ReactCurrentDispatcher,kf=An.ReactCurrentOwner,rs=An.ReactCurrentBatchConfig,nt=0,ii=null,Yt=null,ri=0,ki=0,na=tr(0),$t=0,ko=null,Pr=0,hh=0,Vf=0,mo=null,Mi=null,Gf=0,Sa=1/0,on=null,Cl=!1,bc=null,Xn=null,D0=!1,kn=null,Ml=0,vo=0,Tc=null,J0=-1,el=0;function Ai(){return nt&6?Ht():J0!==-1?J0:J0=Ht()}function Yn(n){return n.mode&1?nt&2&&ri!==0?ri&-ri:Ab.transition!==null?(el===0&&(el=mm()),el):(n=ct,n!==0||(n=window.event,n=n===void 0?16:Em(n.type)),n):1}function Ss(n,e,t,i){if(50<vo)throw vo=0,Tc=null,Error(_e(185));t0(n,t,i),(!(nt&2)||n!==ii)&&(n===ii&&(!(nt&2)&&(hh|=t),$t===4&&Bn(n,ri)),Ni(n,i),t===1&&nt===0&&!(e.mode&1)&&(Sa=Ht()+500,rh&&ir()))}function Ni(n,e){var t=n.callbackNode;A3(n,e);var i=fl(n,n===ii?ri:0);if(i===0)t!==null&&c_(t),n.callbackNode=null,n.callbackPriority=0;else if(e=i&-i,n.callbackPriority!==e){if(t!=null&&c_(t),e===1)n.tag===0?Tb(sp.bind(null,n)):Wm(sp.bind(null,n)),vb(function(){!(nt&6)&&ir()}),t=null;else{switch(vm(i)){case 1:t=df;break;case 4:t=pm;break;case 16:t=cl;break;case 536870912:t=gm;break;default:t=cl}t=G2(t,F2.bind(null,n))}n.callbackPriority=e,n.callbackNode=t}}function F2(n,e){if(J0=-1,el=0,nt&6)throw Error(_e(327));var t=n.callbackNode;if(da()&&n.callbackNode!==t)return null;var i=fl(n,n===ii?ri:0);if(i===0)return null;if(i&30||i&n.expiredLanes||e)e=Pl(n,i);else{e=i;var s=nt;nt|=2;var r=B2();(ii!==n||ri!==e)&&(on=null,Sa=Ht()+500,br(n,e));do try{Wb();break}catch(o){L2(n,o)}while(!0);Rf(),Il.current=r,nt=s,Yt!==null?e=0:(ii=null,ri=0,e=$t)}if(e!==0){if(e===2&&(s=qu(n),s!==0&&(i=s,e=Ac(n,s))),e===1)throw t=ko,br(n,0),Bn(n,i),Ni(n,Ht()),t;if(e===6)Bn(n,i);else{if(s=n.current.alternate,!(i&30)&&!Gb(s)&&(e=Pl(n,i),e===2&&(r=qu(n),r!==0&&(i=r,e=Ac(n,r))),e===1))throw t=ko,br(n,0),Bn(n,i),Ni(n,Ht()),t;switch(n.finishedWork=s,n.finishedLanes=i,e){case 0:case 1:throw Error(_e(345));case 2:ur(n,Mi,on);break;case 3:if(Bn(n,i),(i&130023424)===i&&(e=Gf+500-Ht(),10<e)){if(fl(n,0)!==0)break;if(s=n.suspendedLanes,(s&i)!==i){Ai(),n.pingedLanes|=n.suspendedLanes&s;break}n.timeoutHandle=sc(ur.bind(null,n,Mi,on),e);break}ur(n,Mi,on);break;case 4:if(Bn(n,i),(i&4194240)===i)break;for(e=n.eventTimes,s=-1;0<i;){var a=31-Es(i);r=1<<a,a=e[a],a>s&&(s=a),i&=~r}if(i=s,i=Ht()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*Vb(i/1960))-i,10<i){n.timeoutHandle=sc(ur.bind(null,n,Mi,on),i);break}ur(n,Mi,on);break;case 5:ur(n,Mi,on);break;default:throw Error(_e(329))}}}return Ni(n,Ht()),n.callbackNode===t?F2.bind(null,n):null}function Ac(n,e){var t=mo;return n.current.memoizedState.isDehydrated&&(br(n,e).flags|=256),n=Pl(n,e),n!==2&&(e=Mi,Mi=t,e!==null&&Ec(e)),n}function Ec(n){Mi===null?Mi=n:Mi.push.apply(Mi,n)}function Gb(n){for(var e=n;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var i=0;i<t.length;i++){var s=t[i],r=s.getSnapshot;s=s.value;try{if(!Is(r(),s))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Bn(n,e){for(e&=~Vf,e&=~hh,n.suspendedLanes|=e,n.pingedLanes&=~e,n=n.expirationTimes;0<e;){var t=31-Es(e),i=1<<t;n[t]=-1,e&=~i}}function sp(n){if(nt&6)throw Error(_e(327));da();var e=fl(n,0);if(!(e&1))return Ni(n,Ht()),null;var t=Pl(n,e);if(n.tag!==0&&t===2){var i=qu(n);i!==0&&(e=i,t=Ac(n,i))}if(t===1)throw t=ko,br(n,0),Bn(n,e),Ni(n,Ht()),t;if(t===6)throw Error(_e(345));return n.finishedWork=n.current.alternate,n.finishedLanes=e,ur(n,Mi,on),Ni(n,Ht()),null}function zf(n,e){var t=nt;nt|=1;try{return n(e)}finally{nt=t,nt===0&&(Sa=Ht()+500,rh&&ir())}}function wr(n){kn!==null&&kn.tag===0&&!(nt&6)&&da();var e=nt;nt|=1;var t=rs.transition,i=ct;try{if(rs.transition=null,ct=1,n)return n()}finally{ct=i,rs.transition=t,nt=e,!(nt&6)&&ir()}}function Wf(){ki=na.current,St(na)}function br(n,e){n.finishedWork=null,n.finishedLanes=0;var t=n.timeoutHandle;if(t!==-1&&(n.timeoutHandle=-1,mb(t)),Yt!==null)for(t=Yt.return;t!==null;){var i=t;switch(Af(i),i.tag){case 1:i=i.type.childContextTypes,i!=null&&ml();break;case 3:Aa(),St(Li),St(gi),Df();break;case 5:wf(i);break;case 4:Aa();break;case 13:St(Lt);break;case 19:St(Lt);break;case 10:If(i.type._context);break;case 22:case 23:Wf()}t=t.return}if(ii=n,Yt=n=jn(n.current,null),ri=ki=e,$t=0,ko=null,Vf=hh=Pr=0,Mi=mo=null,gr!==null){for(e=0;e<gr.length;e++)if(t=gr[e],i=t.interleaved,i!==null){t.interleaved=null;var s=i.next,r=t.pending;if(r!==null){var a=r.next;r.next=s,i.next=a}t.pending=i}gr=null}return n}function L2(n,e){do{var t=Yt;try{if(Rf(),$0.current=Rl,Sl){for(var i=Bt.memoizedState;i!==null;){var s=i.queue;s!==null&&(s.pending=null),i=i.next}Sl=!1}if(Mr=0,ei=jt=Bt=null,po=!1,Bo=0,kf.current=null,t===null||t.return===null){$t=1,ko=e,Yt=null;break}e:{var r=n,a=t.return,o=t,l=e;if(e=ri,o.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var h=l,u=o,c=u.tag;if(!(u.mode&1)&&(c===0||c===11||c===15)){var f=u.alternate;f?(u.updateQueue=f.updateQueue,u.memoizedState=f.memoizedState,u.lanes=f.lanes):(u.updateQueue=null,u.memoizedState=null)}var d=H_(a);if(d!==null){d.flags&=-257,K_(d,a,o,r,e),d.mode&1&&W_(r,h,e),e=d,l=h;var _=e.updateQueue;if(_===null){var p=new Set;p.add(l),e.updateQueue=p}else _.add(l);break e}else{if(!(e&1)){W_(r,h,e),Hf();break e}l=Error(_e(426))}}else if(Pt&&o.mode&1){var g=H_(a);if(g!==null){!(g.flags&65536)&&(g.flags|=256),K_(g,a,o,r,e),Ef(Ea(l,o));break e}}r=l=Ea(l,o),$t!==4&&($t=2),mo===null?mo=[r]:mo.push(r),r=a;do{switch(r.tag){case 3:r.flags|=65536,e&=-e,r.lanes|=e;var m=v2(r,l,e);N_(r,m);break e;case 1:o=l;var v=r.type,T=r.stateNode;if(!(r.flags&128)&&(typeof v.getDerivedStateFromError=="function"||T!==null&&typeof T.componentDidCatch=="function"&&(Xn===null||!Xn.has(T)))){r.flags|=65536,e&=-e,r.lanes|=e;var A=y2(r,o,e);N_(r,A);break e}}r=r.return}while(r!==null)}U2(t)}catch(b){e=b,Yt===t&&t!==null&&(Yt=t=t.return);continue}break}while(!0)}function B2(){var n=Il.current;return Il.current=Rl,n===null?Rl:n}function Hf(){($t===0||$t===3||$t===2)&&($t=4),ii===null||!(Pr&268435455)&&!(hh&268435455)||Bn(ii,ri)}function Pl(n,e){var t=nt;nt|=2;var i=B2();(ii!==n||ri!==e)&&(on=null,br(n,e));do try{zb();break}catch(s){L2(n,s)}while(!0);if(Rf(),nt=t,Il.current=i,Yt!==null)throw Error(_e(261));return ii=null,ri=0,$t}function zb(){for(;Yt!==null;)N2(Yt)}function Wb(){for(;Yt!==null&&!_3();)N2(Yt)}function N2(n){var e=V2(n.alternate,n,ki);n.memoizedProps=n.pendingProps,e===null?U2(n):Yt=e,kf.current=null}function U2(n){var e=n;do{var t=e.alternate;if(n=e.return,e.flags&32768){if(t=Bb(t,e),t!==null){t.flags&=32767,Yt=t;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{$t=6,Yt=null;return}}else if(t=Lb(t,e,ki),t!==null){Yt=t;return}if(e=e.sibling,e!==null){Yt=e;return}Yt=e=n}while(e!==null);$t===0&&($t=5)}function ur(n,e,t){var i=ct,s=rs.transition;try{rs.transition=null,ct=1,Hb(n,e,t,i)}finally{rs.transition=s,ct=i}return null}function Hb(n,e,t,i){do da();while(kn!==null);if(nt&6)throw Error(_e(327));t=n.finishedWork;var s=n.finishedLanes;if(t===null)return null;if(n.finishedWork=null,n.finishedLanes=0,t===n.current)throw Error(_e(177));n.callbackNode=null,n.callbackPriority=0;var r=t.lanes|t.childLanes;if(E3(n,r),n===ii&&(Yt=ii=null,ri=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||D0||(D0=!0,G2(cl,function(){return da(),null})),r=(t.flags&15990)!==0,t.subtreeFlags&15990||r){r=rs.transition,rs.transition=null;var a=ct;ct=1;var o=nt;nt|=4,kf.current=null,Ub(n,t),D2(t,n),ub(tc),dl=!!ec,tc=ec=null,n.current=t,kb(t),p3(),nt=o,ct=a,rs.transition=r}else n.current=t;if(D0&&(D0=!1,kn=n,Ml=s),r=n.pendingLanes,r===0&&(Xn=null),v3(t.stateNode),Ni(n,Ht()),e!==null)for(i=n.onRecoverableError,t=0;t<e.length;t++)s=e[t],i(s.value,{componentStack:s.stack,digest:s.digest});if(Cl)throw Cl=!1,n=bc,bc=null,n;return Ml&1&&n.tag!==0&&da(),r=n.pendingLanes,r&1?n===Tc?vo++:(vo=0,Tc=n):vo=0,ir(),null}function da(){if(kn!==null){var n=vm(Ml),e=rs.transition,t=ct;try{if(rs.transition=null,ct=16>n?16:n,kn===null)var i=!1;else{if(n=kn,kn=null,Ml=0,nt&6)throw Error(_e(331));var s=nt;for(nt|=4,Ce=n.current;Ce!==null;){var r=Ce,a=r.child;if(Ce.flags&16){var o=r.deletions;if(o!==null){for(var l=0;l<o.length;l++){var h=o[l];for(Ce=h;Ce!==null;){var u=Ce;switch(u.tag){case 0:case 11:case 15:go(8,u,r)}var c=u.child;if(c!==null)c.return=u,Ce=c;else for(;Ce!==null;){u=Ce;var f=u.sibling,d=u.return;if(M2(u),u===h){Ce=null;break}if(f!==null){f.return=d,Ce=f;break}Ce=d}}}var _=r.alternate;if(_!==null){var p=_.child;if(p!==null){_.child=null;do{var g=p.sibling;p.sibling=null,p=g}while(p!==null)}}Ce=r}}if(r.subtreeFlags&2064&&a!==null)a.return=r,Ce=a;else e:for(;Ce!==null;){if(r=Ce,r.flags&2048)switch(r.tag){case 0:case 11:case 15:go(9,r,r.return)}var m=r.sibling;if(m!==null){m.return=r.return,Ce=m;break e}Ce=r.return}}var v=n.current;for(Ce=v;Ce!==null;){a=Ce;var T=a.child;if(a.subtreeFlags&2064&&T!==null)T.return=a,Ce=T;else e:for(a=v;Ce!==null;){if(o=Ce,o.flags&2048)try{switch(o.tag){case 0:case 11:case 15:lh(9,o)}}catch(b){Ut(o,o.return,b)}if(o===a){Ce=null;break e}var A=o.sibling;if(A!==null){A.return=o.return,Ce=A;break e}Ce=o.return}}if(nt=s,ir(),Gs&&typeof Gs.onPostCommitFiberRoot=="function")try{Gs.onPostCommitFiberRoot(eh,n)}catch{}i=!0}return i}finally{ct=t,rs.transition=e}}return!1}function np(n,e,t){e=Ea(t,e),e=v2(n,e,1),n=Kn(n,e,1),e=Ai(),n!==null&&(t0(n,1,e),Ni(n,e))}function Ut(n,e,t){if(n.tag===3)np(n,n,t);else for(;e!==null;){if(e.tag===3){np(e,n,t);break}else if(e.tag===1){var i=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(Xn===null||!Xn.has(i))){n=Ea(t,n),n=y2(e,n,1),e=Kn(e,n,1),n=Ai(),e!==null&&(t0(e,1,n),Ni(e,n));break}}e=e.return}}function Kb(n,e,t){var i=n.pingCache;i!==null&&i.delete(e),e=Ai(),n.pingedLanes|=n.suspendedLanes&t,ii===n&&(ri&t)===t&&($t===4||$t===3&&(ri&130023424)===ri&&500>Ht()-Gf?br(n,0):Vf|=t),Ni(n,e)}function k2(n,e){e===0&&(n.mode&1?(e=T0,T0<<=1,!(T0&130023424)&&(T0=4194304)):e=1);var t=Ai();n=mn(n,e),n!==null&&(t0(n,e,t),Ni(n,t))}function Xb(n){var e=n.memoizedState,t=0;e!==null&&(t=e.retryLane),k2(n,t)}function Yb(n,e){var t=0;switch(n.tag){case 13:var i=n.stateNode,s=n.memoizedState;s!==null&&(t=s.retryLane);break;case 19:i=n.stateNode;break;default:throw Error(_e(314))}i!==null&&i.delete(e),k2(n,t)}var V2;V2=function(n,e,t){if(n!==null)if(n.memoizedProps!==e.pendingProps||Li.current)wi=!0;else{if(!(n.lanes&t)&&!(e.flags&128))return wi=!1,Fb(n,e,t);wi=!!(n.flags&131072)}else wi=!1,Pt&&e.flags&1048576&&Hm(e,xl,e.index);switch(e.lanes=0,e.tag){case 2:var i=e.type;Q0(n,e),n=e.pendingProps;var s=xa(e,gi.current);fa(e,t),s=Ff(null,e,i,n,s,t);var r=Lf();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Bi(i)?(r=!0,vl(e)):r=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,Mf(e),s.updater=oh,e.stateNode=s,s._reactInternals=e,uc(e,i,n,t),e=dc(null,e,i,!0,r,t)):(e.tag=0,Pt&&r&&Tf(e),yi(null,e,s,t),e=e.child),e;case 16:i=e.elementType;e:{switch(Q0(n,e),n=e.pendingProps,s=i._init,i=s(i._payload),e.type=i,s=e.tag=qb(i),n=ms(i,n),s){case 0:e=fc(null,e,i,n,t);break e;case 1:e=j_(null,e,i,n,t);break e;case 11:e=X_(null,e,i,n,t);break e;case 14:e=Y_(null,e,i,ms(i.type,n),t);break e}throw Error(_e(306,i,""))}return e;case 0:return i=e.type,s=e.pendingProps,s=e.elementType===i?s:ms(i,s),fc(n,e,i,s,t);case 1:return i=e.type,s=e.pendingProps,s=e.elementType===i?s:ms(i,s),j_(n,e,i,s,t);case 3:e:{if(A2(e),n===null)throw Error(_e(387));i=e.pendingProps,r=e.memoizedState,s=r.element,$m(n,e),Al(e,i,null,t);var a=e.memoizedState;if(i=a.element,r.isDehydrated)if(r={element:i,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},e.updateQueue.baseState=r,e.memoizedState=r,e.flags&256){s=Ea(Error(_e(423)),e),e=q_(n,e,i,t,s);break e}else if(i!==s){s=Ea(Error(_e(424)),e),e=q_(n,e,i,t,s);break e}else for(Wi=Hn(e.stateNode.containerInfo.firstChild),Ki=e,Pt=!0,xs=null,t=jm(e,null,i,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(ba(),i===s){e=vn(n,e,t);break e}yi(n,e,i,t)}e=e.child}return e;case 5:return Zm(e),n===null&&oc(e),i=e.type,s=e.pendingProps,r=n!==null?n.memoizedProps:null,a=s.children,ic(i,s)?a=null:r!==null&&ic(i,r)&&(e.flags|=32),T2(n,e),yi(n,e,a,t),e.child;case 6:return n===null&&oc(e),null;case 13:return E2(n,e,t);case 4:return Pf(e,e.stateNode.containerInfo),i=e.pendingProps,n===null?e.child=Ta(e,null,i,t):yi(n,e,i,t),e.child;case 11:return i=e.type,s=e.pendingProps,s=e.elementType===i?s:ms(i,s),X_(n,e,i,s,t);case 7:return yi(n,e,e.pendingProps,t),e.child;case 8:return yi(n,e,e.pendingProps.children,t),e.child;case 12:return yi(n,e,e.pendingProps.children,t),e.child;case 10:e:{if(i=e.type._context,s=e.pendingProps,r=e.memoizedProps,a=s.value,bt(bl,i._currentValue),i._currentValue=a,r!==null)if(Is(r.value,a)){if(r.children===s.children&&!Li.current){e=vn(n,e,t);break e}}else for(r=e.child,r!==null&&(r.return=e);r!==null;){var o=r.dependencies;if(o!==null){a=r.child;for(var l=o.firstContext;l!==null;){if(l.context===i){if(r.tag===1){l=_n(-1,t&-t),l.tag=2;var h=r.updateQueue;if(h!==null){h=h.shared;var u=h.pending;u===null?l.next=l:(l.next=u.next,u.next=l),h.pending=l}}r.lanes|=t,l=r.alternate,l!==null&&(l.lanes|=t),lc(r.return,t,e),o.lanes|=t;break}l=l.next}}else if(r.tag===10)a=r.type===e.type?null:r.child;else if(r.tag===18){if(a=r.return,a===null)throw Error(_e(341));a.lanes|=t,o=a.alternate,o!==null&&(o.lanes|=t),lc(a,t,e),a=r.sibling}else a=r.child;if(a!==null)a.return=r;else for(a=r;a!==null;){if(a===e){a=null;break}if(r=a.sibling,r!==null){r.return=a.return,a=r;break}a=a.return}r=a}yi(n,e,s.children,t),e=e.child}return e;case 9:return s=e.type,i=e.pendingProps.children,fa(e,t),s=ls(s),i=i(s),e.flags|=1,yi(n,e,i,t),e.child;case 14:return i=e.type,s=ms(i,e.pendingProps),s=ms(i.type,s),Y_(n,e,i,s,t);case 15:return x2(n,e,e.type,e.pendingProps,t);case 17:return i=e.type,s=e.pendingProps,s=e.elementType===i?s:ms(i,s),Q0(n,e),e.tag=1,Bi(i)?(n=!0,vl(e)):n=!1,fa(e,t),m2(e,i,s),uc(e,i,s,t),dc(null,e,i,!0,n,t);case 19:return S2(n,e,t);case 22:return b2(n,e,t)}throw Error(_e(156,e.tag))};function G2(n,e){return _m(n,e)}function jb(n,e,t,i){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function is(n,e,t,i){return new jb(n,e,t,i)}function Kf(n){return n=n.prototype,!(!n||!n.isReactComponent)}function qb(n){if(typeof n=="function")return Kf(n)?1:0;if(n!=null){if(n=n.$$typeof,n===uf)return 11;if(n===cf)return 14}return 2}function jn(n,e){var t=n.alternate;return t===null?(t=is(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=n.flags&14680064,t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t}function tl(n,e,t,i,s,r){var a=2;if(i=n,typeof n=="function")Kf(n)&&(a=1);else if(typeof n=="string")a=5;else e:switch(n){case jr:return Tr(t.children,s,r,e);case hf:a=8,s|=8;break;case Fu:return n=is(12,t,e,s|2),n.elementType=Fu,n.lanes=r,n;case Lu:return n=is(13,t,e,s),n.elementType=Lu,n.lanes=r,n;case Bu:return n=is(19,t,e,s),n.elementType=Bu,n.lanes=r,n;case Z1:return uh(t,s,r,e);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case q1:a=10;break e;case $1:a=9;break e;case uf:a=11;break e;case cf:a=14;break e;case Dn:a=16,i=null;break e}throw Error(_e(130,n==null?n:typeof n,""))}return e=is(a,t,e,s),e.elementType=n,e.type=i,e.lanes=r,e}function Tr(n,e,t,i){return n=is(7,n,i,e),n.lanes=t,n}function uh(n,e,t,i){return n=is(22,n,i,e),n.elementType=Z1,n.lanes=t,n.stateNode={isHidden:!1},n}function fu(n,e,t){return n=is(6,n,null,e),n.lanes=t,n}function du(n,e,t){return e=is(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}function $b(n,e,t,i,s){this.tag=e,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Yh(0),this.expirationTimes=Yh(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Yh(0),this.identifierPrefix=i,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function Xf(n,e,t,i,s,r,a,o,l){return n=new $b(n,e,t,o,l),e===1?(e=1,r===!0&&(e|=8)):e=0,r=is(3,null,null,e),n.current=r,r.stateNode=n,r.memoizedState={element:i,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},Mf(r),n}function Zb(n,e,t){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Yr,key:i==null?null:""+i,children:n,containerInfo:e,implementation:t}}function z2(n){if(!n)return $n;n=n._reactInternals;e:{if(Nr(n)!==n||n.tag!==1)throw Error(_e(170));var e=n;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Bi(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(_e(171))}if(n.tag===1){var t=n.type;if(Bi(t))return zm(n,t,e)}return e}function W2(n,e,t,i,s,r,a,o,l){return n=Xf(t,i,!0,n,s,r,a,o,l),n.context=z2(null),t=n.current,i=Ai(),s=Yn(t),r=_n(i,s),r.callback=e??null,Kn(t,r,s),n.current.lanes=s,t0(n,s,i),Ni(n,i),n}function ch(n,e,t,i){var s=e.current,r=Ai(),a=Yn(s);return t=z2(t),e.context===null?e.context=t:e.pendingContext=t,e=_n(r,a),e.payload={element:n},i=i===void 0?null:i,i!==null&&(e.callback=i),n=Kn(s,e,a),n!==null&&(Ss(n,s,a,r),q0(n,s,a)),a}function wl(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function rp(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function Yf(n,e){rp(n,e),(n=n.alternate)&&rp(n,e)}function Qb(){return null}var H2=typeof reportError=="function"?reportError:function(n){console.error(n)};function jf(n){this._internalRoot=n}fh.prototype.render=jf.prototype.render=function(n){var e=this._internalRoot;if(e===null)throw Error(_e(409));ch(n,e,null,null)};fh.prototype.unmount=jf.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var e=n.containerInfo;wr(function(){ch(null,n,null,null)}),e[gn]=null}};function fh(n){this._internalRoot=n}fh.prototype.unstable_scheduleHydration=function(n){if(n){var e=bm();n={blockedOn:null,target:n,priority:e};for(var t=0;t<Ln.length&&e!==0&&e<Ln[t].priority;t++);Ln.splice(t,0,n),t===0&&Am(n)}};function qf(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function dh(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function ap(){}function Jb(n,e,t,i,s){if(s){if(typeof i=="function"){var r=i;i=function(){var h=wl(a);r.call(h)}}var a=W2(e,i,n,0,null,!1,!1,"",ap);return n._reactRootContainer=a,n[gn]=a.current,wo(n.nodeType===8?n.parentNode:n),wr(),a}for(;s=n.lastChild;)n.removeChild(s);if(typeof i=="function"){var o=i;i=function(){var h=wl(l);o.call(h)}}var l=Xf(n,0,!1,null,null,!1,!1,"",ap);return n._reactRootContainer=l,n[gn]=l.current,wo(n.nodeType===8?n.parentNode:n),wr(function(){ch(e,l,t,i)}),l}function _h(n,e,t,i,s){var r=t._reactRootContainer;if(r){var a=r;if(typeof s=="function"){var o=s;s=function(){var l=wl(a);o.call(l)}}ch(e,a,n,s)}else a=Jb(t,e,n,s,i);return wl(a)}ym=function(n){switch(n.tag){case 3:var e=n.stateNode;if(e.current.memoizedState.isDehydrated){var t=so(e.pendingLanes);t!==0&&(_f(e,t|1),Ni(e,Ht()),!(nt&6)&&(Sa=Ht()+500,ir()))}break;case 13:wr(function(){var i=mn(n,1);if(i!==null){var s=Ai();Ss(i,n,1,s)}}),Yf(n,1)}};pf=function(n){if(n.tag===13){var e=mn(n,134217728);if(e!==null){var t=Ai();Ss(e,n,134217728,t)}Yf(n,134217728)}};xm=function(n){if(n.tag===13){var e=Yn(n),t=mn(n,e);if(t!==null){var i=Ai();Ss(t,n,e,i)}Yf(n,e)}};bm=function(){return ct};Tm=function(n,e){var t=ct;try{return ct=n,e()}finally{ct=t}};Xu=function(n,e,t){switch(e){case"input":if(ku(n,t),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var i=t[e];if(i!==n&&i.form===n.form){var s=nh(i);if(!s)throw Error(_e(90));J1(i),ku(i,s)}}}break;case"textarea":tm(n,t);break;case"select":e=t.value,e!=null&&la(n,!!t.multiple,e,!1)}};lm=zf;hm=wr;var eT={usingClientEntryPoint:!1,Events:[s0,Qr,nh,am,om,zf]},Za={findFiberByHostInstance:pr,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},tT={bundleType:Za.bundleType,version:Za.version,rendererPackageName:Za.rendererPackageName,rendererConfig:Za.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:An.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=fm(n),n===null?null:n.stateNode},findFiberByHostInstance:Za.findFiberByHostInstance||Qb,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var O0=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!O0.isDisabled&&O0.supportsFiber)try{eh=O0.inject(tT),Gs=O0}catch{}}qi.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=eT;qi.createPortal=function(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!qf(e))throw Error(_e(200));return Zb(n,e,null,t)};qi.createRoot=function(n,e){if(!qf(n))throw Error(_e(299));var t=!1,i="",s=H2;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(i=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=Xf(n,1,!1,null,null,t,!1,i,s),n[gn]=e.current,wo(n.nodeType===8?n.parentNode:n),new jf(e)};qi.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error(_e(188)):(n=Object.keys(n).join(","),Error(_e(268,n)));return n=fm(e),n=n===null?null:n.stateNode,n};qi.flushSync=function(n){return wr(n)};qi.hydrate=function(n,e,t){if(!dh(e))throw Error(_e(200));return _h(null,n,e,!0,t)};qi.hydrateRoot=function(n,e,t){if(!qf(n))throw Error(_e(405));var i=t!=null&&t.hydratedSources||null,s=!1,r="",a=H2;if(t!=null&&(t.unstable_strictMode===!0&&(s=!0),t.identifierPrefix!==void 0&&(r=t.identifierPrefix),t.onRecoverableError!==void 0&&(a=t.onRecoverableError)),e=W2(e,null,n,1,t??null,s,!1,r,a),n[gn]=e.current,wo(n),i)for(n=0;n<i.length;n++)t=i[n],s=t._getVersion,s=s(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,s]:e.mutableSourceEagerHydrationData.push(t,s);return new fh(e)};qi.render=function(n,e,t){if(!dh(e))throw Error(_e(200));return _h(null,n,e,!1,t)};qi.unmountComponentAtNode=function(n){if(!dh(n))throw Error(_e(40));return n._reactRootContainer?(wr(function(){_h(null,null,n,!1,function(){n._reactRootContainer=null,n[gn]=null})}),!0):!1};qi.unstable_batchedUpdates=zf;qi.unstable_renderSubtreeIntoContainer=function(n,e,t,i){if(!dh(t))throw Error(_e(200));if(n==null||n._reactInternals===void 0)throw Error(_e(38));return _h(n,e,t,!1,i)};qi.version="18.3.1-next-f1338f8080-20240426";function K2(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(K2)}catch(n){console.error(n)}}K2(),K1.exports=qi;var iT=K1.exports,X2,op=iT;X2=op.createRoot,op.hydrateRoot;/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var sT={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nT=n=>n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),Cs=(n,e)=>{const t=Ne.forwardRef(({color:i="currentColor",size:s=24,strokeWidth:r=2,absoluteStrokeWidth:a,className:o="",children:l,...h},u)=>Ne.createElement("svg",{ref:u,...sT,width:s,height:s,stroke:i,strokeWidth:a?Number(r)*24/Number(s):r,className:["lucide",`lucide-${nT(n)}`,o].join(" "),...h},[...e.map(([c,f])=>Ne.createElement(c,f)),...Array.isArray(l)?l:[l]]));return t.displayName=`${n}`,t};/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rT=Cs("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aT=Cs("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y2=Cs("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oT=Cs("File",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lT=Cs("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hT=Cs("Pause",[["rect",{width:"4",height:"16",x:"6",y:"4",key:"iffhe4"}],["rect",{width:"4",height:"16",x:"14",y:"4",key:"sjin7j"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uT=Cs("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cT=Cs("Printer",[["polyline",{points:"6 9 6 2 18 2 18 9",key:"1306q4"}],["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["rect",{width:"12",height:"8",x:"6",y:"14",key:"5ipwut"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fT=Cs("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dT=Cs("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _T=Cs("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),pT="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAbkAAABeCAAAAACbCTV6AAAAIGNIUk0AAHomAACAhAAA+gAAAIDoAAB1MAAA6mAAADqYAAAXcJy6UTwAAAACYktHRAD/h4/MvwAAAAd0SU1FB+kCCxAgNY9Pd3oAAAABb3JOVAHPoneaAAAMBUlEQVR42u1de1QVxxn/oVFQRARUQmNIIiq+MNIYMY2xVm2iBhANQbQaNcrj4qNNPNHWpslJ0tbTJqcnbRJQlNhoNOIDhfhoakCDRkElqdWjxhoL4guDEFAUi0L/2OfdndkH7N67a/b3z85+33xzZ+a3szuPb+b6tMCBLdHO2xlw0Eo4zNkVDnN2hcOcXeEwZ1fc5+0MOHDD8ToAiAgDUFEJAD0iKTEd5iyFol0AgClhAE4WAgCSh5GjOm9LK2HfLrls41FyXIc5C2HfDpKUQp3DnHXwxQ6ynEydw5xlUPwpTUOkzseZt7QIiguYa3iqHy9rWHGZCUx9XBbfaXMWwX6WuIdExME/PYwJ5B6RGThtzho4sJ25Ppzi6yantzqHOQr+WAMAUbM882sccY/M85VoqNQ5b0sr4OB25ionjv7CdJizAA7mMdfeKb5yJY06Z/bLROzdCWK3UIJ6lriIuR1Jav909oWZO9BfJHbanIm4oi3aXeZCIU7U6prFUoc5E1GlK/bwjjSNfzRB6DBnHlqumpk6x1yZjwjvq1lNFMe+IVF+7u+jhLeI45CzfXxUMNcz1W0gav9nZurEHkq2q72i0endCsqiSTcVjV9rt8xHJjwX+62ZpWwFQv0AILgtSehscjpH1kTmjh8aqWi0VUG3L0GZOODV9r+Wiirivml1/ZgEA5q4vs+cXpC/cxsVbW6vpuuK46+r/uZv3pYIKiedNLWQXoLGrmUrQWZuzTUlm8JyquqABuKAJX9xu7006ZipZfQWvNHmbu5UsvmYqjkYW6fpVxf/VXRzJeFrU4voNZjLHGUOJWemD9Wk8hOapkREXM8FflL1JmGB8FftF3DBq5NFszoxlC5BSBQiVMtSxmRscRiAEx+5ffADXD2lsWv/AABIGAkAZ3LucvKM3gBIM840AwDwS+/llviZbD6Ym8tcjZ68pjBXfGwo1SSPpiiNreXDvXZFyfQpSXv48ML2LiZQnVgixPjtW/QHRhdOr3XvqV3PyuihEP3cmrvQBalB48q0XvpSkENn35I2Et9CtbhD7Z9MFr6OYTvlxKFb7hjhJoPtlCzfL8heedMg4v6zplkiuZ5ZTY9esbpJX/pyg1srLxqTdc2gMbf6Bs3iyxM0jfCqDN05hBQhaPNo4YYdpjYKkpeWGzSjc+5DeRNSoK5ylc4hM8ng1opLxmReK2h1VfVPmgX1KydCQTRZHrx5MN1o/p+Vx/+aUZFDakL1mZQO86XsRugC2eAWtwTqIVBXedZOIcurP9KQ6kCaonsfaovFTINWnC7k3waAmBhOcGdjDQDUZ84n9X+qVt7Slz5rEP0UL9lWCQA3V3Bz+kD4IqCG6YOPYyujszGl40GtrfyzfchynQ+odhjlV7G5GQCGJwrfTFdmLQDUZWbIqfuusAEABnXnBIEqybMGQ6YJr6t5mVUA0LDCdT8r8QsH2FXSkHBzqov+nOctIUlbcszJBySrT21NZ9jzos5OkCurFgC+z5rfTRr7SwBATKLmvhFjEPUL0XfGP/WDGgBoyJrfU2sychjUtwSyiZ/tskOtz5oKdDPX0tREs/lxkhsTwelMS6qtIEd/TDtxDAbNcPsmB6Z1AQA0nDWtdmSgM/ftFyTpJvOyovOZa3ypR8eOwRnEPnB0sqRcIdOUkho6VSdxA2ZKOlMhM82rFwrkzPErs+sJ0es/NC8rOttc0rvXgLqseIJK/A2SloqAqGk6RyP9Z8k+Ml3bXv42vy0f5gIbCL3c3YpT0Z7M+fusF/7e5TKV2zdIHQNm6ByN9JtlBb8reRn5WZymfHn0v3OBvsZnRV+bW8sFZFM6g/Qx0W+WTuL6zOlgfOH1Q85cV36KarWsLk/+gwuZ4Fugjzl+KbZSqhmvi4nec3Q2oN4vWoI4Ug9lHhcoOyxVCYvh8TAc2haIOPATyL66zGQYopeHIR11GpgEAnMTg7hQrkTTyL+Zpj9ofFYWHtcTewQXGG1W1VgcBOYC+Ua3ptZd8/l5LmRGJ/hyvB5nlNfZ5T+/N82sHk/CgJF4Mheok2w45xfDI35mWH6TA/hgefx/tdv1ZZcJ10drt7mnQGJOmEt1H71V8G/P1DZ+XER4qkCg7kx8pXbDCTf2ZGZ+VjdFu8W9BRJzPvzrssjt0yMshicamIPR24RZ9BPhRCfZSKIzpv84l+tpA0bANgVxzBrHNwPx0vidVVwosbeRWRi73U8lxpm4ci9UjcVBZC6IH63liNauDpziQi8Ym4efb1Oj7lTceU0p/ZBAnifi+ygXBZ8fbOACvcYZnInxeWqDqhN6voA2hSGrPMP59eR1vOwqH0zrZHSmJ2xVo+7YJA+7eVgeZOZ8UrjQlnIuJCyGP298NuK2qFH3dYK5zt62A2XSbtIibl9H3svMVVgMj42E8Yg/fgPlcoeQS6/zz8uRydtDvVZNFgSFue6zM9lQ9iImytFSTjfHlIxEAo8RxI8m8NSVJOb10JLSvmSDvDatDdpK1nQu8A3rycqPwkOf8WT+ntkkvEYPvK3JpCz3B3HGC425J/hJJca/so6fTkn1hycRJ/LvvK3N5OgmW1JnkAdRu1QutK4KAHbzk89JHi7Qc+/pNjkip87Ujb+KMOspoq77T+beUo0FALCGkz89GB6G+iYeGY5skdRXjRbPbHNQpGVHYStAZS50NhfKaQFO8s7qL3qtCvSg1J262ixm2TboIc9npXpFgynp0n1t+D5K6VFgM3cTMsHzZW8NSvNE1NUyjrLo5urmwSx0e4C56nZ/1wa6E8bIwdwWgE2P3+IXw1OsPzmfsLMJwKGW4ZyA3VeAQFebjlrQC9/0lRcAAJeymfFOX0PHo3Tm7ktbyIZyXi2+wEk93T9pBSLmrr4DoKREIu+aEeLZjHRKy2ZmWyuZy1RDmVPwTOT7KLW7+SnLUUM9W/hWoc8ckveXx4kDOqWZtBsEUDxr74Hp3IarrGJONs8y0xMbvmIDkSkyXeRs2Z5VBGR0V0vSePilrqpoeypkKHkDz+ACPHGBsZ4vPQUT2HblQ/IfHDBLWi6vEAf4pT6iOa5he3mAn8qmlucGwSoIGsVcY4gfj0GSsyW6uDRNeRoP33mG+g+IoOTg2yF1sUSSDOtg7OEGAL7jydoo1TnOoHcU1cv0GfSgKX0ztBaonq4iDeYV905IHYVGDIN14DceAMZ28XY+DENRGU1zaD9BqMhcuGTXWYrW/gn1GK9q/VsDm2jnr8SEAqGjWldLlkJn5hPcsvErsr6E3RQQ6uauo7xfyd2VubPmzQTxlPOgapJOaE2Cw52XaeevtIsD4qywH6qt8HUx45WWT4jVVso64IWmu/kNKDM3xm22d45K90zYG18V929ShNqkvcKNto0VzUtFx6RK/HP7D4rsb0zdeRmB7FCzZcO/5MrD7MxjaHqAm1yZOd9U8Z3ijl0A24Sh7sVnCY3r++RC4eaDgdCAlt+JjuV78hWJNslKPaa2gJuXa1kvO3XwCLu/W0qc2qn3zy0VwtFPqPx+zI6J/CrehbHyE9s2i45me0/ochWcxkna8avXRBvBRmyV9uw9u8ZrJrq5smoAoOVjH/fTm46yvggy4tSYi0gUvJzTVPfwjvj0WX4T3NXXlGK+u0AIF/5NU+GG5d3LDkRBPHUzxSemlVGJU/2niRd45jokqP/+kzu0HXD5zi91Fy06P0y4yZduVx8gfx/sqIZN8OBYAEHscTvN68Z2Qt8wAOXn0VDETKyEpgfgs4sAhgktUo25ceGcX/hsLY/8yIJYDUvAf1qsHkeCR/N/JLq7InWbvV9uccnTh9+1GkzHiztup3kP+w+5p/heQWh6AHC1AkA/wUrtDdiJ76NMhxaMKghQjbN8iYaE3DE434RNshZDMG3dl/CqhIZ/muDmUQaPVIvJYPR2taPJfr9UU0JiDCjwghuCxxGcQTxzjEycOnOR7PA7VeuYd4wKdW8s071S1K9A+4y7nRGcQfA4oBBn038OvCI9wLJLENzPcQYua/TO9D46C8e8VWfWA8CUnwDYXQiIiPuuEUCgQK09mXPg/KOSfeEwZ1c4zNkVDnN2hcOcXeEwZ1c4zNkVDnN2hcOcXeEwZ1c4zNkVDnN2xf8BsH7PBeO8+xYAAAAldEVYdGRhdGU6Y3JlYXRlADIwMjUtMDItMTFUMTY6MzI6MzIrMDA6MDCjglNMAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDI1LTAyLTExVDE2OjMyOjMyKzAwOjAw0t/r8AAAACh0RVh0ZGF0ZTp0aW1lc3RhbXAAMjAyNS0wMi0xMVQxNjozMjo1MyswMDowMOXSyBwAAAAASUVORK5CYII=",gT="/assets/Printer-BeMbHYyo.png",Ra=({children:n,allowContentScroll:e=!1})=>(Ne.useEffect(()=>{const t=()=>{const i=window.innerHeight*.01;document.documentElement.style.setProperty("--vh",`${i}px`)};return t(),window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[]),J.jsx("div",{className:"w-full max-w-md mx-auto flex flex-col px-4 sm:px-6 relative h-[calc(var(--vh,1vh)*100)] overflow-hidden",children:J.jsx("div",{className:`flex flex-col flex-1 ${e?"overflow-auto":"overflow-hidden"}`,children:n})})),mT=({currentFiles:n,showToast:e,handleFileUploadSuccess:t})=>{const[i,s]=Ne.useState(!1),r=o=>{const l=o.slice(0,-6),h=(n==null?void 0:n.map(f=>f.path))||[];if(!h.includes(o))return o;let u=1,c;do c=`${l}(${u}).gcode`,u++;while(h.includes(c));return c};return{uploadFile:Ne.useCallback(async o=>{if(!o.name.toLowerCase().endsWith(".gcode")){e("Only .gcode files are allowed");return}s(!0);try{const l=r(o.name),h=new File([o],l,{type:o.type}),u=new FormData;u.append("file",h);const c=await fetch("/server/files/upload",{method:"POST",body:u});if(!c.ok)throw new Error(`Upload failed: ${c.statusText}`);const d=(await c.json()).item.path;t(d);return}catch(l){e(`Upload failed: ${l.message}`);return}finally{s(!1)}},[n,e,t]),isUploading:i}},vT=({printerState:n,klippyState:e,setSelectedView:t,showToast:i,setSelectedFilePath:s,currentFiles:r,setCurrentFiles:a,sendMessage:o,socket:l})=>{var w;const[h,u]=Ne.useState(!1),[c,f]=Ne.useState(null),d=Ne.useRef(null),[_,p]=Ne.useState(0),[g,m]=Ne.useState(""),[v,T]=Ne.useState("normal");Ne.useEffect(()=>{if(!l)return;(async()=>{try{const F=await o("server.files.list",{root:"gcodes"});a(F),console.log("Set Files:",r)}catch(F){console.error("Error fetching files:",F)}})()},[l]);const A=Ne.useCallback(z=>{s(z),t("prepare")},[s,t]),{uploadFile:b,isUploading:x}=mT({currentFiles:r,showToast:i,handleFileUploadSuccess:A}),E=v==="normal"?1:v==="fast"?2:4,R=z=>{console.log("Kiri available?",typeof kiri<"u"),kiri.newEngine().setListener(F=>{console.log(F);const W=Object.keys(F)[0];W&&F[W]&&F[W].update!==void 0&&(p(F[W].update*100),F[W].updateStatus?m(F[W].updateStatus):m(W.charAt(0).toUpperCase()+W.slice(1)))}).load(URL.createObjectURL(z)).then(F=>(console.log("File loaded successfully, setting process parameters"),F.setProcess({sliceHeight:.1*E,firstSliceHeight:.1*E,sliceShells:2,sliceTopLayers:2,sliceBottomLayers:2,sliceFillSparse:.25,sliceSupportEnable:!0,sliceSupportDensity:.25,outputFeedrate:50*E,firstLayerRate:10*E,outputFinishrate:50*E,sliceFillRate:0*E,firstLayerFillRate:35*E,outputSeekrate:80*E,outputRetractSpeed:30*E,outputRetractDwell:30/E,outputMinSpeed:10*E}))).then(F=>F.setMode("FDM")).then(F=>F.setDevice({deviceType:"FDM",originCenter:!0,bedWidth:150,bedDepth:150,resolutionX:.1,resolutionY:.1,deviceZMax:300,gcodeTime:!0,maxHeight:300,round:!0,gcodeLayer:!1,gcodePre:["G28","G90","M82","G1 Z5 F3000"],gcodePost:["M104 S0","M84"],nozzle:[.4],filament:1.75,gcodeFlavor:"Marlin",extruders:[{extFilament:1.75,extNozzle:.4,extOffsetX:0,extOffsetY:0}]})).then(F=>F.slice()).then(F=>F.prepare()).then(F=>F.export()).then(F=>{const W=new File([F],`${z.name.split(".")[0]}.gcode`,{type:"text/plain"});u(!1),b(W)}).catch(F=>{console.error("Error in slicing workflow:",F),i("Error: "+F.message,"error")})},C=z=>{var W;const F=(W=z.target.files)==null?void 0:W[0];F&&F.name.toLowerCase().endsWith(".gcode")?b(F):(F.name.toLowerCase().endsWith(".stl")||F.name.toLowerCase().endsWith(".obj")||F.name.toLowerCase().endsWith(".3mf"))&&(f(F),u(!0))},I=({progress:z,status:F})=>J.jsxs("div",{className:"mt-6",children:[J.jsxs("div",{className:"flex justify-between mb-1",children:[J.jsx("span",{className:"text-sm",children:F}),J.jsxs("span",{className:"text-sm font-medium",children:[Math.round(z),"%"]})]}),J.jsx("div",{style:{backgroundColor:"var(--button-background)"},className:"w-full rounded-full h-2",children:J.jsx("div",{className:"bg-blue-500 rounded-full h-2 transition-all duration-300 ease-linear",style:{width:`${z}%`}})})]}),D=({speedMode:z,setSpeedMode:F})=>J.jsx("div",{className:"flex justify-center mb-4",children:J.jsxs("div",{className:"inline-flex rounded-lg p-1",style:{backgroundColor:"var(--button-background)"},children:[J.jsx("button",{className:`px-4 py-2 rounded-md text-sm font-medium ${z==="normal"?"bg-blue-500 text-white":"text-[var(--text-color)]"}`,onClick:()=>F("normal"),children:"Normal"}),J.jsx("button",{className:`px-4 py-2 rounded-md text-sm font-medium ${z==="fast"?"bg-blue-500 text-white":"text-[var(--text-color)]"}`,onClick:()=>F("fast"),children:"Fast"}),J.jsx("button",{className:`px-4 py-2 rounded-md text-sm font-medium ${z==="insane"?"bg-blue-500 text-white":"text-[var(--text-color)]"}`,onClick:()=>F("insane"),children:"Insane"})]})});return J.jsxs(Kx.Fragment,{children:[l?J.jsx(Ra,{children:J.jsxs("div",{className:"flex flex-col items-center justify-between",children:[J.jsx("div",{className:"w-full flex justify-center mb-4",children:J.jsx("img",{src:pT,alt:"MOS Printing Logo",className:"h-16 w-auto"})}),J.jsx("div",{className:"w-64 flex items-center justify-center mb-4",children:J.jsx("img",{src:gT,alt:"Printer Preview",className:"w-full h-full object-contain"})}),J.jsx("div",{className:"w-64 flex items-center justify-center mb-4",children:J.jsx("span",{className:`text-sm font-medium ${e==="ready"?"text-green-500":"text-red-500"}`,children:((w=e[0])==null?void 0:w.toUpperCase())+(e==null?void 0:e.slice(1))})}),J.jsxs("div",{className:"w-full flex items-center justify-center relative",children:[J.jsxs("button",{onClick:()=>{var z;return(z=d.current)==null?void 0:z.click()},className:`
              flex flex-col items-center justify-center gap-2 rounded-lg px-6 py-3 w-48
            `,disabled:x,children:[J.jsx(_T,{className:`w-8 h-8 ${x?"animate-pulse":""}`}),J.jsx("span",{className:"text-sm font-medium",children:x?"uploading...":"upload design"})]}),J.jsx("input",{type:"file",ref:d,onChange:C,className:"hidden"}),J.jsxs("div",{className:"absolute right-0 flex flex-col gap-4",children:[J.jsx("button",{onClick:()=>t("settings"),className:"p-2 rounded-full",children:J.jsx(fT,{className:"w-6 h-6"})}),J.jsx("button",{onClick:()=>t("history"),className:"p-2 rounded-full",children:J.jsx(lT,{className:"w-6 h-6"})})]})]})]})}):J.jsx(Ra,{children:J.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-opacity-75 rounded-lg",children:[J.jsx("div",{className:"animate-spin h-8 w-8 border-4 border-t-transparent border-[var(--text-color)] rounded-full"}),J.jsx("div",{className:"mt-4",children:"Connecting"})]})}),h&&J.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:J.jsx("div",{className:"bg-white rounded-lg shadow-lg w-full max-w-2xl",style:{backgroundColor:"var(--background-color)",color:"var(--text-color)"},children:J.jsxs("div",{className:"p-6",children:[J.jsx("h2",{className:"text-xl font-bold mb-2",children:c==null?void 0:c.name}),J.jsx(D,{speedMode:v,setSpeedMode:T}),v==="insane"&&J.jsx("div",{className:"mb-4 text-sm",children:"Are you sure you want to push the limits? This will cause accelerated wear of the motors, drivers and frame."}),v==="fast"&&J.jsx("div",{className:"mb-4 text-sm",children:"Increasing speed may affect print quality."}),_>0&&J.jsx(I,{progress:_,status:g}),J.jsxs("div",{className:`flex ${v==="insane"?"flex-col items-end gap-2 w-full":"justify-end gap-4"} mt-6`,children:[J.jsx("button",{onClick:()=>u(!1),className:`${v==="insane"?"bg-blue-500 text-white w-full":"sm:w-auto"} px-4 py-2 rounded-lg`,disabled:_>0&&_<100,children:v==="insane"?"No, I want my Mommy.":"Cancel"}),J.jsx("button",{onClick:()=>R(c),className:`${v==="insane"?"bg-red-500 w-full":"bg-blue-500 sm:w-auto"} text-white px-4 py-2 rounded-lg`,style:{opacity:_>0&&_<100?.5:1},disabled:_>0&&_<100,children:v==="insane"?"Yes, bring it on!":"Slice"})]})]})})})]})},ph=({title:n,showBack:e=!1,onBack:t})=>J.jsxs("div",{className:"w-full flex items-center justify-between p-4 border-b",children:[e?J.jsx("button",{onClick:t,className:"p-2",children:J.jsx(rT,{className:"w-5 h-5"})}):J.jsx("div",{className:"w-9"}),J.jsx("span",{className:"text-lg font-medium",children:n}),J.jsx("div",{className:"w-9"})]}),yT=n=>{const e=Math.floor(n/36e5),t=Math.floor(n%(1e3*60*60)/(1e3*60));return e>0?`${e}Hr ${t}Min`:`${t}Min`},xT=typeof WeakRef<"u";class bT{constructor(e,t=!1,i,s){this.initialize(e,t,i,s)}initialize(e,t=!1,i,s){return this.mask=e,this.skipNextObservers=t,this.target=i,this.currentTarget=s,this}}class TT{constructor(e,t,i=null){this.callback=e,this.mask=t,this.scope=i,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1,this._remove=null}remove(){this._remove&&this._remove()}}class q{static FromPromise(e,t){const i=new q;return e.then(s=>{i.notifyObservers(s)}).catch(s=>{if(t)t.notifyObservers(s);else throw s}),i}get observers(){return this._observers}constructor(e,t=!1){this.notifyIfTriggered=t,this._observers=new Array,this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new bT(0),e&&(this._onObserverAdded=e)}add(e,t=-1,i=!1,s=null,r=!1){if(!e)return null;const a=new TT(e,t,s);a.unregisterOnNextCall=r,i?this._observers.unshift(a):this._observers.push(a),this._onObserverAdded&&this._onObserverAdded(a),this._hasNotified&&this.notifyIfTriggered&&this._lastNotifiedValue!==void 0&&this.notifyObserver(a,this._lastNotifiedValue);const o=xT?new WeakRef(this):{deref:()=>this};return a._remove=()=>{const l=o.deref();l&&l._remove(a)},a}addOnce(e){return this.add(e,void 0,void 0,void 0,!0)}remove(e){return e?(e._remove=null,this._observers.indexOf(e)!==-1?(this._deferUnregister(e),!0):!1):!1}removeCallback(e,t){for(let i=0;i<this._observers.length;i++){const s=this._observers[i];if(!s._willBeUnregistered&&s.callback===e&&(!t||t===s.scope))return this._deferUnregister(s),!0}return!1}_deferUnregister(e){e._willBeUnregistered||(this._numObserversMarkedAsDeleted++,e.unregisterOnNextCall=!1,e._willBeUnregistered=!0,setTimeout(()=>{this._remove(e)},0))}_remove(e,t=!0){if(!e)return!1;const i=this._observers.indexOf(e);return i!==-1?(t&&this._numObserversMarkedAsDeleted--,this._observers.splice(i,1),!0):!1}makeObserverTopPriority(e){this._remove(e,!1),this._observers.unshift(e)}makeObserverBottomPriority(e){this._remove(e,!1),this._observers.push(e)}notifyObservers(e,t=-1,i,s,r){if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=e),!this._observers.length)return!0;const a=this._eventState;a.mask=t,a.target=i,a.currentTarget=s,a.skipNextObservers=!1,a.lastReturnValue=e,a.userInfo=r;for(const o of this._observers)if(!o._willBeUnregistered&&(o.mask&t&&(o.unregisterOnNextCall&&this._deferUnregister(o),o.scope?a.lastReturnValue=o.callback.apply(o.scope,[e,a]):a.lastReturnValue=o.callback(e,a)),a.skipNextObservers))return!1;return!0}notifyObserver(e,t,i=-1){if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=t),e._willBeUnregistered)return;const s=this._eventState;s.mask=i,s.skipNextObservers=!1,e.unregisterOnNextCall&&this._deferUnregister(e),e.callback(t,s)}hasObservers(){return this._observers.length-this._numObserversMarkedAsDeleted>0}clear(){for(;this._observers.length;){const e=this._observers.pop();e&&(e._remove=null)}this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()}cleanLastNotifiedState(){this._hasNotified=!1,this._lastNotifiedValue=void 0}clone(){const e=new q;return e._observers=this._observers.slice(0),e}hasSpecificMask(e=-1){for(const t of this._observers)if(t.mask&e||t.mask===e)return!0;return!1}}class AT{get wrapU(){return this._cachedWrapU}set wrapU(e){this._cachedWrapU=e}get wrapV(){return this._cachedWrapV}set wrapV(e){this._cachedWrapV=e}get wrapR(){return this._cachedWrapR}set wrapR(e){this._cachedWrapR=e}get anisotropicFilteringLevel(){return this._cachedAnisotropicFilteringLevel}set anisotropicFilteringLevel(e){this._cachedAnisotropicFilteringLevel=e}get comparisonFunction(){return this._comparisonFunction}set comparisonFunction(e){this._comparisonFunction=e}get useMipMaps(){return this._useMipMaps}set useMipMaps(e){this._useMipMaps=e}constructor(){this.samplingMode=-1,this._useMipMaps=!0,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this._comparisonFunction=0}setParameters(e=1,t=1,i=1,s=1,r=2,a=0){return this._cachedWrapU=e,this._cachedWrapV=t,this._cachedWrapR=i,this._cachedAnisotropicFilteringLevel=s,this.samplingMode=r,this._comparisonFunction=a,this}compareSampler(e){return this._cachedWrapU===e._cachedWrapU&&this._cachedWrapV===e._cachedWrapV&&this._cachedWrapR===e._cachedWrapR&&this._cachedAnisotropicFilteringLevel===e._cachedAnisotropicFilteringLevel&&this.samplingMode===e.samplingMode&&this._comparisonFunction===e._comparisonFunction&&this._useMipMaps===e._useMipMaps}}var lp;(function(n){n[n.Unknown=0]="Unknown",n[n.Url=1]="Url",n[n.Temp=2]="Temp",n[n.Raw=3]="Raw",n[n.Dynamic=4]="Dynamic",n[n.RenderTarget=5]="RenderTarget",n[n.MultiRenderTarget=6]="MultiRenderTarget",n[n.Cube=7]="Cube",n[n.CubeRaw=8]="CubeRaw",n[n.CubePrefiltered=9]="CubePrefiltered",n[n.Raw3D=10]="Raw3D",n[n.Raw2DArray=11]="Raw2DArray",n[n.DepthStencil=12]="DepthStencil",n[n.CubeRawRGBD=13]="CubeRawRGBD",n[n.Depth=14]="Depth"})(lp||(lp={}));class gt extends AT{get useMipMaps(){return this.generateMipMaps}set useMipMaps(e){this.generateMipMaps=e}get uniqueId(){return this._uniqueId}_setUniqueId(e){this._uniqueId=e}getEngine(){return this._engine}get source(){return this._source}constructor(e,t,i=!1){super(),this.isReady=!1,this.isCube=!1,this.is3D=!1,this.is2DArray=!1,this.isMultiview=!1,this.url="",this.generateMipMaps=!1,this.samples=0,this.type=-1,this.format=-1,this.onLoadedObservable=new q,this.onErrorObservable=new q,this.onRebuildCallback=null,this.width=0,this.height=0,this.depth=0,this.baseWidth=0,this.baseHeight=0,this.baseDepth=0,this.invertY=!1,this._invertVScale=!1,this._associatedChannel=-1,this._source=0,this._buffer=null,this._bufferView=null,this._bufferViewArray=null,this._bufferViewArrayArray=null,this._size=0,this._extension="",this._files=null,this._workingCanvas=null,this._workingContext=null,this._cachedCoordinatesMode=null,this._isDisabled=!1,this._compression=null,this._sphericalPolynomial=null,this._sphericalPolynomialPromise=null,this._sphericalPolynomialComputed=!1,this._lodGenerationScale=0,this._lodGenerationOffset=0,this._useSRGBBuffer=!1,this._creationFlags=0,this._lodTextureHigh=null,this._lodTextureMid=null,this._lodTextureLow=null,this._isRGBD=!1,this._linearSpecularLOD=!1,this._irradianceTexture=null,this._hardwareTexture=null,this._maxLodLevel=null,this._references=1,this._gammaSpace=null,this._premulAlpha=!1,this._dynamicTextureSource=null,this._autoMSAAManagement=!1,this._engine=e,this._source=t,this._uniqueId=gt._Counter++,i||(this._hardwareTexture=e._createHardwareTexture())}incrementReferences(){this._references++}updateSize(e,t,i=1){this._engine.updateTextureDimensions(this,e,t,i),this.width=e,this.height=t,this.depth=i,this.baseWidth=e,this.baseHeight=t,this.baseDepth=i,this._size=e*t*i}_rebuild(){if(this.isReady=!1,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this.onRebuildCallback){const t=this.onRebuildCallback(this),i=s=>{s._swapAndDie(this,!1),this.isReady=t.isReady};t.isAsync?t.proxy.then(i):i(t.proxy);return}let e;switch(this.source){case 2:break;case 1:e=this._engine.createTexture(this._originalUrl??this.url,!this.generateMipMaps,this.invertY,null,this.samplingMode,t=>{t._swapAndDie(this,!1),this.isReady=!0},null,this._buffer,void 0,this.format,this._extension,void 0,void 0,void 0,this._useSRGBBuffer);return;case 3:e=this._engine.createRawTexture(this._bufferView,this.baseWidth,this.baseHeight,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type,this._creationFlags,this._useSRGBBuffer),e._swapAndDie(this,!1),this.isReady=!0;break;case 10:e=this._engine.createRawTexture3D(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type),e._swapAndDie(this,!1),this.isReady=!0;break;case 11:e=this._engine.createRawTexture2DArray(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type),e._swapAndDie(this,!1),this.isReady=!0;break;case 4:e=this._engine.createDynamicTexture(this.baseWidth,this.baseHeight,this.generateMipMaps,this.samplingMode),e._swapAndDie(this,!1),this._dynamicTextureSource&&this._engine.updateDynamicTexture(this,this._dynamicTextureSource,this.invertY,this._premulAlpha,this.format,!0);break;case 7:e=this._engine.createCubeTexture(this.url,null,this._files,!this.generateMipMaps,()=>{e._swapAndDie(this,!1),this.isReady=!0},null,this.format,this._extension,!1,0,0,null,void 0,this._useSRGBBuffer,ArrayBuffer.isView(this._buffer)?this._buffer:null);return;case 8:e=this._engine.createRawCubeTexture(this._bufferViewArray,this.width,this._originalFormat??this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression),e._swapAndDie(this,!1),this.isReady=!0;break;case 13:return;case 9:e=this._engine.createPrefilteredCubeTexture(this.url,null,this._lodGenerationScale,this._lodGenerationOffset,t=>{t&&t._swapAndDie(this,!1),this.isReady=!0},null,this.format,this._extension),e._sphericalPolynomial=this._sphericalPolynomial;return}}_swapAndDie(e,t=!0){var r;(r=this._hardwareTexture)==null||r.setUsage(e._source,this.generateMipMaps,this.is2DArray,this.isCube,this.is3D,this.width,this.height,this.depth),e._hardwareTexture=this._hardwareTexture,t&&(e._isRGBD=this._isRGBD),this._lodTextureHigh&&(e._lodTextureHigh&&e._lodTextureHigh.dispose(),e._lodTextureHigh=this._lodTextureHigh),this._lodTextureMid&&(e._lodTextureMid&&e._lodTextureMid.dispose(),e._lodTextureMid=this._lodTextureMid),this._lodTextureLow&&(e._lodTextureLow&&e._lodTextureLow.dispose(),e._lodTextureLow=this._lodTextureLow),this._irradianceTexture&&(e._irradianceTexture&&e._irradianceTexture.dispose(),e._irradianceTexture=this._irradianceTexture);const i=this._engine.getLoadedTexturesCache();let s=i.indexOf(this);s!==-1&&i.splice(s,1),s=i.indexOf(e),s===-1&&i.push(e)}dispose(){this._references--,this._references===0&&(this.onLoadedObservable.clear(),this.onErrorObservable.clear(),this._engine._releaseTexture(this),this._hardwareTexture=null,this._dynamicTextureSource=null)}}gt._Counter=0;class Ae{static get LastCreatedEngine(){return this.Instances.length===0?null:this.Instances[this.Instances.length-1]}static get LastCreatedScene(){return this._LastCreatedScene}}Ae.Instances=[];Ae.OnEnginesDisposedObservable=new q;Ae._LastCreatedScene=null;Ae.UseFallbackTexture=!0;Ae.FallbackTexture="";class ET{constructor(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null,this._isDisposed=!1}get isAsync(){return this.isParallelCompiled}get isReady(){return this.program?this.isParallelCompiled?this.engine._isRenderingStateCompiled(this):!0:!1}_handlesSpectorRebuildCallback(e){e&&this.program&&e(this.program)}setEngine(e){this.engine=e}_fillEffectInformation(e,t,i,s,r,a,o,l){const h=this.engine;if(h.supportsUniformBuffers)for(const f in t)e.bindUniformBlock(f,t[f]);this.engine.getUniforms(this,i).forEach((f,d)=>{s[i[d]]=f}),this._uniforms=s;let c;for(c=0;c<r.length;c++)e.getUniform(r[c])==null&&(r.splice(c,1),c--);r.forEach((f,d)=>{a[f]=d});for(const f of h.getAttributes(this,o))l.push(f)}dispose(){this._uniforms={},this._isDisposed=!0}_cacheMatrix(e,t){const i=this._valueCache[e],s=t.updateFlag;return i!==void 0&&i===s?!1:(this._valueCache[e]=s,!0)}_cacheFloat2(e,t,i){let s=this._valueCache[e];if(!s||s.length!==2)return s=[t,i],this._valueCache[e]=s,!0;let r=!1;return s[0]!==t&&(s[0]=t,r=!0),s[1]!==i&&(s[1]=i,r=!0),r}_cacheFloat3(e,t,i,s){let r=this._valueCache[e];if(!r||r.length!==3)return r=[t,i,s],this._valueCache[e]=r,!0;let a=!1;return r[0]!==t&&(r[0]=t,a=!0),r[1]!==i&&(r[1]=i,a=!0),r[2]!==s&&(r[2]=s,a=!0),a}_cacheFloat4(e,t,i,s,r){let a=this._valueCache[e];if(!a||a.length!==4)return a=[t,i,s,r],this._valueCache[e]=a,!0;let o=!1;return a[0]!==t&&(a[0]=t,o=!0),a[1]!==i&&(a[1]=i,o=!0),a[2]!==s&&(a[2]=s,o=!0),a[3]!==r&&(a[3]=r,o=!0),o}setInt(e,t){const i=this._valueCache[e];i!==void 0&&i===t||this.engine.setInt(this._uniforms[e],t)&&(this._valueCache[e]=t)}setInt2(e,t,i){this._cacheFloat2(e,t,i)&&(this.engine.setInt2(this._uniforms[e],t,i)||(this._valueCache[e]=null))}setInt3(e,t,i,s){this._cacheFloat3(e,t,i,s)&&(this.engine.setInt3(this._uniforms[e],t,i,s)||(this._valueCache[e]=null))}setInt4(e,t,i,s,r){this._cacheFloat4(e,t,i,s,r)&&(this.engine.setInt4(this._uniforms[e],t,i,s,r)||(this._valueCache[e]=null))}setIntArray(e,t){this._valueCache[e]=null,this.engine.setIntArray(this._uniforms[e],t)}setIntArray2(e,t){this._valueCache[e]=null,this.engine.setIntArray2(this._uniforms[e],t)}setIntArray3(e,t){this._valueCache[e]=null,this.engine.setIntArray3(this._uniforms[e],t)}setIntArray4(e,t){this._valueCache[e]=null,this.engine.setIntArray4(this._uniforms[e],t)}setUInt(e,t){const i=this._valueCache[e];i!==void 0&&i===t||this.engine.setUInt(this._uniforms[e],t)&&(this._valueCache[e]=t)}setUInt2(e,t,i){this._cacheFloat2(e,t,i)&&(this.engine.setUInt2(this._uniforms[e],t,i)||(this._valueCache[e]=null))}setUInt3(e,t,i,s){this._cacheFloat3(e,t,i,s)&&(this.engine.setUInt3(this._uniforms[e],t,i,s)||(this._valueCache[e]=null))}setUInt4(e,t,i,s,r){this._cacheFloat4(e,t,i,s,r)&&(this.engine.setUInt4(this._uniforms[e],t,i,s,r)||(this._valueCache[e]=null))}setUIntArray(e,t){this._valueCache[e]=null,this.engine.setUIntArray(this._uniforms[e],t)}setUIntArray2(e,t){this._valueCache[e]=null,this.engine.setUIntArray2(this._uniforms[e],t)}setUIntArray3(e,t){this._valueCache[e]=null,this.engine.setUIntArray3(this._uniforms[e],t)}setUIntArray4(e,t){this._valueCache[e]=null,this.engine.setUIntArray4(this._uniforms[e],t)}setArray(e,t){this._valueCache[e]=null,this.engine.setArray(this._uniforms[e],t)}setArray2(e,t){this._valueCache[e]=null,this.engine.setArray2(this._uniforms[e],t)}setArray3(e,t){this._valueCache[e]=null,this.engine.setArray3(this._uniforms[e],t)}setArray4(e,t){this._valueCache[e]=null,this.engine.setArray4(this._uniforms[e],t)}setMatrices(e,t){t&&(this._valueCache[e]=null,this.engine.setMatrices(this._uniforms[e],t))}setMatrix(e,t){this._cacheMatrix(e,t)&&(this.engine.setMatrices(this._uniforms[e],t.asArray())||(this._valueCache[e]=null))}setMatrix3x3(e,t){this._valueCache[e]=null,this.engine.setMatrix3x3(this._uniforms[e],t)}setMatrix2x2(e,t){this._valueCache[e]=null,this.engine.setMatrix2x2(this._uniforms[e],t)}setFloat(e,t){const i=this._valueCache[e];i!==void 0&&i===t||this.engine.setFloat(this._uniforms[e],t)&&(this._valueCache[e]=t)}setVector2(e,t){this._cacheFloat2(e,t.x,t.y)&&(this.engine.setFloat2(this._uniforms[e],t.x,t.y)||(this._valueCache[e]=null))}setFloat2(e,t,i){this._cacheFloat2(e,t,i)&&(this.engine.setFloat2(this._uniforms[e],t,i)||(this._valueCache[e]=null))}setVector3(e,t){this._cacheFloat3(e,t.x,t.y,t.z)&&(this.engine.setFloat3(this._uniforms[e],t.x,t.y,t.z)||(this._valueCache[e]=null))}setFloat3(e,t,i,s){this._cacheFloat3(e,t,i,s)&&(this.engine.setFloat3(this._uniforms[e],t,i,s)||(this._valueCache[e]=null))}setVector4(e,t){this._cacheFloat4(e,t.x,t.y,t.z,t.w)&&(this.engine.setFloat4(this._uniforms[e],t.x,t.y,t.z,t.w)||(this._valueCache[e]=null))}setQuaternion(e,t){this._cacheFloat4(e,t.x,t.y,t.z,t.w)&&(this.engine.setFloat4(this._uniforms[e],t.x,t.y,t.z,t.w)||(this._valueCache[e]=null))}setFloat4(e,t,i,s,r){this._cacheFloat4(e,t,i,s,r)&&(this.engine.setFloat4(this._uniforms[e],t,i,s,r)||(this._valueCache[e]=null))}setColor3(e,t){this._cacheFloat3(e,t.r,t.g,t.b)&&(this.engine.setFloat3(this._uniforms[e],t.r,t.g,t.b)||(this._valueCache[e]=null))}setColor4(e,t,i){this._cacheFloat4(e,t.r,t.g,t.b,i)&&(this.engine.setFloat4(this._uniforms[e],t.r,t.g,t.b,i)||(this._valueCache[e]=null))}setDirectColor4(e,t){this._cacheFloat4(e,t.r,t.g,t.b,t.a)&&(this.engine.setFloat4(this._uniforms[e],t.r,t.g,t.b,t.a)||(this._valueCache[e]=null))}_getVertexShaderCode(){return this.vertexShader?this.engine._getShaderSource(this.vertexShader):null}_getFragmentShaderCode(){return this.fragmentShader?this.engine._getShaderSource(this.fragmentShader):null}}const hp={};function Ee(n,e=!1){if(!(e&&hp[n]))return hp[n]=!0,`${n} needs to be imported before as it contains a side-effect required by your code.`}function zt(){return typeof window<"u"}function ra(){return typeof navigator<"u"}function yo(){return typeof document<"u"}function $f(n){let e="",t=n.firstChild;for(;t;)t.nodeType===3&&(e+=t.textContent),t=t.nextSibling;return e}const Dl={};function j2(n,e,t=""){return t+(e?e+`
`:"")+n}function q2(n,e,t,i,s,r,a){const o=a||Dl.loadFile;if(o)return o(n,e,t,i,s,r);throw Ee("FileTools")}function $2(n,e,t,i){if(n){e?n.IS_NDC_HALF_ZRANGE="":delete n.IS_NDC_HALF_ZRANGE,t?n.USE_REVERSE_DEPTHBUFFER="":delete n.USE_REVERSE_DEPTHBUFFER,i?n.USE_EXACT_SRGB_CONVERSIONS="":delete n.USE_EXACT_SRGB_CONVERSIONS;return}else{let s="";return e&&(s+="#define IS_NDC_HALF_ZRANGE"),t&&(s&&(s+=`
`),s+="#define USE_REVERSE_DEPTHBUFFER"),i&&(s&&(s+=`
`),s+="#define USE_EXACT_SRGB_CONVERSIONS"),s}}function Sc(n,e,t=!1,i){switch(n){case 3:{const r=e instanceof ArrayBuffer?new Int8Array(e):new Int8Array(e);return i&&r.set(new Int8Array(i)),r}case 0:{const r=e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e);return i&&r.set(new Uint8Array(i)),r}case 4:{const r=e instanceof ArrayBuffer?new Int16Array(e):new Int16Array(t?e/2:e);return i&&r.set(new Int16Array(i)),r}case 5:case 8:case 9:case 10:case 2:{const r=e instanceof ArrayBuffer?new Uint16Array(e):new Uint16Array(t?e/2:e);return i&&r.set(new Uint16Array(i)),r}case 6:{const r=e instanceof ArrayBuffer?new Int32Array(e):new Int32Array(t?e/4:e);return i&&r.set(new Int32Array(i)),r}case 7:case 11:case 12:case 13:case 14:case 15:{const r=e instanceof ArrayBuffer?new Uint32Array(e):new Uint32Array(t?e/4:e);return i&&r.set(new Uint32Array(i)),r}case 1:{const r=e instanceof ArrayBuffer?new Float32Array(e):new Float32Array(t?e/4:e);return i&&r.set(new Float32Array(i)),r}}const s=e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e);return i&&s.set(new Uint8Array(i)),s}const Rc=new WeakMap,ST={_webGLVersion:2,cachedPipelines:{}};function Pi(n){let e=Rc.get(n);if(!e){if(!n)return ST;e={_webGLVersion:n.TEXTURE_BINDING_3D?2:1,_context:n,parallelShaderCompile:n.getExtension("KHR_parallel_shader_compile")||void 0,cachedPipelines:{}},Rc.set(n,e)}return e}function _u(n){Rc.delete(n)}function Z2(n,e,t,i,s,r){const a=Pi(i);r||(r=a._createShaderProgramInjection??Zf);const o=Ic(e,"vertex",i,a._contextWasLost),l=Ic(t,"fragment",i,a._contextWasLost);return r(n,o,l,i,s,a.validateShaderPrograms)}function Q2(n,e,t,i,s,r=null,a){const o=Pi(s);a||(a=o._createShaderProgramInjection??Zf);const l=o._webGLVersion>1?`#version 300 es
#define WEBGL2 
`:"",h=up(e,"vertex",i,l,s,o._contextWasLost),u=up(t,"fragment",i,l,s,o._contextWasLost);return a(n,h,u,s,r,o.validateShaderPrograms)}function RT(n,e){const t=new ET,i=Pi(n);return i.parallelShaderCompile&&!i.disableParallelShaderCompile&&(t.isParallelCompiled=!0),t.context=i._context,t}function Zf(n,e,t,i,s=null,r){const a=i.createProgram();if(n.program=a,!a)throw new Error("Unable to create program");return i.attachShader(a,e),i.attachShader(a,t),i.linkProgram(a),n.context=i,n.vertexShader=e,n.fragmentShader=t,n.isParallelCompiled||Qf(n,i,r),a}function IT(n,e,t){const i=n;if(i._isDisposed)return!1;const s=Pi(e);return s&&s.parallelShaderCompile&&s.parallelShaderCompile.COMPLETION_STATUS_KHR&&i.program&&e.getProgramParameter(i.program,s.parallelShaderCompile.COMPLETION_STATUS_KHR)?(Qf(i,e,t),!0):!1}function Qf(n,e,t){const i=n.context,s=n.vertexShader,r=n.fragmentShader,a=n.program;if(!i.getProgramParameter(a,i.LINK_STATUS)){if(!e.getShaderParameter(s,e.COMPILE_STATUS)){const h=e.getShaderInfoLog(s);if(h)throw n.vertexCompilationError=h,new Error("VERTEX SHADER "+h)}if(!e.getShaderParameter(r,e.COMPILE_STATUS)){const h=e.getShaderInfoLog(r);if(h)throw n.fragmentCompilationError=h,new Error("FRAGMENT SHADER "+h)}const l=i.getProgramInfoLog(a);if(l)throw n.programLinkError=l,new Error(l)}if(t&&(i.validateProgram(a),!i.getProgramParameter(a,i.VALIDATE_STATUS))){const h=i.getProgramInfoLog(a);if(h)throw n.programValidationError=h,new Error(h)}i.deleteShader(s),i.deleteShader(r),n.vertexShader=void 0,n.fragmentShader=void 0,n.onCompiled&&(n.onCompiled(),n.onCompiled=void 0)}function CT(n,e,t,i,s,r,a,o,l,h="",u,c,f){const d=Pi(n.context);c||(c=d.createRawShaderProgramInjection??Z2),f||(f=d.createShaderProgramInjection??Q2);const _=n;i?_.program=c(_,e,t,_.context,l):_.program=f(_,e,t,o,_.context,l),_.program.__SPECTOR_rebuildProgram=a,u()}function up(n,e,t,i,s,r){return Ic(j2(n,t,i),e,s,r)}function Ic(n,e,t,i){const s=t.createShader(e==="vertex"?t.VERTEX_SHADER:t.FRAGMENT_SHADER);if(!s){let r=t.NO_ERROR,a=t.NO_ERROR;for(;(a=t.getError())!==t.NO_ERROR;)r=a;throw new Error(`Something went wrong while creating a gl ${e} shader object. gl error=${r}, gl isContextLost=${t.isContextLost()}, _contextWasLost=${i}`)}return t.shaderSource(s,n),t.compileShader(s),s}function MT(n,e){e.useProgram(n)}function PT(n,e){const t=n;if(!t.isParallelCompiled){e(n);return}const i=t.onCompiled;t.onCompiled=()=>{i==null||i(),e(n)}}function J2(n){return n.getPipelineContext===void 0}class U{static _CheckLimit(e,t){let i=U._LogLimitOutputs[e];return i?i.current++:(i={limit:t,current:1},U._LogLimitOutputs[e]=i),i.current<=i.limit}static _GenerateLimitMessage(e,t=1){const i=U._LogLimitOutputs[e];if(!i||!U.MessageLimitReached)return;const s=this._Levels[t];i.current===i.limit&&U[s.name](U.MessageLimitReached.replace(/%LIMIT%/g,""+i.limit).replace(/%TYPE%/g,s.name??""))}static _AddLogEntry(e){U._LogCache=e+U._LogCache,U.OnNewCacheEntry&&U.OnNewCacheEntry(e)}static _FormatMessage(e){const t=s=>s<10?"0"+s:""+s,i=new Date;return"["+t(i.getHours())+":"+t(i.getMinutes())+":"+t(i.getSeconds())+"]: "+e}static _LogDisabled(e,t){}static _LogEnabled(e=1,t,i){const s=Array.isArray(t)?t[0]:t;if(i!==void 0&&!U._CheckLimit(s,i))return;const r=U._FormatMessage(s),a=this._Levels[e],o=Array.isArray(t)?t.slice(1):[];a.logFunc&&a.logFunc("BJS - "+r,...o);const l=`<div style='color:${a.color}'>${r}</div><br>`;U._AddLogEntry(l),U._GenerateLimitMessage(s,e)}static get LogCache(){return U._LogCache}static ClearLogCache(){U._LogCache="",U._LogLimitOutputs={},U.errorsCount=0}static set LogLevels(e){U.Log=U._LogDisabled,U.Warn=U._LogDisabled,U.Error=U._LogDisabled,[U.MessageLogLevel,U.WarningLogLevel,U.ErrorLogLevel].forEach(t=>{if((e&t)===t){const i=this._Levels[t];U[i.name]=U._LogEnabled.bind(U,t)}})}}U.NoneLogLevel=0;U.MessageLogLevel=1;U.WarningLogLevel=2;U.ErrorLogLevel=4;U.AllLogLevel=7;U.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.";U._LogCache="";U._LogLimitOutputs={};U._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}];U.errorsCount=0;U.Log=U._LogEnabled.bind(U,U.MessageLogLevel);U.Warn=U._LogEnabled.bind(U,U.WarningLogLevel);U.Error=U._LogEnabled.bind(U,U.ErrorLogLevel);class wT{constructor(){this.shaderLanguage=0}postProcessor(e,t,i,s,r){if(r.drawBuffersExtensionDisabled){const a=/#extension.+GL_EXT_draw_buffers.+(enable|require)/g;e=e.replace(a,"")}return e}}const DT=/(flat\s)?\s*varying\s*.*/;class OT{constructor(){this.shaderLanguage=0}attributeProcessor(e){return e.replace("attribute","in")}varyingCheck(e,t){return DT.test(e)}varyingProcessor(e,t){return e.replace("varying",t?"in":"out")}postProcessor(e,t,i){const s=e.search(/#extension.+GL_EXT_draw_buffers.+require/)!==-1,r=/#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g;if(e=e.replace(r,""),e=e.replace(/texture2D\s*\(/g,"texture("),i){const a=e.search(/layout *\(location *= *0\) *out/g)!==-1;e=e.replace(/texture2DLodEXT\s*\(/g,"textureLod("),e=e.replace(/textureCubeLodEXT\s*\(/g,"textureLod("),e=e.replace(/textureCube\s*\(/g,"texture("),e=e.replace(/gl_FragDepthEXT/g,"gl_FragDepth"),e=e.replace(/gl_FragColor/g,"glFragColor"),e=e.replace(/gl_FragData/g,"glFragData"),e=e.replace(/void\s+?main\s*\(/g,(s||a?"":`layout(location = 0) out vec4 glFragColor;
`)+"void main(")}else if(t.indexOf("#define MULTIVIEW")!==-1)return`#extension GL_OVR_multiview2 : require
layout (num_views = 2) in;
`+e;return e}}class ka{get underlyingResource(){return null}constructor(){this.references=0,this.capacity=0,this.is32Bits=!1,this.uniqueId=ka._Counter++}}ka._Counter=0;class Vo extends ka{constructor(e){super(),this._buffer=e}get underlyingResource(){return this._buffer}}function Go(n){let e=1;do e*=2;while(e<n);return e===n}function Cc(n,e,t){return n*(1-t)+e*t}function ev(n){const e=tv(n),t=Jf(n);return e-n>n-t?t:e}function tv(n){return n--,n|=n>>1,n|=n>>2,n|=n>>4,n|=n>>8,n|=n>>16,n++,n}function Jf(n){return n=n|n>>1,n=n|n>>2,n=n|n>>4,n=n|n>>8,n=n|n>>16,n-(n>>1)}function Yi(n,e,t=2){let i;switch(t){case 1:i=Jf(n);break;case 2:i=ev(n);break;case 3:default:i=tv(n);break}return Math.min(i,e)}class ye{static GetShadersRepository(e=0){return e===0?ye.ShadersRepository:ye.ShadersRepositoryWGSL}static GetShadersStore(e=0){return e===0?ye.ShadersStore:ye.ShadersStoreWGSL}static GetIncludesShadersStore(e=0){return e===0?ye.IncludesShadersStore:ye.IncludesShadersStoreWGSL}}ye.ShadersRepository="src/Shaders/";ye.ShadersStore={};ye.IncludesShadersStore={};ye.ShadersRepositoryWGSL="src/ShadersWGSL/";ye.ShadersStoreWGSL={};ye.IncludesShadersStoreWGSL={};const FT="attribute",LT="varying";class r0{constructor(){this.children=[]}isValid(e){return!0}process(e,t){var s,r,a,o,l,h;let i="";if(this.line){let u=this.line;const c=t.processor;if(c){c.lineProcessor&&(u=c.lineProcessor(u,t.isFragment,t.processingContext));const f=((s=t.processor)==null?void 0:s.attributeKeywordName)??FT,d=t.isFragment&&((r=t.processor)!=null&&r.varyingFragmentKeywordName)?(a=t.processor)==null?void 0:a.varyingFragmentKeywordName:!t.isFragment&&((o=t.processor)!=null&&o.varyingVertexKeywordName)?(l=t.processor)==null?void 0:l.varyingVertexKeywordName:LT;!t.isFragment&&c.attributeProcessor&&this.line.startsWith(f)?u=c.attributeProcessor(this.line,e,t.processingContext):c.varyingProcessor&&((h=c.varyingCheck)!=null&&h.call(c,this.line,t.isFragment)||!c.varyingCheck&&this.line.startsWith(d))?u=c.varyingProcessor(this.line,t.isFragment,e,t.processingContext):c.uniformProcessor&&c.uniformRegexp&&c.uniformRegexp.test(this.line)?t.lookForClosingBracketForUniformBuffer||(u=c.uniformProcessor(this.line,t.isFragment,e,t.processingContext)):c.uniformBufferProcessor&&c.uniformBufferRegexp&&c.uniformBufferRegexp.test(this.line)?t.lookForClosingBracketForUniformBuffer||(u=c.uniformBufferProcessor(this.line,t.isFragment,t.processingContext),t.lookForClosingBracketForUniformBuffer=!0):c.textureProcessor&&c.textureRegexp&&c.textureRegexp.test(this.line)?u=c.textureProcessor(this.line,t.isFragment,e,t.processingContext):(c.uniformProcessor||c.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!t.lookForClosingBracketForUniformBuffer&&(/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?c.uniformProcessor&&(u=c.uniformProcessor(this.line,t.isFragment,e,t.processingContext)):c.uniformBufferProcessor&&(u=c.uniformBufferProcessor(this.line,t.isFragment,t.processingContext),t.lookForClosingBracketForUniformBuffer=!0)),t.lookForClosingBracketForUniformBuffer&&this.line.indexOf("}")!==-1&&(t.lookForClosingBracketForUniformBuffer=!1,c.endOfUniformBufferProcessor&&(u=c.endOfUniformBufferProcessor(this.line,t.isFragment,t.processingContext)))}i+=u+`
`}return this.children.forEach(u=>{i+=u.process(e,t)}),this.additionalDefineKey&&(e[this.additionalDefineKey]=this.additionalDefineValue||"true"),i}}class BT{constructor(){this._lines=[]}get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}set lines(e){this._lines.length=0;for(const t of e){if(!t||t==="\r")continue;if(t[0]==="#"){this._lines.push(t);continue}const i=t.trim();if(!i)continue;if(i.startsWith("//")){this._lines.push(t);continue}const s=i.indexOf(";");if(s===-1)this._lines.push(i);else if(s===i.length-1)i.length>1&&this._lines.push(i);else{const r=t.split(";");for(let a=0;a<r.length;a++){let o=r[a];o&&(o=o.trim(),o&&this._lines.push(o+(a!==r.length-1?";":"")))}}}}}class pu extends r0{process(e,t){for(let i=0;i<this.children.length;i++){const s=this.children[i];if(s.isValid(e))return s.process(e,t)}return""}}class NT extends r0{isValid(e){return this.testExpression.isTrue(e)}}class dt{isTrue(e){return!0}static postfixToInfix(e){const t=[];for(const i of e)if(dt._OperatorPriority[i]===void 0)t.push(i);else{const s=t[t.length-1],r=t[t.length-2];t.length-=2,t.push(`(${r}${i}${s})`)}return t[t.length-1]}static infixToPostfix(e){const t=dt._InfixToPostfixCache.get(e);if(t)return t.accessTime=Date.now(),t.result;if(!e.includes("&&")&&!e.includes("||")&&!e.includes(")")&&!e.includes("("))return[e];const i=[];let s=-1;const r=()=>{u=u.trim(),u!==""&&(i.push(u),u="")},a=c=>{s<dt._Stack.length-1&&(dt._Stack[++s]=c)},o=()=>dt._Stack[s],l=()=>s===-1?"!!INVALID EXPRESSION!!":dt._Stack[s--];let h=0,u="";for(;h<e.length;){const c=e.charAt(h),f=h<e.length-1?e.substring(h,2+h):"";if(c==="(")u="",a(c);else if(c===")"){for(r();s!==-1&&o()!=="(";)i.push(l());l()}else if(dt._OperatorPriority[f]>1){for(r();s!==-1&&dt._OperatorPriority[o()]>=dt._OperatorPriority[f];)i.push(l());a(f),h++}else u+=c;h++}for(r();s!==-1;)o()==="("?l():i.push(l());return dt._InfixToPostfixCache.size>=dt.InfixToPostfixCacheLimitSize&&dt.ClearCache(),dt._InfixToPostfixCache.set(e,{result:i,accessTime:Date.now()}),i}static ClearCache(){const e=Array.from(dt._InfixToPostfixCache.entries()).sort((t,i)=>t[1].accessTime-i[1].accessTime);for(let t=0;t<dt.InfixToPostfixCacheCleanupSize;t++)dt._InfixToPostfixCache.delete(e[t][0])}}dt.InfixToPostfixCacheLimitSize=5e4;dt.InfixToPostfixCacheCleanupSize=25e3;dt._InfixToPostfixCache=new Map;dt._OperatorPriority={")":0,"(":1,"||":2,"&&":3};dt._Stack=["","","","","","","","","","","","","","","","","","","",""];class Ol extends dt{constructor(e,t=!1){super(),this.define=e,this.not=t}isTrue(e){let t=e[this.define]!==void 0;return this.not&&(t=!t),t}}class UT extends dt{isTrue(e){return this.leftOperand.isTrue(e)||this.rightOperand.isTrue(e)}}class kT extends dt{isTrue(e){return this.leftOperand.isTrue(e)&&this.rightOperand.isTrue(e)}}class VT extends dt{constructor(e,t,i){super(),this.define=e,this.operand=t,this.testValue=i}isTrue(e){let t=e[this.define];t===void 0&&(t=this.define);let i=!1;const s=parseInt(t),r=parseInt(this.testValue);switch(this.operand){case">":i=s>r;break;case"<":i=s<r;break;case"<=":i=s<=r;break;case">=":i=s>=r;break;case"==":i=s===r;break;case"!=":i=s!==r;break}return i}}const GT=/defined\s*?\((.+?)\)/g,gu=/defined\s*?\[(.+?)\]/g,zT=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,WT=/__decl__/,cp=/light\{X\}.(\w*)/g,fp=/\{X\}/g,F0=[],HT=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function ed(n){n.processor&&n.processor.initializeShaders&&n.processor.initializeShaders(n.processingContext)}function Fl(n,e,t,i){var s;(s=e.processor)!=null&&s.preProcessShaderCode&&(n=e.processor.preProcessShaderCode(n,e.isFragment)),zo(n,e,r=>{e.processCodeAfterIncludes&&(r=e.processCodeAfterIncludes(e.isFragment?"fragment":"vertex",r,e.defines));const a=jT(r,e,i);t(a,r)})}function KT(n,e,t,i){var s;(s=e.processor)!=null&&s.preProcessShaderCode&&(n=e.processor.preProcessShaderCode(n,e.isFragment)),zo(n,e,r=>{e.processCodeAfterIncludes&&(r=e.processCodeAfterIncludes(e.isFragment?"fragment":"vertex",r,e.defines));const a=qT(r,e,i);t(a,r)})}function td(n,e,t){return!t.processor||!t.processor.finalizeShaders?{vertexCode:n,fragmentCode:e}:t.processor.finalizeShaders(n,e,t.processingContext)}function XT(n,e){var i;if((i=e.processor)!=null&&i.noPrecision)return n;const t=e.shouldUseHighPrecisionShader;return n.indexOf("precision highp float")===-1?t?n=`precision highp float;
`+n:n=`precision mediump float;
`+n:t||(n=n.replace("precision highp float","precision mediump float")),n}function mu(n){const t=/defined\((.+)\)/.exec(n);if(t&&t.length)return new Ol(t[1].trim(),n[0]==="!");const i=["==","!=",">=","<=","<",">"];let s="",r=0;for(s of i)if(r=n.indexOf(s),r>-1)break;if(r===-1)return new Ol(n);const a=n.substring(0,r).trim(),o=n.substring(r+s.length).trim();return new VT(a,s,o)}function YT(n){n=n.replace(GT,"defined[$1]");const e=dt.infixToPostfix(n),t=[];for(const s of e)if(s!=="||"&&s!=="&&")t.push(s);else if(t.length>=2){let r=t[t.length-1],a=t[t.length-2];t.length-=2;const o=s=="&&"?new kT:new UT;typeof r=="string"&&(r=r.replace(gu,"defined($1)")),typeof a=="string"&&(a=a.replace(gu,"defined($1)")),o.leftOperand=typeof a=="string"?mu(a):a,o.rightOperand=typeof r=="string"?mu(r):r,t.push(o)}let i=t[t.length-1];return typeof i=="string"&&(i=i.replace(gu,"defined($1)")),typeof i=="string"?mu(i):i}function il(n,e){const t=new NT,i=n.substring(0,e);let s=n.substring(e);return s=s.substring(0,(s.indexOf("//")+1||s.length+1)-1).trim(),i==="#ifdef"?t.testExpression=new Ol(s):i==="#ifndef"?t.testExpression=new Ol(s,!0):t.testExpression=YT(s),t}function vu(n,e,t){let i=n.currentLine;for(;Mc(n,t);){i=n.currentLine;const s=i.substring(0,5).toLowerCase();if(s==="#else"){const r=new r0;e.children.push(r),Mc(n,r);return}else if(s==="#elif"){const r=il(i,5);e.children.push(r),t=r}}}function Mc(n,e){for(;n.canRead;){n.lineIndex++;const t=n.currentLine;if(t.indexOf("#")>=0){const s=HT.exec(t);if(s&&s.length){switch(s[0]){case"#ifdef":{const a=new pu;e.children.push(a);const o=il(t,6);a.children.push(o),vu(n,a,o);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{const a=new pu;e.children.push(a);const o=il(t,7);a.children.push(o),vu(n,a,o);break}case"#if":{const a=new pu,o=il(t,3);e.children.push(a),a.children.push(o),vu(n,a,o);break}}continue}}const i=new r0;if(i.line=t,e.children.push(i),t[0]==="#"&&t[1]==="d"){const s=t.replace(";","").split(" ");i.additionalDefineKey=s[1],s.length===3&&(i.additionalDefineValue=s[2])}}return!1}function iv(n,e,t){const i=new r0,s=new BT;return s.lineIndex=-1,s.lines=n.split(`
`),Mc(s,i),i.process(e,t)}function sv(n,e){var s;const t=n.defines,i={};for(const r of t){const o=r.replace("#define","").replace(";","").trim().split(" ");i[o[0]]=o.length>1?o[1]:""}return((s=n.processor)==null?void 0:s.shaderLanguage)===0&&(i.GL_ES="true"),i.__VERSION__=n.version,i[n.platformName]="true",$2(i,e==null?void 0:e.isNDCHalfZRange,e==null?void 0:e.useReverseDepthBuffer,e==null?void 0:e.useExactSrgbConversions),i}function jT(n,e,t){let i=XT(n,e);if(!e.processor||e.processor.shaderLanguage===0&&i.indexOf("#version 3")!==-1&&(i=i.replace("#version 300 es",""),!e.processor.parseGLES3))return i;const s=e.defines,r=sv(e,t);return e.processor.preProcessor&&(i=e.processor.preProcessor(i,s,r,e.isFragment,e.processingContext)),i=iv(i,r,e),e.processor.postProcessor&&(i=e.processor.postProcessor(i,s,e.isFragment,e.processingContext,t?{drawBuffersExtensionDisabled:!t.getCaps().drawBuffersExtension}:{})),t!=null&&t._features.needShaderCodeInlining&&(i=t.inlineShaderCode(i)),i}function qT(n,e,t){var a,o;let i=n;const s=e.defines,r=sv(e,t);return(a=e.processor)!=null&&a.preProcessor&&(i=e.processor.preProcessor(i,s,r,e.isFragment,e.processingContext)),i=iv(i,r,e),(o=e.processor)!=null&&o.postProcessor&&(i=e.processor.postProcessor(i,s,e.isFragment,e.processingContext,t?{drawBuffersExtensionDisabled:!t.getCaps().drawBuffersExtension}:{})),t._features.needShaderCodeInlining&&(i=t.inlineShaderCode(i)),i}function zo(n,e,t){F0.length=0;let i;for(;(i=zT.exec(n))!==null;)F0.push(i);let s=String(n),r=[n],a=!1;for(const o of F0){let l=o[1];if(l.indexOf("__decl__")!==-1&&(l=l.replace(WT,""),e.supportsUniformBuffers&&(l=l.replace("Vertex","Ubo").replace("Fragment","Ubo")),l=l+"Declaration"),e.includesShadersStore[l]){let h=e.includesShadersStore[l];if(o[2]){const c=o[3].split(",");for(let f=0;f<c.length;f+=2){const d=new RegExp(c[f],"g"),_=c[f+1];h=h.replace(d,_)}}if(o[4]){const c=o[5];if(c.indexOf("..")!==-1){const f=c.split(".."),d=parseInt(f[0]);let _=parseInt(f[1]),p=h.slice(0);h="",isNaN(_)&&(_=e.indexParameters[f[1]]);for(let g=d;g<_;g++)e.supportsUniformBuffers||(p=p.replace(cp,(m,v)=>v+"{X}")),h+=p.replace(fp,g.toString())+`
`}else e.supportsUniformBuffers||(h=h.replace(cp,(f,d)=>d+"{X}")),h=h.replace(fp,c)}const u=[];for(const c of r){const f=c.split(o[0]);for(let d=0;d<f.length-1;d++)u.push(f[d]),u.push(h);u.push(f[f.length-1])}r=u,a=a||h.indexOf("#include<")>=0||h.indexOf("#include <")>=0}else{const h=e.shadersRepository+"ShadersInclude/"+l+".fx";nv.loadFile(h,u=>{e.includesShadersStore[l]=u,zo(r.join(""),e,t)});return}}F0.length=0,s=r.join(""),a?zo(s.toString(),e,t):t(s)}const nv={loadFile:(n,e,t,i,s,r)=>{throw Ee("FileTools")}};function $T(n,e){return Pi(e).cachedPipelines[n]}function id(n){const e=n._name,t=n.context;if(e&&t){const i=Pi(t),s=i.cachedPipelines[e];s==null||s.dispose(),delete i.cachedPipelines[e]}}function ZT(n,e,t,i,s,r,a){let o,l;const h=zt()?r==null?void 0:r.getHostDocument():null;typeof e=="string"?o=e:e.vertexSource?o="source:"+e.vertexSource:e.vertexElement?o=(h==null?void 0:h.getElementById(e.vertexElement))||e.vertexElement:o=e.vertex||e,typeof e=="string"?l=e:e.fragmentSource?l="source:"+e.fragmentSource:e.fragmentElement?l=(h==null?void 0:h.getElementById(e.fragmentElement))||e.fragmentElement:l=e.fragment||e;const u=[void 0,void 0],c=()=>{if(u[0]&&u[1]){n.isFragment=!0;const[f,d]=u;Fl(d,n,(_,p)=>{a&&(a._fragmentSourceCodeBeforeMigration=p),t&&(_=t("fragment",_));const g=td(f,_,n);n=null;const m=QT(g.vertexCode,g.fragmentCode,e,s);i==null||i(m.vertexSourceCode,m.fragmentSourceCode)},r)}};dp(o,"Vertex","",f=>{ed(n),Fl(f,n,(d,_)=>{a&&(a._rawVertexSourceCode=f,a._vertexSourceCodeBeforeMigration=_),t&&(d=t("vertex",d)),u[0]=d,c()},r)},s),dp(l,"Fragment","Pixel",f=>{a&&(a._rawFragmentSourceCode=f),u[1]=f,c()},s)}function dp(n,e,t,i,s,r){if(typeof HTMLElement<"u"&&n instanceof HTMLElement){const l=$f(n);i(l);return}if(n.substring(0,7)==="source:"){i(n.substring(7));return}if(n.substring(0,7)==="base64:"){const l=window.atob(n.substring(7));i(l);return}const a=ye.GetShadersStore(s);if(a[n+e+"Shader"]){i(a[n+e+"Shader"]);return}if(t&&a[n+t+"Shader"]){i(a[n+t+"Shader"]);return}let o;if(n[0]==="."||n[0]==="/"||n.indexOf("http")>-1?o=n:o=ye.GetShadersRepository(s)+n,r=r||q2,!r)throw new Error("loadFileInjection is not defined");r(o+"."+e.toLowerCase()+".fx",i)}function QT(n,e,t,i){if(t){const s=t.vertexElement||t.vertex||t.spectorName||t,r=t.fragmentElement||t.fragment||t.spectorName||t;return{vertexSourceCode:(i===1?"//":"")+"#define SHADER_NAME vertex:"+s+`
`+n,fragmentSourceCode:(i===1?"//":"")+"#define SHADER_NAME fragment:"+r+`
`+e}}else return{vertexSourceCode:n,fragmentSourceCode:e}}const JT=(n,e,t,i)=>{try{const s=n.context?Pi(n.context):null;s&&(s.disableParallelShaderCompile=n.disableParallelCompilation);const r=n.existingPipelineContext||e(n.shaderProcessingContext);return r._name=n.name,n.name&&s&&(s.cachedPipelines[n.name]=r),t(r,n.vertex,n.fragment,!!n.createAsRaw,"","",n.rebuildRebind,n.defines,n.transformFeedbackVaryings,"",()=>{i(r,()=>{var a;(a=n.onRenderingStateCompiled)==null||a.call(n,r)})}),r}catch(s){throw U.Error("Error compiling effect"),s}};let L0=[];class Wo{static SetImmediate(e){L0.length===0&&setTimeout(()=>{const t=L0;L0=[];for(const i of t)i()},1),L0.push(e)}}function _p(n,e,t){try{if(n())return e(),!0}catch(i){return t==null||t(i),!0}return!1}const gh=(n,e,t,i=16,s=3e4,r=!0,a)=>{if(r&&_p(n,e,t))return null;const o=setInterval(()=>{_p(n,e,t)?clearInterval(o):(s-=i,s<0&&(clearInterval(o),t==null||t(new Error("Operation timed out after maximum retries. "+(a||"")),!0)))},i);return()=>clearInterval(o)};class Et{static get ShadersRepository(){return ye.ShadersRepository}static set ShadersRepository(e){ye.ShadersRepository=e}get isDisposed(){return this._isDisposed}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new q),this._onBindObservable}get shaderLanguage(){return this._shaderLanguage}constructor(e,t,i,s=null,r,a=null,o=null,l=null,h=null,u,c="",f=0,d){this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new q,this.onErrorObservable=new q,this._onBindObservable=null,this._isDisposed=!1,this._refCount=1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._disableParallelShaderCompilation=!1,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeBeforeMigration="",this._fragmentSourceCodeBeforeMigration="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._processCodeAfterIncludes=void 0,this._processFinalCode=null,this.name=e,this._key=c;const _=this._key.replace(/\r/g,"").replace(/\n/g,"|");let p;if(t.attributes){const g=t;if(this._engine=i,this._attributesNames=g.attributes,this._uniformsNames=g.uniformsNames.concat(g.samplers),this._samplerList=g.samplers.slice(),this.defines=g.defines,this.onError=g.onError,this.onCompiled=g.onCompiled,this._fallbacks=g.fallbacks,this._indexParameters=g.indexParameters,this._transformFeedbackVaryings=g.transformFeedbackVaryings||null,this._multiTarget=!!g.multiTarget,this._shaderLanguage=g.shaderLanguage??0,this._disableParallelShaderCompilation=!!g.disableParallelShaderCompilation,g.uniformBuffersNames){this._uniformBuffersNamesList=g.uniformBuffersNames.slice();for(let m=0;m<g.uniformBuffersNames.length;m++)this._uniformBuffersNames[g.uniformBuffersNames[m]]=m}this._processFinalCode=g.processFinalCode??null,this._processCodeAfterIncludes=g.processCodeAfterIncludes??void 0,d=g.extraInitializationsAsync,p=g.existingPipelineContext}else this._engine=r,this.defines=a??"",this._uniformsNames=i.concat(s),this._samplerList=s?s.slice():[],this._attributesNames=t,this._uniformBuffersNamesList=[],this._shaderLanguage=f,this.onError=h,this.onCompiled=l,this._indexParameters=u,this._fallbacks=o;this._engine.shaderPlatformName==="WEBGL2"&&(p=$T(_,this._engine._gl)??p),this._attributeLocationByName={},this.uniqueId=Et._UniqueIdSeed++,p?(this._pipelineContext=p,this._pipelineContext.setEngine(this._engine),this._onRenderingStateCompiled(this._pipelineContext),this._pipelineContext.program&&(this._pipelineContext.program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this))):this._processShaderCodeAsync(null,!1,null,d),this._engine.onReleaseEffectsObservable.addOnce(()=>{this.isDisposed||this.dispose(!0)})}async _processShaderCodeAsync(e=null,t=!1,i=null,s){s&&await s(),this._processingContext=i||this._engine._getShaderProcessingContext(this._shaderLanguage,!1);const r={defines:this.defines.split(`
`),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:e??this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:ye.GetShadersRepository(this._shaderLanguage),includesShadersStore:ye.GetIncludesShadersStore(this._shaderLanguage),version:(this._engine.version*100).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:this._processCodeAfterIncludes};ZT(r,this.name,this._processFinalCode,(a,o)=>{this._vertexSourceCode=a,this._fragmentSourceCode=o,this._prepareEffect(t)},this._shaderLanguage,this._engine,this)}get key(){return this._key}isReady(){try{return this._isReadyInternal()}catch{return!1}}_isReadyInternal(){return this._engine.isDisposed||this._isReady?!0:this._pipelineContext?this._pipelineContext.isReady:!1}getEngine(){return this._engine}getPipelineContext(){return this._pipelineContext}getAttributesNames(){return this._attributesNames}getAttributeLocation(e){return this._attributes[e]}getAttributeLocationByName(e){return this._attributeLocationByName[e]}getAttributesCount(){return this._attributes.length}getUniformIndex(e){return this._uniformsNames.indexOf(e)}getUniform(e){return this._uniforms[e]}getSamplers(){return this._samplerList}getUniformNames(){return this._uniformsNames}getUniformBuffersNames(){return this._uniformBuffersNamesList}getIndexParameters(){return this._indexParameters}getCompilationError(){return this._compilationError}allFallbacksProcessed(){return this._allFallbacksProcessed}whenCompiledAsync(){return new Promise(e=>{this.executeWhenCompiled(e)})}executeWhenCompiled(e){if(this.isReady()){e(this);return}this.onCompileObservable.add(t=>{e(t)}),(!this._pipelineContext||this._pipelineContext.isAsync)&&this._checkIsReady(null)}_checkIsReady(e){gh(()=>this._isReadyInternal()||this._isDisposed,()=>{},t=>{this._processCompilationErrors(t,e)},16,3e4,!0,` - Effect: ${typeof this.name=="string"?this.name:this.key}`)}get vertexSourceCode(){var e;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:((e=this._pipelineContext)==null?void 0:e._getVertexShaderCode())??this._vertexSourceCode}get fragmentSourceCode(){var e;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:((e=this._pipelineContext)==null?void 0:e._getFragmentShaderCode())??this._fragmentSourceCode}get vertexSourceCodeBeforeMigration(){return this._vertexSourceCodeBeforeMigration}get fragmentSourceCodeBeforeMigration(){return this._fragmentSourceCodeBeforeMigration}get rawVertexSourceCode(){return this._rawVertexSourceCode}get rawFragmentSourceCode(){return this._rawFragmentSourceCode}getPipelineGenerationOptions(){return{platformName:this._engine.shaderPlatformName,shaderLanguage:this._shaderLanguage,shaderNameOrContent:this.name,key:this._key,defines:this.defines.split(`
`),addGlobalDefines:!1,extendedProcessingOptions:{indexParameters:this._indexParameters,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,supportsUniformBuffers:this._engine.supportsUniformBuffers},extendedCreatePipelineOptions:{transformFeedbackVaryings:this._transformFeedbackVaryings,createAsRaw:!!(this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride)}}}_rebuildProgram(e,t,i,s){this._isReady=!1,this._vertexSourceCodeOverride=e,this._fragmentSourceCodeOverride=t,this.onError=(r,a)=>{s&&s(a)},this.onCompiled=()=>{var a,o;const r=this.getEngine().scenes;if(r)for(let l=0;l<r.length;l++)r[l].markAllMaterialsAsDirty(127);(o=(a=this._pipelineContext)._handlesSpectorRebuildCallback)==null||o.call(a,i)},this._fallbacks=null,this._prepareEffect()}_onRenderingStateCompiled(e){if(this._pipelineContext=e,this._pipelineContext.setEngine(this._engine),this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,this._attributesNames,this._attributes),this._attributesNames)for(let t=0;t<this._attributesNames.length;t++){const i=this._attributesNames[t];this._attributeLocationByName[i]=this._attributes[t]}this._engine.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh(),Et.AutomaticallyClearCodeCache&&this.clearCodeCache()}_prepareEffect(e=!1){const t=this._pipelineContext;this._isReady=!1;try{const i=!!(this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride),s=i?null:this.defines,r=i?this._vertexSourceCodeOverride:this._vertexSourceCode,a=i?this._fragmentSourceCodeOverride:this._fragmentSourceCode,o=this._engine;this._pipelineContext=JT({existingPipelineContext:e?t:null,vertex:r,fragment:a,context:o.shaderPlatformName==="WEBGL2"||o.shaderPlatformName==="WEBGL1"?o._gl:void 0,rebuildRebind:(l,h,u,c)=>this._rebuildProgram(l,h,u,c),defines:s,transformFeedbackVaryings:this._transformFeedbackVaryings,name:this._key.replace(/\r/g,"").replace(/\n/g,"|"),createAsRaw:i,disableParallelCompilation:this._disableParallelShaderCompilation,shaderProcessingContext:this._processingContext,onRenderingStateCompiled:l=>{t&&!e&&this._engine._deletePipelineContext(t),l&&this._onRenderingStateCompiled(l)}},this._engine.createPipelineContext.bind(this._engine),this._engine._preparePipelineContext.bind(this._engine),this._engine._executeWhenRenderingStateIsCompiled.bind(this._engine)),this._pipelineContext.isAsync&&this._checkIsReady(t)}catch(i){this._processCompilationErrors(i,t)}}_getShaderCodeAndErrorLine(e,t,i){const s=i?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/;let r=null;if(t&&e){const a=t.match(s);if(a&&a.length===2){const o=parseInt(a[1]),l=e.split(`
`,-1);l.length>=o&&(r=`Offending line [${o}] in ${i?"fragment":"vertex"} code: ${l[o-1]}`)}}return[e,r]}_processCompilationErrors(e,t=null){var a,o,l;this._compilationError=e.message;const i=this._attributesNames,s=this._fallbacks;if(U.Error("Unable to compile effect:"),U.Error("Uniforms: "+this._uniformsNames.map(function(h){return" "+h})),U.Error("Attributes: "+i.map(function(h){return" "+h})),U.Error(`Defines:
`+this.defines),Et.LogShaderCodeOnCompilationError){let h=null,u=null,c=null;(a=this._pipelineContext)!=null&&a._getVertexShaderCode()&&([c,h]=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),c&&(U.Error("Vertex code:"),U.Error(c))),(o=this._pipelineContext)!=null&&o._getFragmentShaderCode()&&([c,u]=this._getShaderCodeAndErrorLine((l=this._pipelineContext)==null?void 0:l._getFragmentShaderCode(),this._compilationError,!0),c&&(U.Error("Fragment code:"),U.Error(c))),h&&U.Error(h),u&&U.Error(u)}U.Error("Error: "+this._compilationError);const r=()=>{this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this._engine.onEffectErrorObservable.notifyObservers({effect:this,errors:this._compilationError})};t&&(this._pipelineContext=t,this._isReady=!0,r()),s?(this._pipelineContext=null,s.hasMoreFallbacks?(this._allFallbacksProcessed=!1,U.Error("Trying next fallback."),this.defines=s.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,r(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,t||r())}get isSupported(){return this._compilationError===""}_bindTexture(e,t){this._engine._bindTexture(this._samplers[e],t,e)}setTexture(e,t){this._engine.setTexture(this._samplers[e],this._uniforms[e],t,e)}setTextureArray(e,t){const i=e+"Ex";if(this._samplerList.indexOf(i+"0")===-1){const s=this._samplerList.indexOf(e);for(let a=1;a<t.length;a++){const o=i+(a-1).toString();this._samplerList.splice(s+a,0,o)}let r=0;for(const a of this._samplerList)this._samplers[a]=r,r+=1}this._engine.setTextureArray(this._samplers[e],this._uniforms[e],t,e)}bindUniformBuffer(e,t){const i=this._uniformBuffersNames[t];i===void 0||Et._BaseCache[i]===e&&this._engine._features.useUBOBindingCache||(Et._BaseCache[i]=e,this._engine.bindUniformBufferBase(e,i,t))}bindUniformBlock(e,t){this._engine.bindUniformBlock(this._pipelineContext,e,t)}setInt(e,t){return this._pipelineContext.setInt(e,t),this}setInt2(e,t,i){return this._pipelineContext.setInt2(e,t,i),this}setInt3(e,t,i,s){return this._pipelineContext.setInt3(e,t,i,s),this}setInt4(e,t,i,s,r){return this._pipelineContext.setInt4(e,t,i,s,r),this}setIntArray(e,t){return this._pipelineContext.setIntArray(e,t),this}setIntArray2(e,t){return this._pipelineContext.setIntArray2(e,t),this}setIntArray3(e,t){return this._pipelineContext.setIntArray3(e,t),this}setIntArray4(e,t){return this._pipelineContext.setIntArray4(e,t),this}setUInt(e,t){return this._pipelineContext.setUInt(e,t),this}setUInt2(e,t,i){return this._pipelineContext.setUInt2(e,t,i),this}setUInt3(e,t,i,s){return this._pipelineContext.setUInt3(e,t,i,s),this}setUInt4(e,t,i,s,r){return this._pipelineContext.setUInt4(e,t,i,s,r),this}setUIntArray(e,t){return this._pipelineContext.setUIntArray(e,t),this}setUIntArray2(e,t){return this._pipelineContext.setUIntArray2(e,t),this}setUIntArray3(e,t){return this._pipelineContext.setUIntArray3(e,t),this}setUIntArray4(e,t){return this._pipelineContext.setUIntArray4(e,t),this}setFloatArray(e,t){return this._pipelineContext.setArray(e,t),this}setFloatArray2(e,t){return this._pipelineContext.setArray2(e,t),this}setFloatArray3(e,t){return this._pipelineContext.setArray3(e,t),this}setFloatArray4(e,t){return this._pipelineContext.setArray4(e,t),this}setArray(e,t){return this._pipelineContext.setArray(e,t),this}setArray2(e,t){return this._pipelineContext.setArray2(e,t),this}setArray3(e,t){return this._pipelineContext.setArray3(e,t),this}setArray4(e,t){return this._pipelineContext.setArray4(e,t),this}setMatrices(e,t){return this._pipelineContext.setMatrices(e,t),this}setMatrix(e,t){return this._pipelineContext.setMatrix(e,t),this}setMatrix3x3(e,t){return this._pipelineContext.setMatrix3x3(e,t),this}setMatrix2x2(e,t){return this._pipelineContext.setMatrix2x2(e,t),this}setFloat(e,t){return this._pipelineContext.setFloat(e,t),this}setBool(e,t){return this._pipelineContext.setInt(e,t?1:0),this}setVector2(e,t){return this._pipelineContext.setVector2(e,t),this}setFloat2(e,t,i){return this._pipelineContext.setFloat2(e,t,i),this}setVector3(e,t){return this._pipelineContext.setVector3(e,t),this}setFloat3(e,t,i,s){return this._pipelineContext.setFloat3(e,t,i,s),this}setVector4(e,t){return this._pipelineContext.setVector4(e,t),this}setQuaternion(e,t){return this._pipelineContext.setQuaternion(e,t),this}setFloat4(e,t,i,s,r){return this._pipelineContext.setFloat4(e,t,i,s,r),this}setColor3(e,t){return this._pipelineContext.setColor3(e,t),this}setColor4(e,t,i){return this._pipelineContext.setColor4(e,t,i),this}setDirectColor4(e,t){return this._pipelineContext.setDirectColor4(e,t),this}clearCodeCache(){this._vertexSourceCode="",this._fragmentSourceCode="",this._fragmentSourceCodeBeforeMigration="",this._vertexSourceCodeBeforeMigration=""}dispose(e=!1){if(e)this._refCount=0;else{if(Et.PersistentMode)return;this._refCount--}this._refCount>0||this._isDisposed||(this._pipelineContext&&id(this._pipelineContext),this._engine._releaseEffect(this),this.clearCodeCache(),this._isDisposed=!0)}static RegisterShader(e,t,i,s=0){t&&(ye.GetShadersStore(s)[`${e}PixelShader`]=t),i&&(ye.GetShadersStore(s)[`${e}VertexShader`]=i)}static ResetCache(){Et._BaseCache={}}}Et.LogShaderCodeOnCompilationError=!0;Et.PersistentMode=!1;Et.AutomaticallyClearCodeCache=!1;Et._UniqueIdSeed=0;Et._BaseCache={};Et.ShadersStore=ye.ShadersStore;Et.IncludesShadersStore=ye.IncludesShadersStore;class Gt{static SetMatrixPrecision(e){if(Gt.MatrixTrackPrecisionChange=!1,e&&!Gt.MatrixUse64Bits&&Gt.MatrixTrackedMatrices)for(let t=0;t<Gt.MatrixTrackedMatrices.length;++t){const i=Gt.MatrixTrackedMatrices[t],s=i._m;i._m=new Array(16);for(let r=0;r<16;++r)i._m[r]=s[r]}Gt.MatrixUse64Bits=e,Gt.MatrixCurrentType=Gt.MatrixUse64Bits?Array:Float32Array,Gt.MatrixTrackedMatrices=null}}Gt.MatrixUse64Bits=!1;Gt.MatrixTrackPrecisionChange=!0;Gt.MatrixCurrentType=Float32Array;Gt.MatrixTrackedMatrices=[];class as{static get Now(){return zt()&&window.performance&&window.performance.now?window.performance.now():Date.now()}}class rv{constructor(e=!0){this._isDepthTestDirty=!1,this._isDepthMaskDirty=!1,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1,e&&this.reset()}get isDirty(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty||this._isFrontFaceDirty}get zOffset(){return this._zOffset}set zOffset(e){this._zOffset!==e&&(this._zOffset=e,this._isZOffsetDirty=!0)}get zOffsetUnits(){return this._zOffsetUnits}set zOffsetUnits(e){this._zOffsetUnits!==e&&(this._zOffsetUnits=e,this._isZOffsetDirty=!0)}get cullFace(){return this._cullFace}set cullFace(e){this._cullFace!==e&&(this._cullFace=e,this._isCullFaceDirty=!0)}get cull(){return this._cull}set cull(e){this._cull!==e&&(this._cull=e,this._isCullDirty=!0)}get depthFunc(){return this._depthFunc}set depthFunc(e){this._depthFunc!==e&&(this._depthFunc=e,this._isDepthFuncDirty=!0)}get depthMask(){return this._depthMask}set depthMask(e){this._depthMask!==e&&(this._depthMask=e,this._isDepthMaskDirty=!0)}get depthTest(){return this._depthTest}set depthTest(e){this._depthTest!==e&&(this._depthTest=e,this._isDepthTestDirty=!0)}get frontFace(){return this._frontFace}set frontFace(e){this._frontFace!==e&&(this._frontFace=e,this._isFrontFaceDirty=!0)}reset(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cullFace=null,this._cull=null,this._zOffset=0,this._zOffsetUnits=0,this._frontFace=null,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!0,this._isFrontFaceDirty=!1}apply(e){this.isDirty&&(this._isCullDirty&&(this.cull?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(e.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(e.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(e.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset||this.zOffsetUnits?(e.enable(e.POLYGON_OFFSET_FILL),e.polygonOffset(this.zOffset,this.zOffsetUnits)):e.disable(e.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1),this._isFrontFaceDirty&&(e.frontFace(this.frontFace),this._isFrontFaceDirty=!1))}}class av{get isDirty(){return this._isStencilTestDirty||this._isStencilMaskDirty||this._isStencilFuncDirty||this._isStencilOpDirty}get func(){return this._func}set func(e){this._func!==e&&(this._func=e,this._isStencilFuncDirty=!0)}get funcRef(){return this._funcRef}set funcRef(e){this._funcRef!==e&&(this._funcRef=e,this._isStencilFuncDirty=!0)}get funcMask(){return this._funcMask}set funcMask(e){this._funcMask!==e&&(this._funcMask=e,this._isStencilFuncDirty=!0)}get opStencilFail(){return this._opStencilFail}set opStencilFail(e){this._opStencilFail!==e&&(this._opStencilFail=e,this._isStencilOpDirty=!0)}get opDepthFail(){return this._opDepthFail}set opDepthFail(e){this._opDepthFail!==e&&(this._opDepthFail=e,this._isStencilOpDirty=!0)}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(e){this._opStencilDepthPass!==e&&(this._opStencilDepthPass=e,this._isStencilOpDirty=!0)}get mask(){return this._mask}set mask(e){this._mask!==e&&(this._mask=e,this._isStencilMaskDirty=!0)}get enabled(){return this._enabled}set enabled(e){this._enabled!==e&&(this._enabled=e,this._isStencilTestDirty=!0)}constructor(e=!0){this._isStencilTestDirty=!1,this._isStencilMaskDirty=!1,this._isStencilFuncDirty=!1,this._isStencilOpDirty=!1,this.useStencilGlobalOnly=!1,e&&this.reset()}reset(){var e;this.stencilMaterial=void 0,(e=this.stencilGlobal)==null||e.reset(),this._isStencilTestDirty=!0,this._isStencilMaskDirty=!0,this._isStencilFuncDirty=!0,this._isStencilOpDirty=!0}apply(e){var i;if(!e)return;const t=!this.useStencilGlobalOnly&&!!((i=this.stencilMaterial)!=null&&i.enabled);this.enabled=t?this.stencilMaterial.enabled:this.stencilGlobal.enabled,this.func=t?this.stencilMaterial.func:this.stencilGlobal.func,this.funcRef=t?this.stencilMaterial.funcRef:this.stencilGlobal.funcRef,this.funcMask=t?this.stencilMaterial.funcMask:this.stencilGlobal.funcMask,this.opStencilFail=t?this.stencilMaterial.opStencilFail:this.stencilGlobal.opStencilFail,this.opDepthFail=t?this.stencilMaterial.opDepthFail:this.stencilGlobal.opDepthFail,this.opStencilDepthPass=t?this.stencilMaterial.opStencilDepthPass:this.stencilGlobal.opStencilDepthPass,this.mask=t?this.stencilMaterial.mask:this.stencilGlobal.mask,this.isDirty&&(this._isStencilTestDirty&&(this.enabled?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this._isStencilTestDirty=!1),this._isStencilMaskDirty&&(e.stencilMask(this.mask),this._isStencilMaskDirty=!1),this._isStencilFuncDirty&&(e.stencilFunc(this.func,this.funcRef,this.funcMask),this._isStencilFuncDirty=!1),this._isStencilOpDirty&&(e.stencilOp(this.opStencilFail,this.opDepthFail,this.opStencilDepthPass),this._isStencilOpDirty=!1))}}class dn{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=dn.ALWAYS,this.funcRef=1,this.funcMask=255,this.opStencilFail=dn.KEEP,this.opDepthFail=dn.KEEP,this.opStencilDepthPass=dn.REPLACE}get stencilFunc(){return this.func}set stencilFunc(e){this.func=e}get stencilFuncRef(){return this.funcRef}set stencilFuncRef(e){this.funcRef=e}get stencilFuncMask(){return this.funcMask}set stencilFuncMask(e){this.funcMask=e}get stencilOpStencilFail(){return this.opStencilFail}set stencilOpStencilFail(e){this.opStencilFail=e}get stencilOpDepthFail(){return this.opDepthFail}set stencilOpDepthFail(e){this.opDepthFail=e}get stencilOpStencilDepthPass(){return this.opStencilDepthPass}set stencilOpStencilDepthPass(e){this.opStencilDepthPass=e}get stencilMask(){return this.mask}set stencilMask(e){this.mask=e}get stencilTest(){return this.enabled}set stencilTest(e){this.enabled=e}}dn.ALWAYS=519;dn.KEEP=7680;dn.REPLACE=7681;class e4{constructor(){this._blendFunctionParameters=new Array(4),this._blendEquationParameters=new Array(2),this._blendConstants=new Array(4),this._isBlendConstantsDirty=!1,this._alphaBlend=!1,this._isAlphaBlendDirty=!1,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this.reset()}get isDirty(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty||this._isBlendEquationParametersDirty}get alphaBlend(){return this._alphaBlend}set alphaBlend(e){this._alphaBlend!==e&&(this._alphaBlend=e,this._isAlphaBlendDirty=!0)}setAlphaBlendConstants(e,t,i,s){this._blendConstants[0]===e&&this._blendConstants[1]===t&&this._blendConstants[2]===i&&this._blendConstants[3]===s||(this._blendConstants[0]=e,this._blendConstants[1]=t,this._blendConstants[2]=i,this._blendConstants[3]=s,this._isBlendConstantsDirty=!0)}setAlphaBlendFunctionParameters(e,t,i,s){this._blendFunctionParameters[0]===e&&this._blendFunctionParameters[1]===t&&this._blendFunctionParameters[2]===i&&this._blendFunctionParameters[3]===s||(this._blendFunctionParameters[0]=e,this._blendFunctionParameters[1]=t,this._blendFunctionParameters[2]=i,this._blendFunctionParameters[3]=s,this._isBlendFunctionParametersDirty=!0)}setAlphaEquationParameters(e,t){this._blendEquationParameters[0]===e&&this._blendEquationParameters[1]===t||(this._blendEquationParameters[0]=e,this._blendEquationParameters[1]=t,this._isBlendEquationParametersDirty=!0)}reset(){this._alphaBlend=!1,this._blendFunctionParameters[0]=null,this._blendFunctionParameters[1]=null,this._blendFunctionParameters[2]=null,this._blendFunctionParameters[3]=null,this._blendEquationParameters[0]=null,this._blendEquationParameters[1]=null,this._blendConstants[0]=null,this._blendConstants[1]=null,this._blendConstants[2]=null,this._blendConstants[3]=null,this._isAlphaBlendDirty=!0,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1}apply(e){this.isDirty&&(this._isAlphaBlendDirty&&(this._alphaBlend?e.enable(e.BLEND):e.disable(e.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(e.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),this._isBlendFunctionParametersDirty=!1),this._isBlendEquationParametersDirty&&(e.blendEquationSeparate(this._blendEquationParameters[0],this._blendEquationParameters[1]),this._isBlendEquationParametersDirty=!1),this._isBlendConstantsDirty&&(e.blendColor(this._blendConstants[0],this._blendConstants[1],this._blendConstants[2],this._blendConstants[3]),this._isBlendConstantsDirty=!1))}}const t4="modulepreload",i4=function(n){return"/"+n},pp={},De=function(e,t,i){let s=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),o=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));s=Promise.allSettled(t.map(l=>{if(l=i4(l),l in pp)return;pp[l]=!0;const h=l.endsWith(".css"),u=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${u}`))return;const c=document.createElement("link");if(c.rel=h?"stylesheet":t4,h||(c.as="script"),c.crossOrigin="",c.href=l,o&&c.setAttribute("nonce",o),document.head.appendChild(c),h)return new Promise((f,d)=>{c.addEventListener("load",f),c.addEventListener("error",()=>d(new Error(`Unable to preload CSS for ${l}`)))})}))}function r(a){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=a,window.dispatchEvent(o),!o.defaultPrevented)throw a}return s.then(a=>{for(const o of a||[])o.status==="rejected"&&r(o.reason);return e().catch(r)})},Ll=new Map;function en(n,e){s4(n)&&U.Warn(`Extension with the name '${name}' already exists`),Ll.set(n,e)}function s4(n){return Ll.delete(n)}function n4(n,e){(e==="image/ktx"||e==="image/ktx2")&&(n=".ktx"),Ll.has(n)||(n.endsWith(".ies")&&en(".ies",()=>De(()=>import("./iesTextureLoader-CVG_gnz1.js"),[]).then(i=>new i._IESTextureLoader)),n.endsWith(".dds")&&en(".dds",()=>De(()=>import("./ddsTextureLoader-C3zeYfiC.js"),__vite__mapDeps([0,1,2])).then(i=>new i._DDSTextureLoader)),n.endsWith(".basis")&&en(".basis",()=>De(()=>import("./basisTextureLoader-Bc6zA1KU.js"),[]).then(i=>new i._BasisTextureLoader)),n.endsWith(".env")&&en(".env",()=>De(()=>import("./envTextureLoader-BMDptslG.js"),__vite__mapDeps([3,2])).then(i=>new i._ENVTextureLoader)),n.endsWith(".hdr")&&en(".hdr",()=>De(()=>import("./hdrTextureLoader-DPK2Y8dY.js"),[]).then(i=>new i._HDRTextureLoader)),(n.endsWith(".ktx")||n.endsWith(".ktx2"))&&(en(".ktx",()=>De(()=>import("./ktxTextureLoader-BFU8XYwJ.js"),[]).then(i=>new i._KTXTextureLoader)),en(".ktx2",()=>De(()=>import("./ktxTextureLoader-BFU8XYwJ.js"),[]).then(i=>new i._KTXTextureLoader))),n.endsWith(".tga")&&en(".tga",()=>De(()=>import("./tgaTextureLoader-DaMTMCNf.js"),[]).then(i=>new i._TGATextureLoader)),n.endsWith(".exr")&&en(".exr",()=>De(()=>import("./exrTextureLoader-BVfD6bOK.js"),[]).then(i=>new i._ExrTextureLoader)));const t=Ll.get(n);return t?Promise.resolve(t(e)):null}function ov(n,e){if(zt()){const{requestAnimationFrame:t}=e||window;if(typeof t=="function")return t(n)}else if(typeof requestAnimationFrame=="function")return requestAnimationFrame(n);return setTimeout(n,16)}class re{get frameId(){return this._frameId}get isWebGPU(){return this._isWebGPU}_getShaderProcessor(e){return this._shaderProcessor}get shaderPlatformName(){return this._shaderPlatformName}_clearEmptyResources(){this._emptyTexture=null,this._emptyCubeTexture=null,this._emptyTexture3D=null,this._emptyTexture2DArray=null}get useReverseDepthBuffer(){return this._useReverseDepthBuffer}set useReverseDepthBuffer(e){e!==this._useReverseDepthBuffer&&(this._useReverseDepthBuffer=e,e?this._depthCullingState.depthFunc=518:this._depthCullingState.depthFunc=515)}setColorWrite(e){e!==this._colorWrite&&(this._colorWriteChanged=!0,this._colorWrite=e)}getColorWrite(){return this._colorWrite}get depthCullingState(){return this._depthCullingState}get alphaState(){return this._alphaState}get stencilState(){return this._stencilState}get stencilStateComposer(){return this._stencilStateComposer}_getGlobalDefines(e){if(e){this.isNDCHalfZRange?e.IS_NDC_HALF_ZRANGE="":delete e.IS_NDC_HALF_ZRANGE,this.useReverseDepthBuffer?e.USE_REVERSE_DEPTHBUFFER="":delete e.USE_REVERSE_DEPTHBUFFER,this.useExactSrgbConversions?e.USE_EXACT_SRGB_CONVERSIONS="":delete e.USE_EXACT_SRGB_CONVERSIONS;return}else{let t="";return this.isNDCHalfZRange&&(t+="#define IS_NDC_HALF_ZRANGE"),this.useReverseDepthBuffer&&(t&&(t+=`
`),t+="#define USE_REVERSE_DEPTHBUFFER"),this.useExactSrgbConversions&&(t&&(t+=`
`),t+="#define USE_EXACT_SRGB_CONVERSIONS"),t}}_rebuildInternalTextures(){const e=this._internalTexturesCache.slice();for(const t of e)t._rebuild()}_rebuildRenderTargetWrappers(){const e=this._renderTargetWrapperCache.slice();for(const t of e)t._rebuild()}_rebuildEffects(){for(const e in this._compiledEffects){const t=this._compiledEffects[e];t._pipelineContext=null,t._prepareEffect()}Et.ResetCache()}_rebuildGraphicsResources(){var e;this.wipeCaches(!0),this._rebuildEffects(),(e=this._rebuildComputeEffects)==null||e.call(this),this._rebuildBuffers(),this._rebuildInternalTextures(),this._rebuildTextures(),this._rebuildRenderTargetWrappers(),this.wipeCaches(!0)}_flagContextRestored(){U.Warn(this.name+" context successfully restored."),this.onContextRestoredObservable.notifyObservers(this),this._contextWasLost=!1}_restoreEngineAfterContextLost(e){setTimeout(async()=>{this._clearEmptyResources();const t=this._depthCullingState.depthTest,i=this._depthCullingState.depthFunc,s=this._depthCullingState.depthMask,r=this._stencilState.stencilTest;await e(),this._rebuildGraphicsResources(),this._depthCullingState.depthTest=t,this._depthCullingState.depthFunc=i,this._depthCullingState.depthMask=s,this._stencilState.stencilTest=r,this._flagContextRestored()},0)}get isDisposed(){return this._isDisposed}get snapshotRendering(){return!1}set snapshotRendering(e){}get snapshotRenderingMode(){return 0}set snapshotRenderingMode(e){}getClassName(){return"AbstractEngine"}get emptyTexture(){return this._emptyTexture||(this._emptyTexture=this.createRawTexture(new Uint8Array(4),1,1,5,!1,!1,1)),this._emptyTexture}get emptyTexture3D(){return this._emptyTexture3D||(this._emptyTexture3D=this.createRawTexture3D(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture3D}get emptyTexture2DArray(){return this._emptyTexture2DArray||(this._emptyTexture2DArray=this.createRawTexture2DArray(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture2DArray}get emptyCubeTexture(){if(!this._emptyCubeTexture){const e=new Uint8Array(4),t=[e,e,e,e,e,e];this._emptyCubeTexture=this.createRawCubeTexture(t,1,5,0,!1,!1,1)}return this._emptyCubeTexture}get activeRenderLoops(){return this._activeRenderLoops}stopRenderLoop(e){if(!e){this._activeRenderLoops.length=0,this._cancelFrame();return}const t=this._activeRenderLoops.indexOf(e);t>=0&&(this._activeRenderLoops.splice(t,1),this._activeRenderLoops.length==0&&this._cancelFrame())}_cancelFrame(){if(this._frameHandler!==0){const e=this._frameHandler;if(this._frameHandler=0,zt()){const{cancelAnimationFrame:t}=this.getHostWindow()||window;if(typeof t=="function")return t(e)}else if(typeof cancelAnimationFrame=="function")return cancelAnimationFrame(e);return clearTimeout(e)}}beginFrame(){this.onBeginFrameObservable.notifyObservers(this)}endFrame(){this._frameId++,this.onEndFrameObservable.notifyObservers(this)}get maxFPS(){return this._maxFPS}set maxFPS(e){if(this._maxFPS=e,e!==void 0){if(e<=0){this._minFrameTime=Number.MAX_VALUE;return}this._minFrameTime=1e3/(e+1)}}_isOverFrameTime(e){if(!e)return!1;const t=e-this._lastFrameTime;return this._maxFPS===void 0||t>=this._minFrameTime?(this._lastFrameTime=e,!1):!0}_processFrame(e){if(this._frameHandler=0,!this._contextWasLost&&!this._isOverFrameTime(e)){let t=!0;(this.isDisposed||!this.renderEvenInBackground&&this._windowIsBackground)&&(t=!1),t&&(this.beginFrame(),!this.skipFrameRender&&!this._renderViews()&&this._renderFrame(),this.endFrame())}}_renderLoop(e){this._processFrame(e),this._activeRenderLoops.length>0&&this._frameHandler===0&&(this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()))}_renderFrame(){for(let e=0;e<this._activeRenderLoops.length;e++){const t=this._activeRenderLoops[e];t()}}_renderViews(){return!1}_queueNewFrame(e,t){return ov(e,t)}runRenderLoop(e){this._activeRenderLoops.indexOf(e)===-1&&(this._activeRenderLoops.push(e),this._activeRenderLoops.length===1&&this._frameHandler===0&&(this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow())))}getDepthBuffer(){return this._depthCullingState.depthTest}setDepthBuffer(e){this._depthCullingState.depthTest=e}setZOffset(e){this._depthCullingState.zOffset=this.useReverseDepthBuffer?-e:e}getZOffset(){const e=this._depthCullingState.zOffset;return this.useReverseDepthBuffer?-e:e}setZOffsetUnits(e){this._depthCullingState.zOffsetUnits=this.useReverseDepthBuffer?-e:e}getZOffsetUnits(){const e=this._depthCullingState.zOffsetUnits;return this.useReverseDepthBuffer?-e:e}getHostWindow(){return zt()?this._renderingCanvas&&this._renderingCanvas.ownerDocument&&this._renderingCanvas.ownerDocument.defaultView?this._renderingCanvas.ownerDocument.defaultView:window:null}get compatibilityMode(){return this._compatibilityMode}set compatibilityMode(e){this._compatibilityMode=!0}_rebuildTextures(){for(const e of this.scenes)e._rebuildTextures();for(const e of this._virtualScenes)e._rebuildTextures()}_releaseRenderTargetWrapper(e){const t=this._renderTargetWrapperCache.indexOf(e);t!==-1&&this._renderTargetWrapperCache.splice(t,1)}get currentViewport(){return this._cachedViewport}setViewport(e,t,i){const s=t||this.getRenderWidth(),r=i||this.getRenderHeight(),a=e.x||0,o=e.y||0;this._cachedViewport=e,this._viewport(a*s,o*r,s*e.width,r*e.height)}createCanvasImage(){return document.createElement("img")}createCanvasPath2D(e){return new Path2D(e)}get description(){let e=this.name+this.version;return this._caps.parallelShaderCompile&&(e+=" - Parallel shader compilation"),e}_createTextureBase(e,t,i,s,r=3,a=null,o=null,l,h,u=null,c=null,f=null,d=null,_,p,g){e=e||"";const m=e.substr(0,5)==="data:",v=e.substr(0,5)==="blob:",T=m&&e.indexOf(";base64,")!==-1,A=c||new gt(this,1);A!==c&&(A.label=e.substring(0,60));const b=e;this._transformTextureUrl&&!T&&!c&&!u&&(e=this._transformTextureUrl(e)),b!==e&&(A._originalUrl=b);const x=e.lastIndexOf(".");let E=d||(x>-1?e.substring(x).toLowerCase():"");E.indexOf("?")>-1&&(E=E.split("?")[0]);const C=n4(E,_);s&&s.addPendingData(A),A.url=e,A.generateMipMaps=!t,A.samplingMode=r,A.invertY=i,A._useSRGBBuffer=this._getUseSRGBBuffer(!!g,t),this._doNotHandleContextLost||(A._buffer=u);let I=null;a&&!c&&(I=A.onLoadedObservable.add(a)),c||this._internalTexturesCache.push(A);const D=(w,z)=>{s&&s.removePendingData(A),e===b?(I&&A.onLoadedObservable.remove(I),Ae.UseFallbackTexture&&e!==Ae.FallbackTexture&&this._createTextureBase(Ae.FallbackTexture,t,A.invertY,s,r,null,o,l,h,u,A),w=(w||"Unknown error")+(Ae.UseFallbackTexture?" - Fallback texture was used":""),A.onErrorObservable.notifyObservers({message:w,exception:z}),o&&o(w,z)):(U.Warn(`Failed to load ${e}, falling back to ${b}`),this._createTextureBase(b,t,A.invertY,s,r,a,o,l,h,u,A,f,d,_,p,g))};if(C){const w=async z=>{(await C).loadData(z,A,(W,X,he,H,G,k)=>{k?D("TextureLoader failed to load data"):l(A,E,s,{width:W,height:X},A.invertY,!he,H,()=>(G(),!1),r)},p)};u?u instanceof ArrayBuffer?w(new Uint8Array(u)):ArrayBuffer.isView(u)?w(u):o&&o("Unable to load: only ArrayBuffer or ArrayBufferView is supported",null):this._loadFile(e,z=>w(new Uint8Array(z)),void 0,s?s.offlineProvider:void 0,!0,(z,F)=>{D("Unable to load "+(z&&z.responseURL,F))})}else{const w=z=>{v&&!this._doNotHandleContextLost&&(A._buffer=z),l(A,E,s,z,A.invertY,t,!1,h,r)};!m||T?u&&(typeof u.decoding=="string"||u.close)?w(u):re._FileToolsLoadImage(e||"",w,D,s?s.offlineProvider:null,_,A.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0,this):typeof u=="string"||u instanceof ArrayBuffer||ArrayBuffer.isView(u)||u instanceof Blob?re._FileToolsLoadImage(u,w,D,s?s.offlineProvider:null,_,A.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0,this):u&&w(u)}return A}_rebuildBuffers(){for(const e of this._uniformBuffers)e._rebuildAfterContextLost()}get _shouldUseHighPrecisionShader(){return!!(this._caps.highPrecisionShaderSupported&&this._highPrecisionShadersAllowed)}getHostDocument(){return this._renderingCanvas&&this._renderingCanvas.ownerDocument?this._renderingCanvas.ownerDocument:yo()?document:null}getLoadedTexturesCache(){return this._internalTexturesCache}clearInternalTexturesCache(){this._internalTexturesCache.length=0}getCaps(){return this._caps}resetTextureCache(){for(const e in this._boundTexturesCache)Object.prototype.hasOwnProperty.call(this._boundTexturesCache,e)&&(this._boundTexturesCache[e]=null);this._currentTextureChannel=-1}get name(){return this._name}set name(e){this._name=e}static get NpmPackage(){return"babylonjs@7.54.2"}static get Version(){return"7.54.2"}getRenderingCanvas(){return this._renderingCanvas}getAudioContext(){return this._audioContext}getAudioDestination(){return this._audioDestination}setHardwareScalingLevel(e){this._hardwareScalingLevel=e,this.resize()}getHardwareScalingLevel(){return this._hardwareScalingLevel}get doNotHandleContextLost(){return this._doNotHandleContextLost}set doNotHandleContextLost(e){this._doNotHandleContextLost=e}get isStencilEnable(){return this._isStencilEnable}getCreationOptions(){return this._creationOptions}constructor(e,t,i){var a,o;this._colorWrite=!0,this._colorWriteChanged=!0,this._depthCullingState=new rv,this._stencilStateComposer=new av,this._stencilState=new dn,this._alphaState=new e4,this._alphaMode=1,this._alphaEquation=0,this._activeRequests=[],this._badOS=!1,this._badDesktopOS=!1,this._compatibilityMode=!0,this._internalTexturesCache=new Array,this._currentRenderTarget=null,this._boundTexturesCache={},this._activeChannel=0,this._currentTextureChannel=-1,this._viewportCached={x:0,y:0,z:0,w:0},this._isWebGPU=!1,this.onCanvasBlurObservable=new q,this.onCanvasFocusObservable=new q,this.onNewSceneAddedObservable=new q,this.onResizeObservable=new q,this.onCanvasPointerOutObservable=new q,this.onEffectErrorObservable=new q,this.disablePerformanceMonitorInBackground=!1,this.disableVertexArrayObjects=!1,this._frameId=0,this.hostInformation={isMobile:!1},this.isFullscreen=!1,this.enableOfflineSupport=!1,this.disableManifestCheck=!1,this.disableContextMenu=!0,this.currentRenderPassId=0,this.isPointerLock=!1,this.postProcesses=[],this.canvasTabIndex=1,this._contextWasLost=!1,this._useReverseDepthBuffer=!1,this.isNDCHalfZRange=!1,this.hasOriginBottomLeft=!0,this._renderTargetWrapperCache=new Array,this._compiledEffects={},this._isDisposed=!1,this.scenes=[],this._virtualScenes=new Array,this.onBeforeTextureInitObservable=new q,this.renderEvenInBackground=!0,this.preventCacheWipeBetweenFrames=!1,this._frameHandler=0,this._activeRenderLoops=new Array,this._windowIsBackground=!1,this._boundRenderFunction=l=>this._renderLoop(l),this._lastFrameTime=0,this.skipFrameRender=!1,this.onBeforeShaderCompilationObservable=new q,this.onAfterShaderCompilationObservable=new q,this.onBeginFrameObservable=new q,this.onEndFrameObservable=new q,this._transformTextureUrl=null,this._uniformBuffers=new Array,this._storageBuffers=new Array,this._highPrecisionShadersAllowed=!0,this.onContextLostObservable=new q,this.onContextRestoredObservable=new q,this._name="",this.premultipliedAlpha=!0,this.adaptToDeviceRatio=!1,this._lastDevicePixelRatio=1,this._doNotHandleContextLost=!1,this.cullBackFaces=null,this._renderPassNames=["main"],this._fps=60,this._deltaTime=0,this._deterministicLockstep=!1,this._lockstepMaxSteps=4,this._timeStep=1/60,this.onDisposeObservable=new q,this.onReleaseEffectsObservable=new q,Ae.Instances.push(this),this.startTime=as.Now,this._stencilStateComposer.stencilGlobal=this._stencilState,Gt.SetMatrixPrecision(!!t.useHighPrecisionMatrix),ra()&&navigator.userAgent&&(this._badOS=/iPad/i.test(navigator.userAgent)||/iPhone/i.test(navigator.userAgent),this._badDesktopOS=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)),this.adaptToDeviceRatio=i??!1,t.antialias=e??t.antialias,t.deterministicLockstep=t.deterministicLockstep??!1,t.lockstepMaxSteps=t.lockstepMaxSteps??4,t.timeStep=t.timeStep??1/60,t.stencil=t.stencil??!0,this._audioContext=((a=t.audioEngineOptions)==null?void 0:a.audioContext)??null,this._audioDestination=((o=t.audioEngineOptions)==null?void 0:o.audioDestination)??null,this.premultipliedAlpha=t.premultipliedAlpha??!0,this._doNotHandleContextLost=!!t.doNotHandleContextLost,this._isStencilEnable=!!t.stencil,this.useExactSrgbConversions=t.useExactSrgbConversions??!1;const s=zt()&&window.devicePixelRatio||1,r=t.limitDeviceRatio||s;i=i||t.adaptToDeviceRatio||!1,this._hardwareScalingLevel=i?1/Math.min(r,s):1,this._lastDevicePixelRatio=s,this._creationOptions=t}resize(e=!1){var s,r;let t,i;if(this.adaptToDeviceRatio){const a=zt()&&window.devicePixelRatio||1,o=this._lastDevicePixelRatio/a;this._lastDevicePixelRatio=a,this._hardwareScalingLevel*=o}if(zt()&&yo())if(this._renderingCanvas){const a=(r=(s=this._renderingCanvas).getBoundingClientRect)==null?void 0:r.call(s);t=this._renderingCanvas.clientWidth||(a==null?void 0:a.width)||this._renderingCanvas.width*this._hardwareScalingLevel||100,i=this._renderingCanvas.clientHeight||(a==null?void 0:a.height)||this._renderingCanvas.height*this._hardwareScalingLevel||100}else t=window.innerWidth,i=window.innerHeight;else t=this._renderingCanvas?this._renderingCanvas.width:100,i=this._renderingCanvas?this._renderingCanvas.height:100;this.setSize(t/this._hardwareScalingLevel,i/this._hardwareScalingLevel,e)}setSize(e,t,i=!1){if(!this._renderingCanvas||(e=e|0,t=t|0,!i&&this._renderingCanvas.width===e&&this._renderingCanvas.height===t))return!1;if(this._renderingCanvas.width=e,this._renderingCanvas.height=t,this.scenes){for(let s=0;s<this.scenes.length;s++){const r=this.scenes[s];for(let a=0;a<r.cameras.length;a++){const o=r.cameras[a];o._currentRenderId=0}}this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this)}return!0}createRawTexture(e,t,i,s,r,a,o,l,h,u,c){throw Ee("engine.rawTexture")}createRawCubeTexture(e,t,i,s,r,a,o,l){throw Ee("engine.rawTexture")}createRawTexture3D(e,t,i,s,r,a,o,l,h,u,c){throw Ee("engine.rawTexture")}createRawTexture2DArray(e,t,i,s,r,a,o,l,h,u,c){throw Ee("engine.rawTexture")}_sharedInit(e){this._renderingCanvas=e}_setupMobileChecks(){navigator&&navigator.userAgent&&(this._checkForMobile=()=>{const e=navigator.userAgent;this.hostInformation.isMobile=e.indexOf("Mobile")!==-1||e.indexOf("Mac")!==-1&&yo()&&"ontouchend"in document},this._checkForMobile(),zt()&&window.addEventListener("resize",this._checkForMobile))}createVideoElement(e){return document.createElement("video")}_reportDrawCall(e=1){var t;(t=this._drawCalls)==null||t.addCount(e,!1)}getFps(){return this._fps}getDeltaTime(){return this._deltaTime}isDeterministicLockStep(){return this._deterministicLockstep}getLockstepMaxSteps(){return this._lockstepMaxSteps}getTimeStep(){return this._timeStep*1e3}_createImageBitmapFromSource(e,t){throw new Error("createImageBitmapFromSource is not implemented")}createImageBitmap(e,t){return createImageBitmap(e,t)}resizeImageBitmap(e,t,i){throw new Error("resizeImageBitmap is not implemented")}getFontOffset(e){throw new Error("getFontOffset is not implemented")}static _CreateCanvas(e,t){if(typeof document>"u")return new OffscreenCanvas(e,t);const i=document.createElement("canvas");return i.width=e,i.height=t,i}createCanvas(e,t){return re._CreateCanvas(e,t)}static _FileToolsLoadImage(e,t,i,s,r,a,o){throw Ee("FileTools")}_loadFile(e,t,i,s,r,a){const o=q2(e,t,i,s,r,a);return this._activeRequests.push(o),o.onCompleteObservable.add(()=>{const l=this._activeRequests.indexOf(o);l!==-1&&this._activeRequests.splice(l,1)}),o}static _FileToolsLoadFile(e,t,i,s,r,a){if(Dl.loadFile)return Dl.loadFile(e,t,i,s,r,a);throw Ee("FileTools")}dispose(){var t;for(this.releaseEffects(),this._isDisposed=!0,this.stopRenderLoop(),this._emptyTexture&&(this._releaseTexture(this._emptyTexture),this._emptyTexture=null),this._emptyCubeTexture&&(this._releaseTexture(this._emptyCubeTexture),this._emptyCubeTexture=null),this._renderingCanvas=null,this.onBeforeTextureInitObservable&&this.onBeforeTextureInitObservable.clear();this.postProcesses.length;)this.postProcesses[0].dispose();for(;this.scenes.length;)this.scenes[0].dispose();for(;this._virtualScenes.length;)this._virtualScenes[0].dispose();(t=this.releaseComputeEffects)==null||t.call(this),Et.ResetCache();for(const i of this._activeRequests)i.abort();this._boundRenderFunction=null,this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onResizeObservable.clear(),this.onCanvasBlurObservable.clear(),this.onCanvasFocusObservable.clear(),this.onCanvasPointerOutObservable.clear(),this.onNewSceneAddedObservable.clear(),this.onEffectErrorObservable.clear(),zt()&&window.removeEventListener("resize",this._checkForMobile);const e=Ae.Instances.indexOf(this);e>=0&&Ae.Instances.splice(e,1),Ae.Instances.length||(Ae.OnEnginesDisposedObservable.notifyObservers(this),Ae.OnEnginesDisposedObservable.clear()),this.onBeginFrameObservable.clear(),this.onEndFrameObservable.clear()}static DefaultLoadingScreenFactory(e){throw Ee("LoadingScreen")}static MarkAllMaterialsAsDirty(e,t){for(let i=0;i<Ae.Instances.length;i++){const s=Ae.Instances[i];for(let r=0;r<s.scenes.length;r++)s.scenes[r].markAllMaterialsAsDirty(e,t)}}}re._RenderPassIdCounter=0;re._RescalePostProcessFactory=null;re.CollisionsEpsilon=.001;re.QueueNewFrame=ov;class lv{get underlyingResource(){return this._webGLTexture}constructor(e=null,t){if(this._MSAARenderBuffers=null,this._context=t,!e&&(e=t.createTexture(),!e))throw new Error("Unable to create webGL texture");this.set(e)}setUsage(){}set(e){this._webGLTexture=e}reset(){this._webGLTexture=null,this._MSAARenderBuffers=null}addMSAARenderBuffer(e){this._MSAARenderBuffers||(this._MSAARenderBuffers=[]),this._MSAARenderBuffers.push(e)}releaseMSAARenderBuffers(){if(this._MSAARenderBuffers){for(const e of this._MSAARenderBuffers)this._context.deleteRenderbuffer(e);this._MSAARenderBuffers=null}}getMSAARenderBuffer(e=0){var t;return((t=this._MSAARenderBuffers)==null?void 0:t[e])??null}release(){this.releaseMSAARenderBuffers(),this._webGLTexture&&this._context.deleteTexture(this._webGLTexture),this.reset()}}function gp(n){return n===13||n===14||n===15||n===16||n===17||n===18||n===19}function r4(n){switch(n){case 13:case 17:case 18:case 14:case 16:return 1;case 15:return 5;case 19:return 0}return 0}function Ia(n){return n===13||n===17||n===18||n===19}class a4{}class Fe extends re{get name(){return this._name}set name(e){this._name=e}get version(){return this._webGLVersion}static get ShadersRepository(){return Et.ShadersRepository}static set ShadersRepository(e){Et.ShadersRepository=e}get supportsUniformBuffers(){return this.webGLVersion>1&&!this.disableUniformBuffers}get needPOTTextures(){return this._webGLVersion<2||this.forcePOTTextures}get _supportsHardwareTextureRescaling(){return!1}set framebufferDimensionsObject(e){this._framebufferDimensionsObject=e}snapshotRenderingReset(){this.snapshotRendering=!1}constructor(e,t,i,s){if(i=i||{},super(t??i.antialias,i,s),this._name="WebGL",this.forcePOTTextures=!1,this.validateShaderPrograms=!1,this.disableUniformBuffers=!1,this._webGLVersion=1,this._vertexAttribArraysEnabled=[],this._uintIndicesCurrentlySet=!1,this._currentBoundBuffer=new Array,this._currentFramebuffer=null,this._dummyFramebuffer=null,this._currentBufferPointers=new Array,this._currentInstanceLocations=new Array,this._currentInstanceBuffers=new Array,this._vaoRecordInProgress=!1,this._mustWipeVertexAttributes=!1,this._nextFreeTextureSlots=new Array,this._maxSimultaneousTextures=0,this._maxMSAASamplesOverride=null,this._unpackFlipYCached=null,this.enableUnpackFlipYCached=!0,this._boundUniforms={},!e)return;let r=null;if(e.getContext){if(r=e,i.preserveDrawingBuffer===void 0&&(i.preserveDrawingBuffer=!1),i.xrCompatible===void 0&&(i.xrCompatible=!1),navigator&&navigator.userAgent){this._setupMobileChecks();const l=navigator.userAgent;for(const h of Fe.ExceptionList){const u=h.key,c=h.targets;if(new RegExp(u).test(l)){if(h.capture&&h.captureConstraint){const d=h.capture,_=h.captureConstraint,g=new RegExp(d).exec(l);if(g&&g.length>0&&parseInt(g[g.length-1])>=_)continue}for(const d of c)switch(d){case"uniformBuffer":this.disableUniformBuffers=!0;break;case"vao":this.disableVertexArrayObjects=!0;break;case"antialias":i.antialias=!1;break;case"maxMSAASamples":this._maxMSAASamplesOverride=1;break}}}}if(this._doNotHandleContextLost?this._onContextLost=()=>{_u(this._gl)}:(this._onContextLost=l=>{l.preventDefault(),this._contextWasLost=!0,_u(this._gl),U.Warn("WebGL context lost."),this.onContextLostObservable.notifyObservers(this)},this._onContextRestored=()=>{this._restoreEngineAfterContextLost(()=>this._initGLContext())},r.addEventListener("webglcontextrestored",this._onContextRestored,!1),i.powerPreference=i.powerPreference||"high-performance"),r.addEventListener("webglcontextlost",this._onContextLost,!1),this._badDesktopOS&&(i.xrCompatible=!1),!i.disableWebGL2Support)try{this._gl=r.getContext("webgl2",i)||r.getContext("experimental-webgl2",i),this._gl&&(this._webGLVersion=2,this._shaderPlatformName="WEBGL2",this._gl.deleteQuery||(this._webGLVersion=1,this._shaderPlatformName="WEBGL1"))}catch{}if(!this._gl){if(!r)throw new Error("The provided canvas is null or undefined.");try{this._gl=r.getContext("webgl",i)||r.getContext("experimental-webgl",i)}catch{throw new Error("WebGL not supported")}}if(!this._gl)throw new Error("WebGL not supported")}else{this._gl=e,r=this._gl.canvas,this._gl.renderbufferStorageMultisample?(this._webGLVersion=2,this._shaderPlatformName="WEBGL2"):this._shaderPlatformName="WEBGL1";const l=this._gl.getContextAttributes();l&&(i.stencil=l.stencil)}this._sharedInit(r),this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),i.useHighPrecisionFloats!==void 0&&(this._highPrecisionShadersAllowed=i.useHighPrecisionFloats),this.resize(),this._initGLContext(),this._initFeatures();for(let l=0;l<this._caps.maxVertexAttribs;l++)this._currentBufferPointers[l]=new a4;this._shaderProcessor=this.webGLVersion>1?new OT:new wT;const a=`Babylon.js v${Fe.Version}`;U.Log(a+` - ${this.description}`),this._renderingCanvas&&this._renderingCanvas.setAttribute&&this._renderingCanvas.setAttribute("data-engine",a);const o=Pi(this._gl);o.validateShaderPrograms=this.validateShaderPrograms,o.parallelShaderCompile=this._caps.parallelShaderCompile}_clearEmptyResources(){this._dummyFramebuffer=null,super._clearEmptyResources()}_getShaderProcessingContext(e){return null}areAllEffectsReady(){for(const e in this._compiledEffects)if(!this._compiledEffects[e].isReady())return!1;return!0}_initGLContext(){this._caps={maxTexturesImageUnits:this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),maxCombinedTexturesImageUnits:this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxTextureSize:this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),maxSamples:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_SAMPLES):1,maxCubemapTextureSize:this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),maxRenderTextureSize:this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),maxVertexAttribs:this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS),maxVaryingVectors:this._gl.getParameter(this._gl.MAX_VARYING_VECTORS),maxFragmentUniformVectors:this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS),maxVertexUniformVectors:this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS),parallelShaderCompile:this._gl.getExtension("KHR_parallel_shader_compile")||void 0,standardDerivatives:this._webGLVersion>1||this._gl.getExtension("OES_standard_derivatives")!==null,maxAnisotropy:1,astc:this._gl.getExtension("WEBGL_compressed_texture_astc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),bptc:this._gl.getExtension("EXT_texture_compression_bptc")||this._gl.getExtension("WEBKIT_EXT_texture_compression_bptc"),s3tc:this._gl.getExtension("WEBGL_compressed_texture_s3tc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),s3tc_srgb:this._gl.getExtension("WEBGL_compressed_texture_s3tc_srgb")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc_srgb"),pvrtc:this._gl.getExtension("WEBGL_compressed_texture_pvrtc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:this._gl.getExtension("WEBGL_compressed_texture_etc1")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),etc2:this._gl.getExtension("WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBGL_compressed_texture_es3_0"),textureAnisotropicFilterExtension:this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),uintIndices:this._webGLVersion>1||this._gl.getExtension("OES_element_index_uint")!==null,fragmentDepthSupported:this._webGLVersion>1||this._gl.getExtension("EXT_frag_depth")!==null,highPrecisionShaderSupported:!1,timerQuery:this._gl.getExtension("EXT_disjoint_timer_query_webgl2")||this._gl.getExtension("EXT_disjoint_timer_query"),supportOcclusionQuery:this._webGLVersion>1,canUseTimestampForTimerQuery:!1,drawBuffersExtension:!1,maxMSAASamples:1,colorBufferFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_float")),supportFloatTexturesResolve:!1,rg11b10ufColorRenderable:!1,colorBufferHalfFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_half_float")),textureFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_float")),textureHalfFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_half_float")),textureHalfFloatRender:!1,textureFloatLinearFiltering:!1,textureFloatRender:!1,textureHalfFloatLinearFiltering:!1,vertexArrayObject:!1,instancedArrays:!1,textureLOD:!!(this._webGLVersion>1||this._gl.getExtension("EXT_shader_texture_lod")),texelFetch:this._webGLVersion!==1,blendMinMax:!1,multiview:this._gl.getExtension("OVR_multiview2"),oculusMultiview:this._gl.getExtension("OCULUS_multiview"),depthTextureExtension:!1,canUseGLInstanceID:this._webGLVersion>1,canUseGLVertexID:this._webGLVersion>1,supportComputeShaders:!1,supportSRGBBuffers:!1,supportTransformFeedbacks:this._webGLVersion>1,textureMaxLevel:this._webGLVersion>1,texture2DArrayMaxLayerCount:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_ARRAY_TEXTURE_LAYERS):128,disableMorphTargetTexture:!1,textureNorm16:!!this._gl.getExtension("EXT_texture_norm16")},this._caps.supportFloatTexturesResolve=this._caps.colorBufferFloat,this._caps.rg11b10ufColorRenderable=this._caps.colorBufferFloat,this._glVersion=this._gl.getParameter(this._gl.VERSION);const e=this._gl.getExtension("WEBGL_debug_renderer_info");if(e!=null&&(this._glRenderer=this._gl.getParameter(e.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(e.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor=this._gl.getParameter(this._gl.VENDOR)||"Unknown vendor"),this._glRenderer||(this._glRenderer=this._gl.getParameter(this._gl.RENDERER)||"Unknown renderer"),this._gl.HALF_FLOAT_OES!==36193&&(this._gl.HALF_FLOAT_OES=36193),this._gl.RGBA16F!==34842&&(this._gl.RGBA16F=34842),this._gl.RGBA32F!==34836&&(this._gl.RGBA32F=34836),this._gl.DEPTH24_STENCIL8!==35056&&(this._gl.DEPTH24_STENCIL8=35056),this._caps.timerQuery&&(this._webGLVersion===1&&(this._gl.getQuery=this._caps.timerQuery.getQueryEXT.bind(this._caps.timerQuery)),this._caps.canUseTimestampForTimerQuery=(this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT,this._caps.timerQuery.QUERY_COUNTER_BITS_EXT)??0)>0),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.textureFloatLinearFiltering=!!(this._caps.textureFloat&&this._gl.getExtension("OES_texture_float_linear")),this._caps.textureFloatRender=!!(this._caps.textureFloat&&this._canRenderToFloatFramebuffer()),this._caps.textureHalfFloatLinearFiltering=!!(this._webGLVersion>1||this._caps.textureHalfFloat&&this._gl.getExtension("OES_texture_half_float_linear")),this._caps.textureNorm16&&(this._gl.R16_EXT=33322,this._gl.RG16_EXT=33324,this._gl.RGB16_EXT=32852,this._gl.RGBA16_EXT=32859,this._gl.R16_SNORM_EXT=36760,this._gl.RG16_SNORM_EXT=36761,this._gl.RGB16_SNORM_EXT=36762,this._gl.RGBA16_SNORM_EXT=36763),this._caps.astc&&(this._gl.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=this._caps.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR),this._caps.bptc&&(this._gl.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=this._caps.bptc.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT),this._caps.s3tc_srgb&&(this._gl.COMPRESSED_SRGB_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT),this._caps.etc2&&(this._gl.COMPRESSED_SRGB8_ETC2=this._caps.etc2.COMPRESSED_SRGB8_ETC2,this._gl.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=this._caps.etc2.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC),this._webGLVersion>1&&this._gl.HALF_FLOAT_OES!==5131&&(this._gl.HALF_FLOAT_OES=5131),this._caps.textureHalfFloatRender=this._caps.textureHalfFloat&&this._canRenderToHalfFloatFramebuffer(),this._webGLVersion>1)this._caps.drawBuffersExtension=!0,this._caps.maxMSAASamples=this._maxMSAASamplesOverride!==null?this._maxMSAASamplesOverride:this._gl.getParameter(this._gl.MAX_SAMPLES),this._caps.maxDrawBuffers=this._gl.getParameter(this._gl.MAX_DRAW_BUFFERS);else{const t=this._gl.getExtension("WEBGL_draw_buffers");if(t!==null){this._caps.drawBuffersExtension=!0,this._gl.drawBuffers=t.drawBuffersWEBGL.bind(t),this._caps.maxDrawBuffers=this._gl.getParameter(t.MAX_DRAW_BUFFERS_WEBGL),this._gl.DRAW_FRAMEBUFFER=this._gl.FRAMEBUFFER;for(let i=0;i<16;i++)this._gl["COLOR_ATTACHMENT"+i+"_WEBGL"]=t["COLOR_ATTACHMENT"+i+"_WEBGL"]}}if(this._webGLVersion>1)this._caps.depthTextureExtension=!0;else{const t=this._gl.getExtension("WEBGL_depth_texture");t!=null&&(this._caps.depthTextureExtension=!0,this._gl.UNSIGNED_INT_24_8=t.UNSIGNED_INT_24_8_WEBGL)}if(this.disableVertexArrayObjects)this._caps.vertexArrayObject=!1;else if(this._webGLVersion>1)this._caps.vertexArrayObject=!0;else{const t=this._gl.getExtension("OES_vertex_array_object");t!=null&&(this._caps.vertexArrayObject=!0,this._gl.createVertexArray=t.createVertexArrayOES.bind(t),this._gl.bindVertexArray=t.bindVertexArrayOES.bind(t),this._gl.deleteVertexArray=t.deleteVertexArrayOES.bind(t))}if(this._webGLVersion>1)this._caps.instancedArrays=!0;else{const t=this._gl.getExtension("ANGLE_instanced_arrays");t!=null?(this._caps.instancedArrays=!0,this._gl.drawArraysInstanced=t.drawArraysInstancedANGLE.bind(t),this._gl.drawElementsInstanced=t.drawElementsInstancedANGLE.bind(t),this._gl.vertexAttribDivisor=t.vertexAttribDivisorANGLE.bind(t)):this._caps.instancedArrays=!1}if(this._gl.getShaderPrecisionFormat){const t=this._gl.getShaderPrecisionFormat(this._gl.VERTEX_SHADER,this._gl.HIGH_FLOAT),i=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);t&&i&&(this._caps.highPrecisionShaderSupported=t.precision!==0&&i.precision!==0)}if(this._webGLVersion>1)this._caps.blendMinMax=!0;else{const t=this._gl.getExtension("EXT_blend_minmax");t!=null&&(this._caps.blendMinMax=!0,this._gl.MAX=t.MAX_EXT,this._gl.MIN=t.MIN_EXT)}if(!this._caps.supportSRGBBuffers){if(this._webGLVersion>1)this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={SRGB:WebGL2RenderingContext.SRGB,SRGB8:WebGL2RenderingContext.SRGB8,SRGB8_ALPHA8:WebGL2RenderingContext.SRGB8_ALPHA8};else{const t=this._gl.getExtension("EXT_sRGB");t!=null&&(this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={SRGB:t.SRGB_EXT,SRGB8:t.SRGB_ALPHA_EXT,SRGB8_ALPHA8:t.SRGB_ALPHA_EXT})}if(this._creationOptions){const t=this._creationOptions.forceSRGBBufferSupportState;t!==void 0&&(this._caps.supportSRGBBuffers=this._caps.supportSRGBBuffers&&t)}}this._depthCullingState.depthTest=!0,this._depthCullingState.depthFunc=this._gl.LEQUAL,this._depthCullingState.depthMask=!0,this._maxSimultaneousTextures=this._caps.maxCombinedTexturesImageUnits;for(let t=0;t<this._maxSimultaneousTextures;t++)this._nextFreeTextureSlots.push(t);this._glRenderer==="Mali-G72"&&(this._caps.disableMorphTargetTexture=!0)}_initFeatures(){this._features={forceBitmapOverHTMLImageElement:typeof HTMLImageElement>"u",supportRenderAndCopyToLodForFloatTextures:this._webGLVersion!==1,supportDepthStencilTexture:this._webGLVersion!==1,supportShadowSamplers:this._webGLVersion!==1,uniformBufferHardCheckMatrix:!1,allowTexturePrefiltering:this._webGLVersion!==1,trackUbosInFrame:!1,checkUbosContentBeforeUpload:!1,supportCSM:this._webGLVersion!==1,basisNeedsPOT:this._webGLVersion===1,support3DTextures:this._webGLVersion!==1,needTypeSuffixInShaderConstants:this._webGLVersion!==1,supportMSAA:this._webGLVersion!==1,supportSSAO2:this._webGLVersion!==1,supportIBLShadows:this._webGLVersion!==1,supportExtendedTextureFormats:this._webGLVersion!==1,supportSwitchCaseInShader:this._webGLVersion!==1,supportSyncTextureRead:!0,needsInvertingBitmap:!0,useUBOBindingCache:!0,needShaderCodeInlining:!1,needToAlwaysBindUniformBuffers:!1,supportRenderPasses:!1,supportSpriteInstancing:!0,forceVertexBufferStrideAndOffsetMultiple4Bytes:!1,_checkNonFloatVertexBuffersDontRecreatePipelineContext:!1,_collectUbosUpdatedInFrame:!1}}get webGLVersion(){return this._webGLVersion}getClassName(){return"ThinEngine"}_prepareWorkingCanvas(){if(this._workingCanvas)return;this._workingCanvas=this.createCanvas(1,1);const e=this._workingCanvas.getContext("2d");e&&(this._workingContext=e)}getInfo(){return this.getGlInfo()}getGlInfo(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}}extractDriverInfo(){const e=this.getGlInfo();return e&&e.renderer?e.renderer:""}getRenderWidth(e=!1){return!e&&this._currentRenderTarget?this._currentRenderTarget.width:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferWidth:this._gl.drawingBufferWidth}getRenderHeight(e=!1){return!e&&this._currentRenderTarget?this._currentRenderTarget.height:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferHeight:this._gl.drawingBufferHeight}clear(e,t,i,s=!1){var o,l;const r=this.stencilStateComposer.useStencilGlobalOnly;this.stencilStateComposer.useStencilGlobalOnly=!0,this.applyStates(),this.stencilStateComposer.useStencilGlobalOnly=r;let a=0;if(t&&e){let h=!0;if(this._currentRenderTarget){const u=(o=this._currentRenderTarget.texture)==null?void 0:o.format;if(u===8||u===9||u===10||u===11){const c=(l=this._currentRenderTarget.texture)==null?void 0:l.type;c===7||c===5?(Fe._TempClearColorUint32[0]=e.r*255,Fe._TempClearColorUint32[1]=e.g*255,Fe._TempClearColorUint32[2]=e.b*255,Fe._TempClearColorUint32[3]=e.a*255,this._gl.clearBufferuiv(this._gl.COLOR,0,Fe._TempClearColorUint32),h=!1):(Fe._TempClearColorInt32[0]=e.r*255,Fe._TempClearColorInt32[1]=e.g*255,Fe._TempClearColorInt32[2]=e.b*255,Fe._TempClearColorInt32[3]=e.a*255,this._gl.clearBufferiv(this._gl.COLOR,0,Fe._TempClearColorInt32),h=!1)}}h&&(this._gl.clearColor(e.r,e.g,e.b,e.a!==void 0?e.a:1),a|=this._gl.COLOR_BUFFER_BIT)}i&&(this.useReverseDepthBuffer?(this._depthCullingState.depthFunc=this._gl.GEQUAL,this._gl.clearDepth(0)):this._gl.clearDepth(1),a|=this._gl.DEPTH_BUFFER_BIT),s&&(this._gl.clearStencil(0),a|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(a)}_viewport(e,t,i,s){(e!==this._viewportCached.x||t!==this._viewportCached.y||i!==this._viewportCached.z||s!==this._viewportCached.w)&&(this._viewportCached.x=e,this._viewportCached.y=t,this._viewportCached.z=i,this._viewportCached.w=s,this._gl.viewport(e,t,i,s))}endFrame(){super.endFrame(),this._badOS&&this.flushFramebuffer()}get performanceMonitor(){throw new Error("Not Supported by ThinEngine")}bindFramebuffer(e,t=0,i,s,r,a=0,o=0){var c,f,d,_,p,g;const l=e;this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=e,this._bindUnboundFramebuffer(l._framebuffer);const h=this._gl;e.isMulti||(e.is2DArray||e.is3D?(h.framebufferTextureLayer(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,(c=e.texture._hardwareTexture)==null?void 0:c.underlyingResource,a,o),l._currentLOD=a):e.isCube?h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_CUBE_MAP_POSITIVE_X+t,(f=e.texture._hardwareTexture)==null?void 0:f.underlyingResource,a):l._currentLOD!==a&&(h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,(d=e.texture._hardwareTexture)==null?void 0:d.underlyingResource,a),l._currentLOD=a));const u=e._depthStencilTexture;if(u){e.is3D&&(e.texture.width!==u.width||e.texture.height!==u.height||e.texture.depth!==u.depth)&&U.Warn("Depth/Stencil attachment for 3D target must have same dimensions as color attachment");const m=e._depthStencilTextureWithStencil?h.DEPTH_STENCIL_ATTACHMENT:h.DEPTH_ATTACHMENT;e.is2DArray||e.is3D?h.framebufferTextureLayer(h.FRAMEBUFFER,m,(_=u._hardwareTexture)==null?void 0:_.underlyingResource,a,o):e.isCube?h.framebufferTexture2D(h.FRAMEBUFFER,m,h.TEXTURE_CUBE_MAP_POSITIVE_X+t,(p=u._hardwareTexture)==null?void 0:p.underlyingResource,a):h.framebufferTexture2D(h.FRAMEBUFFER,m,h.TEXTURE_2D,(g=u._hardwareTexture)==null?void 0:g.underlyingResource,a)}l._MSAAFramebuffer&&this._bindUnboundFramebuffer(l._MSAAFramebuffer),this._cachedViewport&&!r?this.setViewport(this._cachedViewport,i,s):(i||(i=e.width,a&&(i=i/Math.pow(2,a))),s||(s=e.height,a&&(s=s/Math.pow(2,a))),this._viewport(0,0,i,s)),this.wipeCaches()}setStateCullFaceType(e,t){const i=this.cullBackFaces??e??!0?this._gl.BACK:this._gl.FRONT;(this._depthCullingState.cullFace!==i||t)&&(this._depthCullingState.cullFace=i)}setState(e,t=0,i,s=!1,r,a,o=0){(this._depthCullingState.cull!==e||i)&&(this._depthCullingState.cull=e),this.setStateCullFaceType(r,i),this.setZOffset(t),this.setZOffsetUnits(o);const l=s?this._gl.CW:this._gl.CCW;(this._depthCullingState.frontFace!==l||i)&&(this._depthCullingState.frontFace=l),this._stencilStateComposer.stencilMaterial=a}_bindUnboundFramebuffer(e){this._currentFramebuffer!==e&&(this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,e),this._currentFramebuffer=e)}_currentFrameBufferIsDefaultFrameBuffer(){return this._currentFramebuffer===null}generateMipmaps(e){const t=this._getTextureTarget(e);this._bindTextureDirectly(t,e,!0),this._gl.generateMipmap(t),this._bindTextureDirectly(t,null)}unBindFramebuffer(e,t=!1,i){const s=e;this._currentRenderTarget=null,s.disableAutomaticMSAAResolve||(e.isMulti?this.resolveMultiFramebuffer(e):this.resolveFramebuffer(e)),t||(e.isMulti?this.generateMipMapsMultiFramebuffer(e):this.generateMipMapsFramebuffer(e)),i&&(s._MSAAFramebuffer&&this._bindUnboundFramebuffer(s._framebuffer),i()),this._bindUnboundFramebuffer(null)}generateMipMapsFramebuffer(e){var t;!e.isMulti&&((t=e.texture)!=null&&t.generateMipMaps)&&!e.isCube&&this.generateMipmaps(e.texture)}resolveFramebuffer(e){const t=e,i=this._gl;if(!t._MSAAFramebuffer||t.isMulti)return;let s=t.resolveMSAAColors?i.COLOR_BUFFER_BIT:0;s|=t._generateDepthBuffer&&t.resolveMSAADepth?i.DEPTH_BUFFER_BIT:0,s|=t._generateStencilBuffer&&t.resolveMSAAStencil?i.STENCIL_BUFFER_BIT:0,i.bindFramebuffer(i.READ_FRAMEBUFFER,t._MSAAFramebuffer),i.bindFramebuffer(i.DRAW_FRAMEBUFFER,t._framebuffer),i.blitFramebuffer(0,0,e.width,e.height,0,0,e.width,e.height,s,i.NEAREST)}flushFramebuffer(){this._gl.flush()}restoreDefaultFramebuffer(){this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this._bindUnboundFramebuffer(null),this._cachedViewport&&this.setViewport(this._cachedViewport),this.wipeCaches()}_resetVertexBufferBinding(){this.bindArrayBuffer(null),this._cachedVertexBuffers=null}createVertexBuffer(e,t,i){return this._createVertexBuffer(e,this._gl.STATIC_DRAW)}_createVertexBuffer(e,t){const i=this._gl.createBuffer();if(!i)throw new Error("Unable to create vertex buffer");const s=new Vo(i);return this.bindArrayBuffer(s),typeof e!="number"?e instanceof Array?(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(e),t),s.capacity=e.length*4):(this._gl.bufferData(this._gl.ARRAY_BUFFER,e,t),s.capacity=e.byteLength):(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Uint8Array(e),t),s.capacity=e),this._resetVertexBufferBinding(),s.references=1,s}createDynamicVertexBuffer(e,t){return this._createVertexBuffer(e,this._gl.DYNAMIC_DRAW)}_resetIndexBufferBinding(){this.bindIndexBuffer(null),this._cachedIndexBuffer=null}createIndexBuffer(e,t,i){const s=this._gl.createBuffer(),r=new Vo(s);if(!s)throw new Error("Unable to create index buffer");this.bindIndexBuffer(r);const a=this._normalizeIndexData(e);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,a,t?this._gl.DYNAMIC_DRAW:this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),r.references=1,r.is32Bits=a.BYTES_PER_ELEMENT===4,r}_normalizeIndexData(e){if(e.BYTES_PER_ELEMENT===2)return e;if(this._caps.uintIndices){if(e instanceof Uint32Array)return e;for(let i=0;i<e.length;i++)if(e[i]>=65535)return new Uint32Array(e);return new Uint16Array(e)}return new Uint16Array(e)}bindArrayBuffer(e){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(e,this._gl.ARRAY_BUFFER)}bindUniformBlock(e,t,i){const s=e.program,r=this._gl.getUniformBlockIndex(s,t);this._gl.uniformBlockBinding(s,r,i)}bindIndexBuffer(e){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(e,this._gl.ELEMENT_ARRAY_BUFFER)}_bindBuffer(e,t){(this._vaoRecordInProgress||this._currentBoundBuffer[t]!==e)&&(this._gl.bindBuffer(t,e?e.underlyingResource:null),this._currentBoundBuffer[t]=e)}updateArrayBuffer(e){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,e)}_vertexAttribPointer(e,t,i,s,r,a,o){const l=this._currentBufferPointers[t];if(!l)return;let h=!1;l.active?(l.buffer!==e&&(l.buffer=e,h=!0),l.size!==i&&(l.size=i,h=!0),l.type!==s&&(l.type=s,h=!0),l.normalized!==r&&(l.normalized=r,h=!0),l.stride!==a&&(l.stride=a,h=!0),l.offset!==o&&(l.offset=o,h=!0)):(h=!0,l.active=!0,l.index=t,l.size=i,l.type=s,l.normalized=r,l.stride=a,l.offset=o,l.buffer=e),(h||this._vaoRecordInProgress)&&(this.bindArrayBuffer(e),s===this._gl.UNSIGNED_INT||s===this._gl.INT?this._gl.vertexAttribIPointer(t,i,s,a,o):this._gl.vertexAttribPointer(t,i,s,r,a,o))}_bindIndexBufferWithCache(e){e!=null&&this._cachedIndexBuffer!==e&&(this._cachedIndexBuffer=e,this.bindIndexBuffer(e),this._uintIndicesCurrentlySet=e.is32Bits)}_bindVertexBuffersAttributes(e,t,i){const s=t.getAttributesNames();this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.unbindAllAttributes();for(let r=0;r<s.length;r++){const a=t.getAttributeLocation(r);if(a>=0){const o=s[r];let l=null;if(i&&(l=i[o]),l||(l=e[o]),!l)continue;this._gl.enableVertexAttribArray(a),this._vaoRecordInProgress||(this._vertexAttribArraysEnabled[a]=!0);const h=l.getBuffer();h&&(this._vertexAttribPointer(h,a,l.getSize(),l.type,l.normalized,l.byteStride,l.byteOffset),l.getIsInstanced()&&(this._gl.vertexAttribDivisor(a,l.getInstanceDivisor()),this._vaoRecordInProgress||(this._currentInstanceLocations.push(a),this._currentInstanceBuffers.push(h))))}}}recordVertexArrayObject(e,t,i,s){const r=this._gl.createVertexArray();if(!r)throw new Error("Unable to create VAO");return this._vaoRecordInProgress=!0,this._gl.bindVertexArray(r),this._mustWipeVertexAttributes=!0,this._bindVertexBuffersAttributes(e,i,s),this.bindIndexBuffer(t),this._vaoRecordInProgress=!1,this._gl.bindVertexArray(null),r}bindVertexArrayObject(e,t){this._cachedVertexArrayObject!==e&&(this._cachedVertexArrayObject=e,this._gl.bindVertexArray(e),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._uintIndicesCurrentlySet=t!=null&&t.is32Bits,this._mustWipeVertexAttributes=!0)}bindBuffersDirectly(e,t,i,s,r){if(this._cachedVertexBuffers!==e||this._cachedEffectForVertexBuffers!==r){this._cachedVertexBuffers=e,this._cachedEffectForVertexBuffers=r;const a=r.getAttributesCount();this._unbindVertexArrayObject(),this.unbindAllAttributes();let o=0;for(let l=0;l<a;l++)if(l<i.length){const h=r.getAttributeLocation(l);h>=0&&(this._gl.enableVertexAttribArray(h),this._vertexAttribArraysEnabled[h]=!0,this._vertexAttribPointer(e,h,i[l],this._gl.FLOAT,!1,s,o)),o+=i[l]*4}}this._bindIndexBufferWithCache(t)}_unbindVertexArrayObject(){this._cachedVertexArrayObject&&(this._cachedVertexArrayObject=null,this._gl.bindVertexArray(null))}bindBuffers(e,t,i,s){(this._cachedVertexBuffers!==e||this._cachedEffectForVertexBuffers!==i)&&(this._cachedVertexBuffers=e,this._cachedEffectForVertexBuffers=i,this._bindVertexBuffersAttributes(e,i,s)),this._bindIndexBufferWithCache(t)}unbindInstanceAttributes(){let e;for(let t=0,i=this._currentInstanceLocations.length;t<i;t++){const s=this._currentInstanceBuffers[t];e!=s&&s.references&&(e=s,this.bindArrayBuffer(s));const r=this._currentInstanceLocations[t];this._gl.vertexAttribDivisor(r,0)}this._currentInstanceBuffers.length=0,this._currentInstanceLocations.length=0}releaseVertexArrayObject(e){this._gl.deleteVertexArray(e)}_releaseBuffer(e){return e.references--,e.references===0?(this._deleteBuffer(e),!0):!1}_deleteBuffer(e){this._gl.deleteBuffer(e.underlyingResource)}updateAndBindInstancesBuffer(e,t,i){if(this.bindArrayBuffer(e),t&&this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,t),i[0].index!==void 0)this.bindInstancesBuffer(e,i,!0);else for(let s=0;s<4;s++){const r=i[s];this._vertexAttribArraysEnabled[r]||(this._gl.enableVertexAttribArray(r),this._vertexAttribArraysEnabled[r]=!0),this._vertexAttribPointer(e,r,4,this._gl.FLOAT,!1,64,s*16),this._gl.vertexAttribDivisor(r,1),this._currentInstanceLocations.push(r),this._currentInstanceBuffers.push(e)}}bindInstancesBuffer(e,t,i=!0){this.bindArrayBuffer(e);let s=0;if(i)for(let r=0;r<t.length;r++){const a=t[r];s+=a.attributeSize*4}for(let r=0;r<t.length;r++){const a=t[r];a.index===void 0&&(a.index=this._currentEffect.getAttributeLocationByName(a.attributeName)),!(a.index<0)&&(this._vertexAttribArraysEnabled[a.index]||(this._gl.enableVertexAttribArray(a.index),this._vertexAttribArraysEnabled[a.index]=!0),this._vertexAttribPointer(e,a.index,a.attributeSize,a.attributeType||this._gl.FLOAT,a.normalized||!1,s,a.offset),this._gl.vertexAttribDivisor(a.index,a.divisor===void 0?1:a.divisor),this._currentInstanceLocations.push(a.index),this._currentInstanceBuffers.push(e))}}disableInstanceAttributeByName(e){if(!this._currentEffect)return;const t=this._currentEffect.getAttributeLocationByName(e);this.disableInstanceAttribute(t)}disableInstanceAttribute(e){let t=!1,i;for(;(i=this._currentInstanceLocations.indexOf(e))!==-1;)this._currentInstanceLocations.splice(i,1),this._currentInstanceBuffers.splice(i,1),t=!0,i=this._currentInstanceLocations.indexOf(e);t&&(this._gl.vertexAttribDivisor(e,0),this.disableAttributeByIndex(e))}disableAttributeByIndex(e){this._gl.disableVertexAttribArray(e),this._vertexAttribArraysEnabled[e]=!1,this._currentBufferPointers[e].active=!1}draw(e,t,i,s){this.drawElementsType(e?0:1,t,i,s)}drawPointClouds(e,t,i){this.drawArraysType(2,e,t,i)}drawUnIndexed(e,t,i,s){this.drawArraysType(e?0:1,t,i,s)}drawElementsType(e,t,i,s){this.applyStates(),this._reportDrawCall();const r=this._drawMode(e),a=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,o=this._uintIndicesCurrentlySet?4:2;s?this._gl.drawElementsInstanced(r,i,a,t*o,s):this._gl.drawElements(r,i,a,t*o)}drawArraysType(e,t,i,s){this.applyStates(),this._reportDrawCall();const r=this._drawMode(e);s?this._gl.drawArraysInstanced(r,t,i,s):this._gl.drawArrays(r,t,i)}_drawMode(e){switch(e){case 0:return this._gl.TRIANGLES;case 2:return this._gl.POINTS;case 1:return this._gl.LINES;case 3:return this._gl.POINTS;case 4:return this._gl.LINES;case 5:return this._gl.LINE_LOOP;case 6:return this._gl.LINE_STRIP;case 7:return this._gl.TRIANGLE_STRIP;case 8:return this._gl.TRIANGLE_FAN;default:return this._gl.TRIANGLES}}_releaseEffect(e){this._compiledEffects[e._key]&&delete this._compiledEffects[e._key];const t=e.getPipelineContext();t&&this._deletePipelineContext(t)}_deletePipelineContext(e){const t=e;t&&t.program&&(t.program.__SPECTOR_rebuildProgram=null,id(t),this._gl&&this._gl.deleteProgram(t.program))}_getGlobalDefines(e){return $2(e,this.isNDCHalfZRange,this.useReverseDepthBuffer,this.useExactSrgbConversions)}createEffect(e,t,i,s,r,a,o,l,h,u=0,c){const f=typeof e=="string"?e:e.vertexToken||e.vertexSource||e.vertexElement||e.vertex,d=typeof e=="string"?e:e.fragmentToken||e.fragmentSource||e.fragmentElement||e.fragment,_=this._getGlobalDefines(),p=t.attributes!==void 0;let g=r??t.defines??"";_&&(g+=_);const m=f+"+"+d+"@"+g;if(this._compiledEffects[m]){const T=this._compiledEffects[m];return o&&T.isReady()&&o(T),T._refCount++,T}this._gl&&Pi(this._gl);const v=new Et(e,t,p?this:i,s,this,r,a,o,l,h,m,t.shaderLanguage??u,t.extraInitializationsAsync??c);return this._compiledEffects[m]=v,v}_getShaderSource(e){return this._gl.getShaderSource(e)}createRawShaderProgram(e,t,i,s,r=null){const a=Pi(this._gl);return a._contextWasLost=this._contextWasLost,a.validateShaderPrograms=this.validateShaderPrograms,Z2(e,t,i,s||this._gl,r)}createShaderProgram(e,t,i,s,r,a=null){const o=Pi(this._gl);return o._contextWasLost=this._contextWasLost,o.validateShaderPrograms=this.validateShaderPrograms,Q2(e,t,i,s,r||this._gl,a)}inlineShaderCode(e){return e}createPipelineContext(e){if(this._gl){const i=Pi(this._gl);i.parallelShaderCompile=this._caps.parallelShaderCompile}const t=RT(this._gl);return t.engine=this,t}createMaterialContext(){}createDrawContext(){}_finalizePipelineContext(e){return Qf(e,this._gl,this.validateShaderPrograms)}_preparePipelineContext(e,t,i,s,r,a,o,l,h,u,c){const f=Pi(this._gl);return f._contextWasLost=this._contextWasLost,f.validateShaderPrograms=this.validateShaderPrograms,f._createShaderProgramInjection=this._createShaderProgram.bind(this),f.createRawShaderProgramInjection=this.createRawShaderProgram.bind(this),f.createShaderProgramInjection=this.createShaderProgram.bind(this),f.loadFileInjection=this._loadFile.bind(this),CT(e,t,i,s,r,a,o,l,h,u,c)}_createShaderProgram(e,t,i,s,r=null){return Zf(e,t,i,s,r)}_isRenderingStateCompiled(e){return this._isDisposed?!1:IT(e,this._gl,this.validateShaderPrograms)}_executeWhenRenderingStateIsCompiled(e,t){PT(e,t)}getUniforms(e,t){const i=new Array,s=e;for(let r=0;r<t.length;r++)i.push(this._gl.getUniformLocation(s.program,t[r]));return i}getAttributes(e,t){const i=[],s=e;for(let r=0;r<t.length;r++)try{i.push(this._gl.getAttribLocation(s.program,t[r]))}catch{i.push(-1)}return i}enableEffect(e){e=e!==null&&J2(e)?e.effect:e,!(!e||e===this._currentEffect)&&(this._stencilStateComposer.stencilMaterial=void 0,e=e,this.bindSamplers(e),this._currentEffect=e,e.onBind&&e.onBind(e),e._onBindObservable&&e._onBindObservable.notifyObservers(e))}setInt(e,t){return e?(this._gl.uniform1i(e,t),!0):!1}setInt2(e,t,i){return e?(this._gl.uniform2i(e,t,i),!0):!1}setInt3(e,t,i,s){return e?(this._gl.uniform3i(e,t,i,s),!0):!1}setInt4(e,t,i,s,r){return e?(this._gl.uniform4i(e,t,i,s,r),!0):!1}setIntArray(e,t){return e?(this._gl.uniform1iv(e,t),!0):!1}setIntArray2(e,t){return!e||t.length%2!==0?!1:(this._gl.uniform2iv(e,t),!0)}setIntArray3(e,t){return!e||t.length%3!==0?!1:(this._gl.uniform3iv(e,t),!0)}setIntArray4(e,t){return!e||t.length%4!==0?!1:(this._gl.uniform4iv(e,t),!0)}setUInt(e,t){return e?(this._gl.uniform1ui(e,t),!0):!1}setUInt2(e,t,i){return e?(this._gl.uniform2ui(e,t,i),!0):!1}setUInt3(e,t,i,s){return e?(this._gl.uniform3ui(e,t,i,s),!0):!1}setUInt4(e,t,i,s,r){return e?(this._gl.uniform4ui(e,t,i,s,r),!0):!1}setUIntArray(e,t){return e?(this._gl.uniform1uiv(e,t),!0):!1}setUIntArray2(e,t){return!e||t.length%2!==0?!1:(this._gl.uniform2uiv(e,t),!0)}setUIntArray3(e,t){return!e||t.length%3!==0?!1:(this._gl.uniform3uiv(e,t),!0)}setUIntArray4(e,t){return!e||t.length%4!==0?!1:(this._gl.uniform4uiv(e,t),!0)}setArray(e,t){return!e||t.length<1?!1:(this._gl.uniform1fv(e,t),!0)}setArray2(e,t){return!e||t.length%2!==0?!1:(this._gl.uniform2fv(e,t),!0)}setArray3(e,t){return!e||t.length%3!==0?!1:(this._gl.uniform3fv(e,t),!0)}setArray4(e,t){return!e||t.length%4!==0?!1:(this._gl.uniform4fv(e,t),!0)}setMatrices(e,t){return e?(this._gl.uniformMatrix4fv(e,!1,t),!0):!1}setMatrix3x3(e,t){return e?(this._gl.uniformMatrix3fv(e,!1,t),!0):!1}setMatrix2x2(e,t){return e?(this._gl.uniformMatrix2fv(e,!1,t),!0):!1}setFloat(e,t){return e?(this._gl.uniform1f(e,t),!0):!1}setFloat2(e,t,i){return e?(this._gl.uniform2f(e,t,i),!0):!1}setFloat3(e,t,i,s){return e?(this._gl.uniform3f(e,t,i,s),!0):!1}setFloat4(e,t,i,s,r){return e?(this._gl.uniform4f(e,t,i,s,r),!0):!1}applyStates(){if(this._depthCullingState.apply(this._gl),this._stencilStateComposer.apply(this._gl),this._alphaState.apply(this._gl),this._colorWriteChanged){this._colorWriteChanged=!1;const e=this._colorWrite;this._gl.colorMask(e,e,e,e)}}wipeCaches(e){this.preventCacheWipeBetweenFrames&&!e||(this._currentEffect=null,this._viewportCached.x=0,this._viewportCached.y=0,this._viewportCached.z=0,this._viewportCached.w=0,this._unbindVertexArrayObject(),e&&(this._currentProgram=null,this.resetTextureCache(),this._stencilStateComposer.reset(),this._depthCullingState.reset(),this._depthCullingState.depthFunc=this._gl.LEQUAL,this._alphaState.reset(),this._alphaMode=1,this._alphaEquation=0,this._colorWrite=!0,this._colorWriteChanged=!0,this._unpackFlipYCached=null,this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),this._mustWipeVertexAttributes=!0,this.unbindAllAttributes()),this._resetVertexBufferBinding(),this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null,this.bindIndexBuffer(null))}_getSamplingParameters(e,t){const i=this._gl;let s=i.NEAREST,r=i.NEAREST;switch(e){case 11:s=i.LINEAR,t?r=i.LINEAR_MIPMAP_NEAREST:r=i.LINEAR;break;case 3:s=i.LINEAR,t?r=i.LINEAR_MIPMAP_LINEAR:r=i.LINEAR;break;case 8:s=i.NEAREST,t?r=i.NEAREST_MIPMAP_LINEAR:r=i.NEAREST;break;case 4:s=i.NEAREST,t?r=i.NEAREST_MIPMAP_NEAREST:r=i.NEAREST;break;case 5:s=i.NEAREST,t?r=i.LINEAR_MIPMAP_NEAREST:r=i.LINEAR;break;case 6:s=i.NEAREST,t?r=i.LINEAR_MIPMAP_LINEAR:r=i.LINEAR;break;case 7:s=i.NEAREST,r=i.LINEAR;break;case 1:s=i.NEAREST,r=i.NEAREST;break;case 9:s=i.LINEAR,t?r=i.NEAREST_MIPMAP_NEAREST:r=i.NEAREST;break;case 10:s=i.LINEAR,t?r=i.NEAREST_MIPMAP_LINEAR:r=i.NEAREST;break;case 2:s=i.LINEAR,r=i.LINEAR;break;case 12:s=i.LINEAR,r=i.NEAREST;break}return{min:r,mag:s}}_createTexture(){const e=this._gl.createTexture();if(!e)throw new Error("Unable to create texture");return e}_createHardwareTexture(){return new lv(this._createTexture(),this._gl)}_createInternalTexture(e,t,i=!0,s=0){let r=!1,a=!1,o=0,l=3,h=5,u=!1,c=1,f,d=!1,_=0;t!==void 0&&typeof t=="object"?(r=!!t.generateMipMaps,a=!!t.createMipMaps,o=t.type===void 0?0:t.type,l=t.samplingMode===void 0?3:t.samplingMode,h=t.format===void 0?5:t.format,u=t.useSRGBBuffer===void 0?!1:t.useSRGBBuffer,c=t.samples??1,f=t.label,d=!!t.createMSAATexture,_=t.comparisonFunction||0):r=!!t,u&&(u=this._caps.supportSRGBBuffers&&(this.webGLVersion>1||this.isWebGPU)),(o===1&&!this._caps.textureFloatLinearFiltering||o===2&&!this._caps.textureHalfFloatLinearFiltering)&&(l=1),o===1&&!this._caps.textureFloat&&(o=0,U.Warn("Float textures are not supported. Type forced to TEXTURETYPE_UNSIGNED_BYTE"));const p=gp(h),g=Ia(h),m=this._gl,v=new gt(this,s),T=e.width||e,A=e.height||e,b=e.depth||0,x=e.layers||0,E=this._getSamplingParameters(l,(r||a)&&!p),R=x!==0?m.TEXTURE_2D_ARRAY:b!==0?m.TEXTURE_3D:m.TEXTURE_2D,C=p?this._getInternalFormatFromDepthTextureFormat(h,!0,g):this._getRGBABufferInternalSizedFormat(o,h,u),I=p?g?m.DEPTH_STENCIL:m.DEPTH_COMPONENT:this._getInternalFormat(h),D=p?this._getWebGLTextureTypeFromDepthTextureFormat(h):this._getWebGLTextureType(o);if(this._bindTextureDirectly(R,v),x!==0?(v.is2DArray=!0,m.texImage3D(R,0,C,T,A,x,0,I,D,null)):b!==0?(v.is3D=!0,m.texImage3D(R,0,C,T,A,b,0,I,D,null)):m.texImage2D(R,0,C,T,A,0,I,D,null),m.texParameteri(R,m.TEXTURE_MAG_FILTER,E.mag),m.texParameteri(R,m.TEXTURE_MIN_FILTER,E.min),m.texParameteri(R,m.TEXTURE_WRAP_S,m.CLAMP_TO_EDGE),m.texParameteri(R,m.TEXTURE_WRAP_T,m.CLAMP_TO_EDGE),p&&this.webGLVersion>1&&(_===0?(m.texParameteri(R,m.TEXTURE_COMPARE_FUNC,515),m.texParameteri(R,m.TEXTURE_COMPARE_MODE,m.NONE)):(m.texParameteri(R,m.TEXTURE_COMPARE_FUNC,_),m.texParameteri(R,m.TEXTURE_COMPARE_MODE,m.COMPARE_REF_TO_TEXTURE))),(r||a)&&this._gl.generateMipmap(R),this._bindTextureDirectly(R,null),v._useSRGBBuffer=u,v.baseWidth=T,v.baseHeight=A,v.width=T,v.height=A,v.depth=x||b,v.isReady=!0,v.samples=c,v.generateMipMaps=r,v.samplingMode=l,v.type=o,v.format=h,v.label=f,v.comparisonFunction=_,this._internalTexturesCache.push(v),d){let w=null;if(gp(v.format)?w=this._setupFramebufferDepthAttachments(Ia(v.format),v.format!==19,v.width,v.height,c,v.format,!0):w=this._createRenderBuffer(v.width,v.height,c,-1,this._getRGBABufferInternalSizedFormat(v.type,v.format,v._useSRGBBuffer),-1),!w)throw new Error("Unable to create render buffer");v._autoMSAAManagement=!0;let z=v._hardwareTexture;z||(z=v._hardwareTexture=this._createHardwareTexture()),z.addMSAARenderBuffer(w)}return v}_getUseSRGBBuffer(e,t){return e&&this._caps.supportSRGBBuffers&&(this.webGLVersion>1||t)}createTexture(e,t,i,s,r=3,a=null,o=null,l=null,h=null,u=null,c=null,f,d,_,p){return this._createTextureBase(e,t,i,s,r,a,o,(...g)=>this._prepareWebGLTexture(...g,u),(g,m,v,T,A,b)=>{const x=this._gl,E=v.width===g&&v.height===m;A._creationFlags=_??0;const R=this._getTexImageParametersForCreateTexture(A.format,A._useSRGBBuffer);if(E)return x.texImage2D(x.TEXTURE_2D,0,R.internalFormat,R.format,R.type,v),!1;const C=this._caps.maxTextureSize;if(v.width>C||v.height>C||!this._supportsHardwareTextureRescaling)return this._prepareWorkingCanvas(),!this._workingCanvas||!this._workingContext||(this._workingCanvas.width=g,this._workingCanvas.height=m,this._workingContext.drawImage(v,0,0,v.width,v.height,0,0,g,m),x.texImage2D(x.TEXTURE_2D,0,R.internalFormat,R.format,R.type,this._workingCanvas),A.width=g,A.height=m),!1;{const I=new gt(this,2);this._bindTextureDirectly(x.TEXTURE_2D,I,!0),x.texImage2D(x.TEXTURE_2D,0,R.internalFormat,R.format,R.type,v),this._rescaleTexture(I,A,s,R.format,()=>{this._releaseTexture(I),this._bindTextureDirectly(x.TEXTURE_2D,A,!0),b()})}return!0},l,h,u,c,f,d,p)}_getTexImageParametersForCreateTexture(e,t){let i,s;return this.webGLVersion===1?(i=this._getInternalFormat(e,t),s=i):(i=this._getInternalFormat(e,!1),s=this._getRGBABufferInternalSizedFormat(0,e,t)),{internalFormat:s,format:i,type:this._gl.UNSIGNED_BYTE}}_rescaleTexture(e,t,i,s,r){}_unpackFlipY(e){this._unpackFlipYCached!==e&&(this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,e?1:0),this.enableUnpackFlipYCached&&(this._unpackFlipYCached=e))}_getUnpackAlignement(){return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT)}_getTextureTarget(e){return e.isCube?this._gl.TEXTURE_CUBE_MAP:e.is3D?this._gl.TEXTURE_3D:e.is2DArray||e.isMultiview?this._gl.TEXTURE_2D_ARRAY:this._gl.TEXTURE_2D}updateTextureSamplingMode(e,t,i=!1){const s=this._getTextureTarget(t),r=this._getSamplingParameters(e,t.useMipMaps||i);this._setTextureParameterInteger(s,this._gl.TEXTURE_MAG_FILTER,r.mag,t),this._setTextureParameterInteger(s,this._gl.TEXTURE_MIN_FILTER,r.min),i&&(t.generateMipMaps=!0,this._gl.generateMipmap(s)),this._bindTextureDirectly(s,null),t.samplingMode=e}updateTextureDimensions(e,t,i,s=1){}updateTextureWrappingMode(e,t,i=null,s=null){const r=this._getTextureTarget(e);t!==null&&(this._setTextureParameterInteger(r,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(t),e),e._cachedWrapU=t),i!==null&&(this._setTextureParameterInteger(r,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(i),e),e._cachedWrapV=i),(e.is2DArray||e.is3D)&&s!==null&&(this._setTextureParameterInteger(r,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(s),e),e._cachedWrapR=s),this._bindTextureDirectly(r,null)}_uploadCompressedDataToTextureDirectly(e,t,i,s,r,a=0,o=0){const l=this._gl;let h=l.TEXTURE_2D;if(e.isCube&&(h=l.TEXTURE_CUBE_MAP_POSITIVE_X+a),e._useSRGBBuffer)switch(t){case 37492:case 36196:this._caps.etc2?t=l.COMPRESSED_SRGB8_ETC2:e._useSRGBBuffer=!1;break;case 37496:this._caps.etc2?t=l.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:e._useSRGBBuffer=!1;break;case 36492:t=l.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT;break;case 37808:t=l.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;break;case 33776:this._caps.s3tc_srgb?t=l.COMPRESSED_SRGB_S3TC_DXT1_EXT:e._useSRGBBuffer=!1;break;case 33777:this._caps.s3tc_srgb?t=l.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:e._useSRGBBuffer=!1;break;case 33779:this._caps.s3tc_srgb?t=l.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:e._useSRGBBuffer=!1;break;default:e._useSRGBBuffer=!1;break}this._gl.compressedTexImage2D(h,o,t,i,s,0,r)}_uploadDataToTextureDirectly(e,t,i=0,s=0,r,a=!1){const o=this._gl,l=this._getWebGLTextureType(e.type),h=this._getInternalFormat(e.format),u=r===void 0?this._getRGBABufferInternalSizedFormat(e.type,e.format,e._useSRGBBuffer):this._getInternalFormat(r,e._useSRGBBuffer);this._unpackFlipY(e.invertY);let c=o.TEXTURE_2D;e.isCube&&(c=o.TEXTURE_CUBE_MAP_POSITIVE_X+i);const f=Math.round(Math.log(e.width)*Math.LOG2E),d=Math.round(Math.log(e.height)*Math.LOG2E),_=a?e.width:Math.pow(2,Math.max(f-s,0)),p=a?e.height:Math.pow(2,Math.max(d-s,0));o.texImage2D(c,s,u,_,p,0,h,l,t)}updateTextureData(e,t,i,s,r,a,o=0,l=0,h=!1){const u=this._gl,c=this._getWebGLTextureType(e.type),f=this._getInternalFormat(e.format);this._unpackFlipY(e.invertY);let d=u.TEXTURE_2D,_=u.TEXTURE_2D;e.isCube&&(_=u.TEXTURE_CUBE_MAP_POSITIVE_X+o,d=u.TEXTURE_CUBE_MAP),this._bindTextureDirectly(d,e,!0),u.texSubImage2D(_,l,i,s,r,a,f,c,t),h&&this._gl.generateMipmap(_),this._bindTextureDirectly(d,null)}_uploadArrayBufferViewToTexture(e,t,i=0,s=0){const r=this._gl,a=e.isCube?r.TEXTURE_CUBE_MAP:r.TEXTURE_2D;this._bindTextureDirectly(a,e,!0),this._uploadDataToTextureDirectly(e,t,i,s),this._bindTextureDirectly(a,null,!0)}_prepareWebGLTextureContinuation(e,t,i,s,r){const a=this._gl;if(!a)return;const o=this._getSamplingParameters(r,!i);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,o.mag),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,o.min),!i&&!s&&a.generateMipmap(a.TEXTURE_2D),this._bindTextureDirectly(a.TEXTURE_2D,null),t&&t.removePendingData(e),e.onLoadedObservable.notifyObservers(e),e.onLoadedObservable.clear()}_prepareWebGLTexture(e,t,i,s,r,a,o,l,h,u){const c=this.getCaps().maxTextureSize,f=Math.min(c,this.needPOTTextures?Yi(s.width,c):s.width),d=Math.min(c,this.needPOTTextures?Yi(s.height,c):s.height),_=this._gl;if(_){if(!e._hardwareTexture){i&&i.removePendingData(e);return}this._bindTextureDirectly(_.TEXTURE_2D,e,!0),this._unpackFlipY(r===void 0?!0:!!r),e.baseWidth=s.width,e.baseHeight=s.height,e.width=f,e.height=d,e.isReady=!0,e.type=e.type!==-1?e.type:0,e.format=e.format!==-1?e.format:u??(t===".jpg"&&!e._useSRGBBuffer?4:5),!l(f,d,s,t,e,()=>{this._prepareWebGLTextureContinuation(e,i,a,o,h)})&&this._prepareWebGLTextureContinuation(e,i,a,o,h)}}_getInternalFormatFromDepthTextureFormat(e,t,i){const s=this._gl;if(!t)return s.STENCIL_INDEX8;let a=i?s.DEPTH_STENCIL:s.DEPTH_COMPONENT;return this.webGLVersion>1?e===15?a=s.DEPTH_COMPONENT16:e===16?a=s.DEPTH_COMPONENT24:e===17||e===13?a=i?s.DEPTH24_STENCIL8:s.DEPTH_COMPONENT24:e===14?a=s.DEPTH_COMPONENT32F:e===18&&(a=i?s.DEPTH32F_STENCIL8:s.DEPTH_COMPONENT32F):a=s.DEPTH_COMPONENT16,a}_getWebGLTextureTypeFromDepthTextureFormat(e){const t=this._gl;let i=t.UNSIGNED_INT;return e===15?i=t.UNSIGNED_SHORT:e===17||e===13?i=t.UNSIGNED_INT_24_8:e===14?i=t.FLOAT:e===18?i=t.FLOAT_32_UNSIGNED_INT_24_8_REV:e===19&&(i=t.UNSIGNED_BYTE),i}_setupFramebufferDepthAttachments(e,t,i,s,r=1,a,o=!1){const l=this._gl;a=a??(e?13:14);const h=this._getInternalFormatFromDepthTextureFormat(a,t,e);return e&&t?this._createRenderBuffer(i,s,r,l.DEPTH_STENCIL,h,o?-1:l.DEPTH_STENCIL_ATTACHMENT):t?this._createRenderBuffer(i,s,r,h,h,o?-1:l.DEPTH_ATTACHMENT):e?this._createRenderBuffer(i,s,r,h,h,o?-1:l.STENCIL_ATTACHMENT):null}_createRenderBuffer(e,t,i,s,r,a,o=!0){const h=this._gl.createRenderbuffer();return this._updateRenderBuffer(h,e,t,i,s,r,a,o)}_updateRenderBuffer(e,t,i,s,r,a,o,l=!0){const h=this._gl;return h.bindRenderbuffer(h.RENDERBUFFER,e),s>1&&h.renderbufferStorageMultisample?h.renderbufferStorageMultisample(h.RENDERBUFFER,s,a,t,i):h.renderbufferStorage(h.RENDERBUFFER,r,t,i),o!==-1&&h.framebufferRenderbuffer(h.FRAMEBUFFER,o,h.RENDERBUFFER,e),l&&h.bindRenderbuffer(h.RENDERBUFFER,null),e}_releaseTexture(e){this._deleteTexture(e._hardwareTexture),this.unbindAllTextures();const t=this._internalTexturesCache.indexOf(e);t!==-1&&this._internalTexturesCache.splice(t,1),e._lodTextureHigh&&e._lodTextureHigh.dispose(),e._lodTextureMid&&e._lodTextureMid.dispose(),e._lodTextureLow&&e._lodTextureLow.dispose(),e._irradianceTexture&&e._irradianceTexture.dispose()}_deleteTexture(e){e==null||e.release()}_setProgram(e){this._currentProgram!==e&&(MT(e,this._gl),this._currentProgram=e)}bindSamplers(e){const t=e.getPipelineContext();this._setProgram(t.program);const i=e.getSamplers();for(let s=0;s<i.length;s++){const r=e.getUniform(i[s]);r&&(this._boundUniforms[s]=r)}this._currentEffect=null}_activateCurrentTexture(){this._currentTextureChannel!==this._activeChannel&&(this._gl.activeTexture(this._gl.TEXTURE0+this._activeChannel),this._currentTextureChannel=this._activeChannel)}_bindTextureDirectly(e,t,i=!1,s=!1){var l;let r=!1;const a=t&&t._associatedChannel>-1;if(i&&a&&(this._activeChannel=t._associatedChannel),this._boundTexturesCache[this._activeChannel]!==t||s){if(this._activateCurrentTexture(),t&&t.isMultiview)throw U.Error(["_bindTextureDirectly called with a multiview texture!",e,t]),"_bindTextureDirectly called with a multiview texture!";this._gl.bindTexture(e,((l=t==null?void 0:t._hardwareTexture)==null?void 0:l.underlyingResource)??null),this._boundTexturesCache[this._activeChannel]=t,t&&(t._associatedChannel=this._activeChannel)}else i&&(r=!0,this._activateCurrentTexture());return a&&!i&&this._bindSamplerUniformToChannel(t._associatedChannel,this._activeChannel),r}_bindTexture(e,t,i){if(e===void 0)return;t&&(t._associatedChannel=e),this._activeChannel=e;const s=t?this._getTextureTarget(t):this._gl.TEXTURE_2D;this._bindTextureDirectly(s,t)}unbindAllTextures(){for(let e=0;e<this._maxSimultaneousTextures;e++)this._activeChannel=e,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))}setTexture(e,t,i,s){e!==void 0&&(t&&(this._boundUniforms[e]=t),this._setTexture(e,i))}_bindSamplerUniformToChannel(e,t){const i=this._boundUniforms[e];!i||i._currentState===t||(this._gl.uniform1i(i,t),i._currentState=t)}_getTextureWrapMode(e){switch(e){case 1:return this._gl.REPEAT;case 0:return this._gl.CLAMP_TO_EDGE;case 2:return this._gl.MIRRORED_REPEAT}return this._gl.REPEAT}_setTexture(e,t,i=!1,s=!1,r=""){if(!t)return this._boundTexturesCache[e]!=null&&(this._activeChannel=e,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))),!1;if(t.video){this._activeChannel=e;const h=t.getInternalTexture();h&&(h._associatedChannel=e),t.update()}else if(t.delayLoadState===4)return t.delayLoad(),!1;let a;s?a=t.depthStencilTexture:t.isReady()?a=t.getInternalTexture():t.isCube?a=this.emptyCubeTexture:t.is3D?a=this.emptyTexture3D:t.is2DArray?a=this.emptyTexture2DArray:a=this.emptyTexture,!i&&a&&(a._associatedChannel=e);let o=!0;this._boundTexturesCache[e]===a&&(i||this._bindSamplerUniformToChannel(a._associatedChannel,e),o=!1),this._activeChannel=e;const l=this._getTextureTarget(a);if(o&&this._bindTextureDirectly(l,a,i),a&&!a.isMultiview){if(a.isCube&&a._cachedCoordinatesMode!==t.coordinatesMode){a._cachedCoordinatesMode=t.coordinatesMode;const h=t.coordinatesMode!==3&&t.coordinatesMode!==5?1:0;t.wrapU=h,t.wrapV=h}a._cachedWrapU!==t.wrapU&&(a._cachedWrapU=t.wrapU,this._setTextureParameterInteger(l,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(t.wrapU),a)),a._cachedWrapV!==t.wrapV&&(a._cachedWrapV=t.wrapV,this._setTextureParameterInteger(l,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(t.wrapV),a)),a.is3D&&a._cachedWrapR!==t.wrapR&&(a._cachedWrapR=t.wrapR,this._setTextureParameterInteger(l,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(t.wrapR),a)),this._setAnisotropicLevel(l,a,t.anisotropicFilteringLevel)}return!0}setTextureArray(e,t,i,s){if(!(e===void 0||!t)){(!this._textureUnits||this._textureUnits.length!==i.length)&&(this._textureUnits=new Int32Array(i.length));for(let r=0;r<i.length;r++){const a=i[r].getInternalTexture();a?(this._textureUnits[r]=e+r,a._associatedChannel=e+r):this._textureUnits[r]=-1}this._gl.uniform1iv(t,this._textureUnits);for(let r=0;r<i.length;r++)this._setTexture(this._textureUnits[r],i[r],!0)}}_setAnisotropicLevel(e,t,i){const s=this._caps.textureAnisotropicFilterExtension;t.samplingMode!==11&&t.samplingMode!==3&&t.samplingMode!==2&&(i=1),s&&t._cachedAnisotropicFilteringLevel!==i&&(this._setTextureParameterFloat(e,s.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(i,this._caps.maxAnisotropy),t),t._cachedAnisotropicFilteringLevel=i)}_setTextureParameterFloat(e,t,i,s){this._bindTextureDirectly(e,s,!0,!0),this._gl.texParameterf(e,t,i)}_setTextureParameterInteger(e,t,i,s){s&&this._bindTextureDirectly(e,s,!0,!0),this._gl.texParameteri(e,t,i)}unbindAllAttributes(){if(this._mustWipeVertexAttributes){this._mustWipeVertexAttributes=!1;for(let e=0;e<this._caps.maxVertexAttribs;e++)this.disableAttributeByIndex(e);return}for(let e=0,t=this._vertexAttribArraysEnabled.length;e<t;e++)e>=this._caps.maxVertexAttribs||!this._vertexAttribArraysEnabled[e]||this.disableAttributeByIndex(e)}releaseEffects(){this._compiledEffects={},this.onReleaseEffectsObservable.notifyObservers(this)}dispose(){var e;zt()&&this._renderingCanvas&&(this._renderingCanvas.removeEventListener("webglcontextlost",this._onContextLost),this._onContextRestored&&this._renderingCanvas.removeEventListener("webglcontextrestored",this._onContextRestored)),super.dispose(),this._dummyFramebuffer&&this._gl.deleteFramebuffer(this._dummyFramebuffer),this.unbindAllAttributes(),this._boundUniforms={},this._workingCanvas=null,this._workingContext=null,this._currentBufferPointers.length=0,this._currentProgram=null,this._creationOptions.loseContextOnDispose&&((e=this._gl.getExtension("WEBGL_lose_context"))==null||e.loseContext()),_u(this._gl)}attachContextLostEvent(e){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextlost",e,!1)}attachContextRestoredEvent(e){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextrestored",e,!1)}getError(){return this._gl.getError()}_canRenderToFloatFramebuffer(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(1)}_canRenderToHalfFloatFramebuffer(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(2)}_canRenderToFramebuffer(e){const t=this._gl;for(;t.getError()!==t.NO_ERROR;);let i=!0;const s=t.createTexture();t.bindTexture(t.TEXTURE_2D,s),t.texImage2D(t.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(e),1,1,0,t.RGBA,this._getWebGLTextureType(e),null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST);const r=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,r),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,s,0);const a=t.checkFramebufferStatus(t.FRAMEBUFFER);if(i=i&&a===t.FRAMEBUFFER_COMPLETE,i=i&&t.getError()===t.NO_ERROR,i&&(t.clear(t.COLOR_BUFFER_BIT),i=i&&t.getError()===t.NO_ERROR),i){t.bindFramebuffer(t.FRAMEBUFFER,null);const o=t.RGBA,l=t.UNSIGNED_BYTE,h=new Uint8Array(4);t.readPixels(0,0,1,1,o,l,h),i=i&&t.getError()===t.NO_ERROR}for(t.deleteTexture(s),t.deleteFramebuffer(r),t.bindFramebuffer(t.FRAMEBUFFER,null);!i&&t.getError()!==t.NO_ERROR;);return i}_getWebGLTextureType(e){if(this._webGLVersion===1){switch(e){case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT_OES;case 0:return this._gl.UNSIGNED_BYTE;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5}return this._gl.UNSIGNED_BYTE}switch(e){case 3:return this._gl.BYTE;case 0:return this._gl.UNSIGNED_BYTE;case 4:return this._gl.SHORT;case 5:return this._gl.UNSIGNED_SHORT;case 6:return this._gl.INT;case 7:return this._gl.UNSIGNED_INT;case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5;case 11:return this._gl.UNSIGNED_INT_2_10_10_10_REV;case 12:return this._gl.UNSIGNED_INT_24_8;case 13:return this._gl.UNSIGNED_INT_10F_11F_11F_REV;case 14:return this._gl.UNSIGNED_INT_5_9_9_9_REV;case 15:return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV}return this._gl.UNSIGNED_BYTE}_getInternalFormat(e,t=!1){let i=t?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA;switch(e){case 0:i=this._gl.ALPHA;break;case 1:i=this._gl.LUMINANCE;break;case 2:i=this._gl.LUMINANCE_ALPHA;break;case 6:case 33322:case 36760:i=this._gl.RED;break;case 7:case 33324:case 36761:i=this._gl.RG;break;case 4:case 32852:case 36762:i=t?this._glSRGBExtensionValues.SRGB:this._gl.RGB;break;case 5:case 32859:case 36763:i=t?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA;break}if(this._webGLVersion>1)switch(e){case 8:i=this._gl.RED_INTEGER;break;case 9:i=this._gl.RG_INTEGER;break;case 10:i=this._gl.RGB_INTEGER;break;case 11:i=this._gl.RGBA_INTEGER;break}return i}_getRGBABufferInternalSizedFormat(e,t,i=!1){if(this._webGLVersion===1){if(t!==void 0)switch(t){case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;case 4:return i?this._glSRGBExtensionValues.SRGB:this._gl.RGB}return this._gl.RGBA}switch(e){case 3:switch(t){case 6:return this._gl.R8_SNORM;case 7:return this._gl.RG8_SNORM;case 4:return this._gl.RGB8_SNORM;case 8:return this._gl.R8I;case 9:return this._gl.RG8I;case 10:return this._gl.RGB8I;case 11:return this._gl.RGBA8I;default:return this._gl.RGBA8_SNORM}case 0:switch(t){case 6:return this._gl.R8;case 7:return this._gl.RG8;case 4:return i?this._glSRGBExtensionValues.SRGB8:this._gl.RGB8;case 5:return i?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8;case 8:return this._gl.R8UI;case 9:return this._gl.RG8UI;case 10:return this._gl.RGB8UI;case 11:return this._gl.RGBA8UI;case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;default:return this._gl.RGBA8}case 4:switch(t){case 8:return this._gl.R16I;case 36760:return this._gl.R16_SNORM_EXT;case 36761:return this._gl.RG16_SNORM_EXT;case 36762:return this._gl.RGB16_SNORM_EXT;case 36763:return this._gl.RGBA16_SNORM_EXT;case 9:return this._gl.RG16I;case 10:return this._gl.RGB16I;case 11:return this._gl.RGBA16I;default:return this._gl.RGBA16I}case 5:switch(t){case 8:return this._gl.R16UI;case 33322:return this._gl.R16_EXT;case 33324:return this._gl.RG16_EXT;case 32852:return this._gl.RGB16_EXT;case 32859:return this._gl.RGBA16_EXT;case 9:return this._gl.RG16UI;case 10:return this._gl.RGB16UI;case 11:return this._gl.RGBA16UI;default:return this._gl.RGBA16UI}case 6:switch(t){case 8:return this._gl.R32I;case 9:return this._gl.RG32I;case 10:return this._gl.RGB32I;case 11:return this._gl.RGBA32I;default:return this._gl.RGBA32I}case 7:switch(t){case 8:return this._gl.R32UI;case 9:return this._gl.RG32UI;case 10:return this._gl.RGB32UI;case 11:return this._gl.RGBA32UI;default:return this._gl.RGBA32UI}case 1:switch(t){case 6:return this._gl.R32F;case 7:return this._gl.RG32F;case 4:return this._gl.RGB32F;case 5:return this._gl.RGBA32F;default:return this._gl.RGBA32F}case 2:switch(t){case 6:return this._gl.R16F;case 7:return this._gl.RG16F;case 4:return this._gl.RGB16F;case 5:return this._gl.RGBA16F;default:return this._gl.RGBA16F}case 10:return this._gl.RGB565;case 13:return this._gl.R11F_G11F_B10F;case 14:return this._gl.RGB9_E5;case 8:return this._gl.RGBA4;case 9:return this._gl.RGB5_A1;case 11:switch(t){case 5:return this._gl.RGB10_A2;case 11:return this._gl.RGB10_A2UI;default:return this._gl.RGB10_A2}}return i?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8}readPixels(e,t,i,s,r=!0,a=!0,o=null){const l=r?4:3,h=r?this._gl.RGBA:this._gl.RGB,u=i*s*l;if(!o)o=new Uint8Array(u);else if(o.length<u)return U.Error(`Data buffer is too small to store the read pixels (${o.length} should be more than ${u})`),Promise.resolve(o);return a&&this.flushFramebuffer(),this._gl.readPixels(e,t,i,s,h,this._gl.UNSIGNED_BYTE,o),Promise.resolve(o)}static get IsSupportedAsync(){return Promise.resolve(this.isSupported())}static get IsSupported(){return this.isSupported()}static isSupported(){if(this._HasMajorPerformanceCaveat!==null)return!this._HasMajorPerformanceCaveat;if(this._IsSupported===null)try{const e=re._CreateCanvas(1,1),t=e.getContext("webgl")||e.getContext("experimental-webgl");this._IsSupported=t!=null&&!!window.WebGLRenderingContext}catch{this._IsSupported=!1}return this._IsSupported}static get HasMajorPerformanceCaveat(){if(this._HasMajorPerformanceCaveat===null)try{const e=re._CreateCanvas(1,1),t=e.getContext("webgl",{failIfMajorPerformanceCaveat:!0})||e.getContext("experimental-webgl",{failIfMajorPerformanceCaveat:!0});this._HasMajorPerformanceCaveat=!t}catch{this._HasMajorPerformanceCaveat=!1}return this._HasMajorPerformanceCaveat}}Fe._TempClearColorUint32=new Uint32Array(4);Fe._TempClearColorInt32=new Int32Array(4);Fe.ExceptionList=[{key:"Chrome/63.0",capture:"63\\.0\\.3239\\.(\\d+)",captureConstraint:108,targets:["uniformBuffer"]},{key:"Firefox/58",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Firefox/59",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/72.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/73.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/74.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/71",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/72",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/12\\d\\..+?Mobile",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:".*AppleWebKit.*(15.4).*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]},{key:".*(15.4).*AppleWebKit.*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]}];Fe._ConcatenateShader=j2;Fe._IsSupported=null;Fe._HasMajorPerformanceCaveat=null;const o4=Object.freeze(Object.defineProperty({__proto__:null,ThinEngine:Fe},Symbol.toStringTag,{value:"Module"}));class hv{constructor(e=30){this._enabled=!0,this._rollingFrameTime=new l4(e)}sampleFrame(e=as.Now){if(this._enabled){if(this._lastFrameTimeMs!=null){const t=e-this._lastFrameTimeMs;this._rollingFrameTime.add(t)}this._lastFrameTimeMs=e}}get averageFrameTime(){return this._rollingFrameTime.average}get averageFrameTimeVariance(){return this._rollingFrameTime.variance}get instantaneousFrameTime(){return this._rollingFrameTime.history(0)}get averageFPS(){return 1e3/this._rollingFrameTime.average}get instantaneousFPS(){const e=this._rollingFrameTime.history(0);return e===0?0:1e3/e}get isSaturated(){return this._rollingFrameTime.isSaturated()}enable(){this._enabled=!0}disable(){this._enabled=!1,this._lastFrameTimeMs=null}get isEnabled(){return this._enabled}reset(){this._lastFrameTimeMs=null,this._rollingFrameTime.reset()}}class l4{constructor(e){this._samples=new Array(e),this.reset()}add(e){let t;if(this.isSaturated()){const i=this._samples[this._pos];t=i-this.average,this.average-=t/(this._sampleCount-1),this._m2-=t*(i-this.average)}else this._sampleCount++;t=e-this.average,this.average+=t/this._sampleCount,this._m2+=t*(e-this.average),this.variance=this._m2/(this._sampleCount-1),this._samples[this._pos]=e,this._pos++,this._pos%=this._samples.length}history(e){if(e>=this._sampleCount||e>=this._samples.length)return 0;const t=this._wrapPosition(this._pos-1);return this._samples[this._wrapPosition(t-e)]}isSaturated(){return this._sampleCount>=this._samples.length}reset(){this.average=0,this.variance=0,this._sampleCount=0,this._pos=0,this._m2=0}_wrapPosition(e){const t=this._samples.length;return(e%t+t)%t}}Fe.prototype.setAlphaMode=function(n,e=!1){if(this._alphaMode===n){if(!e){const t=n===0;this.depthCullingState.depthMask!==t&&(this.depthCullingState.depthMask=t)}return}switch(n){case 0:this._alphaState.alphaBlend=!1;break;case 7:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 8:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 2:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 6:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 1:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 3:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ZERO,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 4:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_COLOR,this._gl.ZERO,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 5:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 9:this._alphaState.setAlphaBlendFunctionParameters(this._gl.CONSTANT_COLOR,this._gl.ONE_MINUS_CONSTANT_COLOR,this._gl.CONSTANT_ALPHA,this._gl.ONE_MINUS_CONSTANT_ALPHA),this._alphaState.alphaBlend=!0;break;case 10:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 11:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 12:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 13:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE_MINUS_DST_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 14:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 15:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 16:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 17:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break}e||(this.depthCullingState.depthMask=n===0),this._alphaMode=n};Fe.prototype.updateRawTexture=function(n,e,t,i,s=null,r=0,a=!1){if(!n)return;const o=this._getRGBABufferInternalSizedFormat(r,t,a),l=this._getInternalFormat(t),h=this._getWebGLTextureType(r);this._bindTextureDirectly(this._gl.TEXTURE_2D,n,!0),this._unpackFlipY(i===void 0?!0:!!i),this._doNotHandleContextLost||(n._bufferView=e,n.format=t,n.type=r,n.invertY=i,n._compression=s),n.width%4!==0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),s&&e?this._gl.compressedTexImage2D(this._gl.TEXTURE_2D,0,this.getCaps().s3tc[s],n.width,n.height,0,e):this._gl.texImage2D(this._gl.TEXTURE_2D,0,o,n.width,n.height,0,l,h,e),n.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),n.isReady=!0};Fe.prototype.createRawTexture=function(n,e,t,i,s,r,a,o=null,l=0,h=0,u=!1){const c=new gt(this,3);c.baseWidth=e,c.baseHeight=t,c.width=e,c.height=t,c.format=i,c.generateMipMaps=s,c.samplingMode=a,c.invertY=r,c._compression=o,c.type=l,c._useSRGBBuffer=this._getUseSRGBBuffer(u,!s),this._doNotHandleContextLost||(c._bufferView=n),this.updateRawTexture(c,n,i,r,o,l,c._useSRGBBuffer),this._bindTextureDirectly(this._gl.TEXTURE_2D,c,!0);const f=this._getSamplingParameters(a,s);return this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,f.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,f.min),s&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._internalTexturesCache.push(c),c};Fe.prototype.createRawCubeTexture=function(n,e,t,i,s,r,a,o=null){const l=this._gl,h=new gt(this,8);h.isCube=!0,h.format=t,h.type=i,this._doNotHandleContextLost||(h._bufferViewArray=n);const u=this._getWebGLTextureType(i);let c=this._getInternalFormat(t);c===l.RGB&&(c=l.RGBA),u===l.FLOAT&&!this._caps.textureFloatLinearFiltering?(s=!1,a=1,U.Warn("Float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively.")):u===this._gl.HALF_FLOAT_OES&&!this._caps.textureHalfFloatLinearFiltering?(s=!1,a=1,U.Warn("Half float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively.")):u===l.FLOAT&&!this._caps.textureFloatRender?(s=!1,U.Warn("Render to float textures is not supported. Mipmap generation forced to false.")):u===l.HALF_FLOAT&&!this._caps.colorBufferFloat&&(s=!1,U.Warn("Render to half float textures is not supported. Mipmap generation forced to false."));const f=e,d=f;if(h.width=f,h.height=d,h.invertY=r,h._compression=o,!this.needPOTTextures||Go(h.width)&&Go(h.height)||(s=!1),n)this.updateRawCubeTexture(h,n,t,i,r,o);else{const g=this._getRGBABufferInternalSizedFormat(i),m=0;this._bindTextureDirectly(l.TEXTURE_CUBE_MAP,h,!0);for(let v=0;v<6;v++)o?l.compressedTexImage2D(l.TEXTURE_CUBE_MAP_POSITIVE_X+v,m,this.getCaps().s3tc[o],h.width,h.height,0,void 0):l.texImage2D(l.TEXTURE_CUBE_MAP_POSITIVE_X+v,m,g,h.width,h.height,0,c,u,null);this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)}this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,h,!0),n&&s&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP);const p=this._getSamplingParameters(a,s);return l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_MAG_FILTER,p.mag),l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_MIN_FILTER,p.min),l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),this._bindTextureDirectly(l.TEXTURE_CUBE_MAP,null),h.generateMipMaps=s,h.samplingMode=a,h.isReady=!0,h};Fe.prototype.updateRawCubeTexture=function(n,e,t,i,s,r=null,a=0){n._bufferViewArray=e,n.format=t,n.type=i,n.invertY=s,n._compression=r;const o=this._gl,l=this._getWebGLTextureType(i);let h=this._getInternalFormat(t);const u=this._getRGBABufferInternalSizedFormat(i);let c=!1;h===o.RGB&&(h=o.RGBA,c=!0),this._bindTextureDirectly(o.TEXTURE_CUBE_MAP,n,!0),this._unpackFlipY(s===void 0?!0:!!s),n.width%4!==0&&o.pixelStorei(o.UNPACK_ALIGNMENT,1);for(let d=0;d<6;d++){let _=e[d];r?o.compressedTexImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+d,a,this.getCaps().s3tc[r],n.width,n.height,0,_):(c&&(_=uv(_,n.width,n.height,i)),o.texImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+d,a,u,n.width,n.height,0,h,l,_))}(!this.needPOTTextures||Go(n.width)&&Go(n.height))&&n.generateMipMaps&&a===0&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),n.isReady=!0};Fe.prototype.createRawCubeTextureFromUrl=function(n,e,t,i,s,r,a,o,l=null,h=null,u=3,c=!1){const f=this._gl,d=this.createRawCubeTexture(null,t,i,s,!r,c,u,null);e==null||e.addPendingData(d),d.url=n,d.isReady=!1,this._internalTexturesCache.push(d);const _=(g,m)=>{e==null||e.removePendingData(d),h&&g&&h(g.status+" "+g.statusText,m)},p=g=>{if(!d._hardwareTexture)return;const m=d.width,v=a(g);if(v){if(o){const T=this._getWebGLTextureType(s);let A=this._getInternalFormat(i);const b=this._getRGBABufferInternalSizedFormat(s);let x=!1;A===f.RGB&&(A=f.RGBA,x=!0),this._bindTextureDirectly(f.TEXTURE_CUBE_MAP,d,!0),this._unpackFlipY(!1);const E=o(v);for(let R=0;R<E.length;R++){const C=m>>R;for(let I=0;I<6;I++){let D=E[R][I];x&&(D=uv(D,C,C,s)),f.texImage2D(I,R,b,C,C,0,A,T,D)}}this._bindTextureDirectly(f.TEXTURE_CUBE_MAP,null)}else this.updateRawCubeTexture(d,v,i,s,c);d.isReady=!0,e==null||e.removePendingData(d),d.onLoadedObservable.notifyObservers(d),d.onLoadedObservable.clear(),l&&l()}};return this._loadFile(n,g=>{p(g)},void 0,e==null?void 0:e.offlineProvider,!0,_),d};function uv(n,e,t,i){let s,r=1;i===1?s=new Float32Array(e*t*4):i===2?(s=new Uint16Array(e*t*4),r=15360):i===7?s=new Uint32Array(e*t*4):s=new Uint8Array(e*t*4);for(let a=0;a<e;a++)for(let o=0;o<t;o++){const l=(o*e+a)*3,h=(o*e+a)*4;s[h+0]=n[l+0],s[h+1]=n[l+1],s[h+2]=n[l+2],s[h+3]=r}return s}function cv(n){return function(e,t,i,s,r,a,o,l,h=null,u=0){const c=n?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,f=n?10:11,d=new gt(this,f);d.baseWidth=t,d.baseHeight=i,d.baseDepth=s,d.width=t,d.height=i,d.depth=s,d.format=r,d.type=u,d.generateMipMaps=a,d.samplingMode=l,n?d.is3D=!0:d.is2DArray=!0,this._doNotHandleContextLost||(d._bufferView=e),n?this.updateRawTexture3D(d,e,r,o,h,u):this.updateRawTexture2DArray(d,e,r,o,h,u),this._bindTextureDirectly(c,d,!0);const _=this._getSamplingParameters(l,a);return this._gl.texParameteri(c,this._gl.TEXTURE_MAG_FILTER,_.mag),this._gl.texParameteri(c,this._gl.TEXTURE_MIN_FILTER,_.min),a&&this._gl.generateMipmap(c),this._bindTextureDirectly(c,null),this._internalTexturesCache.push(d),d}}Fe.prototype.createRawTexture2DArray=cv(!1);Fe.prototype.createRawTexture3D=cv(!0);function fv(n){return function(e,t,i,s,r=null,a=0){const o=n?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,l=this._getWebGLTextureType(a),h=this._getInternalFormat(i),u=this._getRGBABufferInternalSizedFormat(a,i);this._bindTextureDirectly(o,e,!0),this._unpackFlipY(s===void 0?!0:!!s),this._doNotHandleContextLost||(e._bufferView=t,e.format=i,e.invertY=s,e._compression=r),e.width%4!==0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),r&&t?this._gl.compressedTexImage3D(o,0,this.getCaps().s3tc[r],e.width,e.height,e.depth,0,t):this._gl.texImage3D(o,0,u,e.width,e.height,e.depth,0,h,l,t),e.generateMipMaps&&this._gl.generateMipmap(o),this._bindTextureDirectly(o,null),e.isReady=!0}}Fe.prototype.updateRawTexture2DArray=fv(!1);Fe.prototype.updateRawTexture3D=fv(!0);Fe.prototype._readTexturePixelsSync=function(n,e,t,i=-1,s=0,r=null,a=!0,o=!1,l=0,h=0){var f,d;const u=this._gl;if(!u)throw new Error("Engine does not have gl rendering context.");if(!this._dummyFramebuffer){const _=u.createFramebuffer();if(!_)throw new Error("Unable to create dummy framebuffer");this._dummyFramebuffer=_}u.bindFramebuffer(u.FRAMEBUFFER,this._dummyFramebuffer),i>-1?u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_CUBE_MAP_POSITIVE_X+i,(f=n._hardwareTexture)==null?void 0:f.underlyingResource,s):u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,(d=n._hardwareTexture)==null?void 0:d.underlyingResource,s);let c=n.type!==void 0?this._getWebGLTextureType(n.type):u.UNSIGNED_BYTE;if(o)r||(r=Sc(n.type,4*e*t));else switch(c){case u.UNSIGNED_BYTE:r||(r=new Uint8Array(4*e*t)),c=u.UNSIGNED_BYTE;break;default:r||(r=new Float32Array(4*e*t)),c=u.FLOAT;break}return a&&this.flushFramebuffer(),u.readPixels(l,h,e,t,u.RGBA,c,r),u.bindFramebuffer(u.FRAMEBUFFER,this._currentFramebuffer),r};Fe.prototype._readTexturePixels=function(n,e,t,i=-1,s=0,r=null,a=!0,o=!1,l=0,h=0){return Promise.resolve(this._readTexturePixelsSync(n,e,t,i,s,r,a,o,l,h))};Fe.prototype.updateDynamicIndexBuffer=function(n,e,t=0){this._currentBoundBuffer[this._gl.ELEMENT_ARRAY_BUFFER]=null,this.bindIndexBuffer(n);let i;n.is32Bits?i=e instanceof Uint32Array?e:new Uint32Array(e):i=e instanceof Uint16Array?e:new Uint16Array(e),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,i,this._gl.DYNAMIC_DRAW),this._resetIndexBufferBinding()};Fe.prototype.updateDynamicVertexBuffer=function(n,e,t,i){this.bindArrayBuffer(n),t===void 0&&(t=0);const s=e.byteLength||e.length;i===void 0||i>=s&&t===0?e instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,t,new Float32Array(e)):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,t,e):e instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,t,new Float32Array(e).subarray(0,i/4)):(e instanceof ArrayBuffer?e=new Uint8Array(e,0,i):e=new Uint8Array(e.buffer,e.byteOffset,i),this._gl.bufferSubData(this._gl.ARRAY_BUFFER,t,e)),this._resetVertexBufferBinding()};Fe.prototype._createDepthStencilCubeTexture=function(n,e){const t=new gt(this,12);if(t.isCube=!0,this.webGLVersion===1)return U.Error("Depth cube texture is not supported by WebGL 1."),t;const i={bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1,...e},s=this._gl;this._bindTextureDirectly(s.TEXTURE_CUBE_MAP,t,!0),this._setupDepthStencilTexture(t,n,i.bilinearFiltering,i.comparisonFunction);for(let r=0;r<6;r++)i.generateStencil?s.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+r,0,s.DEPTH24_STENCIL8,n,n,0,s.DEPTH_STENCIL,s.UNSIGNED_INT_24_8,null):s.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+r,0,s.DEPTH_COMPONENT24,n,n,0,s.DEPTH_COMPONENT,s.UNSIGNED_INT,null);return this._bindTextureDirectly(s.TEXTURE_CUBE_MAP,null),this._internalTexturesCache.push(t),t};Fe.prototype._setCubeMapTextureParams=function(n,e,t){const i=this._gl;i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MIN_FILTER,e?i.LINEAR_MIPMAP_LINEAR:i.LINEAR),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),n.samplingMode=e?3:2,e&&this.getCaps().textureMaxLevel&&t!==void 0&&t>0&&(i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MAX_LEVEL,t),n._maxLodLevel=t),this._bindTextureDirectly(i.TEXTURE_CUBE_MAP,null)};Fe.prototype.createCubeTexture=function(n,e,t,i,s=null,r=null,a,o=null,l=!1,h=0,u=0,c=null,f,d=!1,_=null){const p=this._gl;return this.createCubeTextureBase(n,e,t,!!i,s,r,a,o,l,h,u,c,g=>this._bindTextureDirectly(p.TEXTURE_CUBE_MAP,g,!0),(g,m)=>{const v=this.needPOTTextures?Yi(m[0].width,this._caps.maxCubemapTextureSize):m[0].width,T=v,A=[p.TEXTURE_CUBE_MAP_POSITIVE_X,p.TEXTURE_CUBE_MAP_POSITIVE_Y,p.TEXTURE_CUBE_MAP_POSITIVE_Z,p.TEXTURE_CUBE_MAP_NEGATIVE_X,p.TEXTURE_CUBE_MAP_NEGATIVE_Y,p.TEXTURE_CUBE_MAP_NEGATIVE_Z];this._bindTextureDirectly(p.TEXTURE_CUBE_MAP,g,!0),this._unpackFlipY(!1);const b=a?this._getInternalFormat(a,g._useSRGBBuffer):g._useSRGBBuffer?this._glSRGBExtensionValues.SRGB8_ALPHA8:p.RGBA;let x=a?this._getInternalFormat(a):p.RGBA;g._useSRGBBuffer&&this.webGLVersion===1&&(x=b);for(let E=0;E<A.length;E++)if(m[E].width!==v||m[E].height!==T){if(this._prepareWorkingCanvas(),!this._workingCanvas||!this._workingContext){U.Warn("Cannot create canvas to resize texture.");return}this._workingCanvas.width=v,this._workingCanvas.height=T,this._workingContext.drawImage(m[E],0,0,m[E].width,m[E].height,0,0,v,T),p.texImage2D(A[E],0,b,x,p.UNSIGNED_BYTE,this._workingCanvas)}else p.texImage2D(A[E],0,b,x,p.UNSIGNED_BYTE,m[E]);i||p.generateMipmap(p.TEXTURE_CUBE_MAP),this._setCubeMapTextureParams(g,!i),g.width=v,g.height=T,g.isReady=!0,a&&(g.format=a),g.onLoadedObservable.notifyObservers(g),g.onLoadedObservable.clear(),s&&s()},!!d,_)};Fe.prototype.generateMipMapsForCubemap=function(n,e=!0){if(n.generateMipMaps){const t=this._gl;this._bindTextureDirectly(t.TEXTURE_CUBE_MAP,n,!0),t.generateMipmap(t.TEXTURE_CUBE_MAP),e&&this._bindTextureDirectly(t.TEXTURE_CUBE_MAP,null)}};class dv{get depthStencilTexture(){return this._depthStencilTexture}setDepthStencilTexture(e,t=!0){t&&this._depthStencilTexture&&this._depthStencilTexture.dispose(),this._depthStencilTexture=e,this._generateDepthBuffer=this._generateStencilBuffer=this._depthStencilTextureWithStencil=!1,e&&(this._generateDepthBuffer=!0,this._generateStencilBuffer=this._depthStencilTextureWithStencil=Ia(e.format))}get depthStencilTextureWithStencil(){return this._depthStencilTextureWithStencil}get isCube(){return this._isCube}get isMulti(){return this._isMulti}get is2DArray(){return this.layers>0}get is3D(){return this.depth>0}get size(){return this.width}get width(){return this._size.width??this._size}get height(){return this._size.height??this._size}get layers(){return this._size.layers||0}get depth(){return this._size.depth||0}get texture(){var e;return((e=this._textures)==null?void 0:e[0])??null}get textures(){return this._textures}get faceIndices(){return this._faceIndices}get layerIndices(){return this._layerIndices}getBaseArrayLayer(e){var r,a;if(!this._textures)return-1;const t=this._textures[e],i=((r=this._layerIndices)==null?void 0:r[e])??0,s=((a=this._faceIndices)==null?void 0:a[e])??0;return t.isCube?i*6+s:t.is3D?0:i}get samples(){return this._samples}setSamples(e,t=!0,i=!1){if(this.samples===e&&!i)return e;const s=this._isMulti?this._engine.updateMultipleRenderTargetTextureSampleCount(this,e,t):this._engine.updateRenderTargetTextureSampleCount(this,e);return this._samples=e,s}resolveMSAATextures(){this.isMulti?this._engine.resolveMultiFramebuffer(this):this._engine.resolveFramebuffer(this)}generateMipMaps(){this._engine._currentRenderTarget===this&&this._engine.unBindFramebuffer(this,!0),this.isMulti?this._engine.generateMipMapsMultiFramebuffer(this):this._engine.generateMipMapsFramebuffer(this)}constructor(e,t,i,s,r){this._textures=null,this._faceIndices=null,this._layerIndices=null,this._samples=1,this._attachments=null,this._generateStencilBuffer=!1,this._generateDepthBuffer=!1,this._depthStencilTextureWithStencil=!1,this.disableAutomaticMSAAResolve=!1,this.resolveMSAAColors=!0,this.resolveMSAADepth=!1,this.resolveMSAAStencil=!1,this._isMulti=e,this._isCube=t,this._size=i,this._engine=s,this._depthStencilTexture=null,this.label=r}setTextures(e){Array.isArray(e)?this._textures=e:e?this._textures=[e]:this._textures=null}setTexture(e,t=0,i=!0){this._textures||(this._textures=[]),this._textures[t]!==e&&(this._textures[t]&&i&&this._textures[t].dispose(),this._textures[t]=e)}setLayerAndFaceIndices(e,t){this._layerIndices=e,this._faceIndices=t}setLayerAndFaceIndex(e=0,t,i){this._layerIndices||(this._layerIndices=[]),this._faceIndices||(this._faceIndices=[]),t!==void 0&&t>=0&&(this._layerIndices[e]=t),i!==void 0&&i>=0&&(this._faceIndices[e]=i)}createDepthStencilTexture(e=0,t=!0,i=!1,s=1,r=14,a){var o;return(o=this._depthStencilTexture)==null||o.dispose(),this._depthStencilTextureWithStencil=i,this._depthStencilTextureLabel=a,this._depthStencilTexture=this._engine.createDepthStencilTexture(this._size,{bilinearFiltering:t,comparisonFunction:e,generateStencil:i,isCube:this._isCube,samples:s,depthTextureFormat:r,label:a},this),this._depthStencilTexture}_shareDepth(e){this.shareDepth(e)}shareDepth(e){this._depthStencilTexture&&(e._depthStencilTexture&&e._depthStencilTexture.dispose(),e._depthStencilTexture=this._depthStencilTexture,e._depthStencilTextureWithStencil=this._depthStencilTextureWithStencil,this._depthStencilTexture.incrementReferences())}_swapAndDie(e){this.texture&&this.texture._swapAndDie(e),this._textures=null,this.dispose(!0)}_cloneRenderTargetWrapper(){var t,i,s,r,a;let e=null;if(this._isMulti){const o=this.textures;if(o&&o.length>0){let l=!1,h=o.length,u=-1;const c=o[o.length-1]._source;(c===14||c===12)&&(l=!0,u=o[o.length-1].format,h--);const f=[],d=[],_=[],p=[],g=[],m=[],v=[],T={};for(let x=0;x<h;++x){const E=o[x];f.push(E.samplingMode),d.push(E.type),_.push(E.format),T[E.uniqueId]!==void 0?(p.push(-1),v.push(0)):(T[E.uniqueId]=x,E.is2DArray?(p.push(35866),v.push(E.depth)):E.isCube?(p.push(34067),v.push(0)):E.is3D?(p.push(32879),v.push(E.depth)):(p.push(3553),v.push(0))),this._faceIndices&&g.push(this._faceIndices[x]??0),this._layerIndices&&m.push(this._layerIndices[x]??0)}const A={samplingModes:f,generateMipMaps:o[0].generateMipMaps,generateDepthBuffer:this._generateDepthBuffer,generateStencilBuffer:this._generateStencilBuffer,generateDepthTexture:l,depthTextureFormat:u,types:d,formats:_,textureCount:h,targetTypes:p,faceIndex:g,layerIndex:m,layerCounts:v,label:this.label},b={width:this.width,height:this.height,depth:this.depth};e=this._engine.createMultipleRenderTarget(b,A);for(let x=0;x<h;++x){if(p[x]!==-1)continue;const E=T[o[x].uniqueId];e.setTexture(e.textures[E],x)}}}else{const o={};if(o.generateDepthBuffer=this._generateDepthBuffer,o.generateMipMaps=((t=this.texture)==null?void 0:t.generateMipMaps)??!1,o.generateStencilBuffer=this._generateStencilBuffer,o.samplingMode=(i=this.texture)==null?void 0:i.samplingMode,o.type=(s=this.texture)==null?void 0:s.type,o.format=(r=this.texture)==null?void 0:r.format,o.noColorAttachment=!this._textures,o.label=this.label,this.isCube)e=this._engine.createRenderTargetCubeTexture(this.width,o);else{const l={width:this.width,height:this.height,layers:this.is2DArray||this.is3D?(a=this.texture)==null?void 0:a.depth:void 0};e=this._engine.createRenderTargetTexture(l,o)}e.texture&&(e.texture.isReady=!0)}return e}_swapRenderTargetWrapper(e){if(this._textures&&e._textures)for(let t=0;t<this._textures.length;++t)this._textures[t]._swapAndDie(e._textures[t],!1),e._textures[t].isReady=!0;this._depthStencilTexture&&e._depthStencilTexture&&(this._depthStencilTexture._swapAndDie(e._depthStencilTexture),e._depthStencilTexture.isReady=!0),this._textures=null,this._depthStencilTexture=null}_rebuild(){const e=this._cloneRenderTargetWrapper();if(e){if(this._depthStencilTexture){const t=this._depthStencilTexture.samplingMode,i=this._depthStencilTexture.format,s=t===2||t===3||t===11;e.createDepthStencilTexture(this._depthStencilTexture._comparisonFunction,s,this._depthStencilTextureWithStencil,this._depthStencilTexture.samples,i,this._depthStencilTextureLabel)}this.samples>1&&e.setSamples(this.samples),e._swapRenderTargetWrapper(this),e.dispose()}}releaseTextures(){if(this._textures)for(let e=0;e<this._textures.length;++e)this._textures[e].dispose();this._textures=null}dispose(e=!1){var t;e||((t=this._depthStencilTexture)==null||t.dispose(),this._depthStencilTexture=null,this.releaseTextures()),this._engine._releaseRenderTargetWrapper(this)}}class h4 extends dv{setDepthStencilTexture(e,t=!0){if(super.setDepthStencilTexture(e,t),!e)return;const i=this._engine,s=this._context,r=e._hardwareTexture;if(r&&e._autoMSAAManagement&&this._MSAAFramebuffer){const a=i._currentFramebuffer;i._bindUnboundFramebuffer(this._MSAAFramebuffer),s.framebufferRenderbuffer(s.FRAMEBUFFER,Ia(e.format)?s.DEPTH_STENCIL_ATTACHMENT:s.DEPTH_ATTACHMENT,s.RENDERBUFFER,r.getMSAARenderBuffer()),i._bindUnboundFramebuffer(a)}}constructor(e,t,i,s,r){super(e,t,i,s),this._framebuffer=null,this._depthStencilBuffer=null,this._MSAAFramebuffer=null,this._colorTextureArray=null,this._depthStencilTextureArray=null,this._disposeOnlyFramebuffers=!1,this._currentLOD=0,this._context=r}_cloneRenderTargetWrapper(){let e=null;return this._colorTextureArray&&this._depthStencilTextureArray?(e=this._engine.createMultiviewRenderTargetTexture(this.width,this.height),e.texture.isReady=!0):e=super._cloneRenderTargetWrapper(),e}_swapRenderTargetWrapper(e){super._swapRenderTargetWrapper(e),e._framebuffer=this._framebuffer,e._depthStencilBuffer=this._depthStencilBuffer,e._MSAAFramebuffer=this._MSAAFramebuffer,e._colorTextureArray=this._colorTextureArray,e._depthStencilTextureArray=this._depthStencilTextureArray,this._framebuffer=this._depthStencilBuffer=this._MSAAFramebuffer=this._colorTextureArray=this._depthStencilTextureArray=null}createDepthStencilTexture(e=0,t=!0,i=!1,s=1,r=14,a){if(this._depthStencilBuffer){const o=this._engine,l=o._currentFramebuffer,h=this._context;o._bindUnboundFramebuffer(this._framebuffer),h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_STENCIL_ATTACHMENT,h.RENDERBUFFER,null),h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,null),h.framebufferRenderbuffer(h.FRAMEBUFFER,h.STENCIL_ATTACHMENT,h.RENDERBUFFER,null),o._bindUnboundFramebuffer(l),h.deleteRenderbuffer(this._depthStencilBuffer),this._depthStencilBuffer=null}return super.createDepthStencilTexture(e,t,i,s,r,a)}shareDepth(e){super.shareDepth(e);const t=this._context,i=this._depthStencilBuffer,s=e._MSAAFramebuffer||e._framebuffer,r=this._engine;e._depthStencilBuffer&&e._depthStencilBuffer!==i&&t.deleteRenderbuffer(e._depthStencilBuffer),e._depthStencilBuffer=i;const a=e._generateStencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;r._bindUnboundFramebuffer(s),t.framebufferRenderbuffer(t.FRAMEBUFFER,a,t.RENDERBUFFER,i),r._bindUnboundFramebuffer(null)}_bindTextureRenderTarget(e,t=0,i,s=0){var u,c;const r=e._hardwareTexture;if(!r)return;const a=this._framebuffer,o=this._engine,l=o._currentFramebuffer;o._bindUnboundFramebuffer(a);let h;if(o.webGLVersion>1){const f=this._context;h=f["COLOR_ATTACHMENT"+t],e.is2DArray||e.is3D?(i=i??((u=this.layerIndices)==null?void 0:u[t])??0,f.framebufferTextureLayer(f.FRAMEBUFFER,h,r.underlyingResource,s,i)):e.isCube?(i=i??((c=this.faceIndices)==null?void 0:c[t])??0,f.framebufferTexture2D(f.FRAMEBUFFER,h,f.TEXTURE_CUBE_MAP_POSITIVE_X+i,r.underlyingResource,s)):f.framebufferTexture2D(f.FRAMEBUFFER,h,f.TEXTURE_2D,r.underlyingResource,s)}else{const f=this._context;h=f["COLOR_ATTACHMENT"+t+"_WEBGL"];const d=i!==void 0?f.TEXTURE_CUBE_MAP_POSITIVE_X+i:f.TEXTURE_2D;f.framebufferTexture2D(f.FRAMEBUFFER,h,d,r.underlyingResource,s)}if(e._autoMSAAManagement&&this._MSAAFramebuffer){const f=this._context;o._bindUnboundFramebuffer(this._MSAAFramebuffer),f.framebufferRenderbuffer(f.FRAMEBUFFER,h,f.RENDERBUFFER,r.getMSAARenderBuffer())}o._bindUnboundFramebuffer(l)}setTexture(e,t=0,i=!0){super.setTexture(e,t,i),this._bindTextureRenderTarget(e,t)}setLayerAndFaceIndices(e,t){var s;if(super.setLayerAndFaceIndices(e,t),!this.textures||!this.layerIndices||!this.faceIndices)return;const i=((s=this._attachments)==null?void 0:s.length)??this.textures.length;for(let r=0;r<i;r++){const a=this.textures[r];a&&(a.is2DArray||a.is3D?this._bindTextureRenderTarget(a,r,this.layerIndices[r]):a.isCube?this._bindTextureRenderTarget(a,r,this.faceIndices[r]):this._bindTextureRenderTarget(a,r))}}setLayerAndFaceIndex(e=0,t,i){if(super.setLayerAndFaceIndex(e,t,i),!this.textures||!this.layerIndices||!this.faceIndices)return;const s=this.textures[e];s.is2DArray||s.is3D?this._bindTextureRenderTarget(this.textures[e],e,this.layerIndices[e]):s.isCube&&this._bindTextureRenderTarget(this.textures[e],e,this.faceIndices[e])}resolveMSAATextures(){const e=this._engine,t=e._currentFramebuffer;e._bindUnboundFramebuffer(this._MSAAFramebuffer),super.resolveMSAATextures(),e._bindUnboundFramebuffer(t)}dispose(e=this._disposeOnlyFramebuffers){const t=this._context;e||(this._colorTextureArray&&(this._context.deleteTexture(this._colorTextureArray),this._colorTextureArray=null),this._depthStencilTextureArray&&(this._context.deleteTexture(this._depthStencilTextureArray),this._depthStencilTextureArray=null)),this._framebuffer&&(t.deleteFramebuffer(this._framebuffer),this._framebuffer=null),this._depthStencilBuffer&&(t.deleteRenderbuffer(this._depthStencilBuffer),this._depthStencilBuffer=null),this._MSAAFramebuffer&&(t.deleteFramebuffer(this._MSAAFramebuffer),this._MSAAFramebuffer=null),super.dispose(e)}}re.prototype.createDepthStencilTexture=function(n,e,t){if(e.isCube){const i=n.width||n;return this._createDepthStencilCubeTexture(i,e)}else return this._createDepthStencilTexture(n,e,t)};Fe.prototype._createHardwareRenderTargetWrapper=function(n,e,t){const i=new h4(n,e,t,this,this._gl);return this._renderTargetWrapperCache.push(i),i};Fe.prototype.createRenderTargetTexture=function(n,e){const t=this._createHardwareRenderTargetWrapper(!1,!1,n);let i=!0,s=!1,r=!1,a,o=1,l;e!==void 0&&typeof e=="object"&&(i=e.generateDepthBuffer??!0,s=!!e.generateStencilBuffer,r=!!e.noColorAttachment,a=e.colorAttachment,o=e.samples??1,l=e.label);const h=a||(r?null:this._createInternalTexture(n,e,!0,5)),u=n.width||n,c=n.height||n,f=this._currentFramebuffer,d=this._gl,_=d.createFramebuffer();if(this._bindUnboundFramebuffer(_),t._depthStencilBuffer=this._setupFramebufferDepthAttachments(s,i,u,c),h&&!h.is2DArray&&!h.is3D&&d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,h._hardwareTexture.underlyingResource,0),this._bindUnboundFramebuffer(f),t.label=l??"RenderTargetWrapper",t._framebuffer=_,t._generateDepthBuffer=i,t._generateStencilBuffer=s,t.setTextures(h),!a)this.updateRenderTargetTextureSampleCount(t,o);else if(t._samples=a.samples,a.samples>1){const p=a._hardwareTexture.getMSAARenderBuffer(0);t._MSAAFramebuffer=d.createFramebuffer(),this._bindUnboundFramebuffer(t._MSAAFramebuffer),d.framebufferRenderbuffer(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.RENDERBUFFER,p),this._bindUnboundFramebuffer(null)}return t};Fe.prototype._createDepthStencilTexture=function(n,e,t){const i=this._gl,s=n.layers||0,r=n.depth||0;let a=i.TEXTURE_2D;s!==0?a=i.TEXTURE_2D_ARRAY:r!==0&&(a=i.TEXTURE_3D);const o=new gt(this,12);if(o.label=e.label,!this._caps.depthTextureExtension)return U.Error("Depth texture is not supported by your browser or hardware."),o;const l={bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1,...e};if(this._bindTextureDirectly(a,o,!0),this._setupDepthStencilTexture(o,n,l.comparisonFunction===0?!1:l.bilinearFiltering,l.comparisonFunction,l.samples),l.depthTextureFormat!==void 0){if(l.depthTextureFormat!==15&&l.depthTextureFormat!==16&&l.depthTextureFormat!==17&&l.depthTextureFormat!==13&&l.depthTextureFormat!==14&&l.depthTextureFormat!==18)return U.Error(`Depth texture ${l.depthTextureFormat} format is not supported.`),o;o.format=l.depthTextureFormat}else o.format=l.generateStencil?13:16;const h=Ia(o.format),u=this._getWebGLTextureTypeFromDepthTextureFormat(o.format),c=h?i.DEPTH_STENCIL:i.DEPTH_COMPONENT,f=this._getInternalFormatFromDepthTextureFormat(o.format,!0,h);return o.is2DArray?i.texImage3D(a,0,f,o.width,o.height,s,0,c,u,null):o.is3D?i.texImage3D(a,0,f,o.width,o.height,r,0,c,u,null):i.texImage2D(a,0,f,o.width,o.height,0,c,u,null),this._bindTextureDirectly(a,null),this._internalTexturesCache.push(o),t._depthStencilBuffer&&(i.deleteRenderbuffer(t._depthStencilBuffer),t._depthStencilBuffer=null),this._bindUnboundFramebuffer(t._MSAAFramebuffer??t._framebuffer),t._generateStencilBuffer=h,t._depthStencilTextureWithStencil=h,t._depthStencilBuffer=this._setupFramebufferDepthAttachments(t._generateStencilBuffer,t._generateDepthBuffer,t.width,t.height,t.samples,o.format),this._bindUnboundFramebuffer(null),o};Fe.prototype.updateRenderTargetTextureSampleCount=function(n,e){var r;if(this.webGLVersion<2||!n)return 1;if(n.samples===e)return e;const t=this._gl;e=Math.min(e,this.getCaps().maxMSAASamples),n._depthStencilBuffer&&(t.deleteRenderbuffer(n._depthStencilBuffer),n._depthStencilBuffer=null),n._MSAAFramebuffer&&(t.deleteFramebuffer(n._MSAAFramebuffer),n._MSAAFramebuffer=null);const i=(r=n.texture)==null?void 0:r._hardwareTexture;if(i==null||i.releaseMSAARenderBuffers(),n.texture&&e>1&&typeof t.renderbufferStorageMultisample=="function"){const a=t.createFramebuffer();if(!a)throw new Error("Unable to create multi sampled framebuffer");n._MSAAFramebuffer=a,this._bindUnboundFramebuffer(n._MSAAFramebuffer);const o=this._createRenderBuffer(n.texture.width,n.texture.height,e,-1,this._getRGBABufferInternalSizedFormat(n.texture.type,n.texture.format,n.texture._useSRGBBuffer),t.COLOR_ATTACHMENT0,!1);if(!o)throw new Error("Unable to create multi sampled framebuffer");i==null||i.addMSAARenderBuffer(o)}this._bindUnboundFramebuffer(n._MSAAFramebuffer??n._framebuffer),n.texture&&(n.texture.samples=e),n._samples=e;const s=n._depthStencilTexture?n._depthStencilTexture.format:void 0;return n._depthStencilBuffer=this._setupFramebufferDepthAttachments(n._generateStencilBuffer,n._generateDepthBuffer,n.width,n.height,e,s),this._bindUnboundFramebuffer(null),e};Fe.prototype._setupDepthStencilTexture=function(n,e,t,i,s=1){const r=e.width??e,a=e.height??e,o=e.layers||0,l=e.depth||0;n.baseWidth=r,n.baseHeight=a,n.width=r,n.height=a,n.is2DArray=o>0,n.depth=o||l,n.isReady=!0,n.samples=s,n.generateMipMaps=!1,n.samplingMode=t?2:1,n.type=0,n._comparisonFunction=i;const h=this._gl,u=this._getTextureTarget(n),c=this._getSamplingParameters(n.samplingMode,!1);h.texParameteri(u,h.TEXTURE_MAG_FILTER,c.mag),h.texParameteri(u,h.TEXTURE_MIN_FILTER,c.min),h.texParameteri(u,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(u,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),this.webGLVersion>1&&(i===0?(h.texParameteri(u,h.TEXTURE_COMPARE_FUNC,515),h.texParameteri(u,h.TEXTURE_COMPARE_MODE,h.NONE)):(h.texParameteri(u,h.TEXTURE_COMPARE_FUNC,i),h.texParameteri(u,h.TEXTURE_COMPARE_MODE,h.COMPARE_REF_TO_TEXTURE)))};Fe.prototype.setDepthStencilTexture=function(n,e,t,i){n!==void 0&&(e&&(this._boundUniforms[n]=e),!t||!t.depthStencilTexture?this._setTexture(n,null,void 0,void 0,i):this._setTexture(n,t,!1,!0,i))};Fe.prototype.createRenderTargetCubeTexture=function(n,e){const t=this._createHardwareRenderTargetWrapper(!1,!0,n),i={generateMipMaps:!0,generateDepthBuffer:!0,generateStencilBuffer:!1,type:0,samplingMode:3,format:5,...e};i.generateStencilBuffer=i.generateDepthBuffer&&i.generateStencilBuffer,(i.type===1&&!this._caps.textureFloatLinearFiltering||i.type===2&&!this._caps.textureHalfFloatLinearFiltering)&&(i.samplingMode=1);const s=this._gl,r=new gt(this,5);this._bindTextureDirectly(s.TEXTURE_CUBE_MAP,r,!0);const a=this._getSamplingParameters(i.samplingMode,i.generateMipMaps);i.type===1&&!this._caps.textureFloat&&(i.type=0,U.Warn("Float textures are not supported. Cube render target forced to TEXTURETYPE_UNESIGNED_BYTE type")),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MAG_FILTER,a.mag),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MIN_FILTER,a.min),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE);for(let l=0;l<6;l++)s.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+l,0,this._getRGBABufferInternalSizedFormat(i.type,i.format),n,n,0,this._getInternalFormat(i.format),this._getWebGLTextureType(i.type),null);const o=s.createFramebuffer();return this._bindUnboundFramebuffer(o),t._depthStencilBuffer=this._setupFramebufferDepthAttachments(i.generateStencilBuffer,i.generateDepthBuffer,n,n),i.generateMipMaps&&s.generateMipmap(s.TEXTURE_CUBE_MAP),this._bindTextureDirectly(s.TEXTURE_CUBE_MAP,null),this._bindUnboundFramebuffer(null),t._framebuffer=o,t._generateDepthBuffer=i.generateDepthBuffer,t._generateStencilBuffer=i.generateStencilBuffer,r.width=n,r.height=n,r.isReady=!0,r.isCube=!0,r.samples=1,r.generateMipMaps=i.generateMipMaps,r.samplingMode=i.samplingMode,r.type=i.type,r.format=i.format,this._internalTexturesCache.push(r),t.setTextures(r),t};const u4=1/2.2,c4=2.2,It=(1+Math.sqrt(5))/2,Ue=.001;function Ws(n,e){const t=[];for(let i=0;i<n;++i)t.push(e());return t}function sr(n,e){return Ws(n,e)}function f4(n,e,t){const i=n[e];if(typeof i!="function")return null;const s=function(){const r=n.length,a=s.previous.apply(n,arguments);return t(e,r),a};return i.next=s,s.previous=i,n[e]=s,()=>{const r=s.previous;if(!r)return;const a=s.next;a?(r.next=a,a.previous=r):(r.next=void 0,n[e]=r),s.next=void 0,s.previous=void 0}}const d4=["push","splice","pop","shift","unshift"];function _v(n,e){const t=d4.map(i=>f4(n,i,e));return()=>{t.forEach(i=>{i==null||i()})}}const pv={};function Tt(n,e){pv[n]=e}function Zn(n){return pv[n]}function Qe(n,e,t=1401298e-51){return Math.abs(n-e)<=t}function xt(n,e){return n===e?n:Math.random()*(e-n)+n}function Bl(n,e,t){return n+(e-n)*t}function _4(n,e,t,i,s){const r=s*s,a=s*r,o=2*a-3*r+1,l=-2*a+3*r,h=a-2*r+s,u=a-r;return n*o+t*l+e*h+i*u}function lt(n,e=0,t=1){return Math.min(t,Math.max(e,n))}function p4(n){return n-=Math.PI*2*Math.floor((n+Math.PI)/(Math.PI*2)),n}function Bs(n){const e=n.toString(16);return n<=15?("0"+e).toUpperCase():e.toUpperCase()}function gv(n){if(Math.log2)return Math.floor(Math.log2(n));if(n<0)return NaN;if(n===0)return-1/0;let e=0;if(n<1){for(;n<1;)e++,n=n*2;e=-e}else if(n>1)for(;n>1;)e++,n=Math.floor(n/2);return e}function Pc(n,e){const t=n%e;return t===0?e:Pc(e,t)}const bi=n=>parseInt(n.toString().replace(/\W/g,""));class ne{constructor(e=0,t=0){this.x=e,this.y=t}toString(){return`{X: ${this.x} Y: ${this.y}}`}getClassName(){return"Vector2"}getHashCode(){const e=bi(this.x),t=bi(this.y);let i=e;return i=i*397^t,i}toArray(e,t=0){return e[t]=this.x,e[t+1]=this.y,this}fromArray(e,t=0){return ne.FromArrayToRef(e,t,this),this}asArray(){return[this.x,this.y]}copyFrom(e){return this.x=e.x,this.y=e.y,this}copyFromFloats(e,t){return this.x=e,this.y=t,this}set(e,t){return this.copyFromFloats(e,t)}setAll(e){return this.copyFromFloats(e,e)}add(e){return new ne(this.x+e.x,this.y+e.y)}addToRef(e,t){return t.x=this.x+e.x,t.y=this.y+e.y,t}addInPlace(e){return this.x+=e.x,this.y+=e.y,this}addInPlaceFromFloats(e,t){return this.x+=e,this.y+=t,this}addVector3(e){return new ne(this.x+e.x,this.y+e.y)}subtract(e){return new ne(this.x-e.x,this.y-e.y)}subtractToRef(e,t){return t.x=this.x-e.x,t.y=this.y-e.y,t}subtractInPlace(e){return this.x-=e.x,this.y-=e.y,this}multiplyInPlace(e){return this.x*=e.x,this.y*=e.y,this}multiply(e){return new ne(this.x*e.x,this.y*e.y)}multiplyToRef(e,t){return t.x=this.x*e.x,t.y=this.y*e.y,t}multiplyByFloats(e,t){return new ne(this.x*e,this.y*t)}divide(e){return new ne(this.x/e.x,this.y/e.y)}divideToRef(e,t){return t.x=this.x/e.x,t.y=this.y/e.y,t}divideInPlace(e){return this.x=this.x/e.x,this.y=this.y/e.y,this}minimizeInPlace(e){return this.minimizeInPlaceFromFloats(e.x,e.y)}maximizeInPlace(e){return this.maximizeInPlaceFromFloats(e.x,e.y)}minimizeInPlaceFromFloats(e,t){return this.x=Math.min(e,this.x),this.y=Math.min(t,this.y),this}maximizeInPlaceFromFloats(e,t){return this.x=Math.max(e,this.x),this.y=Math.max(t,this.y),this}subtractFromFloats(e,t){return new ne(this.x-e,this.y-t)}subtractFromFloatsToRef(e,t,i){return i.x=this.x-e,i.y=this.y-t,i}negate(){return new ne(-this.x,-this.y)}negateInPlace(){return this.x*=-1,this.y*=-1,this}negateToRef(e){return e.x=-this.x,e.y=-this.y,e}scaleInPlace(e){return this.x*=e,this.y*=e,this}scale(e){return new ne(this.x*e,this.y*e)}scaleToRef(e,t){return t.x=this.x*e,t.y=this.y*e,t}scaleAndAddToRef(e,t){return t.x+=this.x*e,t.y+=this.y*e,t}equals(e){return e&&this.x===e.x&&this.y===e.y}equalsWithEpsilon(e,t=Ue){return e&&Qe(this.x,e.x,t)&&Qe(this.y,e.y,t)}equalsToFloats(e,t){return this.x===e&&this.y===t}floor(){return new ne(Math.floor(this.x),Math.floor(this.y))}floorToRef(e){return e.x=Math.floor(this.x),e.y=Math.floor(this.y),e}fract(){return new ne(this.x-Math.floor(this.x),this.y-Math.floor(this.y))}fractToRef(e){return e.x=this.x-Math.floor(this.x),e.y=this.y-Math.floor(this.y),e}rotateToRef(e,t){const i=Math.cos(e),s=Math.sin(e),r=i*this.x-s*this.y,a=s*this.x+i*this.y;return t.x=r,t.y=a,t}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}lengthSquared(){return this.x*this.x+this.y*this.y}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(e){return e===0||e===1?this:this.scaleInPlace(1/e)}normalizeToNew(){const e=new ne;return this.normalizeToRef(e),e}normalizeToRef(e){const t=this.length();return t===0&&(e.x=this.x,e.y=this.y),this.scaleToRef(1/t,e)}clone(){return new ne(this.x,this.y)}dot(e){return this.x*e.x+this.y*e.y}static Zero(){return new ne(0,0)}static One(){return new ne(1,1)}static Random(e=0,t=1){return new ne(xt(e,t),xt(e,t))}static RandomToRef(e=0,t=1,i){return i.copyFromFloats(xt(e,t),xt(e,t))}static get ZeroReadOnly(){return ne._ZeroReadOnly}static FromArray(e,t=0){return new ne(e[t],e[t+1])}static FromArrayToRef(e,t,i){return i.x=e[t],i.y=e[t+1],i}static FromFloatsToRef(e,t,i){return i.copyFromFloats(e,t),i}static CatmullRom(e,t,i,s,r){const a=r*r,o=r*a,l=.5*(2*t.x+(-e.x+i.x)*r+(2*e.x-5*t.x+4*i.x-s.x)*a+(-e.x+3*t.x-3*i.x+s.x)*o),h=.5*(2*t.y+(-e.y+i.y)*r+(2*e.y-5*t.y+4*i.y-s.y)*a+(-e.y+3*t.y-3*i.y+s.y)*o);return new ne(l,h)}static ClampToRef(e,t,i,s){return s.x=lt(e.x,t.x,i.x),s.y=lt(e.y,t.y,i.y),s}static Clamp(e,t,i){const s=lt(e.x,t.x,i.x),r=lt(e.y,t.y,i.y);return new ne(s,r)}static Hermite(e,t,i,s,r){const a=r*r,o=r*a,l=2*o-3*a+1,h=-2*o+3*a,u=o-2*a+r,c=o-a,f=e.x*l+i.x*h+t.x*u+s.x*c,d=e.y*l+i.y*h+t.y*u+s.y*c;return new ne(f,d)}static Hermite1stDerivative(e,t,i,s,r){return this.Hermite1stDerivativeToRef(e,t,i,s,r,new ne)}static Hermite1stDerivativeToRef(e,t,i,s,r,a){const o=r*r;return a.x=(o-r)*6*e.x+(3*o-4*r+1)*t.x+(-o+r)*6*i.x+(3*o-2*r)*s.x,a.y=(o-r)*6*e.y+(3*o-4*r+1)*t.y+(-o+r)*6*i.y+(3*o-2*r)*s.y,a}static Lerp(e,t,i){return ne.LerpToRef(e,t,i,new ne)}static LerpToRef(e,t,i,s){return s.x=e.x+(t.x-e.x)*i,s.y=e.y+(t.y-e.y)*i,s}static Dot(e,t){return e.x*t.x+e.y*t.y}static Normalize(e){return ne.NormalizeToRef(e,new ne)}static NormalizeToRef(e,t){return e.normalizeToRef(t),t}static Minimize(e,t){const i=e.x<t.x?e.x:t.x,s=e.y<t.y?e.y:t.y;return new ne(i,s)}static Maximize(e,t){const i=e.x>t.x?e.x:t.x,s=e.y>t.y?e.y:t.y;return new ne(i,s)}static Transform(e,t){return ne.TransformToRef(e,t,new ne)}static TransformToRef(e,t,i){const s=t.m,r=e.x*s[0]+e.y*s[4]+s[12],a=e.x*s[1]+e.y*s[5]+s[13];return i.x=r,i.y=a,i}static PointInTriangle(e,t,i,s){const r=.5*(-i.y*s.x+t.y*(-i.x+s.x)+t.x*(i.y-s.y)+i.x*s.y),a=r<0?-1:1,o=(t.y*s.x-t.x*s.y+(s.y-t.y)*e.x+(t.x-s.x)*e.y)*a,l=(t.x*i.y-t.y*i.x+(t.y-i.y)*e.x+(i.x-t.x)*e.y)*a;return o>0&&l>0&&o+l<2*r*a}static Distance(e,t){return Math.sqrt(ne.DistanceSquared(e,t))}static DistanceSquared(e,t){const i=e.x-t.x,s=e.y-t.y;return i*i+s*s}static Center(e,t){return ne.CenterToRef(e,t,new ne)}static CenterToRef(e,t,i){return i.copyFromFloats((e.x+t.x)/2,(e.y+t.y)/2)}static DistanceOfPointFromSegment(e,t,i){const s=ne.DistanceSquared(t,i);if(s===0)return ne.Distance(e,t);const r=i.subtract(t),a=Math.max(0,Math.min(1,ne.Dot(e.subtract(t),r)/s)),o=t.add(r.multiplyByFloats(a,a));return ne.Distance(e,o)}}ne._V8PerformanceHack=new ne(.5,.5);ne._ZeroReadOnly=ne.Zero();Object.defineProperties(ne.prototype,{dimension:{value:[2]},rank:{value:1}});class y{get x(){return this._x}set x(e){this._x=e,this._isDirty=!0}get y(){return this._y}set y(e){this._y=e,this._isDirty=!0}get z(){return this._z}set z(e){this._z=e,this._isDirty=!0}constructor(e=0,t=0,i=0){this._isDirty=!0,this._x=e,this._y=t,this._z=i}toString(){return`{X: ${this._x} Y: ${this._y} Z: ${this._z}}`}getClassName(){return"Vector3"}getHashCode(){const e=bi(this._x),t=bi(this._y),i=bi(this._z);let s=e;return s=s*397^t,s=s*397^i,s}asArray(){return[this._x,this._y,this._z]}toArray(e,t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,this}fromArray(e,t=0){return y.FromArrayToRef(e,t,this),this}toQuaternion(){return se.RotationYawPitchRoll(this._y,this._x,this._z)}addInPlace(e){return this._x+=e._x,this._y+=e._y,this._z+=e._z,this._isDirty=!0,this}addInPlaceFromFloats(e,t,i){return this._x+=e,this._y+=t,this._z+=i,this._isDirty=!0,this}add(e){return new y(this._x+e._x,this._y+e._y,this._z+e._z)}addToRef(e,t){return t._x=this._x+e._x,t._y=this._y+e._y,t._z=this._z+e._z,t._isDirty=!0,t}subtractInPlace(e){return this._x-=e._x,this._y-=e._y,this._z-=e._z,this._isDirty=!0,this}subtract(e){return new y(this._x-e._x,this._y-e._y,this._z-e._z)}subtractToRef(e,t){return this.subtractFromFloatsToRef(e._x,e._y,e._z,t)}subtractFromFloats(e,t,i){return new y(this._x-e,this._y-t,this._z-i)}subtractFromFloatsToRef(e,t,i,s){return s._x=this._x-e,s._y=this._y-t,s._z=this._z-i,s._isDirty=!0,s}negate(){return new y(-this._x,-this._y,-this._z)}negateInPlace(){return this._x*=-1,this._y*=-1,this._z*=-1,this._isDirty=!0,this}negateToRef(e){return e._x=this._x*-1,e._y=this._y*-1,e._z=this._z*-1,e._isDirty=!0,e}scaleInPlace(e){return this._x*=e,this._y*=e,this._z*=e,this._isDirty=!0,this}scale(e){return new y(this._x*e,this._y*e,this._z*e)}scaleToRef(e,t){return t._x=this._x*e,t._y=this._y*e,t._z=this._z*e,t._isDirty=!0,t}getNormalToRef(e){const t=this.length();let i=Math.acos(this.y/t);const s=Math.atan2(this.z,this.x);i>Math.PI/2?i-=Math.PI/2:i+=Math.PI/2;const r=t*Math.sin(i)*Math.cos(s),a=t*Math.cos(i),o=t*Math.sin(i)*Math.sin(s);return e.set(r,a,o),e}applyRotationQuaternionToRef(e,t){const i=this._x,s=this._y,r=this._z,a=e._x,o=e._y,l=e._z,h=e._w,u=2*(o*r-l*s),c=2*(l*i-a*r),f=2*(a*s-o*i);return t._x=i+h*u+o*f-l*c,t._y=s+h*c+l*u-a*f,t._z=r+h*f+a*c-o*u,t._isDirty=!0,t}applyRotationQuaternionInPlace(e){return this.applyRotationQuaternionToRef(e,this)}applyRotationQuaternion(e){return this.applyRotationQuaternionToRef(e,new y)}scaleAndAddToRef(e,t){return t._x+=this._x*e,t._y+=this._y*e,t._z+=this._z*e,t._isDirty=!0,t}projectOnPlane(e,t){return this.projectOnPlaneToRef(e,t,new y)}projectOnPlaneToRef(e,t,i){const s=e.normal,r=e.d,a=de.Vector3[0];this.subtractToRef(t,a),a.normalize();const o=y.Dot(a,s);if(Math.abs(o)<1e-10)i.setAll(1/0);else{const l=-(y.Dot(t,s)+r)/o,h=a.scaleInPlace(l);t.addToRef(h,i)}return i}equals(e){return e&&this._x===e._x&&this._y===e._y&&this._z===e._z}equalsWithEpsilon(e,t=Ue){return e&&Qe(this._x,e._x,t)&&Qe(this._y,e._y,t)&&Qe(this._z,e._z,t)}equalsToFloats(e,t,i){return this._x===e&&this._y===t&&this._z===i}multiplyInPlace(e){return this._x*=e._x,this._y*=e._y,this._z*=e._z,this._isDirty=!0,this}multiply(e){return this.multiplyByFloats(e._x,e._y,e._z)}multiplyToRef(e,t){return t._x=this._x*e._x,t._y=this._y*e._y,t._z=this._z*e._z,t._isDirty=!0,t}multiplyByFloats(e,t,i){return new y(this._x*e,this._y*t,this._z*i)}divide(e){return new y(this._x/e._x,this._y/e._y,this._z/e._z)}divideToRef(e,t){return t._x=this._x/e._x,t._y=this._y/e._y,t._z=this._z/e._z,t._isDirty=!0,t}divideInPlace(e){return this._x=this._x/e._x,this._y=this._y/e._y,this._z=this._z/e._z,this._isDirty=!0,this}minimizeInPlace(e){return this.minimizeInPlaceFromFloats(e._x,e._y,e._z)}maximizeInPlace(e){return this.maximizeInPlaceFromFloats(e._x,e._y,e._z)}minimizeInPlaceFromFloats(e,t,i){return e<this._x&&(this.x=e),t<this._y&&(this.y=t),i<this._z&&(this.z=i),this}maximizeInPlaceFromFloats(e,t,i){return e>this._x&&(this.x=e),t>this._y&&(this.y=t),i>this._z&&(this.z=i),this}isNonUniformWithinEpsilon(e){const t=Math.abs(this._x),i=Math.abs(this._y);if(!Qe(t,i,e))return!0;const s=Math.abs(this._z);return!Qe(t,s,e)||!Qe(i,s,e)}get isNonUniform(){const e=Math.abs(this._x),t=Math.abs(this._y);if(e!==t)return!0;const i=Math.abs(this._z);return e!==i}floorToRef(e){return e._x=Math.floor(this._x),e._y=Math.floor(this._y),e._z=Math.floor(this._z),e._isDirty=!0,e}floor(){return new y(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))}fractToRef(e){return e._x=this.x-Math.floor(this._x),e._y=this.y-Math.floor(this._y),e._z=this.z-Math.floor(this._z),e._isDirty=!0,e}fract(){return new y(this.x-Math.floor(this._x),this.y-Math.floor(this._y),this.z-Math.floor(this._z))}length(){return Math.sqrt(this.lengthSquared())}lengthSquared(){return this._x*this._x+this._y*this._y+this._z*this._z}get hasAZeroComponent(){return this._x*this._y*this._z===0}normalize(){return this.normalizeFromLength(this.length())}reorderInPlace(e){if(e=e.toLowerCase(),e==="xyz")return this;const t=de.Vector3[0].copyFrom(this);return this.x=t[e[0]],this.y=t[e[1]],this.z=t[e[2]],this}rotateByQuaternionToRef(e,t){return e.toRotationMatrix(de.Matrix[0]),y.TransformCoordinatesToRef(this,de.Matrix[0],t),t}rotateByQuaternionAroundPointToRef(e,t,i){return this.subtractToRef(t,de.Vector3[0]),de.Vector3[0].rotateByQuaternionToRef(e,de.Vector3[0]),t.addToRef(de.Vector3[0],i),i}cross(e){return y.CrossToRef(this,e,new y)}normalizeFromLength(e){return e===0||e===1?this:this.scaleInPlace(1/e)}normalizeToNew(){return this.normalizeToRef(new y)}normalizeToRef(e){const t=this.length();return t===0||t===1?(e._x=this._x,e._y=this._y,e._z=this._z,e._isDirty=!0,e):this.scaleToRef(1/t,e)}clone(){return new y(this._x,this._y,this._z)}copyFrom(e){return this.copyFromFloats(e._x,e._y,e._z)}copyFromFloats(e,t,i){return this._x=e,this._y=t,this._z=i,this._isDirty=!0,this}set(e,t,i){return this.copyFromFloats(e,t,i)}setAll(e){return this._x=this._y=this._z=e,this._isDirty=!0,this}static GetClipFactor(e,t,i,s){const r=y.Dot(e,i),a=y.Dot(t,i);return(r-s)/(r-a)}static GetAngleBetweenVectors(e,t,i){const s=e.normalizeToRef(de.Vector3[1]),r=t.normalizeToRef(de.Vector3[2]);let a=y.Dot(s,r);a=lt(a,-1,1);const o=Math.acos(a),l=de.Vector3[3];return y.CrossToRef(s,r,l),y.Dot(l,i)>0?isNaN(o)?0:o:isNaN(o)?-Math.PI:-Math.acos(a)}static GetAngleBetweenVectorsOnPlane(e,t,i){de.Vector3[0].copyFrom(e);const s=de.Vector3[0];de.Vector3[1].copyFrom(t);const r=de.Vector3[1];de.Vector3[2].copyFrom(i);const a=de.Vector3[2],o=de.Vector3[3],l=de.Vector3[4];s.normalize(),r.normalize(),a.normalize(),y.CrossToRef(a,s,o),y.CrossToRef(o,a,l);const h=Math.atan2(y.Dot(r,o),y.Dot(r,l));return p4(h)}static PitchYawRollToMoveBetweenPointsToRef(e,t,i){const s=N.Vector3[0];return t.subtractToRef(e,s),i._y=Math.atan2(s.x,s.z)||0,i._x=Math.atan2(Math.sqrt(s.x**2+s.z**2),s.y)||0,i._z=0,i._isDirty=!0,i}static PitchYawRollToMoveBetweenPoints(e,t){const i=y.Zero();return y.PitchYawRollToMoveBetweenPointsToRef(e,t,i)}static SlerpToRef(e,t,i,s){i=lt(i,0,1);const r=de.Vector3[0],a=de.Vector3[1];r.copyFrom(e);const o=r.length();r.normalizeFromLength(o),a.copyFrom(t);const l=a.length();a.normalizeFromLength(l);const h=y.Dot(r,a);let u,c;if(h<1-Ue){const f=Math.acos(h),d=1/Math.sin(f);u=Math.sin((1-i)*f)*d,c=Math.sin(i*f)*d}else u=1-i,c=i;return r.scaleInPlace(u),a.scaleInPlace(c),s.copyFrom(r).addInPlace(a),s.scaleInPlace(Bl(o,l,i)),s}static SmoothToRef(e,t,i,s,r){return y.SlerpToRef(e,t,s===0?1:i/s,r),r}static FromArray(e,t=0){return new y(e[t],e[t+1],e[t+2])}static FromFloatArray(e,t){return y.FromArray(e,t)}static FromArrayToRef(e,t,i){return i._x=e[t],i._y=e[t+1],i._z=e[t+2],i._isDirty=!0,i}static FromFloatArrayToRef(e,t,i){return y.FromArrayToRef(e,t,i)}static FromFloatsToRef(e,t,i,s){return s.copyFromFloats(e,t,i),s}static Zero(){return new y(0,0,0)}static One(){return new y(1,1,1)}static Up(){return new y(0,1,0)}static get UpReadOnly(){return y._UpReadOnly}static get DownReadOnly(){return y._DownReadOnly}static get RightReadOnly(){return y._RightReadOnly}static get LeftReadOnly(){return y._LeftReadOnly}static get LeftHandedForwardReadOnly(){return y._LeftHandedForwardReadOnly}static get RightHandedForwardReadOnly(){return y._RightHandedForwardReadOnly}static get LeftHandedBackwardReadOnly(){return y._LeftHandedBackwardReadOnly}static get RightHandedBackwardReadOnly(){return y._RightHandedBackwardReadOnly}static get ZeroReadOnly(){return y._ZeroReadOnly}static get OneReadOnly(){return y._OneReadOnly}static Down(){return new y(0,-1,0)}static Forward(e=!1){return new y(0,0,e?-1:1)}static Backward(e=!1){return new y(0,0,e?1:-1)}static Right(){return new y(1,0,0)}static Left(){return new y(-1,0,0)}static Random(e=0,t=1){return new y(xt(e,t),xt(e,t),xt(e,t))}static RandomToRef(e=0,t=1,i){return i.copyFromFloats(xt(e,t),xt(e,t),xt(e,t))}static TransformCoordinates(e,t){const i=y.Zero();return y.TransformCoordinatesToRef(e,t,i),i}static TransformCoordinatesToRef(e,t,i){return y.TransformCoordinatesFromFloatsToRef(e._x,e._y,e._z,t,i),i}static TransformCoordinatesFromFloatsToRef(e,t,i,s,r){const a=s.m,o=e*a[0]+t*a[4]+i*a[8]+a[12],l=e*a[1]+t*a[5]+i*a[9]+a[13],h=e*a[2]+t*a[6]+i*a[10]+a[14],u=1/(e*a[3]+t*a[7]+i*a[11]+a[15]);return r._x=o*u,r._y=l*u,r._z=h*u,r._isDirty=!0,r}static TransformNormal(e,t){const i=y.Zero();return y.TransformNormalToRef(e,t,i),i}static TransformNormalToRef(e,t,i){return this.TransformNormalFromFloatsToRef(e._x,e._y,e._z,t,i),i}static TransformNormalFromFloatsToRef(e,t,i,s,r){const a=s.m;return r._x=e*a[0]+t*a[4]+i*a[8],r._y=e*a[1]+t*a[5]+i*a[9],r._z=e*a[2]+t*a[6]+i*a[10],r._isDirty=!0,r}static CatmullRom(e,t,i,s,r){const a=r*r,o=r*a,l=.5*(2*t._x+(-e._x+i._x)*r+(2*e._x-5*t._x+4*i._x-s._x)*a+(-e._x+3*t._x-3*i._x+s._x)*o),h=.5*(2*t._y+(-e._y+i._y)*r+(2*e._y-5*t._y+4*i._y-s._y)*a+(-e._y+3*t._y-3*i._y+s._y)*o),u=.5*(2*t._z+(-e._z+i._z)*r+(2*e._z-5*t._z+4*i._z-s._z)*a+(-e._z+3*t._z-3*i._z+s._z)*o);return new y(l,h,u)}static Clamp(e,t,i){const s=new y;return y.ClampToRef(e,t,i,s),s}static ClampToRef(e,t,i,s){let r=e._x;r=r>i._x?i._x:r,r=r<t._x?t._x:r;let a=e._y;a=a>i._y?i._y:a,a=a<t._y?t._y:a;let o=e._z;return o=o>i._z?i._z:o,o=o<t._z?t._z:o,s.copyFromFloats(r,a,o),s}static CheckExtends(e,t,i){t.minimizeInPlace(e),i.maximizeInPlace(e)}static Hermite(e,t,i,s,r){const a=r*r,o=r*a,l=2*o-3*a+1,h=-2*o+3*a,u=o-2*a+r,c=o-a,f=e._x*l+i._x*h+t._x*u+s._x*c,d=e._y*l+i._y*h+t._y*u+s._y*c,_=e._z*l+i._z*h+t._z*u+s._z*c;return new y(f,d,_)}static Hermite1stDerivative(e,t,i,s,r){const a=new y;return this.Hermite1stDerivativeToRef(e,t,i,s,r,a),a}static Hermite1stDerivativeToRef(e,t,i,s,r,a){const o=r*r;return a._x=(o-r)*6*e._x+(3*o-4*r+1)*t._x+(-o+r)*6*i._x+(3*o-2*r)*s._x,a._y=(o-r)*6*e._y+(3*o-4*r+1)*t._y+(-o+r)*6*i._y+(3*o-2*r)*s._y,a._z=(o-r)*6*e._z+(3*o-4*r+1)*t._z+(-o+r)*6*i._z+(3*o-2*r)*s._z,a._isDirty=!0,a}static Lerp(e,t,i){const s=new y(0,0,0);return y.LerpToRef(e,t,i,s),s}static LerpToRef(e,t,i,s){return s._x=e._x+(t._x-e._x)*i,s._y=e._y+(t._y-e._y)*i,s._z=e._z+(t._z-e._z)*i,s._isDirty=!0,s}static Dot(e,t){return e._x*t._x+e._y*t._y+e._z*t._z}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z}static Cross(e,t){const i=new y;return y.CrossToRef(e,t,i),i}static CrossToRef(e,t,i){const s=e._y*t._z-e._z*t._y,r=e._z*t._x-e._x*t._z,a=e._x*t._y-e._y*t._x;return i.copyFromFloats(s,r,a),i}static Normalize(e){const t=y.Zero();return y.NormalizeToRef(e,t),t}static NormalizeToRef(e,t){return e.normalizeToRef(t),t}static Project(e,t,i,s){const r=new y;return y.ProjectToRef(e,t,i,s,r),r}static ProjectToRef(e,t,i,s,r){var p;const a=s.width,o=s.height,l=s.x,h=s.y,u=de.Matrix[1],c=(p=Ae.LastCreatedEngine)==null?void 0:p.isNDCHalfZRange,f=c?1:.5,d=c?0:.5;L.FromValuesToRef(a/2,0,0,0,0,-o/2,0,0,0,0,f,0,l+a/2,o/2+h,d,1,u);const _=de.Matrix[0];return t.multiplyToRef(i,_),_.multiplyToRef(u,_),y.TransformCoordinatesToRef(e,_,r),r}static Reflect(e,t){return this.ReflectToRef(e,t,new y)}static ReflectToRef(e,t,i){const s=N.Vector3[0];return s.copyFrom(t).scaleInPlace(2*y.Dot(e,t)),i.copyFrom(e).subtractInPlace(s)}static _UnprojectFromInvertedMatrixToRef(e,t,i){y.TransformCoordinatesToRef(e,t,i);const s=t.m,r=e._x*s[3]+e._y*s[7]+e._z*s[11]+s[15];return Qe(r,1)&&i.scaleInPlace(1/r),i}static UnprojectFromTransform(e,t,i,s,r){return this.Unproject(e,t,i,s,r,L.IdentityReadOnly)}static Unproject(e,t,i,s,r,a){const o=new y;return y.UnprojectToRef(e,t,i,s,r,a,o),o}static UnprojectToRef(e,t,i,s,r,a,o){return y.UnprojectFloatsToRef(e._x,e._y,e._z,t,i,s,r,a,o),o}static UnprojectFloatsToRef(e,t,i,s,r,a,o,l,h){var f;const u=de.Matrix[0];a.multiplyToRef(o,u),u.multiplyToRef(l,u),u.invert();const c=de.Vector3[0];return c.x=e/s*2-1,c.y=-(t/r*2-1),(f=Ae.LastCreatedEngine)!=null&&f.isNDCHalfZRange?c.z=i:c.z=2*i-1,y._UnprojectFromInvertedMatrixToRef(c,u,h),h}static Minimize(e,t){const i=new y;return i.copyFrom(e),i.minimizeInPlace(t),i}static Maximize(e,t){const i=new y;return i.copyFrom(e),i.maximizeInPlace(t),i}static Distance(e,t){return Math.sqrt(y.DistanceSquared(e,t))}static DistanceSquared(e,t){const i=e._x-t._x,s=e._y-t._y,r=e._z-t._z;return i*i+s*s+r*r}static ProjectOnTriangleToRef(e,t,i,s,r){const a=de.Vector3[0],o=de.Vector3[1],l=de.Vector3[2],h=de.Vector3[3],u=de.Vector3[4];i.subtractToRef(t,a),s.subtractToRef(t,o),s.subtractToRef(i,l);const c=a.length(),f=o.length(),d=l.length();if(c<Ue||f<Ue||d<Ue)return r.copyFrom(t),y.Distance(e,t);e.subtractToRef(t,u),y.CrossToRef(a,o,h);const _=h.length();if(_<Ue)return r.copyFrom(t),y.Distance(e,t);h.normalizeFromLength(_);let p=u.length();if(p<Ue)return r.copyFrom(t),0;u.normalizeFromLength(p);const g=y.Dot(h,u),m=de.Vector3[5],v=de.Vector3[6];m.copyFrom(h).scaleInPlace(-p*g),v.copyFrom(e).addInPlace(m);const T=de.Vector3[4],A=de.Vector3[5],b=de.Vector3[7],x=de.Vector3[8];T.copyFrom(a).scaleInPlace(1/c),x.copyFrom(o).scaleInPlace(1/f),T.addInPlace(x).scaleInPlace(-1),A.copyFrom(a).scaleInPlace(-1/c),x.copyFrom(l).scaleInPlace(1/d),A.addInPlace(x).scaleInPlace(-1),b.copyFrom(l).scaleInPlace(-1/d),x.copyFrom(o).scaleInPlace(-1/f),b.addInPlace(x).scaleInPlace(-1);const E=de.Vector3[9];let R;E.copyFrom(v).subtractInPlace(t),y.CrossToRef(T,E,x),R=y.Dot(x,h);const C=R;E.copyFrom(v).subtractInPlace(i),y.CrossToRef(A,E,x),R=y.Dot(x,h);const I=R;E.copyFrom(v).subtractInPlace(s),y.CrossToRef(b,E,x),R=y.Dot(x,h);const D=R,w=de.Vector3[10];let z,F;C>0&&I<0?(w.copyFrom(a),z=t,F=i):I>0&&D<0?(w.copyFrom(l),z=i,F=s):(w.copyFrom(o).scaleInPlace(-1),z=s,F=t);const W=de.Vector3[9],X=de.Vector3[4];if(z.subtractToRef(v,x),F.subtractToRef(v,W),y.CrossToRef(x,W,X),!(y.Dot(X,h)<0))return r.copyFrom(v),Math.abs(p*g);const H=de.Vector3[5];y.CrossToRef(w,X,H),H.normalize();const G=de.Vector3[9];G.copyFrom(z).subtractInPlace(v);const k=G.length();if(k<Ue)return r.copyFrom(z),y.Distance(e,z);G.normalizeFromLength(k);const M=y.Dot(H,G),V=de.Vector3[7];V.copyFrom(v).addInPlace(H.scaleInPlace(k*M)),x.copyFrom(V).subtractInPlace(z),p=w.length(),w.normalizeFromLength(p);let j=y.Dot(x,w)/Math.max(p,Ue);return j=lt(j,0,1),V.copyFrom(z).addInPlace(w.scaleInPlace(j*p)),r.copyFrom(V),y.Distance(e,V)}static Center(e,t){return y.CenterToRef(e,t,y.Zero())}static CenterToRef(e,t,i){return i.copyFromFloats((e._x+t._x)/2,(e._y+t._y)/2,(e._z+t._z)/2)}static RotationFromAxis(e,t,i){const s=new y;return y.RotationFromAxisToRef(e,t,i,s),s}static RotationFromAxisToRef(e,t,i,s){const r=de.Quaternion[0];return se.RotationQuaternionFromAxisToRef(e,t,i,r),r.toEulerAnglesToRef(s),s}}y._V8PerformanceHack=new y(.5,.5,.5);y._UpReadOnly=y.Up();y._DownReadOnly=y.Down();y._LeftHandedForwardReadOnly=y.Forward(!1);y._RightHandedForwardReadOnly=y.Forward(!0);y._LeftHandedBackwardReadOnly=y.Backward(!1);y._RightHandedBackwardReadOnly=y.Backward(!0);y._RightReadOnly=y.Right();y._LeftReadOnly=y.Left();y._ZeroReadOnly=y.Zero();y._OneReadOnly=y.One();Object.defineProperties(y.prototype,{dimension:{value:[3]},rank:{value:1}});class Oe{constructor(e=0,t=0,i=0,s=0){this.x=e,this.y=t,this.z=i,this.w=s}toString(){return`{X: ${this.x} Y: ${this.y} Z: ${this.z} W: ${this.w}}`}getClassName(){return"Vector4"}getHashCode(){const e=bi(this.x),t=bi(this.y),i=bi(this.z),s=bi(this.w);let r=e;return r=r*397^t,r=r*397^i,r=r*397^s,r}asArray(){return[this.x,this.y,this.z,this.w]}toArray(e,t){return t===void 0&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,this}fromArray(e,t=0){return Oe.FromArrayToRef(e,t,this),this}addInPlace(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addInPlaceFromFloats(e,t,i,s){return this.x+=e,this.y+=t,this.z+=i,this.w+=s,this}add(e){return new Oe(this.x+e.x,this.y+e.y,this.z+e.z,this.w+e.w)}addToRef(e,t){return t.x=this.x+e.x,t.y=this.y+e.y,t.z=this.z+e.z,t.w=this.w+e.w,t}subtractInPlace(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subtract(e){return new Oe(this.x-e.x,this.y-e.y,this.z-e.z,this.w-e.w)}subtractToRef(e,t){return t.x=this.x-e.x,t.y=this.y-e.y,t.z=this.z-e.z,t.w=this.w-e.w,t}subtractFromFloats(e,t,i,s){return new Oe(this.x-e,this.y-t,this.z-i,this.w-s)}subtractFromFloatsToRef(e,t,i,s,r){return r.x=this.x-e,r.y=this.y-t,r.z=this.z-i,r.w=this.w-s,r}negate(){return new Oe(-this.x,-this.y,-this.z,-this.w)}negateInPlace(){return this.x*=-1,this.y*=-1,this.z*=-1,this.w*=-1,this}negateToRef(e){return e.x=-this.x,e.y=-this.y,e.z=-this.z,e.w=-this.w,e}scaleInPlace(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}scale(e){return new Oe(this.x*e,this.y*e,this.z*e,this.w*e)}scaleToRef(e,t){return t.x=this.x*e,t.y=this.y*e,t.z=this.z*e,t.w=this.w*e,t}scaleAndAddToRef(e,t){return t.x+=this.x*e,t.y+=this.y*e,t.z+=this.z*e,t.w+=this.w*e,t}equals(e){return e&&this.x===e.x&&this.y===e.y&&this.z===e.z&&this.w===e.w}equalsWithEpsilon(e,t=Ue){return e&&Qe(this.x,e.x,t)&&Qe(this.y,e.y,t)&&Qe(this.z,e.z,t)&&Qe(this.w,e.w,t)}equalsToFloats(e,t,i,s){return this.x===e&&this.y===t&&this.z===i&&this.w===s}multiplyInPlace(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiply(e){return new Oe(this.x*e.x,this.y*e.y,this.z*e.z,this.w*e.w)}multiplyToRef(e,t){return t.x=this.x*e.x,t.y=this.y*e.y,t.z=this.z*e.z,t.w=this.w*e.w,t}multiplyByFloats(e,t,i,s){return new Oe(this.x*e,this.y*t,this.z*i,this.w*s)}divide(e){return new Oe(this.x/e.x,this.y/e.y,this.z/e.z,this.w/e.w)}divideToRef(e,t){return t.x=this.x/e.x,t.y=this.y/e.y,t.z=this.z/e.z,t.w=this.w/e.w,t}divideInPlace(e){return this.divideToRef(e,this)}minimizeInPlace(e){return e.x<this.x&&(this.x=e.x),e.y<this.y&&(this.y=e.y),e.z<this.z&&(this.z=e.z),e.w<this.w&&(this.w=e.w),this}maximizeInPlace(e){return e.x>this.x&&(this.x=e.x),e.y>this.y&&(this.y=e.y),e.z>this.z&&(this.z=e.z),e.w>this.w&&(this.w=e.w),this}minimizeInPlaceFromFloats(e,t,i,s){return this.x=Math.min(e,this.x),this.y=Math.min(t,this.y),this.z=Math.min(i,this.z),this.w=Math.min(s,this.w),this}maximizeInPlaceFromFloats(e,t,i,s){return this.x=Math.max(e,this.x),this.y=Math.max(t,this.y),this.z=Math.max(i,this.z),this.w=Math.max(s,this.w),this}floorToRef(e){return e.x=Math.floor(this.x),e.y=Math.floor(this.y),e.z=Math.floor(this.z),e.w=Math.floor(this.w),e}floor(){return new Oe(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z),Math.floor(this.w))}fractToRef(e){return e.x=this.x-Math.floor(this.x),e.y=this.y-Math.floor(this.y),e.z=this.z-Math.floor(this.z),e.w=this.w-Math.floor(this.w),e}fract(){return new Oe(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z),this.w-Math.floor(this.w))}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}lengthSquared(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(e){return e===0||e===1?this:this.scaleInPlace(1/e)}normalizeToNew(){return this.normalizeToRef(new Oe)}normalizeToRef(e){const t=this.length();return t===0||t===1?(e.x=this.x,e.y=this.y,e.z=this.z,e.w=this.w,e):this.scaleToRef(1/t,e)}toVector3(){return new y(this.x,this.y,this.z)}clone(){return new Oe(this.x,this.y,this.z,this.w)}copyFrom(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}copyFromFloats(e,t,i,s){return this.x=e,this.y=t,this.z=i,this.w=s,this}set(e,t,i,s){return this.copyFromFloats(e,t,i,s)}setAll(e){return this.x=this.y=this.z=this.w=e,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}static FromArray(e,t){return t||(t=0),new Oe(e[t],e[t+1],e[t+2],e[t+3])}static FromArrayToRef(e,t,i){return i.x=e[t],i.y=e[t+1],i.z=e[t+2],i.w=e[t+3],i}static FromFloatArrayToRef(e,t,i){return Oe.FromArrayToRef(e,t,i),i}static FromFloatsToRef(e,t,i,s,r){return r.x=e,r.y=t,r.z=i,r.w=s,r}static Zero(){return new Oe(0,0,0,0)}static One(){return new Oe(1,1,1,1)}static Random(e=0,t=1){return new Oe(xt(e,t),xt(e,t),xt(e,t),xt(e,t))}static RandomToRef(e=0,t=1,i){return i.x=xt(e,t),i.y=xt(e,t),i.z=xt(e,t),i.w=xt(e,t),i}static Clamp(e,t,i){return Oe.ClampToRef(e,t,i,new Oe)}static ClampToRef(e,t,i,s){return s.x=lt(e.x,t.x,i.x),s.y=lt(e.y,t.y,i.y),s.z=lt(e.z,t.z,i.z),s.w=lt(e.w,t.w,i.w),s}static CheckExtends(e,t,i){t.minimizeInPlace(e),i.maximizeInPlace(e)}static get ZeroReadOnly(){return Oe._ZeroReadOnly}static Normalize(e){return Oe.NormalizeToRef(e,new Oe)}static NormalizeToRef(e,t){return e.normalizeToRef(t),t}static Minimize(e,t){const i=new Oe;return i.copyFrom(e),i.minimizeInPlace(t),i}static Maximize(e,t){const i=new Oe;return i.copyFrom(e),i.maximizeInPlace(t),i}static Distance(e,t){return Math.sqrt(Oe.DistanceSquared(e,t))}static DistanceSquared(e,t){const i=e.x-t.x,s=e.y-t.y,r=e.z-t.z,a=e.w-t.w;return i*i+s*s+r*r+a*a}static Center(e,t){return Oe.CenterToRef(e,t,new Oe)}static CenterToRef(e,t,i){return i.x=(e.x+t.x)/2,i.y=(e.y+t.y)/2,i.z=(e.z+t.z)/2,i.w=(e.w+t.w)/2,i}static TransformCoordinates(e,t){return Oe.TransformCoordinatesToRef(e,t,new Oe)}static TransformCoordinatesToRef(e,t,i){return Oe.TransformCoordinatesFromFloatsToRef(e._x,e._y,e._z,t,i),i}static TransformCoordinatesFromFloatsToRef(e,t,i,s,r){const a=s.m,o=e*a[0]+t*a[4]+i*a[8]+a[12],l=e*a[1]+t*a[5]+i*a[9]+a[13],h=e*a[2]+t*a[6]+i*a[10]+a[14],u=e*a[3]+t*a[7]+i*a[11]+a[15];return r.x=o,r.y=l,r.z=h,r.w=u,r}static TransformNormal(e,t){return Oe.TransformNormalToRef(e,t,new Oe)}static TransformNormalToRef(e,t,i){const s=t.m,r=e.x*s[0]+e.y*s[4]+e.z*s[8],a=e.x*s[1]+e.y*s[5]+e.z*s[9],o=e.x*s[2]+e.y*s[6]+e.z*s[10];return i.x=r,i.y=a,i.z=o,i.w=e.w,i}static TransformNormalFromFloatsToRef(e,t,i,s,r,a){const o=r.m;return a.x=e*o[0]+t*o[4]+i*o[8],a.y=e*o[1]+t*o[5]+i*o[9],a.z=e*o[2]+t*o[6]+i*o[10],a.w=s,a}static FromVector3(e,t=0){return new Oe(e._x,e._y,e._z,t)}static Dot(e,t){return e.x*t.x+e.y*t.y+e.z*t.z+e.w*t.w}}Oe._V8PerformanceHack=new Oe(.5,.5,.5,.5);Oe._ZeroReadOnly=Oe.Zero();Object.defineProperties(Oe.prototype,{dimension:{value:[4]},rank:{value:1}});class se{get x(){return this._x}set x(e){this._x=e,this._isDirty=!0}get y(){return this._y}set y(e){this._y=e,this._isDirty=!0}get z(){return this._z}set z(e){this._z=e,this._isDirty=!0}get w(){return this._w}set w(e){this._w=e,this._isDirty=!0}constructor(e=0,t=0,i=0,s=1){this._isDirty=!0,this._x=e,this._y=t,this._z=i,this._w=s}toString(){return`{X: ${this._x} Y: ${this._y} Z: ${this._z} W: ${this._w}}`}getClassName(){return"Quaternion"}getHashCode(){const e=bi(this._x),t=bi(this._y),i=bi(this._z),s=bi(this._w);let r=e;return r=r*397^t,r=r*397^i,r=r*397^s,r}asArray(){return[this._x,this._y,this._z,this._w]}toArray(e,t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,this}fromArray(e,t=0){return se.FromArrayToRef(e,t,this)}equals(e){return e&&this._x===e._x&&this._y===e._y&&this._z===e._z&&this._w===e._w}equalsWithEpsilon(e,t=Ue){return e&&Qe(this._x,e._x,t)&&Qe(this._y,e._y,t)&&Qe(this._z,e._z,t)&&Qe(this._w,e._w,t)}isApprox(e,t=Ue){return e&&(Qe(this._x,e._x,t)&&Qe(this._y,e._y,t)&&Qe(this._z,e._z,t)&&Qe(this._w,e._w,t)||Qe(this._x,-e._x,t)&&Qe(this._y,-e._y,t)&&Qe(this._z,-e._z,t)&&Qe(this._w,-e._w,t))}clone(){return new se(this._x,this._y,this._z,this._w)}copyFrom(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._w=e._w,this._isDirty=!0,this}copyFromFloats(e,t,i,s){return this._x=e,this._y=t,this._z=i,this._w=s,this._isDirty=!0,this}set(e,t,i,s){return this.copyFromFloats(e,t,i,s)}setAll(e){return this.copyFromFloats(e,e,e,e)}add(e){return new se(this._x+e._x,this._y+e._y,this._z+e._z,this._w+e._w)}addInPlace(e){return this._x+=e._x,this._y+=e._y,this._z+=e._z,this._w+=e._w,this._isDirty=!0,this}addToRef(e,t){return t._x=this._x+e._x,t._y=this._y+e._y,t._z=this._z+e._z,t._w=this._w+e._w,t._isDirty=!0,t}addInPlaceFromFloats(e,t,i,s){return this._x+=e,this._y+=t,this._z+=i,this._w+=s,this._isDirty=!0,this}subtractToRef(e,t){return t._x=this._x-e._x,t._y=this._y-e._y,t._z=this._z-e._z,t._w=this._w-e._w,t._isDirty=!0,t}subtractFromFloats(e,t,i,s){return this.subtractFromFloatsToRef(e,t,i,s,new se)}subtractFromFloatsToRef(e,t,i,s,r){return r._x=this._x-e,r._y=this._y-t,r._z=this._z-i,r._w=this._w-s,r._isDirty=!0,r}subtract(e){return new se(this._x-e._x,this._y-e._y,this._z-e._z,this._w-e._w)}subtractInPlace(e){return this._x-=e._x,this._y-=e._y,this._z-=e._z,this._w-=e._w,this._isDirty=!0,this}scale(e){return new se(this._x*e,this._y*e,this._z*e,this._w*e)}scaleToRef(e,t){return t._x=this._x*e,t._y=this._y*e,t._z=this._z*e,t._w=this._w*e,t._isDirty=!0,t}scaleInPlace(e){return this._x*=e,this._y*=e,this._z*=e,this._w*=e,this._isDirty=!0,this}scaleAndAddToRef(e,t){return t._x+=this._x*e,t._y+=this._y*e,t._z+=this._z*e,t._w+=this._w*e,t._isDirty=!0,t}multiply(e){const t=new se(0,0,0,1);return this.multiplyToRef(e,t),t}multiplyToRef(e,t){const i=this._x*e._w+this._y*e._z-this._z*e._y+this._w*e._x,s=-this._x*e._z+this._y*e._w+this._z*e._x+this._w*e._y,r=this._x*e._y-this._y*e._x+this._z*e._w+this._w*e._z,a=-this._x*e._x-this._y*e._y-this._z*e._z+this._w*e._w;return t.copyFromFloats(i,s,r,a),t}multiplyInPlace(e){return this.multiplyToRef(e,this)}multiplyByFloats(e,t,i,s){return this._x*=e,this._y*=t,this._z*=i,this._w*=s,this._isDirty=!0,this}divide(e){throw new ReferenceError("Can not divide a quaternion")}divideToRef(e,t){throw new ReferenceError("Can not divide a quaternion")}divideInPlace(e){throw new ReferenceError("Can not divide a quaternion")}minimizeInPlace(){throw new ReferenceError("Can not minimize a quaternion")}minimizeInPlaceFromFloats(){throw new ReferenceError("Can not minimize a quaternion")}maximizeInPlace(){throw new ReferenceError("Can not maximize a quaternion")}maximizeInPlaceFromFloats(){throw new ReferenceError("Can not maximize a quaternion")}negate(){return this.negateToRef(new se)}negateInPlace(){return this._x=-this._x,this._y=-this._y,this._z=-this._z,this._w=-this._w,this._isDirty=!0,this}negateToRef(e){return e._x=-this._x,e._y=-this._y,e._z=-this._z,e._w=-this._w,e._isDirty=!0,e}equalsToFloats(e,t,i,s){return this._x===e&&this._y===t&&this._z===i&&this._w===s}floorToRef(e){throw new ReferenceError("Can not floor a quaternion")}floor(){throw new ReferenceError("Can not floor a quaternion")}fractToRef(e){throw new ReferenceError("Can not fract a quaternion")}fract(){throw new ReferenceError("Can not fract a quaternion")}conjugateToRef(e){return e.copyFromFloats(-this._x,-this._y,-this._z,this._w),e}conjugateInPlace(){return this._x*=-1,this._y*=-1,this._z*=-1,this._isDirty=!0,this}conjugate(){return new se(-this._x,-this._y,-this._z,this._w)}invert(){const e=this.conjugate(),t=this.lengthSquared();return t==0||t==1||e.scaleInPlace(1/t),e}invertInPlace(){this.conjugateInPlace();const e=this.lengthSquared();return e==0||e==1?this:(this.scaleInPlace(1/e),this)}lengthSquared(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this.lengthSquared())}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(e){return e===0||e===1?this:this.scaleInPlace(1/e)}normalizeToNew(){const e=new se(0,0,0,1);return this.normalizeToRef(e),e}normalizeToRef(e){const t=this.length();return t===0||t===1?e.copyFromFloats(this._x,this._y,this._z,this._w):this.scaleToRef(1/t,e)}toEulerAngles(){const e=y.Zero();return this.toEulerAnglesToRef(e),e}toEulerAnglesToRef(e){const t=this._z,i=this._x,s=this._y,r=this._w,a=s*t-i*r,o=.4999999;if(a<-.4999999)e._y=2*Math.atan2(s,r),e._x=Math.PI/2,e._z=0,e._isDirty=!0;else if(a>o)e._y=2*Math.atan2(s,r),e._x=-Math.PI/2,e._z=0,e._isDirty=!0;else{const l=r*r,h=t*t,u=i*i,c=s*s;e._z=Math.atan2(2*(i*s+t*r),-h-u+c+l),e._x=Math.asin(-2*a),e._y=Math.atan2(2*(t*i+s*r),h-u-c+l),e._isDirty=!0}return e}toAlphaBetaGammaToRef(e){const t=this._z,i=this._x,s=this._y,r=this._w,a=Math.sqrt(i*i+s*s),o=Math.sqrt(t*t+r*r),l=2*Math.atan2(a,o),h=2*Math.atan2(t,r),u=2*Math.atan2(s,i),c=(h+u)/2,f=(h-u)/2;return e.set(f,l,c),e}toRotationMatrix(e){return L.FromQuaternionToRef(this,e),e}fromRotationMatrix(e){return se.FromRotationMatrixToRef(e,this),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}static FromRotationMatrix(e){const t=new se;return se.FromRotationMatrixToRef(e,t),t}static FromRotationMatrixToRef(e,t){const i=e.m,s=i[0],r=i[4],a=i[8],o=i[1],l=i[5],h=i[9],u=i[2],c=i[6],f=i[10],d=s+l+f;let _;return d>0?(_=.5/Math.sqrt(d+1),t._w=.25/_,t._x=(c-h)*_,t._y=(a-u)*_,t._z=(o-r)*_,t._isDirty=!0):s>l&&s>f?(_=2*Math.sqrt(1+s-l-f),t._w=(c-h)/_,t._x=.25*_,t._y=(r+o)/_,t._z=(a+u)/_,t._isDirty=!0):l>f?(_=2*Math.sqrt(1+l-s-f),t._w=(a-u)/_,t._x=(r+o)/_,t._y=.25*_,t._z=(h+c)/_,t._isDirty=!0):(_=2*Math.sqrt(1+f-s-l),t._w=(o-r)/_,t._x=(a+u)/_,t._y=(h+c)/_,t._z=.25*_,t._isDirty=!0),t}static Dot(e,t){return e._x*t._x+e._y*t._y+e._z*t._z+e._w*t._w}static AreClose(e,t,i=.1){const s=se.Dot(e,t);return 1-s*s<=i}static SmoothToRef(e,t,i,s,r){let a=s===0?1:i/s;return a=lt(a,0,1),se.SlerpToRef(e,t,a,r),r}static Zero(){return new se(0,0,0,0)}static Inverse(e){return new se(-e._x,-e._y,-e._z,e._w)}static InverseToRef(e,t){return t.set(-e._x,-e._y,-e._z,e._w),t}static Identity(){return new se(0,0,0,1)}static IsIdentity(e){return e&&e._x===0&&e._y===0&&e._z===0&&e._w===1}static RotationAxis(e,t){return se.RotationAxisToRef(e,t,new se)}static RotationAxisToRef(e,t,i){i._w=Math.cos(t/2);const s=Math.sin(t/2)/e.length();return i._x=e._x*s,i._y=e._y*s,i._z=e._z*s,i._isDirty=!0,i}static FromArray(e,t){return t||(t=0),new se(e[t],e[t+1],e[t+2],e[t+3])}static FromArrayToRef(e,t,i){return i._x=e[t],i._y=e[t+1],i._z=e[t+2],i._w=e[t+3],i._isDirty=!0,i}static FromFloatsToRef(e,t,i,s,r){return r.copyFromFloats(e,t,i,s),r}static FromEulerAngles(e,t,i){const s=new se;return se.RotationYawPitchRollToRef(t,e,i,s),s}static FromEulerAnglesToRef(e,t,i,s){return se.RotationYawPitchRollToRef(t,e,i,s),s}static FromEulerVector(e){const t=new se;return se.RotationYawPitchRollToRef(e._y,e._x,e._z,t),t}static FromEulerVectorToRef(e,t){return se.RotationYawPitchRollToRef(e._y,e._x,e._z,t),t}static FromUnitVectorsToRef(e,t,i,s=Ue){const r=y.Dot(e,t)+1;return r<s?Math.abs(e.x)>Math.abs(e.z)?i.set(-e.y,e.x,0,0):i.set(0,-e.z,e.y,0):(y.CrossToRef(e,t,N.Vector3[0]),i.set(N.Vector3[0].x,N.Vector3[0].y,N.Vector3[0].z,r)),i.normalize()}static RotationYawPitchRoll(e,t,i){const s=new se;return se.RotationYawPitchRollToRef(e,t,i,s),s}static RotationYawPitchRollToRef(e,t,i,s){const r=i*.5,a=t*.5,o=e*.5,l=Math.sin(r),h=Math.cos(r),u=Math.sin(a),c=Math.cos(a),f=Math.sin(o),d=Math.cos(o);return s._x=d*u*h+f*c*l,s._y=f*c*h-d*u*l,s._z=d*c*l-f*u*h,s._w=d*c*h+f*u*l,s._isDirty=!0,s}static RotationAlphaBetaGamma(e,t,i){const s=new se;return se.RotationAlphaBetaGammaToRef(e,t,i,s),s}static RotationAlphaBetaGammaToRef(e,t,i,s){const r=(i+e)*.5,a=(i-e)*.5,o=t*.5;return s._x=Math.cos(a)*Math.sin(o),s._y=Math.sin(a)*Math.sin(o),s._z=Math.sin(r)*Math.cos(o),s._w=Math.cos(r)*Math.cos(o),s._isDirty=!0,s}static RotationQuaternionFromAxis(e,t,i){const s=new se(0,0,0,0);return se.RotationQuaternionFromAxisToRef(e,t,i,s),s}static RotationQuaternionFromAxisToRef(e,t,i,s){const r=de.Matrix[0];return e=e.normalizeToRef(de.Vector3[0]),t=t.normalizeToRef(de.Vector3[1]),i=i.normalizeToRef(de.Vector3[2]),L.FromXYZAxesToRef(e,t,i,r),se.FromRotationMatrixToRef(r,s),s}static FromLookDirectionLH(e,t){const i=new se;return se.FromLookDirectionLHToRef(e,t,i),i}static FromLookDirectionLHToRef(e,t,i){const s=de.Matrix[0];return L.LookDirectionLHToRef(e,t,s),se.FromRotationMatrixToRef(s,i),i}static FromLookDirectionRH(e,t){const i=new se;return se.FromLookDirectionRHToRef(e,t,i),i}static FromLookDirectionRHToRef(e,t,i){const s=de.Matrix[0];return L.LookDirectionRHToRef(e,t,s),se.FromRotationMatrixToRef(s,i)}static Slerp(e,t,i){const s=se.Identity();return se.SlerpToRef(e,t,i,s),s}static SlerpToRef(e,t,i,s){let r,a,o=e._x*t._x+e._y*t._y+e._z*t._z+e._w*t._w,l=!1;if(o<0&&(l=!0,o=-o),o>.999999)a=1-i,r=l?-i:i;else{const h=Math.acos(o),u=1/Math.sin(h);a=Math.sin((1-i)*h)*u,r=l?-Math.sin(i*h)*u:Math.sin(i*h)*u}return s._x=a*e._x+r*t._x,s._y=a*e._y+r*t._y,s._z=a*e._z+r*t._z,s._w=a*e._w+r*t._w,s._isDirty=!0,s}static Hermite(e,t,i,s,r){const a=r*r,o=r*a,l=2*o-3*a+1,h=-2*o+3*a,u=o-2*a+r,c=o-a,f=e._x*l+i._x*h+t._x*u+s._x*c,d=e._y*l+i._y*h+t._y*u+s._y*c,_=e._z*l+i._z*h+t._z*u+s._z*c,p=e._w*l+i._w*h+t._w*u+s._w*c;return new se(f,d,_,p)}static Hermite1stDerivative(e,t,i,s,r){const a=new se;return this.Hermite1stDerivativeToRef(e,t,i,s,r,a),a}static Hermite1stDerivativeToRef(e,t,i,s,r,a){const o=r*r;return a._x=(o-r)*6*e._x+(3*o-4*r+1)*t._x+(-o+r)*6*i._x+(3*o-2*r)*s._x,a._y=(o-r)*6*e._y+(3*o-4*r+1)*t._y+(-o+r)*6*i._y+(3*o-2*r)*s._y,a._z=(o-r)*6*e._z+(3*o-4*r+1)*t._z+(-o+r)*6*i._z+(3*o-2*r)*s._z,a._w=(o-r)*6*e._w+(3*o-4*r+1)*t._w+(-o+r)*6*i._w+(3*o-2*r)*s._w,a._isDirty=!0,a}static Normalize(e){const t=se.Zero();return se.NormalizeToRef(e,t),t}static NormalizeToRef(e,t){return e.normalizeToRef(t),t}static Clamp(e,t,i){const s=new se;return se.ClampToRef(e,t,i,s),s}static ClampToRef(e,t,i,s){return s.copyFromFloats(lt(e.x,t.x,i.x),lt(e.y,t.y,i.y),lt(e.z,t.z,i.z),lt(e.w,t.w,i.w))}static Random(e=0,t=1){return new se(xt(e,t),xt(e,t),xt(e,t),xt(e,t))}static RandomToRef(e=0,t=1,i){return i.copyFromFloats(xt(e,t),xt(e,t),xt(e,t),xt(e,t))}static Minimize(){throw new ReferenceError("Quaternion.Minimize does not make sense")}static Maximize(){throw new ReferenceError("Quaternion.Maximize does not make sense")}static Distance(e,t){return Math.sqrt(se.DistanceSquared(e,t))}static DistanceSquared(e,t){const i=e.x-t.x,s=e.y-t.y,r=e.z-t.z,a=e.w-t.w;return i*i+s*s+r*r+a*a}static Center(e,t){return se.CenterToRef(e,t,se.Zero())}static CenterToRef(e,t,i){return i.copyFromFloats((e.x+t.x)/2,(e.y+t.y)/2,(e.z+t.z)/2,(e.w+t.w)/2)}}se._V8PerformanceHack=new se(.5,.5,.5,.5);Object.defineProperties(se.prototype,{dimension:{value:[4]},rank:{value:1}});class L{static get Use64Bits(){return Gt.MatrixUse64Bits}get m(){return this._m}markAsUpdated(){this.updateFlag=L._UpdateFlagSeed++,this._isIdentity=!1,this._isIdentity3x2=!1,this._isIdentityDirty=!0,this._isIdentity3x2Dirty=!0}_updateIdentityStatus(e,t=!1,i=!1,s=!0){this._isIdentity=e,this._isIdentity3x2=e||i,this._isIdentityDirty=this._isIdentity?!1:t,this._isIdentity3x2Dirty=this._isIdentity3x2?!1:s}constructor(){this._isIdentity=!1,this._isIdentityDirty=!0,this._isIdentity3x2=!0,this._isIdentity3x2Dirty=!0,this.updateFlag=-1,Gt.MatrixTrackPrecisionChange&&Gt.MatrixTrackedMatrices.push(this),this._m=new Gt.MatrixCurrentType(16),this.markAsUpdated()}isIdentity(){if(this._isIdentityDirty){this._isIdentityDirty=!1;const e=this._m;this._isIdentity=e[0]===1&&e[1]===0&&e[2]===0&&e[3]===0&&e[4]===0&&e[5]===1&&e[6]===0&&e[7]===0&&e[8]===0&&e[9]===0&&e[10]===1&&e[11]===0&&e[12]===0&&e[13]===0&&e[14]===0&&e[15]===1}return this._isIdentity}isIdentityAs3x2(){return this._isIdentity3x2Dirty&&(this._isIdentity3x2Dirty=!1,this._m[0]!==1||this._m[5]!==1||this._m[15]!==1?this._isIdentity3x2=!1:this._m[1]!==0||this._m[2]!==0||this._m[3]!==0||this._m[4]!==0||this._m[6]!==0||this._m[7]!==0||this._m[8]!==0||this._m[9]!==0||this._m[10]!==0||this._m[11]!==0||this._m[12]!==0||this._m[13]!==0||this._m[14]!==0?this._isIdentity3x2=!1:this._isIdentity3x2=!0),this._isIdentity3x2}determinant(){if(this._isIdentity===!0)return 1;const e=this._m,t=e[0],i=e[1],s=e[2],r=e[3],a=e[4],o=e[5],l=e[6],h=e[7],u=e[8],c=e[9],f=e[10],d=e[11],_=e[12],p=e[13],g=e[14],m=e[15],v=f*m-g*d,T=c*m-p*d,A=c*g-p*f,b=u*m-_*d,x=u*g-f*_,E=u*p-_*c,R=+(o*v-l*T+h*A),C=-(a*v-l*b+h*x),I=+(a*T-o*b+h*E),D=-(a*A-o*x+l*E);return t*R+i*C+s*I+r*D}toString(){return`{${this.m[0]}, ${this.m[1]}, ${this.m[2]}, ${this.m[3]}
${this.m[4]}, ${this.m[5]}, ${this.m[6]}, ${this.m[7]}
${this.m[8]}, ${this.m[9]}, ${this.m[10]}, ${this.m[11]}
${this.m[12]}, ${this.m[13]}, ${this.m[14]}, ${this.m[15]}}`}toArray(e=null,t=0){if(!e)return this._m;const i=this._m;for(let s=0;s<16;s++)e[t+s]=i[s];return this}asArray(){return this._m}fromArray(e,t=0){return L.FromArrayToRef(e,t,this)}copyFromFloats(...e){return L.FromArrayToRef(e,0,this)}set(...e){const t=this._m;for(let i=0;i<16;i++)t[i]=e[i];return this.markAsUpdated(),this}setAll(e){const t=this._m;for(let i=0;i<16;i++)t[i]=e;return this.markAsUpdated(),this}invert(){return this.invertToRef(this),this}reset(){return L.FromValuesToRef(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,this),this._updateIdentityStatus(!1),this}add(e){const t=new L;return this.addToRef(e,t),t}addToRef(e,t){const i=this._m,s=t._m,r=e.m;for(let a=0;a<16;a++)s[a]=i[a]+r[a];return t.markAsUpdated(),t}addToSelf(e){const t=this._m,i=e.m;return t[0]+=i[0],t[1]+=i[1],t[2]+=i[2],t[3]+=i[3],t[4]+=i[4],t[5]+=i[5],t[6]+=i[6],t[7]+=i[7],t[8]+=i[8],t[9]+=i[9],t[10]+=i[10],t[11]+=i[11],t[12]+=i[12],t[13]+=i[13],t[14]+=i[14],t[15]+=i[15],this.markAsUpdated(),this}addInPlace(e){const t=this._m,i=e.m;for(let s=0;s<16;s++)t[s]+=i[s];return this.markAsUpdated(),this}addInPlaceFromFloats(...e){const t=this._m;for(let i=0;i<16;i++)t[i]+=e[i];return this.markAsUpdated(),this}subtract(e){const t=this._m,i=e.m;for(let s=0;s<16;s++)t[s]-=i[s];return this.markAsUpdated(),this}subtractToRef(e,t){const i=this._m,s=e.m,r=t._m;for(let a=0;a<16;a++)r[a]=i[a]-s[a];return t.markAsUpdated(),t}subtractInPlace(e){const t=this._m,i=e.m;for(let s=0;s<16;s++)t[s]-=i[s];return this.markAsUpdated(),this}subtractFromFloats(...e){return this.subtractFromFloatsToRef(...e,new L)}subtractFromFloatsToRef(...e){const t=e.pop(),i=this._m,s=t._m,r=e;for(let a=0;a<16;a++)s[a]=i[a]-r[a];return t.markAsUpdated(),t}invertToRef(e){if(this._isIdentity===!0)return L.IdentityToRef(e),e;const t=this._m,i=t[0],s=t[1],r=t[2],a=t[3],o=t[4],l=t[5],h=t[6],u=t[7],c=t[8],f=t[9],d=t[10],_=t[11],p=t[12],g=t[13],m=t[14],v=t[15],T=d*v-m*_,A=f*v-g*_,b=f*m-g*d,x=c*v-p*_,E=c*m-d*p,R=c*g-p*f,C=+(l*T-h*A+u*b),I=-(o*T-h*x+u*E),D=+(o*A-l*x+u*R),w=-(o*b-l*E+h*R),z=i*C+s*I+r*D+a*w;if(z===0)return e.copyFrom(this),e;const F=1/z,W=h*v-m*u,X=l*v-g*u,he=l*m-g*h,H=o*v-p*u,G=o*m-p*h,k=o*g-p*l,M=h*_-d*u,V=l*_-f*u,j=l*d-f*h,ae=o*_-c*u,ge=o*d-c*h,$=o*f-c*l,le=-(s*T-r*A+a*b),xe=+(i*T-r*x+a*E),ue=-(i*A-s*x+a*R),Se=+(i*b-s*E+r*R),ze=+(s*W-r*X+a*he),pe=-(i*W-r*H+a*G),Pe=+(i*X-s*H+a*k),me=-(i*he-s*G+r*k),Ke=-(s*M-r*V+a*j),et=+(i*M-r*ae+a*ge),ft=-(i*V-s*ae+a*$),wt=+(i*j-s*ge+r*$);return L.FromValuesToRef(C*F,le*F,ze*F,Ke*F,I*F,xe*F,pe*F,et*F,D*F,ue*F,Pe*F,ft*F,w*F,Se*F,me*F,wt*F,e),e}addAtIndex(e,t){return this._m[e]+=t,this.markAsUpdated(),this}multiplyAtIndex(e,t){return this._m[e]*=t,this.markAsUpdated(),this}setTranslationFromFloats(e,t,i){return this._m[12]=e,this._m[13]=t,this._m[14]=i,this.markAsUpdated(),this}addTranslationFromFloats(e,t,i){return this._m[12]+=e,this._m[13]+=t,this._m[14]+=i,this.markAsUpdated(),this}setTranslation(e){return this.setTranslationFromFloats(e._x,e._y,e._z)}getTranslation(){return new y(this._m[12],this._m[13],this._m[14])}getTranslationToRef(e){return e.x=this._m[12],e.y=this._m[13],e.z=this._m[14],e}removeRotationAndScaling(){const e=this.m;return L.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,e[12],e[13],e[14],e[15],this),this._updateIdentityStatus(e[12]===0&&e[13]===0&&e[14]===0&&e[15]===1),this}copyFrom(e){e.copyToArray(this._m);const t=e;return this.updateFlag=t.updateFlag,this._updateIdentityStatus(t._isIdentity,t._isIdentityDirty,t._isIdentity3x2,t._isIdentity3x2Dirty),this}copyToArray(e,t=0){const i=this._m;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],this}multiply(e){const t=new L;return this.multiplyToRef(e,t),t}multiplyInPlace(e){const t=this._m,i=e.m;for(let s=0;s<16;s++)t[s]*=i[s];return this.markAsUpdated(),this}multiplyByFloats(...e){const t=this._m;for(let i=0;i<16;i++)t[i]*=e[i];return this.markAsUpdated(),this}multiplyByFloatsToRef(...e){const t=e.pop(),i=this._m,s=t._m,r=e;for(let a=0;a<16;a++)s[a]=i[a]*r[a];return t.markAsUpdated(),t}multiplyToRef(e,t){return this._isIdentity?(t.copyFrom(e),t):e._isIdentity?(t.copyFrom(this),t):(this.multiplyToArray(e,t._m,0),t.markAsUpdated(),t)}multiplyToArray(e,t,i){const s=this._m,r=e.m,a=s[0],o=s[1],l=s[2],h=s[3],u=s[4],c=s[5],f=s[6],d=s[7],_=s[8],p=s[9],g=s[10],m=s[11],v=s[12],T=s[13],A=s[14],b=s[15],x=r[0],E=r[1],R=r[2],C=r[3],I=r[4],D=r[5],w=r[6],z=r[7],F=r[8],W=r[9],X=r[10],he=r[11],H=r[12],G=r[13],k=r[14],M=r[15];return t[i]=a*x+o*I+l*F+h*H,t[i+1]=a*E+o*D+l*W+h*G,t[i+2]=a*R+o*w+l*X+h*k,t[i+3]=a*C+o*z+l*he+h*M,t[i+4]=u*x+c*I+f*F+d*H,t[i+5]=u*E+c*D+f*W+d*G,t[i+6]=u*R+c*w+f*X+d*k,t[i+7]=u*C+c*z+f*he+d*M,t[i+8]=_*x+p*I+g*F+m*H,t[i+9]=_*E+p*D+g*W+m*G,t[i+10]=_*R+p*w+g*X+m*k,t[i+11]=_*C+p*z+g*he+m*M,t[i+12]=v*x+T*I+A*F+b*H,t[i+13]=v*E+T*D+A*W+b*G,t[i+14]=v*R+T*w+A*X+b*k,t[i+15]=v*C+T*z+A*he+b*M,this}divide(e){return this.divideToRef(e,new L)}divideToRef(e,t){const i=this._m,s=e.m,r=t._m;for(let a=0;a<16;a++)r[a]=i[a]/s[a];return t.markAsUpdated(),t}divideInPlace(e){const t=this._m,i=e.m;for(let s=0;s<16;s++)t[s]/=i[s];return this.markAsUpdated(),this}minimizeInPlace(e){const t=this._m,i=e.m;for(let s=0;s<16;s++)t[s]=Math.min(t[s],i[s]);return this.markAsUpdated(),this}minimizeInPlaceFromFloats(...e){const t=this._m;for(let i=0;i<16;i++)t[i]=Math.min(t[i],e[i]);return this.markAsUpdated(),this}maximizeInPlace(e){const t=this._m,i=e.m;for(let s=0;s<16;s++)t[s]=Math.min(t[s],i[s]);return this.markAsUpdated(),this}maximizeInPlaceFromFloats(...e){const t=this._m;for(let i=0;i<16;i++)t[i]=Math.min(t[i],e[i]);return this.markAsUpdated(),this}negate(){return this.negateToRef(new L)}negateInPlace(){const e=this._m;for(let t=0;t<16;t++)e[t]=-e[t];return this.markAsUpdated(),this}negateToRef(e){const t=this._m,i=e._m;for(let s=0;s<16;s++)i[s]=-t[s];return e.markAsUpdated(),e}equals(e){const t=e;if(!t)return!1;if((this._isIdentity||t._isIdentity)&&!this._isIdentityDirty&&!t._isIdentityDirty)return this._isIdentity&&t._isIdentity;const i=this.m,s=t.m;return i[0]===s[0]&&i[1]===s[1]&&i[2]===s[2]&&i[3]===s[3]&&i[4]===s[4]&&i[5]===s[5]&&i[6]===s[6]&&i[7]===s[7]&&i[8]===s[8]&&i[9]===s[9]&&i[10]===s[10]&&i[11]===s[11]&&i[12]===s[12]&&i[13]===s[13]&&i[14]===s[14]&&i[15]===s[15]}equalsWithEpsilon(e,t=0){const i=this._m,s=e.m;for(let r=0;r<16;r++)if(!Qe(i[r],s[r],t))return!1;return!0}equalsToFloats(...e){const t=this._m;for(let i=0;i<16;i++)if(t[i]!=e[i])return!1;return!0}floor(){return this.floorToRef(new L)}floorToRef(e){const t=this._m,i=e._m;for(let s=0;s<16;s++)i[s]=Math.floor(t[s]);return e.markAsUpdated(),e}fract(){return this.fractToRef(new L)}fractToRef(e){const t=this._m,i=e._m;for(let s=0;s<16;s++)i[s]=t[s]-Math.floor(t[s]);return e.markAsUpdated(),e}clone(){const e=new L;return e.copyFrom(this),e}getClassName(){return"Matrix"}getHashCode(){let e=bi(this._m[0]);for(let t=1;t<16;t++)e=e*397^bi(this._m[t]);return e}decomposeToTransformNode(e){return e.rotationQuaternion=e.rotationQuaternion||new se,this.decompose(e.scaling,e.rotationQuaternion,e.position)}decompose(e,t,i,s,r=!0){if(this._isIdentity)return i&&i.setAll(0),e&&e.setAll(1),t&&t.copyFromFloats(0,0,0,1),!0;const a=this._m;if(i&&i.copyFromFloats(a[12],a[13],a[14]),e=e||de.Vector3[0],e.x=Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]),e.y=Math.sqrt(a[4]*a[4]+a[5]*a[5]+a[6]*a[6]),e.z=Math.sqrt(a[8]*a[8]+a[9]*a[9]+a[10]*a[10]),s){const o=(r?s.absoluteScaling.x:s.scaling.x)<0?-1:1,l=(r?s.absoluteScaling.y:s.scaling.y)<0?-1:1,h=(r?s.absoluteScaling.z:s.scaling.z)<0?-1:1;e.x*=o,e.y*=l,e.z*=h}else this.determinant()<=0&&(e.y*=-1);if(e._x===0||e._y===0||e._z===0)return t&&t.copyFromFloats(0,0,0,1),!1;if(t){const o=1/e._x,l=1/e._y,h=1/e._z;L.FromValuesToRef(a[0]*o,a[1]*o,a[2]*o,0,a[4]*l,a[5]*l,a[6]*l,0,a[8]*h,a[9]*h,a[10]*h,0,0,0,0,1,de.Matrix[0]),se.FromRotationMatrixToRef(de.Matrix[0],t)}return!0}getRow(e){if(e<0||e>3)return null;const t=e*4;return new Oe(this._m[t+0],this._m[t+1],this._m[t+2],this._m[t+3])}getRowToRef(e,t){if(e>=0&&e<=3){const i=e*4;t.x=this._m[i+0],t.y=this._m[i+1],t.z=this._m[i+2],t.w=this._m[i+3]}return t}setRow(e,t){return this.setRowFromFloats(e,t.x,t.y,t.z,t.w)}transpose(){const e=new L;return L.TransposeToRef(this,e),e}transposeToRef(e){return L.TransposeToRef(this,e),e}setRowFromFloats(e,t,i,s,r){if(e<0||e>3)return this;const a=e*4;return this._m[a+0]=t,this._m[a+1]=i,this._m[a+2]=s,this._m[a+3]=r,this.markAsUpdated(),this}scale(e){const t=new L;return this.scaleToRef(e,t),t}scaleToRef(e,t){for(let i=0;i<16;i++)t._m[i]=this._m[i]*e;return t.markAsUpdated(),t}scaleAndAddToRef(e,t){for(let i=0;i<16;i++)t._m[i]+=this._m[i]*e;return t.markAsUpdated(),t}scaleInPlace(e){const t=this._m;for(let i=0;i<16;i++)t[i]*=e;return this.markAsUpdated(),this}toNormalMatrix(e){const t=de.Matrix[0];this.invertToRef(t),t.transposeToRef(e);const i=e._m;return L.FromValuesToRef(i[0],i[1],i[2],0,i[4],i[5],i[6],0,i[8],i[9],i[10],0,0,0,0,1,e),e}getRotationMatrix(){const e=new L;return this.getRotationMatrixToRef(e),e}getRotationMatrixToRef(e){const t=de.Vector3[0];if(!this.decompose(t))return L.IdentityToRef(e),e;const i=this._m,s=1/t._x,r=1/t._y,a=1/t._z;return L.FromValuesToRef(i[0]*s,i[1]*s,i[2]*s,0,i[4]*r,i[5]*r,i[6]*r,0,i[8]*a,i[9]*a,i[10]*a,0,0,0,0,1,e),e}toggleModelMatrixHandInPlace(){const e=this._m;return e[2]*=-1,e[6]*=-1,e[8]*=-1,e[9]*=-1,e[14]*=-1,this.markAsUpdated(),this}toggleProjectionMatrixHandInPlace(){const e=this._m;return e[8]*=-1,e[9]*=-1,e[10]*=-1,e[11]*=-1,this.markAsUpdated(),this}static FromArray(e,t=0){const i=new L;return L.FromArrayToRef(e,t,i),i}static FromArrayToRef(e,t,i){for(let s=0;s<16;s++)i._m[s]=e[s+t];return i.markAsUpdated(),i}static FromFloat32ArrayToRefScaled(e,t,i,s){return s._m[0]=e[0+t]*i,s._m[1]=e[1+t]*i,s._m[2]=e[2+t]*i,s._m[3]=e[3+t]*i,s._m[4]=e[4+t]*i,s._m[5]=e[5+t]*i,s._m[6]=e[6+t]*i,s._m[7]=e[7+t]*i,s._m[8]=e[8+t]*i,s._m[9]=e[9+t]*i,s._m[10]=e[10+t]*i,s._m[11]=e[11+t]*i,s._m[12]=e[12+t]*i,s._m[13]=e[13+t]*i,s._m[14]=e[14+t]*i,s._m[15]=e[15+t]*i,s.markAsUpdated(),s}static get IdentityReadOnly(){return L._IdentityReadOnly}static FromValuesToRef(e,t,i,s,r,a,o,l,h,u,c,f,d,_,p,g,m){const v=m._m;v[0]=e,v[1]=t,v[2]=i,v[3]=s,v[4]=r,v[5]=a,v[6]=o,v[7]=l,v[8]=h,v[9]=u,v[10]=c,v[11]=f,v[12]=d,v[13]=_,v[14]=p,v[15]=g,m.markAsUpdated()}static FromValues(e,t,i,s,r,a,o,l,h,u,c,f,d,_,p,g){const m=new L,v=m._m;return v[0]=e,v[1]=t,v[2]=i,v[3]=s,v[4]=r,v[5]=a,v[6]=o,v[7]=l,v[8]=h,v[9]=u,v[10]=c,v[11]=f,v[12]=d,v[13]=_,v[14]=p,v[15]=g,m.markAsUpdated(),m}static Compose(e,t,i){const s=new L;return L.ComposeToRef(e,t,i,s),s}static ComposeToRef(e,t,i,s){const r=s._m,a=t._x,o=t._y,l=t._z,h=t._w,u=a+a,c=o+o,f=l+l,d=a*u,_=a*c,p=a*f,g=o*c,m=o*f,v=l*f,T=h*u,A=h*c,b=h*f,x=e._x,E=e._y,R=e._z;return r[0]=(1-(g+v))*x,r[1]=(_+b)*x,r[2]=(p-A)*x,r[3]=0,r[4]=(_-b)*E,r[5]=(1-(d+v))*E,r[6]=(m+T)*E,r[7]=0,r[8]=(p+A)*R,r[9]=(m-T)*R,r[10]=(1-(d+g))*R,r[11]=0,r[12]=i._x,r[13]=i._y,r[14]=i._z,r[15]=1,s.markAsUpdated(),s}static Identity(){const e=L.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return e._updateIdentityStatus(!0),e}static IdentityToRef(e){return L.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,e),e._updateIdentityStatus(!0),e}static Zero(){const e=L.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);return e._updateIdentityStatus(!1),e}static RotationX(e){const t=new L;return L.RotationXToRef(e,t),t}static Invert(e){const t=new L;return e.invertToRef(t),t}static RotationXToRef(e,t){const i=Math.sin(e),s=Math.cos(e);return L.FromValuesToRef(1,0,0,0,0,s,i,0,0,-i,s,0,0,0,0,1,t),t._updateIdentityStatus(s===1&&i===0),t}static RotationY(e){const t=new L;return L.RotationYToRef(e,t),t}static RotationYToRef(e,t){const i=Math.sin(e),s=Math.cos(e);return L.FromValuesToRef(s,0,-i,0,0,1,0,0,i,0,s,0,0,0,0,1,t),t._updateIdentityStatus(s===1&&i===0),t}static RotationZ(e){const t=new L;return L.RotationZToRef(e,t),t}static RotationZToRef(e,t){const i=Math.sin(e),s=Math.cos(e);return L.FromValuesToRef(s,i,0,0,-i,s,0,0,0,0,1,0,0,0,0,1,t),t._updateIdentityStatus(s===1&&i===0),t}static RotationAxis(e,t){const i=new L;return L.RotationAxisToRef(e,t,i),i}static RotationAxisToRef(e,t,i){const s=Math.sin(-t),r=Math.cos(-t),a=1-r;e=e.normalizeToRef(de.Vector3[0]);const o=i._m;return o[0]=e._x*e._x*a+r,o[1]=e._x*e._y*a-e._z*s,o[2]=e._x*e._z*a+e._y*s,o[3]=0,o[4]=e._y*e._x*a+e._z*s,o[5]=e._y*e._y*a+r,o[6]=e._y*e._z*a-e._x*s,o[7]=0,o[8]=e._z*e._x*a-e._y*s,o[9]=e._z*e._y*a+e._x*s,o[10]=e._z*e._z*a+r,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,i.markAsUpdated(),i}static RotationAlignToRef(e,t,i,s=!1){const r=y.Dot(t,e),a=i._m;if(r<-1+Ue)a[0]=-1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=s?1:-1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=s?-1:1,a[11]=0;else{const o=y.Cross(t,e),l=1/(1+r);a[0]=o._x*o._x*l+r,a[1]=o._y*o._x*l-o._z,a[2]=o._z*o._x*l+o._y,a[3]=0,a[4]=o._x*o._y*l+o._z,a[5]=o._y*o._y*l+r,a[6]=o._z*o._y*l-o._x,a[7]=0,a[8]=o._x*o._z*l-o._y,a[9]=o._y*o._z*l+o._x,a[10]=o._z*o._z*l+r,a[11]=0}return a[12]=0,a[13]=0,a[14]=0,a[15]=1,i.markAsUpdated(),i}static RotationYawPitchRoll(e,t,i){const s=new L;return L.RotationYawPitchRollToRef(e,t,i,s),s}static RotationYawPitchRollToRef(e,t,i,s){return se.RotationYawPitchRollToRef(e,t,i,de.Quaternion[0]),de.Quaternion[0].toRotationMatrix(s),s}static Scaling(e,t,i){const s=new L;return L.ScalingToRef(e,t,i,s),s}static ScalingToRef(e,t,i,s){return L.FromValuesToRef(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1,s),s._updateIdentityStatus(e===1&&t===1&&i===1),s}static Translation(e,t,i){const s=new L;return L.TranslationToRef(e,t,i,s),s}static TranslationToRef(e,t,i,s){return L.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,e,t,i,1,s),s._updateIdentityStatus(e===0&&t===0&&i===0),s}static Lerp(e,t,i){const s=new L;return L.LerpToRef(e,t,i,s),s}static LerpToRef(e,t,i,s){const r=s._m,a=e.m,o=t.m;for(let l=0;l<16;l++)r[l]=a[l]*(1-i)+o[l]*i;return s.markAsUpdated(),s}static DecomposeLerp(e,t,i){const s=new L;return L.DecomposeLerpToRef(e,t,i,s),s}static DecomposeLerpToRef(e,t,i,s){const r=de.Vector3[0],a=de.Quaternion[0],o=de.Vector3[1];e.decompose(r,a,o);const l=de.Vector3[2],h=de.Quaternion[1],u=de.Vector3[3];t.decompose(l,h,u);const c=de.Vector3[4];y.LerpToRef(r,l,i,c);const f=de.Quaternion[2];se.SlerpToRef(a,h,i,f);const d=de.Vector3[5];return y.LerpToRef(o,u,i,d),L.ComposeToRef(c,f,d,s),s}static LookAtLH(e,t,i){const s=new L;return L.LookAtLHToRef(e,t,i,s),s}static LookAtLHToRef(e,t,i,s){const r=de.Vector3[0],a=de.Vector3[1],o=de.Vector3[2];t.subtractToRef(e,o),o.normalize(),y.CrossToRef(i,o,r);const l=r.lengthSquared();l===0?r.x=1:r.normalizeFromLength(Math.sqrt(l)),y.CrossToRef(o,r,a),a.normalize();const h=-y.Dot(r,e),u=-y.Dot(a,e),c=-y.Dot(o,e);return L.FromValuesToRef(r._x,a._x,o._x,0,r._y,a._y,o._y,0,r._z,a._z,o._z,0,h,u,c,1,s),s}static LookAtRH(e,t,i){const s=new L;return L.LookAtRHToRef(e,t,i,s),s}static LookAtRHToRef(e,t,i,s){const r=de.Vector3[0],a=de.Vector3[1],o=de.Vector3[2];e.subtractToRef(t,o),o.normalize(),y.CrossToRef(i,o,r);const l=r.lengthSquared();l===0?r.x=1:r.normalizeFromLength(Math.sqrt(l)),y.CrossToRef(o,r,a),a.normalize();const h=-y.Dot(r,e),u=-y.Dot(a,e),c=-y.Dot(o,e);return L.FromValuesToRef(r._x,a._x,o._x,0,r._y,a._y,o._y,0,r._z,a._z,o._z,0,h,u,c,1,s),s}static LookDirectionLH(e,t){const i=new L;return L.LookDirectionLHToRef(e,t,i),i}static LookDirectionLHToRef(e,t,i){const s=de.Vector3[0];s.copyFrom(e),s.scaleInPlace(-1);const r=de.Vector3[1];return y.CrossToRef(t,s,r),L.FromValuesToRef(r._x,r._y,r._z,0,t._x,t._y,t._z,0,s._x,s._y,s._z,0,0,0,0,1,i),i}static LookDirectionRH(e,t){const i=new L;return L.LookDirectionRHToRef(e,t,i),i}static LookDirectionRHToRef(e,t,i){const s=de.Vector3[2];return y.CrossToRef(t,e,s),L.FromValuesToRef(s._x,s._y,s._z,0,t._x,t._y,t._z,0,e._x,e._y,e._z,0,0,0,0,1,i),i}static OrthoLH(e,t,i,s,r){const a=new L;return L.OrthoLHToRef(e,t,i,s,a,r),a}static OrthoLHToRef(e,t,i,s,r,a){const o=i,l=s,h=2/e,u=2/t,c=2/(l-o),f=-(l+o)/(l-o);return L.FromValuesToRef(h,0,0,0,0,u,0,0,0,0,c,0,0,0,f,1,r),a&&r.multiplyToRef(ar,r),r._updateIdentityStatus(h===1&&u===1&&c===1&&f===0),r}static OrthoOffCenterLH(e,t,i,s,r,a,o){const l=new L;return L.OrthoOffCenterLHToRef(e,t,i,s,r,a,l,o),l}static OrthoOffCenterLHToRef(e,t,i,s,r,a,o,l){const h=r,u=a,c=2/(t-e),f=2/(s-i),d=2/(u-h),_=-(u+h)/(u-h),p=(e+t)/(e-t),g=(s+i)/(i-s);return L.FromValuesToRef(c,0,0,0,0,f,0,0,0,0,d,0,p,g,_,1,o),l&&o.multiplyToRef(ar,o),o.markAsUpdated(),o}static ObliqueOffCenterLHToRef(e,t,i,s,r,a,o,l,h,u,c){const f=-o*Math.cos(l),d=-o*Math.sin(l);return L.TranslationToRef(0,0,-h,de.Matrix[1]),L.FromValuesToRef(1,0,0,0,0,1,0,0,f,d,1,0,0,0,0,1,de.Matrix[0]),de.Matrix[1].multiplyToRef(de.Matrix[0],de.Matrix[0]),L.TranslationToRef(0,0,h,de.Matrix[1]),de.Matrix[0].multiplyToRef(de.Matrix[1],de.Matrix[0]),L.OrthoOffCenterLHToRef(e,t,i,s,r,a,u,c),de.Matrix[0].multiplyToRef(u,u),u}static OrthoOffCenterRH(e,t,i,s,r,a,o){const l=new L;return L.OrthoOffCenterRHToRef(e,t,i,s,r,a,l,o),l}static OrthoOffCenterRHToRef(e,t,i,s,r,a,o,l){return L.OrthoOffCenterLHToRef(e,t,i,s,r,a,o,l),o._m[10]*=-1,o}static ObliqueOffCenterRHToRef(e,t,i,s,r,a,o,l,h,u,c){const f=o*Math.cos(l),d=o*Math.sin(l);return L.TranslationToRef(0,0,h,de.Matrix[1]),L.FromValuesToRef(1,0,0,0,0,1,0,0,f,d,1,0,0,0,0,1,de.Matrix[0]),de.Matrix[1].multiplyToRef(de.Matrix[0],de.Matrix[0]),L.TranslationToRef(0,0,-h,de.Matrix[1]),de.Matrix[0].multiplyToRef(de.Matrix[1],de.Matrix[0]),L.OrthoOffCenterRHToRef(e,t,i,s,r,a,u,c),de.Matrix[0].multiplyToRef(u,u),u}static PerspectiveLH(e,t,i,s,r,a=0){const o=new L,l=i,h=s,u=2*l/e,c=2*l/t,f=(h+l)/(h-l),d=-2*h*l/(h-l),_=Math.tan(a);return L.FromValuesToRef(u,0,0,0,0,c,0,_,0,0,f,1,0,0,d,0,o),r&&o.multiplyToRef(ar,o),o._updateIdentityStatus(!1),o}static PerspectiveFovLH(e,t,i,s,r,a=0,o=!1){const l=new L;return L.PerspectiveFovLHToRef(e,t,i,s,l,!0,r,a,o),l}static PerspectiveFovLHToRef(e,t,i,s,r,a=!0,o,l=0,h=!1){const u=i,c=s,f=1/Math.tan(e*.5),d=a?f/t:f,_=a?f:f*t,p=h&&u===0?-1:c!==0?(c+u)/(c-u):1,g=h&&u===0?2*c:c!==0?-2*c*u/(c-u):-2*u,m=Math.tan(l);return L.FromValuesToRef(d,0,0,0,0,_,0,m,0,0,p,1,0,0,g,0,r),o&&r.multiplyToRef(ar,r),r._updateIdentityStatus(!1),r}static PerspectiveFovReverseLHToRef(e,t,i,s,r,a=!0,o,l=0){const h=1/Math.tan(e*.5),u=a?h/t:h,c=a?h:h*t,f=Math.tan(l);return L.FromValuesToRef(u,0,0,0,0,c,0,f,0,0,-i,1,0,0,1,0,r),o&&r.multiplyToRef(ar,r),r._updateIdentityStatus(!1),r}static PerspectiveFovRH(e,t,i,s,r,a=0,o=!1){const l=new L;return L.PerspectiveFovRHToRef(e,t,i,s,l,!0,r,a,o),l}static PerspectiveFovRHToRef(e,t,i,s,r,a=!0,o,l=0,h=!1){const u=i,c=s,f=1/Math.tan(e*.5),d=a?f/t:f,_=a?f:f*t,p=h&&u===0?1:c!==0?-(c+u)/(c-u):-1,g=h&&u===0?2*c:c!==0?-2*c*u/(c-u):-2*u,m=Math.tan(l);return L.FromValuesToRef(d,0,0,0,0,_,0,m,0,0,p,-1,0,0,g,0,r),o&&r.multiplyToRef(ar,r),r._updateIdentityStatus(!1),r}static PerspectiveFovReverseRHToRef(e,t,i,s,r,a=!0,o,l=0){const h=1/Math.tan(e*.5),u=a?h/t:h,c=a?h:h*t,f=Math.tan(l);return L.FromValuesToRef(u,0,0,0,0,c,0,f,0,0,-i,-1,0,0,-1,0,r),o&&r.multiplyToRef(ar,r),r._updateIdentityStatus(!1),r}static GetFinalMatrix(e,t,i,s,r,a){const o=e.width,l=e.height,h=e.x,u=e.y,c=L.FromValues(o/2,0,0,0,0,-l/2,0,0,0,0,a-r,0,h+o/2,l/2+u,r,1),f=new L;return t.multiplyToRef(i,f),f.multiplyToRef(s,f),f.multiplyToRef(c,f)}static GetAsMatrix2x2(e){const t=e.m,i=[t[0],t[1],t[4],t[5]];return Gt.MatrixUse64Bits?i:new Float32Array(i)}static GetAsMatrix3x3(e){const t=e.m,i=[t[0],t[1],t[2],t[4],t[5],t[6],t[8],t[9],t[10]];return Gt.MatrixUse64Bits?i:new Float32Array(i)}static Transpose(e){const t=new L;return L.TransposeToRef(e,t),t}static TransposeToRef(e,t){const i=e.m,s=i[0],r=i[4],a=i[8],o=i[12],l=i[1],h=i[5],u=i[9],c=i[13],f=i[2],d=i[6],_=i[10],p=i[14],g=i[3],m=i[7],v=i[11],T=i[15],A=t._m;return A[0]=s,A[1]=r,A[2]=a,A[3]=o,A[4]=l,A[5]=h,A[6]=u,A[7]=c,A[8]=f,A[9]=d,A[10]=_,A[11]=p,A[12]=g,A[13]=m,A[14]=v,A[15]=T,t.markAsUpdated(),t._updateIdentityStatus(e._isIdentity,e._isIdentityDirty),t}static Reflection(e){const t=new L;return L.ReflectionToRef(e,t),t}static ReflectionToRef(e,t){e.normalize();const i=e.normal.x,s=e.normal.y,r=e.normal.z,a=-2*i,o=-2*s,l=-2*r;return L.FromValuesToRef(a*i+1,o*i,l*i,0,a*s,o*s+1,l*s,0,a*r,o*r,l*r+1,0,a*e.d,o*e.d,l*e.d,1,t),t}static FromXYZAxesToRef(e,t,i,s){return L.FromValuesToRef(e._x,e._y,e._z,0,t._x,t._y,t._z,0,i._x,i._y,i._z,0,0,0,0,1,s),s}static FromQuaternionToRef(e,t){const i=e._x*e._x,s=e._y*e._y,r=e._z*e._z,a=e._x*e._y,o=e._z*e._w,l=e._z*e._x,h=e._y*e._w,u=e._y*e._z,c=e._x*e._w;return t._m[0]=1-2*(s+r),t._m[1]=2*(a+o),t._m[2]=2*(l-h),t._m[3]=0,t._m[4]=2*(a-o),t._m[5]=1-2*(r+i),t._m[6]=2*(u+c),t._m[7]=0,t._m[8]=2*(l+h),t._m[9]=2*(u-c),t._m[10]=1-2*(s+i),t._m[11]=0,t._m[12]=0,t._m[13]=0,t._m[14]=0,t._m[15]=1,t.markAsUpdated(),t}}L._UpdateFlagSeed=0;L._IdentityReadOnly=L.Identity();Object.defineProperties(L.prototype,{dimension:{value:[4,4]},rank:{value:2}});class de{}de.Vector3=sr(11,y.Zero);de.Matrix=sr(2,L.Identity);de.Quaternion=sr(3,se.Zero);class N{}N.Vector2=sr(3,ne.Zero);N.Vector3=sr(13,y.Zero);N.Vector4=sr(3,Oe.Zero);N.Quaternion=sr(3,se.Zero);N.Matrix=sr(8,L.Identity);Tt("BABYLON.Vector2",ne);Tt("BABYLON.Vector3",y);Tt("BABYLON.Vector4",Oe);Tt("BABYLON.Matrix",L);const ar=L.FromValues(1,0,0,0,0,1,0,0,0,0,.5,0,0,0,.5,1);var zi;(function(n){n[n.LOCAL=0]="LOCAL",n[n.WORLD=1]="WORLD",n[n.BONE=2]="BONE"})(zi||(zi={}));class ni{}ni.X=new y(1,0,0);ni.Y=new y(0,1,0);ni.Z=new y(0,0,1);var mp;(function(n){n[n.X=0]="X",n[n.Y=1]="Y",n[n.Z=2]="Z"})(mp||(mp={}));function _a(n){return Math.pow(n,c4)}function pa(n){return n<=.04045?.0773993808*n:Math.pow(.947867299*(n+.055),2.4)}function ga(n){return Math.pow(n,u4)}function ma(n){return n<=.0031308?12.92*n:1.055*Math.pow(n,.41666)-.055}class fe{constructor(e=0,t=0,i=0){this.r=e,this.g=t,this.b=i}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"}getClassName(){return"Color3"}getHashCode(){let e=this.r*255|0;return e=e*397^(this.g*255|0),e=e*397^(this.b*255|0),e}toArray(e,t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,this}fromArray(e,t=0){return fe.FromArrayToRef(e,t,this),this}toColor4(e=1){return new K(this.r,this.g,this.b,e)}asArray(){return[this.r,this.g,this.b]}toLuminance(){return this.r*.3+this.g*.59+this.b*.11}multiply(e){return new fe(this.r*e.r,this.g*e.g,this.b*e.b)}multiplyToRef(e,t){return t.r=this.r*e.r,t.g=this.g*e.g,t.b=this.b*e.b,t}multiplyInPlace(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyByFloats(e,t,i){return new fe(this.r*e,this.g*t,this.b*i)}divide(e){throw new ReferenceError("Can not divide a color")}divideToRef(e,t){throw new ReferenceError("Can not divide a color")}divideInPlace(e){throw new ReferenceError("Can not divide a color")}minimizeInPlace(e){return this.minimizeInPlaceFromFloats(e.r,e.g,e.b)}maximizeInPlace(e){return this.maximizeInPlaceFromFloats(e.r,e.g,e.b)}minimizeInPlaceFromFloats(e,t,i){return this.r=Math.min(e,this.r),this.g=Math.min(t,this.g),this.b=Math.min(i,this.b),this}maximizeInPlaceFromFloats(e,t,i){return this.r=Math.max(e,this.r),this.g=Math.max(t,this.g),this.b=Math.max(i,this.b),this}floorToRef(e){throw new ReferenceError("Can not floor a color")}floor(){throw new ReferenceError("Can not floor a color")}fractToRef(e){throw new ReferenceError("Can not fract a color")}fract(){throw new ReferenceError("Can not fract a color")}equals(e){return e&&this.r===e.r&&this.g===e.g&&this.b===e.b}equalsFloats(e,t,i){return this.equalsToFloats(e,t,i)}equalsToFloats(e,t,i){return this.r===e&&this.g===t&&this.b===i}equalsWithEpsilon(e,t=Ue){return Qe(this.r,e.r,t)&&Qe(this.g,e.g,t)&&Qe(this.b,e.b,t)}negate(){throw new ReferenceError("Can not negate a color")}negateInPlace(){throw new ReferenceError("Can not negate a color")}negateToRef(e){throw new ReferenceError("Can not negate a color")}scale(e){return new fe(this.r*e,this.g*e,this.b*e)}scaleInPlace(e){return this.r*=e,this.g*=e,this.b*=e,this}scaleToRef(e,t){return t.r=this.r*e,t.g=this.g*e,t.b=this.b*e,t}scaleAndAddToRef(e,t){return t.r+=this.r*e,t.g+=this.g*e,t.b+=this.b*e,t}clampToRef(e=0,t=1,i){return i.r=lt(this.r,e,t),i.g=lt(this.g,e,t),i.b=lt(this.b,e,t),i}add(e){return new fe(this.r+e.r,this.g+e.g,this.b+e.b)}addInPlace(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addInPlaceFromFloats(e,t,i){return this.r+=e,this.g+=t,this.b+=i,this}addToRef(e,t){return t.r=this.r+e.r,t.g=this.g+e.g,t.b=this.b+e.b,t}subtract(e){return new fe(this.r-e.r,this.g-e.g,this.b-e.b)}subtractToRef(e,t){return t.r=this.r-e.r,t.g=this.g-e.g,t.b=this.b-e.b,t}subtractInPlace(e){return this.r-=e.r,this.g-=e.g,this.b-=e.b,this}subtractFromFloats(e,t,i){return new fe(this.r-e,this.g-t,this.b-i)}subtractFromFloatsToRef(e,t,i,s){return s.r=this.r-e,s.g=this.g-t,s.b=this.b-i,s}clone(){return new fe(this.r,this.g,this.b)}copyFrom(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copyFromFloats(e,t,i){return this.r=e,this.g=t,this.b=i,this}set(e,t,i){return this.copyFromFloats(e,t,i)}setAll(e){return this.r=this.g=this.b=e,this}toHexString(){const e=Math.round(this.r*255),t=Math.round(this.g*255),i=Math.round(this.b*255);return"#"+Bs(e)+Bs(t)+Bs(i)}fromHexString(e){return e.substring(0,1)!=="#"||e.length!==7?this:(this.r=parseInt(e.substring(1,3),16)/255,this.g=parseInt(e.substring(3,5),16)/255,this.b=parseInt(e.substring(5,7),16)/255,this)}toHSV(){return this.toHSVToRef(new fe)}toHSVToRef(e){const t=this.r,i=this.g,s=this.b,r=Math.max(t,i,s),a=Math.min(t,i,s);let o=0,l=0;const h=r,u=r-a;return r!==0&&(l=u/r),r!=a&&(r==t?(o=(i-s)/u,i<s&&(o+=6)):r==i?o=(s-t)/u+2:r==s&&(o=(t-i)/u+4),o*=60),e.r=o,e.g=l,e.b=h,e}toLinearSpace(e=!1){const t=new fe;return this.toLinearSpaceToRef(t,e),t}toLinearSpaceToRef(e,t=!1){return t?(e.r=pa(this.r),e.g=pa(this.g),e.b=pa(this.b)):(e.r=_a(this.r),e.g=_a(this.g),e.b=_a(this.b)),this}toGammaSpace(e=!1){const t=new fe;return this.toGammaSpaceToRef(t,e),t}toGammaSpaceToRef(e,t=!1){return t?(e.r=ma(this.r),e.g=ma(this.g),e.b=ma(this.b)):(e.r=ga(this.r),e.g=ga(this.g),e.b=ga(this.b)),this}static HSVtoRGBToRef(e,t,i,s){const r=i*t,a=e/60,o=r*(1-Math.abs(a%2-1));let l=0,h=0,u=0;a>=0&&a<=1?(l=r,h=o):a>=1&&a<=2?(l=o,h=r):a>=2&&a<=3?(h=r,u=o):a>=3&&a<=4?(h=o,u=r):a>=4&&a<=5?(l=o,u=r):a>=5&&a<=6&&(l=r,u=o);const c=i-r;return s.r=l+c,s.g=h+c,s.b=u+c,s}static FromHSV(e,t,i){const s=new fe(0,0,0);return fe.HSVtoRGBToRef(e,t,i,s),s}static FromHexString(e){return new fe(0,0,0).fromHexString(e)}static FromArray(e,t=0){return new fe(e[t],e[t+1],e[t+2])}static FromArrayToRef(e,t=0,i){i.r=e[t],i.g=e[t+1],i.b=e[t+2]}static FromInts(e,t,i){return new fe(e/255,t/255,i/255)}static Lerp(e,t,i){const s=new fe(0,0,0);return fe.LerpToRef(e,t,i,s),s}static LerpToRef(e,t,i,s){s.r=e.r+(t.r-e.r)*i,s.g=e.g+(t.g-e.g)*i,s.b=e.b+(t.b-e.b)*i}static Hermite(e,t,i,s,r){const a=r*r,o=r*a,l=2*o-3*a+1,h=-2*o+3*a,u=o-2*a+r,c=o-a,f=e.r*l+i.r*h+t.r*u+s.r*c,d=e.g*l+i.g*h+t.g*u+s.g*c,_=e.b*l+i.b*h+t.b*u+s.b*c;return new fe(f,d,_)}static Hermite1stDerivative(e,t,i,s,r){const a=fe.Black();return this.Hermite1stDerivativeToRef(e,t,i,s,r,a),a}static Hermite1stDerivativeToRef(e,t,i,s,r,a){const o=r*r;a.r=(o-r)*6*e.r+(3*o-4*r+1)*t.r+(-o+r)*6*i.r+(3*o-2*r)*s.r,a.g=(o-r)*6*e.g+(3*o-4*r+1)*t.g+(-o+r)*6*i.g+(3*o-2*r)*s.g,a.b=(o-r)*6*e.b+(3*o-4*r+1)*t.b+(-o+r)*6*i.b+(3*o-2*r)*s.b}static Red(){return new fe(1,0,0)}static Green(){return new fe(0,1,0)}static Blue(){return new fe(0,0,1)}static Black(){return new fe(0,0,0)}static get BlackReadOnly(){return fe._BlackReadOnly}static White(){return new fe(1,1,1)}static Purple(){return new fe(.5,0,.5)}static Magenta(){return new fe(1,0,1)}static Yellow(){return new fe(1,1,0)}static Gray(){return new fe(.5,.5,.5)}static Teal(){return new fe(0,1,1)}static Random(){return new fe(Math.random(),Math.random(),Math.random())}}fe._V8PerformanceHack=new fe(.5,.5,.5);fe._BlackReadOnly=fe.Black();Object.defineProperties(fe.prototype,{dimension:{value:[3]},rank:{value:1}});class K{constructor(e=0,t=0,i=0,s=1){this.r=e,this.g=t,this.b=i,this.a=s}asArray(){return[this.r,this.g,this.b,this.a]}toArray(e,t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e[t+3]=this.a,this}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this.a=e[t+3],this}equals(e){return e&&this.r===e.r&&this.g===e.g&&this.b===e.b&&this.a===e.a}add(e){return new K(this.r+e.r,this.g+e.g,this.b+e.b,this.a+e.a)}addToRef(e,t){return t.r=this.r+e.r,t.g=this.g+e.g,t.b=this.b+e.b,t.a=this.a+e.a,t}addInPlace(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this.a+=e.a,this}addInPlaceFromFloats(e,t,i,s){return this.r+=e,this.g+=t,this.b+=i,this.a+=s,this}subtract(e){return new K(this.r-e.r,this.g-e.g,this.b-e.b,this.a-e.a)}subtractToRef(e,t){return t.r=this.r-e.r,t.g=this.g-e.g,t.b=this.b-e.b,t.a=this.a-e.a,t}subtractInPlace(e){return this.r-=e.r,this.g-=e.g,this.b-=e.b,this.a-=e.a,this}subtractFromFloats(e,t,i,s){return new K(this.r-e,this.g-t,this.b-i,this.a-s)}subtractFromFloatsToRef(e,t,i,s,r){return r.r=this.r-e,r.g=this.g-t,r.b=this.b-i,r.a=this.a-s,r}scale(e){return new K(this.r*e,this.g*e,this.b*e,this.a*e)}scaleInPlace(e){return this.r*=e,this.g*=e,this.b*=e,this.a*=e,this}scaleToRef(e,t){return t.r=this.r*e,t.g=this.g*e,t.b=this.b*e,t.a=this.a*e,t}scaleAndAddToRef(e,t){return t.r+=this.r*e,t.g+=this.g*e,t.b+=this.b*e,t.a+=this.a*e,t}clampToRef(e=0,t=1,i){return i.r=lt(this.r,e,t),i.g=lt(this.g,e,t),i.b=lt(this.b,e,t),i.a=lt(this.a,e,t),i}multiply(e){return new K(this.r*e.r,this.g*e.g,this.b*e.b,this.a*e.a)}multiplyToRef(e,t){return t.r=this.r*e.r,t.g=this.g*e.g,t.b=this.b*e.b,t.a=this.a*e.a,t}multiplyInPlace(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this.a*=e.a,this}multiplyByFloats(e,t,i,s){return new K(this.r*e,this.g*t,this.b*i,this.a*s)}divide(e){throw new ReferenceError("Can not divide a color")}divideToRef(e,t){throw new ReferenceError("Can not divide a color")}divideInPlace(e){throw new ReferenceError("Can not divide a color")}minimizeInPlace(e){return this.r=Math.min(this.r,e.r),this.g=Math.min(this.g,e.g),this.b=Math.min(this.b,e.b),this.a=Math.min(this.a,e.a),this}maximizeInPlace(e){return this.r=Math.max(this.r,e.r),this.g=Math.max(this.g,e.g),this.b=Math.max(this.b,e.b),this.a=Math.max(this.a,e.a),this}minimizeInPlaceFromFloats(e,t,i,s){return this.r=Math.min(e,this.r),this.g=Math.min(t,this.g),this.b=Math.min(i,this.b),this.a=Math.min(s,this.a),this}maximizeInPlaceFromFloats(e,t,i,s){return this.r=Math.max(e,this.r),this.g=Math.max(t,this.g),this.b=Math.max(i,this.b),this.a=Math.max(s,this.a),this}floorToRef(e){throw new ReferenceError("Can not floor a color")}floor(){throw new ReferenceError("Can not floor a color")}fractToRef(e){throw new ReferenceError("Can not fract a color")}fract(){throw new ReferenceError("Can not fract a color")}negate(){throw new ReferenceError("Can not negate a color")}negateInPlace(){throw new ReferenceError("Can not negate a color")}negateToRef(e){throw new ReferenceError("Can not negate a color")}equalsWithEpsilon(e,t=Ue){return Qe(this.r,e.r,t)&&Qe(this.g,e.g,t)&&Qe(this.b,e.b,t)&&Qe(this.a,e.a,t)}equalsToFloats(e,t,i,s){return this.r===e&&this.g===t&&this.b===i&&this.a===s}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"}getClassName(){return"Color4"}getHashCode(){let e=this.r*255|0;return e=e*397^(this.g*255|0),e=e*397^(this.b*255|0),e=e*397^(this.a*255|0),e}clone(){return new K().copyFrom(this)}copyFrom(e){return this.r=e.r,this.g=e.g,this.b=e.b,this.a=e.a,this}copyFromFloats(e,t,i,s){return this.r=e,this.g=t,this.b=i,this.a=s,this}set(e,t,i,s){return this.copyFromFloats(e,t,i,s)}setAll(e){return this.r=this.g=this.b=this.a=e,this}toHexString(e=!1){const t=Math.round(this.r*255),i=Math.round(this.g*255),s=Math.round(this.b*255);if(e)return"#"+Bs(t)+Bs(i)+Bs(s);const r=Math.round(this.a*255);return"#"+Bs(t)+Bs(i)+Bs(s)+Bs(r)}fromHexString(e){return e.substring(0,1)!=="#"||e.length!==9&&e.length!==7?this:(this.r=parseInt(e.substring(1,3),16)/255,this.g=parseInt(e.substring(3,5),16)/255,this.b=parseInt(e.substring(5,7),16)/255,e.length===9&&(this.a=parseInt(e.substring(7,9),16)/255),this)}toLinearSpace(e=!1){const t=new K;return this.toLinearSpaceToRef(t,e),t}toLinearSpaceToRef(e,t=!1){return t?(e.r=pa(this.r),e.g=pa(this.g),e.b=pa(this.b)):(e.r=_a(this.r),e.g=_a(this.g),e.b=_a(this.b)),e.a=this.a,this}toGammaSpace(e=!1){const t=new K;return this.toGammaSpaceToRef(t,e),t}toGammaSpaceToRef(e,t=!1){return t?(e.r=ma(this.r),e.g=ma(this.g),e.b=ma(this.b)):(e.r=ga(this.r),e.g=ga(this.g),e.b=ga(this.b)),e.a=this.a,this}static FromHexString(e){return e.substring(0,1)!=="#"||e.length!==9&&e.length!==7?new K(0,0,0,0):new K(0,0,0,1).fromHexString(e)}static Lerp(e,t,i){return K.LerpToRef(e,t,i,new K)}static LerpToRef(e,t,i,s){return s.r=e.r+(t.r-e.r)*i,s.g=e.g+(t.g-e.g)*i,s.b=e.b+(t.b-e.b)*i,s.a=e.a+(t.a-e.a)*i,s}static Hermite(e,t,i,s,r){const a=r*r,o=r*a,l=2*o-3*a+1,h=-2*o+3*a,u=o-2*a+r,c=o-a,f=e.r*l+i.r*h+t.r*u+s.r*c,d=e.g*l+i.g*h+t.g*u+s.g*c,_=e.b*l+i.b*h+t.b*u+s.b*c,p=e.a*l+i.a*h+t.a*u+s.a*c;return new K(f,d,_,p)}static Hermite1stDerivative(e,t,i,s,r){const a=new K;return this.Hermite1stDerivativeToRef(e,t,i,s,r,a),a}static Hermite1stDerivativeToRef(e,t,i,s,r,a){const o=r*r;a.r=(o-r)*6*e.r+(3*o-4*r+1)*t.r+(-o+r)*6*i.r+(3*o-2*r)*s.r,a.g=(o-r)*6*e.g+(3*o-4*r+1)*t.g+(-o+r)*6*i.g+(3*o-2*r)*s.g,a.b=(o-r)*6*e.b+(3*o-4*r+1)*t.b+(-o+r)*6*i.b+(3*o-2*r)*s.b,a.a=(o-r)*6*e.a+(3*o-4*r+1)*t.a+(-o+r)*6*i.a+(3*o-2*r)*s.a}static FromColor3(e,t=1){return new K(e.r,e.g,e.b,t)}static FromArray(e,t=0){return new K(e[t],e[t+1],e[t+2],e[t+3])}static FromArrayToRef(e,t=0,i){i.r=e[t],i.g=e[t+1],i.b=e[t+2],i.a=e[t+3]}static FromInts(e,t,i,s){return new K(e/255,t/255,i/255,s/255)}static CheckColors4(e,t){if(e.length===t*3){const i=[];for(let s=0;s<e.length;s+=3){const r=s/3*4;i[r]=e[s],i[r+1]=e[s+1],i[r+2]=e[s+2],i[r+3]=1}return i}return e}}K._V8PerformanceHack=new K(.5,.5,.5,.5);Object.defineProperties(K.prototype,{dimension:{value:[4]},rank:{value:1}});class aa{}aa.Color3=Ws(3,fe.Black);aa.Color4=Ws(3,()=>new K(0,0,0,0));Tt("BABYLON.Color3",fe);Tt("BABYLON.Color4",K);class _i{constructor(e,t,i,s){this.normal=new y(e,t,i),this.d=s}asArray(){return[this.normal.x,this.normal.y,this.normal.z,this.d]}clone(){return new _i(this.normal.x,this.normal.y,this.normal.z,this.d)}getClassName(){return"Plane"}getHashCode(){let e=this.normal.getHashCode();return e=e*397^(this.d|0),e}normalize(){const e=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z);let t=0;return e!==0&&(t=1/e),this.normal.x*=t,this.normal.y*=t,this.normal.z*=t,this.d*=t,this}transform(e){const t=_i._TmpMatrix;e.invertToRef(t);const i=t.m,s=this.normal.x,r=this.normal.y,a=this.normal.z,o=this.d,l=s*i[0]+r*i[1]+a*i[2]+o*i[3],h=s*i[4]+r*i[5]+a*i[6]+o*i[7],u=s*i[8]+r*i[9]+a*i[10]+o*i[11],c=s*i[12]+r*i[13]+a*i[14]+o*i[15];return new _i(l,h,u,c)}dotCoordinate(e){return this.normal.x*e.x+this.normal.y*e.y+this.normal.z*e.z+this.d}copyFromPoints(e,t,i){const s=t.x-e.x,r=t.y-e.y,a=t.z-e.z,o=i.x-e.x,l=i.y-e.y,h=i.z-e.z,u=r*h-a*l,c=a*o-s*h,f=s*l-r*o,d=Math.sqrt(u*u+c*c+f*f);let _;return d!==0?_=1/d:_=0,this.normal.x=u*_,this.normal.y=c*_,this.normal.z=f*_,this.d=-(this.normal.x*e.x+this.normal.y*e.y+this.normal.z*e.z),this}isFrontFacingTo(e,t){return y.Dot(this.normal,e)<=t}signedDistanceTo(e){return y.Dot(e,this.normal)+this.d}static FromArray(e){return new _i(e[0],e[1],e[2],e[3])}static FromPoints(e,t,i){const s=new _i(0,0,0,0);return s.copyFromPoints(e,t,i),s}static FromPositionAndNormal(e,t){const i=new _i(0,0,0,0);return this.FromPositionAndNormalToRef(e,t,i)}static FromPositionAndNormalToRef(e,t,i){return i.normal.copyFrom(t),i.normal.normalize(),i.d=-e.dot(i.normal),i}static SignedDistanceToPlaneFromPositionAndNormal(e,t,i){const s=-(t.x*e.x+t.y*e.y+t.z*e.z);return y.Dot(i,t)+s}}_i._TmpMatrix=L.Identity();class Ji{static GetPlanes(e){const t=[];for(let i=0;i<6;i++)t.push(new _i(0,0,0,0));return Ji.GetPlanesToRef(e,t),t}static GetNearPlaneToRef(e,t){const i=e.m;t.normal.x=i[3]+i[2],t.normal.y=i[7]+i[6],t.normal.z=i[11]+i[10],t.d=i[15]+i[14],t.normalize()}static GetFarPlaneToRef(e,t){const i=e.m;t.normal.x=i[3]-i[2],t.normal.y=i[7]-i[6],t.normal.z=i[11]-i[10],t.d=i[15]-i[14],t.normalize()}static GetLeftPlaneToRef(e,t){const i=e.m;t.normal.x=i[3]+i[0],t.normal.y=i[7]+i[4],t.normal.z=i[11]+i[8],t.d=i[15]+i[12],t.normalize()}static GetRightPlaneToRef(e,t){const i=e.m;t.normal.x=i[3]-i[0],t.normal.y=i[7]-i[4],t.normal.z=i[11]-i[8],t.d=i[15]-i[12],t.normalize()}static GetTopPlaneToRef(e,t){const i=e.m;t.normal.x=i[3]-i[1],t.normal.y=i[7]-i[5],t.normal.z=i[11]-i[9],t.d=i[15]-i[13],t.normalize()}static GetBottomPlaneToRef(e,t){const i=e.m;t.normal.x=i[3]+i[1],t.normal.y=i[7]+i[5],t.normal.z=i[11]+i[9],t.d=i[15]+i[13],t.normalize()}static GetPlanesToRef(e,t){Ji.GetNearPlaneToRef(e,t[0]),Ji.GetFarPlaneToRef(e,t[1]),Ji.GetLeftPlaneToRef(e,t[2]),Ji.GetRightPlaneToRef(e,t[3]),Ji.GetTopPlaneToRef(e,t[4]),Ji.GetBottomPlaneToRef(e,t[5])}static IsPointInFrustum(e,t){for(let i=0;i<6;i++)if(t[i].dotCoordinate(e)<0)return!1;return!0}}var vp;(function(n){n[n.CW=0]="CW",n[n.CCW=1]="CCW"})(vp||(vp={}));class Us{constructor(e){this._radians=e,this._radians<0&&(this._radians+=2*Math.PI)}degrees(){return this._radians*180/Math.PI}radians(){return this._radians}static BetweenTwoPoints(e,t){const i=t.subtract(e),s=Math.atan2(i.y,i.x);return new Us(s)}static BetweenTwoVectors(e,t){let i=e.lengthSquared()*t.lengthSquared();if(i===0)return new Us(Math.PI/2);i=Math.sqrt(i);let s=e.dot(t)/i;s=lt(s,-1,1);const r=Math.acos(s);return new Us(r)}static FromRadians(e){return new Us(e)}static FromDegrees(e){return new Us(e*Math.PI/180)}}class g4{constructor(e,t,i){this.startPoint=e,this.midPoint=t,this.endPoint=i;const s=Math.pow(t.x,2)+Math.pow(t.y,2),r=(Math.pow(e.x,2)+Math.pow(e.y,2)-s)/2,a=(s-Math.pow(i.x,2)-Math.pow(i.y,2))/2,o=(e.x-t.x)*(t.y-i.y)-(t.x-i.x)*(e.y-t.y);this.centerPoint=new ne((r*(t.y-i.y)-a*(e.y-t.y))/o,((e.x-t.x)*a-(t.x-i.x)*r)/o),this.radius=this.centerPoint.subtract(this.startPoint).length(),this.startAngle=Us.BetweenTwoPoints(this.centerPoint,this.startPoint);const l=this.startAngle.degrees();let h=Us.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),u=Us.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();h-l>180&&(h-=360),h-l<-180&&(h+=360),u-h>180&&(u-=360),u-h<-180&&(u+=360),this.orientation=h-l<0?0:1,this.angle=Us.FromDegrees(this.orientation===0?l-u:u-l)}}class mh{constructor(e,t){this._points=new Array,this._length=0,this.closed=!1,this._points.push(new ne(e,t))}addLineTo(e,t){if(this.closed)return this;const i=new ne(e,t),s=this._points[this._points.length-1];return this._points.push(i),this._length+=i.subtract(s).length(),this}addArcTo(e,t,i,s,r=36){if(this.closed)return this;const a=this._points[this._points.length-1],o=new ne(e,t),l=new ne(i,s),h=new g4(a,o,l);let u=h.angle.radians()/r;h.orientation===0&&(u*=-1);let c=h.startAngle.radians()+u;for(let f=0;f<r;f++){const d=Math.cos(c)*h.radius+h.centerPoint.x,_=Math.sin(c)*h.radius+h.centerPoint.y;this.addLineTo(d,_),c+=u}return this}addQuadraticCurveTo(e,t,i,s,r=36){if(this.closed)return this;const a=(l,h,u,c)=>(1-l)*(1-l)*h+2*l*(1-l)*u+l*l*c,o=this._points[this._points.length-1];for(let l=0;l<=r;l++){const h=l/r,u=a(h,o.x,e,i),c=a(h,o.y,t,s);this.addLineTo(u,c)}return this}addBezierCurveTo(e,t,i,s,r,a,o=36){if(this.closed)return this;const l=(u,c,f,d,_)=>(1-u)*(1-u)*(1-u)*c+3*u*(1-u)*(1-u)*f+3*u*u*(1-u)*d+u*u*u*_,h=this._points[this._points.length-1];for(let u=0;u<=o;u++){const c=u/o,f=l(c,h.x,e,i,r),d=l(c,h.y,t,s,a);this.addLineTo(f,d)}return this}isPointInside(e){let t=!1;const i=this._points.length;for(let s=i-1,r=0;r<i;s=r++){let a=this._points[s],o=this._points[r],l=o.x-a.x,h=o.y-a.y;if(Math.abs(h)>Number.EPSILON){if(h<0&&(a=this._points[r],l=-l,o=this._points[s],h=-h),e.y<a.y||e.y>o.y)continue;if(e.y===a.y&&e.x===a.x)return!0;{const u=h*(e.x-a.x)-l*(e.y-a.y);if(u===0)return!0;if(u<0)continue;t=!t}}else{if(e.y!==a.y)continue;if(o.x<=e.x&&e.x<=a.x||a.x<=e.x&&e.x<=o.x)return!0}}return t}close(){return this.closed=!0,this}length(){let e=this._length;if(this.closed){const t=this._points[this._points.length-1],i=this._points[0];e+=i.subtract(t).length()}return e}area(){const e=this._points.length;let t=0;for(let i=e-1,s=0;s<e;i=s++)t+=this._points[i].x*this._points[s].y-this._points[s].x*this._points[i].y;return t*.5}getPoints(){return this._points}getPointAtLengthPosition(e){if(e<0||e>1)return ne.Zero();const t=e*this.length();let i=0;for(let s=0;s<this._points.length;s++){const r=(s+1)%this._points.length,a=this._points[s],l=this._points[r].subtract(a),h=l.length()+i;if(t>=i&&t<=h){const u=l.normalize(),c=t-i;return new ne(a.x+u.x*c,a.y+u.y*c)}i=h}return ne.Zero()}static StartingAt(e,t){return new mh(e,t)}}class Ho{constructor(e,t=null,i,s=!1){this.path=e,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array,this._pointAtData={id:0,point:y.Zero(),previousPointArrayIndex:0,position:0,subPosition:0,interpolateReady:!1,interpolationMatrix:L.Identity()};for(let r=0;r<e.length;r++)this._curve[r]=e[r].clone();this._raw=i||!1,this._alignTangentsWithPath=s,this._compute(t,s)}getCurve(){return this._curve}getPoints(){return this._curve}length(){return this._distances[this._distances.length-1]}getTangents(){return this._tangents}getNormals(){return this._normals}getBinormals(){return this._binormals}getDistances(){return this._distances}getPointAt(e){return this._updatePointAtData(e).point}getTangentAt(e,t=!1){return this._updatePointAtData(e,t),t?y.TransformCoordinates(y.Forward(),this._pointAtData.interpolationMatrix):this._tangents[this._pointAtData.previousPointArrayIndex]}getNormalAt(e,t=!1){return this._updatePointAtData(e,t),t?y.TransformCoordinates(y.Right(),this._pointAtData.interpolationMatrix):this._normals[this._pointAtData.previousPointArrayIndex]}getBinormalAt(e,t=!1){return this._updatePointAtData(e,t),t?y.TransformCoordinates(y.UpReadOnly,this._pointAtData.interpolationMatrix):this._binormals[this._pointAtData.previousPointArrayIndex]}getDistanceAt(e){return this.length()*e}getPreviousPointIndexAt(e){return this._updatePointAtData(e),this._pointAtData.previousPointArrayIndex}getSubPositionAt(e){return this._updatePointAtData(e),this._pointAtData.subPosition}getClosestPositionTo(e){let t=Number.MAX_VALUE,i=0;for(let s=0;s<this._curve.length-1;s++){const r=this._curve[s+0],a=this._curve[s+1].subtract(r).normalize(),o=this._distances[s+1]-this._distances[s+0],l=Math.min(Math.max(y.Dot(a,e.subtract(r).normalize()),0)*y.Distance(r,e)/o,1),h=y.Distance(r.add(a.scale(l*o)),e);h<t&&(t=h,i=(this._distances[s+0]+o*l)/this.length())}return i}slice(e=0,t=1){if(e<0&&(e=1-e*-1%1),t<0&&(t=1-t*-1%1),e>t){const h=e;e=t,t=h}const i=this.getCurve(),s=this.getPointAt(e);let r=this.getPreviousPointIndexAt(e);const a=this.getPointAt(t),o=this.getPreviousPointIndexAt(t)+1,l=[];return e!==0&&(r++,l.push(s)),l.push(...i.slice(r,o)),(t!==1||e===1)&&l.push(a),new Ho(l,this.getNormalAt(e),this._raw,this._alignTangentsWithPath)}update(e,t=null,i=!1){for(let s=0;s<e.length;s++)this._curve[s].x=e[s].x,this._curve[s].y=e[s].y,this._curve[s].z=e[s].z;return this._compute(t,i),this}_compute(e,t=!1){const i=this._curve.length;if(i<2)return;this._tangents[0]=this._getFirstNonNullVector(0),this._raw||this._tangents[0].normalize(),this._tangents[i-1]=this._curve[i-1].subtract(this._curve[i-2]),this._raw||this._tangents[i-1].normalize();const s=this._tangents[0],r=this._normalVector(s,e);this._normals[0]=r,this._raw||this._normals[0].normalize(),this._binormals[0]=y.Cross(s,this._normals[0]),this._raw||this._binormals[0].normalize(),this._distances[0]=0;let a,o,l,h,u;for(let c=1;c<i;c++)a=this._getLastNonNullVector(c),c<i-1&&(o=this._getFirstNonNullVector(c),this._tangents[c]=t?o:a.add(o),this._tangents[c].normalize()),this._distances[c]=this._distances[c-1]+this._curve[c].subtract(this._curve[c-1]).length(),l=this._tangents[c],u=this._binormals[c-1],this._normals[c]=y.Cross(u,l),this._raw||(this._normals[c].length()===0?(h=this._normals[c-1],this._normals[c]=h.clone()):this._normals[c].normalize()),this._binormals[c]=y.Cross(l,this._normals[c]),this._raw||this._binormals[c].normalize();this._pointAtData.id=NaN}_getFirstNonNullVector(e){let t=1,i=this._curve[e+t].subtract(this._curve[e]);for(;i.length()===0&&e+t+1<this._curve.length;)t++,i=this._curve[e+t].subtract(this._curve[e]);return i}_getLastNonNullVector(e){let t=1,i=this._curve[e].subtract(this._curve[e-t]);for(;i.length()===0&&e>t+1;)t++,i=this._curve[e].subtract(this._curve[e-t]);return i}_normalVector(e,t){let i,s=e.length();if(s===0&&(s=1),t==null){let r;Qe(Math.abs(e.y)/s,1,Ue)?Qe(Math.abs(e.x)/s,1,Ue)?Qe(Math.abs(e.z)/s,1,Ue)?r=y.Zero():r=new y(0,0,1):r=new y(1,0,0):r=new y(0,-1,0),i=y.Cross(e,r)}else i=y.Cross(e,t),y.CrossToRef(i,e,i);return i.normalize(),i}_updatePointAtData(e,t=!1){if(this._pointAtData.id===e)return this._pointAtData.interpolateReady||this._updateInterpolationMatrix(),this._pointAtData;this._pointAtData.id=e;const i=this.getPoints();if(e<=0)return this._setPointAtData(0,0,i[0],0,t);if(e>=1)return this._setPointAtData(1,1,i[i.length-1],i.length-1,t);let s=i[0],r,a=0;const o=e*this.length();for(let l=1;l<i.length;l++){r=i[l];const h=y.Distance(s,r);if(a+=h,a===o)return this._setPointAtData(e,1,r,l,t);if(a>o){const c=(a-o)/h,f=s.subtract(r),d=r.add(f.scaleInPlace(c));return this._setPointAtData(e,1-c,d,l-1,t)}s=r}return this._pointAtData}_setPointAtData(e,t,i,s,r){return this._pointAtData.point=i,this._pointAtData.position=e,this._pointAtData.subPosition=t,this._pointAtData.previousPointArrayIndex=s,this._pointAtData.interpolateReady=r,r&&this._updateInterpolationMatrix(),this._pointAtData}_updateInterpolationMatrix(){this._pointAtData.interpolationMatrix=L.Identity();const e=this._pointAtData.previousPointArrayIndex;if(e!==this._tangents.length-1){const t=e+1,i=this._tangents[e].clone(),s=this._normals[e].clone(),r=this._binormals[e].clone(),a=this._tangents[t].clone(),o=this._normals[t].clone(),l=this._binormals[t].clone(),h=se.RotationQuaternionFromAxis(s,r,i),u=se.RotationQuaternionFromAxis(o,l,a);se.Slerp(h,u,this._pointAtData.subPosition).toRotationMatrix(this._pointAtData.interpolationMatrix)}}}class Vi{constructor(e,t){this.width=e,this.height=t}toString(){return`{W: ${this.width}, H: ${this.height}}`}getClassName(){return"Size"}getHashCode(){let e=this.width|0;return e=e*397^(this.height|0),e}copyFrom(e){this.width=e.width,this.height=e.height}copyFromFloats(e,t){return this.width=e,this.height=t,this}set(e,t){return this.copyFromFloats(e,t)}multiplyByFloats(e,t){return new Vi(this.width*e,this.height*t)}clone(){return new Vi(this.width,this.height)}equals(e){return e?this.width===e.width&&this.height===e.height:!1}get surface(){return this.width*this.height}static Zero(){return new Vi(0,0)}add(e){return new Vi(this.width+e.width,this.height+e.height)}subtract(e){return new Vi(this.width-e.width,this.height-e.height)}scale(e){return new Vi(this.width*e,this.height*e)}static Lerp(e,t,i){const s=e.width+(t.width-e.width)*i,r=e.height+(t.height-e.height)*i;return new Vi(s,r)}}class Ca{constructor(e,t,i,s){this.x=e,this.y=t,this.width=i,this.height=s}toGlobal(e,t){return new Ca(this.x*e,this.y*t,this.width*e,this.height*t)}toGlobalToRef(e,t,i){return i.x=this.x*e,i.y=this.y*t,i.width=this.width*e,i.height=this.height*t,this}clone(){return new Ca(this.x,this.y,this.width,this.height)}}const Fs=[Math.sqrt(1/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(3/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(15/(4*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(5/(16*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(15/(16*Math.PI))],m4=[()=>1,n=>n.y,n=>n.z,n=>n.x,n=>n.x*n.y,n=>n.y*n.z,n=>3*n.z*n.z-1,n=>n.x*n.z,n=>n.x*n.x-n.y*n.y],tn=(n,e)=>Fs[n]*m4[n](e),sn=[Math.PI,2*Math.PI/3,2*Math.PI/3,2*Math.PI/3,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4];class Nl{constructor(){this.preScaled=!1,this.l00=y.Zero(),this.l1_1=y.Zero(),this.l10=y.Zero(),this.l11=y.Zero(),this.l2_2=y.Zero(),this.l2_1=y.Zero(),this.l20=y.Zero(),this.l21=y.Zero(),this.l22=y.Zero()}addLight(e,t,i){N.Vector3[0].set(t.r,t.g,t.b);const s=N.Vector3[0],r=N.Vector3[1];s.scaleToRef(i,r),r.scaleToRef(tn(0,e),N.Vector3[2]),this.l00.addInPlace(N.Vector3[2]),r.scaleToRef(tn(1,e),N.Vector3[2]),this.l1_1.addInPlace(N.Vector3[2]),r.scaleToRef(tn(2,e),N.Vector3[2]),this.l10.addInPlace(N.Vector3[2]),r.scaleToRef(tn(3,e),N.Vector3[2]),this.l11.addInPlace(N.Vector3[2]),r.scaleToRef(tn(4,e),N.Vector3[2]),this.l2_2.addInPlace(N.Vector3[2]),r.scaleToRef(tn(5,e),N.Vector3[2]),this.l2_1.addInPlace(N.Vector3[2]),r.scaleToRef(tn(6,e),N.Vector3[2]),this.l20.addInPlace(N.Vector3[2]),r.scaleToRef(tn(7,e),N.Vector3[2]),this.l21.addInPlace(N.Vector3[2]),r.scaleToRef(tn(8,e),N.Vector3[2]),this.l22.addInPlace(N.Vector3[2])}scaleInPlace(e){this.l00.scaleInPlace(e),this.l1_1.scaleInPlace(e),this.l10.scaleInPlace(e),this.l11.scaleInPlace(e),this.l2_2.scaleInPlace(e),this.l2_1.scaleInPlace(e),this.l20.scaleInPlace(e),this.l21.scaleInPlace(e),this.l22.scaleInPlace(e)}convertIncidentRadianceToIrradiance(){this.l00.scaleInPlace(sn[0]),this.l1_1.scaleInPlace(sn[1]),this.l10.scaleInPlace(sn[2]),this.l11.scaleInPlace(sn[3]),this.l2_2.scaleInPlace(sn[4]),this.l2_1.scaleInPlace(sn[5]),this.l20.scaleInPlace(sn[6]),this.l21.scaleInPlace(sn[7]),this.l22.scaleInPlace(sn[8])}convertIrradianceToLambertianRadiance(){this.scaleInPlace(1/Math.PI)}preScaleForRendering(){this.preScaled=!0,this.l00.scaleInPlace(Fs[0]),this.l1_1.scaleInPlace(Fs[1]),this.l10.scaleInPlace(Fs[2]),this.l11.scaleInPlace(Fs[3]),this.l2_2.scaleInPlace(Fs[4]),this.l2_1.scaleInPlace(Fs[5]),this.l20.scaleInPlace(Fs[6]),this.l21.scaleInPlace(Fs[7]),this.l22.scaleInPlace(Fs[8])}updateFromArray(e){return y.FromArrayToRef(e[0],0,this.l00),y.FromArrayToRef(e[1],0,this.l1_1),y.FromArrayToRef(e[2],0,this.l10),y.FromArrayToRef(e[3],0,this.l11),y.FromArrayToRef(e[4],0,this.l2_2),y.FromArrayToRef(e[5],0,this.l2_1),y.FromArrayToRef(e[6],0,this.l20),y.FromArrayToRef(e[7],0,this.l21),y.FromArrayToRef(e[8],0,this.l22),this}updateFromFloatsArray(e){return y.FromFloatsToRef(e[0],e[1],e[2],this.l00),y.FromFloatsToRef(e[3],e[4],e[5],this.l1_1),y.FromFloatsToRef(e[6],e[7],e[8],this.l10),y.FromFloatsToRef(e[9],e[10],e[11],this.l11),y.FromFloatsToRef(e[12],e[13],e[14],this.l2_2),y.FromFloatsToRef(e[15],e[16],e[17],this.l2_1),y.FromFloatsToRef(e[18],e[19],e[20],this.l20),y.FromFloatsToRef(e[21],e[22],e[23],this.l21),y.FromFloatsToRef(e[24],e[25],e[26],this.l22),this}static FromArray(e){return new Nl().updateFromArray(e)}static FromPolynomial(e){const t=new Nl;return t.l00=e.xx.scale(.376127).add(e.yy.scale(.376127)).add(e.zz.scale(.376126)),t.l1_1=e.y.scale(.977204),t.l10=e.z.scale(.977204),t.l11=e.x.scale(.977204),t.l2_2=e.xy.scale(1.16538),t.l2_1=e.yz.scale(1.16538),t.l20=e.zz.scale(1.34567).subtract(e.xx.scale(.672834)).subtract(e.yy.scale(.672834)),t.l21=e.zx.scale(1.16538),t.l22=e.xx.scale(1.16538).subtract(e.yy.scale(1.16538)),t.l1_1.scaleInPlace(-1),t.l11.scaleInPlace(-1),t.l2_1.scaleInPlace(-1),t.l21.scaleInPlace(-1),t.scaleInPlace(Math.PI),t}}class Ko{constructor(){this.x=y.Zero(),this.y=y.Zero(),this.z=y.Zero(),this.xx=y.Zero(),this.yy=y.Zero(),this.zz=y.Zero(),this.xy=y.Zero(),this.yz=y.Zero(),this.zx=y.Zero()}get preScaledHarmonics(){return this._harmonics||(this._harmonics=Nl.FromPolynomial(this)),this._harmonics.preScaled||this._harmonics.preScaleForRendering(),this._harmonics}addAmbient(e){N.Vector3[0].copyFromFloats(e.r,e.g,e.b);const t=N.Vector3[0];this.xx.addInPlace(t),this.yy.addInPlace(t),this.zz.addInPlace(t)}scaleInPlace(e){this.x.scaleInPlace(e),this.y.scaleInPlace(e),this.z.scaleInPlace(e),this.xx.scaleInPlace(e),this.yy.scaleInPlace(e),this.zz.scaleInPlace(e),this.yz.scaleInPlace(e),this.zx.scaleInPlace(e),this.xy.scaleInPlace(e)}updateFromHarmonics(e){return this._harmonics=e,this.x.copyFrom(e.l11),this.x.scaleInPlace(1.02333).scaleInPlace(-1),this.y.copyFrom(e.l1_1),this.y.scaleInPlace(1.02333).scaleInPlace(-1),this.z.copyFrom(e.l10),this.z.scaleInPlace(1.02333),this.xx.copyFrom(e.l00),N.Vector3[0].copyFrom(e.l20).scaleInPlace(.247708),N.Vector3[1].copyFrom(e.l22).scaleInPlace(.429043),this.xx.scaleInPlace(.886277).subtractInPlace(N.Vector3[0]).addInPlace(N.Vector3[1]),this.yy.copyFrom(e.l00),this.yy.scaleInPlace(.886277).subtractInPlace(N.Vector3[0]).subtractInPlace(N.Vector3[1]),this.zz.copyFrom(e.l00),N.Vector3[0].copyFrom(e.l20).scaleInPlace(.495417),this.zz.scaleInPlace(.886277).addInPlace(N.Vector3[0]),this.yz.copyFrom(e.l2_1),this.yz.scaleInPlace(.858086).scaleInPlace(-1),this.zx.copyFrom(e.l21),this.zx.scaleInPlace(.858086).scaleInPlace(-1),this.xy.copyFrom(e.l2_2),this.xy.scaleInPlace(.858086),this.scaleInPlace(1/Math.PI),this}static FromHarmonics(e){return new Ko().updateFromHarmonics(e)}static FromArray(e){const t=new Ko;return y.FromArrayToRef(e[0],0,t.x),y.FromArrayToRef(e[1],0,t.y),y.FromArrayToRef(e[2],0,t.z),y.FromArrayToRef(e[3],0,t.xx),y.FromArrayToRef(e[4],0,t.yy),y.FromArrayToRef(e[5],0,t.zz),y.FromArrayToRef(e[6],0,t.yz),y.FromArrayToRef(e[7],0,t.zx),y.FromArrayToRef(e[8],0,t.xy),t}}function P(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var o=n.length-1;o>=0;o--)(a=n[o])&&(r=(s<3?a(r):s>3?a(e,t,r):a(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r}const B0={},sl={};function v4(n){const e=n.getClassName();return sl[e]||(sl[e]={}),sl[e]}function wc(n){const e=n.getClassName();if(B0[e])return B0[e];B0[e]={};const t=B0[e];let i=n,s=e;for(;s;){const r=sl[s];for(const l in r)t[l]=r[l];let a,o=!1;do{if(a=Object.getPrototypeOf(i),!a.getClassName){o=!0;break}if(a.getClassName()!==s)break;i=a}while(a);if(o)break;s=a.getClassName(),i=a}return t}function Ms(n,e){return(t,i)=>{const s=v4(t);s[i]||(s[i]={type:n,sourceName:e})}}function y4(n,e=null){return(t,i)=>{const s=e||"_"+i;Object.defineProperty(t,i,{get:function(){return this[s]},set:function(r){var a;typeof((a=this[s])==null?void 0:a.equals)=="function"&&this[s].equals(r)||this[s]!==r&&(this[s]=r,t[n].apply(this))},enumerable:!0,configurable:!0})}}function Ze(n,e=null){return y4(n,e)}function B(n){return Ms(0,n)}function Zi(n){return Ms(1,n)}function En(n){return Ms(2,n)}function a0(n){return Ms(3,n)}function mv(n){return Ms(4,n)}function cs(n){return Ms(5,n)}function vv(n){return Ms(6,n)}function x4(n){return Ms(7,n)}function sd(n){return Ms(8,n)}function b4(n){return Ms(10,n)}function T4(n){return Ms(11,n)}function yn(n,e,t,i){const s=t.value;t.value=(...r)=>{let a=s;if(typeof _native<"u"&&_native[e]){const o=_native[e];i?a=(...l)=>i(...l)?o(...l):s(...l):a=o}return n[e]=a,a(...r)}}yn.filter=function(n){return(e,t,i)=>yn(e,t,i,n)};function nd(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,n=>{const e=Math.random()*16|0;return(n==="x"?e:e&3|8).toString(16)})}function A4(){return typeof _native<"u"&&_native.XMLHttpRequest?new _native.XMLHttpRequest:new XMLHttpRequest}class Wt{constructor(){this._xhr=A4(),this._requestURL=""}static get IsCustomRequestAvailable(){return Object.keys(Wt.CustomRequestHeaders).length>0||Wt.CustomRequestModifiers.length>0}get requestURL(){return this._requestURL}_injectCustomRequestHeaders(){if(!this._shouldSkipRequestModifications(this._requestURL))for(const e in Wt.CustomRequestHeaders){const t=Wt.CustomRequestHeaders[e];t&&this._xhr.setRequestHeader(e,t)}}_shouldSkipRequestModifications(e){return Wt.SkipRequestModificationForBabylonCDN&&(e.includes("preview.babylonjs.com")||e.includes("cdn.babylonjs.com"))}get onprogress(){return this._xhr.onprogress}set onprogress(e){this._xhr.onprogress=e}get readyState(){return this._xhr.readyState}get status(){return this._xhr.status}get statusText(){return this._xhr.statusText}get response(){return this._xhr.response}get responseURL(){return this._xhr.responseURL}get responseText(){return this._xhr.responseText}get responseType(){return this._xhr.responseType}set responseType(e){this._xhr.responseType=e}get timeout(){return this._xhr.timeout}set timeout(e){this._xhr.timeout=e}addEventListener(e,t,i){this._xhr.addEventListener(e,t,i)}removeEventListener(e,t,i){this._xhr.removeEventListener(e,t,i)}abort(){this._xhr.abort()}send(e){Wt.CustomRequestHeaders&&this._injectCustomRequestHeaders(),this._xhr.send(e)}open(e,t){for(const i of Wt.CustomRequestModifiers){if(this._shouldSkipRequestModifications(t))return;t=i(this._xhr,t)||t}t=t.replace("file:http:","http:"),t=t.replace("file:https:","https:"),this._requestURL=t,this._xhr.open(e,t,!0)}setRequestHeader(e,t){this._xhr.setRequestHeader(e,t)}getResponseHeader(e){return this._xhr.getResponseHeader(e)}}Wt.CustomRequestHeaders={};Wt.CustomRequestModifiers=new Array;Wt.SkipRequestModificationForBabylonCDN=!0;class xo{}xo.FilesToLoad={};class E4{static ExponentialBackoff(e=3,t=500){return(i,s,r)=>s.status!==0||r>=e||i.indexOf("file:")!==-1?-1:Math.pow(2,r)*t}}class Ma extends Error{}Ma._setPrototypeOf=Object.setPrototypeOf||((n,e)=>(n.__proto__=e,n));const Ur={MeshInvalidPositionsError:0,SceneLoaderError:3e3,LoadFileError:4e3,RequestFileError:4001,ReadFileError:4002};class Sn extends Ma{constructor(e,t,i){super(e),this.errorCode=t,this.innerError=i,this.name="RuntimeError",Ma._setPrototypeOf(this,Sn.prototype)}}const yv=n=>{const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let t="",i,s,r,a,o,l,h,u=0;const c=ArrayBuffer.isView(n)?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):new Uint8Array(n);for(;u<c.length;)i=c[u++],s=u<c.length?c[u++]:Number.NaN,r=u<c.length?c[u++]:Number.NaN,a=i>>2,o=(i&3)<<4|s>>4,l=(s&15)<<2|r>>6,h=r&63,isNaN(s)?l=h=64:isNaN(r)&&(h=64),t+=e.charAt(a)+e.charAt(o)+e.charAt(l)+e.charAt(h);return t},xv=n=>atob(n),S4=n=>{const e=xv(n),t=e.length,i=new Uint8Array(new ArrayBuffer(t));for(let s=0;s<t;s++)i[s]=e.charCodeAt(s);return i.buffer},bv=new RegExp(/^data:([^,]+\/[^,]+)?;base64,/i);class Ul extends Sn{constructor(e,t){super(e,Ur.LoadFileError),this.name="LoadFileError",Ma._setPrototypeOf(this,Ul.prototype),t instanceof Wt?this.request=t:this.file=t}}class kl extends Sn{constructor(e,t){super(e,Ur.RequestFileError),this.request=t,this.name="RequestFileError",Ma._setPrototypeOf(this,kl.prototype)}}class rd extends Sn{constructor(e,t){super(e,Ur.ReadFileError),this.file=t,this.name="ReadFileError",Ma._setPrototypeOf(this,rd.prototype)}}const R4=n=>(n=n.replace(/#/gm,"%23"),n),_t={DefaultRetryStrategy:E4.ExponentialBackoff(),BaseUrl:"",CorsBehavior:"anonymous",PreprocessUrl:n=>n,ScriptBaseUrl:"",ScriptPreprocessUrl:n=>n,CleanUrl:R4},ad=(n,e)=>{if(!(n&&n.indexOf("data:")===0)&&_t.CorsBehavior)if(typeof _t.CorsBehavior=="string"||_t.CorsBehavior instanceof String)e.crossOrigin=_t.CorsBehavior;else{const t=_t.CorsBehavior(n);t&&(e.crossOrigin=t)}},od=(n,e,t,i,s="",r,a=Ae.LastCreatedEngine)=>{if(typeof HTMLImageElement>"u"&&!(a!=null&&a._features.forceBitmapOverHTMLImageElement))return t("LoadImage is only supported in web or BabylonNative environments."),null;let o,l=!1;n instanceof ArrayBuffer||ArrayBuffer.isView(n)?typeof Blob<"u"&&typeof URL<"u"?(o=URL.createObjectURL(new Blob([n],{type:s})),l=!0):o=`data:${s};base64,`+yv(n):n instanceof Blob?(o=URL.createObjectURL(n),l=!0):(o=_t.CleanUrl(n),o=_t.PreprocessUrl(o));const h=b=>{if(t){const x=o||n.toString();t(`Error while trying to load image: ${x.indexOf("http")===0||x.length<=128?x:x.slice(0,128)+"..."}`,b)}};if(a!=null&&a._features.forceBitmapOverHTMLImageElement)return Qn(o,b=>{a.createImageBitmap(new Blob([b],{type:s}),{premultiplyAlpha:"none",...r}).then(x=>{e(x),l&&URL.revokeObjectURL(o)}).catch(x=>{t&&t("Error while trying to load image: "+n,x)})},void 0,i||void 0,!0,(b,x)=>{h(x)}),null;const u=new Image;ad(o,u);const c=[],f=()=>{c.forEach(b=>{b.target.addEventListener(b.name,b.handler)})},d=()=>{c.forEach(b=>{b.target.removeEventListener(b.name,b.handler)}),c.length=0},_=()=>{d(),e(u),l&&u.src&&URL.revokeObjectURL(u.src)},p=b=>{d(),h(b),l&&u.src&&URL.revokeObjectURL(u.src)},g=b=>{if(b.blockedURI!==u.src||b.disposition==="report")return;d();const x=new Error(`CSP violation of policy ${b.effectiveDirective} ${b.blockedURI}. Current policy is ${b.originalPolicy}`);Ae.UseFallbackTexture=!1,h(x),l&&u.src&&URL.revokeObjectURL(u.src),u.src=""};c.push({target:u,name:"load",handler:_}),c.push({target:u,name:"error",handler:p}),c.push({target:document,name:"securitypolicyviolation",handler:g}),f();const m=o.substring(0,5)==="blob:",v=o.substring(0,5)==="data:",T=()=>{m||v||!Wt.IsCustomRequestAvailable?u.src=o:Qn(o,(b,x,E)=>{const R=!s&&E?E:s,C=new Blob([b],{type:R}),I=URL.createObjectURL(C);l=!0,u.src=I},void 0,i||void 0,!0,(b,x)=>{h(x)})},A=()=>{i&&i.loadImage(o,u)};if(!m&&!v&&i&&i.enableTexturesOffline)i.open(A,T);else{if(o.indexOf("file:")!==-1){const b=decodeURIComponent(o.substring(5).toLowerCase());if(xo.FilesToLoad[b]&&typeof URL<"u"){try{let x;try{x=URL.createObjectURL(xo.FilesToLoad[b])}catch{x=URL.createObjectURL(xo.FilesToLoad[b])}u.src=x,l=!0}catch{u.src=""}return u}}T()}return u},Xo=(n,e,t,i,s)=>{const r=new FileReader,a={onCompleteObservable:new q,abort:()=>r.abort()};return r.onloadend=()=>a.onCompleteObservable.notifyObservers(a),s&&(r.onerror=()=>{s(new rd(`Unable to read ${n.name}`,n))}),r.onload=o=>{e(o.target.result)},t&&(r.onprogress=t),i?r.readAsArrayBuffer(n):r.readAsText(n),a},Qn=(n,e,t,i,s,r,a)=>{if(n.name)return Xo(n,e,t,s,r?u=>{r(void 0,u)}:void 0);const o=n;if(o.indexOf("file:")!==-1){let u=decodeURIComponent(o.substring(5).toLowerCase());u.indexOf("./")===0&&(u=u.substring(2));const c=xo.FilesToLoad[u];if(c)return Xo(c,e,t,s,r?f=>r(void 0,new Ul(f.message,f.file)):void 0)}const{match:l,type:h}=I4(o);if(l){const u={onCompleteObservable:new q,abort:()=>()=>{}};try{const c=s?ud(o):Av(o);e(c,void 0,h)}catch(c){r?r(void 0,c):U.Error(c.message||"Failed to parse the Data URL")}return Wo.SetImmediate(()=>{u.onCompleteObservable.notifyObservers(u)}),u}return ld(o,(u,c)=>{e(u,c==null?void 0:c.responseURL,c==null?void 0:c.getResponseHeader("content-type"))},t,i,s,r?u=>{r(u.request,new Ul(u.message,u.request))}:void 0,a)},ld=(n,e,t,i,s,r,a)=>{n=_t.CleanUrl(n),n=_t.PreprocessUrl(n);const o=_t.BaseUrl+n;let l=!1;const h={onCompleteObservable:new q,abort:()=>l=!0},u=()=>{let c=new Wt,f=null,d;const _=()=>{c&&(t&&c.removeEventListener("progress",t),d&&c.removeEventListener("readystatechange",d),c.removeEventListener("loadend",p))};let p=()=>{_(),h.onCompleteObservable.notifyObservers(h),h.onCompleteObservable.clear(),t=void 0,d=null,p=null,r=void 0,a=void 0,e=void 0};h.abort=()=>{l=!0,p&&p(),c&&c.readyState!==(XMLHttpRequest.DONE||4)&&c.abort(),f!==null&&(clearTimeout(f),f=null),c=null};const g=v=>{const T=v.message||"Unknown error";r&&c?r(new kl(T,c)):U.Error(T)},m=v=>{if(c){if(c.open("GET",o),a)try{a(c)}catch(T){g(T);return}s&&(c.responseType="arraybuffer"),t&&c.addEventListener("progress",t),p&&c.addEventListener("loadend",p),d=()=>{if(!(l||!c)&&c.readyState===(XMLHttpRequest.DONE||4)){if(d&&c.removeEventListener("readystatechange",d),c.status>=200&&c.status<300||c.status===0&&(!zt()||Tv())){const b=s?c.response:c.responseText;if(b!==null){try{e&&e(b,c)}catch(x){g(x)}return}}const T=_t.DefaultRetryStrategy;if(T){const b=T(o,c,v);if(b!==-1){_(),c=new Wt,f=setTimeout(()=>m(v+1),b);return}}const A=new kl("Error status: "+c.status+" "+c.statusText+" - Unable to load "+o,c);r&&r(A)}},c.addEventListener("readystatechange",d),c.send()}};m(0)};if(i&&i.enableSceneOffline){const c=d=>{d&&d.status>400?r&&r(d):u()},f=()=>{i&&i.loadFile(_t.BaseUrl+n,d=>{!l&&e&&e(d),h.onCompleteObservable.notifyObservers(h)},t?d=>{!l&&t&&t(d)}:void 0,c,s)};i.open(f,c)}else u();return h},Tv=()=>typeof location<"u"&&location.protocol==="file:",hd=n=>bv.test(n),I4=n=>{const e=bv.exec(n);return e===null||e.length===0?{match:!1,type:""}:{match:!0,type:e[0].replace("data:","").replace("base64,","")}};function ud(n){return S4(n.split(",")[1])}const Av=n=>xv(n.split(",")[1]),C4=()=>{re._FileToolsLoadImage=od,Dl.loadFile=Qn,nv.loadFile=Qn};C4();let Qa;const M4=(n,e,t,i,s,r,a,o,l,h)=>{Qa={DecodeBase64UrlToBinary:n,DecodeBase64UrlToString:e,DefaultRetryStrategy:t.DefaultRetryStrategy,BaseUrl:t.BaseUrl,CorsBehavior:t.CorsBehavior,PreprocessUrl:t.PreprocessUrl,IsBase64DataUrl:i,IsFileURL:s,LoadFile:r,LoadImage:a,ReadFile:o,RequestFile:l,SetCorsBehavior:h},Object.defineProperty(Qa,"DefaultRetryStrategy",{get:function(){return t.DefaultRetryStrategy},set:function(u){t.DefaultRetryStrategy=u}}),Object.defineProperty(Qa,"BaseUrl",{get:function(){return t.BaseUrl},set:function(u){t.BaseUrl=u}}),Object.defineProperty(Qa,"PreprocessUrl",{get:function(){return t.PreprocessUrl},set:function(u){t.PreprocessUrl=u}}),Object.defineProperty(Qa,"CorsBehavior",{get:function(){return t.CorsBehavior},set:function(u){t.CorsBehavior=u}})};M4(ud,Av,_t,hd,Tv,Qn,od,Xo,ld,ad);class cd{get wrapU(){return this._wrapU}set wrapU(e){this._wrapU=e}get wrapV(){return this._wrapV}set wrapV(e){this._wrapV=e}get coordinatesMode(){return 0}get isCube(){return this._texture?this._texture.isCube:!1}set isCube(e){this._texture&&(this._texture.isCube=e)}get is3D(){return this._texture?this._texture.is3D:!1}set is3D(e){this._texture&&(this._texture.is3D=e)}get is2DArray(){return this._texture?this._texture.is2DArray:!1}set is2DArray(e){this._texture&&(this._texture.is2DArray=e)}getClassName(){return"ThinTexture"}static _IsRenderTargetWrapper(e){return(e==null?void 0:e.shareDepth)!==void 0}constructor(e){this._wrapU=1,this._wrapV=1,this.wrapR=1,this.anisotropicFilteringLevel=4,this.delayLoadState=0,this._texture=null,this._engine=null,this._cachedSize=Vi.Zero(),this._cachedBaseSize=Vi.Zero(),this._initialSamplingMode=2,this._texture=cd._IsRenderTargetWrapper(e)?e.texture:e,this._texture&&(this._engine=this._texture.getEngine())}isReady(){return this.delayLoadState===4?(this.delayLoad(),!1):this._texture?this._texture.isReady:!1}delayLoad(){}getInternalTexture(){return this._texture}getSize(){if(this._texture){if(this._texture.width)return this._cachedSize.width=this._texture.width,this._cachedSize.height=this._texture.height,this._cachedSize;if(this._texture._size)return this._cachedSize.width=this._texture._size,this._cachedSize.height=this._texture._size,this._cachedSize}return this._cachedSize}getBaseSize(){return!this.isReady()||!this._texture?(this._cachedBaseSize.width=0,this._cachedBaseSize.height=0,this._cachedBaseSize):this._texture._size?(this._cachedBaseSize.width=this._texture._size,this._cachedBaseSize.height=this._texture._size,this._cachedBaseSize):(this._cachedBaseSize.width=this._texture.baseWidth,this._cachedBaseSize.height=this._texture.baseHeight,this._cachedBaseSize)}get samplingMode(){return this._texture?this._texture.samplingMode:this._initialSamplingMode}updateSamplingMode(e){this._texture&&this._engine&&this._engine.updateTextureSamplingMode(e,this._texture)}releaseInternalTexture(){this._texture&&(this._texture.dispose(),this._texture=null)}dispose(){this._texture&&(this.releaseInternalTexture(),this._engine=null)}}class dr{static Eval(e,t){return e.match(/\([^()]*\)/g)?e=e.replace(/\([^()]*\)/g,i=>(i=i.slice(1,i.length-1),dr._HandleParenthesisContent(i,t))):e=dr._HandleParenthesisContent(e,t),e==="true"?!0:e==="false"?!1:dr.Eval(e,t)}static _HandleParenthesisContent(e,t){t=t||(r=>r==="true");let i;const s=e.split("||");for(const r in s)if(Object.prototype.hasOwnProperty.call(s,r)){let a=dr._SimplifyNegation(s[r].trim());const o=a.split("&&");if(o.length>1)for(let l=0;l<o.length;++l){const h=dr._SimplifyNegation(o[l].trim());if(h!=="true"&&h!=="false"?h[0]==="!"?i=!t(h.substring(1)):i=t(h):i=h==="true",!i){a="false";break}}if(i||a==="true"){i=!0;break}a!=="true"&&a!=="false"?a[0]==="!"?i=!t(a.substring(1)):i=t(a):i=a==="true"}return i?"true":"false"}static _SimplifyNegation(e){return e=e.replace(/^[\s!]+/,t=>(t=t.replace(/[\s]/g,()=>""),t.length%2?"!":"")),e=e.trim(),e==="!true"?e="false":e==="!false"&&(e="true"),e}}class Ve{static EnableFor(e){e._tags=e._tags||{},e.hasTags=()=>Ve.HasTags(e),e.addTags=t=>Ve.AddTagsTo(e,t),e.removeTags=t=>Ve.RemoveTagsFrom(e,t),e.matchesTagsQuery=t=>Ve.MatchesQuery(e,t)}static DisableFor(e){delete e._tags,delete e.hasTags,delete e.addTags,delete e.removeTags,delete e.matchesTagsQuery}static HasTags(e){if(!e._tags)return!1;const t=e._tags;for(const i in t)if(Object.prototype.hasOwnProperty.call(t,i))return!0;return!1}static GetTags(e,t=!0){if(!e._tags)return null;if(t){const i=[];for(const s in e._tags)Object.prototype.hasOwnProperty.call(e._tags,s)&&e._tags[s]===!0&&i.push(s);return i.join(" ")}else return e._tags}static AddTagsTo(e,t){if(!t||typeof t!="string")return;t.split(" ").forEach(function(s){Ve._AddTagTo(e,s)})}static _AddTagTo(e,t){t=t.trim(),!(t===""||t==="true"||t==="false")&&(t.match(/[\s]/)||t.match(/^([!]|([|]|[&]){2})/)||(Ve.EnableFor(e),e._tags[t]=!0))}static RemoveTagsFrom(e,t){if(!Ve.HasTags(e))return;const i=t.split(" ");for(const s in i)Ve._RemoveTagFrom(e,i[s])}static _RemoveTagFrom(e,t){delete e._tags[t]}static MatchesQuery(e,t){return t===void 0?!0:t===""?Ve.HasTags(e):dr.Eval(t,i=>Ve.HasTags(e)&&e._tags[i])}}const yp=function(n,e,t,i={}){const s=n();Ve&&Ve.HasTags(e)&&Ve.AddTagsTo(s,Ve.GetTags(e,!0));const r=wc(s),a={};for(const o in r){const l=r[o],h=e[o],u=l.type;if(h!=null&&(o!=="uniqueId"||Ie.AllowLoadingUniqueId))switch(u){case 0:case 6:case 9:case 11:s[o]=h;break;case 1:i.cloneTexturesOnlyOnce&&a[h.uniqueId]?s[o]=a[h.uniqueId]:(s[o]=t||h.isRenderTarget?h:h.clone(),a[h.uniqueId]=s[o]);break;case 2:case 3:case 4:case 5:case 7:case 8:case 10:case 12:s[o]=t?h:h.clone();break}}return s};class Ie{static AppendSerializedAnimations(e,t){if(e.animations){t.animations=[];for(let i=0;i<e.animations.length;i++){const s=e.animations[i];t.animations.push(s.serialize())}}}static Serialize(e,t){t||(t={}),Ve&&(t.tags=Ve.GetTags(e));const i=wc(e);for(const s in i){const r=i[s],a=r.sourceName||s,o=r.type,l=e[s];if(l!=null&&(s!=="uniqueId"||Ie.AllowLoadingUniqueId))switch(o){case 0:t[a]=l;break;case 1:t[a]=l.serialize();break;case 2:t[a]=l.asArray();break;case 3:t[a]=l.serialize();break;case 4:t[a]=l.asArray();break;case 5:t[a]=l.asArray();break;case 6:t[a]=l.id;break;case 7:t[a]=l.serialize();break;case 8:t[a]=l.asArray();break;case 9:t[a]=l.serialize();break;case 10:t[a]=l.asArray();break;case 11:t[a]=l.id;break;case 12:t[a]=l.asArray();break}}return t}static ParseProperties(e,t,i,s){s||(s="");const r=wc(t);for(const a in r){const o=r[a],l=e[o.sourceName||a],h=o.type;if(l!=null&&(a!=="uniqueId"||Ie.AllowLoadingUniqueId)){const u=t;switch(h){case 0:u[a]=l;break;case 1:i&&(u[a]=Ie._TextureParser(l,i,s));break;case 2:u[a]=fe.FromArray(l);break;case 3:u[a]=Ie._FresnelParametersParser(l);break;case 4:u[a]=ne.FromArray(l);break;case 5:u[a]=y.FromArray(l);break;case 6:i&&(u[a]=i.getLastMeshById(l));break;case 7:u[a]=Ie._ColorCurvesParser(l);break;case 8:u[a]=K.FromArray(l);break;case 9:u[a]=Ie._ImageProcessingConfigurationParser(l);break;case 10:u[a]=se.FromArray(l);break;case 11:i&&(u[a]=i.getCameraById(l));break;case 12:u[a]=L.FromArray(l);break}}}}static Parse(e,t,i,s=null){const r=e();return Ve&&Ve.AddTagsTo(r,t.tags),Ie.ParseProperties(t,r,i,s),r}static Clone(e,t,i={}){return yp(e,t,!1,i)}static Instanciate(e,t){return yp(e,t,!0)}}Ie.AllowLoadingUniqueId=!1;Ie._ImageProcessingConfigurationParser=n=>{throw Ee("ImageProcessingConfiguration")};Ie._FresnelParametersParser=n=>{throw Ee("FresnelParameters")};Ie._ColorCurvesParser=n=>{throw Ee("ColorCurves")};Ie._TextureParser=(n,e,t)=>{throw Ee("Texture")};class ot extends cd{set hasAlpha(e){this._hasAlpha!==e&&(this._hasAlpha=e,this._scene&&this._scene.markAllMaterialsAsDirty(1,t=>t.hasTexture(this)))}get hasAlpha(){return this._hasAlpha}set getAlphaFromRGB(e){this._getAlphaFromRGB!==e&&(this._getAlphaFromRGB=e,this._scene&&this._scene.markAllMaterialsAsDirty(1,t=>t.hasTexture(this)))}get getAlphaFromRGB(){return this._getAlphaFromRGB}set coordinatesIndex(e){this._coordinatesIndex!==e&&(this._coordinatesIndex=e,this._scene&&this._scene.markAllMaterialsAsDirty(1,t=>t.hasTexture(this)))}get coordinatesIndex(){return this._coordinatesIndex}set coordinatesMode(e){this._coordinatesMode!==e&&(this._coordinatesMode=e,this._scene&&this._scene.markAllMaterialsAsDirty(1,t=>t.hasTexture(this)))}get coordinatesMode(){return this._coordinatesMode}get wrapU(){return this._wrapU}set wrapU(e){this._wrapU=e}get wrapV(){return this._wrapV}set wrapV(e){this._wrapV=e}get isCube(){return this._texture?this._texture.isCube:this._isCube}set isCube(e){this._texture?this._texture.isCube=e:this._isCube=e}get is3D(){return this._texture?this._texture.is3D:!1}set is3D(e){this._texture&&(this._texture.is3D=e)}get is2DArray(){return this._texture?this._texture.is2DArray:!1}set is2DArray(e){this._texture&&(this._texture.is2DArray=e)}get gammaSpace(){if(this._texture)this._texture._gammaSpace===null&&(this._texture._gammaSpace=this._gammaSpace);else return this._gammaSpace;return this._texture._gammaSpace&&!this._texture._useSRGBBuffer}set gammaSpace(e){var t;if(this._texture){if(this._texture._gammaSpace===e)return;this._texture._gammaSpace=e}else{if(this._gammaSpace===e)return;this._gammaSpace=e}(t=this.getScene())==null||t.markAllMaterialsAsDirty(1,i=>i.hasTexture(this))}get isRGBD(){return this._texture!=null&&this._texture._isRGBD}set isRGBD(e){var t;e!==this.isRGBD&&(this._texture&&(this._texture._isRGBD=e),(t=this.getScene())==null||t.markAllMaterialsAsDirty(1,i=>i.hasTexture(this)))}get noMipmap(){return!1}get lodGenerationOffset(){return this._texture?this._texture._lodGenerationOffset:0}set lodGenerationOffset(e){this._texture&&(this._texture._lodGenerationOffset=e)}get lodGenerationScale(){return this._texture?this._texture._lodGenerationScale:0}set lodGenerationScale(e){this._texture&&(this._texture._lodGenerationScale=e)}get linearSpecularLOD(){return this._texture?this._texture._linearSpecularLOD:!1}set linearSpecularLOD(e){this._texture&&(this._texture._linearSpecularLOD=e)}get irradianceTexture(){return this._texture?this._texture._irradianceTexture:null}set irradianceTexture(e){this._texture&&(this._texture._irradianceTexture=e)}get uid(){return this._uid||(this._uid=nd()),this._uid}toString(){return this.name}getClassName(){return"BaseTexture"}set onDispose(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)}get isBlocking(){return!0}get loadingError(){return this._loadingError}get errorObject(){return this._errorObject}constructor(e,t=null){super(null),this.metadata=null,this.reservedDataStore=null,this._hasAlpha=!1,this._getAlphaFromRGB=!1,this.level=1,this._coordinatesIndex=0,this.optimizeUVAllocation=!0,this._coordinatesMode=0,this.wrapR=1,this.anisotropicFilteringLevel=ot.DEFAULT_ANISOTROPIC_FILTERING_LEVEL,this._isCube=!1,this._gammaSpace=!0,this.invertZ=!1,this.lodLevelInAlpha=!1,this.isRenderTarget=!1,this._prefiltered=!1,this._forceSerialize=!1,this.animations=[],this.onDisposeObservable=new q,this._onDisposeObserver=null,this._scene=null,this._uid=null,this._parentContainer=null,this._loadingError=!1,e?ot._IsScene(e)?this._scene=e:this._engine=e:this._scene=Ae.LastCreatedScene,this._scene&&(this.uniqueId=this._scene.getUniqueId(),this._scene.addTexture(this),this._engine=this._scene.getEngine()),this._texture=t,this._uid=null}getScene(){return this._scene}_getEngine(){return this._engine}getTextureMatrix(){return L.IdentityReadOnly}getReflectionTextureMatrix(){return L.IdentityReadOnly}getRefractionTextureMatrix(){return this.getReflectionTextureMatrix()}isReadyOrNotBlocking(){return!this.isBlocking||this.isReady()||this.loadingError}scale(e){}get canRescale(){return!1}_getFromCache(e,t,i,s,r,a){const o=this._getEngine();if(!o)return null;const l=o._getUseSRGBBuffer(!!r,t),h=o.getLoadedTexturesCache();for(let u=0;u<h.length;u++){const c=h[u];if((r===void 0||l===c._useSRGBBuffer)&&(s===void 0||s===c.invertY)&&c.url===e&&c.generateMipMaps===!t&&(!i||i===c.samplingMode)&&(a===void 0||a===c.isCube))return c.incrementReferences(),c}return null}_rebuild(e=!1){}clone(){return null}get textureType(){return this._texture&&this._texture.type!==void 0?this._texture.type:0}get textureFormat(){return this._texture&&this._texture.format!==void 0?this._texture.format:5}_markAllSubMeshesAsTexturesDirty(){const e=this.getScene();e&&e.markAllMaterialsAsDirty(1)}readPixels(e=0,t=0,i=null,s=!0,r=!1,a=0,o=0,l=Number.MAX_VALUE,h=Number.MAX_VALUE){if(!this._texture)return null;const u=this._getEngine();if(!u)return null;const c=this.getSize();let f=c.width,d=c.height;t!==0&&(f=f/Math.pow(2,t),d=d/Math.pow(2,t),f=Math.round(f),d=Math.round(d)),l=Math.min(f,l),h=Math.min(d,h);try{return this._texture.isCube?u._readTexturePixels(this._texture,l,h,e,t,i,s,r,a,o):u._readTexturePixels(this._texture,l,h,-1,t,i,s,r,a,o)}catch{return null}}_readPixelsSync(e=0,t=0,i=null,s=!0,r=!1){if(!this._texture)return null;const a=this.getSize();let o=a.width,l=a.height;const h=this._getEngine();if(!h)return null;t!=0&&(o=o/Math.pow(2,t),l=l/Math.pow(2,t),o=Math.round(o),l=Math.round(l));try{return this._texture.isCube?h._readTexturePixelsSync(this._texture,o,l,e,t,i,s,r):h._readTexturePixelsSync(this._texture,o,l,-1,t,i,s,r)}catch{return null}}get _lodTextureHigh(){return this._texture?this._texture._lodTextureHigh:null}get _lodTextureMid(){return this._texture?this._texture._lodTextureMid:null}get _lodTextureLow(){return this._texture?this._texture._lodTextureLow:null}dispose(){if(this._scene){this._scene.stopAnimation&&this._scene.stopAnimation(this),this._scene.removePendingData(this);const e=this._scene.textures.indexOf(this);if(e>=0&&this._scene.textures.splice(e,1),this._scene.onTextureRemovedObservable.notifyObservers(this),this._scene=null,this._parentContainer){const t=this._parentContainer.textures.indexOf(this);t>-1&&this._parentContainer.textures.splice(t,1),this._parentContainer=null}}this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.metadata=null,super.dispose()}serialize(e=!1){if(!this.name&&!e)return null;const t=Ie.Serialize(this);return Ie.AppendSerializedAnimations(this,t),t}static WhenAllReady(e,t){let i=e.length;if(i===0){t();return}for(let s=0;s<e.length;s++){const r=e[s];if(r.isReady())--i===0&&t();else{const a=r.onLoadObservable;a?a.addOnce(()=>{--i===0&&t()}):--i===0&&t()}}}static _IsScene(e){return e.getClassName()==="Scene"}}ot.DEFAULT_ANISOTROPIC_FILTERING_LEVEL=4;P([B()],ot.prototype,"uniqueId",void 0);P([B()],ot.prototype,"name",void 0);P([B()],ot.prototype,"displayName",void 0);P([B()],ot.prototype,"metadata",void 0);P([B("hasAlpha")],ot.prototype,"_hasAlpha",void 0);P([B("getAlphaFromRGB")],ot.prototype,"_getAlphaFromRGB",void 0);P([B()],ot.prototype,"level",void 0);P([B("coordinatesIndex")],ot.prototype,"_coordinatesIndex",void 0);P([B()],ot.prototype,"optimizeUVAllocation",void 0);P([B("coordinatesMode")],ot.prototype,"_coordinatesMode",void 0);P([B()],ot.prototype,"wrapU",null);P([B()],ot.prototype,"wrapV",null);P([B()],ot.prototype,"wrapR",void 0);P([B()],ot.prototype,"anisotropicFilteringLevel",void 0);P([B()],ot.prototype,"isCube",null);P([B()],ot.prototype,"is3D",null);P([B()],ot.prototype,"is2DArray",null);P([B()],ot.prototype,"gammaSpace",null);P([B()],ot.prototype,"invertZ",void 0);P([B()],ot.prototype,"lodLevelInAlpha",void 0);P([B()],ot.prototype,"lodGenerationOffset",null);P([B()],ot.prototype,"lodGenerationScale",null);P([B()],ot.prototype,"linearSpecularLOD",null);P([Zi()],ot.prototype,"irradianceTexture",null);P([B()],ot.prototype,"isRenderTarget",void 0);Fe.prototype.createPrefilteredCubeTexture=function(n,e,t,i,s=null,r=null,a,o=null,l=!0){const h=async u=>{if(!u){s&&s(null);return}const c=u.texture;if(l?u.info.sphericalPolynomial&&(c._sphericalPolynomial=u.info.sphericalPolynomial):c._sphericalPolynomial=new Ko,c._source=9,this.getCaps().textureLOD){s&&s(c);return}const f=3,d=this._gl,_=u.width;if(!_)return;const{DDSTools:p}=await De(async()=>{const{DDSTools:m}=await import("./dds-BWCiKDbG.js");return{DDSTools:m}},__vite__mapDeps([1,2])),g=[];for(let m=0;m<f;m++){const T=1-m/(f-1),A=i,b=Math.log2(_)*t+i,x=A+(b-A)*T,E=Math.round(Math.min(Math.max(x,0),b)),R=new gt(this,2);if(R.type=c.type,R.format=c.format,R.width=Math.pow(2,Math.max(Math.log2(_)-E,0)),R.height=R.width,R.isCube=!0,R._cachedWrapU=0,R._cachedWrapV=0,this._bindTextureDirectly(d.TEXTURE_CUBE_MAP,R,!0),R.samplingMode=2,d.texParameteri(d.TEXTURE_CUBE_MAP,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_CUBE_MAP,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_CUBE_MAP,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_CUBE_MAP,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE),u.isDDS){const I=u.info,D=u.data;this._unpackFlipY(I.isCompressed),p.UploadDDSLevels(this,R,D,I,!0,6,E)}else U.Warn("DDS is the only prefiltered cube map supported so far.");this._bindTextureDirectly(d.TEXTURE_CUBE_MAP,null);const C=new ot(e);C._isCube=!0,C._texture=R,R.isReady=!0,g.push(C)}c._lodTextureHigh=g[2],c._lodTextureMid=g[1],c._lodTextureLow=g[0],s&&s(c)};return this.createCubeTexture(n,e,null,!1,h,r,a,o,l,t,i)};Fe.prototype.createUniformBuffer=function(n,e){const t=this._gl.createBuffer();if(!t)throw new Error("Unable to create uniform buffer");const i=new Vo(t);return this.bindUniformBuffer(i),n instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,n,this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(n),this._gl.STATIC_DRAW),this.bindUniformBuffer(null),i.references=1,i};Fe.prototype.createDynamicUniformBuffer=function(n,e){const t=this._gl.createBuffer();if(!t)throw new Error("Unable to create dynamic uniform buffer");const i=new Vo(t);return this.bindUniformBuffer(i),n instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,n,this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(n),this._gl.DYNAMIC_DRAW),this.bindUniformBuffer(null),i.references=1,i};Fe.prototype.updateUniformBuffer=function(n,e,t,i){this.bindUniformBuffer(n),t===void 0&&(t=0),i===void 0?e instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,t,e):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,t,new Float32Array(e)):e instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,e.subarray(t,t+i)):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,new Float32Array(e).subarray(t,t+i)),this.bindUniformBuffer(null)};Fe.prototype.bindUniformBuffer=function(n){this._gl.bindBuffer(this._gl.UNIFORM_BUFFER,n?n.underlyingResource:null)};Fe.prototype.bindUniformBufferBase=function(n,e,t){this._gl.bindBufferBase(this._gl.UNIFORM_BUFFER,e,n?n.underlyingResource:null)};Fe.prototype.bindUniformBlock=function(n,e,t){const i=n.program,s=this._gl.getUniformBlockIndex(i,e);s!==4294967295&&this._gl.uniformBlockBinding(i,s,t)};re.prototype.displayLoadingUI=function(){if(!zt())return;const n=this.loadingScreen;n&&n.displayLoadingUI()};re.prototype.hideLoadingUI=function(){if(!zt())return;const n=this._loadingScreen;n&&n.hideLoadingUI()};Object.defineProperty(re.prototype,"loadingScreen",{get:function(){return!this._loadingScreen&&this._renderingCanvas&&(this._loadingScreen=re.DefaultLoadingScreenFactory(this._renderingCanvas)),this._loadingScreen},set:function(n){this._loadingScreen=n},enumerable:!0,configurable:!0});Object.defineProperty(re.prototype,"loadingUIText",{set:function(n){this.loadingScreen.loadingUIText=n},enumerable:!0,configurable:!0});Object.defineProperty(re.prototype,"loadingUIBackgroundColor",{set:function(n){this.loadingScreen.loadingUIBackgroundColor=n},enumerable:!0,configurable:!0});re.prototype.getInputElement=function(){return this._renderingCanvas};re.prototype.getRenderingCanvasClientRect=function(){return this._renderingCanvas?this._renderingCanvas.getBoundingClientRect():null};re.prototype.getInputElementClientRect=function(){return this._renderingCanvas?this.getInputElement().getBoundingClientRect():null};re.prototype.getAspectRatio=function(n,e=!1){const t=n.viewport;return this.getRenderWidth(e)*t.width/(this.getRenderHeight(e)*t.height)};re.prototype.getScreenAspectRatio=function(){return this.getRenderWidth(!0)/this.getRenderHeight(!0)};re.prototype._verifyPointerLock=function(){var n;(n=this._onPointerLockChange)==null||n.call(this)};re.prototype.setAlphaEquation=function(n){if(this._alphaEquation!==n){switch(n){case 0:this._alphaState.setAlphaEquationParameters(32774,32774);break;case 1:this._alphaState.setAlphaEquationParameters(32778,32778);break;case 2:this._alphaState.setAlphaEquationParameters(32779,32779);break;case 3:this._alphaState.setAlphaEquationParameters(32776,32776);break;case 4:this._alphaState.setAlphaEquationParameters(32775,32775);break;case 5:this._alphaState.setAlphaEquationParameters(32775,32774);break}this._alphaEquation=n}};re.prototype.getInputElement=function(){return this._renderingCanvas};re.prototype.getDepthFunction=function(){return this._depthCullingState.depthFunc};re.prototype.setDepthFunction=function(n){this._depthCullingState.depthFunc=n};re.prototype.setDepthFunctionToGreater=function(){this.setDepthFunction(516)};re.prototype.setDepthFunctionToGreaterOrEqual=function(){this.setDepthFunction(518)};re.prototype.setDepthFunctionToLess=function(){this.setDepthFunction(513)};re.prototype.setDepthFunctionToLessOrEqual=function(){this.setDepthFunction(515)};re.prototype.getDepthWrite=function(){return this._depthCullingState.depthMask};re.prototype.setDepthWrite=function(n){this._depthCullingState.depthMask=n};re.prototype.getStencilBuffer=function(){return this._stencilState.stencilTest};re.prototype.setStencilBuffer=function(n){this._stencilState.stencilTest=n};re.prototype.getStencilMask=function(){return this._stencilState.stencilMask};re.prototype.setStencilMask=function(n){this._stencilState.stencilMask=n};re.prototype.getStencilFunction=function(){return this._stencilState.stencilFunc};re.prototype.getStencilFunctionReference=function(){return this._stencilState.stencilFuncRef};re.prototype.getStencilFunctionMask=function(){return this._stencilState.stencilFuncMask};re.prototype.setStencilFunction=function(n){this._stencilState.stencilFunc=n};re.prototype.setStencilFunctionReference=function(n){this._stencilState.stencilFuncRef=n};re.prototype.setStencilFunctionMask=function(n){this._stencilState.stencilFuncMask=n};re.prototype.getStencilOperationFail=function(){return this._stencilState.stencilOpStencilFail};re.prototype.getStencilOperationDepthFail=function(){return this._stencilState.stencilOpDepthFail};re.prototype.getStencilOperationPass=function(){return this._stencilState.stencilOpStencilDepthPass};re.prototype.setStencilOperationFail=function(n){this._stencilState.stencilOpStencilFail=n};re.prototype.setStencilOperationDepthFail=function(n){this._stencilState.stencilOpDepthFail=n};re.prototype.setStencilOperationPass=function(n){this._stencilState.stencilOpStencilDepthPass=n};re.prototype.cacheStencilState=function(){this._cachedStencilBuffer=this.getStencilBuffer(),this._cachedStencilFunction=this.getStencilFunction(),this._cachedStencilMask=this.getStencilMask(),this._cachedStencilOperationPass=this.getStencilOperationPass(),this._cachedStencilOperationFail=this.getStencilOperationFail(),this._cachedStencilOperationDepthFail=this.getStencilOperationDepthFail(),this._cachedStencilReference=this.getStencilFunctionReference()};re.prototype.restoreStencilState=function(){this.setStencilFunction(this._cachedStencilFunction),this.setStencilMask(this._cachedStencilMask),this.setStencilBuffer(this._cachedStencilBuffer),this.setStencilOperationPass(this._cachedStencilOperationPass),this.setStencilOperationFail(this._cachedStencilOperationFail),this.setStencilOperationDepthFail(this._cachedStencilOperationDepthFail),this.setStencilFunctionReference(this._cachedStencilReference)};re.prototype.setAlphaConstants=function(n,e,t,i){this._alphaState.setAlphaBlendConstants(n,e,t,i)};re.prototype.getAlphaMode=function(){return this._alphaMode};re.prototype.getAlphaEquation=function(){return this._alphaEquation};re.prototype.getRenderPassNames=function(){return this._renderPassNames};re.prototype.getCurrentRenderPassName=function(){return this._renderPassNames[this.currentRenderPassId]};re.prototype.createRenderPassId=function(n){const e=++re._RenderPassIdCounter;return this._renderPassNames[e]=n??"NONAME",e};re.prototype.releaseRenderPassId=function(n){this._renderPassNames[n]=void 0;for(let e=0;e<this.scenes.length;++e){const t=this.scenes[e];for(let i=0;i<t.meshes.length;++i){const s=t.meshes[i];if(s.subMeshes)for(let r=0;r<s.subMeshes.length;++r)s.subMeshes[r]._removeDrawWrapper(n)}}};function P4(n){!n||!n.setAttribute||(n.setAttribute("touch-action","none"),n.style.touchAction="none",n.style.webkitTapHighlightColor="transparent")}function Ev(n,e,t){n._onCanvasFocus=()=>{n.onCanvasFocusObservable.notifyObservers(n)},n._onCanvasBlur=()=>{n.onCanvasBlurObservable.notifyObservers(n)},n._onCanvasContextMenu=s=>{n.disableContextMenu&&s.preventDefault()},e.addEventListener("focus",n._onCanvasFocus),e.addEventListener("blur",n._onCanvasBlur),e.addEventListener("contextmenu",n._onCanvasContextMenu),n._onBlur=()=>{n.disablePerformanceMonitorInBackground&&n.performanceMonitor.disable(),n._windowIsBackground=!0},n._onFocus=()=>{n.disablePerformanceMonitorInBackground&&n.performanceMonitor.enable(),n._windowIsBackground=!1},n._onCanvasPointerOut=s=>{document.elementFromPoint(s.clientX,s.clientY)!==e&&n.onCanvasPointerOutObservable.notifyObservers(s)};const i=n.getHostWindow();i&&typeof i.addEventListener=="function"&&(i.addEventListener("blur",n._onBlur),i.addEventListener("focus",n._onFocus)),e.addEventListener("pointerout",n._onCanvasPointerOut),t.doNotHandleTouchAction||P4(e),!re.audioEngine&&t.audioEngine&&re.AudioEngineFactory&&(re.audioEngine=re.AudioEngineFactory(n.getRenderingCanvas(),n.getAudioContext(),n.getAudioDestination())),yo()&&(n._onFullscreenChange=()=>{n.isFullscreen=!!document.fullscreenElement,n.isFullscreen&&n._pointerLockRequested&&e&&fd(e)},document.addEventListener("fullscreenchange",n._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",n._onFullscreenChange,!1),n._onPointerLockChange=()=>{n.isPointerLock=document.pointerLockElement===e},document.addEventListener("pointerlockchange",n._onPointerLockChange,!1),document.addEventListener("webkitpointerlockchange",n._onPointerLockChange,!1)),n.enableOfflineSupport=re.OfflineProviderFactory!==void 0,n._deterministicLockstep=!!t.deterministicLockstep,n._lockstepMaxSteps=t.lockstepMaxSteps||0,n._timeStep=t.timeStep||1/60}function Sv(n,e){Ae.Instances.length===1&&re.audioEngine&&(re.audioEngine.dispose(),re.audioEngine=null);const t=n.getHostWindow();t&&typeof t.removeEventListener=="function"&&(t.removeEventListener("blur",n._onBlur),t.removeEventListener("focus",n._onFocus)),e&&(e.removeEventListener("focus",n._onCanvasFocus),e.removeEventListener("blur",n._onCanvasBlur),e.removeEventListener("pointerout",n._onCanvasPointerOut),e.removeEventListener("contextmenu",n._onCanvasContextMenu)),yo()&&(document.removeEventListener("fullscreenchange",n._onFullscreenChange),document.removeEventListener("mozfullscreenchange",n._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",n._onFullscreenChange),document.removeEventListener("msfullscreenchange",n._onFullscreenChange),document.removeEventListener("pointerlockchange",n._onPointerLockChange),document.removeEventListener("mspointerlockchange",n._onPointerLockChange),document.removeEventListener("mozpointerlockchange",n._onPointerLockChange),document.removeEventListener("webkitpointerlockchange",n._onPointerLockChange))}function Rv(n){const e=document.createElement("span");e.textContent="Hg",e.style.font=n;const t=document.createElement("div");t.style.display="inline-block",t.style.width="1px",t.style.height="0px",t.style.verticalAlign="bottom";const i=document.createElement("div");i.style.whiteSpace="nowrap",i.appendChild(e),i.appendChild(t),document.body.appendChild(i);let s=0,r=0;try{r=t.getBoundingClientRect().top-e.getBoundingClientRect().top,t.style.verticalAlign="baseline",s=t.getBoundingClientRect().top-e.getBoundingClientRect().top}finally{document.body.removeChild(i)}return{ascent:s,height:r,descent:r-s}}function Iv(n,e,t){return new Promise((s,r)=>{const a=new Image;a.onload=()=>{a.decode().then(()=>{n.createImageBitmap(a,t).then(o=>{s(o)})})},a.onerror=()=>{r(`Error loading image ${a.src}`)},a.src=e})}function Cv(n,e,t,i){const r=n.createCanvas(t,i).getContext("2d");if(!r)throw new Error("Unable to get 2d context for resizeImageBitmap");return r.drawImage(e,0,0),r.getImageData(0,0,t,i).data}function Mv(n){const e=n.requestFullscreen||n.webkitRequestFullscreen;e&&e.call(n)}function Pv(){const n=document;document.exitFullscreen?document.exitFullscreen():n.webkitCancelFullScreen&&n.webkitCancelFullScreen()}function fd(n){if(n.requestPointerLock){const e=n.requestPointerLock();e instanceof Promise?e.then(()=>{n.focus()}).catch(()=>{}):n.focus()}}function wv(){document.exitPointerLock&&document.exitPointerLock()}class Hi{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(e,t){Hi.Enabled&&(this._current+=e,t&&this._fetchResult())}beginMonitoring(){Hi.Enabled&&(this._startMonitoringTime=as.Now)}endMonitoring(e=!0){if(!Hi.Enabled)return;e&&this.fetchNewFrame();const t=as.Now;this._current=t-this._startMonitoringTime,e&&this._fetchResult()}endFrame(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const e=as.Now;e-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=e,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}Hi.Enabled=!0;class oe extends Fe{static get NpmPackage(){return re.NpmPackage}static get Version(){return re.Version}static get Instances(){return Ae.Instances}static get LastCreatedEngine(){return Ae.LastCreatedEngine}static get LastCreatedScene(){return Ae.LastCreatedScene}static DefaultLoadingScreenFactory(e){return re.DefaultLoadingScreenFactory(e)}get _supportsHardwareTextureRescaling(){return!!oe._RescalePostProcessFactory}_measureFps(){this._performanceMonitor.sampleFrame(),this._fps=this._performanceMonitor.averageFPS,this._deltaTime=this._performanceMonitor.instantaneousFrameTime||0}get performanceMonitor(){return this._performanceMonitor}constructor(e,t,i,s=!1){super(e,t,i,s),this.customAnimationFrameRequester=null,this._performanceMonitor=new hv,this._drawCalls=new Hi,e&&(this._features.supportRenderPasses=!0,i=this._creationOptions)}_initGLContext(){super._initGLContext(),this._rescalePostProcess=null}_sharedInit(e){super._sharedInit(e),Ev(this,e,this._creationOptions)}resizeImageBitmap(e,t,i){return Cv(this,e,t,i)}_createImageBitmapFromSource(e,t){return Iv(this,e,t)}switchFullscreen(e){this.isFullscreen?this.exitFullscreen():this.enterFullscreen(e)}enterFullscreen(e){this.isFullscreen||(this._pointerLockRequested=e,this._renderingCanvas&&Mv(this._renderingCanvas))}exitFullscreen(){this.isFullscreen&&Pv()}setDitheringState(e){e?this._gl.enable(this._gl.DITHER):this._gl.disable(this._gl.DITHER)}setRasterizerState(e){e?this._gl.disable(this._gl.RASTERIZER_DISCARD):this._gl.enable(this._gl.RASTERIZER_DISCARD)}setDirectViewport(e,t,i,s){const r=this._cachedViewport;return this._cachedViewport=null,this._viewport(e,t,i,s),r}scissorClear(e,t,i,s,r){this.enableScissor(e,t,i,s),this.clear(r,!0,!0,!0),this.disableScissor()}enableScissor(e,t,i,s){const r=this._gl;r.enable(r.SCISSOR_TEST),r.scissor(e,t,i,s)}disableScissor(){const e=this._gl;e.disable(e.SCISSOR_TEST)}_loadFileAsync(e,t,i){return new Promise((s,r)=>{this._loadFile(e,a=>{s(a)},void 0,t,i,(a,o)=>{r(o)})})}getVertexShaderSource(e){const t=this._gl.getAttachedShaders(e);return t?this._gl.getShaderSource(t[0]):null}getFragmentShaderSource(e){const t=this._gl.getAttachedShaders(e);return t?this._gl.getShaderSource(t[1]):null}set framebufferDimensionsObject(e){this._framebufferDimensionsObject=e,this._framebufferDimensionsObject&&this.onResizeObservable.notifyObservers(this)}_rebuildBuffers(){for(const e of this.scenes)e.resetCachedMaterial(),e._rebuildGeometries();for(const e of this._virtualScenes)e.resetCachedMaterial(),e._rebuildGeometries();super._rebuildBuffers()}getFontOffset(e){return Rv(e)}_cancelFrame(){if(this.customAnimationFrameRequester){if(this._frameHandler!==0){this._frameHandler=0;const{cancelAnimationFrame:e}=this.customAnimationFrameRequester;e&&e(this.customAnimationFrameRequester.requestID)}}else super._cancelFrame()}_renderLoop(e){this._processFrame(e),this._activeRenderLoops.length>0&&this._frameHandler===0&&(this.customAnimationFrameRequester?(this.customAnimationFrameRequester.requestID=this._queueNewFrame(this.customAnimationFrameRequester.renderFunction||this._boundRenderFunction,this.customAnimationFrameRequester),this._frameHandler=this.customAnimationFrameRequester.requestID):this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()))}enterPointerlock(){this._renderingCanvas&&fd(this._renderingCanvas)}exitPointerlock(){wv()}beginFrame(){this._measureFps(),super.beginFrame()}_deletePipelineContext(e){const t=e;t&&t.program&&t.transformFeedback&&(this.deleteTransformFeedback(t.transformFeedback),t.transformFeedback=null),super._deletePipelineContext(e)}createShaderProgram(e,t,i,s,r,a=null){r=r||this._gl,this.onBeforeShaderCompilationObservable.notifyObservers(this);const o=super.createShaderProgram(e,t,i,s,r,a);return this.onAfterShaderCompilationObservable.notifyObservers(this),o}_createShaderProgram(e,t,i,s,r=null){const a=s.createProgram();if(e.program=a,!a)throw new Error("Unable to create program");if(s.attachShader(a,t),s.attachShader(a,i),this.webGLVersion>1&&r){const o=this.createTransformFeedback();this.bindTransformFeedback(o),this.setTranformFeedbackVaryings(a,r),e.transformFeedback=o}return s.linkProgram(a),this.webGLVersion>1&&r&&this.bindTransformFeedback(null),e.context=s,e.vertexShader=t,e.fragmentShader=i,e.isParallelCompiled||this._finalizePipelineContext(e),a}_releaseTexture(e){super._releaseTexture(e)}_releaseRenderTargetWrapper(e){super._releaseRenderTargetWrapper(e),this.scenes.forEach(t=>{t.postProcesses.forEach(i=>{i._outputTexture===e&&(i._outputTexture=null)}),t.cameras.forEach(i=>{i._postProcesses.forEach(s=>{s&&s._outputTexture===e&&(s._outputTexture=null)})})})}_rescaleTexture(e,t,i,s,r){this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE);const a=this.createRenderTargetTexture({width:t.width,height:t.height},{generateMipMaps:!1,type:0,samplingMode:2,generateDepthBuffer:!1,generateStencilBuffer:!1});if(!this._rescalePostProcess&&oe._RescalePostProcessFactory&&(this._rescalePostProcess=oe._RescalePostProcessFactory(this)),this._rescalePostProcess){this._rescalePostProcess.externalTextureSamplerBinding=!0;const o=()=>{this._rescalePostProcess.onApply=function(u){u._bindTexture("textureSampler",e)};let h=i;h||(h=this.scenes[this.scenes.length-1]),h.postProcessManager.directRender([this._rescalePostProcess],a,!0),this._bindTextureDirectly(this._gl.TEXTURE_2D,t,!0),this._gl.copyTexImage2D(this._gl.TEXTURE_2D,0,s,0,0,t.width,t.height,0),this.unBindFramebuffer(a),a.dispose(),r&&r()},l=this._rescalePostProcess.getEffect();l?l.executeWhenCompiled(o):this._rescalePostProcess.onEffectCreatedObservable.addOnce(h=>{h.executeWhenCompiled(o)})}}wrapWebGLTexture(e,t=!1,i=3,s=0,r=0){const a=new lv(e,this._gl),o=new gt(this,0,!0);return o._hardwareTexture=a,o.baseWidth=s,o.baseHeight=r,o.width=s,o.height=r,o.isReady=!0,o.useMipMaps=t,this.updateTextureSamplingMode(i,o),o}_uploadImageToTexture(e,t,i=0,s=0){const r=this._gl,a=this._getWebGLTextureType(e.type),o=this._getInternalFormat(e.format),l=this._getRGBABufferInternalSizedFormat(e.type,o),h=e.isCube?r.TEXTURE_CUBE_MAP:r.TEXTURE_2D;this._bindTextureDirectly(h,e,!0),this._unpackFlipY(e.invertY);let u=r.TEXTURE_2D;e.isCube&&(u=r.TEXTURE_CUBE_MAP_POSITIVE_X+i),r.texImage2D(u,s,l,o,a,t),this._bindTextureDirectly(h,null,!0)}updateTextureComparisonFunction(e,t){if(this.webGLVersion===1){U.Error("WebGL 1 does not support texture comparison.");return}const i=this._gl;e.isCube?(this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,e,!0),t===0?(i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_COMPARE_FUNC,515),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_COMPARE_MODE,i.NONE)):(i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_COMPARE_FUNC,t),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_COMPARE_MODE,i.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)):(this._bindTextureDirectly(this._gl.TEXTURE_2D,e,!0),t===0?(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_COMPARE_FUNC,515),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_COMPARE_MODE,i.NONE)):(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_COMPARE_FUNC,t),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_COMPARE_MODE,i.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)),e._comparisonFunction=t}createInstancesBuffer(e){const t=this._gl.createBuffer();if(!t)throw new Error("Unable to create instance buffer");const i=new Vo(t);return i.capacity=e,this.bindArrayBuffer(i),this._gl.bufferData(this._gl.ARRAY_BUFFER,e,this._gl.DYNAMIC_DRAW),i.references=1,i}deleteInstancesBuffer(e){this._gl.deleteBuffer(e)}_clientWaitAsync(e,t=0,i=10){const s=this._gl;return new Promise((r,a)=>{gh(()=>{const o=s.clientWaitSync(e,t,0);if(o==s.WAIT_FAILED)throw new Error("clientWaitSync failed");return o!=s.TIMEOUT_EXPIRED},r,a,i)})}_readPixelsAsync(e,t,i,s,r,a,o){if(this._webGLVersion<2)throw new Error("_readPixelsAsync only work on WebGL2+");const l=this._gl,h=l.createBuffer();l.bindBuffer(l.PIXEL_PACK_BUFFER,h),l.bufferData(l.PIXEL_PACK_BUFFER,o.byteLength,l.STREAM_READ),l.readPixels(e,t,i,s,r,a,0),l.bindBuffer(l.PIXEL_PACK_BUFFER,null);const u=l.fenceSync(l.SYNC_GPU_COMMANDS_COMPLETE,0);return u?(l.flush(),this._clientWaitAsync(u,0,10).then(()=>(l.deleteSync(u),l.bindBuffer(l.PIXEL_PACK_BUFFER,h),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,o),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),l.deleteBuffer(h),o))):null}dispose(){this.hideLoadingUI(),this._rescalePostProcess&&this._rescalePostProcess.dispose(),Sv(this,this._renderingCanvas),super.dispose()}}oe.ALPHA_DISABLE=0;oe.ALPHA_ADD=1;oe.ALPHA_COMBINE=2;oe.ALPHA_SUBTRACT=3;oe.ALPHA_MULTIPLY=4;oe.ALPHA_MAXIMIZED=5;oe.ALPHA_ONEONE=6;oe.ALPHA_PREMULTIPLIED=7;oe.ALPHA_PREMULTIPLIED_PORTERDUFF=8;oe.ALPHA_INTERPOLATE=9;oe.ALPHA_SCREENMODE=10;oe.DELAYLOADSTATE_NONE=0;oe.DELAYLOADSTATE_LOADED=1;oe.DELAYLOADSTATE_LOADING=2;oe.DELAYLOADSTATE_NOTLOADED=4;oe.NEVER=512;oe.ALWAYS=519;oe.LESS=513;oe.EQUAL=514;oe.LEQUAL=515;oe.GREATER=516;oe.GEQUAL=518;oe.NOTEQUAL=517;oe.KEEP=7680;oe.REPLACE=7681;oe.INCR=7682;oe.DECR=7683;oe.INVERT=5386;oe.INCR_WRAP=34055;oe.DECR_WRAP=34056;oe.TEXTURE_CLAMP_ADDRESSMODE=0;oe.TEXTURE_WRAP_ADDRESSMODE=1;oe.TEXTURE_MIRROR_ADDRESSMODE=2;oe.TEXTUREFORMAT_ALPHA=0;oe.TEXTUREFORMAT_LUMINANCE=1;oe.TEXTUREFORMAT_LUMINANCE_ALPHA=2;oe.TEXTUREFORMAT_RGB=4;oe.TEXTUREFORMAT_RGBA=5;oe.TEXTUREFORMAT_RED=6;oe.TEXTUREFORMAT_R=6;oe.TEXTUREFORMAT_R16_UNORM=33322;oe.TEXTUREFORMAT_RG16_UNORM=33324;oe.TEXTUREFORMAT_RGB16_UNORM=32852;oe.TEXTUREFORMAT_RGBA16_UNORM=32859;oe.TEXTUREFORMAT_R16_SNORM=36760;oe.TEXTUREFORMAT_RG16_SNORM=36761;oe.TEXTUREFORMAT_RGB16_SNORM=36762;oe.TEXTUREFORMAT_RGBA16_SNORM=36763;oe.TEXTUREFORMAT_RG=7;oe.TEXTUREFORMAT_RED_INTEGER=8;oe.TEXTUREFORMAT_R_INTEGER=8;oe.TEXTUREFORMAT_RG_INTEGER=9;oe.TEXTUREFORMAT_RGB_INTEGER=10;oe.TEXTUREFORMAT_RGBA_INTEGER=11;oe.TEXTURETYPE_UNSIGNED_BYTE=0;oe.TEXTURETYPE_UNSIGNED_INT=0;oe.TEXTURETYPE_FLOAT=1;oe.TEXTURETYPE_HALF_FLOAT=2;oe.TEXTURETYPE_BYTE=3;oe.TEXTURETYPE_SHORT=4;oe.TEXTURETYPE_UNSIGNED_SHORT=5;oe.TEXTURETYPE_INT=6;oe.TEXTURETYPE_UNSIGNED_INTEGER=7;oe.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8;oe.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9;oe.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10;oe.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11;oe.TEXTURETYPE_UNSIGNED_INT_24_8=12;oe.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13;oe.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14;oe.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15;oe.TEXTURE_NEAREST_SAMPLINGMODE=1;oe.TEXTURE_BILINEAR_SAMPLINGMODE=2;oe.TEXTURE_TRILINEAR_SAMPLINGMODE=3;oe.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8;oe.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11;oe.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3;oe.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4;oe.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5;oe.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6;oe.TEXTURE_NEAREST_LINEAR=7;oe.TEXTURE_NEAREST_NEAREST=1;oe.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9;oe.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10;oe.TEXTURE_LINEAR_LINEAR=2;oe.TEXTURE_LINEAR_NEAREST=12;oe.TEXTURE_EXPLICIT_MODE=0;oe.TEXTURE_SPHERICAL_MODE=1;oe.TEXTURE_PLANAR_MODE=2;oe.TEXTURE_CUBIC_MODE=3;oe.TEXTURE_PROJECTION_MODE=4;oe.TEXTURE_SKYBOX_MODE=5;oe.TEXTURE_INVCUBIC_MODE=6;oe.TEXTURE_EQUIRECTANGULAR_MODE=7;oe.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8;oe.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9;oe.SCALEMODE_FLOOR=1;oe.SCALEMODE_NEAREST=2;oe.SCALEMODE_CEILING=3;class We{static ComputeNumMipmapLevels(e,t){return gv(Math.max(e,t))+1}static GetTextureTypeFromFormat(e){switch(e){case"r8unorm":case"r8uint":case"rg8unorm":case"rg8uint":case"rgba8unorm":case"rgba8unorm-srgb":case"rgba8uint":case"bgra8unorm":case"bgra8unorm-srgb":case"rgb10a2uint":case"rgb10a2unorm":case"rgb9e5ufloat":case"rg11b10ufloat":case"bc7-rgba-unorm":case"bc7-rgba-unorm-srgb":case"bc6h-rgb-ufloat":case"bc5-rg-unorm":case"bc3-rgba-unorm":case"bc3-rgba-unorm-srgb":case"bc2-rgba-unorm":case"bc2-rgba-unorm-srgb":case"bc4-r-unorm":case"bc1-rgba-unorm":case"bc1-rgba-unorm-srgb":case"etc2-rgb8unorm":case"etc2-rgb8unorm-srgb":case"etc2-rgb8a1unorm":case"etc2-rgb8a1unorm-srgb":case"etc2-rgba8unorm":case"etc2-rgba8unorm-srgb":case"eac-r11unorm":case"eac-rg11unorm":case"astc-4x4-unorm":case"astc-4x4-unorm-srgb":case"astc-5x4-unorm":case"astc-5x4-unorm-srgb":case"astc-5x5-unorm":case"astc-5x5-unorm-srgb":case"astc-6x5-unorm":case"astc-6x5-unorm-srgb":case"astc-6x6-unorm":case"astc-6x6-unorm-srgb":case"astc-8x5-unorm":case"astc-8x5-unorm-srgb":case"astc-8x6-unorm":case"astc-8x6-unorm-srgb":case"astc-8x8-unorm":case"astc-8x8-unorm-srgb":case"astc-10x5-unorm":case"astc-10x5-unorm-srgb":case"astc-10x6-unorm":case"astc-10x6-unorm-srgb":case"astc-10x8-unorm":case"astc-10x8-unorm-srgb":case"astc-10x10-unorm":case"astc-10x10-unorm-srgb":case"astc-12x10-unorm":case"astc-12x10-unorm-srgb":case"astc-12x12-unorm":case"astc-12x12-unorm-srgb":case"stencil8":return 0;case"r8snorm":case"r8sint":case"rg8snorm":case"rg8sint":case"rgba8snorm":case"rgba8sint":case"bc6h-rgb-float":case"bc5-rg-snorm":case"bc4-r-snorm":case"eac-r11snorm":case"eac-rg11snorm":return 3;case"r16uint":case"r16unorm":case"rg16unorm":case"rgba16unorm":case"rg16uint":case"rgba16uint":case"depth16unorm":return 5;case"r16sint":case"r16snorm":case"rg16snorm":case"rgba16snorm":case"rg16sint":case"rgba16sint":return 4;case"r16float":case"rg16float":case"rgba16float":return 2;case"r32uint":case"rg32uint":case"rgba32uint":return 7;case"r32sint":case"rg32sint":case"rgba32sint":return 7;case"r32float":case"rg32float":case"rgba32float":case"depth32float":case"depth32float-stencil8":case"depth24plus":case"depth24plus-stencil8":return 1}return 0}static GetBlockInformationFromFormat(e){switch(e){case"r8unorm":case"r8snorm":case"r8uint":case"r8sint":return{width:1,height:1,length:1};case"r16uint":case"r16sint":case"r16unorm":case"rg16unorm":case"rgba16unorm":case"r16snorm":case"rg16snorm":case"rgba16snorm":case"r16float":case"rg8unorm":case"rg8snorm":case"rg8uint":case"rg8sint":return{width:1,height:1,length:2};case"r32uint":case"r32sint":case"r32float":case"rg16uint":case"rg16sint":case"rg16float":case"rgba8unorm":case"rgba8unorm-srgb":case"rgba8snorm":case"rgba8uint":case"rgba8sint":case"bgra8unorm":case"bgra8unorm-srgb":case"rgb9e5ufloat":case"rgb10a2uint":case"rgb10a2unorm":case"rg11b10ufloat":return{width:1,height:1,length:4};case"rg32uint":case"rg32sint":case"rg32float":case"rgba16uint":case"rgba16sint":case"rgba16float":return{width:1,height:1,length:8};case"rgba32uint":case"rgba32sint":case"rgba32float":return{width:1,height:1,length:16};case"stencil8":throw"No fixed size for Stencil8 format!";case"depth16unorm":return{width:1,height:1,length:2};case"depth24plus":throw"No fixed size for Depth24Plus format!";case"depth24plus-stencil8":throw"No fixed size for Depth24PlusStencil8 format!";case"depth32float":return{width:1,height:1,length:4};case"depth32float-stencil8":return{width:1,height:1,length:5};case"bc7-rgba-unorm":case"bc7-rgba-unorm-srgb":case"bc6h-rgb-ufloat":case"bc6h-rgb-float":case"bc5-rg-unorm":case"bc5-rg-snorm":case"bc3-rgba-unorm":case"bc3-rgba-unorm-srgb":case"bc2-rgba-unorm":case"bc2-rgba-unorm-srgb":return{width:4,height:4,length:16};case"bc4-r-unorm":case"bc4-r-snorm":case"bc1-rgba-unorm":case"bc1-rgba-unorm-srgb":return{width:4,height:4,length:8};case"etc2-rgb8unorm":case"etc2-rgb8unorm-srgb":case"etc2-rgb8a1unorm":case"etc2-rgb8a1unorm-srgb":case"eac-r11unorm":case"eac-r11snorm":return{width:4,height:4,length:8};case"etc2-rgba8unorm":case"etc2-rgba8unorm-srgb":case"eac-rg11unorm":case"eac-rg11snorm":return{width:4,height:4,length:16};case"astc-4x4-unorm":case"astc-4x4-unorm-srgb":return{width:4,height:4,length:16};case"astc-5x4-unorm":case"astc-5x4-unorm-srgb":return{width:5,height:4,length:16};case"astc-5x5-unorm":case"astc-5x5-unorm-srgb":return{width:5,height:5,length:16};case"astc-6x5-unorm":case"astc-6x5-unorm-srgb":return{width:6,height:5,length:16};case"astc-6x6-unorm":case"astc-6x6-unorm-srgb":return{width:6,height:6,length:16};case"astc-8x5-unorm":case"astc-8x5-unorm-srgb":return{width:8,height:5,length:16};case"astc-8x6-unorm":case"astc-8x6-unorm-srgb":return{width:8,height:6,length:16};case"astc-8x8-unorm":case"astc-8x8-unorm-srgb":return{width:8,height:8,length:16};case"astc-10x5-unorm":case"astc-10x5-unorm-srgb":return{width:10,height:5,length:16};case"astc-10x6-unorm":case"astc-10x6-unorm-srgb":return{width:10,height:6,length:16};case"astc-10x8-unorm":case"astc-10x8-unorm-srgb":return{width:10,height:8,length:16};case"astc-10x10-unorm":case"astc-10x10-unorm-srgb":return{width:10,height:10,length:16};case"astc-12x10-unorm":case"astc-12x10-unorm-srgb":return{width:12,height:10,length:16};case"astc-12x12-unorm":case"astc-12x12-unorm-srgb":return{width:12,height:12,length:16}}return{width:1,height:1,length:4}}static IsHardwareTexture(e){return!!e.release}static IsInternalTexture(e){return!!e.dispose}static IsImageBitmap(e){return e.close!==void 0}static IsImageBitmapArray(e){return Array.isArray(e)&&e[0].close!==void 0}static IsCompressedFormat(e){switch(e){case"bc7-rgba-unorm-srgb":case"bc7-rgba-unorm":case"bc6h-rgb-float":case"bc6h-rgb-ufloat":case"bc5-rg-snorm":case"bc5-rg-unorm":case"bc4-r-snorm":case"bc4-r-unorm":case"bc3-rgba-unorm-srgb":case"bc3-rgba-unorm":case"bc2-rgba-unorm-srgb":case"bc2-rgba-unorm":case"bc1-rgba-unorm-srgb":case"bc1-rgba-unorm":case"etc2-rgb8unorm":case"etc2-rgb8unorm-srgb":case"etc2-rgb8a1unorm":case"etc2-rgb8a1unorm-srgb":case"etc2-rgba8unorm":case"etc2-rgba8unorm-srgb":case"eac-r11unorm":case"eac-r11snorm":case"eac-rg11unorm":case"eac-rg11snorm":case"astc-4x4-unorm":case"astc-4x4-unorm-srgb":case"astc-5x4-unorm":case"astc-5x4-unorm-srgb":case"astc-5x5-unorm":case"astc-5x5-unorm-srgb":case"astc-6x5-unorm":case"astc-6x5-unorm-srgb":case"astc-6x6-unorm":case"astc-6x6-unorm-srgb":case"astc-8x5-unorm":case"astc-8x5-unorm-srgb":case"astc-8x6-unorm":case"astc-8x6-unorm-srgb":case"astc-8x8-unorm":case"astc-8x8-unorm-srgb":case"astc-10x5-unorm":case"astc-10x5-unorm-srgb":case"astc-10x6-unorm":case"astc-10x6-unorm-srgb":case"astc-10x8-unorm":case"astc-10x8-unorm-srgb":case"astc-10x10-unorm":case"astc-10x10-unorm-srgb":case"astc-12x10-unorm":case"astc-12x10-unorm-srgb":case"astc-12x12-unorm":case"astc-12x12-unorm-srgb":return!0}return!1}static GetWebGPUTextureFormat(e,t,i=!1){switch(t){case 15:return"depth16unorm";case 16:return"depth24plus";case 13:return"depth24plus-stencil8";case 14:return"depth32float";case 18:return"depth32float-stencil8";case 19:return"stencil8";case 36492:return i?"bc7-rgba-unorm-srgb":"bc7-rgba-unorm";case 36495:return"bc6h-rgb-ufloat";case 36494:return"bc6h-rgb-float";case 33779:return i?"bc3-rgba-unorm-srgb":"bc3-rgba-unorm";case 33778:return i?"bc2-rgba-unorm-srgb":"bc2-rgba-unorm";case 33777:case 33776:return i?"bc1-rgba-unorm-srgb":"bc1-rgba-unorm";case 37808:return i?"astc-4x4-unorm-srgb":"astc-4x4-unorm";case 36196:case 37492:return i?"etc2-rgb8unorm-srgb":"etc2-rgb8unorm";case 37496:return i?"etc2-rgba8unorm-srgb":"etc2-rgba8unorm"}switch(e){case 3:switch(t){case 6:return"r8snorm";case 7:return"rg8snorm";case 4:throw"RGB format not supported in WebGPU";case 8:return"r8sint";case 9:return"rg8sint";case 10:throw"RGB_INTEGER format not supported in WebGPU";case 11:return"rgba8sint";default:return"rgba8snorm"}case 0:switch(t){case 6:return"r8unorm";case 7:return"rg8unorm";case 4:throw"TEXTUREFORMAT_RGB format not supported in WebGPU";case 5:return i?"rgba8unorm-srgb":"rgba8unorm";case 12:return i?"bgra8unorm-srgb":"bgra8unorm";case 8:return"r8uint";case 9:return"rg8uint";case 10:throw"RGB_INTEGER format not supported in WebGPU";case 11:return"rgba8uint";case 0:throw"TEXTUREFORMAT_ALPHA format not supported in WebGPU";case 1:throw"TEXTUREFORMAT_LUMINANCE format not supported in WebGPU";case 2:throw"TEXTUREFORMAT_LUMINANCE_ALPHA format not supported in WebGPU";default:return"rgba8unorm"}case 4:switch(t){case 8:return"r16sint";case 9:return"rg16sint";case 10:throw"TEXTUREFORMAT_RGB_INTEGER format not supported in WebGPU";case 11:return"rgba16sint";default:return"rgba16sint"}case 5:switch(t){case 8:return"r16uint";case 9:return"rg16uint";case 10:throw"TEXTUREFORMAT_RGB_INTEGER format not supported in WebGPU";case 11:return"rgba16uint";default:return"rgba16uint"}case 6:switch(t){case 8:return"r32sint";case 9:return"rg32sint";case 10:throw"TEXTUREFORMAT_RGB_INTEGER format not supported in WebGPU";case 11:return"rgba32sint";default:return"rgba32sint"}case 7:switch(t){case 8:return"r32uint";case 9:return"rg32uint";case 10:throw"TEXTUREFORMAT_RGB_INTEGER format not supported in WebGPU";case 11:return"rgba32uint";default:return"rgba32uint"}case 1:switch(t){case 6:return"r32float";case 7:return"rg32float";case 4:throw"TEXTUREFORMAT_RGB format not supported in WebGPU";case 5:return"rgba32float";default:return"rgba32float"}case 2:switch(t){case 6:return"r16float";case 7:return"rg16float";case 4:throw"TEXTUREFORMAT_RGB format not supported in WebGPU";case 5:return"rgba16float";default:return"rgba16float"}case 10:throw"TEXTURETYPE_UNSIGNED_SHORT_5_6_5 format not supported in WebGPU";case 13:switch(t){case 5:return"rg11b10ufloat";case 11:throw"TEXTUREFORMAT_RGBA_INTEGER format not supported in WebGPU when type is TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV";default:return"rg11b10ufloat"}case 14:switch(t){case 5:return"rgb9e5ufloat";case 11:throw"TEXTUREFORMAT_RGBA_INTEGER format not supported in WebGPU when type is TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV";default:return"rgb9e5ufloat"}case 8:throw"TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4 format not supported in WebGPU";case 9:throw"TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1 format not supported in WebGPU";case 11:switch(t){case 5:return"rgb10a2unorm";case 11:return"rgb10a2uint";default:return"rgb10a2unorm"}}return i?"rgba8unorm-srgb":"rgba8unorm"}static GetNumChannelsFromWebGPUTextureFormat(e){switch(e){case"r8unorm":case"r8snorm":case"r8uint":case"r8sint":case"bc4-r-unorm":case"bc4-r-snorm":case"r16uint":case"r16sint":case"depth16unorm":case"r16float":case"r16unorm":case"r16snorm":case"r32uint":case"r32sint":case"r32float":case"depth32float":case"stencil8":case"depth24plus":case"eac-r11unorm":case"eac-r11snorm":return 1;case"rg8unorm":case"rg8snorm":case"rg8uint":case"rg8sint":case"depth32float-stencil8":case"bc5-rg-unorm":case"bc5-rg-snorm":case"rg16uint":case"rg16sint":case"rg16float":case"rg16unorm":case"rg16snorm":case"rg32uint":case"rg32sint":case"rg32float":case"depth24plus-stencil8":case"eac-rg11unorm":case"eac-rg11snorm":return 2;case"rgb9e5ufloat":case"rg11b10ufloat":case"bc6h-rgb-ufloat":case"bc6h-rgb-float":case"etc2-rgb8unorm":case"etc2-rgb8unorm-srgb":return 3;case"rgba8unorm":case"rgba8unorm-srgb":case"rgba8snorm":case"rgba8uint":case"rgba8sint":case"bgra8unorm":case"bgra8unorm-srgb":case"rgba16unorm":case"rgba16snorm":case"rgb10a2uint":case"rgb10a2unorm":case"bc7-rgba-unorm":case"bc7-rgba-unorm-srgb":case"bc3-rgba-unorm":case"bc3-rgba-unorm-srgb":case"bc2-rgba-unorm":case"bc2-rgba-unorm-srgb":case"bc1-rgba-unorm":case"bc1-rgba-unorm-srgb":case"rgba16uint":case"rgba16sint":case"rgba16float":case"rgba32uint":case"rgba32sint":case"rgba32float":case"etc2-rgb8a1unorm":case"etc2-rgb8a1unorm-srgb":case"etc2-rgba8unorm":case"etc2-rgba8unorm-srgb":case"astc-4x4-unorm":case"astc-4x4-unorm-srgb":case"astc-5x4-unorm":case"astc-5x4-unorm-srgb":case"astc-5x5-unorm":case"astc-5x5-unorm-srgb":case"astc-6x5-unorm":case"astc-6x5-unorm-srgb":case"astc-6x6-unorm":case"astc-6x6-unorm-srgb":case"astc-8x5-unorm":case"astc-8x5-unorm-srgb":case"astc-8x6-unorm":case"astc-8x6-unorm-srgb":case"astc-8x8-unorm":case"astc-8x8-unorm-srgb":case"astc-10x5-unorm":case"astc-10x5-unorm-srgb":case"astc-10x6-unorm":case"astc-10x6-unorm-srgb":case"astc-10x8-unorm":case"astc-10x8-unorm-srgb":case"astc-10x10-unorm":case"astc-10x10-unorm-srgb":case"astc-12x10-unorm":case"astc-12x10-unorm-srgb":case"astc-12x12-unorm":case"astc-12x12-unorm-srgb":return 4}throw`Unknown format ${e}!`}static HasStencilAspect(e){switch(e){case"stencil8":case"depth32float-stencil8":case"depth24plus-stencil8":return!0}return!1}static HasDepthAndStencilAspects(e){switch(e){case"depth32float-stencil8":case"depth24plus-stencil8":return!0}return!1}static GetDepthFormatOnly(e){switch(e){case"depth16unorm":return"depth16unorm";case"depth24plus":return"depth24plus";case"depth24plus-stencil8":return"depth24plus";case"depth32float":return"depth32float";case"depth32float-stencil8":return"depth32float"}return e}static GetSample(e){return e>1?4:1}}class Dv{constructor(){this._gpuTimeInFrameId=-1,this.counter=new Hi}_addDuration(e,t){e<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==e?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(t,!1),this._gpuTimeInFrameId=e):this.counter.addCount(t,!1))}}class rt extends re{constructor(){super(...arguments),this.dbgShowShaderCode=!1,this.dbgSanityChecks=!0,this.dbgVerboseLogsNumFrames=10,this.dbgLogIfNotDrawWrapper=!0,this.dbgShowEmptyEnableEffectCalls=!0,this.dbgVerboseLogsForFirstFrames=!1,this._currentRenderPass=null,this._snapshotRenderingMode=0,this._timestampIndex=0,this._debugStackRenderPass=[]}get enableGPUTimingMeasurements(){return this._timestampQuery.enable}set enableGPUTimingMeasurements(e){this._timestampQuery.enable!==e&&(this.gpuTimeInFrameForMainPass=e?new Dv:void 0,this._timestampQuery.enable=e)}_currentPassIsMainPass(){return this._currentRenderTarget===null}_endCurrentRenderPass(){var t,i,s;if(!this._currentRenderPass)return 0;if(this._debugStackRenderPass.length!==0)for(let r=0;r<this._debugStackRenderPass.length;++r)this._currentRenderPass.popDebugGroup();const e=this._currentPassIsMainPass()?2:1;return!this._snapshotRendering.endRenderPass(this._currentRenderPass)&&!this.compatibilityMode&&(this._bundleList.run(this._currentRenderPass),this._bundleList.reset()),this._currentRenderPass.end(),this._timestampQuery.endPass(this._timestampIndex,this._currentRenderTarget&&this._currentRenderTarget.gpuTimeInFrame?this._currentRenderTarget.gpuTimeInFrame:this.gpuTimeInFrameForMainPass),this._timestampIndex+=2,this.dbgVerboseLogsForFirstFrames&&(this._count===void 0&&(this._count=0),(!this._count||this._count<this.dbgVerboseLogsNumFrames)&&U.Log("frame #"+this._count+" - "+(e===2?"main":"render target")+" end pass"+(e===1?" - internalTexture.uniqueId="+((i=(t=this._currentRenderTarget)==null?void 0:t.texture)==null?void 0:i.uniqueId):""))),(s=this._debugPopGroup)==null||s.call(this,0),this._currentRenderPass=null,e}_generateMipmaps(e,t){t=t??this._renderEncoder;const i=e._hardwareTexture;if(!i)return;t===this._renderEncoder&&this._endCurrentRenderPass();const s=e._hardwareTexture.format,r=We.ComputeNumMipmapLevels(e.width,e.height);this.dbgVerboseLogsForFirstFrames&&(this._count===void 0&&(this._count=0),(!this._count||this._count<this.dbgVerboseLogsNumFrames)&&U.Log("frame #"+this._count+" - generate mipmaps - width="+e.width+", height="+e.height+", isCube="+e.isCube+", command encoder="+(t===this._renderEncoder?"render":"copy"))),e.isCube?this._textureHelper.generateCubeMipmaps(i,s,r,t):this._textureHelper.generateMipmaps(i,s,r,0,e.is3D,t)}}var xp;(function(n){n.LowPower="low-power",n.HighPerformance="high-performance"})(xp||(xp={}));var bp;(function(n){n.DepthClipControl="depth-clip-control",n.Depth32FloatStencil8="depth32float-stencil8",n.TextureCompressionBC="texture-compression-bc",n.TextureCompressionBCSliced3D="texture-compression-bc-sliced-3d",n.TextureCompressionETC2="texture-compression-etc2",n.TextureCompressionASTC="texture-compression-astc",n.TextureCompressionASTCSliced3D="texture-compression-astc-sliced-3d",n.TimestampQuery="timestamp-query",n.IndirectFirstInstance="indirect-first-instance",n.ShaderF16="shader-f16",n.RG11B10UFloatRenderable="rg11b10ufloat-renderable",n.BGRA8UnormStorage="bgra8unorm-storage",n.Float32Filterable="float32-filterable",n.Float32Blendable="float32-blendable",n.ClipDistances="clip-distances",n.DualSourceBlending="dual-source-blending"})(bp||(bp={}));var Tp;(function(n){n.Unmapped="unmapped",n.Pending="pending",n.Mapped="mapped"})(Tp||(Tp={}));var Xe;(function(n){n[n.MapRead=1]="MapRead",n[n.MapWrite=2]="MapWrite",n[n.CopySrc=4]="CopySrc",n[n.CopyDst=8]="CopyDst",n[n.Index=16]="Index",n[n.Vertex=32]="Vertex",n[n.Uniform=64]="Uniform",n[n.Storage=128]="Storage",n[n.Indirect=256]="Indirect",n[n.QueryResolve=512]="QueryResolve"})(Xe||(Xe={}));var Ap;(function(n){n[n.Read=1]="Read",n[n.Write=2]="Write"})(Ap||(Ap={}));var Ep;(function(n){n.E1d="1d",n.E2d="2d",n.E3d="3d"})(Ep||(Ep={}));var Sp;(function(n){n[n.CopySrc=1]="CopySrc",n[n.CopyDst=2]="CopyDst",n[n.TextureBinding=4]="TextureBinding",n[n.StorageBinding=8]="StorageBinding",n[n.RenderAttachment=16]="RenderAttachment"})(Sp||(Sp={}));var Rp;(function(n){n.E1d="1d",n.E2d="2d",n.E2dArray="2d-array",n.Cube="cube",n.CubeArray="cube-array",n.E3d="3d"})(Rp||(Rp={}));var Ip;(function(n){n.All="all",n.StencilOnly="stencil-only",n.DepthOnly="depth-only"})(Ip||(Ip={}));var Cp;(function(n){n.R8Unorm="r8unorm",n.R8Snorm="r8snorm",n.R8Uint="r8uint",n.R8Sint="r8sint",n.R16Uint="r16uint",n.R16Sint="r16sint",n.R16Float="r16float",n.RG8Unorm="rg8unorm",n.RG8Snorm="rg8snorm",n.RG8Uint="rg8uint",n.RG8Sint="rg8sint",n.R16Unorm="r16unorm",n.R16Snorm="r16snorm",n.RG16Unorm="rg16unorm",n.RG16Snorm="rg16snorm",n.RGBA16Unorm="rgba16unorm",n.RGBA16Snorm="rgba16snorm",n.R32Uint="r32uint",n.R32Sint="r32sint",n.R32Float="r32float",n.RG16Uint="rg16uint",n.RG16Sint="rg16sint",n.RG16Float="rg16float",n.RGBA8Unorm="rgba8unorm",n.RGBA8UnormSRGB="rgba8unorm-srgb",n.RGBA8Snorm="rgba8snorm",n.RGBA8Uint="rgba8uint",n.RGBA8Sint="rgba8sint",n.BGRA8Unorm="bgra8unorm",n.BGRA8UnormSRGB="bgra8unorm-srgb",n.RGB9E5UFloat="rgb9e5ufloat",n.RGB10A2UINT="rgb10a2uint",n.RGB10A2Unorm="rgb10a2unorm",n.RG11B10UFloat="rg11b10ufloat",n.RG32Uint="rg32uint",n.RG32Sint="rg32sint",n.RG32Float="rg32float",n.RGBA16Uint="rgba16uint",n.RGBA16Sint="rgba16sint",n.RGBA16Float="rgba16float",n.RGBA32Uint="rgba32uint",n.RGBA32Sint="rgba32sint",n.RGBA32Float="rgba32float",n.Stencil8="stencil8",n.Depth16Unorm="depth16unorm",n.Depth24Plus="depth24plus",n.Depth24PlusStencil8="depth24plus-stencil8",n.Depth32Float="depth32float",n.BC1RGBAUnorm="bc1-rgba-unorm",n.BC1RGBAUnormSRGB="bc1-rgba-unorm-srgb",n.BC2RGBAUnorm="bc2-rgba-unorm",n.BC2RGBAUnormSRGB="bc2-rgba-unorm-srgb",n.BC3RGBAUnorm="bc3-rgba-unorm",n.BC3RGBAUnormSRGB="bc3-rgba-unorm-srgb",n.BC4RUnorm="bc4-r-unorm",n.BC4RSnorm="bc4-r-snorm",n.BC5RGUnorm="bc5-rg-unorm",n.BC5RGSnorm="bc5-rg-snorm",n.BC6HRGBUFloat="bc6h-rgb-ufloat",n.BC6HRGBFloat="bc6h-rgb-float",n.BC7RGBAUnorm="bc7-rgba-unorm",n.BC7RGBAUnormSRGB="bc7-rgba-unorm-srgb",n.ETC2RGB8Unorm="etc2-rgb8unorm",n.ETC2RGB8UnormSRGB="etc2-rgb8unorm-srgb",n.ETC2RGB8A1Unorm="etc2-rgb8a1unorm",n.ETC2RGB8A1UnormSRGB="etc2-rgb8a1unorm-srgb",n.ETC2RGBA8Unorm="etc2-rgba8unorm",n.ETC2RGBA8UnormSRGB="etc2-rgba8unorm-srgb",n.EACR11Unorm="eac-r11unorm",n.EACR11Snorm="eac-r11snorm",n.EACRG11Unorm="eac-rg11unorm",n.EACRG11Snorm="eac-rg11snorm",n.ASTC4x4Unorm="astc-4x4-unorm",n.ASTC4x4UnormSRGB="astc-4x4-unorm-srgb",n.ASTC5x4Unorm="astc-5x4-unorm",n.ASTC5x4UnormSRGB="astc-5x4-unorm-srgb",n.ASTC5x5Unorm="astc-5x5-unorm",n.ASTC5x5UnormSRGB="astc-5x5-unorm-srgb",n.ASTC6x5Unorm="astc-6x5-unorm",n.ASTC6x5UnormSRGB="astc-6x5-unorm-srgb",n.ASTC6x6Unorm="astc-6x6-unorm",n.ASTC6x6UnormSRGB="astc-6x6-unorm-srgb",n.ASTC8x5Unorm="astc-8x5-unorm",n.ASTC8x5UnormSRGB="astc-8x5-unorm-srgb",n.ASTC8x6Unorm="astc-8x6-unorm",n.ASTC8x6UnormSRGB="astc-8x6-unorm-srgb",n.ASTC8x8Unorm="astc-8x8-unorm",n.ASTC8x8UnormSRGB="astc-8x8-unorm-srgb",n.ASTC10x5Unorm="astc-10x5-unorm",n.ASTC10x5UnormSRGB="astc-10x5-unorm-srgb",n.ASTC10x6Unorm="astc-10x6-unorm",n.ASTC10x6UnormSRGB="astc-10x6-unorm-srgb",n.ASTC10x8Unorm="astc-10x8-unorm",n.ASTC10x8UnormSRGB="astc-10x8-unorm-srgb",n.ASTC10x10Unorm="astc-10x10-unorm",n.ASTC10x10UnormSRGB="astc-10x10-unorm-srgb",n.ASTC12x10Unorm="astc-12x10-unorm",n.ASTC12x10UnormSRGB="astc-12x10-unorm-srgb",n.ASTC12x12Unorm="astc-12x12-unorm",n.ASTC12x12UnormSRGB="astc-12x12-unorm-srgb",n.Depth32FloatStencil8="depth32float-stencil8"})(Cp||(Cp={}));var Mp;(function(n){n.ClampToEdge="clamp-to-edge",n.Repeat="repeat",n.MirrorRepeat="mirror-repeat"})(Mp||(Mp={}));var Pp;(function(n){n.Nearest="nearest",n.Linear="linear"})(Pp||(Pp={}));var wp;(function(n){n.Nearest="nearest",n.Linear="linear"})(wp||(wp={}));var Dp;(function(n){n.Never="never",n.Less="less",n.Equal="equal",n.LessEqual="less-equal",n.Greater="greater",n.NotEqual="not-equal",n.GreaterEqual="greater-equal",n.Always="always"})(Dp||(Dp={}));var Op;(function(n){n[n.Vertex=1]="Vertex",n[n.Fragment=2]="Fragment",n[n.Compute=4]="Compute"})(Op||(Op={}));var Fp;(function(n){n.Uniform="uniform",n.Storage="storage",n.ReadOnlyStorage="read-only-storage"})(Fp||(Fp={}));var Lp;(function(n){n.Filtering="filtering",n.NonFiltering="non-filtering",n.Comparison="comparison"})(Lp||(Lp={}));var Bp;(function(n){n.Float="float",n.UnfilterableFloat="unfilterable-float",n.Depth="depth",n.Sint="sint",n.Uint="uint"})(Bp||(Bp={}));var Np;(function(n){n.WriteOnly="write-only",n.ReadOnly="read-only",n.ReadWrite="read-write"})(Np||(Np={}));var Up;(function(n){n.Error="error",n.Warning="warning",n.Info="info"})(Up||(Up={}));var kp;(function(n){n.Validation="validation",n.Internal="internal"})(kp||(kp={}));var Vp;(function(n){n.Auto="auto"})(Vp||(Vp={}));var Gp;(function(n){n.PointList="point-list",n.LineList="line-list",n.LineStrip="line-strip",n.TriangleList="triangle-list",n.TriangleStrip="triangle-strip"})(Gp||(Gp={}));var zp;(function(n){n.CCW="ccw",n.CW="cw"})(zp||(zp={}));var Wp;(function(n){n.None="none",n.Front="front",n.Back="back"})(Wp||(Wp={}));var Hp;(function(n){n[n.Red=1]="Red",n[n.Green=2]="Green",n[n.Blue=4]="Blue",n[n.Alpha=8]="Alpha",n[n.All=15]="All"})(Hp||(Hp={}));var Kp;(function(n){n.Zero="zero",n.One="one",n.Src="src",n.OneMinusSrc="one-minus-src",n.SrcAlpha="src-alpha",n.OneMinusSrcAlpha="one-minus-src-alpha",n.Dst="dst",n.OneMinusDst="one-minus-dst",n.DstAlpha="dst-alpha",n.OneMinusDstAlpha="one-minus-dst-alpha",n.SrcAlphaSaturated="src-alpha-saturated",n.Constant="constant",n.OneMinusConstant="one-minus-constant",n.Src1="src1",n.OneMinusSrc1="one-minus-src1",n.Src1Alpha="src1-alpha",n.OneMinusSrc1Alpha="one-minus-src1-alpha"})(Kp||(Kp={}));var Xp;(function(n){n.Add="add",n.Subtract="subtract",n.ReverseSubtract="reverse-subtract",n.Min="min",n.Max="max"})(Xp||(Xp={}));var Yp;(function(n){n.Keep="keep",n.Zero="zero",n.Replace="replace",n.Invert="invert",n.IncrementClamp="increment-clamp",n.DecrementClamp="decrement-clamp",n.IncrementWrap="increment-wrap",n.DecrementWrap="decrement-wrap"})(Yp||(Yp={}));var jp;(function(n){n.Uint16="uint16",n.Uint32="uint32"})(jp||(jp={}));var qp;(function(n){n.Uint8x2="uint8x2",n.Uint8x4="uint8x4",n.Sint8x2="sint8x2",n.Sint8x4="sint8x4",n.Unorm8x2="unorm8x2",n.Unorm8x4="unorm8x4",n.Snorm8x2="snorm8x2",n.Snorm8x4="snorm8x4",n.Uint16x2="uint16x2",n.Uint16x4="uint16x4",n.Sint16x2="sint16x2",n.Sint16x4="sint16x4",n.Unorm16x2="unorm16x2",n.Unorm16x4="unorm16x4",n.Snorm16x2="snorm16x2",n.Snorm16x4="snorm16x4",n.Float16x2="float16x2",n.Float16x4="float16x4",n.Float32="float32",n.Float32x2="float32x2",n.Float32x3="float32x3",n.Float32x4="float32x4",n.Uint32="uint32",n.Uint32x2="uint32x2",n.Uint32x3="uint32x3",n.Uint32x4="uint32x4",n.Sint32="sint32",n.Sint32x2="sint32x2",n.Sint32x3="sint32x3",n.Sint32x4="sint32x4",n.UNORM10x10x10x2="unorm10-10-10-2"})(qp||(qp={}));var $p;(function(n){n.Vertex="vertex",n.Instance="instance"})($p||($p={}));var Zp;(function(n){n.Beginning="beginning",n.End="end"})(Zp||(Zp={}));var Qp;(function(n){n.Beginning="beginning",n.End="end"})(Qp||(Qp={}));var Jp;(function(n){n.Load="load",n.Clear="clear"})(Jp||(Jp={}));var eg;(function(n){n.Store="store",n.Discard="discard"})(eg||(eg={}));var tg;(function(n){n.Occlusion="occlusion",n.Timestamp="timestamp"})(tg||(tg={}));var ig;(function(n){n.Opaque="opaque",n.Premultiplied="premultiplied"})(ig||(ig={}));var sg;(function(n){n.Standard="standard",n.Extended="extended"})(sg||(sg={}));var ng;(function(n){n.Unknown="unknown",n.Destroyed="destroyed"})(ng||(ng={}));var rg;(function(n){n.Validation="validation",n.OutOfMemory="out-of-memory",n.Internal="internal"})(rg||(rg={}));function w4(n,e,t,i){switch(e){case 5120:{let s=n.getInt8(t);return i&&(s=Math.max(s/127,-1)),s}case 5121:{let s=n.getUint8(t);return i&&(s=s/255),s}case 5122:{let s=n.getInt16(t,!0);return i&&(s=Math.max(s/32767,-1)),s}case 5123:{let s=n.getUint16(t,!0);return i&&(s=s/65535),s}case 5124:return n.getInt32(t,!0);case 5125:return n.getUint32(t,!0);case 5126:return n.getFloat32(t,!0);default:throw new Error(`Invalid component type ${e}`)}}function D4(n,e,t,i,s){switch(e){case 5120:{i&&(s=Math.round(s*127)),n.setInt8(t,s);break}case 5121:{i&&(s=Math.round(s*255)),n.setUint8(t,s);break}case 5122:{i&&(s=Math.round(s*32767)),n.setInt16(t,s,!0);break}case 5123:{i&&(s=Math.round(s*65535)),n.setUint16(t,s,!0);break}case 5124:{n.setInt32(t,s,!0);break}case 5125:{n.setUint32(t,s,!0);break}case 5126:{n.setFloat32(t,s,!0);break}default:throw new Error(`Invalid component type ${e}`)}}function Nn(n){switch(n){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${n}'`)}}function Vl(n,e,t,i,s,r,a,o){const l=new Array(i),h=new Array(i);if(n instanceof Array){let u=e/4;const c=t/4;for(let f=0;f<r;f+=i){for(let d=0;d<i;d++)l[d]=h[d]=n[u+d];o(h,f);for(let d=0;d<i;d++)l[d]!==h[d]&&(n[u+d]=h[d]);u+=c}}else{const u=ArrayBuffer.isView(n)?new DataView(n.buffer,n.byteOffset,n.byteLength):new DataView(n),c=Nn(s);for(let f=0;f<r;f+=i){for(let d=0,_=e;d<i;d++,_+=c)l[d]=h[d]=w4(u,s,_,a);o(h,f);for(let d=0,_=e;d<i;d++,_+=c)l[d]!==h[d]&&D4(u,s,_,a,h[d]);e+=t}}}function ag(n,e,t,i,s,r,a,o){const l=e*Nn(t),h=a*e;if(t!==5126||s!==l){const u=new Float32Array(h);return Vl(n,i,s,e,t,h,r,(c,f)=>{for(let d=0;d<e;d++)u[f+d]=c[d]}),u}if(!(n instanceof Array||n instanceof Float32Array)||i!==0||n.length!==h)if(n instanceof Array){const u=i/4;return n.slice(u,u+h)}else{if(n instanceof ArrayBuffer)return new Float32Array(n,i,h);{const u=n.byteOffset+i;return u&3&&(U.Warn("Float array must be aligned to 4-bytes border"),o=!0),o?new Float32Array(n.buffer.slice(u,u+h*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(n.buffer,u,h)}}return o?n.slice():n}function O4(n,e,t,i,s,r,a,o){const l=e*Nn(t),h=a*e;if(o.length!==h)throw new Error("Output length is not valid");if(t!==5126||s!==l){Vl(n,i,s,e,t,h,r,(u,c)=>{for(let f=0;f<e;f++)o[c+f]=u[f]});return}if(n instanceof Array){const u=i/4;o.set(n,u)}else if(n instanceof ArrayBuffer){const u=new Float32Array(n,i,h);o.set(u)}else{const u=n.byteOffset+i;if(u&3){U.Warn("Float array must be aligned to 4-bytes border"),o.set(new Float32Array(n.buffer.slice(u,u+h*Float32Array.BYTES_PER_ELEMENT)));return}const c=new Float32Array(n.buffer,u,h);o.set(c)}}class Pa{get isDisposed(){return this._isDisposed}constructor(e,t,i,s=0,r=!1,a=!1,o=!1,l,h){this._isAlreadyOwned=!1,this._isDisposed=!1,e&&e.getScene?this._engine=e.getScene().getEngine():this._engine=e,this._updatable=i,this._instanced=a,this._divisor=l||1,this._label=h,t instanceof ka?(this._data=null,this._buffer=t):(this._data=t,this._buffer=null),this.byteStride=o?s:s*Float32Array.BYTES_PER_ELEMENT,r||this.create()}createVertexBuffer(e,t,i,s,r,a=!1,o){const l=a?t:t*Float32Array.BYTES_PER_ELEMENT,h=s?a?s:s*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new S(this._engine,this,e,this._updatable,!0,h,r===void 0?this._instanced:r,l,i,void 0,void 0,!0,this._divisor||o)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(e=null){!e&&this._buffer||(e=e||this._data,e&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,e),this._data=e):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(e,this._label),this._data=e):this._buffer=this._engine.createVertexBuffer(e,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.capacity>0){this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.capacity,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.capacity,void 0,this._label);return}U.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(e){this.create(e)}updateDirectly(e,t,i,s=!1){this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,e,s?t:t*Float32Array.BYTES_PER_ELEMENT,i?i*this.byteStride:void 0),t===0&&i===void 0?this._data=e:this._data=null)}_increaseReferences(){if(this._buffer){if(!this._isAlreadyOwned){this._isAlreadyOwned=!0;return}this._buffer.references++}}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class S{get isDisposed(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(e){const t=e!=0;this._instanceDivisor=e,t!==this._instanced&&(this._instanced=t,this._computeHashCode())}get _maxVerticesCount(){const e=this.getData();return e?Array.isArray(e)?e.length/(this.byteStride/4)-this.byteOffset/4:(e.byteLength-this.byteOffset)/this.byteStride:0}constructor(e,t,i,s,r,a,o,l,h,u,c=!1,f=!1,d=1,_=!1){this._isDisposed=!1;let p=!1;if(this.engine=e,typeof s=="object"&&s!==null?(p=s.updatable??!1,r=s.postponeInternalCreation,a=s.stride,o=s.instanced,l=s.offset,h=s.size,u=s.type,c=s.normalized??!1,f=s.useBytes??!1,d=s.divisor??1,_=s.takeBufferOwnership??!1,this._label=s.label):p=!!s,t instanceof Pa?(this._buffer=t,this._ownsBuffer=_):(this._buffer=new Pa(e,t,p,a,r,o,f,d,this._label),this._ownsBuffer=!0),this.uniqueId=S._Counter++,this._kind=i,u===void 0){const m=this.getData();this.type=m?S.GetDataType(m):S.FLOAT}else this.type=u;const g=Nn(this.type);f?(this._size=h||(a?a/g:S.DeduceStride(i)),this.byteStride=a||this._buffer.byteStride||this._size*g,this.byteOffset=l||0):(this._size=h||a||S.DeduceStride(i),this.byteStride=a?a*g:this._buffer.byteStride||this._size*g,this.byteOffset=(l||0)*g),this.normalized=c,this._instanced=o!==void 0?o:!1,this._instanceDivisor=o?d:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120<<0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var e;(e=this._buffer)==null||e._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(e,t){const i=this.getData();return i?ag(i,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,e,t):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Nn(this.type)}getOffset(){return this.byteOffset/Nn(this.type)}getSize(e=!1){return e?this._size*Nn(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(e){this._buffer.create(e),this._alignBuffer()}update(e){this._buffer.update(e),this._alignBuffer()}updateDirectly(e,t,i=!1){this._buffer.updateDirectly(e,t,void 0,i),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(e,t){Vl(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,e,this.normalized,(i,s)=>{for(let r=0;r<this._size;r++)t(i[r],s+r)})}_alignBuffer(){}static DeduceStride(e){switch(e){case S.UVKind:case S.UV2Kind:case S.UV3Kind:case S.UV4Kind:case S.UV5Kind:case S.UV6Kind:return 2;case S.NormalKind:case S.PositionKind:return 3;case S.ColorKind:case S.ColorInstanceKind:case S.MatricesIndicesKind:case S.MatricesIndicesExtraKind:case S.MatricesWeightsKind:case S.MatricesWeightsExtraKind:case S.TangentKind:return 4;default:throw new Error("Invalid kind '"+e+"'")}}static GetDataType(e){return e instanceof Int8Array?S.BYTE:e instanceof Uint8Array?S.UNSIGNED_BYTE:e instanceof Int16Array?S.SHORT:e instanceof Uint16Array?S.UNSIGNED_SHORT:e instanceof Int32Array?S.INT:e instanceof Uint32Array?S.UNSIGNED_INT:S.FLOAT}static GetTypeByteLength(e){return Nn(e)}static ForEach(e,t,i,s,r,a,o,l){Vl(e,t,i,s,r,a,o,(h,u)=>{for(let c=0;c<s;c++)l(h[c],u+c)})}static GetFloatData(e,t,i,s,r,a,o,l){return ag(e,t,i,s,r,a,o,l)}}S._Counter=0;S.BYTE=5120;S.UNSIGNED_BYTE=5121;S.SHORT=5122;S.UNSIGNED_SHORT=5123;S.INT=5124;S.UNSIGNED_INT=5125;S.FLOAT=5126;S.PositionKind="position";S.NormalKind="normal";S.TangentKind="tangent";S.UVKind="uv";S.UV2Kind="uv2";S.UV3Kind="uv3";S.UV4Kind="uv4";S.UV5Kind="uv5";S.UV6Kind="uv6";S.ColorKind="color";S.ColorInstanceKind="instanceColor";S.MatricesIndicesKind="matricesIndices";S.MatricesWeightsKind="matricesWeights";S.MatricesIndicesExtraKind="matricesIndicesExtra";S.MatricesWeightsExtraKind="matricesWeightsExtra";const og=(n,e,t)=>!n||n.getClassName&&n.getClassName()==="Mesh"?null:n.getClassName&&(n.getClassName()==="SubMesh"||n.getClassName()==="PhysicsBody")?n.clone(e):n.clone?n.clone():Array.isArray(n)?n.slice():t&&typeof n=="object"?{...n}:null;function F4(n){const e=[];do Object.getOwnPropertyNames(n).forEach(function(t){e.indexOf(t)===-1&&e.push(t)});while(n=Object.getPrototypeOf(n));return e}class dd{static DeepCopy(e,t,i,s,r=!1){const a=F4(e);for(const o of a){if(o[0]==="_"&&(!s||s.indexOf(o)===-1)||o.endsWith("Observable")||i&&i.indexOf(o)!==-1)continue;const l=e[o],h=typeof l;if(h!=="function")try{if(h==="object")if(l instanceof Uint8Array)t[o]=Uint8Array.from(l);else if(l instanceof Array){if(t[o]=[],l.length>0)if(typeof l[0]=="object")for(let u=0;u<l.length;u++){const c=og(l[u],t,r);t[o].indexOf(c)===-1&&t[o].push(c)}else t[o]=l.slice(0)}else t[o]=og(l,t,r);else t[o]=l}catch(u){U.Warn(u.message)}}}}class bo{static Instantiate(e){if(this.RegisteredExternalClasses&&this.RegisteredExternalClasses[e])return this.RegisteredExternalClasses[e];const t=Zn(e);if(t)return t;U.Warn(e+" not found, you may have missed an import.");const i=e.split(".");let s=window||this;for(let r=0,a=i.length;r<a;r++)s=s[i[r]];return typeof s!="function"?null:s}}bo.RegisteredExternalClasses={};class Z{static get BaseUrl(){return _t.BaseUrl}static set BaseUrl(e){_t.BaseUrl=e}static get CleanUrl(){return _t.CleanUrl}static set CleanUrl(e){_t.CleanUrl=e}static IsAbsoluteUrl(e){return e.indexOf("//")===0?!0:e.indexOf("://")===-1||e.indexOf(".")===-1||e.indexOf("/")===-1||e.indexOf(":")>e.indexOf("/")?!1:e.indexOf("://")<e.indexOf(".")||e.indexOf("data:")===0||e.indexOf("blob:")===0}static set ScriptBaseUrl(e){_t.ScriptBaseUrl=e}static get ScriptBaseUrl(){return _t.ScriptBaseUrl}static set CDNBaseUrl(e){Z.ScriptBaseUrl=e,Z.AssetBaseUrl=e}static set ScriptPreprocessUrl(e){_t.ScriptPreprocessUrl=e}static get ScriptPreprocessUrl(){return _t.ScriptPreprocessUrl}static get DefaultRetryStrategy(){return _t.DefaultRetryStrategy}static set DefaultRetryStrategy(e){_t.DefaultRetryStrategy=e}static get CorsBehavior(){return _t.CorsBehavior}static set CorsBehavior(e){_t.CorsBehavior=e}static get UseFallbackTexture(){return Ae.UseFallbackTexture}static set UseFallbackTexture(e){Ae.UseFallbackTexture=e}static get RegisteredExternalClasses(){return bo.RegisteredExternalClasses}static set RegisteredExternalClasses(e){bo.RegisteredExternalClasses=e}static get fallbackTexture(){return Ae.FallbackTexture}static set fallbackTexture(e){Ae.FallbackTexture=e}static FetchToRef(e,t,i,s,r,a){const o=Math.abs(e)*i%i|0,l=Math.abs(t)*s%s|0,h=(o+l*i)*4;a.r=r[h]/255,a.g=r[h+1]/255,a.b=r[h+2]/255,a.a=r[h+3]/255}static Mix(e,t,i){return 0}static Instantiate(e){return bo.Instantiate(e)}static SetImmediate(e){Wo.SetImmediate(e)}static IsExponentOfTwo(e){return!0}static FloatRound(e){return Math.fround(e)}static GetFilename(e){const t=e.lastIndexOf("/");return t<0?e:e.substring(t+1)}static GetFolderPath(e,t=!1){const i=e.lastIndexOf("/");return i<0?t?e:"":e.substring(0,i+1)}static ToDegrees(e){return e*180/Math.PI}static ToRadians(e){return e*Math.PI/180}static SmoothAngleChange(e,t,i=.9){const s=this.ToRadians(e),r=this.ToRadians(t);return this.ToDegrees(Math.atan2((1-i)*Math.sin(r)+i*Math.sin(s),(1-i)*Math.cos(r)+i*Math.cos(s)))}static MakeArray(e,t){return t!==!0&&(e===void 0||e==null)?null:Array.isArray(e)?e:[e]}static GetPointerPrefix(e){return zt()&&!window.PointerEvent?"mouse":"pointer"}static SetCorsBehavior(e,t){ad(e,t)}static SetReferrerPolicyBehavior(e,t){t.referrerPolicy=e}static get PreprocessUrl(){return _t.PreprocessUrl}static set PreprocessUrl(e){_t.PreprocessUrl=e}static LoadImage(e,t,i,s,r,a){return od(e,t,i,s,r,a)}static LoadFile(e,t,i,s,r,a){return Qn(e,t,i,s,r,a)}static LoadFileAsync(e,t=!0){return new Promise((i,s)=>{Qn(e,r=>{i(r)},void 0,void 0,t,(r,a)=>{s(a)})})}static GetAssetUrl(e){if(!e)return"";if(Z.AssetBaseUrl&&e.startsWith(Z._DefaultAssetsUrl)){const t=Z.AssetBaseUrl[Z.AssetBaseUrl.length-1]==="/"?Z.AssetBaseUrl.substring(0,Z.AssetBaseUrl.length-1):Z.AssetBaseUrl;return e.replace(Z._DefaultAssetsUrl,t)}return e}static GetBabylonScriptURL(e,t){if(!e)return"";if(Z.ScriptBaseUrl&&e.startsWith(Z._DefaultCdnUrl)){const i=Z.ScriptBaseUrl[Z.ScriptBaseUrl.length-1]==="/"?Z.ScriptBaseUrl.substring(0,Z.ScriptBaseUrl.length-1):Z.ScriptBaseUrl;e=e.replace(Z._DefaultCdnUrl,i)}return e=Z.ScriptPreprocessUrl(e),t&&(e=Z.GetAbsoluteUrl(e)),e}static LoadBabylonScript(e,t,i,s){e=Z.GetBabylonScriptURL(e),Z.LoadScript(e,t,i)}static LoadBabylonScriptAsync(e){return e=Z.GetBabylonScriptURL(e),Z.LoadScriptAsync(e)}static LoadScript(e,t,i,s,r=!1){if(typeof importScripts=="function"){try{importScripts(e),t&&t()}catch(l){i==null||i(`Unable to load script '${e}' in worker`,l)}return}else if(!zt()){i==null||i(`Cannot load script '${e}' outside of a window or a worker`);return}const a=document.getElementsByTagName("head")[0],o=document.createElement("script");r?(o.setAttribute("type","module"),o.innerText=e):(o.setAttribute("type","text/javascript"),o.setAttribute("src",e)),s&&(o.id=s),o.onload=()=>{t&&t()},o.onerror=l=>{i&&i(`Unable to load script '${e}'`,l)},a.appendChild(o)}static LoadScriptAsync(e,t){return new Promise((i,s)=>{this.LoadScript(e,()=>{i()},(r,a)=>{s(a||new Error(r))},t)})}static ReadFileAsDataURL(e,t,i){const s=new FileReader,r={onCompleteObservable:new q,abort:()=>s.abort()};return s.onloadend=()=>{r.onCompleteObservable.notifyObservers(r)},s.onload=a=>{t(a.target.result)},s.onprogress=i,s.readAsDataURL(e),r}static ReadFile(e,t,i,s,r){return Xo(e,t,i,s,r)}static FileAsURL(e){const t=new Blob([e]);return window.URL.createObjectURL(t)}static Format(e,t=2){return e.toFixed(t)}static DeepCopy(e,t,i,s){dd.DeepCopy(e,t,i,s)}static IsEmpty(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}static RegisterTopRootEvents(e,t){for(let i=0;i<t.length;i++){const s=t[i];e.addEventListener(s.name,s.handler,!1);try{window.parent&&window.parent.addEventListener(s.name,s.handler,!1)}catch{}}}static UnregisterTopRootEvents(e,t){for(let i=0;i<t.length;i++){const s=t[i];e.removeEventListener(s.name,s.handler);try{e.parent&&e.parent.removeEventListener(s.name,s.handler)}catch{}}}static async DumpFramebuffer(e,t,i,s,r="image/png",a,o){throw Ee("DumpTools")}static DumpData(e,t,i,s,r="image/png",a,o=!1,l=!1,h){throw Ee("DumpTools")}static DumpDataAsync(e,t,i,s="image/png",r,a=!1,o=!1,l){throw Ee("DumpTools")}static _IsOffScreenCanvas(e){return e.convertToBlob!==void 0}static ToBlob(e,t,i="image/png",s){!Z._IsOffScreenCanvas(e)&&!e.toBlob&&(e.toBlob=function(r,a,o){setTimeout(()=>{const l=atob(this.toDataURL(a,o).split(",")[1]),h=l.length,u=new Uint8Array(h);for(let c=0;c<h;c++)u[c]=l.charCodeAt(c);r(new Blob([u]))})}),Z._IsOffScreenCanvas(e)?e.convertToBlob({type:i,quality:s}).then(r=>t(r)):e.toBlob(function(r){t(r)},i,s)}static DownloadBlob(e,t){if("download"in document.createElement("a")){if(!t){const i=new Date;t="screenshot_"+((i.getFullYear()+"-"+(i.getMonth()+1)).slice(2)+"-"+i.getDate()+"_"+i.getHours()+"-"+("0"+i.getMinutes()).slice(-2))+".png"}Z.Download(e,t)}else if(e&&typeof URL<"u"){const i=URL.createObjectURL(e),s=window.open("");if(!s)return;const r=s.document.createElement("img");r.onload=function(){URL.revokeObjectURL(i)},r.src=i,s.document.body.appendChild(r)}}static EncodeScreenshotCanvasData(e,t,i="image/png",s,r){if(typeof s=="string"||!t)this.ToBlob(e,function(a){a&&Z.DownloadBlob(a,s),t&&t("")},i,r);else if(t){if(Z._IsOffScreenCanvas(e)){e.convertToBlob({type:i,quality:r}).then(o=>{const l=new FileReader;l.readAsDataURL(o),l.onloadend=()=>{const h=l.result;t(h)}});return}const a=e.toDataURL(i,r);t(a)}}static Download(e,t){if(typeof URL>"u")return;const i=window.URL.createObjectURL(e),s=document.createElement("a");document.body.appendChild(s),s.style.display="none",s.href=i,s.download=t,s.addEventListener("click",()=>{s.parentElement&&s.parentElement.removeChild(s)}),s.click(),window.URL.revokeObjectURL(i)}static BackCompatCameraNoPreventDefault(e){return typeof e[0]=="boolean"?e[0]:typeof e[1]=="boolean"?e[1]:!1}static CreateScreenshot(e,t,i,s,r="image/png",a=!1,o){throw Ee("ScreenshotTools")}static CreateScreenshotAsync(e,t,i,s="image/png",r){throw Ee("ScreenshotTools")}static CreateScreenshotUsingRenderTarget(e,t,i,s,r="image/png",a=1,o=!1,l,h=!1,u=!1,c=!0,f,d){throw Ee("ScreenshotTools")}static CreateScreenshotUsingRenderTargetAsync(e,t,i,s="image/png",r=1,a=!1,o,l=!1,h=!1,u=!0,c,f){throw Ee("ScreenshotTools")}static RandomId(){return nd()}static IsBase64(e){return hd(e)}static DecodeBase64(e){return ud(e)}static get errorsCount(){return U.errorsCount}static Log(e){U.Log(e)}static Warn(e){U.Warn(e)}static Error(e){U.Error(e)}static get LogCache(){return U.LogCache}static ClearLogCache(){U.ClearLogCache()}static set LogLevels(e){U.LogLevels=e}static set PerformanceLogLevel(e){if((e&Z.PerformanceUserMarkLogLevel)===Z.PerformanceUserMarkLogLevel){Z.StartPerformanceCounter=Z._StartUserMark,Z.EndPerformanceCounter=Z._EndUserMark;return}if((e&Z.PerformanceConsoleLogLevel)===Z.PerformanceConsoleLogLevel){Z.StartPerformanceCounter=Z._StartPerformanceConsole,Z.EndPerformanceCounter=Z._EndPerformanceConsole;return}Z.StartPerformanceCounter=Z._StartPerformanceCounterDisabled,Z.EndPerformanceCounter=Z._EndPerformanceCounterDisabled}static _StartPerformanceCounterDisabled(e,t){}static _EndPerformanceCounterDisabled(e,t){}static _StartUserMark(e,t=!0){if(!Z._Performance){if(!zt())return;Z._Performance=window.performance}!t||!Z._Performance.mark||Z._Performance.mark(e+"-Begin")}static _EndUserMark(e,t=!0){!t||!Z._Performance.mark||(Z._Performance.mark(e+"-End"),Z._Performance.measure(e,e+"-Begin",e+"-End"))}static _StartPerformanceConsole(e,t=!0){t&&(Z._StartUserMark(e,t),console.time&&console.time(e))}static _EndPerformanceConsole(e,t=!0){t&&(Z._EndUserMark(e,t),console.timeEnd(e))}static get Now(){return as.Now}static GetClassName(e,t=!1){let i=null;return!t&&e.getClassName?i=e.getClassName():(e instanceof Object&&(i=(t?e:Object.getPrototypeOf(e)).constructor.__bjsclassName__),i||(i=typeof e)),i}static First(e,t){for(const i of e)if(t(i))return i;return null}static getFullClassName(e,t=!1){let i=null,s=null;if(!t&&e.getClassName)i=e.getClassName();else{if(e instanceof Object){const r=t?e:Object.getPrototypeOf(e);i=r.constructor.__bjsclassName__,s=r.constructor.__bjsmoduleName__}i||(i=typeof e)}return i?(s!=null?s+".":"")+i:null}static DelayAsync(e){return new Promise(t=>{setTimeout(()=>{t()},e)})}static IsSafari(){return ra()?/^((?!chrome|android).)*safari/i.test(navigator.userAgent):!1}}Z.AssetBaseUrl="";Z.UseCustomRequestHeaders=!1;Z.CustomRequestHeaders=Wt.CustomRequestHeaders;Z.GetDOMTextContent=$f;Z._DefaultCdnUrl="https://cdn.babylonjs.com";Z._DefaultAssetsUrl="https://assets.babylonjs.com/core";Z.GetAbsoluteUrl=typeof document=="object"?n=>{const e=document.createElement("a");return e.href=n,e.href}:typeof URL=="function"&&typeof location=="object"?n=>new URL(n,location.origin).href:()=>{throw new Error("Unable to get absolute URL. Override BABYLON.Tools.GetAbsoluteUrl to a custom implementation for the current context.")};Z.NoneLogLevel=U.NoneLogLevel;Z.MessageLogLevel=U.MessageLogLevel;Z.WarningLogLevel=U.WarningLogLevel;Z.ErrorLogLevel=U.ErrorLogLevel;Z.AllLogLevel=U.AllLogLevel;Z.IsWindowObjectExist=zt;Z.PerformanceNoneLogLevel=0;Z.PerformanceUserMarkLogLevel=1;Z.PerformanceConsoleLogLevel=2;Z.StartPerformanceCounter=Z._StartPerformanceCounterDisabled;Z.EndPerformanceCounter=Z._EndPerformanceCounterDisabled;class Gl{constructor(e,t,i,s=0){this.iterations=e,this.index=s-1,this._done=!1,this._fn=t,this._successCallback=i}executeNext(){this._done||(this.index+1<this.iterations?(++this.index,this._fn(this)):this.breakLoop())}breakLoop(){this._done=!0,this._successCallback()}static Run(e,t,i,s=0){const r=new Gl(e,t,i,s);return r.executeNext(),r}static SyncAsyncForLoop(e,t,i,s,r,a=0){return Gl.Run(Math.ceil(e/t),o=>{r&&r()?o.breakLoop():setTimeout(()=>{for(let l=0;l<t;++l){const h=o.index*t+l;if(h>=e)break;if(i(h),r&&r()){o.breakLoop();break}}o.executeNext()},a)},s)}}Z.Mix=Cc;Z.IsExponentOfTwo=Go;Ae.FallbackTexture="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z";class ce{constructor(e,t,i,s,r=!1){this._valueCache={},this._engine=e,this._noUBO=!e.supportsUniformBuffers||r,this._dynamic=i,this._name=s??"no-name",this._data=t||[],this._uniformLocations={},this._uniformSizes={},this._uniformArraySizes={},this._uniformLocationPointer=0,this._needSync=!1,this._engine._features.trackUbosInFrame&&(this._buffers=[],this._bufferIndex=-1,this._createBufferOnWrite=!1,this._currentFrameId=0),this._noUBO?(this.updateMatrix3x3=this._updateMatrix3x3ForEffect,this.updateMatrix2x2=this._updateMatrix2x2ForEffect,this.updateFloat=this._updateFloatForEffect,this.updateFloat2=this._updateFloat2ForEffect,this.updateFloat3=this._updateFloat3ForEffect,this.updateFloat4=this._updateFloat4ForEffect,this.updateFloatArray=this._updateFloatArrayForEffect,this.updateArray=this._updateArrayForEffect,this.updateIntArray=this._updateIntArrayForEffect,this.updateUIntArray=this._updateUIntArrayForEffect,this.updateMatrix=this._updateMatrixForEffect,this.updateMatrices=this._updateMatricesForEffect,this.updateVector3=this._updateVector3ForEffect,this.updateVector4=this._updateVector4ForEffect,this.updateColor3=this._updateColor3ForEffect,this.updateColor4=this._updateColor4ForEffect,this.updateDirectColor4=this._updateDirectColor4ForEffect,this.updateInt=this._updateIntForEffect,this.updateInt2=this._updateInt2ForEffect,this.updateInt3=this._updateInt3ForEffect,this.updateInt4=this._updateInt4ForEffect,this.updateUInt=this._updateUIntForEffect,this.updateUInt2=this._updateUInt2ForEffect,this.updateUInt3=this._updateUInt3ForEffect,this.updateUInt4=this._updateUInt4ForEffect):(this._engine._uniformBuffers.push(this),this.updateMatrix3x3=this._updateMatrix3x3ForUniform,this.updateMatrix2x2=this._updateMatrix2x2ForUniform,this.updateFloat=this._updateFloatForUniform,this.updateFloat2=this._updateFloat2ForUniform,this.updateFloat3=this._updateFloat3ForUniform,this.updateFloat4=this._updateFloat4ForUniform,this.updateFloatArray=this._updateFloatArrayForUniform,this.updateArray=this._updateArrayForUniform,this.updateIntArray=this._updateIntArrayForUniform,this.updateUIntArray=this._updateUIntArrayForUniform,this.updateMatrix=this._updateMatrixForUniform,this.updateMatrices=this._updateMatricesForUniform,this.updateVector3=this._updateVector3ForUniform,this.updateVector4=this._updateVector4ForUniform,this.updateColor3=this._updateColor3ForUniform,this.updateColor4=this._updateColor4ForUniform,this.updateDirectColor4=this._updateDirectColor4ForUniform,this.updateInt=this._updateIntForUniform,this.updateInt2=this._updateInt2ForUniform,this.updateInt3=this._updateInt3ForUniform,this.updateInt4=this._updateInt4ForUniform,this.updateUInt=this._updateUIntForUniform,this.updateUInt2=this._updateUInt2ForUniform,this.updateUInt3=this._updateUInt3ForUniform,this.updateUInt4=this._updateUInt4ForUniform)}get useUbo(){return!this._noUBO}get isSync(){return!this._needSync}isDynamic(){return this._dynamic!==void 0}getData(){return this._bufferData}getBuffer(){return this._buffer}_fillAlignment(e){let t;if(e<=2?t=e:t=4,this._uniformLocationPointer%t!==0){const i=this._uniformLocationPointer;this._uniformLocationPointer+=t-this._uniformLocationPointer%t;const s=this._uniformLocationPointer-i;for(let r=0;r<s;r++)this._data.push(0)}}addUniform(e,t,i=0){if(this._noUBO||this._uniformLocations[e]!==void 0)return;let s;if(i>0){if(t instanceof Array)throw"addUniform should not be use with Array in UBO: "+e;if(this._fillAlignment(4),this._uniformArraySizes[e]={strideSize:t,arraySize:i},t==16)t=t*i;else{const a=(4-t)*i;t=t*i+a}s=[];for(let r=0;r<t;r++)s.push(0)}else{if(t instanceof Array)s=t,t=s.length;else{t=t,s=[];for(let r=0;r<t;r++)s.push(0)}this._fillAlignment(t)}this._uniformSizes[e]=t,this._uniformLocations[e]=this._uniformLocationPointer,this._uniformLocationPointer+=t;for(let r=0;r<t;r++)this._data.push(s[r]);this._needSync=!0}addMatrix(e,t){this.addUniform(e,Array.prototype.slice.call(t.asArray()))}addFloat2(e,t,i){const s=[t,i];this.addUniform(e,s)}addFloat3(e,t,i,s){const r=[t,i,s];this.addUniform(e,r)}addColor3(e,t){const i=[t.r,t.g,t.b];this.addUniform(e,i)}addColor4(e,t,i){const s=[t.r,t.g,t.b,i];this.addUniform(e,s)}addVector3(e,t){const i=[t.x,t.y,t.z];this.addUniform(e,i)}addMatrix3x3(e){this.addUniform(e,12)}addMatrix2x2(e){this.addUniform(e,8)}create(){this._noUBO||this._buffer||(this._fillAlignment(4),this._bufferData=new Float32Array(this._data),this._rebuild(),this._needSync=!0)}_getNames(){const e=[];let t=0;for(const i in this._uniformLocations)if(e.push(i),++t===10)break;return e.join(",")}_rebuild(){this._noUBO||!this._bufferData||(this._dynamic?this._buffer=this._engine.createDynamicUniformBuffer(this._bufferData,this._name+"_UniformList:"+this._getNames()):this._buffer=this._engine.createUniformBuffer(this._bufferData,this._name+"_UniformList:"+this._getNames()),this._engine._features.trackUbosInFrame&&(this._buffers.push([this._buffer,this._engine._features.checkUbosContentBeforeUpload?this._bufferData.slice():void 0]),this._bufferIndex=this._buffers.length-1,this._createBufferOnWrite=!1))}_rebuildAfterContextLost(){this._engine._features.trackUbosInFrame&&(this._buffers=[],this._currentFrameId=0),this._rebuild()}get _numBuffers(){return this._buffers.length}get _indexBuffer(){return this._bufferIndex}get name(){return this._name}get currentEffect(){return this._currentEffect}_buffersEqual(e,t){for(let i=0;i<e.length;++i)if(e[i]!==t[i])return!1;return!0}_copyBuffer(e,t){for(let i=0;i<e.length;++i)t[i]=e[i]}update(){if(!this._noUBO){if(this.bindUniformBuffer(),!this._buffer){this.create();return}if(!this._dynamic&&!this._needSync){this._createBufferOnWrite=this._engine._features.trackUbosInFrame;return}if(this._buffers&&this._buffers.length>1&&this._buffers[this._bufferIndex][1])if(this._buffersEqual(this._bufferData,this._buffers[this._bufferIndex][1])){this._needSync=!1,this._createBufferOnWrite=this._engine._features.trackUbosInFrame;return}else this._copyBuffer(this._bufferData,this._buffers[this._bufferIndex][1]);this._engine.updateUniformBuffer(this._buffer,this._bufferData),this._engine._features._collectUbosUpdatedInFrame&&(ce._UpdatedUbosInFrame[this._name]||(ce._UpdatedUbosInFrame[this._name]=0),ce._UpdatedUbosInFrame[this._name]++),this._needSync=!1,this._createBufferOnWrite=this._engine._features.trackUbosInFrame}}_createNewBuffer(){this._bufferIndex+1<this._buffers.length?(this._bufferIndex++,this._buffer=this._buffers[this._bufferIndex][0],this._createBufferOnWrite=!1,this._needSync=!0):this._rebuild()}_checkNewFrame(){this._engine._features.trackUbosInFrame&&this._currentFrameId!==this._engine.frameId&&(this._currentFrameId=this._engine.frameId,this._createBufferOnWrite=!1,this._buffers&&this._buffers.length>0?(this._needSync=this._bufferIndex!==0,this._bufferIndex=0,this._buffer=this._buffers[this._bufferIndex][0]):this._bufferIndex=-1)}updateUniform(e,t,i){this._checkNewFrame();let s=this._uniformLocations[e];if(s===void 0){if(this._buffer){U.Error("Cannot add an uniform after UBO has been created. uniformName="+e);return}this.addUniform(e,i),s=this._uniformLocations[e]}if(this._buffer||this.create(),this._dynamic)for(let r=0;r<i;r++)this._bufferData[s+r]=t[r];else{let r=!1;for(let a=0;a<i;a++)(i===16&&!this._engine._features.uniformBufferHardCheckMatrix||this._bufferData[s+a]!==Math.fround(t[a]))&&(r=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[s+a]=t[a]);this._needSync=this._needSync||r}}updateUniformArray(e,t,i){this._checkNewFrame();const s=this._uniformLocations[e];if(s===void 0){U.Error("Cannot add an uniform Array dynamically. Please, add it using addUniform and make sure that uniform buffers are supported by the current engine.");return}this._buffer||this.create();const r=this._uniformArraySizes[e];if(this._dynamic)for(let a=0;a<i;a++)this._bufferData[s+a]=t[a];else{let a=!1,o=0,l=0;for(let h=0;h<i;h++)if(this._bufferData[s+l*4+o]!==Z.FloatRound(t[h])&&(a=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[s+l*4+o]=t[h]),o++,o===r.strideSize){for(;o<4;o++)this._bufferData[s+l*4+o]=0;o=0,l++}this._needSync=this._needSync||a}}_cacheMatrix(e,t){this._checkNewFrame();const i=this._valueCache[e],s=t.updateFlag;return i!==void 0&&i===s?!1:(this._valueCache[e]=s,!0)}_updateMatrix3x3ForUniform(e,t){for(let i=0;i<3;i++)ce._TempBuffer[i*4]=t[i*3],ce._TempBuffer[i*4+1]=t[i*3+1],ce._TempBuffer[i*4+2]=t[i*3+2],ce._TempBuffer[i*4+3]=0;this.updateUniform(e,ce._TempBuffer,12)}_updateMatrix3x3ForEffect(e,t){this._currentEffect.setMatrix3x3(e,t)}_updateMatrix2x2ForEffect(e,t){this._currentEffect.setMatrix2x2(e,t)}_updateMatrix2x2ForUniform(e,t){for(let i=0;i<2;i++)ce._TempBuffer[i*4]=t[i*2],ce._TempBuffer[i*4+1]=t[i*2+1],ce._TempBuffer[i*4+2]=0,ce._TempBuffer[i*4+3]=0;this.updateUniform(e,ce._TempBuffer,8)}_updateFloatForEffect(e,t){this._currentEffect.setFloat(e,t)}_updateFloatForUniform(e,t){ce._TempBuffer[0]=t,this.updateUniform(e,ce._TempBuffer,1)}_updateFloat2ForEffect(e,t,i,s=""){this._currentEffect.setFloat2(e+s,t,i)}_updateFloat2ForUniform(e,t,i){ce._TempBuffer[0]=t,ce._TempBuffer[1]=i,this.updateUniform(e,ce._TempBuffer,2)}_updateFloat3ForEffect(e,t,i,s,r=""){this._currentEffect.setFloat3(e+r,t,i,s)}_updateFloat3ForUniform(e,t,i,s){ce._TempBuffer[0]=t,ce._TempBuffer[1]=i,ce._TempBuffer[2]=s,this.updateUniform(e,ce._TempBuffer,3)}_updateFloat4ForEffect(e,t,i,s,r,a=""){this._currentEffect.setFloat4(e+a,t,i,s,r)}_updateFloat4ForUniform(e,t,i,s,r){ce._TempBuffer[0]=t,ce._TempBuffer[1]=i,ce._TempBuffer[2]=s,ce._TempBuffer[3]=r,this.updateUniform(e,ce._TempBuffer,4)}_updateFloatArrayForEffect(e,t){this._currentEffect.setFloatArray(e,t)}_updateFloatArrayForUniform(e,t){this.updateUniformArray(e,t,t.length)}_updateArrayForEffect(e,t){this._currentEffect.setArray(e,t)}_updateArrayForUniform(e,t){this.updateUniformArray(e,t,t.length)}_updateIntArrayForEffect(e,t){this._currentEffect.setIntArray(e,t)}_updateIntArrayForUniform(e,t){ce._TempBufferInt32View.set(t),this.updateUniformArray(e,ce._TempBuffer,t.length)}_updateUIntArrayForEffect(e,t){this._currentEffect.setUIntArray(e,t)}_updateUIntArrayForUniform(e,t){ce._TempBufferUInt32View.set(t),this.updateUniformArray(e,ce._TempBuffer,t.length)}_updateMatrixForEffect(e,t){this._currentEffect.setMatrix(e,t)}_updateMatrixForUniform(e,t){this._cacheMatrix(e,t)&&this.updateUniform(e,t.asArray(),16)}_updateMatricesForEffect(e,t){this._currentEffect.setMatrices(e,t)}_updateMatricesForUniform(e,t){this.updateUniform(e,t,t.length)}_updateVector3ForEffect(e,t){this._currentEffect.setVector3(e,t)}_updateVector3ForUniform(e,t){ce._TempBuffer[0]=t.x,ce._TempBuffer[1]=t.y,ce._TempBuffer[2]=t.z,this.updateUniform(e,ce._TempBuffer,3)}_updateVector4ForEffect(e,t){this._currentEffect.setVector4(e,t)}_updateVector4ForUniform(e,t){ce._TempBuffer[0]=t.x,ce._TempBuffer[1]=t.y,ce._TempBuffer[2]=t.z,ce._TempBuffer[3]=t.w,this.updateUniform(e,ce._TempBuffer,4)}_updateColor3ForEffect(e,t,i=""){this._currentEffect.setColor3(e+i,t)}_updateColor3ForUniform(e,t){ce._TempBuffer[0]=t.r,ce._TempBuffer[1]=t.g,ce._TempBuffer[2]=t.b,this.updateUniform(e,ce._TempBuffer,3)}_updateColor4ForEffect(e,t,i,s=""){this._currentEffect.setColor4(e+s,t,i)}_updateDirectColor4ForEffect(e,t,i=""){this._currentEffect.setDirectColor4(e+i,t)}_updateColor4ForUniform(e,t,i){ce._TempBuffer[0]=t.r,ce._TempBuffer[1]=t.g,ce._TempBuffer[2]=t.b,ce._TempBuffer[3]=i,this.updateUniform(e,ce._TempBuffer,4)}_updateDirectColor4ForUniform(e,t){ce._TempBuffer[0]=t.r,ce._TempBuffer[1]=t.g,ce._TempBuffer[2]=t.b,ce._TempBuffer[3]=t.a,this.updateUniform(e,ce._TempBuffer,4)}_updateIntForEffect(e,t,i=""){this._currentEffect.setInt(e+i,t)}_updateIntForUniform(e,t){ce._TempBufferInt32View[0]=t,this.updateUniform(e,ce._TempBuffer,1)}_updateInt2ForEffect(e,t,i,s=""){this._currentEffect.setInt2(e+s,t,i)}_updateInt2ForUniform(e,t,i){ce._TempBufferInt32View[0]=t,ce._TempBufferInt32View[1]=i,this.updateUniform(e,ce._TempBuffer,2)}_updateInt3ForEffect(e,t,i,s,r=""){this._currentEffect.setInt3(e+r,t,i,s)}_updateInt3ForUniform(e,t,i,s){ce._TempBufferInt32View[0]=t,ce._TempBufferInt32View[1]=i,ce._TempBufferInt32View[2]=s,this.updateUniform(e,ce._TempBuffer,3)}_updateInt4ForEffect(e,t,i,s,r,a=""){this._currentEffect.setInt4(e+a,t,i,s,r)}_updateInt4ForUniform(e,t,i,s,r){ce._TempBufferInt32View[0]=t,ce._TempBufferInt32View[1]=i,ce._TempBufferInt32View[2]=s,ce._TempBufferInt32View[3]=r,this.updateUniform(e,ce._TempBuffer,4)}_updateUIntForEffect(e,t,i=""){this._currentEffect.setUInt(e+i,t)}_updateUIntForUniform(e,t){ce._TempBufferUInt32View[0]=t,this.updateUniform(e,ce._TempBuffer,1)}_updateUInt2ForEffect(e,t,i,s=""){this._currentEffect.setUInt2(e+s,t,i)}_updateUInt2ForUniform(e,t,i){ce._TempBufferUInt32View[0]=t,ce._TempBufferUInt32View[1]=i,this.updateUniform(e,ce._TempBuffer,2)}_updateUInt3ForEffect(e,t,i,s,r=""){this._currentEffect.setUInt3(e+r,t,i,s)}_updateUInt3ForUniform(e,t,i,s){ce._TempBufferUInt32View[0]=t,ce._TempBufferUInt32View[1]=i,ce._TempBufferUInt32View[2]=s,this.updateUniform(e,ce._TempBuffer,3)}_updateUInt4ForEffect(e,t,i,s,r,a=""){this._currentEffect.setUInt4(e+a,t,i,s,r)}_updateUInt4ForUniform(e,t,i,s,r){ce._TempBufferUInt32View[0]=t,ce._TempBufferUInt32View[1]=i,ce._TempBufferUInt32View[2]=s,ce._TempBufferUInt32View[3]=r,this.updateUniform(e,ce._TempBuffer,4)}setTexture(e,t){this._currentEffect.setTexture(e,t)}setTextureArray(e,t){this._currentEffect.setTextureArray(e,t)}bindTexture(e,t){this._currentEffect._bindTexture(e,t)}updateUniformDirectly(e,t){this.updateUniform(e,t,t.length),this.update()}bindToEffect(e,t){this._currentEffect=e,this._currentEffectName=t}bindUniformBuffer(){!this._noUBO&&this._buffer&&this._currentEffect&&this._currentEffect.bindUniformBuffer(this._buffer,this._currentEffectName)}unbindEffect(){this._currentEffect=void 0,this._currentEffectName=void 0}setDataBuffer(e){if(!this._buffers)return this._buffer===e;for(let t=0;t<this._buffers.length;++t)if(this._buffers[t][0]===e)return this._bufferIndex=t,this._buffer=e,this._createBufferOnWrite=!1,this._currentEffect=void 0,!0;return!1}dispose(){if(this._noUBO)return;const e=this._engine._uniformBuffers,t=e.indexOf(this);if(t!==-1&&(e[t]=e[e.length-1],e.pop()),this._engine._features.trackUbosInFrame&&this._buffers)for(let i=0;i<this._buffers.length;++i){const s=this._buffers[i][0];this._engine._releaseBuffer(s)}else this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)}}ce._UpdatedUbosInFrame={};ce._MAX_UNIFORM_SIZE=256;ce._TempBuffer=new Float32Array(ce._MAX_UNIFORM_SIZE);ce._TempBufferInt32View=new Int32Array(ce._TempBuffer.buffer);ce._TempBufferUInt32View=new Uint32Array(ce._TempBuffer.buffer);class Mt{constructor(){this.shaderLanguage=0}_addUniformToLeftOverUBO(e,t,i){let s=0;[e,t,s]=this._getArraySize(e,t,i);for(let r=0;r<this._webgpuProcessingContext.leftOverUniforms.length;r++)if(this._webgpuProcessingContext.leftOverUniforms[r].name===e)return;this._webgpuProcessingContext.leftOverUniforms.push({name:e,type:t,length:s})}_buildLeftOverUBO(){if(!this._webgpuProcessingContext.leftOverUniforms.length)return"";const e=Mt.LeftOvertUBOName;let t=this._webgpuProcessingContext.availableBuffers[e];return t||(t={binding:this._webgpuProcessingContext.getNextFreeUBOBinding()},this._webgpuProcessingContext.availableBuffers[e]=t,this._addBufferBindingDescription(e,t,"uniform",!0),this._addBufferBindingDescription(e,t,"uniform",!1)),this._generateLeftOverUBOCode(e,t)}_collectBindingNames(){for(let e=0;e<this._webgpuProcessingContext.bindGroupLayoutEntries.length;e++){const t=this._webgpuProcessingContext.bindGroupLayoutEntries[e];if(t===void 0){this._webgpuProcessingContext.bindGroupLayoutEntries[e]=[];continue}for(let i=0;i<t.length;i++){const s=this._webgpuProcessingContext.bindGroupLayoutEntries[e][i],r=this._webgpuProcessingContext.bindGroupLayoutEntryInfo[e][s.binding].name,a=this._webgpuProcessingContext.bindGroupLayoutEntryInfo[e][s.binding].nameInArrayOfTexture;s&&(s.texture||s.externalTexture||s.storageTexture?this._webgpuProcessingContext.textureNames.push(a):s.sampler?this._webgpuProcessingContext.samplerNames.push(r):s.buffer&&this._webgpuProcessingContext.bufferNames.push(r))}}}_preCreateBindGroupEntries(){const e=this._webgpuProcessingContext.bindGroupEntries;for(let t=0;t<this._webgpuProcessingContext.bindGroupLayoutEntries.length;t++){const i=this._webgpuProcessingContext.bindGroupLayoutEntries[t],s=[];for(let r=0;r<i.length;r++){const a=this._webgpuProcessingContext.bindGroupLayoutEntries[t][r];a.sampler||a.texture||a.storageTexture||a.externalTexture?s.push({binding:a.binding,resource:void 0}):a.buffer&&s.push({binding:a.binding,resource:{buffer:void 0,offset:0,size:0}})}e[t]=s}}_addTextureBindingDescription(e,t,i,s,r,a){let{groupIndex:o,bindingIndex:l}=t.textures[i];if(this._webgpuProcessingContext.bindGroupLayoutEntries[o]||(this._webgpuProcessingContext.bindGroupLayoutEntries[o]=[],this._webgpuProcessingContext.bindGroupLayoutEntryInfo[o]=[]),!this._webgpuProcessingContext.bindGroupLayoutEntryInfo[o][l]){let h;s===null?h=this._webgpuProcessingContext.bindGroupLayoutEntries[o].push({binding:l,visibility:0,externalTexture:{}}):r?h=this._webgpuProcessingContext.bindGroupLayoutEntries[o].push({binding:l,visibility:0,storageTexture:{access:"write-only",format:r,viewDimension:s}}):h=this._webgpuProcessingContext.bindGroupLayoutEntries[o].push({binding:l,visibility:0,texture:{sampleType:t.sampleType,viewDimension:s,multisampled:!1}});const u=t.isTextureArray?e+i:e;this._webgpuProcessingContext.bindGroupLayoutEntryInfo[o][l]={name:e,index:h-1,nameInArrayOfTexture:u}}l=this._webgpuProcessingContext.bindGroupLayoutEntryInfo[o][l].index,a?this._webgpuProcessingContext.bindGroupLayoutEntries[o][l].visibility|=1:this._webgpuProcessingContext.bindGroupLayoutEntries[o][l].visibility|=2}_addSamplerBindingDescription(e,t,i){let{groupIndex:s,bindingIndex:r}=t.binding;if(this._webgpuProcessingContext.bindGroupLayoutEntries[s]||(this._webgpuProcessingContext.bindGroupLayoutEntries[s]=[],this._webgpuProcessingContext.bindGroupLayoutEntryInfo[s]=[]),!this._webgpuProcessingContext.bindGroupLayoutEntryInfo[s][r]){const a=this._webgpuProcessingContext.bindGroupLayoutEntries[s].push({binding:r,visibility:0,sampler:{type:t.type}});this._webgpuProcessingContext.bindGroupLayoutEntryInfo[s][r]={name:e,index:a-1}}r=this._webgpuProcessingContext.bindGroupLayoutEntryInfo[s][r].index,i?this._webgpuProcessingContext.bindGroupLayoutEntries[s][r].visibility|=1:this._webgpuProcessingContext.bindGroupLayoutEntries[s][r].visibility|=2}_addBufferBindingDescription(e,t,i,s){let{groupIndex:r,bindingIndex:a}=t.binding;if(this._webgpuProcessingContext.bindGroupLayoutEntries[r]||(this._webgpuProcessingContext.bindGroupLayoutEntries[r]=[],this._webgpuProcessingContext.bindGroupLayoutEntryInfo[r]=[]),!this._webgpuProcessingContext.bindGroupLayoutEntryInfo[r][a]){const o=this._webgpuProcessingContext.bindGroupLayoutEntries[r].push({binding:a,visibility:0,buffer:{type:i}});this._webgpuProcessingContext.bindGroupLayoutEntryInfo[r][a]={name:e,index:o-1}}a=this._webgpuProcessingContext.bindGroupLayoutEntryInfo[r][a].index,s?this._webgpuProcessingContext.bindGroupLayoutEntries[r][a].visibility|=1:this._webgpuProcessingContext.bindGroupLayoutEntries[r][a].visibility|=2}}Mt.LeftOvertUBOName="LeftOver";Mt.InternalsUBOName="Internals";Mt.UniformSizes={bool:1,int:1,float:1,vec2:2,ivec2:2,uvec2:2,vec3:3,ivec3:3,uvec3:3,vec4:4,ivec4:4,uvec4:4,mat2:4,mat3:12,mat4:16,i32:1,u32:1,f32:1,mat2x2:4,mat3x3:12,mat4x4:16,mat2x2f:4,mat3x3f:12,mat4x4f:16,vec2i:2,vec3i:3,vec4i:4,vec2u:2,vec3u:3,vec4u:4,vec2f:2,vec3f:3,vec4f:4,vec2h:1,vec3h:2,vec4h:2};Mt._SamplerFunctionByWebGLSamplerType={sampler2D:"sampler2D",sampler2DArray:"sampler2DArray",sampler2DShadow:"sampler2DShadow",sampler2DArrayShadow:"sampler2DArrayShadow",samplerCube:"samplerCube",sampler3D:"sampler3D"};Mt._TextureTypeByWebGLSamplerType={sampler2D:"texture2D",sampler2DArray:"texture2DArray",sampler2DShadow:"texture2D",sampler2DArrayShadow:"texture2DArray",samplerCube:"textureCube",samplerCubeArray:"textureCubeArray",sampler3D:"texture3D"};Mt._GpuTextureViewDimensionByWebGPUTextureType={textureCube:"cube",textureCubeArray:"cube-array",texture2D:"2d",texture2DArray:"2d-array",texture3D:"3d"};Mt._SamplerTypeByWebGLSamplerType={sampler2DShadow:"samplerShadow",sampler2DArrayShadow:"samplerShadow"};Mt._IsComparisonSamplerByWebGPUSamplerType={samplerShadow:!0,samplerArrayShadow:!0,sampler:!1};class L4{get isAsync(){return!1}get isReady(){return!!this.stages}constructor(e,t){this.bindGroupLayouts={},this._name="unnamed",this.shaderProcessingContext=e,this._leftOverUniformsByName={},this.engine=t,this.vertexBufferKindToType={}}_handlesSpectorRebuildCallback(){}_fillEffectInformation(e,t,i,s,r,a,o,l){const h=this.engine;h._doNotHandleContextLost&&(e._fragmentSourceCode="",e._vertexSourceCode="");const u=this.shaderProcessingContext.availableTextures;let c;for(c=0;c<r.length;c++){const _=r[c],p=u[r[c]];p==null||p==null?(r.splice(c,1),c--):a[_]=c}for(const _ of h.getAttributes(this,o))l.push(_);this.buildUniformLayout();const f=[],d=[];for(c=0;c<o.length;c++){const _=l[c];_>=0&&(f.push(o[c]),d.push(_))}this.shaderProcessingContext.attributeNamesFromEffect=f,this.shaderProcessingContext.attributeLocationsFromEffect=d}buildUniformLayout(){var e;if(this.shaderProcessingContext.leftOverUniforms.length){(e=this.uniformBuffer)==null||e.dispose(),this.uniformBuffer=new ce(this.engine,void 0,void 0,"leftOver-"+this._name);for(const t of this.shaderProcessingContext.leftOverUniforms){const i=t.type.replace(/^(.*?)(<.*>)?$/,"$1"),s=Mt.UniformSizes[i];this.uniformBuffer.addUniform(t.name,s,t.length),this._leftOverUniformsByName[t.name]=t.type}this.uniformBuffer.create()}}setEngine(e){this.engine=e}dispose(){this.uniformBuffer&&this.uniformBuffer.dispose()}setInt(e,t){!this.uniformBuffer||!this._leftOverUniformsByName[e]||this.uniformBuffer.updateInt(e,t)}setInt2(e,t,i){!this.uniformBuffer||!this._leftOverUniformsByName[e]||this.uniformBuffer.updateInt2(e,t,i)}setInt3(e,t,i,s){!this.uniformBuffer||!this._leftOverUniformsByName[e]||this.uniformBuffer.updateInt3(e,t,i,s)}setInt4(e,t,i,s,r){!this.uniformBuffer||!this._leftOverUniformsByName[e]||this.uniformBuffer.updateInt4(e,t,i,s,r)}setIntArray(e,t){!this.uniformBuffer||!this._leftOverUniformsByName[e]||this.uniformBuffer.updateIntArray(e,t)}setIntArray2(e,t){this.setIntArray(e,t)}setIntArray3(e,t){this.setIntArray(e,t)}setIntArray4(e,t){this.setIntArray(e,t)}setUInt(e,t){!this.uniformBuffer||!this._leftOverUniformsByName[e]||this.uniformBuffer.updateUInt(e,t)}setUInt2(e,t,i){!this.uniformBuffer||!this._leftOverUniformsByName[e]||this.uniformBuffer.updateUInt2(e,t,i)}setUInt3(e,t,i,s){!this.uniformBuffer||!this._leftOverUniformsByName[e]||this.uniformBuffer.updateUInt3(e,t,i,s)}setUInt4(e,t,i,s,r){!this.uniformBuffer||!this._leftOverUniformsByName[e]||this.uniformBuffer.updateUInt4(e,t,i,s,r)}setUIntArray(e,t){!this.uniformBuffer||!this._leftOverUniformsByName[e]||this.uniformBuffer.updateUIntArray(e,t)}setUIntArray2(e,t){this.setUIntArray(e,t)}setUIntArray3(e,t){this.setUIntArray(e,t)}setUIntArray4(e,t){this.setUIntArray(e,t)}setArray(e,t){!this.uniformBuffer||!this._leftOverUniformsByName[e]||this.uniformBuffer.updateArray(e,t)}setArray2(e,t){this.setArray(e,t)}setArray3(e,t){this.setArray(e,t)}setArray4(e,t){this.setArray(e,t)}setMatrices(e,t){!this.uniformBuffer||!this._leftOverUniformsByName[e]||this.uniformBuffer.updateMatrices(e,t)}setMatrix(e,t){!this.uniformBuffer||!this._leftOverUniformsByName[e]||this.uniformBuffer.updateMatrix(e,t)}setMatrix3x3(e,t){!this.uniformBuffer||!this._leftOverUniformsByName[e]||this.uniformBuffer.updateMatrix3x3(e,t)}setMatrix2x2(e,t){!this.uniformBuffer||!this._leftOverUniformsByName[e]||this.uniformBuffer.updateMatrix2x2(e,t)}setFloat(e,t){!this.uniformBuffer||!this._leftOverUniformsByName[e]||this.uniformBuffer.updateFloat(e,t)}setVector2(e,t){this.setFloat2(e,t.x,t.y)}setFloat2(e,t,i){!this.uniformBuffer||!this._leftOverUniformsByName[e]||this.uniformBuffer.updateFloat2(e,t,i)}setVector3(e,t){this.setFloat3(e,t.x,t.y,t.z)}setFloat3(e,t,i,s){!this.uniformBuffer||!this._leftOverUniformsByName[e]||this.uniformBuffer.updateFloat3(e,t,i,s)}setVector4(e,t){this.setFloat4(e,t.x,t.y,t.z,t.w)}setQuaternion(e,t){this.setFloat4(e,t.x,t.y,t.z,t.w)}setFloat4(e,t,i,s,r){!this.uniformBuffer||!this._leftOverUniformsByName[e]||this.uniformBuffer.updateFloat4(e,t,i,s,r)}setColor3(e,t){this.setFloat3(e,t.r,t.g,t.b)}setColor4(e,t,i){this.setFloat4(e,t.r,t.g,t.b,i)}setDirectColor4(e,t){this.setFloat4(e,t.r,t.g,t.b,t.a)}_getVertexShaderCode(){var e;return(e=this.sources)==null?void 0:e.vertex}_getFragmentShaderCode(){var e;return(e=this.sources)==null?void 0:e.fragment}}const B4=4,N4=65536,lg={mat2:2,mat3:3,mat4:4,mat2x2:2,mat3x3:3,mat4x4:4};class Di{static get KnownUBOs(){return Di._SimplifiedKnownBindings?Di._SimplifiedKnownUBOs:Di._KnownUBOs}constructor(e,t=!1){this.vertexBufferKindToNumberOfComponents={},this.shaderLanguage=e,this._attributeNextLocation=0,this._varyingNextLocation=0,this.freeGroupIndex=0,this.freeBindingIndex=0,this.availableVaryings={},this.availableAttributes={},this.availableBuffers={},this.availableTextures={},this.availableSamplers={},this.orderedAttributes=[],this.bindGroupLayoutEntries=[],this.bindGroupLayoutEntryInfo=[],this.bindGroupEntries=[],this.bufferNames=[],this.textureNames=[],this.samplerNames=[],this.leftOverUniforms=[],t||this._findStartingGroupBinding()}_findStartingGroupBinding(){const e=Di.KnownUBOs,t=[];for(const i in e){const s=e[i].binding;s.groupIndex!==-1&&(t[s.groupIndex]===void 0?t[s.groupIndex]=s.bindingIndex:t[s.groupIndex]=Math.max(t[s.groupIndex],s.bindingIndex))}this.freeGroupIndex=t.length-1,this.freeGroupIndex===0?(this.freeGroupIndex++,this.freeBindingIndex=0):this.freeBindingIndex=t[t.length-1]+1}getAttributeNextLocation(e,t=0){const i=this._attributeNextLocation;return this._attributeNextLocation+=(lg[e]??1)*(t||1),i}getVaryingNextLocation(e,t=0){const i=this._varyingNextLocation;return this._varyingNextLocation+=(lg[e]??1)*(t||1),i}getNextFreeUBOBinding(){return this._getNextFreeBinding(1)}_getNextFreeBinding(e){if(this.freeBindingIndex>N4-e&&(this.freeGroupIndex++,this.freeBindingIndex=0),this.freeGroupIndex===B4)throw"Too many textures or UBOs have been declared and it is not supported in WebGPU.";const t={groupIndex:this.freeGroupIndex,bindingIndex:this.freeBindingIndex};return this.freeBindingIndex+=e,t}}Di._SimplifiedKnownBindings=!0;Di._SimplifiedKnownUBOs={Scene:{binding:{groupIndex:0,bindingIndex:0}},Light0:{binding:{groupIndex:-1,bindingIndex:-1}},Light1:{binding:{groupIndex:-1,bindingIndex:-1}},Light2:{binding:{groupIndex:-1,bindingIndex:-1}},Light3:{binding:{groupIndex:-1,bindingIndex:-1}},Light4:{binding:{groupIndex:-1,bindingIndex:-1}},Light5:{binding:{groupIndex:-1,bindingIndex:-1}},Light6:{binding:{groupIndex:-1,bindingIndex:-1}},Light7:{binding:{groupIndex:-1,bindingIndex:-1}},Light8:{binding:{groupIndex:-1,bindingIndex:-1}},Light9:{binding:{groupIndex:-1,bindingIndex:-1}},Light10:{binding:{groupIndex:-1,bindingIndex:-1}},Light11:{binding:{groupIndex:-1,bindingIndex:-1}},Light12:{binding:{groupIndex:-1,bindingIndex:-1}},Light13:{binding:{groupIndex:-1,bindingIndex:-1}},Light14:{binding:{groupIndex:-1,bindingIndex:-1}},Light15:{binding:{groupIndex:-1,bindingIndex:-1}},Light16:{binding:{groupIndex:-1,bindingIndex:-1}},Light17:{binding:{groupIndex:-1,bindingIndex:-1}},Light18:{binding:{groupIndex:-1,bindingIndex:-1}},Light19:{binding:{groupIndex:-1,bindingIndex:-1}},Light20:{binding:{groupIndex:-1,bindingIndex:-1}},Light21:{binding:{groupIndex:-1,bindingIndex:-1}},Light22:{binding:{groupIndex:-1,bindingIndex:-1}},Light23:{binding:{groupIndex:-1,bindingIndex:-1}},Light24:{binding:{groupIndex:-1,bindingIndex:-1}},Light25:{binding:{groupIndex:-1,bindingIndex:-1}},Light26:{binding:{groupIndex:-1,bindingIndex:-1}},Light27:{binding:{groupIndex:-1,bindingIndex:-1}},Light28:{binding:{groupIndex:-1,bindingIndex:-1}},Light29:{binding:{groupIndex:-1,bindingIndex:-1}},Light30:{binding:{groupIndex:-1,bindingIndex:-1}},Light31:{binding:{groupIndex:-1,bindingIndex:-1}},Material:{binding:{groupIndex:-1,bindingIndex:-1}},Mesh:{binding:{groupIndex:-1,bindingIndex:-1}},Internals:{binding:{groupIndex:-1,bindingIndex:-1}}};Di._KnownUBOs={Scene:{binding:{groupIndex:0,bindingIndex:0}},Light0:{binding:{groupIndex:1,bindingIndex:0}},Light1:{binding:{groupIndex:1,bindingIndex:1}},Light2:{binding:{groupIndex:1,bindingIndex:2}},Light3:{binding:{groupIndex:1,bindingIndex:3}},Light4:{binding:{groupIndex:1,bindingIndex:4}},Light5:{binding:{groupIndex:1,bindingIndex:5}},Light6:{binding:{groupIndex:1,bindingIndex:6}},Light7:{binding:{groupIndex:1,bindingIndex:7}},Light8:{binding:{groupIndex:1,bindingIndex:8}},Light9:{binding:{groupIndex:1,bindingIndex:9}},Light10:{binding:{groupIndex:1,bindingIndex:10}},Light11:{binding:{groupIndex:1,bindingIndex:11}},Light12:{binding:{groupIndex:1,bindingIndex:12}},Light13:{binding:{groupIndex:1,bindingIndex:13}},Light14:{binding:{groupIndex:1,bindingIndex:14}},Light15:{binding:{groupIndex:1,bindingIndex:15}},Light16:{binding:{groupIndex:1,bindingIndex:16}},Light17:{binding:{groupIndex:1,bindingIndex:17}},Light18:{binding:{groupIndex:1,bindingIndex:18}},Light19:{binding:{groupIndex:1,bindingIndex:19}},Light20:{binding:{groupIndex:1,bindingIndex:20}},Light21:{binding:{groupIndex:1,bindingIndex:21}},Light22:{binding:{groupIndex:1,bindingIndex:22}},Light23:{binding:{groupIndex:1,bindingIndex:23}},Light24:{binding:{groupIndex:1,bindingIndex:24}},Light25:{binding:{groupIndex:1,bindingIndex:25}},Light26:{binding:{groupIndex:1,bindingIndex:26}},Light27:{binding:{groupIndex:1,bindingIndex:27}},Light28:{binding:{groupIndex:1,bindingIndex:28}},Light29:{binding:{groupIndex:1,bindingIndex:29}},Light30:{binding:{groupIndex:1,bindingIndex:30}},Light31:{binding:{groupIndex:1,bindingIndex:31}},Material:{binding:{groupIndex:2,bindingIndex:0}},Mesh:{binding:{groupIndex:2,bindingIndex:1}},Internals:{binding:{groupIndex:2,bindingIndex:2}}};function N0(n,e,t,i){let s=i,r=0,a="";for(;s<t.length;){const o=t.charAt(s);if(a)o===a?a==='"'||a==="'"?t.charAt(s-1)!=="\\"&&(a=""):a="":a==="*/"&&o==="*"&&s+1<t.length&&(t.charAt(s+1)==="/"&&(a=""),a===""&&s++);else switch(o){case n:r++;break;case e:r--;break;case'"':case"'":case"`":a=o;break;case"/":if(s+1<t.length){const l=t.charAt(s+1);l==="/"?a=`
`:l==="*"&&(a="*/")}break}if(s++,r===0)break}return r===0?s-1:-1}function hg(n,e){for(;e<n.length;){const t=n[e];if(t!==" "&&t!==`
`&&t!=="\r"&&t!=="	"&&t!==`
`&&t!=="")break;e++}return e}function yu(n){const e=n.charCodeAt(0);return e>=48&&e<=57||e>=65&&e<=90||e>=97&&e<=122||e==95}function Dc(n){let e=0,t="",i=!1;const s=[];for(;e<n.length;){const r=n.charAt(e);if(t)r===t?t==='"'||t==="'"?(n.charAt(e-1)!=="\\"&&(t=""),s.push(r)):(t="",i=!1):t==="*/"&&r==="*"&&e+1<n.length?(n.charAt(e+1)==="/"&&(t=""),t===""&&(i=!1,e++)):i||s.push(r);else{switch(r){case'"':case"'":case"`":t=r;break;case"/":if(e+1<n.length){const a=n.charAt(e+1);a==="/"?(t=`
`,i=!0):a==="*"&&(t="*/",i=!0)}break}i||s.push(r)}e++}return s.join("")}function U4(n,e,t,i){for(;e>=0&&n.charAt(e)!==t&&n.charAt(e)!==i;)e--;return e}function k4(n){return n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Oc(n,e,t,i){let s=n.indexOf(e);if(s<0)return n;if(t){for(;s++<n.length&&n.charAt(s)!="{";);if(s<n.length){const r=n.substring(0,s+1),a=n.substring(s+1);n=r+t+a}}if(i){const r=n.lastIndexOf("}");n=n.substring(0,r),n+=i+`
}`}return n}class V4 extends Mt{constructor(){super(...arguments),this._missingVaryings=[],this._textureArrayProcessing=[],this._vertexIsGLES3=!1,this._fragmentIsGLES3=!1,this.shaderLanguage=0,this.parseGLES3=!0}_getArraySize(e,t,i){let s=0;const r=e.indexOf("["),a=e.indexOf("]");if(r>0&&a>0){const o=e.substring(r+1,a);s=+o,isNaN(s)&&(s=+i[o.trim()]),e=e.substring(0,r)}return[e,t,s]}initializeShaders(e){this._webgpuProcessingContext=e,this._missingVaryings.length=0,this._textureArrayProcessing.length=0,this.attributeKeywordName=void 0,this.varyingVertexKeywordName=void 0,this.varyingFragmentKeywordName=void 0}preProcessShaderCode(e,t){const i=`// Internals UBO
uniform ${Mt.InternalsUBOName} {
float yFactor_;
float textureOutputHeight_;
};
`,s=e.indexOf("// Internals UBO")!==-1;return t?(this._fragmentIsGLES3=e.indexOf("#version 3")!==-1,this._fragmentIsGLES3&&(this.varyingFragmentKeywordName="in"),s?e:i+`##INJECTCODE##
`+e):(this._vertexIsGLES3=e.indexOf("#version 3")!==-1,this._vertexIsGLES3&&(this.attributeKeywordName="in",this.varyingVertexKeywordName="out"),s?e:i+e)}varyingCheck(e,t){const i=/(flat\s)?\s*\bout\b/,s=/(flat\s)?\s*\bin\b/,r=/(flat\s)?\s*\bvarying\b/;return(t&&this._fragmentIsGLES3?s:!t&&this._vertexIsGLES3?i:r).test(e)}varyingProcessor(e,t,i){this._preProcessors=i;const s=/\s*(flat)?\s*out\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/gm,r=/\s*(flat)?\s*in\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/gm,a=/\s*(flat)?\s*varying\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/gm,l=(t&&this._fragmentIsGLES3?r:!t&&this._vertexIsGLES3?s:a).exec(e);if(l!==null){const h=l[1]??"",u=l[2],c=l[3];let f;t?(f=this._webgpuProcessingContext.availableVaryings[c],this._missingVaryings[f]="",f===void 0&&U.Warn(`Invalid fragment shader: The varying named "${c}" is not declared in the vertex shader! This declaration will be ignored.`)):(f=this._webgpuProcessingContext.getVaryingNextLocation(u,this._getArraySize(c,u,i)[2]),this._webgpuProcessingContext.availableVaryings[c]=f,this._missingVaryings[f]=`layout(location = ${f}) ${h} in ${u} ${c};`),e=e.replace(l[0],f===void 0?"":`layout(location = ${f}) ${h} ${t?"in":"out"} ${u} ${c};`)}return e}attributeProcessor(e,t){this._preProcessors=t;const i=/\s*in\s+(\S+)\s+(\S+)\s*;/gm,s=/\s*attribute\s+(\S+)\s+(\S+)\s*;/gm,a=(this._vertexIsGLES3?i:s).exec(e);if(a!==null){const o=a[1],l=a[2],h=this._webgpuProcessingContext.getAttributeNextLocation(o,this._getArraySize(l,o,t)[2]);this._webgpuProcessingContext.availableAttributes[l]=h,this._webgpuProcessingContext.orderedAttributes[h]=l;const u=this._webgpuProcessingContext.vertexBufferKindToNumberOfComponents[l];if(u!==void 0){const c=u<0?u===-1?"int":"ivec"+-u:u===1?"uint":"uvec"+u,f=`_int_${l}_`;e=e.replace(a[0],`layout(location = ${h}) in ${c} ${f}; ${o} ${l} = ${o}(${f});`)}else e=e.replace(a[0],`layout(location = ${h}) in ${o} ${l};`)}return e}uniformProcessor(e,t,i){this._preProcessors=i;const r=/\s*uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/gm.exec(e);if(r!==null){let a=r[1],o=r[2];if(a.indexOf("sampler")===0||a.indexOf("sampler")===1){let l=0;[o,a,l]=this._getArraySize(o,a,i);let h=this._webgpuProcessingContext.availableTextures[o];if(!h){h={autoBindSampler:!0,isTextureArray:l>0,isStorageTexture:!1,textures:[],sampleType:"float"};for(let E=0;E<(l||1);++E)h.textures.push(this._webgpuProcessingContext.getNextFreeUBOBinding())}const u=Mt._SamplerTypeByWebGLSamplerType[a]??"sampler",c=!!Mt._IsComparisonSamplerByWebGPUSamplerType[u],f=c?"comparison":"filtering",d=o+"Sampler";let _=this._webgpuProcessingContext.availableSamplers[d];_||(_={binding:this._webgpuProcessingContext.getNextFreeUBOBinding(),type:f});const p=a.charAt(0)==="u"?"u":a.charAt(0)==="i"?"i":"";p&&(a=a.substring(1));const g=c?"depth":p==="u"?"uint":p==="i"?"sint":"float";h.sampleType=g;const m=l>0,v=_.binding.groupIndex,T=_.binding.bindingIndex,A=Mt._SamplerFunctionByWebGLSamplerType[a],b=Mt._TextureTypeByWebGLSamplerType[a],x=Mt._GpuTextureViewDimensionByWebGPUTextureType[b];if(!m)l=1,e=`layout(set = ${v}, binding = ${T}) uniform ${u} ${d};
                        layout(set = ${h.textures[0].groupIndex}, binding = ${h.textures[0].bindingIndex}) uniform ${p}${b} ${o}Texture;
                        #define ${o} ${p}${A}(${o}Texture, ${d})`;else{const E=[];E.push(`layout(set = ${v}, binding = ${T}) uniform ${p}${u} ${d};`),e=`
`;for(let R=0;R<l;++R){const C=h.textures[R].groupIndex,I=h.textures[R].bindingIndex;E.push(`layout(set = ${C}, binding = ${I}) uniform ${b} ${o}Texture${R};`),e+=`${R>0?`
`:""}#define ${o}${R} ${p}${A}(${o}Texture${R}, ${d})`}e=E.join(`
`)+e,this._textureArrayProcessing.push(o)}this._webgpuProcessingContext.availableTextures[o]=h,this._webgpuProcessingContext.availableSamplers[d]=_,this._addSamplerBindingDescription(d,_,!t);for(let E=0;E<l;++E)this._addTextureBindingDescription(o,h,E,x,null,!t)}else this._addUniformToLeftOverUBO(o,a,i),e=""}return e}uniformBufferProcessor(e,t){const s=/uniform\s+(\w+)/gm.exec(e);if(s!==null){const r=s[1];let a=this._webgpuProcessingContext.availableBuffers[r];if(!a){const o=Di.KnownUBOs[r];let l;o&&o.binding.groupIndex!==-1?l=o.binding:l=this._webgpuProcessingContext.getNextFreeUBOBinding(),a={binding:l},this._webgpuProcessingContext.availableBuffers[r]=a}this._addBufferBindingDescription(r,a,"uniform",!t),e=e.replace("uniform",`layout(set = ${a.binding.groupIndex}, binding = ${a.binding.bindingIndex}) uniform`)}return e}postProcessor(e,t,i,s,r){const a=e.search(/#extension.+GL_EXT_draw_buffers.+require/)!==-1,o=/#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g;if(e=e.replace(o,""),e=e.replace(/texture2D\s*\(/g,"texture("),i){const l=e.indexOf("gl_FragCoord")>=0,h=`
                glFragCoord_ = gl_FragCoord;
                if (yFactor_ == 1.) {
                    glFragCoord_.y = textureOutputHeight_ - glFragCoord_.y;
                }
            `,u=l?`vec4 glFragCoord_;
`:"",c=e.search(/layout *\(location *= *0\) *out/g)!==-1;if(e=e.replace(/texture2DLodEXT\s*\(/g,"textureLod("),e=e.replace(/textureCubeLodEXT\s*\(/g,"textureLod("),e=e.replace(/textureCube\s*\(/g,"texture("),e=e.replace(/gl_FragDepthEXT/g,"gl_FragDepth"),e=e.replace(/gl_FragColor/g,"glFragColor"),e=e.replace(/gl_FragData/g,"glFragData"),e=e.replace(/gl_FragCoord/g,"glFragCoord_"),!this._fragmentIsGLES3)e=e.replace(/void\s+?main\s*\(/g,(a||c?"":`layout(location = 0) out vec4 glFragColor;
`)+"void main(");else{const f=/^\s*out\s+\S+\s+\S+\s*;/gm.exec(e);f!==null&&(e=e.substring(0,f.index)+"layout(location = 0) "+e.substring(f.index))}e=e.replace(/dFdy/g,"(-yFactor_)*dFdy"),e=e.replace("##INJECTCODE##",u),l&&(e=Oc(e,"void main",h))}else if(e=e.replace(/gl_InstanceID/g,"gl_InstanceIndex"),e=e.replace(/gl_VertexID/g,"gl_VertexIndex"),t.indexOf("#define MULTIVIEW")!==-1)return`#extension GL_OVR_multiview2 : require
layout (num_views = 2) in;
`+e;if(!i){const l=e.lastIndexOf("}");e=e.substring(0,l),e+=`gl_Position.y *= yFactor_;
`,e+="}"}return e}_applyTextureArrayProcessing(e,t){const i=new RegExp(t+"\\s*\\[(.+)?\\]","gm");let s=i.exec(e);for(;s!==null;){const r=s[1];let a=+r;this._preProcessors&&isNaN(a)&&(a=+this._preProcessors[r.trim()]),e=e.replace(s[0],t+a),s=i.exec(e)}return e}_generateLeftOverUBOCode(e,t){let i=`layout(set = ${t.binding.groupIndex}, binding = ${t.binding.bindingIndex}) uniform ${e} {
    `;for(const s of this._webgpuProcessingContext.leftOverUniforms)s.length>0?i+=`    ${s.type} ${s.name}[${s.length}];
`:i+=`    ${s.type} ${s.name};
`;return i+=`};

`,i}finalizeShaders(e,t){for(let s=0;s<this._textureArrayProcessing.length;++s){const r=this._textureArrayProcessing[s];e=this._applyTextureArrayProcessing(e,r),t=this._applyTextureArrayProcessing(t,r)}for(let s=0;s<this._missingVaryings.length;++s){const r=this._missingVaryings[s];r&&r.length>0&&(t=r+`
`+t)}const i=this._buildLeftOverUBO();return e=i+e,t=i+t,this._collectBindingNames(),this._preCreateBindGroupEntries(),this._preProcessors=null,this._webgpuProcessingContext.vertexBufferKindToNumberOfComponents={},{vertexCode:e,fragmentCode:t}}}const ug="bakedVertexAnimationDeclaration",G4=`#ifdef BAKED_VERTEX_ANIMATION_TEXTURE
uniform bakedVertexAnimationTime: f32;uniform bakedVertexAnimationTextureSizeInverted: vec2<f32>;uniform bakedVertexAnimationSettings: vec4<f32>;var bakedVertexAnimationTexture : texture_2d<f32>;
#ifdef INSTANCES
attribute bakedVertexAnimationSettingsInstanced : vec4<f32>;
#endif
fn readMatrixFromRawSamplerVAT(smp : texture_2d<f32>,index : f32,frame : f32)->mat4x4<f32>
{let offset=i32(index)*4;let frameUV=i32(frame);let m0=textureLoad(smp,vec2<i32>(offset+0,frameUV),0);let m1=textureLoad(smp,vec2<i32>(offset+1,frameUV),0);let m2=textureLoad(smp,vec2<i32>(offset+2,frameUV),0);let m3=textureLoad(smp,vec2<i32>(offset+3,frameUV),0);return mat4x4<f32>(m0,m1,m2,m3);}
#endif
`;ye.IncludesShadersStoreWGSL[ug]||(ye.IncludesShadersStoreWGSL[ug]=G4);const cg="bakedVertexAnimation",z4=`#ifdef BAKED_VERTEX_ANIMATION_TEXTURE
{
#ifdef INSTANCES
let VATStartFrame: f32=vertexInputs.bakedVertexAnimationSettingsInstanced.x;let VATEndFrame: f32=vertexInputs.bakedVertexAnimationSettingsInstanced.y;let VATOffsetFrame: f32=vertexInputs.bakedVertexAnimationSettingsInstanced.z;let VATSpeed: f32=vertexInputs.bakedVertexAnimationSettingsInstanced.w;
#else
let VATStartFrame: f32=uniforms.bakedVertexAnimationSettings.x;let VATEndFrame: f32=uniforms.bakedVertexAnimationSettings.y;let VATOffsetFrame: f32=uniforms.bakedVertexAnimationSettings.z;let VATSpeed: f32=uniforms.bakedVertexAnimationSettings.w;
#endif
let totalFrames: f32=VATEndFrame-VATStartFrame+1.0;let time: f32=uniforms.bakedVertexAnimationTime*VATSpeed/totalFrames;let frameCorrection: f32=select(1.0,0.0,time<1.0);let numOfFrames: f32=totalFrames-frameCorrection;var VATFrameNum: f32=fract(time)*numOfFrames;VATFrameNum=(VATFrameNum+VATOffsetFrame) % numOfFrames;VATFrameNum=floor(VATFrameNum);VATFrameNum=VATFrameNum+VATStartFrame+frameCorrection;var VATInfluence : mat4x4<f32>;VATInfluence=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,vertexInputs.matricesIndices[0],VATFrameNum)*vertexInputs.matricesWeights[0];
#if NUM_BONE_INFLUENCERS>1
VATInfluence=VATInfluence+readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,vertexInputs.matricesIndices[1],VATFrameNum)*vertexInputs.matricesWeights[1];
#endif
#if NUM_BONE_INFLUENCERS>2
VATInfluence=VATInfluence+readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,vertexInputs.matricesIndices[2],VATFrameNum)*vertexInputs.matricesWeights[2];
#endif
#if NUM_BONE_INFLUENCERS>3
VATInfluence=VATInfluence+readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,vertexInputs.matricesIndices[3],VATFrameNum)*vertexInputs.matricesWeights[3];
#endif
#if NUM_BONE_INFLUENCERS>4
VATInfluence=VATInfluence+readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,vertexInputs.matricesIndicesExtra[0],VATFrameNum)*vertexInputs.matricesWeightsExtra[0];
#endif
#if NUM_BONE_INFLUENCERS>5
VATInfluence=VATInfluence+readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,vertexInputs.matricesIndicesExtra[1],VATFrameNum)*vertexInputs.matricesWeightsExtra[1];
#endif
#if NUM_BONE_INFLUENCERS>6
VATInfluence=VATInfluence+readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,vertexInputs.matricesIndicesExtra[2],VATFrameNum)*vertexInputs.matricesWeightsExtra[2];
#endif
#if NUM_BONE_INFLUENCERS>7
VATInfluence=VATInfluence+readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,vertexInputs.matricesIndicesExtra[3],VATFrameNum)*vertexInputs.matricesWeightsExtra[3];
#endif
finalWorld=finalWorld*VATInfluence;}
#endif
`;ye.IncludesShadersStoreWGSL[cg]||(ye.IncludesShadersStoreWGSL[cg]=z4);const fg="instancesDeclaration",W4=`#ifdef INSTANCES
attribute world0 : vec4<f32>;attribute world1 : vec4<f32>;attribute world2 : vec4<f32>;attribute world3 : vec4<f32>;
#ifdef INSTANCESCOLOR
attribute instanceColor : vec4<f32>;
#endif
#if defined(THIN_INSTANCES) && !defined(WORLD_UBO)
uniform world : mat4x4<f32>;
#endif
#if defined(VELOCITY) || defined(PREPASS_VELOCITY) || defined(PREPASS_VELOCITY_LINEAR) || defined(VELOCITY_LINEAR)
attribute previousWorld0 : vec4<f32>;attribute previousWorld1 : vec4<f32>;attribute previousWorld2 : vec4<f32>;attribute previousWorld3 : vec4<f32>;
#ifdef THIN_INSTANCES
uniform previousWorld : mat4x4<f32>;
#endif
#endif
#else
#if !defined(WORLD_UBO)
uniform world : mat4x4<f32>;
#endif
#if defined(VELOCITY) || defined(PREPASS_VELOCITY) || defined(PREPASS_VELOCITY_LINEAR) || defined(VELOCITY_LINEAR)
uniform previousWorld : mat4x4<f32>;
#endif
#endif
`;ye.IncludesShadersStoreWGSL[fg]||(ye.IncludesShadersStoreWGSL[fg]=W4);const dg="instancesVertex",H4=`#ifdef INSTANCES
var finalWorld=mat4x4<f32>(vertexInputs.world0,vertexInputs.world1,vertexInputs.world2,vertexInputs.world3);
#if defined(PREPASS_VELOCITY) || defined(VELOCITY) || defined(PREPASS_VELOCITY_LINEAR) || defined(VELOCITY_LINEAR)
var finalPreviousWorld=mat4x4<f32>(
vertexInputs.previousWorld0,vertexInputs.previousWorld1,
vertexInputs.previousWorld2,vertexInputs.previousWorld3);
#endif
#ifdef THIN_INSTANCES
#if !defined(WORLD_UBO)
finalWorld=uniforms.world*finalWorld;
#else
finalWorld=mesh.world*finalWorld;
#endif
#if defined(PREPASS_VELOCITY) || defined(VELOCITY) || defined(PREPASS_VELOCITY_LINEAR) || defined(VELOCITY_LINEAR)
finalPreviousWorld=uniforms.previousWorld*finalPreviousWorld;
#endif
#endif
#else
#if !defined(WORLD_UBO)
var finalWorld=uniforms.world;
#else
var finalWorld=mesh.world;
#endif
#if defined(PREPASS_VELOCITY) || defined(VELOCITY) || defined(PREPASS_VELOCITY_LINEAR) || defined(VELOCITY_LINEAR)
var finalPreviousWorld=uniforms.previousWorld;
#endif
#endif
`;ye.IncludesShadersStoreWGSL[dg]||(ye.IncludesShadersStoreWGSL[dg]=H4);const _g="helperFunctions",K4=`const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; 
const LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}
fn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}
fn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}
fn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}
fn maxEps(x: f32)->f32 {return max(x,Epsilon);}
fn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}
fn absEps(x: f32)->f32 {return abs(x)+Epsilon;}
fn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(
vec3(i0.x,i1.x,i2.x),
vec3(i0.y,i1.y,i2.y),
vec3(i0.z,i1.z,i2.z)
);return outMatrix;}
fn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,
b11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,
b21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}
#if USE_EXACT_SRGB_CONVERSIONS
fn toLinearSpaceExact(color: vec3f)->vec3f
{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}
fn toGammaSpaceExact(color: vec3f)->vec3f
{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}
#endif
fn toLinearSpace(color: f32)->f32
{
#if USE_EXACT_SRGB_CONVERSIONS
var nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);
#else
return pow(color,LinearEncodePowerApprox);
#endif
}
fn toLinearSpaceVec3(color: vec3f)->vec3f
{
#if USE_EXACT_SRGB_CONVERSIONS
return toLinearSpaceExact(color);
#else
return pow(color,vec3f(LinearEncodePowerApprox));
#endif
}
fn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>
{
#if USE_EXACT_SRGB_CONVERSIONS
return vec4f(toLinearSpaceExact(color.rgb),color.a);
#else
return vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);
#endif
}
fn toGammaSpace(color: vec4<f32>)->vec4<f32>
{
#if USE_EXACT_SRGB_CONVERSIONS
return vec4<f32>(toGammaSpaceExact(color.rgb),color.a);
#else
return vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);
#endif
}
fn toGammaSpaceVec3(color: vec3f)->vec3f
{
#if USE_EXACT_SRGB_CONVERSIONS
return toGammaSpaceExact(color);
#else
return pow(color,vec3f(GammaEncodePowerApprox));
#endif
}
fn squareVec3(value: vec3f)->vec3f
{return value*value;}
fn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}
fn getLuminance(color: vec3f)->f32
{return saturate(dot(color,LuminanceEncodeApprox));}
fn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}
fn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}
const rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}
fn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}
fn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}
fn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}
fn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}
fn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}
`;ye.IncludesShadersStoreWGSL[_g]||(ye.IncludesShadersStoreWGSL[_g]=K4);const pg="fresnelFunction",X4=`#ifdef FRESNEL
fn computeFresnelTerm(viewDirection: vec3f,worldNormal: vec3f,bias: f32,power: f32)->f32
{let fresnelTerm: f32=pow(bias+abs(dot(viewDirection,worldNormal)),power);return clamp(fresnelTerm,0.,1.);}
#endif
`;ye.IncludesShadersStoreWGSL[pg]||(ye.IncludesShadersStoreWGSL[pg]=X4);const gg="meshUboDeclaration",Y4=`struct Mesh {world : mat4x4<f32>,
visibility : f32,};var<uniform> mesh : Mesh;
#define WORLD_UBO
`;ye.IncludesShadersStoreWGSL[gg]||(ye.IncludesShadersStoreWGSL[gg]=Y4);const mg="sceneUboDeclaration",j4=`struct Scene {viewProjection : mat4x4<f32>,
#ifdef MULTIVIEW
viewProjectionR : mat4x4<f32>,
#endif 
view : mat4x4<f32>,
projection : mat4x4<f32>,
vEyePosition : vec4<f32>,};
#define SCENE_UBO
var<uniform> scene : Scene;
`;ye.IncludesShadersStoreWGSL[mg]||(ye.IncludesShadersStoreWGSL[mg]=j4);const vg="decalFragment",q4=`#ifdef DECAL
var decalTempColor=decalColor.rgb;var decalTempAlpha=decalColor.a;
#ifdef GAMMADECAL
decalTempColor=toLinearSpaceVec3(decalColor.rgb);
#endif
#ifdef DECAL_SMOOTHALPHA
decalTempAlpha=decalColor.a*decalColor.a;
#endif
surfaceAlbedo=mix(surfaceAlbedo.rgb,decalTempColor,decalTempAlpha);
#endif
`;ye.IncludesShadersStoreWGSL[vg]||(ye.IncludesShadersStoreWGSL[vg]=q4);const yg="fragmentOutputs.fragDepth",$4="uniforms",Z4="internals",Q4={texture_1d:"1d",texture_2d:"2d",texture_2d_array:"2d-array",texture_3d:"3d",texture_cube:"cube",texture_cube_array:"cube-array",texture_multisampled_2d:"2d",texture_depth_2d:"2d",texture_depth_2d_array:"2d-array",texture_depth_cube:"cube",texture_depth_cube_array:"cube-array",texture_depth_multisampled_2d:"2d",texture_storage_1d:"1d",texture_storage_2d:"2d",texture_storage_2d_array:"2d-array",texture_storage_3d:"3d",texture_external:null};class J4 extends Mt{constructor(){super(...arguments),this.shaderLanguage=1,this.uniformRegexp=/uniform\s+(\w+)\s*:\s*(.+)\s*;/,this.textureRegexp=/var\s+(\w+)\s*:\s*((array<\s*)?(texture_\w+)\s*(<\s*(.+)\s*>)?\s*(,\s*\w+\s*>\s*)?);/,this.noPrecision=!0,this.pureMode=!1}preProcessor(e,t,i,s,r){for(const a in i){if(a==="__VERSION__")continue;const o=i[a];(!isNaN(parseInt(o))||!isNaN(parseFloat(o)))&&(e=`const ${a} = ${o};
`+e)}return e}_getArraySize(e,t,i){let s=0;const r=t.lastIndexOf(">");if(t.indexOf("array")>=0&&r>0){let a=r;for(;a>0&&t.charAt(a)!==" "&&t.charAt(a)!==",";)a--;const o=t.substring(a+1,r);for(s=+o,isNaN(s)&&(s=+i[o.trim()]);a>0&&(t.charAt(a)===" "||t.charAt(a)===",");)a--;t=t.substring(t.indexOf("<")+1,a+1)}return[e,t,s]}initializeShaders(e){this._webgpuProcessingContext=e,this._attributesInputWGSL=[],this._attributesWGSL=[],this._attributesConversionCodeWGSL=[],this._hasNonFloatAttribute=!1,this._varyingsWGSL=[],this._varyingNamesWGSL=[],this._stridedUniformArrays=[]}preProcessShaderCode(e){const t=this.pureMode?"":`struct ${Mt.InternalsUBOName} {
  yFactor_: f32,
  textureOutputHeight_: f32,
};
var<uniform> ${Z4} : ${Mt.InternalsUBOName};
`;return e.indexOf(t)!==-1?e:t+Dc(e)}varyingCheck(e){return/(flat|linear|perspective)?\s*(center|centroid|sample)?\s*\bvarying\b/.test(e)}varyingProcessor(e,t,i){const r=/\s*(flat|linear|perspective)?\s*(center|centroid|sample)?\s*varying\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s*:\s*(.+)\s*;/gm.exec(e);if(r!==null){const a=r[1]??"perspective",o=r[2]??"center",l=r[4],h=r[3],u=a==="flat"?`@interpolate(${a})`:`@interpolate(${a}, ${o})`;let c;t?(c=this._webgpuProcessingContext.availableVaryings[h],c===void 0&&U.Warn(`Invalid fragment shader: The varying named "${h}" is not declared in the vertex shader! This declaration will be ignored.`)):(c=this._webgpuProcessingContext.getVaryingNextLocation(l,this._getArraySize(h,l,i)[2]),this._webgpuProcessingContext.availableVaryings[h]=c,this._varyingsWGSL.push(`  @location(${c}) ${u} ${h} : ${l},`),this._varyingNamesWGSL.push(h)),e=""}return e}attributeProcessor(e,t){const s=/\s*attribute\s+(\S+)\s*:\s*(.+)\s*;/gm.exec(e);if(s!==null){const r=s[2],a=s[1],o=this._webgpuProcessingContext.getAttributeNextLocation(r,this._getArraySize(a,r,t)[2]);this._webgpuProcessingContext.availableAttributes[a]=o,this._webgpuProcessingContext.orderedAttributes[o]=a;const l=this._webgpuProcessingContext.vertexBufferKindToNumberOfComponents[a];if(l!==void 0){const h=l<0?l===-1?"i32":"vec"+-l+"<i32>":l===1?"u32":"vec"+l+"<u32>",u=`_int_${a}_`;this._attributesInputWGSL.push(`@location(${o}) ${u} : ${h},`),this._attributesWGSL.push(`${a} : ${r},`),this._attributesConversionCodeWGSL.push(`vertexInputs.${a} = ${r}(vertexInputs_.${u});`),this._hasNonFloatAttribute=!0}else this._attributesInputWGSL.push(`@location(${o}) ${a} : ${r},`),this._attributesWGSL.push(`${a} : ${r},`),this._attributesConversionCodeWGSL.push(`vertexInputs.${a} = vertexInputs_.${a};`);e=""}return e}uniformProcessor(e,t,i){const s=this.uniformRegexp.exec(e);if(s!==null){const r=s[2],a=s[1];this._addUniformToLeftOverUBO(a,r,i),e=""}return e}textureProcessor(e,t,i){const s=this.textureRegexp.exec(e);if(s!==null){const r=s[1],a=s[2],o=!!s[3],l=s[4],h=l.indexOf("storage")>0,u=s[6],c=h?u.substring(0,u.indexOf(",")).trim():null;let f=o?this._getArraySize(r,a,i)[2]:0,d=this._webgpuProcessingContext.availableTextures[r];if(d)f=d.textures.length;else{d={isTextureArray:f>0,isStorageTexture:h,textures:[],sampleType:"float"},f=f||1;for(let m=0;m<f;++m)d.textures.push(this._webgpuProcessingContext.getNextFreeUBOBinding())}this._webgpuProcessingContext.availableTextures[r]=d;const _=l.indexOf("depth")>0,p=Q4[l],g=_?"depth":u==="u32"?"uint":u==="i32"?"sint":"float";if(d.sampleType=g,p===void 0)throw`Can't get the texture dimension corresponding to the texture function "${l}"!`;for(let m=0;m<f;++m){const{groupIndex:v,bindingIndex:T}=d.textures[m];m===0&&(e=`@group(${v}) @binding(${T}) ${e}`),this._addTextureBindingDescription(r,d,m,p,c,!t)}}return e}postProcessor(e){const t=/#define (.+?) (.+?)$/gm;let i;for(;(i=t.exec(e))!==null;)e=e.replace(new RegExp(i[1],"g"),i[2]);return e}finalizeShaders(e,t){const i=t.indexOf("fragmentInputs.position")>=0&&!this.pureMode?`
            if (internals.yFactor_ == 1.) {
                fragmentInputs.position.y = internals.textureOutputHeight_ - fragmentInputs.position.y;
            }
        `:"";e=this._processSamplers(e,!0),t=this._processSamplers(t,!1),e=this._processCustomBuffers(e,!0),t=this._processCustomBuffers(t,!1);const s=this._buildLeftOverUBO();e=s+e,t=s+t,e=e.replace(/#define (\w+)\s+(\d+\.?\d*)/g,"const $1 = $2;"),e=e.replace(/#define /g,"//#define "),e=this._processStridedUniformArrays(e);let r=`struct VertexInputs {
  @builtin(vertex_index) vertexIndex : u32,
  @builtin(instance_index) instanceIndex : u32,
`;this._attributesInputWGSL.length>0&&(r+=this._attributesInputWGSL.join(`
`)),r+=`
};
var<private> vertexInputs`+(this._hasNonFloatAttribute?"_":"")+` : VertexInputs;
`,this._hasNonFloatAttribute&&(r+=`struct VertexInputs_ {
  vertexIndex : u32, instanceIndex : u32,
`,r+=this._attributesWGSL.join(`
`),r+=`
};
var<private> vertexInputs : VertexInputs_;
`);let a=`struct FragmentInputs {
  @builtin(position) position : vec4<f32>,
`;this._varyingsWGSL.length>0&&(a+=this._varyingsWGSL.join(`
`)),a+=`
};
var<private> vertexOutputs : FragmentInputs;
`,e=r+a+e;let o=`
  vertexInputs${this._hasNonFloatAttribute?"_":""} = input;
`;this._hasNonFloatAttribute&&(o+=`vertexInputs.vertexIndex = vertexInputs_.vertexIndex;
vertexInputs.instanceIndex = vertexInputs_.instanceIndex;
`,o+=this._attributesConversionCodeWGSL.join(`
`),o+=`
`);const l=this.pureMode?"  return vertexOutputs;":`  vertexOutputs.position.y = vertexOutputs.position.y * internals.yFactor_;
  return vertexOutputs;`;let h=e.indexOf("#define DISABLE_UNIFORMITY_ANALYSIS")!==-1;e=(h?`diagnostic(off, derivative_uniformity);
`:"")+`diagnostic(off, chromium.unreachable_code);
`+Oc(e,"fn main",o,l),t=t.replace(/#define (\w+)\s+(\d+\.?\d*)/g,"const $1 = $2;"),t=t.replace(/#define /g,"//#define "),t=this._processStridedUniformArrays(t),this.pureMode||(t=t.replace(/dpdy/g,"(-internals.yFactor_)*dpdy"));let u=`struct FragmentInputs {
  @builtin(position) position : vec4<f32>,
  @builtin(front_facing) frontFacing : bool,
`;this._varyingsWGSL.length>0&&(u+=this._varyingsWGSL.join(`
`)),u+=`
};
var<private> fragmentInputs : FragmentInputs;
`;let c=`struct FragmentOutputs {
`;const f="fragmentOutputs\\.fragData";let d=t.match(new RegExp(f+"0","g")),_=0;if(d){c+=` @location(${_}) fragData0 : vec4<f32>,
`,_++;for(let A=1;A<8;A++)d=t.match(new RegExp(f+A,"g")),d&&(c+=` @location(${_}) fragData${_} : vec4<f32>,
`,_++);t.indexOf("MRT_AND_COLOR")!==-1&&(c+=`  @location(${_}) color : vec4<f32>,
`,_++)}const p=/oitDepthSampler/;d=t.match(p),d&&(c+=` @location(${_++}) depth : vec2<f32>,
`,c+=` @location(${_++}) frontColor : vec4<f32>,
`,c+=` @location(${_++}) backColor : vec4<f32>,
`),_===0&&(c+=`  @location(0) color : vec4<f32>,
`,_++);let g=!1,m=0;for(;!g&&(m=t.indexOf(yg,m),!(m<0));){const A=m;for(g=!0;m>1&&t.charAt(m)!==`
`;){if(t.charAt(m)==="/"&&t.charAt(m-1)==="/"){g=!1;break}m--}m=A+yg.length}g&&(c+=`  @builtin(frag_depth) fragDepth: f32,
`),c+=`};
var<private> fragmentOutputs : FragmentOutputs;
`,t=u+c+t;const v=`  fragmentInputs = input;
  `+i,T="  return fragmentOutputs;";return h=t.indexOf("#define DISABLE_UNIFORMITY_ANALYSIS")!==-1,t=(h?`diagnostic(off, derivative_uniformity);
`:"")+`diagnostic(off, chromium.unreachable_code);
`+Oc(t,"fn main",v,T),this._collectBindingNames(),this._preCreateBindGroupEntries(),this._webgpuProcessingContext.vertexBufferKindToNumberOfComponents={},{vertexCode:e,fragmentCode:t}}_generateLeftOverUBOCode(e,t){let i="",s=`struct ${e} {
`;for(const r of this._webgpuProcessingContext.leftOverUniforms){const a=r.type.replace(/^(.*?)(<.*>)?$/,"$1"),o=Mt.UniformSizes[a];if(r.length>0)if(o<=2){const l=`${e}_${this._stridedUniformArrays.length}_strided_arr`;i+=`struct ${l} {
                        @size(16)
                        el: ${a},
                    }`,this._stridedUniformArrays.push(r.name),s+=` @align(16) ${r.name} : array<${l}, ${r.length}>,
`}else s+=` ${r.name} : array<${r.type}, ${r.length}>,
`;else s+=`  ${r.name} : ${r.type},
`}return s+=`};
`,s=`${i}
${s}`,s+=`@group(${t.binding.groupIndex}) @binding(${t.binding.bindingIndex}) var<uniform> ${$4} : ${e};
`,s}_processSamplers(e,t){const i=/var\s+(\w+Sampler)\s*:\s*(sampler|sampler_comparison)\s*;/gm;for(;;){const s=i.exec(e);if(s===null)break;const r=s[1],a=s[2],o=r.length-7,l=r.lastIndexOf("Sampler")===o?r.substring(0,o):null,h=a==="sampler_comparison"?"comparison":"filtering";if(l){const _=this._webgpuProcessingContext.availableTextures[l];_&&(_.autoBindSampler=!0)}let u=this._webgpuProcessingContext.availableSamplers[r];u||(u={binding:this._webgpuProcessingContext.getNextFreeUBOBinding(),type:h},this._webgpuProcessingContext.availableSamplers[r]=u),this._addSamplerBindingDescription(r,u,t);const c=e.substring(0,s.index),f=`@group(${u.binding.groupIndex}) @binding(${u.binding.bindingIndex}) `,d=e.substring(s.index);e=c+f+d,i.lastIndex+=f.length}return e}_processCustomBuffers(e,t){var s;const i=/var<\s*(uniform|storage)\s*(,\s*(read|read_write)\s*)?>\s+(\S+)\s*:\s*(\S+)\s*;/gm;for(;;){const r=i.exec(e);if(r===null)break;const a=r[1],o=r[3];let l=r[4];const h=r[5];let u=this._webgpuProcessingContext.availableBuffers[l];if(!u){const g=a==="uniform"?Di.KnownUBOs[h]:null;let m;g?(l=h,m=g.binding,m.groupIndex===-1&&(m=(s=this._webgpuProcessingContext.availableBuffers[l])==null?void 0:s.binding,m||(m=this._webgpuProcessingContext.getNextFreeUBOBinding()))):m=this._webgpuProcessingContext.getNextFreeUBOBinding(),u={binding:m},this._webgpuProcessingContext.availableBuffers[l]=u}this._addBufferBindingDescription(l,this._webgpuProcessingContext.availableBuffers[l],o==="read_write"?"storage":a==="storage"?"read-only-storage":"uniform",t);const c=u.binding.groupIndex,f=u.binding.bindingIndex,d=e.substring(0,r.index),_=`@group(${c}) @binding(${f}) `,p=e.substring(r.index);e=d+_+p,i.lastIndex+=_.length}return e}_processStridedUniformArrays(e){for(const t of this._stridedUniformArrays)e=e.replace(new RegExp(`${t}\\s*\\[(.*?)\\]`,"g"),`${t}[$1].el`);return e}}class nl{get underlyingResource(){return this._webgpuTexture}getMSAATexture(e){var t;return((t=this._webgpuMSAATexture)==null?void 0:t[e])??null}setMSAATexture(e,t){this._webgpuMSAATexture||(this._webgpuMSAATexture=[]),this._webgpuMSAATexture[t]=e}releaseMSAATexture(e){if(this._webgpuMSAATexture)if(e!==void 0)this._engine._textureHelper.releaseTexture(this._webgpuMSAATexture[e]),delete this._webgpuMSAATexture[e];else{for(const t of this._webgpuMSAATexture)this._engine._textureHelper.releaseTexture(t);this._webgpuMSAATexture=null}}constructor(e,t=null){this._engine=e,this._originalFormatIsRGB=!1,this.format="rgba8unorm",this.textureUsages=0,this.textureAdditionalUsages=0,this._webgpuTexture=t,this._webgpuMSAATexture=null,this.view=null,this.viewForWriting=null}set(e){this._webgpuTexture=e}setUsage(e,t,i,s,r,a,o,l){let h="2d",u=1;s?(h=i?"cube-array":"cube",u=6*(l||1)):r?(h="3d",u=1):i&&(h="2d-array",u=l);const c=We.GetDepthFormatOnly(this.format),f=We.HasDepthAndStencilAspects(this.format)?"depth-only":"all";this.createView({label:`TextureView${r?"3D":s?"Cube":"2D"}${i?"_Array"+u:""}_${a}x${o}_${t?"wmips":"womips"}_${this.format}_${h}`,format:c,dimension:h,mipLevelCount:t?gv(Math.max(a,o))+1:1,baseArrayLayer:0,baseMipLevel:0,arrayLayerCount:u,aspect:f})}createView(e,t=!1){if(this.view=this._webgpuTexture.createView(e),t&&e){const i=e.mipLevelCount;e.mipLevelCount=1,this.viewForWriting=this._webgpuTexture.createView(e),e.mipLevelCount=i}}reset(){this._webgpuTexture=null,this._webgpuMSAATexture=null,this.view=null,this.viewForWriting=null}release(){var e,t;(e=this._webgpuTexture)==null||e.destroy(),this.releaseMSAATexture(),(t=this._copyInvertYTempTexture)==null||t.destroy(),this.reset()}}const eA=`
    const pos = array<vec2<f32>, 4>( vec2f(-1.0f, 1.0f),  vec2f(1.0f, 1.0f),  vec2f(-1.0f, -1.0f),  vec2f(1.0f, -1.0f));
    const tex = array<vec2<f32>, 4>( vec2f(0.0f, 0.0f),  vec2f(1.0f, 0.0f),  vec2f(0.0f, 1.0f),  vec2f(1.0f, 1.0f));

    varying vTex: vec2f;

    @vertex
    fn main(input : VertexInputs) -> FragmentInputs {
        vertexOutputs.vTex = tex[input.vertexIndex];
        vertexOutputs.position = vec4f(pos[input.vertexIndex], 0.0, 1.0);
    }
    `,tA=`
    var imgSampler: sampler;
    var img: texture_2d<f32>;

    varying vTex: vec2f;

    @fragment
    fn main(input: FragmentInputs) -> FragmentOutputs {
        fragmentOutputs.color = textureSample(img, imgSampler, input.vTex);
    }
    `,Ov=`
    const pos = array<vec2<f32>, 4>( vec2f(-1.0f, 1.0f),  vec2f(1.0f, 1.0f),  vec2f(-1.0f, -1.0f),  vec2f(1.0f, -1.0f));
    const tex = array<vec2<f32>, 4>( vec2f(0.0f, 0.0f),  vec2f(1.0f, 0.0f),  vec2f(0.0f, 1.0f),  vec2f(1.0f, 1.0f));

    var img: texture_2d<f32>;

    #ifdef INVERTY
        varying vTextureSize: vec2f;
    #endif

    @vertex
    fn main(input : VertexInputs) -> FragmentInputs {
        #ifdef INVERTY
            vertexOutputs.vTextureSize = vec2f(textureDimensions(img, 0));
        #endif
        vertexOutputs.position =  vec4f(pos[input.vertexIndex], 0.0, 1.0);
    }
    `,iA=`
    var img: texture_2d<f32>;

    #ifdef INVERTY
        varying vTextureSize: vec2f;
    #endif

    @fragment
    fn main(input: FragmentInputs) -> FragmentOutputs {
    #ifdef INVERTY
        var color: vec4f = textureLoad(img, vec2i(i32(input.position.x), i32(input.vTextureSize.y - input.position.y)), 0);
    #else
        var color: vec4f = textureLoad(img, vec2i(input.position.xy), 0);
    #endif
    #ifdef PREMULTIPLYALPHA
        color = vec4f(color.rgb * color.a, color.a);
    #endif
        fragmentOutputs.color = color;
    }
    `,sA=Ov,nA=`
    var img: texture_2d<f32>;
    uniform ofstX: f32;
    uniform ofstY: f32;
    uniform width: f32;
    uniform height: f32;

    #ifdef INVERTY
        varying vTextureSize: vec2f;
    #endif

    @fragment
    fn main(input: FragmentInputs) -> FragmentOutputs {
        if (input.position.x < uniforms.ofstX || input.position.x >= uniforms.ofstX + uniforms.width) {
            discard;
        }
        if (input.position.y < uniforms.ofstY || input.position.y >= uniforms.ofstY + uniforms.height) {
            discard;
        }
    #ifdef INVERTY
        var color: vec4f = textureLoad(img, vec2i(i32(input.position.x), i32(uniforms.ofstY + uniforms.height - (input.position.y - uniforms.ofstY))), 0);
    #else
        var color: vec4f = textureLoad(img, vec2i(input.position.xy), 0);
    #endif
    #ifdef PREMULTIPLYALPHA
        color = vec4f(color.rgb * color.a, color.a);
    #endif
        fragmentOutputs.color = color;
    }
    `,rA=`
    const pos = array<vec2<f32>, 4>( vec2f(-1.0f, 1.0f),  vec2f(1.0f, 1.0f),  vec2f(-1.0f, -1.0f),  vec2f(1.0f, -1.0f));

    @vertex
    fn main(input : VertexInputs) -> FragmentInputs {
        vertexOutputs.position =  vec4f(pos[input.vertexIndex], 0.0, 1.0);
    }
    `,aA=`
    uniform color: vec4f;


    @fragment
    fn main(input: FragmentInputs) -> FragmentOutputs {
        fragmentOutputs.color = uniforms.color;
    }
    `,oA=`
    struct VertexOutput {
        @builtin(position) Position : vec4<f32>,
        @location(0) fragUV : vec2<f32>
    }

    @vertex
    fn main(
        @builtin(vertex_index) VertexIndex : u32
    ) -> VertexOutput {
        var pos = array<vec2<f32>, 4>(
            vec2(-1.0,  1.0),
            vec2( 1.0,  1.0),
            vec2(-1.0, -1.0),
            vec2( 1.0, -1.0)
        );
        var tex = array<vec2<f32>, 4>(
            vec2(0.0, 0.0),
            vec2(1.0, 0.0),
            vec2(0.0, 1.0),
            vec2(1.0, 1.0)
        );

        var output: VertexOutput;

        output.Position = vec4<f32>(pos[VertexIndex], 0.0, 1.0);
        output.fragUV = tex[VertexIndex];

        return output;
    }
    `,lA=`
    @group(0) @binding(0) var videoSampler: sampler;
    @group(0) @binding(1) var videoTexture: texture_external;

    @fragment
    fn main(
        @location(0) fragUV: vec2<f32>
    ) -> @location(0) vec4<f32> {
        return textureSampleBaseClampToEdge(videoTexture, videoSampler, fragUV);
    }
    `,hA=`
    @group(0) @binding(0) var videoSampler: sampler;
    @group(0) @binding(1) var videoTexture: texture_external;

    @fragment
    fn main(
        @location(0) fragUV: vec2<f32>
    ) -> @location(0) vec4<f32> {
        return textureSampleBaseClampToEdge(videoTexture, videoSampler, vec2<f32>(fragUV.x, 1.0 - fragUV.y));
    }
    `;var gs;(function(n){n[n.MipMap=0]="MipMap",n[n.InvertYPremultiplyAlpha=1]="InvertYPremultiplyAlpha",n[n.Clear=2]="Clear",n[n.InvertYPremultiplyAlphaWithOfst=3]="InvertYPremultiplyAlphaWithOfst"})(gs||(gs={}));var oa;(function(n){n[n.DontInvertY=0]="DontInvertY",n[n.InvertY=1]="InvertY"})(oa||(oa={}));const xg=[{vertex:eA,fragment:tA},{vertex:Ov,fragment:iA},{vertex:rA,fragment:aA},{vertex:sA,fragment:nA}],ks={"":0,r8unorm:1,r8uint:2,r8sint:3,r16uint:4,r16sint:5,r16float:6,rg8unorm:7,rg8uint:8,rg8sint:9,r32uint:10,r32sint:11,r32float:12,rg16uint:13,rg16sint:14,rg16float:15,rgba8unorm:16,"rgba8unorm-srgb":17,rgba8uint:18,rgba8sint:19,bgra8unorm:20,"bgra8unorm-srgb":21,rgb10a2uint:22,rgb10a2unorm:23,rg32uint:24,rg32sint:25,rg32float:26,rgba16uint:27,rgba16sint:28,rgba16float:29,rgba32uint:30,rgba32sint:31,rgba32float:32,stencil8:33,depth16unorm:34,depth24plus:35,"depth24plus-stencil8":36,depth32float:37,"depth32float-stencil8":38,r16unorm:39,rg16unorm:40,rgba16unorm:41,r16snorm:42,rg16snorm:43,rgba16snorm:44};class uA{constructor(e,t,i,s){if(this._pipelines={},this._compiledShaders=[],this._videoPipelines={},this._videoCompiledShaders=[],this._deferredReleaseTextures=[],this._engine=e,this._device=t,this._bufferManager=i,s.indexOf("rg11b10ufloat-renderable")!==-1){const r=Object.keys(ks);ks.rg11b10ufloat=ks[r[r.length-1]]+1}this._mipmapSampler=t.createSampler({minFilter:"linear"}),this._videoSampler=t.createSampler({minFilter:"linear"}),this._ubCopyWithOfst=this._bufferManager.createBuffer(4*4,Xe.Uniform|Xe.CopyDst,"UBCopyWithOffset").underlyingResource,this._getPipeline("rgba8unorm"),this._getVideoPipeline("rgba8unorm")}_getPipeline(e,t=gs.MipMap,i){const s=t===gs.MipMap?1:t===gs.InvertYPremultiplyAlpha?((i.invertY?1:0)<<1)+((i.premultiplyAlpha?1:0)<<2):t===gs.Clear?8:t===gs.InvertYPremultiplyAlphaWithOfst?((i.invertY?1:0)<<4)+((i.premultiplyAlpha?1:0)<<5):0;this._pipelines[e]||(this._pipelines[e]=[]);let r=this._pipelines[e][s];if(!r){let a="";(t===gs.InvertYPremultiplyAlpha||t===gs.InvertYPremultiplyAlphaWithOfst)&&(i.invertY&&(a+=`#define INVERTY
`),i.premultiplyAlpha&&(a+=`#define PREMULTIPLYALPHA
`));let o=this._compiledShaders[s];if(!o){let h=xg[t].vertex,u=xg[t].fragment;const c={defines:a.split(`
`),indexParameters:null,isFragment:!1,shouldUseHighPrecisionShader:!0,processor:this._engine._getShaderProcessor(1),supportsUniformBuffers:!0,shadersRepository:"",includesShadersStore:{},version:(this._engine.version*100).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._engine._getShaderProcessingContext(1,!0),isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer};ed(c),c.processor.pureMode=!0,Fl(h,c,p=>{h=p},this._engine),c.isFragment=!0,Fl(u,c,p=>{u=p},this._engine);const f=td(h,u,c);c.processor.pureMode=!1;const d=this._device.createShaderModule({label:`BabylonWebGPUDevice${this._engine.uniqueId}_InternalVertexShader_${s}`,code:f.vertexCode}),_=this._device.createShaderModule({label:`BabylonWebGPUDevice${this._engine.uniqueId}_InternalFragmentShader_${s}`,code:f.fragmentCode});o=this._compiledShaders[s]=[d,_]}const l=this._device.createRenderPipeline({label:`BabylonWebGPUDevice${this._engine.uniqueId}_InternalPipeline_${e}_${s}`,layout:"auto",vertex:{module:o[0],entryPoint:"main"},fragment:{module:o[1],entryPoint:"main",targets:[{format:e}]},primitive:{topology:"triangle-strip",stripIndexFormat:"uint16"}});r=this._pipelines[e][s]=[l,l.getBindGroupLayout(0)]}return r}_getVideoPipeline(e,t=oa.DontInvertY){const i=t===oa.InvertY?1:0;this._videoPipelines[e]||(this._videoPipelines[e]=[]);let s=this._videoPipelines[e][i];if(!s){let r=this._videoCompiledShaders[i];if(!r){const o=this._device.createShaderModule({code:oA,label:`BabylonWebGPUDevice${this._engine.uniqueId}_CopyVideoToTexture_VertexShader`}),l=this._device.createShaderModule({code:i===0?lA:hA,label:`BabylonWebGPUDevice${this._engine.uniqueId}_CopyVideoToTexture_FragmentShader_${i===0?"DontInvertY":"InvertY"}`});r=this._videoCompiledShaders[i]=[o,l]}const a=this._device.createRenderPipeline({label:`BabylonWebGPUDevice${this._engine.uniqueId}_InternalVideoPipeline_${e}_${i===0?"DontInvertY":"InvertY"}`,layout:"auto",vertex:{module:r[0],entryPoint:"main"},fragment:{module:r[1],entryPoint:"main",targets:[{format:e}]},primitive:{topology:"triangle-strip",stripIndexFormat:"uint16"}});s=this._videoPipelines[e][i]=[a,a.getBindGroupLayout(0)]}return s}setCommandEncoder(e){this._commandEncoderForCreation=e}copyVideoToTexture(e,t,i,s=!1,r){var _,p;const a=r===void 0,[o,l]=this._getVideoPipeline(i,s?oa.InvertY:oa.DontInvertY);a&&(r=this._device.createCommandEncoder({})),(_=r.pushDebugGroup)==null||_.call(r,`copy video to texture - invertY=${s}`);const h=t._hardwareTexture,u={label:`BabylonWebGPUDevice${this._engine.uniqueId}_copyVideoToTexture_${i}_${s?"InvertY":"DontInvertY"}${t.label?"_"+t.label:""}`,colorAttachments:[{view:h.underlyingResource.createView({format:i,dimension:"2d",mipLevelCount:1,baseArrayLayer:0,baseMipLevel:0,arrayLayerCount:1,aspect:"all"}),loadOp:"load",storeOp:"store"}]},c=r.beginRenderPass(u),f={layout:l,entries:[{binding:0,resource:this._videoSampler},{binding:1,resource:this._device.importExternalTexture({source:e.underlyingResource})}]},d=this._device.createBindGroup(f);c.setPipeline(o),c.setBindGroup(0,d),c.draw(4,1,0,0),c.end(),(p=r.popDebugGroup)==null||p.call(r),a&&(this._device.queue.submit([r.finish()]),r=null)}invertYPreMultiplyAlpha(e,t,i,s,r=!1,a=!1,o=0,l=0,h=1,u=0,c=0,f=0,d=0,_,p){var I,D;const g=f!==0,m=_===void 0,[v,T]=this._getPipeline(s,g?gs.InvertYPremultiplyAlphaWithOfst:gs.InvertYPremultiplyAlpha,{invertY:r,premultiplyAlpha:a});o=Math.max(o,0),m&&(_=this._device.createCommandEncoder({})),(I=_.pushDebugGroup)==null||I.call(_,`internal process texture - invertY=${r} premultiplyAlpha=${a}`);let A;if(We.IsHardwareTexture(e)?(A=e.underlyingResource,r&&!a&&h===1&&o===0||(e=void 0)):(A=e,e=void 0),!A)return;g&&this._bufferManager.setRawData(this._ubCopyWithOfst,0,new Float32Array([u,c,f,d]),0,4*4);const b=e,x=(b==null?void 0:b._copyInvertYTempTexture)??this.createTexture({width:t,height:i,layers:1},!1,!1,!1,!1,!1,s,1,_,21,void 0,"TempTextureForCopyWithInvertY"),E=(b==null?void 0:b._copyInvertYRenderPassDescr)??{label:`BabylonWebGPUDevice${this._engine.uniqueId}_invertYPreMultiplyAlpha_${s}_${r?"InvertY":"DontInvertY"}_${a?"PremultiplyAlpha":"DontPremultiplyAlpha"}`,colorAttachments:[{view:x.createView({format:s,dimension:"2d",baseMipLevel:0,mipLevelCount:1,arrayLayerCount:1,baseArrayLayer:0}),loadOp:"load",storeOp:"store"}]},R=_.beginRenderPass(E);let C=g?b==null?void 0:b._copyInvertYBindGroupWithOfst:b==null?void 0:b._copyInvertYBindGroup;if(!C){const w={layout:T,entries:[{binding:0,resource:A.createView({format:s,dimension:"2d",baseMipLevel:l,mipLevelCount:1,arrayLayerCount:h,baseArrayLayer:o})}]};g&&w.entries.push({binding:1,resource:{buffer:this._ubCopyWithOfst}}),C=this._device.createBindGroup(w)}R.setPipeline(v),R.setBindGroup(0,C),R.draw(4,1,0,0),R.end(),_.copyTextureToTexture({texture:x},{texture:A,mipLevel:l,origin:{x:0,y:0,z:o}},{width:f||t,height:d||i,depthOrArrayLayers:1}),b?(b._copyInvertYTempTexture=x,b._copyInvertYRenderPassDescr=E,g?b._copyInvertYBindGroupWithOfst=C:b._copyInvertYBindGroup=C):this._deferredReleaseTextures.push([x,null]),(D=_.popDebugGroup)==null||D.call(_),m&&(this._device.queue.submit([_.finish()]),_=null)}createTexture(e,t=!1,i=!1,s=!1,r=!1,a=!1,o="rgba8unorm",l=1,h,u=-1,c=0,f){l=We.GetSample(l);const d=e.layers||1,_={width:e.width,height:e.height,depthOrArrayLayers:d},p=ks[o]?16:0,g=We.IsCompressedFormat(o),m=t?We.ComputeNumMipmapLevels(e.width,e.height):1,v=u>=0?u:7;c|=t&&!g?1|p:0,!g&&!a&&(c|=p|2);const T=this._device.createTexture({label:`BabylonWebGPUDevice${this._engine.uniqueId}_Texture${a?"3D":"2D"}_${f?f+"_":""}${_.width}x${_.height}x${_.depthOrArrayLayers}_${t?"wmips":"womips"}_${o}_samples${l}`,size:_,dimension:a?"3d":"2d",format:o,usage:v|c,sampleCount:l,mipLevelCount:m});return We.IsImageBitmap(e)&&(this.updateTexture(e,T,e.width,e.height,d,o,0,0,s,r,0,0),t&&i&&this.generateMipmaps(T,o,m,0,a,h)),T}createCubeTexture(e,t=!1,i=!1,s=!1,r=!1,a="rgba8unorm",o=1,l,h=-1,u=0,c){o=We.GetSample(o);const f=We.IsImageBitmapArray(e)?e[0].width:e.width,d=We.IsImageBitmapArray(e)?e[0].height:e.height,_=ks[a]?16:0,p=We.IsCompressedFormat(a),g=t?We.ComputeNumMipmapLevels(f,d):1,m=h>=0?h:7;u|=t&&!p?1|_:0,p||(u|=_|2);const v=this._device.createTexture({label:`BabylonWebGPUDevice${this._engine.uniqueId}_TextureCube_${c?c+"_":""}${f}x${d}x6_${t?"wmips":"womips"}_${a}_samples${o}`,size:{width:f,height:d,depthOrArrayLayers:6},dimension:"2d",format:a,usage:m|u,sampleCount:o,mipLevelCount:g});return We.IsImageBitmapArray(e)&&(this.updateCubeTextures(e,v,f,d,a,s,r,0,0),t&&i&&this.generateCubeMipmaps(v,a,g,l)),v}generateCubeMipmaps(e,t,i,s){var a,o;const r=s===void 0;r&&(s=this._device.createCommandEncoder({})),(a=s.pushDebugGroup)==null||a.call(s,`create cube mipmaps - ${i} levels`);for(let l=0;l<6;++l)this.generateMipmaps(e,t,i,l,!1,s);(o=s.popDebugGroup)==null||o.call(s),r&&(this._device.queue.submit([s.finish()]),s=null)}generateMipmaps(e,t,i,s=0,r=!1,a){var f,d,_,p;const o=a===void 0,[l,h]=this._getPipeline(t);s=Math.max(s,0),o&&(a=this._device.createCommandEncoder({})),(f=a.pushDebugGroup)==null||f.call(a,`create mipmaps for face #${s} - ${i} levels`);let u;if(We.IsHardwareTexture(e)?(u=e.underlyingResource,e._mipmapGenRenderPassDescr=e._mipmapGenRenderPassDescr||[],e._mipmapGenBindGroup=e._mipmapGenBindGroup||[]):(u=e,e=void 0),!u)return;const c=e;for(let g=1;g<i;++g){const m=((d=c==null?void 0:c._mipmapGenRenderPassDescr[s])==null?void 0:d[g-1])??{label:`BabylonWebGPUDevice${this._engine.uniqueId}_generateMipmaps_${t}_faceIndex${s}_level${g}`,colorAttachments:[{view:u.createView({format:t,dimension:r?"3d":"2d",baseMipLevel:g,mipLevelCount:1,arrayLayerCount:1,baseArrayLayer:s}),loadOp:"load",storeOp:"store"}]};c&&(c._mipmapGenRenderPassDescr[s]=c._mipmapGenRenderPassDescr[s]||[],c._mipmapGenRenderPassDescr[s][g-1]=m);const v=a.beginRenderPass(m),T=((_=c==null?void 0:c._mipmapGenBindGroup[s])==null?void 0:_[g-1])??this._device.createBindGroup({layout:h,entries:[{binding:0,resource:u.createView({format:t,dimension:r?"3d":"2d",baseMipLevel:g-1,mipLevelCount:1,arrayLayerCount:1,baseArrayLayer:s})},{binding:1,resource:this._mipmapSampler}]});c&&(c._mipmapGenBindGroup[s]=c._mipmapGenBindGroup[s]||[],c._mipmapGenBindGroup[s][g-1]=T),v.setPipeline(l),v.setBindGroup(0,T),v.draw(4,1,0,0),v.end()}(p=a.popDebugGroup)==null||p.call(a),o&&(this._device.queue.submit([a.finish()]),a=null)}createGPUTextureForInternalTexture(e,t,i,s,r,a){e._hardwareTexture||(e._hardwareTexture=new nl(this._engine)),t===void 0&&(t=e.width),i===void 0&&(i=e.height),s===void 0&&(s=e.depth);const o=e._hardwareTexture,l=((r??0)&1)!==0;o.format=We.GetWebGPUTextureFormat(e.type,e.format,e._useSRGBBuffer),o.textureUsages=e._source===5||e.source===6?21:e._source===12?20:-1,o.textureAdditionalUsages=l?8:0;const h=e.generateMipMaps,u=s||1;let c;if(e._maxLodLevel!==null?c=e._maxLodLevel:c=h?We.ComputeNumMipmapLevels(t,i):1,e.isCube){const f=this.createCubeTexture({width:t,height:i},e.generateMipMaps,e.generateMipMaps,e.invertY,!1,o.format,1,this._commandEncoderForCreation,o.textureUsages,o.textureAdditionalUsages,e.label);o.set(f);const d=e.is3D?1:u,_=We.GetDepthFormatOnly(o.format),p=We.HasDepthAndStencilAspects(o.format)?"depth-only":"all",g=e.is2DArray?"cube-array":"cube";o.createView({label:`BabylonWebGPUDevice${this._engine.uniqueId}_TextureViewCube${e.is2DArray?"_Array"+d:""}_${t}x${i}_${h?"wmips":"womips"}_${_}_${g}_${p}_${e.label??"noname"}`,format:_,dimension:g,mipLevelCount:c,baseArrayLayer:0,baseMipLevel:0,arrayLayerCount:6,aspect:p},l)}else{const f=this.createTexture({width:t,height:i,layers:u},e.generateMipMaps,e.generateMipMaps,e.invertY,!1,e.is3D,o.format,1,this._commandEncoderForCreation,o.textureUsages,o.textureAdditionalUsages,e.label);o.set(f);const d=e.is3D?1:u,_=We.GetDepthFormatOnly(o.format),p=We.HasDepthAndStencilAspects(o.format)?"depth-only":"all",g=e.is2DArray?"2d-array":e.is3D?"3d":"2d";o.createView({label:`BabylonWebGPUDevice${this._engine.uniqueId}_TextureView${e.is3D?"3D":"2D"}${e.is2DArray?"_Array"+d:""}_${t}x${i}${e.is3D?"x"+u:""}_${h?"wmips":"womips"}_${_}_${g}_${p}_${e.label??"noname"}`,format:_,dimension:g,mipLevelCount:c,baseArrayLayer:0,baseMipLevel:0,arrayLayerCount:d,aspect:p},l)}return e.width=e.baseWidth=t,e.height=e.baseHeight=i,e.depth=e.baseDepth=s,a||this.createMSAATexture(e,e.samples),o}createMSAATexture(e,t,i=!0,s=0){const r=e._hardwareTexture;if(i&&(r==null||r.releaseMSAATexture()),!r||(t??1)<=1)return;const a=e.width,o=e.height,l=this.createTexture({width:a,height:o,layers:1},!1,!1,!1,!1,!1,r.format,t,this._commandEncoderForCreation,16,0,e.label?"MSAA_"+e.label:"MSAA");r.setMSAATexture(l,s)}updateCubeTextures(e,t,i,s,r,a=!1,o=!1,l=0,h=0){const u=[0,3,1,4,2,5];for(let c=0;c<u.length;++c){const f=e[u[c]];this.updateTexture(f,t,i,s,1,r,c,0,a,o,l,h)}}updateTexture(e,t,i,s,r,a,o=0,l=0,h=!1,u=!1,c=0,f=0,d){const _=We.IsInternalTexture(t)?t._hardwareTexture.underlyingResource:t,p=We.GetBlockInformationFromFormat(a),g=We.IsInternalTexture(t)?t._hardwareTexture:t,m={texture:_,origin:{x:c,y:f,z:Math.max(o,0)},mipLevel:l,premultipliedAlpha:u},v={width:Math.ceil(i/p.width)*p.width,height:Math.ceil(s/p.height)*p.height,depthOrArrayLayers:r||1};if(e.byteLength!==void 0){e=e;const T=Math.ceil(i/p.width)*p.length;if(Math.ceil(T/256)*256===T){const b=this._device.createCommandEncoder({}),x=this._bufferManager.createRawBuffer(e.byteLength,Xe.MapWrite|Xe.CopySrc,!0,"TempBufferForUpdateTexture"+(_?"_"+_.label:"")),E=x.getMappedRange();new Uint8Array(E).set(e),x.unmap(),b.copyBufferToTexture({buffer:x,offset:0,bytesPerRow:T,rowsPerImage:s},m,v),this._device.queue.submit([b.finish()]),this._bufferManager.releaseBuffer(x)}else this._device.queue.writeTexture(m,e,{offset:0,bytesPerRow:T,rowsPerImage:s},v);if(h||u)if(We.IsInternalTexture(t)){const b=c===0&&f===0&&i===t.width&&s===t.height;this.invertYPreMultiplyAlpha(g,t.width,t.height,a,h,u,o,l,r||1,c,f,b?0:i,b?0:s,void 0,d)}else throw"updateTexture: Can't process the texture data because a GPUTexture was provided instead of an InternalTexture!"}else e=e,this._device.queue.copyExternalImageToTexture({source:e,flipY:h},m,v)}readPixels(e,t,i,s,r,a,o=0,l=0,h=null,u=!1){const c=We.GetBlockInformationFromFormat(a),f=Math.ceil(s/c.width)*c.length,d=Math.ceil(f/256)*256,_=d*r,p=this._bufferManager.createRawBuffer(_,Xe.MapRead|Xe.CopyDst,void 0,"TempBufferForReadPixels"+(e.label?"_"+e.label:"")),g=this._device.createCommandEncoder({});return g.copyTextureToBuffer({texture:e,mipLevel:l,origin:{x:t,y:i,z:Math.max(o,0)}},{buffer:p,offset:0,bytesPerRow:d},{width:s,height:r,depthOrArrayLayers:1}),this._device.queue.submit([g.finish()]),this._bufferManager.readDataFromBuffer(p,_,s,r,f,d,We.GetTextureTypeFromFormat(a),0,h,!0,u)}releaseTexture(e){if(We.IsInternalTexture(e)){const t=e._hardwareTexture,i=e._irradianceTexture;this._deferredReleaseTextures.push([t,i])}else this._deferredReleaseTextures.push([e,null])}destroyDeferredTextures(){for(let e=0;e<this._deferredReleaseTextures.length;++e){const[t,i]=this._deferredReleaseTextures[e];t&&(We.IsHardwareTexture(t)?t.release():t.destroy()),i==null||i.dispose()}this._deferredReleaseTextures.length=0}}class cA extends ka{set buffer(e){this._buffer=e}constructor(e,t=0){super(),this.engineId=-1,this.capacity=t,e&&(this._buffer=e)}get underlyingResource(){return this._buffer}}function Fv(n,e,t=!1){const i=e.width,s=e.height;if(n instanceof Float32Array){let h=n.byteLength/n.BYTES_PER_ELEMENT;const u=new Uint8Array(h);for(;--h>=0;){let c=n[h];c<0?c=0:c>1&&(c=1),u[h]=c*255}n=u}const r=document.createElement("canvas");r.width=i,r.height=s;const a=r.getContext("2d");if(!a)return null;const o=a.createImageData(i,s);if(o.data.set(n),a.putImageData(o,0,0),t){const h=document.createElement("canvas");h.width=i,h.height=s;const u=h.getContext("2d");return u?(u.translate(0,s),u.scale(1,-1),u.drawImage(r,0,0),h.toDataURL("image/png")):null}return r.toDataURL("image/png")}function fA(n,e=0,t=0){const i=n.getInternalTexture();if(!i)return null;const s=n._readPixelsSync(e,t);return s?Fv(s,n.getSize(),i.invertY):null}async function dA(n,e=0,t=0){const i=n.getInternalTexture();if(!i)return null;const s=await n.readPixels(e,t);return s?Fv(s,n.getSize(),i.invertY):null}class ie extends ot{static _CreateVideoTexture(e,t,i,s=!1,r=!1,a=ie.TRILINEAR_SAMPLINGMODE,o={},l,h=5){throw Ee("VideoTexture")}get noMipmap(){return this._noMipmap}get mimeType(){return this._mimeType}set isBlocking(e){this._isBlocking=e}get isBlocking(){return this._isBlocking}get invertY(){return this._invertY}constructor(e,t,i,s,r=ie.TRILINEAR_SAMPLINGMODE,a=null,o=null,l=null,h=!1,u,c,f,d,_){super(t),this.url=null,this.uOffset=0,this.vOffset=0,this.uScale=1,this.vScale=1,this.uAng=0,this.vAng=0,this.wAng=0,this.uRotationCenter=.5,this.vRotationCenter=.5,this.wRotationCenter=.5,this.homogeneousRotationInUVTransform=!1,this.inspectableCustomProperties=null,this._noMipmap=!1,this._invertY=!1,this._rowGenerationMatrix=null,this._cachedTextureMatrix=null,this._projectionModeMatrix=null,this._t0=null,this._t1=null,this._t2=null,this._cachedUOffset=-1,this._cachedVOffset=-1,this._cachedUScale=0,this._cachedVScale=0,this._cachedUAng=-1,this._cachedVAng=-1,this._cachedWAng=-1,this._cachedReflectionProjectionMatrixId=-1,this._cachedURotationCenter=-1,this._cachedVRotationCenter=-1,this._cachedWRotationCenter=-1,this._cachedHomogeneousRotationInUVTransform=!1,this._cachedIdentity3x2=!0,this._cachedReflectionTextureMatrix=null,this._cachedReflectionUOffset=-1,this._cachedReflectionVOffset=-1,this._cachedReflectionUScale=0,this._cachedReflectionVScale=0,this._cachedReflectionCoordinatesMode=-1,this._buffer=null,this._deleteBuffer=!1,this._format=null,this._delayedOnLoad=null,this._delayedOnError=null,this.onLoadObservable=new q,this._isBlocking=!0,this.name=e||"",this.url=e;let p,g=!1,m=null,v=!0;typeof i=="object"&&i!==null?(p=i.noMipmap??!1,s=i.invertY??!0,r=i.samplingMode??ie.TRILINEAR_SAMPLINGMODE,a=i.onLoad??null,o=i.onError??null,l=i.buffer??null,h=i.deleteBuffer??!1,u=i.format,c=i.mimeType,f=i.loaderOptions,d=i.creationFlags,g=i.useSRGBBuffer??!1,m=i.internalTexture??null,v=i.gammaSpace??v,_=i.forcedExtension??_):p=!!i,this._gammaSpace=v,this._noMipmap=p,this._invertY=s===void 0?!0:s,this._initialSamplingMode=r,this._buffer=l,this._deleteBuffer=h,this._mimeType=c,this._loaderOptions=f,this._creationFlags=d,this._useSRGBBuffer=g,this._forcedExtension=_,u&&(this._format=u);const T=this.getScene(),A=this._getEngine();if(!A)return;A.onBeforeTextureInitObservable.notifyObservers(this);const b=()=>{this._texture&&(this._texture._invertVScale&&(this.vScale*=-1,this.vOffset+=1),this._texture._cachedWrapU!==null&&(this.wrapU=this._texture._cachedWrapU,this._texture._cachedWrapU=null),this._texture._cachedWrapV!==null&&(this.wrapV=this._texture._cachedWrapV,this._texture._cachedWrapV=null),this._texture._cachedWrapR!==null&&(this.wrapR=this._texture._cachedWrapR,this._texture._cachedWrapR=null)),this.onLoadObservable.hasObservers()&&this.onLoadObservable.notifyObservers(this),a&&a(),!this.isBlocking&&T&&T.resetCachedMaterial()},x=(E,R)=>{this._loadingError=!0,this._errorObject={message:E,exception:R},o&&o(E,R),ie.OnTextureLoadErrorObservable.notifyObservers(this)};if(!this.url&&!m){this._delayedOnLoad=b,this._delayedOnError=x;return}if(this._texture=m??this._getFromCache(this.url,p,r,this._invertY,g,this.isCube),this._texture)if(this._texture.isReady)Wo.SetImmediate(()=>b());else{const E=this._texture.onLoadedObservable.add(b);this._texture.onErrorObservable.add(R=>{var C;x(R.message,R.exception),(C=this._texture)==null||C.onLoadedObservable.remove(E)})}else if(!T||!T.useDelayedTextureLoading){try{this._texture=A.createTexture(this.url,p,this._invertY,T,r,b,x,this._buffer,void 0,this._format,this._forcedExtension,c,f,d,g)}catch(E){throw x("error loading",E),E}h&&(this._buffer=null)}else this.delayLoadState=4,this._delayedOnLoad=b,this._delayedOnError=x}updateURL(e,t=null,i,s){this.url&&(this.releaseInternalTexture(),this.getScene().markAllMaterialsAsDirty(1,r=>r.hasTexture(this))),(!this.name||this.name.startsWith("data:"))&&(this.name=e),this.url=e,this._buffer=t,this._forcedExtension=s,this.delayLoadState=4,i&&(this._delayedOnLoad=i),this.delayLoad()}delayLoad(){if(this.delayLoadState!==4)return;const e=this.getScene();e&&(this.delayLoadState=1,this._texture=this._getFromCache(this.url,this._noMipmap,this.samplingMode,this._invertY,this._useSRGBBuffer,this.isCube),this._texture?this._delayedOnLoad&&(this._texture.isReady?Wo.SetImmediate(this._delayedOnLoad):this._texture.onLoadedObservable.add(this._delayedOnLoad)):(this._texture=e.getEngine().createTexture(this.url,this._noMipmap,this._invertY,e,this.samplingMode,this._delayedOnLoad,this._delayedOnError,this._buffer,null,this._format,this._forcedExtension,this._mimeType,this._loaderOptions,this._creationFlags,this._useSRGBBuffer),this._deleteBuffer&&(this._buffer=null)),this._delayedOnLoad=null,this._delayedOnError=null)}_prepareRowForTextureGeneration(e,t,i,s){e*=this._cachedUScale,t*=this._cachedVScale,e-=this.uRotationCenter*this._cachedUScale,t-=this.vRotationCenter*this._cachedVScale,i-=this.wRotationCenter,y.TransformCoordinatesFromFloatsToRef(e,t,i,this._rowGenerationMatrix,s),s.x+=this.uRotationCenter*this._cachedUScale+this._cachedUOffset,s.y+=this.vRotationCenter*this._cachedVScale+this._cachedVOffset,s.z+=this.wRotationCenter}getTextureMatrix(e=1){if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale*e===this._cachedUScale&&this.vScale===this._cachedVScale&&this.uAng===this._cachedUAng&&this.vAng===this._cachedVAng&&this.wAng===this._cachedWAng&&this.uRotationCenter===this._cachedURotationCenter&&this.vRotationCenter===this._cachedVRotationCenter&&this.wRotationCenter===this._cachedWRotationCenter&&this.homogeneousRotationInUVTransform===this._cachedHomogeneousRotationInUVTransform)return this._cachedTextureMatrix;this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale*e,this._cachedVScale=this.vScale,this._cachedUAng=this.uAng,this._cachedVAng=this.vAng,this._cachedWAng=this.wAng,this._cachedURotationCenter=this.uRotationCenter,this._cachedVRotationCenter=this.vRotationCenter,this._cachedWRotationCenter=this.wRotationCenter,this._cachedHomogeneousRotationInUVTransform=this.homogeneousRotationInUVTransform,(!this._cachedTextureMatrix||!this._rowGenerationMatrix)&&(this._cachedTextureMatrix=L.Zero(),this._rowGenerationMatrix=new L,this._t0=y.Zero(),this._t1=y.Zero(),this._t2=y.Zero()),L.RotationYawPitchRollToRef(this.vAng,this.uAng,this.wAng,this._rowGenerationMatrix),this.homogeneousRotationInUVTransform?(L.TranslationToRef(-this._cachedURotationCenter,-this._cachedVRotationCenter,-this._cachedWRotationCenter,N.Matrix[0]),L.TranslationToRef(this._cachedURotationCenter,this._cachedVRotationCenter,this._cachedWRotationCenter,N.Matrix[1]),L.ScalingToRef(this._cachedUScale,this._cachedVScale,0,N.Matrix[2]),L.TranslationToRef(this._cachedUOffset,this._cachedVOffset,0,N.Matrix[3]),N.Matrix[0].multiplyToRef(this._rowGenerationMatrix,this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(N.Matrix[1],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(N.Matrix[2],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(N.Matrix[3],this._cachedTextureMatrix),this._cachedTextureMatrix.setRowFromFloats(2,this._cachedTextureMatrix.m[12],this._cachedTextureMatrix.m[13],this._cachedTextureMatrix.m[14],1)):(this._prepareRowForTextureGeneration(0,0,0,this._t0),this._prepareRowForTextureGeneration(1,0,0,this._t1),this._prepareRowForTextureGeneration(0,1,0,this._t2),this._t1.subtractInPlace(this._t0),this._t2.subtractInPlace(this._t0),L.FromValuesToRef(this._t1.x,this._t1.y,this._t1.z,0,this._t2.x,this._t2.y,this._t2.z,0,this._t0.x,this._t0.y,this._t0.z,0,0,0,0,1,this._cachedTextureMatrix));const t=this.getScene();if(!t)return this._cachedTextureMatrix;const i=this._cachedIdentity3x2;return this._cachedIdentity3x2=this._cachedTextureMatrix.isIdentityAs3x2(),this.optimizeUVAllocation&&i!==this._cachedIdentity3x2&&t.markAllMaterialsAsDirty(1,s=>s.hasTexture(this)),this._cachedTextureMatrix}getReflectionTextureMatrix(){const e=this.getScene();if(!e)return this._cachedReflectionTextureMatrix;if(this.uOffset===this._cachedReflectionUOffset&&this.vOffset===this._cachedReflectionVOffset&&this.uScale===this._cachedReflectionUScale&&this.vScale===this._cachedReflectionVScale&&this.coordinatesMode===this._cachedReflectionCoordinatesMode)if(this.coordinatesMode===ie.PROJECTION_MODE){if(this._cachedReflectionProjectionMatrixId===e.getProjectionMatrix().updateFlag)return this._cachedReflectionTextureMatrix}else return this._cachedReflectionTextureMatrix;this._cachedReflectionTextureMatrix||(this._cachedReflectionTextureMatrix=L.Zero()),this._projectionModeMatrix||(this._projectionModeMatrix=L.Zero());const t=this._cachedReflectionCoordinatesMode!==this.coordinatesMode;switch(this._cachedReflectionUOffset=this.uOffset,this._cachedReflectionVOffset=this.vOffset,this._cachedReflectionUScale=this.uScale,this._cachedReflectionVScale=this.vScale,this._cachedReflectionCoordinatesMode=this.coordinatesMode,this.coordinatesMode){case ie.PLANAR_MODE:{L.IdentityToRef(this._cachedReflectionTextureMatrix),this._cachedReflectionTextureMatrix[0]=this.uScale,this._cachedReflectionTextureMatrix[5]=this.vScale,this._cachedReflectionTextureMatrix[12]=this.uOffset,this._cachedReflectionTextureMatrix[13]=this.vOffset;break}case ie.PROJECTION_MODE:{L.FromValuesToRef(.5,0,0,0,0,-.5,0,0,0,0,0,0,.5,.5,1,1,this._projectionModeMatrix);const i=e.getProjectionMatrix();this._cachedReflectionProjectionMatrixId=i.updateFlag,i.multiplyToRef(this._projectionModeMatrix,this._cachedReflectionTextureMatrix);break}default:L.IdentityToRef(this._cachedReflectionTextureMatrix);break}return t&&e.markAllMaterialsAsDirty(1,i=>i.hasTexture(this)),this._cachedReflectionTextureMatrix}clone(){const e={noMipmap:this._noMipmap,invertY:this._invertY,samplingMode:this.samplingMode,onLoad:void 0,onError:void 0,buffer:this._texture?this._texture._buffer:void 0,deleteBuffer:this._deleteBuffer,format:this.textureFormat,mimeType:this.mimeType,loaderOptions:this._loaderOptions,creationFlags:this._creationFlags,useSRGBBuffer:this._useSRGBBuffer};return Ie.Clone(()=>new ie(this._texture?this._texture.url:null,this.getScene(),e),this)}serialize(){var i,s;const e=this.name;ie.SerializeBuffers||this.name.startsWith("data:")&&(this.name=""),this.name.startsWith("data:")&&this.url===this.name&&(this.url="");const t=super.serialize(ie._SerializeInternalTextureUniqueId);return t?((ie.SerializeBuffers||ie.ForceSerializeBuffers)&&(typeof this._buffer=="string"&&this._buffer.substring(0,5)==="data:"?(t.base64String=this._buffer,t.name=t.name.replace("data:","")):this.url&&this.url.startsWith("data:")&&this._buffer instanceof Uint8Array?t.base64String="data:image/png;base64,"+yv(this._buffer):(ie.ForceSerializeBuffers||this.url&&this.url.startsWith("blob:")||this._forceSerialize)&&(t.base64String=!this._engine||this._engine._features.supportSyncTextureRead?fA(this):dA(this))),t.invertY=this._invertY,t.samplingMode=this.samplingMode,t._creationFlags=this._creationFlags,t._useSRGBBuffer=this._useSRGBBuffer,ie._SerializeInternalTextureUniqueId&&(t.internalTextureUniqueId=(i=this._texture)==null?void 0:i.uniqueId),t.internalTextureLabel=(s=this._texture)==null?void 0:s.label,t.noMipmap=this._noMipmap,this.name=e,t):null}getClassName(){return"Texture"}dispose(){super.dispose(),this.onLoadObservable.clear(),this._delayedOnLoad=null,this._delayedOnError=null,this._buffer=null}static Parse(e,t,i){if(e.customType){const h=bo.Instantiate(e.customType).Parse(e,t,i);return e.samplingMode&&h.updateSamplingMode&&h._samplingMode&&h._samplingMode!==e.samplingMode&&h.updateSamplingMode(e.samplingMode),h}if(e.isCube&&!e.isRenderTarget)return ie._CubeTextureParser(e,t,i);const s=e.internalTextureUniqueId!==void 0;if(!e.name&&!e.isRenderTarget&&!s)return null;let r;if(s){const l=t.getEngine().getLoadedTexturesCache();for(const h of l)if(h.uniqueId===e.internalTextureUniqueId){r=h;break}}const a=l=>{if(l&&l._texture&&(l._texture._cachedWrapU=null,l._texture._cachedWrapV=null,l._texture._cachedWrapR=null),e.samplingMode){const h=e.samplingMode;l&&l.samplingMode!==h&&l.updateSamplingMode(h)}if(l&&e.animations)for(let h=0;h<e.animations.length;h++){const u=e.animations[h],c=Zn("BABYLON.Animation");c&&l.animations.push(c.Parse(u))}l&&l._texture&&(s&&!r&&l._texture._setUniqueId(e.internalTextureUniqueId),l._texture.label=e.internalTextureLabel)};return Ie.Parse(()=>{let l=!0;if(e.noMipmap&&(l=!1),e.mirrorPlane){const h=ie._CreateMirror(e.name,e.renderTargetSize,t,l);return h._waitingRenderList=e.renderList,h.mirrorPlane=_i.FromArray(e.mirrorPlane),a(h),h}else if(e.isRenderTarget){let h=null;if(e.isCube){if(t.reflectionProbes)for(let u=0;u<t.reflectionProbes.length;u++){const c=t.reflectionProbes[u];if(c.name===e.name)return c.cubeTexture}}else h=ie._CreateRenderTargetTexture(e.name,e.renderTargetSize,t,l,e._creationFlags??0),h._waitingRenderList=e.renderList;return a(h),h}else if(e.isVideo){const h=ie._CreateVideoTexture(i+(e.url||e.name),i+(e.src||e.url),t,l,e.invertY,e.samplingMode,e.settings||{});return a(h),h}else{let h;if(e.base64String&&!r)h=ie.CreateFromBase64String(e.base64String,e.base64String,t,!l,e.invertY,e.samplingMode,()=>{a(h)},e._creationFlags??0,e._useSRGBBuffer??!1),h.name=e.name;else{let u;e.name&&(e.name.indexOf("://")>0||e.name.startsWith("data:"))?u=e.name:u=i+e.name,e.url&&(e.url.startsWith("data:")||ie.UseSerializedUrlIfAny)&&(u=e.url);const c={noMipmap:!l,invertY:e.invertY,samplingMode:e.samplingMode,onLoad:()=>{a(h)},internalTexture:r};h=new ie(u,t,c)}return h}},e,t)}static CreateFromBase64String(e,t,i,s,r,a=ie.TRILINEAR_SAMPLINGMODE,o=null,l=null,h=5,u,c){return new ie("data:"+t,i,s,r,a,o,l,e,!1,h,void 0,void 0,u,c)}static LoadFromDataString(e,t,i,s=!1,r,a=!0,o=ie.TRILINEAR_SAMPLINGMODE,l=null,h=null,u=5,c,f){return e.substring(0,5)!=="data:"&&(e="data:"+e),new ie(e,i,r,a,o,l,h,t,s,u,void 0,void 0,c,f)}}ie.SerializeBuffers=!0;ie.ForceSerializeBuffers=!1;ie.OnTextureLoadErrorObservable=new q;ie._SerializeInternalTextureUniqueId=!1;ie._CubeTextureParser=(n,e,t)=>{throw Ee("CubeTexture")};ie._CreateMirror=(n,e,t,i)=>{throw Ee("MirrorTexture")};ie._CreateRenderTargetTexture=(n,e,t,i,s)=>{throw Ee("RenderTargetTexture")};ie.NEAREST_SAMPLINGMODE=1;ie.NEAREST_NEAREST_MIPLINEAR=8;ie.BILINEAR_SAMPLINGMODE=2;ie.LINEAR_LINEAR_MIPNEAREST=11;ie.TRILINEAR_SAMPLINGMODE=3;ie.LINEAR_LINEAR_MIPLINEAR=3;ie.NEAREST_NEAREST_MIPNEAREST=4;ie.NEAREST_LINEAR_MIPNEAREST=5;ie.NEAREST_LINEAR_MIPLINEAR=6;ie.NEAREST_LINEAR=7;ie.NEAREST_NEAREST=1;ie.LINEAR_NEAREST_MIPNEAREST=9;ie.LINEAR_NEAREST_MIPLINEAR=10;ie.LINEAR_LINEAR=2;ie.LINEAR_NEAREST=12;ie.EXPLICIT_MODE=0;ie.SPHERICAL_MODE=1;ie.PLANAR_MODE=2;ie.CUBIC_MODE=3;ie.PROJECTION_MODE=4;ie.SKYBOX_MODE=5;ie.INVCUBIC_MODE=6;ie.EQUIRECTANGULAR_MODE=7;ie.FIXED_EQUIRECTANGULAR_MODE=8;ie.FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9;ie.CLAMP_ADDRESSMODE=0;ie.WRAP_ADDRESSMODE=1;ie.MIRROR_ADDRESSMODE=2;ie.UseSerializedUrlIfAny=!1;P([B()],ie.prototype,"url",void 0);P([B()],ie.prototype,"uOffset",void 0);P([B()],ie.prototype,"vOffset",void 0);P([B()],ie.prototype,"uScale",void 0);P([B()],ie.prototype,"vScale",void 0);P([B()],ie.prototype,"uAng",void 0);P([B()],ie.prototype,"vAng",void 0);P([B()],ie.prototype,"wAng",void 0);P([B()],ie.prototype,"uRotationCenter",void 0);P([B()],ie.prototype,"vRotationCenter",void 0);P([B()],ie.prototype,"wRotationCenter",void 0);P([B()],ie.prototype,"homogeneousRotationInUVTransform",void 0);P([B()],ie.prototype,"isBlocking",null);Tt("BABYLON.Texture",ie);Ie._TextureParser=ie.Parse;class Fc{constructor(e){this._vertexBuffers={},this.onBeforeRenderObservable=new q,this._scene=e}_prepareBuffers(){if(this._vertexBuffers[S.PositionKind])return;const e=[];e.push(1,1),e.push(-1,1),e.push(-1,-1),e.push(1,-1),this._vertexBuffers[S.PositionKind]=new S(this._scene.getEngine(),e,S.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const e=[];e.push(0),e.push(1),e.push(2),e.push(0),e.push(2),e.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(e)}_rebuild(){const e=this._vertexBuffers[S.PositionKind];e&&(e._rebuild(),this._buildIndexBuffer())}_prepareFrame(e=null,t=null){const i=this._scene.activeCamera;return!i||(t=t||i._postProcesses.filter(s=>s!=null),!t||t.length===0||!this._scene.postProcessesEnabled)?!1:(t[0].activate(i,e,t!=null),!0)}directRender(e,t=null,i=!1,s=0,r=0,a=!1){var l;const o=this._scene.getEngine();for(let h=0;h<e.length;h++){h<e.length-1?e[h+1].activate(this._scene.activeCamera||this._scene,t==null?void 0:t.texture):(t?o.bindFramebuffer(t,s,void 0,void 0,i,r):a||o.restoreDefaultFramebuffer(),(l=o._debugInsertMarker)==null||l.call(o,`post process ${e[h].name} output`));const u=e[h],c=u.apply();c&&(u.onBeforeRenderObservable.notifyObservers(c),this._prepareBuffers(),o.bindBuffers(this._vertexBuffers,this._indexBuffer,c),o.drawElementsType(0,0,6),u.onAfterRenderObservable.notifyObservers(c))}o.setDepthBuffer(!0),o.setDepthWrite(!0)}_finalizeFrame(e,t,i,s,r=!1){var l;const a=this._scene.activeCamera;if(!a||(this.onBeforeRenderObservable.notifyObservers(this),s=s||a._postProcesses.filter(h=>h!=null),s.length===0||!this._scene.postProcessesEnabled))return;const o=this._scene.getEngine();for(let h=0,u=s.length;h<u;h++){const c=s[h];if(h<u-1?c._outputTexture=s[h+1].activate(a,t==null?void 0:t.texture):(t?(o.bindFramebuffer(t,i,void 0,void 0,r),c._outputTexture=t):(o.restoreDefaultFramebuffer(),c._outputTexture=null),(l=o._debugInsertMarker)==null||l.call(o,`post process ${s[h].name} output`)),e)break;const f=c.apply();f&&(c.onBeforeRenderObservable.notifyObservers(f),this._prepareBuffers(),o.bindBuffers(this._vertexBuffers,this._indexBuffer,f),o.drawElementsType(0,0,6),c.onAfterRenderObservable.notifyObservers(f))}o.setDepthBuffer(!0),o.setDepthWrite(!0),o.setAlphaMode(0)}dispose(){const e=this._vertexBuffers[S.PositionKind];e&&(e.dispose(),this._vertexBuffers[S.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}class ti{constructor(e){this.length=0,this.data=new Array(e),this._id=ti._GlobalId++}push(e){this.data[this.length++]=e,this.length>this.data.length&&(this.data.length*=2)}forEach(e){for(let t=0;t<this.length;t++)e(this.data[t])}sort(e){this.data.sort(e)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(e){if(e.length!==0){this.length+e.length>this.data.length&&(this.data.length=(this.length+e.length)*2);for(let t=0;t<e.length;t++)this.data[this.length++]=(e.data||e)[t]}}indexOf(e){const t=this.data.indexOf(e);return t>=this.length?-1:t}contains(e){return this.indexOf(e)!==-1}}ti._GlobalId=0;class cr extends ti{constructor(){super(...arguments),this._duplicateId=0}push(e){super.push(e),e.__smartArrayFlags||(e.__smartArrayFlags={}),e.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(e){return e.__smartArrayFlags&&e.__smartArrayFlags[this._id]===this._duplicateId?!1:(this.push(e),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(e){if(e.length!==0){this.length+e.length>this.data.length&&(this.data.length=(this.length+e.length)*2);for(let t=0;t<e.length;t++){const i=(e.data||e)[t];this.pushNoDuplicate(i)}}}}class vs{set opaqueSortCompareFn(e){e?this._opaqueSortCompareFn=e:this._opaqueSortCompareFn=vs.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(e){e?this._alphaTestSortCompareFn=e:this._alphaTestSortCompareFn=vs.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(e){e?this._transparentSortCompareFn=e:this._transparentSortCompareFn=vs.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(e,t,i=null,s=null,r=null){this.index=e,this._opaqueSubMeshes=new ti(256),this._transparentSubMeshes=new ti(256),this._alphaTestSubMeshes=new ti(256),this._depthOnlySubMeshes=new ti(256),this._particleSystems=new ti(256),this._spriteManagers=new ti(256),this._empty=!0,this._edgesRenderers=new cr(16),this._scene=t,this.opaqueSortCompareFn=i,this.alphaTestSortCompareFn=s,this.transparentSortCompareFn=r}render(e,t,i,s){if(e){e(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);return}const r=this._scene.getEngine();this._depthOnlySubMeshes.length!==0&&(r.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),r.setColorWrite(!0)),this._opaqueSubMeshes.length!==0&&this._renderOpaque(this._opaqueSubMeshes),this._alphaTestSubMeshes.length!==0&&this._renderAlphaTest(this._alphaTestSubMeshes);const a=r.getStencilBuffer();if(r.setStencilBuffer(!1),t&&this._renderSprites(),i&&this._renderParticles(s),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),this._transparentSubMeshes.length!==0||this._scene.useOrderIndependentTransparency){if(r.setStencilBuffer(a),this._scene.useOrderIndependentTransparency){const o=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);o.length&&this._renderTransparent(o)}else this._renderTransparent(this._transparentSubMeshes);r.setAlphaMode(0)}if(r.setStencilBuffer(!1),this._edgesRenderers.length){for(let o=0;o<this._edgesRenderers.length;o++)this._edgesRenderers.data[o].render();r.setAlphaMode(0)}r.setStencilBuffer(a)}_renderOpaqueSorted(e){vs._RenderSorted(e,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(e){vs._RenderSorted(e,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(e){vs._RenderSorted(e,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(e,t,i,s){let r=0,a;const o=i?i.globalPosition:vs._ZeroVector;if(s)for(;r<e.length;r++)a=e.data[r],a._alphaIndex=a.getMesh().alphaIndex,a._distanceToCamera=y.Distance(a.getBoundingInfo().boundingSphere.centerWorld,o);const l=e.length===e.data.length?e.data:e.data.slice(0,e.length);t&&l.sort(t);const h=l[0].getMesh().getScene();for(r=0;r<l.length;r++)if(a=l[r],!(h._activeMeshesFrozenButKeepClipping&&!a.isInFrustum(h._frustumPlanes))){if(s){const u=a.getMaterial();if(u&&u.needDepthPrePass){const c=u.getScene().getEngine();c.setColorWrite(!1),c.setAlphaMode(0),a.render(!1),c.setColorWrite(!0)}}a.render(s)}}static defaultTransparentSortCompare(e,t){return e._alphaIndex>t._alphaIndex?1:e._alphaIndex<t._alphaIndex?-1:vs.backToFrontSortCompare(e,t)}static backToFrontSortCompare(e,t){return e._distanceToCamera<t._distanceToCamera?1:e._distanceToCamera>t._distanceToCamera?-1:0}static frontToBackSortCompare(e,t){return e._distanceToCamera<t._distanceToCamera?-1:e._distanceToCamera>t._distanceToCamera?1:0}static PainterSortCompare(e,t){const i=e.getMesh(),s=t.getMesh();return i.material&&s.material?i.material.uniqueId-s.material.uniqueId:i.uniqueId-s.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(e,t,i){t===void 0&&(t=e.getMesh()),i===void 0&&(i=e.getMaterial()),i!=null&&(i.needAlphaBlendingForMesh(t)?this._transparentSubMeshes.push(e):i.needAlphaTestingForMesh(t)?(i.needDepthPrePass&&this._depthOnlySubMeshes.push(e),this._alphaTestSubMeshes.push(e)):(i.needDepthPrePass&&this._depthOnlySubMeshes.push(e),this._opaqueSubMeshes.push(e)),t._renderingGroup=this,t._edgesRenderer&&t.isEnabled()&&t.isVisible&&t._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(t._edgesRenderer),this._empty=!1)}dispatchSprites(e){this._spriteManagers.push(e),this._empty=!1}dispatchParticles(e){this._particleSystems.push(e),this._empty=!1}_renderParticles(e){if(this._particleSystems.length===0)return;const t=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let i=0;i<this._particleSystems.length;i++){const s=this._particleSystems.data[i];if((t&&t.layerMask&s.layerMask)===0)continue;const r=s.emitter;(!r.position||!e||e.indexOf(r)!==-1)&&this._scene._activeParticles.addCount(s.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||this._spriteManagers.length===0)return;const e=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let t=0;t<this._spriteManagers.length;t++){const i=this._spriteManagers.data[t];(e&&e.layerMask&i.layerMask)!==0&&i.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}vs._ZeroVector=y.Zero();class _A{}class Qt{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(e){e!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=e,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const e of this._scene.meshes)if(e.subMeshes)for(const t of e.subMeshes)t._wasDispatched=!1;if(this._scene.spriteManagers)for(const e of this._scene.spriteManagers)e._wasDispatched=!1;for(const e of this._scene.particleSystems)e._wasDispatched=!1}constructor(e){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new _A,this._maintainStateBetweenFrames=!1,this._scene=e;for(let t=Qt.MIN_RENDERINGGROUPS;t<Qt.MAX_RENDERINGGROUPS;t++)this._autoClearDepthStencil[t]={autoClear:!0,depth:!0,stencil:!0}}getRenderingGroup(e){const t=e||0;return this._prepareRenderingGroup(t),this._renderingGroups[t]}_clearDepthStencilBuffer(e=!0,t=!0){this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,e,t),this._depthStencilBufferAlreadyCleaned=!0)}render(e,t,i,s){const r=this._renderingGroupInfo;if(r.scene=this._scene,r.camera=this._scene.activeCamera,r.renderingManager=this,this._scene.spriteManagers&&s)for(let a=0;a<this._scene.spriteManagers.length;a++){const o=this._scene.spriteManagers[a];this.dispatchSprites(o)}for(let a=Qt.MIN_RENDERINGGROUPS;a<Qt.MAX_RENDERINGGROUPS;a++){this._depthStencilBufferAlreadyCleaned=a===Qt.MIN_RENDERINGGROUPS;const o=this._renderingGroups[a];if(!o||o._empty)continue;const l=1<<a;if(r.renderingGroupId=a,this._scene.onBeforeRenderingGroupObservable.notifyObservers(r,l),Qt.AUTOCLEAR){const h=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(a):this._autoClearDepthStencil[a];h&&h.autoClear&&this._clearDepthStencilBuffer(h.depth,h.stencil)}for(const h of this._scene._beforeRenderingGroupDrawStage)h.action(a);o.render(e,s,i,t);for(const h of this._scene._afterRenderingGroupDrawStage)h.action(a);this._scene.onAfterRenderingGroupObservable.notifyObservers(r,l)}}reset(){if(!this.maintainStateBetweenFrames)for(let e=Qt.MIN_RENDERINGGROUPS;e<Qt.MAX_RENDERINGGROUPS;e++){const t=this._renderingGroups[e];t&&t.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let e=Qt.MIN_RENDERINGGROUPS;e<Qt.MAX_RENDERINGGROUPS;e++){const t=this._renderingGroups[e];t&&t.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let e=Qt.MIN_RENDERINGGROUPS;e<Qt.MAX_RENDERINGGROUPS;e++){const t=this._renderingGroups[e];t&&t.dispose()}}_prepareRenderingGroup(e){this._renderingGroups[e]===void 0&&(this._renderingGroups[e]=new vs(e,this._scene,this._customOpaqueSortCompareFn[e],this._customAlphaTestSortCompareFn[e],this._customTransparentSortCompareFn[e]))}dispatchSprites(e){this.maintainStateBetweenFrames&&e._wasDispatched||(e._wasDispatched=!0,this.getRenderingGroup(e.renderingGroupId).dispatchSprites(e))}dispatchParticles(e){this.maintainStateBetweenFrames&&e._wasDispatched||(e._wasDispatched=!0,this.getRenderingGroup(e.renderingGroupId).dispatchParticles(e))}dispatch(e,t,i){t===void 0&&(t=e.getMesh()),!(this.maintainStateBetweenFrames&&e._wasDispatched)&&(e._wasDispatched=!0,this.getRenderingGroup(t.renderingGroupId).dispatch(e,t,i))}setRenderingOrder(e,t=null,i=null,s=null){if(this._customOpaqueSortCompareFn[e]=t,this._customAlphaTestSortCompareFn[e]=i,this._customTransparentSortCompareFn[e]=s,this._renderingGroups[e]){const r=this._renderingGroups[e];r.opaqueSortCompareFn=this._customOpaqueSortCompareFn[e],r.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[e],r.transparentSortCompareFn=this._customTransparentSortCompareFn[e]}}setRenderingAutoClearDepthStencil(e,t,i=!0,s=!0){this._autoClearDepthStencil[e]={autoClear:t,depth:i,stencil:s}}getAutoClearDepthStencilSetup(e){return this._autoClearDepthStencil[e]}}Qt.MAX_RENDERINGGROUPS=4;Qt.MIN_RENDERINGGROUPS=0;Qt.AUTOCLEAR=!0;class os{get renderList(){return this._renderList}set renderList(e){this._renderList!==e&&(this._unObserveRenderList&&(this._unObserveRenderList(),this._unObserveRenderList=null),e&&(this._unObserveRenderList=_v(e,this._renderListHasChanged)),this._renderList=e)}get renderInLinearSpace(){return this._renderInLinearSpace}set renderInLinearSpace(e){e!==this._renderInLinearSpace&&(this._renderInLinearSpace=e,this._scene.markAllMaterialsAsDirty(64))}get name(){return this._name}set name(e){if(this._name===e||(this._name=e,!this._scene))return;const t=this._scene.getEngine();for(let i=0;i<this._renderPassIds.length;++i){const s=this._renderPassIds[i];t._renderPassNames[s]=`${this._name}#${i}`}}get renderPassIds(){return this._renderPassIds}get currentRefreshId(){return this._currentRefreshId}setMaterialForRendering(e,t){let i;Array.isArray(e)?i=e:i=[e];for(let s=0;s<i.length;++s)for(let r=0;r<this.options.numPasses;++r)i[s].setMaterialForRenderPass(this._renderPassIds[r],t!==void 0?Array.isArray(t)?t[r]:t:void 0)}constructor(e,t,i){this._unObserveRenderList=null,this._renderListHasChanged=(s,r)=>{const a=this._renderList?this._renderList.length:0;(r===0&&a>0||a===0)&&this._scene.meshes.forEach(o=>{o._markSubMeshesAsLightDirty()})},this.particleSystemList=null,this.getCustomRenderList=null,this.renderParticles=!0,this.renderSprites=!1,this.forceLayerMaskCheck=!1,this._renderInLinearSpace=!1,this.onBeforeRenderObservable=new q,this.onAfterRenderObservable=new q,this.onBeforeRenderingManagerRenderObservable=new q,this.onAfterRenderingManagerRenderObservable=new q,this.onFastPathRenderObservable=new q,this._currentRefreshId=-1,this._refreshRate=1,this._currentApplyByPostProcessSetting=!1,this._currentSceneCamera=null,this.name=e,this._scene=t,this.renderList=[],this._renderPassIds=[],this.options={numPasses:1,doNotChangeAspectRatio:!0,...i},this._createRenderPassId(),this.renderPassId=this._renderPassIds[0],this._renderingManager=new Qt(t),this._renderingManager._useSceneAutoClearSetup=!0}_releaseRenderPassId(){const e=this._scene.getEngine();for(let t=0;t<this.options.numPasses;++t)e.releaseRenderPassId(this._renderPassIds[t]);this._renderPassIds.length=0}_createRenderPassId(){this._releaseRenderPassId();const e=this._scene.getEngine();for(let t=0;t<this.options.numPasses;++t)this._renderPassIds[t]=e.createRenderPassId(`${this.name}#${t}`)}resetRefreshCounter(){this._currentRefreshId=-1}get refreshRate(){return this._refreshRate}set refreshRate(e){this._refreshRate=e,this.resetRefreshCounter()}shouldRender(){return this._currentRefreshId===-1?(this._currentRefreshId=1,!0):this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1)}isReadyForRendering(e,t){this.prepareRenderList(),this.initRender(e,t);const i=this._checkReadiness();return this.finishRender(),i}prepareRenderList(){const e=this._scene;if(this._waitingRenderList){if(!this.renderListPredicate){this.renderList=[];for(let t=0;t<this._waitingRenderList.length;t++){const i=this._waitingRenderList[t],s=e.getMeshById(i);s&&this.renderList.push(s)}}this._waitingRenderList=void 0}if(this.renderListPredicate){this.renderList?this.renderList.length=0:this.renderList=[];const t=this._scene.meshes;for(let i=0;i<t.length;i++){const s=t[i];this.renderListPredicate(s)&&this.renderList.push(s)}}this._currentApplyByPostProcessSetting=this._scene.imageProcessingConfiguration.applyByPostProcess,this._scene.imageProcessingConfiguration._applyByPostProcess=!!this._renderInLinearSpace}initRender(e,t){const i=this._scene.getEngine(),s=this.activeCamera??this._scene.activeCamera;this._currentSceneCamera=this._scene.activeCamera,s&&(s!==this._scene.activeCamera&&(this._scene.setTransformMatrix(s.getViewMatrix(),s.getProjectionMatrix(!0)),this._scene.activeCamera=s),i.setViewport(s.rigParent?s.rigParent.viewport:s.viewport,e,t)),this._defaultRenderListPrepared=!1}finishRender(){const e=this._scene;e.imageProcessingConfiguration._applyByPostProcess=this._currentApplyByPostProcessSetting,e.activeCamera=this._currentSceneCamera,this._currentSceneCamera&&(this.activeCamera&&this.activeCamera!==e.activeCamera&&e.setTransformMatrix(this._currentSceneCamera.getViewMatrix(),this._currentSceneCamera.getProjectionMatrix(!0)),e.getEngine().setViewport(this._currentSceneCamera.viewport)),e.resetCachedMaterial()}render(e=0,t=!1){const i=this._scene,s=i.getEngine(),r=s.currentRenderPassId;if(s.currentRenderPassId=this._renderPassIds[e],this.onBeforeRenderObservable.notifyObservers(e),s.snapshotRendering&&s.snapshotRenderingMode===1)this.onFastPathRenderObservable.notifyObservers(e);else{let o=null;const l=this.renderList?this.renderList:i.getActiveMeshes().data,h=this.renderList?this.renderList.length:i.getActiveMeshes().length;this.getCustomRenderList&&(o=this.getCustomRenderList(e,l,h)),o?this._prepareRenderingManager(o,o.length,this.forceLayerMaskCheck):(this._defaultRenderListPrepared||(this._prepareRenderingManager(l,h,!this.renderList||this.forceLayerMaskCheck),this._defaultRenderListPrepared=!0),o=l),this.onBeforeRenderingManagerRenderObservable.notifyObservers(e),this._renderingManager.render(this.customRenderFunction,o,this.renderParticles,this.renderSprites),this.onAfterRenderingManagerRenderObservable.notifyObservers(e)}t||this.onAfterRenderObservable.notifyObservers(e),s.currentRenderPassId=r}_checkReadiness(){const e=this._scene,t=e.getEngine(),i=t.currentRenderPassId;let s=!0;e.getViewMatrix()||e.updateTransformMatrix();const r=this.options.numPasses;for(let o=0;o<r&&s;o++){let l=null;const h=this.renderList?this.renderList:e.getActiveMeshes().data,u=this.renderList?this.renderList.length:e.getActiveMeshes().length;t.currentRenderPassId=this._renderPassIds[o],this.onBeforeRenderObservable.notifyObservers(o),this.getCustomRenderList&&(l=this.getCustomRenderList(o,h,u)),l||(l=h),this.options.doNotChangeAspectRatio||e.updateTransformMatrix(!0);for(let c=0;c<l.length&&s;++c){const f=l[c];if(!(!f.isEnabled()||f.isBlocked||!f.isVisible||!f.subMeshes)){if(this.customIsReadyFunction){if(!this.customIsReadyFunction(f,this.refreshRate,!0)){s=!1;continue}}else if(!f.isReady(!0)){s=!1;continue}}}this.onAfterRenderObservable.notifyObservers(o),r>1&&(e.incrementRenderId(),e.resetCachedMaterial())}const a=this.particleSystemList||e.particleSystems;for(const o of a)o.isReady()||(s=!1);return t.currentRenderPassId=i,s}_prepareRenderingManager(e,t,i){const s=this._scene,r=s.activeCamera,a=this.cameraForLOD??r;this._renderingManager.reset();const o=s.getRenderId(),l=s.getFrameId();for(let u=0;u<t;u++){const c=e[u];if(c&&!c.isBlocked){if(this.customIsReadyFunction){if(!this.customIsReadyFunction(c,this.refreshRate,!1)){this.resetRefreshCounter();continue}}else if(!c.isReady(this.refreshRate===0)){this.resetRefreshCounter();continue}let f=null;if(a){const _=c._internalAbstractMeshDataInfo._currentLOD.get(a);!_||_[1]!==l?(f=s.customLODSelector?s.customLODSelector(c,a):c.getLOD(a),_?(_[0]=f,_[1]=l):c._internalAbstractMeshDataInfo._currentLOD.set(a,[f,l])):f=_[0]}else f=c;if(!f)continue;f!==c&&f.billboardMode!==0&&f.computeWorldMatrix(),f._preActivateForIntermediateRendering(o);let d;if(i&&r?d=(c.layerMask&r.layerMask)===0:d=!1,c.isEnabled()&&c.isVisible&&c.subMeshes&&!d){if(f!==c&&f._activate(o,!0),c._activate(o,!0)&&c.subMeshes.length){c.isAnInstance?c._internalAbstractMeshDataInfo._actAsRegularMesh&&(f=c):f._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!1,f._internalAbstractMeshDataInfo._isActiveIntermediate=!0,s._prepareSkeleton(f);for(let _=0;_<f.subMeshes.length;_++){const p=f.subMeshes[_];this._renderingManager.dispatch(p,f)}}c._postActivate()}}}const h=this.particleSystemList||s.particleSystems;for(let u=0;u<h.length;u++){const c=h[u],f=c.emitter;!c.isStarted()||!f||f.position&&!f.isEnabled()||this._renderingManager.dispatchParticles(c)}}setRenderingOrder(e,t=null,i=null,s=null){this._renderingManager.setRenderingOrder(e,t,i,s)}setRenderingAutoClearDepthStencil(e,t,i=!0,s=!0){this._renderingManager.setRenderingAutoClearDepthStencil(e,t,i,s),this._renderingManager._useSceneAutoClearSetup=!1}clone(){const e=new os(this.name,this._scene,this.options);return this.renderList&&(e.renderList=this.renderList.slice(0)),e}dispose(){const e=this.renderList?this.renderList:this._scene.getActiveMeshes().data,t=this.renderList?this.renderList.length:this._scene.getActiveMeshes().length;for(let i=0;i<t;i++){const s=e[i];s.getMaterialForRenderPass(this.renderPassId)!==void 0&&s.setMaterialForRenderPass(this.renderPassId,void 0)}this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderingManagerRenderObservable.clear(),this.onAfterRenderingManagerRenderObservable.clear(),this.onFastPathRenderObservable.clear(),this._releaseRenderPassId(),this.renderList=null}_rebuild(){this.refreshRate===os.REFRESHRATE_RENDER_ONCE&&(this.refreshRate=os.REFRESHRATE_RENDER_ONCE)}freeRenderingGroups(){this._renderingManager&&this._renderingManager.freeRenderingGroups()}}os.REFRESHRATE_RENDER_ONCE=0;os.REFRESHRATE_RENDER_ONEVERYFRAME=1;os.REFRESHRATE_RENDER_ONEVERYTWOFRAMES=2;Et.prototype.setDepthStencilTexture=function(n,e){this._engine.setDepthStencilTexture(this._samplers[n],this._uniforms[n],e,n)};class Rn extends ie{get renderListPredicate(){return this._objectRenderer.renderListPredicate}set renderListPredicate(e){this._objectRenderer.renderListPredicate=e}get renderList(){return this._objectRenderer.renderList}set renderList(e){this._objectRenderer.renderList=e}get particleSystemList(){return this._objectRenderer.particleSystemList}set particleSystemList(e){this._objectRenderer.particleSystemList=e}get getCustomRenderList(){return this._objectRenderer.getCustomRenderList}set getCustomRenderList(e){this._objectRenderer.getCustomRenderList=e}get renderParticles(){return this._objectRenderer.renderParticles}set renderParticles(e){this._objectRenderer.renderParticles=e}get renderSprites(){return this._objectRenderer.renderSprites}set renderSprites(e){this._objectRenderer.renderSprites=e}get forceLayerMaskCheck(){return this._objectRenderer.forceLayerMaskCheck}set forceLayerMaskCheck(e){this._objectRenderer.forceLayerMaskCheck=e}get activeCamera(){return this._objectRenderer.activeCamera}set activeCamera(e){this._objectRenderer.activeCamera=e}get cameraForLOD(){return this._objectRenderer.cameraForLOD}set cameraForLOD(e){this._objectRenderer.cameraForLOD=e}get renderInLinearSpace(){return this._objectRenderer.renderInLinearSpace}set renderInLinearSpace(e){this._objectRenderer.renderInLinearSpace=e}get customIsReadyFunction(){return this._objectRenderer.customIsReadyFunction}set customIsReadyFunction(e){this._objectRenderer.customIsReadyFunction=e}get customRenderFunction(){return this._objectRenderer.customRenderFunction}set customRenderFunction(e){this._objectRenderer.customRenderFunction=e}get postProcesses(){return this._postProcesses}get _prePassEnabled(){return!!this._prePassRenderTarget&&this._prePassRenderTarget.enabled}set onAfterUnbind(e){this._onAfterUnbindObserver&&this.onAfterUnbindObservable.remove(this._onAfterUnbindObserver),this._onAfterUnbindObserver=this.onAfterUnbindObservable.add(e)}get onBeforeRenderObservable(){return this._objectRenderer.onBeforeRenderObservable}set onBeforeRender(e){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(e)}get onAfterRenderObservable(){return this._objectRenderer.onAfterRenderObservable}set onAfterRender(e){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(e)}set onClear(e){this._onClearObserver&&this.onClearObservable.remove(this._onClearObserver),this._onClearObserver=this.onClearObservable.add(e)}get _waitingRenderList(){return this._objectRenderer._waitingRenderList}set _waitingRenderList(e){this._objectRenderer._waitingRenderList=e}get renderPassId(){return this._objectRenderer.renderPassId}get renderPassIds(){return this._objectRenderer.renderPassIds}get currentRefreshId(){return this._objectRenderer.currentRefreshId}setMaterialForRendering(e,t){this._objectRenderer.setMaterialForRendering(e,t)}get isMulti(){var e;return((e=this._renderTarget)==null?void 0:e.isMulti)??!1}get renderTargetOptions(){return this._renderTargetOptions}get renderTarget(){return this._renderTarget}_onRatioRescale(){this._sizeRatio&&this.resize(this._initialSizeParameter)}set boundingBoxSize(e){if(this._boundingBoxSize&&this._boundingBoxSize.equals(e))return;this._boundingBoxSize=e;const t=this.getScene();t&&t.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}get depthStencilTexture(){var e;return((e=this._renderTarget)==null?void 0:e._depthStencilTexture)??null}constructor(e,t,i,s=!1,r=!0,a=0,o=!1,l=ie.TRILINEAR_SAMPLINGMODE,h=!0,u=!1,c=!1,f=5,d=!1,_,p,g=!1,m=!1){let v,T=!0,A;if(typeof s=="object"){const x=s;s=!!x.generateMipMaps,r=x.doNotChangeAspectRatio??!0,a=x.type??0,o=!!x.isCube,l=x.samplingMode??ie.TRILINEAR_SAMPLINGMODE,h=x.generateDepthBuffer??!0,u=!!x.generateStencilBuffer,c=!!x.isMulti,f=x.format??5,d=!!x.delayAllocation,_=x.samples,p=x.creationFlags,g=!!x.noColorAttachment,m=!!x.useSRGBBuffer,v=x.colorAttachment,T=x.gammaSpace??T,A=x.existingObjectRenderer}if(super(null,i,!s,void 0,l,void 0,void 0,void 0,void 0,f),this.ignoreCameraViewport=!1,this.onBeforeBindObservable=new q,this.onAfterUnbindObservable=new q,this.onClearObservable=new q,this.onResizeObservable=new q,this._cleared=!1,this.skipInitialClear=!1,this._samples=1,this._canRescale=!0,this._renderTarget=null,this._dontDisposeObjectRenderer=!1,this.boundingBoxPosition=y.Zero(),this._disableEngineStages=!1,this._dumpToolsLoading=!1,i=this.getScene(),!i)return;const b=this.getScene().getEngine();this._gammaSpace=T,this._coordinatesMode=ie.PROJECTION_MODE,this.name=e,this.isRenderTarget=!0,this._initialSizeParameter=t,this._dontDisposeObjectRenderer=!!A,this._processSizeParameter(t),this._objectRenderer=A??new os(e,i,{numPasses:o?6:this.getRenderLayers()||1,doNotChangeAspectRatio:r}),this._onBeforeRenderingManagerRenderObserver=this._objectRenderer.onBeforeRenderingManagerRenderObservable.add(()=>{if(!this._disableEngineStages)for(const x of this._scene._beforeRenderTargetClearStage)x.action(this,this._currentFaceIndex,this._currentLayer);if(this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(b):this.skipInitialClear||b.clear(this.clearColor||this._scene.clearColor,!0,!0,!0),this._doNotChangeAspectRatio||this._scene.updateTransformMatrix(!0),!this._disableEngineStages)for(const x of this._scene._beforeRenderTargetDrawStage)x.action(this,this._currentFaceIndex,this._currentLayer)}),this._onAfterRenderingManagerRenderObserver=this._objectRenderer.onAfterRenderingManagerRenderObservable.add(()=>{var E;if(!this._disableEngineStages)for(const R of this._scene._afterRenderTargetDrawStage)R.action(this,this._currentFaceIndex,this._currentLayer);const x=((E=this._texture)==null?void 0:E.generateMipMaps)??!1;if(this._texture&&(this._texture.generateMipMaps=!1),this._postProcessManager?this._postProcessManager._finalizeFrame(!1,this._renderTarget??void 0,this._currentFaceIndex,this._postProcesses,this.ignoreCameraViewport):this._currentUseCameraPostProcess&&this._scene.postProcessManager._finalizeFrame(!1,this._renderTarget??void 0,this._currentFaceIndex),!this._disableEngineStages)for(const R of this._scene._afterRenderTargetPostProcessStage)R.action(this,this._currentFaceIndex,this._currentLayer);this._texture&&(this._texture.generateMipMaps=x),this._doNotChangeAspectRatio||this._scene.updateTransformMatrix(!0),this._currentDumpForDebug&&(this._dumpTools?this._dumpTools.DumpFramebuffer(this.getRenderWidth(),this.getRenderHeight(),b):U.Error("dumpTools module is still being loaded. To speed up the process import dump tools directly in your project"))}),this._onFastPathRenderObserver=this._objectRenderer.onFastPathRenderObservable.add(()=>{this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(b):this.skipInitialClear||b.clear(this.clearColor||this._scene.clearColor,!0,!0,!0)}),this._resizeObserver=b.onResizeObservable.add(()=>{}),this._generateMipMaps=!!s,this._doNotChangeAspectRatio=r,!c&&(this._renderTargetOptions={generateMipMaps:s,type:a,format:this._format??void 0,samplingMode:this.samplingMode,generateDepthBuffer:h,generateStencilBuffer:u,samples:_,creationFlags:p,noColorAttachment:g,useSRGBBuffer:m,colorAttachment:v,label:this.name},this.samplingMode===ie.NEAREST_SAMPLINGMODE&&(this.wrapU=ie.CLAMP_ADDRESSMODE,this.wrapV=ie.CLAMP_ADDRESSMODE),d||(o?(this._renderTarget=i.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions),this.coordinatesMode=ie.INVCUBIC_MODE,this._textureMatrix=L.Identity()):this._renderTarget=i.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,_!==void 0&&(this.samples=_)))}createDepthStencilTexture(e=0,t=!0,i=!1,s=1,r=14,a){var o;(o=this._renderTarget)==null||o.createDepthStencilTexture(e,t,i,s,r,a)}_processSizeParameter(e){if(e.ratio){this._sizeRatio=e.ratio;const t=this._getEngine();this._size={width:this._bestReflectionRenderTargetDimension(t.getRenderWidth(),this._sizeRatio),height:this._bestReflectionRenderTargetDimension(t.getRenderHeight(),this._sizeRatio)}}else this._size=e}get samples(){var e;return((e=this._renderTarget)==null?void 0:e.samples)??this._samples}set samples(e){this._renderTarget&&(this._samples=this._renderTarget.setSamples(e))}addPostProcess(e){if(!this._postProcessManager){const t=this.getScene();if(!t)return;this._postProcessManager=new Fc(t),this._postProcesses=new Array}this._postProcesses.push(e),this._postProcesses[0].autoClear=!1}clearPostProcesses(e=!1){if(this._postProcesses){if(e)for(const t of this._postProcesses)t.dispose();this._postProcesses=[]}}removePostProcess(e){if(!this._postProcesses)return;const t=this._postProcesses.indexOf(e);t!==-1&&(this._postProcesses.splice(t,1),this._postProcesses.length>0&&(this._postProcesses[0].autoClear=!1))}resetRefreshCounter(){this._objectRenderer.resetRefreshCounter()}get refreshRate(){return this._objectRenderer.refreshRate}set refreshRate(e){this._objectRenderer.refreshRate=e}_shouldRender(){return this._objectRenderer.shouldRender()}getRenderSize(){return this.getRenderWidth()}getRenderWidth(){return this._size.width?this._size.width:this._size}getRenderHeight(){return this._size.width?this._size.height:this._size}getRenderLayers(){const e=this._size.layers;if(e)return e;const t=this._size.depth;return t||0}disableRescaling(){this._canRescale=!1}get canRescale(){return this._canRescale}scale(e){const t=Math.max(1,this.getRenderSize()*e);this.resize(t)}getReflectionTextureMatrix(){return this.isCube?this._textureMatrix:super.getReflectionTextureMatrix()}resize(e){var s;const t=this.isCube;(s=this._renderTarget)==null||s.dispose(),this._renderTarget=null;const i=this.getScene();i&&(this._processSizeParameter(e),t?this._renderTarget=i.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions):this._renderTarget=i.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,this._renderTargetOptions.samples!==void 0&&(this.samples=this._renderTargetOptions.samples),this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this))}render(e=!1,t=!1){this._render(e,t)}isReadyForRendering(){this._dumpToolsLoading||(this._dumpToolsLoading=!0,De(()=>Promise.resolve().then(()=>l6),void 0).then(t=>this._dumpTools=t)),this._objectRenderer.prepareRenderList(),this.onBeforeBindObservable.notifyObservers(this),this._objectRenderer.initRender(this.getRenderWidth(),this.getRenderHeight());const e=this._objectRenderer._checkReadiness();return this.onAfterUnbindObservable.notifyObservers(this),this._objectRenderer.finishRender(),e}_render(e=!1,t=!1){const i=this.getScene();if(i){if(this.useCameraPostProcesses!==void 0&&(e=this.useCameraPostProcesses),this._objectRenderer.prepareRenderList(),this.onBeforeBindObservable.notifyObservers(this),this._objectRenderer.initRender(this.getRenderWidth(),this.getRenderHeight()),(this.is2DArray||this.is3D)&&!this.isMulti)for(let s=0;s<this.getRenderLayers();s++)this._renderToTarget(0,e,t,s),i.incrementRenderId(),i.resetCachedMaterial();else if(this.isCube&&!this.isMulti)for(let s=0;s<6;s++)this._renderToTarget(s,e,t),i.incrementRenderId(),i.resetCachedMaterial();else this._renderToTarget(0,e,t);this.onAfterUnbindObservable.notifyObservers(this),this._objectRenderer.finishRender()}}_bestReflectionRenderTargetDimension(e,t){const s=e*t,r=ev(s+128*128/(128+s));return Math.min(Jf(e),r)}_bindFrameBuffer(e=0,t=0){const i=this.getScene();if(!i)return;const s=i.getEngine();this._renderTarget&&s.bindFramebuffer(this._renderTarget,this.isCube?e:void 0,void 0,void 0,this.ignoreCameraViewport,0,t)}_unbindFrameBuffer(e,t){this._renderTarget&&e.unBindFramebuffer(this._renderTarget,this.isCube,()=>{this.onAfterRenderObservable.notifyObservers(t)})}_prepareFrame(e,t,i,s){this._postProcessManager?this._prePassEnabled||this._postProcessManager._prepareFrame(this._texture,this._postProcesses):(!s||!e.postProcessManager._prepareFrame(this._texture))&&this._bindFrameBuffer(t,i)}_renderToTarget(e,t,i,s=0){var o,l;const r=this.getScene();if(!r)return;const a=r.getEngine();this._currentFaceIndex=e,this._currentLayer=s,this._currentUseCameraPostProcess=t,this._currentDumpForDebug=i,this._prepareFrame(r,e,s,t),(o=a._debugPushGroup)==null||o.call(a,`render to face #${e} layer #${s}`,2),this._objectRenderer.render(e+s,!0),(l=a._debugPopGroup)==null||l.call(a,2),this._unbindFrameBuffer(a,e),this._texture&&this.isCube&&e===5&&a.generateMipMapsForCubemap(this._texture,!0)}setRenderingOrder(e,t=null,i=null,s=null){this._objectRenderer.setRenderingOrder(e,t,i,s)}setRenderingAutoClearDepthStencil(e,t){this._objectRenderer.setRenderingAutoClearDepthStencil(e,t)}clone(){const e=this.getSize(),t=new Rn(this.name,e,this.getScene(),this._renderTargetOptions.generateMipMaps,this._doNotChangeAspectRatio,this._renderTargetOptions.type,this.isCube,this._renderTargetOptions.samplingMode,this._renderTargetOptions.generateDepthBuffer,this._renderTargetOptions.generateStencilBuffer,void 0,this._renderTargetOptions.format,void 0,this._renderTargetOptions.samples);return t.hasAlpha=this.hasAlpha,t.level=this.level,t.coordinatesMode=this.coordinatesMode,this.renderList&&(t.renderList=this.renderList.slice(0)),t}serialize(){if(!this.name)return null;const e=super.serialize();if(e.renderTargetSize=this.getRenderSize(),e.renderList=[],this.renderList)for(let t=0;t<this.renderList.length;t++)e.renderList.push(this.renderList[t].id);return e}disposeFramebufferObjects(){var e;(e=this._renderTarget)==null||e.dispose(!0)}releaseInternalTexture(){var e;(e=this._renderTarget)==null||e.releaseTextures(),this._texture=null}dispose(){var i;this.onResizeObservable.clear(),this.onClearObservable.clear(),this.onAfterUnbindObservable.clear(),this.onBeforeBindObservable.clear(),this._postProcessManager&&(this._postProcessManager.dispose(),this._postProcessManager=null),this._prePassRenderTarget&&this._prePassRenderTarget.dispose(),this._objectRenderer.onBeforeRenderingManagerRenderObservable.remove(this._onBeforeRenderingManagerRenderObserver),this._objectRenderer.onAfterRenderingManagerRenderObservable.remove(this._onAfterRenderingManagerRenderObserver),this._objectRenderer.onFastPathRenderObservable.remove(this._onFastPathRenderObserver),this._dontDisposeObjectRenderer||this._objectRenderer.dispose(),this.clearPostProcesses(!0),this._resizeObserver&&(this.getScene().getEngine().onResizeObservable.remove(this._resizeObserver),this._resizeObserver=null);const e=this.getScene();if(!e)return;let t=e.customRenderTargets.indexOf(this);t>=0&&e.customRenderTargets.splice(t,1);for(const s of e.cameras)t=s.customRenderTargets.indexOf(this),t>=0&&s.customRenderTargets.splice(t,1);(i=this._renderTarget)==null||i.dispose(),this._renderTarget=null,this._texture=null,super.dispose()}_rebuild(){this._objectRenderer._rebuild(),this._postProcessManager&&this._postProcessManager._rebuild()}freeRenderingGroups(){this._objectRenderer.freeRenderingGroups()}getViewCount(){return 1}}Rn.REFRESHRATE_RENDER_ONCE=os.REFRESHRATE_RENDER_ONCE;Rn.REFRESHRATE_RENDER_ONEVERYFRAME=os.REFRESHRATE_RENDER_ONEVERYFRAME;Rn.REFRESHRATE_RENDER_ONEVERYTWOFRAMES=os.REFRESHRATE_RENDER_ONEVERYTWOFRAMES;ie._CreateRenderTargetTexture=(n,e,t,i,s)=>new Rn(n,e,t,i);class o0{static GetEffect(e){return e.getPipelineContext===void 0?e.effect:e}constructor(e,t=!0){this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=e.createDrawContext(),t&&(this.materialContext=e.createMaterialContext())}setEffect(e,t,i=!0){var s;this.effect=e,t!==void 0&&(this.defines=t),i&&((s=this.drawContext)==null||s.reset())}dispose(e=!1){var t;if(this.effect){const i=this.effect;e?i.dispose():Wo.SetImmediate(()=>{i.getEngine().onEndFrameObservable.addOnce(()=>{i.dispose()})}),this.effect=null}(t=this.drawContext)==null||t.dispose()}}const Lc="postprocessVertexShader",Lv=`attribute vec2 position;uniform vec2 scale;varying vec2 vUV;const vec2 madd=vec2(0.5,0.5);
#define CUSTOM_VERTEX_DEFINITIONS
void main(void) {
#define CUSTOM_VERTEX_MAIN_BEGIN
vUV=(position*madd+madd)*scale;gl_Position=vec4(position,0.0,1.0);
#define CUSTOM_VERTEX_MAIN_END
}`;ye.ShadersStore[Lc]||(ye.ShadersStore[Lc]=Lv);const pA={name:Lc,shader:Lv},Bv=Object.freeze(Object.defineProperty({__proto__:null,postprocessVertexShader:pA},Symbol.toStringTag,{value:"Module"})),xu={positions:[1,1,-1,1,-1,-1,1,-1],indices:[0,1,2,0,2,3]};class gA{constructor(e,t=xu){this._fullscreenViewport=new Ca(0,0,1,1);const i=t.positions??xu.positions,s=t.indices??xu.indices;this.engine=e,this._vertexBuffers={[S.PositionKind]:new S(e,i,S.PositionKind,!1,!1,2)},this._indexBuffer=e.createIndexBuffer(s),this._onContextRestoredObserver=e.onContextRestoredObservable.add(()=>{this._indexBuffer=e.createIndexBuffer(s);for(const r in this._vertexBuffers)this._vertexBuffers[r]._rebuild()})}setViewport(e=this._fullscreenViewport){this.engine.setViewport(e)}bindBuffers(e){this.engine.bindBuffers(this._vertexBuffers,this._indexBuffer,e)}applyEffectWrapper(e){this.engine.setState(!0),this.engine.depthCullingState.depthTest=!1,this.engine.stencilState.stencilTest=!1,this.engine.enableEffect(e.drawWrapper),this.bindBuffers(e.effect),e.onApplyObservable.notifyObservers({})}saveStates(){this._savedStateDepthTest=this.engine.depthCullingState.depthTest,this._savedStateStencilTest=this.engine.stencilState.stencilTest}restoreStates(){this.engine.depthCullingState.depthTest=this._savedStateDepthTest,this.engine.stencilState.stencilTest=this._savedStateStencilTest}draw(){this.engine.drawElementsType(0,0,6)}_isRenderTargetTexture(e){return e.renderTarget!==void 0}render(e,t=null){if(!e.effect.isReady())return;this.saveStates(),this.setViewport();const i=t===null?null:this._isRenderTargetTexture(t)?t.renderTarget:t;i&&this.engine.bindFramebuffer(i),this.applyEffectWrapper(e),this.draw(),i&&this.engine.unBindFramebuffer(i),this.restoreStates()}dispose(){const e=this._vertexBuffers[S.PositionKind];e&&(e.dispose(),delete this._vertexBuffers[S.PositionKind]),this._indexBuffer&&this.engine._releaseBuffer(this._indexBuffer),this._onContextRestoredObserver&&(this.engine.onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}}class qt{static RegisterShaderCodeProcessing(e,t){if(!t){delete qt._CustomShaderCodeProcessing[e??""];return}qt._CustomShaderCodeProcessing[e??""]=t}static _GetShaderCodeProcessing(e){return qt._CustomShaderCodeProcessing[e]??qt._CustomShaderCodeProcessing[""]}get name(){return this.options.name}set name(e){this.options.name=e}isReady(){var e;return((e=this._drawWrapper.effect)==null?void 0:e.isReady())??!1}get drawWrapper(){return this._drawWrapper}get effect(){return this._drawWrapper.effect}set effect(e){this._drawWrapper.effect=e}constructor(e){this.alphaMode=0,this.onEffectCreatedObservable=new q(void 0,!0),this.onApplyObservable=new q,this._shadersLoaded=!1,this._webGPUReady=!1,this._importPromises=[],this.options={...e,name:e.name||"effectWrapper",engine:e.engine,uniforms:e.uniforms||e.uniformNames||[],uniformNames:void 0,samplers:e.samplers||e.samplerNames||[],samplerNames:void 0,attributeNames:e.attributeNames||["position"],uniformBuffers:e.uniformBuffers||[],defines:e.defines||"",useShaderStore:e.useShaderStore||!1,vertexUrl:e.vertexUrl||e.vertexShader||"postprocess",vertexShader:void 0,fragmentShader:e.fragmentShader||"pass",indexParameters:e.indexParameters,blockCompilation:e.blockCompilation||!1,shaderLanguage:e.shaderLanguage||0,onCompiled:e.onCompiled||void 0,extraInitializations:e.extraInitializations||void 0,extraInitializationsAsync:e.extraInitializationsAsync||void 0,useAsPostProcess:e.useAsPostProcess??!1},this.options.uniformNames=this.options.uniforms,this.options.samplerNames=this.options.samplers,this.options.vertexShader=this.options.vertexUrl,this.options.useAsPostProcess&&(this.options.samplers.indexOf("textureSampler")===-1&&this.options.samplers.push("textureSampler"),this.options.uniforms.indexOf("scale")===-1&&this.options.uniforms.push("scale")),e.vertexUrl||e.vertexShader?this._shaderPath={vertexSource:this.options.vertexShader}:(this.options.useAsPostProcess||(this.options.uniforms.push("scale"),this.onApplyObservable.add(()=>{this.effect.setFloat2("scale",1,1)})),this._shaderPath={vertex:this.options.vertexShader}),this._shaderPath.fragmentSource=this.options.fragmentShader,this._shaderPath.spectorName=this.options.name,this.options.useShaderStore&&(this._shaderPath.fragment=this._shaderPath.fragmentSource,this._shaderPath.vertex||(this._shaderPath.vertex=this._shaderPath.vertexSource),delete this._shaderPath.fragmentSource,delete this._shaderPath.vertexSource),this.onApplyObservable.add(()=>{this.bind()}),this.options.useShaderStore||(this._onContextRestoredObserver=this.options.engine.onContextRestoredObservable.add(()=>{this.effect._pipelineContext=null,this.effect._prepareEffect()})),this._drawWrapper=new o0(this.options.engine),this._webGPUReady=this.options.shaderLanguage===1;const t=Array.isArray(this.options.defines)?this.options.defines.join(`
`):this.options.defines;this._postConstructor(this.options.blockCompilation,t,this.options.extraInitializations)}_gatherImports(e=!1,t){this.options.useAsPostProcess&&(e&&this._webGPUReady?t.push(Promise.all([De(()=>import("./postprocess.vertex-DNLLiaDQ.js"),[])])):t.push(Promise.all([De(()=>Promise.resolve().then(()=>Bv),void 0)])))}_postConstructor(e,t=null,i,s){this._importPromises.length=0,s&&this._importPromises.push(...s);const r=this.options.engine.isWebGPU&&!qt.ForceGLSL;this._gatherImports(r,this._importPromises),i!==void 0&&i(r,this._importPromises),r&&this._webGPUReady&&(this.options.shaderLanguage=1),e||this.updateEffect(t)}updateEffect(e=null,t=null,i=null,s,r,a,o,l){const h=qt._GetShaderCodeProcessing(this.name);if(h!=null&&h.defineCustomBindings){const f=(t==null?void 0:t.slice())??[];f.push(...this.options.uniforms);const d=(i==null?void 0:i.slice())??[];d.push(...this.options.samplers),e=h.defineCustomBindings(this.name,e,f,d),t=f,i=d}this.options.defines=e||"";const u=this._shadersLoaded||this._importPromises.length===0?void 0:async()=>{await Promise.all(this._importPromises),this._shadersLoaded=!0};let c;this.options.extraInitializationsAsync?c=async()=>{u==null||u(),await this.options.extraInitializationsAsync()}:c=u,this.options.useShaderStore?this._drawWrapper.effect=this.options.engine.createEffect({vertex:o??this._shaderPath.vertex,fragment:l??this._shaderPath.fragment},{attributes:this.options.attributeNames,uniformsNames:t||this.options.uniforms,uniformBuffersNames:this.options.uniformBuffers,samplers:i||this.options.samplers,defines:e!==null?e:"",fallbacks:null,onCompiled:r??this.options.onCompiled,onError:a??null,indexParameters:s||this.options.indexParameters,processCodeAfterIncludes:h!=null&&h.processCodeAfterIncludes?(f,d)=>h.processCodeAfterIncludes(this.name,f,d):null,processFinalCode:h!=null&&h.processFinalCode?(f,d)=>h.processFinalCode(this.name,f,d):null,shaderLanguage:this.options.shaderLanguage,extraInitializationsAsync:c},this.options.engine):this._drawWrapper.effect=new Et(this._shaderPath,this.options.attributeNames,t||this.options.uniforms,i||this.options.samplerNames,this.options.engine,e,void 0,r||this.options.onCompiled,void 0,void 0,void 0,this.options.shaderLanguage,c),this.onEffectCreatedObservable.notifyObservers(this._drawWrapper.effect)}bind(){var e,t;this.options.useAsPostProcess&&(this.options.engine.setAlphaMode(this.alphaMode),this.drawWrapper.effect.setFloat2("scale",1,1)),(t=(e=qt._GetShaderCodeProcessing(this.name))==null?void 0:e.bindCustomBindings)==null||t.call(e,this.name,this._drawWrapper.effect)}dispose(e=!1){this._onContextRestoredObserver&&(this.effect.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null),this.onEffectCreatedObservable.clear(),this._drawWrapper.dispose(!0)}}qt.ForceGLSL=!1;qt._CustomShaderCodeProcessing={};re.prototype.setTextureFromPostProcess=function(n,e,t){let i=null;e&&(e._forcedOutputTexture?i=e._forcedOutputTexture:e._textures.data[e._currentRenderTextureInd]&&(i=e._textures.data[e._currentRenderTextureInd])),this._bindTexture(n,(i==null?void 0:i.texture)??null,t)};re.prototype.setTextureFromPostProcessOutput=function(n,e,t){var i;this._bindTexture(n,((i=e==null?void 0:e._outputTexture)==null?void 0:i.texture)??null,t)};Et.prototype.setTextureFromPostProcess=function(n,e){this._engine.setTextureFromPostProcess(this._samplers[n],e,n)};Et.prototype.setTextureFromPostProcessOutput=function(n,e){this._engine.setTextureFromPostProcessOutput(this._samplers[n],e,n)};class pt{static get ForceGLSL(){return qt.ForceGLSL}static set ForceGLSL(e){qt.ForceGLSL=e}static RegisterShaderCodeProcessing(e,t){qt.RegisterShaderCodeProcessing(e,t)}get name(){return this._effectWrapper.name}set name(e){this._effectWrapper.name=e}get alphaMode(){return this._effectWrapper.alphaMode}set alphaMode(e){this._effectWrapper.alphaMode=e}get samples(){return this._samples}set samples(e){this._samples=Math.min(e,this._engine.getCaps().maxMSAASamples),this._textures.forEach(t=>{t.setSamples(this._samples)})}get shaderLanguage(){return this._shaderLanguage}getEffectName(){return this._fragmentUrl}set onActivate(e){this._onActivateObserver&&this.onActivateObservable.remove(this._onActivateObserver),e&&(this._onActivateObserver=this.onActivateObservable.add(e))}set onSizeChanged(e){this._onSizeChangedObserver&&this.onSizeChangedObservable.remove(this._onSizeChangedObserver),this._onSizeChangedObserver=this.onSizeChangedObservable.add(e)}set onApply(e){this._onApplyObserver&&this.onApplyObservable.remove(this._onApplyObserver),this._onApplyObserver=this.onApplyObservable.add(e)}set onBeforeRender(e){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(e)}set onAfterRender(e){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(e)}get inputTexture(){return this._textures.data[this._currentRenderTextureInd]}set inputTexture(e){this._forcedOutputTexture=e}restoreDefaultInputTexture(){this._forcedOutputTexture&&(this._forcedOutputTexture=null,this.markTextureDirty())}getCamera(){return this._camera}get texelSize(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.texelSize:(this._forcedOutputTexture&&this._texelSize.copyFromFloats(1/this._forcedOutputTexture.width,1/this._forcedOutputTexture.height),this._texelSize)}constructor(e,t,i,s,r,a,o=1,l,h,u=null,c=0,f="postprocess",d,_=!1,p=5,g,m){this._parentContainer=null,this.width=-1,this.height=-1,this.nodeMaterialSource=null,this._outputTexture=null,this.autoClear=!0,this.forceAutoClearInAlphaMode=!1,this.animations=[],this.enablePixelPerfectMode=!1,this.forceFullscreenViewport=!0,this.scaleMode=1,this.alwaysForcePOT=!1,this._samples=1,this.adaptScaleToCurrentViewport=!1,this._webGPUReady=!1,this._reusable=!1,this._renderId=0,this.externalTextureSamplerBinding=!1,this._textures=new ti(2),this._textureCache=[],this._currentRenderTextureInd=0,this._scaleRatio=new ne(1,1),this._texelSize=ne.Zero(),this.onActivateObservable=new q,this.onSizeChangedObservable=new q,this.onApplyObservable=new q,this.onBeforeRenderObservable=new q,this.onAfterRenderObservable=new q,this.onDisposeObservable=new q;let v=1,T=null,A;if(i&&!Array.isArray(i)){const b=i;i=b.uniforms??null,s=b.samplers??null,v=b.size??1,a=b.camera??null,o=b.samplingMode??1,l=b.engine,h=b.reusable,u=Array.isArray(b.defines)?b.defines.join(`
`):b.defines??null,c=b.textureType??0,f=b.vertexUrl??"postprocess",d=b.indexParameters,_=b.blockCompilation??!1,p=b.textureFormat??5,g=b.shaderLanguage??0,T=b.uniformBuffers??null,m=b.extraInitializations,A=b.effectWrapper}else r&&(typeof r=="number"?v=r:v={width:r.width,height:r.height});if(this._useExistingThinPostProcess=!!A,this._effectWrapper=A??new qt({name:e,useShaderStore:!0,useAsPostProcess:!0,fragmentShader:t,engine:l||(a==null?void 0:a.getScene().getEngine()),uniforms:i,samplers:s,uniformBuffers:T,defines:u,vertexUrl:f,indexParameters:d,blockCompilation:!0,shaderLanguage:g,extraInitializations:void 0}),this.name=e,this.onEffectCreatedObservable=this._effectWrapper.onEffectCreatedObservable,a!=null?(this._camera=a,this._scene=a.getScene(),a.attachPostProcess(this),this._engine=this._scene.getEngine(),this._scene.postProcesses.push(this),this.uniqueId=this._scene.getUniqueId()):l&&(this._engine=l,this._engine.postProcesses.push(this)),this._options=v,this.renderTargetSamplingMode=o||1,this._reusable=h||!1,this._textureType=c,this._textureFormat=p,this._shaderLanguage=g||0,this._samplers=s||[],this._samplers.indexOf("textureSampler")===-1&&this._samplers.push("textureSampler"),this._fragmentUrl=t,this._vertexUrl=f,this._parameters=i||[],this._parameters.indexOf("scale")===-1&&this._parameters.push("scale"),this._uniformBuffers=T||[],this._indexParameters=d,!this._useExistingThinPostProcess){this._webGPUReady=this._shaderLanguage===1;const b=[];this._gatherImports(this._engine.isWebGPU&&!pt.ForceGLSL,b),this._effectWrapper._webGPUReady=this._webGPUReady,this._effectWrapper._postConstructor(_,u,m,b)}}_gatherImports(e=!1,t){e&&this._webGPUReady?t.push(Promise.all([De(()=>import("./postprocess.vertex-DNLLiaDQ.js"),[])])):t.push(Promise.all([De(()=>Promise.resolve().then(()=>Bv),void 0)]))}getClassName(){return"PostProcess"}getEngine(){return this._engine}getEffect(){return this._effectWrapper.drawWrapper.effect}shareOutputWith(e){return this._disposeTextures(),this._shareOutputWithPostProcess=e,this}useOwnOutput(){this._textures.length==0&&(this._textures=new ti(2)),this._shareOutputWithPostProcess=null}updateEffect(e=null,t=null,i=null,s,r,a,o,l){this._effectWrapper.updateEffect(e,t,i,s,r,a,o,l),this._postProcessDefines=Array.isArray(this._effectWrapper.options.defines)?this._effectWrapper.options.defines.join(`
`):this._effectWrapper.options.defines}isReusable(){return this._reusable}markTextureDirty(){this.width=-1}_createRenderTargetTexture(e,t,i=0){for(let r=0;r<this._textureCache.length;r++)if(this._textureCache[r].texture.width===e.width&&this._textureCache[r].texture.height===e.height&&this._textureCache[r].postProcessChannel===i&&this._textureCache[r].texture._generateDepthBuffer===t.generateDepthBuffer&&this._textureCache[r].texture.samples===t.samples)return this._textureCache[r].texture;const s=this._engine.createRenderTargetTexture(e,t);return this._textureCache.push({texture:s,postProcessChannel:i,lastUsedRenderId:-1}),s}_flushTextureCache(){const e=this._renderId;for(let t=this._textureCache.length-1;t>=0;t--)if(e-this._textureCache[t].lastUsedRenderId>100){let i=!1;for(let s=0;s<this._textures.length;s++)if(this._textures.data[s]===this._textureCache[t].texture){i=!0;break}i||(this._textureCache[t].texture.dispose(),this._textureCache.splice(t,1))}}resize(e,t,i=null,s=!1,r=!1){this._textures.length>0&&this._textures.reset(),this.width=e,this.height=t;let a=null;if(i){for(let h=0;h<i._postProcesses.length;h++)if(i._postProcesses[h]!==null){a=i._postProcesses[h];break}}const o={width:this.width,height:this.height},l={generateMipMaps:s,generateDepthBuffer:r||a===this,generateStencilBuffer:(r||a===this)&&this._engine.isStencilEnable,samplingMode:this.renderTargetSamplingMode,type:this._textureType,format:this._textureFormat,samples:this._samples,label:"PostProcessRTT-"+this.name};this._textures.push(this._createRenderTargetTexture(o,l,0)),this._reusable&&this._textures.push(this._createRenderTargetTexture(o,l,1)),this._texelSize.copyFromFloats(1/this.width,1/this.height),this.onSizeChangedObservable.notifyObservers(this)}_getTarget(){let e;if(this._shareOutputWithPostProcess)e=this._shareOutputWithPostProcess.inputTexture;else if(this._forcedOutputTexture)e=this._forcedOutputTexture,this.width=this._forcedOutputTexture.width,this.height=this._forcedOutputTexture.height;else{e=this.inputTexture;let t;for(let i=0;i<this._textureCache.length;i++)if(this._textureCache[i].texture===e){t=this._textureCache[i];break}t&&(t.lastUsedRenderId=this._renderId)}return e}activate(e,t=null,i){var _,p;const s=e===null||e.cameraRigMode!==void 0?e||this._camera:null,r=(s==null?void 0:s.getScene())??e,a=r.getEngine(),o=a.getCaps().maxTextureSize,l=(t?t.width:this._engine.getRenderWidth(!0))*this._options|0,h=(t?t.height:this._engine.getRenderHeight(!0))*this._options|0;let u=this._options.width||l,c=this._options.height||h;const f=this.renderTargetSamplingMode!==7&&this.renderTargetSamplingMode!==1&&this.renderTargetSamplingMode!==2;let d=null;if(!this._shareOutputWithPostProcess&&!this._forcedOutputTexture){if(this.adaptScaleToCurrentViewport){const g=a.currentViewport;g&&(u*=g.width,c*=g.height)}(f||this.alwaysForcePOT)&&(this._options.width||(u=a.needPOTTextures?Yi(u,o,this.scaleMode):u),this._options.height||(c=a.needPOTTextures?Yi(c,o,this.scaleMode):c)),(this.width!==u||this.height!==c||!(d=this._getTarget()))&&this.resize(u,c,s,f,i),this._textures.forEach(g=>{g.samples!==this.samples&&this._engine.updateRenderTargetTextureSampleCount(g,this.samples)}),this._flushTextureCache(),this._renderId++}return d||(d=this._getTarget()),this.enablePixelPerfectMode?(this._scaleRatio.copyFromFloats(l/u,h/c),this._engine.bindFramebuffer(d,0,l,h,this.forceFullscreenViewport)):(this._scaleRatio.copyFromFloats(1,1),this._engine.bindFramebuffer(d,0,void 0,void 0,this.forceFullscreenViewport)),(p=(_=this._engine)._debugInsertMarker)==null||p.call(_,`post process ${this.name} input`),this.onActivateObservable.notifyObservers(s),this.autoClear&&(this.alphaMode===0||this.forceAutoClearInAlphaMode)&&this._engine.clear(this.clearColor?this.clearColor:r.clearColor,r._allowPostProcessClearColor,!0,!0),this._reusable&&(this._currentRenderTextureInd=(this._currentRenderTextureInd+1)%2),d}get isSupported(){return this._effectWrapper.drawWrapper.effect.isSupported}get aspectRatio(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.aspectRatio:this._forcedOutputTexture?this._forcedOutputTexture.width/this._forcedOutputTexture.height:this.width/this.height}isReady(){return this._effectWrapper.isReady()}apply(){if(!this._effectWrapper.isReady())return null;this._engine.enableEffect(this._effectWrapper.drawWrapper),this._engine.setState(!1),this._engine.setDepthBuffer(!1),this._engine.setDepthWrite(!1),this.alphaConstants&&this.getEngine().setAlphaConstants(this.alphaConstants.r,this.alphaConstants.g,this.alphaConstants.b,this.alphaConstants.a);let e;return this._shareOutputWithPostProcess?e=this._shareOutputWithPostProcess.inputTexture:this._forcedOutputTexture?e=this._forcedOutputTexture:e=this.inputTexture,this.externalTextureSamplerBinding||this._effectWrapper.drawWrapper.effect._bindTexture("textureSampler",e==null?void 0:e.texture),this._effectWrapper.drawWrapper.effect.setVector2("scale",this._scaleRatio),this.onApplyObservable.notifyObservers(this._effectWrapper.drawWrapper.effect),this._effectWrapper.bind(),this._effectWrapper.drawWrapper.effect}_disposeTextures(){if(this._shareOutputWithPostProcess||this._forcedOutputTexture){this._disposeTextureCache();return}this._disposeTextureCache(),this._textures.dispose()}_disposeTextureCache(){for(let e=this._textureCache.length-1;e>=0;e--)this._textureCache[e].texture.dispose();this._textureCache.length=0}setPrePassRenderer(e){return this._prePassEffectConfiguration?(this._prePassEffectConfiguration=e.addEffectConfiguration(this._prePassEffectConfiguration),this._prePassEffectConfiguration.enabled=!0,!0):!1}dispose(e){e=e||this._camera,this._useExistingThinPostProcess||this._effectWrapper.dispose(),this._disposeTextures();let t;if(this._scene&&(t=this._scene.postProcesses.indexOf(this),t!==-1&&this._scene.postProcesses.splice(t,1)),this._parentContainer){const i=this._parentContainer.postProcesses.indexOf(this);i>-1&&this._parentContainer.postProcesses.splice(i,1),this._parentContainer=null}if(t=this._engine.postProcesses.indexOf(this),t!==-1&&this._engine.postProcesses.splice(t,1),this.onDisposeObservable.notifyObservers(),!!e){if(e.detachPostProcess(this),t=e._postProcesses.indexOf(this),t===0&&e._postProcesses.length>0){const i=this._camera._getFirstPostProcess();i&&i.markTextureDirty()}this.onActivateObservable.clear(),this.onAfterRenderObservable.clear(),this.onApplyObservable.clear(),this.onBeforeRenderObservable.clear(),this.onSizeChangedObservable.clear(),this.onEffectCreatedObservable.clear()}}serialize(){const e=Ie.Serialize(this),t=this.getCamera()||this._scene&&this._scene.activeCamera;return e.customType="BABYLON."+this.getClassName(),e.cameraId=t?t.id:null,e.reusable=this._reusable,e.textureType=this._textureType,e.fragmentUrl=this._fragmentUrl,e.parameters=this._parameters,e.samplers=this._samplers,e.uniformBuffers=this._uniformBuffers,e.options=this._options,e.defines=this._postProcessDefines,e.textureFormat=this._textureFormat,e.vertexUrl=this._vertexUrl,e.indexParameters=this._indexParameters,e}clone(){const e=this.serialize();e._engine=this._engine,e.cameraId=null;const t=pt.Parse(e,this._scene,"");return t?(t.onActivateObservable=this.onActivateObservable.clone(),t.onSizeChangedObservable=this.onSizeChangedObservable.clone(),t.onApplyObservable=this.onApplyObservable.clone(),t.onBeforeRenderObservable=this.onBeforeRenderObservable.clone(),t.onAfterRenderObservable=this.onAfterRenderObservable.clone(),t._prePassEffectConfiguration=this._prePassEffectConfiguration,t):null}static Parse(e,t,i){const s=Zn(e.customType);if(!s||!s._Parse)return null;const r=t?t.getCameraById(e.cameraId):null;return s._Parse(e,r,t,i)}static _Parse(e,t,i,s){return Ie.Parse(()=>new pt(e.name,e.fragmentUrl,e.parameters,e.samplers,e.options,t,e.renderTargetSamplingMode,e._engine,e.reusable,e.defines,e.textureType,e.vertexUrl,e.indexParameters,!1,e.textureFormat),e,i,s)}}P([B()],pt.prototype,"uniqueId",void 0);P([B()],pt.prototype,"name",null);P([B()],pt.prototype,"width",void 0);P([B()],pt.prototype,"height",void 0);P([B()],pt.prototype,"renderTargetSamplingMode",void 0);P([sd()],pt.prototype,"clearColor",void 0);P([B()],pt.prototype,"autoClear",void 0);P([B()],pt.prototype,"forceAutoClearInAlphaMode",void 0);P([B()],pt.prototype,"alphaMode",null);P([B()],pt.prototype,"alphaConstants",void 0);P([B()],pt.prototype,"enablePixelPerfectMode",void 0);P([B()],pt.prototype,"forceFullscreenViewport",void 0);P([B()],pt.prototype,"scaleMode",void 0);P([B()],pt.prototype,"alwaysForcePOT",void 0);P([B("samples")],pt.prototype,"_samples",void 0);P([B()],pt.prototype,"adaptScaleToCurrentViewport",void 0);Tt("BABYLON.PostProcess",pt);class Dr extends qt{_gatherImports(e,t){e?(this._webGPUReady=!0,t.push(Promise.all([De(()=>import("./pass.fragment-DApSp89C.js"),[])]))):t.push(Promise.all([De(()=>import("./pass.fragment-CS1tgUTK.js"),[])])),super._gatherImports(e,t)}constructor(e,t=null,i){super({...i,name:e,engine:t||oe.LastCreatedEngine,useShaderStore:!0,useAsPostProcess:!0,fragmentShader:Dr.FragmentUrl})}}Dr.FragmentUrl="pass";class vh extends qt{_gatherImports(e,t){e?(this._webGPUReady=!0,t.push(Promise.all([De(()=>import("./passCube.fragment-yKbcXgxh.js"),[])]))):t.push(Promise.all([De(()=>import("./passCube.fragment-Ko5oWIJq.js"),[])])),super._gatherImports(e,t)}constructor(e,t=null,i){super({...i,name:e,engine:t||oe.LastCreatedEngine,useShaderStore:!0,useAsPostProcess:!0,fragmentShader:vh.FragmentUrl,defines:"#define POSITIVEX"}),this._face=0}get face(){return this._face}set face(e){if(!(e<0||e>5))switch(this._face=e,this._face){case 0:this.updateEffect("#define POSITIVEX");break;case 1:this.updateEffect("#define NEGATIVEX");break;case 2:this.updateEffect("#define POSITIVEY");break;case 3:this.updateEffect("#define NEGATIVEY");break;case 4:this.updateEffect("#define POSITIVEZ");break;case 5:this.updateEffect("#define NEGATIVEZ");break}}}vh.FragmentUrl="passCube";class l0 extends pt{getClassName(){return"PassPostProcess"}constructor(e,t,i=null,s,r,a,o=0,l=!1){const h={size:typeof t=="number"?t:void 0,camera:i,samplingMode:s,engine:r,reusable:a,textureType:o,blockCompilation:l,...t};super(e,Dr.FragmentUrl,{effectWrapper:typeof t=="number"||!t.effectWrapper?new Dr(e,r,h):void 0,...h})}static _Parse(e,t,i,s){return Ie.Parse(()=>new l0(e.name,e.options,t,e.renderTargetSamplingMode,e._engine,e.reusable),e,i,s)}}Tt("BABYLON.PassPostProcess",l0);class _d extends pt{get face(){return this._effectWrapper.face}set face(e){this._effectWrapper.face=e}getClassName(){return"PassCubePostProcess"}constructor(e,t,i=null,s,r,a,o=0,l=!1){const h={size:typeof t=="number"?t:void 0,camera:i,samplingMode:s,engine:r,reusable:a,textureType:o,blockCompilation:l,...t};super(e,Dr.FragmentUrl,{effectWrapper:typeof t=="number"||!t.effectWrapper?new vh(e,r,h):void 0,...h})}static _Parse(e,t,i,s){return Ie.Parse(()=>new _d(e.name,e.options,t,e.renderTargetSamplingMode,e._engine,e.reusable),e,i,s)}}P([B()],_d.prototype,"face",null);re._RescalePostProcessFactory=n=>new l0("rescale",1,null,2,n,!1,0);function mA(n,e,t,i,s,r,a,o){const l=e.getEngine();return e.isReady=!1,s=s??e.samplingMode,i=i??e.type,r=r??e.format,a=a??e.width,o=o??e.height,i===-1&&(i=0),new Promise(h=>{const u=new pt("postprocess",n,null,null,1,null,s,l,!1,void 0,i,void 0,null,!1,r);u.externalTextureSamplerBinding=!0;const c=l.createRenderTargetTexture({width:a,height:o},{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:s,type:i,format:r});u.onEffectCreatedObservable.addOnce(f=>{f.executeWhenCompiled(()=>{u.onApply=d=>{d._bindTexture("textureSampler",e),d.setFloat2("scale",1,1)},t.postProcessManager.directRender([u],c,!0),l.restoreDefaultFramebuffer(),l._releaseTexture(e),u&&u.dispose(),c._swapAndDie(e),e.type=i,e.format=5,e.isReady=!0,h(e)})})})}let U0,bg;function l5(n){U0||(U0=new Float32Array(1),bg=new Int32Array(U0.buffer)),U0[0]=n;const e=bg[0];let t=e>>16&32768,i=e>>12&2047;const s=e>>23&255;return s<103?t:s>142?(t|=31744,t|=(s==255?0:1)&&e&8388607,t):s<113?(i|=2048,t|=(i>>114-s)+(i>>113-s&1),t):(t|=s-112<<10|i>>1,t+=i&1,t)}function vA(n){const e=(n&32768)>>15,t=(n&31744)>>10,i=n&1023;return t===0?(e?-1:1)*Math.pow(2,-14)*(i/Math.pow(2,10)):t==31?i?NaN:(e?-1:1)*(1/0):(e?-1:1)*Math.pow(2,t-15)*(1+i/Math.pow(2,10))}class zl{static _IsGPUBuffer(e){return e.underlyingResource===void 0}static _FlagsToString(e,t=""){let i=t;for(let s=0;s<=9;++s)e&1<<s&&(i&&(i+="_"),i+=Xe[1<<s]);return i}constructor(e,t){this._deferredReleaseBuffers=[],this._engine=e,this._device=t}createRawBuffer(e,t,i=!1,s){const r=e.byteLength!==void 0?e.byteLength+3&-4:e+3&-4,a={label:"BabylonWebGPUDevice"+this._engine.uniqueId+"_"+zl._FlagsToString(t,s??"Buffer")+"_size"+r,mappedAtCreation:i,size:r,usage:t};return this._device.createBuffer(a)}createBuffer(e,t,i){const s=e.byteLength!==void 0,r=new cA,a="DataBufferUniqueId="+r.uniqueId;return r.buffer=this.createRawBuffer(e,t,void 0,i?a+"-"+i:a),r.references=1,r.capacity=s?e.byteLength:e,r.engineId=this._engine.uniqueId,s&&this.setSubData(r,0,e),r}setRawData(e,t,i,s,r){s+=i.byteOffset,this._device.queue.writeBuffer(e,t,i.buffer,s,r)}setSubData(e,t,i,s=0,r=0){const a=e.underlyingResource;r=r||i.byteLength-s;const o=t&3;s-=o,t-=o;const l=r;if(r=r+o+3&-4,i.buffer.byteLength-i.byteOffset<r){const u=new Uint8Array(r);u.set(new Uint8Array(i.buffer,i.byteOffset+s,l)),i=u,s=0}this.setRawData(a,t,i,s,r)}_getHalfFloatAsFloatRGBAArrayBuffer(e,t,i){i||(i=new Float32Array(e));const s=new Uint16Array(t);for(;e--;)i[e]=vA(s[e]);return i}readDataFromBuffer(e,t,i,s,r,a,o=0,l=0,h=null,u=!0,c=!1){const f=o===1?2:o===2?1:0,d=this._engine.uniqueId;return new Promise((_,p)=>{e.mapAsync(1,l,t).then(()=>{const g=e.getMappedRange(l,t);let m=h;if(c)m===null?m=Sc(o,t,!0,g):m=Sc(o,m.buffer,void 0,g);else if(m===null)switch(f){case 0:m=new Uint8Array(t),m.set(new Uint8Array(g));break;case 1:m=this._getHalfFloatAsFloatRGBAArrayBuffer(t/2,g);break;case 2:m=new Float32Array(t/4),m.set(new Float32Array(g));break}else switch(f){case 0:m=new Uint8Array(m.buffer),m.set(new Uint8Array(g));break;case 1:m=this._getHalfFloatAsFloatRGBAArrayBuffer(t/2,g,h);break;case 2:m=new Float32Array(m.buffer),m.set(new Float32Array(g));break}if(r!==a){f===1&&!c&&(r*=2,a*=2);const v=new Uint8Array(m.buffer);let T=r,A=0;for(let b=1;b<s;++b){A=b*a;for(let x=0;x<r;++x)v[T++]=v[A++]}f!==0&&!c?m=new Float32Array(v.buffer,0,T/4):m=new Uint8Array(v.buffer,0,T)}e.unmap(),u&&this.releaseBuffer(e),_(m)},g=>{this._engine.isDisposed||this._engine.uniqueId!==d?_(new Uint8Array):p(g)})})}releaseBuffer(e){return zl._IsGPUBuffer(e)?(this._deferredReleaseBuffers.push(e),!0):(e.references--,e.references===0?(this._deferredReleaseBuffers.push(e.underlyingResource),!0):!1)}destroyDeferredBuffers(){for(let e=0;e<this._deferredReleaseBuffers.length;++e)this._deferredReleaseBuffers[e].destroy();this._deferredReleaseBuffers.length=0}}const yA=[0,0,3,7,0,2,6,2,4,1,5,3,1],xA=[0,64,32,96,16,80,48,112,8],bA=[0,128,128,0,0,0,0,128,0,0,0,0,128];class vr{constructor(e){this._samplers={},this._device=e,this.disabled=!1}static GetSamplerHashCode(e){const t=e._cachedAnisotropicFilteringLevel?e._cachedAnisotropicFilteringLevel:1;return yA[e.samplingMode]+xA[(e._comparisonFunction||514)-512+1]+bA[e.samplingMode]+((e._cachedWrapU??1)<<8)+((e._cachedWrapV??1)<<10)+((e._cachedWrapR??1)<<12)+((e.useMipMaps?1:0)<<14)+(t<<15)}static _GetSamplerFilterDescriptor(e,t){let i,s,r,a,o;const l=e.useMipMaps;switch(e.samplingMode){case 11:i="linear",s="linear",r="nearest",l||(a=o=0);break;case 3:case 3:i="linear",s="linear",l?r="linear":(r="nearest",a=o=0);break;case 8:i="nearest",s="nearest",l?r="linear":(r="nearest",a=o=0);break;case 4:i="nearest",s="nearest",r="nearest",l||(a=o=0);break;case 5:i="nearest",s="linear",r="nearest",l||(a=o=0);break;case 6:i="nearest",s="linear",l?r="linear":(r="nearest",a=o=0);break;case 7:i="nearest",s="linear",r="nearest",a=o=0;break;case 1:case 1:i="nearest",s="nearest",r="nearest",a=o=0;break;case 9:i="linear",s="nearest",r="nearest",l||(a=o=0);break;case 10:i="linear",s="nearest",l?r="linear":(r="nearest",a=o=0);break;case 2:case 2:i="linear",s="linear",t>1?r="linear":(r="nearest",a=o=0);break;case 12:i="linear",s="nearest",r="nearest",a=o=0;break;default:i="nearest",s="nearest",r="nearest",a=o=0;break}return t>1&&(a!==0||o!==0)?{magFilter:"linear",minFilter:"linear",mipmapFilter:"linear",anisotropyEnabled:!0}:{magFilter:i,minFilter:s,mipmapFilter:r,lodMinClamp:a,lodMaxClamp:o}}static _GetWrappingMode(e){switch(e){case 1:return"repeat";case 0:return"clamp-to-edge";case 2:return"mirror-repeat"}return"repeat"}static _GetSamplerWrappingDescriptor(e){return{addressModeU:this._GetWrappingMode(e._cachedWrapU),addressModeV:this._GetWrappingMode(e._cachedWrapV),addressModeW:this._GetWrappingMode(e._cachedWrapR)}}static _GetSamplerDescriptor(e,t){let i=(e.useMipMaps||e.samplingMode===2)&&e._cachedAnisotropicFilteringLevel?e._cachedAnisotropicFilteringLevel:1;e.samplingMode!==11&&e.samplingMode!==3&&e.samplingMode!==2&&(i=1);const s=this._GetSamplerFilterDescriptor(e,i);return{label:t,...s,...this._GetSamplerWrappingDescriptor(e),compare:e._comparisonFunction?vr.GetCompareFunction(e._comparisonFunction):void 0,maxAnisotropy:s.anisotropyEnabled?i:1}}static GetCompareFunction(e){switch(e){case 519:return"always";case 514:return"equal";case 516:return"greater";case 518:return"greater-equal";case 513:return"less";case 515:return"less-equal";case 512:return"never";case 517:return"not-equal";default:return"less"}}getSampler(e,t=!1,i=0,s){if(this.disabled)return this._device.createSampler(vr._GetSamplerDescriptor(e,s));t?i=0:i===0&&(i=vr.GetSamplerHashCode(e));let r=t?void 0:this._samplers[i];return r||(r=this._device.createSampler(vr._GetSamplerDescriptor(e,s)),t||(this._samplers[i]=r)),r}}const TA={[S.PositionKind]:!0,[S.NormalKind]:!0,[S.TangentKind]:!0,[S.UVKind]:!0,[S.UV2Kind]:!0,[S.UV3Kind]:!0,[S.UV4Kind]:!0,[S.UV5Kind]:!0,[S.UV6Kind]:!0,[S.ColorKind]:!0,[S.ColorInstanceKind]:!0,[S.MatricesIndicesKind]:!0,[S.MatricesWeightsKind]:!0,[S.MatricesIndicesExtraKind]:!0,[S.MatricesWeightsExtraKind]:!0};function AA(n){switch(n){case S.BYTE:case S.SHORT:case S.INT:case S.FLOAT:return!0;case S.UNSIGNED_BYTE:case S.UNSIGNED_SHORT:case S.UNSIGNED_INT:return!1;default:throw new Error(`Invalid type '${n}'`)}}function EA(n,e){const t=e.getEngine(),i=e._pipelineContext;if(!(i!=null&&i.vertexBufferKindToType))return;let s=null;for(const r in n){const a=n[r];if(!a||!TA[r])continue;const o=a.normalized?S.FLOAT:a.type,l=i.vertexBufferKindToType[r];(o!==S.FLOAT&&l===void 0||l!==void 0&&l!==o)&&(s||(s=t._getShaderProcessingContext(e.shaderLanguage,!1)),i.vertexBufferKindToType[r]=o,o!==S.FLOAT&&(s.vertexBufferKindToNumberOfComponents[r]=S.DeduceStride(r),AA(o)&&(s.vertexBufferKindToNumberOfComponents[r]*=-1)))}if(s){const r=t._caps.parallelShaderCompile;t._caps.parallelShaderCompile=void 0,e._processShaderCodeAsync(null,t._features._checkNonFloatVertexBuffersDontRecreatePipelineContext,s),t._caps.parallelShaderCompile=r}}var mt;(function(n){n[n.StencilReadMask=0]="StencilReadMask",n[n.StencilWriteMask=1]="StencilWriteMask",n[n.DepthBias=2]="DepthBias",n[n.DepthBiasSlopeScale=3]="DepthBiasSlopeScale",n[n.DepthStencilState=4]="DepthStencilState",n[n.MRTAttachments1=5]="MRTAttachments1",n[n.MRTAttachments2=6]="MRTAttachments2",n[n.RasterizationState=7]="RasterizationState",n[n.ColorStates=8]="ColorStates",n[n.ShaderStage=9]="ShaderStage",n[n.TextureStage=10]="TextureStage",n[n.VertexState=11]="VertexState",n[n.NumStates=12]="NumStates"})(mt||(mt={}));const k0={0:1,1:2,768:3,769:4,770:5,771:6,772:7,773:8,774:9,775:10,776:11,32769:12,32770:13,32771:12,32772:13},zr={0:0,7680:1,7681:2,7682:3,7683:4,5386:5,34055:6,34056:7};class at{constructor(e,t){this.mrtTextureCount=0,this._device=e,this._useTextureStage=!0,this._states=new Array(30),this._statesLength=0,this._stateDirtyLowestIndex=0,this._emptyVertexBuffer=t,this._mrtFormats=[],this._parameter={token:void 0,pipeline:null},this.disabled=!1,this.vertexBuffers=[],this._kMaxVertexBufferStride=e.limits.maxVertexBufferArrayStride||2048,this.reset()}reset(){this._isDirty=!0,this.vertexBuffers.length=0,this.setAlphaToCoverage(!1),this.resetDepthCullingState(),this.setClampDepth(!1),this.setDepthBias(0),this._webgpuColorFormat=["bgra8unorm"],this.setColorFormat("bgra8unorm"),this.setMRT([]),this.setAlphaBlendEnabled(!1),this.setAlphaBlendFactors([null,null,null,null],[null,null]),this.setWriteMask(15),this.setDepthStencilFormat("depth24plus-stencil8"),this.setStencilEnabled(!1),this.resetStencilState(),this.setBuffers(null,null,null),this._setTextureState(0)}get colorFormats(){return this._mrtAttachments1>0?this._mrtFormats:this._webgpuColorFormat}getRenderPipeline(e,t,i,s=0){if(i=We.GetSample(i),this.disabled){const a=at._GetTopology(e);return this._setVertexState(t),this._setTextureState(s),this._parameter.pipeline=this._createRenderPipeline(t,a,i),at.NumCacheMiss++,at._NumPipelineCreationCurrentFrame++,this._parameter.pipeline}if(this._setShaderStage(t.uniqueId),this._setRasterizationState(e,i),this._setColorStates(),this._setDepthStencilState(),this._setVertexState(t),this._setTextureState(s),this.lastStateDirtyLowestIndex=this._stateDirtyLowestIndex,!this._isDirty&&this._parameter.pipeline)return this._stateDirtyLowestIndex=this._statesLength,at.NumCacheHitWithoutHash++,this._parameter.pipeline;if(this._getRenderPipeline(this._parameter),this._isDirty=!1,this._stateDirtyLowestIndex=this._statesLength,this._parameter.pipeline)return at.NumCacheHitWithHash++,this._parameter.pipeline;const r=at._GetTopology(e);return this._parameter.pipeline=this._createRenderPipeline(t,r,i),this._setRenderPipeline(this._parameter),at.NumCacheMiss++,at._NumPipelineCreationCurrentFrame++,this._parameter.pipeline}endFrame(){at.NumPipelineCreationLastFrame=at._NumPipelineCreationCurrentFrame,at._NumPipelineCreationCurrentFrame=0}setAlphaToCoverage(e){this._alphaToCoverageEnabled=e}setFrontFace(e){this._frontFace=e}setCullEnabled(e){this._cullEnabled=e}setCullFace(e){this._cullFace=e}setClampDepth(e){this._clampDepth=e}resetDepthCullingState(){this.setDepthCullingState(!1,2,1,0,0,!0,!0,519)}setDepthCullingState(e,t,i,s,r,a,o,l){this._depthWriteEnabled=o,this._depthTestEnabled=a,this._depthCompare=(l??519)-512,this._cullFace=i,this._cullEnabled=e,this._frontFace=t,this.setDepthBiasSlopeScale(s),this.setDepthBias(r)}setDepthBias(e){this._depthBias!==e&&(this._depthBias=e,this._states[mt.DepthBias]=e,this._isDirty=!0,this._stateDirtyLowestIndex=Math.min(this._stateDirtyLowestIndex,mt.DepthBias))}setDepthBiasSlopeScale(e){this._depthBiasSlopeScale!==e&&(this._depthBiasSlopeScale=e,this._states[mt.DepthBiasSlopeScale]=e,this._isDirty=!0,this._stateDirtyLowestIndex=Math.min(this._stateDirtyLowestIndex,mt.DepthBiasSlopeScale))}setColorFormat(e){this._webgpuColorFormat[0]=e,this._colorFormat=ks[e??""]}setMRTAttachments(e){this.mrtAttachments=e;let t=0;for(let i=0;i<e.length;++i)e[i]!==0&&(t+=1<<i);this._mrtEnabledMask!==t&&(this._mrtEnabledMask=t,this._isDirty=!0,this._stateDirtyLowestIndex=Math.min(this._stateDirtyLowestIndex,mt.MRTAttachments1))}setMRT(e,t){if(t=t??e.length,t>10)throw"Can't handle more than 10 attachments for a MRT in cache render pipeline!";this.mrtTextureArray=e,this.mrtTextureCount=t,this._mrtEnabledMask=65535;const i=[0,0];let s=0,r=0,a=0;for(let o=0;o<t;++o){const l=e[o],h=l==null?void 0:l._hardwareTexture;this._mrtFormats[a]=(h==null?void 0:h.format)??this._webgpuColorFormat[0],i[s]+=ks[this._mrtFormats[a]??""]<<r,r+=6,a++,r>=32&&(r=0,s++)}this._mrtFormats.length=a,(this._mrtAttachments1!==i[0]||this._mrtAttachments2!==i[1])&&(this._mrtAttachments1=i[0],this._mrtAttachments2=i[1],this._states[mt.MRTAttachments1]=i[0],this._states[mt.MRTAttachments2]=i[1],this._isDirty=!0,this._stateDirtyLowestIndex=Math.min(this._stateDirtyLowestIndex,mt.MRTAttachments1))}setAlphaBlendEnabled(e){this._alphaBlendEnabled=e}setAlphaBlendFactors(e,t){this._alphaBlendFuncParams=e,this._alphaBlendEqParams=t}setWriteMask(e){this._writeMask=e}setDepthStencilFormat(e){this._webgpuDepthStencilFormat=e,this._depthStencilFormat=e===void 0?0:ks[e]}setDepthTestEnabled(e){this._depthTestEnabled=e}setDepthWriteEnabled(e){this._depthWriteEnabled=e}setDepthCompare(e){this._depthCompare=(e??519)-512}setStencilEnabled(e){this._stencilEnabled=e}setStencilCompare(e){this._stencilFrontCompare=(e??519)-512}setStencilDepthFailOp(e){this._stencilFrontDepthFailOp=e===null?1:zr[e]}setStencilPassOp(e){this._stencilFrontPassOp=e===null?2:zr[e]}setStencilFailOp(e){this._stencilFrontFailOp=e===null?1:zr[e]}setStencilReadMask(e){this._stencilReadMask!==e&&(this._stencilReadMask=e,this._states[mt.StencilReadMask]=e,this._isDirty=!0,this._stateDirtyLowestIndex=Math.min(this._stateDirtyLowestIndex,mt.StencilReadMask))}setStencilWriteMask(e){this._stencilWriteMask!==e&&(this._stencilWriteMask=e,this._states[mt.StencilWriteMask]=e,this._isDirty=!0,this._stateDirtyLowestIndex=Math.min(this._stateDirtyLowestIndex,mt.StencilWriteMask))}resetStencilState(){this.setStencilState(!1,519,7680,7681,7680,255,255)}setStencilState(e,t,i,s,r,a,o){this._stencilEnabled=e,this._stencilFrontCompare=(t??519)-512,this._stencilFrontDepthFailOp=i===null?1:zr[i],this._stencilFrontPassOp=s===null?2:zr[s],this._stencilFrontFailOp=r===null?1:zr[r],this.setStencilReadMask(a),this.setStencilWriteMask(o)}setBuffers(e,t,i){this._vertexBuffers=e,this._overrideVertexBuffers=i,this._indexBuffer=t}static _GetTopology(e){switch(e){case 0:return"triangle-list";case 2:return"point-list";case 1:return"line-list";case 3:return"point-list";case 4:return"line-list";case 5:throw"LineLoop is an unsupported fillmode in WebGPU";case 6:return"line-strip";case 7:return"triangle-strip";case 8:throw"TriangleFan is an unsupported fillmode in WebGPU";default:return"triangle-list"}}static _GetAphaBlendOperation(e){switch(e){case 32774:return"add";case 32778:return"subtract";case 32779:return"reverse-subtract";case 32775:return"min";case 32776:return"max";default:return"add"}}static _GetAphaBlendFactor(e){switch(e){case 0:return"zero";case 1:return"one";case 768:return"src";case 769:return"one-minus-src";case 770:return"src-alpha";case 771:return"one-minus-src-alpha";case 772:return"dst-alpha";case 773:return"one-minus-dst-alpha";case 774:return"dst";case 775:return"one-minus-dst";case 776:return"src-alpha-saturated";case 32769:return"constant";case 32770:return"one-minus-constant";case 32771:return"constant";case 32772:return"one-minus-constant";case 35065:return"src1";case 35066:return"one-minus-src1";case 34185:return"src1-alpha";case 35067:return"one-minus-src1-alpha";default:return"one"}}static _GetCompareFunction(e){switch(e){case 0:return"never";case 1:return"less";case 2:return"equal";case 3:return"less-equal";case 4:return"greater";case 5:return"not-equal";case 6:return"greater-equal";case 7:return"always"}return"never"}static _GetStencilOpFunction(e){switch(e){case 0:return"zero";case 1:return"keep";case 2:return"replace";case 3:return"increment-clamp";case 4:return"decrement-clamp";case 5:return"invert";case 6:return"increment-wrap";case 7:return"decrement-wrap"}return"keep"}static _GetVertexInputDescriptorFormat(e){const t=e.type,i=e.normalized,s=e.getSize();switch(t){case S.BYTE:switch(s){case 1:case 2:return i?"snorm8x2":"sint8x2";case 3:case 4:return i?"snorm8x4":"sint8x4"}break;case S.UNSIGNED_BYTE:switch(s){case 1:case 2:return i?"unorm8x2":"uint8x2";case 3:case 4:return i?"unorm8x4":"uint8x4"}break;case S.SHORT:switch(s){case 1:case 2:return i?"snorm16x2":"sint16x2";case 3:case 4:return i?"snorm16x4":"sint16x4"}break;case S.UNSIGNED_SHORT:switch(s){case 1:case 2:return i?"unorm16x2":"uint16x2";case 3:case 4:return i?"unorm16x4":"uint16x4"}break;case S.INT:switch(s){case 1:return"sint32";case 2:return"sint32x2";case 3:return"sint32x3";case 4:return"sint32x4"}break;case S.UNSIGNED_INT:switch(s){case 1:return"uint32";case 2:return"uint32x2";case 3:return"uint32x3";case 4:return"uint32x4"}break;case S.FLOAT:switch(s){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4"}break}throw new Error(`Invalid Format '${e.getKind()}' - type=${t}, normalized=${i}, size=${s}`)}_getAphaBlendState(){return this._alphaBlendEnabled?{srcFactor:at._GetAphaBlendFactor(this._alphaBlendFuncParams[2]),dstFactor:at._GetAphaBlendFactor(this._alphaBlendFuncParams[3]),operation:at._GetAphaBlendOperation(this._alphaBlendEqParams[1])}:null}_getColorBlendState(){return this._alphaBlendEnabled?{srcFactor:at._GetAphaBlendFactor(this._alphaBlendFuncParams[0]),dstFactor:at._GetAphaBlendFactor(this._alphaBlendFuncParams[1]),operation:at._GetAphaBlendOperation(this._alphaBlendEqParams[0])}:null}_setShaderStage(e){this._shaderId!==e&&(this._shaderId=e,this._states[mt.ShaderStage]=e,this._isDirty=!0,this._stateDirtyLowestIndex=Math.min(this._stateDirtyLowestIndex,mt.ShaderStage))}_setRasterizationState(e,t){const i=this._frontFace,s=this._cullEnabled?this._cullFace:0,r=this._clampDepth?1:0,a=this._alphaToCoverageEnabled?1:0,o=i-1+(s<<1)+(r<<3)+(a<<4)+(e<<5)+(t<<8);this._rasterizationState!==o&&(this._rasterizationState=o,this._states[mt.RasterizationState]=this._rasterizationState,this._isDirty=!0,this._stateDirtyLowestIndex=Math.min(this._stateDirtyLowestIndex,mt.RasterizationState))}_setColorStates(){let e=((this._writeMask?1:0)<<22)+(this._colorFormat<<23)+((this._depthWriteEnabled?1:0)<<29);this._alphaBlendEnabled&&(e+=((this._alphaBlendFuncParams[0]===null?2:k0[this._alphaBlendFuncParams[0]])<<0)+((this._alphaBlendFuncParams[1]===null?2:k0[this._alphaBlendFuncParams[1]])<<4)+((this._alphaBlendFuncParams[2]===null?2:k0[this._alphaBlendFuncParams[2]])<<8)+((this._alphaBlendFuncParams[3]===null?2:k0[this._alphaBlendFuncParams[3]])<<12)+((this._alphaBlendEqParams[0]===null?1:this._alphaBlendEqParams[0]-32773)<<16)+((this._alphaBlendEqParams[1]===null?1:this._alphaBlendEqParams[1]-32773)<<19)),e!==this._colorStates&&(this._colorStates=e,this._states[mt.ColorStates]=this._colorStates,this._isDirty=!0,this._stateDirtyLowestIndex=Math.min(this._stateDirtyLowestIndex,mt.ColorStates))}_setDepthStencilState(){const e=this._stencilEnabled?this._stencilFrontCompare+(this._stencilFrontDepthFailOp<<3)+(this._stencilFrontPassOp<<6)+(this._stencilFrontFailOp<<9):591,t=this._depthStencilFormat+((this._depthTestEnabled?this._depthCompare:7)<<6)+(e<<10);this._depthStencilState!==t&&(this._depthStencilState=t,this._states[mt.DepthStencilState]=this._depthStencilState,this._isDirty=!0,this._stateDirtyLowestIndex=Math.min(this._stateDirtyLowestIndex,mt.DepthStencilState))}_setVertexState(e){var h;const t=this._statesLength;let i=mt.VertexState;const s=e._pipelineContext,r=s.shaderProcessingContext.attributeNamesFromEffect,a=s.shaderProcessingContext.attributeLocationsFromEffect;let o,l=0;for(let u=0;u<r.length;u++){const c=a[u];let f=(this._overrideVertexBuffers&&this._overrideVertexBuffers[r[u]])??this._vertexBuffers[r[u]];f||(f=this._emptyVertexBuffer,at.LogErrorIfNoVertexBuffer&&U.Error(`No vertex buffer is provided for the "${r[u]}" attribute. A default empty vertex buffer will be used, but this may generate errors in some browsers.`));const d=(h=f.effectiveBuffer)==null?void 0:h.underlyingResource;if(f._validOffsetRange===void 0){const p=f.effectiveByteOffset,g=f.getSize(!0),m=f.effectiveByteStride;f._validOffsetRange=p+g<=this._kMaxVertexBufferStride&&m===0||m!==0&&p+g<=m}o&&o===d&&f._validOffsetRange||(this.vertexBuffers[l++]=f,o=f._validOffsetRange?d:null);const _=f.hashCode+(c<<7);this._isDirty=this._isDirty||this._states[i]!==_,this._states[i++]=_}this.vertexBuffers.length=l,this._statesLength=i,this._isDirty=this._isDirty||i!==t,this._isDirty&&(this._stateDirtyLowestIndex=Math.min(this._stateDirtyLowestIndex,mt.VertexState))}_setTextureState(e){this._textureState!==e&&(this._textureState=e,this._states[mt.TextureStage]=this._textureState,this._isDirty=!0,this._stateDirtyLowestIndex=Math.min(this._stateDirtyLowestIndex,mt.TextureStage))}_createPipelineLayout(e){if(this._useTextureStage)return this._createPipelineLayoutWithTextureStage(e);const t=[],i=e.shaderProcessingContext.bindGroupLayoutEntries;for(let s=0;s<i.length;s++){const r=i[s];t[s]=this._device.createBindGroupLayout({entries:r})}return e.bindGroupLayouts[0]=t,this._device.createPipelineLayout({bindGroupLayouts:t})}_createPipelineLayoutWithTextureStage(e){const t=e.shaderProcessingContext,i=t.bindGroupLayoutEntries;let s=1;for(let a=0;a<i.length;a++){const o=i[a];for(let l=0;l<o.length;l++){const h=i[a][l];if(h.texture){const u=t.bindGroupLayoutEntryInfo[a][h.binding].name,c=t.availableTextures[u],f=c.autoBindSampler?t.availableSamplers[u+"Sampler"]:null;let d=c.sampleType,_=(f==null?void 0:f.type)??"filtering";if(this._textureState&s&&d!=="depth"&&(c.autoBindSampler&&(_="non-filtering"),d="unfilterable-float"),h.texture.sampleType=d,f){const p=t.bindGroupLayoutEntryInfo[f.binding.groupIndex][f.binding.bindingIndex].index;i[f.binding.groupIndex][p].sampler.type=_}s=s<<1}}}const r=[];for(let a=0;a<i.length;++a)r[a]=this._device.createBindGroupLayout({entries:i[a]});return e.bindGroupLayouts[this._textureState]=r,this._device.createPipelineLayout({bindGroupLayouts:r})}_getVertexInputDescriptor(e){var l;const t=[],i=e._pipelineContext,s=i.shaderProcessingContext.attributeNamesFromEffect,r=i.shaderProcessingContext.attributeLocationsFromEffect;let a,o;for(let h=0;h<s.length;h++){const u=r[h];let c=(this._overrideVertexBuffers&&this._overrideVertexBuffers[s[h]])??this._vertexBuffers[s[h]];c||(c=this._emptyVertexBuffer);let f=(l=c.effectiveBuffer)==null?void 0:l.underlyingResource,d=c.effectiveByteOffset;const _=!c._validOffsetRange;if(!(a&&o&&a===f)||_){const p={arrayStride:c.effectiveByteStride,stepMode:c.getIsInstanced()?"instance":"vertex",attributes:[]};t.push(p),o=p.attributes,_&&(d=0,f=null)}o.push({shaderLocation:u,offset:d,format:at._GetVertexInputDescriptorFormat(c)}),a=f}return t}_createRenderPipeline(e,t,i){var _;const s=e._pipelineContext,r=this._getVertexInputDescriptor(e),a=this._createPipelineLayout(s),o=[],l=this._getAphaBlendState(),h=this._getColorBlendState();if(this._vertexBuffers&&EA(this._vertexBuffers,e),this._mrtAttachments1>0)for(let p=0;p<this._mrtFormats.length;++p){const g=this._mrtFormats[p];if(g){const m={format:g,writeMask:this._mrtEnabledMask&1<<p?this._writeMask:0};l&&h&&(m.blend={alpha:l,color:h}),o.push(m)}else o.push(null)}else if(this._webgpuColorFormat[0]){const p={format:this._webgpuColorFormat[0],writeMask:this._writeMask};l&&h&&(p.blend={alpha:l,color:h}),o.push(p)}else o.push(null);const u={compare:at._GetCompareFunction(this._stencilEnabled?this._stencilFrontCompare:7),depthFailOp:at._GetStencilOpFunction(this._stencilEnabled?this._stencilFrontDepthFailOp:1),failOp:at._GetStencilOpFunction(this._stencilEnabled?this._stencilFrontFailOp:1),passOp:at._GetStencilOpFunction(this._stencilEnabled?this._stencilFrontPassOp:1)},c=t==="triangle-list"||t==="triangle-strip";let f;(t==="line-strip"||t==="triangle-strip")&&(f=!this._indexBuffer||this._indexBuffer.is32Bits?"uint32":"uint16");const d=this._webgpuDepthStencilFormat?We.HasStencilAspect(this._webgpuDepthStencilFormat):!1;return this._device.createRenderPipeline({label:`RenderPipeline_${((_=o[0])==null?void 0:_.format)??"nooutput"}_${this._webgpuDepthStencilFormat??"nodepth"}_samples${i}_textureState${this._textureState}`,layout:a,vertex:{module:s.stages.vertexStage.module,entryPoint:s.stages.vertexStage.entryPoint,buffers:r},primitive:{topology:t,stripIndexFormat:f,frontFace:this._frontFace===1?"ccw":"cw",cullMode:this._cullEnabled?this._cullFace===2?"front":"back":"none"},fragment:s.stages.fragmentStage?{module:s.stages.fragmentStage.module,entryPoint:s.stages.fragmentStage.entryPoint,targets:o}:void 0,multisample:{count:i},depthStencil:this._webgpuDepthStencilFormat===void 0?void 0:{depthWriteEnabled:this._depthWriteEnabled,depthCompare:this._depthTestEnabled?at._GetCompareFunction(this._depthCompare):"always",format:this._webgpuDepthStencilFormat,stencilFront:this._stencilEnabled&&d?u:void 0,stencilBack:this._stencilEnabled&&d?u:void 0,stencilReadMask:this._stencilEnabled&&d?this._stencilReadMask:void 0,stencilWriteMask:this._stencilEnabled&&d?this._stencilWriteMask:void 0,depthBias:this._depthBias,depthBiasClamp:c?this._depthBiasClamp:0,depthBiasSlopeScale:c?this._depthBiasSlopeScale:0}})}}at.LogErrorIfNoVertexBuffer=!1;at.NumCacheHitWithoutHash=0;at.NumCacheHitWithHash=0;at.NumCacheMiss=0;at.NumPipelineCreationLastFrame=0;at._NumPipelineCreationCurrentFrame=0;class Bc{constructor(){this.values={}}count(){let e=0,t=this.pipeline?1:0;for(const i in this.values){const s=this.values[i],[r,a]=s.count();e+=r,t+=a,e++}return[e,t]}}class bs extends at{static GetNodeCounts(){const e=bs._Cache.count();return{nodeCount:e[0],pipelineCount:e[1]}}static _GetPipelines(e,t,i,s){if(e.pipeline){const r=i.slice();r.length=s,t.push(r)}for(const r in e.values){const a=e.values[r];i[s]=parseInt(r),bs._GetPipelines(a,t,i,s+1)}}static GetPipelines(){const e=[];return bs._GetPipelines(bs._Cache,e,[],0),e}static ResetCache(){bs._Cache=new Bc}reset(){this._nodeStack=[],this._nodeStack[0]=bs._Cache,super.reset()}_getRenderPipeline(e){let t=this._nodeStack[this._stateDirtyLowestIndex];for(let i=this._stateDirtyLowestIndex;i<this._statesLength;++i){let s=t.values[this._states[i]];s||(s=new Bc,t.values[this._states[i]]=s),t=s,this._nodeStack[i+1]=t}e.token=t,e.pipeline=t.pipeline}_setRenderPipeline(e){e.token.pipeline=e.pipeline}}bs._Cache=new Bc;class SA extends av{constructor(e){super(!1),this._cache=e,this.reset()}get func(){return this._func}set func(e){this._func!==e&&(this._func=e,this._cache.setStencilCompare(e))}get funcMask(){return this._funcMask}set funcMask(e){this._funcMask!==e&&(this._funcMask=e,this._cache.setStencilReadMask(e))}get opStencilFail(){return this._opStencilFail}set opStencilFail(e){this._opStencilFail!==e&&(this._opStencilFail=e,this._cache.setStencilFailOp(e))}get opDepthFail(){return this._opDepthFail}set opDepthFail(e){this._opDepthFail!==e&&(this._opDepthFail=e,this._cache.setStencilDepthFailOp(e))}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(e){this._opStencilDepthPass!==e&&(this._opStencilDepthPass=e,this._cache.setStencilPassOp(e))}get mask(){return this._mask}set mask(e){this._mask!==e&&(this._mask=e,this._cache.setStencilWriteMask(e))}get enabled(){return this._enabled}set enabled(e){this._enabled!==e&&(this._enabled=e,this._cache.setStencilEnabled(e))}reset(){super.reset(),this._cache.resetStencilState()}apply(){var t;const e=(t=this.stencilMaterial)==null?void 0:t.enabled;this.enabled=e?this.stencilMaterial.enabled:this.stencilGlobal.enabled,this.enabled&&(this.func=e?this.stencilMaterial.func:this.stencilGlobal.func,this.funcRef=e?this.stencilMaterial.funcRef:this.stencilGlobal.funcRef,this.funcMask=e?this.stencilMaterial.funcMask:this.stencilGlobal.funcMask,this.opStencilFail=e?this.stencilMaterial.opStencilFail:this.stencilGlobal.opStencilFail,this.opDepthFail=e?this.stencilMaterial.opDepthFail:this.stencilGlobal.opDepthFail,this.opStencilDepthPass=e?this.stencilMaterial.opStencilDepthPass:this.stencilGlobal.opStencilDepthPass,this.mask=e?this.stencilMaterial.mask:this.stencilGlobal.mask)}}class RA extends rv{constructor(e){super(!1),this._cache=e,this.reset()}get zOffset(){return this._zOffset}set zOffset(e){this._zOffset!==e&&(this._zOffset=e,this._isZOffsetDirty=!0,this._cache.setDepthBiasSlopeScale(e))}get zOffsetUnits(){return this._zOffsetUnits}set zOffsetUnits(e){this._zOffsetUnits!==e&&(this._zOffsetUnits=e,this._isZOffsetDirty=!0,this._cache.setDepthBias(e))}get cullFace(){return this._cullFace}set cullFace(e){this._cullFace!==e&&(this._cullFace=e,this._isCullFaceDirty=!0,this._cache.setCullFace(e??1))}get cull(){return this._cull}set cull(e){this._cull!==e&&(this._cull=e,this._isCullDirty=!0,this._cache.setCullEnabled(!!e))}get depthFunc(){return this._depthFunc}set depthFunc(e){this._depthFunc!==e&&(this._depthFunc=e,this._isDepthFuncDirty=!0,this._cache.setDepthCompare(e))}get depthMask(){return this._depthMask}set depthMask(e){this._depthMask!==e&&(this._depthMask=e,this._isDepthMaskDirty=!0,this._cache.setDepthWriteEnabled(e))}get depthTest(){return this._depthTest}set depthTest(e){this._depthTest!==e&&(this._depthTest=e,this._isDepthTestDirty=!0,this._cache.setDepthTestEnabled(e))}get frontFace(){return this._frontFace}set frontFace(e){this._frontFace!==e&&(this._frontFace=e,this._isFrontFaceDirty=!0,this._cache.setFrontFace(e??2))}reset(){super.reset(),this._cache.resetDepthCullingState()}apply(){}}class Nv{static IsExternalTexture(e){return e.underlyingResource!==void 0}getClassName(){return"ExternalTexture"}get underlyingResource(){return this._video}constructor(e){this.useMipMaps=!1,this.type=16,this.format=4294967295,this._video=e,this.uniqueId=gt._Counter++}isReady(){return this._video.readyState>=this._video.HAVE_CURRENT_DATA}dispose(){}}class yh{get forceBindGroupCreation(){return this._numExternalTextures>0}get hasFloatOrDepthTextures(){return this._numFloatOrDepthTextures>0}constructor(){this.uniqueId=yh._Counter++,this.updateId=0,this.textureState=0,this.reset()}reset(){this.samplers={},this.textures={},this.isDirty=!0,this._numFloatOrDepthTextures=0,this._numExternalTextures=0}setSampler(e,t){let i=this.samplers[e],s=-1;i?s=i.hashCode:this.samplers[e]=i={sampler:t,hashCode:0},i.sampler=t,i.hashCode=t?vr.GetSamplerHashCode(t):0;const r=s!==i.hashCode;r&&this.updateId++,this.isDirty||(this.isDirty=r)}setTexture(e,t){var a;let i=this.textures[e],s=-1;i?s=((a=i.texture)==null?void 0:a.uniqueId)??-1:this.textures[e]=i={texture:t,isFloatOrDepthTexture:!1,isExternalTexture:!1},i.isExternalTexture&&this._numExternalTextures--,i.isFloatOrDepthTexture&&this._numFloatOrDepthTextures--,t?(i.isFloatOrDepthTexture=t.type===1||t.format>=13&&t.format<=18,i.isExternalTexture=Nv.IsExternalTexture(t),i.isFloatOrDepthTexture&&this._numFloatOrDepthTextures++,i.isExternalTexture&&this._numExternalTextures++):(i.isFloatOrDepthTexture=!1,i.isExternalTexture=!1),i.texture=t;const r=s!==((t==null?void 0:t.uniqueId)??-1);r&&this.updateId++,this.isDirty||(this.isDirty=r)}}yh._Counter=0;class xh{isDirty(e){return this._isDirty||this._materialContextUpdateId!==e}resetIsDirty(e){this._isDirty=!1,this._materialContextUpdateId=e}get useInstancing(){return this._useInstancing}set useInstancing(e){this._useInstancing!==e&&(e?(this.indirectDrawBuffer=this._bufferManager.createRawBuffer(20,Xe.CopyDst|Xe.Indirect|Xe.Storage,void 0,"IndirectDrawBuffer"),this._indirectDrawData=new Uint32Array(5),this._indirectDrawData[3]=0,this._indirectDrawData[4]=0):(this.indirectDrawBuffer&&this._bufferManager.releaseBuffer(this.indirectDrawBuffer),this.indirectDrawBuffer=void 0,this._indirectDrawData=void 0),this._useInstancing=e,this._currentInstanceCount=-1)}constructor(e){this._bufferManager=e,this.uniqueId=xh._Counter++,this._useInstancing=!1,this._currentInstanceCount=0,this.reset()}reset(){this.buffers={},this._isDirty=!0,this._materialContextUpdateId=0,this.fastBundle=void 0,this.bindGroups=void 0}setBuffer(e,t){var i;this._isDirty||(this._isDirty=(t==null?void 0:t.uniqueId)!==((i=this.buffers[e])==null?void 0:i.uniqueId)),this.buffers[e]=t}setIndirectData(e,t,i){t===this._currentInstanceCount||!this.indirectDrawBuffer||!this._indirectDrawData||(this._currentInstanceCount=t,this._indirectDrawData[0]=e,this._indirectDrawData[1]=t,this._indirectDrawData[2]=i,this._bufferManager.setRawData(this.indirectDrawBuffer,0,this._indirectDrawData,0,20))}dispose(){this.indirectDrawBuffer&&(this._bufferManager.releaseBuffer(this.indirectDrawBuffer),this.indirectDrawBuffer=void 0,this._indirectDrawData=void 0),this.fastBundle=void 0,this.bindGroups=void 0,this.buffers=void 0}}xh._Counter=0;const IA=1<<20,CA=2**35;class ro{constructor(){this.values={}}}class qe{static get Statistics(){return{totalCreated:qe.NumBindGroupsCreatedTotal,lastFrameCreated:qe.NumBindGroupsCreatedLastFrame,lookupLastFrame:qe.NumBindGroupsLookupLastFrame,noLookupLastFrame:qe.NumBindGroupsNoLookupLastFrame}}static ResetCache(){qe._Cache=new ro,qe.NumBindGroupsCreatedTotal=0,qe.NumBindGroupsCreatedLastFrame=0,qe.NumBindGroupsLookupLastFrame=0,qe.NumBindGroupsNoLookupLastFrame=0,qe._NumBindGroupsCreatedCurrentFrame=0,qe._NumBindGroupsLookupCurrentFrame=0,qe._NumBindGroupsNoLookupCurrentFrame=0}constructor(e,t,i){this.disabled=!1,this._device=e,this._cacheSampler=t,this._engine=i}endFrame(){qe.NumBindGroupsCreatedLastFrame=qe._NumBindGroupsCreatedCurrentFrame,qe.NumBindGroupsLookupLastFrame=qe._NumBindGroupsLookupCurrentFrame,qe.NumBindGroupsNoLookupLastFrame=qe._NumBindGroupsNoLookupCurrentFrame,qe._NumBindGroupsCreatedCurrentFrame=0,qe._NumBindGroupsLookupCurrentFrame=0,qe._NumBindGroupsNoLookupCurrentFrame=0}getBindGroups(e,t,i){var l,h,u,c,f,d;let s,r=qe._Cache;const a=this.disabled||i.forceBindGroupCreation;if(!a){if(!t.isDirty(i.updateId)&&!i.isDirty)return qe._NumBindGroupsNoLookupCurrentFrame++,t.bindGroups;for(const _ of e.shaderProcessingContext.bufferNames){const p=(((l=t.buffers[_])==null?void 0:l.uniqueId)??0)+IA;let g=r.values[p];g||(g=new ro,r.values[p]=g),r=g}for(const _ of e.shaderProcessingContext.samplerNames){const p=((h=i.samplers[_])==null?void 0:h.hashCode)??0;let g=r.values[p];g||(g=new ro,r.values[p]=g),r=g}for(const _ of e.shaderProcessingContext.textureNames){const p=(((c=(u=i.textures[_])==null?void 0:u.texture)==null?void 0:c.uniqueId)??0)+CA;let g=r.values[p];g||(g=new ro,r.values[p]=g),r=g}s=r.bindGroups}if(t.resetIsDirty(i.updateId),i.isDirty=!1,s)return t.bindGroups=s,qe._NumBindGroupsLookupCurrentFrame++,s;s=[],t.bindGroups=s,a||(r.bindGroups=s),qe.NumBindGroupsCreatedTotal++,qe._NumBindGroupsCreatedCurrentFrame++;const o=e.bindGroupLayouts[i.textureState];for(let _=0;_<e.shaderProcessingContext.bindGroupLayoutEntries.length;_++){const p=e.shaderProcessingContext.bindGroupLayoutEntries[_],g=e.shaderProcessingContext.bindGroupEntries[_];for(let v=0;v<p.length;v++){const T=e.shaderProcessingContext.bindGroupLayoutEntries[_][v],A=e.shaderProcessingContext.bindGroupLayoutEntryInfo[_][T.binding],b=A.nameInArrayOfTexture??A.name;if(T.sampler){const x=i.samplers[b];if(x){const E=x.sampler;if(!E){this._engine.dbgSanityChecks&&U.Error(`Trying to bind a null sampler! entry=${JSON.stringify(T)}, name=${b}, bindingInfo=${JSON.stringify(x,(R,C)=>R==="texture"?"<no dump>":C)}, materialContext.uniqueId=${i.uniqueId}`,50);continue}g[v].resource=this._cacheSampler.getSampler(E,!1,x.hashCode,E.label)}else U.Error(`Sampler "${b}" could not be bound. entry=${JSON.stringify(T)}, materialContext=${JSON.stringify(i,(E,R)=>E==="texture"||E==="sampler"?"<no dump>":R)}`,50)}else if(T.texture||T.storageTexture){const x=i.textures[b];if(x){if(this._engine.dbgSanityChecks&&x.texture===null){U.Error(`Trying to bind a null texture! entry=${JSON.stringify(T)}, bindingInfo=${JSON.stringify(x,(R,C)=>R==="texture"?"<no dump>":C)}, materialContext.uniqueId=${i.uniqueId}`,50);continue}const E=x.texture._hardwareTexture;if(this._engine.dbgSanityChecks&&(!E||T.texture&&!E.view||T.storageTexture&&!E.viewForWriting)){U.Error(`Trying to bind a null gpu texture or view! entry=${JSON.stringify(T)}, name=${b}, bindingInfo=${JSON.stringify(x,(R,C)=>R==="texture"?"<no dump>":C)}, isReady=${(f=x.texture)==null?void 0:f.isReady}, materialContext.uniqueId=${i.uniqueId}`,50);continue}g[v].resource=T.storageTexture?E.viewForWriting:E.view}else U.Error(`Texture "${b}" could not be bound. entry=${JSON.stringify(T)}, materialContext=${JSON.stringify(i,(E,R)=>E==="texture"||E==="sampler"?"<no dump>":R)}`,50)}else if(T.externalTexture){const x=i.textures[b];if(x){if(this._engine.dbgSanityChecks&&x.texture===null){U.Error(`Trying to bind a null external texture! entry=${JSON.stringify(T)}, name=${b}, bindingInfo=${JSON.stringify(x,(R,C)=>R==="texture"?"<no dump>":C)}, materialContext.uniqueId=${i.uniqueId}`,50);continue}const E=x.texture.underlyingResource;if(this._engine.dbgSanityChecks&&!E){U.Error(`Trying to bind a null gpu external texture! entry=${JSON.stringify(T)}, name=${b}, bindingInfo=${JSON.stringify(x,(R,C)=>R==="texture"?"<no dump>":C)}, isReady=${(d=x.texture)==null?void 0:d.isReady}, materialContext.uniqueId=${i.uniqueId}`,50);continue}g[v].resource=this._device.importExternalTexture({source:E})}else U.Error(`Texture "${b}" could not be bound. entry=${JSON.stringify(T)}, materialContext=${JSON.stringify(i,(E,R)=>E==="texture"||E==="sampler"?"<no dump>":R)}`,50)}else if(T.buffer){const x=t.buffers[b];if(x){const E=x.underlyingResource;g[v].resource.buffer=E,g[v].resource.size=x.capacity}else U.Error(`Can't find buffer "${b}". entry=${JSON.stringify(T)}, buffers=${JSON.stringify(t.buffers)}, drawContext.uniqueId=${t.uniqueId}`,50)}}const m=o[_];s[_]=this._device.createBindGroup({layout:m,entries:g})}return s}}qe.NumBindGroupsCreatedTotal=0;qe.NumBindGroupsCreatedLastFrame=0;qe.NumBindGroupsLookupLastFrame=0;qe.NumBindGroupsNoLookupLastFrame=0;qe._Cache=new ro;qe._NumBindGroupsCreatedCurrentFrame=0;qe._NumBindGroupsLookupCurrentFrame=0;qe._NumBindGroupsNoLookupCurrentFrame=0;const Tg="clearQuadVertexShader",MA=`uniform depthValue: f32;const pos=array(
vec2f(-1.0,1.0),
vec2f(1.0,1.0),
vec2f(-1.0,-1.0),
vec2f(1.0,-1.0)
);
#define CUSTOM_VERTEX_DEFINITIONS
@vertex
fn main(input : VertexInputs)->FragmentInputs {
#define CUSTOM_VERTEX_MAIN_BEGIN
vertexOutputs.position=vec4f(pos[input.vertexIndex],uniforms.depthValue,1.0);
#define CUSTOM_VERTEX_MAIN_END
}
`;ye.ShadersStoreWGSL[Tg]||(ye.ShadersStoreWGSL[Tg]=MA);const Ag="clearQuadPixelShader",PA=`uniform color: vec4f;@fragment
fn main(input: FragmentInputs)->FragmentOutputs {fragmentOutputs.color=uniforms.color;}
`;ye.ShadersStoreWGSL[Ag]||(ye.ShadersStoreWGSL[Ag]=PA);class wA{setDepthStencilFormat(e){this._depthTextureFormat=e,this._cacheRenderPipeline.setDepthStencilFormat(e)}setColorFormat(e){this._cacheRenderPipeline.setColorFormat(e)}setMRTAttachments(e,t,i){this._cacheRenderPipeline.setMRT(t,i),this._cacheRenderPipeline.setMRTAttachments(e)}constructor(e,t,i){this._bindGroups={},this._bundleCache={},this._keyTemp=[],this._device=e,this._engine=t,this._cacheRenderPipeline=new bs(this._device,i),this._cacheRenderPipeline.setDepthTestEnabled(!1),this._cacheRenderPipeline.setStencilReadMask(255),this._effect=t.createEffect("clearQuad",[],["color","depthValue"],void 0,void 0,void 0,void 0,void 0,void 0,1)}clear(e,t,i,s,r=1){let a,o=null,l;const h=!!this._engine._currentRenderTarget;if(e)a=e;else{let g=0;this._keyTemp.length=0;for(let v=0;v<this._cacheRenderPipeline.colorFormats.length;++v)this._keyTemp[g++]=ks[this._cacheRenderPipeline.colorFormats[v]??""];const m=ks[this._depthTextureFormat??0];if(this._keyTemp[g]=(t?t.r+t.g*256+t.b*256*256+t.a*256*256*256:0)+(i?2**32:0)+(s?2**33:0)+(this._engine.useReverseDepthBuffer?2**34:0)+(h?2**35:0)+(r>1?2**36:0)+m*2**37,l=this._keyTemp.join("_"),o=this._bundleCache[l],o)return o;a=this._device.createRenderBundleEncoder({label:"clearQuadRenderBundle",colorFormats:this._cacheRenderPipeline.colorFormats,depthStencilFormat:this._depthTextureFormat,sampleCount:We.GetSample(r)})}this._cacheRenderPipeline.setDepthWriteEnabled(!!i),this._cacheRenderPipeline.setStencilEnabled(!!s&&!!this._depthTextureFormat&&We.HasStencilAspect(this._depthTextureFormat)),this._cacheRenderPipeline.setStencilWriteMask(s?255:0),this._cacheRenderPipeline.setStencilCompare(s?519:512),this._cacheRenderPipeline.setStencilPassOp(s?7681:7680),this._cacheRenderPipeline.setWriteMask(t?15:0);const u=this._cacheRenderPipeline.getRenderPipeline(7,this._effect,r),c=this._effect._pipelineContext;t&&this._effect.setDirectColor4("color",t),this._effect.setFloat("depthValue",this._engine.useReverseDepthBuffer?this._engine._clearReverseDepthValue:this._engine._clearDepthValue),c.uniformBuffer.update();const f=h?this._engine._ubInvertY:this._engine._ubDontInvertY,d=c.uniformBuffer.getBuffer(),_=d.uniqueId+"-"+f.uniqueId;let p=this._bindGroups[_];if(!p){const g=c.bindGroupLayouts[0];p=this._bindGroups[_]=[],p.push(this._device.createBindGroup({label:`clearQuadBindGroup0-${_}`,layout:g[0],entries:[]})),Di._SimplifiedKnownBindings||p.push(this._device.createBindGroup({label:`clearQuadBindGroup1-${_}`,layout:g[1],entries:[]})),p.push(this._device.createBindGroup({label:`clearQuadBindGroup${Di._SimplifiedKnownBindings?1:2}-${_}`,layout:g[Di._SimplifiedKnownBindings?1:2],entries:[{binding:0,resource:{buffer:f.underlyingResource,size:f.capacity}},{binding:1,resource:{buffer:d.underlyingResource,size:d.capacity}}]}))}a.setPipeline(u);for(let g=0;g<p.length;++g)a.setBindGroup(g,p[g]);return a.draw(4,1,0,0),e||(o=a.finish(),this._bundleCache[l]=o),o}}class pd{constructor(e,t,i,s){this.x=Math.floor(e),this.y=Math.floor(t),this.w=Math.floor(i),this.h=Math.floor(s)}run(e){e.setViewport(this.x,this.y,this.w,this.h,0,1)}clone(){return new pd(this.x,this.y,this.w,this.h)}}class gd{constructor(e,t,i,s){this.x=e,this.y=t,this.w=i,this.h=s}run(e){e.setScissorRect(this.x,this.y,this.w,this.h)}clone(){return new gd(this.x,this.y,this.w,this.h)}}class Wl{constructor(e){this.ref=e}run(e){e.setStencilReference(this.ref)}clone(){return new Wl(this.ref)}}class md{constructor(e){this.color=e}run(e){e.setBlendConstant(this.color)}clone(){return new md(this.color)}}class vd{constructor(e){this.query=e}run(e){e.beginOcclusionQuery(this.query)}clone(){return new vd(this.query)}}class yd{constructor(){}run(e){e.endOcclusionQuery()}clone(){return new yd}}class xd{constructor(){this.bundles=[]}run(e){e.executeBundles(this.bundles)}clone(){const e=new xd;return e.bundles=this.bundles,e}}class bd{constructor(e){this.numDrawCalls=0,this._device=e,this._list=new Array(10),this._listLength=0}addBundle(e){if(!this._currentItemIsBundle){const t=new xd;this._list[this._listLength++]=t,this._currentBundleList=t.bundles,this._currentItemIsBundle=!0}e&&this._currentBundleList.push(e)}_finishBundle(){this._currentItemIsBundle&&this._bundleEncoder&&(this._currentBundleList.push(this._bundleEncoder.finish()),this._bundleEncoder=void 0,this._currentItemIsBundle=!1)}addItem(e){this._finishBundle(),this._list[this._listLength++]=e,this._currentItemIsBundle=!1}getBundleEncoder(e,t,i){return this._currentItemIsBundle||(this.addBundle(),this._bundleEncoder=this._device.createRenderBundleEncoder({colorFormats:e,depthStencilFormat:t,sampleCount:We.GetSample(i)})),this._bundleEncoder}close(){this._finishBundle()}run(e){this.close();for(let t=0;t<this._listLength;++t)this._list[t].run(e)}reset(){this._listLength=0,this._currentItemIsBundle=!1,this.numDrawCalls=0}clone(){this.close();const e=new bd(this._device);e._list=new Array(this._listLength),e._listLength=this._listLength,e.numDrawCalls=this.numDrawCalls;for(let t=0;t<this._listLength;++t)e._list[t]=this._list[t].clone();return e}}class Uv{get querySet(){return this._querySet}constructor(e,t,i,s,r,a=!0,o){this._dstBuffers=[],this._engine=e,this._device=s,this._bufferManager=r,this._count=t,this._canUseMultipleBuffers=a,this._querySet=s.createQuerySet({label:o??"QuerySet",type:i,count:t}),this._queryBuffer=r.createRawBuffer(8*t,Xe.QueryResolve|Xe.CopySrc,void 0,"QueryBuffer"),a||this._dstBuffers.push(this._bufferManager.createRawBuffer(8*this._count,Xe.MapRead|Xe.CopyDst,void 0,"QueryBufferNoMultipleBuffers"))}_getBuffer(e,t){if(!this._canUseMultipleBuffers&&this._dstBuffers.length===0)return null;const i=this._device.createCommandEncoder();let s;return this._dstBuffers.length===0?s=this._bufferManager.createRawBuffer(8*this._count,Xe.MapRead|Xe.CopyDst,void 0,"QueryBufferAdditionalBuffer"):(s=this._dstBuffers[this._dstBuffers.length-1],this._dstBuffers.length--),i.resolveQuerySet(this._querySet,e,t,this._queryBuffer,0),i.copyBufferToBuffer(this._queryBuffer,0,s,0,8*t),this._device.queue.submit([i.finish()]),s}async readValues(e=0,t=1){const i=this._getBuffer(e,t);if(i===null)return null;const s=this._engine.uniqueId;return i.mapAsync(1).then(()=>{const r=new BigUint64Array(i.getMappedRange()).slice();return i.unmap(),this._dstBuffers[this._dstBuffers.length]=i,r},r=>{if(this._engine.isDisposed||this._engine.uniqueId!==s)return null;throw r})}async readValue(e=0){const t=this._getBuffer(e,1);if(t===null)return null;const i=this._engine.uniqueId;return t.mapAsync(1).then(()=>{const s=new BigUint64Array(t.getMappedRange()),r=Number(s[0]);return t.unmap(),this._dstBuffers[this._dstBuffers.length]=t,r},s=>{if(this._engine.isDisposed||this._engine.uniqueId!==i)return 0;throw s})}async readTwoValuesAndSubtract(e=0){const t=this._getBuffer(e,2);if(t===null)return null;const i=this._engine.uniqueId;return t.mapAsync(1).then(()=>{const s=new BigUint64Array(t.getMappedRange()),r=Number(s[1]-s[0]);return t.unmap(),this._dstBuffers[this._dstBuffers.length]=t,r},s=>{if(this._engine.isDisposed||this._engine.uniqueId!==i)return 0;throw s})}dispose(){this._querySet.destroy(),this._bufferManager.releaseBuffer(this._queryBuffer);for(let e=0;e<this._dstBuffers.length;++e)this._bufferManager.releaseBuffer(this._dstBuffers[e])}}class DA{get gpuFrameTimeCounter(){return this._gpuFrameTimeCounter}constructor(e,t,i){this._enabled=!1,this._gpuFrameTimeCounter=new Hi,this._measureDurationState=0,this._engine=e,this._device=t,this._bufferManager=i}get enable(){return this._enabled}set enable(e){if(this._enabled!==e)if(this._enabled=e,this._measureDurationState=0,e)try{this._measureDuration=new OA(this._engine,this._device,this._bufferManager,2e3,"QuerySet_TimestampQuery")}catch(t){this._enabled=!1,U.Error(`Could not create a WebGPUDurationMeasure!
Error: `+t.message+`
Make sure timestamp query is supported and enabled in your browser.`);return}else this._measureDuration.dispose()}startFrame(e){this._enabled&&this._measureDurationState===0&&(this._measureDuration.start(e),this._measureDurationState=1)}endFrame(e){this._measureDurationState===1&&(this._measureDurationState=2,this._measureDuration.stop(e).then(t=>{t!==null&&t>=0&&(this._gpuFrameTimeCounter.fetchNewFrame(),this._gpuFrameTimeCounter.addCount(t,!0)),this._measureDurationState=0}))}startPass(e,t){this._enabled?this._measureDuration.startPass(e,t):e.timestampWrites=void 0}endPass(e,t){if(!this._enabled||!t)return;const i=this._engine.frameId;this._measureDuration.stopPass(e).then(s=>{t._addDuration(i,s!==null&&s>0?s:0)})}dispose(){var e;(e=this._measureDuration)==null||e.dispose()}}class OA{constructor(e,t,i,s=2,r){this._count=s,this._querySet=new Uv(e,s,"timestamp",t,i,!0,r)}start(e){var t;(t=e.writeTimestamp)==null||t.call(e,this._querySet.querySet,0)}async stop(e){var t;return(t=e.writeTimestamp)==null||t.call(e,this._querySet.querySet,1),e.writeTimestamp?this._querySet.readTwoValuesAndSubtract(0):0}startPass(e,t){if(t+3>this._count)throw new Error("WebGPUDurationMeasure: index out of range ("+t+")");e.timestampWrites={querySet:this._querySet.querySet,beginningOfPassWriteIndex:t+2,endOfPassWriteIndex:t+3}}async stopPass(e){return this._querySet.readTwoValuesAndSubtract(e+2)}dispose(){this._querySet.dispose()}}class FA{get querySet(){return this._querySet.querySet}get hasQueries(){return this._currentTotalIndices!==this._availableIndices.length}canBeginQuery(e){if(this._frameQuerySetIsDirty===this._engine.frameId||this._queryFrameId[e]===this._engine.frameId)return!1;const t=this._engine._getCurrentRenderPassWrapper().renderPassDescriptor.occlusionQuerySet!==void 0;return t&&(this._queryFrameId[e]=this._engine.frameId),t}constructor(e,t,i,s=50,r=100){this._availableIndices=[],this._frameQuerySetIsDirty=-1,this._queryFrameId=[],this._engine=e,this._device=t,this._bufferManager=i,this._frameLastBuffer=-1,this._currentTotalIndices=0,this._countIncrement=r,this._allocateNewIndices(s)}createQuery(){this._availableIndices.length===0&&this._allocateNewIndices();const e=this._availableIndices[this._availableIndices.length-1];return this._availableIndices.length--,e}deleteQuery(e){this._availableIndices[this._availableIndices.length]=e}isQueryResultAvailable(e){return this._retrieveQueryBuffer(),!!this._lastBuffer&&e<this._lastBuffer.length}getQueryResult(e){var t;return Number(((t=this._lastBuffer)==null?void 0:t[e])??-1)}_retrieveQueryBuffer(){this._lastBuffer&&this._frameLastBuffer===this._engine.frameId||this._frameLastBuffer!==this._engine.frameId&&(this._frameLastBuffer=this._engine.frameId,this._querySet.readValues(0,this._currentTotalIndices).then(e=>{this._lastBuffer=e}))}_allocateNewIndices(e){e=e??this._countIncrement,this._delayQuerySetDispose();for(let t=0;t<e;++t)this._availableIndices.push(this._currentTotalIndices+t);this._currentTotalIndices+=e,this._querySet=new Uv(this._engine,this._currentTotalIndices,"occlusion",this._device,this._bufferManager,!1,"QuerySet_OcclusionQuery_count_"+this._currentTotalIndices),this._frameQuerySetIsDirty=this._engine.frameId}_delayQuerySetDispose(){const e=this._querySet;e&&setTimeout(()=>e.dispose,1e3)}dispose(){var e;(e=this._querySet)==null||e.dispose(),this._availableIndices.length=0}}class bh{get code(){return this._sourceCode}constructor(e,t=20){this.debug=!1,this._sourceCode=e,this._numMaxIterations=t,this._functionDescr=[],this.inlineToken="#define inline"}processCode(){this.debug&&U.Log(`Start inlining process (code size=${this._sourceCode.length})...`),this._collectFunctions(),this._processInlining(this._numMaxIterations),this.debug&&U.Log("End of inlining process.")}_collectFunctions(){let e=0;for(;e<this._sourceCode.length;){const t=this._sourceCode.indexOf(this.inlineToken,e);if(t<0)break;const i=this._sourceCode.indexOf("(",t+this.inlineToken.length);if(i<0){this.debug&&U.Warn(`Could not find the opening parenthesis after the token. startIndex=${e}`),e=t+this.inlineToken.length;continue}const s=bh._RegexpFindFunctionNameAndType.exec(this._sourceCode.substring(t+this.inlineToken.length,i));if(!s){this.debug&&U.Warn(`Could not extract the name/type of the function from: ${this._sourceCode.substring(t+this.inlineToken.length,i)}`),e=t+this.inlineToken.length;continue}const[r,a]=[s[3],s[4]],o=N0("(",")",this._sourceCode,i);if(o<0){this.debug&&U.Warn(`Could not extract the parameters the function '${a}' (type=${r}). funcParamsStartIndex=${i}`),e=t+this.inlineToken.length;continue}const l=this._sourceCode.substring(i+1,o),h=hg(this._sourceCode,o+1);if(h===this._sourceCode.length){this.debug&&U.Warn(`Could not extract the body of the function '${a}' (type=${r}). funcParamsEndIndex=${o}`),e=t+this.inlineToken.length;continue}const u=N0("{","}",this._sourceCode,h);if(u<0){this.debug&&U.Warn(`Could not extract the body of the function '${a}' (type=${r}). funcBodyStartIndex=${h}`),e=t+this.inlineToken.length;continue}const c=this._sourceCode.substring(h,u+1),f=Dc(l).split(","),d=[];for(let g=0;g<f.length;++g){const m=f[g].trim(),v=m.lastIndexOf(" ");v>=0&&d.push(m.substring(v+1))}r!=="void"&&d.push("return"),this._functionDescr.push({name:a,type:r,parameters:d,body:c,callIndex:0}),e=u+1;const _=t>0?this._sourceCode.substring(0,t):"",p=u+1<this._sourceCode.length-1?this._sourceCode.substring(u+1):"";this._sourceCode=_+p,e-=u+1-t}this.debug&&U.Log(`Collect functions: ${this._functionDescr.length} functions found. functionDescr=${this._functionDescr}`)}_processInlining(e=20){for(;e-->=0&&this._replaceFunctionCallsByCode(););return this.debug&&U.Log(`numMaxIterations is ${e} after inlining process`),e>=0}_replaceFunctionCallsByCode(){let e=!1;for(const t of this._functionDescr){const{name:i,type:s,parameters:r,body:a}=t;let o=0;for(;o<this._sourceCode.length;){const l=this._sourceCode.indexOf(i,o);if(l<0)break;if(l===0||yu(this._sourceCode.charAt(l-1))){o=l+i.length;continue}const h=hg(this._sourceCode,l+i.length);if(h===this._sourceCode.length||this._sourceCode.charAt(h)!=="("){o=l+i.length;continue}const u=N0("(",")",this._sourceCode,h);if(u<0){this.debug&&U.Warn(`Could not extract the parameters of the function call. Function '${i}' (type=${s}). callParamsStartIndex=${h}`),o=l+i.length;continue}const c=this._sourceCode.substring(h+1,u),d=(T=>{const A=[];let b=0,x=0;for(;b<T.length;){if(T.charAt(b)==="("){const E=N0("(",")",T,b);if(E<0)return null;b=E}else T.charAt(b)===","&&(A.push(T.substring(x,b)),x=b+1);b++}return x<b&&A.push(T.substring(x,b)),A})(Dc(c));if(d===null){this.debug&&U.Warn(`Invalid function call: can't extract the parameters of the function call. Function '${i}' (type=${s}). callParamsStartIndex=${h}, callParams=`+c),o=l+i.length;continue}const _=[];for(let T=0;T<d.length;++T){const A=d[T].trim();_.push(A)}const p=s!=="void"?i+"_"+t.callIndex++:null;if(p&&_.push(p+" ="),_.length!==r.length){this.debug&&U.Warn(`Invalid function call: not the same number of parameters for the call than the number expected by the function. Function '${i}' (type=${s}). function parameters=${r}, call parameters=${_}`),o=l+i.length;continue}o=u+1;const g=this._replaceNames(a,r,_);let m=l>0?this._sourceCode.substring(0,l):"";const v=u+1<this._sourceCode.length-1?this._sourceCode.substring(u+1):"";if(p){const T=U4(this._sourceCode,l-1,`
`,"{");m=this._sourceCode.substring(0,T+1);const A=this._sourceCode.substring(T+1,l);this._sourceCode=m+s+" "+p+`;
`+g+`
`+A+p+v,this.debug&&U.Log(`Replace function call by code. Function '${i}' (type=${s}). injectDeclarationIndex=${T}, call parameters=${_}`)}else this._sourceCode=m+g+v,o+=g.length-(u+1-l),this.debug&&U.Log(`Replace function call by code. Function '${i}' (type=${s}). functionCallIndex=${l}, call parameters=${_}`);e=!0}}return e}_replaceNames(e,t,i){for(let s=0;s<t.length;++s){const r=new RegExp(k4(t[s]),"g"),a=t[s].length,o=i[s];e=e.replace(r,(l,...h)=>{const u=h[0];return yu(e.charAt(u-1))||yu(e.charAt(u+a))?t[s]:o})}return e}}bh._RegexpFindFunctionNameAndType=/((\s+?)(\w+)\s+(\w+)\s*?)$/;class Ii{async initTwgsl(e){if(!Ii._Twgsl)return e=e||{},e={...Ii._TWgslDefaultOptions,...e},e.twgsl?(Ii._Twgsl=e.twgsl,Promise.resolve()):(e.jsPath&&e.wasmPath&&await Z.LoadBabylonScriptAsync(e.jsPath),self.twgsl?(Ii._Twgsl=await self.twgsl(Z.GetBabylonScriptURL(e.wasmPath)),Promise.resolve()):Promise.reject("twgsl is not available."))}convertSpirV2WGSL(e,t=!1){const i=Ii._Twgsl.convertSpirV2WGSL(e,Ii.DisableUniformityAnalysis||t);return Ii.ShowWGSLShaderCode&&(U.Log(i),U.Log("***********************************************")),Ii.DisableUniformityAnalysis||t?`diagnostic(off, derivative_uniformity);
`+i:i}}Ii._TWgslDefaultOptions={jsPath:`${Z._DefaultCdnUrl}/twgsl/twgsl.js`,wasmPath:`${Z._DefaultCdnUrl}/twgsl/twgsl.wasm`};Ii.ShowWGSLShaderCode=!1;Ii.DisableUniformityAnalysis=!1;Ii._Twgsl=null;class LA{constructor(e,t,i){this._record=!1,this._play=!1,this._playBundleListIndex=0,this._allBundleLists=[],this._enabled=!1,this.showDebugLogs=!1,this._engine=e,this._mode=t,this._bundleList=i}get enabled(){return this._enabled}get play(){return this._play}get record(){return this._record}set enabled(e){this._log("enabled",`activate=${e}, mode=${this._mode}`),this._allBundleLists.length=0,this._record=this._enabled=e,this._play=!1,e&&(this._modeSaved=this._mode,this._mode=0)}get mode(){return this._mode}set mode(e){this._record?this._modeSaved=e:this._mode=e}endRenderPass(e){if(!this._record&&!this._play)return!1;let t=null;return this._record?(t=this._bundleList.clone(),this._allBundleLists.push(t),this._bundleList.reset(),this._log("endRenderPass",`bundleList recorded at position #${this._allBundleLists.length-1}`)):this._playBundleListIndex>=this._allBundleLists.length?this._log("endRenderPass",`empty or out-of-sync bundleList (_allBundleLists.length=${this._allBundleLists.length}, playBundleListIndex=${this._playBundleListIndex})`):(this._log("endRenderPass",`run bundleList #${this._playBundleListIndex}`),t=this._allBundleLists[this._playBundleListIndex++]),t&&(t.run(e),this._mode===1&&this._engine._reportDrawCall(t.numDrawCalls)),!0}endFrame(){this._record&&(this._record=!1,this._play=!0,this._mode=this._modeSaved,this._log("endFrame","bundles recorded, switching to play mode")),this._playBundleListIndex=0}reset(){this._log("reset","called"),this._record&&(this._mode=this._modeSaved),this.enabled=!1,this.enabled=!0}_log(e,t){this.showDebugLogs&&U.Log(`[Frame: ${this._engine.frameId}] WebGPUSnapshotRendering:${e} - ${t}`)}}const Ja=(()=>{const n=new Uint8Array(4),e=new Uint32Array(n.buffer);return!!((e[0]=1)&n[0])})();Object.defineProperty(S.prototype,"effectiveByteStride",{get:function(){return this._alignedBuffer&&this._alignedBuffer.byteStride||this.byteStride},enumerable:!0,configurable:!0});Object.defineProperty(S.prototype,"effectiveByteOffset",{get:function(){return this._alignedBuffer?0:this.byteOffset},enumerable:!0,configurable:!0});Object.defineProperty(S.prototype,"effectiveBuffer",{get:function(){return this._alignedBuffer&&this._alignedBuffer.getBuffer()||this._buffer.getBuffer()},enumerable:!0,configurable:!0});S.prototype._rebuild=function(){var n,e;(n=this._buffer)==null||n._rebuild(),(e=this._alignedBuffer)==null||e._rebuild()};S.prototype.dispose=function(){var n;this._ownsBuffer&&this._buffer.dispose(),(n=this._alignedBuffer)==null||n.dispose(),this._alignedBuffer=void 0,this._isDisposed=!0};S.prototype.getWrapperBuffer=function(){return this._alignedBuffer||this._buffer};S.prototype._alignBuffer=function(){var c;const n=this._buffer.getData();if(!this.engine._features.forceVertexBufferStrideAndOffsetMultiple4Bytes||this.byteStride%4===0&&this.byteOffset%4===0||!n)return;const e=S.GetTypeByteLength(this.type),t=this.byteStride+3&-4,i=t/e,s=this._maxVerticesCount,a=s*t/e;let o;if(Array.isArray(n)){const f=new Float32Array(n);o=new DataView(f.buffer,f.byteOffset,f.byteLength)}else n instanceof ArrayBuffer?o=new DataView(n,0,n.byteLength):o=new DataView(n.buffer,n.byteOffset,n.byteLength);let l;this.type===S.BYTE?l=new Int8Array(a):this.type===S.UNSIGNED_BYTE?l=new Uint8Array(a):this.type===S.SHORT?l=new Int16Array(a):this.type===S.UNSIGNED_SHORT?l=new Uint16Array(a):this.type===S.INT?l=new Int32Array(a):this.type===S.UNSIGNED_INT?l=new Uint32Array(a):l=new Float32Array(a);const h=this.getSize();let u=this.byteOffset;for(let f=0;f<s;++f){for(let d=0;d<h;++d)switch(this.type){case S.BYTE:l[f*i+d]=o.getInt8(u+d);break;case S.UNSIGNED_BYTE:l[f*i+d]=o.getUint8(u+d);break;case S.SHORT:l[f*i+d]=o.getInt16(u+d*2,Ja);break;case S.UNSIGNED_SHORT:l[f*i+d]=o.getUint16(u+d*2,Ja);break;case S.INT:l[f*i+d]=o.getInt32(u+d*4,Ja);break;case S.UNSIGNED_INT:l[f*i+d]=o.getUint32(u+d*4,Ja);break;case S.FLOAT:l[f*i+d]=o.getFloat32(u+d*4,Ja);break}u+=this.byteStride}(c=this._alignedBuffer)==null||c.dispose(),this._alignedBuffer=new Pa(this.engine,l,!1,t,!1,this.getIsInstanced(),!0,this.instanceDivisor,(this._label??"VertexBuffer")+"_aligned")};re.AudioEngineFactory=(n,e,t)=>new BA(n,e,t);class BA{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(e=null,t=null,i=null){if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new q,this.onAudioLockedObservable=new q,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!zt())return;typeof window.AudioContext<"u"&&(this.canUseWebAudio=!0);const s=document.createElement("audio");this._hostElement=e,this._audioContext=t,this._audioDestination=i;try{s&&s.canPlayType&&(s.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||s.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch{}try{s&&s.canPlayType&&s.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch{}}lock(){this._triggerSuspendedState()}unlock(){var e,t;if(((e=this._audioContext)==null?void 0:e.state)==="running"){this._hideMuteButton(),this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this));return}this._tryToRun?(t=this._audioContext)==null||t.suspend().then(()=>{this._tryToRun=!1,this._triggerRunningState()}):this._triggerRunningState()}_resumeAudioContextOnStateChange(){var e;(e=this._audioContext)==null||e.addEventListener("statechange",()=>{var t;this.unlocked&&((t=this._audioContext)==null?void 0:t.state)!=="running"&&this._resumeAudioContext()},{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContext(){var e;return(e=this._audioContext)!=null&&e.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,this._audioContext.state==="running"&&this._triggerRunningState())}catch(e){this.canUseWebAudio=!1,U.Error("Web Audio: "+e.message)}}_triggerRunningState(){this._tryToRun||(this._tryToRun=!0,this._resumeAudioContext().then(()=>{this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}).catch(()=>{this._tryToRun=!1,this.unlocked=!1}))}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const t=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",i=document.createElement("style");i.appendChild(document.createTextNode(t)),document.getElementsByTagName("head")[0].appendChild(i),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",()=>{this._triggerRunningState()},!0),this._muteButton.addEventListener("click",()=>{this.unlock()},!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear()}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(e){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=e)}connectToAnalyser(e){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=e,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}class NA extends Nv{constructor(e){super(e)}}rt.prototype.setAlphaMode=function(n,e=!1){if(this._alphaMode===n&&(n===0&&!this._alphaState.alphaBlend||n!==0&&this._alphaState.alphaBlend)){if(!e){const t=n===0;this.depthCullingState.depthMask!==t&&(this.setDepthWrite(t),this._cacheRenderPipeline.setDepthWriteEnabled(t))}return}switch(n){case 0:this._alphaState.alphaBlend=!1;break;case 7:this._alphaState.setAlphaBlendFunctionParameters(1,771,1,1),this._alphaState.alphaBlend=!0;break;case 8:this._alphaState.setAlphaBlendFunctionParameters(1,771,1,771),this._alphaState.alphaBlend=!0;break;case 2:this._alphaState.setAlphaBlendFunctionParameters(770,771,1,1),this._alphaState.alphaBlend=!0;break;case 6:this._alphaState.setAlphaBlendFunctionParameters(1,1,0,1),this._alphaState.alphaBlend=!0;break;case 1:this._alphaState.setAlphaBlendFunctionParameters(770,1,0,1),this._alphaState.alphaBlend=!0;break;case 3:this._alphaState.setAlphaBlendFunctionParameters(0,769,1,1),this._alphaState.alphaBlend=!0;break;case 4:this._alphaState.setAlphaBlendFunctionParameters(774,0,1,1),this._alphaState.alphaBlend=!0;break;case 5:this._alphaState.setAlphaBlendFunctionParameters(770,769,1,1),this._alphaState.alphaBlend=!0;break;case 9:this._alphaState.setAlphaBlendFunctionParameters(32769,32770,32771,32772),this._alphaState.alphaBlend=!0;break;case 10:this._alphaState.setAlphaBlendFunctionParameters(1,769,1,771),this._alphaState.alphaBlend=!0;break;case 11:this._alphaState.setAlphaBlendFunctionParameters(1,1,1,1),this._alphaState.alphaBlend=!0;break;case 12:this._alphaState.setAlphaBlendFunctionParameters(772,1,0,0),this._alphaState.alphaBlend=!0;break;case 13:this._alphaState.setAlphaBlendFunctionParameters(775,769,773,771),this._alphaState.alphaBlend=!0;break;case 14:this._alphaState.setAlphaBlendFunctionParameters(1,771,1,771),this._alphaState.alphaBlend=!0;break;case 15:this._alphaState.setAlphaBlendFunctionParameters(1,1,1,0),this._alphaState.alphaBlend=!0;break;case 16:this._alphaState.setAlphaBlendFunctionParameters(775,769,0,1),this._alphaState.alphaBlend=!0;break;case 17:this._alphaState.setAlphaBlendFunctionParameters(770,771,1,771),this._alphaState.alphaBlend=!0;break}e||(this.setDepthWrite(n===0),this._cacheRenderPipeline.setDepthWriteEnabled(n===0)),this._alphaMode=n,this._cacheRenderPipeline.setAlphaBlendEnabled(this._alphaState.alphaBlend),this._cacheRenderPipeline.setAlphaBlendFactors(this._alphaState._blendFunctionParameters,this._alphaState._blendEquationParameters)};rt.prototype.setAlphaEquation=function(n){re.prototype.setAlphaEquation.call(this,n),this._cacheRenderPipeline.setAlphaBlendFactors(this._alphaState._blendFunctionParameters,this._alphaState._blendEquationParameters)};rt.prototype.createRawTexture=function(n,e,t,i,s,r,a,o=null,l=0,h=0,u=!1){const c=new gt(this,3);return c.baseWidth=e,c.baseHeight=t,c.width=e,c.height=t,c.format=i,c.generateMipMaps=s,c.samplingMode=a,c.invertY=r,c._compression=o,c.type=l,c._creationFlags=h,c._useSRGBBuffer=u,this._doNotHandleContextLost||(c._bufferView=n),this._textureHelper.createGPUTextureForInternalTexture(c,e,t,void 0,h),this.updateRawTexture(c,n,i,r,o,l,u),this._internalTexturesCache.push(c),c};rt.prototype.updateRawTexture=function(n,e,t,i,s=null,r=0,a=!1){if(n){if(this._doNotHandleContextLost||(n._bufferView=e,n.invertY=i,n._compression=s,n._useSRGBBuffer=a),e){const o=n._hardwareTexture;t===4&&(e=h0(e,n.width,n.height,r));const h=new Uint8Array(e.buffer,e.byteOffset,e.byteLength);this._textureHelper.updateTexture(h,n,n.width,n.height,n.depth,o.format,0,0,i,!1,0,0),n.generateMipMaps&&this._generateMipmaps(n,this._uploadEncoder)}n.isReady=!0}};rt.prototype.createRawCubeTexture=function(n,e,t,i,s,r,a,o=null){const l=new gt(this,8);if(i===1&&!this._caps.textureFloatLinearFiltering?(s=!1,a=1,U.Warn("Float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively.")):i===2&&!this._caps.textureHalfFloatLinearFiltering?(s=!1,a=1,U.Warn("Half float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively.")):i===1&&!this._caps.textureFloatRender?(s=!1,U.Warn("Render to float textures is not supported. Mipmap generation forced to false.")):i===2&&!this._caps.colorBufferFloat&&(s=!1,U.Warn("Render to half float textures is not supported. Mipmap generation forced to false.")),l.isCube=!0,l._originalFormat=t,l.format=t===4?5:t,l.type=i,l.generateMipMaps=s,l.width=e,l.height=e,l.samplingMode=a,this._doNotHandleContextLost||(l._bufferViewArray=n),l.invertY=r,l._compression=o,l._cachedWrapU=0,l._cachedWrapV=0,this._textureHelper.createGPUTextureForInternalTexture(l),t===4){const h=l._hardwareTexture;h._originalFormatIsRGB=!0}return n&&this.updateRawCubeTexture(l,n,t,i,r,o),l.isReady=!0,l};rt.prototype.updateRawCubeTexture=function(n,e,t,i,s,r=null){n._bufferViewArray=e,n.invertY=s,n._compression=r;const a=n._hardwareTexture,o=a._originalFormatIsRGB,l=[0,2,4,1,3,5],h=[];for(let u=0;u<e.length;++u){let c=e[l[u]];o&&(c=h0(c,n.width,n.height,i)),h.push(new Uint8Array(c.buffer,c.byteOffset,c.byteLength))}this._textureHelper.updateCubeTextures(h,a.underlyingResource,n.width,n.height,a.format,s,!1,0,0),n.generateMipMaps&&this._generateMipmaps(n,this._uploadEncoder),n.isReady=!0};rt.prototype.createRawCubeTextureFromUrl=function(n,e,t,i,s,r,a,o,l=null,h=null,u=3,c=!1){const f=this.createRawCubeTexture(null,t,i,s,!r,c,u,null);e==null||e.addPendingData(f),f.url=n,f.isReady=!1,this._internalTexturesCache.push(f);const d=(p,g)=>{e==null||e.removePendingData(f),h&&p&&h(p.status+" "+p.statusText,g)},_=p=>{const g=f.width,m=a(p);if(m){if(o){const v=i===4,T=o(m),A=f._hardwareTexture,b=[0,1,2,3,4,5];for(let x=0;x<T.length;x++){const E=g>>x,R=[];for(let C=0;C<6;C++){let I=T[x][b[C]];v&&(I=h0(I,E,E,s)),R.push(new Uint8Array(I.buffer,I.byteOffset,I.byteLength))}this._textureHelper.updateCubeTextures(R,A.underlyingResource,E,E,A.format,c,!1,0,0)}}else this.updateRawCubeTexture(f,m,i,s,c);f.isReady=!0,e==null||e.removePendingData(f),l&&l()}};return this._loadFile(n,p=>{_(p)},void 0,e==null?void 0:e.offlineProvider,!0,d),f};rt.prototype.createRawTexture3D=function(n,e,t,i,s,r,a,o,l=null,h=0,u=0){const f=new gt(this,10);return f.baseWidth=e,f.baseHeight=t,f.baseDepth=i,f.width=e,f.height=t,f.depth=i,f.format=s,f.type=h,f.generateMipMaps=r,f.samplingMode=o,f.is3D=!0,f._creationFlags=u,this._doNotHandleContextLost||(f._bufferView=n),this._textureHelper.createGPUTextureForInternalTexture(f,e,t,void 0,u),this.updateRawTexture3D(f,n,s,a,l,h),this._internalTexturesCache.push(f),f};rt.prototype.updateRawTexture3D=function(n,e,t,i,s=null,r=0){if(this._doNotHandleContextLost||(n._bufferView=e,n.format=t,n.invertY=i,n._compression=s),e){const a=n._hardwareTexture;t===4&&(e=h0(e,n.width,n.height,r));const l=new Uint8Array(e.buffer,e.byteOffset,e.byteLength);this._textureHelper.updateTexture(l,n,n.width,n.height,n.depth,a.format,0,0,i,!1,0,0),n.generateMipMaps&&this._generateMipmaps(n,this._uploadEncoder)}n.isReady=!0};rt.prototype.createRawTexture2DArray=function(n,e,t,i,s,r,a,o,l=null,h=0,u=0){const f=new gt(this,11);return f.baseWidth=e,f.baseHeight=t,f.baseDepth=i,f.width=e,f.height=t,f.depth=i,f.format=s,f.type=h,f.generateMipMaps=r,f.samplingMode=o,f.is2DArray=!0,f._creationFlags=u,this._doNotHandleContextLost||(f._bufferView=n),this._textureHelper.createGPUTextureForInternalTexture(f,e,t,i,u),this.updateRawTexture2DArray(f,n,s,a,l,h),this._internalTexturesCache.push(f),f};rt.prototype.updateRawTexture2DArray=function(n,e,t,i,s=null,r=0){if(this._doNotHandleContextLost||(n._bufferView=e,n.format=t,n.invertY=i,n._compression=s),e){const a=n._hardwareTexture;t===4&&(e=h0(e,n.width,n.height,r));const l=new Uint8Array(e.buffer,e.byteOffset,e.byteLength);this._textureHelper.updateTexture(l,n,n.width,n.height,n.depth,a.format,0,0,i,!1,0,0),n.generateMipMaps&&this._generateMipmaps(n,this._uploadEncoder)}n.isReady=!0};function h0(n,e,t,i){let s,r=1;i===1?s=new Float32Array(e*t*4):i===2?(s=new Uint16Array(e*t*4),r=15360):i===7?s=new Uint32Array(e*t*4):s=new Uint8Array(e*t*4);for(let a=0;a<e;a++)for(let o=0;o<t;o++){const l=(o*e+a)*3,h=(o*e+a)*4;s[h+0]=n[l+0],s[h+1]=n[l+1],s[h+2]=n[l+2],s[h+3]=r}return s}rt.prototype._readTexturePixels=function(n,e,t,i=-1,s=0,r=null,a=!0,o=!1,l=0,h=0){const u=n._hardwareTexture;return a&&this.flushFramebuffer(),this._textureHelper.readPixels(u.underlyingResource,l,h,e,t,u.format,i,s,r,o)};rt.prototype._readTexturePixelsSync=function(){throw"_readTexturePixelsSync is unsupported in WebGPU!"};rt.prototype._createDepthStencilCubeTexture=function(n,e){const t=new gt(this,e.generateStencil?12:14);t.isCube=!0,t.label=e.label;const i={bilinearFiltering:!1,comparisonFunction:0,samples:1,depthTextureFormat:e.generateStencil?13:14,...e};t.format=i.depthTextureFormat,this._setupDepthStencilTexture(t,n,i.bilinearFiltering,i.comparisonFunction,i.samples),this._textureHelper.createGPUTextureForInternalTexture(t);const s=t._hardwareTexture;return t.type=We.GetTextureTypeFromFormat(s.format),this._internalTexturesCache.push(t),t};rt.prototype.createCubeTexture=function(n,e,t,i,s=null,r=null,a,o=null,l=!1,h=0,u=0,c=null,f,d=!1,_=null){return this.createCubeTextureBase(n,e,t,!!i,s,r,a,o,l,h,u,c,null,(p,g)=>{const m=g,v=m[0].width,T=v;this._setCubeMapTextureParams(p,!i),p.format=a??-1;const A=this._textureHelper.createGPUTextureForInternalTexture(p,v,T);this._textureHelper.updateCubeTextures(m,A.underlyingResource,v,T,A.format,!1,!1,0,0),i||this._generateMipmaps(p,this._uploadEncoder),p.isReady=!0,p.onLoadedObservable.notifyObservers(p),p.onLoadedObservable.clear(),s&&s()},!!d,_)};rt.prototype._setCubeMapTextureParams=function(n,e,t){n.samplingMode=e?3:2,n._cachedWrapU=0,n._cachedWrapV=0,t&&(n._maxLodLevel=t)};rt.prototype.generateMipMapsForCubemap=function(n){var e;n.generateMipMaps&&((e=n._hardwareTexture)!=null&&e.underlyingResource||this._textureHelper.createGPUTextureForInternalTexture(n),this._generateMipmaps(n))};class UA extends dv{constructor(e,t,i,s,r){super(e,t,i,s,r),s.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new Dv)}}rt.prototype._createHardwareRenderTargetWrapper=function(n,e,t){const i=new UA(n,e,t,this);return this._renderTargetWrapperCache.push(i),i};rt.prototype.createRenderTargetTexture=function(n,e){var r;const t=this._createHardwareRenderTargetWrapper(!1,!1,n),i={};e!==void 0&&typeof e=="object"?(i.generateMipMaps=e.generateMipMaps,i.generateDepthBuffer=e.generateDepthBuffer===void 0?!0:e.generateDepthBuffer,i.generateStencilBuffer=i.generateDepthBuffer&&e.generateStencilBuffer,i.samplingMode=e.samplingMode===void 0?3:e.samplingMode,i.creationFlags=e.creationFlags??0,i.noColorAttachment=!!e.noColorAttachment,i.colorAttachment=e.colorAttachment,i.samples=e.samples,i.label=e.label,i.format=e.format,i.type=e.type):(i.generateMipMaps=e,i.generateDepthBuffer=!0,i.generateStencilBuffer=!1,i.samplingMode=3,i.creationFlags=0,i.noColorAttachment=!1);const s=i.colorAttachment||(i.noColorAttachment?null:this._createInternalTexture(n,i,!0,5));return t.label=i.label??"RenderTargetWrapper",t._samples=((r=i.colorAttachment)==null?void 0:r.samples)??i.samples??1,t._generateDepthBuffer=i.generateDepthBuffer,t._generateStencilBuffer=!!i.generateStencilBuffer,t.setTextures(s),(t._generateDepthBuffer||t._generateStencilBuffer)&&t.createDepthStencilTexture(0,!1,t._generateStencilBuffer,t.samples,i.generateStencilBuffer?13:14,i.label?i.label+"-DepthStencil":void 0),s&&!i.colorAttachment&&(e!==void 0&&typeof e=="object"&&e.createMipMaps&&!i.generateMipMaps&&(s.generateMipMaps=!0),this._textureHelper.createGPUTextureForInternalTexture(s,void 0,void 0,void 0,i.creationFlags),e!==void 0&&typeof e=="object"&&e.createMipMaps&&!i.generateMipMaps&&(s.generateMipMaps=!1)),t};rt.prototype._createDepthStencilTexture=function(n,e,t){const i={bilinearFiltering:!1,comparisonFunction:0,samples:1,depthTextureFormat:e.generateStencil?13:14,...e},s=Ia(i.depthTextureFormat);t._depthStencilTextureWithStencil=s;const r=new gt(this,s?12:14);return r.label=e.label,r.format=i.depthTextureFormat,r.type=r4(r.format),this._setupDepthStencilTexture(r,n,i.bilinearFiltering,i.comparisonFunction,i.samples),this._textureHelper.createGPUTextureForInternalTexture(r),this._internalTexturesCache.push(r),r};rt.prototype._setupDepthStencilTexture=function(n,e,t,i,s=1){const r=e.width??e,a=e.height??e,o=e.layers||0,l=e.depth||0;n.baseWidth=r,n.baseHeight=a,n.width=r,n.height=a,n.is2DArray=o>0,n.is3D=l>0,n.depth=o||l,n.isReady=!0,n.samples=s,n.generateMipMaps=!1,n.samplingMode=t?2:1,n.type=1,n._comparisonFunction=i,n._cachedWrapU=0,n._cachedWrapV=0};rt.prototype.updateRenderTargetTextureSampleCount=function(n,e){return!n||!n.texture||n.samples===e||(e=Math.min(e,this.getCaps().maxMSAASamples),this._textureHelper.createMSAATexture(n.texture,e),n._depthStencilTexture&&(this._textureHelper.createMSAATexture(n._depthStencilTexture,e),n._depthStencilTexture.samples=e),n._samples=e,n.texture.samples=e),e};rt.prototype.setDepthStencilTexture=function(n,e,t,i){!t||!t.depthStencilTexture?this._setTexture(n,null,void 0,void 0,i):this._setTexture(n,t,!1,!0,i)};rt.prototype.createRenderTargetCubeTexture=function(n,e){const t=this._createHardwareRenderTargetWrapper(!1,!0,n),i={generateMipMaps:!0,generateDepthBuffer:!0,generateStencilBuffer:!1,type:0,samplingMode:3,format:5,samples:1,...e};i.generateStencilBuffer=i.generateDepthBuffer&&i.generateStencilBuffer,t.label=i.label??"RenderTargetWrapper",t._generateDepthBuffer=i.generateDepthBuffer,t._generateStencilBuffer=i.generateStencilBuffer;const s=new gt(this,5);return s.width=n,s.height=n,s.depth=0,s.isReady=!0,s.isCube=!0,s.samples=i.samples,s.generateMipMaps=i.generateMipMaps,s.samplingMode=i.samplingMode,s.type=i.type,s.format=i.format,this._internalTexturesCache.push(s),t.setTextures(s),(t._generateDepthBuffer||t._generateStencilBuffer)&&t.createDepthStencilTexture(0,i.samplingMode===void 0||i.samplingMode===2||i.samplingMode===2||i.samplingMode===3||i.samplingMode===3||i.samplingMode===5||i.samplingMode===6||i.samplingMode===7||i.samplingMode===11,t._generateStencilBuffer,t.samples),e&&e.createMipMaps&&!i.generateMipMaps&&(s.generateMipMaps=!0),this._textureHelper.createGPUTextureForInternalTexture(s),e&&e.createMipMaps&&!i.generateMipMaps&&(s.generateMipMaps=!1),t};function Nc(n,e,t){try{const i=n.next();i.done?e(i):i.value?i.value.then(()=>{i.value=void 0,e(i)},t):e(i)}catch(i){t(i)}}function kA(n=25){let e;return(t,i,s)=>{const r=performance.now();e===void 0||r-e>n?(e=r,setTimeout(()=>{Nc(t,i,s)},0)):Nc(t,i,s)}}function kv(n,e,t,i,s){const r=()=>{let a;const o=l=>{l.done?t(l.value):a===void 0?a=!0:r()};do a=void 0,e(n,o,i),a===void 0&&(a=!1);while(a)};r()}function Td(n,e){let t;return kv(n,Nc,i=>t=i,i=>{throw i}),t}function VA(n,e,t){return new Promise((i,s)=>{kv(n,e,i,s)})}function GA(n,e){return(...t)=>Td(n(...t))}class Uc{constructor(e,t,i){this.bu=e,this.bv=t,this.distance=i,this.faceId=0,this.subMeshId=0}}class un{constructor(e,t,i){this.vectors=Ws(8,y.Zero),this.center=y.Zero(),this.centerWorld=y.Zero(),this.extendSize=y.Zero(),this.extendSizeWorld=y.Zero(),this.directions=Ws(3,y.Zero),this.vectorsWorld=Ws(8,y.Zero),this.minimumWorld=y.Zero(),this.maximumWorld=y.Zero(),this.minimum=y.Zero(),this.maximum=y.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(e,t,i)}reConstruct(e,t,i){const s=e.x,r=e.y,a=e.z,o=t.x,l=t.y,h=t.z,u=this.vectors;this.minimum.copyFromFloats(s,r,a),this.maximum.copyFromFloats(o,l,h),u[0].copyFromFloats(s,r,a),u[1].copyFromFloats(o,l,h),u[2].copyFromFloats(o,r,a),u[3].copyFromFloats(s,l,a),u[4].copyFromFloats(s,r,h),u[5].copyFromFloats(o,l,a),u[6].copyFromFloats(s,l,h),u[7].copyFromFloats(o,r,h),t.addToRef(e,this.center).scaleInPlace(.5),t.subtractToRef(e,this.extendSize).scaleInPlace(.5),this._worldMatrix=i||L.IdentityReadOnly,this._update(this._worldMatrix)}scale(e){const t=un._TmpVector3,i=this.maximum.subtractToRef(this.minimum,t[0]),s=i.length();i.normalizeFromLength(s);const r=s*e,a=i.scaleInPlace(r*.5),o=this.center.subtractToRef(a,t[1]),l=this.center.addToRef(a,t[2]);return this.reConstruct(o,l,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(e){const t=this.minimumWorld,i=this.maximumWorld,s=this.directions,r=this.vectorsWorld,a=this.vectors;if(e.isIdentity()){t.copyFrom(this.minimum),i.copyFrom(this.maximum);for(let o=0;o<8;++o)r[o].copyFrom(a[o]);this.extendSizeWorld.copyFrom(this.extendSize),this.centerWorld.copyFrom(this.center)}else{t.setAll(Number.MAX_VALUE),i.setAll(-Number.MAX_VALUE);for(let o=0;o<8;++o){const l=r[o];y.TransformCoordinatesToRef(a[o],e,l),t.minimizeInPlace(l),i.maximizeInPlace(l)}i.subtractToRef(t,this.extendSizeWorld).scaleInPlace(.5),i.addToRef(t,this.centerWorld).scaleInPlace(.5)}y.FromArrayToRef(e.m,0,s[0]),y.FromArrayToRef(e.m,4,s[1]),y.FromArrayToRef(e.m,8,s[2]),this._worldMatrix=e}isInFrustum(e){return un.IsInFrustum(this.vectorsWorld,e)}isCompletelyInFrustum(e){return un.IsCompletelyInFrustum(this.vectorsWorld,e)}intersectsPoint(e){const t=this.minimumWorld,i=this.maximumWorld,s=t.x,r=t.y,a=t.z,o=i.x,l=i.y,h=i.z,u=e.x,c=e.y,f=e.z,d=-.001;return!(o-u<d||d>u-s||l-c<d||d>c-r||h-f<d||d>f-a)}intersectsSphere(e){return un.IntersectsSphere(this.minimumWorld,this.maximumWorld,e.centerWorld,e.radiusWorld)}intersectsMinMax(e,t){const i=this.minimumWorld,s=this.maximumWorld,r=i.x,a=i.y,o=i.z,l=s.x,h=s.y,u=s.z,c=e.x,f=e.y,d=e.z,_=t.x,p=t.y,g=t.z;return!(l<c||r>_||h<f||a>p||u<d||o>g)}dispose(){var e,t;(e=this._drawWrapperFront)==null||e.dispose(),(t=this._drawWrapperBack)==null||t.dispose()}static Intersects(e,t){return e.intersectsMinMax(t.minimumWorld,t.maximumWorld)}static IntersectsSphere(e,t,i,s){const r=un._TmpVector3[0];return y.ClampToRef(i,e,t,r),y.DistanceSquared(i,r)<=s*s}static IsCompletelyInFrustum(e,t){for(let i=0;i<6;++i){const s=t[i];for(let r=0;r<8;++r)if(s.dotCoordinate(e[r])<0)return!1}return!0}static IsInFrustum(e,t){for(let i=0;i<6;++i){let s=!0;const r=t[i];for(let a=0;a<8;++a)if(r.dotCoordinate(e[a])>=0){s=!1;break}if(s)return!1}return!0}}un._TmpVector3=Ws(3,y.Zero);class Ar{constructor(e,t,i){this.center=y.Zero(),this.centerWorld=y.Zero(),this.minimum=y.Zero(),this.maximum=y.Zero(),this.reConstruct(e,t,i)}reConstruct(e,t,i){this.minimum.copyFrom(e),this.maximum.copyFrom(t);const s=y.Distance(e,t);t.addToRef(e,this.center).scaleInPlace(.5),this.radius=s*.5,this._update(i||L.IdentityReadOnly)}scale(e){const t=this.radius*e,i=Ar._TmpVector3,s=i[0].setAll(t),r=this.center.subtractToRef(s,i[1]),a=this.center.addToRef(s,i[2]);return this.reConstruct(r,a,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(e){if(e.isIdentity())this.centerWorld.copyFrom(this.center),this.radiusWorld=this.radius;else{y.TransformCoordinatesToRef(this.center,e,this.centerWorld);const t=Ar._TmpVector3[0];y.TransformNormalFromFloatsToRef(1,1,1,e,t),this.radiusWorld=Math.max(Math.abs(t.x),Math.abs(t.y),Math.abs(t.z))*this.radius}}isInFrustum(e){const t=this.centerWorld,i=this.radiusWorld;for(let s=0;s<6;s++)if(e[s].dotCoordinate(t)<=-i)return!1;return!0}isCenterInFrustum(e){const t=this.centerWorld;for(let i=0;i<6;i++)if(e[i].dotCoordinate(t)<0)return!1;return!0}intersectsPoint(e){const t=y.DistanceSquared(this.centerWorld,e);return!(this.radiusWorld*this.radiusWorld<t)}static Intersects(e,t){const i=y.DistanceSquared(e.centerWorld,t.centerWorld),s=e.radiusWorld+t.radiusWorld;return!(s*s<i)}static CreateFromCenterAndRadius(e,t,i){this._TmpVector3[0].copyFrom(e),this._TmpVector3[1].copyFromFloats(0,0,t),this._TmpVector3[2].copyFrom(e),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].subtractInPlace(this._TmpVector3[1]);const s=new Ar(this._TmpVector3[0],this._TmpVector3[2]);return i?s._worldMatrix=i:s._worldMatrix=L.Identity(),s}}Ar._TmpVector3=Ws(3,y.Zero);const bu={min:0,max:0},Tu={min:0,max:0},Eg=(n,e,t)=>{const i=y.Dot(e.centerWorld,n),s=Math.abs(y.Dot(e.directions[0],n))*e.extendSize.x,r=Math.abs(y.Dot(e.directions[1],n))*e.extendSize.y,a=Math.abs(y.Dot(e.directions[2],n))*e.extendSize.z,o=s+r+a;t.min=i-o,t.max=i+o},vi=(n,e,t)=>(Eg(n,e,bu),Eg(n,t,Tu),!(bu.min>Tu.max||Tu.min>bu.max));class Oi{constructor(e,t,i){this._isLocked=!1,this.boundingBox=new un(e,t,i),this.boundingSphere=new Ar(e,t,i)}reConstruct(e,t,i){this.boundingBox.reConstruct(e,t,i),this.boundingSphere.reConstruct(e,t,i)}get minimum(){return this.boundingBox.minimum}get maximum(){return this.boundingBox.maximum}get isLocked(){return this._isLocked}set isLocked(e){this._isLocked=e}update(e){this._isLocked||(this.boundingBox._update(e),this.boundingSphere._update(e))}centerOn(e,t){const i=Oi._TmpVector3[0].copyFrom(e).subtractInPlace(t),s=Oi._TmpVector3[1].copyFrom(e).addInPlace(t);return this.boundingBox.reConstruct(i,s,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(i,s,this.boundingBox.getWorldMatrix()),this}encapsulate(e){const t=y.Minimize(this.minimum,e),i=y.Maximize(this.maximum,e);return this.reConstruct(t,i,this.boundingBox.getWorldMatrix()),this}encapsulateBoundingInfo(e){const t=N.Matrix[0];this.boundingBox.getWorldMatrix().invertToRef(t);const i=N.Vector3[0];return y.TransformCoordinatesToRef(e.boundingBox.minimumWorld,t,i),this.encapsulate(i),y.TransformCoordinatesToRef(e.boundingBox.maximumWorld,t,i),this.encapsulate(i),this}scale(e){return this.boundingBox.scale(e),this.boundingSphere.scale(e),this}isInFrustum(e,t=0){return(t===2||t===3)&&this.boundingSphere.isCenterInFrustum(e)?!0:this.boundingSphere.isInFrustum(e)?t===1||t===3?!0:this.boundingBox.isInFrustum(e):!1}get diagonalLength(){const e=this.boundingBox;return e.maximumWorld.subtractToRef(e.minimumWorld,Oi._TmpVector3[0]).length()}isCompletelyInFrustum(e){return this.boundingBox.isCompletelyInFrustum(e)}_checkCollision(e){return e._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}intersectsPoint(e){return!(!this.boundingSphere.centerWorld||!this.boundingSphere.intersectsPoint(e)||!this.boundingBox.intersectsPoint(e))}intersects(e,t){if(!Ar.Intersects(this.boundingSphere,e.boundingSphere)||!un.Intersects(this.boundingBox,e.boundingBox))return!1;if(!t)return!0;const i=this.boundingBox,s=e.boundingBox;return!(!vi(i.directions[0],i,s)||!vi(i.directions[1],i,s)||!vi(i.directions[2],i,s)||!vi(s.directions[0],i,s)||!vi(s.directions[1],i,s)||!vi(s.directions[2],i,s)||!vi(y.Cross(i.directions[0],s.directions[0]),i,s)||!vi(y.Cross(i.directions[0],s.directions[1]),i,s)||!vi(y.Cross(i.directions[0],s.directions[2]),i,s)||!vi(y.Cross(i.directions[1],s.directions[0]),i,s)||!vi(y.Cross(i.directions[1],s.directions[1]),i,s)||!vi(y.Cross(i.directions[1],s.directions[2]),i,s)||!vi(y.Cross(i.directions[2],s.directions[0]),i,s)||!vi(y.Cross(i.directions[2],s.directions[1]),i,s)||!vi(y.Cross(i.directions[2],s.directions[2]),i,s))}}Oi._TmpVector3=Ws(2,y.Zero);class Th{static extractMinAndMaxIndexed(e,t,i,s,r,a){for(let o=i;o<i+s;o++){const l=t[o]*3,h=e[l],u=e[l+1],c=e[l+2];r.minimizeInPlaceFromFloats(h,u,c),a.maximizeInPlaceFromFloats(h,u,c)}}static extractMinAndMax(e,t,i,s,r,a){for(let o=t,l=t*s;o<t+i;o++,l+=s){const h=e[l],u=e[l+1],c=e[l+2];r.minimizeInPlaceFromFloats(h,u,c),a.maximizeInPlaceFromFloats(h,u,c)}}}P([yn.filter((...[n,e])=>!Array.isArray(n)&&!Array.isArray(e))],Th,"extractMinAndMaxIndexed",null);P([yn.filter((...[n])=>!Array.isArray(n))],Th,"extractMinAndMax",null);function zA(n,e,t,i,s=null){const r=new y(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),a=new y(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return Th.extractMinAndMaxIndexed(n,e,t,i,r,a),s&&(r.x-=r.x*s.x+s.y,r.y-=r.y*s.x+s.y,r.z-=r.z*s.x+s.y,a.x+=a.x*s.x+s.y,a.y+=a.y*s.x+s.y,a.z+=a.z*s.x+s.y),{minimum:r,maximum:a}}function Vv(n,e,t,i=null,s){const r=new y(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),a=new y(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return s||(s=3),Th.extractMinAndMax(n,e,t,s,r,a),i&&(r.x-=r.x*i.x+i.y,r.y-=r.y*i.x+i.y,r.z-=r.z*i.x+i.y,a.x+=a.x*i.x+i.y,a.y+=a.y*i.x+i.y,a.z+=a.z*i.x+i.y),{minimum:r,maximum:a}}class ss{get materialDefines(){var e;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:(e=this._getDrawWrapper())==null?void 0:e.defines}set materialDefines(e){const t=this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0);t.defines=e}_getDrawWrapper(e,t=!1){e=e??this._engine.currentRenderPassId;let i=this._drawWrappers[e];return!i&&t&&(this._drawWrappers[e]=i=new o0(this._mesh.getScene().getEngine())),i}_removeDrawWrapper(e,t=!0,i=!1){var s;t&&((s=this._drawWrappers[e])==null||s.dispose(i)),this._drawWrappers[e]=void 0}get effect(){var e;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:((e=this._getDrawWrapper())==null?void 0:e.effect)??null}get _drawWrapper(){return this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)}get _drawWrapperOverride(){return this._mainDrawWrapperOverride}_setMainDrawWrapperOverride(e){this._mainDrawWrapperOverride=e}setEffect(e,t=null,i,s=!0){const r=this._drawWrapper;r.setEffect(e,t,s),i!==void 0&&(r.materialContext=i),e||(r.defines=null,r.materialContext=void 0)}resetDrawCache(e,t=!1){if(this._drawWrappers)if(e!==void 0){this._removeDrawWrapper(e,!0,t);return}else for(const i of this._drawWrappers)i==null||i.dispose(t);this._drawWrappers=[]}static AddToMesh(e,t,i,s,r,a,o,l=!0){return new ss(e,t,i,s,r,a,o,l)}constructor(e,t,i,s,r,a,o,l=!0,h=!0){this.materialIndex=e,this.verticesStart=t,this.verticesCount=i,this.indexStart=s,this.indexCount=r,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._wasDispatched=!1,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=a,this._renderingMesh=o||a,h&&a.subMeshes.push(this),this._engine=this._mesh.getScene().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=a.subMeshes.length-1,l&&(this.refreshBoundingInfo(),a.computeWorldMatrix(!0))}get IsGlobal(){return this.verticesStart===0&&this.verticesCount===this._mesh.getTotalVertices()&&this.indexStart===0&&this.indexCount===this._mesh.getTotalIndices()}getBoundingInfo(){return this.IsGlobal||this._mesh.hasThinInstances?this._mesh.getBoundingInfo():this._boundingInfo}setBoundingInfo(e){return this._boundingInfo=e,this}getMesh(){return this._mesh}getRenderingMesh(){return this._renderingMesh}getReplacementMesh(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null}getEffectiveMesh(){const e=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return e||this._renderingMesh}getMaterial(e=!0){const t=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId)??this._renderingMesh.material;if(t){if(this._isMultiMaterial(t)){const i=t.getSubMaterial(this.materialIndex);return this._currentMaterial!==i&&(this._currentMaterial=i,this.resetDrawCache()),i}}else return e&&this._mesh.getScene()._hasDefaultMaterial?this._mesh.getScene().defaultMaterial:null;return t}_isMultiMaterial(e){return e.getSubMaterial!==void 0}refreshBoundingInfo(e=null){if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.geometry)return this;if(e||(e=this._renderingMesh.getVerticesData(S.PositionKind)),!e)return this._boundingInfo=this._mesh.getBoundingInfo(),this;const t=this._renderingMesh.getIndices();let i;if(this.indexStart===0&&this.indexCount===t.length){const s=this._renderingMesh.getBoundingInfo();i={minimum:s.minimum.clone(),maximum:s.maximum.clone()}}else i=zA(e,t,this.indexStart,this.indexCount,this._renderingMesh.geometry.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(i.minimum,i.maximum):this._boundingInfo=new Oi(i.minimum,i.maximum),this}_checkCollision(e){return this.getBoundingInfo()._checkCollision(e)}updateBoundingInfo(e){let t=this.getBoundingInfo();return t||(this.refreshBoundingInfo(),t=this.getBoundingInfo()),t&&t.update(e),this}isInFrustum(e){const t=this.getBoundingInfo();return t?t.isInFrustum(e,this._mesh.cullingStrategy):!1}isCompletelyInFrustum(e){const t=this.getBoundingInfo();return t?t.isCompletelyInFrustum(e):!1}render(e){return this._renderingMesh.render(this,e,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this}_getLinesIndexBuffer(e,t){if(!this._linesIndexBuffer){const i=Math.floor(this.indexCount/3)*6,r=this.verticesStart+this.verticesCount>65535?new Uint32Array(i):new Uint16Array(i);let a=0;if(e.length===0)for(let o=this.indexStart;o<this.indexStart+this.indexCount;o+=3)r[a++]=o,r[a++]=o+1,r[a++]=o+1,r[a++]=o+2,r[a++]=o+2,r[a++]=o;else for(let o=this.indexStart;o<this.indexStart+this.indexCount;o+=3)r[a++]=e[o],r[a++]=e[o+1],r[a++]=e[o+1],r[a++]=e[o+2],r[a++]=e[o+2],r[a++]=e[o];this._linesIndexBuffer=t.createIndexBuffer(r),this._linesIndexCount=r.length}return this._linesIndexBuffer}canIntersects(e){const t=this.getBoundingInfo();return t?e.intersectsBox(t.boundingBox):!1}intersects(e,t,i,s,r){const a=this.getMaterial();if(!a)return null;let o=3,l=!1;switch(a.fillMode){case 3:case 5:case 6:case 8:return null;case 7:o=1,l=!0;break}return a.fillMode===4?i.length?this._intersectLines(e,t,i,this._mesh.intersectionThreshold,s):this._intersectUnIndexedLines(e,t,i,this._mesh.intersectionThreshold,s):!i.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(e,t,i,s,r):this._intersectTriangles(e,t,i,o,l,s,r)}_intersectLines(e,t,i,s,r){let a=null;for(let o=this.indexStart;o<this.indexStart+this.indexCount;o+=2){const l=t[i[o]],h=t[i[o+1]],u=e.intersectionSegment(l,h,s);if(!(u<0)&&(r||!a||u<a.distance)&&(a=new Uc(null,null,u),a.faceId=o/2,r))break}return a}_intersectUnIndexedLines(e,t,i,s,r){let a=null;for(let o=this.verticesStart;o<this.verticesStart+this.verticesCount;o+=2){const l=t[o],h=t[o+1],u=e.intersectionSegment(l,h,s);if(!(u<0)&&(r||!a||u<a.distance)&&(a=new Uc(null,null,u),a.faceId=o/2,r))break}return a}_intersectTriangles(e,t,i,s,r,a,o){let l=null,h=-1;for(let u=this.indexStart;u<this.indexStart+this.indexCount-(3-s);u+=s){h++;const c=i[u],f=i[u+1],d=i[u+2];if(r&&d===4294967295){u+=2;continue}const _=t[c],p=t[f],g=t[d];if(!_||!p||!g||o&&!o(_,p,g,e,c,f,d))continue;const m=e.intersectsTriangle(_,p,g);if(m){if(m.distance<0)continue;if((a||!l||m.distance<l.distance)&&(l=m,l.faceId=h,a))break}}return l}_intersectUnIndexedTriangles(e,t,i,s,r){let a=null;for(let o=this.verticesStart;o<this.verticesStart+this.verticesCount;o+=3){const l=t[o],h=t[o+1],u=t[o+2];if(r&&!r(l,h,u,e,-1,-1,-1))continue;const c=e.intersectsTriangle(l,h,u);if(c){if(c.distance<0)continue;if((s||!a||c.distance<a.distance)&&(a=c,a.faceId=o/3,s))break}}return a}_rebuild(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)}clone(e,t){const i=new ss(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,e,t,!1);if(!this.IsGlobal){const s=this.getBoundingInfo();if(!s)return i;i._boundingInfo=new Oi(s.minimum,s.maximum)}return i}dispose(e=!1){this._linesIndexBuffer&&(this._mesh.getScene().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);const t=this._mesh.subMeshes.indexOf(this);this._mesh.subMeshes.splice(t,1),this.resetDrawCache(void 0,e)}getClassName(){return"SubMesh"}static CreateFromIndices(e,t,i,s,r,a=!0){let o=Number.MAX_VALUE,l=-Number.MAX_VALUE;const u=(r||s).getIndices();for(let c=t;c<t+i;c++){const f=u[c];f<o&&(o=f),f>l&&(l=f)}return new ss(e,o,l-o+1,t,i,s,r,a)}}class Au{}class Q{constructor(){this.uniqueId=0,this.metadata={},this._applyTo=GA(this._applyToCoroutine.bind(this)),this.uniqueId=Q._UniqueIDGenerator,Q._UniqueIDGenerator++}set(e,t){switch(e.length||U.Warn(`Setting vertex data kind '${t}' with an empty array`),t){case S.PositionKind:this.positions=e;break;case S.NormalKind:this.normals=e;break;case S.TangentKind:this.tangents=e;break;case S.UVKind:this.uvs=e;break;case S.UV2Kind:this.uvs2=e;break;case S.UV3Kind:this.uvs3=e;break;case S.UV4Kind:this.uvs4=e;break;case S.UV5Kind:this.uvs5=e;break;case S.UV6Kind:this.uvs6=e;break;case S.ColorKind:this.colors=e;break;case S.MatricesIndicesKind:this.matricesIndices=e;break;case S.MatricesWeightsKind:this.matricesWeights=e;break;case S.MatricesIndicesExtraKind:this.matricesIndicesExtra=e;break;case S.MatricesWeightsExtraKind:this.matricesWeightsExtra=e;break}}applyToMesh(e,t){return this._applyTo(e,t,!1),this}applyToGeometry(e,t){return this._applyTo(e,t,!1),this}updateMesh(e){return this._update(e),this}updateGeometry(e){return this._update(e),this}*_applyToCoroutine(e,t=!1,i){if(this.positions&&(e.setVerticesData(S.PositionKind,this.positions,t),i&&(yield)),this.normals&&(e.setVerticesData(S.NormalKind,this.normals,t),i&&(yield)),this.tangents&&(e.setVerticesData(S.TangentKind,this.tangents,t),i&&(yield)),this.uvs&&(e.setVerticesData(S.UVKind,this.uvs,t),i&&(yield)),this.uvs2&&(e.setVerticesData(S.UV2Kind,this.uvs2,t),i&&(yield)),this.uvs3&&(e.setVerticesData(S.UV3Kind,this.uvs3,t),i&&(yield)),this.uvs4&&(e.setVerticesData(S.UV4Kind,this.uvs4,t),i&&(yield)),this.uvs5&&(e.setVerticesData(S.UV5Kind,this.uvs5,t),i&&(yield)),this.uvs6&&(e.setVerticesData(S.UV6Kind,this.uvs6,t),i&&(yield)),this.colors){const s=this.positions&&this.colors.length===this.positions.length?3:4;e.setVerticesData(S.ColorKind,this.colors,t,s),this.hasVertexAlpha&&e.hasVertexAlpha!==void 0&&(e.hasVertexAlpha=!0),i&&(yield)}if(this.matricesIndices&&(e.setVerticesData(S.MatricesIndicesKind,this.matricesIndices,t),i&&(yield)),this.matricesWeights&&(e.setVerticesData(S.MatricesWeightsKind,this.matricesWeights,t),i&&(yield)),this.matricesIndicesExtra&&(e.setVerticesData(S.MatricesIndicesExtraKind,this.matricesIndicesExtra,t),i&&(yield)),this.matricesWeightsExtra&&(e.setVerticesData(S.MatricesWeightsExtraKind,this.matricesWeightsExtra,t),i&&(yield)),this.indices?(e.setIndices(this.indices,null,t),i&&(yield)):e.setIndices([],null),e.subMeshes&&this.materialInfos&&this.materialInfos.length>1){const s=e;s.subMeshes=[];for(const r of this.materialInfos)new ss(r.materialIndex,r.verticesStart,r.verticesCount,r.indexStart,r.indexCount,s)}return this}_update(e,t,i){return this.positions&&e.updateVerticesData(S.PositionKind,this.positions,t,i),this.normals&&e.updateVerticesData(S.NormalKind,this.normals,t,i),this.tangents&&e.updateVerticesData(S.TangentKind,this.tangents,t,i),this.uvs&&e.updateVerticesData(S.UVKind,this.uvs,t,i),this.uvs2&&e.updateVerticesData(S.UV2Kind,this.uvs2,t,i),this.uvs3&&e.updateVerticesData(S.UV3Kind,this.uvs3,t,i),this.uvs4&&e.updateVerticesData(S.UV4Kind,this.uvs4,t,i),this.uvs5&&e.updateVerticesData(S.UV5Kind,this.uvs5,t,i),this.uvs6&&e.updateVerticesData(S.UV6Kind,this.uvs6,t,i),this.colors&&e.updateVerticesData(S.ColorKind,this.colors,t,i),this.matricesIndices&&e.updateVerticesData(S.MatricesIndicesKind,this.matricesIndices,t,i),this.matricesWeights&&e.updateVerticesData(S.MatricesWeightsKind,this.matricesWeights,t,i),this.matricesIndicesExtra&&e.updateVerticesData(S.MatricesIndicesExtraKind,this.matricesIndicesExtra,t,i),this.matricesWeightsExtra&&e.updateVerticesData(S.MatricesWeightsExtraKind,this.matricesWeightsExtra,t,i),this.indices&&e.setIndices(this.indices,null),this}static _TransformVector3Coordinates(e,t,i=0,s=e.length){const r=N.Vector3[0],a=N.Vector3[1];for(let o=i;o<i+s;o+=3)y.FromArrayToRef(e,o,r),y.TransformCoordinatesToRef(r,t,a),e[o]=a.x,e[o+1]=a.y,e[o+2]=a.z}static _TransformVector3Normals(e,t,i=0,s=e.length){const r=N.Vector3[0],a=N.Vector3[1];for(let o=i;o<i+s;o+=3)y.FromArrayToRef(e,o,r),y.TransformNormalToRef(r,t,a),e[o]=a.x,e[o+1]=a.y,e[o+2]=a.z}static _TransformVector4Normals(e,t,i=0,s=e.length){const r=N.Vector4[0],a=N.Vector4[1];for(let o=i;o<i+s;o+=4)Oe.FromArrayToRef(e,o,r),Oe.TransformNormalToRef(r,t,a),e[o]=a.x,e[o+1]=a.y,e[o+2]=a.z,e[o+3]=a.w}static _FlipFaces(e,t=0,i=e.length){for(let s=t;s<t+i;s+=3){const r=e[s+1];e[s+1]=e[s+2],e[s+2]=r}}transform(e){const t=e.determinant()<0;return this.positions&&Q._TransformVector3Coordinates(this.positions,e),this.normals&&Q._TransformVector3Normals(this.normals,e),this.tangents&&Q._TransformVector4Normals(this.tangents,e),t&&this.indices&&Q._FlipFaces(this.indices),this}splitBasedOnMaterialID(){if(!this.materialInfos||this.materialInfos.length<2)return[this];const e=[];for(const t of this.materialInfos){const i=new Q;if(this.positions&&(i.positions=this.positions.slice(t.verticesStart*3,(t.verticesCount+t.verticesStart)*3)),this.normals&&(i.normals=this.normals.slice(t.verticesStart*3,(t.verticesCount+t.verticesStart)*3)),this.tangents&&(i.tangents=this.tangents.slice(t.verticesStart*4,(t.verticesCount+t.verticesStart)*4)),this.colors&&(i.colors=this.colors.slice(t.verticesStart*4,(t.verticesCount+t.verticesStart)*4)),this.uvs&&(i.uvs=this.uvs.slice(t.verticesStart*2,(t.verticesCount+t.verticesStart)*2)),this.uvs2&&(i.uvs2=this.uvs2.slice(t.verticesStart*2,(t.verticesCount+t.verticesStart)*2)),this.uvs3&&(i.uvs3=this.uvs3.slice(t.verticesStart*2,(t.verticesCount+t.verticesStart)*2)),this.uvs4&&(i.uvs4=this.uvs4.slice(t.verticesStart*2,(t.verticesCount+t.verticesStart)*2)),this.uvs5&&(i.uvs5=this.uvs5.slice(t.verticesStart*2,(t.verticesCount+t.verticesStart)*2)),this.uvs6&&(i.uvs6=this.uvs6.slice(t.verticesStart*2,(t.verticesCount+t.verticesStart)*2)),this.matricesIndices&&(i.matricesIndices=this.matricesIndices.slice(t.verticesStart*4,(t.verticesCount+t.verticesStart)*4)),this.matricesIndicesExtra&&(i.matricesIndicesExtra=this.matricesIndicesExtra.slice(t.verticesStart*4,(t.verticesCount+t.verticesStart)*4)),this.matricesWeights&&(i.matricesWeights=this.matricesWeights.slice(t.verticesStart*4,(t.verticesCount+t.verticesStart)*4)),this.matricesWeightsExtra&&(i.matricesWeightsExtra=this.matricesWeightsExtra.slice(t.verticesStart*4,(t.verticesCount+t.verticesStart)*4)),this.indices){i.indices=[];for(let r=t.indexStart;r<t.indexStart+t.indexCount;r++)i.indices.push(this.indices[r]-t.verticesStart)}const s=new Au;s.indexStart=0,s.indexCount=i.indices?i.indices.length:0,s.materialIndex=t.materialIndex,s.verticesStart=0,s.verticesCount=(i.positions?i.positions.length:0)/3,i.materialInfos=[s],e.push(i)}return e}merge(e,t=!1,i=!1,s=!1,r=!1){const a=Array.isArray(e)?e.map(o=>({vertexData:o})):[{vertexData:e}];return Td(this._mergeCoroutine(void 0,a,t,!1,i,s,r))}*_mergeCoroutine(e,t,i=!1,s,r,a=!1,o=!1){var d,_;this._validate();let l=t.map(p=>p.vertexData),h=this;if(o)for(const p of l)p&&(p._validate(),!this.normals&&p.normals&&(this.normals=new Float32Array(this.positions.length)),!this.tangents&&p.tangents&&(this.tangents=new Float32Array(this.positions.length/3*4)),!this.uvs&&p.uvs&&(this.uvs=new Float32Array(this.positions.length/3*2)),!this.uvs2&&p.uvs2&&(this.uvs2=new Float32Array(this.positions.length/3*2)),!this.uvs3&&p.uvs3&&(this.uvs3=new Float32Array(this.positions.length/3*2)),!this.uvs4&&p.uvs4&&(this.uvs4=new Float32Array(this.positions.length/3*2)),!this.uvs5&&p.uvs5&&(this.uvs5=new Float32Array(this.positions.length/3*2)),!this.uvs6&&p.uvs6&&(this.uvs6=new Float32Array(this.positions.length/3*2)),!this.colors&&p.colors&&(this.colors=new Float32Array(this.positions.length/3*4),this.colors.fill(1)),!this.matricesIndices&&p.matricesIndices&&(this.matricesIndices=new Float32Array(this.positions.length/3*4)),!this.matricesWeights&&p.matricesWeights&&(this.matricesWeights=new Float32Array(this.positions.length/3*4)),!this.matricesIndicesExtra&&p.matricesIndicesExtra&&(this.matricesIndicesExtra=new Float32Array(this.positions.length/3*4)),!this.matricesWeightsExtra&&p.matricesWeightsExtra&&(this.matricesWeightsExtra=new Float32Array(this.positions.length/3*4)));for(const p of l)if(p){if(o)this.normals&&!p.normals&&(p.normals=new Float32Array(p.positions.length)),this.tangents&&!p.tangents&&(p.tangents=new Float32Array(p.positions.length/3*4)),this.uvs&&!p.uvs&&(p.uvs=new Float32Array(p.positions.length/3*2)),this.uvs2&&!p.uvs2&&(p.uvs2=new Float32Array(p.positions.length/3*2)),this.uvs3&&!p.uvs3&&(p.uvs3=new Float32Array(p.positions.length/3*2)),this.uvs4&&!p.uvs4&&(p.uvs4=new Float32Array(p.positions.length/3*2)),this.uvs5&&!p.uvs5&&(p.uvs5=new Float32Array(p.positions.length/3*2)),this.uvs6&&!p.uvs6&&(p.uvs6=new Float32Array(p.positions.length/3*2)),this.colors&&!p.colors&&(p.colors=new Float32Array(p.positions.length/3*4),p.colors.fill(1)),this.matricesIndices&&!p.matricesIndices&&(p.matricesIndices=new Float32Array(p.positions.length/3*4)),this.matricesWeights&&!p.matricesWeights&&(p.matricesWeights=new Float32Array(p.positions.length/3*4)),this.matricesIndicesExtra&&!p.matricesIndicesExtra&&(p.matricesIndicesExtra=new Float32Array(p.positions.length/3*4)),this.matricesWeightsExtra&&!p.matricesWeightsExtra&&(p.matricesWeightsExtra=new Float32Array(p.positions.length/3*4));else if(p._validate(),!this.normals!=!p.normals||!this.tangents!=!p.tangents||!this.uvs!=!p.uvs||!this.uvs2!=!p.uvs2||!this.uvs3!=!p.uvs3||!this.uvs4!=!p.uvs4||!this.uvs5!=!p.uvs5||!this.uvs6!=!p.uvs6||!this.colors!=!p.colors||!this.matricesIndices!=!p.matricesIndices||!this.matricesWeights!=!p.matricesWeights||!this.matricesIndicesExtra!=!p.matricesIndicesExtra||!this.matricesWeightsExtra!=!p.matricesWeightsExtra)throw new Error("Cannot merge vertex data that do not have the same set of attributes")}if(a){let p=0,g=0,m=0;const v=[];let T=null;const A=[];for(const x of this.splitBasedOnMaterialID())A.push({vertexData:x,transform:e});for(const x of t)if(x.vertexData)for(const E of x.vertexData.splitBasedOnMaterialID())A.push({vertexData:E,transform:x.transform});A.sort((x,E)=>{const R=x.vertexData.materialInfos?x.vertexData.materialInfos[0].materialIndex:0,C=E.vertexData.materialInfos?E.vertexData.materialInfos[0].materialIndex:0;return R>C?1:R===C?0:-1});for(const x of A){const E=x.vertexData;if(E.materialInfos?p=E.materialInfos[0].materialIndex:p=0,T&&T.materialIndex===p)T.indexCount+=E.indices.length,T.verticesCount+=E.positions.length/3;else{const R=new Au;R.materialIndex=p,R.indexStart=g,R.indexCount=E.indices.length,R.verticesStart=m,R.verticesCount=E.positions.length/3,v.push(R),T=R}g+=E.indices.length,m+=E.positions.length/3}const b=A.splice(0,1)[0];h=b.vertexData,e=b.transform,l=A.map(x=>x.vertexData),t=A,this.materialInfos=v}const u=l.reduce((p,g)=>{var m;return p+(((m=g.indices)==null?void 0:m.length)??0)},((d=h.indices)==null?void 0:d.length)??0);let f=r||l.some(p=>p.indices===h.indices)?(_=h.indices)==null?void 0:_.slice():h.indices;if(u>0){let p=(f==null?void 0:f.length)??0;if(f||(f=new Array(u)),f.length!==u){if(Array.isArray(f))f.length=u;else{const m=i||f instanceof Uint32Array?new Uint32Array(u):new Uint16Array(u);m.set(f),f=m}e&&e.determinant()<0&&Q._FlipFaces(f,0,p)}let g=h.positions?h.positions.length/3:0;for(const{vertexData:m,transform:v}of t)if(m.indices){for(let T=0;T<m.indices.length;T++)f[p+T]=m.indices[T]+g;v&&v.determinant()<0&&Q._FlipFaces(f,p,m.indices.length),g+=m.positions.length/3,p+=m.indices.length,s&&(yield)}}return this.indices=f,this.positions=Q._MergeElement(S.PositionKind,h.positions,e,t.map(p=>[p.vertexData.positions,p.transform])),s&&(yield),h.normals&&(this.normals=Q._MergeElement(S.NormalKind,h.normals,e,t.map(p=>[p.vertexData.normals,p.transform])),s&&(yield)),h.tangents&&(this.tangents=Q._MergeElement(S.TangentKind,h.tangents,e,t.map(p=>[p.vertexData.tangents,p.transform])),s&&(yield)),h.uvs&&(this.uvs=Q._MergeElement(S.UVKind,h.uvs,e,t.map(p=>[p.vertexData.uvs,p.transform])),s&&(yield)),h.uvs2&&(this.uvs2=Q._MergeElement(S.UV2Kind,h.uvs2,e,t.map(p=>[p.vertexData.uvs2,p.transform])),s&&(yield)),h.uvs3&&(this.uvs3=Q._MergeElement(S.UV3Kind,h.uvs3,e,t.map(p=>[p.vertexData.uvs3,p.transform])),s&&(yield)),h.uvs4&&(this.uvs4=Q._MergeElement(S.UV4Kind,h.uvs4,e,t.map(p=>[p.vertexData.uvs4,p.transform])),s&&(yield)),h.uvs5&&(this.uvs5=Q._MergeElement(S.UV5Kind,h.uvs5,e,t.map(p=>[p.vertexData.uvs5,p.transform])),s&&(yield)),h.uvs6&&(this.uvs6=Q._MergeElement(S.UV6Kind,h.uvs6,e,t.map(p=>[p.vertexData.uvs6,p.transform])),s&&(yield)),h.colors&&(this.colors=Q._MergeElement(S.ColorKind,h.colors,e,t.map(p=>[p.vertexData.colors,p.transform])),(h.hasVertexAlpha!==void 0||t.some(p=>p.vertexData.hasVertexAlpha!==void 0))&&(this.hasVertexAlpha=h.hasVertexAlpha||t.some(p=>p.vertexData.hasVertexAlpha)),s&&(yield)),h.matricesIndices&&(this.matricesIndices=Q._MergeElement(S.MatricesIndicesKind,h.matricesIndices,e,t.map(p=>[p.vertexData.matricesIndices,p.transform])),s&&(yield)),h.matricesWeights&&(this.matricesWeights=Q._MergeElement(S.MatricesWeightsKind,h.matricesWeights,e,t.map(p=>[p.vertexData.matricesWeights,p.transform])),s&&(yield)),h.matricesIndicesExtra&&(this.matricesIndicesExtra=Q._MergeElement(S.MatricesIndicesExtraKind,h.matricesIndicesExtra,e,t.map(p=>[p.vertexData.matricesIndicesExtra,p.transform])),s&&(yield)),h.matricesWeightsExtra&&(this.matricesWeightsExtra=Q._MergeElement(S.MatricesWeightsExtraKind,h.matricesWeightsExtra,e,t.map(p=>[p.vertexData.matricesWeightsExtra,p.transform]))),this}static _MergeElement(e,t,i,s){const r=s.filter(l=>l[0]!==null&&l[0]!==void 0);if(!t&&r.length==0)return t;if(!t)return this._MergeElement(e,r[0][0],r[0][1],r.slice(1));const a=r.reduce((l,h)=>l+h[0].length,t.length),o=e===S.PositionKind?Q._TransformVector3Coordinates:e===S.NormalKind?Q._TransformVector3Normals:e===S.TangentKind?Q._TransformVector4Normals:()=>{};if(t instanceof Float32Array){const l=new Float32Array(a);l.set(t),i&&o(l,i,0,t.length);let h=t.length;for(const[u,c]of r)l.set(u,h),c&&o(l,c,h,u.length),h+=u.length;return l}else{const l=new Array(a);for(let u=0;u<t.length;u++)l[u]=t[u];i&&o(l,i,0,t.length);let h=t.length;for(const[u,c]of r){for(let f=0;f<u.length;f++)l[h+f]=u[f];c&&o(l,c,h,u.length),h+=u.length}return l}}_validate(){if(!this.positions)throw new Sn("Positions are required",Ur.MeshInvalidPositionsError);const e=(s,r)=>{const a=S.DeduceStride(s);if(r.length%a!==0)throw new Error("The "+s+"s array count must be a multiple of "+a);return r.length/a},t=e(S.PositionKind,this.positions),i=(s,r)=>{const a=e(s,r);if(a!==t)throw new Error("The "+s+"s element count ("+a+") does not match the positions count ("+t+")")};this.normals&&i(S.NormalKind,this.normals),this.tangents&&i(S.TangentKind,this.tangents),this.uvs&&i(S.UVKind,this.uvs),this.uvs2&&i(S.UV2Kind,this.uvs2),this.uvs3&&i(S.UV3Kind,this.uvs3),this.uvs4&&i(S.UV4Kind,this.uvs4),this.uvs5&&i(S.UV5Kind,this.uvs5),this.uvs6&&i(S.UV6Kind,this.uvs6),this.colors&&i(S.ColorKind,this.colors),this.matricesIndices&&i(S.MatricesIndicesKind,this.matricesIndices),this.matricesWeights&&i(S.MatricesWeightsKind,this.matricesWeights),this.matricesIndicesExtra&&i(S.MatricesIndicesExtraKind,this.matricesIndicesExtra),this.matricesWeightsExtra&&i(S.MatricesWeightsExtraKind,this.matricesWeightsExtra)}clone(){const e=this.serialize();return Q.Parse(e)}serialize(){const e={};if(this.positions&&(e.positions=Array.from(this.positions)),this.normals&&(e.normals=Array.from(this.normals)),this.tangents&&(e.tangents=Array.from(this.tangents)),this.uvs&&(e.uvs=Array.from(this.uvs)),this.uvs2&&(e.uvs2=Array.from(this.uvs2)),this.uvs3&&(e.uvs3=Array.from(this.uvs3)),this.uvs4&&(e.uvs4=Array.from(this.uvs4)),this.uvs5&&(e.uvs5=Array.from(this.uvs5)),this.uvs6&&(e.uvs6=Array.from(this.uvs6)),this.colors&&(e.colors=Array.from(this.colors),e.hasVertexAlpha=this.hasVertexAlpha),this.matricesIndices&&(e.matricesIndices=Array.from(this.matricesIndices),e.matricesIndices._isExpanded=!0),this.matricesWeights&&(e.matricesWeights=Array.from(this.matricesWeights)),this.matricesIndicesExtra&&(e.matricesIndicesExtra=Array.from(this.matricesIndicesExtra),e.matricesIndicesExtra._isExpanded=!0),this.matricesWeightsExtra&&(e.matricesWeightsExtra=Array.from(this.matricesWeightsExtra)),e.indices=this.indices?Array.from(this.indices):[],this.materialInfos){e.materialInfos=[];for(const t of this.materialInfos){const i={indexStart:t.indexStart,indexCount:t.indexCount,materialIndex:t.materialIndex,verticesStart:t.verticesStart,verticesCount:t.verticesCount};e.materialInfos.push(i)}}return e}static ExtractFromMesh(e,t,i){return Q._ExtractFrom(e,t,i)}static ExtractFromGeometry(e,t,i){return Q._ExtractFrom(e,t,i)}static _ExtractFrom(e,t,i){const s=new Q;if(e.isVerticesDataPresent(S.PositionKind)&&(s.positions=e.getVerticesData(S.PositionKind,t,i)),e.isVerticesDataPresent(S.NormalKind)&&(s.normals=e.getVerticesData(S.NormalKind,t,i)),e.isVerticesDataPresent(S.TangentKind)&&(s.tangents=e.getVerticesData(S.TangentKind,t,i)),e.isVerticesDataPresent(S.UVKind)&&(s.uvs=e.getVerticesData(S.UVKind,t,i)),e.isVerticesDataPresent(S.UV2Kind)&&(s.uvs2=e.getVerticesData(S.UV2Kind,t,i)),e.isVerticesDataPresent(S.UV3Kind)&&(s.uvs3=e.getVerticesData(S.UV3Kind,t,i)),e.isVerticesDataPresent(S.UV4Kind)&&(s.uvs4=e.getVerticesData(S.UV4Kind,t,i)),e.isVerticesDataPresent(S.UV5Kind)&&(s.uvs5=e.getVerticesData(S.UV5Kind,t,i)),e.isVerticesDataPresent(S.UV6Kind)&&(s.uvs6=e.getVerticesData(S.UV6Kind,t,i)),e.isVerticesDataPresent(S.ColorKind)){const r=e.geometry||e,a=r.getVertexBuffer(S.ColorKind),o=r.getVerticesData(S.ColorKind,t,i);if(a.getSize()===3){const l=new Float32Array(o.length*4/3);for(let h=0,u=0;h<o.length;h+=3,u+=4)l[u]=o[h],l[u+1]=o[h+1],l[u+2]=o[h+2],l[u+3]=1;s.colors=l}else if(a.getSize()===4)s.colors=o;else throw new Error(`Unexpected number of color components: ${a.getSize()}`)}return e.isVerticesDataPresent(S.MatricesIndicesKind)&&(s.matricesIndices=e.getVerticesData(S.MatricesIndicesKind,t,i)),e.isVerticesDataPresent(S.MatricesWeightsKind)&&(s.matricesWeights=e.getVerticesData(S.MatricesWeightsKind,t,i)),e.isVerticesDataPresent(S.MatricesIndicesExtraKind)&&(s.matricesIndicesExtra=e.getVerticesData(S.MatricesIndicesExtraKind,t,i)),e.isVerticesDataPresent(S.MatricesWeightsExtraKind)&&(s.matricesWeightsExtra=e.getVerticesData(S.MatricesWeightsExtraKind,t,i)),s.indices=e.getIndices(t,i),s}static CreateRibbon(e){throw Ee("ribbonBuilder")}static CreateBox(e){throw Ee("boxBuilder")}static CreateTiledBox(e){throw Ee("tiledBoxBuilder")}static CreateTiledPlane(e){throw Ee("tiledPlaneBuilder")}static CreateSphere(e){throw Ee("sphereBuilder")}static CreateCylinder(e){throw Ee("cylinderBuilder")}static CreateTorus(e){throw Ee("torusBuilder")}static CreateLineSystem(e){throw Ee("linesBuilder")}static CreateDashedLines(e){throw Ee("linesBuilder")}static CreateGround(e){throw Ee("groundBuilder")}static CreateTiledGround(e){throw Ee("groundBuilder")}static CreateGroundFromHeightMap(e){throw Ee("groundBuilder")}static CreatePlane(e){throw Ee("planeBuilder")}static CreateDisc(e){throw Ee("discBuilder")}static CreatePolygon(e,t,i,s,r,a,o){throw Ee("polygonBuilder")}static CreateIcoSphere(e){throw Ee("icoSphereBuilder")}static CreatePolyhedron(e){throw Ee("polyhedronBuilder")}static CreateCapsule(e={orientation:y.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6}){throw Ee("capsuleBuilder")}static CreateTorusKnot(e){throw Ee("torusKnotBuilder")}static ComputeNormals(e,t,i,s){let r=0,a=0,o=0,l=0,h=0,u=0,c=0,f=0,d=0,_=0,p=0,g=0,m=0,v=0,T=0,A=0,b=0,x=0,E=0,R=0,C=!1,I=!1,D=!1,w=!1,z=1,F=0,W=null;s&&(C=!!s.facetNormals,I=!!s.facetPositions,D=!!s.facetPartitioning,z=s.useRightHandedSystem===!0?-1:1,F=s.ratio||0,w=!!s.depthSort,W=s.distanceTo,w&&W===void 0&&(W=y.Zero()));let X=0,he=0,H=0,G=0;for(D&&s&&s.bbSize&&(X=s.subDiv.X*F/s.bbSize.x,he=s.subDiv.Y*F/s.bbSize.y,H=s.subDiv.Z*F/s.bbSize.z,G=s.subDiv.max*s.subDiv.max,s.facetPartitioning.length=0),r=0;r<e.length;r++)i[r]=0;const k=t.length/3|0;for(r=0;r<k;r++){if(g=t[r*3]*3,m=g+1,v=g+2,T=t[r*3+1]*3,A=T+1,b=T+2,x=t[r*3+2]*3,E=x+1,R=x+2,a=e[g]-e[T],o=e[m]-e[A],l=e[v]-e[b],h=e[x]-e[T],u=e[E]-e[A],c=e[R]-e[b],f=z*(o*c-l*u),d=z*(l*h-a*c),_=z*(a*u-o*h),p=Math.sqrt(f*f+d*d+_*_),p=p===0?1:p,f/=p,d/=p,_/=p,C&&s&&(s.facetNormals[r].x=f,s.facetNormals[r].y=d,s.facetNormals[r].z=_),I&&s&&(s.facetPositions[r].x=(e[g]+e[T]+e[x])/3,s.facetPositions[r].y=(e[m]+e[A]+e[E])/3,s.facetPositions[r].z=(e[v]+e[b]+e[R])/3),D&&s){const M=Math.floor((s.facetPositions[r].x-s.bInfo.minimum.x*F)*X),V=Math.floor((s.facetPositions[r].y-s.bInfo.minimum.y*F)*he),j=Math.floor((s.facetPositions[r].z-s.bInfo.minimum.z*F)*H),ae=Math.floor((e[g]-s.bInfo.minimum.x*F)*X),ge=Math.floor((e[m]-s.bInfo.minimum.y*F)*he),$=Math.floor((e[v]-s.bInfo.minimum.z*F)*H),le=Math.floor((e[T]-s.bInfo.minimum.x*F)*X),xe=Math.floor((e[A]-s.bInfo.minimum.y*F)*he),ue=Math.floor((e[b]-s.bInfo.minimum.z*F)*H),Se=Math.floor((e[x]-s.bInfo.minimum.x*F)*X),ze=Math.floor((e[E]-s.bInfo.minimum.y*F)*he),pe=Math.floor((e[R]-s.bInfo.minimum.z*F)*H),Pe=ae+s.subDiv.max*ge+G*$,me=le+s.subDiv.max*xe+G*ue,Ke=Se+s.subDiv.max*ze+G*pe,et=M+s.subDiv.max*V+G*j;s.facetPartitioning[et]=s.facetPartitioning[et]?s.facetPartitioning[et]:new Array,s.facetPartitioning[Pe]=s.facetPartitioning[Pe]?s.facetPartitioning[Pe]:new Array,s.facetPartitioning[me]=s.facetPartitioning[me]?s.facetPartitioning[me]:new Array,s.facetPartitioning[Ke]=s.facetPartitioning[Ke]?s.facetPartitioning[Ke]:new Array,s.facetPartitioning[Pe].push(r),me!=Pe&&s.facetPartitioning[me].push(r),Ke==me||Ke==Pe||s.facetPartitioning[Ke].push(r),et==Pe||et==me||et==Ke||s.facetPartitioning[et].push(r)}if(w&&s&&s.facetPositions){const M=s.depthSortedFacets[r];M.ind=r*3,M.sqDistance=y.DistanceSquared(s.facetPositions[r],W)}i[g]+=f,i[m]+=d,i[v]+=_,i[T]+=f,i[A]+=d,i[b]+=_,i[x]+=f,i[E]+=d,i[R]+=_}for(r=0;r<i.length/3;r++)f=i[r*3],d=i[r*3+1],_=i[r*3+2],p=Math.sqrt(f*f+d*d+_*_),p=p===0?1:p,f/=p,d/=p,_/=p,i[r*3]=f,i[r*3+1]=d,i[r*3+2]=_}static _ComputeSides(e,t,i,s,r,a,o){const l=i.length,h=s.length;let u,c;switch(e=e||Q.DEFAULTSIDE,e){case Q.FRONTSIDE:break;case Q.BACKSIDE:for(u=0;u<l;u+=3){const f=i[u];i[u]=i[u+2],i[u+2]=f}for(c=0;c<h;c++)s[c]=-s[c];break;case Q.DOUBLESIDE:{const f=t.length,d=f/3;for(let g=0;g<f;g++)t[f+g]=t[g];for(u=0;u<l;u+=3)i[u+l]=i[u+2]+d,i[u+1+l]=i[u+1]+d,i[u+2+l]=i[u]+d;for(c=0;c<h;c++)s[h+c]=-s[c];const _=r.length;let p=0;for(p=0;p<_;p++)r[p+_]=r[p];for(a=a||new Oe(0,0,1,1),o=o||new Oe(0,0,1,1),p=0,u=0;u<_/2;u++)r[p]=a.x+(a.z-a.x)*r[p],r[p+1]=a.y+(a.w-a.y)*r[p+1],r[p+_]=o.x+(o.z-o.x)*r[p+_],r[p+_+1]=o.y+(o.w-o.y)*r[p+_+1],p+=2;break}}}static Parse(e){const t=new Q,i=e.positions;i&&t.set(i,S.PositionKind);const s=e.normals;s&&t.set(s,S.NormalKind);const r=e.tangents;r&&t.set(r,S.TangentKind);const a=e.uvs;a&&t.set(a,S.UVKind);const o=e.uvs2;o&&t.set(o,S.UV2Kind);const l=e.uvs3;l&&t.set(l,S.UV3Kind);const h=e.uvs4;h&&t.set(h,S.UV4Kind);const u=e.uvs5;u&&t.set(u,S.UV5Kind);const c=e.uvs6;c&&t.set(c,S.UV6Kind);const f=e.colors;f&&(t.set(K.CheckColors4(f,i.length/3),S.ColorKind),e.hasVertexAlpha!==void 0&&(t.hasVertexAlpha=e.hasVertexAlpha));const d=e.matricesIndices;d&&t.set(d,S.MatricesIndicesKind);const _=e.matricesWeights;_&&t.set(_,S.MatricesWeightsKind);const p=e.indices;p&&(t.indices=p);const g=e.materialInfos;if(g){t.materialInfos=[];for(const m of g){const v=new Au;v.indexCount=m.indexCount,v.indexStart=m.indexStart,v.verticesCount=m.verticesCount,v.verticesStart=m.verticesStart,v.materialIndex=m.materialIndex,t.materialInfos.push(v)}}return t}static ImportVertexData(e,t){const i=Q.Parse(e);t.setAllVerticesData(i,e.updatable)}}Q.FRONTSIDE=0;Q.BACKSIDE=1;Q.DOUBLESIDE=2;Q.DEFAULTSIDE=0;Q._UniqueIDGenerator=0;P([yn.filter((...[n])=>!Array.isArray(n))],Q,"_TransformVector3Coordinates",null);P([yn.filter((...[n])=>!Array.isArray(n))],Q,"_TransformVector3Normals",null);P([yn.filter((...[n])=>!Array.isArray(n))],Q,"_TransformVector4Normals",null);P([yn.filter((...[n])=>!Array.isArray(n))],Q,"_FlipFaces",null);class WA{constructor(){this._doNotSerialize=!1,this._isDisposed=!1,this._sceneRootNodesIndex=-1,this._isEnabled=!0,this._isParentEnabled=!0,this._isReady=!0,this._onEnabledStateChangedObservable=new q,this._onClonedObservable=new q}}class Rt{static AddNodeConstructor(e,t){this._NodeConstructors[e]=t}static Construct(e,t,i,s){const r=this._NodeConstructors[e];return r?r(t,i,s):null}set accessibilityTag(e){this._accessibilityTag=e,this.onAccessibilityTagChangedObservable.notifyObservers(e)}get accessibilityTag(){return this._accessibilityTag}get doNotSerialize(){return this._nodeDataStorage._doNotSerialize?!0:this._parentNode?this._parentNode.doNotSerialize:!1}set doNotSerialize(e){this._nodeDataStorage._doNotSerialize=e}isDisposed(){return this._nodeDataStorage._isDisposed}set parent(e){if(this._parentNode===e)return;const t=this._parentNode;if(this._parentNode&&this._parentNode._children!==void 0&&this._parentNode._children!==null){const i=this._parentNode._children.indexOf(this);i!==-1&&this._parentNode._children.splice(i,1),!e&&!this._nodeDataStorage._isDisposed&&this._addToSceneRootNodes()}this._parentNode=e,this._isDirty=!0,this._parentNode&&((this._parentNode._children===void 0||this._parentNode._children===null)&&(this._parentNode._children=new Array),this._parentNode._children.push(this),t||this._removeFromSceneRootNodes()),this._syncParentEnabledState()}get parent(){return this._parentNode}_serializeAsParent(e){e.parentId=this.uniqueId}_addToSceneRootNodes(){this._nodeDataStorage._sceneRootNodesIndex===-1&&(this._nodeDataStorage._sceneRootNodesIndex=this._scene.rootNodes.length,this._scene.rootNodes.push(this))}_removeFromSceneRootNodes(){if(this._nodeDataStorage._sceneRootNodesIndex!==-1){const e=this._scene.rootNodes,t=e.length-1;e[this._nodeDataStorage._sceneRootNodesIndex]=e[t],e[this._nodeDataStorage._sceneRootNodesIndex]._nodeDataStorage._sceneRootNodesIndex=this._nodeDataStorage._sceneRootNodesIndex,this._scene.rootNodes.pop(),this._nodeDataStorage._sceneRootNodesIndex=-1}}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(e){this._animationPropertiesOverride=e}getClassName(){return"Node"}set onDispose(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)}get onEnabledStateChangedObservable(){return this._nodeDataStorage._onEnabledStateChangedObservable}get onClonedObservable(){return this._nodeDataStorage._onClonedObservable}constructor(e,t=null,i=!0){this._isDirty=!1,this._nodeDataStorage=new WA,this.state="",this.metadata=null,this.reservedDataStore=null,this._accessibilityTag=null,this.onAccessibilityTagChangedObservable=new q,this._parentContainer=null,this.animations=[],this._ranges={},this.onReady=null,this._currentRenderId=-1,this._parentUpdateId=-1,this._childUpdateId=-1,this._waitingParentId=null,this._waitingParentInstanceIndex=null,this._waitingParsedUniqueId=null,this._cache={},this._parentNode=null,this._children=null,this._worldMatrix=L.Identity(),this._worldMatrixDeterminant=0,this._worldMatrixDeterminantIsDirty=!0,this._animationPropertiesOverride=null,this._isNode=!0,this.onDisposeObservable=new q,this._onDisposeObserver=null,this._behaviors=new Array,this.name=e,this.id=e,this._scene=t||Ae.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._initCache(),i&&this._addToSceneRootNodes()}getScene(){return this._scene}getEngine(){return this._scene.getEngine()}addBehavior(e,t=!1){return this._behaviors.indexOf(e)!==-1?this:(e.init(),this._scene.isLoading&&!t?this._scene.onDataLoadedObservable.addOnce(()=>{e.attach(this)}):e.attach(this),this._behaviors.push(e),this)}removeBehavior(e){const t=this._behaviors.indexOf(e);return t===-1?this:(this._behaviors[t].detach(),this._behaviors.splice(t,1),this)}get behaviors(){return this._behaviors}getBehaviorByName(e){for(const t of this._behaviors)if(t.name===e)return t;return null}getWorldMatrix(){return this._currentRenderId!==this._scene.getRenderId()&&this.computeWorldMatrix(),this._worldMatrix}_getWorldMatrixDeterminant(){return this._worldMatrixDeterminantIsDirty&&(this._worldMatrixDeterminantIsDirty=!1,this._worldMatrixDeterminant=this._worldMatrix.determinant()),this._worldMatrixDeterminant}get worldMatrixFromCache(){return this._worldMatrix}_initCache(){this._cache={}}updateCache(e){!e&&this.isSynchronized()||this._updateCache()}_getActionManagerForTrigger(e,t=!0){return this.parent?this.parent._getActionManagerForTrigger(e,!1):null}_updateCache(e){}_isSynchronized(){return!0}_markSyncedWithParent(){this._parentNode&&(this._parentUpdateId=this._parentNode._childUpdateId)}isSynchronizedWithParent(){return this._parentNode?this._parentNode._isDirty||this._parentUpdateId!==this._parentNode._childUpdateId?!1:this._parentNode.isSynchronized():!0}isSynchronized(){return this._parentNode&&!this.isSynchronizedWithParent()?!1:this._isSynchronized()}isReady(e=!1){return this._nodeDataStorage._isReady}markAsDirty(e){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this}isEnabled(e=!0){return e===!1?this._nodeDataStorage._isEnabled:this._nodeDataStorage._isEnabled?this._nodeDataStorage._isParentEnabled:!1}_syncParentEnabledState(){this._nodeDataStorage._isParentEnabled=this._parentNode?this._parentNode.isEnabled():!0,this._children&&this._children.forEach(e=>{e._syncParentEnabledState()})}setEnabled(e){this._nodeDataStorage._isEnabled!==e&&(this._nodeDataStorage._isEnabled=e,this._syncParentEnabledState(),this._nodeDataStorage._onEnabledStateChangedObservable.notifyObservers(e))}isDescendantOf(e){return this.parent?this.parent===e?!0:this.parent.isDescendantOf(e):!1}_getDescendants(e,t=!1,i){if(this._children)for(let s=0;s<this._children.length;s++){const r=this._children[s];(!i||i(r))&&e.push(r),t||r._getDescendants(e,!1,i)}}getDescendants(e,t){const i=[];return this._getDescendants(i,e,t),i}getChildMeshes(e,t){const i=[];return this._getDescendants(i,e,s=>(!t||t(s))&&s.cullingStrategy!==void 0),i}getChildren(e,t=!0){return this.getDescendants(t,e)}_setReady(e){if(e!==this._nodeDataStorage._isReady){if(!e){this._nodeDataStorage._isReady=!1;return}this.onReady&&this.onReady(this),this._nodeDataStorage._isReady=!0}}getAnimationByName(e){for(let t=0;t<this.animations.length;t++){const i=this.animations[t];if(i.name===e)return i}return null}createAnimationRange(e,t,i){if(!this._ranges[e]){this._ranges[e]=Rt._AnimationRangeFactory(e,t,i);for(let s=0,r=this.animations.length;s<r;s++)this.animations[s]&&this.animations[s].createRange(e,t,i)}}deleteAnimationRange(e,t=!0){for(let i=0,s=this.animations.length;i<s;i++)this.animations[i]&&this.animations[i].deleteRange(e,t);this._ranges[e]=null}getAnimationRange(e){return this._ranges[e]||null}clone(e,t,i){const s=Ie.Clone(()=>new Rt(e,this.getScene()),this);if(t&&(s.parent=t),!i){const r=this.getDescendants(!0);for(let a=0;a<r.length;a++){const o=r[a];o.clone(e+"."+o.name,s)}}return s}getAnimationRanges(){const e=[];let t;for(t in this._ranges)e.push(this._ranges[t]);return e}beginAnimation(e,t,i,s){const r=this.getAnimationRange(e);return r?this._scene.beginAnimation(this,r.from,r.to,t,i,s):null}serializeAnimationRanges(){const e=[];for(const t in this._ranges){const i=this._ranges[t];if(!i)continue;const s={};s.name=t,s.from=i.from,s.to=i.to,e.push(s)}return e}computeWorldMatrix(e){return this._worldMatrix||(this._worldMatrix=L.Identity()),this._worldMatrix}dispose(e,t=!1){if(this._nodeDataStorage._isDisposed=!0,!e){const i=this.getDescendants(!0);for(const s of i)s.dispose(e,t)}this.parent?this.parent=null:this._removeFromSceneRootNodes(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onEnabledStateChangedObservable.clear(),this.onClonedObservable.clear();for(const i of this._behaviors)i.detach();this._behaviors.length=0,this.metadata=null}static ParseAnimationRanges(e,t,i){if(t.ranges)for(let s=0;s<t.ranges.length;s++){const r=t.ranges[s];e.createAnimationRange(r.name,r.from,r.to)}}getHierarchyBoundingVectors(e=!0,t=null){this.getScene().incrementRenderId(),this.computeWorldMatrix(!0);let i,s;const r=this;if(r.getBoundingInfo&&r.subMeshes){const a=r.getBoundingInfo();i=a.boundingBox.minimumWorld.clone(),s=a.boundingBox.maximumWorld.clone()}else i=new y(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),s=new y(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);if(e){const a=this.getDescendants(!1);for(const o of a){const l=o;if(l.computeWorldMatrix(!0),t&&!t(l)||!l.getBoundingInfo||l.getTotalVertices()===0)continue;const u=l.getBoundingInfo().boundingBox,c=u.minimumWorld,f=u.maximumWorld;y.CheckExtends(c,i,s),y.CheckExtends(f,i,s)}}return{min:i,max:s}}}Rt._AnimationRangeFactory=(n,e,t)=>{throw Ee("AnimationRange")};Rt._NodeConstructors={};P([B()],Rt.prototype,"name",void 0);P([B()],Rt.prototype,"id",void 0);P([B()],Rt.prototype,"uniqueId",void 0);P([B()],Rt.prototype,"state",void 0);P([B()],Rt.prototype,"metadata",void 0);const HA=L.Compose(y.One(),se.FromEulerAngles(0,Math.PI,0),y.Zero());class Re extends Rt{get billboardMode(){return this._billboardMode}set billboardMode(e){this._billboardMode!==e&&(this._billboardMode=e,this._cache.useBillboardPosition=(this._billboardMode&Re.BILLBOARDMODE_USE_POSITION)!==0,this._computeUseBillboardPath())}get preserveParentRotationForBillboard(){return this._preserveParentRotationForBillboard}set preserveParentRotationForBillboard(e){e!==this._preserveParentRotationForBillboard&&(this._preserveParentRotationForBillboard=e,this._computeUseBillboardPath())}_computeUseBillboardPath(){this._cache.useBillboardPath=this._billboardMode!==Re.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard}get infiniteDistance(){return this._infiniteDistance}set infiniteDistance(e){this._infiniteDistance!==e&&(this._infiniteDistance=e)}constructor(e,t=null,i=!0){super(e,t,!1),this._forward=new y(0,0,1),this._up=new y(0,1,0),this._right=new y(1,0,0),this._position=y.Zero(),this._rotation=y.Zero(),this._rotationQuaternion=null,this._scaling=y.One(),this._transformToBoneReferal=null,this._isAbsoluteSynced=!1,this._billboardMode=Re.BILLBOARDMODE_NONE,this._preserveParentRotationForBillboard=!1,this.scalingDeterminant=1,this._infiniteDistance=!1,this.ignoreNonUniformScaling=!1,this.reIntegrateRotationIntoRotationQuaternion=!1,this._poseMatrix=null,this._localMatrix=L.Zero(),this._usePivotMatrix=!1,this._absolutePosition=y.Zero(),this._absoluteScaling=y.Zero(),this._absoluteRotationQuaternion=se.Identity(),this._pivotMatrix=L.Identity(),this._postMultiplyPivotMatrix=!1,this._isWorldMatrixFrozen=!1,this._indexInSceneTransformNodesArray=-1,this.onAfterWorldMatrixUpdateObservable=new q,this._nonUniformScaling=!1,i&&this.getScene().addTransformNode(this)}getClassName(){return"TransformNode"}get position(){return this._position}set position(e){this._position=e,this._markAsDirtyInternal()}isUsingPivotMatrix(){return this._usePivotMatrix}isUsingPostMultiplyPivotMatrix(){return this._postMultiplyPivotMatrix}get rotation(){return this._rotation}set rotation(e){this._rotation=e,this._rotationQuaternion=null,this._markAsDirtyInternal()}get scaling(){return this._scaling}set scaling(e){this._scaling=e,this._markAsDirtyInternal()}get rotationQuaternion(){return this._rotationQuaternion}set rotationQuaternion(e){this._rotationQuaternion=e,e&&this._rotation.setAll(0),this._markAsDirtyInternal()}_markAsDirtyInternal(){this._isDirty||(this._isDirty=!0,this.customMarkAsDirty&&this.customMarkAsDirty())}get forward(){return y.TransformNormalFromFloatsToRef(0,0,this.getScene().useRightHandedSystem?-1:1,this.getWorldMatrix(),this._forward),this._forward.normalize()}get up(){return y.TransformNormalFromFloatsToRef(0,1,0,this.getWorldMatrix(),this._up),this._up.normalize()}get right(){return y.TransformNormalFromFloatsToRef(this.getScene().useRightHandedSystem?-1:1,0,0,this.getWorldMatrix(),this._right),this._right.normalize()}updatePoseMatrix(e){return this._poseMatrix?(this._poseMatrix.copyFrom(e),this):(this._poseMatrix=e.clone(),this)}getPoseMatrix(){return this._poseMatrix||(this._poseMatrix=L.Identity()),this._poseMatrix}_isSynchronized(){const e=this._cache;return!(this._billboardMode!==e.billboardMode||this._billboardMode!==Re.BILLBOARDMODE_NONE||e.pivotMatrixUpdated||this._infiniteDistance||this._position._isDirty||this._scaling._isDirty||this._rotationQuaternion&&this._rotationQuaternion._isDirty||this._rotation._isDirty)}_initCache(){super._initCache();const e=this._cache;e.localMatrixUpdated=!1,e.billboardMode=-1,e.infiniteDistance=!1,e.useBillboardPosition=!1,e.useBillboardPath=!1}get absolutePosition(){return this.getAbsolutePosition()}get absoluteScaling(){return this._syncAbsoluteScalingAndRotation(),this._absoluteScaling}get absoluteRotationQuaternion(){return this._syncAbsoluteScalingAndRotation(),this._absoluteRotationQuaternion}setPreTransformMatrix(e){return this.setPivotMatrix(e,!1)}setPivotMatrix(e,t=!0){return this._pivotMatrix.copyFrom(e),this._usePivotMatrix=!this._pivotMatrix.isIdentity(),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=t,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=L.Invert(this._pivotMatrix)),this}getPivotMatrix(){return this._pivotMatrix}instantiateHierarchy(e=null,t,i){const s=this.clone("Clone of "+(this.name||this.id),e||this.parent,!0);s&&i&&i(this,s);for(const r of this.getChildTransformNodes(!0))r.instantiateHierarchy(s,t,i);return s}freezeWorldMatrix(e=null,t=!1){return e?t?(this._rotation.setAll(0),this._rotationQuaternion=this._rotationQuaternion||se.Identity(),e.decompose(this._scaling,this._rotationQuaternion,this._position),this.computeWorldMatrix(!0)):(this._worldMatrix=e,this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._afterComputeWorldMatrix()):(this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0)),this._isDirty=!1,this._isWorldMatrixFrozen=!0,this}unfreezeWorldMatrix(){return this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0),this}get isWorldMatrixFrozen(){return this._isWorldMatrixFrozen}getAbsolutePosition(){return this.computeWorldMatrix(),this._absolutePosition}setAbsolutePosition(e){if(!e)return this;let t,i,s;if(e.x===void 0){if(arguments.length<3)return this;t=arguments[0],i=arguments[1],s=arguments[2]}else t=e.x,i=e.y,s=e.z;if(this.parent){const r=N.Matrix[0];this.parent.getWorldMatrix().invertToRef(r),y.TransformCoordinatesFromFloatsToRef(t,i,s,r,this.position)}else this.position.x=t,this.position.y=i,this.position.z=s;return this._absolutePosition.copyFrom(e),this}setPositionWithLocalVector(e){return this.computeWorldMatrix(),this.position=y.TransformNormal(e,this._localMatrix),this}getPositionExpressedInLocalSpace(){this.computeWorldMatrix();const e=N.Matrix[0];return this._localMatrix.invertToRef(e),y.TransformNormal(this.position,e)}locallyTranslate(e){return this.computeWorldMatrix(!0),this.position=y.TransformCoordinates(e,this._localMatrix),this}lookAt(e,t=0,i=0,s=0,r=0){const a=Re._LookAtVectorCache,o=r===0?this.position:this.getAbsolutePosition();if(e.subtractToRef(o,a),this.setDirection(a,t,i,s),r===1&&this.parent)if(this.rotationQuaternion){const l=N.Matrix[0];this.rotationQuaternion.toRotationMatrix(l);const h=N.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(h),h.invert(),l.multiplyToRef(h,l),this.rotationQuaternion.fromRotationMatrix(l)}else{const l=N.Quaternion[0];se.FromEulerVectorToRef(this.rotation,l);const h=N.Matrix[0];l.toRotationMatrix(h);const u=N.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(u),u.invert(),h.multiplyToRef(u,h),l.fromRotationMatrix(h),l.toEulerAnglesToRef(this.rotation)}return this}getDirection(e){const t=y.Zero();return this.getDirectionToRef(e,t),t}getDirectionToRef(e,t){return y.TransformNormalToRef(e,this.getWorldMatrix(),t),this}setDirection(e,t=0,i=0,s=0){const r=-Math.atan2(e.z,e.x)+Math.PI/2,a=Math.sqrt(e.x*e.x+e.z*e.z),o=-Math.atan2(e.y,a);return this.rotationQuaternion?se.RotationYawPitchRollToRef(r+t,o+i,s,this.rotationQuaternion):(this.rotation.x=o+i,this.rotation.y=r+t,this.rotation.z=s),this}setPivotPoint(e,t=0){this.getScene().getRenderId()==0&&this.computeWorldMatrix(!0);const i=this.getWorldMatrix();if(t==1){const s=N.Matrix[0];i.invertToRef(s),e=y.TransformCoordinates(e,s)}return this.setPivotMatrix(L.Translation(-e.x,-e.y,-e.z),!0)}getPivotPoint(){const e=y.Zero();return this.getPivotPointToRef(e),e}getPivotPointToRef(e){return e.x=-this._pivotMatrix.m[12],e.y=-this._pivotMatrix.m[13],e.z=-this._pivotMatrix.m[14],this}getAbsolutePivotPoint(){const e=y.Zero();return this.getAbsolutePivotPointToRef(e),e}getAbsolutePivotPointToRef(e){return this.getPivotPointToRef(e),y.TransformCoordinatesToRef(e,this.getWorldMatrix(),e),this}markAsDirty(e){if(this._isDirty)return this;if(this._children)for(const t of this._children)t.markAsDirty(e);return super.markAsDirty(e)}setParent(e,t=!1,i=!1){if(!e&&!this.parent)return this;const s=N.Quaternion[0],r=N.Vector3[0],a=N.Vector3[1],o=N.Matrix[1];L.IdentityToRef(o);const l=N.Matrix[0];this.computeWorldMatrix(!0);let h=this.rotationQuaternion;return h||(h=Re._TmpRotation,se.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,h)),L.ComposeToRef(this.scaling,h,this.position,l),this.parent&&l.multiplyToRef(this.parent.computeWorldMatrix(!0),l),e&&(e.computeWorldMatrix(!0).invertToRef(o),l.multiplyToRef(o,l)),l.decompose(a,s,r,t?this:void 0),this.rotationQuaternion?this.rotationQuaternion.copyFrom(s):s.toEulerAnglesToRef(this.rotation),this.scaling.copyFrom(a),this.position.copyFrom(r),this.parent=e,i&&this.setPivotMatrix(L.Identity()),this}addChild(e,t=!1){return e.setParent(this,t),this}removeChild(e,t=!1){return e.parent!==this?this:(e.setParent(null,t),this)}get nonUniformScaling(){return this._nonUniformScaling}_updateNonUniformScalingState(e){return this._nonUniformScaling===e?!1:(this._nonUniformScaling=e,!0)}attachToBone(e,t){return this._currentParentWhenAttachingToBone=this.parent,this._transformToBoneReferal=t,this.parent=e,e.getSkeleton().prepare(!0),e.getFinalMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this}detachFromBone(e=!1){return this.parent?(this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,e?this.parent=this._currentParentWhenAttachingToBone:this.parent=null,this):(e&&(this.parent=this._currentParentWhenAttachingToBone),this)}rotate(e,t,i){e.normalize(),this.rotationQuaternion||(this.rotationQuaternion=this.rotation.toQuaternion(),this.rotation.setAll(0));let s;if(!i||i===0)s=se.RotationAxisToRef(e,t,Re._RotationAxisCache),this.rotationQuaternion.multiplyToRef(s,this.rotationQuaternion);else{if(this.parent){const r=this.parent.getWorldMatrix(),a=N.Matrix[0];r.invertToRef(a),e=y.TransformNormal(e,a),r.determinant()<0&&(t*=-1)}s=se.RotationAxisToRef(e,t,Re._RotationAxisCache),s.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}return this}rotateAround(e,t,i){t.normalize(),this.rotationQuaternion||(this.rotationQuaternion=se.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.setAll(0));const s=N.Vector3[0],r=N.Vector3[1],a=N.Vector3[2],o=N.Quaternion[0],l=N.Matrix[0],h=N.Matrix[1],u=N.Matrix[2],c=N.Matrix[3];return e.subtractToRef(this.position,s),L.TranslationToRef(s.x,s.y,s.z,l),L.TranslationToRef(-s.x,-s.y,-s.z,h),L.RotationAxisToRef(t,i,u),h.multiplyToRef(u,c),c.multiplyToRef(l,c),c.decompose(r,o,a),this.position.addInPlace(a),o.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this}translate(e,t,i){const s=e.scale(t);if(!i||i===0){const r=this.getPositionExpressedInLocalSpace().add(s);this.setPositionWithLocalVector(r)}else this.setAbsolutePosition(this.getAbsolutePosition().add(s));return this}addRotation(e,t,i){let s;this.rotationQuaternion?s=this.rotationQuaternion:(s=N.Quaternion[1],se.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,s));const r=N.Quaternion[0];return se.RotationYawPitchRollToRef(t,e,i,r),s.multiplyInPlace(r),this.rotationQuaternion||s.toEulerAnglesToRef(this.rotation),this}_getEffectiveParent(){return this.parent}isWorldMatrixCameraDependent(){return this._infiniteDistance&&!this.parent||this._billboardMode!==Re.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard}computeWorldMatrix(e=!1,t=null){if(this._isWorldMatrixFrozen&&!this._isDirty)return this._worldMatrix;const i=this.getScene().getRenderId();if(!this._isDirty&&!e&&(this._currentRenderId===i||this.isSynchronized()))return this._currentRenderId=i,this._worldMatrix;t=t||this.getScene().activeCamera,this._updateCache();const s=this._cache;s.pivotMatrixUpdated=!1,s.billboardMode=this.billboardMode,s.infiniteDistance=this.infiniteDistance,s.parent=this._parentNode,this._currentRenderId=i,this._childUpdateId+=1,this._isDirty=!1,this._position._isDirty=!1,this._rotation._isDirty=!1,this._scaling._isDirty=!1;const r=this._getEffectiveParent(),a=Re._TmpScaling;let o=this._position;if(this._infiniteDistance&&!this.parent&&t){const h=t.getWorldMatrix(),u=new y(h.m[12],h.m[13],h.m[14]);o=Re._TmpTranslation,o.copyFromFloats(this._position.x+u.x,this._position.y+u.y,this._position.z+u.z)}a.copyFromFloats(this._scaling.x*this.scalingDeterminant,this._scaling.y*this.scalingDeterminant,this._scaling.z*this.scalingDeterminant);let l;if(this._rotationQuaternion?(this._rotationQuaternion._isDirty=!1,l=this._rotationQuaternion,this.reIntegrateRotationIntoRotationQuaternion&&this.rotation.lengthSquared()&&(this._rotationQuaternion.multiplyInPlace(se.RotationYawPitchRoll(this._rotation.y,this._rotation.x,this._rotation.z)),this._rotation.copyFromFloats(0,0,0))):(l=Re._TmpRotation,se.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,l)),this._usePivotMatrix){const h=N.Matrix[1];L.ScalingToRef(a.x,a.y,a.z,h);const u=N.Matrix[0];l.toRotationMatrix(u),this._pivotMatrix.multiplyToRef(h,N.Matrix[4]),N.Matrix[4].multiplyToRef(u,this._localMatrix),this._postMultiplyPivotMatrix&&this._localMatrix.multiplyToRef(this._pivotMatrixInverse,this._localMatrix),this._localMatrix.addTranslationFromFloats(o.x,o.y,o.z)}else L.ComposeToRef(a,l,o,this._localMatrix);if(r&&r.getWorldMatrix){if(e&&r.computeWorldMatrix(e),s.useBillboardPath){if(this._transformToBoneReferal){const f=this.parent;f.getSkeleton().prepare(),f.getFinalMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),N.Matrix[7])}else N.Matrix[7].copyFrom(r.getWorldMatrix());const h=N.Vector3[5],u=N.Vector3[6],c=N.Quaternion[0];N.Matrix[7].decompose(u,c,h),L.ScalingToRef(u.x,u.y,u.z,N.Matrix[7]),N.Matrix[7].setTranslation(h),Re.BillboardUseParentOrientation&&(this._position.applyRotationQuaternionToRef(c,h),this._localMatrix.setTranslation(h)),this._localMatrix.multiplyToRef(N.Matrix[7],this._worldMatrix)}else if(this._transformToBoneReferal){const h=this.parent;h.getSkeleton().prepare(),this._localMatrix.multiplyToRef(h.getFinalMatrix(),N.Matrix[6]),N.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)}else this._localMatrix.multiplyToRef(r.getWorldMatrix(),this._worldMatrix);this._markSyncedWithParent()}else this._worldMatrix.copyFrom(this._localMatrix);if(s.useBillboardPath&&t&&this.billboardMode&&!s.useBillboardPosition){const h=N.Vector3[0];if(this._worldMatrix.getTranslationToRef(h),N.Matrix[1].copyFrom(t.getViewMatrix()),this._scene.useRightHandedSystem&&N.Matrix[1].multiplyToRef(HA,N.Matrix[1]),N.Matrix[1].setTranslationFromFloats(0,0,0),N.Matrix[1].invertToRef(N.Matrix[0]),(this.billboardMode&Re.BILLBOARDMODE_ALL)!==Re.BILLBOARDMODE_ALL){N.Matrix[0].decompose(void 0,N.Quaternion[0],void 0);const u=N.Vector3[1];N.Quaternion[0].toEulerAnglesToRef(u),(this.billboardMode&Re.BILLBOARDMODE_X)!==Re.BILLBOARDMODE_X&&(u.x=0),(this.billboardMode&Re.BILLBOARDMODE_Y)!==Re.BILLBOARDMODE_Y&&(u.y=0),(this.billboardMode&Re.BILLBOARDMODE_Z)!==Re.BILLBOARDMODE_Z&&(u.z=0),L.RotationYawPitchRollToRef(u.y,u.x,u.z,N.Matrix[0])}this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(N.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(N.Vector3[0])}else if(s.useBillboardPath&&t&&s.useBillboardPosition){const h=N.Vector3[0];this._worldMatrix.getTranslationToRef(h);const u=t.globalPosition;this._worldMatrix.invertToRef(N.Matrix[1]);const c=N.Vector3[1];y.TransformCoordinatesToRef(u,N.Matrix[1],c),c.normalize();const f=-Math.atan2(c.z,c.x)+Math.PI/2,d=Math.sqrt(c.x*c.x+c.z*c.z),_=-Math.atan2(c.y,d);if(se.RotationYawPitchRollToRef(f,_,0,N.Quaternion[0]),(this.billboardMode&Re.BILLBOARDMODE_ALL)!==Re.BILLBOARDMODE_ALL){const p=N.Vector3[1];N.Quaternion[0].toEulerAnglesToRef(p),(this.billboardMode&Re.BILLBOARDMODE_X)!==Re.BILLBOARDMODE_X&&(p.x=0),(this.billboardMode&Re.BILLBOARDMODE_Y)!==Re.BILLBOARDMODE_Y&&(p.y=0),(this.billboardMode&Re.BILLBOARDMODE_Z)!==Re.BILLBOARDMODE_Z&&(p.z=0),L.RotationYawPitchRollToRef(p.y,p.x,p.z,N.Matrix[0])}else L.FromQuaternionToRef(N.Quaternion[0],N.Matrix[0]);this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(N.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(N.Vector3[0])}return this.ignoreNonUniformScaling?this._updateNonUniformScalingState(!1):this._scaling.isNonUniformWithinEpsilon(1e-6)?this._updateNonUniformScalingState(!0):r&&r._nonUniformScaling?this._updateNonUniformScalingState(r._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._isAbsoluteSynced=!1,this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=L.Invert(this._worldMatrix)),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix}resetLocalMatrix(e=!0){if(this.computeWorldMatrix(),e){const t=this.getChildren();for(let i=0;i<t.length;++i){const s=t[i];if(s){s.computeWorldMatrix();const r=N.Matrix[0];s._localMatrix.multiplyToRef(this._localMatrix,r);const a=N.Quaternion[0];r.decompose(s.scaling,a,s.position),s.rotationQuaternion?s.rotationQuaternion.copyFrom(a):a.toEulerAnglesToRef(s.rotation)}}}this.scaling.copyFromFloats(1,1,1),this.position.copyFromFloats(0,0,0),this.rotation.copyFromFloats(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=se.Identity()),this._worldMatrix=L.Identity()}_afterComputeWorldMatrix(){}registerAfterWorldMatrixUpdate(e){return this.onAfterWorldMatrixUpdateObservable.add(e),this}unregisterAfterWorldMatrixUpdate(e){return this.onAfterWorldMatrixUpdateObservable.removeCallback(e),this}getPositionInCameraSpace(e=null){return e||(e=this.getScene().activeCamera),y.TransformCoordinates(this.getAbsolutePosition(),e.getViewMatrix())}getDistanceToCamera(e=null){return e||(e=this.getScene().activeCamera),this.getAbsolutePosition().subtract(e.globalPosition).length()}clone(e,t,i){const s=Ie.Clone(()=>new Re(e,this.getScene()),this);if(s.name=e,s.id=e,t&&(s.parent=t),!i){const r=this.getDescendants(!0);for(let a=0;a<r.length;a++){const o=r[a];o.clone&&o.clone(e+"."+o.name,s)}}return s}serialize(e){const t=Ie.Serialize(this,e);return t.type=this.getClassName(),t.uniqueId=this.uniqueId,this.parent&&this.parent._serializeAsParent(t),t.localMatrix=this.getPivotMatrix().asArray(),t.isEnabled=this.isEnabled(),Ie.AppendSerializedAnimations(this,t),t.ranges=this.serializeAnimationRanges(),t}static Parse(e,t,i){const s=Ie.Parse(()=>new Re(e.name,t),e,t,i);if(e.localMatrix?s.setPreTransformMatrix(L.FromArray(e.localMatrix)):e.pivotMatrix&&s.setPivotMatrix(L.FromArray(e.pivotMatrix)),s.setEnabled(e.isEnabled),s._waitingParsedUniqueId=e.uniqueId,e.parentId!==void 0&&(s._waitingParentId=e.parentId),e.parentInstanceIndex!==void 0&&(s._waitingParentInstanceIndex=e.parentInstanceIndex),e.animations){for(let r=0;r<e.animations.length;r++){const a=e.animations[r],o=Zn("BABYLON.Animation");o&&s.animations.push(o.Parse(a))}Rt.ParseAnimationRanges(s,e,t)}return e.autoAnimate&&t.beginAnimation(s,e.autoAnimateFrom,e.autoAnimateTo,e.autoAnimateLoop,e.autoAnimateSpeed||1),s}getChildTransformNodes(e,t){const i=[];return this._getDescendants(i,e,s=>(!t||t(s))&&s instanceof Re),i}dispose(e,t=!1){if(this.getScene().stopAnimation(this),this.getScene().removeTransformNode(this),this._parentContainer){const i=this._parentContainer.transformNodes.indexOf(this);i>-1&&this._parentContainer.transformNodes.splice(i,1),this._parentContainer=null}if(this.onAfterWorldMatrixUpdateObservable.clear(),e){const i=this.getChildTransformNodes(!0);for(const s of i)s.parent=null,s.computeWorldMatrix(!0)}super.dispose(e,t)}normalizeToUnitCube(e=!0,t=!1,i){let s=null,r=null;t&&(this.rotationQuaternion?(r=this.rotationQuaternion.clone(),this.rotationQuaternion.copyFromFloats(0,0,0,1)):this.rotation&&(s=this.rotation.clone(),this.rotation.copyFromFloats(0,0,0)));const a=this.getHierarchyBoundingVectors(e,i),o=a.max.subtract(a.min),l=Math.max(o.x,o.y,o.z);if(l===0)return this;const h=1/l;return this.scaling.scaleInPlace(h),t&&(this.rotationQuaternion&&r?this.rotationQuaternion.copyFrom(r):this.rotation&&s&&this.rotation.copyFrom(s)),this}_syncAbsoluteScalingAndRotation(){this._isAbsoluteSynced||(this._worldMatrix.decompose(this._absoluteScaling,this._absoluteRotationQuaternion),this._isAbsoluteSynced=!0)}}Re.BILLBOARDMODE_NONE=0;Re.BILLBOARDMODE_X=1;Re.BILLBOARDMODE_Y=2;Re.BILLBOARDMODE_Z=4;Re.BILLBOARDMODE_ALL=7;Re.BILLBOARDMODE_USE_POSITION=128;Re.BillboardUseParentOrientation=!1;Re._TmpRotation=se.Zero();Re._TmpScaling=y.Zero();Re._TmpTranslation=y.Zero();Re._LookAtVectorCache=new y(0,0,0);Re._RotationAxisCache=new se;P([cs("position")],Re.prototype,"_position",void 0);P([cs("rotation")],Re.prototype,"_rotation",void 0);P([b4("rotationQuaternion")],Re.prototype,"_rotationQuaternion",void 0);P([cs("scaling")],Re.prototype,"_scaling",void 0);P([B("billboardMode")],Re.prototype,"_billboardMode",void 0);P([B()],Re.prototype,"scalingDeterminant",void 0);P([B("infiniteDistance")],Re.prototype,"_infiniteDistance",void 0);P([B()],Re.prototype,"ignoreNonUniformScaling",void 0);P([B()],Re.prototype,"reIntegrateRotationIntoRotationQuaternion",void 0);class xn{constructor(){this.hit=!1,this.distance=0,this.pickedPoint=null,this.pickedMesh=null,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshFaceId=-1,this.subMeshId=0,this.pickedSprite=null,this.thinInstanceIndex=-1,this.ray=null,this.originMesh=null,this.aimTransform=null,this.gripTransform=null}getNormal(e=!1,t=!0){if(!this.pickedMesh||t&&!this.pickedMesh.isVerticesDataPresent(S.NormalKind))return null;let i=this.pickedMesh.getIndices();(i==null?void 0:i.length)===0&&(i=null);let s;const r=N.Vector3[0],a=N.Vector3[1],o=N.Vector3[2];if(t){const h=this.pickedMesh.getVerticesData(S.NormalKind);let u=i?y.FromArrayToRef(h,i[this.faceId*3]*3,r):r.copyFromFloats(h[this.faceId*3*3],h[this.faceId*3*3+1],h[this.faceId*3*3+2]),c=i?y.FromArrayToRef(h,i[this.faceId*3+1]*3,a):a.copyFromFloats(h[(this.faceId*3+1)*3],h[(this.faceId*3+1)*3+1],h[(this.faceId*3+1)*3+2]),f=i?y.FromArrayToRef(h,i[this.faceId*3+2]*3,o):o.copyFromFloats(h[(this.faceId*3+2)*3],h[(this.faceId*3+2)*3+1],h[(this.faceId*3+2)*3+2]);u=u.scale(this.bu),c=c.scale(this.bv),f=f.scale(1-this.bu-this.bv),s=new y(u.x+c.x+f.x,u.y+c.y+f.y,u.z+c.z+f.z)}else{const h=this.pickedMesh.getVerticesData(S.PositionKind),u=i?y.FromArrayToRef(h,i[this.faceId*3]*3,r):r.copyFromFloats(h[this.faceId*3*3],h[this.faceId*3*3+1],h[this.faceId*3*3+2]),c=i?y.FromArrayToRef(h,i[this.faceId*3+1]*3,a):a.copyFromFloats(h[(this.faceId*3+1)*3],h[(this.faceId*3+1)*3+1],h[(this.faceId*3+1)*3+2]),f=i?y.FromArrayToRef(h,i[this.faceId*3+2]*3,o):o.copyFromFloats(h[(this.faceId*3+2)*3],h[(this.faceId*3+2)*3+1],h[(this.faceId*3+2)*3+2]),d=u.subtract(c),_=f.subtract(c);s=y.Cross(d,_)}const l=(h,u)=>{let c=h.getWorldMatrix();h.nonUniformScaling&&(N.Matrix[0].copyFrom(c),c=N.Matrix[0],c.setTranslationFromFloats(0,0,0),c.invert(),c.transposeToRef(N.Matrix[1]),c=N.Matrix[1]),y.TransformNormalToRef(u,c,u)};if(e&&l(this.pickedMesh,s),this.ray){const h=N.Vector3[0].copyFrom(s);e||l(this.pickedMesh,h),y.Dot(h,this.ray.direction)>0&&s.negateInPlace()}return s.normalize(),s}getTextureCoordinates(e=S.UVKind){if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(e))return null;const t=this.pickedMesh.getIndices();if(!t)return null;const i=this.pickedMesh.getVerticesData(e);if(!i)return null;let s=ne.FromArray(i,t[this.faceId*3]*2),r=ne.FromArray(i,t[this.faceId*3+1]*2),a=ne.FromArray(i,t[this.faceId*3+2]*2);return s=s.scale(this.bu),r=r.scale(this.bv),a=a.scale(1-this.bu-this.bv),new ne(s.x+r.x+a.x,s.y+r.y+a.y)}}class KA{constructor(){this._checkCollisions=!1,this._collisionMask=-1,this._collisionGroup=-1,this._surroundingMeshes=null,this._collider=null,this._oldPositionForCollisions=new y(0,0,0),this._diffPositionForCollisions=new y(0,0,0),this._collisionResponse=!0}}function XA(n,e,t){let i=null;switch(e){case S.PositionKind:i=s=>s.getPositions();break;case S.NormalKind:i=s=>s.getNormals();break;case S.TangentKind:i=s=>s.getTangents();break;case S.UVKind:i=s=>s.getUVs();break;case S.UV2Kind:i=s=>s.getUV2s();break;case S.ColorKind:i=s=>s.getColors();break;default:return}for(let s=0;s<n.length;s++){let r=n[s];for(let a=0;a<t.numTargets;a++){const o=t.getTarget(a),l=o.influence;if(l!==0){const h=i(o);h&&(r+=(h[s]-n[s])*l)}}n[s]=r}}function YA(n,e,t,i,s,r,a){const o=N.Vector3[0],l=N.Matrix[0],h=N.Matrix[1],u=e===S.NormalKind?y.TransformNormalFromFloatsToRef:y.TransformCoordinatesFromFloatsToRef;for(let c=0,f=0;c<n.length;c+=3,f+=4){l.reset();let d,_;for(d=0;d<4;d++)_=s[f+d],_>0&&(L.FromFloat32ArrayToRefScaled(t,Math.floor(i[f+d]*16),_,h),l.addToSelf(h));if(r&&a)for(d=0;d<4;d++)_=a[f+d],_>0&&(L.FromFloat32ArrayToRefScaled(t,Math.floor(r[f+d]*16),_,h),l.addToSelf(h));u(n[c],n[c+1],n[c+2],l,o),o.toArray(n,c)}}class jA{constructor(){this.facetNb=0,this.partitioningSubdivisions=10,this.partitioningBBoxRatio=1.01,this.facetDataEnabled=!1,this.facetParameters={},this.bbSize=y.Zero(),this.subDiv={max:1,X:1,Y:1,Z:1},this.facetDepthSort=!1,this.facetDepthSortEnabled=!1}}class qA{constructor(){this._hasVertexAlpha=!1,this._useVertexColors=!0,this._numBoneInfluencers=4,this._applyFog=!0,this._receiveShadows=!1,this._facetData=new jA,this._visibility=1,this._skeleton=null,this._layerMask=268435455,this._computeBonesUsingShaders=!0,this._isActive=!1,this._onlyForInstances=!1,this._isActiveIntermediate=!1,this._onlyForInstancesIntermediate=!1,this._actAsRegularMesh=!1,this._currentLOD=new Map,this._collisionRetryCount=3,this._morphTargetManager=null,this._renderingGroupId=0,this._bakedVertexAnimationManager=null,this._material=null,this._positions=null,this._pointerOverDisableMeshTesting=!1,this._meshCollisionData=new KA,this._enableDistantPicking=!1,this._rawBoundingInfo=null,this._sideOrientationHint=!1,this._inheritVisibility=!1}}class it extends Re{static get BILLBOARDMODE_NONE(){return Re.BILLBOARDMODE_NONE}static get BILLBOARDMODE_X(){return Re.BILLBOARDMODE_X}static get BILLBOARDMODE_Y(){return Re.BILLBOARDMODE_Y}static get BILLBOARDMODE_Z(){return Re.BILLBOARDMODE_Z}static get BILLBOARDMODE_ALL(){return Re.BILLBOARDMODE_ALL}static get BILLBOARDMODE_USE_POSITION(){return Re.BILLBOARDMODE_USE_POSITION}get facetNb(){return this._internalAbstractMeshDataInfo._facetData.facetNb}get partitioningSubdivisions(){return this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions}set partitioningSubdivisions(e){this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions=e}get partitioningBBoxRatio(){return this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio}set partitioningBBoxRatio(e){this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio=e}get mustDepthSortFacets(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSort}set mustDepthSortFacets(e){this._internalAbstractMeshDataInfo._facetData.facetDepthSort=e}get facetDepthSortFrom(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom}set facetDepthSortFrom(e){this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom=e}get collisionRetryCount(){return this._internalAbstractMeshDataInfo._collisionRetryCount}set collisionRetryCount(e){this._internalAbstractMeshDataInfo._collisionRetryCount=e}get isFacetDataEnabled(){return this._internalAbstractMeshDataInfo._facetData.facetDataEnabled}get morphTargetManager(){return this._internalAbstractMeshDataInfo._morphTargetManager}set morphTargetManager(e){this._internalAbstractMeshDataInfo._morphTargetManager!==e&&(this._internalAbstractMeshDataInfo._morphTargetManager=e,this._syncGeometryWithMorphTargetManager())}get bakedVertexAnimationManager(){return this._internalAbstractMeshDataInfo._bakedVertexAnimationManager}set bakedVertexAnimationManager(e){this._internalAbstractMeshDataInfo._bakedVertexAnimationManager!==e&&(this._internalAbstractMeshDataInfo._bakedVertexAnimationManager=e,this._markSubMeshesAsAttributesDirty())}_syncGeometryWithMorphTargetManager(){}_updateNonUniformScalingState(e){return super._updateNonUniformScalingState(e)?(this._markSubMeshesAsMiscDirty(),!0):!1}get rawBoundingInfo(){return this._internalAbstractMeshDataInfo._rawBoundingInfo}set rawBoundingInfo(e){this._internalAbstractMeshDataInfo._rawBoundingInfo=e}set onCollide(e){this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver&&this.onCollideObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver=this.onCollideObservable.add(e)}set onCollisionPositionChange(e){this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(e)}get visibility(){return this._internalAbstractMeshDataInfo._visibility}set visibility(e){if(this._internalAbstractMeshDataInfo._visibility===e)return;const t=this._internalAbstractMeshDataInfo._visibility;this._internalAbstractMeshDataInfo._visibility=e,(t===1&&e!==1||t!==1&&e===1)&&this._markSubMeshesAsDirty(i=>{i.markAsMiscDirty(),i.markAsPrePassDirty()})}get inheritVisibility(){return this._internalAbstractMeshDataInfo._inheritVisibility}set inheritVisibility(e){this._internalAbstractMeshDataInfo._inheritVisibility=e}get isVisible(){if(!this._isVisible||!this.inheritVisibility||!this._parentNode)return this._isVisible;if(this._isVisible){let e=this._parentNode;for(;e;){const t=e.isVisible;if(typeof t<"u")return t;e=e.parent}}return this._isVisible}set isVisible(e){this._isVisible=e}get pointerOverDisableMeshTesting(){return this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting}set pointerOverDisableMeshTesting(e){this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting=e}get renderingGroupId(){return this._internalAbstractMeshDataInfo._renderingGroupId}set renderingGroupId(e){this._internalAbstractMeshDataInfo._renderingGroupId=e}get material(){return this._internalAbstractMeshDataInfo._material}set material(e){this._setMaterial(e)}_setMaterial(e){this._internalAbstractMeshDataInfo._material!==e&&(this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),this._internalAbstractMeshDataInfo._material=e,e&&e.meshMap&&(e.meshMap[this.uniqueId]=this),this.onMaterialChangedObservable.hasObservers()&&this.onMaterialChangedObservable.notifyObservers(this),this.subMeshes&&(this.resetDrawCache(void 0,e==null),this._unBindEffect()))}getMaterialForRenderPass(e){var t;return(t=this._internalAbstractMeshDataInfo._materialForRenderPass)==null?void 0:t[e]}setMaterialForRenderPass(e,t){var s;this.resetDrawCache(e),this._internalAbstractMeshDataInfo._materialForRenderPass||(this._internalAbstractMeshDataInfo._materialForRenderPass=[]);const i=this._internalAbstractMeshDataInfo._materialForRenderPass[e];(s=i==null?void 0:i.meshMap)!=null&&s[this.uniqueId]&&(i.meshMap[this.uniqueId]=void 0),this._internalAbstractMeshDataInfo._materialForRenderPass[e]=t,t&&t.meshMap&&(t.meshMap[this.uniqueId]=this)}get receiveShadows(){return this._internalAbstractMeshDataInfo._receiveShadows}set receiveShadows(e){this._internalAbstractMeshDataInfo._receiveShadows!==e&&(this._internalAbstractMeshDataInfo._receiveShadows=e,this._markSubMeshesAsLightDirty())}get hasVertexAlpha(){return this._internalAbstractMeshDataInfo._hasVertexAlpha}set hasVertexAlpha(e){this._internalAbstractMeshDataInfo._hasVertexAlpha!==e&&(this._internalAbstractMeshDataInfo._hasVertexAlpha=e,this._markSubMeshesAsAttributesDirty(),this._markSubMeshesAsMiscDirty())}get useVertexColors(){return this._internalAbstractMeshDataInfo._useVertexColors}set useVertexColors(e){this._internalAbstractMeshDataInfo._useVertexColors!==e&&(this._internalAbstractMeshDataInfo._useVertexColors=e,this._markSubMeshesAsAttributesDirty())}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(e){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==e&&(this._internalAbstractMeshDataInfo._computeBonesUsingShaders=e,this._markSubMeshesAsAttributesDirty())}get numBoneInfluencers(){return this._internalAbstractMeshDataInfo._numBoneInfluencers}set numBoneInfluencers(e){this._internalAbstractMeshDataInfo._numBoneInfluencers!==e&&(this._internalAbstractMeshDataInfo._numBoneInfluencers=e,this._markSubMeshesAsAttributesDirty())}get applyFog(){return this._internalAbstractMeshDataInfo._applyFog}set applyFog(e){this._internalAbstractMeshDataInfo._applyFog!==e&&(this._internalAbstractMeshDataInfo._applyFog=e,this._markSubMeshesAsMiscDirty())}get enableDistantPicking(){return this._internalAbstractMeshDataInfo._enableDistantPicking}set enableDistantPicking(e){this._internalAbstractMeshDataInfo._enableDistantPicking=e}get layerMask(){return this._internalAbstractMeshDataInfo._layerMask}set layerMask(e){e!==this._internalAbstractMeshDataInfo._layerMask&&(this._internalAbstractMeshDataInfo._layerMask=e,this._resyncLightSources())}get collisionMask(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask}set collisionMask(e){this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask=isNaN(e)?-1:e}get collisionResponse(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse}set collisionResponse(e){this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse=e}get collisionGroup(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup}set collisionGroup(e){this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup=isNaN(e)?-1:e}get surroundingMeshes(){return this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes}set surroundingMeshes(e){this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes=e}get lightSources(){return this._lightSources}set skeleton(e){const t=this._internalAbstractMeshDataInfo._skeleton;t&&t.needInitialSkinMatrix&&t._unregisterMeshWithPoseMatrix(this),e&&e.needInitialSkinMatrix&&e._registerMeshWithPoseMatrix(this),this._internalAbstractMeshDataInfo._skeleton=e,this._internalAbstractMeshDataInfo._skeleton||(this._bonesTransformMatrices=null),this._markSubMeshesAsAttributesDirty()}get skeleton(){return this._internalAbstractMeshDataInfo._skeleton}constructor(e,t=null){switch(super(e,t,!1),this._internalAbstractMeshDataInfo=new qA,this._waitingMaterialId=null,this._waitingMorphTargetManagerId=null,this.cullingStrategy=it.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY,this.onCollideObservable=new q,this.onCollisionPositionChangeObservable=new q,this.onMaterialChangedObservable=new q,this.definedFacingForward=!0,this._occlusionQuery=null,this._renderingGroup=null,this.alphaIndex=Number.MAX_VALUE,this._isVisible=!0,this.isPickable=!0,this.isNearPickable=!1,this.isNearGrabbable=!1,this.showSubMeshesBoundingBox=!1,this.isBlocker=!1,this.enablePointerMoveEvents=!1,this.outlineColor=fe.Red(),this.outlineWidth=.02,this.overlayColor=fe.Red(),this.overlayAlpha=.5,this.useOctreeForRenderingSelection=!0,this.useOctreeForPicking=!0,this.useOctreeForCollisions=!0,this.alwaysSelectAsActiveMesh=!1,this.doNotSyncBoundingInfo=!1,this.actionManager=null,this.ellipsoid=new y(.5,1,.5),this.ellipsoidOffset=new y(0,0,0),this.edgesWidth=1,this.edgesColor=new K(1,0,0,1),this._edgesRenderer=null,this._masterMesh=null,this._boundingInfo=null,this._boundingInfoIsDirty=!0,this._renderId=0,this._intersectionsInProgress=new Array,this._unIndexed=!1,this._lightSources=new Array,this._waitingData={lods:null,actions:null,freezeWorldMatrix:null},this._bonesTransformMatrices=null,this._transformMatrixTexture=null,this.onRebuildObservable=new q,this._onCollisionPositionChange=(i,s,r=null)=>{s.subtractToRef(this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,this._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),this._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions.length()>re.CollisionsEpsilon&&this.position.addInPlace(this._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),r&&this.onCollideObservable.notifyObservers(r),this.onCollisionPositionChangeObservable.notifyObservers(this.position)},t=this.getScene(),t.addMesh(this),this._resyncLightSources(),this._uniformBuffer=new ce(this.getScene().getEngine(),void 0,void 0,e,!this.getScene().getEngine().isWebGPU),this._buildUniformLayout(),t.performancePriority){case 2:this.doNotSyncBoundingInfo=!0;case 1:this.alwaysSelectAsActiveMesh=!0,this.isPickable=!1;break}}_buildUniformLayout(){this._uniformBuffer.addUniform("world",16),this._uniformBuffer.addUniform("visibility",1),this._uniformBuffer.create()}transferToEffect(e){const t=this._uniformBuffer;t.updateMatrix("world",e),t.updateFloat("visibility",this._internalAbstractMeshDataInfo._visibility),t.update()}getMeshUniformBuffer(){return this._uniformBuffer}getClassName(){return"AbstractMesh"}toString(e){let t="Name: "+this.name+", isInstance: "+(this.getClassName()!=="InstancedMesh"?"YES":"NO");t+=", # of submeshes: "+(this.subMeshes?this.subMeshes.length:0);const i=this._internalAbstractMeshDataInfo._skeleton;return i&&(t+=", skeleton: "+i.name),e&&(t+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],t+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingData.freezeWorldMatrix?"YES":"NO")),t}_getEffectiveParent(){return this._masterMesh&&this.billboardMode!==Re.BILLBOARDMODE_NONE?this._masterMesh:super._getEffectiveParent()}_getActionManagerForTrigger(e,t=!0){if(this.actionManager&&(t||this.actionManager.isRecursive))if(e){if(this.actionManager.hasSpecificTrigger(e))return this.actionManager}else return this.actionManager;return this.parent?this.parent._getActionManagerForTrigger(e,!1):null}_rebuild(e=!1){if(this.onRebuildObservable.notifyObservers(this),this._occlusionQuery!==null&&(this._occlusionQuery=null),!!this.subMeshes){for(const t of this.subMeshes)t._rebuild();this.resetDrawCache()}}_resyncLightSources(){this._lightSources.length=0;for(const e of this.getScene().lights)e.isEnabled()&&e.canAffectMesh(this)&&this._lightSources.push(e);this._markSubMeshesAsLightDirty()}_resyncLightSource(e){const t=e.isEnabled()&&e.canAffectMesh(this),i=this._lightSources.indexOf(e);let s=!1;if(i===-1){if(!t)return;this._lightSources.push(e)}else{if(t)return;s=!0,this._lightSources.splice(i,1)}this._markSubMeshesAsLightDirty(s)}_unBindEffect(){for(const e of this.subMeshes)e.setEffect(null)}_removeLightSource(e,t){const i=this._lightSources.indexOf(e);i!==-1&&(this._lightSources.splice(i,1),this._markSubMeshesAsLightDirty(t))}_markSubMeshesAsDirty(e){if(this.subMeshes)for(const t of this.subMeshes)for(let i=0;i<t._drawWrappers.length;++i){const s=t._drawWrappers[i];!s||!s.defines||!s.defines.markAllAsDirty||e(s.defines)}}_markSubMeshesAsLightDirty(e=!1){this._markSubMeshesAsDirty(t=>t.markAsLightDirty(e))}_markSubMeshesAsAttributesDirty(){this._markSubMeshesAsDirty(e=>e.markAsAttributesDirty())}_markSubMeshesAsMiscDirty(){this._markSubMeshesAsDirty(e=>e.markAsMiscDirty())}markAsDirty(e){return this._currentRenderId=Number.MAX_VALUE,super.markAsDirty(e),this._isDirty=!0,this}resetDrawCache(e,t=!1){if(this.subMeshes)for(const i of this.subMeshes)i.resetDrawCache(e,t)}get isBlocked(){return!1}getLOD(e){return this}getTotalVertices(){return 0}getTotalIndices(){return 0}getIndices(){return null}getVerticesData(e){return null}setVerticesData(e,t,i,s){return this}updateVerticesData(e,t,i,s){return this}setIndices(e,t){return this}isVerticesDataPresent(e){return!1}getBoundingInfo(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfoIsDirty&&(this._boundingInfoIsDirty=!1,this._updateBoundingInfo()),this._boundingInfo)}getRawBoundingInfo(){return this.rawBoundingInfo??this.getBoundingInfo()}setBoundingInfo(e){return this._boundingInfo=e,this}get hasBoundingInfo(){return this._boundingInfo!==null}buildBoundingInfo(e,t,i){return this._boundingInfo=new Oi(e,t,i),this._boundingInfo}normalizeToUnitCube(e=!0,t=!1,i){return super.normalizeToUnitCube(e,t,i)}get useBones(){return this.skeleton&&this.getScene().skeletonsEnabled&&this.isVerticesDataPresent(S.MatricesIndicesKind)&&this.isVerticesDataPresent(S.MatricesWeightsKind)}_preActivate(){}_preActivateForIntermediateRendering(e){}_activate(e,t){return this._renderId=e,!0}_postActivate(){}_freeze(){}_unFreeze(){}getWorldMatrix(){return this._masterMesh&&this.billboardMode===Re.BILLBOARDMODE_NONE?this._masterMesh.getWorldMatrix():super.getWorldMatrix()}_getWorldMatrixDeterminant(){return this._masterMesh?this._masterMesh._getWorldMatrixDeterminant():super._getWorldMatrixDeterminant()}get isAnInstance(){return!1}get hasInstances(){return!1}get hasThinInstances(){return!1}movePOV(e,t,i){return this.position.addInPlace(this.calcMovePOV(e,t,i)),this}calcMovePOV(e,t,i){const s=new L;(this.rotationQuaternion?this.rotationQuaternion:se.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)).toRotationMatrix(s);const a=y.Zero(),o=this.definedFacingForward?-1:1;return y.TransformCoordinatesFromFloatsToRef(e*o,t,i*o,s,a),a}rotatePOV(e,t,i){return this.rotation.addInPlace(this.calcRotatePOV(e,t,i)),this}calcRotatePOV(e,t,i){const s=this.definedFacingForward?1:-1;return new y(e*s,t,i*s)}_refreshBoundingInfo(e,t){if(e){const i=Vv(e,0,this.getTotalVertices(),t);this._boundingInfo?this._boundingInfo.reConstruct(i.minimum,i.maximum):this._boundingInfo=new Oi(i.minimum,i.maximum)}if(this.subMeshes)for(let i=0;i<this.subMeshes.length;i++)this.subMeshes[i].refreshBoundingInfo(e);this._updateBoundingInfo()}_refreshBoundingInfoDirect(e){if(this._boundingInfo?this._boundingInfo.reConstruct(e.minimum,e.maximum):this._boundingInfo=new Oi(e.minimum,e.maximum),this.subMeshes)for(let t=0;t<this.subMeshes.length;t++)this.subMeshes[t].refreshBoundingInfo(null);this._updateBoundingInfo()}static _ApplySkeleton(e,t,i,s,r,a,o){YA(e,t,i,s,r,a,o)}_getData(e,t,i=S.PositionKind){const s=e.cache,r=a=>{if(s){const o=s._vertexData||(s._vertexData={});return o[a]||this.copyVerticesData(a,o),o[a]}return this.getVerticesData(a)};if(t||(t=r(i)),!t)return null;if(s?(s._outputData?s._outputData.set(t):s._outputData=new Float32Array(t),t=s._outputData):(e.applyMorph&&this.morphTargetManager||e.applySkeleton&&this.skeleton)&&(t=t.slice()),e.applyMorph&&this.morphTargetManager&&XA(t,i,this.morphTargetManager),e.applySkeleton&&this.skeleton){const a=r(S.MatricesIndicesKind),o=r(S.MatricesWeightsKind);if(o&&a){const l=this.numBoneInfluencers>4,h=l?r(S.MatricesIndicesExtraKind):null,u=l?r(S.MatricesWeightsExtraKind):null,c=this.skeleton.getTransformMatrices(this);it._ApplySkeleton(t,i,c,a,o,h,u)}}if(e.updatePositionsArray!==!1&&i===S.PositionKind){const a=this._internalAbstractMeshDataInfo._positions||[],o=a.length;if(a.length=t.length/3,o<a.length)for(let l=o;l<a.length;l++)a[l]=new y;for(let l=0,h=0;l<a.length;l++,h+=3)a[l].copyFromFloats(t[h],t[h+1],t[h+2]);this._internalAbstractMeshDataInfo._positions=a}return t}getNormalsData(e=!1,t=!1){return this._getData({applySkeleton:e,applyMorph:t,updatePositionsArray:!1},null,S.NormalKind)}getPositionData(e=!1,t=!1,i=null){return this._getData({applySkeleton:e,applyMorph:t,updatePositionsArray:!1},i,S.PositionKind)}_updateBoundingInfo(){return this._boundingInfo?this._boundingInfo.update(this.worldMatrixFromCache):this._boundingInfo=new Oi(y.Zero(),y.Zero(),this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}_updateSubMeshesBoundingInfo(e){if(!this.subMeshes)return this;const t=this.subMeshes.length;for(let i=0;i<t;i++){const s=this.subMeshes[i];(t>1||!s.IsGlobal)&&s.updateBoundingInfo(e)}return this}_afterComputeWorldMatrix(){this.doNotSyncBoundingInfo||(this._boundingInfoIsDirty=!0)}isInFrustum(e){return this.getBoundingInfo().isInFrustum(e,this.cullingStrategy)}isCompletelyInFrustum(e){return this.getBoundingInfo().isCompletelyInFrustum(e)}intersectsMesh(e,t=!1,i){const s=this.getBoundingInfo(),r=e.getBoundingInfo();if(s.intersects(r,t))return!0;if(i){for(const a of this.getChildMeshes())if(a.intersectsMesh(e,t,!0))return!0}return!1}intersectsPoint(e){return this.getBoundingInfo().intersectsPoint(e)}get checkCollisions(){return this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions}set checkCollisions(e){this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions=e}get collider(){return this._internalAbstractMeshDataInfo._meshCollisionData._collider}moveWithCollisions(e){this.getAbsolutePosition().addToRef(this.ellipsoidOffset,this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions);const i=this.getScene().collisionCoordinator;return this._internalAbstractMeshDataInfo._meshCollisionData._collider||(this._internalAbstractMeshDataInfo._meshCollisionData._collider=i.createCollider()),this._internalAbstractMeshDataInfo._meshCollisionData._collider._radius=this.ellipsoid,i.getNewPosition(this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,e,this._internalAbstractMeshDataInfo._meshCollisionData._collider,this.collisionRetryCount,this,this._onCollisionPositionChange,this.uniqueId),this}_collideForSubMesh(e,t,i){var s;if(this._generatePointsArray(),!this._positions)return this;if(!e._lastColliderWorldVertices||!e._lastColliderTransformMatrix.equals(t)){e._lastColliderTransformMatrix=t.clone(),e._lastColliderWorldVertices=[],e._trianglePlanes=[];const r=e.verticesStart,a=e.verticesStart+e.verticesCount;for(let o=r;o<a;o++)e._lastColliderWorldVertices.push(y.TransformCoordinates(this._positions[o],t))}return i._collide(e._trianglePlanes,e._lastColliderWorldVertices,this.getIndices(),e.indexStart,e.indexStart+e.indexCount,e.verticesStart,!!e.getMaterial(),this,this._shouldConvertRHS(),((s=e.getMaterial())==null?void 0:s.fillMode)===7),this}_processCollisionsForSubMeshes(e,t){const i=this._scene.getCollidingSubMeshCandidates(this,e),s=i.length;for(let r=0;r<s;r++){const a=i.data[r];s>1&&!a._checkCollision(e)||this._collideForSubMesh(a,t,e)}return this}_shouldConvertRHS(){return!1}_checkCollision(e){if(!this.getBoundingInfo()._checkCollision(e))return this;const t=N.Matrix[0],i=N.Matrix[1];return L.ScalingToRef(1/e._radius.x,1/e._radius.y,1/e._radius.z,t),this.worldMatrixFromCache.multiplyToRef(t,i),this._processCollisionsForSubMeshes(e,i),this}_generatePointsArray(){return!1}intersects(e,t,i,s=!1,r,a=!1){const o=new xn,l=this.getClassName(),h=l==="InstancedLinesMesh"||l==="LinesMesh"||l==="GreasedLineMesh"?this.intersectionThreshold:0,u=this.getBoundingInfo();if(!this.subMeshes||!a&&(!e.intersectsSphere(u.boundingSphere,h)||!e.intersectsBox(u.boundingBox,h)))return o;if(s)return o.hit=!a,o.pickedMesh=a?null:this,o.distance=a?0:y.Distance(e.origin,u.boundingSphere.center),o.subMeshId=0,o;if(!this._generatePointsArray())return o;let c=null;const f=this._scene.getIntersectingSubMeshCandidates(this,e),d=f.length;let _=!1;for(let p=0;p<d;p++){const m=f.data[p].getMaterial();if(m&&(m.fillMode==7||m.fillMode==0||m.fillMode==1||m.fillMode==2||m.fillMode==4)){_=!0;break}}if(!_)return o.hit=!0,o.pickedMesh=this,o.distance=y.Distance(e.origin,u.boundingSphere.center),o.subMeshId=-1,o;for(let p=0;p<d;p++){const g=f.data[p];if(d>1&&!a&&!g.canIntersects(e))continue;const m=g.intersects(e,this._positions,this.getIndices(),t,i);if(m&&(t||!c||m.distance<c.distance)&&(c=m,c.subMeshId=p,t))break}if(c){const p=r??this.getWorldMatrix(),g=N.Vector3[0],m=N.Vector3[1];y.TransformCoordinatesToRef(e.origin,p,g),e.direction.scaleToRef(c.distance,m);const T=y.TransformNormal(m,p).addInPlace(g);return o.hit=!0,o.distance=y.Distance(g,T),o.pickedPoint=T,o.pickedMesh=this,o.bu=c.bu||0,o.bv=c.bv||0,o.subMeshFaceId=c.faceId,o.faceId=c.faceId+f.data[c.subMeshId].indexStart/(this.getClassName().indexOf("LinesMesh")!==-1?2:3),o.subMeshId=c.subMeshId,o}return o}clone(e,t,i){return null}releaseSubMeshes(e=!1){if(this.subMeshes)for(;this.subMeshes.length;)this.subMeshes[0].dispose(e);else this.subMeshes=[];return this}dispose(e,t=!1){let i;const s=this.getScene();for(this._scene.useMaterialMeshMap&&this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),s.freeActiveMeshes(),s.freeRenderingGroups(),s.renderingManager.maintainStateBetweenFrames&&s.renderingManager.restoreDispachedFlags(),this.actionManager!==void 0&&this.actionManager!==null&&(this.actionManager.disposeWhenUnowned&&!this._scene.meshes.some(o=>o!==this&&o.actionManager===this.actionManager)&&this.actionManager.dispose(),this.actionManager=null),this._internalAbstractMeshDataInfo._skeleton=null,this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null),i=0;i<this._intersectionsInProgress.length;i++){const o=this._intersectionsInProgress[i],l=o._intersectionsInProgress.indexOf(this);o._intersectionsInProgress.splice(l,1)}this._intersectionsInProgress.length=0,s.lights.forEach(o=>{let l=o.includedOnlyMeshes.indexOf(this);l!==-1&&o.includedOnlyMeshes.splice(l,1),l=o.excludedMeshes.indexOf(this),l!==-1&&o.excludedMeshes.splice(l,1);const h=o.getShadowGenerators();if(h){const u=h.values();for(let c=u.next();c.done!==!0;c=u.next()){const d=c.value.getShadowMap();d&&d.renderList&&(l=d.renderList.indexOf(this),l!==-1&&d.renderList.splice(l,1))}}}),(this.getClassName()!=="InstancedMesh"||this.getClassName()!=="InstancedLinesMesh")&&this.releaseSubMeshes(!0);const a=s.getEngine();if(this._occlusionQuery!==null&&(this.isOcclusionQueryInProgress=!1,a.deleteQuery(this._occlusionQuery),this._occlusionQuery=null),a.wipeCaches(),s.removeMesh(this),this._parentContainer){const o=this._parentContainer.meshes.indexOf(this);o>-1&&this._parentContainer.meshes.splice(o,1),this._parentContainer=null}if(t&&this.material&&(this.material.getClassName()==="MultiMaterial"?this.material.dispose(!1,!0,!0):this.material.dispose(!1,!0)),!e)for(i=0;i<s.particleSystems.length;i++)s.particleSystems[i].emitter===this&&(s.particleSystems[i].dispose(),i--);this._internalAbstractMeshDataInfo._facetData.facetDataEnabled&&this.disableFacetData(),this._uniformBuffer.dispose(),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this.onRebuildObservable.clear(),super.dispose(e,t)}_initFacetData(){const e=this._internalAbstractMeshDataInfo._facetData;e.facetNormals||(e.facetNormals=[]),e.facetPositions||(e.facetPositions=[]),e.facetPartitioning||(e.facetPartitioning=new Array),e.facetNb=this.getIndices().length/3|0,e.partitioningSubdivisions=e.partitioningSubdivisions?e.partitioningSubdivisions:10,e.partitioningBBoxRatio=e.partitioningBBoxRatio?e.partitioningBBoxRatio:1.01;for(let t=0;t<e.facetNb;t++)e.facetNormals[t]=y.Zero(),e.facetPositions[t]=y.Zero();return e.facetDataEnabled=!0,this}updateFacetData(){const e=this._internalAbstractMeshDataInfo._facetData;e.facetDataEnabled||this._initFacetData();const t=this.getVerticesData(S.PositionKind),i=this.getIndices(),s=this.getVerticesData(S.NormalKind),r=this.getBoundingInfo();if(e.facetDepthSort&&!e.facetDepthSortEnabled){if(e.facetDepthSortEnabled=!0,i instanceof Uint16Array)e.depthSortedIndices=new Uint16Array(i);else if(i instanceof Uint32Array)e.depthSortedIndices=new Uint32Array(i);else{let o=!1;for(let l=0;l<i.length;l++)if(i[l]>65535){o=!0;break}o?e.depthSortedIndices=new Uint32Array(i):e.depthSortedIndices=new Uint16Array(i)}if(e.facetDepthSortFunction=function(o,l){return l.sqDistance-o.sqDistance},!e.facetDepthSortFrom){const o=this.getScene().activeCamera;e.facetDepthSortFrom=o?o.position:y.Zero()}e.depthSortedFacets=[];for(let o=0;o<e.facetNb;o++){const l={ind:o*3,sqDistance:0};e.depthSortedFacets.push(l)}e.invertedMatrix=L.Identity(),e.facetDepthSortOrigin=y.Zero()}e.bbSize.x=r.maximum.x-r.minimum.x>Ue?r.maximum.x-r.minimum.x:Ue,e.bbSize.y=r.maximum.y-r.minimum.y>Ue?r.maximum.y-r.minimum.y:Ue,e.bbSize.z=r.maximum.z-r.minimum.z>Ue?r.maximum.z-r.minimum.z:Ue;let a=e.bbSize.x>e.bbSize.y?e.bbSize.x:e.bbSize.y;if(a=a>e.bbSize.z?a:e.bbSize.z,e.subDiv.max=e.partitioningSubdivisions,e.subDiv.X=Math.floor(e.subDiv.max*e.bbSize.x/a),e.subDiv.Y=Math.floor(e.subDiv.max*e.bbSize.y/a),e.subDiv.Z=Math.floor(e.subDiv.max*e.bbSize.z/a),e.subDiv.X=e.subDiv.X<1?1:e.subDiv.X,e.subDiv.Y=e.subDiv.Y<1?1:e.subDiv.Y,e.subDiv.Z=e.subDiv.Z<1?1:e.subDiv.Z,e.facetParameters.facetNormals=this.getFacetLocalNormals(),e.facetParameters.facetPositions=this.getFacetLocalPositions(),e.facetParameters.facetPartitioning=this.getFacetLocalPartitioning(),e.facetParameters.bInfo=r,e.facetParameters.bbSize=e.bbSize,e.facetParameters.subDiv=e.subDiv,e.facetParameters.ratio=this.partitioningBBoxRatio,e.facetParameters.depthSort=e.facetDepthSort,e.facetDepthSort&&e.facetDepthSortEnabled&&(this.computeWorldMatrix(!0),this._worldMatrix.invertToRef(e.invertedMatrix),y.TransformCoordinatesToRef(e.facetDepthSortFrom,e.invertedMatrix,e.facetDepthSortOrigin),e.facetParameters.distanceTo=e.facetDepthSortOrigin),e.facetParameters.depthSortedFacets=e.depthSortedFacets,s&&Q.ComputeNormals(t,i,s,e.facetParameters),e.facetDepthSort&&e.facetDepthSortEnabled){e.depthSortedFacets.sort(e.facetDepthSortFunction);const o=e.depthSortedIndices.length/3|0;for(let l=0;l<o;l++){const h=e.depthSortedFacets[l].ind;e.depthSortedIndices[l*3]=i[h],e.depthSortedIndices[l*3+1]=i[h+1],e.depthSortedIndices[l*3+2]=i[h+2]}this.updateIndices(e.depthSortedIndices,void 0,!0)}return this}getFacetLocalNormals(){const e=this._internalAbstractMeshDataInfo._facetData;return e.facetNormals||this.updateFacetData(),e.facetNormals}getFacetLocalPositions(){const e=this._internalAbstractMeshDataInfo._facetData;return e.facetPositions||this.updateFacetData(),e.facetPositions}getFacetLocalPartitioning(){const e=this._internalAbstractMeshDataInfo._facetData;return e.facetPartitioning||this.updateFacetData(),e.facetPartitioning}getFacetPosition(e){const t=y.Zero();return this.getFacetPositionToRef(e,t),t}getFacetPositionToRef(e,t){const i=this.getFacetLocalPositions()[e],s=this.getWorldMatrix();return y.TransformCoordinatesToRef(i,s,t),this}getFacetNormal(e){const t=y.Zero();return this.getFacetNormalToRef(e,t),t}getFacetNormalToRef(e,t){const i=this.getFacetLocalNormals()[e];return y.TransformNormalToRef(i,this.getWorldMatrix(),t),this}getFacetsAtLocalCoordinates(e,t,i){const s=this.getBoundingInfo(),r=this._internalAbstractMeshDataInfo._facetData,a=Math.floor((e-s.minimum.x*r.partitioningBBoxRatio)*r.subDiv.X*r.partitioningBBoxRatio/r.bbSize.x),o=Math.floor((t-s.minimum.y*r.partitioningBBoxRatio)*r.subDiv.Y*r.partitioningBBoxRatio/r.bbSize.y),l=Math.floor((i-s.minimum.z*r.partitioningBBoxRatio)*r.subDiv.Z*r.partitioningBBoxRatio/r.bbSize.z);return a<0||a>r.subDiv.max||o<0||o>r.subDiv.max||l<0||l>r.subDiv.max?null:r.facetPartitioning[a+r.subDiv.max*o+r.subDiv.max*r.subDiv.max*l]}getClosestFacetAtCoordinates(e,t,i,s,r=!1,a=!0){const o=this.getWorldMatrix(),l=N.Matrix[5];o.invertToRef(l);const h=N.Vector3[8];y.TransformCoordinatesFromFloatsToRef(e,t,i,l,h);const u=this.getClosestFacetAtLocalCoordinates(h.x,h.y,h.z,s,r,a);return s&&y.TransformCoordinatesFromFloatsToRef(s.x,s.y,s.z,o,s),u}getClosestFacetAtLocalCoordinates(e,t,i,s,r=!1,a=!0){let o=null,l=0,h=0,u=0,c=0,f=0,d=0,_=0,p=0;const g=this.getFacetLocalPositions(),m=this.getFacetLocalNormals(),v=this.getFacetsAtLocalCoordinates(e,t,i);if(!v)return null;let T=Number.MAX_VALUE,A=T,b,x,E;for(let R=0;R<v.length;R++)b=v[R],x=m[b],E=g[b],c=(e-E.x)*x.x+(t-E.y)*x.y+(i-E.z)*x.z,(!r||r&&a&&c>=0||r&&!a&&c<=0)&&(c=x.x*E.x+x.y*E.y+x.z*E.z,f=-(x.x*e+x.y*t+x.z*i-c)/(x.x*x.x+x.y*x.y+x.z*x.z),d=e+x.x*f,_=t+x.y*f,p=i+x.z*f,l=d-e,h=_-t,u=p-i,A=l*l+h*h+u*u,A<T&&(T=A,o=b,s&&(s.x=d,s.y=_,s.z=p)));return o}getFacetDataParameters(){return this._internalAbstractMeshDataInfo._facetData.facetParameters}disableFacetData(){const e=this._internalAbstractMeshDataInfo._facetData;return e.facetDataEnabled&&(e.facetDataEnabled=!1,e.facetPositions=[],e.facetNormals=[],e.facetPartitioning=new Array,e.facetParameters={},e.depthSortedIndices=new Uint32Array(0)),this}updateIndices(e,t,i=!1){return this}createNormals(e){const t=this.getVerticesData(S.PositionKind),i=this.getIndices();let s;return this.isVerticesDataPresent(S.NormalKind)?s=this.getVerticesData(S.NormalKind):s=[],Q.ComputeNormals(t,i,s,{useRightHandedSystem:this.getScene().useRightHandedSystem}),this.setVerticesData(S.NormalKind,s,e),this}async optimizeIndicesAsync(){const e=this.getIndices();if(!e)return this;const{OptimizeIndices:t}=await De(async()=>{const{OptimizeIndices:i}=await import("./mesh.vertexData.functions-BYooUupK.js");return{OptimizeIndices:i}},[]);return t(e),this.setIndices(e,this.getTotalVertices()),this}alignWithNormal(e,t){t||(t=ni.Y);const i=N.Vector3[0],s=N.Vector3[1];return y.CrossToRef(t,e,s),y.CrossToRef(e,s,i),this.rotationQuaternion?se.RotationQuaternionFromAxisToRef(i,e,s,this.rotationQuaternion):y.RotationFromAxisToRef(i,e,s,this.rotation),this}_checkOcclusionQuery(){return!1}disableEdgesRendering(){throw Ee("EdgesRenderer")}enableEdgesRendering(e,t,i){throw Ee("EdgesRenderer")}getConnectedParticleSystems(){return this._scene.particleSystems.filter(e=>e.emitter===this)}}it.OCCLUSION_TYPE_NONE=0;it.OCCLUSION_TYPE_OPTIMISTIC=1;it.OCCLUSION_TYPE_STRICT=2;it.OCCLUSION_ALGORITHM_TYPE_ACCURATE=0;it.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE=1;it.CULLINGSTRATEGY_STANDARD=0;it.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1;it.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2;it.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3;P([yn.filter((...[n,e,t,i,s])=>!Array.isArray(n)&&!Array.isArray(e)&&!Array.isArray(t)&&!Array.isArray(i)&&!Array.isArray(s))],it,"_ApplySkeleton",null);Tt("BABYLON.AbstractMesh",it);class $A{constructor(){this.occlusionInternalRetryCounter=0,this.isOcclusionQueryInProgress=!1,this.isOccluded=!1,this.occlusionRetryCount=-1,this.occlusionType=it.OCCLUSION_TYPE_NONE,this.occlusionQueryAlgorithmType=it.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE,this.forceRenderingWhenOccluded=!1}}re.prototype.createQuery=function(){return null};re.prototype.deleteQuery=function(n){return this};re.prototype.isQueryResultAvailable=function(n){return!1};re.prototype.getQueryResult=function(n){return 0};re.prototype.beginOcclusionQuery=function(n,e){return!1};re.prototype.endOcclusionQuery=function(n){return this};Object.defineProperty(it.prototype,"isOcclusionQueryInProgress",{get:function(){return this._occlusionDataStorage.isOcclusionQueryInProgress},set:function(n){this._occlusionDataStorage.isOcclusionQueryInProgress=n},enumerable:!1,configurable:!0});Object.defineProperty(it.prototype,"_occlusionDataStorage",{get:function(){return this.__occlusionDataStorage||(this.__occlusionDataStorage=new $A),this.__occlusionDataStorage},enumerable:!1,configurable:!0});Object.defineProperty(it.prototype,"isOccluded",{get:function(){return this._occlusionDataStorage.isOccluded},set:function(n){this._occlusionDataStorage.isOccluded=n},enumerable:!0,configurable:!0});Object.defineProperty(it.prototype,"occlusionQueryAlgorithmType",{get:function(){return this._occlusionDataStorage.occlusionQueryAlgorithmType},set:function(n){this._occlusionDataStorage.occlusionQueryAlgorithmType=n},enumerable:!0,configurable:!0});Object.defineProperty(it.prototype,"occlusionType",{get:function(){return this._occlusionDataStorage.occlusionType},set:function(n){this._occlusionDataStorage.occlusionType=n},enumerable:!0,configurable:!0});Object.defineProperty(it.prototype,"occlusionRetryCount",{get:function(){return this._occlusionDataStorage.occlusionRetryCount},set:function(n){this._occlusionDataStorage.occlusionRetryCount=n},enumerable:!0,configurable:!0});Object.defineProperty(it.prototype,"forceRenderingWhenOccluded",{get:function(){return this._occlusionDataStorage.forceRenderingWhenOccluded},set:function(n){this._occlusionDataStorage.forceRenderingWhenOccluded=n},enumerable:!0,configurable:!0});it.prototype._checkOcclusionQuery=function(){const n=this._occlusionDataStorage;if(n.occlusionType===it.OCCLUSION_TYPE_NONE)return n.isOccluded=!1,!1;const e=this.getEngine();if(!e.getCaps().supportOcclusionQuery||!e.isQueryResultAvailable)return n.isOccluded=!1,!1;if(this.isOcclusionQueryInProgress&&this._occlusionQuery!==null&&this._occlusionQuery!==void 0)if(e.isQueryResultAvailable(this._occlusionQuery)){const s=e.getQueryResult(this._occlusionQuery);n.isOcclusionQueryInProgress=!1,n.occlusionInternalRetryCounter=0,n.isOccluded=!(s>0)}else if(n.occlusionInternalRetryCounter++,n.occlusionRetryCount!==-1&&n.occlusionInternalRetryCounter>n.occlusionRetryCount)n.isOcclusionQueryInProgress=!1,n.occlusionInternalRetryCounter=0,n.isOccluded=n.occlusionType===it.OCCLUSION_TYPE_OPTIMISTIC?!1:n.isOccluded;else return n.occlusionType===it.OCCLUSION_TYPE_OPTIMISTIC?!1:n.isOccluded;const t=this.getScene();if(t.getBoundingBoxRenderer){const i=t.getBoundingBoxRenderer();this._occlusionQuery===null&&(this._occlusionQuery=e.createQuery()),this._occlusionQuery&&e.beginOcclusionQuery(n.occlusionQueryAlgorithmType,this._occlusionQuery)&&(i.renderOcclusionBoundingBox(this),e.endOcclusionQuery(n.occlusionQueryAlgorithmType),this._occlusionDataStorage.isOcclusionQueryInProgress=!0)}return n.isOccluded};rt.prototype.getGPUFrameTimeCounter=function(){return this._timestampQuery.gpuFrameTimeCounter};rt.prototype.captureGPUFrameTime=function(n){this._timestampQuery.enable=n&&!!this._caps.timerQuery};rt.prototype.createQuery=function(){return this._occlusionQuery.createQuery()};rt.prototype.deleteQuery=function(n){return this._occlusionQuery.deleteQuery(n),this};rt.prototype.isQueryResultAvailable=function(n){return this._occlusionQuery.isQueryResultAvailable(n)};rt.prototype.getQueryResult=function(n){return this._occlusionQuery.getQueryResult(n)};rt.prototype.beginOcclusionQuery=function(n,e){var t;if(this.compatibilityMode){if(this._occlusionQuery.canBeginQuery(e))return(t=this._currentRenderPass)==null||t.beginOcclusionQuery(e),!0}else return this._bundleList.addItem(new vd(e)),!0;return!1};rt.prototype.endOcclusionQuery=function(){var n;return this.compatibilityMode?(n=this._currentRenderPass)==null||n.endOcclusionQuery():this._bundleList.addItem(new yd),this};const Sg={label:"TextureView_SwapChain_ResolveTarget",dimension:"2d",format:void 0,mipLevelCount:1,arrayLayerCount:1},Rg={label:"TextureView_SwapChain",dimension:"2d",format:void 0,mipLevelCount:1,arrayLayerCount:1},ZA=new K;class je extends rt{get snapshotRenderingMode(){return this._snapshotRendering.mode}set snapshotRenderingMode(e){this._snapshotRendering.mode=e}snapshotRenderingReset(){this._snapshotRendering.reset()}get snapshotRendering(){return this._snapshotRendering.enabled}set snapshotRendering(e){this._snapshotRendering.enabled=e}get disableCacheSamplers(){return this._cacheSampler?this._cacheSampler.disabled:!1}set disableCacheSamplers(e){this._cacheSampler&&(this._cacheSampler.disabled=e)}get disableCacheRenderPipelines(){return this._cacheRenderPipeline?this._cacheRenderPipeline.disabled:!1}set disableCacheRenderPipelines(e){this._cacheRenderPipeline&&(this._cacheRenderPipeline.disabled=e)}get disableCacheBindGroups(){return this._cacheBindGroups?this._cacheBindGroups.disabled:!1}set disableCacheBindGroups(e){this._cacheBindGroups&&(this._cacheBindGroups.disabled=e)}areAllEffectsReady(){return!0}getFontOffset(e){return Rv(e)}static get IsSupportedAsync(){return navigator.gpu?navigator.gpu.requestAdapter().then(e=>!!e,()=>!1).catch(()=>!1):Promise.resolve(!1)}static get IsSupported(){return U.Warn("You must call IsSupportedAsync for WebGPU!"),!1}get supportsUniformBuffers(){return!0}get supportedExtensions(){return this._adapterSupportedExtensions}get enabledExtensions(){return this._deviceEnabledExtensions}get supportedLimits(){return this._adapterSupportedLimits}get currentLimits(){return this._deviceLimits}get description(){return this.name+this.version}get version(){return 1}getInfo(){return{vendor:this._adapterInfo.vendor||"unknown vendor",renderer:this._adapterInfo.architecture||"unknown renderer",version:this._adapterInfo.description||"unknown version"}}get compatibilityMode(){return this._compatibilityMode}set compatibilityMode(e){this._compatibilityMode=e}get currentSampleCount(){return this._currentRenderTarget?this._currentRenderTarget.samples:this._mainPassSampleCount}static CreateAsync(e,t={}){const i=new je(e,t);return new Promise(s=>{i.initAsync(t.glslangOptions,t.twgslOptions).then(()=>s(i))})}constructor(e,t={}){if(super(t.antialias??!0,t),this.uniqueId=-1,this._uploadEncoderDescriptor={label:"upload"},this._renderEncoderDescriptor={label:"render"},this._clearDepthValue=1,this._clearReverseDepthValue=0,this._clearStencilValue=0,this._defaultSampleCount=4,this._glslang=null,this._tintWASM=null,this._glslangAndTintAreFullyLoaded=!1,this._adapterInfo={vendor:"",architecture:"",device:"",description:""},this._compiledComputeEffects={},this._counters={numEnableEffects:0,numEnableDrawWrapper:0,numBundleCreationNonCompatMode:0,numBundleReuseNonCompatMode:0},this.countersLastFrame={numEnableEffects:0,numEnableDrawWrapper:0,numBundleCreationNonCompatMode:0,numBundleReuseNonCompatMode:0},this.numMaxUncapturedErrors=20,this.scenes=[],this._virtualScenes=new Array,this._commandBuffers=[null,null],this._mainRenderPassWrapper={renderPassDescriptor:null,colorAttachmentViewDescriptor:null,depthAttachmentViewDescriptor:null,colorAttachmentGPUTextures:[],depthTextureFormat:void 0},this._rttRenderPassWrapper={renderPassDescriptor:null,colorAttachmentViewDescriptor:null,depthAttachmentViewDescriptor:null,colorAttachmentGPUTextures:[],depthTextureFormat:void 0},this._pendingDebugCommands=[],this._currentOverrideVertexBuffers=null,this._currentIndexBuffer=null,this._colorWriteLocal=!0,this._forceEnableEffect=!1,this.isNDCHalfZRange=!0,this.hasOriginBottomLeft=!1,this._workingGlslangAndTintPromise=null,this._viewportsCurrent={x:0,y:0,w:0,h:0},this._scissorsCurrent={x:0,y:0,w:0,h:0},this._scissorCached={x:0,y:0,z:0,w:0},this._stencilRefsCurrent=-1,this._blendColorsCurrent=[null,null,null,null],this._performanceMonitor=new hv,this._name="WebGPU",this._drawCalls=new Hi,t.deviceDescriptor=t.deviceDescriptor||{},t.enableGPUDebugMarkers=t.enableGPUDebugMarkers??!1,U.Log(`Babylon.js v${re.Version} - ${this.description} engine`),!navigator.gpu){U.Error("WebGPU is not supported by your browser.");return}t.swapChainFormat=t.swapChainFormat||navigator.gpu.getPreferredCanvasFormat(),this._isWebGPU=!0,this._shaderPlatformName="WEBGPU",this._renderingCanvas=e,this._options=t,this._mainPassSampleCount=t.antialias?this._defaultSampleCount:1,navigator&&navigator.userAgent&&this._setupMobileChecks(),this._sharedInit(this._renderingCanvas),this._shaderProcessor=new V4,this._shaderProcessorWGSL=new J4}prepareGlslangAndTintAsync(){return this._workingGlslangAndTintPromise||(this._workingGlslangAndTintPromise=new Promise(e=>{var t;this._initGlslang(this._glslangOptions??((t=this._options)==null?void 0:t.glslangOptions)).then(i=>{var s;this._glslang=i,this._tintWASM=new Ii,this._tintWASM.initTwgsl(this._twgslOptions??((s=this._options)==null?void 0:s.twgslOptions)).then(()=>{this._glslangAndTintAreFullyLoaded=!0,e()})})})),this._workingGlslangAndTintPromise}initAsync(e,t){return this.uniqueId=je._InstanceId++,this._glslangOptions=e,this._twgslOptions=t,navigator.gpu.requestAdapter(this._options).then(i=>{var s;if(i){this._adapter=i,this._adapterSupportedExtensions=[],(s=this._adapter.features)==null||s.forEach(o=>this._adapterSupportedExtensions.push(o)),this._adapterSupportedLimits=this._adapter.limits,this._adapterInfo=this._adapter.info;const r=this._options.deviceDescriptor??{},a=(r==null?void 0:r.requiredFeatures)??(this._options.enableAllFeatures?this._adapterSupportedExtensions:void 0);if(a){const o=a,l=[];for(const h of o)this._adapterSupportedExtensions.indexOf(h)!==-1&&l.push(h);r.requiredFeatures=l}if(this._options.setMaximumLimits&&!r.requiredLimits){r.requiredLimits={};for(const o in this._adapterSupportedLimits)o==="minSubgroupSize"||o==="maxSubgroupSize"||(r.requiredLimits[o]=this._adapterSupportedLimits[o])}return r.label=`BabylonWebGPUDevice${this.uniqueId}`,this._adapter.requestDevice(r)}else throw"Could not retrieve a WebGPU adapter (adapter is null)."}).then(i=>{var r,a;this._device=i,this._deviceEnabledExtensions=[],(r=this._device.features)==null||r.forEach(o=>this._deviceEnabledExtensions.push(o)),this._deviceLimits=i.limits;let s=-1;this._device.addEventListener("uncapturederror",o=>{++s<this.numMaxUncapturedErrors?U.Warn(`WebGPU uncaptured error (${s+1}): ${o.error} - ${o.error.message}`):s++===this.numMaxUncapturedErrors&&U.Warn(`WebGPU uncaptured error: too many warnings (${this.numMaxUncapturedErrors}), no more warnings will be reported to the console for this engine.`)}),this._doNotHandleContextLost||(a=this._device.lost)==null||a.then(o=>{this._isDisposed||(this._contextWasLost=!0,U.Warn("WebGPU context lost. "+o),this.onContextLostObservable.notifyObservers(this),this._restoreEngineAfterContextLost(async()=>{var _,p;const l=this.snapshotRenderingMode,h=this.snapshotRendering,u=this.disableCacheSamplers,c=this.disableCacheRenderPipelines,f=this.disableCacheBindGroups,d=this.enableGPUTimingMeasurements;await this.initAsync(this._glslangOptions??((_=this._options)==null?void 0:_.glslangOptions),this._twgslOptions??((p=this._options)==null?void 0:p.twgslOptions)),this.snapshotRenderingMode=l,this.snapshotRendering=h,this.disableCacheSamplers=u,this.disableCacheRenderPipelines=c,this.disableCacheBindGroups=f,this.enableGPUTimingMeasurements=d,this._currentRenderPass=null}))})}).then(()=>{this._initializeLimits(),this._bufferManager=new zl(this,this._device),this._textureHelper=new uA(this,this._device,this._bufferManager,this._deviceEnabledExtensions),this._cacheSampler=new vr(this._device),this._cacheBindGroups=new qe(this._device,this._cacheSampler,this),this._timestampQuery=new DA(this,this._device,this._bufferManager),this._occlusionQuery=this._device.createQuerySet?new FA(this,this._device,this._bufferManager):void 0,this._bundleList=new bd(this._device),this._snapshotRendering=new LA(this,this._snapshotRenderingMode,this._bundleList),this._ubInvertY=this._bufferManager.createBuffer(new Float32Array([-1,0]),Xe.Uniform|Xe.CopyDst,"UBInvertY"),this._ubDontInvertY=this._bufferManager.createBuffer(new Float32Array([1,0]),Xe.Uniform|Xe.CopyDst,"UBDontInvertY"),this.dbgVerboseLogsForFirstFrames&&this._count===void 0&&(this._count=0,U.Log(["%c frame #"+this._count+" - begin","background: #ffff00"])),this._uploadEncoder=this._device.createCommandEncoder(this._uploadEncoderDescriptor),this._renderEncoder=this._device.createCommandEncoder(this._renderEncoderDescriptor),this._emptyVertexBuffer=new S(this,[0],"",{stride:1,offset:0,size:1,label:"EmptyVertexBuffer"}),this._cacheRenderPipeline=new bs(this._device,this._emptyVertexBuffer),this._depthCullingState=new RA(this._cacheRenderPipeline),this._stencilStateComposer=new SA(this._cacheRenderPipeline),this._stencilStateComposer.stencilGlobal=this._stencilState,this._depthCullingState.depthTest=!0,this._depthCullingState.depthFunc=515,this._depthCullingState.depthMask=!0,this._textureHelper.setCommandEncoder(this._uploadEncoder),this._clearQuad=new wA(this._device,this,this._emptyVertexBuffer),this._defaultDrawContext=this.createDrawContext(),this._currentDrawContext=this._defaultDrawContext,this._defaultMaterialContext=this.createMaterialContext(),this._currentMaterialContext=this._defaultMaterialContext,this._initializeContextAndSwapChain(),this._initializeMainAttachments(),this.resize()}).catch(i=>{throw U.Error("A fatal error occurred during WebGPU creation/initialization."),i})}_initGlslang(e){return e=e||{},e={...je._GlslangDefaultOptions,...e},e.glslang?Promise.resolve(e.glslang):self.glslang?self.glslang(e.wasmPath):e.jsPath&&e.wasmPath?Z.LoadBabylonScriptAsync(e.jsPath).then(()=>self.glslang(Z.GetBabylonScriptURL(e.wasmPath))):Promise.reject("gslang is not available.")}_initializeLimits(){this._caps={maxTexturesImageUnits:this._deviceLimits.maxSampledTexturesPerShaderStage,maxVertexTextureImageUnits:this._deviceLimits.maxSampledTexturesPerShaderStage,maxCombinedTexturesImageUnits:this._deviceLimits.maxSampledTexturesPerShaderStage*2,maxTextureSize:this._deviceLimits.maxTextureDimension2D,maxCubemapTextureSize:this._deviceLimits.maxTextureDimension2D,maxRenderTextureSize:this._deviceLimits.maxTextureDimension2D,maxVertexAttribs:this._deviceLimits.maxVertexAttributes,maxDrawBuffers:8,maxVaryingVectors:this._deviceLimits.maxInterStageShaderVariables,maxFragmentUniformVectors:Math.floor(this._deviceLimits.maxUniformBufferBindingSize/4),maxVertexUniformVectors:Math.floor(this._deviceLimits.maxUniformBufferBindingSize/4),standardDerivatives:!0,astc:this._deviceEnabledExtensions.indexOf("texture-compression-astc")>=0?!0:void 0,s3tc:this._deviceEnabledExtensions.indexOf("texture-compression-bc")>=0?!0:void 0,pvrtc:null,etc1:null,etc2:this._deviceEnabledExtensions.indexOf("texture-compression-etc2")>=0?!0:void 0,bptc:this._deviceEnabledExtensions.indexOf("texture-compression-bc")>=0?!0:void 0,maxAnisotropy:16,uintIndices:!0,fragmentDepthSupported:!0,highPrecisionShaderSupported:!0,colorBufferFloat:!0,supportFloatTexturesResolve:!1,rg11b10ufColorRenderable:this._deviceEnabledExtensions.indexOf("rg11b10ufloat-renderable")>=0,textureFloat:!0,textureFloatLinearFiltering:this._deviceEnabledExtensions.indexOf("float32-filterable")>=0,textureFloatRender:!0,textureHalfFloat:!0,textureHalfFloatLinearFiltering:!0,textureHalfFloatRender:!0,textureLOD:!0,texelFetch:!0,drawBuffersExtension:!0,depthTextureExtension:!0,vertexArrayObject:!1,instancedArrays:!0,timerQuery:typeof BigUint64Array<"u"&&this._deviceEnabledExtensions.indexOf("timestamp-query")!==-1?!0:void 0,supportOcclusionQuery:typeof BigUint64Array<"u",canUseTimestampForTimerQuery:!0,multiview:!1,oculusMultiview:!1,parallelShaderCompile:void 0,blendMinMax:!0,maxMSAASamples:4,canUseGLInstanceID:!0,canUseGLVertexID:!0,supportComputeShaders:!0,supportSRGBBuffers:!0,supportTransformFeedbacks:!1,textureMaxLevel:!0,texture2DArrayMaxLayerCount:this._deviceLimits.maxTextureArrayLayers,disableMorphTargetTexture:!1,textureNorm16:!1},this._features={forceBitmapOverHTMLImageElement:!0,supportRenderAndCopyToLodForFloatTextures:!0,supportDepthStencilTexture:!0,supportShadowSamplers:!0,uniformBufferHardCheckMatrix:!1,allowTexturePrefiltering:!0,trackUbosInFrame:!0,checkUbosContentBeforeUpload:!0,supportCSM:!0,basisNeedsPOT:!1,support3DTextures:!0,needTypeSuffixInShaderConstants:!0,supportMSAA:!0,supportSSAO2:!0,supportIBLShadows:!0,supportExtendedTextureFormats:!0,supportSwitchCaseInShader:!0,supportSyncTextureRead:!1,needsInvertingBitmap:!1,useUBOBindingCache:!1,needShaderCodeInlining:!0,needToAlwaysBindUniformBuffers:!0,supportRenderPasses:!0,supportSpriteInstancing:!0,forceVertexBufferStrideAndOffsetMultiple4Bytes:!0,_checkNonFloatVertexBuffersDontRecreatePipelineContext:!0,_collectUbosUpdatedInFrame:!1}}_initializeContextAndSwapChain(){if(!this._renderingCanvas)throw"The rendering canvas has not been set!";this._context=this._renderingCanvas.getContext("webgpu"),this._configureContext(),this._colorFormat=this._options.swapChainFormat,this._mainRenderPassWrapper.colorAttachmentGPUTextures=[new nl(this)],this._mainRenderPassWrapper.colorAttachmentGPUTextures[0].format=this._colorFormat,this._setColorFormat(this._mainRenderPassWrapper)}_initializeMainAttachments(){if(!this._bufferManager)return;this.flushFramebuffer(),this._mainTextureExtends={width:this.getRenderWidth(!0),height:this.getRenderHeight(!0),depthOrArrayLayers:1};const e=new Float32Array([this.getRenderHeight(!0)]);this._bufferManager.setSubData(this._ubInvertY,4,e),this._bufferManager.setSubData(this._ubDontInvertY,4,e);let t;if(this._options.antialias){const r={label:`Texture_MainColor_${this._mainTextureExtends.width}x${this._mainTextureExtends.height}_antialiasing`,size:this._mainTextureExtends,mipLevelCount:1,sampleCount:this._mainPassSampleCount,dimension:"2d",format:this._options.swapChainFormat,usage:16};this._mainTexture&&this._textureHelper.releaseTexture(this._mainTexture),this._mainTexture=this._device.createTexture(r),t=[{view:this._mainTexture.createView({label:"TextureView_MainColor_antialiasing",dimension:"2d",format:this._options.swapChainFormat,mipLevelCount:1,arrayLayerCount:1}),clearValue:new K(0,0,0,1),loadOp:"clear",storeOp:"store"}]}else t=[{view:void 0,clearValue:new K(0,0,0,1),loadOp:"clear",storeOp:"store"}];this._mainRenderPassWrapper.depthTextureFormat=this.isStencilEnable?"depth24plus-stencil8":"depth32float",this._setDepthTextureFormat(this._mainRenderPassWrapper),this._setColorFormat(this._mainRenderPassWrapper);const i={label:`Texture_MainDepthStencil_${this._mainTextureExtends.width}x${this._mainTextureExtends.height}`,size:this._mainTextureExtends,mipLevelCount:1,sampleCount:this._mainPassSampleCount,dimension:"2d",format:this._mainRenderPassWrapper.depthTextureFormat,usage:16};this._depthTexture&&this._textureHelper.releaseTexture(this._depthTexture),this._depthTexture=this._device.createTexture(i);const s={view:this._depthTexture.createView({label:`TextureView_MainDepthStencil_${this._mainTextureExtends.width}x${this._mainTextureExtends.height}`,dimension:"2d",format:this._depthTexture.format,mipLevelCount:1,arrayLayerCount:1}),depthClearValue:this._clearDepthValue,depthLoadOp:"clear",depthStoreOp:"store",stencilClearValue:this._clearStencilValue,stencilLoadOp:this.isStencilEnable?"clear":void 0,stencilStoreOp:this.isStencilEnable?"store":void 0};this._mainRenderPassWrapper.renderPassDescriptor={label:"MainRenderPass",colorAttachments:t,depthStencilAttachment:s}}_sharedInit(e){super._sharedInit(e),Ev(this,e,this._creationOptions)}_configureContext(){this._context.configure({device:this._device,format:this._options.swapChainFormat,usage:17,alphaMode:this.premultipliedAlpha?"premultiplied":"opaque"})}resizeImageBitmap(e,t,i){return Cv(this,e,t,i)}_createImageBitmapFromSource(e,t){return Iv(this,e,t)}switchFullscreen(e){this.isFullscreen?this.exitFullscreen():this.enterFullscreen(e)}enterFullscreen(e){this.isFullscreen||(this._pointerLockRequested=e,this._renderingCanvas&&Mv(this._renderingCanvas))}exitFullscreen(){this.isFullscreen&&Pv()}enterPointerlock(){this._renderingCanvas&&fd(this._renderingCanvas)}exitPointerlock(){wv()}_rebuildBuffers(){super._rebuildBuffers();for(const e of this._storageBuffers)e.getBuffer().engineId!==this.uniqueId&&e._rebuild()}_restoreEngineAfterContextLost(e){bs.ResetCache(),qe.ResetCache();const t=s=>{var r;for(const a of s){for(const o of a.meshes){const l=o.subMeshes;if(l)for(const h of l)h._drawWrappers=[]}for(const o of a.materials)(r=o._materialContext)==null||r.reset()}};t(this.scenes),t(this._virtualScenes);const i=[];for(const s of this._uniformBuffers)s.name.indexOf("leftOver")<0&&i.push(s);this._uniformBuffers=i,super._restoreEngineAfterContextLost(e)}setSize(e,t,i=!1){return super.setSize(e,t,i)?(this.dbgVerboseLogsForFirstFrames&&(this._count===void 0&&(this._count=0),(!this._count||this._count<this.dbgVerboseLogsNumFrames)&&U.Log(["frame #"+this._count+" - setSize -",e,t])),this._initializeMainAttachments(),this.snapshotRendering&&this.snapshotRenderingReset(),!0):!1}_getShaderProcessor(e){return e===1?this._shaderProcessorWGSL:this._shaderProcessor}_getShaderProcessingContext(e,t){return new Di(e,t)}_getCurrentRenderPass(){return this._currentRenderTarget&&!this._currentRenderPass?this._startRenderTargetRenderPass(this._currentRenderTarget,!1,null,!1,!1):this._currentRenderPass||this._startMainRenderPass(!1),this._currentRenderPass}_getCurrentRenderPassWrapper(){return this._currentRenderTarget?this._rttRenderPassWrapper:this._mainRenderPassWrapper}applyStates(){this._stencilStateComposer.apply(),this._cacheRenderPipeline.setAlphaBlendEnabled(this._alphaState.alphaBlend)}wipeCaches(e){this.preventCacheWipeBetweenFrames&&!e||(this._forceEnableEffect=!0,this._currentIndexBuffer=null,this._currentOverrideVertexBuffers=null,this._cacheRenderPipeline.setBuffers(null,null,null),e&&(this._stencilStateComposer.reset(),this._depthCullingState.reset(),this._depthCullingState.depthFunc=515,this._alphaState.reset(),this._alphaMode=1,this._alphaEquation=0,this._cacheRenderPipeline.setAlphaBlendFactors(this._alphaState._blendFunctionParameters,this._alphaState._blendEquationParameters),this._cacheRenderPipeline.setAlphaBlendEnabled(!1),this.setColorWrite(!0)),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null)}setColorWrite(e){this._colorWriteLocal=e,this._cacheRenderPipeline.setWriteMask(e?15:0)}getColorWrite(){return this._colorWriteLocal}_mustUpdateViewport(){const e=this._viewportCached.x,t=this._viewportCached.y,i=this._viewportCached.z,s=this._viewportCached.w,r=this._viewportsCurrent.x!==e||this._viewportsCurrent.y!==t||this._viewportsCurrent.w!==i||this._viewportsCurrent.h!==s;return r&&(this._viewportsCurrent.x=this._viewportCached.x,this._viewportsCurrent.y=this._viewportCached.y,this._viewportsCurrent.w=this._viewportCached.z,this._viewportsCurrent.h=this._viewportCached.w),r}_applyViewport(e){const t=Math.floor(this._viewportCached.x),i=Math.floor(this._viewportCached.z),s=Math.floor(this._viewportCached.w);let r=Math.floor(this._viewportCached.y);this._currentRenderTarget||(r=this.getRenderHeight(!0)-r-s),e?e.addItem(new pd(t,r,i,s)):this._getCurrentRenderPass().setViewport(t,r,i,s,0,1),this.dbgVerboseLogsForFirstFrames&&(this._count===void 0&&(this._count=0),(!this._count||this._count<this.dbgVerboseLogsNumFrames)&&U.Log(["frame #"+this._count+" - viewport applied - (",this._viewportCached.x,this._viewportCached.y,this._viewportCached.z,this._viewportCached.w,") current pass is main pass="+this._currentPassIsMainPass()]))}_viewport(e,t,i,s){this._viewportCached.x=e,this._viewportCached.y=t,this._viewportCached.z=i,this._viewportCached.w=s}_mustUpdateScissor(){const e=this._scissorCached.x,t=this._scissorCached.y,i=this._scissorCached.z,s=this._scissorCached.w,r=this._scissorsCurrent.x!==e||this._scissorsCurrent.y!==t||this._scissorsCurrent.w!==i||this._scissorsCurrent.h!==s;return r&&(this._scissorsCurrent.x=this._scissorCached.x,this._scissorsCurrent.y=this._scissorCached.y,this._scissorsCurrent.w=this._scissorCached.z,this._scissorsCurrent.h=this._scissorCached.w),r}_applyScissor(e){const t=this._currentRenderTarget?this._scissorCached.y:this.getRenderHeight()-this._scissorCached.w-this._scissorCached.y;e?e.addItem(new gd(this._scissorCached.x,t,this._scissorCached.z,this._scissorCached.w)):this._getCurrentRenderPass().setScissorRect(this._scissorCached.x,t,this._scissorCached.z,this._scissorCached.w),this.dbgVerboseLogsForFirstFrames&&(this._count===void 0&&(this._count=0),(!this._count||this._count<this.dbgVerboseLogsNumFrames)&&U.Log(["frame #"+this._count+" - scissor applied - (",this._scissorCached.x,this._scissorCached.y,this._scissorCached.z,this._scissorCached.w,") current pass is main pass="+this._currentPassIsMainPass()]))}_scissorIsActive(){return this._scissorCached.x!==0||this._scissorCached.y!==0||this._scissorCached.z!==0||this._scissorCached.w!==0}enableScissor(e,t,i,s){this._scissorCached.x=e,this._scissorCached.y=t,this._scissorCached.z=i,this._scissorCached.w=s}disableScissor(){this._scissorCached.x=this._scissorCached.y=this._scissorCached.z=this._scissorCached.w=0,this._scissorsCurrent.x=this._scissorsCurrent.y=this._scissorsCurrent.w=this._scissorsCurrent.h=0}_mustUpdateStencilRef(){const e=this._stencilStateComposer.funcRef!==this._stencilRefsCurrent;return e&&(this._stencilRefsCurrent=this._stencilStateComposer.funcRef),e}_applyStencilRef(e){e?e.addItem(new Wl(this._stencilStateComposer.funcRef??0)):this._getCurrentRenderPass().setStencilReference(this._stencilStateComposer.funcRef??0)}_mustUpdateBlendColor(){const e=this._alphaState._blendConstants,t=e[0]!==this._blendColorsCurrent[0]||e[1]!==this._blendColorsCurrent[1]||e[2]!==this._blendColorsCurrent[2]||e[3]!==this._blendColorsCurrent[3];return t&&(this._blendColorsCurrent[0]=e[0],this._blendColorsCurrent[1]=e[1],this._blendColorsCurrent[2]=e[2],this._blendColorsCurrent[3]=e[3]),t}_applyBlendColor(e){e?e.addItem(new md(this._alphaState._blendConstants.slice())):this._getCurrentRenderPass().setBlendConstant(this._alphaState._blendConstants)}_resetRenderPassStates(){this._viewportsCurrent.x=this._viewportsCurrent.y=this._viewportsCurrent.w=this._viewportsCurrent.h=0,this._scissorsCurrent.x=this._scissorsCurrent.y=this._scissorsCurrent.w=this._scissorsCurrent.h=0,this._stencilRefsCurrent=-1,this._blendColorsCurrent[0]=this._blendColorsCurrent[1]=this._blendColorsCurrent[2]=this._blendColorsCurrent[3]=null}clear(e,t,i,s=!1){e&&e.a===void 0&&(e.a=1);const r=this._scissorIsActive();this.dbgVerboseLogsForFirstFrames&&(this._count===void 0&&(this._count=0),(!this._count||this._count<this.dbgVerboseLogsNumFrames)&&U.Log(["frame #"+this._count+" - clear - backBuffer=",t," depth=",i," stencil=",s," scissor is active=",r])),this._currentRenderTarget?r?(this._currentRenderPass||this._startRenderTargetRenderPass(this._currentRenderTarget,!1,t?e:null,i,s),this._applyScissor(this.compatibilityMode?null:this._bundleList),this._clearFullQuad(t?e:null,i,s)):(this._currentRenderPass&&this._endCurrentRenderPass(),this._startRenderTargetRenderPass(this._currentRenderTarget,!0,t?e:null,i,s)):((!this._currentRenderPass||!r)&&this._startMainRenderPass(!r,t?e:null,i,s),r&&(this._applyScissor(this.compatibilityMode?null:this._bundleList),this._clearFullQuad(t?e:null,i,s)))}_clearFullQuad(e,t,i){const s=this.compatibilityMode?this._getCurrentRenderPass():null;this._clearQuad.setColorFormat(this._colorFormat),this._clearQuad.setDepthStencilFormat(this._depthTextureFormat),this._clearQuad.setMRTAttachments(this._cacheRenderPipeline.mrtAttachments??[],this._cacheRenderPipeline.mrtTextureArray??[],this._cacheRenderPipeline.mrtTextureCount),this.compatibilityMode?s.setStencilReference(this._clearStencilValue):this._bundleList.addItem(new Wl(this._clearStencilValue));const r=this._clearQuad.clear(s,e,t,i,this.currentSampleCount);this.compatibilityMode?this._applyStencilRef(null):(this._bundleList.addBundle(r),this._applyStencilRef(this._bundleList),this._reportDrawCall())}createVertexBuffer(e,t,i){let s;return e instanceof Array?s=new Float32Array(e):e instanceof ArrayBuffer?s=new Uint8Array(e):s=e,this._bufferManager.createBuffer(s,Xe.Vertex|Xe.CopyDst,i)}createDynamicVertexBuffer(e,t){return this.createVertexBuffer(e,void 0,t)}createIndexBuffer(e,t,i){let s=!0,r;if(e instanceof Uint32Array||e instanceof Int32Array)r=e;else if(e instanceof Uint16Array)r=e,s=!1;else{for(let o=0;o<e.length;o++)if(e[o]>65535){r=new Uint32Array(e);break}r||(r=new Uint16Array(e),s=!1)}const a=this._bufferManager.createBuffer(r,Xe.Index|Xe.CopyDst,i);return a.is32Bits=s,a}updateDynamicIndexBuffer(e,t,i=0){const s=e;let r;e.is32Bits?r=t instanceof Uint32Array?t:new Uint32Array(t):r=t instanceof Uint16Array?t:new Uint16Array(t),this._bufferManager.setSubData(s,i,r)}updateDynamicVertexBuffer(e,t,i,s){const r=e;i===void 0&&(i=0);let a;s===void 0?(t instanceof Array?a=new Float32Array(t):t instanceof ArrayBuffer?a=new Uint8Array(t):a=t,s=a.byteLength):t instanceof Array?a=new Float32Array(t):t instanceof ArrayBuffer?a=new Uint8Array(t):a=t,this._bufferManager.setSubData(r,i,a,0,s)}_createBuffer(e,t,i){let s;e instanceof Array?s=new Float32Array(e):e instanceof ArrayBuffer?s=new Uint8Array(e):s=e;let r=0;return t&1&&(r|=Xe.CopySrc),t&2&&(r|=Xe.CopyDst),t&4&&(r|=Xe.Uniform),t&8&&(r|=Xe.Vertex),t&16&&(r|=Xe.Index),t&32&&(r|=Xe.Storage),t&64&&(r|=Xe.Indirect),this._bufferManager.createBuffer(s,r,i)}bindBuffersDirectly(){throw"Not implemented on WebGPU"}updateAndBindInstancesBuffer(){throw"Not implemented on WebGPU"}unbindInstanceAttributes(){}bindBuffers(e,t,i,s){this._currentIndexBuffer=t,this._currentOverrideVertexBuffers=s??null,this._cacheRenderPipeline.setBuffers(e,t,this._currentOverrideVertexBuffers)}_releaseBuffer(e){return this._bufferManager.releaseBuffer(e)}createUniformBuffer(e,t){let i;return e instanceof Array?i=new Float32Array(e):i=e,this._bufferManager.createBuffer(i,Xe.Uniform|Xe.CopyDst,t)}createDynamicUniformBuffer(e,t){return this.createUniformBuffer(e,t)}updateUniformBuffer(e,t,i,s){i===void 0&&(i=0);const r=e;let a;s===void 0?(t instanceof Float32Array?a=t:a=new Float32Array(t),s=a.byteLength):t instanceof Float32Array?a=t:a=new Float32Array(t),this._bufferManager.setSubData(r,i,a,0,s)}bindUniformBufferBase(e,t,i){this._currentDrawContext.setBuffer(i,e)}bindUniformBlock(){}createEffect(e,t,i,s,r,a,o,l,h,u=0,c){const f=typeof e=="string"?e:e.vertexToken||e.vertexSource||e.vertexElement||e.vertex,d=typeof e=="string"?e:e.fragmentToken||e.fragmentSource||e.fragmentElement||e.fragment,_=this._getGlobalDefines(),p=t.attributes!==void 0;let g=r??t.defines??"";_&&(g+=`
`+_);const m=f+"+"+d+"@"+g;if(this._compiledEffects[m]){const T=this._compiledEffects[m];return o&&T.isReady()&&o(T),T._refCount++,T}const v=new Et(e,t,p?this:i,s,this,r,a,o,l,h,m,t.shaderLanguage??u,t.extraInitializationsAsync??c);return this._compiledEffects[m]=v,v}_compileRawShaderToSpirV(e,t){return this._glslang.compileGLSL(e,t)}_compileShaderToSpirV(e,t,i,s){return this._compileRawShaderToSpirV(s+(i?i+`
`:"")+e,t)}_getWGSLShader(e,t,i){return i?i="//"+i.split(`
`).join(`
//`)+`
`:i="",i+e}_createPipelineStageDescriptor(e,t,i,s,r){return this._tintWASM&&i===0&&(e=this._tintWASM.convertSpirV2WGSL(e,s),t=this._tintWASM.convertSpirV2WGSL(t,r)),{vertexStage:{module:this._device.createShaderModule({label:"vertex",code:e}),entryPoint:"main"},fragmentStage:{module:this._device.createShaderModule({label:"fragment",code:t}),entryPoint:"main"}}}_compileRawPipelineStageDescriptor(e,t,i){const s=e.indexOf("#define DISABLE_UNIFORMITY_ANALYSIS")>=0,r=t.indexOf("#define DISABLE_UNIFORMITY_ANALYSIS")>=0,a=i===0?this._compileRawShaderToSpirV(e,"vertex"):e,o=i===0?this._compileRawShaderToSpirV(t,"fragment"):t;return this._createPipelineStageDescriptor(a,o,i,s,r)}_compilePipelineStageDescriptor(e,t,i,s){this.onBeforeShaderCompilationObservable.notifyObservers(this);const r=e.indexOf("#define DISABLE_UNIFORMITY_ANALYSIS")>=0,a=t.indexOf("#define DISABLE_UNIFORMITY_ANALYSIS")>=0,o=`#version 450
`,l=s===0?this._compileShaderToSpirV(e,"vertex",i,o):this._getWGSLShader(e,"vertex",i),h=s===0?this._compileShaderToSpirV(t,"fragment",i,o):this._getWGSLShader(t,"fragment",i),u=this._createPipelineStageDescriptor(l,h,s,r,a);return this.onAfterShaderCompilationObservable.notifyObservers(this),u}createRawShaderProgram(){throw"Not available on WebGPU"}createShaderProgram(){throw"Not available on WebGPU"}inlineShaderCode(e){const t=new bh(e);return t.debug=!1,t.processCode(),t.code}createPipelineContext(e){return new L4(e,this)}createMaterialContext(){return new yh}createDrawContext(){return new xh(this._bufferManager)}async _preparePipelineContext(e,t,i,s,r,a,o,l,h,u,c){const f=e,d=f.shaderProcessingContext.shaderLanguage;d===0&&!this._glslangAndTintAreFullyLoaded&&await this.prepareGlslangAndTintAsync(),this.dbgShowShaderCode&&(U.Log(["defines",l]),U.Log(t),U.Log(i),U.Log("***********************************************")),f.sources={fragment:i,vertex:t,rawVertex:r,rawFragment:a},s?f.stages=this._compileRawPipelineStageDescriptor(t,i,d):f.stages=this._compilePipelineStageDescriptor(t,i,l,d),c()}getAttributes(e,t){const i=new Array(t.length),s=e;for(let r=0;r<t.length;r++){const a=t[r],o=s.shaderProcessingContext.availableAttributes[a];o!==void 0&&(i[r]=o)}return i}enableEffect(e){if(e){if(!J2(e))this._currentEffect=e,this._currentMaterialContext=this._defaultMaterialContext,this._currentDrawContext=this._defaultDrawContext,this._counters.numEnableEffects++,this.dbgLogIfNotDrawWrapper&&U.Warn(`enableEffect has been called with an Effect and not a Wrapper! effect.uniqueId=${e.uniqueId}, effect.name=${e.name}, effect.name.vertex=${typeof e.name=="string"?"":e.name.vertex}, effect.name.fragment=${typeof e.name=="string"?"":e.name.fragment}`,10);else if(!e.effect||e.effect===this._currentEffect&&e.materialContext===this._currentMaterialContext&&e.drawContext===this._currentDrawContext&&!this._forceEnableEffect){if(!e.effect&&this.dbgShowEmptyEnableEffectCalls)throw U.Log(["drawWrapper=",e]),"Invalid call to enableEffect: the effect property is empty!";return}else if(this._currentEffect=e.effect,this._currentMaterialContext=e.materialContext,this._currentDrawContext=e.drawContext,this._counters.numEnableDrawWrapper++,!this._currentMaterialContext)throw U.Log(["drawWrapper=",e]),"Invalid call to enableEffect: the materialContext property is empty!";this._stencilStateComposer.stencilMaterial=void 0,this._forceEnableEffect=!1,this._currentEffect.onBind&&this._currentEffect.onBind(this._currentEffect),this._currentEffect._onBindObservable&&this._currentEffect._onBindObservable.notifyObservers(this._currentEffect)}}_releaseEffect(e){this._compiledEffects[e._key]&&(delete this._compiledEffects[e._key],this._deletePipelineContext(e.getPipelineContext()))}releaseEffects(){for(const e in this._compiledEffects){const t=this._compiledEffects[e].getPipelineContext();this._deletePipelineContext(t)}this._compiledEffects={},this.onReleaseEffectsObservable.notifyObservers(this)}_deletePipelineContext(e){const t=e;t&&id(t)}get needPOTTextures(){return!1}_createHardwareTexture(){return new nl(this)}_releaseTexture(e){const t=this._internalTexturesCache.indexOf(e);t!==-1&&this._internalTexturesCache.splice(t,1),this._textureHelper.releaseTexture(e)}_getRGBABufferInternalSizedFormat(){return 5}updateTextureComparisonFunction(e,t){e._comparisonFunction=t}_createInternalTexture(e,t,i=!0,s=0){const r={};t!==void 0&&typeof t=="object"?(r.generateMipMaps=t.generateMipMaps,r.createMipMaps=t.createMipMaps,r.type=t.type===void 0?0:t.type,r.samplingMode=t.samplingMode===void 0?3:t.samplingMode,r.format=t.format===void 0?5:t.format,r.samples=t.samples??1,r.creationFlags=t.creationFlags??0,r.useSRGBBuffer=t.useSRGBBuffer??!1,r.label=t.label):(r.generateMipMaps=t,r.type=0,r.samplingMode=3,r.format=5,r.samples=1,r.creationFlags=0,r.useSRGBBuffer=!1),(r.type===1&&!this._caps.textureFloatLinearFiltering||r.type===2&&!this._caps.textureHalfFloatLinearFiltering)&&(r.samplingMode=1),r.type===1&&!this._caps.textureFloat&&(r.type=0,U.Warn("Float textures are not supported. Type forced to TEXTURETYPE_UNSIGNED_BYTE"));const a=new gt(this,s),o=e.width??e,l=e.height??e,h=e.depth??0,u=e.layers??0;if(a.baseWidth=o,a.baseHeight=l,a.width=o,a.height=l,a.depth=h||u,a.isReady=!0,a.samples=r.samples,a.generateMipMaps=!!r.generateMipMaps,a.samplingMode=r.samplingMode,a.type=r.type,a.format=r.format,a.is2DArray=u>0,a.is3D=h>0,a._cachedWrapU=0,a._cachedWrapV=0,a._useSRGBBuffer=r.useSRGBBuffer,a.label=r.label,this._internalTexturesCache.push(a),!i){const c=!r.generateMipMaps&&r.createMipMaps;c&&(a.generateMipMaps=!0),this._textureHelper.createGPUTextureForInternalTexture(a,o,l,u||1,r.creationFlags),c&&(a.generateMipMaps=!1)}return a}createTexture(e,t,i,s,r=3,a=null,o=null,l=null,h=null,u=null,c=null,f,d,_,p){return this._createTextureBase(e,t,i,s,r,a,o,(g,m,v,T,A,b,x,E)=>{var C;const R=T;if(g.baseWidth=R.width,g.baseHeight=R.height,g.width=R.width,g.height=R.height,g.format=g.format!==-1?g.format:u??5,g.type=g.type!==-1?g.type:0,g._creationFlags=_??0,E(g.width,g.height,R,m,g,()=>{}),(C=g._hardwareTexture)!=null&&C.underlyingResource)!b&&!x&&this._generateMipmaps(g,this._uploadEncoder);else{const I=this._textureHelper.createGPUTextureForInternalTexture(g,R.width,R.height,void 0,_);We.IsImageBitmap(R)&&(this._textureHelper.updateTexture(R,g,R.width,R.height,g.depth,I.format,0,0,A,!1,0,0),!b&&!x&&this._generateMipmaps(g,this._uploadEncoder))}v&&v.removePendingData(g),g.isReady=!0,g.onLoadedObservable.notifyObservers(g),g.onLoadedObservable.clear()},()=>!1,l,h,u,c,f,d,p)}wrapWebGPUTexture(e){const t=new nl(this,e),i=new gt(this,0,!0);return i._hardwareTexture=t,i.isReady=!0,i}wrapWebGLTexture(){throw new Error("wrapWebGLTexture is not supported, use wrapWebGPUTexture instead.")}_getUseSRGBBuffer(e,t){return e&&this._caps.supportSRGBBuffers}_unpackFlipY(e){}updateTextureSamplingMode(e,t,i=!1){i&&(t.generateMipMaps=!0,this._generateMipmaps(t)),t.samplingMode=e}updateTextureWrappingMode(e,t,i=null,s=null){t!==null&&(e._cachedWrapU=t),i!==null&&(e._cachedWrapV=i),(e.is2DArray||e.is3D)&&s!==null&&(e._cachedWrapR=s)}updateTextureDimensions(e,t,i,s=1){if(!e._hardwareTexture||e.width===t&&e.height===i&&e.depth===s)return;const r=e._hardwareTexture.textureAdditionalUsages;e._hardwareTexture.release(),this._textureHelper.createGPUTextureForInternalTexture(e,t,i,s,r)}_setInternalTexture(e,t,i){if(i=i??e,this._currentEffect){const r=this._currentEffect._pipelineContext.shaderProcessingContext.availableTextures[i];if(this._currentMaterialContext.setTexture(e,t),r&&r.autoBindSampler){const a=i+"Sampler";this._currentMaterialContext.setSampler(a,t)}}}createPrefilteredCubeTexture(e,t,i,s,r=null,a=null,o,l=null,h=!0){const u=c=>{if(!c){r&&r(null);return}const f=c.texture;h?c.info.sphericalPolynomial&&(f._sphericalPolynomial=c.info.sphericalPolynomial):f._sphericalPolynomial=new Ko,f._source=9,r&&r(f)};return this.createCubeTexture(e,t,null,!1,u,a,o,l,h,i,s)}setTexture(e,t,i,s){this._setTexture(e,i,!1,!1,s,s)}setTextureArray(e,t,i,s){for(let r=0;r<i.length;r++)this._setTexture(-1,i[r],!0,!1,s+r.toString(),s)}_setTexture(e,t,i=!1,s=!1,r="",a){if(a=a??r,this._currentEffect){if(!t)return this._currentMaterialContext.setTexture(r,null),!1;if(t.video)t.update();else if(t.delayLoadState===4)return t.delayLoad(),!1;let o=null;if(s?o=t.depthStencilTexture:t.isReady()?o=t.getInternalTexture():t.isCube?o=this.emptyCubeTexture:t.is3D?o=this.emptyTexture3D:t.is2DArray?o=this.emptyTexture2DArray:o=this.emptyTexture,o&&!o.isMultiview){if(o.isCube&&o._cachedCoordinatesMode!==t.coordinatesMode){o._cachedCoordinatesMode=t.coordinatesMode;const l=t.coordinatesMode!==3&&t.coordinatesMode!==5?1:0;t.wrapU=l,t.wrapV=l}o._cachedWrapU=t.wrapU,o._cachedWrapV=t.wrapV,o.is3D&&(o._cachedWrapR=t.wrapR),this._setAnisotropicLevel(0,o,t.anisotropicFilteringLevel)}this._setInternalTexture(r,o,a)}else this.dbgVerboseLogsForFirstFrames&&(this._count===void 0&&(this._count=0),(!this._count||this._count<this.dbgVerboseLogsNumFrames)&&U.Log(["frame #"+this._count+" - _setTexture called with a null _currentEffect! texture=",t]));return!0}_setAnisotropicLevel(e,t,i){t._cachedAnisotropicFilteringLevel!==i&&(t._cachedAnisotropicFilteringLevel=Math.min(i,this._caps.maxAnisotropy))}_bindTexture(e,t,i){e!==void 0&&this._setInternalTexture(i,t)}generateMipmaps(e){this._generateMipmaps(e)}updateTextureData(e,t,i,s,r,a,o=0,l=0,h=!1){var f;let u=e._hardwareTexture;(f=e._hardwareTexture)!=null&&f.underlyingResource||(u=this._textureHelper.createGPUTextureForInternalTexture(e));const c=new Uint8Array(t.buffer,t.byteOffset,t.byteLength);this._textureHelper.updateTexture(c,e,r,a,e.depth,u.format,o,l,e.invertY,!1,i,s),h&&this._generateMipmaps(e)}_uploadCompressedDataToTextureDirectly(e,t,i,s,r,a=0,o=0){var u;let l=e._hardwareTexture;(u=e._hardwareTexture)!=null&&u.underlyingResource||(e.format=t,l=this._textureHelper.createGPUTextureForInternalTexture(e,i,s));const h=new Uint8Array(r.buffer,r.byteOffset,r.byteLength);this._textureHelper.updateTexture(h,e,i,s,e.depth,l.format,a,o,!1,!1,0,0)}_uploadDataToTextureDirectly(e,t,i=0,s=0,r,a=!1){var d;const o=Math.round(Math.log(e.width)*Math.LOG2E),l=Math.round(Math.log(e.height)*Math.LOG2E),h=a?e.width:Math.pow(2,Math.max(o-s,0)),u=a?e.height:Math.pow(2,Math.max(l-s,0));let c=e._hardwareTexture;(d=e._hardwareTexture)!=null&&d.underlyingResource||(c=this._textureHelper.createGPUTextureForInternalTexture(e,h,u));const f=new Uint8Array(t.buffer,t.byteOffset,t.byteLength);this._textureHelper.updateTexture(f,e,h,u,e.depth,c.format,i,s,e.invertY,!1,0,0)}_uploadArrayBufferViewToTexture(e,t,i=0,s=0){this._uploadDataToTextureDirectly(e,t,i,s)}_uploadImageToTexture(e,t,i=0,s=0){var h;let r=e._hardwareTexture;if((h=e._hardwareTexture)!=null&&h.underlyingResource||(r=this._textureHelper.createGPUTextureForInternalTexture(e)),t instanceof HTMLImageElement)throw"WebGPU engine: HTMLImageElement not supported in _uploadImageToTexture!";const a=t,o=Math.ceil(e.width/(1<<s)),l=Math.ceil(e.height/(1<<s));this._textureHelper.updateTexture(a,e,o,l,e.depth,r.format,i,s,e.invertY,!1,0,0)}readPixels(e,t,i,s,r=!0,a=!0,o=null){const h=this._getCurrentRenderPassWrapper().colorAttachmentGPUTextures[0];if(!h)return Promise.resolve(new Uint8Array(0));const u=h.underlyingResource,c=h.format;return u?(a&&this.flushFramebuffer(),this._textureHelper.readPixels(u,e,t,i,s,c,void 0,void 0,o)):Promise.resolve(new Uint8Array(0))}_measureFps(){this._performanceMonitor.sampleFrame(),this._fps=this._performanceMonitor.averageFPS,this._deltaTime=this._performanceMonitor.instantaneousFrameTime||0}get performanceMonitor(){return this._performanceMonitor}beginFrame(){this._measureFps(),super.beginFrame()}endFrame(){if(this._endCurrentRenderPass(),this._snapshotRendering.endFrame(),this._timestampQuery.endFrame(this._renderEncoder),this._timestampIndex=0,this.flushFramebuffer(),this._textureHelper.destroyDeferredTextures(),this._bufferManager.destroyDeferredBuffers(),this._features._collectUbosUpdatedInFrame){if(this.dbgVerboseLogsForFirstFrames&&(this._count===void 0&&(this._count=0),!this._count||this._count<this.dbgVerboseLogsNumFrames)){const e=[];for(const t in ce._UpdatedUbosInFrame)e.push(t+":"+ce._UpdatedUbosInFrame[t]);U.Log(["frame #"+this._count+" - updated ubos -",e.join(", ")])}ce._UpdatedUbosInFrame={}}this.countersLastFrame.numEnableEffects=this._counters.numEnableEffects,this.countersLastFrame.numEnableDrawWrapper=this._counters.numEnableDrawWrapper,this.countersLastFrame.numBundleCreationNonCompatMode=this._counters.numBundleCreationNonCompatMode,this.countersLastFrame.numBundleReuseNonCompatMode=this._counters.numBundleReuseNonCompatMode,this._counters.numEnableEffects=0,this._counters.numEnableDrawWrapper=0,this._counters.numBundleCreationNonCompatMode=0,this._counters.numBundleReuseNonCompatMode=0,this._cacheRenderPipeline.endFrame(),this._cacheBindGroups.endFrame(),this._pendingDebugCommands.length=0,this.dbgVerboseLogsForFirstFrames&&(this._count===void 0&&(this._count=0),this._count<this.dbgVerboseLogsNumFrames&&U.Log(["%c frame #"+this._count+" - end","background: #ffff00"]),this._count<this.dbgVerboseLogsNumFrames&&(this._count++,this._count!==this.dbgVerboseLogsNumFrames&&U.Log(["%c frame #"+this._count+" - begin","background: #ffff00"]))),super.endFrame()}extractDriverInfo(){return""}flushFramebuffer(){this._endCurrentRenderPass(),this._commandBuffers[0]=this._uploadEncoder.finish(),this._commandBuffers[1]=this._renderEncoder.finish(),this._device.queue.submit(this._commandBuffers),this._uploadEncoder=this._device.createCommandEncoder(this._uploadEncoderDescriptor),this._renderEncoder=this._device.createCommandEncoder(this._renderEncoderDescriptor),this._timestampQuery.startFrame(this._uploadEncoder),this._textureHelper.setCommandEncoder(this._uploadEncoder),this._bundleList.reset()}_currentFrameBufferIsDefaultFrameBuffer(){return this._currentPassIsMainPass()}_startRenderTargetRenderPass(e,t,i,s,r){var T,A,b,x;this._endCurrentRenderPass();const a=e,o=a._depthStencilTexture,l=o==null?void 0:o._hardwareTexture,h=l==null?void 0:l.underlyingResource,u=l==null?void 0:l.getMSAATexture(0),c=h==null?void 0:h.createView(this._rttRenderPassWrapper.depthAttachmentViewDescriptor),f=u==null?void 0:u.createView(this._rttRenderPassWrapper.depthAttachmentViewDescriptor),d=l?We.HasStencilAspect(l.format):!1,_=[];this.useReverseDepthBuffer&&this.setDepthFunctionToGreaterOrEqual();const p=ZA;i&&(p.r=i.r*255,p.g=i.g*255,p.b=i.b*255,p.a=i.a*255);const g=t&&i,m=t&&s,v=t&&r;if(a._attachments&&a.isMulti){(!this._mrtAttachments||this._mrtAttachments.length===0)&&(this._mrtAttachments=a._defaultAttachments);for(let E=0;E<this._mrtAttachments.length;++E){const R=this._mrtAttachments[E],C=a.textures[E],I=C==null?void 0:C._hardwareTexture,D=I==null?void 0:I.underlyingResource;if(I&&D){const w=a.getBaseArrayLayer(E),z=I.getMSAATexture(w),F={...this._rttRenderPassWrapper.colorAttachmentViewDescriptor,dimension:C.is3D?"3d":"2d",format:I.format,baseArrayLayer:w},W={...this._rttRenderPassWrapper.colorAttachmentViewDescriptor,dimension:C.is3D?"3d":"2d",format:I.format,baseArrayLayer:0},X=C.type===7||C.type===5,he=D.createView(F),H=z==null?void 0:z.createView(W);_.push({view:H||he,resolveTarget:z?he:void 0,depthSlice:C.is3D?((T=a.layerIndices)==null?void 0:T[E])??0:void 0,clearValue:R!==0&&g?X?p:i:void 0,loadOp:R!==0&&g?"clear":"load",storeOp:"store"})}}this._cacheRenderPipeline.setMRT(a.textures,this._mrtAttachments.length),this._cacheRenderPipeline.setMRTAttachments(this._mrtAttachments)}else{const E=a.texture;if(E){const R=E._hardwareTexture,C=R.underlyingResource;let I;a.is3D&&(I=this._rttRenderPassWrapper.colorAttachmentViewDescriptor.baseArrayLayer,this._rttRenderPassWrapper.colorAttachmentViewDescriptor.baseArrayLayer=0);const D=R.getMSAATexture(0),w=C.createView(this._rttRenderPassWrapper.colorAttachmentViewDescriptor),z=D==null?void 0:D.createView(this._rttRenderPassWrapper.colorAttachmentViewDescriptor),F=E.type===7||E.type===5;_.push({view:z||w,resolveTarget:D?w:void 0,depthSlice:I,clearValue:g?F?p:i:void 0,loadOp:g?"clear":"load",storeOp:"store"})}else _.push(null)}if((A=this._debugPushGroup)==null||A.call(this,"render target pass"+(e.label?" ("+e.label+")":""),0),this._rttRenderPassWrapper.renderPassDescriptor={label:(e.label??"RTT")+" - RenderPass",colorAttachments:_,depthStencilAttachment:o&&h?{view:f||c,depthClearValue:m?this.useReverseDepthBuffer?this._clearReverseDepthValue:this._clearDepthValue:void 0,depthLoadOp:m?"clear":"load",depthStoreOp:"store",stencilClearValue:a._depthStencilTextureWithStencil&&v?this._clearStencilValue:void 0,stencilLoadOp:d?a._depthStencilTextureWithStencil&&v?"clear":"load":void 0,stencilStoreOp:d?"store":void 0}:void 0,occlusionQuerySet:(b=this._occlusionQuery)!=null&&b.hasQueries?this._occlusionQuery.querySet:void 0},this._timestampQuery.startPass(this._rttRenderPassWrapper.renderPassDescriptor,this._timestampIndex),this._currentRenderPass=this._renderEncoder.beginRenderPass(this._rttRenderPassWrapper.renderPassDescriptor),this.dbgVerboseLogsForFirstFrames&&(this._count===void 0&&(this._count=0),!this._count||this._count<this.dbgVerboseLogsNumFrames)){const E=a.texture;U.Log(["frame #"+this._count+" - render target begin pass - rtt name="+e.label+", internalTexture.uniqueId="+E.uniqueId+", width="+E.width+", height="+E.height+", setClearStates="+t,"renderPassDescriptor=",this._rttRenderPassWrapper.renderPassDescriptor])}(x=this._debugFlushPendingCommands)==null||x.call(this),this._resetRenderPassStates(),(!l||!We.HasStencilAspect(l.format))&&(this._stencilStateComposer.enabled=!1)}_startMainRenderPass(e,t,i,s){var h,u,c;this._endCurrentRenderPass(),this.useReverseDepthBuffer&&this.setDepthFunctionToGreaterOrEqual();const r=e&&t,a=e&&i,o=e&&s;this._mainRenderPassWrapper.renderPassDescriptor.colorAttachments[0].clearValue=r?t:void 0,this._mainRenderPassWrapper.renderPassDescriptor.colorAttachments[0].loadOp=r?"clear":"load",this._mainRenderPassWrapper.renderPassDescriptor.depthStencilAttachment.depthClearValue=a?this.useReverseDepthBuffer?this._clearReverseDepthValue:this._clearDepthValue:void 0,this._mainRenderPassWrapper.renderPassDescriptor.depthStencilAttachment.depthLoadOp=a?"clear":"load",this._mainRenderPassWrapper.renderPassDescriptor.depthStencilAttachment.stencilClearValue=o?this._clearStencilValue:void 0,this._mainRenderPassWrapper.renderPassDescriptor.depthStencilAttachment.stencilLoadOp=this.isStencilEnable?o?"clear":"load":void 0,this._mainRenderPassWrapper.renderPassDescriptor.occlusionQuerySet=(h=this._occlusionQuery)!=null&&h.hasQueries?this._occlusionQuery.querySet:void 0;const l=this._context.getCurrentTexture();this._mainRenderPassWrapper.colorAttachmentGPUTextures[0].set(l),this._options.antialias?(Sg.format=l.format,this._mainRenderPassWrapper.renderPassDescriptor.colorAttachments[0].resolveTarget=l.createView(Sg)):(Rg.format=l.format,this._mainRenderPassWrapper.renderPassDescriptor.colorAttachments[0].view=l.createView(Rg)),this.dbgVerboseLogsForFirstFrames&&(this._count===void 0&&(this._count=0),(!this._count||this._count<this.dbgVerboseLogsNumFrames)&&U.Log(["frame #"+this._count+" - main begin pass - texture width="+this._mainTextureExtends.width," height="+this._mainTextureExtends.height+", setClearStates="+e,"renderPassDescriptor=",this._mainRenderPassWrapper.renderPassDescriptor])),(u=this._debugPushGroup)==null||u.call(this,"main pass",0),this._timestampQuery.startPass(this._mainRenderPassWrapper.renderPassDescriptor,this._timestampIndex),this._currentRenderPass=this._renderEncoder.beginRenderPass(this._mainRenderPassWrapper.renderPassDescriptor),this._setDepthTextureFormat(this._mainRenderPassWrapper),this._setColorFormat(this._mainRenderPassWrapper),(c=this._debugFlushPendingCommands)==null||c.call(this),this._resetRenderPassStates(),this._isStencilEnable||(this._stencilStateComposer.enabled=!1)}bindFramebuffer(e,t=0,i,s,r,a=0,o=0){var u,c;const l=(u=e.texture)==null?void 0:u._hardwareTexture;this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this._endCurrentRenderPass(),this._currentRenderTarget=e;const h=this._currentRenderTarget._depthStencilTexture;this._rttRenderPassWrapper.colorAttachmentGPUTextures[0]=l,this._rttRenderPassWrapper.depthTextureFormat=h?We.GetWebGPUTextureFormat(-1,h.format):void 0,this._setDepthTextureFormat(this._rttRenderPassWrapper),this._setColorFormat(this._rttRenderPassWrapper),this._rttRenderPassWrapper.colorAttachmentViewDescriptor={format:this._colorFormat,dimension:e.is3D?"3d":"2d",mipLevelCount:1,baseArrayLayer:e.isCube?o*6+t:o,baseMipLevel:a,arrayLayerCount:1,aspect:"all"},this._rttRenderPassWrapper.depthAttachmentViewDescriptor={format:this._depthTextureFormat,dimension:h&&h.is3D?"3d":"2d",mipLevelCount:1,baseArrayLayer:h?h.isCube?o*6+t:o:0,baseMipLevel:0,arrayLayerCount:1,aspect:"all"},this.dbgVerboseLogsForFirstFrames&&(this._count===void 0&&(this._count=0),(!this._count||this._count<this.dbgVerboseLogsNumFrames)&&U.Log(["frame #"+this._count+" - bindFramebuffer - rtt name="+e.label+", internalTexture.uniqueId="+((c=e.texture)==null?void 0:c.uniqueId)+", face="+t+", lodLevel="+a+", layer="+o,"colorAttachmentViewDescriptor=",this._rttRenderPassWrapper.colorAttachmentViewDescriptor,"depthAttachmentViewDescriptor=",this._rttRenderPassWrapper.depthAttachmentViewDescriptor])),this._cachedViewport&&!r?this.setViewport(this._cachedViewport,i,s):(i||(i=e.width,a&&(i=i/Math.pow(2,a))),s||(s=e.height,a&&(s=s/Math.pow(2,a))),this._viewport(0,0,i,s)),this.wipeCaches()}unBindFramebuffer(e,t=!1,i){var r;const s=this._currentRenderTarget;this._currentRenderTarget=null,i&&i(),this._currentRenderTarget=s,this._endCurrentRenderPass(),t||(e.isMulti?this.generateMipMapsMultiFramebuffer(e):this.generateMipMapsFramebuffer(e)),this._currentRenderTarget=null,this.dbgVerboseLogsForFirstFrames&&(this._count===void 0&&(this._count=0),(!this._count||this._count<this.dbgVerboseLogsNumFrames)&&U.Log("frame #"+this._count+" - unBindFramebuffer - rtt name="+e.label+", internalTexture.uniqueId=",(r=e.texture)==null?void 0:r.uniqueId)),this._mrtAttachments=[],this._cacheRenderPipeline.setMRT([]),this._cacheRenderPipeline.setMRTAttachments(this._mrtAttachments)}generateMipMapsFramebuffer(e){var t;!e.isMulti&&((t=e.texture)!=null&&t.generateMipMaps)&&!e.isCube&&this._generateMipmaps(e.texture)}resolveFramebuffer(e){throw new Error("resolveFramebuffer is not yet implemented in WebGPU!")}restoreDefaultFramebuffer(){this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this._currentRenderPass||this._startMainRenderPass(!1),this._cachedViewport&&this.setViewport(this._cachedViewport),this.wipeCaches()}_setColorFormat(e){var i;const t=((i=e.colorAttachmentGPUTextures[0])==null?void 0:i.format)??null;this._cacheRenderPipeline.setColorFormat(t),this._colorFormat!==t&&(this._colorFormat=t)}_setDepthTextureFormat(e){this._cacheRenderPipeline.setDepthStencilFormat(e.depthTextureFormat),this._depthTextureFormat!==e.depthTextureFormat&&(this._depthTextureFormat=e.depthTextureFormat)}setDitheringState(){}setRasterizerState(){}_executeWhenRenderingStateIsCompiled(e,t){t()}bindSamplers(){}_getUnpackAlignement(){return 1}_bindTextureDirectly(){return!1}setStateCullFaceType(e,t=!1){const i=this.cullBackFaces??e??!0?1:2;(this._depthCullingState.cullFace!==i||t)&&(this._depthCullingState.cullFace=i)}setState(e,t=0,i,s=!1,r,a,o=0){(this._depthCullingState.cull!==e||i)&&(this._depthCullingState.cull=e),this.setStateCullFaceType(r,i),this.setZOffset(t),this.setZOffsetUnits(o);const l=s?this._currentRenderTarget?1:2:this._currentRenderTarget?2:1;(this._depthCullingState.frontFace!==l||i)&&(this._depthCullingState.frontFace=l),this._stencilStateComposer.stencilMaterial=a}_applyRenderPassChanges(e){const t=this._stencilStateComposer.enabled?this._mustUpdateStencilRef():!1,i=this._alphaState.alphaBlend?this._mustUpdateBlendColor():!1;this._mustUpdateViewport()&&this._applyViewport(e),this._mustUpdateScissor()&&this._applyScissor(e),t&&this._applyStencilRef(e),i&&this._applyBlendColor(e)}_draw(e,t,i,s,r){var g;const a=this._getCurrentRenderPass(),o=this._bundleList;this.applyStates();const l=this._currentEffect._pipelineContext;if(this.bindUniformBufferBase(this._currentRenderTarget?this._ubInvertY:this._ubDontInvertY,0,Mt.InternalsUBOName),l.uniformBuffer&&(l.uniformBuffer.update(),this.bindUniformBufferBase(l.uniformBuffer.getBuffer(),0,Mt.LeftOvertUBOName)),this._snapshotRendering.play){this._reportDrawCall();return}!this.compatibilityMode&&(this._currentDrawContext.isDirty(this._currentMaterialContext.updateId)||this._currentMaterialContext.isDirty||this._currentMaterialContext.forceBindGroupCreation)&&(this._currentDrawContext.fastBundle=void 0);const h=!this.compatibilityMode&&this._currentDrawContext.fastBundle;let u=a;if(h||this._snapshotRendering.record){if(this._applyRenderPassChanges(o),!this._snapshotRendering.record){this._counters.numBundleReuseNonCompatMode++,this._currentDrawContext.indirectDrawBuffer&&this._currentDrawContext.setIndirectData(s,r||1,i),o.addBundle(this._currentDrawContext.fastBundle),this._reportDrawCall();return}u=o.getBundleEncoder(this._cacheRenderPipeline.colorFormats,this._depthTextureFormat,this.currentSampleCount),o.numDrawCalls++}let c=0;if(this._currentMaterialContext.hasFloatOrDepthTextures){let m=1;for(let v=0;v<l.shaderProcessingContext.textureNames.length;++v){const T=l.shaderProcessingContext.textureNames[v],A=(g=this._currentMaterialContext.textures[T])==null?void 0:g.texture,b=A&&A.format>=13&&A.format<=18;((A==null?void 0:A.type)===1&&!this._caps.textureFloatLinearFiltering||b)&&(c|=m),m=m<<1}}this._currentMaterialContext.textureState=c;const f=this._cacheRenderPipeline.getRenderPipeline(t,this._currentEffect,this.currentSampleCount,c),d=this._cacheBindGroups.getBindGroups(l,this._currentDrawContext,this._currentMaterialContext);this._snapshotRendering.record||(this._applyRenderPassChanges(this.compatibilityMode?null:o),this.compatibilityMode||(this._counters.numBundleCreationNonCompatMode++,u=this._device.createRenderBundleEncoder({colorFormats:this._cacheRenderPipeline.colorFormats,depthStencilFormat:this._depthTextureFormat,sampleCount:We.GetSample(this.currentSampleCount)}))),u.setPipeline(f),this._currentIndexBuffer&&u.setIndexBuffer(this._currentIndexBuffer.underlyingResource,this._currentIndexBuffer.is32Bits?"uint32":"uint16",0);const _=this._cacheRenderPipeline.vertexBuffers;for(let m=0;m<_.length;m++){const v=_[m],T=v.effectiveBuffer;T&&u.setVertexBuffer(m,T.underlyingResource,v._validOffsetRange?0:v.byteOffset)}for(let m=0;m<d.length;m++)u.setBindGroup(m,d[m]);const p=!this.compatibilityMode&&!this._snapshotRendering.record;p&&this._currentDrawContext.indirectDrawBuffer?(this._currentDrawContext.setIndirectData(s,r||1,i),e===0?u.drawIndexedIndirect(this._currentDrawContext.indirectDrawBuffer,0):u.drawIndirect(this._currentDrawContext.indirectDrawBuffer,0)):e===0?u.drawIndexed(s,r||1,i,0,0):u.draw(s,r||1,i,0),p&&(this._currentDrawContext.fastBundle=u.finish(),o.addBundle(this._currentDrawContext.fastBundle)),this._reportDrawCall()}drawElementsType(e,t,i,s=1){this._draw(0,e,t,i,s)}drawArraysType(e,t,i,s=1){this._currentIndexBuffer=null,this._draw(1,e,t,i,s)}dispose(){var e,t;this._isDisposed=!0,this.hideLoadingUI(),this._timestampQuery.dispose(),(e=this._mainTexture)==null||e.destroy(),(t=this._depthTexture)==null||t.destroy(),this._textureHelper.destroyDeferredTextures(),this._bufferManager.destroyDeferredBuffers(),this._device.destroy(),Sv(this,this._renderingCanvas),super.dispose()}getRenderWidth(e=!1){var t;return!e&&this._currentRenderTarget?this._currentRenderTarget.width:((t=this._renderingCanvas)==null?void 0:t.width)??0}getRenderHeight(e=!1){var t;return!e&&this._currentRenderTarget?this._currentRenderTarget.height:((t=this._renderingCanvas)==null?void 0:t.height)??0}getError(){return 0}createExternalTexture(e){return new NA(e)}setExternalTexture(e,t){if(!t){this._currentMaterialContext.setTexture(e,null);return}this._setInternalTexture(e,t)}setTextureSampler(e,t){var i;(i=this._currentMaterialContext)==null||i.setSampler(e,t)}createStorageBuffer(e,t,i){return this._createBuffer(e,t|32,i)}updateStorageBuffer(e,t,i,s){const r=e;i===void 0&&(i=0);let a;s===void 0?(t instanceof Array?a=new Float32Array(t):t instanceof ArrayBuffer?a=new Uint8Array(t):a=t,s=a.byteLength):t instanceof Array?a=new Float32Array(t):t instanceof ArrayBuffer?a=new Uint8Array(t):a=t,this._bufferManager.setSubData(r,i,a,0,s)}_readFromGPUBuffer(e,t,i,s){return new Promise((r,a)=>{const o=()=>{e.mapAsync(1,0,t).then(()=>{const l=e.getMappedRange(0,t);let h=i;if(h===void 0)h=new Uint8Array(t),h.set(new Uint8Array(l));else{const u=h.constructor;h=new u(h.buffer),h.set(new u(l))}e.unmap(),this._bufferManager.releaseBuffer(e),r(h)},l=>{this.isDisposed?r(new Uint8Array):a(l)})};s?(this.flushFramebuffer(),o()):this.onEndFrameObservable.addOnce(()=>{o()})})}readFromStorageBuffer(e,t,i,s,r){i=i||e.capacity;const a=this._bufferManager.createRawBuffer(i,Xe.MapRead|Xe.CopyDst,void 0,"TempReadFromStorageBuffer");return this._renderEncoder.copyBufferToBuffer(e.underlyingResource,t??0,a,0,i),this._readFromGPUBuffer(a,i,s,r)}readFromMultipleStorageBuffers(e,t,i,s,r){i=i||e[0].capacity;const a=this._bufferManager.createRawBuffer(i*e.length,Xe.MapRead|Xe.CopyDst,void 0,"TempReadFromMultipleStorageBuffers");for(let o=0;o<e.length;o++)this._renderEncoder.copyBufferToBuffer(e[o].underlyingResource,t??0,a,o*i,i);return this._readFromGPUBuffer(a,i*e.length,s,r)}setStorageBuffer(e,t){var i;(i=this._currentDrawContext)==null||i.setBuffer(e,(t==null?void 0:t.getBuffer())??null)}}je._GlslangDefaultOptions={jsPath:`${Z._DefaultCdnUrl}/glslang/glslang.js`,wasmPath:`${Z._DefaultCdnUrl}/glslang/glslang.wasm`};je._InstanceId=0;class Ig{constructor(){this._count=0,this._data={}}copyFrom(e){this.clear(),e.forEach((t,i)=>this.add(t,i))}get(e){const t=this._data[e];if(t!==void 0)return t}getOrAddWithFactory(e,t){let i=this.get(e);return i!==void 0||(i=t(e),i&&this.add(e,i)),i}getOrAdd(e,t){const i=this.get(e);return i!==void 0?i:(this.add(e,t),t)}contains(e){return this._data[e]!==void 0}add(e,t){return this._data[e]!==void 0?!1:(this._data[e]=t,++this._count,!0)}set(e,t){return this._data[e]===void 0?!1:(this._data[e]=t,!0)}getAndRemove(e){const t=this.get(e);return t!==void 0?(delete this._data[e],--this._count,t):null}remove(e){return this.contains(e)?(delete this._data[e],--this._count,!0):!1}clear(){this._data={},this._count=0}get count(){return this._count}forEach(e){for(const t in this._data){const i=this._data[t];e(t,i)}}first(e){for(const t in this._data){const i=this._data[t],s=e(t,i);if(s)return s}return null}}function Gv(n){n.push("vCameraColorCurveNeutral","vCameraColorCurvePositive","vCameraColorCurveNegative")}class ut{constructor(){this._dirty=!0,this._tempColor=new K(0,0,0,0),this._globalCurve=new K(0,0,0,0),this._highlightsCurve=new K(0,0,0,0),this._midtonesCurve=new K(0,0,0,0),this._shadowsCurve=new K(0,0,0,0),this._positiveCurve=new K(0,0,0,0),this._negativeCurve=new K(0,0,0,0),this._globalHue=30,this._globalDensity=0,this._globalSaturation=0,this._globalExposure=0,this._highlightsHue=30,this._highlightsDensity=0,this._highlightsSaturation=0,this._highlightsExposure=0,this._midtonesHue=30,this._midtonesDensity=0,this._midtonesSaturation=0,this._midtonesExposure=0,this._shadowsHue=30,this._shadowsDensity=0,this._shadowsSaturation=0,this._shadowsExposure=0}get globalHue(){return this._globalHue}set globalHue(e){this._globalHue=e,this._dirty=!0}get globalDensity(){return this._globalDensity}set globalDensity(e){this._globalDensity=e,this._dirty=!0}get globalSaturation(){return this._globalSaturation}set globalSaturation(e){this._globalSaturation=e,this._dirty=!0}get globalExposure(){return this._globalExposure}set globalExposure(e){this._globalExposure=e,this._dirty=!0}get highlightsHue(){return this._highlightsHue}set highlightsHue(e){this._highlightsHue=e,this._dirty=!0}get highlightsDensity(){return this._highlightsDensity}set highlightsDensity(e){this._highlightsDensity=e,this._dirty=!0}get highlightsSaturation(){return this._highlightsSaturation}set highlightsSaturation(e){this._highlightsSaturation=e,this._dirty=!0}get highlightsExposure(){return this._highlightsExposure}set highlightsExposure(e){this._highlightsExposure=e,this._dirty=!0}get midtonesHue(){return this._midtonesHue}set midtonesHue(e){this._midtonesHue=e,this._dirty=!0}get midtonesDensity(){return this._midtonesDensity}set midtonesDensity(e){this._midtonesDensity=e,this._dirty=!0}get midtonesSaturation(){return this._midtonesSaturation}set midtonesSaturation(e){this._midtonesSaturation=e,this._dirty=!0}get midtonesExposure(){return this._midtonesExposure}set midtonesExposure(e){this._midtonesExposure=e,this._dirty=!0}get shadowsHue(){return this._shadowsHue}set shadowsHue(e){this._shadowsHue=e,this._dirty=!0}get shadowsDensity(){return this._shadowsDensity}set shadowsDensity(e){this._shadowsDensity=e,this._dirty=!0}get shadowsSaturation(){return this._shadowsSaturation}set shadowsSaturation(e){this._shadowsSaturation=e,this._dirty=!0}get shadowsExposure(){return this._shadowsExposure}set shadowsExposure(e){this._shadowsExposure=e,this._dirty=!0}getClassName(){return"ColorCurves"}static Bind(e,t,i="vCameraColorCurvePositive",s="vCameraColorCurveNeutral",r="vCameraColorCurveNegative"){e._dirty&&(e._dirty=!1,e._getColorGradingDataToRef(e._globalHue,e._globalDensity,e._globalSaturation,e._globalExposure,e._globalCurve),e._getColorGradingDataToRef(e._highlightsHue,e._highlightsDensity,e._highlightsSaturation,e._highlightsExposure,e._tempColor),e._tempColor.multiplyToRef(e._globalCurve,e._highlightsCurve),e._getColorGradingDataToRef(e._midtonesHue,e._midtonesDensity,e._midtonesSaturation,e._midtonesExposure,e._tempColor),e._tempColor.multiplyToRef(e._globalCurve,e._midtonesCurve),e._getColorGradingDataToRef(e._shadowsHue,e._shadowsDensity,e._shadowsSaturation,e._shadowsExposure,e._tempColor),e._tempColor.multiplyToRef(e._globalCurve,e._shadowsCurve),e._highlightsCurve.subtractToRef(e._midtonesCurve,e._positiveCurve),e._midtonesCurve.subtractToRef(e._shadowsCurve,e._negativeCurve)),t&&(t.setFloat4(i,e._positiveCurve.r,e._positiveCurve.g,e._positiveCurve.b,e._positiveCurve.a),t.setFloat4(s,e._midtonesCurve.r,e._midtonesCurve.g,e._midtonesCurve.b,e._midtonesCurve.a),t.setFloat4(r,e._negativeCurve.r,e._negativeCurve.g,e._negativeCurve.b,e._negativeCurve.a))}_getColorGradingDataToRef(e,t,i,s,r){e!=null&&(e=ut._Clamp(e,0,360),t=ut._Clamp(t,-100,100),i=ut._Clamp(i,-100,100),s=ut._Clamp(s,-100,100),t=ut._ApplyColorGradingSliderNonlinear(t),t*=.5,s=ut._ApplyColorGradingSliderNonlinear(s),t<0&&(t*=-1,e=(e+180)%360),ut._FromHSBToRef(e,t,50+.25*s,r),r.scaleToRef(2,r),r.a=1+.01*i)}static _ApplyColorGradingSliderNonlinear(e){e/=100;let t=Math.abs(e);return t=Math.pow(t,2),e<0&&(t*=-1),t*=100,t}static _FromHSBToRef(e,t,i,s){let r=ut._Clamp(e,0,360);const a=ut._Clamp(t/100,0,1),o=ut._Clamp(i/100,0,1);if(a===0)s.r=o,s.g=o,s.b=o;else{r/=60;const l=Math.floor(r),h=r-l,u=o*(1-a),c=o*(1-a*h),f=o*(1-a*(1-h));switch(l){case 0:s.r=o,s.g=f,s.b=u;break;case 1:s.r=c,s.g=o,s.b=u;break;case 2:s.r=u,s.g=o,s.b=f;break;case 3:s.r=u,s.g=c,s.b=o;break;case 4:s.r=f,s.g=u,s.b=o;break;default:s.r=o,s.g=u,s.b=c;break}}s.a=1}static _Clamp(e,t,i){return Math.min(Math.max(e,t),i)}clone(){return Ie.Clone(()=>new ut,this)}serialize(){return Ie.Serialize(this)}static Parse(e){return Ie.Parse(()=>new ut,e,null,null)}}ut.PrepareUniforms=Gv;P([B()],ut.prototype,"_globalHue",void 0);P([B()],ut.prototype,"_globalDensity",void 0);P([B()],ut.prototype,"_globalSaturation",void 0);P([B()],ut.prototype,"_globalExposure",void 0);P([B()],ut.prototype,"_highlightsHue",void 0);P([B()],ut.prototype,"_highlightsDensity",void 0);P([B()],ut.prototype,"_highlightsSaturation",void 0);P([B()],ut.prototype,"_highlightsExposure",void 0);P([B()],ut.prototype,"_midtonesHue",void 0);P([B()],ut.prototype,"_midtonesDensity",void 0);P([B()],ut.prototype,"_midtonesSaturation",void 0);P([B()],ut.prototype,"_midtonesExposure",void 0);Ie._ColorCurvesParser=ut.Parse;function QA(n,e){e.EXPOSURE&&n.push("exposureLinear"),e.CONTRAST&&n.push("contrast"),e.COLORGRADING&&n.push("colorTransformSettings"),(e.VIGNETTE||e.DITHER)&&n.push("vInverseScreenSize"),e.VIGNETTE&&(n.push("vignetteSettings1"),n.push("vignetteSettings2")),e.COLORCURVES&&Gv(n),e.DITHER&&n.push("ditherIntensity")}function JA(n,e){e.COLORGRADING&&n.push("txColorTransform")}class ke{constructor(){this.colorCurves=new ut,this._colorCurvesEnabled=!1,this._colorGradingEnabled=!1,this._colorGradingWithGreenDepth=!0,this._colorGradingBGR=!0,this._exposure=1,this._toneMappingEnabled=!1,this._toneMappingType=ke.TONEMAPPING_STANDARD,this._contrast=1,this.vignetteStretch=0,this.vignetteCenterX=0,this.vignetteCenterY=0,this.vignetteWeight=1.5,this.vignetteColor=new K(0,0,0,0),this.vignetteCameraFov=.5,this._vignetteBlendMode=ke.VIGNETTEMODE_MULTIPLY,this._vignetteEnabled=!1,this._ditheringEnabled=!1,this._ditheringIntensity=1/255,this._skipFinalColorClamp=!1,this._applyByPostProcess=!1,this._isEnabled=!0,this.onUpdateParameters=new q}get colorCurvesEnabled(){return this._colorCurvesEnabled}set colorCurvesEnabled(e){this._colorCurvesEnabled!==e&&(this._colorCurvesEnabled=e,this._updateParameters())}get colorGradingTexture(){return this._colorGradingTexture}set colorGradingTexture(e){this._colorGradingTexture!==e&&(this._colorGradingTexture=e,this._updateParameters())}get colorGradingEnabled(){return this._colorGradingEnabled}set colorGradingEnabled(e){this._colorGradingEnabled!==e&&(this._colorGradingEnabled=e,this._updateParameters())}get colorGradingWithGreenDepth(){return this._colorGradingWithGreenDepth}set colorGradingWithGreenDepth(e){this._colorGradingWithGreenDepth!==e&&(this._colorGradingWithGreenDepth=e,this._updateParameters())}get colorGradingBGR(){return this._colorGradingBGR}set colorGradingBGR(e){this._colorGradingBGR!==e&&(this._colorGradingBGR=e,this._updateParameters())}get exposure(){return this._exposure}set exposure(e){this._exposure!==e&&(this._exposure=e,this._updateParameters())}get toneMappingEnabled(){return this._toneMappingEnabled}set toneMappingEnabled(e){this._toneMappingEnabled!==e&&(this._toneMappingEnabled=e,this._updateParameters())}get toneMappingType(){return this._toneMappingType}set toneMappingType(e){this._toneMappingType!==e&&(this._toneMappingType=e,this._updateParameters())}get contrast(){return this._contrast}set contrast(e){this._contrast!==e&&(this._contrast=e,this._updateParameters())}get vignetteCentreY(){return this.vignetteCenterY}set vignetteCentreY(e){this.vignetteCenterY=e}get vignetteCentreX(){return this.vignetteCenterX}set vignetteCentreX(e){this.vignetteCenterX=e}get vignetteBlendMode(){return this._vignetteBlendMode}set vignetteBlendMode(e){this._vignetteBlendMode!==e&&(this._vignetteBlendMode=e,this._updateParameters())}get vignetteEnabled(){return this._vignetteEnabled}set vignetteEnabled(e){this._vignetteEnabled!==e&&(this._vignetteEnabled=e,this._updateParameters())}get ditheringEnabled(){return this._ditheringEnabled}set ditheringEnabled(e){this._ditheringEnabled!==e&&(this._ditheringEnabled=e,this._updateParameters())}get ditheringIntensity(){return this._ditheringIntensity}set ditheringIntensity(e){this._ditheringIntensity!==e&&(this._ditheringIntensity=e,this._updateParameters())}get skipFinalColorClamp(){return this._skipFinalColorClamp}set skipFinalColorClamp(e){this._skipFinalColorClamp!==e&&(this._skipFinalColorClamp=e,this._updateParameters())}get applyByPostProcess(){return this._applyByPostProcess}set applyByPostProcess(e){this._applyByPostProcess!==e&&(this._applyByPostProcess=e,this._updateParameters())}get isEnabled(){return this._isEnabled}set isEnabled(e){this._isEnabled!==e&&(this._isEnabled=e,this._updateParameters())}_updateParameters(){this.onUpdateParameters.notifyObservers(this)}getClassName(){return"ImageProcessingConfiguration"}prepareDefines(e,t=!1){if(t!==this.applyByPostProcess||!this._isEnabled){e.VIGNETTE=!1,e.TONEMAPPING=0,e.CONTRAST=!1,e.EXPOSURE=!1,e.COLORCURVES=!1,e.COLORGRADING=!1,e.COLORGRADING3D=!1,e.DITHER=!1,e.IMAGEPROCESSING=!1,e.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,e.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess&&this._isEnabled;return}if(e.VIGNETTE=this.vignetteEnabled,e.VIGNETTEBLENDMODEMULTIPLY=this.vignetteBlendMode===ke._VIGNETTEMODE_MULTIPLY,e.VIGNETTEBLENDMODEOPAQUE=!e.VIGNETTEBLENDMODEMULTIPLY,!this._toneMappingEnabled)e.TONEMAPPING=0;else switch(this._toneMappingType){case ke.TONEMAPPING_KHR_PBR_NEUTRAL:e.TONEMAPPING=3;break;case ke.TONEMAPPING_ACES:e.TONEMAPPING=2;break;default:e.TONEMAPPING=1;break}e.CONTRAST=this.contrast!==1,e.EXPOSURE=this.exposure!==1,e.COLORCURVES=this.colorCurvesEnabled&&!!this.colorCurves,e.COLORGRADING=this.colorGradingEnabled&&!!this.colorGradingTexture,e.COLORGRADING?e.COLORGRADING3D=this.colorGradingTexture.is3D:e.COLORGRADING3D=!1,e.SAMPLER3DGREENDEPTH=this.colorGradingWithGreenDepth,e.SAMPLER3DBGRMAP=this.colorGradingBGR,e.DITHER=this._ditheringEnabled,e.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess,e.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,e.IMAGEPROCESSING=e.VIGNETTE||!!e.TONEMAPPING||e.CONTRAST||e.EXPOSURE||e.COLORCURVES||e.COLORGRADING||e.DITHER}isReady(){return!this.colorGradingEnabled||!this.colorGradingTexture||this.colorGradingTexture.isReady()}bind(e,t){if(this._colorCurvesEnabled&&this.colorCurves&&ut.Bind(this.colorCurves,e),this._vignetteEnabled||this._ditheringEnabled){const i=1/e.getEngine().getRenderWidth(),s=1/e.getEngine().getRenderHeight();if(e.setFloat2("vInverseScreenSize",i,s),this._ditheringEnabled&&e.setFloat("ditherIntensity",.5*this._ditheringIntensity),this._vignetteEnabled){const r=t??s/i;let a=Math.tan(this.vignetteCameraFov*.5),o=a*r;const l=Math.sqrt(o*a);o=Cc(o,l,this.vignetteStretch),a=Cc(a,l,this.vignetteStretch),e.setFloat4("vignetteSettings1",o,a,-o*this.vignetteCenterX,-a*this.vignetteCenterY);const h=-2*this.vignetteWeight;e.setFloat4("vignetteSettings2",this.vignetteColor.r,this.vignetteColor.g,this.vignetteColor.b,h)}}if(e.setFloat("exposureLinear",this.exposure),e.setFloat("contrast",this.contrast),this.colorGradingTexture){e.setTexture("txColorTransform",this.colorGradingTexture);const i=this.colorGradingTexture.getSize().height;e.setFloat4("colorTransformSettings",(i-1)/i,.5/i,i,this.colorGradingTexture.level)}}clone(){return Ie.Clone(()=>new ke,this)}serialize(){return Ie.Serialize(this)}static Parse(e){const t=Ie.Parse(()=>new ke,e,null,null);return e.vignetteCentreX!==void 0&&(t.vignetteCenterX=e.vignetteCentreX),e.vignetteCentreY!==void 0&&(t.vignetteCenterY=e.vignetteCentreY),t}static get VIGNETTEMODE_MULTIPLY(){return this._VIGNETTEMODE_MULTIPLY}static get VIGNETTEMODE_OPAQUE(){return this._VIGNETTEMODE_OPAQUE}}ke.TONEMAPPING_STANDARD=0;ke.TONEMAPPING_ACES=1;ke.TONEMAPPING_KHR_PBR_NEUTRAL=2;ke.PrepareUniforms=QA;ke.PrepareSamplers=JA;ke._VIGNETTEMODE_MULTIPLY=0;ke._VIGNETTEMODE_OPAQUE=1;P([x4()],ke.prototype,"colorCurves",void 0);P([B()],ke.prototype,"_colorCurvesEnabled",void 0);P([Zi("colorGradingTexture")],ke.prototype,"_colorGradingTexture",void 0);P([B()],ke.prototype,"_colorGradingEnabled",void 0);P([B()],ke.prototype,"_colorGradingWithGreenDepth",void 0);P([B()],ke.prototype,"_colorGradingBGR",void 0);P([B()],ke.prototype,"_exposure",void 0);P([B()],ke.prototype,"_toneMappingEnabled",void 0);P([B()],ke.prototype,"_toneMappingType",void 0);P([B()],ke.prototype,"_contrast",void 0);P([B()],ke.prototype,"vignetteStretch",void 0);P([B()],ke.prototype,"vignetteCenterX",void 0);P([B()],ke.prototype,"vignetteCenterY",void 0);P([B()],ke.prototype,"vignetteWeight",void 0);P([sd()],ke.prototype,"vignetteColor",void 0);P([B()],ke.prototype,"vignetteCameraFov",void 0);P([B()],ke.prototype,"_vignetteBlendMode",void 0);P([B()],ke.prototype,"_vignetteEnabled",void 0);P([B()],ke.prototype,"_ditheringEnabled",void 0);P([B()],ke.prototype,"_ditheringIntensity",void 0);P([B()],ke.prototype,"_skipFinalColorClamp",void 0);P([B()],ke.prototype,"_applyByPostProcess",void 0);P([B()],ke.prototype,"_isEnabled",void 0);Ie._ImageProcessingConfigurationParser=ke.Parse;Tt("BABYLON.ImageProcessingConfiguration",ke);class Xt{constructor(e,t,i,s,r,a){this.source=e,this.pointerX=t,this.pointerY=i,this.meshUnderPointer=s,this.sourceEvent=r,this.additionalData=a}static CreateNew(e,t,i){const s=e.getScene();return new Xt(e,s.pointerX,s.pointerY,s.meshUnderPointer||e,t,i)}static CreateNewFromSprite(e,t,i,s){return new Xt(e,t.pointerX,t.pointerY,t.meshUnderPointer,i,s)}static CreateNewFromScene(e,t){return new Xt(null,e.pointerX,e.pointerY,e.meshUnderPointer,t)}static CreateNewFromPrimitive(e,t,i,s){return new Xt(e,t.x,t.y,null,i,s)}}class Me{}Me.NAME_EFFECTLAYER="EffectLayer";Me.NAME_LAYER="Layer";Me.NAME_LENSFLARESYSTEM="LensFlareSystem";Me.NAME_BOUNDINGBOXRENDERER="BoundingBoxRenderer";Me.NAME_PARTICLESYSTEM="ParticleSystem";Me.NAME_GAMEPAD="Gamepad";Me.NAME_SIMPLIFICATIONQUEUE="SimplificationQueue";Me.NAME_GEOMETRYBUFFERRENDERER="GeometryBufferRenderer";Me.NAME_PREPASSRENDERER="PrePassRenderer";Me.NAME_DEPTHRENDERER="DepthRenderer";Me.NAME_DEPTHPEELINGRENDERER="DepthPeelingRenderer";Me.NAME_POSTPROCESSRENDERPIPELINEMANAGER="PostProcessRenderPipelineManager";Me.NAME_SPRITE="Sprite";Me.NAME_SUBSURFACE="SubSurface";Me.NAME_OUTLINERENDERER="Outline";Me.NAME_PROCEDURALTEXTURE="ProceduralTexture";Me.NAME_SHADOWGENERATOR="ShadowGenerator";Me.NAME_OCTREE="Octree";Me.NAME_PHYSICSENGINE="PhysicsEngine";Me.NAME_AUDIO="Audio";Me.NAME_FLUIDRENDERER="FluidRenderer";Me.NAME_IBLCDFGENERATOR="iblCDFGenerator";Me.STEP_ISREADYFORMESH_EFFECTLAYER=0;Me.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER=0;Me.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER=0;Me.STEP_PREACTIVEMESH_BOUNDINGBOXRENDERER=0;Me.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER=1;Me.STEP_BEFORECAMERADRAW_PREPASS=0;Me.STEP_BEFORECAMERADRAW_EFFECTLAYER=1;Me.STEP_BEFORECAMERADRAW_LAYER=2;Me.STEP_BEFORERENDERTARGETDRAW_PREPASS=0;Me.STEP_BEFORERENDERTARGETDRAW_LAYER=1;Me.STEP_BEFORERENDERINGMESH_PREPASS=0;Me.STEP_BEFORERENDERINGMESH_OUTLINE=1;Me.STEP_AFTERRENDERINGMESH_PREPASS=0;Me.STEP_AFTERRENDERINGMESH_OUTLINE=1;Me.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW=0;Me.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER=1;Me.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE=0;Me.STEP_BEFORECLEAR_PROCEDURALTEXTURE=0;Me.STEP_BEFORECLEAR_PREPASS=1;Me.STEP_BEFORERENDERTARGETCLEAR_PREPASS=0;Me.STEP_AFTERRENDERTARGETDRAW_PREPASS=0;Me.STEP_AFTERRENDERTARGETDRAW_LAYER=1;Me.STEP_AFTERCAMERADRAW_PREPASS=0;Me.STEP_AFTERCAMERADRAW_EFFECTLAYER=1;Me.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM=2;Me.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW=3;Me.STEP_AFTERCAMERADRAW_LAYER=4;Me.STEP_AFTERCAMERADRAW_FLUIDRENDERER=5;Me.STEP_AFTERCAMERAPOSTPROCESS_LAYER=0;Me.STEP_AFTERRENDERTARGETPOSTPROCESS_LAYER=0;Me.STEP_AFTERRENDER_AUDIO=0;Me.STEP_GATHERRENDERTARGETS_DEPTHRENDERER=0;Me.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER=1;Me.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR=2;Me.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER=3;Me.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER=0;Me.STEP_GATHERACTIVECAMERARENDERTARGETS_FLUIDRENDERER=1;Me.STEP_POINTERMOVE_SPRITE=0;Me.STEP_POINTERDOWN_SPRITE=0;Me.STEP_POINTERUP_SPRITE=0;class vt extends Array{constructor(e){super(...e)}static Create(){return Object.create(vt.prototype)}registerStep(e,t,i){let s=0,r=Number.MAX_VALUE;for(;s<this.length&&(r=this[s].index,!(e<r));s++);this.splice(s,0,{index:e,component:t,action:i.bind(t)})}clear(){this.length=0}}class we{}we.POINTERDOWN=1;we.POINTERUP=2;we.POINTERMOVE=4;we.POINTERWHEEL=8;we.POINTERPICK=16;we.POINTERTAP=32;we.POINTERDOUBLETAP=64;class zv{constructor(e,t){this.type=e,this.event=t}}class eE extends zv{constructor(e,t,i,s){super(e,t),this.ray=null,this.originalPickingInfo=null,this.skipOnPointerObservable=!1,this.localPosition=new ne(i,s)}}class nn extends zv{get pickInfo(){return this._pickInfo||this._generatePickInfo(),this._pickInfo}constructor(e,t,i,s=null){super(e,t),this._pickInfo=i,this._inputManager=s}_generatePickInfo(){this._inputManager&&(this._pickInfo=this._inputManager._pickMove(this.event),this._inputManager._setRayOnPointerInfo(this._pickInfo,this.event),this._inputManager=null)}}class Gi{constructor(){this.hoverCursor="",this.actions=[],this.isRecursive=!1,this.disposeWhenUnowned=!0}static get HasTriggers(){for(const e in Gi.Triggers)if(Object.prototype.hasOwnProperty.call(Gi.Triggers,e))return!0;return!1}static get HasPickTriggers(){for(const e in Gi.Triggers)if(Object.prototype.hasOwnProperty.call(Gi.Triggers,e)){const t=parseInt(e);if(t>=1&&t<=7)return!0}return!1}static HasSpecificTrigger(e){for(const t in Gi.Triggers)if(Object.prototype.hasOwnProperty.call(Gi.Triggers,t)&&parseInt(t)===e)return!0;return!1}}Gi.Triggers={};class Yo{}Yo.KEYDOWN=1;Yo.KEYUP=2;class kc{constructor(e,t){this.type=e,this.event=t}}class Cg extends kc{get skipOnPointerObservable(){return this.skipOnKeyboardObservable}set skipOnPointerObservable(e){this.skipOnKeyboardObservable=e}constructor(e,t){super(e,t),this.type=e,this.event=t,this.skipOnKeyboardObservable=!1}}var ve;(function(n){n[n.Generic=0]="Generic",n[n.Keyboard=1]="Keyboard",n[n.Mouse=2]="Mouse",n[n.Touch=3]="Touch",n[n.DualShock=4]="DualShock",n[n.Xbox=5]="Xbox",n[n.Switch=6]="Switch",n[n.DualSense=7]="DualSense"})(ve||(ve={}));var Te;(function(n){n[n.Horizontal=0]="Horizontal",n[n.Vertical=1]="Vertical",n[n.LeftClick=2]="LeftClick",n[n.MiddleClick=3]="MiddleClick",n[n.RightClick=4]="RightClick",n[n.BrowserBack=5]="BrowserBack",n[n.BrowserForward=6]="BrowserForward",n[n.MouseWheelX=7]="MouseWheelX",n[n.MouseWheelY=8]="MouseWheelY",n[n.MouseWheelZ=9]="MouseWheelZ",n[n.Move=12]="Move"})(Te||(Te={}));var Mg;(function(n){n[n.Horizontal=0]="Horizontal",n[n.Vertical=1]="Vertical",n[n.LeftClick=2]="LeftClick",n[n.MiddleClick=3]="MiddleClick",n[n.RightClick=4]="RightClick",n[n.BrowserBack=5]="BrowserBack",n[n.BrowserForward=6]="BrowserForward",n[n.MouseWheelX=7]="MouseWheelX",n[n.MouseWheelY=8]="MouseWheelY",n[n.MouseWheelZ=9]="MouseWheelZ",n[n.DeltaHorizontal=10]="DeltaHorizontal",n[n.DeltaVertical=11]="DeltaVertical"})(Mg||(Mg={}));var Pg;(function(n){n[n.Cross=0]="Cross",n[n.Circle=1]="Circle",n[n.Square=2]="Square",n[n.Triangle=3]="Triangle",n[n.L1=4]="L1",n[n.R1=5]="R1",n[n.L2=6]="L2",n[n.R2=7]="R2",n[n.Share=8]="Share",n[n.Options=9]="Options",n[n.L3=10]="L3",n[n.R3=11]="R3",n[n.DPadUp=12]="DPadUp",n[n.DPadDown=13]="DPadDown",n[n.DPadLeft=14]="DPadLeft",n[n.DPadRight=15]="DPadRight",n[n.Home=16]="Home",n[n.TouchPad=17]="TouchPad",n[n.LStickXAxis=18]="LStickXAxis",n[n.LStickYAxis=19]="LStickYAxis",n[n.RStickXAxis=20]="RStickXAxis",n[n.RStickYAxis=21]="RStickYAxis"})(Pg||(Pg={}));var wg;(function(n){n[n.Cross=0]="Cross",n[n.Circle=1]="Circle",n[n.Square=2]="Square",n[n.Triangle=3]="Triangle",n[n.L1=4]="L1",n[n.R1=5]="R1",n[n.L2=6]="L2",n[n.R2=7]="R2",n[n.Create=8]="Create",n[n.Options=9]="Options",n[n.L3=10]="L3",n[n.R3=11]="R3",n[n.DPadUp=12]="DPadUp",n[n.DPadDown=13]="DPadDown",n[n.DPadLeft=14]="DPadLeft",n[n.DPadRight=15]="DPadRight",n[n.Home=16]="Home",n[n.TouchPad=17]="TouchPad",n[n.LStickXAxis=18]="LStickXAxis",n[n.LStickYAxis=19]="LStickYAxis",n[n.RStickXAxis=20]="RStickXAxis",n[n.RStickYAxis=21]="RStickYAxis"})(wg||(wg={}));var Dg;(function(n){n[n.A=0]="A",n[n.B=1]="B",n[n.X=2]="X",n[n.Y=3]="Y",n[n.LB=4]="LB",n[n.RB=5]="RB",n[n.LT=6]="LT",n[n.RT=7]="RT",n[n.Back=8]="Back",n[n.Start=9]="Start",n[n.LS=10]="LS",n[n.RS=11]="RS",n[n.DPadUp=12]="DPadUp",n[n.DPadDown=13]="DPadDown",n[n.DPadLeft=14]="DPadLeft",n[n.DPadRight=15]="DPadRight",n[n.Home=16]="Home",n[n.LStickXAxis=17]="LStickXAxis",n[n.LStickYAxis=18]="LStickYAxis",n[n.RStickXAxis=19]="RStickXAxis",n[n.RStickYAxis=20]="RStickYAxis"})(Dg||(Dg={}));var Og;(function(n){n[n.B=0]="B",n[n.A=1]="A",n[n.Y=2]="Y",n[n.X=3]="X",n[n.L=4]="L",n[n.R=5]="R",n[n.ZL=6]="ZL",n[n.ZR=7]="ZR",n[n.Minus=8]="Minus",n[n.Plus=9]="Plus",n[n.LS=10]="LS",n[n.RS=11]="RS",n[n.DPadUp=12]="DPadUp",n[n.DPadDown=13]="DPadDown",n[n.DPadLeft=14]="DPadLeft",n[n.DPadRight=15]="DPadRight",n[n.Home=16]="Home",n[n.Capture=17]="Capture",n[n.LStickXAxis=18]="LStickXAxis",n[n.LStickYAxis=19]="LStickYAxis",n[n.RStickXAxis=20]="RStickXAxis",n[n.RStickYAxis=21]="RStickYAxis"})(Og||(Og={}));var Fg;(function(n){n[n.PointerMove=0]="PointerMove",n[n.PointerDown=1]="PointerDown",n[n.PointerUp=2]="PointerUp"})(Fg||(Fg={}));class u0{}u0.DOM_DELTA_PIXEL=0;u0.DOM_DELTA_LINE=1;u0.DOM_DELTA_PAGE=2;class fr{static CreateDeviceEvent(e,t,i,s,r,a,o){switch(e){case ve.Keyboard:return this._CreateKeyboardEvent(i,s,r,a);case ve.Mouse:if(i===Te.MouseWheelX||i===Te.MouseWheelY||i===Te.MouseWheelZ)return this._CreateWheelEvent(e,t,i,s,r,a);case ve.Touch:return this._CreatePointerEvent(e,t,i,s,r,a,o);default:throw`Unable to generate event for device ${ve[e]}`}}static _CreatePointerEvent(e,t,i,s,r,a,o){const l=this._CreateMouseEvent(e,t,i,s,r,a);e===ve.Mouse?(l.deviceType=ve.Mouse,l.pointerId=1,l.pointerType="mouse"):(l.deviceType=ve.Touch,l.pointerId=o??t,l.pointerType="touch");let h=0;return h+=r.pollInput(e,t,Te.LeftClick),h+=r.pollInput(e,t,Te.RightClick)*2,h+=r.pollInput(e,t,Te.MiddleClick)*4,l.buttons=h,i===Te.Move?l.type="pointermove":i>=Te.LeftClick&&i<=Te.RightClick&&(l.type=s===1?"pointerdown":"pointerup",l.button=i-2),l}static _CreateWheelEvent(e,t,i,s,r,a){const o=this._CreateMouseEvent(e,t,i,s,r,a);switch(o.pointerId=1,o.type="wheel",o.deltaMode=u0.DOM_DELTA_PIXEL,o.deltaX=0,o.deltaY=0,o.deltaZ=0,i){case Te.MouseWheelX:o.deltaX=s;break;case Te.MouseWheelY:o.deltaY=s;break;case Te.MouseWheelZ:o.deltaZ=s;break}return o}static _CreateMouseEvent(e,t,i,s,r,a){const o=this._CreateEvent(a),l=r.pollInput(e,t,Te.Horizontal),h=r.pollInput(e,t,Te.Vertical);return a?(o.movementX=0,o.movementY=0,o.offsetX=o.movementX-a.getBoundingClientRect().x,o.offsetY=o.movementY-a.getBoundingClientRect().y):(o.movementX=r.pollInput(e,t,10),o.movementY=r.pollInput(e,t,11),o.offsetX=0,o.offsetY=0),this._CheckNonCharacterKeys(o,r),o.clientX=l,o.clientY=h,o.x=l,o.y=h,o.deviceType=e,o.deviceSlot=t,o.inputIndex=i,o}static _CreateKeyboardEvent(e,t,i,s){const r=this._CreateEvent(s);return this._CheckNonCharacterKeys(r,i),r.deviceType=ve.Keyboard,r.deviceSlot=0,r.inputIndex=e,r.type=t===1?"keydown":"keyup",r.key=String.fromCharCode(e),r.keyCode=e,r}static _CheckNonCharacterKeys(e,t){const i=t.isDeviceAvailable(ve.Keyboard),s=i&&t.pollInput(ve.Keyboard,0,18)===1,r=i&&t.pollInput(ve.Keyboard,0,17)===1,a=i&&(t.pollInput(ve.Keyboard,0,91)===1||t.pollInput(ve.Keyboard,0,92)===1||t.pollInput(ve.Keyboard,0,93)===1),o=i&&t.pollInput(ve.Keyboard,0,16)===1;e.altKey=s,e.ctrlKey=r,e.metaKey=a,e.shiftKey=o}static _CreateEvent(e){const t={};return t.preventDefault=()=>{},t.target=e,t}}class tE{constructor(e,t,i){this._nativeInput=_native.DeviceInputSystem?new _native.DeviceInputSystem(e,t,(s,r,a,o)=>{const l=fr.CreateDeviceEvent(s,r,a,o,this);i(s,r,l)}):this._createDummyNativeInput()}pollInput(e,t,i){return this._nativeInput.pollInput(e,t,i)}isDeviceAvailable(e){return e===ve.Mouse||e===ve.Touch}dispose(){this._nativeInput.dispose()}_createDummyNativeInput(){return{pollInput:()=>0,isDeviceAvailable:()=>!1,dispose:()=>{}}}}const Lg=255,Bg=Object.keys(Te).length/2;class iE{constructor(e,t,i,s){this._inputs=[],this._keyboardActive=!1,this._pointerActive=!1,this._usingSafari=Z.IsSafari(),this._usingMacOS=ra()&&/(Mac|iPhone|iPod|iPad)/i.test(navigator.platform),this._keyboardDownEvent=r=>{},this._keyboardUpEvent=r=>{},this._keyboardBlurEvent=r=>{},this._pointerMoveEvent=r=>{},this._pointerDownEvent=r=>{},this._pointerUpEvent=r=>{},this._pointerCancelEvent=r=>{},this._pointerCancelTouch=r=>{},this._pointerLeaveEvent=r=>{},this._pointerWheelEvent=r=>{},this._pointerBlurEvent=r=>{},this._pointerMacOSChromeOutEvent=r=>{},this._eventsAttached=!1,this._mouseId=-1,this._isUsingFirefox=ra()&&navigator.userAgent&&navigator.userAgent.indexOf("Firefox")!==-1,this._isUsingChromium=ra()&&navigator.userAgent&&navigator.userAgent.indexOf("Chrome")!==-1,this._maxTouchPoints=0,this._pointerInputClearObserver=null,this._gamepadConnectedEvent=r=>{},this._gamepadDisconnectedEvent=r=>{},this._eventPrefix=Z.GetPointerPrefix(e),this._engine=e,this._onDeviceConnected=t,this._onDeviceDisconnected=i,this._onInputChanged=s,this._mouseId=this._isUsingFirefox?0:1,this._enableEvents(),this._usingMacOS&&(this._metaKeys=[]),this._engine._onEngineViewChanged||(this._engine._onEngineViewChanged=()=>{this._enableEvents()})}pollInput(e,t,i){const s=this._inputs[e][t];if(!s)throw`Unable to find device ${ve[e]}`;e>=ve.DualShock&&e<=ve.DualSense&&this._updateDevice(e,t,i);const r=s[i];if(r===void 0)throw`Unable to find input ${i} for device ${ve[e]} in slot ${t}`;return i===Te.Move&&Z.Warn("Unable to provide information for PointerInput.Move.  Try using PointerInput.Horizontal or PointerInput.Vertical for move data."),r}isDeviceAvailable(e){return this._inputs[e]!==void 0}dispose(){this._onDeviceConnected=()=>{},this._onDeviceDisconnected=()=>{},this._onInputChanged=()=>{},delete this._engine._onEngineViewChanged,this._elementToAttachTo&&this._disableEvents()}_enableEvents(){const e=this==null?void 0:this._engine.getInputElement();if(e&&(!this._eventsAttached||this._elementToAttachTo!==e)){if(this._disableEvents(),this._inputs){for(const t of this._inputs)if(t)for(const i in t){const s=+i,r=t[s];if(r)for(let a=0;a<r.length;a++)r[a]=0}}this._elementToAttachTo=e,this._elementToAttachTo.tabIndex=this._elementToAttachTo.tabIndex!==-1?this._elementToAttachTo.tabIndex:this._engine.canvasTabIndex,this._handleKeyActions(),this._handlePointerActions(),this._handleGamepadActions(),this._eventsAttached=!0,this._checkForConnectedDevices()}}_disableEvents(){this._elementToAttachTo&&(this._elementToAttachTo.removeEventListener("blur",this._keyboardBlurEvent),this._elementToAttachTo.removeEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.removeEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.removeEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"leave",this._pointerLeaveEvent),this._elementToAttachTo.removeEventListener(this._wheelEventName,this._pointerWheelEvent),this._usingMacOS&&this._isUsingChromium&&this._elementToAttachTo.removeEventListener("lostpointercapture",this._pointerMacOSChromeOutEvent),window.removeEventListener("gamepadconnected",this._gamepadConnectedEvent),window.removeEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)),this._pointerInputClearObserver&&this._engine.onEndFrameObservable.remove(this._pointerInputClearObserver),this._eventsAttached=!1}_checkForConnectedDevices(){if(navigator.getGamepads){const e=navigator.getGamepads();for(const t of e)t&&this._addGamePad(t)}typeof matchMedia=="function"&&matchMedia("(pointer:fine)").matches&&this._addPointerDevice(ve.Mouse,0,0,0)}_addGamePad(e){const t=this._getGamepadDeviceType(e.id),i=e.index;this._gamepads=this._gamepads||new Array(e.index+1),this._registerDevice(t,i,e.buttons.length+e.axes.length),this._gamepads[i]=t}_addPointerDevice(e,t,i,s){this._pointerActive||(this._pointerActive=!0),this._registerDevice(e,t,Bg);const r=this._inputs[e][t];r[0]=i,r[1]=s}_registerDevice(e,t,i){if(t===void 0)throw`Unable to register device ${ve[e]} to undefined slot.`;if(this._inputs[e]||(this._inputs[e]={}),!this._inputs[e][t]){const s=new Array(i);s.fill(0),this._inputs[e][t]=s,this._onDeviceConnected(e,t)}}_unregisterDevice(e,t){this._inputs[e][t]&&(delete this._inputs[e][t],this._onDeviceDisconnected(e,t))}_handleKeyActions(){this._keyboardDownEvent=e=>{this._keyboardActive||(this._keyboardActive=!0,this._registerDevice(ve.Keyboard,0,Lg));const t=this._inputs[ve.Keyboard][0];if(t){t[e.keyCode]=1;const i=e;i.inputIndex=e.keyCode,this._usingMacOS&&e.metaKey&&e.key!=="Meta"&&(this._metaKeys.includes(e.keyCode)||this._metaKeys.push(e.keyCode)),this._onInputChanged(ve.Keyboard,0,i)}},this._keyboardUpEvent=e=>{this._keyboardActive||(this._keyboardActive=!0,this._registerDevice(ve.Keyboard,0,Lg));const t=this._inputs[ve.Keyboard][0];if(t){t[e.keyCode]=0;const i=e;if(i.inputIndex=e.keyCode,this._usingMacOS&&e.key==="Meta"&&this._metaKeys.length>0){for(const s of this._metaKeys){const r=fr.CreateDeviceEvent(ve.Keyboard,0,s,0,this,this._elementToAttachTo);t[s]=0,this._onInputChanged(ve.Keyboard,0,r)}this._metaKeys.splice(0,this._metaKeys.length)}this._onInputChanged(ve.Keyboard,0,i)}},this._keyboardBlurEvent=()=>{if(this._keyboardActive){const e=this._inputs[ve.Keyboard][0];for(let t=0;t<e.length;t++)if(e[t]!==0){e[t]=0;const i=fr.CreateDeviceEvent(ve.Keyboard,0,t,0,this,this._elementToAttachTo);this._onInputChanged(ve.Keyboard,0,i)}this._usingMacOS&&this._metaKeys.splice(0,this._metaKeys.length)}},this._elementToAttachTo.addEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.addEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.addEventListener("blur",this._keyboardBlurEvent)}_handlePointerActions(){this._maxTouchPoints=ra()&&navigator.maxTouchPoints||2,this._activeTouchIds||(this._activeTouchIds=new Array(this._maxTouchPoints));for(let i=0;i<this._maxTouchPoints;i++)this._activeTouchIds[i]=-1;this._pointerMoveEvent=i=>{const s=this._getPointerType(i);let r=s===ve.Mouse?0:this._activeTouchIds.indexOf(i.pointerId);if(s===ve.Touch&&r===-1){const o=this._activeTouchIds.indexOf(-1);if(o>=0)r=o,this._activeTouchIds[o]=i.pointerId,this._onDeviceConnected(s,r);else{Z.Warn(`Max number of touches exceeded.  Ignoring touches in excess of ${this._maxTouchPoints}`);return}}this._inputs[s]||(this._inputs[s]={}),this._inputs[s][r]||this._addPointerDevice(s,r,i.clientX,i.clientY);const a=this._inputs[s][r];if(a){const o=i;o.inputIndex=Te.Move,a[Te.Horizontal]=i.clientX,a[Te.Vertical]=i.clientY,s===ve.Touch&&a[Te.LeftClick]===0&&(a[Te.LeftClick]=1),i.pointerId===void 0&&(i.pointerId=this._mouseId),this._onInputChanged(s,r,o),!this._usingSafari&&i.button!==-1&&(o.inputIndex=i.button+2,a[i.button+2]=a[i.button+2]?0:1,this._onInputChanged(s,r,o))}},this._pointerDownEvent=i=>{const s=this._getPointerType(i);let r=s===ve.Mouse?0:i.pointerId;if(s===ve.Touch){let o=this._activeTouchIds.indexOf(i.pointerId);if(o===-1&&(o=this._activeTouchIds.indexOf(-1)),o>=0)r=o,this._activeTouchIds[o]=i.pointerId;else{Z.Warn(`Max number of touches exceeded.  Ignoring touches in excess of ${this._maxTouchPoints}`);return}}this._inputs[s]||(this._inputs[s]={}),this._inputs[s][r]?s===ve.Touch&&this._onDeviceConnected(s,r):this._addPointerDevice(s,r,i.clientX,i.clientY);const a=this._inputs[s][r];if(a){const o=a[Te.Horizontal],l=a[Te.Vertical];if(s===ve.Mouse){if(i.pointerId===void 0&&(i.pointerId=this._mouseId),!document.pointerLockElement)try{this._elementToAttachTo.setPointerCapture(this._mouseId)}catch{}}else if(i.pointerId&&!document.pointerLockElement)try{this._elementToAttachTo.setPointerCapture(i.pointerId)}catch{}a[Te.Horizontal]=i.clientX,a[Te.Vertical]=i.clientY,a[i.button+2]=1;const h=i;h.inputIndex=i.button+2,this._onInputChanged(s,r,h),(o!==i.clientX||l!==i.clientY)&&(h.inputIndex=Te.Move,this._onInputChanged(s,r,h))}},this._pointerUpEvent=i=>{var h,u,c,f,d;const s=this._getPointerType(i),r=s===ve.Mouse?0:this._activeTouchIds.indexOf(i.pointerId);if(s===ve.Touch){if(r===-1)return;this._activeTouchIds[r]=-1}const a=(h=this._inputs[s])==null?void 0:h[r];let o=i.button,l=a&&a[o+2]!==0;if(!l&&this._isUsingFirefox&&this._usingMacOS&&a&&(o=o===2?0:2,l=a[o+2]!==0),l){const _=a[Te.Horizontal],p=a[Te.Vertical];a[Te.Horizontal]=i.clientX,a[Te.Vertical]=i.clientY,a[o+2]=0;const g=i;i.pointerId===void 0&&(i.pointerId=this._mouseId),(_!==i.clientX||p!==i.clientY)&&(g.inputIndex=Te.Move,this._onInputChanged(s,r,g)),g.inputIndex=o+2,s===ve.Mouse&&this._mouseId>=0&&((c=(u=this._elementToAttachTo).hasPointerCapture)!=null&&c.call(u,this._mouseId))?this._elementToAttachTo.releasePointerCapture(this._mouseId):i.pointerId&&((d=(f=this._elementToAttachTo).hasPointerCapture)!=null&&d.call(f,i.pointerId))&&this._elementToAttachTo.releasePointerCapture(i.pointerId),this._onInputChanged(s,r,g),s===ve.Touch&&this._onDeviceDisconnected(s,r)}},this._pointerCancelTouch=i=>{var a,o;const s=this._activeTouchIds.indexOf(i);if(s===-1)return;(o=(a=this._elementToAttachTo).hasPointerCapture)!=null&&o.call(a,i)&&this._elementToAttachTo.releasePointerCapture(i),this._inputs[ve.Touch][s][Te.LeftClick]=0;const r=fr.CreateDeviceEvent(ve.Touch,s,Te.LeftClick,0,this,this._elementToAttachTo,i);this._onInputChanged(ve.Touch,s,r),this._activeTouchIds[s]=-1,this._onDeviceDisconnected(ve.Touch,s)},this._pointerCancelEvent=i=>{var s,r;if(i.pointerType==="mouse"){const a=this._inputs[ve.Mouse][0];this._mouseId>=0&&((r=(s=this._elementToAttachTo).hasPointerCapture)!=null&&r.call(s,this._mouseId))&&this._elementToAttachTo.releasePointerCapture(this._mouseId);for(let o=Te.LeftClick;o<=Te.BrowserForward;o++)if(a[o]===1){a[o]=0;const l=fr.CreateDeviceEvent(ve.Mouse,0,o,0,this,this._elementToAttachTo);this._onInputChanged(ve.Mouse,0,l)}}else this._pointerCancelTouch(i.pointerId)},this._pointerLeaveEvent=i=>{i.pointerType==="pen"&&this._pointerCancelTouch(i.pointerId)},this._wheelEventName="onwheel"in document.createElement("div")?"wheel":document.onmousewheel!==void 0?"mousewheel":"DOMMouseScroll";let e=!1;const t=function(){};try{const i=Object.defineProperty({},"passive",{get:function(){e=!0}});this._elementToAttachTo.addEventListener("test",t,i),this._elementToAttachTo.removeEventListener("test",t,i)}catch{}this._pointerBlurEvent=()=>{var i,s,r,a,o;if(this.isDeviceAvailable(ve.Mouse)){const l=this._inputs[ve.Mouse][0];this._mouseId>=0&&((s=(i=this._elementToAttachTo).hasPointerCapture)!=null&&s.call(i,this._mouseId))&&this._elementToAttachTo.releasePointerCapture(this._mouseId);for(let h=Te.LeftClick;h<=Te.BrowserForward;h++)if(l[h]===1){l[h]=0;const u=fr.CreateDeviceEvent(ve.Mouse,0,h,0,this,this._elementToAttachTo);this._onInputChanged(ve.Mouse,0,u)}}if(this.isDeviceAvailable(ve.Touch)){const l=this._inputs[ve.Touch];for(let h=0;h<this._activeTouchIds.length;h++){const u=this._activeTouchIds[h];if((a=(r=this._elementToAttachTo).hasPointerCapture)!=null&&a.call(r,u)&&this._elementToAttachTo.releasePointerCapture(u),u!==-1&&((o=l[h])==null?void 0:o[Te.LeftClick])===1){l[h][Te.LeftClick]=0;const c=fr.CreateDeviceEvent(ve.Touch,h,Te.LeftClick,0,this,this._elementToAttachTo,u);this._onInputChanged(ve.Touch,h,c),this._activeTouchIds[h]=-1,this._onDeviceDisconnected(ve.Touch,h)}}}},this._pointerWheelEvent=i=>{const s=ve.Mouse,r=0;this._inputs[s]||(this._inputs[s]=[]),this._inputs[s][r]||(this._pointerActive=!0,this._registerDevice(s,r,Bg));const a=this._inputs[s][r];if(a){a[Te.MouseWheelX]=i.deltaX||0,a[Te.MouseWheelY]=i.deltaY||i.wheelDelta||0,a[Te.MouseWheelZ]=i.deltaZ||0;const o=i;i.pointerId===void 0&&(i.pointerId=this._mouseId),a[Te.MouseWheelX]!==0&&(o.inputIndex=Te.MouseWheelX,this._onInputChanged(s,r,o)),a[Te.MouseWheelY]!==0&&(o.inputIndex=Te.MouseWheelY,this._onInputChanged(s,r,o)),a[Te.MouseWheelZ]!==0&&(o.inputIndex=Te.MouseWheelZ,this._onInputChanged(s,r,o))}},this._usingMacOS&&this._isUsingChromium&&(this._pointerMacOSChromeOutEvent=i=>{i.buttons>1&&this._pointerCancelEvent(i)},this._elementToAttachTo.addEventListener("lostpointercapture",this._pointerMacOSChromeOutEvent)),this._elementToAttachTo.addEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"leave",this._pointerLeaveEvent),this._elementToAttachTo.addEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.addEventListener(this._wheelEventName,this._pointerWheelEvent,e?{passive:!1}:!1),this._pointerInputClearObserver=this._engine.onEndFrameObservable.add(()=>{if(this.isDeviceAvailable(ve.Mouse)){const i=this._inputs[ve.Mouse][0];i[Te.MouseWheelX]=0,i[Te.MouseWheelY]=0,i[Te.MouseWheelZ]=0}})}_handleGamepadActions(){this._gamepadConnectedEvent=e=>{this._addGamePad(e.gamepad)},this._gamepadDisconnectedEvent=e=>{if(this._gamepads){const t=this._getGamepadDeviceType(e.gamepad.id),i=e.gamepad.index;this._unregisterDevice(t,i),delete this._gamepads[i]}},window.addEventListener("gamepadconnected",this._gamepadConnectedEvent),window.addEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)}_updateDevice(e,t,i){const s=navigator.getGamepads()[t];if(s&&e===this._gamepads[t]){const r=this._inputs[e][t];i>=s.buttons.length?r[i]=s.axes[i-s.buttons.length].valueOf():r[i]=s.buttons[i].value}}_getGamepadDeviceType(e){return e.indexOf("054c")!==-1?e.indexOf("0ce6")!==-1?ve.DualSense:ve.DualShock:e.indexOf("Xbox One")!==-1||e.search("Xbox 360")!==-1||e.search("xinput")!==-1?ve.Xbox:e.indexOf("057e")!==-1?ve.Switch:ve.Generic}_getPointerType(e){let t=ve.Mouse;return(e.pointerType==="touch"||e.pointerType==="pen"||e.touches)&&(t=ve.Touch),t}}class Ng{constructor(e,t,i=0){this.deviceType=t,this.deviceSlot=i,this.onInputChangedObservable=new q,this._deviceInputSystem=e}getInput(e){return this._deviceInputSystem.pollInput(this.deviceType,this.deviceSlot,e)}}class sE{constructor(e){this._registeredManagers=new Array,this._refCount=0,this.registerManager=a=>{for(let o=0;o<this._devices.length;o++){const l=this._devices[o];for(const h in l){const u=+h;a._addDevice(new Ng(this._deviceInputSystem,o,u))}}this._registeredManagers.push(a)},this.unregisterManager=a=>{const o=this._registeredManagers.indexOf(a);o>-1&&this._registeredManagers.splice(o,1)};const t=Object.keys(ve).length/2;this._devices=new Array(t);const i=(a,o)=>{this._devices[a]||(this._devices[a]=new Array),this._devices[a][o]||(this._devices[a][o]=o);for(const l of this._registeredManagers){const h=new Ng(this._deviceInputSystem,a,o);l._addDevice(h)}},s=(a,o)=>{var l;(l=this._devices[a])!=null&&l[o]&&delete this._devices[a][o];for(const h of this._registeredManagers)h._removeDevice(a,o)},r=(a,o,l)=>{if(l)for(const h of this._registeredManagers)h._onInputChanged(a,o,l)};typeof _native<"u"?this._deviceInputSystem=new tE(i,s,r):this._deviceInputSystem=new iE(e,i,s,r)}dispose(){this._deviceInputSystem.dispose()}}class nE{getDeviceSource(e,t){if(t===void 0){if(this._firstDevice[e]===void 0)return null;t=this._firstDevice[e]}return!this._devices[e]||this._devices[e][t]===void 0?null:this._devices[e][t]}getDeviceSources(e){return this._devices[e]?this._devices[e].filter(t=>!!t):[]}constructor(e){const t=Object.keys(ve).length/2;this._devices=new Array(t),this._firstDevice=new Array(t),this._engine=e,this._engine._deviceSourceManager||(this._engine._deviceSourceManager=new sE(e)),this._engine._deviceSourceManager._refCount++,this.onDeviceConnectedObservable=new q(i=>{for(const s of this._devices)if(s)for(const r of s)r&&this.onDeviceConnectedObservable.notifyObserver(i,r)}),this.onDeviceDisconnectedObservable=new q,this._engine._deviceSourceManager.registerManager(this),this._onDisposeObserver=e.onDisposeObservable.add(()=>{this.dispose()})}dispose(){this.onDeviceConnectedObservable.clear(),this.onDeviceDisconnectedObservable.clear(),this._engine._deviceSourceManager&&(this._engine._deviceSourceManager.unregisterManager(this),--this._engine._deviceSourceManager._refCount<1&&(this._engine._deviceSourceManager.dispose(),delete this._engine._deviceSourceManager)),this._engine.onDisposeObservable.remove(this._onDisposeObserver)}_addDevice(e){this._devices[e.deviceType]||(this._devices[e.deviceType]=new Array),this._devices[e.deviceType][e.deviceSlot]||(this._devices[e.deviceType][e.deviceSlot]=e,this._updateFirstDevices(e.deviceType)),this.onDeviceConnectedObservable.notifyObservers(e)}_removeDevice(e,t){var s,r;const i=(s=this._devices[e])==null?void 0:s[t];this.onDeviceDisconnectedObservable.notifyObservers(i),(r=this._devices[e])!=null&&r[t]&&delete this._devices[e][t],this._updateFirstDevices(e)}_onInputChanged(e,t,i){var s,r;(r=(s=this._devices[e])==null?void 0:s[t])==null||r.onInputChangedObservable.notifyObservers(i)}_updateFirstDevices(e){switch(e){case ve.Keyboard:case ve.Mouse:this._firstDevice[e]=0;break;case ve.Touch:case ve.DualSense:case ve.DualShock:case ve.Xbox:case ve.Switch:case ve.Generic:{delete this._firstDevice[e];const t=this._devices[e];if(t){for(let i=0;i<t.length;i++)if(t[i]){this._firstDevice[e]=i;break}}break}}}}class Ad{}Ad._IsPickingAvailable=!1;class Ug{constructor(){this._singleClick=!1,this._doubleClick=!1,this._hasSwiped=!1,this._ignore=!1}get singleClick(){return this._singleClick}get doubleClick(){return this._doubleClick}get hasSwiped(){return this._hasSwiped}get ignore(){return this._ignore}set singleClick(e){this._singleClick=e}set doubleClick(e){this._doubleClick=e}set hasSwiped(e){this._hasSwiped=e}set ignore(e){this._ignore=e}}class yt{constructor(e){this._alreadyAttached=!1,this._meshPickProceed=!1,this._currentPickResult=null,this._previousPickResult=null,this._activePointerIds=new Array,this._activePointerIdsCount=0,this._doubleClickOccured=!1,this._isSwiping=!1,this._swipeButtonPressed=-1,this._skipPointerTap=!1,this._isMultiTouchGesture=!1,this._pointerX=0,this._pointerY=0,this._startingPointerPosition=new ne(0,0),this._previousStartingPointerPosition=new ne(0,0),this._startingPointerTime=0,this._previousStartingPointerTime=0,this._pointerCaptures={},this._meshUnderPointerId={},this._movePointerInfo=null,this._cameraObserverCount=0,this._delayedClicks=[null,null,null,null,null],this._deviceSourceManager=null,this._scene=e||Ae.LastCreatedScene,this._scene}get meshUnderPointer(){return this._movePointerInfo&&(this._movePointerInfo._generatePickInfo(),this._movePointerInfo=null),this._pointerOverMesh}getMeshUnderPointerByPointerId(e){return this._meshUnderPointerId[e]||null}get unTranslatedPointer(){return new ne(this._unTranslatedPointerX,this._unTranslatedPointerY)}get pointerX(){return this._pointerX}set pointerX(e){this._pointerX=e}get pointerY(){return this._pointerY}set pointerY(e){this._pointerY=e}_updatePointerPosition(e){const t=this._scene.getEngine().getInputElementClientRect();t&&(this._pointerX=e.clientX-t.left,this._pointerY=e.clientY-t.top,this._unTranslatedPointerX=this._pointerX,this._unTranslatedPointerY=this._pointerY)}_processPointerMove(e,t){const i=this._scene,s=i.getEngine(),r=s.getInputElement();r&&(r.tabIndex=s.canvasTabIndex,i.doNotHandleCursors||(r.style.cursor=i.defaultCursor)),this._setCursorAndPointerOverMesh(e,t,i);for(const l of i._pointerMoveStage){e=e||this._pickMove(t);const h=!!(e!=null&&e.pickedMesh);e=l.action(this._unTranslatedPointerX,this._unTranslatedPointerY,e,h,r)}const a=t.inputIndex>=Te.MouseWheelX&&t.inputIndex<=Te.MouseWheelZ?we.POINTERWHEEL:we.POINTERMOVE;i.onPointerMove&&(e=e||this._pickMove(t),i.onPointerMove(t,e,a));let o;e?(o=new nn(a,t,e),this._setRayOnPointerInfo(e,t)):(o=new nn(a,t,null,this),this._movePointerInfo=o),i.onPointerObservable.hasObservers()&&i.onPointerObservable.notifyObservers(o,a)}_setRayOnPointerInfo(e,t){const i=this._scene;e&&Ad._IsPickingAvailable&&(e.ray||(e.ray=i.createPickingRay(t.offsetX,t.offsetY,L.Identity(),i.activeCamera)))}_addCameraPointerObserver(e,t){return this._cameraObserverCount++,this._scene.onPointerObservable.add(e,t)}_removeCameraPointerObserver(e){return this._cameraObserverCount--,this._scene.onPointerObservable.remove(e)}_checkForPicking(){return!!(this._scene.onPointerObservable.observers.length>this._cameraObserverCount||this._scene.onPointerPick)}_checkPrePointerObservable(e,t,i){const s=this._scene,r=new eE(i,t,this._unTranslatedPointerX,this._unTranslatedPointerY);return e&&(r.originalPickingInfo=e,r.ray=e.ray,t.pointerType==="xr-near"&&e.originMesh&&(r.nearInteractionPickingInfo=e)),s.onPrePointerObservable.notifyObservers(r,i),!!r.skipOnPointerObservable}_pickMove(e){const t=this._scene,i=t.pick(this._unTranslatedPointerX,this._unTranslatedPointerY,t.pointerMovePredicate,t.pointerMoveFastCheck,t.cameraToUseForPointers,t.pointerMoveTrianglePredicate);return this._setCursorAndPointerOverMesh(i,e,t),i}_setCursorAndPointerOverMesh(e,t,i){const r=i.getEngine().getInputElement();if(e!=null&&e.pickedMesh){if(this.setPointerOverMesh(e.pickedMesh,t.pointerId,e,t),!i.doNotHandleCursors&&r&&this._pointerOverMesh){const a=this._pointerOverMesh._getActionManagerForTrigger();a&&a.hasPointerTriggers&&(r.style.cursor=a.hoverCursor||i.hoverCursor)}}else this.setPointerOverMesh(null,t.pointerId,e,t)}simulatePointerMove(e,t){const i=new PointerEvent("pointermove",t);i.inputIndex=Te.Move,!this._checkPrePointerObservable(e,i,we.POINTERMOVE)&&this._processPointerMove(e,i)}simulatePointerDown(e,t){const i=new PointerEvent("pointerdown",t);i.inputIndex=i.button+2,!this._checkPrePointerObservable(e,i,we.POINTERDOWN)&&this._processPointerDown(e,i)}_processPointerDown(e,t){const i=this._scene;if(e!=null&&e.pickedMesh){this._pickedDownMesh=e.pickedMesh;const a=e.pickedMesh._getActionManagerForTrigger();if(a){if(a.hasPickTriggers)switch(a.processTrigger(5,new Xt(e.pickedMesh,i.pointerX,i.pointerY,e.pickedMesh,t,e)),t.button){case 0:a.processTrigger(2,new Xt(e.pickedMesh,i.pointerX,i.pointerY,e.pickedMesh,t,e));break;case 1:a.processTrigger(4,new Xt(e.pickedMesh,i.pointerX,i.pointerY,e.pickedMesh,t,e));break;case 2:a.processTrigger(3,new Xt(e.pickedMesh,i.pointerX,i.pointerY,e.pickedMesh,t,e));break}a.hasSpecificTrigger(8)&&window.setTimeout(()=>{const o=i.pick(this._unTranslatedPointerX,this._unTranslatedPointerY,l=>l.isPickable&&l.isVisible&&l.isReady()&&l.actionManager&&l.actionManager.hasSpecificTrigger(8)&&l===this._pickedDownMesh,!1,i.cameraToUseForPointers);o!=null&&o.pickedMesh&&a&&this._activePointerIdsCount!==0&&Date.now()-this._startingPointerTime>yt.LongPressDelay&&!this._isPointerSwiping()&&(this._startingPointerTime=0,a.processTrigger(8,Xt.CreateNew(o.pickedMesh,t)))},yt.LongPressDelay)}}else for(const a of i._pointerDownStage)e=a.action(this._unTranslatedPointerX,this._unTranslatedPointerY,e,t,!1);let s;const r=we.POINTERDOWN;e?(i.onPointerDown&&i.onPointerDown(t,e,r),s=new nn(r,t,e),this._setRayOnPointerInfo(e,t)):s=new nn(r,t,null,this),i.onPointerObservable.hasObservers()&&i.onPointerObservable.notifyObservers(s,r)}_isPointerSwiping(){return this._isSwiping}simulatePointerUp(e,t,i){const s=new PointerEvent("pointerup",t);s.inputIndex=Te.Move;const r=new Ug;i?r.doubleClick=!0:r.singleClick=!0,!this._checkPrePointerObservable(e,s,we.POINTERUP)&&this._processPointerUp(e,s,r)}_processPointerUp(e,t,i){const s=this._scene;if(e!=null&&e.pickedMesh){if(this._pickedUpMesh=e.pickedMesh,this._pickedDownMesh===this._pickedUpMesh&&(s.onPointerPick&&s.onPointerPick(t,e),i.singleClick&&!i.ignore&&s.onPointerObservable.observers.length>this._cameraObserverCount)){const a=we.POINTERPICK,o=new nn(a,t,e);this._setRayOnPointerInfo(e,t),s.onPointerObservable.notifyObservers(o,a)}const r=e.pickedMesh._getActionManagerForTrigger();if(r&&!i.ignore){r.processTrigger(7,Xt.CreateNew(e.pickedMesh,t,e)),!i.hasSwiped&&i.singleClick&&r.processTrigger(1,Xt.CreateNew(e.pickedMesh,t,e));const a=e.pickedMesh._getActionManagerForTrigger(6);i.doubleClick&&a&&a.processTrigger(6,Xt.CreateNew(e.pickedMesh,t,e))}}else if(!i.ignore)for(const r of s._pointerUpStage)e=r.action(this._unTranslatedPointerX,this._unTranslatedPointerY,e,t,i.doubleClick);if(this._pickedDownMesh&&this._pickedDownMesh!==this._pickedUpMesh){const r=this._pickedDownMesh._getActionManagerForTrigger(16);r&&r.processTrigger(16,Xt.CreateNew(this._pickedDownMesh,t))}if(!i.ignore){const r=new nn(we.POINTERUP,t,e);if(this._setRayOnPointerInfo(e,t),s.onPointerObservable.notifyObservers(r,we.POINTERUP),s.onPointerUp&&s.onPointerUp(t,e,we.POINTERUP),!i.hasSwiped&&!this._skipPointerTap&&!this._isMultiTouchGesture){let a=0;if(i.singleClick?a=we.POINTERTAP:i.doubleClick&&(a=we.POINTERDOUBLETAP),a){const o=new nn(a,t,e);s.onPointerObservable.hasObservers()&&s.onPointerObservable.hasSpecificMask(a)&&s.onPointerObservable.notifyObservers(o,a)}}}}isPointerCaptured(e=0){return this._pointerCaptures[e]}attachControl(e=!0,t=!0,i=!0,s=null){const r=this._scene,a=r.getEngine();s||(s=a.getInputElement()),this._alreadyAttached&&this.detachControl(),s&&(this._alreadyAttachedTo=s),this._deviceSourceManager=new nE(a),this._initActionManager=o=>{if(!this._meshPickProceed){const l=r.skipPointerUpPicking||r._registeredActions===0&&!this._checkForPicking()&&!r.onPointerUp?null:r.pick(this._unTranslatedPointerX,this._unTranslatedPointerY,r.pointerUpPredicate,r.pointerUpFastCheck,r.cameraToUseForPointers,r.pointerUpTrianglePredicate);this._currentPickResult=l,l&&(o=l.hit&&l.pickedMesh?l.pickedMesh._getActionManagerForTrigger():null),this._meshPickProceed=!0}return o},this._delayedSimpleClick=(o,l,h)=>{if((Date.now()-this._previousStartingPointerTime>yt.DoubleClickDelay&&!this._doubleClickOccured||o!==this._previousButtonPressed)&&(this._doubleClickOccured=!1,l.singleClick=!0,l.ignore=!1,this._delayedClicks[o])){const u=this._delayedClicks[o].evt,c=we.POINTERTAP,f=new nn(c,u,this._currentPickResult);r.onPointerObservable.hasObservers()&&r.onPointerObservable.hasSpecificMask(c)&&r.onPointerObservable.notifyObservers(f,c),this._delayedClicks[o]=null}},this._initClickEvent=(o,l,h,u)=>{var p,g;const c=new Ug;this._currentPickResult=null;let f=null,d=o.hasSpecificMask(we.POINTERPICK)||l.hasSpecificMask(we.POINTERPICK)||o.hasSpecificMask(we.POINTERTAP)||l.hasSpecificMask(we.POINTERTAP)||o.hasSpecificMask(we.POINTERDOUBLETAP)||l.hasSpecificMask(we.POINTERDOUBLETAP);!d&&Gi&&(f=this._initActionManager(f,c),f&&(d=f.hasPickTriggers));let _=!1;if(d=d&&!this._isMultiTouchGesture,d){const m=h.button;if(c.hasSwiped=this._isPointerSwiping(),!c.hasSwiped){let v=!yt.ExclusiveDoubleClickMode;if(v||(v=!o.hasSpecificMask(we.POINTERDOUBLETAP)&&!l.hasSpecificMask(we.POINTERDOUBLETAP),v&&!Gi.HasSpecificTrigger(6)&&(f=this._initActionManager(f,c),f&&(v=!f.hasSpecificTrigger(6)))),v)(Date.now()-this._previousStartingPointerTime>yt.DoubleClickDelay||m!==this._previousButtonPressed)&&(c.singleClick=!0,u(c,this._currentPickResult),_=!0);else{const A={evt:h,clickInfo:c,timeoutId:window.setTimeout(this._delayedSimpleClick.bind(this,m,c,u),yt.DoubleClickDelay)};this._delayedClicks[m]=A}let T=o.hasSpecificMask(we.POINTERDOUBLETAP)||l.hasSpecificMask(we.POINTERDOUBLETAP);!T&&Gi.HasSpecificTrigger(6)&&(f=this._initActionManager(f,c),f&&(T=f.hasSpecificTrigger(6))),T&&(m===this._previousButtonPressed&&Date.now()-this._previousStartingPointerTime<yt.DoubleClickDelay&&!this._doubleClickOccured?(!c.hasSwiped&&!this._isPointerSwiping()?(this._previousStartingPointerTime=0,this._doubleClickOccured=!0,c.doubleClick=!0,c.ignore=!1,yt.ExclusiveDoubleClickMode&&this._delayedClicks[m]&&(clearTimeout((p=this._delayedClicks[m])==null?void 0:p.timeoutId),this._delayedClicks[m]=null),u(c,this._currentPickResult)):(this._doubleClickOccured=!1,this._previousStartingPointerTime=this._startingPointerTime,this._previousStartingPointerPosition.x=this._startingPointerPosition.x,this._previousStartingPointerPosition.y=this._startingPointerPosition.y,this._previousButtonPressed=m,yt.ExclusiveDoubleClickMode?(this._delayedClicks[m]&&(clearTimeout((g=this._delayedClicks[m])==null?void 0:g.timeoutId),this._delayedClicks[m]=null),u(c,this._previousPickResult)):u(c,this._currentPickResult)),_=!0):(this._doubleClickOccured=!1,this._previousStartingPointerTime=this._startingPointerTime,this._previousStartingPointerPosition.x=this._startingPointerPosition.x,this._previousStartingPointerPosition.y=this._startingPointerPosition.y,this._previousButtonPressed=m))}}_||u(c,this._currentPickResult)},this._onPointerMove=o=>{if(this._updatePointerPosition(o),!this._isSwiping&&this._swipeButtonPressed!==-1&&(this._isSwiping=Math.abs(this._startingPointerPosition.x-this._pointerX)>yt.DragMovementThreshold||Math.abs(this._startingPointerPosition.y-this._pointerY)>yt.DragMovementThreshold),a.isPointerLock&&a._verifyPointerLock(),this._checkPrePointerObservable(null,o,o.inputIndex>=Te.MouseWheelX&&o.inputIndex<=Te.MouseWheelZ?we.POINTERWHEEL:we.POINTERMOVE)||!r.cameraToUseForPointers&&!r.activeCamera)return;if(r.skipPointerMovePicking){this._processPointerMove(new xn,o);return}r.pointerMovePredicate||(r.pointerMovePredicate=h=>h.isPickable&&h.isVisible&&h.isReady()&&h.isEnabled()&&(h.enablePointerMoveEvents||r.constantlyUpdateMeshUnderPointer||h._getActionManagerForTrigger()!==null)&&(!r.cameraToUseForPointers||(r.cameraToUseForPointers.layerMask&h.layerMask)!==0));const l=r._registeredActions>0||r.constantlyUpdateMeshUnderPointer?this._pickMove(o):null;this._processPointerMove(l,o)},this._onPointerDown=o=>{var u;const l=this._activePointerIds.indexOf(-1);if(l===-1?this._activePointerIds.push(o.pointerId):this._activePointerIds[l]=o.pointerId,this._activePointerIdsCount++,this._pickedDownMesh=null,this._meshPickProceed=!1,yt.ExclusiveDoubleClickMode){for(let c=0;c<this._delayedClicks.length;c++)if(this._delayedClicks[c])if(o.button===c)clearTimeout((u=this._delayedClicks[c])==null?void 0:u.timeoutId);else{const f=this._delayedClicks[c].clickInfo;this._doubleClickOccured=!1,f.singleClick=!0,f.ignore=!1;const d=this._delayedClicks[c].evt,_=we.POINTERTAP,p=new nn(_,d,this._currentPickResult);r.onPointerObservable.hasObservers()&&r.onPointerObservable.hasSpecificMask(_)&&r.onPointerObservable.notifyObservers(p,_),this._delayedClicks[c]=null}}if(this._updatePointerPosition(o),this._swipeButtonPressed===-1&&(this._swipeButtonPressed=o.button),r.preventDefaultOnPointerDown&&s&&(o.preventDefault(),s.focus()),this._startingPointerPosition.x=this._pointerX,this._startingPointerPosition.y=this._pointerY,this._startingPointerTime=Date.now(),this._checkPrePointerObservable(null,o,we.POINTERDOWN)||!r.cameraToUseForPointers&&!r.activeCamera)return;this._pointerCaptures[o.pointerId]=!0,r.pointerDownPredicate||(r.pointerDownPredicate=c=>c.isPickable&&c.isVisible&&c.isReady()&&c.isEnabled()&&(!r.cameraToUseForPointers||(r.cameraToUseForPointers.layerMask&c.layerMask)!==0)),this._pickedDownMesh=null;let h;r.skipPointerDownPicking||r._registeredActions===0&&!this._checkForPicking()&&!r.onPointerDown?h=new xn:h=r.pick(this._unTranslatedPointerX,this._unTranslatedPointerY,r.pointerDownPredicate,r.pointerDownFastCheck,r.cameraToUseForPointers,r.pointerDownTrianglePredicate),this._processPointerDown(h,o)},this._onPointerUp=o=>{const l=this._activePointerIds.indexOf(o.pointerId);l!==-1&&(this._activePointerIds[l]=-1,this._activePointerIdsCount--,this._pickedUpMesh=null,this._meshPickProceed=!1,this._updatePointerPosition(o),r.preventDefaultOnPointerUp&&s&&(o.preventDefault(),s.focus()),this._initClickEvent(r.onPrePointerObservable,r.onPointerObservable,o,(h,u)=>{if(r.onPrePointerObservable.hasObservers()&&(this._skipPointerTap=!1,!h.ignore)){if(this._checkPrePointerObservable(null,o,we.POINTERUP)){this._swipeButtonPressed===o.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1),o.buttons===0&&(this._pointerCaptures[o.pointerId]=!1);return}h.hasSwiped||(h.singleClick&&r.onPrePointerObservable.hasSpecificMask(we.POINTERTAP)&&this._checkPrePointerObservable(null,o,we.POINTERTAP)&&(this._skipPointerTap=!0),h.doubleClick&&r.onPrePointerObservable.hasSpecificMask(we.POINTERDOUBLETAP)&&this._checkPrePointerObservable(null,o,we.POINTERDOUBLETAP)&&(this._skipPointerTap=!0))}if(!this._pointerCaptures[o.pointerId]){this._swipeButtonPressed===o.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1);return}o.buttons===0&&(this._pointerCaptures[o.pointerId]=!1),!(!r.cameraToUseForPointers&&!r.activeCamera)&&(r.pointerUpPredicate||(r.pointerUpPredicate=c=>c.isPickable&&c.isVisible&&c.isReady()&&c.isEnabled()&&(!r.cameraToUseForPointers||(r.cameraToUseForPointers.layerMask&c.layerMask)!==0)),!this._meshPickProceed&&(Gi&&Gi.HasTriggers||this._checkForPicking()||r.onPointerUp)&&this._initActionManager(null,h),u||(u=this._currentPickResult),this._processPointerUp(u,o,h),this._previousPickResult=this._currentPickResult,this._swipeButtonPressed===o.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1))}))},this._onKeyDown=o=>{const l=Yo.KEYDOWN;if(r.onPreKeyboardObservable.hasObservers()){const h=new Cg(l,o);if(r.onPreKeyboardObservable.notifyObservers(h,l),h.skipOnKeyboardObservable)return}if(r.onKeyboardObservable.hasObservers()){const h=new kc(l,o);r.onKeyboardObservable.notifyObservers(h,l)}r.actionManager&&r.actionManager.processTrigger(14,Xt.CreateNewFromScene(r,o))},this._onKeyUp=o=>{const l=Yo.KEYUP;if(r.onPreKeyboardObservable.hasObservers()){const h=new Cg(l,o);if(r.onPreKeyboardObservable.notifyObservers(h,l),h.skipOnKeyboardObservable)return}if(r.onKeyboardObservable.hasObservers()){const h=new kc(l,o);r.onKeyboardObservable.notifyObservers(h,l)}r.actionManager&&r.actionManager.processTrigger(15,Xt.CreateNewFromScene(r,o))},this._deviceSourceManager.onDeviceConnectedObservable.add(o=>{o.deviceType===ve.Mouse?o.onInputChangedObservable.add(l=>{this._originMouseEvent=l,l.inputIndex===Te.LeftClick||l.inputIndex===Te.MiddleClick||l.inputIndex===Te.RightClick||l.inputIndex===Te.BrowserBack||l.inputIndex===Te.BrowserForward?t&&o.getInput(l.inputIndex)===1?this._onPointerDown(l):e&&o.getInput(l.inputIndex)===0&&this._onPointerUp(l):i&&(l.inputIndex===Te.Move?this._onPointerMove(l):(l.inputIndex===Te.MouseWheelX||l.inputIndex===Te.MouseWheelY||l.inputIndex===Te.MouseWheelZ)&&this._onPointerMove(l))}):o.deviceType===ve.Touch?o.onInputChangedObservable.add(l=>{l.inputIndex===Te.LeftClick&&(t&&o.getInput(l.inputIndex)===1?(this._onPointerDown(l),this._activePointerIdsCount>1&&(this._isMultiTouchGesture=!0)):e&&o.getInput(l.inputIndex)===0&&(this._onPointerUp(l),this._activePointerIdsCount===0&&(this._isMultiTouchGesture=!1))),i&&l.inputIndex===Te.Move&&this._onPointerMove(l)}):o.deviceType===ve.Keyboard&&o.onInputChangedObservable.add(l=>{l.type==="keydown"?this._onKeyDown(l):l.type==="keyup"&&this._onKeyUp(l)})}),this._alreadyAttached=!0}detachControl(){this._alreadyAttached&&(this._deviceSourceManager.dispose(),this._deviceSourceManager=null,this._alreadyAttachedTo&&!this._scene.doNotHandleCursors&&(this._alreadyAttachedTo.style.cursor=this._scene.defaultCursor),this._alreadyAttached=!1,this._alreadyAttachedTo=null)}setPointerOverMesh(e,t=0,i,s){if(this._meshUnderPointerId[t]===e&&(!e||!e._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting))return;const r=this._meshUnderPointerId[t];let a;r&&(a=r._getActionManagerForTrigger(10),a&&a.processTrigger(10,new Xt(r,this._pointerX,this._pointerY,e,s,{pointerId:t}))),e?(this._meshUnderPointerId[t]=e,this._pointerOverMesh=e,a=e._getActionManagerForTrigger(9),a&&a.processTrigger(9,new Xt(e,this._pointerX,this._pointerY,e,s,{pointerId:t,pickResult:i}))):(delete this._meshUnderPointerId[t],this._pointerOverMesh=null),this._scene.onMeshUnderPointerUpdatedObservable.hasObservers()&&this._scene.onMeshUnderPointerUpdatedObservable.notifyObservers({mesh:e,pointerId:t})}getPointerOverMesh(){return this.meshUnderPointer}_invalidateMesh(e){this._pointerOverMesh===e&&(this._pointerOverMesh=null),this._pickedDownMesh===e&&(this._pickedDownMesh=null),this._pickedUpMesh===e&&(this._pickedUpMesh=null);for(const t in this._meshUnderPointerId)this._meshUnderPointerId[t]===e&&delete this._meshUnderPointerId[t]}}yt.DragMovementThreshold=10;yt.LongPressDelay=500;yt.DoubleClickDelay=300;yt.ExclusiveDoubleClickMode=!1;class Wv{static get UniqueId(){const e=this._UniqueIdCounter;return this._UniqueIdCounter++,e}}Wv._UniqueIdCounter=1;class He{static CompareLightsPriority(e,t){return e.shadowEnabled!==t.shadowEnabled?(t.shadowEnabled?1:0)-(e.shadowEnabled?1:0):t.renderPriority-e.renderPriority}}He.FALLOFF_DEFAULT=0;He.FALLOFF_PHYSICAL=1;He.FALLOFF_GLTF=2;He.FALLOFF_STANDARD=3;He.LIGHTMAP_DEFAULT=0;He.LIGHTMAP_SPECULAR=1;He.LIGHTMAP_SHADOWSONLY=2;He.INTENSITYMODE_AUTOMATIC=0;He.INTENSITYMODE_LUMINOUSPOWER=1;He.INTENSITYMODE_LUMINOUSINTENSITY=2;He.INTENSITYMODE_ILLUMINANCE=3;He.INTENSITYMODE_LUMINANCE=4;He.LIGHTTYPEID_POINTLIGHT=0;He.LIGHTTYPEID_DIRECTIONALLIGHT=1;He.LIGHTTYPEID_SPOTLIGHT=2;He.LIGHTTYPEID_HEMISPHERICLIGHT=3;He.LIGHTTYPEID_RECT_AREALIGHT=4;class rE{constructor(){this.pointerDownFastCheck=!1,this.pointerUpFastCheck=!1,this.pointerMoveFastCheck=!1,this.skipPointerMovePicking=!1,this.skipPointerDownPicking=!1,this.skipPointerUpPicking=!1}}var Vc;(function(n){n[n.BackwardCompatible=0]="BackwardCompatible",n[n.Intermediate=1]="Intermediate",n[n.Aggressive=2]="Aggressive"})(Vc||(Vc={}));class Je{static DefaultMaterialFactory(e){throw Ee("StandardMaterial")}static CollisionCoordinatorFactory(){throw Ee("DefaultCollisionCoordinator")}get clearColor(){return this._clearColor}set clearColor(e){e!==this._clearColor&&(this._clearColor=e,this.onClearColorChangedObservable.notifyObservers(this._clearColor))}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}get performancePriority(){return this._performancePriority}set performancePriority(e){if(e!==this._performancePriority){switch(this._performancePriority=e,e){case 0:this.skipFrustumClipping=!1,this._renderingManager.maintainStateBetweenFrames=!1,this.skipPointerMovePicking=!1,this.autoClear=!0;break;case 1:this.skipFrustumClipping=!1,this._renderingManager.maintainStateBetweenFrames=!1,this.skipPointerMovePicking=!0,this.autoClear=!1;break;case 2:this.skipFrustumClipping=!0,this._renderingManager.maintainStateBetweenFrames=!0,this.skipPointerMovePicking=!0,this.autoClear=!1;break}this.onScenePerformancePriorityChangedObservable.notifyObservers(e)}}set forceWireframe(e){this._forceWireframe!==e&&(this._forceWireframe=e,this.markAllMaterialsAsDirty(16))}get forceWireframe(){return this._forceWireframe}set skipFrustumClipping(e){this._skipFrustumClipping!==e&&(this._skipFrustumClipping=e)}get skipFrustumClipping(){return this._skipFrustumClipping}set forcePointsCloud(e){this._forcePointsCloud!==e&&(this._forcePointsCloud=e,this.markAllMaterialsAsDirty(16))}get forcePointsCloud(){return this._forcePointsCloud}get environmentTexture(){return this._environmentTexture}set environmentTexture(e){this._environmentTexture!==e&&(this._environmentTexture=e,this.onEnvironmentTextureChangedObservable.notifyObservers(e),this.markAllMaterialsAsDirty(1))}getNodes(){let e=[];return e=e.concat(this.meshes),e=e.concat(this.lights),e=e.concat(this.cameras),e=e.concat(this.transformNodes),this.skeletons.forEach(t=>e=e.concat(t.bones)),e}get animationPropertiesOverride(){return this._animationPropertiesOverride}set animationPropertiesOverride(e){this._animationPropertiesOverride=e}set onDispose(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)}set beforeRender(e){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),e&&(this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(e))}set afterRender(e){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),e&&(this._onAfterRenderObserver=this.onAfterRenderObservable.add(e))}set beforeCameraRender(e){this._onBeforeCameraRenderObserver&&this.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=this.onBeforeCameraRenderObservable.add(e)}set afterCameraRender(e){this._onAfterCameraRenderObserver&&this.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=this.onAfterCameraRenderObservable.add(e)}get pointerDownPredicate(){return this._pointerPickingConfiguration.pointerDownPredicate}set pointerDownPredicate(e){this._pointerPickingConfiguration.pointerDownPredicate=e}get pointerUpPredicate(){return this._pointerPickingConfiguration.pointerUpPredicate}set pointerUpPredicate(e){this._pointerPickingConfiguration.pointerUpPredicate=e}get pointerMovePredicate(){return this._pointerPickingConfiguration.pointerMovePredicate}set pointerMovePredicate(e){this._pointerPickingConfiguration.pointerMovePredicate=e}get pointerDownFastCheck(){return this._pointerPickingConfiguration.pointerDownFastCheck}set pointerDownFastCheck(e){this._pointerPickingConfiguration.pointerDownFastCheck=e}get pointerUpFastCheck(){return this._pointerPickingConfiguration.pointerUpFastCheck}set pointerUpFastCheck(e){this._pointerPickingConfiguration.pointerUpFastCheck=e}get pointerMoveFastCheck(){return this._pointerPickingConfiguration.pointerMoveFastCheck}set pointerMoveFastCheck(e){this._pointerPickingConfiguration.pointerMoveFastCheck=e}get skipPointerMovePicking(){return this._pointerPickingConfiguration.skipPointerMovePicking}set skipPointerMovePicking(e){this._pointerPickingConfiguration.skipPointerMovePicking=e}get skipPointerDownPicking(){return this._pointerPickingConfiguration.skipPointerDownPicking}set skipPointerDownPicking(e){this._pointerPickingConfiguration.skipPointerDownPicking=e}get skipPointerUpPicking(){return this._pointerPickingConfiguration.skipPointerUpPicking}set skipPointerUpPicking(e){this._pointerPickingConfiguration.skipPointerUpPicking=e}get unTranslatedPointer(){return this._inputManager.unTranslatedPointer}static get DragMovementThreshold(){return yt.DragMovementThreshold}static set DragMovementThreshold(e){yt.DragMovementThreshold=e}static get LongPressDelay(){return yt.LongPressDelay}static set LongPressDelay(e){yt.LongPressDelay=e}static get DoubleClickDelay(){return yt.DoubleClickDelay}static set DoubleClickDelay(e){yt.DoubleClickDelay=e}static get ExclusiveDoubleClickMode(){return yt.ExclusiveDoubleClickMode}static set ExclusiveDoubleClickMode(e){yt.ExclusiveDoubleClickMode=e}bindEyePosition(e,t="vEyePosition",i=!1){var a;const s=this._forcedViewPosition?this._forcedViewPosition:this._mirroredCameraPosition?this._mirroredCameraPosition:((a=this.activeCamera)==null?void 0:a.globalPosition)??y.ZeroReadOnly,r=this.useRightHandedSystem===(this._mirroredCameraPosition!=null);return N.Vector4[0].set(s.x,s.y,s.z,r?-1:1),e&&(i?e.setFloat3(t,N.Vector4[0].x,N.Vector4[0].y,N.Vector4[0].z):e.setVector4(t,N.Vector4[0])),N.Vector4[0]}finalizeSceneUbo(){const e=this.getSceneUniformBuffer(),t=this.bindEyePosition(null);return e.updateFloat4("vEyePosition",t.x,t.y,t.z,t.w),e.update(),e}set useRightHandedSystem(e){this._useRightHandedSystem!==e&&(this._useRightHandedSystem=e,this.markAllMaterialsAsDirty(16))}get useRightHandedSystem(){return this._useRightHandedSystem}setStepId(e){this._currentStepId=e}getStepId(){return this._currentStepId}getInternalStep(){return this._currentInternalStep}set fogEnabled(e){this._fogEnabled!==e&&(this._fogEnabled=e,this.markAllMaterialsAsDirty(16))}get fogEnabled(){return this._fogEnabled}set fogMode(e){this._fogMode!==e&&(this._fogMode=e,this.markAllMaterialsAsDirty(16))}get fogMode(){return this._fogMode}get prePass(){return!!this.prePassRenderer&&this.prePassRenderer.defaultRT.enabled}set shadowsEnabled(e){this._shadowsEnabled!==e&&(this._shadowsEnabled=e,this.markAllMaterialsAsDirty(2))}get shadowsEnabled(){return this._shadowsEnabled}set lightsEnabled(e){this._lightsEnabled!==e&&(this._lightsEnabled=e,this.markAllMaterialsAsDirty(2))}get lightsEnabled(){return this._lightsEnabled}get activeCameras(){return this._activeCameras}set activeCameras(e){this._unObserveActiveCameras&&(this._unObserveActiveCameras(),this._unObserveActiveCameras=null),e&&(this._unObserveActiveCameras=_v(e,()=>{this.onActiveCamerasChanged.notifyObservers(this)})),this._activeCameras=e}get activeCamera(){return this._activeCamera}set activeCamera(e){e!==this._activeCamera&&(this._activeCamera=e,this.onActiveCameraChanged.notifyObservers(this))}get _hasDefaultMaterial(){return Je.DefaultMaterialFactory!==Je._OriginalDefaultMaterialFactory}get defaultMaterial(){return this._defaultMaterial||(this._defaultMaterial=Je.DefaultMaterialFactory(this)),this._defaultMaterial}set defaultMaterial(e){this._defaultMaterial=e}set texturesEnabled(e){this._texturesEnabled!==e&&(this._texturesEnabled=e,this.markAllMaterialsAsDirty(1))}get texturesEnabled(){return this._texturesEnabled}get frameGraph(){return this._frameGraph}set frameGraph(e){if(this._frameGraph){this._frameGraph=e,e||(this.customRenderFunction=this._currentCustomRenderFunction);return}this._frameGraph=e,e&&(this._currentCustomRenderFunction=this.customRenderFunction,this.customRenderFunction=this._renderWithFrameGraph)}set skeletonsEnabled(e){this._skeletonsEnabled!==e&&(this._skeletonsEnabled=e,this.markAllMaterialsAsDirty(8))}get skeletonsEnabled(){return this._skeletonsEnabled}get collisionCoordinator(){return this._collisionCoordinator||(this._collisionCoordinator=Je.CollisionCoordinatorFactory(),this._collisionCoordinator.init(this)),this._collisionCoordinator}get renderingManager(){return this._renderingManager}get frustumPlanes(){return this._frustumPlanes}_registerTransientComponents(){if(this._transientComponents.length>0){for(const e of this._transientComponents)e.register();this._transientComponents.length=0}}_addComponent(e){this._components.push(e),this._transientComponents.push(e);const t=e;t.addFromContainer&&t.serialize&&this._serializableComponents.push(t)}_getComponent(e){for(const t of this._components)if(t.name===e)return t;return null}constructor(e,t){this._inputManager=new yt(this),this.cameraToUseForPointers=null,this._isScene=!0,this._blockEntityCollection=!1,this.autoClear=!0,this.autoClearDepthAndStencil=!0,this._clearColor=new K(.2,.2,.3,1),this.onClearColorChangedObservable=new q,this.ambientColor=new fe(0,0,0),this.environmentIntensity=1,this.iblIntensity=1,this._performancePriority=0,this.onScenePerformancePriorityChangedObservable=new q,this._forceWireframe=!1,this._skipFrustumClipping=!1,this._forcePointsCloud=!1,this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.particleSystems=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.effectLayers=[],this.sounds=null,this.layers=[],this.lensFlareSystems=[],this.proceduralTextures=[],this.animationsEnabled=!0,this._animationPropertiesOverride=null,this.useConstantAnimationDeltaTime=!1,this.constantlyUpdateMeshUnderPointer=!1,this.hoverCursor="pointer",this.defaultCursor="",this.doNotHandleCursors=!1,this.preventDefaultOnPointerDown=!0,this.preventDefaultOnPointerUp=!0,this.metadata=null,this.reservedDataStore=null,this.disableOfflineSupportExceptionRules=[],this.onDisposeObservable=new q,this._onDisposeObserver=null,this.onBeforeRenderObservable=new q,this._onBeforeRenderObserver=null,this.onAfterRenderObservable=new q,this.onAfterRenderCameraObservable=new q,this._onAfterRenderObserver=null,this.onBeforeAnimationsObservable=new q,this.onAfterAnimationsObservable=new q,this.onBeforeDrawPhaseObservable=new q,this.onAfterDrawPhaseObservable=new q,this.onReadyObservable=new q,this.onBeforeCameraRenderObservable=new q,this._onBeforeCameraRenderObserver=null,this.onAfterCameraRenderObservable=new q,this._onAfterCameraRenderObserver=null,this.onBeforeActiveMeshesEvaluationObservable=new q,this.onAfterActiveMeshesEvaluationObservable=new q,this.onBeforeParticlesRenderingObservable=new q,this.onAfterParticlesRenderingObservable=new q,this.onDataLoadedObservable=new q,this.onNewCameraAddedObservable=new q,this.onCameraRemovedObservable=new q,this.onNewLightAddedObservable=new q,this.onLightRemovedObservable=new q,this.onNewGeometryAddedObservable=new q,this.onGeometryRemovedObservable=new q,this.onNewTransformNodeAddedObservable=new q,this.onTransformNodeRemovedObservable=new q,this.onNewMeshAddedObservable=new q,this.onMeshRemovedObservable=new q,this.onNewSkeletonAddedObservable=new q,this.onSkeletonRemovedObservable=new q,this.onNewMaterialAddedObservable=new q,this.onNewMultiMaterialAddedObservable=new q,this.onMaterialRemovedObservable=new q,this.onMultiMaterialRemovedObservable=new q,this.onNewTextureAddedObservable=new q,this.onTextureRemovedObservable=new q,this.onBeforeRenderTargetsRenderObservable=new q,this.onAfterRenderTargetsRenderObservable=new q,this.onBeforeStepObservable=new q,this.onAfterStepObservable=new q,this.onActiveCameraChanged=new q,this.onActiveCamerasChanged=new q,this.onBeforeRenderingGroupObservable=new q,this.onAfterRenderingGroupObservable=new q,this.onMeshImportedObservable=new q,this.onAnimationFileImportedObservable=new q,this.onEnvironmentTextureChangedObservable=new q,this.onMeshUnderPointerUpdatedObservable=new q,this._registeredForLateAnimationBindings=new cr(256),this._pointerPickingConfiguration=new rE,this.onPrePointerObservable=new q,this.onPointerObservable=new q,this.onPreKeyboardObservable=new q,this.onKeyboardObservable=new q,this._useRightHandedSystem=!1,this._timeAccumulator=0,this._currentStepId=0,this._currentInternalStep=0,this._fogEnabled=!0,this._fogMode=Je.FOGMODE_NONE,this.fogColor=new fe(.2,.2,.3),this.fogDensity=.1,this.fogStart=0,this.fogEnd=1e3,this.needsPreviousWorldMatrices=!1,this._shadowsEnabled=!0,this._lightsEnabled=!0,this._unObserveActiveCameras=null,this._texturesEnabled=!0,this._frameGraph=null,this.frameGraphs=[],this.physicsEnabled=!0,this.particlesEnabled=!0,this.spritesEnabled=!0,this._skeletonsEnabled=!0,this.lensFlaresEnabled=!0,this.collisionsEnabled=!0,this.gravity=new y(0,-9.807,0),this.postProcessesEnabled=!0,this.renderTargetsEnabled=!0,this.dumpNextRenderTargets=!1,this.customRenderTargets=[],this.importedMeshesFiles=[],this.probesEnabled=!0,this._meshesForIntersections=new cr(256),this.proceduralTexturesEnabled=!0,this._totalVertices=new Hi,this._activeIndices=new Hi,this._activeParticles=new Hi,this._activeBones=new Hi,this._animationTime=0,this.animationTimeScale=1,this._renderId=0,this._frameId=0,this._executeWhenReadyTimeoutId=null,this._intermediateRendering=!1,this._defaultFrameBufferCleared=!1,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1,this._toBeDisposed=new Array(256),this._activeRequests=new Array,this._pendingData=new Array,this._isDisposed=!1,this.dispatchAllSubMeshesOfActiveMeshes=!1,this._activeMeshes=new ti(256),this._processedMaterials=new ti(256),this._renderTargets=new cr(256),this._materialsRenderTargets=new cr(256),this._activeParticleSystems=new ti(256),this._activeSkeletons=new cr(32),this._softwareSkinnedMeshes=new cr(32),this._activeAnimatables=new Array,this._transformMatrix=L.Zero(),this.requireLightSorting=!1,this._components=[],this._serializableComponents=[],this._transientComponents=[],this._beforeCameraUpdateStage=vt.Create(),this._beforeClearStage=vt.Create(),this._beforeRenderTargetClearStage=vt.Create(),this._gatherRenderTargetsStage=vt.Create(),this._gatherActiveCameraRenderTargetsStage=vt.Create(),this._isReadyForMeshStage=vt.Create(),this._beforeEvaluateActiveMeshStage=vt.Create(),this._evaluateSubMeshStage=vt.Create(),this._preActiveMeshStage=vt.Create(),this._cameraDrawRenderTargetStage=vt.Create(),this._beforeCameraDrawStage=vt.Create(),this._beforeRenderTargetDrawStage=vt.Create(),this._beforeRenderingGroupDrawStage=vt.Create(),this._beforeRenderingMeshStage=vt.Create(),this._afterRenderingMeshStage=vt.Create(),this._afterRenderingGroupDrawStage=vt.Create(),this._afterCameraDrawStage=vt.Create(),this._afterCameraPostProcessStage=vt.Create(),this._afterRenderTargetDrawStage=vt.Create(),this._afterRenderTargetPostProcessStage=vt.Create(),this._afterRenderStage=vt.Create(),this._pointerMoveStage=vt.Create(),this._pointerDownStage=vt.Create(),this._pointerUpStage=vt.Create(),this._geometriesByUniqueId=null,this._defaultMeshCandidates={data:[],length:0},this._defaultSubMeshCandidates={data:[],length:0},this._preventFreeActiveMeshesAndRenderingGroups=!1,this._activeMeshesFrozen=!1,this._activeMeshesFrozenButKeepClipping=!1,this._skipEvaluateActiveMeshesCompletely=!1,this._useCurrentFrameBuffer=!1,this._allowPostProcessClearColor=!0,this.getDeterministicFrameTime=()=>this._engine.getTimeStep(),this._registeredActions=0,this._blockMaterialDirtyMechanism=!1,this._perfCollector=null,this.activeCameras=[];const i={useGeometryUniqueIdsMap:!0,useMaterialMeshMap:!0,useClonedMeshMap:!0,virtual:!1,...t};e=this._engine=e||Ae.LastCreatedEngine,i.virtual?e._virtualScenes.push(this):(Ae._LastCreatedScene=this,e.scenes.push(this)),this._uid=null,this._renderingManager=new Qt(this),Fc&&(this.postProcessManager=new Fc(this)),zt()&&this.attachControl(),this._createUbo(),ke&&(this._imageProcessingConfiguration=new ke),this.setDefaultCandidateProviders(),i.useGeometryUniqueIdsMap&&(this._geometriesByUniqueId={}),this.useMaterialMeshMap=i.useMaterialMeshMap,this.useClonedMeshMap=i.useClonedMeshMap,(!t||!t.virtual)&&e.onNewSceneAddedObservable.notifyObservers(this)}getClassName(){return"Scene"}_getDefaultMeshCandidates(){return this._defaultMeshCandidates.data=this.meshes,this._defaultMeshCandidates.length=this.meshes.length,this._defaultMeshCandidates}_getDefaultSubMeshCandidates(e){return this._defaultSubMeshCandidates.data=e.subMeshes,this._defaultSubMeshCandidates.length=e.subMeshes.length,this._defaultSubMeshCandidates}setDefaultCandidateProviders(){this.getActiveMeshCandidates=()=>this._getDefaultMeshCandidates(),this.getActiveSubMeshCandidates=e=>this._getDefaultSubMeshCandidates(e),this.getIntersectingSubMeshCandidates=(e,t)=>this._getDefaultSubMeshCandidates(e),this.getCollidingSubMeshCandidates=(e,t)=>this._getDefaultSubMeshCandidates(e)}get meshUnderPointer(){return this._inputManager.meshUnderPointer}get pointerX(){return this._inputManager.pointerX}set pointerX(e){this._inputManager.pointerX=e}get pointerY(){return this._inputManager.pointerY}set pointerY(e){this._inputManager.pointerY=e}getCachedMaterial(){return this._cachedMaterial}getCachedEffect(){return this._cachedEffect}getCachedVisibility(){return this._cachedVisibility}isCachedMaterialInvalid(e,t,i=1){return this._cachedEffect!==t||this._cachedMaterial!==e||this._cachedVisibility!==i}getEngine(){return this._engine}getTotalVertices(){return this._totalVertices.current}get totalVerticesPerfCounter(){return this._totalVertices}getActiveIndices(){return this._activeIndices.current}get totalActiveIndicesPerfCounter(){return this._activeIndices}getActiveParticles(){return this._activeParticles.current}get activeParticlesPerfCounter(){return this._activeParticles}getActiveBones(){return this._activeBones.current}get activeBonesPerfCounter(){return this._activeBones}getActiveMeshes(){return this._activeMeshes}getAnimationRatio(){return this._animationRatio!==void 0?this._animationRatio:1}getRenderId(){return this._renderId}getFrameId(){return this._frameId}incrementRenderId(){this._renderId++}_createUbo(){this.setSceneUniformBuffer(this.createSceneUniformBuffer())}simulatePointerMove(e,t){return this._inputManager.simulatePointerMove(e,t),this}simulatePointerDown(e,t){return this._inputManager.simulatePointerDown(e,t),this}simulatePointerUp(e,t,i){return this._inputManager.simulatePointerUp(e,t,i),this}isPointerCaptured(e=0){return this._inputManager.isPointerCaptured(e)}attachControl(e=!0,t=!0,i=!0){this._inputManager.attachControl(e,t,i)}detachControl(){this._inputManager.detachControl()}isReady(e=!0){var a,o;if(this._isDisposed)return!1;let t;const i=this.getEngine(),s=i.currentRenderPassId;i.currentRenderPassId=((a=this.activeCamera)==null?void 0:a.renderPassId)??s;let r=!0;for(this._pendingData.length>0&&(r=!1),(o=this.prePassRenderer)==null||o.update(),this.useOrderIndependentTransparency&&this.depthPeelingRenderer&&r&&(r=this.depthPeelingRenderer.isReady()),e&&(this._processedMaterials.reset(),this._materialsRenderTargets.reset()),t=0;t<this.meshes.length;t++){const l=this.meshes[t];if(!l.subMeshes||l.subMeshes.length===0)continue;if(!l.isReady(!0)){r=!1;continue}const h=l.hasThinInstances||l.getClassName()==="InstancedMesh"||l.getClassName()==="InstancedLinesMesh"||i.getCaps().instancedArrays&&l.instances.length>0;for(const c of this._isReadyForMeshStage)c.action(l,h)||(r=!1);if(!e)continue;const u=l.material||this.defaultMaterial;if(u)if(u._storeEffectOnSubMeshes)for(const c of l.subMeshes){const f=c.getMaterial();f&&f.hasRenderTargetTextures&&f.getRenderTargetTextures!=null&&this._processedMaterials.indexOf(f)===-1&&(this._processedMaterials.push(f),this._materialsRenderTargets.concatWithNoDuplicate(f.getRenderTargetTextures()))}else u.hasRenderTargetTextures&&u.getRenderTargetTextures!=null&&this._processedMaterials.indexOf(u)===-1&&(this._processedMaterials.push(u),this._materialsRenderTargets.concatWithNoDuplicate(u.getRenderTargetTextures()))}if(e)for(t=0;t<this._materialsRenderTargets.length;++t)this._materialsRenderTargets.data[t].isReadyForRendering()||(r=!1);for(t=0;t<this.geometries.length;t++)this.geometries[t].delayLoadState===2&&(r=!1);if(this.activeCameras&&this.activeCameras.length>0)for(const l of this.activeCameras)l.isReady(!0)||(r=!1);else this.activeCamera&&(this.activeCamera.isReady(!0)||(r=!1));for(const l of this.particleSystems)l.isReady()||(r=!1);if(this.layers)for(const l of this.layers)l.isReady()||(r=!1);if(this.effectLayers)for(const l of this.effectLayers)l.isLayerReady()||(r=!1);return i.areAllEffectsReady()||(r=!1),i.currentRenderPassId=s,r}resetCachedMaterial(){this._cachedMaterial=null,this._cachedEffect=null,this._cachedVisibility=null}registerBeforeRender(e){this.onBeforeRenderObservable.add(e)}unregisterBeforeRender(e){this.onBeforeRenderObservable.removeCallback(e)}registerAfterRender(e){this.onAfterRenderObservable.add(e)}unregisterAfterRender(e){this.onAfterRenderObservable.removeCallback(e)}_executeOnceBeforeRender(e){const t=()=>{e(),setTimeout(()=>{this.unregisterBeforeRender(t)})};this.registerBeforeRender(t)}executeOnceBeforeRender(e,t){t!==void 0?setTimeout(()=>{this._executeOnceBeforeRender(e)},t):this._executeOnceBeforeRender(e)}addPendingData(e){this._pendingData.push(e)}removePendingData(e){const t=this.isLoading,i=this._pendingData.indexOf(e);i!==-1&&this._pendingData.splice(i,1),t&&!this.isLoading&&this.onDataLoadedObservable.notifyObservers(this)}getWaitingItemsCount(){return this._pendingData.length}get isLoading(){return this._pendingData.length>0}executeWhenReady(e,t=!1){this.onReadyObservable.addOnce(e),this._executeWhenReadyTimeoutId===null&&this._checkIsReady(t)}whenReadyAsync(e=!1){return new Promise(t=>{this.executeWhenReady(()=>{t()},e)})}_checkIsReady(e=!1){if(this._registerTransientComponents(),this.isReady(e)){this.onReadyObservable.notifyObservers(this),this.onReadyObservable.clear(),this._executeWhenReadyTimeoutId=null;return}if(this._isDisposed){this.onReadyObservable.clear(),this._executeWhenReadyTimeoutId=null;return}this._executeWhenReadyTimeoutId=setTimeout(()=>{this.incrementRenderId(),this._checkIsReady(e)},100)}get animatables(){return this._activeAnimatables}resetLastAnimationTimeFrame(){this._animationTimeLast=as.Now}getViewMatrix(){return this._viewMatrix}getProjectionMatrix(){return this._projectionMatrix}getTransformMatrix(){return this._transformMatrix}setTransformMatrix(e,t,i,s){!i&&!s&&this._multiviewSceneUbo&&(this._multiviewSceneUbo.dispose(),this._multiviewSceneUbo=null),!(this._viewUpdateFlag===e.updateFlag&&this._projectionUpdateFlag===t.updateFlag)&&(this._viewUpdateFlag=e.updateFlag,this._projectionUpdateFlag=t.updateFlag,this._viewMatrix=e,this._projectionMatrix=t,this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._frustumPlanes?Ji.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=Ji.GetPlanes(this._transformMatrix),this._multiviewSceneUbo&&this._multiviewSceneUbo.useUbo?this._updateMultiviewUbo(i,s):this._sceneUbo.useUbo&&(this._sceneUbo.updateMatrix("viewProjection",this._transformMatrix),this._sceneUbo.updateMatrix("view",this._viewMatrix),this._sceneUbo.updateMatrix("projection",this._projectionMatrix)))}getSceneUniformBuffer(){return this._multiviewSceneUbo?this._multiviewSceneUbo:this._sceneUbo}createSceneUniformBuffer(e){const t=new ce(this._engine,void 0,!1,e??"scene");return t.addUniform("viewProjection",16),t.addUniform("view",16),t.addUniform("projection",16),t.addUniform("vEyePosition",4),t}setSceneUniformBuffer(e){this._sceneUbo=e,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1}getUniqueId(){return Wv.UniqueId}addMesh(e,t=!1){this._blockEntityCollection||(this.meshes.push(e),e._resyncLightSources(),e.parent||e._addToSceneRootNodes(),Z.SetImmediate(()=>{this.onNewMeshAddedObservable.notifyObservers(e)}),t&&e.getChildMeshes().forEach(i=>{this.addMesh(i)}))}removeMesh(e,t=!1){const i=this.meshes.indexOf(e);return i!==-1&&(this.meshes.splice(i,1),e.parent||e._removeFromSceneRootNodes()),this._inputManager._invalidateMesh(e),this.onMeshRemovedObservable.notifyObservers(e),t&&e.getChildMeshes().forEach(s=>{this.removeMesh(s)}),i}addTransformNode(e){this._blockEntityCollection||e.getScene()===this&&e._indexInSceneTransformNodesArray!==-1||(e._indexInSceneTransformNodesArray=this.transformNodes.length,this.transformNodes.push(e),e.parent||e._addToSceneRootNodes(),this.onNewTransformNodeAddedObservable.notifyObservers(e))}removeTransformNode(e){const t=e._indexInSceneTransformNodesArray;if(t!==-1){if(t!==this.transformNodes.length-1){const i=this.transformNodes[this.transformNodes.length-1];this.transformNodes[t]=i,i._indexInSceneTransformNodesArray=t}e._indexInSceneTransformNodesArray=-1,this.transformNodes.pop(),e.parent||e._removeFromSceneRootNodes()}return this.onTransformNodeRemovedObservable.notifyObservers(e),t}removeSkeleton(e){const t=this.skeletons.indexOf(e);return t!==-1&&(this.skeletons.splice(t,1),this.onSkeletonRemovedObservable.notifyObservers(e),this._executeActiveContainerCleanup(this._activeSkeletons)),t}removeMorphTargetManager(e){const t=this.morphTargetManagers.indexOf(e);return t!==-1&&this.morphTargetManagers.splice(t,1),t}removeLight(e){const t=this.lights.indexOf(e);if(t!==-1){for(const i of this.meshes)i._removeLightSource(e,!1);this.lights.splice(t,1),this.sortLightsByPriority(),e.parent||e._removeFromSceneRootNodes()}return this.onLightRemovedObservable.notifyObservers(e),t}removeCamera(e){const t=this.cameras.indexOf(e);if(t!==-1&&(this.cameras.splice(t,1),e.parent||e._removeFromSceneRootNodes()),this.activeCameras){const i=this.activeCameras.indexOf(e);i!==-1&&this.activeCameras.splice(i,1)}return this.activeCamera===e&&(this.cameras.length>0?this.activeCamera=this.cameras[0]:this.activeCamera=null),this.onCameraRemovedObservable.notifyObservers(e),t}removeParticleSystem(e){const t=this.particleSystems.indexOf(e);return t!==-1&&(this.particleSystems.splice(t,1),this._executeActiveContainerCleanup(this._activeParticleSystems)),t}removeAnimation(e){const t=this.animations.indexOf(e);return t!==-1&&this.animations.splice(t,1),t}stopAnimation(e,t,i){}removeAnimationGroup(e){const t=this.animationGroups.indexOf(e);return t!==-1&&this.animationGroups.splice(t,1),t}removeMultiMaterial(e){const t=this.multiMaterials.indexOf(e);return t!==-1&&this.multiMaterials.splice(t,1),this.onMultiMaterialRemovedObservable.notifyObservers(e),t}removeMaterial(e){const t=e._indexInSceneMaterialArray;if(t!==-1&&t<this.materials.length){if(t!==this.materials.length-1){const i=this.materials[this.materials.length-1];this.materials[t]=i,i._indexInSceneMaterialArray=t}e._indexInSceneMaterialArray=-1,this.materials.pop()}return this.onMaterialRemovedObservable.notifyObservers(e),t}removeActionManager(e){const t=this.actionManagers.indexOf(e);return t!==-1&&this.actionManagers.splice(t,1),t}removeTexture(e){const t=this.textures.indexOf(e);return t!==-1&&this.textures.splice(t,1),this.onTextureRemovedObservable.notifyObservers(e),t}addLight(e){if(!this._blockEntityCollection){this.lights.push(e),this.sortLightsByPriority(),e.parent||e._addToSceneRootNodes();for(const t of this.meshes)t.lightSources.indexOf(e)===-1&&(t.lightSources.push(e),t._resyncLightSources());Z.SetImmediate(()=>{this.onNewLightAddedObservable.notifyObservers(e)})}}sortLightsByPriority(){this.requireLightSorting&&this.lights.sort(He.CompareLightsPriority)}addCamera(e){this._blockEntityCollection||(this.cameras.push(e),Z.SetImmediate(()=>{this.onNewCameraAddedObservable.notifyObservers(e)}),e.parent||e._addToSceneRootNodes())}addSkeleton(e){this._blockEntityCollection||(this.skeletons.push(e),Z.SetImmediate(()=>{this.onNewSkeletonAddedObservable.notifyObservers(e)}))}addParticleSystem(e){this._blockEntityCollection||this.particleSystems.push(e)}addAnimation(e){this._blockEntityCollection||this.animations.push(e)}addAnimationGroup(e){this._blockEntityCollection||this.animationGroups.push(e)}addMultiMaterial(e){this._blockEntityCollection||(this.multiMaterials.push(e),Z.SetImmediate(()=>{this.onNewMultiMaterialAddedObservable.notifyObservers(e)}))}addMaterial(e){this._blockEntityCollection||e.getScene()===this&&e._indexInSceneMaterialArray!==-1||(e._indexInSceneMaterialArray=this.materials.length,this.materials.push(e),Z.SetImmediate(()=>{this.onNewMaterialAddedObservable.notifyObservers(e)}))}addMorphTargetManager(e){this._blockEntityCollection||this.morphTargetManagers.push(e)}addGeometry(e){this._blockEntityCollection||(this._geometriesByUniqueId&&(this._geometriesByUniqueId[e.uniqueId]=this.geometries.length),this.geometries.push(e))}addActionManager(e){this.actionManagers.push(e)}addTexture(e){this._blockEntityCollection||(this.textures.push(e),this.onNewTextureAddedObservable.notifyObservers(e))}switchActiveCamera(e,t=!0){this._engine.getInputElement()&&(this.activeCamera&&this.activeCamera.detachControl(),this.activeCamera=e,t&&e.attachControl())}setActiveCameraById(e){const t=this.getCameraById(e);return t?(this.activeCamera=t,t):null}setActiveCameraByName(e){const t=this.getCameraByName(e);return t?(this.activeCamera=t,t):null}getAnimationGroupByName(e){for(let t=0;t<this.animationGroups.length;t++)if(this.animationGroups[t].name===e)return this.animationGroups[t];return null}_getMaterial(e,t){for(let i=0;i<this.materials.length;i++){const s=this.materials[i];if(t(s))return s}if(e)for(let i=0;i<this.multiMaterials.length;i++){const s=this.multiMaterials[i];if(t(s))return s}return null}getMaterialByUniqueID(e,t=!1){return this._getMaterial(t,i=>i.uniqueId===e)}getMaterialById(e,t=!1){return this._getMaterial(t,i=>i.id===e)}getMaterialByName(e,t=!1){return this._getMaterial(t,i=>i.name===e)}getLastMaterialById(e,t=!1){for(let i=this.materials.length-1;i>=0;i--)if(this.materials[i].id===e)return this.materials[i];if(t){for(let i=this.multiMaterials.length-1;i>=0;i--)if(this.multiMaterials[i].id===e)return this.multiMaterials[i]}return null}getTextureByUniqueId(e){for(let t=0;t<this.textures.length;t++)if(this.textures[t].uniqueId===e)return this.textures[t];return null}getTextureByName(e){for(let t=0;t<this.textures.length;t++)if(this.textures[t].name===e)return this.textures[t];return null}getCameraById(e){for(let t=0;t<this.cameras.length;t++)if(this.cameras[t].id===e)return this.cameras[t];return null}getCameraByUniqueId(e){for(let t=0;t<this.cameras.length;t++)if(this.cameras[t].uniqueId===e)return this.cameras[t];return null}getCameraByName(e){for(let t=0;t<this.cameras.length;t++)if(this.cameras[t].name===e)return this.cameras[t];return null}getBoneById(e){for(let t=0;t<this.skeletons.length;t++){const i=this.skeletons[t];for(let s=0;s<i.bones.length;s++)if(i.bones[s].id===e)return i.bones[s]}return null}getBoneByName(e){for(let t=0;t<this.skeletons.length;t++){const i=this.skeletons[t];for(let s=0;s<i.bones.length;s++)if(i.bones[s].name===e)return i.bones[s]}return null}getLightByName(e){for(let t=0;t<this.lights.length;t++)if(this.lights[t].name===e)return this.lights[t];return null}getLightById(e){for(let t=0;t<this.lights.length;t++)if(this.lights[t].id===e)return this.lights[t];return null}getLightByUniqueId(e){for(let t=0;t<this.lights.length;t++)if(this.lights[t].uniqueId===e)return this.lights[t];return null}getParticleSystemById(e){for(let t=0;t<this.particleSystems.length;t++)if(this.particleSystems[t].id===e)return this.particleSystems[t];return null}getGeometryById(e){for(let t=0;t<this.geometries.length;t++)if(this.geometries[t].id===e)return this.geometries[t];return null}_getGeometryByUniqueId(e){if(this._geometriesByUniqueId){const t=this._geometriesByUniqueId[e];if(t!==void 0)return this.geometries[t]}else for(let t=0;t<this.geometries.length;t++)if(this.geometries[t].uniqueId===e)return this.geometries[t];return null}getFrameGraphByName(e){for(let t=0;t<this.frameGraphs.length;t++)if(this.frameGraphs[t].name===e)return this.frameGraphs[t];return null}pushGeometry(e,t){return!t&&this._getGeometryByUniqueId(e.uniqueId)?!1:(this.addGeometry(e),Z.SetImmediate(()=>{this.onNewGeometryAddedObservable.notifyObservers(e)}),!0)}removeGeometry(e){let t;if(this._geometriesByUniqueId){if(t=this._geometriesByUniqueId[e.uniqueId],t===void 0)return!1}else if(t=this.geometries.indexOf(e),t<0)return!1;if(t!==this.geometries.length-1){const i=this.geometries[this.geometries.length-1];i&&(this.geometries[t]=i,this._geometriesByUniqueId&&(this._geometriesByUniqueId[i.uniqueId]=t))}return this._geometriesByUniqueId&&(this._geometriesByUniqueId[e.uniqueId]=void 0),this.geometries.pop(),this.onGeometryRemovedObservable.notifyObservers(e),!0}getGeometries(){return this.geometries}getMeshById(e){for(let t=0;t<this.meshes.length;t++)if(this.meshes[t].id===e)return this.meshes[t];return null}getMeshesById(e){return this.meshes.filter(function(t){return t.id===e})}getTransformNodeById(e){for(let t=0;t<this.transformNodes.length;t++)if(this.transformNodes[t].id===e)return this.transformNodes[t];return null}getTransformNodeByUniqueId(e){for(let t=0;t<this.transformNodes.length;t++)if(this.transformNodes[t].uniqueId===e)return this.transformNodes[t];return null}getTransformNodesById(e){return this.transformNodes.filter(function(t){return t.id===e})}getMeshByUniqueId(e){for(let t=0;t<this.meshes.length;t++)if(this.meshes[t].uniqueId===e)return this.meshes[t];return null}getLastMeshById(e){for(let t=this.meshes.length-1;t>=0;t--)if(this.meshes[t].id===e)return this.meshes[t];return null}getLastTransformNodeById(e){for(let t=this.transformNodes.length-1;t>=0;t--)if(this.transformNodes[t].id===e)return this.transformNodes[t];return null}getLastEntryById(e){let t;for(t=this.meshes.length-1;t>=0;t--)if(this.meshes[t].id===e)return this.meshes[t];for(t=this.transformNodes.length-1;t>=0;t--)if(this.transformNodes[t].id===e)return this.transformNodes[t];for(t=this.cameras.length-1;t>=0;t--)if(this.cameras[t].id===e)return this.cameras[t];for(t=this.lights.length-1;t>=0;t--)if(this.lights[t].id===e)return this.lights[t];return null}getNodeById(e){const t=this.getMeshById(e);if(t)return t;const i=this.getTransformNodeById(e);if(i)return i;const s=this.getLightById(e);if(s)return s;const r=this.getCameraById(e);if(r)return r;const a=this.getBoneById(e);return a||null}getNodeByName(e){const t=this.getMeshByName(e);if(t)return t;const i=this.getTransformNodeByName(e);if(i)return i;const s=this.getLightByName(e);if(s)return s;const r=this.getCameraByName(e);if(r)return r;const a=this.getBoneByName(e);return a||null}getMeshByName(e){for(let t=0;t<this.meshes.length;t++)if(this.meshes[t].name===e)return this.meshes[t];return null}getTransformNodeByName(e){for(let t=0;t<this.transformNodes.length;t++)if(this.transformNodes[t].name===e)return this.transformNodes[t];return null}getLastSkeletonById(e){for(let t=this.skeletons.length-1;t>=0;t--)if(this.skeletons[t].id===e)return this.skeletons[t];return null}getSkeletonByUniqueId(e){for(let t=0;t<this.skeletons.length;t++)if(this.skeletons[t].uniqueId===e)return this.skeletons[t];return null}getSkeletonById(e){for(let t=0;t<this.skeletons.length;t++)if(this.skeletons[t].id===e)return this.skeletons[t];return null}getSkeletonByName(e){for(let t=0;t<this.skeletons.length;t++)if(this.skeletons[t].name===e)return this.skeletons[t];return null}getMorphTargetManagerById(e){for(let t=0;t<this.morphTargetManagers.length;t++)if(this.morphTargetManagers[t].uniqueId===e)return this.morphTargetManagers[t];return null}getMorphTargetById(e){for(let t=0;t<this.morphTargetManagers.length;++t){const i=this.morphTargetManagers[t];for(let s=0;s<i.numTargets;++s){const r=i.getTarget(s);if(r.id===e)return r}}return null}getMorphTargetByName(e){for(let t=0;t<this.morphTargetManagers.length;++t){const i=this.morphTargetManagers[t];for(let s=0;s<i.numTargets;++s){const r=i.getTarget(s);if(r.name===e)return r}}return null}getPostProcessByName(e){for(let t=0;t<this.postProcesses.length;++t){const i=this.postProcesses[t];if(i.name===e)return i}return null}isActiveMesh(e){return this._activeMeshes.indexOf(e)!==-1}get uid(){return this._uid||(this._uid=Z.RandomId()),this._uid}addExternalData(e,t){return this._externalData||(this._externalData=new Ig),this._externalData.add(e,t)}getExternalData(e){return this._externalData?this._externalData.get(e):null}getOrAddExternalDataWithFactory(e,t){return this._externalData||(this._externalData=new Ig),this._externalData.getOrAddWithFactory(e,t)}removeExternalData(e){return this._externalData.remove(e)}_evaluateSubMesh(e,t,i,s){if(s||e.isInFrustum(this._frustumPlanes)){for(const a of this._evaluateSubMeshStage)a.action(t,e);const r=e.getMaterial();r!=null&&(r.hasRenderTargetTextures&&r.getRenderTargetTextures!=null&&this._processedMaterials.indexOf(r)===-1&&(this._processedMaterials.push(r),this._materialsRenderTargets.concatWithNoDuplicate(r.getRenderTargetTextures())),this._renderingManager.dispatch(e,t,r))}}freeProcessedMaterials(){this._processedMaterials.dispose()}get blockfreeActiveMeshesAndRenderingGroups(){return this._preventFreeActiveMeshesAndRenderingGroups}set blockfreeActiveMeshesAndRenderingGroups(e){this._preventFreeActiveMeshesAndRenderingGroups!==e&&(e&&(this.freeActiveMeshes(),this.freeRenderingGroups()),this._preventFreeActiveMeshesAndRenderingGroups=e)}freeActiveMeshes(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._activeMeshes.dispose(),this.activeCamera&&this.activeCamera._activeMeshes&&this.activeCamera._activeMeshes.dispose(),this.activeCameras))for(let e=0;e<this.activeCameras.length;e++){const t=this.activeCameras[e];t&&t._activeMeshes&&t._activeMeshes.dispose()}}freeRenderingGroups(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._renderingManager&&this._renderingManager.freeRenderingGroups(),this.textures))for(let e=0;e<this.textures.length;e++){const t=this.textures[e];t&&t.renderList&&t.freeRenderingGroups()}}_isInIntermediateRendering(){return this._intermediateRendering}freezeActiveMeshes(e=!1,t,i,s=!0,r=!1){return this.executeWhenReady(()=>{if(!this.activeCamera){i&&i("No active camera found");return}if(this._frustumPlanes||this.updateTransformMatrix(),this._evaluateActiveMeshes(),this._activeMeshesFrozen=!0,this._activeMeshesFrozenButKeepClipping=r,this._skipEvaluateActiveMeshesCompletely=e,s)for(let a=0;a<this._activeMeshes.length;a++)this._activeMeshes.data[a]._freeze();t&&t()}),this}unfreezeActiveMeshes(){for(let e=0;e<this.meshes.length;e++){const t=this.meshes[e];t._internalAbstractMeshDataInfo&&(t._internalAbstractMeshDataInfo._isActive=!1)}for(let e=0;e<this._activeMeshes.length;e++)this._activeMeshes.data[e]._unFreeze();return this._activeMeshesFrozen=!1,this}_executeActiveContainerCleanup(e){!(this._engine.snapshotRendering&&this._engine.snapshotRenderingMode===1)&&this._activeMeshesFrozen&&this._activeMeshes.length||this.onBeforeRenderObservable.addOnce(()=>e.dispose())}_evaluateActiveMeshes(){var i;if(this._engine.snapshotRendering&&this._engine.snapshotRenderingMode===1){this._activeMeshes.length>0&&((i=this.activeCamera)==null||i._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset());return}if(this._activeMeshesFrozen&&this._activeMeshes.length){if(!this._skipEvaluateActiveMeshesCompletely){const s=this._activeMeshes.length;for(let r=0;r<s;r++)this._activeMeshes.data[r].computeWorldMatrix()}if(this._activeParticleSystems){const s=this._activeParticleSystems.length;for(let r=0;r<s;r++)this._activeParticleSystems.data[r].animate()}this._renderingManager.resetSprites();return}if(!this.activeCamera)return;this.onBeforeActiveMeshesEvaluationObservable.notifyObservers(this),this.activeCamera._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset(),this._materialsRenderTargets.reset();for(const s of this._beforeEvaluateActiveMeshStage)s.action();const e=this.getActiveMeshCandidates(),t=e.length;for(let s=0;s<t;s++){const r=e.data[s];let a=r._internalAbstractMeshDataInfo._currentLOD.get(this.activeCamera);if(a?a[1]=-1:(a=[r,-1],r._internalAbstractMeshDataInfo._currentLOD.set(this.activeCamera,a)),r.isBlocked||(this._totalVertices.addCount(r.getTotalVertices(),!1),!r.isReady()||!r.isEnabled()||r.scaling.hasAZeroComponent))continue;r.computeWorldMatrix(),r.actionManager&&r.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(r);let o=this.customLODSelector?this.customLODSelector(r,this.activeCamera):r.getLOD(this.activeCamera);if(a[0]=o,a[1]=this._frameId,o!=null&&(o!==r&&o.billboardMode!==0&&o.computeWorldMatrix(),r._preActivate(),r.isVisible&&r.visibility>0&&r.layerMask&this.activeCamera.layerMask&&(this._skipFrustumClipping||r.alwaysSelectAsActiveMesh||r.isInFrustum(this._frustumPlanes)))){this._activeMeshes.push(r),this.activeCamera._activeMeshes.push(r),o!==r&&o._activate(this._renderId,!1);for(const l of this._preActiveMeshStage)l.action(r);r._activate(this._renderId,!1)&&(r.isAnInstance?r._internalAbstractMeshDataInfo._actAsRegularMesh&&(o=r):o._internalAbstractMeshDataInfo._onlyForInstances=!1,o._internalAbstractMeshDataInfo._isActive=!0,this._activeMesh(r,o)),r._postActivate()}}if(this.onAfterActiveMeshesEvaluationObservable.notifyObservers(this),this.particlesEnabled){this.onBeforeParticlesRenderingObservable.notifyObservers(this);for(let s=0;s<this.particleSystems.length;s++){const r=this.particleSystems[s];if(!r.isStarted()||!r.emitter)continue;const a=r.emitter;(!a.position||a.isEnabled())&&(this._activeParticleSystems.push(r),r.animate(),this._renderingManager.dispatchParticles(r))}this.onAfterParticlesRenderingObservable.notifyObservers(this)}}_prepareSkeleton(e){!this._skeletonsEnabled||!e.skeleton||(this._activeSkeletons.pushNoDuplicate(e.skeleton)&&(e.skeleton.prepare(),this._activeBones.addCount(e.skeleton.bones.length,!1)),e.computeBonesUsingShaders||this._softwareSkinnedMeshes.pushNoDuplicate(e)&&this.frameGraph&&e.applySkeleton(e.skeleton))}_activeMesh(e,t){this._prepareSkeleton(t);let i=e.hasInstances||e.isAnInstance||this.dispatchAllSubMeshesOfActiveMeshes||this._skipFrustumClipping||t.alwaysSelectAsActiveMesh;if(t&&t.subMeshes&&t.subMeshes.length>0){const s=this.getActiveSubMeshCandidates(t),r=s.length;i=i||r===1;for(let a=0;a<r;a++){const o=s.data[a];this._evaluateSubMesh(o,t,e,i)}}}updateTransformMatrix(e){const t=this.activeCamera;if(t)if(t._renderingMultiview){const i=t._rigCameras[0],s=t._rigCameras[1];this.setTransformMatrix(i.getViewMatrix(),i.getProjectionMatrix(e),s.getViewMatrix(),s.getProjectionMatrix(e))}else this.setTransformMatrix(t.getViewMatrix(),t.getProjectionMatrix(e))}_bindFrameBuffer(e,t=!0){this._useCurrentFrameBuffer||(e&&e._multiviewTexture?e._multiviewTexture._bindFrameBuffer():e&&e.outputRenderTarget?e.outputRenderTarget._bindFrameBuffer():this._engine._currentFrameBufferIsDefaultFrameBuffer()||this._engine.restoreDefaultFramebuffer()),t&&this._clearFrameBuffer(e)}_clearFrameBuffer(e){if(!(e&&e._multiviewTexture))if(e&&e.outputRenderTarget&&!e._renderingMultiview){const t=e.outputRenderTarget;t.onClearObservable.hasObservers()?t.onClearObservable.notifyObservers(this._engine):!t.skipInitialClear&&!e.isRightCamera&&(this.autoClear&&this._engine.clear(t.clearColor||this._clearColor,!t._cleared,!0,!0),t._cleared=!0)}else this._defaultFrameBufferCleared?this._engine.clear(null,!1,!0,!0):(this._defaultFrameBufferCleared=!0,this._clear())}_renderForCamera(e,t,i=!0){var a;if(e&&e._skipRendering)return;const s=this._engine;if(this._activeCamera=e,!this.activeCamera)throw new Error("Active camera not set");if(s.setViewport(this.activeCamera.viewport),this.resetCachedMaterial(),this._renderId++,!this.prePass&&i){let o=!0;e._renderingMultiview&&e.outputRenderTarget&&(o=e.outputRenderTarget.skipInitialClear,this.autoClear&&(this._defaultFrameBufferCleared=!1,e.outputRenderTarget.skipInitialClear=!1)),this._bindFrameBuffer(this._activeCamera),e._renderingMultiview&&e.outputRenderTarget&&(e.outputRenderTarget.skipInitialClear=o)}this.updateTransformMatrix(),this.onBeforeCameraRenderObservable.notifyObservers(this.activeCamera),this._evaluateActiveMeshes();for(let o=0;o<this._softwareSkinnedMeshes.length;o++){const l=this._softwareSkinnedMeshes.data[o];l.applySkeleton(l.skeleton)}this.onBeforeRenderTargetsRenderObservable.notifyObservers(this),this._renderTargets.concatWithNoDuplicate(this._materialsRenderTargets),e.customRenderTargets&&e.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(e.customRenderTargets),t&&t.customRenderTargets&&t.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(t.customRenderTargets),this.environmentTexture&&this.environmentTexture.isRenderTarget&&this._renderTargets.pushNoDuplicate(this.environmentTexture);for(const o of this._gatherActiveCameraRenderTargetsStage)o.action(this._renderTargets);let r=!1;if(this.renderTargetsEnabled){if(this._intermediateRendering=!0,this._renderTargets.length>0){Z.StartPerformanceCounter("Render targets",this._renderTargets.length>0);for(let o=0;o<this._renderTargets.length;o++){const l=this._renderTargets.data[o];if(l._shouldRender()){this._renderId++;const h=l.activeCamera&&l.activeCamera!==this.activeCamera;l.render(h,this.dumpNextRenderTargets),r=!0}}Z.EndPerformanceCounter("Render targets",this._renderTargets.length>0),this._renderId++}for(const o of this._cameraDrawRenderTargetStage)r=o.action(this.activeCamera)||r;this._intermediateRendering=!1}this._engine.currentRenderPassId=((a=e.outputRenderTarget)==null?void 0:a.renderPassId)??e.renderPassId??0,r&&!this.prePass&&(this._bindFrameBuffer(this._activeCamera,!1),this.updateTransformMatrix()),this.onAfterRenderTargetsRenderObservable.notifyObservers(this),this.postProcessManager&&!e._multiviewTexture&&!this.prePass&&this.postProcessManager._prepareFrame();for(const o of this._beforeCameraDrawStage)o.action(this.activeCamera);this.onBeforeDrawPhaseObservable.notifyObservers(this),s.snapshotRendering&&s.snapshotRenderingMode===1&&this.finalizeSceneUbo(),this._renderingManager.render(null,null,!0,!0),this.onAfterDrawPhaseObservable.notifyObservers(this);for(const o of this._afterCameraDrawStage)o.action(this.activeCamera);if(this.postProcessManager&&!e._multiviewTexture){const o=e.outputRenderTarget?e.outputRenderTarget.renderTarget:void 0;this.postProcessManager._finalizeFrame(e.isIntermediate,o)}for(const o of this._afterCameraPostProcessStage)o.action(this.activeCamera);this._renderTargets.reset(),this.onAfterCameraRenderObservable.notifyObservers(this.activeCamera)}_processSubCameras(e,t=!0){if(e.cameraRigMode===0||e._renderingMultiview){e._renderingMultiview&&!this._multiviewSceneUbo&&this._createMultiviewUbo(),this._renderForCamera(e,void 0,t),this.onAfterRenderCameraObservable.notifyObservers(e);return}if(e._useMultiviewToSingleView)this._renderMultiviewToSingleView(e);else{this.onBeforeCameraRenderObservable.notifyObservers(e);for(let i=0;i<e._rigCameras.length;i++)this._renderForCamera(e._rigCameras[i],e)}this._activeCamera=e,this.updateTransformMatrix(),this.onAfterRenderCameraObservable.notifyObservers(e)}_checkIntersections(){for(let e=0;e<this._meshesForIntersections.length;e++){const t=this._meshesForIntersections.data[e];if(t.actionManager)for(let i=0;t.actionManager&&i<t.actionManager.actions.length;i++){const s=t.actionManager.actions[i];if(s.trigger===12||s.trigger===13){const r=s.getTriggerParameter(),a=r.mesh?r.mesh:r,o=a.intersectsMesh(t,r.usePreciseIntersection),l=t._intersectionsInProgress.indexOf(a);o&&l===-1?s.trigger===12?(s._executeCurrent(Xt.CreateNew(t,void 0,a)),t._intersectionsInProgress.push(a)):s.trigger===13&&t._intersectionsInProgress.push(a):!o&&l>-1&&(s.trigger===13&&s._executeCurrent(Xt.CreateNew(t,void 0,a)),(!t.actionManager.hasSpecificTrigger(13,h=>{const u=h.mesh?h.mesh:h;return a===u})||s.trigger===13)&&t._intersectionsInProgress.splice(l,1))}}}}_advancePhysicsEngineStep(e){}_animate(e){}animate(){if(this._engine.isDeterministicLockStep()){let e=Math.max(Je.MinDeltaTime,Math.min(this._engine.getDeltaTime(),Je.MaxDeltaTime))+this._timeAccumulator;const t=this._engine.getTimeStep(),i=1e3/t/1e3;let s=0;const r=this._engine.getLockstepMaxSteps();let a=Math.floor(e/t);for(a=Math.min(a,r);e>0&&s<a;)this.onBeforeStepObservable.notifyObservers(this),this._animationRatio=t*i,this._animate(t),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(t),this.onAfterStepObservable.notifyObservers(this),this._currentStepId++,s++,e-=t;this._timeAccumulator=e<0?0:e}else{const e=this.useConstantAnimationDeltaTime?16:Math.max(Je.MinDeltaTime,Math.min(this._engine.getDeltaTime(),Je.MaxDeltaTime));this._animationRatio=e*(60/1e3),this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(e)}}_clear(){(this.autoClearDepthAndStencil||this.autoClear)&&this._engine.clear(this._clearColor,this.autoClear||this.forceWireframe||this.forcePointsCloud,this.autoClearDepthAndStencil,this.autoClearDepthAndStencil)}_checkCameraRenderTarget(e){var t;if(e!=null&&e.outputRenderTarget&&!(e!=null&&e.isRigCamera)&&(e.outputRenderTarget._cleared=!1),(t=e==null?void 0:e.rigCameras)!=null&&t.length)for(let i=0;i<e.rigCameras.length;++i){const s=e.rigCameras[i].outputRenderTarget;s&&(s._cleared=!1)}}resetDrawCache(e){if(this.meshes)for(const t of this.meshes)t.resetDrawCache(e)}_renderWithFrameGraph(e=!0,t=!1){var r;if(this.activeCamera=null,this._activeParticleSystems.reset(),this._activeSkeletons.reset(),e){for(const a of this.cameras)if(a.update(),a.cameraRigMode!==0)for(let o=0;o<a._rigCameras.length;o++)a._rigCameras[o].update()}for(const a of this._beforeClearStage)a.action();const i=this.getActiveMeshCandidates(),s=i.length;for(let a=0;a<s;a++){const o=i.data[a];o.isBlocked||(this._totalVertices.addCount(o.getTotalVertices(),!1),!(!o.isReady()||!o.isEnabled()||o.scaling.hasAZeroComponent)&&(o.computeWorldMatrix(),o.actionManager&&o.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(o)))}if(this.particlesEnabled)for(let a=0;a<this.particleSystems.length;a++){const o=this.particleSystems[a];if(!o.isStarted()||!o.emitter)continue;const l=o.emitter;(!l.position||l.isEnabled())&&(this._activeParticleSystems.push(o),o.animate())}(r=this.frameGraph)==null||r.execute()}render(e=!0,t=!1){var i,s;if(!this.isDisposed){this.onReadyObservable.hasObservers()&&this._executeWhenReadyTimeoutId===null&&this._checkIsReady(),this._frameId++,this._defaultFrameBufferCleared=!1,this._checkCameraRenderTarget(this.activeCamera),(i=this.activeCameras)!=null&&i.length&&this.activeCameras.forEach(this._checkCameraRenderTarget),this._registerTransientComponents(),this._activeParticles.fetchNewFrame(),this._totalVertices.fetchNewFrame(),this._activeIndices.fetchNewFrame(),this._activeBones.fetchNewFrame(),this._meshesForIntersections.reset(),this.resetCachedMaterial(),this.onBeforeAnimationsObservable.notifyObservers(this),this.actionManager&&this.actionManager.processTrigger(11),t||this.animate();for(const r of this._beforeCameraUpdateStage)r.action();if(e){if(this.activeCameras&&this.activeCameras.length>0)for(let r=0;r<this.activeCameras.length;r++){const a=this.activeCameras[r];if(a.update(),a.cameraRigMode!==0)for(let o=0;o<a._rigCameras.length;o++)a._rigCameras[o].update()}else if(this.activeCamera&&(this.activeCamera.update(),this.activeCamera.cameraRigMode!==0))for(let r=0;r<this.activeCamera._rigCameras.length;r++)this.activeCamera._rigCameras[r].update()}if(this.onBeforeRenderObservable.notifyObservers(this),this.customRenderFunction)this._renderId++,this._engine.currentRenderPassId=0,this.customRenderFunction(e,t);else{const r=this.getEngine();this.onBeforeRenderTargetsRenderObservable.notifyObservers(this);const a=(s=this.activeCameras)!=null&&s.length?this.activeCameras[0]:this.activeCamera;if(this.renderTargetsEnabled){Z.StartPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!0;for(let o=0;o<this.customRenderTargets.length;o++){const l=this.customRenderTargets[o];if(l._shouldRender()){if(this._renderId++,this.activeCamera=l.activeCamera||this.activeCamera,!this.activeCamera)throw new Error("Active camera not set");r.setViewport(this.activeCamera.viewport),this.updateTransformMatrix(),l.render(a!==this.activeCamera,this.dumpNextRenderTargets)}}Z.EndPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!1,this._renderId++}this._engine.currentRenderPassId=(a==null?void 0:a.renderPassId)??0,this.activeCamera=a,this._activeCamera&&this._activeCamera.cameraRigMode!==22&&!this.prePass&&this._bindFrameBuffer(this._activeCamera,!1),this.onAfterRenderTargetsRenderObservable.notifyObservers(this);for(const o of this._beforeClearStage)o.action();this._clearFrameBuffer(this.activeCamera);for(const o of this._gatherRenderTargetsStage)o.action(this._renderTargets);if(this.activeCameras&&this.activeCameras.length>0)for(let o=0;o<this.activeCameras.length;o++)this._processSubCameras(this.activeCameras[o],o>0);else{if(!this.activeCamera)throw new Error("No camera defined");this._processSubCameras(this.activeCamera,!!this.activeCamera.outputRenderTarget)}}this._checkIntersections();for(const r of this._afterRenderStage)r.action();if(this.afterRender&&this.afterRender(),this.onAfterRenderObservable.notifyObservers(this),this._toBeDisposed.length){for(let r=0;r<this._toBeDisposed.length;r++){const a=this._toBeDisposed[r];a&&a.dispose()}this._toBeDisposed.length=0}this.dumpNextRenderTargets&&(this.dumpNextRenderTargets=!1),this._activeBones.addCount(0,!0),this._activeIndices.addCount(0,!0),this._activeParticles.addCount(0,!0),this._engine.restoreDefaultFramebuffer()}}freezeMaterials(){for(let e=0;e<this.materials.length;e++)this.materials[e].freeze()}unfreezeMaterials(){for(let e=0;e<this.materials.length;e++)this.materials[e].unfreeze()}dispose(){if(this.isDisposed)return;this.beforeRender=null,this.afterRender=null,this.metadata=null,this.skeletons.length=0,this.morphTargetManagers.length=0,this._transientComponents.length=0,this._isReadyForMeshStage.clear(),this._beforeEvaluateActiveMeshStage.clear(),this._evaluateSubMeshStage.clear(),this._preActiveMeshStage.clear(),this._cameraDrawRenderTargetStage.clear(),this._beforeCameraDrawStage.clear(),this._beforeRenderTargetDrawStage.clear(),this._beforeRenderingGroupDrawStage.clear(),this._beforeRenderingMeshStage.clear(),this._afterRenderingMeshStage.clear(),this._afterRenderingGroupDrawStage.clear(),this._afterCameraDrawStage.clear(),this._afterRenderTargetDrawStage.clear(),this._afterRenderStage.clear(),this._beforeCameraUpdateStage.clear(),this._beforeClearStage.clear(),this._gatherRenderTargetsStage.clear(),this._gatherActiveCameraRenderTargetsStage.clear(),this._pointerMoveStage.clear(),this._pointerDownStage.clear(),this._pointerUpStage.clear(),this.importedMeshesFiles=[],this._activeAnimatables&&this.stopAllAnimations&&(this._activeAnimatables.forEach(r=>{r.onAnimationEndObservable.clear(),r.onAnimationEnd=null}),this.stopAllAnimations()),this.resetCachedMaterial(),this.activeCamera&&(this.activeCamera._activeMeshes.dispose(),this.activeCamera=null),this.activeCameras=null,this._activeMeshes.dispose(),this._renderingManager.dispose(),this._processedMaterials.dispose(),this._activeParticleSystems.dispose(),this._activeSkeletons.dispose(),this._softwareSkinnedMeshes.dispose(),this._renderTargets.dispose(),this._materialsRenderTargets.dispose(),this._registeredForLateAnimationBindings.dispose(),this._meshesForIntersections.dispose(),this._toBeDisposed.length=0;const e=this._activeRequests.slice();for(const r of e)r.abort();this._activeRequests.length=0;try{this.onDisposeObservable.notifyObservers(this)}catch(r){U.Error("An error occurred while calling onDisposeObservable!",r)}if(this.detachControl(),this._engine.getInputElement())for(let r=0;r<this.cameras.length;r++)this.cameras[r].detachControl();this._disposeList(this.animationGroups),this._disposeList(this.lights),this._defaultMaterial&&this._defaultMaterial.dispose(),this._disposeList(this.multiMaterials),this._disposeList(this.materials),this._disposeList(this.meshes,r=>r.dispose(!0)),this._disposeList(this.transformNodes,r=>r.dispose(!0));const i=this.cameras;this._disposeList(i),this._disposeList(this.particleSystems),this._disposeList(this.postProcesses),this._disposeList(this.textures),this._disposeList(this.morphTargetManagers),this._sceneUbo.dispose(),this._multiviewSceneUbo&&this._multiviewSceneUbo.dispose(),this.postProcessManager.dispose(),this._disposeList(this._components);let s=this._engine.scenes.indexOf(this);if(s>-1&&this._engine.scenes.splice(s,1),Ae._LastCreatedScene===this){Ae._LastCreatedScene=null;let r=Ae.Instances.length-1;for(;r>=0;){const a=Ae.Instances[r];if(a.scenes.length>0){Ae._LastCreatedScene=a.scenes[this._engine.scenes.length-1];break}r--}}s=this._engine._virtualScenes.indexOf(this),s>-1&&this._engine._virtualScenes.splice(s,1),this._engine.wipeCaches(!0),this.onDisposeObservable.clear(),this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderTargetsRenderObservable.clear(),this.onAfterRenderTargetsRenderObservable.clear(),this.onAfterStepObservable.clear(),this.onBeforeStepObservable.clear(),this.onBeforeActiveMeshesEvaluationObservable.clear(),this.onAfterActiveMeshesEvaluationObservable.clear(),this.onBeforeParticlesRenderingObservable.clear(),this.onAfterParticlesRenderingObservable.clear(),this.onBeforeDrawPhaseObservable.clear(),this.onAfterDrawPhaseObservable.clear(),this.onBeforeAnimationsObservable.clear(),this.onAfterAnimationsObservable.clear(),this.onDataLoadedObservable.clear(),this.onBeforeRenderingGroupObservable.clear(),this.onAfterRenderingGroupObservable.clear(),this.onMeshImportedObservable.clear(),this.onBeforeCameraRenderObservable.clear(),this.onAfterCameraRenderObservable.clear(),this.onAfterRenderCameraObservable.clear(),this.onReadyObservable.clear(),this.onNewCameraAddedObservable.clear(),this.onCameraRemovedObservable.clear(),this.onNewLightAddedObservable.clear(),this.onLightRemovedObservable.clear(),this.onNewGeometryAddedObservable.clear(),this.onGeometryRemovedObservable.clear(),this.onNewTransformNodeAddedObservable.clear(),this.onTransformNodeRemovedObservable.clear(),this.onNewMeshAddedObservable.clear(),this.onMeshRemovedObservable.clear(),this.onNewSkeletonAddedObservable.clear(),this.onSkeletonRemovedObservable.clear(),this.onNewMaterialAddedObservable.clear(),this.onNewMultiMaterialAddedObservable.clear(),this.onMaterialRemovedObservable.clear(),this.onMultiMaterialRemovedObservable.clear(),this.onNewTextureAddedObservable.clear(),this.onTextureRemovedObservable.clear(),this.onPrePointerObservable.clear(),this.onPointerObservable.clear(),this.onPreKeyboardObservable.clear(),this.onKeyboardObservable.clear(),this.onActiveCameraChanged.clear(),this.onScenePerformancePriorityChangedObservable.clear(),this.onClearColorChangedObservable.clear(),this.onEnvironmentTextureChangedObservable.clear(),this.onMeshUnderPointerUpdatedObservable.clear(),this._isDisposed=!0}_disposeList(e,t){const i=e.slice(0);t=t??(s=>s.dispose());for(const s of i)t(s);e.length=0}get isDisposed(){return this._isDisposed}clearCachedVertexData(){for(let e=0;e<this.meshes.length;e++){const i=this.meshes[e].geometry;i&&i.clearCachedData()}}cleanCachedTextureBuffer(){for(const e of this.textures)e._buffer&&(e._buffer=null)}getWorldExtends(e){const t=new y(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),i=new y(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return e=e||(()=>!0),this.meshes.filter(e).forEach(s=>{if(s.computeWorldMatrix(!0),!s.subMeshes||s.subMeshes.length===0||s.infiniteDistance)return;const r=s.getBoundingInfo(),a=r.boundingBox.minimumWorld,o=r.boundingBox.maximumWorld;y.CheckExtends(a,t,i),y.CheckExtends(o,t,i)}),{min:t,max:i}}createPickingRay(e,t,i,s,r=!1){throw Ee("Ray")}createPickingRayToRef(e,t,i,s,r,a=!1,o=!1){throw Ee("Ray")}createPickingRayInCameraSpace(e,t,i){throw Ee("Ray")}createPickingRayInCameraSpaceToRef(e,t,i,s){throw Ee("Ray")}pick(e,t,i,s,r,a){const o=Ee("Ray",!0);return o&&U.Warn(o),new xn}pickWithBoundingInfo(e,t,i,s,r){const a=Ee("Ray",!0);return a&&U.Warn(a),new xn}pickWithRay(e,t,i,s){throw Ee("Ray")}multiPick(e,t,i,s,r){throw Ee("Ray")}multiPickWithRay(e,t,i){throw Ee("Ray")}setPointerOverMesh(e,t,i){this._inputManager.setPointerOverMesh(e,t,i)}getPointerOverMesh(){return this._inputManager.getPointerOverMesh()}_rebuildGeometries(){for(const e of this.geometries)e._rebuild();for(const e of this.meshes)e._rebuild();this.postProcessManager&&this.postProcessManager._rebuild();for(const e of this._components)e.rebuild();for(const e of this.particleSystems)e.rebuild();if(this.spriteManagers)for(const e of this.spriteManagers)e.rebuild()}_rebuildTextures(){for(const e of this.textures)e._rebuild(!0);this.markAllMaterialsAsDirty(1)}_getByTags(e,t,i){if(t===void 0)return e;const s=[];for(const r in e){const a=e[r];Ve&&Ve.MatchesQuery(a,t)&&(!i||i(a))&&s.push(a)}return s}getMeshesByTags(e,t){return this._getByTags(this.meshes,e,t)}getCamerasByTags(e,t){return this._getByTags(this.cameras,e,t)}getLightsByTags(e,t){return this._getByTags(this.lights,e,t)}getMaterialByTags(e,t){return this._getByTags(this.materials,e,t).concat(this._getByTags(this.multiMaterials,e,t))}getTransformNodesByTags(e,t){return this._getByTags(this.transformNodes,e,t)}setRenderingOrder(e,t=null,i=null,s=null){this._renderingManager.setRenderingOrder(e,t,i,s)}setRenderingAutoClearDepthStencil(e,t,i=!0,s=!0){this._renderingManager.setRenderingAutoClearDepthStencil(e,t,i,s)}getAutoClearDepthStencilSetup(e){return this._renderingManager.getAutoClearDepthStencilSetup(e)}_forceBlockMaterialDirtyMechanism(e){this._blockMaterialDirtyMechanism=e}get blockMaterialDirtyMechanism(){return this._blockMaterialDirtyMechanism}set blockMaterialDirtyMechanism(e){this._blockMaterialDirtyMechanism!==e&&(this._blockMaterialDirtyMechanism=e,e||this.markAllMaterialsAsDirty(127))}markAllMaterialsAsDirty(e,t){if(!this._blockMaterialDirtyMechanism)for(const i of this.materials)t&&!t(i)||i.markAsDirty(e)}_loadFile(e,t,i,s,r,a,o){const l=Qn(e,t,i,s?this.offlineProvider:void 0,r,a,o);return this._activeRequests.push(l),l.onCompleteObservable.add(h=>{this._activeRequests.splice(this._activeRequests.indexOf(h),1)}),l}_loadFileAsync(e,t,i,s,r){return new Promise((a,o)=>{this._loadFile(e,l=>{a(l)},t,i,s,(l,h)=>{o(h)},r)})}_requestFile(e,t,i,s,r,a,o){const l=ld(e,t,i,s?this.offlineProvider:void 0,r,a,o);return this._activeRequests.push(l),l.onCompleteObservable.add(h=>{this._activeRequests.splice(this._activeRequests.indexOf(h),1)}),l}_requestFileAsync(e,t,i,s,r){return new Promise((a,o)=>{this._requestFile(e,l=>{a(l)},t,i,s,l=>{o(l)},r)})}_readFile(e,t,i,s,r){const a=Xo(e,t,i,s,r);return this._activeRequests.push(a),a.onCompleteObservable.add(o=>{this._activeRequests.splice(this._activeRequests.indexOf(o),1)}),a}_readFileAsync(e,t,i){return new Promise((s,r)=>{this._readFile(e,a=>{s(a)},t,i,a=>{r(a)})})}getPerfCollector(){throw Ee("performanceViewerSceneExtension")}setActiveCameraByID(e){return this.setActiveCameraById(e)}getMaterialByID(e){return this.getMaterialById(e)}getLastMaterialByID(e){return this.getLastMaterialById(e)}getTextureByUniqueID(e){return this.getTextureByUniqueId(e)}getCameraByID(e){return this.getCameraById(e)}getCameraByUniqueID(e){return this.getCameraByUniqueId(e)}getBoneByID(e){return this.getBoneById(e)}getLightByID(e){return this.getLightById(e)}getLightByUniqueID(e){return this.getLightByUniqueId(e)}getParticleSystemByID(e){return this.getParticleSystemById(e)}getGeometryByID(e){return this.getGeometryById(e)}getMeshByID(e){return this.getMeshById(e)}getMeshByUniqueID(e){return this.getMeshByUniqueId(e)}getLastMeshByID(e){return this.getLastMeshById(e)}getMeshesByID(e){return this.getMeshesById(e)}getTransformNodeByID(e){return this.getTransformNodeById(e)}getTransformNodeByUniqueID(e){return this.getTransformNodeByUniqueId(e)}getTransformNodesByID(e){return this.getTransformNodesById(e)}getNodeByID(e){return this.getNodeById(e)}getLastEntryByID(e){return this.getLastEntryById(e)}getLastSkeletonByID(e){return this.getLastSkeletonById(e)}}Je.FOGMODE_NONE=0;Je.FOGMODE_EXP=1;Je.FOGMODE_EXP2=2;Je.FOGMODE_LINEAR=3;Je.MinDeltaTime=1;Je.MaxDeltaTime=1e3;Je._OriginalDefaultMaterialFactory=Je.DefaultMaterialFactory;Tt("BABYLON.Scene",Je);class be extends Rt{get position(){return this._position}set position(e){this._position=e}set upVector(e){this._upVector=e}get upVector(){return this._upVector}get screenArea(){let e=0,t=0;if(this.mode===be.PERSPECTIVE_CAMERA)this.fovMode===be.FOVMODE_VERTICAL_FIXED?(t=this.minZ*2*Math.tan(this.fov/2),e=this.getEngine().getAspectRatio(this)*t):(e=this.minZ*2*Math.tan(this.fov/2),t=e/this.getEngine().getAspectRatio(this));else{const i=this.getEngine().getRenderWidth()/2,s=this.getEngine().getRenderHeight()/2;e=(this.orthoRight??i)-(this.orthoLeft??-i),t=(this.orthoTop??s)-(this.orthoBottom??-s)}return e*t}set orthoLeft(e){this._orthoLeft=e;for(const t of this._rigCameras)t.orthoLeft=e}get orthoLeft(){return this._orthoLeft}set orthoRight(e){this._orthoRight=e;for(const t of this._rigCameras)t.orthoRight=e}get orthoRight(){return this._orthoRight}set orthoBottom(e){this._orthoBottom=e;for(const t of this._rigCameras)t.orthoBottom=e}get orthoBottom(){return this._orthoBottom}set orthoTop(e){this._orthoTop=e;for(const t of this._rigCameras)t.orthoTop=e}get orthoTop(){return this._orthoTop}set mode(e){this._mode=e;for(const t of this._rigCameras)t.mode=e}get mode(){return this._mode}get hasMoved(){return this._hasMoved}constructor(e,t,i,s=!0){super(e,i,!1),this._position=y.Zero(),this._upVector=y.Up(),this.oblique=null,this._orthoLeft=null,this._orthoRight=null,this._orthoBottom=null,this._orthoTop=null,this.fov=.8,this.projectionPlaneTilt=0,this.minZ=1,this.maxZ=1e4,this.inertia=.9,this._mode=be.PERSPECTIVE_CAMERA,this.isIntermediate=!1,this.viewport=new Ca(0,0,1,1),this.layerMask=268435455,this.fovMode=be.FOVMODE_VERTICAL_FIXED,this.cameraRigMode=be.RIG_MODE_NONE,this.customRenderTargets=[],this.outputRenderTarget=null,this.onViewMatrixChangedObservable=new q,this.onProjectionMatrixChangedObservable=new q,this.onAfterCheckInputsObservable=new q,this.onRestoreStateObservable=new q,this.isRigCamera=!1,this._hasMoved=!1,this._rigCameras=new Array,this._skipRendering=!1,this._projectionMatrix=new L,this._postProcesses=new Array,this._activeMeshes=new ti(256),this._globalPosition=y.Zero(),this._computedViewMatrix=L.Identity(),this._doNotComputeProjectionMatrix=!1,this._transformMatrix=L.Zero(),this._refreshFrustumPlanes=!0,this._absoluteRotation=se.Identity(),this._isCamera=!0,this._isLeftCamera=!1,this._isRightCamera=!1,this.getScene().addCamera(this),s&&!this.getScene().activeCamera&&(this.getScene().activeCamera=this),this.position=t,this.renderPassId=this.getScene().getEngine().createRenderPassId(`Camera ${e}`)}storeState(){return this._stateStored=!0,this._storedFov=this.fov,this}hasStateStored(){return!!this._stateStored}_restoreStateValues(){return this._stateStored?(this.fov=this._storedFov,!0):!1}restoreState(){return this._restoreStateValues()?(this.onRestoreStateObservable.notifyObservers(this),!0):!1}getClassName(){return"Camera"}toString(e){let t="Name: "+this.name;if(t+=", type: "+this.getClassName(),this.animations)for(let i=0;i<this.animations.length;i++)t+=", animation[0]: "+this.animations[i].toString(e);return t}applyVerticalCorrection(){const e=this.absoluteRotation.toEulerAngles();this.projectionPlaneTilt=this._scene.useRightHandedSystem?-e.x:e.x}get globalPosition(){return this._globalPosition}getActiveMeshes(){return this._activeMeshes}isActiveMesh(e){return this._activeMeshes.indexOf(e)!==-1}isReady(e=!1){if(e){for(const t of this._postProcesses)if(t&&!t.isReady())return!1}return super.isReady(e)}_initCache(){super._initCache(),this._cache.position=new y(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new y(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.minZ=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.fovMode=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.obliqueAngle=void 0,this._cache.obliqueLength=void 0,this._cache.obliqueOffset=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0}_updateCache(e){e||super._updateCache(),this._cache.position.copyFrom(this.position),this._cache.upVector.copyFrom(this.upVector)}_isSynchronized(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()}_isSynchronizedViewMatrix(){return super._isSynchronized()?this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent():!1}_isSynchronizedProjectionMatrix(){let e=this._cache.mode===this.mode&&this._cache.minZ===this.minZ&&this._cache.maxZ===this.maxZ;if(!e)return!1;const t=this.getEngine();return this.mode===be.PERSPECTIVE_CAMERA?e=this._cache.fov===this.fov&&this._cache.fovMode===this.fovMode&&this._cache.aspectRatio===t.getAspectRatio(this)&&this._cache.projectionPlaneTilt===this.projectionPlaneTilt:(e=this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===t.getRenderWidth()&&this._cache.renderHeight===t.getRenderHeight(),this.oblique&&(e=e&&this._cache.obliqueAngle===this.oblique.angle&&this._cache.obliqueLength===this.oblique.length&&this._cache.obliqueOffset===this.oblique.offset)),e}attachControl(e,t){}detachControl(e){}update(){this._hasMoved=!1,this._checkInputs(),this.cameraRigMode!==be.RIG_MODE_NONE&&this._updateRigCameras(),this.getViewMatrix(),this.getProjectionMatrix()}_checkInputs(){this.onAfterCheckInputsObservable.notifyObservers(this)}get rigCameras(){return this._rigCameras}get rigPostProcess(){return this._rigPostProcess}_getFirstPostProcess(){for(let e=0;e<this._postProcesses.length;e++)if(this._postProcesses[e]!==null)return this._postProcesses[e];return null}_cascadePostProcessesToRigCams(){const e=this._getFirstPostProcess();e&&e.markTextureDirty();for(let t=0,i=this._rigCameras.length;t<i;t++){const s=this._rigCameras[t],r=s._rigPostProcess;r?(r.getEffectName()==="pass"&&(s.isIntermediate=this._postProcesses.length===0),s._postProcesses=this._postProcesses.slice(0).concat(r),r.markTextureDirty()):s._postProcesses=this._postProcesses.slice(0)}}attachPostProcess(e,t=null){return!e.isReusable()&&this._postProcesses.indexOf(e)>-1?(U.Error("You're trying to reuse a post process not defined as reusable."),0):(t==null||t<0?this._postProcesses.push(e):this._postProcesses[t]===null?this._postProcesses[t]=e:this._postProcesses.splice(t,0,e),this._cascadePostProcessesToRigCams(),this._scene.prePassRenderer&&this._scene.prePassRenderer.markAsDirty(),this._postProcesses.indexOf(e))}detachPostProcess(e){const t=this._postProcesses.indexOf(e);t!==-1&&(this._postProcesses[t]=null),this._scene.prePassRenderer&&this._scene.prePassRenderer.markAsDirty(),this._cascadePostProcessesToRigCams()}getWorldMatrix(){return this._isSynchronizedViewMatrix()?this._worldMatrix:(this.getViewMatrix(),this._worldMatrix)}_getViewMatrix(){return L.Identity()}getViewMatrix(e){return!e&&this._isSynchronizedViewMatrix()?this._computedViewMatrix:(this._hasMoved=!0,this.updateCache(),this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.getScene().getRenderId(),this._childUpdateId++,this._refreshFrustumPlanes=!0,this._cameraRigParams&&this._cameraRigParams.vrPreViewMatrix&&this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._computedViewMatrix),this.parent&&this.parent.onViewMatrixChangedObservable&&this.parent.onViewMatrixChangedObservable.notifyObservers(this.parent),this.onViewMatrixChangedObservable.notifyObservers(this),this._computedViewMatrix.invertToRef(this._worldMatrix),this._computedViewMatrix)}freezeProjectionMatrix(e){this._doNotComputeProjectionMatrix=!0,e!==void 0&&(this._projectionMatrix=e)}unfreezeProjectionMatrix(){this._doNotComputeProjectionMatrix=!1}getProjectionMatrix(e){var r,a,o;if(this._doNotComputeProjectionMatrix||!e&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;this._cache.mode=this.mode,this._cache.minZ=this.minZ,this._cache.maxZ=this.maxZ,this._refreshFrustumPlanes=!0;const t=this.getEngine(),i=this.getScene(),s=t.useReverseDepthBuffer;if(this.mode===be.PERSPECTIVE_CAMERA){this._cache.fov=this.fov,this._cache.fovMode=this.fovMode,this._cache.aspectRatio=t.getAspectRatio(this),this._cache.projectionPlaneTilt=this.projectionPlaneTilt,this.minZ<=0&&(this.minZ=.1);let l;i.useRightHandedSystem?l=L.PerspectiveFovRHToRef:l=L.PerspectiveFovLHToRef,l(this.fov,t.getAspectRatio(this),s?this.maxZ:this.minZ,s?this.minZ:this.maxZ,this._projectionMatrix,this.fovMode===be.FOVMODE_VERTICAL_FIXED,t.isNDCHalfZRange,this.projectionPlaneTilt,s)}else{const l=t.getRenderWidth()/2,h=t.getRenderHeight()/2;i.useRightHandedSystem?this.oblique?L.ObliqueOffCenterRHToRef(this.orthoLeft??-l,this.orthoRight??l,this.orthoBottom??-h,this.orthoTop??h,s?this.maxZ:this.minZ,s?this.minZ:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,t.isNDCHalfZRange):L.OrthoOffCenterRHToRef(this.orthoLeft??-l,this.orthoRight??l,this.orthoBottom??-h,this.orthoTop??h,s?this.maxZ:this.minZ,s?this.minZ:this.maxZ,this._projectionMatrix,t.isNDCHalfZRange):this.oblique?L.ObliqueOffCenterLHToRef(this.orthoLeft??-l,this.orthoRight??l,this.orthoBottom??-h,this.orthoTop??h,s?this.maxZ:this.minZ,s?this.minZ:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,t.isNDCHalfZRange):L.OrthoOffCenterLHToRef(this.orthoLeft??-l,this.orthoRight??l,this.orthoBottom??-h,this.orthoTop??h,s?this.maxZ:this.minZ,s?this.minZ:this.maxZ,this._projectionMatrix,t.isNDCHalfZRange),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.obliqueAngle=(r=this.oblique)==null?void 0:r.angle,this._cache.obliqueLength=(a=this.oblique)==null?void 0:a.length,this._cache.obliqueOffset=(o=this.oblique)==null?void 0:o.offset,this._cache.renderWidth=t.getRenderWidth(),this._cache.renderHeight=t.getRenderHeight()}return this.onProjectionMatrixChangedObservable.notifyObservers(this),this._projectionMatrix}getTransformationMatrix(){return this._computedViewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._transformMatrix}_computeObliqueDistance(e){const t=this,i=this;return(t.radius||(i.target?y.Distance(this.position,i.target):this.position.length()))+e}_updateFrustumPlanes(){this._refreshFrustumPlanes&&(this.getTransformationMatrix(),this._frustumPlanes?Ji.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=Ji.GetPlanes(this._transformMatrix),this._refreshFrustumPlanes=!1)}isInFrustum(e,t=!1){if(this._updateFrustumPlanes(),t&&this.rigCameras.length>0){let i=!1;return this.rigCameras.forEach(s=>{s._updateFrustumPlanes(),i=i||e.isInFrustum(s._frustumPlanes)}),i}else return e.isInFrustum(this._frustumPlanes)}isCompletelyInFrustum(e){return this._updateFrustumPlanes(),e.isCompletelyInFrustum(this._frustumPlanes)}getForwardRay(e=100,t,i){throw Ee("Ray")}getForwardRayToRef(e,t=100,i,s){throw Ee("Ray")}dispose(e,t=!1){for(this.onViewMatrixChangedObservable.clear(),this.onProjectionMatrixChangedObservable.clear(),this.onAfterCheckInputsObservable.clear(),this.onRestoreStateObservable.clear(),this.inputs&&this.inputs.clear(),this.getScene().stopAnimation(this),this.getScene().removeCamera(this);this._rigCameras.length>0;){const s=this._rigCameras.pop();s&&s.dispose()}if(this._parentContainer){const s=this._parentContainer.cameras.indexOf(this);s>-1&&this._parentContainer.cameras.splice(s,1),this._parentContainer=null}if(this._rigPostProcess)this._rigPostProcess.dispose(this),this._rigPostProcess=null,this._postProcesses.length=0;else if(this.cameraRigMode!==be.RIG_MODE_NONE)this._rigPostProcess=null,this._postProcesses.length=0;else{let s=this._postProcesses.length;for(;--s>=0;){const r=this._postProcesses[s];r&&r.dispose(this)}}let i=this.customRenderTargets.length;for(;--i>=0;)this.customRenderTargets[i].dispose();this.customRenderTargets.length=0,this._activeMeshes.dispose(),this.getScene().getEngine().releaseRenderPassId(this.renderPassId),super.dispose(e,t)}get isLeftCamera(){return this._isLeftCamera}get isRightCamera(){return this._isRightCamera}get leftCamera(){return this._rigCameras.length<1?null:this._rigCameras[0]}get rightCamera(){return this._rigCameras.length<2?null:this._rigCameras[1]}getLeftTarget(){return this._rigCameras.length<1?null:this._rigCameras[0].getTarget()}getRightTarget(){return this._rigCameras.length<2?null:this._rigCameras[1].getTarget()}setCameraRigMode(e,t){if(this.cameraRigMode!==e){for(;this._rigCameras.length>0;){const i=this._rigCameras.pop();i&&i.dispose()}if(this.cameraRigMode=e,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=t.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=Z.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this.cameraRigMode!==be.RIG_MODE_NONE){const i=this.createRigCamera(this.name+"_L",0);i&&(i._isLeftCamera=!0);const s=this.createRigCamera(this.name+"_R",1);s&&(s._isRightCamera=!0),i&&s&&(this._rigCameras.push(i),this._rigCameras.push(s))}this._setRigMode(t),this._cascadePostProcessesToRigCams(),this.update()}}_setRigMode(e){}_getVRProjectionMatrix(){return L.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.minZ,this.maxZ,this._cameraRigParams.vrWorkMatrix,!0,this.getEngine().isNDCHalfZRange),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix}setCameraRigParameter(e,t){this._cameraRigParams||(this._cameraRigParams={}),this._cameraRigParams[e]=t,e==="interaxialDistance"&&(this._cameraRigParams.stereoHalfAngle=Z.ToRadians(t/.0637))}createRigCamera(e,t){return null}_updateRigCameras(){for(let e=0;e<this._rigCameras.length;e++)this._rigCameras[e].minZ=this.minZ,this._rigCameras[e].maxZ=this.maxZ,this._rigCameras[e].fov=this.fov,this._rigCameras[e].upVector.copyFrom(this.upVector);this.cameraRigMode===be.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)}_setupInputs(){}serialize(){const e=Ie.Serialize(this);return e.uniqueId=this.uniqueId,e.type=this.getClassName(),this.parent&&this.parent._serializeAsParent(e),this.inputs&&this.inputs.serialize(e),Ie.AppendSerializedAnimations(this,e),e.ranges=this.serializeAnimationRanges(),e.isEnabled=this.isEnabled(),e}clone(e,t=null){const i=Ie.Clone(be.GetConstructorFromName(this.getClassName(),e,this.getScene(),this.interaxialDistance,this.isStereoscopicSideBySide),this);return i.name=e,i.parent=t,this.onClonedObservable.notifyObservers(i),i}getDirection(e){const t=y.Zero();return this.getDirectionToRef(e,t),t}get absoluteRotation(){return this.getWorldMatrix().decompose(void 0,this._absoluteRotation),this._absoluteRotation}getDirectionToRef(e,t){y.TransformNormalToRef(e,this.getWorldMatrix(),t)}static GetConstructorFromName(e,t,i,s=0,r=!0){const a=Rt.Construct(e,t,i,{interaxial_distance:s,isStereoscopicSideBySide:r});return a||(()=>be._CreateDefaultParsedCamera(t,i))}computeWorldMatrix(){return this.getWorldMatrix()}static Parse(e,t){const i=e.type,s=be.GetConstructorFromName(i,e.name,t,e.interaxial_distance,e.isStereoscopicSideBySide),r=Ie.Parse(s,e,t);if(e.parentId!==void 0&&(r._waitingParentId=e.parentId),e.parentInstanceIndex!==void 0&&(r._waitingParentInstanceIndex=e.parentInstanceIndex),r.inputs&&(r.inputs.parse(e),r._setupInputs()),e.upVector&&(r.upVector=y.FromArray(e.upVector)),r.setPosition&&(r.position.copyFromFloats(0,0,0),r.setPosition(y.FromArray(e.position))),e.target&&r.setTarget&&r.setTarget(y.FromArray(e.target)),e.cameraRigMode){const a=e.interaxial_distance?{interaxialDistance:e.interaxial_distance}:{};r.setCameraRigMode(e.cameraRigMode,a)}if(e.animations){for(let a=0;a<e.animations.length;a++){const o=e.animations[a],l=Zn("BABYLON.Animation");l&&r.animations.push(l.Parse(o))}Rt.ParseAnimationRanges(r,e,t)}return e.autoAnimate&&t.beginAnimation(r,e.autoAnimateFrom,e.autoAnimateTo,e.autoAnimateLoop,e.autoAnimateSpeed||1),e.isEnabled!==void 0&&r.setEnabled(e.isEnabled),r}_calculateHandednessMultiplier(){let e=this.getScene().useRightHandedSystem?-1:1;return this.parent&&this.parent._getWorldMatrixDeterminant()<0&&(e*=-1),e}}be._CreateDefaultParsedCamera=(n,e)=>{throw Ee("UniversalCamera")};be.PERSPECTIVE_CAMERA=0;be.ORTHOGRAPHIC_CAMERA=1;be.FOVMODE_VERTICAL_FIXED=0;be.FOVMODE_HORIZONTAL_FIXED=1;be.RIG_MODE_NONE=0;be.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10;be.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11;be.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12;be.RIG_MODE_STEREOSCOPIC_OVERUNDER=13;be.RIG_MODE_STEREOSCOPIC_INTERLACED=14;be.RIG_MODE_VR=20;be.RIG_MODE_CUSTOM=22;be.ForceAttachControlToAlwaysPreventDefault=!1;P([cs("position")],be.prototype,"_position",void 0);P([cs("upVector")],be.prototype,"_upVector",void 0);P([B()],be.prototype,"orthoLeft",null);P([B()],be.prototype,"orthoRight",null);P([B()],be.prototype,"orthoBottom",null);P([B()],be.prototype,"orthoTop",null);P([B()],be.prototype,"fov",void 0);P([B()],be.prototype,"projectionPlaneTilt",void 0);P([B()],be.prototype,"minZ",void 0);P([B()],be.prototype,"maxZ",void 0);P([B()],be.prototype,"inertia",void 0);P([B()],be.prototype,"mode",null);P([B()],be.prototype,"layerMask",void 0);P([B()],be.prototype,"fovMode",void 0);P([B()],be.prototype,"cameraRigMode",void 0);P([B()],be.prototype,"interaxialDistance",void 0);P([B()],be.prototype,"isStereoscopicSideBySide",void 0);class Ct{static get ForceFullSceneLoadingForIncremental(){return Ct._ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(e){Ct._ForceFullSceneLoadingForIncremental=e}static get ShowLoadingScreen(){return Ct._ShowLoadingScreen}static set ShowLoadingScreen(e){Ct._ShowLoadingScreen=e}static get loggingLevel(){return Ct._LoggingLevel}static set loggingLevel(e){Ct._LoggingLevel=e}static get CleanBoneMatrixWeights(){return Ct._CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(e){Ct._CleanBoneMatrixWeights=e}}Ct._ForceFullSceneLoadingForIncremental=!1;Ct._ShowLoadingScreen=!0;Ct._CleanBoneMatrixWeights=!1;Ct._LoggingLevel=0;class Jt{get boundingBias(){return this._boundingBias}set boundingBias(e){this._boundingBias?this._boundingBias.copyFrom(e):this._boundingBias=e.clone(),this._updateBoundingInfo(!0,null)}static CreateGeometryForMesh(e){const t=new Jt(Jt.RandomId(),e.getScene());return t.applyToMesh(e),t}get meshes(){return this._meshes}constructor(e,t,i,s=!1,r=null){this.delayLoadState=0,this._totalVertices=0,this._isDisposed=!1,this._extend={minimum:new y(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),maximum:new y(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},this._indexBufferIsUpdatable=!1,this._positionsCache=[],this._parentContainer=null,this.useBoundingInfoFromGeometry=!1,this._scene=t||Ae.LastCreatedScene,this._scene&&(this.id=e,this.uniqueId=this._scene.getUniqueId(),this._engine=this._scene.getEngine(),this._meshes=[],this._vertexBuffers={},this._indices=[],this._updatable=s,i?this.setAllVerticesData(i,s):this._totalVertices=0,this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObjects={}),r&&(this.applyToMesh(r),r.computeWorldMatrix(!0)))}get extend(){return this._extend}getScene(){return this._scene}getEngine(){return this._engine}isReady(){return this.delayLoadState===1||this.delayLoadState===0}get doNotSerialize(){for(let e=0;e<this._meshes.length;e++)if(!this._meshes[e].doNotSerialize)return!1;return!0}_rebuild(){this._vertexArrayObjects&&(this._vertexArrayObjects={}),this._meshes.length!==0&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer"));const e=new Set;for(const t in this._vertexBuffers)e.add(this._vertexBuffers[t].getWrapperBuffer());e.forEach(t=>{t._rebuild()})}setAllVerticesData(e,t){e.applyToGeometry(this,t),this._notifyUpdate()}setVerticesData(e,t,i=!1,s){i&&Array.isArray(t)&&(t=new Float32Array(t));const r=new S(this._engine,t,e,{updatable:i,postponeInternalCreation:this._meshes.length===0,stride:s,label:"Geometry_"+this.id+"_"+e});this.setVerticesBuffer(r)}removeVerticesData(e){this._vertexBuffers[e]&&(this._vertexBuffers[e].dispose(),delete this._vertexBuffers[e]),this._vertexArrayObjects&&this._disposeVertexArrayObjects()}setVerticesBuffer(e,t=null,i=!0){const s=e.getKind();this._vertexBuffers[s]&&i&&this._vertexBuffers[s].dispose(),e._buffer&&e._buffer._increaseReferences(),this._vertexBuffers[s]=e;const r=this._meshes,a=r.length;if(s===S.PositionKind){this._totalVertices=t??e._maxVerticesCount,this._updateExtend(e.getFloatData(this._totalVertices)),this._resetPointsArrayCache();const o=this._extend&&this._extend.minimum||new y(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),l=this._extend&&this._extend.maximum||new y(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);for(let h=0;h<a;h++){const u=r[h];u.buildBoundingInfo(o,l),u._createGlobalSubMesh(u.isUnIndexed),u.computeWorldMatrix(!0),u.synchronizeInstances()}}this._notifyUpdate(s)}updateVerticesDataDirectly(e,t,i,s=!1){const r=this.getVertexBuffer(e);r&&(r.updateDirectly(t,i,s),this._notifyUpdate(e))}updateVerticesData(e,t,i=!1){const s=this.getVertexBuffer(e);s&&(s.update(t),e===S.PositionKind&&this._updateBoundingInfo(i,t),this._notifyUpdate(e))}_updateBoundingInfo(e,t){if(e&&this._updateExtend(t),this._resetPointsArrayCache(),e){const i=this._meshes;for(const s of i){s.hasBoundingInfo?s.getBoundingInfo().reConstruct(this._extend.minimum,this._extend.maximum):s.buildBoundingInfo(this._extend.minimum,this._extend.maximum);const r=s.subMeshes;for(const a of r)a.refreshBoundingInfo()}}}_bind(e,t,i,s){if(!e)return;t===void 0&&(t=this._indexBuffer);const r=this.getVertexBuffers();if(!r)return;if(t!=this._indexBuffer||!this._vertexArrayObjects&&!s){this._engine.bindBuffers(r,t,e,i);return}const a=s||this._vertexArrayObjects,o=this._engine;a[e.key]||(a[e.key]=o.recordVertexArrayObject(r,t,e,i)),o.bindVertexArrayObject(a[e.key],t)}getTotalVertices(){return this.isReady()?this._totalVertices:0}getVerticesData(e,t,i){const s=this.getVertexBuffer(e);return s?s.getFloatData(this._totalVertices,i||t&&this._meshes.length!==1):null}copyVerticesData(e,t){const i=this.getVertexBuffer(e);if(!i)return;t[e]||(t[e]=new Float32Array(this._totalVertices*i.getSize()));const s=i.getData();s&&O4(s,i.getSize(),i.type,i.byteOffset,i.byteStride,i.normalized,this._totalVertices,t[e])}isVertexBufferUpdatable(e){const t=this._vertexBuffers[e];return t?t.isUpdatable():!1}getVertexBuffer(e){return this.isReady()?this._vertexBuffers[e]:null}getVertexBuffers(){return this.isReady()?this._vertexBuffers:null}isVerticesDataPresent(e){return this._vertexBuffers?this._vertexBuffers[e]!==void 0:this._delayInfo?this._delayInfo.indexOf(e)!==-1:!1}getVerticesDataKinds(){const e=[];let t;if(!this._vertexBuffers&&this._delayInfo)for(t in this._delayInfo)e.push(t);else for(t in this._vertexBuffers)e.push(t);return e}updateIndices(e,t,i=!1){if(this._indexBuffer)if(!this._indexBufferIsUpdatable)this.setIndices(e,null,!0);else{const s=e.length!==this._indices.length;if(i||(this._indices=e.slice()),this._engine.updateDynamicIndexBuffer(this._indexBuffer,e,t),s)for(const r of this._meshes)r._createGlobalSubMesh(!0)}}setIndexBuffer(e,t,i,s=null){this._indices=[],this._indexBufferIsUpdatable=!1,this._indexBuffer=e,this._totalVertices=t,this._totalIndices=i,s===null?e.is32Bits=t>65535:e.is32Bits=s;for(const r of this._meshes)r._createGlobalSubMesh(!0),r.synchronizeInstances();this._notifyUpdate()}setIndices(e,t=null,i=!1,s=!1){this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indices=e,this._indexBufferIsUpdatable=i,this._meshes.length!==0&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,i,"Geometry_"+this.id+"_IndexBuffer")),t!=null&&(this._totalVertices=t);for(const r of this._meshes)r._createGlobalSubMesh(!s),r.synchronizeInstances();this._notifyUpdate()}getTotalIndices(){return this.isReady()?this._totalIndices!==void 0?this._totalIndices:this._indices.length:0}getIndices(e,t){if(!this.isReady())return null;const i=this._indices;return!t&&(!e||this._meshes.length===1)?i:i.slice()}getIndexBuffer(){return this.isReady()?this._indexBuffer:null}_releaseVertexArrayObject(e=null){!e||!this._vertexArrayObjects||this._vertexArrayObjects[e.key]&&(this._engine.releaseVertexArrayObject(this._vertexArrayObjects[e.key]),delete this._vertexArrayObjects[e.key])}releaseForMesh(e,t){const i=this._meshes,s=i.indexOf(e);s!==-1&&(i.splice(s,1),this._vertexArrayObjects&&e._invalidateInstanceVertexArrayObject(),e._geometry=null,i.length===0&&t&&this.dispose())}applyToMesh(e){if(e._geometry===this)return;const t=e._geometry;t&&t.releaseForMesh(e),this._vertexArrayObjects&&e._invalidateInstanceVertexArrayObject();const i=this._meshes;e._geometry=this,e._internalAbstractMeshDataInfo._positions=null,this._scene.pushGeometry(this),i.push(e),this.isReady()?this._applyToMesh(e):this._boundingInfo&&e.setBoundingInfo(this._boundingInfo)}_updateExtend(e=null){if(this.useBoundingInfoFromGeometry&&this._boundingInfo)this._extend={minimum:this._boundingInfo.minimum.clone(),maximum:this._boundingInfo.maximum.clone()};else{if(!e&&(e=this.getVerticesData(S.PositionKind),!e))return;this._extend=Vv(e,0,this._totalVertices,this.boundingBias,3)}}_applyToMesh(e){const t=this._meshes.length;for(const i in this._vertexBuffers)t===1&&this._vertexBuffers[i].create(),i===S.PositionKind&&(this._extend||this._updateExtend(),e.buildBoundingInfo(this._extend.minimum,this._extend.maximum),e._createGlobalSubMesh(e.isUnIndexed),e._updateBoundingInfo());t===1&&this._indices&&this._indices.length>0&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer")),e._syncGeometryWithMorphTargetManager(),e.synchronizeInstances()}_notifyUpdate(e){this.onGeometryUpdated&&this.onGeometryUpdated(this,e),this._vertexArrayObjects&&this._disposeVertexArrayObjects();for(const t of this._meshes)t._markSubMeshesAsAttributesDirty()}load(e,t){if(this.delayLoadState!==2){if(this.isReady()){t&&t();return}this.delayLoadState=2,this._queueLoad(e,t)}}_queueLoad(e,t){this.delayLoadingFile&&(e.addPendingData(this),e._loadFile(this.delayLoadingFile,i=>{if(!this._delayLoadingFunction)return;this._delayLoadingFunction(JSON.parse(i),this),this.delayLoadState=1,this._delayInfo=[],e.removePendingData(this);const s=this._meshes,r=s.length;for(let a=0;a<r;a++)this._applyToMesh(s[a]);t&&t()},void 0,!0))}toLeftHanded(){const e=this.getIndices(!1);if(e!=null&&e.length>0){for(let s=0;s<e.length;s+=3){const r=e[s+0];e[s+0]=e[s+2],e[s+2]=r}this.setIndices(e)}const t=this.getVerticesData(S.PositionKind,!1);if(t!=null&&t.length>0){for(let s=0;s<t.length;s+=3)t[s+2]=-t[s+2];this.setVerticesData(S.PositionKind,t,!1)}const i=this.getVerticesData(S.NormalKind,!1);if(i!=null&&i.length>0){for(let s=0;s<i.length;s+=3)i[s+2]=-i[s+2];this.setVerticesData(S.NormalKind,i,!1)}}_resetPointsArrayCache(){this._positions=null}_generatePointsArray(){if(this._positions)return!0;const e=this.getVerticesData(S.PositionKind);if(!e||e.length===0)return!1;for(let t=this._positionsCache.length*3,i=this._positionsCache.length;t<e.length;t+=3,++i)this._positionsCache[i]=y.FromArray(e,t);for(let t=0,i=0;t<e.length;t+=3,++i)this._positionsCache[i].set(e[0+t],e[1+t],e[2+t]);return this._positionsCache.length=e.length/3,this._positions=this._positionsCache,!0}isDisposed(){return this._isDisposed}_disposeVertexArrayObjects(){if(this._vertexArrayObjects){for(const i in this._vertexArrayObjects)this._engine.releaseVertexArrayObject(this._vertexArrayObjects[i]);this._vertexArrayObjects={};const e=this._meshes,t=e.length;for(let i=0;i<t;i++)e[i]._invalidateInstanceVertexArrayObject()}}dispose(){const e=this._meshes,t=e.length;let i;for(i=0;i<t;i++)this.releaseForMesh(e[i]);this._meshes.length=0,this._disposeVertexArrayObjects();for(const s in this._vertexBuffers)this._vertexBuffers[s].dispose();if(this._vertexBuffers={},this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=0,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._parentContainer){const s=this._parentContainer.geometries.indexOf(this);s>-1&&this._parentContainer.geometries.splice(s,1),this._parentContainer=null}this._isDisposed=!0}copy(e){const t=new Q;t.indices=[];const i=this.getIndices();if(i)for(let l=0;l<i.length;l++)t.indices.push(i[l]);let s=!1,r=!1,a;for(a in this._vertexBuffers){const l=this.getVerticesData(a);if(l&&(l instanceof Float32Array?t.set(new Float32Array(l),a):t.set(l.slice(0),a),!r)){const h=this.getVertexBuffer(a);h&&(s=h.isUpdatable(),r=!s)}}const o=new Jt(e,this._scene,t,s);o.delayLoadState=this.delayLoadState,o.delayLoadingFile=this.delayLoadingFile,o._delayLoadingFunction=this._delayLoadingFunction;for(a in this._delayInfo)o._delayInfo=o._delayInfo||[],o._delayInfo.push(a);return o._boundingInfo=new Oi(this._extend.minimum,this._extend.maximum),o}serialize(){const e={};return e.id=this.id,e.uniqueId=this.uniqueId,e.updatable=this._updatable,Ve&&Ve.HasTags(this)&&(e.tags=Ve.GetTags(this)),e}_toNumberArray(e){return Array.isArray(e)?e:Array.prototype.slice.call(e)}clearCachedData(){this._indices=[],this._resetPointsArrayCache();for(const e in this._vertexBuffers)Object.prototype.hasOwnProperty.call(this._vertexBuffers,e)&&(this._vertexBuffers[e]._buffer._data=null)}serializeVerticeData(){const e=this.serialize();return this.isVerticesDataPresent(S.PositionKind)&&(e.positions=this._toNumberArray(this.getVerticesData(S.PositionKind)),this.isVertexBufferUpdatable(S.PositionKind)&&(e.positions._updatable=!0)),this.isVerticesDataPresent(S.NormalKind)&&(e.normals=this._toNumberArray(this.getVerticesData(S.NormalKind)),this.isVertexBufferUpdatable(S.NormalKind)&&(e.normals._updatable=!0)),this.isVerticesDataPresent(S.TangentKind)&&(e.tangents=this._toNumberArray(this.getVerticesData(S.TangentKind)),this.isVertexBufferUpdatable(S.TangentKind)&&(e.tangents._updatable=!0)),this.isVerticesDataPresent(S.UVKind)&&(e.uvs=this._toNumberArray(this.getVerticesData(S.UVKind)),this.isVertexBufferUpdatable(S.UVKind)&&(e.uvs._updatable=!0)),this.isVerticesDataPresent(S.UV2Kind)&&(e.uvs2=this._toNumberArray(this.getVerticesData(S.UV2Kind)),this.isVertexBufferUpdatable(S.UV2Kind)&&(e.uvs2._updatable=!0)),this.isVerticesDataPresent(S.UV3Kind)&&(e.uvs3=this._toNumberArray(this.getVerticesData(S.UV3Kind)),this.isVertexBufferUpdatable(S.UV3Kind)&&(e.uvs3._updatable=!0)),this.isVerticesDataPresent(S.UV4Kind)&&(e.uvs4=this._toNumberArray(this.getVerticesData(S.UV4Kind)),this.isVertexBufferUpdatable(S.UV4Kind)&&(e.uvs4._updatable=!0)),this.isVerticesDataPresent(S.UV5Kind)&&(e.uvs5=this._toNumberArray(this.getVerticesData(S.UV5Kind)),this.isVertexBufferUpdatable(S.UV5Kind)&&(e.uvs5._updatable=!0)),this.isVerticesDataPresent(S.UV6Kind)&&(e.uvs6=this._toNumberArray(this.getVerticesData(S.UV6Kind)),this.isVertexBufferUpdatable(S.UV6Kind)&&(e.uvs6._updatable=!0)),this.isVerticesDataPresent(S.ColorKind)&&(e.colors=this._toNumberArray(this.getVerticesData(S.ColorKind)),this.isVertexBufferUpdatable(S.ColorKind)&&(e.colors._updatable=!0)),this.isVerticesDataPresent(S.MatricesIndicesKind)&&(e.matricesIndices=this._toNumberArray(this.getVerticesData(S.MatricesIndicesKind)),e.matricesIndices._isExpanded=!0,this.isVertexBufferUpdatable(S.MatricesIndicesKind)&&(e.matricesIndices._updatable=!0)),this.isVerticesDataPresent(S.MatricesWeightsKind)&&(e.matricesWeights=this._toNumberArray(this.getVerticesData(S.MatricesWeightsKind)),this.isVertexBufferUpdatable(S.MatricesWeightsKind)&&(e.matricesWeights._updatable=!0)),e.indices=this._toNumberArray(this.getIndices()),e}static ExtractFromMesh(e,t){const i=e._geometry;return i?i.copy(t):null}static RandomId(){return Z.RandomId()}static _GetGeometryByLoadedUniqueId(e,t){for(let i=0;i<t.geometries.length;i++)if(t.geometries[i]._loadedUniqueId===e)return t.geometries[i];return null}static _ImportGeometry(e,t){const i=t.getScene(),s=e.geometryUniqueId,r=e.geometryId;if(s||r){const a=s?this._GetGeometryByLoadedUniqueId(s,i):i.getGeometryById(r);a&&a.applyToMesh(t)}else if(e instanceof ArrayBuffer){const a=t._binaryInfo;if(a.positionsAttrDesc&&a.positionsAttrDesc.count>0){const o=new Float32Array(e,a.positionsAttrDesc.offset,a.positionsAttrDesc.count);t.setVerticesData(S.PositionKind,o,!1)}if(a.normalsAttrDesc&&a.normalsAttrDesc.count>0){const o=new Float32Array(e,a.normalsAttrDesc.offset,a.normalsAttrDesc.count);t.setVerticesData(S.NormalKind,o,!1)}if(a.tangetsAttrDesc&&a.tangetsAttrDesc.count>0){const o=new Float32Array(e,a.tangetsAttrDesc.offset,a.tangetsAttrDesc.count);t.setVerticesData(S.TangentKind,o,!1)}if(a.uvsAttrDesc&&a.uvsAttrDesc.count>0){const o=new Float32Array(e,a.uvsAttrDesc.offset,a.uvsAttrDesc.count);t.setVerticesData(S.UVKind,o,!1)}if(a.uvs2AttrDesc&&a.uvs2AttrDesc.count>0){const o=new Float32Array(e,a.uvs2AttrDesc.offset,a.uvs2AttrDesc.count);t.setVerticesData(S.UV2Kind,o,!1)}if(a.uvs3AttrDesc&&a.uvs3AttrDesc.count>0){const o=new Float32Array(e,a.uvs3AttrDesc.offset,a.uvs3AttrDesc.count);t.setVerticesData(S.UV3Kind,o,!1)}if(a.uvs4AttrDesc&&a.uvs4AttrDesc.count>0){const o=new Float32Array(e,a.uvs4AttrDesc.offset,a.uvs4AttrDesc.count);t.setVerticesData(S.UV4Kind,o,!1)}if(a.uvs5AttrDesc&&a.uvs5AttrDesc.count>0){const o=new Float32Array(e,a.uvs5AttrDesc.offset,a.uvs5AttrDesc.count);t.setVerticesData(S.UV5Kind,o,!1)}if(a.uvs6AttrDesc&&a.uvs6AttrDesc.count>0){const o=new Float32Array(e,a.uvs6AttrDesc.offset,a.uvs6AttrDesc.count);t.setVerticesData(S.UV6Kind,o,!1)}if(a.colorsAttrDesc&&a.colorsAttrDesc.count>0){const o=new Float32Array(e,a.colorsAttrDesc.offset,a.colorsAttrDesc.count);t.setVerticesData(S.ColorKind,o,!1,a.colorsAttrDesc.stride)}if(a.matricesIndicesAttrDesc&&a.matricesIndicesAttrDesc.count>0){const o=new Int32Array(e,a.matricesIndicesAttrDesc.offset,a.matricesIndicesAttrDesc.count),l=[];for(let h=0;h<o.length;h++){const u=o[h];l.push(u&255),l.push((u&65280)>>8),l.push((u&16711680)>>16),l.push(u>>24&255)}t.setVerticesData(S.MatricesIndicesKind,l,!1)}if(a.matricesIndicesExtraAttrDesc&&a.matricesIndicesExtraAttrDesc.count>0){const o=new Int32Array(e,a.matricesIndicesExtraAttrDesc.offset,a.matricesIndicesExtraAttrDesc.count),l=[];for(let h=0;h<o.length;h++){const u=o[h];l.push(u&255),l.push((u&65280)>>8),l.push((u&16711680)>>16),l.push(u>>24&255)}t.setVerticesData(S.MatricesIndicesExtraKind,l,!1)}if(a.matricesWeightsAttrDesc&&a.matricesWeightsAttrDesc.count>0){const o=new Float32Array(e,a.matricesWeightsAttrDesc.offset,a.matricesWeightsAttrDesc.count);t.setVerticesData(S.MatricesWeightsKind,o,!1)}if(a.indicesAttrDesc&&a.indicesAttrDesc.count>0){const o=new Int32Array(e,a.indicesAttrDesc.offset,a.indicesAttrDesc.count);t.setIndices(o,null)}if(a.subMeshesAttrDesc&&a.subMeshesAttrDesc.count>0){const o=new Int32Array(e,a.subMeshesAttrDesc.offset,a.subMeshesAttrDesc.count*5);t.subMeshes=[];for(let l=0;l<a.subMeshesAttrDesc.count;l++){const h=o[l*5+0],u=o[l*5+1],c=o[l*5+2],f=o[l*5+3],d=o[l*5+4];ss.AddToMesh(h,u,c,f,d,t)}}}else if(e.positions&&e.normals&&e.indices){if(t.setVerticesData(S.PositionKind,e.positions,e.positions._updatable),t.setVerticesData(S.NormalKind,e.normals,e.normals._updatable),e.tangents&&t.setVerticesData(S.TangentKind,e.tangents,e.tangents._updatable),e.uvs&&t.setVerticesData(S.UVKind,e.uvs,e.uvs._updatable),e.uvs2&&t.setVerticesData(S.UV2Kind,e.uvs2,e.uvs2._updatable),e.uvs3&&t.setVerticesData(S.UV3Kind,e.uvs3,e.uvs3._updatable),e.uvs4&&t.setVerticesData(S.UV4Kind,e.uvs4,e.uvs4._updatable),e.uvs5&&t.setVerticesData(S.UV5Kind,e.uvs5,e.uvs5._updatable),e.uvs6&&t.setVerticesData(S.UV6Kind,e.uvs6,e.uvs6._updatable),e.colors&&t.setVerticesData(S.ColorKind,K.CheckColors4(e.colors,e.positions.length/3),e.colors._updatable),e.matricesIndices)if(e.matricesIndices._isExpanded)delete e.matricesIndices._isExpanded,t.setVerticesData(S.MatricesIndicesKind,e.matricesIndices,e.matricesIndices._updatable);else{const a=[];for(let o=0;o<e.matricesIndices.length;o++){const l=e.matricesIndices[o];a.push(l&255),a.push((l&65280)>>8),a.push((l&16711680)>>16),a.push(l>>24&255)}t.setVerticesData(S.MatricesIndicesKind,a,e.matricesIndices._updatable)}if(e.matricesIndicesExtra)if(e.matricesIndicesExtra._isExpanded)delete e.matricesIndices._isExpanded,t.setVerticesData(S.MatricesIndicesExtraKind,e.matricesIndicesExtra,e.matricesIndicesExtra._updatable);else{const a=[];for(let o=0;o<e.matricesIndicesExtra.length;o++){const l=e.matricesIndicesExtra[o];a.push(l&255),a.push((l&65280)>>8),a.push((l&16711680)>>16),a.push(l>>24&255)}t.setVerticesData(S.MatricesIndicesExtraKind,a,e.matricesIndicesExtra._updatable)}e.matricesWeights&&(Jt._CleanMatricesWeights(e,t),t.setVerticesData(S.MatricesWeightsKind,e.matricesWeights,e.matricesWeights._updatable)),e.matricesWeightsExtra&&t.setVerticesData(S.MatricesWeightsExtraKind,e.matricesWeightsExtra,e.matricesWeights._updatable),t.setIndices(e.indices,null)}if(e.subMeshes){t.subMeshes=[];for(let a=0;a<e.subMeshes.length;a++){const o=e.subMeshes[a];ss.AddToMesh(o.materialIndex,o.verticesStart,o.verticesCount,o.indexStart,o.indexCount,t)}}t._shouldGenerateFlatShading&&(t.convertToFlatShadedMesh(),t._shouldGenerateFlatShading=!1),t.computeWorldMatrix(!0),i.onMeshImportedObservable.notifyObservers(t)}static _CleanMatricesWeights(e,t){if(!Ct.CleanBoneMatrixWeights)return;let s=0;if(e.skeletonId>-1){const c=t.getScene().getLastSkeletonById(e.skeletonId);if(!c)return;s=c.bones.length}else return;const r=t.getVerticesData(S.MatricesIndicesKind),a=t.getVerticesData(S.MatricesIndicesExtraKind),o=e.matricesWeights,l=e.matricesWeightsExtra,h=e.numBoneInfluencer,u=o.length;for(let c=0;c<u;c+=4){let f=0,d=-1;for(let _=0;_<4;_++){const p=o[c+_];f+=p,p<.001&&d<0&&(d=_)}if(l)for(let _=0;_<4;_++){const p=l[c+_];f+=p,p<.001&&d<0&&(d=_+4)}if((d<0||d>h-1)&&(d=h-1),f>.001){const _=1/f;for(let p=0;p<4;p++)o[c+p]*=_;if(l)for(let p=0;p<4;p++)l[c+p]*=_}else d>=4?(l[c+d-4]=1-f,a[c+d-4]=s):(o[c+d]=1-f,r[c+d]=s)}t.setVerticesData(S.MatricesIndicesKind,r),e.matricesWeightsExtra&&t.setVerticesData(S.MatricesIndicesExtraKind,a)}static Parse(e,t,i){const s=new Jt(e.id,t,void 0,e.updatable);return s._loadedUniqueId=e.uniqueId,Ve&&Ve.AddTagsTo(s,e.tags),e.delayLoadingFile?(s.delayLoadState=4,s.delayLoadingFile=i+e.delayLoadingFile,s._boundingInfo=new Oi(y.FromArray(e.boundingBoxMinimum),y.FromArray(e.boundingBoxMaximum)),s._delayInfo=[],e.hasUVs&&s._delayInfo.push(S.UVKind),e.hasUVs2&&s._delayInfo.push(S.UV2Kind),e.hasUVs3&&s._delayInfo.push(S.UV3Kind),e.hasUVs4&&s._delayInfo.push(S.UV4Kind),e.hasUVs5&&s._delayInfo.push(S.UV5Kind),e.hasUVs6&&s._delayInfo.push(S.UV6Kind),e.hasColors&&s._delayInfo.push(S.ColorKind),e.hasMatricesIndices&&s._delayInfo.push(S.MatricesIndicesKind),e.hasMatricesWeights&&s._delayInfo.push(S.MatricesWeightsKind),s._delayLoadingFunction=Q.ImportVertexData):Q.ImportVertexData(e,s),t.pushGeometry(s,!0),s}}class In{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681}get func(){return this._func}set func(e){this._func=e}get funcRef(){return this._funcRef}set funcRef(e){this._funcRef=e}get funcMask(){return this._funcMask}set funcMask(e){this._funcMask=e}get opStencilFail(){return this._opStencilFail}set opStencilFail(e){this._opStencilFail=e}get opDepthFail(){return this._opDepthFail}set opDepthFail(e){this._opDepthFail=e}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(e){this._opStencilDepthPass=e}get mask(){return this._mask}set mask(e){this._mask=e}get enabled(){return this._enabled}set enabled(e){this._enabled=e}getClassName(){return"MaterialStencilState"}copyTo(e){Ie.Clone(()=>e,this)}serialize(){return Ie.Serialize(this)}parse(e,t,i){Ie.Parse(()=>this,e,t,i)}}P([B()],In.prototype,"func",null);P([B()],In.prototype,"funcRef",null);P([B()],In.prototype,"funcMask",null);P([B()],In.prototype,"opStencilFail",null);P([B()],In.prototype,"opDepthFail",null);P([B()],In.prototype,"opStencilDepthPass",null);P([B()],In.prototype,"mask",null);P([B()],In.prototype,"enabled",null);function Ah(n){n.indexOf("vClipPlane")===-1&&n.push("vClipPlane"),n.indexOf("vClipPlane2")===-1&&n.push("vClipPlane2"),n.indexOf("vClipPlane3")===-1&&n.push("vClipPlane3"),n.indexOf("vClipPlane4")===-1&&n.push("vClipPlane4"),n.indexOf("vClipPlane5")===-1&&n.push("vClipPlane5"),n.indexOf("vClipPlane6")===-1&&n.push("vClipPlane6")}function Hv(n,e,t){const i=!!(n.clipPlane??e.clipPlane),s=!!(n.clipPlane2??e.clipPlane2),r=!!(n.clipPlane3??e.clipPlane3),a=!!(n.clipPlane4??e.clipPlane4),o=!!(n.clipPlane5??e.clipPlane5),l=!!(n.clipPlane6??e.clipPlane6);i&&t.push("#define CLIPPLANE"),s&&t.push("#define CLIPPLANE2"),r&&t.push("#define CLIPPLANE3"),a&&t.push("#define CLIPPLANE4"),o&&t.push("#define CLIPPLANE5"),l&&t.push("#define CLIPPLANE6")}function aE(n,e,t){let i=!1;const s=!!(n.clipPlane??e.clipPlane),r=!!(n.clipPlane2??e.clipPlane2),a=!!(n.clipPlane3??e.clipPlane3),o=!!(n.clipPlane4??e.clipPlane4),l=!!(n.clipPlane5??e.clipPlane5),h=!!(n.clipPlane6??e.clipPlane6);return t.CLIPPLANE!==s&&(t.CLIPPLANE=s,i=!0),t.CLIPPLANE2!==r&&(t.CLIPPLANE2=r,i=!0),t.CLIPPLANE3!==a&&(t.CLIPPLANE3=a,i=!0),t.CLIPPLANE4!==o&&(t.CLIPPLANE4=o,i=!0),t.CLIPPLANE5!==l&&(t.CLIPPLANE5=l,i=!0),t.CLIPPLANE6!==h&&(t.CLIPPLANE6=h,i=!0),i}function Eh(n,e,t){let i=e.clipPlane??t.clipPlane;Wr(n,"vClipPlane",i),i=e.clipPlane2??t.clipPlane2,Wr(n,"vClipPlane2",i),i=e.clipPlane3??t.clipPlane3,Wr(n,"vClipPlane3",i),i=e.clipPlane4??t.clipPlane4,Wr(n,"vClipPlane4",i),i=e.clipPlane5??t.clipPlane5,Wr(n,"vClipPlane5",i),i=e.clipPlane6??t.clipPlane6,Wr(n,"vClipPlane6",i)}function Wr(n,e,t){t&&n.setFloat4(e,t.normal.x,t.normal.y,t.normal.z,t.d)}const kg=fe.Black(),or={NUM_MORPH_INFLUENCERS:0,NORMAL:!1,TANGENT:!1,UV:!1,UV2:!1,COLOR:!1};function Ed(n,e,t){if(!n||n.LOGARITHMICDEPTH||n.indexOf&&n.indexOf("LOGARITHMICDEPTH")>=0){const i=t.activeCamera;i.mode===1&&U.Error("Logarithmic depth is not compatible with orthographic cameras!",20),e.setFloat("logarithmicDepthConstant",2/(Math.log(i.maxZ+1)/Math.LN2))}}function Sd(n,e,t,i=!1){t&&n.fogEnabled&&(!e||e.applyFog)&&n.fogMode!==0&&(t.setFloat4("vFogInfos",n.fogMode,n.fogStart,n.fogEnd,n.fogDensity),i?(n.fogColor.toLinearSpaceToRef(kg,n.getEngine().useExactSrgbConversions),t.setColor3("vFogColor",kg)):t.setColor3("vFogColor",n.fogColor))}function Kv(n,e,t,i,s,r,a,o,l,h){const u=n.numMaxInfluencers||n.numInfluencers;return u<=0?0:(e.push("#define MORPHTARGETS"),n.hasPositions&&e.push("#define MORPHTARGETTEXTURE_HASPOSITIONS"),n.hasNormals&&e.push("#define MORPHTARGETTEXTURE_HASNORMALS"),n.hasTangents&&e.push("#define MORPHTARGETTEXTURE_HASTANGENTS"),n.hasUVs&&e.push("#define MORPHTARGETTEXTURE_HASUVS"),n.hasUV2s&&e.push("#define MORPHTARGETTEXTURE_HASUV2S"),n.hasColors&&e.push("#define MORPHTARGETTEXTURE_HASCOLORS"),n.supportsPositions&&s&&e.push("#define MORPHTARGETS_POSITION"),n.supportsNormals&&r&&e.push("#define MORPHTARGETS_NORMAL"),n.supportsTangents&&a&&e.push("#define MORPHTARGETS_TANGENT"),n.supportsUVs&&o&&e.push("#define MORPHTARGETS_UV"),n.supportsUV2s&&l&&e.push("#define MORPHTARGETS_UV2"),n.supportsColors&&h&&e.push("#define MORPHTARGETS_COLOR"),e.push("#define NUM_MORPH_INFLUENCERS "+u),n.isUsingTextureForTargets&&e.push("#define MORPHTARGETS_TEXTURE"),or.NUM_MORPH_INFLUENCERS=u,or.NORMAL=r,or.TANGENT=a,or.UV=o,or.UV2=l,or.COLOR=h,Xv(t,i,or,s),u)}function Xv(n,e,t,i=!0){const s=t.NUM_MORPH_INFLUENCERS;if(s>0&&Ae.LastCreatedEngine){const r=Ae.LastCreatedEngine.getCaps().maxVertexAttribs,a=e.morphTargetManager;if(a!=null&&a.isUsingTextureForTargets)return;const o=a&&a.supportsPositions&&i,l=a&&a.supportsNormals&&t.NORMAL,h=a&&a.supportsTangents&&t.TANGENT,u=a&&a.supportsUVs&&t.UV1,c=a&&a.supportsUV2s&&t.UV2,f=a&&a.supportsColors&&t.COLOR;for(let d=0;d<s;d++)o&&n.push("position"+d),l&&n.push("normal"+d),h&&n.push("tangent"+d),u&&n.push("uv_"+d),c&&n.push("uv2_"+d),f&&n.push("color"+d),n.length>r&&U.Error("Cannot add more vertex attributes for mesh "+e.name)}}function Rd(n,e=!1){n.push("world0"),n.push("world1"),n.push("world2"),n.push("world3"),e&&(n.push("previousWorld0"),n.push("previousWorld1"),n.push("previousWorld2"),n.push("previousWorld3"))}function Id(n,e){const t=n.morphTargetManager;!n||!t||e.setFloatArray("morphTargetInfluences",t.influences)}function Yv(n,e){e.bindToEffect(n,"Scene")}function Pn(n,e,t){e._needUVs=!0,e[t]=!0,n.optimizeUVAllocation&&n.getTextureMatrix().isIdentityAs3x2()?(e[t+"DIRECTUV"]=n.coordinatesIndex+1,e["MAINUV"+(n.coordinatesIndex+1)]=!0):e[t+"DIRECTUV"]=0}function wn(n,e,t){const i=n.getTextureMatrix();e.updateMatrix(t+"Matrix",i)}function jv(n,e,t){t.BAKED_VERTEX_ANIMATION_TEXTURE&&t.INSTANCES&&n.push("bakedVertexAnimationSettingsInstanced")}function qv(n,e,t){if(!(!e||!n)&&(n.computeBonesUsingShaders&&e._bonesComputationForcedToCPU&&(n.computeBonesUsingShaders=!1),n.useBones&&n.computeBonesUsingShaders&&n.skeleton)){const i=n.skeleton;if(i.isUsingTextureForMatrices&&e.getUniformIndex("boneTextureWidth")>-1){const s=i.getTransformMatrixTexture(n);e.setTexture("boneSampler",s),e.setFloat("boneTextureWidth",4*(i.bones.length+1))}else{const s=i.getTransformMatrices(n);s&&e.setMatrices("mBones",s)}}}function oE(n,e,t,i,s,r=!0){n._bindLight(e,t,i,s,r)}function lE(n,e,t,i,s=4){const r=Math.min(e.lightSources.length,s);for(let a=0;a<r;a++){const o=e.lightSources[a];oE(o,a,n,t,typeof i=="boolean"?i:i.SPECULARTERM,e.receiveShadows)}}function hE(n,e,t,i){t.NUM_BONE_INFLUENCERS>0&&(i.addCPUSkinningFallback(0,e),n.push("matricesIndices"),n.push("matricesWeights"),t.NUM_BONE_INFLUENCERS>4&&(n.push("matricesIndicesExtra"),n.push("matricesWeightsExtra")))}function $v(n,e){(e.INSTANCES||e.THIN_INSTANCES)&&Rd(n,!!e.PREPASS_VELOCITY),e.INSTANCESCOLOR&&n.push("instanceColor")}function uE(n,e,t=4,i=0){let s=0;for(let r=0;r<t&&n["LIGHT"+r];r++)r>0&&(s=i+r,e.addFallback(s,"LIGHT"+r)),n.SHADOWS||(n["SHADOW"+r]&&e.addFallback(i,"SHADOW"+r),n["SHADOWPCF"+r]&&e.addFallback(i,"SHADOWPCF"+r),n["SHADOWPCSS"+r]&&e.addFallback(i,"SHADOWPCSS"+r),n["SHADOWPOISSON"+r]&&e.addFallback(i,"SHADOWPOISSON"+r),n["SHADOWESM"+r]&&e.addFallback(i,"SHADOWESM"+r),n["SHADOWCLOSEESM"+r]&&e.addFallback(i,"SHADOWCLOSEESM"+r));return s++}function cE(n,e){return e.fogEnabled&&n.applyFog&&e.fogMode!==0}function Zv(n,e,t,i,s,r,a,o=!1){a._areMiscDirty&&(a.LOGARITHMICDEPTH=t,a.POINTSIZE=i,a.FOG=s&&cE(n,e),a.NONUNIFORMSCALING=n.nonUniformScaling,a.ALPHATEST=r,a.DECAL_AFTER_DETAIL=o)}function fE(n,e,t,i,s=4,r=!1){if(!t._areLightsDirty)return t._needNormals;let a=0;const o={needNormals:t._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(n.lightsEnabled&&!r){for(const h of e.lightSources)if(dE(n,e,h,a,t,i,o),a++,a===s)break}t.SPECULARTERM=o.specularEnabled,t.SHADOWS=o.shadowEnabled;for(let h=a;h<s;h++)t["LIGHT"+h]!==void 0&&(t["LIGHT"+h]=!1,t["HEMILIGHT"+h]=!1,t["POINTLIGHT"+h]=!1,t["DIRLIGHT"+h]=!1,t["SPOTLIGHT"+h]=!1,t["AREALIGHT"+h]=!1,t["SHADOW"+h]=!1,t["SHADOWCSM"+h]=!1,t["SHADOWCSMDEBUG"+h]=!1,t["SHADOWCSMNUM_CASCADES"+h]=!1,t["SHADOWCSMUSESHADOWMAXZ"+h]=!1,t["SHADOWCSMNOBLEND"+h]=!1,t["SHADOWCSM_RIGHTHANDED"+h]=!1,t["SHADOWPCF"+h]=!1,t["SHADOWPCSS"+h]=!1,t["SHADOWPOISSON"+h]=!1,t["SHADOWESM"+h]=!1,t["SHADOWCLOSEESM"+h]=!1,t["SHADOWCUBE"+h]=!1,t["SHADOWLOWQUALITY"+h]=!1,t["SHADOWMEDIUMQUALITY"+h]=!1);const l=n.getEngine().getCaps();return t.SHADOWFLOAT===void 0&&(o.needRebuild=!0),t.SHADOWFLOAT=o.shadowEnabled&&(l.textureFloatRender&&l.textureFloatLinearFiltering||l.textureHalfFloatRender&&l.textureHalfFloatLinearFiltering),t.LIGHTMAPEXCLUDED=o.lightmapMode,o.needRebuild&&t.rebuild(),o.needNormals}function dE(n,e,t,i,s,r,a){switch(a.needNormals=!0,s["LIGHT"+i]===void 0&&(a.needRebuild=!0),s["LIGHT"+i]=!0,s["SPOTLIGHT"+i]=!1,s["HEMILIGHT"+i]=!1,s["POINTLIGHT"+i]=!1,s["DIRLIGHT"+i]=!1,s["AREALIGHT"+i]=!1,t.prepareLightSpecificDefines(s,i),s["LIGHT_FALLOFF_PHYSICAL"+i]=!1,s["LIGHT_FALLOFF_GLTF"+i]=!1,s["LIGHT_FALLOFF_STANDARD"+i]=!1,t.falloffType){case He.FALLOFF_GLTF:s["LIGHT_FALLOFF_GLTF"+i]=!0;break;case He.FALLOFF_PHYSICAL:s["LIGHT_FALLOFF_PHYSICAL"+i]=!0;break;case He.FALLOFF_STANDARD:s["LIGHT_FALLOFF_STANDARD"+i]=!0;break}if(t.specular.equalsFloats(0,0,0)||(a.specularEnabled=!0),s["SHADOW"+i]=!1,s["SHADOWCSM"+i]=!1,s["SHADOWCSMDEBUG"+i]=!1,s["SHADOWCSMNUM_CASCADES"+i]=!1,s["SHADOWCSMUSESHADOWMAXZ"+i]=!1,s["SHADOWCSMNOBLEND"+i]=!1,s["SHADOWCSM_RIGHTHANDED"+i]=!1,s["SHADOWPCF"+i]=!1,s["SHADOWPCSS"+i]=!1,s["SHADOWPOISSON"+i]=!1,s["SHADOWESM"+i]=!1,s["SHADOWCLOSEESM"+i]=!1,s["SHADOWCUBE"+i]=!1,s["SHADOWLOWQUALITY"+i]=!1,s["SHADOWMEDIUMQUALITY"+i]=!1,e&&e.receiveShadows&&n.shadowsEnabled&&t.shadowEnabled){const o=t.getShadowGenerator(n.activeCamera)??t.getShadowGenerator();if(o){const l=o.getShadowMap();l&&l.renderList&&l.renderList.length>0&&(a.shadowEnabled=!0,o.prepareDefines(s,i))}}t.lightmapMode!=He.LIGHTMAP_DEFAULT?(a.lightmapMode=!0,s["LIGHTMAPEXCLUDED"+i]=!0,s["LIGHTMAPNOSPECULAR"+i]=t.lightmapMode==He.LIGHTMAP_SHADOWSONLY):(s["LIGHTMAPEXCLUDED"+i]=!1,s["LIGHTMAPNOSPECULAR"+i]=!1)}function Qv(n,e,t,i,s,r=null,a=!1){let o=xE(n,i);r!==!1&&(o=aE(t,n,i)),i.DEPTHPREPASS!==!e.getColorWrite()&&(i.DEPTHPREPASS=!i.DEPTHPREPASS,o=!0),i.INSTANCES!==s&&(i.INSTANCES=s,o=!0),i.THIN_INSTANCES!==a&&(i.THIN_INSTANCES=a,o=!0),o&&i.markAsUnprocessed()}function _E(n,e){if(n.useBones&&n.computeBonesUsingShaders&&n.skeleton){e.NUM_BONE_INFLUENCERS=n.numBoneInfluencers;const t=e.BONETEXTURE!==void 0;if(n.skeleton.isUsingTextureForMatrices&&t)e.BONETEXTURE=!0;else{e.BonesPerMesh=n.skeleton.bones.length+1,e.BONETEXTURE=t?!1:void 0;const i=n.getScene().prePassRenderer;if(i&&i.enabled){const s=i.excludedSkinnedMesh.indexOf(n)===-1;e.BONES_VELOCITY_ENABLED=s}}}else e.NUM_BONE_INFLUENCERS=0,e.BonesPerMesh=0,e.BONETEXTURE!==void 0&&(e.BONETEXTURE=!1)}function pE(n,e){const t=n.morphTargetManager;t?(e.MORPHTARGETS_UV=t.supportsUVs&&e.UV1,e.MORPHTARGETS_UV2=t.supportsUV2s&&e.UV2,e.MORPHTARGETS_TANGENT=t.supportsTangents&&e.TANGENT,e.MORPHTARGETS_NORMAL=t.supportsNormals&&e.NORMAL,e.MORPHTARGETS_POSITION=t.supportsPositions,e.MORPHTARGETS_COLOR=t.supportsColors,e.MORPHTARGETTEXTURE_HASUVS=t.hasUVs,e.MORPHTARGETTEXTURE_HASUV2S=t.hasUV2s,e.MORPHTARGETTEXTURE_HASTANGENTS=t.hasTangents,e.MORPHTARGETTEXTURE_HASNORMALS=t.hasNormals,e.MORPHTARGETTEXTURE_HASPOSITIONS=t.hasPositions,e.MORPHTARGETTEXTURE_HASCOLORS=t.hasColors,e.NUM_MORPH_INFLUENCERS=t.numMaxInfluencers||t.numInfluencers,e.MORPHTARGETS=e.NUM_MORPH_INFLUENCERS>0,e.MORPHTARGETS_TEXTURE=t.isUsingTextureForTargets):(e.MORPHTARGETS_UV=!1,e.MORPHTARGETS_UV2=!1,e.MORPHTARGETS_TANGENT=!1,e.MORPHTARGETS_NORMAL=!1,e.MORPHTARGETS_POSITION=!1,e.MORPHTARGETS_COLOR=!1,e.MORPHTARGETTEXTURE_HASUVS=!1,e.MORPHTARGETTEXTURE_HASUV2S=!1,e.MORPHTARGETTEXTURE_HASTANGENTS=!1,e.MORPHTARGETTEXTURE_HASNORMALS=!1,e.MORPHTARGETTEXTURE_HASPOSITIONS=!1,e.MORPHTARGETTEXTURE_HAS_COLORS=!1,e.MORPHTARGETS=!1,e.NUM_MORPH_INFLUENCERS=0)}function gE(n,e){const t=n.bakedVertexAnimationManager;e.BAKED_VERTEX_ANIMATION_TEXTURE=!!(t&&t.isEnabled)}function Jv(n,e,t,i,s=!1,r=!0,a=!0){if(!e._areAttributesDirty&&e._needNormals===e._normals&&e._needUVs===e._uvs)return!1;e._normals=e._needNormals,e._uvs=e._needUVs,e.NORMAL=e._needNormals&&n.isVerticesDataPresent("normal"),e._needNormals&&n.isVerticesDataPresent("tangent")&&(e.TANGENT=!0);for(let o=1;o<=6;++o)e["UV"+o]=e._needUVs?n.isVerticesDataPresent(`uv${o===1?"":o}`):!1;if(t){const o=n.useVertexColors&&n.isVerticesDataPresent("color");e.VERTEXCOLOR=o,e.VERTEXALPHA=n.hasVertexAlpha&&o&&r}return n.isVerticesDataPresent("instanceColor")&&(n.hasInstances||n.hasThinInstances)&&(e.INSTANCESCOLOR=!0),i&&_E(n,e),s&&pE(n,e),a&&gE(n,e),!0}function mE(n,e){if(n.activeCamera){const t=e.MULTIVIEW;e.MULTIVIEW=n.activeCamera.outputRenderTarget!==null&&n.activeCamera.outputRenderTarget.getViewCount()>1,e.MULTIVIEW!=t&&e.markAsUnprocessed()}}function vE(n,e,t){const i=e.ORDER_INDEPENDENT_TRANSPARENCY,s=e.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;e.ORDER_INDEPENDENT_TRANSPARENCY=n.useOrderIndependentTransparency&&t,e.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!n.getEngine().getCaps().textureFloatLinearFiltering,(i!==e.ORDER_INDEPENDENT_TRANSPARENCY||s!==e.ORDER_INDEPENDENT_TRANSPARENCY_16BITS)&&e.markAsUnprocessed()}function yE(n,e,t){const i=e.PREPASS;if(!e._arePrePassDirty)return;const s=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:9,define:"PREPASS_LOCAL_POSITION",index:"PREPASS_LOCAL_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:11,define:"PREPASS_VELOCITY_LINEAR",index:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:10,define:"PREPASS_SCREENSPACE_DEPTH",index:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"},{type:8,define:"PREPASS_WORLD_NORMAL",index:"PREPASS_WORLD_NORMAL_INDEX"}];if(n.prePassRenderer&&n.prePassRenderer.enabled&&t){e.PREPASS=!0,e.SCENE_MRT_COUNT=n.prePassRenderer.mrtCount,e.PREPASS_NORMAL_WORLDSPACE=n.prePassRenderer.generateNormalsInWorldSpace,e.PREPASS_COLOR=!0,e.PREPASS_COLOR_INDEX=0;for(let r=0;r<s.length;r++){const a=n.prePassRenderer.getIndex(s[r].type);a!==-1?(e[s[r].define]=!0,e[s[r].index]=a):e[s[r].define]=!1}}else{e.PREPASS=!1;for(let r=0;r<s.length;r++)e[s[r].define]=!1}e.PREPASS!=i&&(e.markAsUnprocessed(),e.markAsImageProcessingDirty())}function xE(n,e){let t=!1;if(n.activeCamera){const i=e.CAMERA_ORTHOGRAPHIC?1:0,s=e.CAMERA_PERSPECTIVE?1:0,r=n.activeCamera.mode===1?1:0,a=n.activeCamera.mode===0?1:0;(i^r||s^a)&&(e.CAMERA_ORTHOGRAPHIC=r===1,e.CAMERA_PERSPECTIVE=a===1,t=!0)}return t}function bE(n,e,t,i,s=null,r=!1,a=!1){s&&s.push("Light"+n),!r&&(e.push("vLightData"+n,"vLightDiffuse"+n,"vLightSpecular"+n,"vLightDirection"+n,"vLightWidth"+n,"vLightHeight"+n,"vLightFalloff"+n,"vLightGround"+n,"lightMatrix"+n,"shadowsInfo"+n,"depthValues"+n),t.push("shadowTexture"+n),t.push("depthTexture"+n),e.push("viewFrustumZ"+n,"cascadeBlendFactor"+n,"lightSizeUVCorrection"+n,"depthCorrection"+n,"penumbraDarkness"+n,"frustumLengths"+n),i&&(t.push("projectionLightTexture"+n),e.push("textureProjectionMatrix"+n)),a&&t.push("iesLightTexture"+n))}function TE(n,e,t,i=4){let s,r;if(n.uniformsNames){const a=n;s=a.uniformsNames,r=a.uniformBuffersNames,e=a.samplers,t=a.defines,i=a.maxSimultaneousLights||0}else s=n,e||(e=[]);for(let a=0;a<i&&t["LIGHT"+a];a++)bE(a,s,e,t["PROJECTEDLIGHTTEXTURE"+a],r,!1,t["IESLIGHTTEXTURE"+a]);t.NUM_MORPH_INFLUENCERS&&(s.push("morphTargetInfluences"),s.push("morphTargetCount")),t.BAKED_VERTEX_ANIMATION_TEXTURE&&(s.push("bakedVertexAnimationSettings"),s.push("bakedVertexAnimationTextureSizeInverted"),s.push("bakedVertexAnimationTime"),e.push("bakedVertexAnimationTexture"))}class Y{get _supportGlowLayer(){return!1}set _glowModeEnabled(e){}get shaderLanguage(){return this._shaderLanguage}get canRenderToMRT(){return!1}set alpha(e){if(this._alpha===e)return;const t=this._alpha;this._alpha=e,(t===1||e===1)&&this.markAsDirty(Y.MiscDirtyFlag+Y.PrePassDirtyFlag)}get alpha(){return this._alpha}set backFaceCulling(e){this._backFaceCulling!==e&&(this._backFaceCulling=e,this.markAsDirty(Y.TextureDirtyFlag))}get backFaceCulling(){return this._backFaceCulling}set cullBackFaces(e){this._cullBackFaces!==e&&(this._cullBackFaces=e,this.markAsDirty(Y.TextureDirtyFlag))}get cullBackFaces(){return this._cullBackFaces}get blockDirtyMechanism(){return this._blockDirtyMechanism}set blockDirtyMechanism(e){this._blockDirtyMechanism!==e&&(this._blockDirtyMechanism=e,e||this.markDirty())}atomicMaterialsUpdate(e){this.blockDirtyMechanism=!0;try{e(this)}finally{this.blockDirtyMechanism=!1}}get hasRenderTargetTextures(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures}set onDispose(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new q),this._onBindObservable}set onBind(e){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(e)}get onUnBindObservable(){return this._onUnBindObservable||(this._onUnBindObservable=new q),this._onUnBindObservable}get onEffectCreatedObservable(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new q),this._onEffectCreatedObservable}set alphaMode(e){this._alphaMode!==e&&(this._alphaMode=e,this.markAsDirty(Y.TextureDirtyFlag))}get alphaMode(){return this._alphaMode}set needDepthPrePass(e){this._needDepthPrePass!==e&&(this._needDepthPrePass=e,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))}get needDepthPrePass(){return this._needDepthPrePass}get isPrePassCapable(){return!1}set fogEnabled(e){this._fogEnabled!==e&&(this._fogEnabled=e,this.markAsDirty(Y.MiscDirtyFlag))}get fogEnabled(){return this._fogEnabled}get wireframe(){switch(this._fillMode){case Y.WireFrameFillMode:case Y.LineListDrawMode:case Y.LineLoopDrawMode:case Y.LineStripDrawMode:return!0}return this._scene.forceWireframe}set wireframe(e){this.fillMode=e?Y.WireFrameFillMode:Y.TriangleFillMode}get pointsCloud(){switch(this._fillMode){case Y.PointFillMode:case Y.PointListDrawMode:return!0}return this._scene.forcePointsCloud}set pointsCloud(e){this.fillMode=e?Y.PointFillMode:Y.TriangleFillMode}get fillMode(){return this._fillMode}set fillMode(e){this._fillMode!==e&&(this._fillMode=e,this.markAsDirty(Y.MiscDirtyFlag))}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(e){const t=this.getScene().getEngine().getCaps().fragmentDepthSupported;e&&!t&&U.Warn("Logarithmic depth has been requested for a material on a device that doesn't support it."),this._useLogarithmicDepth=e&&t,this._markAllSubMeshesAsMiscDirty()}_getDrawWrapper(){return this._drawWrapper}_setDrawWrapper(e){this._drawWrapper=e}constructor(e,t,i,s=!1){this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this._shaderLanguage=0,this._forceGLSL=!1,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this._blockDirtyMechanism=!1,this.sideOrientation=null,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.onDisposeObservable=new q,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.stencil=new In,this._useUBO=!1,this._fillMode=Y.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=()=>{},this._callbackPluginEventIsReadyForSubMesh=()=>{},this._callbackPluginEventPrepareDefines=()=>{},this._callbackPluginEventPrepareDefinesBeforeAttributes=()=>{},this._callbackPluginEventHardBindForSubMesh=()=>{},this._callbackPluginEventBindForSubMesh=()=>{},this._callbackPluginEventHasRenderTargetTextures=()=>{},this._callbackPluginEventFillRenderTargetTextures=()=>{},this._transparencyMode=null,this.name=e;const r=t||Ae.LastCreatedScene;r&&(this._scene=r,this._dirtyCallbacks={},this._forceGLSL=s,this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[127]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=e||Z.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new o0(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._uniformBuffer=new ce(this._scene.getEngine(),void 0,void 0,e),this._useUBO=this.getScene().getEngine().supportsUniformBuffers,this._createUniformBuffer(),i||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),Y.OnEventObservable.notifyObservers(this,1))}_createUniformBuffer(){var t;const e=this.getScene().getEngine();(t=this._uniformBuffer)==null||t.dispose(),e.isWebGPU&&!this._forceGLSL?(this._uniformBuffer=new ce(e,void 0,void 0,this.name,!0),this._shaderLanguage=1):this._uniformBuffer=new ce(this._scene.getEngine(),void 0,void 0,this.name),this._uniformBufferLayoutBuilt=!1}toString(e){return"Name: "+this.name}getClassName(){return"Material"}get _isMaterial(){return!0}get isFrozen(){return this.checkReadyOnlyOnce}freeze(){this.markDirty(),this.checkReadyOnlyOnce=!0}unfreeze(){this.markDirty(),this.checkReadyOnlyOnce=!1}isReady(e,t){return!0}isReadyForSubMesh(e,t,i){const s=t.materialDefines;return s?(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=s,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh):!1}getEffect(){return this._drawWrapper.effect}getScene(){return this._scene}_getEffectiveOrientation(e){return this.sideOrientation!==null?this.sideOrientation:e.sideOrientation}get transparencyMode(){return this._transparencyMode}set transparencyMode(e){this._transparencyMode!==e&&(this._transparencyMode=e,this._markAllSubMeshesAsTexturesAndMiscDirty())}get _hasTransparencyMode(){return this._transparencyMode!=null}get _transparencyModeIsBlend(){return this._transparencyMode===Y.MATERIAL_ALPHABLEND||this._transparencyMode===Y.MATERIAL_ALPHATESTANDBLEND}get _transparencyModeIsTest(){return this._transparencyMode===Y.MATERIAL_ALPHATEST||this._transparencyMode===Y.MATERIAL_ALPHATESTANDBLEND}get _disableAlphaBlending(){return this._transparencyMode===Y.MATERIAL_OPAQUE||this._transparencyMode===Y.MATERIAL_ALPHATEST}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:this._disableAlphaBlending?!1:this.alpha<1}needAlphaBlendingForMesh(e){return this._hasTransparencyMode?this._transparencyModeIsBlend:e.visibility<1?!0:this._disableAlphaBlending?!1:e.hasVertexAlpha||this.needAlphaBlending()}needAlphaTesting(){return this._hasTransparencyMode?this._transparencyModeIsTest:!1}needAlphaTestingForMesh(e){return this._hasTransparencyMode?this._transparencyModeIsTest:!this.needAlphaBlendingForMesh(e)&&this.needAlphaTesting()}getAlphaTestTexture(){return null}markDirty(e=!1){const t=this.getScene().meshes;for(const i of t)if(i.subMeshes){for(const s of i.subMeshes)if(s.getMaterial()===this)for(const r of s._drawWrappers)r&&this._materialContext===r.materialContext&&(r._wasPreviouslyReady=!1,r._wasPreviouslyUsingInstances=null,r._forceRebindOnNextCall=e)}e&&this.markAsDirty(Y.AllDirtyFlag)}_preBind(e,t=null){const i=this._scene.getEngine(),r=(t??this.sideOrientation)===Y.ClockWiseSideOrientation;return i.enableEffect(e||this._getDrawWrapper()),i.setState(this.backFaceCulling,this.zOffset,!1,r,this._scene._mirroredCameraPosition?!this.cullBackFaces:this.cullBackFaces,this.stencil,this.zOffsetUnits),r}bind(e,t){}buildUniformLayout(){const e=this._uniformBuffer;this._eventInfo.ubo=e,this._callbackPluginEventGeneric(8,this._eventInfo),e.create(),this._uniformBufferLayoutBuilt=!0}bindForSubMesh(e,t,i){const s=i._drawWrapper;this._eventInfo.subMesh=i,this._callbackPluginEventBindForSubMesh(this._eventInfo),s._forceRebindOnNextCall=!1}bindOnlyWorldMatrix(e){}bindView(e){this._useUBO?this._needToBindSceneUbo=!0:e.setMatrix("view",this.getScene().getViewMatrix())}bindViewProjection(e){this._useUBO?this._needToBindSceneUbo=!0:(e.setMatrix("viewProjection",this.getScene().getTransformMatrix()),e.setMatrix("projection",this.getScene().getProjectionMatrix()))}bindEyePosition(e,t){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(e,t)}_afterBind(e,t=null,i){if(this._scene._cachedMaterial=this,this._needToBindSceneUbo&&t&&(this._needToBindSceneUbo=!1,Yv(t,this.getScene().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),e?this._scene._cachedVisibility=e.visibility:this._scene._cachedVisibility=1,this._onBindObservable&&e&&this._onBindObservable.notifyObservers(e),this.disableDepthWrite){const s=this._scene.getEngine();this._cachedDepthWriteState=s.getDepthWrite(),s.setDepthWrite(!1)}if(this.disableColorWrite){const s=this._scene.getEngine();this._cachedColorWriteState=s.getColorWrite(),s.setColorWrite(!1)}if(this.depthFunction!==0){const s=this._scene.getEngine();this._cachedDepthFunctionState=s.getDepthFunction()||0,s.setDepthFunction(this.depthFunction)}}unbind(){this._scene.getSceneUniformBuffer().unbindEffect(),this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),this.depthFunction!==0&&this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState),this.disableDepthWrite&&this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState),this.disableColorWrite&&this._scene.getEngine().setColorWrite(this._cachedColorWriteState)}getAnimatables(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(256,this._eventInfo),this._eventInfo.animatables}getActiveTextures(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(512,this._eventInfo),this._eventInfo.activeTextures}hasTexture(e){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=e,this._callbackPluginEventGeneric(1024,this._eventInfo),this._eventInfo.hasTexture}clone(e){return null}_clonePlugins(e,t){const i={};if(this._serializePlugins(i),Y._ParsePlugins(i,e,this._scene,t),this.pluginManager)for(const s of this.pluginManager._plugins){const r=e.pluginManager.getPlugin(s.name);r&&s.copyTo(r)}}getBindedMeshes(){if(this.meshMap){const e=[];for(const t in this.meshMap){const i=this.meshMap[t];i&&e.push(i)}return e}else return this._scene.meshes.filter(t=>t.material===this)}forceCompilation(e,t,i,s){const r={clipPlane:!1,useInstances:!1,...i},a=this.getScene(),o=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;const l=()=>{if(!this._scene||!this._scene.getEngine())return;const h=a.clipPlane;if(r.clipPlane&&(a.clipPlane=new _i(0,0,0,1)),this._storeEffectOnSubMeshes){let u=!0,c=null;if(e.subMeshes){const f=new ss(0,0,0,0,0,e,void 0,!1,!1);f.materialDefines&&(f.materialDefines._renderId=-1),this.isReadyForSubMesh(e,f,r.useInstances)||(f.effect&&f.effect.getCompilationError()&&f.effect.allFallbacksProcessed()?c=f.effect.getCompilationError():(u=!1,setTimeout(l,16)))}u&&(this.allowShaderHotSwapping=o,c&&s&&s(c),t&&t(this))}else this.isReady()?(this.allowShaderHotSwapping=o,t&&t(this)):setTimeout(l,16);r.clipPlane&&(a.clipPlane=h)};l()}forceCompilationAsync(e,t){return new Promise((i,s)=>{this.forceCompilation(e,()=>{i()},t,r=>{s(r)})})}markAsDirty(e){this.getScene().blockMaterialDirtyMechanism||this._blockDirtyMechanism||(Y._DirtyCallbackArray.length=0,e&Y.ImageProcessingDirtyFlag&&Y._DirtyCallbackArray.push(Y._ImageProcessingDirtyCallBack),e&Y.TextureDirtyFlag&&Y._DirtyCallbackArray.push(Y._TextureDirtyCallBack),e&Y.LightDirtyFlag&&Y._DirtyCallbackArray.push(Y._LightsDirtyCallBack),e&Y.FresnelDirtyFlag&&Y._DirtyCallbackArray.push(Y._FresnelDirtyCallBack),e&Y.AttributesDirtyFlag&&Y._DirtyCallbackArray.push(Y._AttributeDirtyCallBack),e&Y.MiscDirtyFlag&&Y._DirtyCallbackArray.push(Y._MiscDirtyCallBack),e&Y.PrePassDirtyFlag&&Y._DirtyCallbackArray.push(Y._PrePassDirtyCallBack),Y._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(Y._RunDirtyCallBacks),this.getScene().resetCachedMaterial())}resetDrawCache(){const e=this.getScene().meshes;for(const t of e)if(t.subMeshes)for(const i of t.subMeshes)i.getMaterial()===this&&i.resetDrawCache()}_markAllSubMeshesAsDirty(e){const t=this.getScene();if(t.blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const i=t.meshes;for(const s of i)if(s.subMeshes){for(const r of s.subMeshes)if((r.getMaterial()||(t._hasDefaultMaterial?t.defaultMaterial:null))===this)for(const o of r._drawWrappers)!o||!o.defines||!o.defines.markAllAsDirty||this._materialContext===o.materialContext&&e(o.defines)}}_markScenePrePassDirty(){if(this.getScene().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const e=this.getScene().enablePrePassRenderer();e&&e.markAsDirty()}_markAllSubMeshesAsAllDirty(){this._markAllSubMeshesAsDirty(Y._AllDirtyCallBack)}_markAllSubMeshesAsImageProcessingDirty(){this._markAllSubMeshesAsDirty(Y._ImageProcessingDirtyCallBack)}_markAllSubMeshesAsTexturesDirty(){this._markAllSubMeshesAsDirty(Y._TextureDirtyCallBack)}_markAllSubMeshesAsFresnelDirty(){this._markAllSubMeshesAsDirty(Y._FresnelDirtyCallBack)}_markAllSubMeshesAsFresnelAndMiscDirty(){this._markAllSubMeshesAsDirty(Y._FresnelAndMiscDirtyCallBack)}_markAllSubMeshesAsLightsDirty(){this._markAllSubMeshesAsDirty(Y._LightsDirtyCallBack)}_markAllSubMeshesAsAttributesDirty(){this._markAllSubMeshesAsDirty(Y._AttributeDirtyCallBack)}_markAllSubMeshesAsMiscDirty(){this._markAllSubMeshesAsDirty(Y._MiscDirtyCallBack)}_markAllSubMeshesAsPrePassDirty(){this._markAllSubMeshesAsDirty(Y._PrePassDirtyCallBack)}_markAllSubMeshesAsTexturesAndMiscDirty(){this._markAllSubMeshesAsDirty(Y._TextureAndMiscDirtyCallBack)}_checkScenePerformancePriority(){if(this._scene.performancePriority!==0){this.checkReadyOnlyOnce=!0;const e=this._scene.onScenePerformancePriorityChangedObservable.addOnce(()=>{this.checkReadyOnlyOnce=!1});this.onDisposeObservable.add(()=>{this._scene.onScenePerformancePriorityChangedObservable.remove(e)})}}setPrePassRenderer(e){return!1}dispose(e,t,i){const s=this.getScene();if(s.stopAnimation(this),s.freeProcessedMaterials(),s.removeMaterial(this),this._eventInfo.forceDisposeTextures=t,this._callbackPluginEventGeneric(2,this._eventInfo),this._parentContainer){const r=this._parentContainer.materials.indexOf(this);r>-1&&this._parentContainer.materials.splice(r,1),this._parentContainer=null}if(i!==!0)if(this.meshMap)for(const r in this.meshMap){const a=this.meshMap[r];this._disposeMeshResources(a)}else{const r=s.meshes;for(const a of r)this._disposeMeshResources(a)}this._uniformBuffer.dispose(),this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear(),this._eventInfo&&(this._eventInfo={})}_disposeMeshResources(e){var s;if(!e)return;const t=e.geometry,i=e._internalAbstractMeshDataInfo._materialForRenderPass;if(this._storeEffectOnSubMeshes){if(e.subMeshes&&i)for(const r of e.subMeshes){const a=r._drawWrappers;for(let o=0;o<a.length;o++){const l=(s=a[o])==null?void 0:s.effect;if(!l)continue;i[o]===this&&(t==null||t._releaseVertexArrayObject(l),r._removeDrawWrapper(o,!0,!0))}}}else t==null||t._releaseVertexArrayObject(this._drawWrapper.effect);e.material===this&&!e.sourceMesh&&(e.material=null)}serialize(){const e=Ie.Serialize(this);return e.stencil=this.stencil.serialize(),e.uniqueId=this.uniqueId,this._serializePlugins(e),e}_serializePlugins(e){if(e.plugins={},this.pluginManager)for(const t of this.pluginManager._plugins)t.doNotSerialize||(e.plugins[t.getClassName()]=t.serialize())}static Parse(e,t,i){if(!e.customType)e.customType="BABYLON.StandardMaterial";else if(e.customType==="BABYLON.PBRMaterial"&&e.overloadedAlbedo&&(e.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return U.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null;const r=Z.Instantiate(e.customType).Parse(e,t,i);return r._loadedUniqueId=e.uniqueId,r}static _ParsePlugins(e,t,i,s){var r;if(e.plugins)for(const a in e.plugins){const o=e.plugins[a];let l=(r=t.pluginManager)==null?void 0:r.getPlugin(o.name);if(!l){const h=Z.Instantiate("BABYLON."+a);h&&(l=new h(t))}l==null||l.parse(o,i,s)}}}Y.TriangleFillMode=0;Y.WireFrameFillMode=1;Y.PointFillMode=2;Y.PointListDrawMode=3;Y.LineListDrawMode=4;Y.LineLoopDrawMode=5;Y.LineStripDrawMode=6;Y.TriangleStripDrawMode=7;Y.TriangleFanDrawMode=8;Y.ClockWiseSideOrientation=0;Y.CounterClockWiseSideOrientation=1;Y.ImageProcessingDirtyFlag=64;Y.TextureDirtyFlag=1;Y.LightDirtyFlag=2;Y.FresnelDirtyFlag=4;Y.AttributesDirtyFlag=8;Y.MiscDirtyFlag=16;Y.PrePassDirtyFlag=32;Y.AllDirtyFlag=127;Y.MATERIAL_OPAQUE=0;Y.MATERIAL_ALPHATEST=1;Y.MATERIAL_ALPHABLEND=2;Y.MATERIAL_ALPHATESTANDBLEND=3;Y.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0;Y.MATERIAL_NORMALBLENDMETHOD_RNM=1;Y.OnEventObservable=new q;Y._AllDirtyCallBack=n=>n.markAllAsDirty();Y._ImageProcessingDirtyCallBack=n=>n.markAsImageProcessingDirty();Y._TextureDirtyCallBack=n=>n.markAsTexturesDirty();Y._FresnelDirtyCallBack=n=>n.markAsFresnelDirty();Y._MiscDirtyCallBack=n=>n.markAsMiscDirty();Y._PrePassDirtyCallBack=n=>n.markAsPrePassDirty();Y._LightsDirtyCallBack=n=>n.markAsLightDirty();Y._AttributeDirtyCallBack=n=>n.markAsAttributesDirty();Y._FresnelAndMiscDirtyCallBack=n=>{Y._FresnelDirtyCallBack(n),Y._MiscDirtyCallBack(n)};Y._TextureAndMiscDirtyCallBack=n=>{Y._TextureDirtyCallBack(n),Y._MiscDirtyCallBack(n)};Y._DirtyCallbackArray=[];Y._RunDirtyCallBacks=n=>{for(const e of Y._DirtyCallbackArray)e(n)};P([B()],Y.prototype,"id",void 0);P([B()],Y.prototype,"uniqueId",void 0);P([B()],Y.prototype,"name",void 0);P([B()],Y.prototype,"metadata",void 0);P([B()],Y.prototype,"checkReadyOnEveryCall",void 0);P([B()],Y.prototype,"checkReadyOnlyOnce",void 0);P([B()],Y.prototype,"state",void 0);P([B("alpha")],Y.prototype,"_alpha",void 0);P([B("backFaceCulling")],Y.prototype,"_backFaceCulling",void 0);P([B("cullBackFaces")],Y.prototype,"_cullBackFaces",void 0);P([B()],Y.prototype,"sideOrientation",void 0);P([B("alphaMode")],Y.prototype,"_alphaMode",void 0);P([B()],Y.prototype,"_needDepthPrePass",void 0);P([B()],Y.prototype,"disableDepthWrite",void 0);P([B()],Y.prototype,"disableColorWrite",void 0);P([B()],Y.prototype,"forceDepthWrite",void 0);P([B()],Y.prototype,"depthFunction",void 0);P([B()],Y.prototype,"separateCullingPass",void 0);P([B("fogEnabled")],Y.prototype,"_fogEnabled",void 0);P([B()],Y.prototype,"pointSize",void 0);P([B()],Y.prototype,"zOffset",void 0);P([B()],Y.prototype,"zOffsetUnits",void 0);P([B()],Y.prototype,"pointsCloud",null);P([B()],Y.prototype,"fillMode",null);P([B()],Y.prototype,"useLogarithmicDepth",null);P([B()],Y.prototype,"transparencyMode",null);class wa extends Y{get subMaterials(){return this._subMaterials}set subMaterials(e){this._subMaterials=e,this._hookArray(e)}getChildren(){return this.subMaterials}constructor(e,t){super(e,t,!0),this._waitingSubMaterialsUniqueIds=[],this.getScene().addMultiMaterial(this),this.subMaterials=[],this._storeEffectOnSubMeshes=!0}_hookArray(e){const t=e.push;e.push=(...s)=>{const r=t.apply(e,s);return this._markAllSubMeshesAsTexturesDirty(),r};const i=e.splice;e.splice=(s,r)=>{const a=i.apply(e,[s,r]);return this._markAllSubMeshesAsTexturesDirty(),a}}getSubMaterial(e){return e<0||e>=this.subMaterials.length?this.getScene().defaultMaterial:this.subMaterials[e]}getActiveTextures(){return super.getActiveTextures().concat(...this.subMaterials.map(e=>e?e.getActiveTextures():[]))}hasTexture(e){var t;if(super.hasTexture(e))return!0;for(let i=0;i<this.subMaterials.length;i++)if((t=this.subMaterials[i])!=null&&t.hasTexture(e))return!0;return!1}getClassName(){return"MultiMaterial"}isReadyForSubMesh(e,t,i){for(let s=0;s<this.subMaterials.length;s++){const r=this.subMaterials[s];if(r){if(r._storeEffectOnSubMeshes){if(!r.isReadyForSubMesh(e,t,i))return!1;continue}if(!r.isReady(e))return!1}}return!0}clone(e,t){const i=new wa(e,this.getScene());for(let s=0;s<this.subMaterials.length;s++){let r=null;const a=this.subMaterials[s];t&&a?r=a.clone(e+"-"+a.name):r=this.subMaterials[s],i.subMaterials.push(r)}return i}serialize(){const e={};e.name=this.name,e.id=this.id,e.uniqueId=this.uniqueId,Ve&&(e.tags=Ve.GetTags(this)),e.materialsUniqueIds=[],e.materials=[];for(let t=0;t<this.subMaterials.length;t++){const i=this.subMaterials[t];i?(e.materialsUniqueIds.push(i.uniqueId),e.materials.push(i.id)):(e.materialsUniqueIds.push(null),e.materials.push(null))}return e}dispose(e,t,i){const s=this.getScene();if(!s)return;if(i)for(let a=0;a<this.subMaterials.length;a++){const o=this.subMaterials[a];o&&o.dispose(e,t)}const r=s.multiMaterials.indexOf(this);r>=0&&s.multiMaterials.splice(r,1),super.dispose(e,t)}static ParseMultiMaterial(e,t){const i=new wa(e.name,t);return i.id=e.id,i._loadedUniqueId=e.uniqueId,Ve&&Ve.AddTagsTo(i,e.tags),e.materialsUniqueIds?i._waitingSubMaterialsUniqueIds=e.materialsUniqueIds:e.materials.forEach(s=>i.subMaterials.push(t.getLastMaterialById(s))),i}}Tt("BABYLON.MultiMaterial",wa);class AE{constructor(e,t){this.distanceOrScreenCoverage=e,this.mesh=t}}class ey{}class EE{constructor(){this.visibleInstances={},this.batchCache=new Vg,this.batchCacheReplacementModeInFrozenMode=new Vg,this.instancesBufferSize=32*16*4}}class Vg{constructor(){this.mustReturn=!1,this.visibleInstances=new Array,this.renderSelf=[],this.hardwareInstancedRendering=[]}}class SE{constructor(){this.instancesCount=0,this.matrixBuffer=null,this.previousMatrixBuffer=null,this.matrixBufferSize=32*16,this.matrixData=null,this.boundingVectors=[],this.worldMatrices=null}}class RE{constructor(){this._areNormalsFrozen=!1,this._source=null,this.meshMap=null,this._preActivateId=-1,this._LODLevels=new Array,this._useLODScreenCoverage=!1,this._effectiveMaterial=null,this._forcedInstanceCount=0,this._overrideRenderingFillMode=null}}const Os={source:null,parent:null,doNotCloneChildren:!1,clonePhysicsImpostor:!0,cloneThinInstances:!1};class O extends it{static _GetDefaultSideOrientation(e){return e||O.FRONTSIDE}get useLODScreenCoverage(){return this._internalMeshDataInfo._useLODScreenCoverage}set useLODScreenCoverage(e){this._internalMeshDataInfo._useLODScreenCoverage=e,this._sortLODLevels()}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(e){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==e&&(e&&this._internalMeshDataInfo._sourcePositions&&(this.setVerticesData(S.PositionKind,this._internalMeshDataInfo._sourcePositions,!0),this._internalMeshDataInfo._sourceNormals&&this.setVerticesData(S.NormalKind,this._internalMeshDataInfo._sourceNormals,!0),this._internalMeshDataInfo._sourcePositions=null,this._internalMeshDataInfo._sourceNormals=null),this._internalAbstractMeshDataInfo._computeBonesUsingShaders=e,this._markSubMeshesAsAttributesDirty())}get onBeforeRenderObservable(){return this._internalMeshDataInfo._onBeforeRenderObservable||(this._internalMeshDataInfo._onBeforeRenderObservable=new q),this._internalMeshDataInfo._onBeforeRenderObservable}get onBeforeBindObservable(){return this._internalMeshDataInfo._onBeforeBindObservable||(this._internalMeshDataInfo._onBeforeBindObservable=new q),this._internalMeshDataInfo._onBeforeBindObservable}get onAfterRenderObservable(){return this._internalMeshDataInfo._onAfterRenderObservable||(this._internalMeshDataInfo._onAfterRenderObservable=new q),this._internalMeshDataInfo._onAfterRenderObservable}get onBetweenPassObservable(){return this._internalMeshDataInfo._onBetweenPassObservable||(this._internalMeshDataInfo._onBetweenPassObservable=new q),this._internalMeshDataInfo._onBetweenPassObservable}get onBeforeDrawObservable(){return this._internalMeshDataInfo._onBeforeDrawObservable||(this._internalMeshDataInfo._onBeforeDrawObservable=new q),this._internalMeshDataInfo._onBeforeDrawObservable}set onBeforeDraw(e){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver),this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(e)}get hasInstances(){return this.instances.length>0}get hasThinInstances(){return(this.forcedInstanceCount||this._thinInstanceDataStorage.instancesCount||0)>0}get forcedInstanceCount(){return this._internalMeshDataInfo._forcedInstanceCount}set forcedInstanceCount(e){this._internalMeshDataInfo._forcedInstanceCount=e}get sideOrientation(){return this._internalMeshDataInfo._sideOrientation}set sideOrientation(e){this._internalMeshDataInfo._sideOrientation=e,this._internalAbstractMeshDataInfo._sideOrientationHint=this._scene.useRightHandedSystem&&e===1||!this._scene.useRightHandedSystem&&e===0}get overrideMaterialSideOrientation(){return this.sideOrientation}set overrideMaterialSideOrientation(e){this.sideOrientation=e,this.material&&(this.material.sideOrientation=null)}get overrideRenderingFillMode(){return this._internalMeshDataInfo._overrideRenderingFillMode}set overrideRenderingFillMode(e){this._internalMeshDataInfo._overrideRenderingFillMode=e}get material(){return this._internalAbstractMeshDataInfo._material}set material(e){e&&(this.material&&this.material.sideOrientation===null||this._internalAbstractMeshDataInfo._sideOrientationHint)&&(e.sideOrientation=null),this._setMaterial(e)}get source(){return this._internalMeshDataInfo._source}get cloneMeshMap(){return this._internalMeshDataInfo.meshMap}get isUnIndexed(){return this._unIndexed}set isUnIndexed(e){this._unIndexed!==e&&(this._unIndexed=e,this._markSubMeshesAsAttributesDirty())}get worldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesData}get previousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesPreviousData}get manualUpdateOfWorldMatrixInstancedBuffer(){return this._instanceDataStorage.manualUpdate}set manualUpdateOfWorldMatrixInstancedBuffer(e){this._instanceDataStorage.manualUpdate=e}get manualUpdateOfPreviousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.previousManualUpdate}set manualUpdateOfPreviousWorldMatrixInstancedBuffer(e){this._instanceDataStorage.previousManualUpdate=e}get forceWorldMatrixInstancedBufferUpdate(){return this._instanceDataStorage.forceMatrixUpdates}set forceWorldMatrixInstancedBufferUpdate(e){this._instanceDataStorage.forceMatrixUpdates=e}_copySource(e,t,i=!0,s=!1){var a,o;const r=this.getScene();if(e._geometry&&e._geometry.applyToMesh(this),dd.DeepCopy(e,this,["name","material","skeleton","instances","parent","uniqueId","source","metadata","morphTargetManager","hasInstances","worldMatrixInstancedBuffer","previousWorldMatrixInstancedBuffer","hasLODLevels","geometry","isBlocked","areNormalsFrozen","facetNb","isFacetDataEnabled","lightSources","useBones","isAnInstance","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","isWorldMatrixFrozen","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","cloneMeshMap","hasBoundingInfo","physicsBody","physicsImpostor"],["_poseMatrix"]),this._internalMeshDataInfo._source=e,r.useClonedMeshMap&&(e._internalMeshDataInfo.meshMap||(e._internalMeshDataInfo.meshMap={}),e._internalMeshDataInfo.meshMap[this.uniqueId]=this),this._originalBuilderSideOrientation=e._originalBuilderSideOrientation,this._creationDataStorage=e._creationDataStorage,e._ranges){const l=e._ranges;for(const h in l)Object.prototype.hasOwnProperty.call(l,h)&&l[h]&&this.createAnimationRange(h,l[h].from,l[h].to)}if(e.metadata&&e.metadata.clone?this.metadata=e.metadata.clone():this.metadata=e.metadata,this._internalMetadata=e._internalMetadata,Ve&&Ve.HasTags(e)&&Ve.AddTagsTo(this,Ve.GetTags(e,!0)),this.setEnabled(e.isEnabled(!1)),this.parent=e.parent,this.setPivotMatrix(e.getPivotMatrix(),this._postMultiplyPivotMatrix),this.id=this.name+"."+e.id,this.material=e.material,!t){const l=e.getDescendants(!0);for(let h=0;h<l.length;h++){const u=l[h];u._isMesh?(Os.parent=this,Os.doNotCloneChildren=t,Os.clonePhysicsImpostor=i,Os.cloneThinInstances=s,u.clone(this.name+"."+u.name,Os)):u.clone&&u.clone(this.name+"."+u.name,this)}}if(e.morphTargetManager&&(this.morphTargetManager=e.morphTargetManager),r.getPhysicsEngine){const l=r.getPhysicsEngine();if(i&&l)if(l.getPluginVersion()===1){const h=l.getImpostorForPhysicsObject(e);h&&(this.physicsImpostor=h.clone(this))}else l.getPluginVersion()===2&&e.physicsBody&&e.physicsBody.clone(this)}for(let l=0;l<r.particleSystems.length;l++){const h=r.particleSystems[l];h.emitter===e&&h.clone(h.name,this)}if(this.skeleton=e.skeleton,s&&(e._thinInstanceDataStorage.matrixData?(this.thinInstanceSetBuffer("matrix",new Float32Array(e._thinInstanceDataStorage.matrixData),16,!e._thinInstanceDataStorage.matrixBuffer.isUpdatable()),this._thinInstanceDataStorage.matrixBufferSize=e._thinInstanceDataStorage.matrixBufferSize,this._thinInstanceDataStorage.instancesCount=e._thinInstanceDataStorage.instancesCount):this._thinInstanceDataStorage.matrixBufferSize=e._thinInstanceDataStorage.matrixBufferSize,e._userThinInstanceBuffersStorage)){const l=e._userThinInstanceBuffersStorage;for(const h in l.data)this.thinInstanceSetBuffer(h,new Float32Array(l.data[h]),l.strides[h],!((o=(a=l.vertexBuffers)==null?void 0:a[h])!=null&&o.isUpdatable())),this._userThinInstanceBuffersStorage.sizes[h]=l.sizes[h]}this.refreshBoundingInfo(!0,!0),this.computeWorldMatrix(!0)}constructor(e,t=null,i=null,s=null,r,a=!0){super(e,t),this._internalMeshDataInfo=new RE,this.delayLoadState=0,this.instances=[],this._creationDataStorage=null,this._geometry=null,this._instanceDataStorage=new EE,this._thinInstanceDataStorage=new SE,this._shouldGenerateFlatShading=!1,this._originalBuilderSideOrientation=O.DEFAULTSIDE,this.ignoreCameraMaxZ=!1,t=this.getScene(),this._scene.useRightHandedSystem?this.sideOrientation=0:this.sideOrientation=1,this._onBeforeDraw=(h,u,c)=>{h&&c&&(this._uniformBuffer?this.transferToEffect(u):c.bindOnlyWorldMatrix(u))};let o=null,l=!1;if(i&&i._addToSceneRootNodes===void 0){const h=i;o=h.parent??null,s=h.source??null,r=h.doNotCloneChildren??!1,a=h.clonePhysicsImpostor??!0,l=h.cloneThinInstances??!1}else o=i;s&&this._copySource(s,r,a,l),o!==null&&(this.parent=o),this._instanceDataStorage.hardwareInstancedRendering=this.getEngine().getCaps().instancedArrays,this._internalMeshDataInfo._onMeshReadyObserverAdded=h=>{h.unregisterOnNextCall=!0,this.isReady(!0)?this.onMeshReadyObservable.notifyObservers(this):this._internalMeshDataInfo._checkReadinessObserver||(this._internalMeshDataInfo._checkReadinessObserver=this._scene.onBeforeRenderObservable.add(()=>{this.isReady(!0)&&(this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),this._internalMeshDataInfo._checkReadinessObserver=null,this.onMeshReadyObservable.notifyObservers(this))}))},this.onMeshReadyObservable=new q(this._internalMeshDataInfo._onMeshReadyObserverAdded),s&&s.onClonedObservable.notifyObservers(this)}instantiateHierarchy(e=null,t,i){const s=this.getTotalVertices()===0||t&&t.doNotInstantiate&&(t.doNotInstantiate===!0||t.doNotInstantiate(this))?this.clone("Clone of "+(this.name||this.id),e||this.parent,!0):this.createInstance("instance of "+(this.name||this.id));s.parent=e||this.parent,s.position=this.position.clone(),s.scaling=this.scaling.clone(),this.rotationQuaternion?s.rotationQuaternion=this.rotationQuaternion.clone():s.rotation=this.rotation.clone(),i&&i(this,s);for(const r of this.getChildTransformNodes(!0))r.getClassName()==="InstancedMesh"&&s.getClassName()==="Mesh"&&r.sourceMesh===this?r.instantiateHierarchy(s,{doNotInstantiate:t&&t.doNotInstantiate||!1,newSourcedMesh:s},i):r.instantiateHierarchy(s,t,i);return s}getClassName(){return"Mesh"}get _isMesh(){return!0}toString(e){let t=super.toString(e);if(t+=", n vertices: "+this.getTotalVertices(),t+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),this.animations)for(let i=0;i<this.animations.length;i++)t+=", animation[0]: "+this.animations[i].toString(e);if(e)if(this._geometry){const i=this.getIndices(),s=this.getVerticesData(S.PositionKind);s&&i&&(t+=", flat shading: "+(s.length/3===i.length?"YES":"NO"))}else t+=", flat shading: UNKNOWN";return t}_unBindEffect(){super._unBindEffect();for(const e of this.instances)e._unBindEffect()}get hasLODLevels(){return this._internalMeshDataInfo._LODLevels.length>0}getLODLevels(){return this._internalMeshDataInfo._LODLevels}_sortLODLevels(){const e=this._internalMeshDataInfo._useLODScreenCoverage?-1:1;this._internalMeshDataInfo._LODLevels.sort((t,i)=>t.distanceOrScreenCoverage<i.distanceOrScreenCoverage?e:t.distanceOrScreenCoverage>i.distanceOrScreenCoverage?-e:0)}addLODLevel(e,t){if(t&&t._masterMesh)return U.Warn("You cannot use a mesh as LOD level twice"),this;const i=new AE(e,t);return this._internalMeshDataInfo._LODLevels.push(i),t&&(t._masterMesh=this),this._sortLODLevels(),this}getLODLevelAtDistance(e){const t=this._internalMeshDataInfo;for(let i=0;i<t._LODLevels.length;i++){const s=t._LODLevels[i];if(s.distanceOrScreenCoverage===e)return s.mesh}return null}removeLODLevel(e){const t=this._internalMeshDataInfo;for(let i=0;i<t._LODLevels.length;i++)t._LODLevels[i].mesh===e&&(t._LODLevels.splice(i,1),e&&(e._masterMesh=null));return this._sortLODLevels(),this}getLOD(e,t){const i=this._internalMeshDataInfo;if(!i._LODLevels||i._LODLevels.length===0)return this;const s=t||this.getBoundingInfo().boundingSphere,r=e.mode===be.ORTHOGRAPHIC_CAMERA?e.minZ:s.centerWorld.subtract(e.globalPosition).length();let a=r,o=1;if(i._useLODScreenCoverage){const l=e.screenArea;let h=s.radiusWorld*e.minZ/r;h=h*h*Math.PI,a=h/l,o=-1}if(o*i._LODLevels[i._LODLevels.length-1].distanceOrScreenCoverage>o*a)return this.onLODLevelSelection&&this.onLODLevelSelection(a,this,this),this;for(let l=0;l<i._LODLevels.length;l++){const h=i._LODLevels[l];if(o*h.distanceOrScreenCoverage<o*a){if(h.mesh){if(h.mesh.delayLoadState===4)return h.mesh._checkDelayState(),this;if(h.mesh.delayLoadState===2)return this;h.mesh._preActivate(),h.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)}return this.onLODLevelSelection&&this.onLODLevelSelection(a,this,h.mesh),h.mesh}}return this.onLODLevelSelection&&this.onLODLevelSelection(a,this,this),this}get geometry(){return this._geometry}getTotalVertices(){return this._geometry===null||this._geometry===void 0?0:this._geometry.getTotalVertices()}getVerticesData(e,t,i,s){var a,o;if(!this._geometry)return null;let r=s||(o=(a=this._userInstancedBuffersStorage)==null?void 0:a.vertexBuffers[e])==null?void 0:o.getFloatData(this.instances.length+1,i||t&&this._geometry.meshes.length!==1);return r||(r=this._geometry.getVerticesData(e,t,i)),r}copyVerticesData(e,t){this._geometry&&this._geometry.copyVerticesData(e,t)}getVertexBuffer(e,t){var i;return this._geometry?(t||(i=this._userInstancedBuffersStorage)==null?void 0:i.vertexBuffers[e])??this._geometry.getVertexBuffer(e):null}isVerticesDataPresent(e,t){var i;return this._geometry?!t&&((i=this._userInstancedBuffersStorage)==null?void 0:i.vertexBuffers[e])!==void 0||this._geometry.isVerticesDataPresent(e):this._delayInfo?this._delayInfo.indexOf(e)!==-1:!1}isVertexBufferUpdatable(e,t){var i;if(!this._geometry)return this._delayInfo?this._delayInfo.indexOf(e)!==-1:!1;if(!t){const s=(i=this._userInstancedBuffersStorage)==null?void 0:i.vertexBuffers[e];if(s)return s.isUpdatable()}return this._geometry.isVertexBufferUpdatable(e)}getVerticesDataKinds(e){if(!this._geometry){const i=[];return this._delayInfo&&this._delayInfo.forEach(function(s){i.push(s)}),i}const t=this._geometry.getVerticesDataKinds();if(!e&&this._userInstancedBuffersStorage)for(const i in this._userInstancedBuffersStorage.vertexBuffers)t.indexOf(i)===-1&&t.push(i);return t}getTotalIndices(){return this._geometry?this._geometry.getTotalIndices():0}getIndices(e,t){return this._geometry?this._geometry.getIndices(e,t):[]}get isBlocked(){return this._masterMesh!==null&&this._masterMesh!==void 0}isReady(e=!1,t=!1){var l,h,u,c,f;if(this.delayLoadState===2||!super.isReady(e))return!1;if(!this.subMeshes||this.subMeshes.length===0||!e)return!0;const i=this.getEngine(),s=this.getScene(),r=t||i.getCaps().instancedArrays&&(this.instances.length>0||this.hasThinInstances);this.computeWorldMatrix();const a=this.material||s.defaultMaterial;if(a){if(a._storeEffectOnSubMeshes)for(const d of this.subMeshes){const _=d.getMaterial();if(_){if(_._storeEffectOnSubMeshes){if(!_.isReadyForSubMesh(this,d,r))return!1}else if(!_.isReady(this,r))return!1}}else if(!a.isReady(this,r))return!1}const o=i.currentRenderPassId;for(const d of this.lightSources){const _=d.getShadowGenerators();if(!_)continue;const p=_.values();for(let g=p.next();g.done!==!0;g=p.next()){const m=g.value;if(m&&(!((l=m.getShadowMap())!=null&&l.renderList)||(h=m.getShadowMap())!=null&&h.renderList&&((c=(u=m.getShadowMap())==null?void 0:u.renderList)==null?void 0:c.indexOf(this))!==-1)){const T=m.getShadowMap().renderPassIds??[i.currentRenderPassId];for(let A=0;A<T.length;++A){i.currentRenderPassId=T[A];for(const b of this.subMeshes)if(!m.isReady(b,r,((f=b.getMaterial())==null?void 0:f.needAlphaBlendingForMesh(this))??!1))return i.currentRenderPassId=o,!1}i.currentRenderPassId=o}}}for(const d of this._internalMeshDataInfo._LODLevels)if(d.mesh&&!d.mesh.isReady(r))return!1;return!0}get areNormalsFrozen(){return this._internalMeshDataInfo._areNormalsFrozen}freezeNormals(){return this._internalMeshDataInfo._areNormalsFrozen=!0,this}unfreezeNormals(){return this._internalMeshDataInfo._areNormalsFrozen=!1,this}set overridenInstanceCount(e){this._instanceDataStorage.overridenInstanceCount=e}_preActivate(){const e=this._internalMeshDataInfo,t=this.getScene().getRenderId();return e._preActivateId===t?this:(e._preActivateId=t,this._instanceDataStorage.visibleInstances=null,this)}_preActivateForIntermediateRendering(e){return this._instanceDataStorage.visibleInstances&&(this._instanceDataStorage.visibleInstances.intermediateDefaultRenderId=e),this}_registerInstanceForRenderId(e,t){return this._instanceDataStorage.visibleInstances||(this._instanceDataStorage.visibleInstances={defaultRenderId:t,selfDefaultRenderId:this._renderId}),this._instanceDataStorage.visibleInstances[t]||(this._instanceDataStorage.previousRenderId!==void 0&&this._instanceDataStorage.isFrozen&&(this._instanceDataStorage.visibleInstances[this._instanceDataStorage.previousRenderId]=null),this._instanceDataStorage.previousRenderId=t,this._instanceDataStorage.visibleInstances[t]=new Array),this._instanceDataStorage.visibleInstances[t].push(e),this}_afterComputeWorldMatrix(){super._afterComputeWorldMatrix(),this.hasThinInstances&&(this.doNotSyncBoundingInfo||this.thinInstanceRefreshBoundingInfo(!1))}_postActivate(){this.edgesShareWithInstances&&this.edgesRenderer&&this.edgesRenderer.isEnabled&&this._renderingGroup&&(this._renderingGroup._edgesRenderers.pushNoDuplicate(this.edgesRenderer),this.edgesRenderer.customInstances.push(this.getWorldMatrix()))}refreshBoundingInfo(e=!1,t=!1){if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;let i;typeof e=="object"?i=e:i={applySkeleton:e,applyMorph:t};const s=this.geometry?this.geometry.boundingBias:null;return this._refreshBoundingInfo(this._getData(i,null,S.PositionKind),s),this}_createGlobalSubMesh(e){const t=this.getTotalVertices();if(!t||!this.getIndices())return null;if(this.subMeshes&&this.subMeshes.length>0){const i=this.getIndices();if(!i)return null;const s=i.length;let r=!1;if(e)r=!0;else for(const a of this.subMeshes){if(a.indexStart+a.indexCount>s){r=!0;break}if(a.verticesStart+a.verticesCount>t){r=!0;break}}if(!r)return this.subMeshes[0]}return this.releaseSubMeshes(),new ss(0,0,t,0,this.getTotalIndices()||t,this)}subdivide(e){if(e<1)return;const t=this.getTotalIndices();let i=t/e|0,s=0;for(;i%3!==0;)i++;this.releaseSubMeshes();for(let r=0;r<e&&!(s>=t);r++)ss.CreateFromIndices(0,s,r===e-1?t-s:i,this,void 0,!1),s+=i;this.refreshBoundingInfo(),this.synchronizeInstances()}setVerticesData(e,t,i=!1,s){if(this._geometry)this._geometry.setVerticesData(e,t,i,s);else{const r=new Q;r.set(t,e);const a=this.getScene();new Jt(Jt.RandomId(),a,r,i,this)}return this}removeVerticesData(e){this._geometry&&this._geometry.removeVerticesData(e)}markVerticesDataAsUpdatable(e,t=!0){const i=this.getVertexBuffer(e);!i||i.isUpdatable()===t||this.setVerticesData(e,this.getVerticesData(e),t)}setVerticesBuffer(e,t=!0){return this._geometry||(this._geometry=Jt.CreateGeometryForMesh(this)),this._geometry.setVerticesBuffer(e,null,t),this}updateVerticesData(e,t,i,s){return this._geometry?(s?(this.makeGeometryUnique(),this.updateVerticesData(e,t,i,!1)):this._geometry.updateVerticesData(e,t,i),this):this}updateMeshPositions(e,t=!0){const i=this.getVerticesData(S.PositionKind);if(!i)return this;if(e(i),this.updateVerticesData(S.PositionKind,i,!1,!1),t){const s=this.getIndices(),r=this.getVerticesData(S.NormalKind);if(!r)return this;Q.ComputeNormals(i,s,r),this.updateVerticesData(S.NormalKind,r,!1,!1)}return this}makeGeometryUnique(){if(!this._geometry)return this;if(this._geometry.meshes.length===1)return this;const e=this._geometry,t=this._geometry.copy(Jt.RandomId());return e.releaseForMesh(this,!0),t.applyToMesh(this),this}setIndexBuffer(e,t,i,s=null){let r=this._geometry;r||(r=new Jt(Jt.RandomId(),this.getScene(),void 0,void 0,this)),r.setIndexBuffer(e,t,i,s)}setIndices(e,t=null,i=!1,s=!1){if(this._geometry)this._geometry.setIndices(e,t,i,s);else{const r=new Q;r.indices=e;const a=this.getScene();new Jt(Jt.RandomId(),a,r,i,this)}return this}updateIndices(e,t,i=!1){return this._geometry?(this._geometry.updateIndices(e,t,i),this):this}toLeftHanded(){return this._geometry?(this._geometry.toLeftHanded(),this):this}_bind(e,t,i,s=!0){if(!this._geometry)return this;const r=this.getScene().getEngine();let a;if(this._unIndexed)switch(this._getRenderingFillMode(i)){case Y.WireFrameFillMode:a=e._getLinesIndexBuffer(this.getIndices(),r);break;default:a=null;break}else switch(this._getRenderingFillMode(i)){case Y.PointFillMode:a=null;break;case Y.WireFrameFillMode:a=e._getLinesIndexBuffer(this.getIndices(),r);break;default:case Y.TriangleFillMode:a=this._geometry.getIndexBuffer();break}return this._bindDirect(t,a,s)}_bindDirect(e,t,i=!0){return this._geometry?(this.morphTargetManager&&this.morphTargetManager.isUsingTextureForTargets&&this.morphTargetManager._bind(e),!i||!this._userInstancedBuffersStorage||this.hasThinInstances?this._geometry._bind(e,t):this._geometry._bind(e,t,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects),this):this}_draw(e,t,i){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeDrawObservable&&this._internalMeshDataInfo._onBeforeDrawObservable.notifyObservers(this);const r=this.getScene().getEngine();return this._unIndexed&&t!==Y.WireFrameFillMode||t==Y.PointFillMode?r.drawArraysType(t,e.verticesStart,e.verticesCount,this.forcedInstanceCount||i):t==Y.WireFrameFillMode?r.drawElementsType(t,0,e._linesIndexCount,this.forcedInstanceCount||i):r.drawElementsType(t,e.indexStart,e.indexCount,this.forcedInstanceCount||i),this}registerBeforeRender(e){return this.onBeforeRenderObservable.add(e),this}unregisterBeforeRender(e){return this.onBeforeRenderObservable.removeCallback(e),this}registerAfterRender(e){return this.onAfterRenderObservable.add(e),this}unregisterAfterRender(e){return this.onAfterRenderObservable.removeCallback(e),this}_getInstancesRenderList(e,t=!1){if(this._instanceDataStorage.isFrozen){if(t)return this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.hardwareInstancedRendering[e]=!1,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.renderSelf[e]=!0,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode;if(this._instanceDataStorage.previousBatch)return this._instanceDataStorage.previousBatch}const i=this.getScene(),s=i._isInIntermediateRendering(),r=s?this._internalAbstractMeshDataInfo._onlyForInstancesIntermediate:this._internalAbstractMeshDataInfo._onlyForInstances,a=this._instanceDataStorage.batchCache;if(a.mustReturn=!1,a.renderSelf[e]=t||!r&&this.isEnabled()&&this.isVisible,a.visibleInstances[e]=null,this._instanceDataStorage.visibleInstances&&!t){const o=this._instanceDataStorage.visibleInstances,l=i.getRenderId(),h=s?o.intermediateDefaultRenderId:o.defaultRenderId;a.visibleInstances[e]=o[l],!a.visibleInstances[e]&&h&&(a.visibleInstances[e]=o[h])}return a.hardwareInstancedRendering[e]=!t&&this._instanceDataStorage.hardwareInstancedRendering&&a.visibleInstances[e]!==null&&a.visibleInstances[e]!==void 0,this._instanceDataStorage.previousBatch=a,a}_updateInstancedBuffers(e,t,i,s,r,a){var g;const o=t.visibleInstances[e._id],l=o?o.length:0,h=this._instanceDataStorage;let u=h.instancesBuffer,c=h.instancesPreviousBuffer,f=0,d=0;const _=t.renderSelf[e._id],p=!u||i!==h.instancesBufferSize||this._scene.needsPreviousWorldMatrices&&!h.instancesPreviousBuffer;if(!this._instanceDataStorage.manualUpdate&&(!h.isFrozen||p)){const m=this.getWorldMatrix();if(_&&(this._scene.needsPreviousWorldMatrices&&(h.masterMeshPreviousWorldMatrix?(h.masterMeshPreviousWorldMatrix.copyToArray(h.instancesPreviousData,f),h.masterMeshPreviousWorldMatrix.copyFrom(m)):(h.masterMeshPreviousWorldMatrix=m.clone(),h.masterMeshPreviousWorldMatrix.copyToArray(h.instancesPreviousData,f))),m.copyToArray(h.instancesData,f),f+=16,d++),o){if(O.INSTANCEDMESH_SORT_TRANSPARENT&&this._scene.activeCamera&&((g=e.getMaterial())!=null&&g.needAlphaBlendingForMesh(e.getRenderingMesh()))){const v=this._scene.activeCamera.globalPosition;for(let T=0;T<o.length;T++){const A=o[T];A._distanceToCamera=y.Distance(A.getBoundingInfo().boundingSphere.centerWorld,v)}o.sort((T,A)=>T._distanceToCamera>A._distanceToCamera?-1:T._distanceToCamera<A._distanceToCamera?1:0)}for(let v=0;v<o.length;v++){const T=o[v],A=T.getWorldMatrix();A.copyToArray(h.instancesData,f),this._scene.needsPreviousWorldMatrices&&(T._previousWorldMatrix?(T._previousWorldMatrix.copyToArray(h.instancesPreviousData,f),T._previousWorldMatrix.copyFrom(A)):(T._previousWorldMatrix=A.clone(),T._previousWorldMatrix.copyToArray(h.instancesPreviousData,f))),f+=16,d++}}}else d=(_?1:0)+l;p?(u&&u.dispose(),c&&c.dispose(),u=new Pa(s,h.instancesData,!0,16,!1,!0),h.instancesBuffer=u,this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this._userInstancedBuffersStorage.vertexBuffers.world0=u.createVertexBuffer("world0",0,4),this._userInstancedBuffersStorage.vertexBuffers.world1=u.createVertexBuffer("world1",4,4),this._userInstancedBuffersStorage.vertexBuffers.world2=u.createVertexBuffer("world2",8,4),this._userInstancedBuffersStorage.vertexBuffers.world3=u.createVertexBuffer("world3",12,4),this._scene.needsPreviousWorldMatrices&&(c=new Pa(s,h.instancesPreviousData,!0,16,!1,!0),h.instancesPreviousBuffer=c,this._userInstancedBuffersStorage.vertexBuffers.previousWorld0=c.createVertexBuffer("previousWorld0",0,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld1=c.createVertexBuffer("previousWorld1",4,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld2=c.createVertexBuffer("previousWorld2",8,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld3=c.createVertexBuffer("previousWorld3",12,4)),this._invalidateInstanceVertexArrayObject()):(!this._instanceDataStorage.isFrozen||this._instanceDataStorage.forceMatrixUpdates)&&(u.updateDirectly(h.instancesData,0,d),this._scene.needsPreviousWorldMatrices&&(!this._instanceDataStorage.manualUpdate||this._instanceDataStorage.previousManualUpdate)&&c.updateDirectly(h.instancesPreviousData,0,d)),this._processInstancedBuffers(o,_),a&&r!==void 0&&(this.getScene()._activeIndices.addCount(e.indexCount*d,!1),s._currentDrawContext&&(s._currentDrawContext.useInstancing=!0),this._bind(e,a,r),this._draw(e,r,d)),this._scene.needsPreviousWorldMatrices&&!p&&this._instanceDataStorage.manualUpdate&&(!this._instanceDataStorage.isFrozen||this._instanceDataStorage.forceMatrixUpdates)&&!this._instanceDataStorage.previousManualUpdate&&c.updateDirectly(h.instancesData,0,d)}_renderWithInstances(e,t,i,s,r){const a=i.visibleInstances[e._id],o=a?a.length:0,l=this._instanceDataStorage,h=l.instancesBufferSize,c=(o+1)*16*4;for(;l.instancesBufferSize<c;)l.instancesBufferSize*=2;return(!l.instancesData||h!=l.instancesBufferSize)&&(l.instancesData=new Float32Array(l.instancesBufferSize/4)),(this._scene.needsPreviousWorldMatrices&&!l.instancesPreviousData||h!=l.instancesBufferSize)&&(l.instancesPreviousData=new Float32Array(l.instancesBufferSize/4)),this._updateInstancedBuffers(e,i,h,r,t,s),r.unbindInstanceAttributes(),this}_renderWithThinInstances(e,t,i,s){var a;const r=((a=this._thinInstanceDataStorage)==null?void 0:a.instancesCount)??0;this.getScene()._activeIndices.addCount(e.indexCount*r,!1),s._currentDrawContext&&(s._currentDrawContext.useInstancing=!0),this._bind(e,i,t),this._draw(e,t,r),this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData&&this._thinInstanceDataStorage.matrixData&&(this._thinInstanceDataStorage.previousMatrixBuffer?this._thinInstanceDataStorage.previousMatrixBuffer.updateDirectly(this._thinInstanceDataStorage.matrixData,0,r):this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.matrixData,!1)),s.unbindInstanceAttributes()}_processInstancedBuffers(e,t){}_processRendering(e,t,i,s,r,a,o,l){const h=this.getScene(),u=h.getEngine();if(s=this._getRenderingFillMode(s),a&&t.getRenderingMesh().hasThinInstances)return this._renderWithThinInstances(t,s,i,u),this;if(a)this._renderWithInstances(t,s,r,i,u);else{u._currentDrawContext&&(u._currentDrawContext.useInstancing=!1);let c=0;r.renderSelf[t._id]&&(o&&o(!1,e.getWorldMatrix(),l),c++,this._draw(t,s,this._instanceDataStorage.overridenInstanceCount));const f=r.visibleInstances[t._id];if(f){const d=f.length;c+=d;for(let _=0;_<d;_++){const g=f[_].getWorldMatrix();o&&o(!0,g,l),this._draw(t,s)}}h._activeIndices.addCount(t.indexCount*c,!1)}return this}_rebuild(e=!1){if(this._instanceDataStorage.instancesBuffer&&(e&&this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null),this._userInstancedBuffersStorage){for(const t in this._userInstancedBuffersStorage.vertexBuffers){const i=this._userInstancedBuffersStorage.vertexBuffers[t];i&&(e&&i.dispose(),this._userInstancedBuffersStorage.vertexBuffers[t]=null)}this._userInstancedBuffersStorage.vertexArrayObjects&&(this._userInstancedBuffersStorage.vertexArrayObjects={})}this._internalMeshDataInfo._effectiveMaterial=null,super._rebuild(e)}_freeze(){if(this.subMeshes){for(let e=0;e<this.subMeshes.length;e++)this._getInstancesRenderList(e);this._internalMeshDataInfo._effectiveMaterial=null,this._instanceDataStorage.isFrozen=!0}}_unFreeze(){this._instanceDataStorage.isFrozen=!1,this._instanceDataStorage.previousBatch=null}renderWithRenderPassId(e,t,i,s,r=!0){const a=this._scene.getEngine(),o=a.currentRenderPassId;if(e!==void 0&&(a.currentRenderPassId=e),s)(!r||r&&s.isInFrustum(this._scene._frustumPlanes))&&this.render(s,!!t,i);else for(let l=0;l<this.subMeshes.length;l++){const h=this.subMeshes[l];(!r||r&&h.isInFrustum(this._scene._frustumPlanes))&&this.render(h,!!t,i)}return e!==void 0&&(a.currentRenderPassId=o),this}directRender(){if(!this.subMeshes)return this;for(const e of this.subMeshes)this.render(e,!1);return this}render(e,t,i){var E,R;const s=this.getScene();this._internalAbstractMeshDataInfo._isActiveIntermediate?this._internalAbstractMeshDataInfo._isActiveIntermediate=!1:this._internalAbstractMeshDataInfo._isActive=!1;const r=((E=s.activeCameras)==null?void 0:E.length)??0;if((r>1&&s.activeCamera===s.activeCameras[0]||r<=1)&&this._checkOcclusionQuery()&&!this._occlusionDataStorage.forceRenderingWhenOccluded)return this;const o=this._getInstancesRenderList(e._id,!!i);if(o.mustReturn)return this;if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const l=s.getEngine();let h=0,u=null;this.ignoreCameraMaxZ&&s.activeCamera&&!s._isInIntermediateRendering()&&(h=s.activeCamera.maxZ,u=s.activeCamera,s.activeCamera.maxZ=0,s.updateTransformMatrix(!0)),this._internalMeshDataInfo._onBeforeRenderObservable&&this._internalMeshDataInfo._onBeforeRenderObservable.notifyObservers(this);const c=e.getRenderingMesh(),f=o.hardwareInstancedRendering[e._id]||c.hasThinInstances||!!this._userInstancedBuffersStorage&&!e.getMesh()._internalAbstractMeshDataInfo._actAsRegularMesh,d=this._instanceDataStorage,_=e.getMaterial();if(!_)return u&&(u.maxZ=h,s.updateTransformMatrix(!0)),this;if(!d.isFrozen||!this._internalMeshDataInfo._effectiveMaterial||this._internalMeshDataInfo._effectiveMaterial!==_){if(_._storeEffectOnSubMeshes){if(!_.isReadyForSubMesh(this,e,f))return u&&(u.maxZ=h,s.updateTransformMatrix(!0)),this}else if(!_.isReady(this,f))return u&&(u.maxZ=h,s.updateTransformMatrix(!0)),this;this._internalMeshDataInfo._effectiveMaterial=_}else if(_._storeEffectOnSubMeshes&&!((R=e._drawWrapper)!=null&&R._wasPreviouslyReady)||!_._storeEffectOnSubMeshes&&!_._getDrawWrapper()._wasPreviouslyReady)return u&&(u.maxZ=h,s.updateTransformMatrix(!0)),this;t&&l.setAlphaMode(this._internalMeshDataInfo._effectiveMaterial.alphaMode);let p;this._internalMeshDataInfo._effectiveMaterial._storeEffectOnSubMeshes?p=e._drawWrapper:p=this._internalMeshDataInfo._effectiveMaterial._getDrawWrapper();const g=(p==null?void 0:p.effect)??null;for(const C of s._beforeRenderingMeshStage)C.action(this,e,o,g);if(!p||!g)return u&&(u.maxZ=h,s.updateTransformMatrix(!0)),this;const m=i||this;let v;if(!d.isFrozen&&(this._internalMeshDataInfo._effectiveMaterial.backFaceCulling||this._internalMeshDataInfo._effectiveMaterial.sideOrientation!==null||this._internalMeshDataInfo._effectiveMaterial.twoSidedLighting)){const C=m._getWorldMatrixDeterminant();v=this._internalMeshDataInfo._effectiveMaterial._getEffectiveOrientation(this),C<0&&(v=v===Y.ClockWiseSideOrientation?Y.CounterClockWiseSideOrientation:Y.ClockWiseSideOrientation),d.sideOrientation=v}else v=d.sideOrientation;const T=this._internalMeshDataInfo._effectiveMaterial._preBind(p,v);this._internalMeshDataInfo._effectiveMaterial.forceDepthWrite&&l.setDepthWrite(!0);const A=this._internalMeshDataInfo._effectiveMaterial,b=A.fillMode;this._internalMeshDataInfo._onBeforeBindObservable&&this._internalMeshDataInfo._onBeforeBindObservable.notifyObservers(this),f||this._bind(e,g,b,!1);const x=m.getWorldMatrix();A._storeEffectOnSubMeshes?A.bindForSubMesh(x,this,e):A.bind(x,this),!A.backFaceCulling&&A.separateCullingPass&&(l.setState(!0,A.zOffset,!1,!T,A.cullBackFaces,A.stencil,A.zOffsetUnits),this._processRendering(this,e,g,b,o,f,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),l.setState(!0,A.zOffset,!1,T,A.cullBackFaces,A.stencil,A.zOffsetUnits),this._internalMeshDataInfo._onBetweenPassObservable&&this._internalMeshDataInfo._onBetweenPassObservable.notifyObservers(e)),this._processRendering(this,e,g,b,o,f,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),this._internalMeshDataInfo._effectiveMaterial.unbind();for(const C of s._afterRenderingMeshStage)C.action(this,e,o,g);return this._internalMeshDataInfo._onAfterRenderObservable&&this._internalMeshDataInfo._onAfterRenderObservable.notifyObservers(this),u&&(u.maxZ=h,s.updateTransformMatrix(!0)),s.performancePriority===2&&!d.isFrozen&&this._freeze(),this}cleanMatrixWeights(){this.isVerticesDataPresent(S.MatricesWeightsKind)&&(this.isVerticesDataPresent(S.MatricesWeightsExtraKind)?this._normalizeSkinWeightsAndExtra():this._normalizeSkinFourWeights())}_normalizeSkinFourWeights(){const e=this.getVerticesData(S.MatricesWeightsKind),t=e.length;for(let i=0;i<t;i+=4){const s=e[i]+e[i+1]+e[i+2]+e[i+3];if(s===0)e[i]=1;else{const r=1/s;e[i]*=r,e[i+1]*=r,e[i+2]*=r,e[i+3]*=r}}this.setVerticesData(S.MatricesWeightsKind,e)}_normalizeSkinWeightsAndExtra(){const e=this.getVerticesData(S.MatricesWeightsExtraKind),t=this.getVerticesData(S.MatricesWeightsKind),i=t.length;for(let s=0;s<i;s+=4){let r=t[s]+t[s+1]+t[s+2]+t[s+3];if(r+=e[s]+e[s+1]+e[s+2]+e[s+3],r===0)t[s]=1;else{const a=1/r;t[s]*=a,t[s+1]*=a,t[s+2]*=a,t[s+3]*=a,e[s]*=a,e[s+1]*=a,e[s+2]*=a,e[s+3]*=a}}this.setVerticesData(S.MatricesWeightsKind,t),this.setVerticesData(S.MatricesWeightsKind,e)}validateSkinning(){const e=this.getVerticesData(S.MatricesWeightsExtraKind),t=this.getVerticesData(S.MatricesWeightsKind);if(t===null||this.skeleton==null)return{skinned:!1,valid:!0,report:"not skinned"};const i=t.length;let s=0,r=0,a=0,o=0;const l=e===null?4:8,h=[];for(let g=0;g<=l;g++)h[g]=0;const u=.001;for(let g=0;g<i;g+=4){let m=t[g],v=m,T=v===0?0:1;for(let A=1;A<l;A++){const b=A<4?t[g+A]:e[g+A-4];b>m&&s++,b!==0&&T++,v+=b,m=b}if(h[T]++,T>a&&(a=T),v===0)r++;else{const A=1/v;let b=0;for(let x=0;x<l;x++)x<4?b+=Math.abs(t[g+x]-t[g+x]*A):b+=Math.abs(e[g+x-4]-e[g+x-4]*A);b>u&&o++}}const c=this.skeleton.bones.length,f=this.getVerticesData(S.MatricesIndicesKind),d=this.getVerticesData(S.MatricesIndicesExtraKind);let _=0;for(let g=0;g<i;g+=4)for(let m=0;m<l;m++){const v=m<4?f[g+m]:d[g+m-4];(v>=c||v<0)&&_++}const p="Number of Weights = "+i/4+`
Maximum influences = `+a+`
Missing Weights = `+r+`
Not Sorted = `+s+`
Not Normalized = `+o+`
WeightCounts = [`+h+`]
Number of bones = `+c+`
Bad Bone Indices = `+_;return{skinned:!0,valid:r===0&&o===0&&_===0,report:p}}_checkDelayState(){const e=this.getScene();return this._geometry?this._geometry.load(e):this.delayLoadState===4&&(this.delayLoadState=2,this._queueLoad(e)),this}_queueLoad(e){e.addPendingData(this);const t=this.delayLoadingFile.indexOf(".babylonbinarymeshdata")!==-1;return Z.LoadFile(this.delayLoadingFile,i=>{i instanceof ArrayBuffer?this._delayLoadingFunction(i,this):this._delayLoadingFunction(JSON.parse(i),this),this.instances.forEach(s=>{s.refreshBoundingInfo(),s._syncSubMeshes()}),this.delayLoadState=1,e.removePendingData(this)},()=>{},e.offlineProvider,t),this}isInFrustum(e){return this.delayLoadState===2||!super.isInFrustum(e)?!1:(this._checkDelayState(),!0)}setMaterialById(e){const t=this.getScene().materials;let i;for(i=t.length-1;i>-1;i--)if(t[i].id===e)return this.material=t[i],this;const s=this.getScene().multiMaterials;for(i=s.length-1;i>-1;i--)if(s[i].id===e)return this.material=s[i],this;return this}getAnimatables(){const e=[];return this.material&&e.push(this.material),this.skeleton&&e.push(this.skeleton),e}bakeTransformIntoVertices(e){if(!this.isVerticesDataPresent(S.PositionKind))return this;const t=this.subMeshes.splice(0);this._resetPointsArrayCache();let i=this.getVerticesData(S.PositionKind);const s=y.Zero();let r;for(r=0;r<i.length;r+=3)y.TransformCoordinatesFromFloatsToRef(i[r],i[r+1],i[r+2],e,s).toArray(i,r);if(this.setVerticesData(S.PositionKind,i,this.getVertexBuffer(S.PositionKind).isUpdatable()),this.isVerticesDataPresent(S.NormalKind)){for(i=this.getVerticesData(S.NormalKind),r=0;r<i.length;r+=3)y.TransformNormalFromFloatsToRef(i[r],i[r+1],i[r+2],e,s).normalize().toArray(i,r);this.setVerticesData(S.NormalKind,i,this.getVertexBuffer(S.NormalKind).isUpdatable())}if(this.isVerticesDataPresent(S.TangentKind)){for(i=this.getVerticesData(S.TangentKind),r=0;r<i.length;r+=4)y.TransformNormalFromFloatsToRef(i[r],i[r+1],i[r+2],e,s).normalize().toArray(i,r);this.setVerticesData(S.TangentKind,i,this.getVertexBuffer(S.TangentKind).isUpdatable())}return e.determinant()<0&&this.flipFaces(),this.releaseSubMeshes(),this.subMeshes=t,this}bakeCurrentTransformIntoVertices(e=!0,t=!1){return t&&this.makeGeometryUnique(),this.bakeTransformIntoVertices(this.computeWorldMatrix(!0)),this.resetLocalMatrix(e),this}get _positions(){return this._internalAbstractMeshDataInfo._positions||this._geometry&&this._geometry._positions||null}_resetPointsArrayCache(){return this._geometry&&this._geometry._resetPointsArrayCache(),this}_generatePointsArray(){return this._geometry?this._geometry._generatePointsArray():!1}clone(e="",t=null,i,s=!0){if(t&&t._addToSceneRootNodes===void 0){const r=t;return Os.source=this,Os.doNotCloneChildren=r.doNotCloneChildren,Os.clonePhysicsImpostor=r.clonePhysicsImpostor,Os.cloneThinInstances=r.cloneThinInstances,new O(e,this.getScene(),Os)}return new O(e,this.getScene(),t,this,i,s)}dispose(e,t=!1){this.morphTargetManager=null,this._geometry&&this._geometry.releaseForMesh(this,!0);const i=this._internalMeshDataInfo;if(i._onBeforeDrawObservable&&i._onBeforeDrawObservable.clear(),i._onBeforeBindObservable&&i._onBeforeBindObservable.clear(),i._onBeforeRenderObservable&&i._onBeforeRenderObservable.clear(),i._onAfterRenderObservable&&i._onAfterRenderObservable.clear(),i._onBetweenPassObservable&&i._onBetweenPassObservable.clear(),this._scene.useClonedMeshMap){if(i.meshMap)for(const s in i.meshMap){const r=i.meshMap[s];r&&(r._internalMeshDataInfo._source=null,i.meshMap[s]=void 0)}i._source&&i._source._internalMeshDataInfo.meshMap&&(i._source._internalMeshDataInfo.meshMap[this.uniqueId]=void 0)}else{const s=this.getScene().meshes;for(const r of s){const a=r;a._internalMeshDataInfo&&a._internalMeshDataInfo._source&&a._internalMeshDataInfo._source===this&&(a._internalMeshDataInfo._source=null)}}i._source=null,this._instanceDataStorage.visibleInstances={},this._disposeInstanceSpecificData(),this._disposeThinInstanceSpecificData(),this._internalMeshDataInfo._checkReadinessObserver&&this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),super.dispose(e,t)}_disposeInstanceSpecificData(){}_disposeThinInstanceSpecificData(){}_invalidateInstanceVertexArrayObject(){}applyDisplacementMap(e,t,i,s,r,a,o=!1,l){const h=this.getScene(),u=c=>{const f=c.width,d=c.height,p=this.getEngine().createCanvas(f,d).getContext("2d");p.drawImage(c,0,0);const g=p.getImageData(0,0,f,d).data;this.applyDisplacementMapFromBuffer(g,f,d,t,i,r,a,o),s&&s(this)};return Z.LoadImage(e,u,l||(()=>{}),h.offlineProvider),this}applyDisplacementMapFromBuffer(e,t,i,s,r,a,o,l=!1){if(!this.isVerticesDataPresent(S.PositionKind)||!this.isVerticesDataPresent(S.NormalKind)||!this.isVerticesDataPresent(S.UVKind))return U.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"),this;const h=this.getVerticesData(S.PositionKind,!0,!0),u=this.getVerticesData(S.NormalKind),c=this.getVerticesData(S.UVKind);let f=y.Zero();const d=y.Zero(),_=ne.Zero();a=a||ne.Zero(),o=o||new ne(1,1);for(let p=0;p<h.length;p+=3){y.FromArrayToRef(h,p,f),y.FromArrayToRef(u,p,d),ne.FromArrayToRef(c,p/3*2,_);const g=Math.abs(_.x*o.x+a.x%1)*(t-1)%t|0,m=Math.abs(_.y*o.y+a.y%1)*(i-1)%i|0,v=(g+m*t)*4,T=e[v]/255,A=e[v+1]/255,b=e[v+2]/255,x=T*.3+A*.59+b*.11;d.normalize(),d.scaleInPlace(s+(r-s)*x),f=f.add(d),f.toArray(h,p)}return Q.ComputeNormals(h,this.getIndices(),u),l?(this.setVerticesData(S.PositionKind,h),this.setVerticesData(S.NormalKind,u),this.setVerticesData(S.UVKind,c)):(this.updateVerticesData(S.PositionKind,h),this.updateVerticesData(S.NormalKind,u)),this}_getFlattenedNormals(e,t){const i=new Float32Array(e.length*3);let s=0;const r=this.sideOrientation===(this._scene.useRightHandedSystem?1:0);for(let a=0;a<e.length;a+=3){const o=y.FromArray(t,e[a]*3),l=y.FromArray(t,e[a+1]*3),h=y.FromArray(t,e[a+2]*3),u=o.subtract(l),c=h.subtract(l),f=y.Normalize(y.Cross(u,c));r&&f.scaleInPlace(-1);for(let d=0;d<3;d++)i[s++]=f.x,i[s++]=f.y,i[s++]=f.z}return i}_convertToUnIndexedMesh(e=!1){const t=this.getVerticesDataKinds().filter(l=>{var h;return!((h=this.getVertexBuffer(l))!=null&&h.getIsInstanced())}),i=this.getIndices(),s={},r=(l,h)=>{const u=new Float32Array(i.length*h);let c=0;for(let f=0;f<i.length;f++)for(let d=0;d<h;d++)u[c++]=l[i[f]*h+d];return u},a=this.getBoundingInfo(),o=this.geometry?this.subMeshes.slice(0):[];for(const l of t)s[l]=this.getVerticesData(l);for(const l of t){const h=this.getVertexBuffer(l),u=h.getSize();if(e&&l===S.NormalKind){const c=this._getFlattenedNormals(i,s[S.PositionKind]);this.setVerticesData(S.NormalKind,c,h.isUpdatable(),u)}else this.setVerticesData(l,r(s[l],u),h.isUpdatable(),u)}if(this.morphTargetManager){for(let l=0;l<this.morphTargetManager.numTargets;l++){const h=this.morphTargetManager.getTarget(l),u=h.getPositions();h.setPositions(r(u,3));const c=h.getNormals();c&&h.setNormals(e?this._getFlattenedNormals(i,u):r(c,3));const f=h.getTangents();f&&h.setTangents(r(f,3));const d=h.getUVs();d&&h.setUVs(r(d,2));const _=h.getColors();_&&h.setColors(r(_,4))}this.morphTargetManager.synchronize()}for(let l=0;l<i.length;l++)i[l]=l;this.setIndices(i),this._unIndexed=!0,this.releaseSubMeshes();for(const l of o){const h=l.getBoundingInfo();ss.AddToMesh(l.materialIndex,l.indexStart,l.indexCount,l.indexStart,l.indexCount,this).setBoundingInfo(h)}return this.setBoundingInfo(a),this.synchronizeInstances(),this}convertToFlatShadedMesh(){return this._convertToUnIndexedMesh(!0)}convertToUnIndexedMesh(){return this._convertToUnIndexedMesh()}flipFaces(e=!1){const t=Q.ExtractFromMesh(this);let i;if(e&&this.isVerticesDataPresent(S.NormalKind)&&t.normals){for(i=0;i<t.normals.length;i++)t.normals[i]*=-1;this.setVerticesData(S.NormalKind,t.normals,this.isVertexBufferUpdatable(S.NormalKind))}if(t.indices){let s;for(i=0;i<t.indices.length;i+=3)s=t.indices[i+1],t.indices[i+1]=t.indices[i+2],t.indices[i+2]=s;this.setIndices(t.indices,null,this.isVertexBufferUpdatable(S.PositionKind),!0)}return this}increaseVertices(e=1){const t=Q.ExtractFromMesh(this),i=t.indices&&!Array.isArray(t.indices)&&Array.from?Array.from(t.indices):t.indices,s=t.positions&&!Array.isArray(t.positions)&&Array.from?Array.from(t.positions):t.positions,r=t.uvs&&!Array.isArray(t.uvs)&&Array.from?Array.from(t.uvs):t.uvs,a=t.normals&&!Array.isArray(t.normals)&&Array.from?Array.from(t.normals):t.normals;if(!i||!s)U.Warn("Couldn't increase number of vertices : VertexData must contain at least indices and positions");else{t.indices=i,t.positions=s,r&&(t.uvs=r),a&&(t.normals=a);const o=e+1,l=new Array;for(let b=0;b<o+1;b++)l[b]=new Array;let h,u;const c=new y(0,0,0),f=new y(0,0,0),d=new ne(0,0),_=new Array,p=new Array,g=new Array;let m,v=s.length,T;r&&(T=r.length);let A;a&&(A=a.length);for(let b=0;b<i.length;b+=3){p[0]=i[b],p[1]=i[b+1],p[2]=i[b+2];for(let x=0;x<3;x++)if(h=p[x],u=p[(x+1)%3],g[h]===void 0&&g[u]===void 0?(g[h]=new Array,g[u]=new Array):(g[h]===void 0&&(g[h]=new Array),g[u]===void 0&&(g[u]=new Array)),g[h][u]===void 0&&g[u][h]===void 0){g[h][u]=[],c.x=(s[3*u]-s[3*h])/o,c.y=(s[3*u+1]-s[3*h+1])/o,c.z=(s[3*u+2]-s[3*h+2])/o,a&&(f.x=(a[3*u]-a[3*h])/o,f.y=(a[3*u+1]-a[3*h+1])/o,f.z=(a[3*u+2]-a[3*h+2])/o),r&&(d.x=(r[2*u]-r[2*h])/o,d.y=(r[2*u+1]-r[2*h+1])/o),g[h][u].push(h);for(let E=1;E<o;E++)g[h][u].push(s.length/3),s[v++]=s[3*h]+E*c.x,s[v++]=s[3*h+1]+E*c.y,s[v++]=s[3*h+2]+E*c.z,a&&(a[A++]=a[3*h]+E*f.x,a[A++]=a[3*h+1]+E*f.y,a[A++]=a[3*h+2]+E*f.z),r&&(r[T++]=r[2*h]+E*d.x,r[T++]=r[2*h+1]+E*d.y);g[h][u].push(u),g[u][h]=new Array,m=g[h][u].length;for(let E=0;E<m;E++)g[u][h][E]=g[h][u][m-1-E]}l[0][0]=i[b],l[1][0]=g[i[b]][i[b+1]][1],l[1][1]=g[i[b]][i[b+2]][1];for(let x=2;x<o;x++){l[x][0]=g[i[b]][i[b+1]][x],l[x][x]=g[i[b]][i[b+2]][x],c.x=(s[3*l[x][x]]-s[3*l[x][0]])/x,c.y=(s[3*l[x][x]+1]-s[3*l[x][0]+1])/x,c.z=(s[3*l[x][x]+2]-s[3*l[x][0]+2])/x,a&&(f.x=(a[3*l[x][x]]-a[3*l[x][0]])/x,f.y=(a[3*l[x][x]+1]-a[3*l[x][0]+1])/x,f.z=(a[3*l[x][x]+2]-a[3*l[x][0]+2])/x),r&&(d.x=(r[2*l[x][x]]-r[2*l[x][0]])/x,d.y=(r[2*l[x][x]+1]-r[2*l[x][0]+1])/x);for(let E=1;E<x;E++)l[x][E]=s.length/3,s[v++]=s[3*l[x][0]]+E*c.x,s[v++]=s[3*l[x][0]+1]+E*c.y,s[v++]=s[3*l[x][0]+2]+E*c.z,a&&(a[A++]=a[3*l[x][0]]+E*f.x,a[A++]=a[3*l[x][0]+1]+E*f.y,a[A++]=a[3*l[x][0]+2]+E*f.z),r&&(r[T++]=r[2*l[x][0]]+E*d.x,r[T++]=r[2*l[x][0]+1]+E*d.y)}l[o]=g[i[b+1]][i[b+2]],_.push(l[0][0],l[1][0],l[1][1]);for(let x=1;x<o;x++){let E;for(E=0;E<x;E++)_.push(l[x][E],l[x+1][E],l[x+1][E+1]),_.push(l[x][E],l[x+1][E+1],l[x][E+1]);_.push(l[x][E],l[x+1][E],l[x+1][E+1])}}t.indices=_,t.applyToMesh(this,this.isVertexBufferUpdatable(S.PositionKind))}}forceSharedVertices(){const e=Q.ExtractFromMesh(this),t=e.uvs,i=e.indices,s=e.positions,r=e.colors,a=e.matricesIndices,o=e.matricesWeights,l=e.matricesIndicesExtra,h=e.matricesWeightsExtra;if(i===void 0||s===void 0||i===null||s===null)U.Warn("VertexData contains empty entries");else{const u=new Array,c=new Array,f=new Array,d=new Array,_=new Array,p=new Array,g=new Array,m=new Array;let v=new Array,T=0;const A={};let b,x;for(let R=0;R<i.length;R+=3){x=[i[R],i[R+1],i[R+2]],v=[];for(let C=0;C<3;C++){v[C]="";for(let I=0;I<3;I++)Math.abs(s[3*x[C]+I])<1e-8&&(s[3*x[C]+I]=0),v[C]+=s[3*x[C]+I]+"|"}if(!(v[0]==v[1]||v[0]==v[2]||v[1]==v[2]))for(let C=0;C<3;C++){if(b=A[v[C]],b===void 0){A[v[C]]=T,b=T++;for(let I=0;I<3;I++)u.push(s[3*x[C]+I]);if(r!=null)for(let I=0;I<4;I++)d.push(r[4*x[C]+I]);if(t!=null)for(let I=0;I<2;I++)f.push(t[2*x[C]+I]);if(a!=null)for(let I=0;I<4;I++)_.push(a[4*x[C]+I]);if(o!=null)for(let I=0;I<4;I++)p.push(o[4*x[C]+I]);if(l!=null)for(let I=0;I<4;I++)g.push(l[4*x[C]+I]);if(h!=null)for(let I=0;I<4;I++)m.push(h[4*x[C]+I])}c.push(b)}}const E=new Array;Q.ComputeNormals(u,c,E),e.positions=u,e.indices=c,e.normals=E,t!=null&&(e.uvs=f),r!=null&&(e.colors=d),a!=null&&(e.matricesIndices=_),o!=null&&(e.matricesWeights=p),l!=null&&(e.matricesIndicesExtra=g),o!=null&&(e.matricesWeightsExtra=m),e.applyToMesh(this,this.isVertexBufferUpdatable(S.PositionKind))}}static _instancedMeshFactory(e,t){throw Ee("InstancedMesh")}static _PhysicsImpostorParser(e,t,i){throw Ee("PhysicsImpostor")}createInstance(e){const t=O._instancedMeshFactory(e,this);return t.parent=this.parent,t}synchronizeInstances(){for(let e=0;e<this.instances.length;e++)this.instances[e]._syncSubMeshes();return this}optimizeIndices(e){const t=this.getIndices(),i=this.getVerticesData(S.PositionKind);if(!i||!t)return this;const s=[];for(let a=0;a<i.length;a=a+3)s.push(y.FromArray(i,a));const r=[];return Gl.SyncAsyncForLoop(s.length,40,a=>{const o=s.length-1-a,l=s[o];for(let h=0;h<o;++h){const u=s[h];if(l.equals(u)){r[o]=h;break}}},()=>{for(let o=0;o<t.length;++o)t[o]=r[t[o]]||t[o];const a=this.subMeshes.slice(0);this.setIndices(t),this.subMeshes=a,e&&e(this)}),this}serialize(e={}){e.name=this.name,e.id=this.id,e.uniqueId=this.uniqueId,e.type=this.getClassName(),Ve&&Ve.HasTags(this)&&(e.tags=Ve.GetTags(this)),e.position=this.position.asArray(),this.rotationQuaternion?e.rotationQuaternion=this.rotationQuaternion.asArray():this.rotation&&(e.rotation=this.rotation.asArray()),e.scaling=this.scaling.asArray(),this._postMultiplyPivotMatrix?e.pivotMatrix=this.getPivotMatrix().asArray():e.localMatrix=this.getPivotMatrix().asArray(),e.isEnabled=this.isEnabled(!1),e.isVisible=this.isVisible,e.infiniteDistance=this.infiniteDistance,e.pickable=this.isPickable,e.receiveShadows=this.receiveShadows,e.billboardMode=this.billboardMode,e.visibility=this.visibility,e.alwaysSelectAsActiveMesh=this.alwaysSelectAsActiveMesh,e.checkCollisions=this.checkCollisions,e.ellipsoid=this.ellipsoid.asArray(),e.ellipsoidOffset=this.ellipsoidOffset.asArray(),e.doNotSyncBoundingInfo=this.doNotSyncBoundingInfo,e.isBlocker=this.isBlocker,e.sideOrientation=this.sideOrientation,this.parent&&this.parent._serializeAsParent(e),e.isUnIndexed=this.isUnIndexed;const t=this._geometry;if(t&&this.subMeshes){e.geometryUniqueId=t.uniqueId,e.geometryId=t.id,e.subMeshes=[];for(let i=0;i<this.subMeshes.length;i++){const s=this.subMeshes[i];e.subMeshes.push({materialIndex:s.materialIndex,verticesStart:s.verticesStart,verticesCount:s.verticesCount,indexStart:s.indexStart,indexCount:s.indexCount})}}if(this.material?this.material.doNotSerialize||(e.materialUniqueId=this.material.uniqueId,e.materialId=this.material.id):(this.material=null,e.materialUniqueId=this._scene.defaultMaterial.uniqueId,e.materialId=this._scene.defaultMaterial.id),this.morphTargetManager&&(e.morphTargetManagerId=this.morphTargetManager.uniqueId),this.skeleton&&(e.skeletonId=this.skeleton.id,e.numBoneInfluencers=this.numBoneInfluencers),this.getScene()._getComponent(Me.NAME_PHYSICSENGINE)){const i=this.getPhysicsImpostor();i&&(e.physicsMass=i.getParam("mass"),e.physicsFriction=i.getParam("friction"),e.physicsRestitution=i.getParam("mass"),e.physicsImpostor=i.type)}this.metadata&&(e.metadata=this.metadata),e.instances=[];for(let i=0;i<this.instances.length;i++){const s=this.instances[i];if(s.doNotSerialize)continue;const r={name:s.name,id:s.id,isEnabled:s.isEnabled(!1),isVisible:s.isVisible,isPickable:s.isPickable,checkCollisions:s.checkCollisions,position:s.position.asArray(),scaling:s.scaling.asArray()};if(s.parent&&s.parent._serializeAsParent(r),s.rotationQuaternion?r.rotationQuaternion=s.rotationQuaternion.asArray():s.rotation&&(r.rotation=s.rotation.asArray()),this.getScene()._getComponent(Me.NAME_PHYSICSENGINE)){const a=s.getPhysicsImpostor();a&&(r.physicsMass=a.getParam("mass"),r.physicsFriction=a.getParam("friction"),r.physicsRestitution=a.getParam("mass"),r.physicsImpostor=a.type)}s.metadata&&(r.metadata=s.metadata),s.actionManager&&(r.actions=s.actionManager.serialize(s.name)),e.instances.push(r),Ie.AppendSerializedAnimations(s,r),r.ranges=s.serializeAnimationRanges()}if(this._thinInstanceDataStorage.instancesCount&&this._thinInstanceDataStorage.matrixData&&(e.thinInstances={instancesCount:this._thinInstanceDataStorage.instancesCount,matrixData:Array.from(this._thinInstanceDataStorage.matrixData),matrixBufferSize:this._thinInstanceDataStorage.matrixBufferSize,enablePicking:this.thinInstanceEnablePicking},this._userThinInstanceBuffersStorage)){const i={data:{},sizes:{},strides:{}};for(const s in this._userThinInstanceBuffersStorage.data)i.data[s]=Array.from(this._userThinInstanceBuffersStorage.data[s]),i.sizes[s]=this._userThinInstanceBuffersStorage.sizes[s],i.strides[s]=this._userThinInstanceBuffersStorage.strides[s];e.thinInstances.userThinInstance=i}return Ie.AppendSerializedAnimations(this,e),e.ranges=this.serializeAnimationRanges(),e.layerMask=this.layerMask,e.alphaIndex=this.alphaIndex,e.hasVertexAlpha=this.hasVertexAlpha,e.overlayAlpha=this.overlayAlpha,e.overlayColor=this.overlayColor.asArray(),e.renderOverlay=this.renderOverlay,e.applyFog=this.applyFog,this.actionManager&&(e.actions=this.actionManager.serialize(this.name)),e}_syncGeometryWithMorphTargetManager(){if(!this.geometry)return;this._markSubMeshesAsAttributesDirty();const e=this._internalAbstractMeshDataInfo._morphTargetManager;if(e&&e.vertexCount){if(e.vertexCount!==this.getTotalVertices()){U.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."),this.morphTargetManager=null;return}if(e.isUsingTextureForTargets)return;for(let t=0;t<e.numInfluencers;t++){const i=e.getActiveTarget(t),s=i.getPositions();if(!s){U.Error("Invalid morph target. Target must have positions.");return}this.geometry.setVerticesData(S.PositionKind+t,s,!1,3);const r=i.getNormals();r&&this.geometry.setVerticesData(S.NormalKind+t,r,!1,3);const a=i.getTangents();a&&this.geometry.setVerticesData(S.TangentKind+t,a,!1,3);const o=i.getUVs();o&&this.geometry.setVerticesData(S.UVKind+"_"+t,o,!1,2);const l=i.getUV2s();l&&this.geometry.setVerticesData(S.UV2Kind+"_"+t,l,!1,2);const h=i.getColors();h&&this.geometry.setVerticesData(S.ColorKind+t,h,!1,4)}}else{let t=0;for(;this.geometry.isVerticesDataPresent(S.PositionKind+t);)this.geometry.removeVerticesData(S.PositionKind+t),this.geometry.isVerticesDataPresent(S.NormalKind+t)&&this.geometry.removeVerticesData(S.NormalKind+t),this.geometry.isVerticesDataPresent(S.TangentKind+t)&&this.geometry.removeVerticesData(S.TangentKind+t),this.geometry.isVerticesDataPresent(S.UVKind+t)&&this.geometry.removeVerticesData(S.UVKind+"_"+t),this.geometry.isVerticesDataPresent(S.UV2Kind+t)&&this.geometry.removeVerticesData(S.UV2Kind+"_"+t),this.geometry.isVerticesDataPresent(S.ColorKind+t)&&this.geometry.removeVerticesData(S.ColorKind+t),t++}}static Parse(e,t,i){let s;if(e.type&&e.type==="LinesMesh"?s=O._LinesMeshParser(e,t):e.type&&e.type==="GroundMesh"?s=O._GroundMeshParser(e,t):e.type&&e.type==="GoldbergMesh"?s=O._GoldbergMeshParser(e,t):e.type&&e.type==="GreasedLineMesh"?s=O._GreasedLineMeshParser(e,t):e.type&&e.type==="TrailMesh"?s=O._TrailMeshParser(e,t):s=new O(e.name,t),s.id=e.id,s._waitingParsedUniqueId=e.uniqueId,Ve&&Ve.AddTagsTo(s,e.tags),s.position=y.FromArray(e.position),e.metadata!==void 0&&(s.metadata=e.metadata),e.rotationQuaternion?s.rotationQuaternion=se.FromArray(e.rotationQuaternion):e.rotation&&(s.rotation=y.FromArray(e.rotation)),s.scaling=y.FromArray(e.scaling),e.localMatrix?s.setPreTransformMatrix(L.FromArray(e.localMatrix)):e.pivotMatrix&&s.setPivotMatrix(L.FromArray(e.pivotMatrix)),s.setEnabled(e.isEnabled),s.isVisible=e.isVisible,s.infiniteDistance=e.infiniteDistance,s.alwaysSelectAsActiveMesh=!!e.alwaysSelectAsActiveMesh,s.showBoundingBox=e.showBoundingBox,s.showSubMeshesBoundingBox=e.showSubMeshesBoundingBox,e.applyFog!==void 0&&(s.applyFog=e.applyFog),e.pickable!==void 0&&(s.isPickable=e.pickable),e.alphaIndex!==void 0&&(s.alphaIndex=e.alphaIndex),s.receiveShadows=e.receiveShadows,e.billboardMode!==void 0&&(s.billboardMode=e.billboardMode),e.visibility!==void 0&&(s.visibility=e.visibility),s.checkCollisions=e.checkCollisions,s.doNotSyncBoundingInfo=!!e.doNotSyncBoundingInfo,e.ellipsoid&&(s.ellipsoid=y.FromArray(e.ellipsoid)),e.ellipsoidOffset&&(s.ellipsoidOffset=y.FromArray(e.ellipsoidOffset)),e.overrideMaterialSideOrientation!=null&&(s.sideOrientation=e.overrideMaterialSideOrientation),e.sideOrientation!==void 0&&(s.sideOrientation=e.sideOrientation),e.isBlocker!==void 0&&(s.isBlocker=e.isBlocker),s._shouldGenerateFlatShading=e.useFlatShading,e.freezeWorldMatrix&&(s._waitingData.freezeWorldMatrix=e.freezeWorldMatrix),e.parentId!==void 0&&(s._waitingParentId=e.parentId),e.parentInstanceIndex!==void 0&&(s._waitingParentInstanceIndex=e.parentInstanceIndex),e.actions!==void 0&&(s._waitingData.actions=e.actions),e.overlayAlpha!==void 0&&(s.overlayAlpha=e.overlayAlpha),e.overlayColor!==void 0&&(s.overlayColor=fe.FromArray(e.overlayColor)),e.renderOverlay!==void 0&&(s.renderOverlay=e.renderOverlay),s.isUnIndexed=!!e.isUnIndexed,s.hasVertexAlpha=e.hasVertexAlpha,e.delayLoadingFile?(s.delayLoadState=4,s.delayLoadingFile=i+e.delayLoadingFile,s.buildBoundingInfo(y.FromArray(e.boundingBoxMinimum),y.FromArray(e.boundingBoxMaximum)),e._binaryInfo&&(s._binaryInfo=e._binaryInfo),s._delayInfo=[],e.hasUVs&&s._delayInfo.push(S.UVKind),e.hasUVs2&&s._delayInfo.push(S.UV2Kind),e.hasUVs3&&s._delayInfo.push(S.UV3Kind),e.hasUVs4&&s._delayInfo.push(S.UV4Kind),e.hasUVs5&&s._delayInfo.push(S.UV5Kind),e.hasUVs6&&s._delayInfo.push(S.UV6Kind),e.hasColors&&s._delayInfo.push(S.ColorKind),e.hasMatricesIndices&&s._delayInfo.push(S.MatricesIndicesKind),e.hasMatricesWeights&&s._delayInfo.push(S.MatricesWeightsKind),s._delayLoadingFunction=Jt._ImportGeometry,Ct.ForceFullSceneLoadingForIncremental&&s._checkDelayState()):Jt._ImportGeometry(e,s),e.materialUniqueId?s._waitingMaterialId=e.materialUniqueId:e.materialId&&(s._waitingMaterialId=e.materialId),e.morphTargetManagerId>-1&&(s._waitingMorphTargetManagerId=e.morphTargetManagerId),e.skeletonId!==void 0&&e.skeletonId!==null&&(s.skeleton=t.getLastSkeletonById(e.skeletonId),e.numBoneInfluencers&&(s.numBoneInfluencers=e.numBoneInfluencers)),e.animations){for(let r=0;r<e.animations.length;r++){const a=e.animations[r],o=Zn("BABYLON.Animation");o&&s.animations.push(o.Parse(a))}Rt.ParseAnimationRanges(s,e,t)}if(e.autoAnimate&&t.beginAnimation(s,e.autoAnimateFrom,e.autoAnimateTo,e.autoAnimateLoop,e.autoAnimateSpeed||1),e.layerMask&&!isNaN(e.layerMask)?s.layerMask=Math.abs(parseInt(e.layerMask)):s.layerMask=268435455,e.physicsImpostor&&(s.physicsImpostor=O._PhysicsImpostorParser(t,s,e)),e.lodMeshIds&&(s._waitingData.lods={ids:e.lodMeshIds,distances:e.lodDistances?e.lodDistances:null,coverages:e.lodCoverages?e.lodCoverages:null}),e.instances)for(let r=0;r<e.instances.length;r++){const a=e.instances[r],o=s.createInstance(a.name);if(a.id&&(o.id=a.id),Ve&&(a.tags?Ve.AddTagsTo(o,a.tags):Ve.AddTagsTo(o,e.tags)),o.position=y.FromArray(a.position),a.metadata!==void 0&&(o.metadata=a.metadata),a.parentId!==void 0&&(o._waitingParentId=a.parentId),a.parentInstanceIndex!==void 0&&(o._waitingParentInstanceIndex=a.parentInstanceIndex),a.isEnabled!==void 0&&a.isEnabled!==null&&o.setEnabled(a.isEnabled),a.isVisible!==void 0&&a.isVisible!==null&&(o.isVisible=a.isVisible),a.isPickable!==void 0&&a.isPickable!==null&&(o.isPickable=a.isPickable),a.rotationQuaternion?o.rotationQuaternion=se.FromArray(a.rotationQuaternion):a.rotation&&(o.rotation=y.FromArray(a.rotation)),o.scaling=y.FromArray(a.scaling),a.checkCollisions!=null&&a.checkCollisions!=null&&(o.checkCollisions=a.checkCollisions),a.pickable!=null&&a.pickable!=null&&(o.isPickable=a.pickable),a.showBoundingBox!=null&&a.showBoundingBox!=null&&(o.showBoundingBox=a.showBoundingBox),a.showSubMeshesBoundingBox!=null&&a.showSubMeshesBoundingBox!=null&&(o.showSubMeshesBoundingBox=a.showSubMeshesBoundingBox),a.alphaIndex!=null&&a.showSubMeshesBoundingBox!=null&&(o.alphaIndex=a.alphaIndex),a.physicsImpostor&&(o.physicsImpostor=O._PhysicsImpostorParser(t,o,a)),a.actions!==void 0&&(o._waitingData.actions=a.actions),a.animations){for(let l=0;l<a.animations.length;l++){const h=a.animations[l],u=Zn("BABYLON.Animation");u&&o.animations.push(u.Parse(h))}Rt.ParseAnimationRanges(o,a,t),a.autoAnimate&&t.beginAnimation(o,a.autoAnimateFrom,a.autoAnimateTo,a.autoAnimateLoop,a.autoAnimateSpeed||1)}}if(e.thinInstances){const r=e.thinInstances;if(s.thinInstanceEnablePicking=!!r.enablePicking,r.matrixData?(s.thinInstanceSetBuffer("matrix",new Float32Array(r.matrixData),16,!1),s._thinInstanceDataStorage.matrixBufferSize=r.matrixBufferSize,s._thinInstanceDataStorage.instancesCount=r.instancesCount):s._thinInstanceDataStorage.matrixBufferSize=r.matrixBufferSize,e.thinInstances.userThinInstance){const a=e.thinInstances.userThinInstance;for(const o in a.data)s.thinInstanceSetBuffer(o,new Float32Array(a.data[o]),a.strides[o],!1),s._userThinInstanceBuffersStorage.sizes[o]=a.sizes[o]}}return s}setPositionsForCPUSkinning(){const e=this._internalMeshDataInfo;if(!e._sourcePositions){const t=this.getVerticesData(S.PositionKind);if(!t)return e._sourcePositions;e._sourcePositions=new Float32Array(t),this.isVertexBufferUpdatable(S.PositionKind)||this.setVerticesData(S.PositionKind,t,!0)}return e._sourcePositions}setNormalsForCPUSkinning(){const e=this._internalMeshDataInfo;if(!e._sourceNormals){const t=this.getVerticesData(S.NormalKind);if(!t)return e._sourceNormals;e._sourceNormals=new Float32Array(t),this.isVertexBufferUpdatable(S.NormalKind)||this.setVerticesData(S.NormalKind,t,!0)}return e._sourceNormals}applySkeleton(e){if(!this.geometry)return this;if(this.geometry._softwareSkinningFrameId==this.getScene().getFrameId())return this;if(this.geometry._softwareSkinningFrameId=this.getScene().getFrameId(),!this.isVerticesDataPresent(S.PositionKind))return this;if(!this.isVerticesDataPresent(S.MatricesIndicesKind))return this;if(!this.isVerticesDataPresent(S.MatricesWeightsKind))return this;const t=this.isVerticesDataPresent(S.NormalKind),i=this._internalMeshDataInfo;if(!i._sourcePositions){const m=this.subMeshes.slice();this.setPositionsForCPUSkinning(),this.subMeshes=m}t&&!i._sourceNormals&&this.setNormalsForCPUSkinning();let s=this.getVerticesData(S.PositionKind);if(!s)return this;s instanceof Float32Array||(s=new Float32Array(s));let r=this.getVerticesData(S.NormalKind);if(t){if(!r)return this;r instanceof Float32Array||(r=new Float32Array(r))}const a=this.getVerticesData(S.MatricesIndicesKind),o=this.getVerticesData(S.MatricesWeightsKind);if(!o||!a)return this;const l=this.numBoneInfluencers>4,h=l?this.getVerticesData(S.MatricesIndicesExtraKind):null,u=l?this.getVerticesData(S.MatricesWeightsExtraKind):null,c=e.getTransformMatrices(this),f=y.Zero(),d=new L,_=new L;let p=0,g;for(let m=0;m<s.length;m+=3,p+=4){let v;for(g=0;g<4;g++)v=o[p+g],v>0&&(L.FromFloat32ArrayToRefScaled(c,Math.floor(a[p+g]*16),v,_),d.addToSelf(_));if(l)for(g=0;g<4;g++)v=u[p+g],v>0&&(L.FromFloat32ArrayToRefScaled(c,Math.floor(h[p+g]*16),v,_),d.addToSelf(_));y.TransformCoordinatesFromFloatsToRef(i._sourcePositions[m],i._sourcePositions[m+1],i._sourcePositions[m+2],d,f),f.toArray(s,m),t&&(y.TransformNormalFromFloatsToRef(i._sourceNormals[m],i._sourceNormals[m+1],i._sourceNormals[m+2],d,f),f.toArray(r,m)),d.reset()}return this.updateVerticesData(S.PositionKind,s),t&&this.updateVerticesData(S.NormalKind,r),this}static MinMax(e){let t=null,i=null;return e.forEach(function(s){const a=s.getBoundingInfo().boundingBox;!t||!i?(t=a.minimumWorld,i=a.maximumWorld):(t.minimizeInPlace(a.minimumWorld),i.maximizeInPlace(a.maximumWorld))}),!t||!i?{min:y.Zero(),max:y.Zero()}:{min:t,max:i}}static Center(e){const t=e instanceof Array?O.MinMax(e):e;return y.Center(t.min,t.max)}static MergeMeshes(e,t=!0,i,s,r,a){return Td(O._MergeMeshesCoroutine(e,t,i,s,r,a,!1))}static MergeMeshesAsync(e,t=!0,i,s,r,a){return VA(O._MergeMeshesCoroutine(e,t,i,s,r,a,!0),kA())}static*_MergeMeshesCoroutine(e,t=!0,i,s,r,a,o){if(e=e.filter(Boolean),e.length===0)return null;let l;if(!i){let E=0;for(l=0;l<e.length;l++)if(E+=e[l].getTotalVertices(),E>=65536)return U.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),null}a&&(r=!1);const h=new Array,u=new Array,c=new Array,f=e[0].sideOrientation;for(l=0;l<e.length;l++){const E=e[l];if(E.isAnInstance)return U.Warn("Cannot merge instance meshes."),null;if(f!==E.sideOrientation)return U.Warn("Cannot merge meshes with different sideOrientation values."),null;if(r&&c.push(E.getTotalIndices()),a)if(E.material){const R=E.material;if(R instanceof wa){for(let C=0;C<R.subMaterials.length;C++)h.indexOf(R.subMaterials[C])<0&&h.push(R.subMaterials[C]);for(let C=0;C<E.subMeshes.length;C++)u.push(h.indexOf(R.subMaterials[E.subMeshes[C].materialIndex])),c.push(E.subMeshes[C].indexCount)}else{h.indexOf(R)<0&&h.push(R);for(let C=0;C<E.subMeshes.length;C++)u.push(h.indexOf(R)),c.push(E.subMeshes[C].indexCount)}}else for(let R=0;R<E.subMeshes.length;R++)u.push(0),c.push(E.subMeshes[R].indexCount)}const d=e[0],_=E=>{const R=E.computeWorldMatrix(!0);return{vertexData:Q.ExtractFromMesh(E,!1,!1),transform:R}},{vertexData:p,transform:g}=_(d);o&&(yield);const m=new Array(e.length-1);for(let E=1;E<e.length;E++)m[E-1]=_(e[E]),o&&(yield);const v=p._mergeCoroutine(g,m,i,o,!t);let T=v.next();for(;!T.done;)o&&(yield),T=v.next();const A=T.value;s||(s=new O(d.name+"_merged",d.getScene()));const b=A._applyToCoroutine(s,void 0,o);let x=b.next();for(;!x.done;)o&&(yield),x=b.next();if(s.checkCollisions=d.checkCollisions,s.sideOrientation=d.sideOrientation,t)for(l=0;l<e.length;l++)e[l].dispose();if(r||a){s.releaseSubMeshes(),l=0;let E=0;for(;l<c.length;)ss.CreateFromIndices(0,E,c[l],s,void 0,!1),E+=c[l],l++;for(const R of s.subMeshes)R.refreshBoundingInfo();s.computeWorldMatrix(!0)}if(a){const E=new wa(d.name+"_merged",d.getScene());E.subMaterials=h;for(let R=0;R<s.subMeshes.length;R++)s.subMeshes[R].materialIndex=u[R];s.material=E}else s.material=d.material;return s}addInstance(e){e._indexInSourceMeshInstanceArray=this.instances.length,this.instances.push(e)}removeInstance(e){const t=e._indexInSourceMeshInstanceArray;if(t!=-1){if(t!==this.instances.length-1){const i=this.instances[this.instances.length-1];this.instances[t]=i,i._indexInSourceMeshInstanceArray=t}e._indexInSourceMeshInstanceArray=-1,this.instances.pop()}}_shouldConvertRHS(){return this._scene.useRightHandedSystem&&this.sideOrientation===Y.CounterClockWiseSideOrientation}_getRenderingFillMode(e){const t=this.getScene();return t.forcePointsCloud?Y.PointFillMode:t.forceWireframe?Y.WireFrameFillMode:this.overrideRenderingFillMode??e}setMaterialByID(e){return this.setMaterialById(e)}static CreateRibbon(e,t,i,s,r,a,o,l,h){throw new Error("Import MeshBuilder to populate this function")}static CreateDisc(e,t,i,s,r,a){throw new Error("Import MeshBuilder to populate this function")}static CreateBox(e,t,i,s,r){throw new Error("Import MeshBuilder to populate this function")}static CreateSphere(e,t,i,s,r,a){throw new Error("Import MeshBuilder to populate this function")}static CreateHemisphere(e,t,i,s){throw new Error("Import MeshBuilder to populate this function")}static CreateCylinder(e,t,i,s,r,a,o,l,h){throw new Error("Import MeshBuilder to populate this function")}static CreateTorus(e,t,i,s,r,a,o){throw new Error("Import MeshBuilder to populate this function")}static CreateTorusKnot(e,t,i,s,r,a,o,l,h,u){throw new Error("Import MeshBuilder to populate this function")}static CreateLines(e,t,i,s,r){throw new Error("Import MeshBuilder to populate this function")}static CreateDashedLines(e,t,i,s,r,a,o,l){throw new Error("Import MeshBuilder to populate this function")}static CreatePolygon(e,t,i,s,r,a,o){throw new Error("Import MeshBuilder to populate this function")}static ExtrudePolygon(e,t,i,s,r,a,o,l){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShape(e,t,i,s,r,a,o,l,h,u){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShapeCustom(e,t,i,s,r,a,o,l,h,u,c,f){throw new Error("Import MeshBuilder to populate this function")}static CreateLathe(e,t,i,s,r,a,o){throw new Error("Import MeshBuilder to populate this function")}static CreatePlane(e,t,i,s,r){throw new Error("Import MeshBuilder to populate this function")}static CreateGround(e,t,i,s,r,a){throw new Error("Import MeshBuilder to populate this function")}static CreateTiledGround(e,t,i,s,r,a,o,l,h){throw new Error("Import MeshBuilder to populate this function")}static CreateGroundFromHeightMap(e,t,i,s,r,a,o,l,h,u,c){throw new Error("Import MeshBuilder to populate this function")}static CreateTube(e,t,i,s,r,a,o,l,h,u){throw new Error("Import MeshBuilder to populate this function")}static CreatePolyhedron(e,t,i){throw new Error("Import MeshBuilder to populate this function")}static CreateIcoSphere(e,t,i){throw new Error("Import MeshBuilder to populate this function")}static CreateDecal(e,t,i,s,r,a){throw new Error("Import MeshBuilder to populate this function")}static CreateCapsule(e,t,i){throw new Error("Import MeshBuilder to populate this function")}static ExtendToGoldberg(e){throw new Error("Import MeshBuilder to populate this function")}}O.FRONTSIDE=Q.FRONTSIDE;O.BACKSIDE=Q.BACKSIDE;O.DOUBLESIDE=Q.DOUBLESIDE;O.DEFAULTSIDE=Q.DEFAULTSIDE;O.NO_CAP=0;O.CAP_START=1;O.CAP_END=2;O.CAP_ALL=3;O.NO_FLIP=0;O.FLIP_TILE=1;O.ROTATE_TILE=2;O.FLIP_ROW=3;O.ROTATE_ROW=4;O.FLIP_N_ROTATE_TILE=5;O.FLIP_N_ROTATE_ROW=6;O.CENTER=0;O.LEFT=1;O.RIGHT=2;O.TOP=3;O.BOTTOM=4;O.INSTANCEDMESH_SORT_TRANSPARENT=!1;O._GroundMeshParser=(n,e)=>{throw Ee("GroundMesh")};O._GoldbergMeshParser=(n,e)=>{throw Ee("GoldbergMesh")};O._LinesMeshParser=(n,e)=>{throw Ee("LinesMesh")};O._GreasedLineMeshParser=(n,e)=>{throw Ee("GreasedLineMesh")};O._GreasedLineRibbonMeshParser=(n,e)=>{throw Ee("GreasedLineRibbonMesh")};O._TrailMeshParser=(n,e)=>{throw Ee("TrailMesh")};Tt("BABYLON.Mesh",O);class IE{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(e){this._zoomStopsAnimation=e}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(e){this._idleRotationSpeed=e}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(e){this._idleRotationWaitTime=e}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(e){this._idleRotationSpinupTime=e}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(e){this._attachedCamera=e;const t=this._attachedCamera.getScene();this._onPrePointerObservableObserver=t.onPrePointerObservable.add(i=>{if(i.type===we.POINTERDOWN){this._isPointerDown=!0;return}i.type===we.POINTERUP&&(this._isPointerDown=!1)}),this._onAfterCheckInputsObserver=e.onAfterCheckInputsObservable.add(()=>{if(this._reachTargetAlpha())return;const i=as.Now;let s=0;this._lastFrameTime!=null&&(s=i-this._lastFrameTime),this._lastFrameTime=i,this._applyUserInteraction();const r=i-this._lastInteractionTime-this._idleRotationWaitTime,a=Math.max(Math.min(r/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*a,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(s/1e3))})}detach(){if(!this._attachedCamera)return;const e=this._attachedCamera.getScene();this._onPrePointerObservableObserver&&e.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(e){this._lastInteractionTime=e??as.Now}_reachTargetAlpha(){return this._attachedCamera&&this.targetAlpha?Math.abs(this._attachedCamera.alpha-this.targetAlpha)<Ue:!1}_userIsZooming(){return this._attachedCamera?this._attachedCamera.inertialRadiusOffset!==0:!1}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let e=!1;return this._lastFrameRadius===this._attachedCamera.radius&&this._attachedCamera.inertialRadiusOffset!==0&&(e=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?e:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=as.Now)}_userIsMoving(){return this._attachedCamera?this._attachedCamera.inertialAlphaOffset!==0||this._attachedCamera.inertialBetaOffset!==0||this._attachedCamera.inertialRadiusOffset!==0||this._attachedCamera.inertialPanningX!==0||this._attachedCamera.inertialPanningY!==0||this._isPointerDown:!1}}class Rs{constructor(){this._easingMode=Rs.EASINGMODE_EASEIN}setEasingMode(e){const t=Math.min(Math.max(e,0),2);this._easingMode=t}getEasingMode(){return this._easingMode}easeInCore(e){throw new Error("You must implement this method")}ease(e){switch(this._easingMode){case Rs.EASINGMODE_EASEIN:return this.easeInCore(e);case Rs.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-e)}return e>=.5?(1-this.easeInCore((1-e)*2))*.5+.5:this.easeInCore(e*2)*.5}}Rs.EASINGMODE_EASEIN=0;Rs.EASINGMODE_EASEOUT=1;Rs.EASINGMODE_EASEINOUT=2;class CE extends Rs{constructor(e=1){super(),this.amplitude=e}easeInCore(e){const t=Math.max(0,this.amplitude);return Math.pow(e,3)-e*t*Math.sin(3.141592653589793*e)}}class ME extends Rs{constructor(e=2){super(),this.exponent=e}easeInCore(e){return this.exponent<=0?e:(Math.exp(this.exponent*e)-1)/(Math.exp(this.exponent)-1)}}class Sh{constructor(e,t,i){this.name=e,this.from=t,this.to=i}clone(){return new Sh(this.name,this.from,this.to)}}const PE=Object.freeze(new se(0,0,0,0)),wE=Object.freeze(y.Zero()),DE=Object.freeze(ne.Zero()),OE=Object.freeze(Vi.Zero()),FE=Object.freeze(fe.Black()),LE=Object.freeze(new K(0,0,0,0)),ps={key:0,repeatCount:0,loopMode:2};class te{static _PrepareAnimation(e,t,i,s,r,a,o,l){let h;if(!isNaN(parseFloat(r))&&isFinite(r)?h=te.ANIMATIONTYPE_FLOAT:r instanceof se?h=te.ANIMATIONTYPE_QUATERNION:r instanceof y?h=te.ANIMATIONTYPE_VECTOR3:r instanceof ne?h=te.ANIMATIONTYPE_VECTOR2:r instanceof fe?h=te.ANIMATIONTYPE_COLOR3:r instanceof K?h=te.ANIMATIONTYPE_COLOR4:r instanceof Vi&&(h=te.ANIMATIONTYPE_SIZE),h==null)return null;const u=new te(e,t,i,h,o),c=[{frame:0,value:r},{frame:s,value:a}];return u.setKeys(c),l!==void 0&&u.setEasingFunction(l),u}static CreateAnimation(e,t,i,s){const r=new te(e+"Animation",e,i,t,te.ANIMATIONLOOPMODE_CONSTANT);return r.setEasingFunction(s),r}static CreateAndStartAnimation(e,t,i,s,r,a,o,l,h,u,c){const f=te._PrepareAnimation(e,i,s,r,a,o,l,h);return!f||(t.getScene&&(c=t.getScene()),!c)?null:c.beginDirectAnimation(t,[f],0,r,f.loopMode!==te.ANIMATIONLOOPMODE_CONSTANT,1,u)}static CreateAndStartHierarchyAnimation(e,t,i,s,r,a,o,l,h,u,c){const f=te._PrepareAnimation(e,s,r,a,o,l,h,u);return f?t.getScene().beginDirectHierarchyAnimation(t,i,[f],0,a,f.loopMode===1,1,c):null}static CreateMergeAndStartAnimation(e,t,i,s,r,a,o,l,h,u){const c=te._PrepareAnimation(e,i,s,r,a,o,l,h);return c?(t.animations.push(c),t.getScene().beginAnimation(t,0,r,c.loopMode===1,1,u)):null}static MakeAnimationAdditive(e,t,i,s=!1,r){let a;typeof t=="object"?a=t:a={referenceFrame:t??0,range:i,cloneOriginalAnimation:s,clonedAnimationName:r};let o=e;if(a.cloneOriginalAnimation&&(o=e.clone(),o.name=a.clonedAnimationName||o.name),!o._keys.length)return o;const l=a.referenceFrame&&a.referenceFrame>=0?a.referenceFrame:0;let h=0;const u=o._keys[0];let c=o._keys.length-1;const f=o._keys[c],d={referenceValue:u.value,referencePosition:N.Vector3[0],referenceQuaternion:N.Quaternion[0],referenceScaling:N.Vector3[1],keyPosition:N.Vector3[2],keyQuaternion:N.Quaternion[1],keyScaling:N.Vector3[3]};let _=u.frame,p=f.frame;if(a.range){const v=o.getRange(a.range);v&&(_=v.from,p=v.to)}else _=a.fromFrame??_,p=a.toFrame??p;if(_!==u.frame&&(h=o.createKeyForFrame(_)),p!==f.frame&&(c=o.createKeyForFrame(p)),o._keys.length===1){const v=o._getKeyValue(o._keys[0]);d.referenceValue=v.clone?v.clone():v}else if(l<=u.frame){const v=o._getKeyValue(u.value);d.referenceValue=v.clone?v.clone():v}else if(l>=f.frame){const v=o._getKeyValue(f.value);d.referenceValue=v.clone?v.clone():v}else{ps.key=0;const v=o._interpolate(l,ps);d.referenceValue=v.clone?v.clone():v}o.dataType===te.ANIMATIONTYPE_QUATERNION?d.referenceValue.normalize().conjugateInPlace():o.dataType===te.ANIMATIONTYPE_MATRIX&&(d.referenceValue.decompose(d.referenceScaling,d.referenceQuaternion,d.referencePosition),d.referenceQuaternion.normalize().conjugateInPlace());let g=Number.MAX_VALUE;const m=a.clipKeys?[]:null;for(let v=h;v<=c;v++){let T=o._keys[v];if((m||a.cloneOriginalAnimation)&&(T={frame:T.frame,value:T.value.clone?T.value.clone():T.value,inTangent:T.inTangent,outTangent:T.outTangent,interpolation:T.interpolation,lockedTangent:T.lockedTangent},m&&(g===Number.MAX_VALUE&&(g=T.frame),T.frame-=g,m.push(T))),!(v&&o.dataType!==te.ANIMATIONTYPE_FLOAT&&T.value===u.value))switch(o.dataType){case te.ANIMATIONTYPE_MATRIX:T.value.decompose(d.keyScaling,d.keyQuaternion,d.keyPosition),d.keyPosition.subtractInPlace(d.referencePosition),d.keyScaling.divideInPlace(d.referenceScaling),d.referenceQuaternion.multiplyToRef(d.keyQuaternion,d.keyQuaternion),L.ComposeToRef(d.keyScaling,d.keyQuaternion,d.keyPosition,T.value);break;case te.ANIMATIONTYPE_QUATERNION:d.referenceValue.multiplyToRef(T.value,T.value);break;case te.ANIMATIONTYPE_VECTOR2:case te.ANIMATIONTYPE_VECTOR3:case te.ANIMATIONTYPE_COLOR3:case te.ANIMATIONTYPE_COLOR4:T.value.subtractToRef(d.referenceValue,T.value);break;case te.ANIMATIONTYPE_SIZE:T.value.width-=d.referenceValue.width,T.value.height-=d.referenceValue.height;break;default:T.value-=d.referenceValue}}return m&&o.setKeys(m,!0),o}static TransitionTo(e,t,i,s,r,a,o,l=null){if(o<=0)return i[e]=t,l&&l(),null;const h=r*(o/1e3);a.setKeys([{frame:0,value:i[e].clone?i[e].clone():i[e]},{frame:h,value:t}]),i.animations||(i.animations=[]),i.animations.push(a);const u=s.beginAnimation(i,0,h,!1);return u.onAnimationEnd=l,u}get runtimeAnimations(){return this._runtimeAnimations}get hasRunningRuntimeAnimations(){for(const e of this._runtimeAnimations)if(!e.isStopped())return!0;return!1}constructor(e,t,i,s,r,a){this.name=e,this.targetProperty=t,this.framePerSecond=i,this.dataType=s,this.loopMode=r,this.enableBlending=a,this._easingFunction=null,this._runtimeAnimations=new Array,this._events=new Array,this.blendingSpeed=.01,this._ranges={},this.targetPropertyPath=t.split("."),this.dataType=s,this.loopMode=r===void 0?te.ANIMATIONLOOPMODE_CYCLE:r,this.uniqueId=te._UniqueIdGenerator++}toString(e){let t="Name: "+this.name+", property: "+this.targetProperty;if(t+=", datatype: "+["Float","Vector3","Quaternion","Matrix","Color3","Vector2"][this.dataType],t+=", nKeys: "+(this._keys?this._keys.length:"none"),t+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),e){t+=", Ranges: {";let i=!0;for(const s in this._ranges)i&&(t+=", ",i=!1),t+=s;t+="}"}return t}addEvent(e){this._events.push(e),this._events.sort((t,i)=>t.frame-i.frame)}removeEvents(e){for(let t=0;t<this._events.length;t++)this._events[t].frame===e&&(this._events.splice(t,1),t--)}getEvents(){return this._events}createRange(e,t,i){this._ranges[e]||(this._ranges[e]=new Sh(e,t,i))}deleteRange(e,t=!0){const i=this._ranges[e];if(i){if(t){const s=i.from,r=i.to;for(let a=this._keys.length-1;a>=0;a--)this._keys[a].frame>=s&&this._keys[a].frame<=r&&this._keys.splice(a,1)}this._ranges[e]=null}}getRange(e){return this._ranges[e]}getKeys(){return this._keys}getHighestFrame(){let e=0;for(let t=0,i=this._keys.length;t<i;t++)e<this._keys[t].frame&&(e=this._keys[t].frame);return e}getEasingFunction(){return this._easingFunction}setEasingFunction(e){this._easingFunction=e}floatInterpolateFunction(e,t,i){return Bl(e,t,i)}floatInterpolateFunctionWithTangents(e,t,i,s,r){return _4(e,t,i,s,r)}quaternionInterpolateFunction(e,t,i){return se.Slerp(e,t,i)}quaternionInterpolateFunctionWithTangents(e,t,i,s,r){return se.Hermite(e,t,i,s,r).normalize()}vector3InterpolateFunction(e,t,i){return y.Lerp(e,t,i)}vector3InterpolateFunctionWithTangents(e,t,i,s,r){return y.Hermite(e,t,i,s,r)}vector2InterpolateFunction(e,t,i){return ne.Lerp(e,t,i)}vector2InterpolateFunctionWithTangents(e,t,i,s,r){return ne.Hermite(e,t,i,s,r)}sizeInterpolateFunction(e,t,i){return Vi.Lerp(e,t,i)}color3InterpolateFunction(e,t,i){return fe.Lerp(e,t,i)}color3InterpolateFunctionWithTangents(e,t,i,s,r){return fe.Hermite(e,t,i,s,r)}color4InterpolateFunction(e,t,i){return K.Lerp(e,t,i)}color4InterpolateFunctionWithTangents(e,t,i,s,r){return K.Hermite(e,t,i,s,r)}_getKeyValue(e){return typeof e=="function"?e():e}evaluate(e){return ps.key=0,this._interpolate(e,ps)}_interpolate(e,t,i=!1){if(t.loopMode===te.ANIMATIONLOOPMODE_CONSTANT&&t.repeatCount>0)return t.highLimitValue.clone?t.highLimitValue.clone():t.highLimitValue;const s=this._keys,r=s.length;let a=t.key;for(;a>=0&&e<s[a].frame;)--a;for(;a+1<=r-1&&e>=s[a+1].frame;)++a;if(t.key=a,a<0)return i?void 0:this._getKeyValue(s[0].value);if(a+1>r-1)return i?void 0:this._getKeyValue(s[r-1].value);const o=s[a],l=s[a+1];if(i&&(e===o.frame||e===l.frame))return;const h=this._getKeyValue(o.value),u=this._getKeyValue(l.value);if(o.interpolation===1)return l.frame>e?h:u;const c=o.outTangent!==void 0&&l.inTangent!==void 0,f=l.frame-o.frame;let d=(e-o.frame)/f;const _=o.easingFunction||this.getEasingFunction();switch(_&&(d=_.ease(d)),this.dataType){case te.ANIMATIONTYPE_FLOAT:{const p=c?this.floatInterpolateFunctionWithTangents(h,o.outTangent*f,u,l.inTangent*f,d):this.floatInterpolateFunction(h,u,d);switch(t.loopMode){case te.ANIMATIONLOOPMODE_CYCLE:case te.ANIMATIONLOOPMODE_CONSTANT:case te.ANIMATIONLOOPMODE_YOYO:return p;case te.ANIMATIONLOOPMODE_RELATIVE:case te.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return(t.offsetValue??0)*t.repeatCount+p}break}case te.ANIMATIONTYPE_QUATERNION:{const p=c?this.quaternionInterpolateFunctionWithTangents(h,o.outTangent.scale(f),u,l.inTangent.scale(f),d):this.quaternionInterpolateFunction(h,u,d);switch(t.loopMode){case te.ANIMATIONLOOPMODE_CYCLE:case te.ANIMATIONLOOPMODE_CONSTANT:case te.ANIMATIONLOOPMODE_YOYO:return p;case te.ANIMATIONLOOPMODE_RELATIVE:case te.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return p.addInPlace((t.offsetValue||PE).scale(t.repeatCount))}return p}case te.ANIMATIONTYPE_VECTOR3:{const p=c?this.vector3InterpolateFunctionWithTangents(h,o.outTangent.scale(f),u,l.inTangent.scale(f),d):this.vector3InterpolateFunction(h,u,d);switch(t.loopMode){case te.ANIMATIONLOOPMODE_CYCLE:case te.ANIMATIONLOOPMODE_CONSTANT:case te.ANIMATIONLOOPMODE_YOYO:return p;case te.ANIMATIONLOOPMODE_RELATIVE:case te.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return p.add((t.offsetValue||wE).scale(t.repeatCount))}break}case te.ANIMATIONTYPE_VECTOR2:{const p=c?this.vector2InterpolateFunctionWithTangents(h,o.outTangent.scale(f),u,l.inTangent.scale(f),d):this.vector2InterpolateFunction(h,u,d);switch(t.loopMode){case te.ANIMATIONLOOPMODE_CYCLE:case te.ANIMATIONLOOPMODE_CONSTANT:case te.ANIMATIONLOOPMODE_YOYO:return p;case te.ANIMATIONLOOPMODE_RELATIVE:case te.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return p.add((t.offsetValue||DE).scale(t.repeatCount))}break}case te.ANIMATIONTYPE_SIZE:{switch(t.loopMode){case te.ANIMATIONLOOPMODE_CYCLE:case te.ANIMATIONLOOPMODE_CONSTANT:case te.ANIMATIONLOOPMODE_YOYO:return this.sizeInterpolateFunction(h,u,d);case te.ANIMATIONLOOPMODE_RELATIVE:case te.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return this.sizeInterpolateFunction(h,u,d).add((t.offsetValue||OE).scale(t.repeatCount))}break}case te.ANIMATIONTYPE_COLOR3:{const p=c?this.color3InterpolateFunctionWithTangents(h,o.outTangent.scale(f),u,l.inTangent.scale(f),d):this.color3InterpolateFunction(h,u,d);switch(t.loopMode){case te.ANIMATIONLOOPMODE_CYCLE:case te.ANIMATIONLOOPMODE_CONSTANT:case te.ANIMATIONLOOPMODE_YOYO:return p;case te.ANIMATIONLOOPMODE_RELATIVE:case te.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return p.add((t.offsetValue||FE).scale(t.repeatCount))}break}case te.ANIMATIONTYPE_COLOR4:{const p=c?this.color4InterpolateFunctionWithTangents(h,o.outTangent.scale(f),u,l.inTangent.scale(f),d):this.color4InterpolateFunction(h,u,d);switch(t.loopMode){case te.ANIMATIONLOOPMODE_CYCLE:case te.ANIMATIONLOOPMODE_CONSTANT:case te.ANIMATIONLOOPMODE_YOYO:return p;case te.ANIMATIONLOOPMODE_RELATIVE:case te.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return p.add((t.offsetValue||LE).scale(t.repeatCount))}break}case te.ANIMATIONTYPE_MATRIX:{switch(t.loopMode){case te.ANIMATIONLOOPMODE_CYCLE:case te.ANIMATIONLOOPMODE_CONSTANT:case te.ANIMATIONLOOPMODE_YOYO:return te.AllowMatricesInterpolation?this.matrixInterpolateFunction(h,u,d,t.workValue):h;case te.ANIMATIONLOOPMODE_RELATIVE:case te.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return h}break}}return 0}matrixInterpolateFunction(e,t,i,s){return te.AllowMatrixDecomposeForInterpolation?s?(L.DecomposeLerpToRef(e,t,i,s),s):L.DecomposeLerp(e,t,i):s?(L.LerpToRef(e,t,i,s),s):L.Lerp(e,t,i)}clone(){const e=new te(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(e.enableBlending=this.enableBlending,e.blendingSpeed=this.blendingSpeed,this._keys&&e.setKeys(this._keys),this._ranges){e._ranges={};for(const t in this._ranges){const i=this._ranges[t];i&&(e._ranges[t]=i.clone())}}return e}setKeys(e,t=!1){this._keys=t?e:e.slice(0)}createKeyForFrame(e){ps.key=0;const t=this._interpolate(e,ps,!0);if(!t)return this._keys[ps.key].frame===e?ps.key:ps.key+1;const i={frame:e,value:t.clone?t.clone():t};return this._keys.splice(ps.key+1,0,i),ps.key+1}serialize(){const e={};e.name=this.name,e.property=this.targetProperty,e.framePerSecond=this.framePerSecond,e.dataType=this.dataType,e.loopBehavior=this.loopMode,e.enableBlending=this.enableBlending,e.blendingSpeed=this.blendingSpeed;const t=this.dataType;e.keys=[];const i=this.getKeys();for(let s=0;s<i.length;s++){const r=i[s],a={};switch(a.frame=r.frame,t){case te.ANIMATIONTYPE_FLOAT:a.values=[r.value],r.inTangent!==void 0&&a.values.push(r.inTangent),r.outTangent!==void 0&&(r.inTangent===void 0&&a.values.push(void 0),a.values.push(r.outTangent)),r.interpolation!==void 0&&(r.inTangent===void 0&&a.values.push(void 0),r.outTangent===void 0&&a.values.push(void 0),a.values.push(r.interpolation));break;case te.ANIMATIONTYPE_QUATERNION:case te.ANIMATIONTYPE_MATRIX:case te.ANIMATIONTYPE_VECTOR3:case te.ANIMATIONTYPE_COLOR3:case te.ANIMATIONTYPE_COLOR4:a.values=r.value.asArray(),r.inTangent!=null&&a.values.push(r.inTangent.asArray()),r.outTangent!=null&&(r.inTangent===void 0&&a.values.push(void 0),a.values.push(r.outTangent.asArray())),r.interpolation!==void 0&&(r.inTangent===void 0&&a.values.push(void 0),r.outTangent===void 0&&a.values.push(void 0),a.values.push(r.interpolation));break}e.keys.push(a)}e.ranges=[];for(const s in this._ranges){const r=this._ranges[s];if(!r)continue;const a={};a.name=s,a.from=r.from,a.to=r.to,e.ranges.push(a)}return e}static _UniversalLerp(e,t,i){const s=e.constructor;return s.Lerp?s.Lerp(e,t,i):s.Slerp?s.Slerp(e,t,i):e.toFixed?e*(1-i)+i*t:t}static Parse(e){const t=new te(e.name,e.property,e.framePerSecond,e.dataType,e.loopBehavior),i=e.dataType,s=[];let r,a;for(e.enableBlending&&(t.enableBlending=e.enableBlending),e.blendingSpeed&&(t.blendingSpeed=e.blendingSpeed),a=0;a<e.keys.length;a++){const o=e.keys[a];let l,h,u;switch(i){case te.ANIMATIONTYPE_FLOAT:r=o.values[0],o.values.length>=2&&(l=o.values[1]),o.values.length>=3&&(h=o.values[2]),o.values.length>=4&&(u=o.values[3]);break;case te.ANIMATIONTYPE_QUATERNION:if(r=se.FromArray(o.values),o.values.length>=8){const f=se.FromArray(o.values.slice(4,8));f.equals(se.Zero())||(l=f)}if(o.values.length>=12){const f=se.FromArray(o.values.slice(8,12));f.equals(se.Zero())||(h=f)}o.values.length>=13&&(u=o.values[12]);break;case te.ANIMATIONTYPE_MATRIX:r=L.FromArray(o.values),o.values.length>=17&&(u=o.values[16]);break;case te.ANIMATIONTYPE_COLOR3:r=fe.FromArray(o.values),o.values[3]&&(l=fe.FromArray(o.values[3])),o.values[4]&&(h=fe.FromArray(o.values[4])),o.values[5]&&(u=o.values[5]);break;case te.ANIMATIONTYPE_COLOR4:r=K.FromArray(o.values),o.values[4]&&(l=K.FromArray(o.values[4])),o.values[5]&&(h=K.FromArray(o.values[5])),o.values[6]&&(u=K.FromArray(o.values[6]));break;case te.ANIMATIONTYPE_VECTOR3:default:r=y.FromArray(o.values),o.values[3]&&(l=y.FromArray(o.values[3])),o.values[4]&&(h=y.FromArray(o.values[4])),o.values[5]&&(u=o.values[5]);break}const c={};c.frame=o.frame,c.value=r,l!=null&&(c.inTangent=l),h!=null&&(c.outTangent=h),u!=null&&(c.interpolation=u),s.push(c)}if(t.setKeys(s),e.ranges)for(a=0;a<e.ranges.length;a++)r=e.ranges[a],t.createRange(r.name,r.from,r.to);return t}static AppendSerializedAnimations(e,t){Ie.AppendSerializedAnimations(e,t)}static ParseFromFileAsync(e,t){return new Promise((i,s)=>{const r=new Wt;r.addEventListener("readystatechange",()=>{if(r.readyState==4)if(r.status==200){let a=JSON.parse(r.responseText);if(a.animations&&(a=a.animations),a.length){const o=[];for(const l of a)o.push(this.Parse(l));i(o)}else{const o=this.Parse(a);e&&(o.name=e),i(o)}}else s("Unable to load the animation")}),r.open("GET",t),r.send()})}static ParseFromSnippetAsync(e){return new Promise((t,i)=>{const s=new Wt;s.addEventListener("readystatechange",()=>{if(s.readyState==4)if(s.status==200){const r=JSON.parse(JSON.parse(s.responseText).jsonPayload);if(r.animations){const a=JSON.parse(r.animations),o=[];for(const l of a.animations){const h=this.Parse(l);h.snippetId=e,o.push(h)}t(o)}else{const a=JSON.parse(r.animation),o=this.Parse(a);o.snippetId=e,t(o)}}else i("Unable to load the snippet "+e)}),s.open("GET",this.SnippetUrl+"/"+e.replace(/#/g,"/")),s.send()})}}te._UniqueIdGenerator=0;te.AllowMatricesInterpolation=!1;te.AllowMatrixDecomposeForInterpolation=!0;te.SnippetUrl="https://snippet.babylonjs.com";te.ANIMATIONTYPE_FLOAT=0;te.ANIMATIONTYPE_VECTOR3=1;te.ANIMATIONTYPE_QUATERNION=2;te.ANIMATIONTYPE_MATRIX=3;te.ANIMATIONTYPE_COLOR3=4;te.ANIMATIONTYPE_COLOR4=7;te.ANIMATIONTYPE_VECTOR2=5;te.ANIMATIONTYPE_SIZE=6;te.ANIMATIONLOOPMODE_RELATIVE=0;te.ANIMATIONLOOPMODE_CYCLE=1;te.ANIMATIONLOOPMODE_CONSTANT=2;te.ANIMATIONLOOPMODE_YOYO=4;te.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT=5;te.CreateFromSnippetAsync=te.ParseFromSnippetAsync;Tt("BABYLON.Animation",te);Rt._AnimationRangeFactory=(n,e,t)=>new Sh(n,e,t);class Er{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(e){if(this._autoTransitionRange===e)return;this._autoTransitionRange=e;const t=this._attachedCamera;t&&(e?this._onMeshTargetChangedObserver=t.onMeshTargetChangedObservable.add(i=>{if(i&&(i.computeWorldMatrix(!0),i.getBoundingInfo)){const s=i.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=s*.05,this.upperRadiusTransitionRange=s*.05}}):this._onMeshTargetChangedObserver&&t.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(e){this._attachedCamera=e,this._onAfterCheckInputsObserver=e.onAfterCheckInputsObservable.add(()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))})}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(e){return this._attachedCamera?this._attachedCamera.radius===e&&!this._radiusIsAnimating:!1}_applyBoundRadiusAnimation(e){if(!this._attachedCamera)return;this._radiusBounceTransition||(Er.EasingFunction.setEasingMode(Er.EasingMode),this._radiusBounceTransition=te.CreateAnimation("radius",te.ANIMATIONTYPE_FLOAT,60,Er.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const t=te.TransitionTo("radius",this._attachedCamera.radius+e,this._attachedCamera,this._attachedCamera.getScene(),60,this._radiusBounceTransition,this.transitionDuration,()=>this._clearAnimationLocks());t&&this._animatables.push(t)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}Er.EasingFunction=new CE(.3);Er.EasingMode=Rs.EASINGMODE_EASEOUT;class xi{constructor(){this.onTargetFramingAnimationEndObservable=new q,this._mode=xi.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(e){this._mode=e}get mode(){return this._mode}set radiusScale(e){this._radiusScale=e}get radiusScale(){return this._radiusScale}set positionScale(e){this._positionScale=e}get positionScale(){return this._positionScale}set defaultElevation(e){this._defaultElevation=e}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(e){this._elevationReturnTime=e}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(e){this._elevationReturnWaitTime=e}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(e){this._zoomStopsAnimation=e}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(e){this._framingTime=e}get framingTime(){return this._framingTime}init(){}attach(e){this._attachedCamera=e;const t=this._attachedCamera.getScene();xi.EasingFunction.setEasingMode(xi.EasingMode),this._onPrePointerObservableObserver=t.onPrePointerObservable.add(i=>{if(i.type===we.POINTERDOWN){this._isPointerDown=!0;return}i.type===we.POINTERUP&&(this._isPointerDown=!1)}),this._onMeshTargetChangedObserver=e.onMeshTargetChangedObservable.add(i=>{i&&i.getBoundingInfo&&this.zoomOnMesh(i,void 0,()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()})}),this._onAfterCheckInputsObserver=e.onAfterCheckInputsObservable.add(()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()})}detach(){if(!this._attachedCamera)return;const e=this._attachedCamera.getScene();this._onPrePointerObservableObserver&&e.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(e,t=!1,i=null){e.computeWorldMatrix(!0);const s=e.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(s.minimumWorld,s.maximumWorld,t,i)}zoomOnMeshHierarchy(e,t=!1,i=null){e.computeWorldMatrix(!0);const s=e.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(s.min,s.max,t,i)}zoomOnMeshesHierarchy(e,t=!1,i=null){const s=new y(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),r=new y(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let a=0;a<e.length;a++){const o=e[a].getHierarchyBoundingVectors(!0);y.CheckExtends(o.min,s,r),y.CheckExtends(o.max,s,r)}this.zoomOnBoundingInfo(s,r,t,i)}zoomOnBoundingInfo(e,t,i=!1,s=null){let r;if(!this._attachedCamera)return!1;const a=e.y,o=t.y,l=a+(o-a)*this._positionScale,h=t.subtract(e).scale(.5);if(!isFinite(l))return!1;if(i)r=new y(0,l,0);else{const f=e.add(h);r=new y(f.x,l,f.z)}this._vectorTransition||(this._vectorTransition=te.CreateAnimation("target",te.ANIMATIONTYPE_VECTOR3,60,xi.EasingFunction)),this._betaIsAnimating=!0;let u=te.TransitionTo("target",r,this._attachedCamera,this._attachedCamera.getScene(),60,this._vectorTransition,this._framingTime);u&&this._animatables.push(u);let c=0;if(this._mode===xi.FitFrustumSidesMode){const f=this._calculateLowerRadiusFromModelBoundingSphere(e,t);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=h.length()+this._attachedCamera.minZ),c=f}else this._mode===xi.IgnoreBoundsSizeMode&&(c=this._calculateLowerRadiusFromModelBoundingSphere(e,t),this.autoCorrectCameraLimitsAndSensibility&&this._attachedCamera.lowerRadiusLimit===null&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.minZ));if(this.autoCorrectCameraLimitsAndSensibility){const f=t.subtract(e).length();this._attachedCamera.panningSensibility=5e3/f,this._attachedCamera.wheelPrecision=100/c}return this._radiusTransition||(this._radiusTransition=te.CreateAnimation("radius",te.ANIMATIONTYPE_FLOAT,60,xi.EasingFunction)),u=te.TransitionTo("radius",c,this._attachedCamera,this._attachedCamera.getScene(),60,this._radiusTransition,this._framingTime,()=>{this.stopAllAnimations(),s&&s(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()}),u&&this._animatables.push(u),!0}_calculateLowerRadiusFromModelBoundingSphere(e,t){const i=this._attachedCamera;if(!i)return 0;let s=i._calculateLowerRadiusFromModelBoundingSphere(e,t,this._radiusScale);return i.lowerRadiusLimit&&this._mode===xi.IgnoreBoundsSizeMode&&(s=s<i.lowerRadiusLimit?i.lowerRadiusLimit:s),i.upperRadiusLimit&&(s=s>i.upperRadiusLimit?i.upperRadiusLimit:s),s}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const e=as.Now-this._lastInteractionTime,t=Math.PI*.5-this._defaultElevation,i=Math.PI*.5;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>i&&e>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=te.CreateAnimation("beta",te.ANIMATIONTYPE_FLOAT,60,xi.EasingFunction));const s=te.TransitionTo("beta",t,this._attachedCamera,this._attachedCamera.getScene(),60,this._betaTransition,this._elevationReturnTime,()=>{this._clearAnimationLocks(),this.stopAllAnimations()});s&&this._animatables.push(s)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=as.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return this._attachedCamera?this._attachedCamera.inertialAlphaOffset!==0||this._attachedCamera.inertialBetaOffset!==0||this._attachedCamera.inertialRadiusOffset!==0||this._attachedCamera.inertialPanningX!==0||this._attachedCamera.inertialPanningY!==0||this._isPointerDown:!1}}xi.EasingFunction=new ME;xi.EasingMode=Rs.EASINGMODE_EASEINOUT;xi.IgnoreBoundsSizeMode=0;xi.FitFrustumSidesMode=1;Rt.AddNodeConstructor("TargetCamera",(n,e)=>()=>new Dt(n,y.Zero(),e));class Dt extends be{constructor(e,t,i,s=!0){super(e,t,i,s),this._tmpUpVector=y.Zero(),this._tmpTargetVector=y.Zero(),this.cameraDirection=new y(0,0,0),this.cameraRotation=new ne(0,0),this.ignoreParentScaling=!1,this.updateUpVectorFromRotation=!1,this._tmpQuaternion=new se,this.rotation=new y(0,0,0),this.speed=2,this.noRotationConstraint=!1,this.invertRotation=!1,this.inverseRotationSpeed=.2,this.lockedTarget=null,this._currentTarget=y.Zero(),this._initialFocalDistance=1,this._viewMatrix=L.Zero(),this._camMatrix=L.Zero(),this._cameraTransformMatrix=L.Zero(),this._cameraRotationMatrix=L.Zero(),this._referencePoint=new y(0,0,1),this._transformedReferencePoint=y.Zero(),this._deferredPositionUpdate=new y,this._deferredRotationQuaternionUpdate=new se,this._deferredRotationUpdate=new y,this._deferredUpdated=!1,this._deferOnly=!1,this._defaultUp=y.Up(),this._cachedRotationZ=0,this._cachedQuaternionRotationZ=0}getFrontPosition(e){this.getWorldMatrix();const t=N.Vector3[0],i=N.Vector3[1];return i.set(0,0,this._scene.useRightHandedSystem?-1:1),this.getDirectionToRef(i,t),t.scaleInPlace(e),this.globalPosition.add(t)}_getLockedTargetPosition(){if(!this.lockedTarget)return null;if(this.lockedTarget.absolutePosition){const e=this.lockedTarget;e.computeWorldMatrix().getTranslationToRef(e.absolutePosition)}return this.lockedTarget.absolutePosition||this.lockedTarget}storeState(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),super.storeState()}_restoreStateValues(){return super._restoreStateValues()?(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.copyFromFloats(0,0,0),this.cameraRotation.copyFromFloats(0,0),!0):!1}_initCache(){super._initCache(),this._cache.lockedTarget=new y(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new y(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new se(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)}_updateCache(e){e||super._updateCache();const t=this._getLockedTargetPosition();t?this._cache.lockedTarget?this._cache.lockedTarget.copyFrom(t):this._cache.lockedTarget=t.clone():this._cache.lockedTarget=null,this._cache.rotation.copyFrom(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.copyFrom(this.rotationQuaternion)}_isSynchronizedViewMatrix(){if(!super._isSynchronizedViewMatrix())return!1;const e=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(e):!e)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))}_computeLocalCameraSpeed(){const e=this.getEngine();return this.speed*Math.sqrt(e.getDeltaTime()/(e.getFps()*100))}setTarget(e){this.upVector.normalize(),this._initialFocalDistance=e.subtract(this.position).length(),this.position.z===e.z&&(this.position.z+=Ue),this._referencePoint.normalize().scaleInPlace(this._initialFocalDistance),L.LookAtLHToRef(this.position,e,this._defaultUp,this._camMatrix),this._camMatrix.invert(),this.rotation.x=Math.atan(this._camMatrix.m[6]/this._camMatrix.m[10]);const t=e.subtract(this.position);t.x>=0?this.rotation.y=-Math.atan(t.z/t.x)+Math.PI/2:this.rotation.y=-Math.atan(t.z/t.x)-Math.PI/2,this.rotation.z=0,isNaN(this.rotation.x)&&(this.rotation.x=0),isNaN(this.rotation.y)&&(this.rotation.y=0),isNaN(this.rotation.z)&&(this.rotation.z=0),this.rotationQuaternion&&se.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)}get target(){return this.getTarget()}set target(e){this.setTarget(e)}getTarget(){return this._currentTarget}_decideIfNeedsToMove(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){if(this.parent){this.parent.getWorldMatrix().invertToRef(N.Matrix[0]),y.TransformNormalToRef(this.cameraDirection,N.Matrix[0],N.Vector3[0]),this._deferredPositionUpdate.addInPlace(N.Vector3[0]),this._deferOnly?this._deferredUpdated=!0:this.position.copyFrom(this._deferredPositionUpdate);return}this._deferredPositionUpdate.addInPlace(this.cameraDirection),this._deferOnly?this._deferredUpdated=!0:this.position.copyFrom(this._deferredPositionUpdate)}_checkInputs(){const e=this.invertRotation?-this.inverseRotationSpeed:1,t=this._decideIfNeedsToMove(),i=this.cameraRotation.x||this.cameraRotation.y;this._deferredUpdated=!1,this._deferredRotationUpdate.copyFrom(this.rotation),this._deferredPositionUpdate.copyFrom(this.position),this.rotationQuaternion&&this._deferredRotationQuaternionUpdate.copyFrom(this.rotationQuaternion),t&&this._updatePosition(),i&&(this.rotationQuaternion&&this.rotationQuaternion.toEulerAnglesToRef(this._deferredRotationUpdate),this._deferredRotationUpdate.x+=this.cameraRotation.x*e,this._deferredRotationUpdate.y+=this.cameraRotation.y*e,this.noRotationConstraint||(this._deferredRotationUpdate.x>1.570796&&(this._deferredRotationUpdate.x=1.570796),this._deferredRotationUpdate.x<-1.570796&&(this._deferredRotationUpdate.x=-1.570796)),this._deferOnly?this._deferredUpdated=!0:this.rotation.copyFrom(this._deferredRotationUpdate),this.rotationQuaternion&&this._deferredRotationUpdate.lengthSquared()&&(se.RotationYawPitchRollToRef(this._deferredRotationUpdate.y,this._deferredRotationUpdate.x,this._deferredRotationUpdate.z,this._deferredRotationQuaternionUpdate),this._deferOnly?this._deferredUpdated=!0:this.rotationQuaternion.copyFrom(this._deferredRotationQuaternionUpdate))),t&&(Math.abs(this.cameraDirection.x)<this.speed*Ue&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*Ue&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*Ue&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),i&&(Math.abs(this.cameraRotation.x)<this.speed*Ue&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*Ue&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),super._checkInputs()}_updateCameraRotationMatrix(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):L.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)}_rotateUpVectorWithCameraRotationMatrix(){return y.TransformNormalToRef(this._defaultUp,this._cameraRotationMatrix,this.upVector),this}_getViewMatrix(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!==this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),y.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?ni.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(se.FromEulerVectorToRef(this.rotation,this._tmpQuaternion),ni.Y.rotateByQuaternionToRef(this._tmpQuaternion,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix}_computeViewMatrix(e,t,i){if(this.ignoreParentScaling){if(this.parent){const s=this.parent.getWorldMatrix();y.TransformCoordinatesToRef(e,s,this._globalPosition),y.TransformCoordinatesToRef(t,s,this._tmpTargetVector),y.TransformNormalToRef(i,s,this._tmpUpVector),this._markSyncedWithParent()}else this._globalPosition.copyFrom(e),this._tmpTargetVector.copyFrom(t),this._tmpUpVector.copyFrom(i);this.getScene().useRightHandedSystem?L.LookAtRHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix):L.LookAtLHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix);return}if(this.getScene().useRightHandedSystem?L.LookAtRHToRef(e,t,i,this._viewMatrix):L.LookAtLHToRef(e,t,i,this._viewMatrix),this.parent){const s=this.parent.getWorldMatrix();this._viewMatrix.invert(),this._viewMatrix.multiplyToRef(s,this._viewMatrix),this._viewMatrix.getTranslationToRef(this._globalPosition),this._viewMatrix.invert(),this._markSyncedWithParent()}else this._globalPosition.copyFrom(e)}createRigCamera(e,t){if(this.cameraRigMode!==be.RIG_MODE_NONE){const i=new Dt(e,this.position.clone(),this.getScene());return i.isRigCamera=!0,i.rigParent=this,this.cameraRigMode===be.RIG_MODE_VR&&(this.rotationQuaternion||(this.rotationQuaternion=new se),i._cameraRigParams={},i.rotationQuaternion=new se),i.mode=this.mode,i.orthoLeft=this.orthoLeft,i.orthoRight=this.orthoRight,i.orthoTop=this.orthoTop,i.orthoBottom=this.orthoBottom,i}return null}_updateRigCameras(){const e=this._rigCameras[0],t=this._rigCameras[1];switch(this.computeWorldMatrix(),this.cameraRigMode){case be.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case be.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case be.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case be.RIG_MODE_STEREOSCOPIC_OVERUNDER:case be.RIG_MODE_STEREOSCOPIC_INTERLACED:{const i=this.cameraRigMode===be.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,s=this.cameraRigMode===be.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*i,e),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*s,t);break}case be.RIG_MODE_VR:e.rotationQuaternion?(e.rotationQuaternion.copyFrom(this.rotationQuaternion),t.rotationQuaternion.copyFrom(this.rotationQuaternion)):(e.rotation.copyFrom(this.rotation),t.rotation.copyFrom(this.rotation)),e.position.copyFrom(this.position),t.position.copyFrom(this.position);break}super._updateRigCameras()}_getRigCamPositionAndTarget(e,t){this.getTarget().subtractToRef(this.position,Dt._TargetFocalPoint),Dt._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);const s=Dt._TargetFocalPoint.addInPlace(this.position);L.TranslationToRef(-s.x,-s.y,-s.z,Dt._TargetTransformMatrix),Dt._TargetTransformMatrix.multiplyToRef(L.RotationAxis(t.upVector,e),Dt._RigCamTransformMatrix),L.TranslationToRef(s.x,s.y,s.z,Dt._TargetTransformMatrix),Dt._RigCamTransformMatrix.multiplyToRef(Dt._TargetTransformMatrix,Dt._RigCamTransformMatrix),y.TransformCoordinatesToRef(this.position,Dt._RigCamTransformMatrix,t.position),t.setTarget(s)}getClassName(){return"TargetCamera"}}Dt._RigCamTransformMatrix=new L;Dt._TargetTransformMatrix=new L;Dt._TargetFocalPoint=new y;P([B()],Dt.prototype,"ignoreParentScaling",void 0);P([B()],Dt.prototype,"updateUpVectorFromRotation",void 0);P([cs()],Dt.prototype,"rotation",void 0);P([B()],Dt.prototype,"speed",void 0);P([vv("lockedTargetId")],Dt.prototype,"lockedTarget",void 0);var jo={};class BE{constructor(e){this.attachedToElement=!1,this.attached={},this.camera=e,this.checkInputs=()=>{}}add(e){const t=e.getSimpleName();if(this.attached[t]){U.Warn("camera input of type "+t+" already exists on camera");return}this.attached[t]=e,e.camera=this.camera,e.checkInputs&&(this.checkInputs=this._addCheckInputs(e.checkInputs.bind(e))),this.attachedToElement&&e.attachControl(this.noPreventDefault)}remove(e){for(const t in this.attached){const i=this.attached[t];if(i===e){i.detachControl(),i.camera=null,delete this.attached[t],this.rebuildInputCheck();return}}}removeByType(e){for(const t in this.attached){const i=this.attached[t];i.getClassName()===e&&(i.detachControl(),i.camera=null,delete this.attached[t],this.rebuildInputCheck())}}_addCheckInputs(e){const t=this.checkInputs;return()=>{t(),e()}}attachInput(e){this.attachedToElement&&e.attachControl(this.noPreventDefault)}attachElement(e=!1){if(!this.attachedToElement){e=be.ForceAttachControlToAlwaysPreventDefault?!1:e,this.attachedToElement=!0,this.noPreventDefault=e;for(const t in this.attached)this.attached[t].attachControl(e)}}detachElement(e=!1){for(const t in this.attached)this.attached[t].detachControl(),e&&(this.attached[t].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const e in this.attached){const t=this.attached[e];t.checkInputs&&(this.checkInputs=this._addCheckInputs(t.checkInputs.bind(t)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(e){const t={};for(const i in this.attached){const s=this.attached[i],r=Ie.Serialize(s);t[s.getClassName()]=r}e.inputsmgr=t}parse(e){const t=e.inputsmgr;if(t){this.clear();for(const i in t){const s=jo[i];if(s){const r=t[i],a=Ie.Parse(()=>new s,r,null);this.add(a)}}}else for(const i in this.attached){const s=jo[this.attached[i].getClassName()];if(s){const r=Ie.Parse(()=>new s,e,null);this.remove(this.attached[i]),this.add(r)}}}}class ty{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(e){e=Z.BackCompatCameraNoPreventDefault(arguments);const t=this.camera.getEngine(),i=t.getInputElement();let s=0,r=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=o=>{var c,f;const l=o.event,h=l.pointerType==="touch";if(o.type!==we.POINTERMOVE&&this.buttons.indexOf(l.button)===-1)return;const u=l.target;if(this._altKey=l.altKey,this._ctrlKey=l.ctrlKey,this._metaKey=l.metaKey,this._shiftKey=l.shiftKey,this._buttonsPressed=l.buttons,t.isPointerLock){const d=l.movementX,_=l.movementY;this.onTouch(null,d,_),this._pointA=null,this._pointB=null}else{if(o.type!==we.POINTERDOWN&&o.type!==we.POINTERDOUBLETAP&&h&&((c=this._pointA)==null?void 0:c.pointerId)!==l.pointerId&&((f=this._pointB)==null?void 0:f.pointerId)!==l.pointerId)return;if(o.type===we.POINTERDOWN&&(this._currentMousePointerIdDown===-1||h)){try{u==null||u.setPointerCapture(l.pointerId)}catch{}if(this._pointA===null)this._pointA={x:l.clientX,y:l.clientY,pointerId:l.pointerId,type:l.pointerType};else if(this._pointB===null)this._pointB={x:l.clientX,y:l.clientY,pointerId:l.pointerId,type:l.pointerType};else return;this._currentMousePointerIdDown===-1&&!h&&(this._currentMousePointerIdDown=l.pointerId),this.onButtonDown(l),e||(l.preventDefault(),i&&i.focus())}else if(o.type===we.POINTERDOUBLETAP)this.onDoubleTap(l.pointerType);else if(o.type===we.POINTERUP&&(this._currentMousePointerIdDown===l.pointerId||h)){try{u==null||u.releasePointerCapture(l.pointerId)}catch{}h||(this._pointB=null),t._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==l.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==l.pointerId?this._pointB=null:this._pointA=this._pointB=null,(s!==0||r)&&(this.onMultiTouch(this._pointA,this._pointB,s,0,r,null),s=0,r=null),this._currentMousePointerIdDown=-1,this.onButtonUp(l),e||l.preventDefault()}else if(o.type===we.POINTERMOVE){if(e||l.preventDefault(),this._pointA&&this._pointB===null){const d=l.clientX-this._pointA.x,_=l.clientY-this._pointA.y;this._pointA.x=l.clientX,this._pointA.y=l.clientY,this.onTouch(this._pointA,d,_)}else if(this._pointA&&this._pointB){const d=this._pointA.pointerId===l.pointerId?this._pointA:this._pointB;d.x=l.clientX,d.y=l.clientY;const _=this._pointA.x-this._pointB.x,p=this._pointA.y-this._pointB.y,g=_*_+p*p,m={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:l.pointerId,type:o.type};this.onMultiTouch(this._pointA,this._pointB,s,g,r,m),r=m,s=g}}}},this._observer=this.camera.getScene()._inputManager._addCameraPointerObserver(this._pointerInput,we.POINTERDOWN|we.POINTERUP|we.POINTERMOVE|we.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,s=0,r=null,this.onLostFocus()},this._contextMenuBind=o=>this.onContextMenu(o),i&&i.addEventListener("contextmenu",this._contextMenuBind,!1);const a=this.camera.getScene().getEngine().getHostWindow();a&&Z.RegisterTopRootEvents(a,[{name:"blur",handler:this._onLostFocus}])}detachControl(){if(this._onLostFocus){const e=this.camera.getScene().getEngine().getHostWindow();e&&Z.UnregisterTopRootEvents(e,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.getScene()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const e=this.camera.getScene().getEngine().getInputElement();e&&e.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(e){}onTouch(e,t,i){}onMultiTouch(e,t,i,s,r,a){}onContextMenu(e){e.preventDefault()}onButtonDown(e){}onButtonUp(e){}onLostFocus(){}}P([B()],ty.prototype,"buttons",void 0);class Ri extends ty{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(e,t){if(this.panningSensibility!==0&&e&&t){const i=t.x-e.x,s=t.y-e.y;this.camera.inertialPanningX+=-i/this.panningSensibility,this.camera.inertialPanningY+=s/this.panningSensibility}}_computePinchZoom(e,t){const i=this.camera.radius||Ri.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=i*Math.sqrt(e)/Math.sqrt(t):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=(t-e)*.001*i*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(t-e)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(e,t,i){this.panningSensibility!==0&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-t/this.panningSensibility,this.camera.inertialPanningY+=i/this.panningSensibility):(this.camera.inertialAlphaOffset-=t/this.angularSensibilityX,this.camera.inertialBetaOffset-=i/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(e,t,i,s,r,a){i===0&&r===null||s===0&&a===null||(this.multiTouchPanAndZoom?(this._computePinchZoom(i,s),this._computeMultiTouchPanning(r,a)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(s)-Math.sqrt(i))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(i,s),this._isPinching=!0):this._computeMultiTouchPanning(r,a)):this.multiTouchPanning?this._computeMultiTouchPanning(r,a):this.pinchZoom&&this._computePinchZoom(i,s))}onButtonDown(e){this._isPanClick=e.button===this.camera._panningMouseButton}onButtonUp(e){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}Ri.MinimumRadiusForPinch=.001;P([B()],Ri.prototype,"buttons",void 0);P([B()],Ri.prototype,"angularSensibilityX",void 0);P([B()],Ri.prototype,"angularSensibilityY",void 0);P([B()],Ri.prototype,"pinchPrecision",void 0);P([B()],Ri.prototype,"pinchDeltaPercentage",void 0);P([B()],Ri.prototype,"useNaturalPinchZoom",void 0);P([B()],Ri.prototype,"pinchZoom",void 0);P([B()],Ri.prototype,"panningSensibility",void 0);P([B()],Ri.prototype,"multiTouchPanning",void 0);P([B()],Ri.prototype,"multiTouchPanAndZoom",void 0);jo.ArcRotateCameraPointersInput=Ri;class Ps{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(e){e=Z.BackCompatCameraNoPreventDefault(arguments),!this._onCanvasBlurObserver&&(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add(()=>{this._keys.length=0}),this._onKeyboardObserver=this._scene.onKeyboardObservable.add(t=>{const i=t.event;if(!i.metaKey){if(t.type===Yo.KEYDOWN)this._ctrlPressed=i.ctrlKey,this._altPressed=i.altKey,(this.keysUp.indexOf(i.keyCode)!==-1||this.keysDown.indexOf(i.keyCode)!==-1||this.keysLeft.indexOf(i.keyCode)!==-1||this.keysRight.indexOf(i.keyCode)!==-1||this.keysReset.indexOf(i.keyCode)!==-1)&&(this._keys.indexOf(i.keyCode)===-1&&this._keys.push(i.keyCode),i.preventDefault&&(e||i.preventDefault()));else if(this.keysUp.indexOf(i.keyCode)!==-1||this.keysDown.indexOf(i.keyCode)!==-1||this.keysLeft.indexOf(i.keyCode)!==-1||this.keysRight.indexOf(i.keyCode)!==-1||this.keysReset.indexOf(i.keyCode)!==-1){const s=this._keys.indexOf(i.keyCode);s>=0&&this._keys.splice(s,1),i.preventDefault&&(e||i.preventDefault())}}}))}detachControl(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const e=this.camera;for(let t=0;t<this._keys.length;t++){const i=this._keys[t];this.keysLeft.indexOf(i)!==-1?this._ctrlPressed&&this.camera._useCtrlForPanning?e.inertialPanningX-=1/this.panningSensibility:e.inertialAlphaOffset-=this.angularSpeed:this.keysUp.indexOf(i)!==-1?this._ctrlPressed&&this.camera._useCtrlForPanning?e.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?e.inertialRadiusOffset+=1/this.zoomingSensibility:e.inertialBetaOffset-=this.angularSpeed:this.keysRight.indexOf(i)!==-1?this._ctrlPressed&&this.camera._useCtrlForPanning?e.inertialPanningX+=1/this.panningSensibility:e.inertialAlphaOffset+=this.angularSpeed:this.keysDown.indexOf(i)!==-1?this._ctrlPressed&&this.camera._useCtrlForPanning?e.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?e.inertialRadiusOffset-=1/this.zoomingSensibility:e.inertialBetaOffset+=this.angularSpeed:this.keysReset.indexOf(i)!==-1&&e.useInputToRestoreState&&e.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}P([B()],Ps.prototype,"keysUp",void 0);P([B()],Ps.prototype,"keysDown",void 0);P([B()],Ps.prototype,"keysLeft",void 0);P([B()],Ps.prototype,"keysRight",void 0);P([B()],Ps.prototype,"keysReset",void 0);P([B()],Ps.prototype,"panningSensibility",void 0);P([B()],Ps.prototype,"zoomingSensibility",void 0);P([B()],Ps.prototype,"useAltToZoom",void 0);P([B()],Ps.prototype,"angularSpeed",void 0);jo.ArcRotateCameraKeyboardMoveInput=Ps;const NE=40;class c0{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new y(0,0,0),this._globalOffset=new y(0,0,0),this._inertialPanning=y.Zero()}_computeDeltaFromMouseWheelLegacyEvent(e,t){let i=0;const s=e*.01*this.wheelDeltaPercentage*t;return e>0?i=s/(1+this.wheelDeltaPercentage):i=s*(1+this.wheelDeltaPercentage),i}attachControl(e){e=Z.BackCompatCameraNoPreventDefault(arguments),this._wheel=t=>{if(t.type!==we.POINTERWHEEL)return;const i=t.event;let s=0;const r=i.deltaMode===u0.DOM_DELTA_LINE?NE:1,a=-(i.deltaY*r);if(this.customComputeDeltaFromMouseWheel)s=this.customComputeDeltaFromMouseWheel(a,this,i);else if(this.wheelDeltaPercentage){if(s=this._computeDeltaFromMouseWheelLegacyEvent(a,this.camera.radius),s>0){let o=this.camera.radius,l=this.camera.inertialRadiusOffset+s;for(let h=0;h<20&&Math.abs(l)>.001;h++)o-=l,l*=this.camera.inertia;o=lt(o,0,Number.MAX_VALUE),s=this._computeDeltaFromMouseWheelLegacyEvent(a,o)}}else s=a/(this.wheelPrecision*40);s&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(s)):this.camera.inertialRadiusOffset+=s),i.preventDefault&&(e||i.preventDefault())},this._observer=this.camera.getScene()._inputManager._addCameraPointerObserver(this._wheel,we.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.setAll(0)}detachControl(){this._observer&&(this.camera.getScene()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const e=this.camera;0+e.inertialAlphaOffset+e.inertialBetaOffset+e.inertialRadiusOffset&&(this._updateHitPlane(),e.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(e.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const e=this.camera,t=e.target.subtract(e.position);this._hitPlane=_i.FromPositionAndNormal(e.target,t)}_getPosition(){const e=this.camera,t=e.getScene(),i=t.createPickingRay(t.pointerX,t.pointerY,L.Identity(),e,!1);(e.targetScreenOffset.x!==0||e.targetScreenOffset.y!==0)&&(this._viewOffset.set(e.targetScreenOffset.x,e.targetScreenOffset.y,0),e.getViewMatrix().invertToRef(e._cameraTransformMatrix),this._globalOffset=y.TransformNormal(this._viewOffset,e._cameraTransformMatrix),i.origin.addInPlace(this._globalOffset));let s=0;return this._hitPlane&&(s=i.intersectsPlane(this._hitPlane)??0),i.origin.addInPlace(i.direction.scaleInPlace(s))}_zoomToMouse(e){const t=this.camera,i=1-t.inertia;if(t.lowerRadiusLimit){const l=t.lowerRadiusLimit??0;t.radius-(t.inertialRadiusOffset+e)/i<l&&(e=(t.radius-l)*i-t.inertialRadiusOffset)}if(t.upperRadiusLimit){const l=t.upperRadiusLimit??0;t.radius-(t.inertialRadiusOffset+e)/i>l&&(e=(t.radius-l)*i-t.inertialRadiusOffset)}const r=e/i/t.radius,a=this._getPosition(),o=N.Vector3[6];a.subtractToRef(t.target,o),o.scaleInPlace(r),o.scaleInPlace(i),this._inertialPanning.addInPlace(o),t.inertialRadiusOffset+=e}_zeroIfClose(e){Math.abs(e.x)<Ue&&(e.x=0),Math.abs(e.y)<Ue&&(e.y=0),Math.abs(e.z)<Ue&&(e.z=0)}}P([B()],c0.prototype,"wheelPrecision",void 0);P([B()],c0.prototype,"zoomToMouseLocation",void 0);P([B()],c0.prototype,"wheelDeltaPercentage",void 0);jo.ArcRotateCameraMouseWheelInput=c0;class UE extends BE{constructor(e){super(e)}addMouseWheel(){return this.add(new c0),this}addPointers(){return this.add(new Ri),this}addKeyboard(){return this.add(new Ps),this}}Rt.AddNodeConstructor("ArcRotateCamera",(n,e)=>()=>new st(n,0,0,1,y.Zero(),e));function kE(n){let e=Math.PI/2;return n.x===0&&n.z===0||(e=Math.acos(n.x/Math.sqrt(Math.pow(n.x,2)+Math.pow(n.z,2)))),n.z<0&&(e=2*Math.PI-e),e}function VE(n,e){return Math.acos(n/e)}class st extends Dt{get target(){return this._target}set target(e){this.setTarget(e)}get targetHost(){return this._targetHost}set targetHost(e){e&&this.setTarget(e)}getTarget(){return this.target}get position(){return this._position}set position(e){this.setPosition(e)}set upVector(e){this._upToYMatrix||(this._yToUpMatrix=new L,this._upToYMatrix=new L,this._upVector=y.Zero()),e.normalize(),this._upVector.copyFrom(e),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){L.RotationAlignToRef(y.UpReadOnly,this._upVector,this._yToUpMatrix),L.RotationAlignToRef(this._upVector,y.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const e=this.inputs.attached.pointers;return e?e.angularSensibilityX:0}set angularSensibilityX(e){const t=this.inputs.attached.pointers;t&&(t.angularSensibilityX=e)}get angularSensibilityY(){const e=this.inputs.attached.pointers;return e?e.angularSensibilityY:0}set angularSensibilityY(e){const t=this.inputs.attached.pointers;t&&(t.angularSensibilityY=e)}get pinchPrecision(){const e=this.inputs.attached.pointers;return e?e.pinchPrecision:0}set pinchPrecision(e){const t=this.inputs.attached.pointers;t&&(t.pinchPrecision=e)}get pinchDeltaPercentage(){const e=this.inputs.attached.pointers;return e?e.pinchDeltaPercentage:0}set pinchDeltaPercentage(e){const t=this.inputs.attached.pointers;t&&(t.pinchDeltaPercentage=e)}get useNaturalPinchZoom(){const e=this.inputs.attached.pointers;return e?e.useNaturalPinchZoom:!1}set useNaturalPinchZoom(e){const t=this.inputs.attached.pointers;t&&(t.useNaturalPinchZoom=e)}get panningSensibility(){const e=this.inputs.attached.pointers;return e?e.panningSensibility:0}set panningSensibility(e){const t=this.inputs.attached.pointers;t&&(t.panningSensibility=e)}get keysUp(){const e=this.inputs.attached.keyboard;return e?e.keysUp:[]}set keysUp(e){const t=this.inputs.attached.keyboard;t&&(t.keysUp=e)}get keysDown(){const e=this.inputs.attached.keyboard;return e?e.keysDown:[]}set keysDown(e){const t=this.inputs.attached.keyboard;t&&(t.keysDown=e)}get keysLeft(){const e=this.inputs.attached.keyboard;return e?e.keysLeft:[]}set keysLeft(e){const t=this.inputs.attached.keyboard;t&&(t.keysLeft=e)}get keysRight(){const e=this.inputs.attached.keyboard;return e?e.keysRight:[]}set keysRight(e){const t=this.inputs.attached.keyboard;t&&(t.keysRight=e)}get wheelPrecision(){const e=this.inputs.attached.mousewheel;return e?e.wheelPrecision:0}set wheelPrecision(e){const t=this.inputs.attached.mousewheel;t&&(t.wheelPrecision=e)}get zoomToMouseLocation(){const e=this.inputs.attached.mousewheel;return e?e.zoomToMouseLocation:!1}set zoomToMouseLocation(e){const t=this.inputs.attached.mousewheel;t&&(t.zoomToMouseLocation=e)}get wheelDeltaPercentage(){const e=this.inputs.attached.mousewheel;return e?e.wheelDeltaPercentage:0}set wheelDeltaPercentage(e){const t=this.inputs.attached.mousewheel;t&&(t.wheelDeltaPercentage=e)}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return this._bouncingBehavior!=null}set useBouncingBehavior(e){e!==this.useBouncingBehavior&&(e?(this._bouncingBehavior=new Er,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return this._framingBehavior!=null}set useFramingBehavior(e){e!==this.useFramingBehavior&&(e?(this._framingBehavior=new xi,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return this._autoRotationBehavior!=null}set useAutoRotationBehavior(e){e!==this.useAutoRotationBehavior&&(e?(this._autoRotationBehavior=new IE,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(e,t,i,s,r,a,o=!0){super(e,y.Zero(),a,o),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=y.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=ne.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new L,this.panningAxis=new y(1,1,0),this._transformedDirection=new y,this.mapPanning=!1,this._progressiveRestore=!1,this.onMeshTargetChangedObservable=new q,this.checkCollisions=!1,this.collisionRadius=new y(.5,.5,.5),this._previousPosition=y.Zero(),this._collisionVelocity=y.Zero(),this._newPosition=y.Zero(),this._computationVector=y.Zero(),this._onCollisionPositionChange=(l,h,u=null)=>{u?(this.setPosition(h),this.onCollide&&this.onCollide(u)):this._previousPosition.copyFrom(this._position);const c=Math.cos(this.alpha),f=Math.sin(this.alpha),d=Math.cos(this.beta);let _=Math.sin(this.beta);_===0&&(_=1e-4);const p=this._getTargetPosition();this._computationVector.copyFromFloats(this.radius*c*_,this.radius*d,this.radius*f*_),p.addToRef(this._computationVector,this._newPosition),this._position.copyFrom(this._newPosition);let g=this.upVector;this.allowUpsideDown&&this.beta<0&&(g=g.clone(),g=g.negate()),this._computeViewMatrix(this._position,p,g),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y),this._collisionTriggered=!1},this._target=y.Zero(),r&&this.setTarget(r),this.alpha=t,this.beta=i,this.radius=s,this.getViewMatrix(),this.inputs=new UE(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new y(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=ne.Zero()}_updateCache(e){e||super._updateCache(),this._cache._target.copyFrom(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.copyFrom(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const t=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?t.addToRef(this._targetBoundingCenter,this._target):this._target.copyFrom(t)}const e=this._getLockedTargetPosition();return e||this._target}storeState(){return this._storedAlpha=this._goalAlpha=this.alpha,this._storedBeta=this._goalBeta=this.beta,this._storedRadius=this._goalRadius=this.radius,this._storedTarget=this._goalTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this._goalTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>Ue&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):super._restoreStateValues()?(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0):!1}interpolateTo(e=this.alpha,t=this.beta,i=this.radius,s=this.target,r=this.targetScreenOffset,a){this._progressiveRestore=!0,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,a!=null?this._currentInterpolationFactor=a:this.restoreStateInterpolationFactor!==0?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,e=lt(e,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),t=lt(t,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),i=lt(i,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),s.y=lt(s.y,this.lowerTargetYLimit??-1/0,1/0),this._goalAlpha=e,this._goalBeta=t,this._goalRadius=i,this._goalTarget=s,this._goalTargetScreenOffset=r}_isSynchronizedViewMatrix(){return super._isSynchronizedViewMatrix()?this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset):!1}attachControl(e,t,i=!0,s=2){const r=arguments;t=Z.BackCompatCameraNoPreventDefault(r),this._useCtrlForPanning=i,this._panningMouseButton=s,typeof r[0]=="boolean"&&(r.length>1&&(this._useCtrlForPanning=r[1]),r.length>2&&(this._panningMouseButton=r[2])),this.inputs.attachElement(t),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}detachControl(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(!this._collisionTriggered){if(this.inputs.checkInputs(),this._progressiveRestore){const e=this._scene.getEngine().getDeltaTime()/1e3,t=1-Math.pow(2,-e/this._currentInterpolationFactor);this.setTarget(y.Lerp(this.getTarget(),this._goalTarget,t)),se.RotationAlphaBetaGammaToRef(this._goalAlpha,this._goalBeta,0,N.Quaternion[0]),se.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,N.Quaternion[1]),se.SlerpToRef(N.Quaternion[1],N.Quaternion[0],t,N.Quaternion[2]),N.Quaternion[2].normalize(),N.Quaternion[2].toAlphaBetaGammaToRef(N.Vector3[0]),this.alpha=N.Vector3[0].x,this.beta=N.Vector3[0].y,this.radius+=(this._goalRadius-this.radius)*t,ne.LerpToRef(this.targetScreenOffset,this._goalTargetScreenOffset,t,this.targetScreenOffset),(y.DistanceSquared(this.getTarget(),this._goalTarget)<Ue&&N.Quaternion[2].isApprox(N.Quaternion[0])&&Math.pow(this._goalRadius-this.radius,2)<Ue&&ne.Distance(this.targetScreenOffset,this._goalTargetScreenOffset)<Ue||this.inertialAlphaOffset!==0||this.inertialBetaOffset!==0||this.inertialRadiusOffset!==0||this.inertialPanningX!==0||this.inertialPanningY!==0)&&(this._progressiveRestore=!1)}if(this.inertialAlphaOffset!==0||this.inertialBetaOffset!==0||this.inertialRadiusOffset!==0){const e=this.invertRotation?-1:1,t=this._calculateHandednessMultiplier();let i=this.inertialAlphaOffset*t;this.beta<0&&(i*=-1),this.alpha+=i*e,this.beta+=this.inertialBetaOffset*e,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<Ue&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<Ue&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*Ue&&(this.inertialRadiusOffset=0)}if(this.inertialPanningX!==0||this.inertialPanningY!==0){const e=new y(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),e.multiplyInPlace(this.panningAxis),y.TransformNormalToRef(e,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const t=this.upVector,i=y.CrossToRef(this._transformedDirection,t,this._transformedDirection);y.CrossToRef(t,i,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit)this._transformedDirection.addInPlace(this._target),y.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.copyFrom(this._transformedDirection);else{if(this.parent){const t=N.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(t),t.transposeToRef(t),y.TransformCoordinatesToRef(this._transformedDirection,t,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*Ue&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*Ue&&(this.inertialPanningY=0)}this._checkLimits(),super._checkInputs()}}_checkLimits(){this.lowerBetaLimit===null||this.lowerBetaLimit===void 0?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),this.upperBetaLimit===null||this.upperBetaLimit===void 0?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),this.lowerAlphaLimit!==null&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),this.upperAlphaLimit!==null&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),this.lowerRadiusLimit!==null&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),this.upperRadiusLimit!==null&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),(this._upVector.x!==0||this._upVector.y!==1||this._upVector.z!==0)&&y.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),this.radius===0&&(this.radius=1e-4);const e=this.alpha;this.alpha=kE(this._computationVector),this.beta=VE(this._computationVector.y,this.radius);const t=Math.round((e-this.alpha)/(2*Math.PI));this.alpha+=t*2*Math.PI,this._checkLimits()}setPosition(e){this._position.equals(e)||(this._position.copyFrom(e),this.rebuildAnglesAndRadius())}setTarget(e,t=!1,i=!1,s=!1){if(s=this.overrideCloneAlphaBetaRadius??s,e.computeWorldMatrix)t&&e.getBoundingInfo?this._targetBoundingCenter=e.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,e.computeWorldMatrix(),this._targetHost=e,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const r=e,a=this._getTargetPosition();if(a&&!i&&a.equals(r))return;this._targetHost=null,this._target=r,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}s||this.rebuildAnglesAndRadius()}_getViewMatrix(){const e=Math.cos(this.alpha),t=Math.sin(this.alpha),i=Math.cos(this.beta);let s=Math.sin(this.beta);s===0&&(s=1e-4),this.radius===0&&(this.radius=1e-4);const r=this._getTargetPosition();if(this._computationVector.copyFromFloats(this.radius*e*s,this.radius*i,this.radius*t*s),(this._upVector.x!==0||this._upVector.y!==1||this._upVector.z!==0)&&y.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),r.addToRef(this._computationVector,this._newPosition),this.getScene().collisionsEnabled&&this.checkCollisions){const a=this.getScene().collisionCoordinator;this._collider||(this._collider=a.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,a.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.copyFrom(this._newPosition);let a=this.upVector;this.allowUpsideDown&&s<0&&(a=a.negate()),this._computeViewMatrix(this._position,r,a),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget=r,this._viewMatrix}zoomOn(e,t=!1){e=e||this.getScene().meshes;const i=O.MinMax(e);let s=this._calculateLowerRadiusFromModelBoundingSphere(i.min,i.max);s=Math.max(Math.min(s,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=s*this.zoomOnFactor,this.focusOn({min:i.min,max:i.max,distance:s},t)}focusOn(e,t=!1){let i,s;if(e.min===void 0){const r=e||this.getScene().meshes;i=O.MinMax(r),s=y.Distance(i.min,i.max)}else{const r=e;i=r,s=r.distance}this._target=O.Center(i),t||(this.maxZ=s*2)}createRigCamera(e,t){let i=0;switch(this.cameraRigMode){case be.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case be.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case be.RIG_MODE_STEREOSCOPIC_OVERUNDER:case be.RIG_MODE_STEREOSCOPIC_INTERLACED:case be.RIG_MODE_VR:i=this._cameraRigParams.stereoHalfAngle*(t===0?1:-1);break;case be.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:i=this._cameraRigParams.stereoHalfAngle*(t===0?-1:1);break}const s=new st(e,this.alpha+i,this.beta,this.radius,this._target,this.getScene());return s._cameraRigParams={},s.isRigCamera=!0,s.rigParent=this,s.upVector=this.upVector,s.mode=this.mode,s.orthoLeft=this.orthoLeft,s.orthoRight=this.orthoRight,s.orthoBottom=this.orthoBottom,s.orthoTop=this.orthoTop,s}_updateRigCameras(){const e=this._rigCameras[0],t=this._rigCameras[1];switch(e.beta=t.beta=this.beta,this.cameraRigMode){case be.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case be.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case be.RIG_MODE_STEREOSCOPIC_OVERUNDER:case be.RIG_MODE_STEREOSCOPIC_INTERLACED:case be.RIG_MODE_VR:e.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,t.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case be.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:e.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,t.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle;break}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(e,t,i=1){const s=y.Distance(e,t),a=this.getScene().getEngine().getAspectRatio(this),o=Math.tan(this.fov/2),l=o*a,u=s*.5*i,c=u*Math.sqrt(1+1/(l*l)),f=u*Math.sqrt(1+1/(o*o));return Math.max(c,f)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}P([B()],st.prototype,"alpha",void 0);P([B()],st.prototype,"beta",void 0);P([B()],st.prototype,"radius",void 0);P([B()],st.prototype,"overrideCloneAlphaBetaRadius",void 0);P([cs("target")],st.prototype,"_target",void 0);P([vv("targetHost")],st.prototype,"_targetHost",void 0);P([B()],st.prototype,"inertialAlphaOffset",void 0);P([B()],st.prototype,"inertialBetaOffset",void 0);P([B()],st.prototype,"inertialRadiusOffset",void 0);P([B()],st.prototype,"lowerAlphaLimit",void 0);P([B()],st.prototype,"upperAlphaLimit",void 0);P([B()],st.prototype,"lowerBetaLimit",void 0);P([B()],st.prototype,"upperBetaLimit",void 0);P([B()],st.prototype,"lowerRadiusLimit",void 0);P([B()],st.prototype,"upperRadiusLimit",void 0);P([B()],st.prototype,"lowerTargetYLimit",void 0);P([B()],st.prototype,"inertialPanningX",void 0);P([B()],st.prototype,"inertialPanningY",void 0);P([B()],st.prototype,"pinchToPanMaxDistance",void 0);P([B()],st.prototype,"panningDistanceLimit",void 0);P([cs()],st.prototype,"panningOriginTarget",void 0);P([B()],st.prototype,"panningInertia",void 0);P([B()],st.prototype,"zoomToMouseLocation",null);P([B()],st.prototype,"zoomOnFactor",void 0);P([mv()],st.prototype,"targetScreenOffset",void 0);P([B()],st.prototype,"allowUpsideDown",void 0);P([B()],st.prototype,"useInputToRestoreState",void 0);P([B()],st.prototype,"restoreStateInterpolationFactor",void 0);Tt("BABYLON.ArcRotateCamera",st);class Be extends Rt{get range(){return this._range}set range(e){this._range=e,this._inverseSquaredRange=1/(this.range*this.range)}get intensityMode(){return this._intensityMode}set intensityMode(e){this._intensityMode=e,this._computePhotometricScale()}get radius(){return this._radius}set radius(e){this._radius=e,this._computePhotometricScale()}get shadowEnabled(){return this._shadowEnabled}set shadowEnabled(e){this._shadowEnabled!==e&&(this._shadowEnabled=e,this._markMeshesAsLightDirty())}get includedOnlyMeshes(){return this._includedOnlyMeshes}set includedOnlyMeshes(e){this._includedOnlyMeshes=e,this._hookArrayForIncludedOnly(e)}get excludedMeshes(){return this._excludedMeshes}set excludedMeshes(e){this._excludedMeshes=e,this._hookArrayForExcluded(e)}get excludeWithLayerMask(){return this._excludeWithLayerMask}set excludeWithLayerMask(e){this._excludeWithLayerMask=e,this._resyncMeshes()}get includeOnlyWithLayerMask(){return this._includeOnlyWithLayerMask}set includeOnlyWithLayerMask(e){this._includeOnlyWithLayerMask=e,this._resyncMeshes()}get lightmapMode(){return this._lightmapMode}set lightmapMode(e){this._lightmapMode!==e&&(this._lightmapMode=e,this._markMeshesAsLightDirty())}getViewMatrix(e){return null}getProjectionMatrix(e,t){return null}constructor(e,t){super(e,t,!1),this.diffuse=new fe(1,1,1),this.specular=new fe(1,1,1),this.falloffType=Be.FALLOFF_DEFAULT,this.intensity=1,this._range=Number.MAX_VALUE,this._inverseSquaredRange=0,this._photometricScale=1,this._intensityMode=Be.INTENSITYMODE_AUTOMATIC,this._radius=1e-5,this.renderPriority=0,this._shadowEnabled=!0,this._excludeWithLayerMask=0,this._includeOnlyWithLayerMask=0,this._lightmapMode=0,this._shadowGenerators=null,this._excludedMeshesIds=new Array,this._includedOnlyMeshesIds=new Array,this._isLight=!0,this.getScene().addLight(this),this._uniformBuffer=new ce(this.getScene().getEngine(),void 0,void 0,e),this._buildUniformLayout(),this.includedOnlyMeshes=[],this.excludedMeshes=[],this._resyncMeshes()}transferTexturesToEffect(e,t){return this}_bindLight(e,t,i,s,r=!0){const a=e.toString();let o=!1;if(this._uniformBuffer.bindToEffect(i,"Light"+a),this._renderId!==t.getRenderId()||this._lastUseSpecular!==s||!this._uniformBuffer.useUbo){this._renderId=t.getRenderId(),this._lastUseSpecular=s;const l=this.getScaledIntensity();this.transferToEffect(i,a),this.diffuse.scaleToRef(l,aa.Color3[0]),this._uniformBuffer.updateColor4("vLightDiffuse",aa.Color3[0],this.range,a),s&&(this.specular.scaleToRef(l,aa.Color3[1]),this._uniformBuffer.updateColor4("vLightSpecular",aa.Color3[1],this.radius,a)),o=!0}if(this.transferTexturesToEffect(i,a),t.shadowsEnabled&&this.shadowEnabled&&r){const l=this.getShadowGenerator(t.activeCamera)??this.getShadowGenerator();l&&(l.bindShadowLight(a,i),o=!0)}o?this._uniformBuffer.update():this._uniformBuffer.bindUniformBuffer()}getClassName(){return"Light"}toString(e){let t="Name: "+this.name;if(t+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(let i=0;i<this.animations.length;i++)t+=", animation[0]: "+this.animations[i].toString(e);return t}_syncParentEnabledState(){super._syncParentEnabledState(),this.isDisposed()||this._resyncMeshes()}setEnabled(e){super.setEnabled(e),this._resyncMeshes()}getShadowGenerator(e=null){return this._shadowGenerators===null?null:this._shadowGenerators.get(e)??null}getShadowGenerators(){return this._shadowGenerators}getAbsolutePosition(){return y.Zero()}canAffectMesh(e){return e?!(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&this.includedOnlyMeshes.indexOf(e)===-1||this.excludedMeshes&&this.excludedMeshes.length>0&&this.excludedMeshes.indexOf(e)!==-1||this.includeOnlyWithLayerMask!==0&&!(this.includeOnlyWithLayerMask&e.layerMask)||this.excludeWithLayerMask!==0&&this.excludeWithLayerMask&e.layerMask):!0}dispose(e,t=!1){if(this._shadowGenerators){const i=this._shadowGenerators.values();for(let s=i.next();s.done!==!0;s=i.next())s.value.dispose();this._shadowGenerators=null}if(this.getScene().stopAnimation(this),this._parentContainer){const i=this._parentContainer.lights.indexOf(this);i>-1&&this._parentContainer.lights.splice(i,1),this._parentContainer=null}for(const i of this.getScene().meshes)i._removeLightSource(this,!0);this._uniformBuffer.dispose(),this.getScene().removeLight(this),super.dispose(e,t)}getTypeID(){return 0}getScaledIntensity(){return this._photometricScale*this.intensity}clone(e,t=null){const i=Be.GetConstructorFromName(this.getTypeID(),e,this.getScene());if(!i)return null;const s=Ie.Clone(i,this);return e&&(s.name=e),t&&(s.parent=t),s.setEnabled(this.isEnabled()),this.onClonedObservable.notifyObservers(s),s}serialize(){const e=Ie.Serialize(this);return e.uniqueId=this.uniqueId,e.type=this.getTypeID(),this.parent&&this.parent._serializeAsParent(e),this.excludedMeshes.length>0&&(e.excludedMeshesIds=[],this.excludedMeshes.forEach(t=>{e.excludedMeshesIds.push(t.id)})),this.includedOnlyMeshes.length>0&&(e.includedOnlyMeshesIds=[],this.includedOnlyMeshes.forEach(t=>{e.includedOnlyMeshesIds.push(t.id)})),Ie.AppendSerializedAnimations(this,e),e.ranges=this.serializeAnimationRanges(),e.isEnabled=this.isEnabled(),e}static GetConstructorFromName(e,t,i){const s=Rt.Construct("Light_Type_"+e,t,i);return s||null}static Parse(e,t){const i=Be.GetConstructorFromName(e.type,e.name,t);if(!i)return null;const s=Ie.Parse(i,e,t);if(e.excludedMeshesIds&&(s._excludedMeshesIds=e.excludedMeshesIds),e.includedOnlyMeshesIds&&(s._includedOnlyMeshesIds=e.includedOnlyMeshesIds),e.parentId!==void 0&&(s._waitingParentId=e.parentId),e.parentInstanceIndex!==void 0&&(s._waitingParentInstanceIndex=e.parentInstanceIndex),e.falloffType!==void 0&&(s.falloffType=e.falloffType),e.lightmapMode!==void 0&&(s.lightmapMode=e.lightmapMode),e.animations){for(let r=0;r<e.animations.length;r++){const a=e.animations[r],o=Zn("BABYLON.Animation");o&&s.animations.push(o.Parse(a))}Rt.ParseAnimationRanges(s,e,t)}return e.autoAnimate&&t.beginAnimation(s,e.autoAnimateFrom,e.autoAnimateTo,e.autoAnimateLoop,e.autoAnimateSpeed||1),e.isEnabled!==void 0&&s.setEnabled(e.isEnabled),s}_hookArrayForExcluded(e){const t=e.push;e.push=(...s)=>{const r=t.apply(e,s);for(const a of s)a._resyncLightSource(this);return r};const i=e.splice;e.splice=(s,r)=>{const a=i.apply(e,[s,r]);for(const o of a)o._resyncLightSource(this);return a};for(const s of e)s._resyncLightSource(this)}_hookArrayForIncludedOnly(e){const t=e.push;e.push=(...s)=>{const r=t.apply(e,s);return this._resyncMeshes(),r};const i=e.splice;e.splice=(s,r)=>{const a=i.apply(e,[s,r]);return this._resyncMeshes(),a},this._resyncMeshes()}_resyncMeshes(){for(const e of this.getScene().meshes)e._resyncLightSource(this)}_markMeshesAsLightDirty(){for(const e of this.getScene().meshes)e.lightSources.indexOf(this)!==-1&&e._markSubMeshesAsLightDirty()}_computePhotometricScale(){this._photometricScale=this._getPhotometricScale(),this.getScene().resetCachedMaterial()}_getPhotometricScale(){let e=0;const t=this.getTypeID();let i=this.intensityMode;switch(i===Be.INTENSITYMODE_AUTOMATIC&&(t===Be.LIGHTTYPEID_DIRECTIONALLIGHT?i=Be.INTENSITYMODE_ILLUMINANCE:i=Be.INTENSITYMODE_LUMINOUSINTENSITY),t){case Be.LIGHTTYPEID_POINTLIGHT:case Be.LIGHTTYPEID_SPOTLIGHT:switch(i){case Be.INTENSITYMODE_LUMINOUSPOWER:e=1/(4*Math.PI);break;case Be.INTENSITYMODE_LUMINOUSINTENSITY:e=1;break;case Be.INTENSITYMODE_LUMINANCE:e=this.radius*this.radius;break}break;case Be.LIGHTTYPEID_DIRECTIONALLIGHT:switch(i){case Be.INTENSITYMODE_ILLUMINANCE:e=1;break;case Be.INTENSITYMODE_LUMINANCE:{let s=this.radius;s=Math.max(s,.001),e=2*Math.PI*(1-Math.cos(s));break}}break;case Be.LIGHTTYPEID_HEMISPHERICLIGHT:e=1;break}return e}_reorderLightsInScene(){const e=this.getScene();this._renderPriority!=0&&(e.requireLightSorting=!0),this.getScene().sortLightsByPriority()}_isReady(){return!0}}Be.FALLOFF_DEFAULT=He.FALLOFF_DEFAULT;Be.FALLOFF_PHYSICAL=He.FALLOFF_PHYSICAL;Be.FALLOFF_GLTF=He.FALLOFF_GLTF;Be.FALLOFF_STANDARD=He.FALLOFF_STANDARD;Be.LIGHTMAP_DEFAULT=He.LIGHTMAP_DEFAULT;Be.LIGHTMAP_SPECULAR=He.LIGHTMAP_SPECULAR;Be.LIGHTMAP_SHADOWSONLY=He.LIGHTMAP_SHADOWSONLY;Be.INTENSITYMODE_AUTOMATIC=He.INTENSITYMODE_AUTOMATIC;Be.INTENSITYMODE_LUMINOUSPOWER=He.INTENSITYMODE_LUMINOUSPOWER;Be.INTENSITYMODE_LUMINOUSINTENSITY=He.INTENSITYMODE_LUMINOUSINTENSITY;Be.INTENSITYMODE_ILLUMINANCE=He.INTENSITYMODE_ILLUMINANCE;Be.INTENSITYMODE_LUMINANCE=He.INTENSITYMODE_LUMINANCE;Be.LIGHTTYPEID_POINTLIGHT=He.LIGHTTYPEID_POINTLIGHT;Be.LIGHTTYPEID_DIRECTIONALLIGHT=He.LIGHTTYPEID_DIRECTIONALLIGHT;Be.LIGHTTYPEID_SPOTLIGHT=He.LIGHTTYPEID_SPOTLIGHT;Be.LIGHTTYPEID_HEMISPHERICLIGHT=He.LIGHTTYPEID_HEMISPHERICLIGHT;Be.LIGHTTYPEID_RECT_AREALIGHT=He.LIGHTTYPEID_RECT_AREALIGHT;P([En()],Be.prototype,"diffuse",void 0);P([En()],Be.prototype,"specular",void 0);P([B()],Be.prototype,"falloffType",void 0);P([B()],Be.prototype,"intensity",void 0);P([B()],Be.prototype,"range",null);P([B()],Be.prototype,"intensityMode",null);P([B()],Be.prototype,"radius",null);P([B()],Be.prototype,"_renderPriority",void 0);P([Ze("_reorderLightsInScene")],Be.prototype,"renderPriority",void 0);P([B("shadowEnabled")],Be.prototype,"_shadowEnabled",void 0);P([B("excludeWithLayerMask")],Be.prototype,"_excludeWithLayerMask",void 0);P([B("includeOnlyWithLayerMask")],Be.prototype,"_includeOnlyWithLayerMask",void 0);P([B("lightmapMode")],Be.prototype,"_lightmapMode",void 0);class f0 extends Be{constructor(){super(...arguments),this._needProjectionMatrixCompute=!0,this._viewMatrix=L.Identity(),this._projectionMatrix=L.Identity()}_setPosition(e){this._position=e}get position(){return this._position}set position(e){this._setPosition(e)}_setDirection(e){this._direction=e}get direction(){return this._direction}set direction(e){this._setDirection(e)}get shadowMinZ(){return this._shadowMinZ}set shadowMinZ(e){this._shadowMinZ=e,this.forceProjectionMatrixCompute()}get shadowMaxZ(){return this._shadowMaxZ}set shadowMaxZ(e){this._shadowMaxZ=e,this.forceProjectionMatrixCompute()}computeTransformedInformation(){return this.parent&&this.parent.getWorldMatrix?(this.transformedPosition||(this.transformedPosition=y.Zero()),y.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),this.direction&&(this.transformedDirection||(this.transformedDirection=y.Zero()),y.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this.transformedDirection)),!0):!1}getDepthScale(){return 50}getShadowDirection(e){return this.transformedDirection?this.transformedDirection:this.direction}getAbsolutePosition(){return this.transformedPosition?this.transformedPosition:this.position}setDirectionToTarget(e){return this.direction=y.Normalize(e.subtract(this.position)),this.direction}getRotation(){this.direction.normalize();const e=y.Cross(this.direction,ni.Y),t=y.Cross(e,this.direction);return y.RotationFromAxis(e,t,this.direction)}needCube(){return!1}needProjectionMatrixCompute(){return this._needProjectionMatrixCompute}forceProjectionMatrixCompute(){this._needProjectionMatrixCompute=!0}_initCache(){super._initCache(),this._cache.position=y.Zero()}_isSynchronized(){return!!this._cache.position.equals(this.position)}computeWorldMatrix(e){return!e&&this.isSynchronized()?(this._currentRenderId=this.getScene().getRenderId(),this._worldMatrix):(this._updateCache(),this._cache.position.copyFrom(this.position),this._worldMatrix||(this._worldMatrix=L.Identity()),L.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this.parent&&this.parent.getWorldMatrix&&(this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix)}getDepthMinZ(e){return this.shadowMinZ!==void 0?this.shadowMinZ:(e==null?void 0:e.minZ)||0}getDepthMaxZ(e){return this.shadowMaxZ!==void 0?this.shadowMaxZ:(e==null?void 0:e.maxZ)||1e4}setShadowProjectionMatrix(e,t,i){return this.customProjectionMatrixBuilder?this.customProjectionMatrixBuilder(t,i,e):this._setDefaultShadowProjectionMatrix(e,t,i),this}_syncParentEnabledState(){super._syncParentEnabledState(),(!this.parent||!this.parent.getWorldMatrix)&&(this.transformedPosition=null,this.transformedDirection=null)}getViewMatrix(e){const t=N.Vector3[0];let i=this.position;this.computeTransformedInformation()&&(i=this.transformedPosition),y.NormalizeToRef(this.getShadowDirection(e),t),Math.abs(y.Dot(t,y.Up()))===1&&(t.z=1e-13);const s=N.Vector3[1];return i.addToRef(t,s),L.LookAtLHToRef(i,s,y.Up(),this._viewMatrix),this._viewMatrix}getProjectionMatrix(e,t){return this.setShadowProjectionMatrix(this._projectionMatrix,e??this._viewMatrix,t??[]),this._projectionMatrix}}P([cs()],f0.prototype,"position",null);P([cs()],f0.prototype,"direction",null);P([B()],f0.prototype,"shadowMinZ",null);P([B()],f0.prototype,"shadowMaxZ",null);Rt.AddNodeConstructor("Light_Type_0",(n,e)=>()=>new Rh(n,y.Zero(),e));class Rh extends f0{get shadowAngle(){return this._shadowAngle}set shadowAngle(e){this._shadowAngle=e,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(e){const t=this.needCube();if(this._direction=e,this.needCube()!==t&&this._shadowGenerators){const i=this._shadowGenerators.values();for(let s=i.next();s.done!==!0;s=i.next())s.value.recreateShadowMap()}}constructor(e,t,i){super(e,i),this._shadowAngle=Math.PI/2,this.position=t}getClassName(){return"PointLight"}getTypeID(){return Be.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(e){if(this.direction)return super.getShadowDirection(e);switch(e){case 0:return new y(1,0,0);case 1:return new y(-1,0,0);case 2:return new y(0,-1,0);case 3:return new y(0,1,0);case 4:return new y(0,0,1);case 5:return new y(0,0,-1)}return y.Zero()}_setDefaultShadowProjectionMatrix(e,t,i){const s=this.getScene().activeCamera;if(!s)return;const r=this.shadowMinZ!==void 0?this.shadowMinZ:s.minZ,a=this.shadowMaxZ!==void 0?this.shadowMaxZ:s.maxZ,o=this.getScene().getEngine().useReverseDepthBuffer;L.PerspectiveFovLHToRef(this.shadowAngle,1,o?a:r,o?r:a,e,!0,this._scene.getEngine().isNDCHalfZRange,void 0,o)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(e,t){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,t):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,t),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,t),this}transferToNodeMaterialEffect(e,t){return this.computeTransformedInformation()?e.setFloat3(t,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):e.setFloat3(t,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(e,t){e["POINTLIGHT"+t]=!0}}P([B()],Rh.prototype,"shadowAngle",null);Tt("BABYLON.PointLight",Rh);class Gg{constructor(){this.previousWorldMatrices={},this.previousBones={}}static AddUniforms(e){e.push("previousWorld","previousViewProjection","mPreviousBones")}static AddSamplers(e){}bindForSubMesh(e,t,i,s,r){if(t.prePassRenderer&&t.prePassRenderer.enabled&&t.prePassRenderer.currentRTisSceneRT&&(t.prePassRenderer.getIndex(2)!==-1||t.prePassRenderer.getIndex(11)!==-1)){this.previousWorldMatrices[i.uniqueId]||(this.previousWorldMatrices[i.uniqueId]=s.clone()),this.previousViewProjection||(this.previousViewProjection=t.getTransformMatrix().clone(),this.currentViewProjection=t.getTransformMatrix().clone());const a=t.getEngine();this.currentViewProjection.updateFlag!==t.getTransformMatrix().updateFlag?(this._lastUpdateFrameId=a.frameId,this.previousViewProjection.copyFrom(this.currentViewProjection),this.currentViewProjection.copyFrom(t.getTransformMatrix())):this._lastUpdateFrameId!==a.frameId&&(this._lastUpdateFrameId=a.frameId,this.previousViewProjection.copyFrom(this.currentViewProjection)),e.setMatrix("previousWorld",this.previousWorldMatrices[i.uniqueId]),e.setMatrix("previousViewProjection",this.previousViewProjection),this.previousWorldMatrices[i.uniqueId]=s.clone()}}}class Cd{constructor(e){if(this._keys=[],this._isDirty=!0,this._areLightsDirty=!0,this._areLightsDisposed=!1,this._areAttributesDirty=!0,this._areTexturesDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!0,this._areImageProcessingDirty=!0,this._normals=!1,this._uvs=!1,this._needNormals=!1,this._needUVs=!1,this._externalProperties=e,e)for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&this._setDefaultValue(t)}get isDirty(){return this._isDirty}markAsProcessed(){this._isDirty=!1,this._areAttributesDirty=!1,this._areTexturesDirty=!1,this._areFresnelDirty=!1,this._areLightsDirty=!1,this._areLightsDisposed=!1,this._areMiscDirty=!1,this._arePrePassDirty=!1,this._areImageProcessingDirty=!1}markAsUnprocessed(){this._isDirty=!0}markAllAsDirty(){this._areTexturesDirty=!0,this._areAttributesDirty=!0,this._areLightsDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!0,this._areImageProcessingDirty=!0,this._isDirty=!0}markAsImageProcessingDirty(){this._areImageProcessingDirty=!0,this._isDirty=!0}markAsLightDirty(e=!1){this._areLightsDirty=!0,this._areLightsDisposed=this._areLightsDisposed||e,this._isDirty=!0}markAsAttributesDirty(){this._areAttributesDirty=!0,this._isDirty=!0}markAsTexturesDirty(){this._areTexturesDirty=!0,this._isDirty=!0}markAsFresnelDirty(){this._areFresnelDirty=!0,this._isDirty=!0}markAsMiscDirty(){this._areMiscDirty=!0,this._isDirty=!0}markAsPrePassDirty(){this._arePrePassDirty=!0,this._isDirty=!0}rebuild(){this._keys.length=0;for(const e of Object.keys(this))e[0]!=="_"&&this._keys.push(e);if(this._externalProperties)for(const e in this._externalProperties)this._keys.indexOf(e)===-1&&this._keys.push(e)}isEqual(e){if(this._keys.length!==e._keys.length)return!1;for(let t=0;t<this._keys.length;t++){const i=this._keys[t];if(this[i]!==e[i])return!1}return!0}cloneTo(e){this._keys.length!==e._keys.length&&(e._keys=this._keys.slice(0));for(let t=0;t<this._keys.length;t++){const i=this._keys[t];e[i]=this[i]}}reset(){this._keys.forEach(e=>this._setDefaultValue(e))}_setDefaultValue(e){var s,r,a,o;const t=((r=(s=this._externalProperties)==null?void 0:s[e])==null?void 0:r.type)??typeof this[e],i=(o=(a=this._externalProperties)==null?void 0:a[e])==null?void 0:o.default;switch(t){case"number":this[e]=i??0;break;case"string":this[e]=i??"";break;default:this[e]=i??!1;break}}toString(){let e="";for(let t=0;t<this._keys.length;t++){const i=this._keys[t],s=this[i];switch(typeof s){case"number":case"string":e+="#define "+i+" "+s+`
`;break;default:s&&(e+="#define "+i+`
`);break}}return e}}class Md extends Y{constructor(e,t,i=!0,s=!1){super(e,t,void 0,s),this._normalMatrix=new L,this._storeEffectOnSubMeshes=i}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(e,t){return e?!this._storeEffectOnSubMeshes||!e.subMeshes||e.subMeshes.length===0?!0:this.isReadyForSubMesh(e,e.subMeshes[0],t):!1}_isReadyForSubMesh(e){const t=e.materialDefines;return!!(!this.checkReadyOnEveryCall&&e.effect&&t&&t._renderId===this.getScene().getRenderId())}bindOnlyWorldMatrix(e){this._activeEffect.setMatrix("world",e)}bindOnlyNormalMatrix(e){this._activeEffect.setMatrix("normalMatrix",e)}bind(e,t){t&&this.bindForSubMesh(e,t,t.subMeshes[0])}_afterBind(e,t=null,i){super._afterBind(e,t,i),this.getScene()._cachedEffect=t,i?i._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}_mustRebind(e,t,i,s=1){return i._drawWrapper._forceRebindOnNextCall||e.isCachedMaterialInvalid(this,t,s)}dispose(e,t,i){this._activeEffect=void 0,super.dispose(e,t,i)}}class Le{static get DiffuseTextureEnabled(){return this._DiffuseTextureEnabled}static set DiffuseTextureEnabled(e){this._DiffuseTextureEnabled!==e&&(this._DiffuseTextureEnabled=e,re.MarkAllMaterialsAsDirty(1))}static get BaseWeightTextureEnabled(){return this._BaseWeightTextureEnabled}static set BaseWeightTextureEnabled(e){this._BaseWeightTextureEnabled!==e&&(this._BaseWeightTextureEnabled=e,re.MarkAllMaterialsAsDirty(1))}static get DetailTextureEnabled(){return this._DetailTextureEnabled}static set DetailTextureEnabled(e){this._DetailTextureEnabled!==e&&(this._DetailTextureEnabled=e,re.MarkAllMaterialsAsDirty(1))}static get DecalMapEnabled(){return this._DecalMapEnabled}static set DecalMapEnabled(e){this._DecalMapEnabled!==e&&(this._DecalMapEnabled=e,re.MarkAllMaterialsAsDirty(1))}static get AmbientTextureEnabled(){return this._AmbientTextureEnabled}static set AmbientTextureEnabled(e){this._AmbientTextureEnabled!==e&&(this._AmbientTextureEnabled=e,re.MarkAllMaterialsAsDirty(1))}static get OpacityTextureEnabled(){return this._OpacityTextureEnabled}static set OpacityTextureEnabled(e){this._OpacityTextureEnabled!==e&&(this._OpacityTextureEnabled=e,re.MarkAllMaterialsAsDirty(1))}static get ReflectionTextureEnabled(){return this._ReflectionTextureEnabled}static set ReflectionTextureEnabled(e){this._ReflectionTextureEnabled!==e&&(this._ReflectionTextureEnabled=e,re.MarkAllMaterialsAsDirty(1))}static get EmissiveTextureEnabled(){return this._EmissiveTextureEnabled}static set EmissiveTextureEnabled(e){this._EmissiveTextureEnabled!==e&&(this._EmissiveTextureEnabled=e,re.MarkAllMaterialsAsDirty(1))}static get SpecularTextureEnabled(){return this._SpecularTextureEnabled}static set SpecularTextureEnabled(e){this._SpecularTextureEnabled!==e&&(this._SpecularTextureEnabled=e,re.MarkAllMaterialsAsDirty(1))}static get BumpTextureEnabled(){return this._BumpTextureEnabled}static set BumpTextureEnabled(e){this._BumpTextureEnabled!==e&&(this._BumpTextureEnabled=e,re.MarkAllMaterialsAsDirty(1))}static get LightmapTextureEnabled(){return this._LightmapTextureEnabled}static set LightmapTextureEnabled(e){this._LightmapTextureEnabled!==e&&(this._LightmapTextureEnabled=e,re.MarkAllMaterialsAsDirty(1))}static get RefractionTextureEnabled(){return this._RefractionTextureEnabled}static set RefractionTextureEnabled(e){this._RefractionTextureEnabled!==e&&(this._RefractionTextureEnabled=e,re.MarkAllMaterialsAsDirty(1))}static get ColorGradingTextureEnabled(){return this._ColorGradingTextureEnabled}static set ColorGradingTextureEnabled(e){this._ColorGradingTextureEnabled!==e&&(this._ColorGradingTextureEnabled=e,re.MarkAllMaterialsAsDirty(1))}static get FresnelEnabled(){return this._FresnelEnabled}static set FresnelEnabled(e){this._FresnelEnabled!==e&&(this._FresnelEnabled=e,re.MarkAllMaterialsAsDirty(4))}static get ClearCoatTextureEnabled(){return this._ClearCoatTextureEnabled}static set ClearCoatTextureEnabled(e){this._ClearCoatTextureEnabled!==e&&(this._ClearCoatTextureEnabled=e,re.MarkAllMaterialsAsDirty(1))}static get ClearCoatBumpTextureEnabled(){return this._ClearCoatBumpTextureEnabled}static set ClearCoatBumpTextureEnabled(e){this._ClearCoatBumpTextureEnabled!==e&&(this._ClearCoatBumpTextureEnabled=e,re.MarkAllMaterialsAsDirty(1))}static get ClearCoatTintTextureEnabled(){return this._ClearCoatTintTextureEnabled}static set ClearCoatTintTextureEnabled(e){this._ClearCoatTintTextureEnabled!==e&&(this._ClearCoatTintTextureEnabled=e,re.MarkAllMaterialsAsDirty(1))}static get SheenTextureEnabled(){return this._SheenTextureEnabled}static set SheenTextureEnabled(e){this._SheenTextureEnabled!==e&&(this._SheenTextureEnabled=e,re.MarkAllMaterialsAsDirty(1))}static get AnisotropicTextureEnabled(){return this._AnisotropicTextureEnabled}static set AnisotropicTextureEnabled(e){this._AnisotropicTextureEnabled!==e&&(this._AnisotropicTextureEnabled=e,re.MarkAllMaterialsAsDirty(1))}static get ThicknessTextureEnabled(){return this._ThicknessTextureEnabled}static set ThicknessTextureEnabled(e){this._ThicknessTextureEnabled!==e&&(this._ThicknessTextureEnabled=e,re.MarkAllMaterialsAsDirty(1))}static get RefractionIntensityTextureEnabled(){return this._ThicknessTextureEnabled}static set RefractionIntensityTextureEnabled(e){this._RefractionIntensityTextureEnabled!==e&&(this._RefractionIntensityTextureEnabled=e,re.MarkAllMaterialsAsDirty(1))}static get TranslucencyIntensityTextureEnabled(){return this._TranslucencyIntensityTextureEnabled}static set TranslucencyIntensityTextureEnabled(e){this._TranslucencyIntensityTextureEnabled!==e&&(this._TranslucencyIntensityTextureEnabled=e,re.MarkAllMaterialsAsDirty(1))}static get TranslucencyColorTextureEnabled(){return this._TranslucencyColorTextureEnabled}static set TranslucencyColorTextureEnabled(e){this._TranslucencyColorTextureEnabled!==e&&(this._TranslucencyColorTextureEnabled=e,re.MarkAllMaterialsAsDirty(1))}static get IridescenceTextureEnabled(){return this._IridescenceTextureEnabled}static set IridescenceTextureEnabled(e){this._IridescenceTextureEnabled!==e&&(this._IridescenceTextureEnabled=e,re.MarkAllMaterialsAsDirty(1))}}Le._DiffuseTextureEnabled=!0;Le._BaseWeightTextureEnabled=!0;Le._DetailTextureEnabled=!0;Le._DecalMapEnabled=!0;Le._AmbientTextureEnabled=!0;Le._OpacityTextureEnabled=!0;Le._ReflectionTextureEnabled=!0;Le._EmissiveTextureEnabled=!0;Le._SpecularTextureEnabled=!0;Le._BumpTextureEnabled=!0;Le._LightmapTextureEnabled=!0;Le._RefractionTextureEnabled=!0;Le._ColorGradingTextureEnabled=!0;Le._FresnelEnabled=!0;Le._ClearCoatTextureEnabled=!0;Le._ClearCoatBumpTextureEnabled=!0;Le._ClearCoatTintTextureEnabled=!0;Le._SheenTextureEnabled=!0;Le._AnisotropicTextureEnabled=!0;Le._ThicknessTextureEnabled=!0;Le._RefractionIntensityTextureEnabled=!0;Le._TranslucencyIntensityTextureEnabled=!0;Le._TranslucencyColorTextureEnabled=!0;Le._IridescenceTextureEnabled=!0;class Pd{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}unBindMesh(){this._mesh=null}addFallback(e,t){this._defines[e]||(e<this._currentRank&&(this._currentRank=e),e>this._maxRank&&(this._maxRank=e),this._defines[e]=new Array),this._defines[e].push(t)}addCPUSkinningFallback(e,t){this._mesh=t,e<this._currentRank&&(this._currentRank=e),e>this._maxRank&&(this._maxRank=e)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(e,t){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,e=e.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),t._bonesComputationForcedToCPU=!0;const i=this._mesh.getScene();for(let s=0;s<i.meshes.length;s++){const r=i.meshes[s];if(!r.material){!this._mesh.material&&r.computeBonesUsingShaders&&r.numBoneInfluencers>0&&(r.computeBonesUsingShaders=!1);continue}if(!(!r.computeBonesUsingShaders||r.numBoneInfluencers===0)){if(r.material.getEffect()===t)r.computeBonesUsingShaders=!1;else if(r.subMeshes){for(const a of r.subMeshes)if(a.effect===t){r.computeBonesUsingShaders=!1;break}}}}}else{const i=this._defines[this._currentRank];if(i)for(let s=0;s<i.length;s++)e=e.replace("#define "+i[s],"");this._currentRank++}return e}}const GE=new RegExp("^([gimus]+)!");class Vn{constructor(e){this._plugins=[],this._activePlugins=[],this._activePluginsForExtraEvents=[],this._material=e,this._scene=e.getScene(),this._engine=this._scene.getEngine()}_addPlugin(e){for(let s=0;s<this._plugins.length;++s)if(this._plugins[s].name===e.name)return!1;if(this._material._uniformBufferLayoutBuilt&&(this._material.resetDrawCache(),this._material._createUniformBuffer()),!e.isCompatible(this._material.shaderLanguage))throw`The plugin "${e.name}" can't be added to the material "${this._material.name}" because the plugin is not compatible with the shader language of the material.`;const t=e.getClassName();Vn._MaterialPluginClassToMainDefine[t]||(Vn._MaterialPluginClassToMainDefine[t]="MATERIALPLUGIN_"+ ++Vn._MaterialPluginCounter),this._material._callbackPluginEventGeneric=(s,r)=>this._handlePluginEvent(s,r),this._plugins.push(e),this._plugins.sort((s,r)=>s.priority-r.priority),this._codeInjectionPoints={};const i={};i[Vn._MaterialPluginClassToMainDefine[t]]={type:"boolean",default:!0};for(const s of this._plugins)s.collectDefines(i),this._collectPointNames("vertex",s.getCustomCode("vertex",this._material.shaderLanguage)),this._collectPointNames("fragment",s.getCustomCode("fragment",this._material.shaderLanguage));return this._defineNamesFromPlugins=i,!0}_activatePlugin(e){this._activePlugins.indexOf(e)===-1&&(this._activePlugins.push(e),this._activePlugins.sort((t,i)=>t.priority-i.priority),this._material._callbackPluginEventIsReadyForSubMesh=this._handlePluginEventIsReadyForSubMesh.bind(this),this._material._callbackPluginEventPrepareDefinesBeforeAttributes=this._handlePluginEventPrepareDefinesBeforeAttributes.bind(this),this._material._callbackPluginEventPrepareDefines=this._handlePluginEventPrepareDefines.bind(this),this._material._callbackPluginEventBindForSubMesh=this._handlePluginEventBindForSubMesh.bind(this),e.registerForExtraEvents&&(this._activePluginsForExtraEvents.push(e),this._activePluginsForExtraEvents.sort((t,i)=>t.priority-i.priority),this._material._callbackPluginEventHasRenderTargetTextures=this._handlePluginEventHasRenderTargetTextures.bind(this),this._material._callbackPluginEventFillRenderTargetTextures=this._handlePluginEventFillRenderTargetTextures.bind(this),this._material._callbackPluginEventHardBindForSubMesh=this._handlePluginEventHardBindForSubMesh.bind(this)))}getPlugin(e){for(let t=0;t<this._plugins.length;++t)if(this._plugins[t].name===e)return this._plugins[t];return null}_handlePluginEventIsReadyForSubMesh(e){let t=!0;for(const i of this._activePlugins)t=t&&i.isReadyForSubMesh(e.defines,this._scene,this._engine,e.subMesh);e.isReadyForSubMesh=t}_handlePluginEventPrepareDefinesBeforeAttributes(e){for(const t of this._activePlugins)t.prepareDefinesBeforeAttributes(e.defines,this._scene,e.mesh)}_handlePluginEventPrepareDefines(e){for(const t of this._activePlugins)t.prepareDefines(e.defines,this._scene,e.mesh)}_handlePluginEventHardBindForSubMesh(e){for(const t of this._activePluginsForExtraEvents)t.hardBindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,e.subMesh)}_handlePluginEventBindForSubMesh(e){for(const t of this._activePlugins)t.bindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,e.subMesh)}_handlePluginEventHasRenderTargetTextures(e){let t=!1;for(const i of this._activePluginsForExtraEvents)if(t=i.hasRenderTargetTextures(),t)break;e.hasRenderTargetTextures=t}_handlePluginEventFillRenderTargetTextures(e){for(const t of this._activePluginsForExtraEvents)t.fillRenderTargetTextures(e.renderTargets)}_handlePluginEvent(e,t){switch(e){case 512:{const i=t;for(const s of this._activePlugins)s.getActiveTextures(i.activeTextures);break}case 256:{const i=t;for(const s of this._activePlugins)s.getAnimatables(i.animatables);break}case 1024:{const i=t;let s=!1;for(const r of this._activePlugins)if(s=r.hasTexture(i.texture),s)break;i.hasTexture=s;break}case 2:{const i=t;for(const s of this._plugins)s.dispose(i.forceDisposeTextures);break}case 4:{const i=t;i.defineNames=this._defineNamesFromPlugins;break}case 128:{const i=t;for(const s of this._activePlugins)i.fallbackRank=s.addFallbacks(i.defines,i.fallbacks,i.fallbackRank),s.getAttributes(i.attributes,this._scene,i.mesh);this._uniformList.length>0&&i.uniforms.push(...this._uniformList),this._samplerList.length>0&&i.samplers.push(...this._samplerList),this._uboList.length>0&&i.uniformBuffersNames.push(...this._uboList),i.customCode=this._injectCustomCode(i,i.customCode);break}case 8:{const i=t;this._uboDeclaration="",this._vertexDeclaration="",this._fragmentDeclaration="",this._uniformList=[],this._samplerList=[],this._uboList=[];const s=this._material.shaderLanguage===1;for(const r of this._plugins){const a=r.getUniforms(this._material.shaderLanguage);if(a){if(a.ubo)for(const o of a.ubo){if(o.size&&o.type){const l=o.arraySize??0;if(i.ubo.addUniform(o.name,o.size,l),s){let h;switch(o.type){case"mat4":h="mat4x4f";break;case"float":h="f32";break;default:h=`${o.type}f`;break}this._uboDeclaration+=`uniform ${o.name}: ${h}${l>0?`[${l}]`:""};
`}else this._uboDeclaration+=`${o.type} ${o.name}${l>0?`[${l}]`:""};
`}this._uniformList.push(o.name)}a.vertex&&(this._vertexDeclaration+=a.vertex+`
`),a.fragment&&(this._fragmentDeclaration+=a.fragment+`
`)}r.getSamplers(this._samplerList),r.getUniformBuffersNames(this._uboList)}break}}}_collectPointNames(e,t){if(t)for(const i in t)this._codeInjectionPoints[e]||(this._codeInjectionPoints[e]={}),this._codeInjectionPoints[e][i]=!0}_injectCustomCode(e,t){return(i,s)=>{var o,l;t&&(s=t(i,s)),this._uboDeclaration&&(s=s.replace("#define ADDITIONAL_UBO_DECLARATION",this._uboDeclaration)),this._vertexDeclaration&&(s=s.replace("#define ADDITIONAL_VERTEX_DECLARATION",this._vertexDeclaration)),this._fragmentDeclaration&&(s=s.replace("#define ADDITIONAL_FRAGMENT_DECLARATION",this._fragmentDeclaration));const r=(o=this._codeInjectionPoints)==null?void 0:o[i];if(!r)return s;let a=null;for(let h in r){let u="";for(const c of this._activePlugins){let f=(l=c.getCustomCode(i,this._material.shaderLanguage))==null?void 0:l[h];f&&(c.resolveIncludes&&(a===null&&(a={defines:[],indexParameters:e.indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:void 0,supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:ye.GetShadersRepository(0),includesShadersStore:ye.GetIncludesShadersStore(0),version:void 0,platformName:this._engine.shaderPlatformName,processingContext:void 0,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:void 0}),a.isFragment=i==="fragment",zo(f,a,d=>f=d)),u+=f+`
`)}if(u.length>0)if(h.charAt(0)==="!"){h=h.substring(1);let c="g";if(h.charAt(0)==="!")c="",h=h.substring(1);else{const p=GE.exec(h);p&&p.length>=2&&(c=p[1],h=h.substring(c.length+1))}c.indexOf("g")<0&&(c+="g");const f=s,d=new RegExp(h,c);let _=d.exec(f);for(;_!==null;){let p=u;for(let g=0;g<_.length;++g)p=p.replace("$"+g,_[g]);s=s.replace(_[0],p),_=d.exec(f)}}else{const c="#define "+h;s=s.replace(c,`
`+u+`
`+c)}}return s}}}Vn._MaterialPluginClassToMainDefine={};Vn._MaterialPluginCounter=0;Ae.OnEnginesDisposedObservable.add(()=>{WE()});const zE=[];let zg=null;function WE(){zE.length=0,Y.OnEventObservable.remove(zg),zg=null}class Va{isCompatible(e){switch(e){case 0:return!0;default:return!1}}_enable(e){e&&this._pluginManager._activatePlugin(this)}constructor(e,t,i,s,r=!0,a=!1,o=!1){this.priority=500,this.resolveIncludes=!1,this.registerForExtraEvents=!1,this.doNotSerialize=!1,this._material=e,this.name=t,this.priority=i,this.resolveIncludes=o,e.pluginManager||(e.pluginManager=new Vn(e),e.onDisposeObservable.add(()=>{e.pluginManager=void 0})),this._pluginDefineNames=s,this._pluginManager=e.pluginManager,r&&this._pluginManager._addPlugin(this),a&&this._enable(!0),this.markAllDefinesAsDirty=e._dirtyCallbacks[127]}getClassName(){return"MaterialPluginBase"}isReadyForSubMesh(e,t,i,s){return!0}hardBindForSubMesh(e,t,i,s){}bindForSubMesh(e,t,i,s){}dispose(e){}getCustomCode(e,t=0){return null}collectDefines(e){if(this._pluginDefineNames)for(const t of Object.keys(this._pluginDefineNames)){if(t[0]==="_")continue;const i=typeof this._pluginDefineNames[t];e[t]={type:i==="number"?"number":i==="string"?"string":i==="boolean"?"boolean":"object",default:this._pluginDefineNames[t]}}}prepareDefinesBeforeAttributes(e,t,i){}prepareDefines(e,t,i){}hasTexture(e){return!1}hasRenderTargetTextures(){return!1}fillRenderTargetTextures(e){}getActiveTextures(e){}getAnimatables(e){}addFallbacks(e,t,i){return i}getSamplers(e){}getAttributes(e,t,i){}getUniformBuffersNames(e){}getUniforms(e=0){return{}}copyTo(e){Ie.Clone(()=>e,this)}serialize(){return Ie.Serialize(this)}parse(e,t,i){Ie.Parse(()=>this,e,t,i)}}P([B()],Va.prototype,"name",void 0);P([B()],Va.prototype,"priority",void 0);P([B()],Va.prototype,"resolveIncludes",void 0);P([B()],Va.prototype,"registerForExtraEvents",void 0);Tt("BABYLON.MaterialPluginBase",Va);class HE extends Cd{constructor(){super(...arguments),this.DETAIL=!1,this.DETAILDIRECTUV=0,this.DETAIL_NORMALBLENDMETHOD=0}}class kr extends Va{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(e,t=!0){super(e,"DetailMap",140,new HE,t),this._texture=null,this.diffuseBlendLevel=1,this.roughnessBlendLevel=1,this.bumpLevel=1,this._normalBlendMethod=Y.MATERIAL_NORMALBLENDMETHOD_WHITEOUT,this._isEnabled=!1,this.isEnabled=!1,this._internalMarkAllSubMeshesAsTexturesDirty=e._dirtyCallbacks[1]}isReadyForSubMesh(e,t,i){return this._isEnabled?!(e._areTexturesDirty&&t.texturesEnabled&&i.getCaps().standardDerivatives&&this._texture&&Le.DetailTextureEnabled&&!this._texture.isReady()):!0}prepareDefines(e,t){if(this._isEnabled){e.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod;const i=t.getEngine();e._areTexturesDirty&&(i.getCaps().standardDerivatives&&this._texture&&Le.DetailTextureEnabled&&this._isEnabled?(Pn(this._texture,e,"DETAIL"),e.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod):e.DETAIL=!1)}else e.DETAIL=!1}bindForSubMesh(e,t){if(!this._isEnabled)return;const i=this._material.isFrozen;(!e.useUbo||!i||!e.isSync)&&this._texture&&Le.DetailTextureEnabled&&(e.updateFloat4("vDetailInfos",this._texture.coordinatesIndex,this.diffuseBlendLevel,this.bumpLevel,this.roughnessBlendLevel),wn(this._texture,e,"detail")),t.texturesEnabled&&this._texture&&Le.DetailTextureEnabled&&e.setTexture("detailSampler",this._texture)}hasTexture(e){return this._texture===e}getActiveTextures(e){this._texture&&e.push(this._texture)}getAnimatables(e){this._texture&&this._texture.animations&&this._texture.animations.length>0&&e.push(this._texture)}dispose(e){var t;e&&((t=this._texture)==null||t.dispose())}getClassName(){return"DetailMapConfiguration"}getSamplers(e){e.push("detailSampler")}getUniforms(){return{ubo:[{name:"vDetailInfos",size:4,type:"vec4"},{name:"detailMatrix",size:16,type:"mat4"}]}}}P([Zi("detailTexture"),Ze("_markAllSubMeshesAsTexturesDirty")],kr.prototype,"texture",void 0);P([B()],kr.prototype,"diffuseBlendLevel",void 0);P([B()],kr.prototype,"roughnessBlendLevel",void 0);P([B()],kr.prototype,"bumpLevel",void 0);P([B(),Ze("_markAllSubMeshesAsTexturesDirty")],kr.prototype,"normalBlendMethod",void 0);P([B(),Ze("_markAllSubMeshesAsTexturesDirty")],kr.prototype,"isEnabled",void 0);var Wg;(function(n){n[n.Zero=0]="Zero",n[n.One=1]="One",n[n.MaxViewZ=2]="MaxViewZ"})(Wg||(Wg={}));class Ci{static CreateConfiguration(e){return Ci._Configurations[e]={defines:{},previousWorldMatrices:{},previousViewProjection:L.Zero(),currentViewProjection:L.Zero(),previousBones:{},lastUpdateFrameId:-1,excludedSkinnedMesh:[],reverseCulling:!1},Ci._Configurations[e]}static DeleteConfiguration(e){delete Ci._Configurations[e]}static GetConfiguration(e){return Ci._Configurations[e]}static AddUniformsAndSamplers(e,t){e.push("previousWorld","previousViewProjection","mPreviousBones")}static MarkAsDirty(e,t){for(const i of t)if(i.subMeshes)for(const s of i.subMeshes)s._removeDrawWrapper(e)}static PrepareDefines(e,t,i){if(!i._arePrePassDirty)return;const s=Ci._Configurations[e];if(!s)return;i.PREPASS=!0,i.PREPASS_COLOR=!1,i.PREPASS_COLOR_INDEX=-1;let r=0;for(let a=0;a<Ci.GeometryTextureDescriptions.length;a++){const o=Ci.GeometryTextureDescriptions[a],l=o.define,h=o.defineIndex,u=s.defines[h];u!==void 0?(i[l]=!0,i[h]=u,r++):(i[l]=!1,delete i[h])}i.SCENE_MRT_COUNT=r,i.BONES_VELOCITY_ENABLED=t.useBones&&t.computeBonesUsingShaders&&t.skeleton&&!t.skeleton.isUsingTextureForMatrices&&s.excludedSkinnedMesh.indexOf(t)===-1}static Bind(e,t,i,s,r){const a=Ci._Configurations[e];if(!a)return;const o=i.getScene(),l=o.getEngine();if(a.reverseCulling&&l.setStateCullFaceType(o._mirroredCameraPosition?r.cullBackFaces:!r.cullBackFaces),(a.defines.PREPASS_VELOCITY_INDEX!==void 0||a.defines.PREPASS_VELOCITY_LINEAR_INDEX!==void 0)&&(a.previousWorldMatrices[i.uniqueId]||(a.previousWorldMatrices[i.uniqueId]=s.clone()),a.previousViewProjection||(a.previousViewProjection=o.getTransformMatrix().clone(),a.currentViewProjection=o.getTransformMatrix().clone()),a.currentViewProjection.updateFlag!==o.getTransformMatrix().updateFlag?(a.lastUpdateFrameId=l.frameId,a.previousViewProjection.copyFrom(a.currentViewProjection),a.currentViewProjection.copyFrom(o.getTransformMatrix())):a.lastUpdateFrameId!==l.frameId&&(a.lastUpdateFrameId=l.frameId,a.previousViewProjection.copyFrom(a.currentViewProjection)),t.setMatrix("previousWorld",a.previousWorldMatrices[i.uniqueId]),t.setMatrix("previousViewProjection",a.previousViewProjection),a.previousWorldMatrices[i.uniqueId]=s.clone(),i.useBones&&i.computeBonesUsingShaders&&i.skeleton)){const h=i.skeleton;if(!h.isUsingTextureForMatrices||t.getUniformIndex("boneTextureWidth")===-1){const u=h.getTransformMatrices(i);u&&(a.previousBones[i.uniqueId]||(a.previousBones[i.uniqueId]=u.slice()),t.setMatrices("mPreviousBones",a.previousBones[i.uniqueId]),a.previousBones[i.uniqueId].set(u))}}}}Ci.GeometryTextureDescriptions=[{type:0,name:"Irradiance",clearType:0,define:"PREPASS_IRRADIANCE",defineIndex:"PREPASS_IRRADIANCE_INDEX"},{type:1,name:"WorldPosition",clearType:0,define:"PREPASS_POSITION",defineIndex:"PREPASS_POSITION_INDEX"},{type:2,name:"Velocity",clearType:0,define:"PREPASS_VELOCITY",defineIndex:"PREPASS_VELOCITY_INDEX"},{type:3,name:"Reflectivity",clearType:0,define:"PREPASS_REFLECTIVITY",defineIndex:"PREPASS_REFLECTIVITY_INDEX"},{type:5,name:"ViewDepth",clearType:2,define:"PREPASS_DEPTH",defineIndex:"PREPASS_DEPTH_INDEX"},{type:6,name:"ViewNormal",clearType:0,define:"PREPASS_NORMAL",defineIndex:"PREPASS_NORMAL_INDEX"},{type:7,name:"AlbedoSqrt",clearType:0,define:"PREPASS_ALBEDO_SQRT",defineIndex:"PREPASS_ALBEDO_SQRT_INDEX"},{type:8,name:"WorldNormal",clearType:0,define:"PREPASS_WORLD_NORMAL",defineIndex:"PREPASS_WORLD_NORMAL_INDEX"},{type:9,name:"LocalPosition",clearType:0,define:"PREPASS_LOCAL_POSITION",defineIndex:"PREPASS_LOCAL_POSITION_INDEX"},{type:10,name:"ScreenDepth",clearType:1,define:"PREPASS_SCREENSPACE_DEPTH",defineIndex:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:11,name:"LinearVelocity",clearType:0,define:"PREPASS_VELOCITY_LINEAR",defineIndex:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:12,name:"Albedo",clearType:0,define:"PREPASS_ALBEDO",defineIndex:"PREPASS_ALBEDO_INDEX"}];Ci._Configurations={};const Eu={effect:null,subMesh:null};class KE extends Cd{constructor(e){super(e),this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.DIFFUSE=!1,this.DIFFUSEDIRECTUV=0,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.OPACITY=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.REFLECTION=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.SPECULAR=!1,this.SPECULARDIRECTUV=0,this.BUMP=!1,this.BUMPDIRECTUV=0,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.SPECULAROVERALPHA=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHAFROMDIFFUSE=!1,this.POINTSIZE=!1,this.FOG=!1,this.SPECULARTERM=!1,this.DIFFUSEFRESNEL=!1,this.OPACITYFRESNEL=!1,this.REFLECTIONFRESNEL=!1,this.REFRACTIONFRESNEL=!1,this.EMISSIVEFRESNEL=!1,this.FRESNEL=!1,this.NORMAL=!1,this.TANGENT=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.GLOSSINESS=!1,this.ROUGHNESS=!1,this.EMISSIVEASILLUMINATION=!1,this.LINKEMISSIVEWITHDIFFUSE=!1,this.REFLECTIONFRESNELFROMSPECULAR=!1,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.USELIGHTMAPASSHADOWMAP=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.INVERTCUBICMAP=!1,this.LOGARITHMICDEPTH=!1,this.REFRACTION=!1,this.REFRACTIONMAP_3D=!1,this.REFLECTIONOVERALPHA=!1,this.TWOSIDEDLIGHTING=!1,this.SHADOWFLOAT=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_POSITION=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.MORPHTARGETS_UV2=!1,this.MORPHTARGETS_COLOR=!1,this.MORPHTARGETTEXTURE_HASPOSITIONS=!1,this.MORPHTARGETTEXTURE_HASNORMALS=!1,this.MORPHTARGETTEXTURE_HASTANGENTS=!1,this.MORPHTARGETTEXTURE_HASUVS=!1,this.MORPHTARGETTEXTURE_HASUV2S=!1,this.MORPHTARGETTEXTURE_HASCOLORS=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.NONUNIFORMSCALING=!1,this.PREMULTIPLYALPHA=!1,this.ALPHATEST_AFTERALLALPHACOMPUTATIONS=!1,this.ALPHABLEND=!0,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.RGBDLIGHTMAP=!1,this.RGBDREFLECTION=!1,this.RGBDREFRACTION=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.AREALIGHTSUPPORTED=!0,this.IS_REFLECTION_LINEAR=!1,this.IS_REFRACTION_LINEAR=!1,this.EXPOSURE=!1,this.DECAL_AFTER_DETAIL=!1,this.rebuild()}setReflectionMode(e){const t=["REFLECTIONMAP_CUBIC","REFLECTIONMAP_EXPLICIT","REFLECTIONMAP_PLANAR","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_SKYBOX","REFLECTIONMAP_SPHERICAL","REFLECTIONMAP_EQUIRECTANGULAR","REFLECTIONMAP_EQUIRECTANGULAR_FIXED","REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED"];for(const i of t)this[i]=i===e}}class ee extends Md{get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(e){this._attachImageProcessingConfiguration(e),this._markAllSubMeshesAsTexturesDirty()}_attachImageProcessingConfiguration(e){e!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),e?this._imageProcessingConfiguration=e:this._imageProcessingConfiguration=this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add(()=>{this._markAllSubMeshesAsImageProcessingDirty()})))}get isPrePassCapable(){return!this.disableDepthWrite}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(e){this.imageProcessingConfiguration.colorCurvesEnabled=e}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(e){this.imageProcessingConfiguration.colorGradingEnabled=e}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(e){this._imageProcessingConfiguration.toneMappingEnabled=e}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(e){this._imageProcessingConfiguration.exposure=e}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(e){this._imageProcessingConfiguration.contrast=e}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(e){this._imageProcessingConfiguration.colorGradingTexture=e}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(e){this._imageProcessingConfiguration.colorCurves=e}get canRenderToMRT(){return!0}constructor(e,t,i=!1){super(e,t,void 0,i||ee.ForceGLSL),this._diffuseTexture=null,this._ambientTexture=null,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._specularTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._refractionTexture=null,this.ambientColor=new fe(0,0,0),this.diffuseColor=new fe(1,1,1),this.specularColor=new fe(1,1,1),this.emissiveColor=new fe(0,0,0),this.specularPower=64,this._useAlphaFromDiffuseTexture=!1,this._useEmissiveAsIllumination=!1,this._linkEmissiveWithDiffuse=!1,this._useSpecularOverAlpha=!1,this._useReflectionOverAlpha=!1,this._disableLighting=!1,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this._roughness=0,this.indexOfRefraction=.98,this.invertRefractionY=!0,this.alphaCutOff=.4,this._useLightmapAsShadowmap=!1,this._useReflectionFresnelFromSpecular=!1,this._useGlossinessFromSpecularMapAlpha=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._applyDecalMapAfterDetailMap=!1,this._shadersLoaded=!1,this._renderTargets=new ti(16),this._globalAmbientColor=new fe(0,0,0),this._cacheHasRenderTargetTextures=!1,this.detailMap=new kr(this),this._attachImageProcessingConfiguration(null),this.prePassConfiguration=new Gg,this.getRenderTargetTextures=()=>(this._renderTargets.reset(),ee.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),ee.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&this._renderTargets.push(this._refractionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets)}get hasRenderTargetTextures(){return ee.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget||ee.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget?!0:this._cacheHasRenderTargetTextures}getClassName(){return"StandardMaterial"}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:this._disableAlphaBlending?!1:this.alpha<1||this._opacityTexture!=null||this._shouldUseAlphaFromDiffuseTexture()||this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled}needAlphaTesting(){return this._hasTransparencyMode?this._transparencyModeIsTest:this._hasAlphaChannel()&&(this._transparencyMode==null||this._transparencyMode===Y.MATERIAL_ALPHATEST)}_shouldUseAlphaFromDiffuseTexture(){return this._diffuseTexture!=null&&this._diffuseTexture.hasAlpha&&this._useAlphaFromDiffuseTexture&&this._transparencyMode!==Y.MATERIAL_OPAQUE}_hasAlphaChannel(){return this._diffuseTexture!=null&&this._diffuseTexture.hasAlpha||this._opacityTexture!=null}getAlphaTestTexture(){return this._diffuseTexture}isReadyForSubMesh(e,t,i=!1){this._uniformBufferLayoutBuilt||this.buildUniformLayout();const s=t._drawWrapper;if(s.effect&&this.isFrozen&&s._wasPreviouslyReady&&s._wasPreviouslyUsingInstances===i)return!0;t.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),t.materialDefines=new KE(this._eventInfo.defineNames));const r=this.getScene(),a=t.materialDefines;if(this._isReadyForSubMesh(t))return!0;const o=r.getEngine();a._needNormals=fE(r,e,a,!0,this._maxSimultaneousLights,this._disableLighting),mE(r,a);const l=this.needAlphaBlendingForMesh(e)&&this.getScene().useOrderIndependentTransparency;if(yE(r,a,this.canRenderToMRT&&!l),vE(r,a,l),Ci.PrepareDefines(o.currentRenderPassId,e,a),a._areTexturesDirty){this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,a._needUVs=!1;for(let u=1;u<=6;++u)a["MAINUV"+u]=!1;if(r.texturesEnabled){if(a.DIFFUSEDIRECTUV=0,a.BUMPDIRECTUV=0,a.AMBIENTDIRECTUV=0,a.OPACITYDIRECTUV=0,a.EMISSIVEDIRECTUV=0,a.SPECULARDIRECTUV=0,a.LIGHTMAPDIRECTUV=0,this._diffuseTexture&&ee.DiffuseTextureEnabled)if(this._diffuseTexture.isReadyOrNotBlocking())Pn(this._diffuseTexture,a,"DIFFUSE");else return!1;else a.DIFFUSE=!1;if(this._ambientTexture&&ee.AmbientTextureEnabled)if(this._ambientTexture.isReadyOrNotBlocking())Pn(this._ambientTexture,a,"AMBIENT");else return!1;else a.AMBIENT=!1;if(this._opacityTexture&&ee.OpacityTextureEnabled)if(this._opacityTexture.isReadyOrNotBlocking())Pn(this._opacityTexture,a,"OPACITY"),a.OPACITYRGB=this._opacityTexture.getAlphaFromRGB;else return!1;else a.OPACITY=!1;if(this._reflectionTexture&&ee.ReflectionTextureEnabled)if(this._reflectionTexture.isReadyOrNotBlocking()){switch(a._needNormals=!0,a.REFLECTION=!0,a.ROUGHNESS=this._roughness>0,a.REFLECTIONOVERALPHA=this._useReflectionOverAlpha,a.INVERTCUBICMAP=this._reflectionTexture.coordinatesMode===ie.INVCUBIC_MODE,a.REFLECTIONMAP_3D=this._reflectionTexture.isCube,a.REFLECTIONMAP_OPPOSITEZ=a.REFLECTIONMAP_3D&&this.getScene().useRightHandedSystem?!this._reflectionTexture.invertZ:this._reflectionTexture.invertZ,a.RGBDREFLECTION=this._reflectionTexture.isRGBD,this._reflectionTexture.coordinatesMode){case ie.EXPLICIT_MODE:a.setReflectionMode("REFLECTIONMAP_EXPLICIT");break;case ie.PLANAR_MODE:a.setReflectionMode("REFLECTIONMAP_PLANAR");break;case ie.PROJECTION_MODE:a.setReflectionMode("REFLECTIONMAP_PROJECTION");break;case ie.SKYBOX_MODE:a.setReflectionMode("REFLECTIONMAP_SKYBOX");break;case ie.SPHERICAL_MODE:a.setReflectionMode("REFLECTIONMAP_SPHERICAL");break;case ie.EQUIRECTANGULAR_MODE:a.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR");break;case ie.FIXED_EQUIRECTANGULAR_MODE:a.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR_FIXED");break;case ie.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:a.setReflectionMode("REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED");break;case ie.CUBIC_MODE:case ie.INVCUBIC_MODE:default:a.setReflectionMode("REFLECTIONMAP_CUBIC");break}a.USE_LOCAL_REFLECTIONMAP_CUBIC=!!this._reflectionTexture.boundingBoxSize}else return!1;else a.REFLECTION=!1,a.REFLECTIONMAP_OPPOSITEZ=!1;if(this._emissiveTexture&&ee.EmissiveTextureEnabled)if(this._emissiveTexture.isReadyOrNotBlocking())Pn(this._emissiveTexture,a,"EMISSIVE");else return!1;else a.EMISSIVE=!1;if(this._lightmapTexture&&ee.LightmapTextureEnabled)if(this._lightmapTexture.isReadyOrNotBlocking())Pn(this._lightmapTexture,a,"LIGHTMAP"),a.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,a.RGBDLIGHTMAP=this._lightmapTexture.isRGBD;else return!1;else a.LIGHTMAP=!1;if(this._specularTexture&&ee.SpecularTextureEnabled)if(this._specularTexture.isReadyOrNotBlocking())Pn(this._specularTexture,a,"SPECULAR"),a.GLOSSINESS=this._useGlossinessFromSpecularMapAlpha;else return!1;else a.SPECULAR=!1;if(r.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&ee.BumpTextureEnabled){if(this._bumpTexture.isReady())Pn(this._bumpTexture,a,"BUMP"),a.PARALLAX=this._useParallax,a.PARALLAX_RHS=r.useRightHandedSystem,a.PARALLAXOCCLUSION=this._useParallaxOcclusion;else return!1;a.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap}else a.BUMP=!1,a.PARALLAX=!1,a.PARALLAX_RHS=!1,a.PARALLAXOCCLUSION=!1;if(this._refractionTexture&&ee.RefractionTextureEnabled)if(this._refractionTexture.isReadyOrNotBlocking())a._needUVs=!0,a.REFRACTION=!0,a.REFRACTIONMAP_3D=this._refractionTexture.isCube,a.RGBDREFRACTION=this._refractionTexture.isRGBD,a.USE_LOCAL_REFRACTIONMAP_CUBIC=!!this._refractionTexture.boundingBoxSize;else return!1;else a.REFRACTION=!1;a.TWOSIDEDLIGHTING=!this._backFaceCulling&&this._twoSidedLighting}else a.DIFFUSE=!1,a.AMBIENT=!1,a.OPACITY=!1,a.REFLECTION=!1,a.EMISSIVE=!1,a.LIGHTMAP=!1,a.BUMP=!1,a.REFRACTION=!1;a.ALPHAFROMDIFFUSE=this._shouldUseAlphaFromDiffuseTexture(),a.EMISSIVEASILLUMINATION=this._useEmissiveAsIllumination,a.LINKEMISSIVEWITHDIFFUSE=this._linkEmissiveWithDiffuse,a.SPECULAROVERALPHA=this._useSpecularOverAlpha,a.PREMULTIPLYALPHA=this.alphaMode===7||this.alphaMode===8,a.ALPHATEST_AFTERALLALPHACOMPUTATIONS=this.transparencyMode!==null,a.ALPHABLEND=this.transparencyMode===null||this.needAlphaBlendingForMesh(e)}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=a,this._eventInfo.subMesh=t,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(a._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(a),a.IS_REFLECTION_LINEAR=this.reflectionTexture!=null&&!this.reflectionTexture.gammaSpace,a.IS_REFRACTION_LINEAR=this.refractionTexture!=null&&!this.refractionTexture.gammaSpace}if(a._areFresnelDirty&&(ee.FresnelEnabled?(this._diffuseFresnelParameters||this._opacityFresnelParameters||this._emissiveFresnelParameters||this._refractionFresnelParameters||this._reflectionFresnelParameters)&&(a.DIFFUSEFRESNEL=this._diffuseFresnelParameters&&this._diffuseFresnelParameters.isEnabled,a.OPACITYFRESNEL=this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled,a.REFLECTIONFRESNEL=this._reflectionFresnelParameters&&this._reflectionFresnelParameters.isEnabled,a.REFLECTIONFRESNELFROMSPECULAR=this._useReflectionFresnelFromSpecular,a.REFRACTIONFRESNEL=this._refractionFresnelParameters&&this._refractionFresnelParameters.isEnabled,a.EMISSIVEFRESNEL=this._emissiveFresnelParameters&&this._emissiveFresnelParameters.isEnabled,a._needNormals=!0,a.FRESNEL=!0):a.FRESNEL=!1),a.AREALIGHTUSED){for(let u=0;u<e.lightSources.length;u++)if(!e.lightSources[u]._isReady())return!1}Zv(e,r,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this.needAlphaTestingForMesh(e),a,this._applyDecalMapAfterDetailMap),Qv(r,o,this,a,i,null,t.getRenderingMesh().hasThinInstances),this._eventInfo.defines=a,this._eventInfo.mesh=e,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),Jv(e,a,!0,!0,!0),this._callbackPluginEventPrepareDefines(this._eventInfo);let h=!1;if(a.isDirty){const u=a._areLightsDisposed;a.markAsProcessed();const c=new Pd;a.REFLECTION&&c.addFallback(0,"REFLECTION"),a.SPECULAR&&c.addFallback(0,"SPECULAR"),a.BUMP&&c.addFallback(0,"BUMP"),a.PARALLAX&&c.addFallback(1,"PARALLAX"),a.PARALLAX_RHS&&c.addFallback(1,"PARALLAX_RHS"),a.PARALLAXOCCLUSION&&c.addFallback(0,"PARALLAXOCCLUSION"),a.SPECULAROVERALPHA&&c.addFallback(0,"SPECULAROVERALPHA"),a.FOG&&c.addFallback(1,"FOG"),a.POINTSIZE&&c.addFallback(0,"POINTSIZE"),a.LOGARITHMICDEPTH&&c.addFallback(0,"LOGARITHMICDEPTH"),uE(a,c,this._maxSimultaneousLights),a.SPECULARTERM&&c.addFallback(0,"SPECULARTERM"),a.DIFFUSEFRESNEL&&c.addFallback(1,"DIFFUSEFRESNEL"),a.OPACITYFRESNEL&&c.addFallback(2,"OPACITYFRESNEL"),a.REFLECTIONFRESNEL&&c.addFallback(3,"REFLECTIONFRESNEL"),a.EMISSIVEFRESNEL&&c.addFallback(4,"EMISSIVEFRESNEL"),a.FRESNEL&&c.addFallback(4,"FRESNEL"),a.MULTIVIEW&&c.addFallback(0,"MULTIVIEW");const f=[S.PositionKind];a.NORMAL&&f.push(S.NormalKind),a.TANGENT&&f.push(S.TangentKind);for(let x=1;x<=6;++x)a["UV"+x]&&f.push(`uv${x===1?"":x}`);a.VERTEXCOLOR&&f.push(S.ColorKind),hE(f,e,a,c),$v(f,a),Xv(f,e,a),jv(f,e,a);let d="default";const _=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vDiffuseColor","vSpecularColor","vEmissiveColor","visibility","vFogInfos","vFogColor","pointSize","vDiffuseInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vEmissiveInfos","vSpecularInfos","vBumpInfos","vLightmapInfos","vRefractionInfos","mBones","diffuseMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","specularMatrix","bumpMatrix","normalMatrix","lightmapMatrix","refractionMatrix","diffuseLeftColor","diffuseRightColor","opacityParts","reflectionLeftColor","reflectionRightColor","emissiveLeftColor","emissiveRightColor","refractionLeftColor","refractionRightColor","vReflectionPosition","vReflectionSize","vRefractionPosition","vRefractionSize","logarithmicDepthConstant","vTangentSpaceParams","alphaCutOff","boneTextureWidth","morphTargetTextureInfo","morphTargetTextureIndices"],p=["diffuseSampler","ambientSampler","opacitySampler","reflectionCubeSampler","reflection2DSampler","emissiveSampler","specularSampler","bumpSampler","lightmapSampler","refractionCubeSampler","refraction2DSampler","boneSampler","morphTargets","oitDepthSampler","oitFrontColorSampler","areaLightsLTC1Sampler","areaLightsLTC2Sampler"],g=["Material","Scene","Mesh"],m={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:a.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=c,this._eventInfo.fallbackRank=0,this._eventInfo.defines=a,this._eventInfo.uniforms=_,this._eventInfo.attributes=f,this._eventInfo.samplers=p,this._eventInfo.uniformBuffersNames=g,this._eventInfo.customCode=void 0,this._eventInfo.mesh=e,this._eventInfo.indexParameters=m,this._callbackPluginEventGeneric(128,this._eventInfo),Ci.AddUniformsAndSamplers(_,p),Gg.AddUniforms(_),ke&&(ke.PrepareUniforms(_,a),ke.PrepareSamplers(p,a)),TE({uniformsNames:_,uniformBuffersNames:g,samplers:p,defines:a,maxSimultaneousLights:this._maxSimultaneousLights}),Ah(_);const v={};this.customShaderNameResolve&&(d=this.customShaderNameResolve(d,_,g,p,a,f,v));const T=a.toString(),A=t.effect;let b=r.getEngine().createEffect(d,{attributes:f,uniformsNames:_,uniformBuffersNames:g,samplers:p,defines:T,fallbacks:c,onCompiled:this.onCompiled,onError:this.onError,indexParameters:m,processFinalCode:v.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:a.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{this._shaderLanguage===1?await Promise.all([De(()=>import("./default.vertex-B1XsCRxi.js"),__vite__mapDeps([4,5,6,7,8,9,10,11])),De(()=>import("./default.fragment-DUQEnaKN.js"),__vite__mapDeps([12,5,13,10,14,15]))]):await Promise.all([De(()=>import("./default.vertex-P1fku4YL.js"),__vite__mapDeps([16,17,18,19,20,21,22])),De(()=>import("./default.fragment-CDqUmta-.js"),__vite__mapDeps([23,17,18,19]))]),this._shadersLoaded=!0}},o);if(this._eventInfo.customCode=void 0,b)if(this._onEffectCreatedObservable&&(Eu.effect=b,Eu.subMesh=t,this._onEffectCreatedObservable.notifyObservers(Eu)),this.allowShaderHotSwapping&&A&&!b.isReady()){if(b=A,a.markAsUnprocessed(),h=this.isFrozen,u)return a._areLightsDisposed=!0,!1}else r.resetCachedMaterial(),t.setEffect(b,a,this._materialContext)}return!t.effect||!t.effect.isReady()?!1:(a._renderId=r.getRenderId(),s._wasPreviouslyReady=!h,s._wasPreviouslyUsingInstances=i,this._checkScenePerformancePriority(),!0)}buildUniformLayout(){const e=this._uniformBuffer;e.addUniform("diffuseLeftColor",4),e.addUniform("diffuseRightColor",4),e.addUniform("opacityParts",4),e.addUniform("reflectionLeftColor",4),e.addUniform("reflectionRightColor",4),e.addUniform("refractionLeftColor",4),e.addUniform("refractionRightColor",4),e.addUniform("emissiveLeftColor",4),e.addUniform("emissiveRightColor",4),e.addUniform("vDiffuseInfos",2),e.addUniform("vAmbientInfos",2),e.addUniform("vOpacityInfos",2),e.addUniform("vReflectionInfos",2),e.addUniform("vReflectionPosition",3),e.addUniform("vReflectionSize",3),e.addUniform("vEmissiveInfos",2),e.addUniform("vLightmapInfos",2),e.addUniform("vSpecularInfos",2),e.addUniform("vBumpInfos",3),e.addUniform("diffuseMatrix",16),e.addUniform("ambientMatrix",16),e.addUniform("opacityMatrix",16),e.addUniform("reflectionMatrix",16),e.addUniform("emissiveMatrix",16),e.addUniform("lightmapMatrix",16),e.addUniform("specularMatrix",16),e.addUniform("bumpMatrix",16),e.addUniform("vTangentSpaceParams",2),e.addUniform("pointSize",1),e.addUniform("alphaCutOff",1),e.addUniform("refractionMatrix",16),e.addUniform("vRefractionInfos",4),e.addUniform("vRefractionPosition",3),e.addUniform("vRefractionSize",3),e.addUniform("vSpecularColor",4),e.addUniform("vEmissiveColor",3),e.addUniform("vDiffuseColor",4),e.addUniform("vAmbientColor",3),super.buildUniformLayout()}bindForSubMesh(e,t,i){var h;const s=this.getScene(),r=i.materialDefines;if(!r)return;const a=i.effect;if(!a)return;this._activeEffect=a,t.getMeshUniformBuffer().bindToEffect(a,"Mesh"),t.transferToEffect(e),this._uniformBuffer.bindToEffect(a,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,s,t,e,this.isFrozen),Ci.Bind(s.getEngine().currentRenderPassId,this._activeEffect,t,e,this),this._eventInfo.subMesh=i,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),r.OBJECTSPACE_NORMALMAP&&(e.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const o=this._mustRebind(s,a,i,t.visibility);qv(t,a);const l=this._uniformBuffer;if(o){if(this.bindViewProjection(a),!l.useUbo||!this.isFrozen||!l.isSync||i._drawWrapper._forceRebindOnNextCall){if(ee.FresnelEnabled&&r.FRESNEL&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(l.updateColor4("diffuseLeftColor",this.diffuseFresnelParameters.leftColor,this.diffuseFresnelParameters.power),l.updateColor4("diffuseRightColor",this.diffuseFresnelParameters.rightColor,this.diffuseFresnelParameters.bias)),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&l.updateColor4("opacityParts",new fe(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(l.updateColor4("reflectionLeftColor",this.reflectionFresnelParameters.leftColor,this.reflectionFresnelParameters.power),l.updateColor4("reflectionRightColor",this.reflectionFresnelParameters.rightColor,this.reflectionFresnelParameters.bias)),this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled&&(l.updateColor4("refractionLeftColor",this.refractionFresnelParameters.leftColor,this.refractionFresnelParameters.power),l.updateColor4("refractionRightColor",this.refractionFresnelParameters.rightColor,this.refractionFresnelParameters.bias)),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(l.updateColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),l.updateColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias))),s.texturesEnabled){if(this._diffuseTexture&&ee.DiffuseTextureEnabled&&(l.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),wn(this._diffuseTexture,l,"diffuse")),this._ambientTexture&&ee.AmbientTextureEnabled&&(l.updateFloat2("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level),wn(this._ambientTexture,l,"ambient")),this._opacityTexture&&ee.OpacityTextureEnabled&&(l.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),wn(this._opacityTexture,l,"opacity")),this._hasAlphaChannel()&&l.updateFloat("alphaCutOff",this.alphaCutOff),this._reflectionTexture&&ee.ReflectionTextureEnabled){if(l.updateFloat2("vReflectionInfos",this._reflectionTexture.level,this.roughness),l.updateMatrix("reflectionMatrix",this._reflectionTexture.getReflectionTextureMatrix()),this._reflectionTexture.boundingBoxSize){const u=this._reflectionTexture;l.updateVector3("vReflectionPosition",u.boundingBoxPosition),l.updateVector3("vReflectionSize",u.boundingBoxSize)}}else l.updateFloat2("vReflectionInfos",0,this.roughness);if(this._emissiveTexture&&ee.EmissiveTextureEnabled&&(l.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),wn(this._emissiveTexture,l,"emissive")),this._lightmapTexture&&ee.LightmapTextureEnabled&&(l.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),wn(this._lightmapTexture,l,"lightmap")),this._specularTexture&&ee.SpecularTextureEnabled&&(l.updateFloat2("vSpecularInfos",this._specularTexture.coordinatesIndex,this._specularTexture.level),wn(this._specularTexture,l,"specular")),this._bumpTexture&&s.getEngine().getCaps().standardDerivatives&&ee.BumpTextureEnabled&&(l.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,1/this._bumpTexture.level,this.parallaxScaleBias),wn(this._bumpTexture,l,"bump"),s._mirroredCameraPosition?l.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):l.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1)),this._refractionTexture&&ee.RefractionTextureEnabled){let u=1;if(this._refractionTexture.isCube||(l.updateMatrix("refractionMatrix",this._refractionTexture.getReflectionTextureMatrix()),this._refractionTexture.depth&&(u=this._refractionTexture.depth)),l.updateFloat4("vRefractionInfos",this._refractionTexture.level,this.indexOfRefraction,u,this.invertRefractionY?-1:1),this._refractionTexture.boundingBoxSize){const c=this._refractionTexture;l.updateVector3("vRefractionPosition",c.boundingBoxPosition),l.updateVector3("vRefractionSize",c.boundingBoxSize)}}}this.pointsCloud&&l.updateFloat("pointSize",this.pointSize),l.updateColor4("vSpecularColor",this.specularColor,this.specularPower),l.updateColor3("vEmissiveColor",ee.EmissiveTextureEnabled?this.emissiveColor:fe.BlackReadOnly),l.updateColor4("vDiffuseColor",this.diffuseColor,this.alpha),s.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor),l.updateColor3("vAmbientColor",this._globalAmbientColor)}s.texturesEnabled&&(this._diffuseTexture&&ee.DiffuseTextureEnabled&&a.setTexture("diffuseSampler",this._diffuseTexture),this._ambientTexture&&ee.AmbientTextureEnabled&&a.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&ee.OpacityTextureEnabled&&a.setTexture("opacitySampler",this._opacityTexture),this._reflectionTexture&&ee.ReflectionTextureEnabled&&(this._reflectionTexture.isCube?a.setTexture("reflectionCubeSampler",this._reflectionTexture):a.setTexture("reflection2DSampler",this._reflectionTexture)),this._emissiveTexture&&ee.EmissiveTextureEnabled&&a.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&ee.LightmapTextureEnabled&&a.setTexture("lightmapSampler",this._lightmapTexture),this._specularTexture&&ee.SpecularTextureEnabled&&a.setTexture("specularSampler",this._specularTexture),this._bumpTexture&&s.getEngine().getCaps().standardDerivatives&&ee.BumpTextureEnabled&&a.setTexture("bumpSampler",this._bumpTexture),this._refractionTexture&&ee.RefractionTextureEnabled&&(this._refractionTexture.isCube?a.setTexture("refractionCubeSampler",this._refractionTexture):a.setTexture("refraction2DSampler",this._refractionTexture))),this.getScene().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(t)&&this.getScene().depthPeelingRenderer.bind(a),this._eventInfo.subMesh=i,this._callbackPluginEventBindForSubMesh(this._eventInfo),Eh(a,this,s),this.bindEyePosition(a)}else s.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);(o||!this.isFrozen)&&(s.lightsEnabled&&!this._disableLighting&&lE(s,t,a,r,this._maxSimultaneousLights),(s.fogEnabled&&t.applyFog&&s.fogMode!==Je.FOGMODE_NONE||this._reflectionTexture||this._refractionTexture||t.receiveShadows||r.PREPASS)&&this.bindView(a),Sd(s,t,a),r.NUM_MORPH_INFLUENCERS&&Id(t,a),r.BAKED_VERTEX_ANIMATION_TEXTURE&&((h=t.bakedVertexAnimationManager)==null||h.bind(a,r.INSTANCES)),this.useLogarithmicDepth&&Ed(r,a,s),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(this._activeEffect)),this._afterBind(t,this._activeEffect,i),l.update()}getAnimatables(){const e=super.getAnimatables();return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&e.push(this._diffuseTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&e.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&e.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&e.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&e.push(this._emissiveTexture),this._specularTexture&&this._specularTexture.animations&&this._specularTexture.animations.length>0&&e.push(this._specularTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&e.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&e.push(this._lightmapTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&e.push(this._refractionTexture),e}getActiveTextures(){const e=super.getActiveTextures();return this._diffuseTexture&&e.push(this._diffuseTexture),this._ambientTexture&&e.push(this._ambientTexture),this._opacityTexture&&e.push(this._opacityTexture),this._reflectionTexture&&e.push(this._reflectionTexture),this._emissiveTexture&&e.push(this._emissiveTexture),this._specularTexture&&e.push(this._specularTexture),this._bumpTexture&&e.push(this._bumpTexture),this._lightmapTexture&&e.push(this._lightmapTexture),this._refractionTexture&&e.push(this._refractionTexture),e}hasTexture(e){return!!(super.hasTexture(e)||this._diffuseTexture===e||this._ambientTexture===e||this._opacityTexture===e||this._reflectionTexture===e||this._emissiveTexture===e||this._specularTexture===e||this._bumpTexture===e||this._lightmapTexture===e||this._refractionTexture===e)}dispose(e,t){var i,s,r,a,o,l,h,u,c;t&&((i=this._diffuseTexture)==null||i.dispose(),(s=this._ambientTexture)==null||s.dispose(),(r=this._opacityTexture)==null||r.dispose(),(a=this._reflectionTexture)==null||a.dispose(),(o=this._emissiveTexture)==null||o.dispose(),(l=this._specularTexture)==null||l.dispose(),(h=this._bumpTexture)==null||h.dispose(),(u=this._lightmapTexture)==null||u.dispose(),(c=this._refractionTexture)==null||c.dispose()),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(e,t)}clone(e,t=!0,i=""){const s=Ie.Clone(()=>new ee(e,this.getScene()),this,{cloneTexturesOnlyOnce:t});return s.name=e,s.id=e,this.stencil.copyTo(s.stencil),this._clonePlugins(s,i),s}static Parse(e,t,i){const s=Ie.Parse(()=>new ee(e.name,t),e,t,i);return e.stencil&&s.stencil.parse(e.stencil,t,i),Y._ParsePlugins(e,s,t,i),s}static get DiffuseTextureEnabled(){return Le.DiffuseTextureEnabled}static set DiffuseTextureEnabled(e){Le.DiffuseTextureEnabled=e}static get DetailTextureEnabled(){return Le.DetailTextureEnabled}static set DetailTextureEnabled(e){Le.DetailTextureEnabled=e}static get AmbientTextureEnabled(){return Le.AmbientTextureEnabled}static set AmbientTextureEnabled(e){Le.AmbientTextureEnabled=e}static get OpacityTextureEnabled(){return Le.OpacityTextureEnabled}static set OpacityTextureEnabled(e){Le.OpacityTextureEnabled=e}static get ReflectionTextureEnabled(){return Le.ReflectionTextureEnabled}static set ReflectionTextureEnabled(e){Le.ReflectionTextureEnabled=e}static get EmissiveTextureEnabled(){return Le.EmissiveTextureEnabled}static set EmissiveTextureEnabled(e){Le.EmissiveTextureEnabled=e}static get SpecularTextureEnabled(){return Le.SpecularTextureEnabled}static set SpecularTextureEnabled(e){Le.SpecularTextureEnabled=e}static get BumpTextureEnabled(){return Le.BumpTextureEnabled}static set BumpTextureEnabled(e){Le.BumpTextureEnabled=e}static get LightmapTextureEnabled(){return Le.LightmapTextureEnabled}static set LightmapTextureEnabled(e){Le.LightmapTextureEnabled=e}static get RefractionTextureEnabled(){return Le.RefractionTextureEnabled}static set RefractionTextureEnabled(e){Le.RefractionTextureEnabled=e}static get ColorGradingTextureEnabled(){return Le.ColorGradingTextureEnabled}static set ColorGradingTextureEnabled(e){Le.ColorGradingTextureEnabled=e}static get FresnelEnabled(){return Le.FresnelEnabled}static set FresnelEnabled(e){Le.FresnelEnabled=e}}ee.ForceGLSL=!1;P([Zi("diffuseTexture")],ee.prototype,"_diffuseTexture",void 0);P([Ze("_markAllSubMeshesAsTexturesAndMiscDirty")],ee.prototype,"diffuseTexture",void 0);P([Zi("ambientTexture")],ee.prototype,"_ambientTexture",void 0);P([Ze("_markAllSubMeshesAsTexturesDirty")],ee.prototype,"ambientTexture",void 0);P([Zi("opacityTexture")],ee.prototype,"_opacityTexture",void 0);P([Ze("_markAllSubMeshesAsTexturesAndMiscDirty")],ee.prototype,"opacityTexture",void 0);P([Zi("reflectionTexture")],ee.prototype,"_reflectionTexture",void 0);P([Ze("_markAllSubMeshesAsTexturesDirty")],ee.prototype,"reflectionTexture",void 0);P([Zi("emissiveTexture")],ee.prototype,"_emissiveTexture",void 0);P([Ze("_markAllSubMeshesAsTexturesDirty")],ee.prototype,"emissiveTexture",void 0);P([Zi("specularTexture")],ee.prototype,"_specularTexture",void 0);P([Ze("_markAllSubMeshesAsTexturesDirty")],ee.prototype,"specularTexture",void 0);P([Zi("bumpTexture")],ee.prototype,"_bumpTexture",void 0);P([Ze("_markAllSubMeshesAsTexturesDirty")],ee.prototype,"bumpTexture",void 0);P([Zi("lightmapTexture")],ee.prototype,"_lightmapTexture",void 0);P([Ze("_markAllSubMeshesAsTexturesDirty")],ee.prototype,"lightmapTexture",void 0);P([Zi("refractionTexture")],ee.prototype,"_refractionTexture",void 0);P([Ze("_markAllSubMeshesAsTexturesDirty")],ee.prototype,"refractionTexture",void 0);P([En("ambient")],ee.prototype,"ambientColor",void 0);P([En("diffuse")],ee.prototype,"diffuseColor",void 0);P([En("specular")],ee.prototype,"specularColor",void 0);P([En("emissive")],ee.prototype,"emissiveColor",void 0);P([B()],ee.prototype,"specularPower",void 0);P([B("useAlphaFromDiffuseTexture")],ee.prototype,"_useAlphaFromDiffuseTexture",void 0);P([Ze("_markAllSubMeshesAsTexturesAndMiscDirty")],ee.prototype,"useAlphaFromDiffuseTexture",void 0);P([B("useEmissiveAsIllumination")],ee.prototype,"_useEmissiveAsIllumination",void 0);P([Ze("_markAllSubMeshesAsTexturesDirty")],ee.prototype,"useEmissiveAsIllumination",void 0);P([B("linkEmissiveWithDiffuse")],ee.prototype,"_linkEmissiveWithDiffuse",void 0);P([Ze("_markAllSubMeshesAsTexturesDirty")],ee.prototype,"linkEmissiveWithDiffuse",void 0);P([B("useSpecularOverAlpha")],ee.prototype,"_useSpecularOverAlpha",void 0);P([Ze("_markAllSubMeshesAsTexturesDirty")],ee.prototype,"useSpecularOverAlpha",void 0);P([B("useReflectionOverAlpha")],ee.prototype,"_useReflectionOverAlpha",void 0);P([Ze("_markAllSubMeshesAsTexturesDirty")],ee.prototype,"useReflectionOverAlpha",void 0);P([B("disableLighting")],ee.prototype,"_disableLighting",void 0);P([Ze("_markAllSubMeshesAsLightsDirty")],ee.prototype,"disableLighting",void 0);P([B("useObjectSpaceNormalMap")],ee.prototype,"_useObjectSpaceNormalMap",void 0);P([Ze("_markAllSubMeshesAsTexturesDirty")],ee.prototype,"useObjectSpaceNormalMap",void 0);P([B("useParallax")],ee.prototype,"_useParallax",void 0);P([Ze("_markAllSubMeshesAsTexturesDirty")],ee.prototype,"useParallax",void 0);P([B("useParallaxOcclusion")],ee.prototype,"_useParallaxOcclusion",void 0);P([Ze("_markAllSubMeshesAsTexturesDirty")],ee.prototype,"useParallaxOcclusion",void 0);P([B()],ee.prototype,"parallaxScaleBias",void 0);P([B("roughness")],ee.prototype,"_roughness",void 0);P([Ze("_markAllSubMeshesAsTexturesDirty")],ee.prototype,"roughness",void 0);P([B()],ee.prototype,"indexOfRefraction",void 0);P([B()],ee.prototype,"invertRefractionY",void 0);P([B()],ee.prototype,"alphaCutOff",void 0);P([B("useLightmapAsShadowmap")],ee.prototype,"_useLightmapAsShadowmap",void 0);P([Ze("_markAllSubMeshesAsTexturesDirty")],ee.prototype,"useLightmapAsShadowmap",void 0);P([a0("diffuseFresnelParameters")],ee.prototype,"_diffuseFresnelParameters",void 0);P([Ze("_markAllSubMeshesAsFresnelDirty")],ee.prototype,"diffuseFresnelParameters",void 0);P([a0("opacityFresnelParameters")],ee.prototype,"_opacityFresnelParameters",void 0);P([Ze("_markAllSubMeshesAsFresnelAndMiscDirty")],ee.prototype,"opacityFresnelParameters",void 0);P([a0("reflectionFresnelParameters")],ee.prototype,"_reflectionFresnelParameters",void 0);P([Ze("_markAllSubMeshesAsFresnelDirty")],ee.prototype,"reflectionFresnelParameters",void 0);P([a0("refractionFresnelParameters")],ee.prototype,"_refractionFresnelParameters",void 0);P([Ze("_markAllSubMeshesAsFresnelDirty")],ee.prototype,"refractionFresnelParameters",void 0);P([a0("emissiveFresnelParameters")],ee.prototype,"_emissiveFresnelParameters",void 0);P([Ze("_markAllSubMeshesAsFresnelDirty")],ee.prototype,"emissiveFresnelParameters",void 0);P([B("useReflectionFresnelFromSpecular")],ee.prototype,"_useReflectionFresnelFromSpecular",void 0);P([Ze("_markAllSubMeshesAsFresnelDirty")],ee.prototype,"useReflectionFresnelFromSpecular",void 0);P([B("useGlossinessFromSpecularMapAlpha")],ee.prototype,"_useGlossinessFromSpecularMapAlpha",void 0);P([Ze("_markAllSubMeshesAsTexturesDirty")],ee.prototype,"useGlossinessFromSpecularMapAlpha",void 0);P([B("maxSimultaneousLights")],ee.prototype,"_maxSimultaneousLights",void 0);P([Ze("_markAllSubMeshesAsLightsDirty")],ee.prototype,"maxSimultaneousLights",void 0);P([B("invertNormalMapX")],ee.prototype,"_invertNormalMapX",void 0);P([Ze("_markAllSubMeshesAsTexturesDirty")],ee.prototype,"invertNormalMapX",void 0);P([B("invertNormalMapY")],ee.prototype,"_invertNormalMapY",void 0);P([Ze("_markAllSubMeshesAsTexturesDirty")],ee.prototype,"invertNormalMapY",void 0);P([B("twoSidedLighting")],ee.prototype,"_twoSidedLighting",void 0);P([Ze("_markAllSubMeshesAsTexturesDirty")],ee.prototype,"twoSidedLighting",void 0);P([B("applyDecalMapAfterDetailMap")],ee.prototype,"_applyDecalMapAfterDetailMap",void 0);P([Ze("_markAllSubMeshesAsMiscDirty")],ee.prototype,"applyDecalMapAfterDetailMap",void 0);Tt("BABYLON.StandardMaterial",ee);Je.DefaultMaterialFactory=n=>new ee("default material",n);function XE(n,e){const t=e.method||"GET";return new Promise((i,s)=>{const r=new Wt;r.addEventListener("readystatechange",()=>{if(r.readyState==4)if(r.status==200){const a={};if(e.responseHeaders)for(const o of e.responseHeaders)a[o]=r.getResponseHeader(o)||"";i({response:r.response,headerValues:a})}else s(`Unable to fetch data from ${n}. Error code: ${r.status}`)}),r.open(t,n),r.send()})}var Hg;(function(n){n[n.Clean=0]="Clean",n[n.Stop=1]="Stop",n[n.Sync=2]="Sync",n[n.NoSync=3]="NoSync"})(Hg||(Hg={}));function YE(n){return!!n.createPlugin}function jE(n){return!!n.name}const iy=new q,Hs={};let Su=!1;function Ih(){return Hs[".babylon"]}function qE(n){for(const e in Hs){const t=Hs[e];if(t.mimeType===n)return t}}function Gc(n,e){const t=Hs[n];return t||(U.Warn("Unable to find a plugin to load "+n+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),e?Ih():void 0)}function $E(n){return!!Hs[n]}function ZE(n){for(const e in Hs){const t=Hs[e].plugin;if(t.canDirectLoad&&t.canDirectLoad(n))return Hs[e]}return Ih()}function QE(n){const e=n.indexOf("?");e!==-1&&(n=n.substring(0,e));const t=n.lastIndexOf(".");return n.substring(t,n.length).toLowerCase()}function JE(n){return n.substring(0,5)==="data:"?n.substring(5):null}function wd(n,e,t){let s="Unable to load from "+(n.rawData?"binary data":n.url);return e?s+=`: ${e}`:t&&(s+=`: ${t}`),s}async function Dd(n,e,t,i,s,r,a,o,l){var d;const h=JE(n.url);if(n.rawData&&!a)throw"When using ArrayBufferView to load data the file extension must be provided.";const u=!h&&!a?QE(n.url):"";let c=a?Gc(a,!0):h?ZE(n.url):Gc(u,!1);if(!c&&u){if(n.url&&!n.url.startsWith("blob:")){const _=await XE(n.url,{method:"HEAD",responseHeaders:["Content-Type"]}),p=_.headerValues?_.headerValues["Content-Type"]:"";p&&(c=qE(p))}c||(c=Ih())}if(!c)throw new Error(`No plugin or fallback for ${a??n.url}`);if(((d=l==null?void 0:l[c.plugin.name])==null?void 0:d.enabled)===!1)throw new Error(`The '${c.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(n.rawData&&!c.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(_=>{if(YE(c.plugin)){const g=c.plugin.createPlugin(l??{});return g instanceof Promise?(g.then(_).catch(m=>{s("Error instantiating plugin.",m)}),null):(_(g),g)}else return _(c.plugin),c.plugin})(_=>{var x;if(!_)throw`The loader plugin corresponding to the '${a}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(iy.notifyObservers(_),h&&(_.canDirectLoad&&_.canDirectLoad(n.url)||!hd(n.url))){if(_.directLoad){const E=_.directLoad(e,h);E instanceof Promise?E.then(R=>{t(_,R)}).catch(R=>{s("Error in directLoad of _loadData: "+R,R)}):t(_,E)}else t(_,h);return}const p=c.isBinary,g=(E,R)=>{if(e.isDisposed){s("Scene has been disposed");return}t(_,E,R)};let m=null,v=!1;(x=_.onDisposeObservable)==null||x.add(()=>{v=!0,m&&(m.abort(),m=null),r()});const T=()=>{if(v)return;const E=(R,C)=>{s(R==null?void 0:R.statusText,C)};if(!_.loadFile&&n.rawData)throw"Plugin does not support loading ArrayBufferView.";m=_.loadFile?_.loadFile(e,n.rawData||n.file||n.url,n.rootUrl,g,i,p,E,o):e._loadFile(n.file||n.url,g,i,!0,p,E)},A=e.getEngine();let b=A.enableOfflineSupport;if(b){let E=!1;for(const R of e.disableOfflineSupportExceptionRules)if(R.test(n.url)){E=!0;break}b=!E}b&&re.OfflineProviderFactory?e.offlineProvider=re.OfflineProviderFactory(n.url,T,A.disableManifestCheck):T()})}function Od(n,e){let t,i,s=null,r=null;if(!e)t=n,i=Z.GetFilename(n),n=Z.GetFolderPath(n);else if(jE(e))t=`file:${e.name}`,i=e.name,s=e;else if(ArrayBuffer.isView(e))t="",i=nd(),r=e;else if(e.startsWith("data:"))t=e,i="";else if(n){const a=e;if(a.substring(0,1)==="/")return Z.Error("Wrong sceneFilename parameter"),null;t=n+a,i=a}else t=e,i=Z.GetFilename(e),n=Z.GetFolderPath(e);return{url:t,rootUrl:n,name:i,file:s,rawData:r}}function sy(n){if(typeof n.extensions=="string"){const e=n.extensions;Hs[e.toLowerCase()]={plugin:n,isBinary:!1}}else{const e=n.extensions;Object.keys(e).forEach(t=>{Hs[t.toLowerCase()]={plugin:n,isBinary:e[t].isBinary,mimeType:e[t].mimeType}})}}async function ny(n,e,t="",i=Ae.LastCreatedScene,s=null,r=null,a=null,o=null,l="",h={}){if(!i)return U.Error("No scene available to import mesh to"),null;const u=Od(e,t);if(!u)return null;const c={};i.addPendingData(c);const f=()=>{i.removePendingData(c)},d=(g,m)=>{const v=wd(u,g,m);a?a(i,v,new Sn(v,Ur.SceneLoaderError,m)):U.Error(v),f()},_=r?g=>{try{r(g)}catch(m){d("Error in onProgress callback: "+m,m)}}:void 0,p=(g,m,v,T,A,b,x,E)=>{if(i.importedMeshesFiles.push(u.url),s)try{s(g,m,v,T,A,b,x,E)}catch(R){d("Error in onSuccess callback: "+R,R)}i.removePendingData(c)};return await Dd(u,i,(g,m,v)=>{if(g.rewriteRootURL&&(u.rootUrl=g.rewriteRootURL(u.rootUrl,v)),g.importMesh){const T=g,A=[],b=[],x=[];if(!T.importMesh(n,i,m,u.rootUrl,A,b,x,d))return;i.loadingPluginName=g.name,p(A,b,x,[],[],[],[],[])}else g.importMeshAsync(n,i,m,u.rootUrl,_,u.name).then(A=>{i.loadingPluginName=g.name,p(A.meshes,A.particleSystems,A.skeletons,A.animationGroups,A.transformNodes,A.geometries,A.lights,A.spriteManagers)}).catch(A=>{d(A.message,A)})},_,d,f,o,l,h)}function e6(n,e,t,i,s,r,a,o){return new Promise((l,h)=>{try{ny(n,e,t,i,(u,c,f,d,_,p,g,m)=>{l({meshes:u,particleSystems:c,skeletons:f,animationGroups:d,transformNodes:_,geometries:p,lights:g,spriteManagers:m})},s,(u,c,f)=>{h(f||new Error(c))},r,a,o).catch(h)}catch(u){h(u)}})}async function ry(n,e="",t=Ae.LastCreatedEngine,i=null,s=null,r=null,a=null,o="",l={}){if(!t){Z.Error("No engine available");return}await Fd(n,e,new Je(t),i,s,r,a,o,l)}function t6(n,e,t,i,s,r,a){return new Promise((o,l)=>{ry(n,e,t,h=>{o(h)},i,(h,u,c)=>{l(c||new Error(u))},s,r,a)})}async function Fd(n,e="",t=Ae.LastCreatedScene,i=null,s=null,r=null,a=null,o="",l={}){if(!t)return U.Error("No scene available to append to"),null;const h=Od(n,e);if(!h)return null;const u={};t.addPendingData(u);const c=()=>{t.removePendingData(u)};Ct.ShowLoadingScreen&&!Su&&(Su=!0,t.getEngine().displayLoadingUI(),t.executeWhenReady(()=>{t.getEngine().hideLoadingUI(),Su=!1}));const f=(p,g)=>{const m=wd(h,p,g);r?r(t,m,new Sn(m,Ur.SceneLoaderError,g)):U.Error(m),c()},d=s?p=>{try{s(p)}catch(g){f("Error in onProgress callback",g)}}:void 0,_=()=>{if(i)try{i(t)}catch(p){f("Error in onSuccess callback",p)}t.removePendingData(u)};return await Dd(h,t,(p,g)=>{if(p.load){if(!p.load(t,g,h.rootUrl,f))return;t.loadingPluginName=p.name,_()}else p.loadAsync(t,g,h.rootUrl,d,h.name).then(()=>{t.loadingPluginName=p.name,_()}).catch(v=>{f(v.message,v)})},d,f,c,a,o,l)}function i6(n,e,t,i,s,r,a){return new Promise((o,l)=>{try{Fd(n,e,t,h=>{o(h)},i,(h,u,c)=>{l(c||new Error(u))},s,r,a).catch(l)}catch(h){l(h)}})}async function Ld(n,e="",t=Ae.LastCreatedScene,i=null,s=null,r=null,a=null,o="",l={}){if(!t)return U.Error("No scene available to load asset container to"),null;const h=Od(n,e);if(!h)return null;const u={};t.addPendingData(u);const c=()=>{t.removePendingData(u)},f=(p,g)=>{const m=wd(h,p,g);r?r(t,m,new Sn(m,Ur.SceneLoaderError,g)):U.Error(m),c()},d=s?p=>{try{s(p)}catch(g){f("Error in onProgress callback",g)}}:void 0,_=p=>{if(i)try{i(p)}catch(g){f("Error in onSuccess callback",g)}t.removePendingData(u)};return await Dd(h,t,(p,g)=>{if(p.loadAssetContainer){const v=p.loadAssetContainer(t,g,h.rootUrl,f);if(!v)return;v.populateRootNodes(),t.loadingPluginName=p.name,_(v)}else p.loadAssetContainerAsync?p.loadAssetContainerAsync(t,g,h.rootUrl,d,h.name).then(v=>{v.populateRootNodes(),t.loadingPluginName=p.name,_(v)}).catch(v=>{f(v.message,v)}):f("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")},d,f,c,a,o,l)}function s6(n,e,t,i,s,r,a){return new Promise((o,l)=>{try{Ld(n,e,t,h=>{o(h)},i,(h,u,c)=>{l(c||new Error(u))},s,r,a).catch(l)}catch(h){l(h)}})}async function ay(n,e="",t=Ae.LastCreatedScene,i=!0,s=0,r=null,a=null,o=null,l=null,h=null,u="",c={}){if(!t){U.Error("No scene available to load animations to");return}if(i){for(const p of t.animatables)p.reset();t.stopAllAnimations(),t.animationGroups.slice().forEach(p=>{p.dispose()}),t.getNodes().forEach(p=>{p.animations&&(p.animations=[])})}else switch(s){case 0:t.animationGroups.slice().forEach(_=>{_.dispose()});break;case 1:t.animationGroups.forEach(_=>{_.stop()});break;case 2:t.animationGroups.forEach(_=>{_.reset(),_.restart()});break;case 3:break;default:U.Error("Unknown animation group loading mode value '"+s+"'");return}const f=t.animatables.length;await Ld(n,e,t,_=>{_.mergeAnimationsTo(t,t.animatables.slice(f),r),_.dispose(),t.onAnimationFileImportedObservable.notifyObservers(t),a&&a(t)},o,l,h,u,c)}function n6(n,e,t,i,s,r,a,o,l,h){return new Promise((u,c)=>{try{ay(n,e,t,i,s,r,f=>{u(f)},a,(f,d,_)=>{c(_||new Error(d))},o,l,h).catch(c)}catch(f){c(f)}})}class Or{static get ForceFullSceneLoadingForIncremental(){return Ct.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(e){Ct.ForceFullSceneLoadingForIncremental=e}static get ShowLoadingScreen(){return Ct.ShowLoadingScreen}static set ShowLoadingScreen(e){Ct.ShowLoadingScreen=e}static get loggingLevel(){return Ct.loggingLevel}static set loggingLevel(e){Ct.loggingLevel=e}static get CleanBoneMatrixWeights(){return Ct.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(e){Ct.CleanBoneMatrixWeights=e}static GetDefaultPlugin(){return Ih()}static GetPluginForExtension(e){var t;return(t=Gc(e,!0))==null?void 0:t.plugin}static IsPluginForExtensionAvailable(e){return $E(e)}static RegisterPlugin(e){sy(e)}static ImportMesh(e,t,i,s,r,a,o,l,h){ny(e,t,i,s,r,a,o,l,h).catch(u=>o==null?void 0:o(Ae.LastCreatedScene,u==null?void 0:u.message,u))}static ImportMeshAsync(e,t,i,s,r,a,o){return e6(e,t,i,s,r,a,o)}static Load(e,t,i,s,r,a,o,l){ry(e,t,i,s,r,a,o,l).catch(h=>a==null?void 0:a(Ae.LastCreatedScene,h==null?void 0:h.message,h))}static LoadAsync(e,t,i,s,r,a){return t6(e,t,i,s,r,a)}static Append(e,t,i,s,r,a,o,l){Fd(e,t,i,s,r,a,o,l).catch(h=>a==null?void 0:a(i??Ae.LastCreatedScene,h==null?void 0:h.message,h))}static AppendAsync(e,t,i,s,r,a){return i6(e,t,i,s,r,a)}static LoadAssetContainer(e,t,i,s,r,a,o,l){Ld(e,t,i,s,r,a,o,l).catch(h=>a==null?void 0:a(i??Ae.LastCreatedScene,h==null?void 0:h.message,h))}static LoadAssetContainerAsync(e,t,i,s,r,a){return s6(e,t,i,s,r,a)}static ImportAnimations(e,t,i,s,r,a,o,l,h,u,c){ay(e,t,i,s,r,a,o,l,h,u,c).catch(f=>h==null?void 0:h(i??Ae.LastCreatedScene,f==null?void 0:f.message,f))}static ImportAnimationsAsync(e,t,i,s,r,a,o,l,h,u,c){return n6(e,t,i,s,r,a,l,u,c)}}Or.NO_LOGGING=0;Or.MINIMAL_LOGGING=1;Or.SUMMARY_LOGGING=2;Or.DETAILED_LOGGING=3;Or.OnPluginActivatedObservable=iy;class Ch extends pt{getClassName(){return"FxaaPostProcess"}constructor(e,t,i=null,s,r,a,o=0){super(e,"fxaa",["texelSize"],null,t,i,s||ie.BILINEAR_SAMPLINGMODE,r,a,null,o,"fxaa",void 0,!0);const l=this._getDefines();this.updateEffect(l),this.onApplyObservable.add(h=>{const u=this.texelSize;h.setFloat2("texelSize",u.x,u.y)})}_gatherImports(e,t){e?(this._webGPUReady=!0,t.push(Promise.all([De(()=>import("./fxaa.fragment-CZb9KpHu.js"),[]),De(()=>import("./fxaa.vertex-CkqcaMHB.js"),[])]))):t.push(Promise.all([De(()=>import("./fxaa.fragment-DHoTeRkR.js"),[]),De(()=>import("./fxaa.vertex-CBx57UNj.js"),[])])),super._gatherImports(e,t)}_getDefines(){const e=this.getEngine();return e&&e.extractDriverInfo().toLowerCase().indexOf("mali")>-1?`#define MALI 1
`:null}static _Parse(e,t,i,s){return Ie.Parse(()=>new Ch(e.name,e.options,t,e.renderTargetSamplingMode,i.getEngine(),e.reusable),e,i,s)}}Tt("BABYLON.FxaaPostProcess",Ch);let _r,yr=null;async function r6(){return yr||(yr=new Promise((n,e)=>{let t,i=null;const s={preserveDrawingBuffer:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};De(async()=>{const{ThinEngine:r}=await Promise.resolve().then(()=>o4);return{ThinEngine:r}},void 0).then(({ThinEngine:r})=>{var l;const a=Ae.Instances.length;try{t=new OffscreenCanvas(100,100),i=new r(t,!1,s)}catch{a<Ae.Instances.length&&((l=Ae.Instances.pop())==null||l.dispose()),t=document.createElement("canvas"),i=new r(t,!1,s)}Ae.Instances.pop(),Ae.OnEnginesDisposedObservable.add(h=>{i&&h!==i&&!i.isDisposed&&Ae.Instances.length===0&&Ud()}),i.getCaps().parallelShaderCompile=void 0;const o=new gA(i);De(async()=>{const{passPixelShader:h}=await import("./pass.fragment-CS1tgUTK.js");return{passPixelShader:h}},[]).then(({passPixelShader:h})=>{if(!i){e("Engine is not defined");return}const u=new qt({engine:i,name:h.name,fragmentShader:h.shader,samplerNames:["textureSampler"]});_r={canvas:t,engine:i,renderer:o,wrapper:u},n(_r)})}).catch(e)})),await yr}async function Bd(n,e,t,i,s="image/png",r,a){const o=await t.readPixels(0,0,n,e),l=new Uint8Array(o.buffer);Ga(n,e,l,i,s,r,!0,void 0,a)}function Nd(n,e,t,i="image/png",s,r=!1,a=!1,o){return new Promise(l=>{Ga(n,e,t,h=>l(h),i,s,r,a,o)})}function Ga(n,e,t,i,s="image/png",r,a=!1,o=!1,l){r6().then(h=>{if(h.engine.setSize(n,e,!0),t instanceof Float32Array){const c=new Uint8Array(t.length);let f=t.length;for(;f--;){const d=t[f];c[f]=Math.round(lt(d)*255)}t=c}const u=h.engine.createRawTexture(t,n,e,5,!1,!a,1);h.renderer.setViewport(),h.renderer.applyEffectWrapper(h.wrapper),h.wrapper.effect._bindTexture("textureSampler",u),h.renderer.draw(),o?Z.ToBlob(h.canvas,c=>{const f=new FileReader;f.onload=d=>{const _=d.target.result;i&&i(_)},f.readAsArrayBuffer(c)},s,l):Z.EncodeScreenshotCanvasData(h.canvas,i,s,r,l),u.dispose()})}function Ud(){_r?(_r.wrapper.dispose(),_r.renderer.dispose(),_r.engine.dispose()):yr==null||yr.then(n=>{n.wrapper.dispose(),n.renderer.dispose(),n.engine.dispose()}),yr=null,_r=null}const a6={DumpData:Ga,DumpDataAsync:Nd,DumpFramebuffer:Bd,Dispose:Ud},o6=()=>{Z.DumpData=Ga,Z.DumpDataAsync=Nd,Z.DumpFramebuffer=Bd};o6();const l6=Object.freeze(Object.defineProperty({__proto__:null,Dispose:Ud,DumpData:Ga,DumpDataAsync:Nd,DumpFramebuffer:Bd,DumpTools:a6},Symbol.toStringTag,{value:"Module"}));let rn=null;function Mh(n,e,t,i,s="image/png",r=!1,a,o=!1){const{height:l,width:h}=hy(n,e,t);if(!(l&&h)){U.Error("Invalid 'size' parameter !");return}if(e.getScene().activeCamera!==e){Ph(n,e,t,c=>{if(r){const f=new Blob([c]);Z.DownloadBlob(f),i&&i("")}else i&&i(c)},s,1,n.getCreationOptions().antialias,void 0,void 0,void 0,void 0,a);return}n.onEndFrameObservable.addOnce(()=>{rn||(rn=document.createElement("canvas")),rn.width=h,rn.height=l;const c=rn.getContext("2d"),f=n.getRenderingCanvas();if(!c||!f){U.Error("Failed to create screenshot. Rendering context or rendering canvas is not available.");return}const d=f.width,_=f.height,p=rn.width,g=rn.height,m=p/d,v=g/_,T=o?Math.max(m,v):Math.min(m,v),A=d*T,b=_*T,x=(p-A)/2,E=(g-b)/2;c.drawImage(f,0,0,d,_,x,E,A,b),r?(Z.EncodeScreenshotCanvasData(rn,void 0,s,void 0,a),i&&i("")):Z.EncodeScreenshotCanvasData(rn,i,s,void 0,a)})}function oy(n,e,t,i="image/png",s,r=!1){return new Promise((a,o)=>{Mh(n,e,t,l=>{typeof l<"u"?a(l):o(new Error("Data is undefined"))},i,void 0,s,r)})}function h6(n,e,t,i,s="image/png",r,a=!1){return new Promise(o=>{Mh(n,e,{width:t,height:i},()=>{o()},s,!0,r,a)})}function Ph(n,e,t,i,s="image/png",r=1,a=!1,o,l=!1,h=!1,u=!0,c,f,d){const{height:_,width:p,finalWidth:g,finalHeight:m}=hy(n,e,t),v={width:p,height:_};if(!(_&&p)){U.Error("Invalid 'size' parameter !");return}n.skipFrameRender=!0;const T=n.getRenderWidth,A=n.getRenderHeight;n.getRenderWidth=(I=!1)=>!I&&n._currentRenderTarget?n._currentRenderTarget.width:p,n.getRenderHeight=(I=!1)=>!I&&n._currentRenderTarget?n._currentRenderTarget.height:_,n.onResizeObservable.hasObservers()&&n.onResizeObservable.notifyObservers(n);const b=e.getScene(),x=new Rn("screenShot",v,b,!1,!1,0,!1,ie.BILINEAR_SAMPLINGMODE,void 0,h,void 0,void 0,void 0,r);x.renderList=b.meshes.slice(),x.samples=r,x.renderSprites=l,x.activeCamera=e,x.forceLayerMaskCheck=u,f==null||f(x);const E=d||Ga,R=()=>{gh(()=>x.isReadyForRendering()&&e.isReady(!0),()=>{n.onEndFrameObservable.addOnce(()=>{g===p&&m===_?x.readPixels(void 0,void 0,void 0,!1).then(W=>{E(p,_,W,i,s,o,!0,void 0,c),x.dispose()}):(n.isWebGPU?De(()=>import("./pass.fragment-DApSp89C.js"),[]):De(()=>import("./pass.fragment-CS1tgUTK.js"),[])).then(()=>mA("pass",x.getInternalTexture(),b,void 0,void 0,void 0,g,m).then(X=>{n._readTexturePixels(X,g,m,-1,0,null,!0,!1,0,0).then(he=>{E(g,m,he,i,s,o,!0,void 0,c),X.dispose()})}))}),b.incrementRenderId(),b.resetCachedMaterial();const I=b.activeCamera,D=b.activeCameras,w=e.outputRenderTarget,z=b.spritesEnabled;b.activeCamera=e,b.activeCameras=null,e.outputRenderTarget=x,b.spritesEnabled=l;const F=b.meshes;b.meshes=x.renderList||b.meshes;try{b.render()}finally{b.activeCamera=I,b.activeCameras=D,e.outputRenderTarget=w,b.spritesEnabled=z,b.meshes=F,n.getRenderWidth=T,n.getRenderHeight=A,n.onResizeObservable.hasObservers()&&n.onResizeObservable.notifyObservers(n),e.getProjectionMatrix(!0),n.skipFrameRender=!1}},()=>{n.skipFrameRender=!1,n.getRenderWidth=T,n.getRenderHeight=A})},C=()=>{b.incrementRenderId(),b.resetCachedMaterial(),R()};if(a){const I=new Ch("antialiasing",1,b.activeCamera);x.addPostProcess(I),I.onEffectCreatedObservable.addOnce(D=>{D.isReady()?C():D.onCompiled=()=>{C()}})}else C()}function ly(n,e,t,i="image/png",s=1,r=!1,a,o=!1,l=!1,h=!0,u,c,f){return new Promise((d,_)=>{Ph(n,e,t,p=>{typeof p<"u"?d(p):_(new Error("Data is undefined"))},i,s,r,a,o,l,h,u,c,f)})}function hy(n,e,t){let i=0,s=0,r=0,a=0;if(typeof t=="object"){const o=t.precision?Math.abs(t.precision):1;t.width&&t.height?(i=t.height*o,s=t.width*o):t.width&&!t.height?(s=t.width*o,i=Math.round(s/n.getAspectRatio(e))):t.height&&!t.width?(i=t.height*o,s=Math.round(i*n.getAspectRatio(e))):(s=Math.round(n.getRenderWidth()*o),i=Math.round(s/n.getAspectRatio(e))),t.finalWidth&&t.finalHeight?(a=t.finalHeight,r=t.finalWidth):t.finalWidth&&!t.finalHeight?(r=t.finalWidth,a=Math.round(r/n.getAspectRatio(e))):t.finalHeight&&!t.finalWidth?(a=t.finalHeight,r=Math.round(a*n.getAspectRatio(e))):(r=s,a=i)}else isNaN(t)||(i=t,s=t,r=t,a=t);return s&&(s=Math.floor(s)),i&&(i=Math.floor(i)),r&&(r=Math.floor(r)),a&&(a=Math.floor(a)),{height:i|0,width:s|0,finalWidth:r|0,finalHeight:a|0}}const u6={CreateScreenshot:Mh,CreateScreenshotAsync:oy,CreateScreenshotWithResizeAsync:h6,CreateScreenshotUsingRenderTarget:Ph,CreateScreenshotUsingRenderTargetAsync:ly},c6=()=>{Z.CreateScreenshot=Mh,Z.CreateScreenshotAsync=oy,Z.CreateScreenshotUsingRenderTarget=Ph,Z.CreateScreenshotUsingRenderTargetAsync=ly};c6();O._instancedMeshFactory=(n,e)=>{const t=new wh(n,e);if(e.instancedBuffers){t.instancedBuffers={};for(const i in e.instancedBuffers)t.instancedBuffers[i]=e.instancedBuffers[i]}return t};class wh extends it{constructor(e,t){super(e,t.getScene()),this._indexInSourceMeshInstanceArray=-1,this._distanceToCamera=0,t.addInstance(this),this._sourceMesh=t,this._unIndexed=t._unIndexed,this.position.copyFrom(t.position),this.rotation.copyFrom(t.rotation),this.scaling.copyFrom(t.scaling),t.rotationQuaternion&&(this.rotationQuaternion=t.rotationQuaternion.clone()),this.animations=t.animations.slice();for(const i of t.getAnimationRanges())i!=null&&this.createAnimationRange(i.name,i.from,i.to);this.infiniteDistance=t.infiniteDistance,this.setPivotMatrix(t.getPivotMatrix()),this.refreshBoundingInfo(!0,!0),this._syncSubMeshes()}getClassName(){return"InstancedMesh"}get lightSources(){return this._sourceMesh._lightSources}_resyncLightSources(){}_resyncLightSource(){}_removeLightSource(){}get receiveShadows(){return this._sourceMesh.receiveShadows}set receiveShadows(e){var t;((t=this._sourceMesh)==null?void 0:t.receiveShadows)!==e&&Z.Warn("Setting receiveShadows on an instanced mesh has no effect")}get material(){return this._sourceMesh.material}set material(e){var t;((t=this._sourceMesh)==null?void 0:t.material)!==e&&Z.Warn("Setting material on an instanced mesh has no effect")}get visibility(){return this._sourceMesh.visibility}set visibility(e){var t;((t=this._sourceMesh)==null?void 0:t.visibility)!==e&&Z.Warn("Setting visibility on an instanced mesh has no effect")}get skeleton(){return this._sourceMesh.skeleton}set skeleton(e){var t;((t=this._sourceMesh)==null?void 0:t.skeleton)!==e&&Z.Warn("Setting skeleton on an instanced mesh has no effect")}get renderingGroupId(){return this._sourceMesh.renderingGroupId}set renderingGroupId(e){!this._sourceMesh||e===this._sourceMesh.renderingGroupId||U.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")}getTotalVertices(){return this._sourceMesh?this._sourceMesh.getTotalVertices():0}getTotalIndices(){return this._sourceMesh.getTotalIndices()}get sourceMesh(){return this._sourceMesh}get geometry(){return this._sourceMesh._geometry}createInstance(e){return this._sourceMesh.createInstance(e)}isReady(e=!1){return this._sourceMesh.isReady(e,!0)}getVerticesData(e,t,i){return this._sourceMesh.getVerticesData(e,t,i)}copyVerticesData(e,t){this._sourceMesh.copyVerticesData(e,t)}setVerticesData(e,t,i,s){return this.sourceMesh&&this.sourceMesh.setVerticesData(e,t,i,s),this.sourceMesh}updateVerticesData(e,t,i,s){return this.sourceMesh&&this.sourceMesh.updateVerticesData(e,t,i,s),this.sourceMesh}setIndices(e,t=null){return this.sourceMesh&&this.sourceMesh.setIndices(e,t),this.sourceMesh}isVerticesDataPresent(e){return this._sourceMesh.isVerticesDataPresent(e)}getIndices(){return this._sourceMesh.getIndices()}get _positions(){return this._sourceMesh._positions}refreshBoundingInfo(e=!1,t=!1){if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;let i;typeof e=="object"?i=e:i={applySkeleton:e,applyMorph:t};const s=this._sourceMesh.geometry?this._sourceMesh.geometry.boundingBias:null;return this._refreshBoundingInfo(this._sourceMesh._getData(i,null,S.PositionKind),s),this}_preActivate(){return this._currentLOD&&this._currentLOD._preActivate(),this}_activate(e,t){if(super._activate(e,t),this._sourceMesh.subMeshes||U.Warn("Instances should only be created for meshes with geometry."),this._currentLOD){if(this._currentLOD._getWorldMatrixDeterminant()>=0!=this._getWorldMatrixDeterminant()>=0)return this._internalAbstractMeshDataInfo._actAsRegularMesh=!0,!0;if(this._internalAbstractMeshDataInfo._actAsRegularMesh=!1,this._currentLOD._registerInstanceForRenderId(this,e),t){if(!this._currentLOD._internalAbstractMeshDataInfo._isActiveIntermediate)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!0,!0}else if(!this._currentLOD._internalAbstractMeshDataInfo._isActive)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstances=!0,!0}return!1}_postActivate(){this._sourceMesh.edgesShareWithInstances&&this._sourceMesh._edgesRenderer&&this._sourceMesh._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup?(this._sourceMesh._renderingGroup._edgesRenderers.pushNoDuplicate(this._sourceMesh._edgesRenderer),this._sourceMesh._edgesRenderer.customInstances.push(this.getWorldMatrix())):this._edgesRenderer&&this._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup&&this._sourceMesh._renderingGroup._edgesRenderers.push(this._edgesRenderer)}getWorldMatrix(){if(this._currentLOD&&this._currentLOD.billboardMode!==Re.BILLBOARDMODE_NONE&&this._currentLOD._masterMesh!==this){this._billboardWorldMatrix||(this._billboardWorldMatrix=new L);const e=this._currentLOD._masterMesh;return this._currentLOD._masterMesh=this,N.Vector3[7].copyFrom(this._currentLOD.position),this._currentLOD.position.set(0,0,0),this._billboardWorldMatrix.copyFrom(this._currentLOD.computeWorldMatrix(!0)),this._currentLOD.position.copyFrom(N.Vector3[7]),this._currentLOD._masterMesh=e,this._billboardWorldMatrix}return super.getWorldMatrix()}get isAnInstance(){return!0}getLOD(e){if(!e)return this;const t=this.sourceMesh.getLODLevels();if(!t||t.length===0)this._currentLOD=this.sourceMesh;else{const i=this.getBoundingInfo();this._currentLOD=this.sourceMesh.getLOD(e,i.boundingSphere)}return this._currentLOD}_preActivateForIntermediateRendering(e){return this.sourceMesh._preActivateForIntermediateRendering(e)}_syncSubMeshes(){if(this.releaseSubMeshes(),this._sourceMesh.subMeshes)for(let e=0;e<this._sourceMesh.subMeshes.length;e++)this._sourceMesh.subMeshes[e].clone(this,this._sourceMesh);return this}_generatePointsArray(){return this._sourceMesh._generatePointsArray()}_updateBoundingInfo(){return this.hasBoundingInfo?this.getBoundingInfo().update(this.worldMatrixFromCache):this.buildBoundingInfo(this.absolutePosition,this.absolutePosition,this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}clone(e,t=null,i,s){const r=(s||this._sourceMesh).createInstance(e);if(dd.DeepCopy(this,r,["name","subMeshes","uniqueId","parent","lightSources","receiveShadows","material","visibility","skeleton","sourceMesh","isAnInstance","facetNb","isFacetDataEnabled","isBlocked","useBones","hasInstances","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","isWorldMatrixFrozen","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","hasBoundingInfo"],[]),this.refreshBoundingInfo(),t&&(r.parent=t),!i)for(let a=0;a<this.getScene().meshes.length;a++){const o=this.getScene().meshes[a];o.parent===this&&o.clone(o.name,r)}return r.computeWorldMatrix(!0),this.onClonedObservable.notifyObservers(r),r}dispose(e,t=!1){this._sourceMesh.removeInstance(this),super.dispose(e,t)}_serializeAsParent(e){super._serializeAsParent(e),e.parentId=this._sourceMesh.uniqueId,e.parentInstanceIndex=this._indexInSourceMeshInstanceArray}instantiateHierarchy(e=null,t,i){const s=this.clone("Clone of "+(this.name||this.id),e||this.parent,!0,t&&t.newSourcedMesh);s&&i&&i(this,s);for(const r of this.getChildTransformNodes(!0))r.instantiateHierarchy(s,t,i);return s}}O.prototype.registerInstancedBuffer=function(n,e){var t,i;if((i=(t=this._userInstancedBuffersStorage)==null?void 0:t.vertexBuffers[n])==null||i.dispose(),!this.instancedBuffers){this.instancedBuffers={};for(const s of this.instances)s.instancedBuffers={}}this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this.instancedBuffers[n]=null,this._userInstancedBuffersStorage.strides[n]=e,this._userInstancedBuffersStorage.sizes[n]=e*32,this._userInstancedBuffersStorage.data[n]=new Float32Array(this._userInstancedBuffersStorage.sizes[n]),this._userInstancedBuffersStorage.vertexBuffers[n]=new S(this.getEngine(),this._userInstancedBuffersStorage.data[n],n,!0,!1,e,!0);for(const s of this.instances)s.instancedBuffers[n]=null;this._invalidateInstanceVertexArrayObject(),this._markSubMeshesAsAttributesDirty()};O.prototype._processInstancedBuffers=function(n,e){const t=n?n.length:0;for(const i in this.instancedBuffers){let s=this._userInstancedBuffersStorage.sizes[i];const r=this._userInstancedBuffersStorage.strides[i],a=(t+1)*r;for(;s<a;)s*=2;this._userInstancedBuffersStorage.data[i].length!=s&&(this._userInstancedBuffersStorage.data[i]=new Float32Array(s),this._userInstancedBuffersStorage.sizes[i]=s,this._userInstancedBuffersStorage.vertexBuffers[i]&&(this._userInstancedBuffersStorage.vertexBuffers[i].dispose(),this._userInstancedBuffersStorage.vertexBuffers[i]=null));const o=this._userInstancedBuffersStorage.data[i];let l=0;if(e){const h=this.instancedBuffers[i];h.toArray?h.toArray(o,l):h.copyToArray?h.copyToArray(o,l):o[l]=h,l+=r}for(let h=0;h<t;h++){const c=n[h].instancedBuffers[i];c.toArray?c.toArray(o,l):c.copyToArray?c.copyToArray(o,l):o[l]=c,l+=r}this._userInstancedBuffersStorage.vertexBuffers[i]?this._userInstancedBuffersStorage.vertexBuffers[i].updateDirectly(o,0):(this._userInstancedBuffersStorage.vertexBuffers[i]=new S(this.getEngine(),this._userInstancedBuffersStorage.data[i],i,!0,!1,r,!0),this._invalidateInstanceVertexArrayObject())}};O.prototype._invalidateInstanceVertexArrayObject=function(){if(!(!this._userInstancedBuffersStorage||this._userInstancedBuffersStorage.vertexArrayObjects===void 0)){for(const n in this._userInstancedBuffersStorage.vertexArrayObjects)this.getEngine().releaseVertexArrayObject(this._userInstancedBuffersStorage.vertexArrayObjects[n]);this._userInstancedBuffersStorage.vertexArrayObjects={}}};O.prototype._disposeInstanceSpecificData=function(){for(this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();for(const n in this.instancedBuffers)this._userInstancedBuffersStorage.vertexBuffers[n]&&this._userInstancedBuffersStorage.vertexBuffers[n].dispose();this._invalidateInstanceVertexArrayObject(),this.instancedBuffers={}};Tt("BABYLON.InstancedMesh",wh);const Ru={effect:null,subMesh:null};class bn extends Md{constructor(e,t,i,s={},r=!0){super(e,t,r),this._textures={},this._textureArrays={},this._externalTextures={},this._floats={},this._ints={},this._uints={},this._floatsArrays={},this._colors3={},this._colors3Arrays={},this._colors4={},this._colors4Arrays={},this._vectors2={},this._vectors3={},this._vectors4={},this._quaternions={},this._quaternionsArrays={},this._matrices={},this._matrixArrays={},this._matrices3x3={},this._matrices2x2={},this._vectors2Arrays={},this._vectors3Arrays={},this._vectors4Arrays={},this._uniformBuffers={},this._textureSamplers={},this._storageBuffers={},this._cachedWorldViewMatrix=new L,this._cachedWorldViewProjectionMatrix=new L,this._multiview=!1,this._materialHelperNeedsPreviousMatrices=!1,this._shaderPath=i,this._options={needAlphaBlending:!1,needAlphaTesting:!1,attributes:["position","normal","uv"],uniforms:["worldViewProjection"],uniformBuffers:[],samplers:[],externalTextures:[],samplerObjects:[],storageBuffers:[],defines:[],useClipPlane:!1,...s}}get shaderPath(){return this._shaderPath}set shaderPath(e){this._shaderPath=e}get options(){return this._options}get isMultiview(){return this._multiview}getClassName(){return"ShaderMaterial"}needAlphaBlending(){return this.alpha<1||this._options.needAlphaBlending}needAlphaTesting(){return this._options.needAlphaTesting}_checkUniform(e){this._options.uniforms.indexOf(e)===-1&&this._options.uniforms.push(e)}setTexture(e,t){return this._options.samplers.indexOf(e)===-1&&this._options.samplers.push(e),this._textures[e]=t,this}removeTexture(e){delete this._textures[e]}setTextureArray(e,t){return this._options.samplers.indexOf(e)===-1&&this._options.samplers.push(e),this._checkUniform(e),this._textureArrays[e]=t,this}setExternalTexture(e,t){return this._options.externalTextures.indexOf(e)===-1&&this._options.externalTextures.push(e),this._externalTextures[e]=t,this}setFloat(e,t){return this._checkUniform(e),this._floats[e]=t,this}setInt(e,t){return this._checkUniform(e),this._ints[e]=t,this}setUInt(e,t){return this._checkUniform(e),this._uints[e]=t,this}setFloats(e,t){return this._checkUniform(e),this._floatsArrays[e]=t,this}setColor3(e,t){return this._checkUniform(e),this._colors3[e]=t,this}setColor3Array(e,t){return this._checkUniform(e),this._colors3Arrays[e]=t.reduce((i,s)=>(s.toArray(i,i.length),i),[]),this}setColor4(e,t){return this._checkUniform(e),this._colors4[e]=t,this}setColor4Array(e,t){return this._checkUniform(e),this._colors4Arrays[e]=t.reduce((i,s)=>(s.toArray(i,i.length),i),[]),this}setVector2(e,t){return this._checkUniform(e),this._vectors2[e]=t,this}setVector3(e,t){return this._checkUniform(e),this._vectors3[e]=t,this}setVector4(e,t){return this._checkUniform(e),this._vectors4[e]=t,this}setQuaternion(e,t){return this._checkUniform(e),this._quaternions[e]=t,this}setQuaternionArray(e,t){return this._checkUniform(e),this._quaternionsArrays[e]=t.reduce((i,s)=>(s.toArray(i,i.length),i),[]),this}setMatrix(e,t){return this._checkUniform(e),this._matrices[e]=t,this}setMatrices(e,t){this._checkUniform(e);const i=new Float32Array(t.length*16);for(let s=0;s<t.length;s++)t[s].copyToArray(i,s*16);return this._matrixArrays[e]=i,this}setMatrix3x3(e,t){return this._checkUniform(e),this._matrices3x3[e]=t,this}setMatrix2x2(e,t){return this._checkUniform(e),this._matrices2x2[e]=t,this}setArray2(e,t){return this._checkUniform(e),this._vectors2Arrays[e]=t,this}setArray3(e,t){return this._checkUniform(e),this._vectors3Arrays[e]=t,this}setArray4(e,t){return this._checkUniform(e),this._vectors4Arrays[e]=t,this}setUniformBuffer(e,t){return this._options.uniformBuffers.indexOf(e)===-1&&this._options.uniformBuffers.push(e),this._uniformBuffers[e]=t,this}setTextureSampler(e,t){return this._options.samplerObjects.indexOf(e)===-1&&this._options.samplerObjects.push(e),this._textureSamplers[e]=t,this}setStorageBuffer(e,t){return this._options.storageBuffers.indexOf(e)===-1&&this._options.storageBuffers.push(e),this._storageBuffers[e]=t,this}setDefine(e,t){const i=e.trimEnd()+" ",s=this.options.defines.findIndex(r=>r===e||r.startsWith(i));return s>=0&&this.options.defines.splice(s,1),(typeof t!="boolean"||t)&&this.options.defines.push(i+t),this}isReadyForSubMesh(e,t,i){return this.isReady(e,i,t)}isReady(e,t,i){const s=i&&this._storeEffectOnSubMeshes;if(this.isFrozen){const b=s?i._drawWrapper:this._drawWrapper;if(b.effect&&b._wasPreviouslyReady&&b._wasPreviouslyUsingInstances===t)return!0}const r=this.getScene(),a=r.getEngine(),o=[],l=[];let h=null,u=this._shaderPath,c=this._options.uniforms,f=this._options.uniformBuffers,d=this._options.samplers;a.getCaps().multiview&&r.activeCamera&&r.activeCamera.outputRenderTarget&&r.activeCamera.outputRenderTarget.getViewCount()>1&&(this._multiview=!0,o.push("#define MULTIVIEW"),c.indexOf("viewProjection")!==-1&&c.indexOf("viewProjectionR")===-1&&c.push("viewProjectionR"));for(let b=0;b<this._options.defines.length;b++){const x=this._options.defines[b].indexOf("#define")===0?this._options.defines[b]:`#define ${this._options.defines[b]}`;o.push(x)}for(let b=0;b<this._options.attributes.length;b++)l.push(this._options.attributes[b]);if(e&&e.isVerticesDataPresent(S.ColorKind)&&(l.indexOf(S.ColorKind)===-1&&l.push(S.ColorKind),o.push("#define VERTEXCOLOR")),t&&(o.push("#define INSTANCES"),Rd(l,this._materialHelperNeedsPreviousMatrices),e!=null&&e.hasThinInstances&&(o.push("#define THIN_INSTANCES"),e&&e.isVerticesDataPresent(S.ColorInstanceKind)&&(l.push(S.ColorInstanceKind),o.push("#define INSTANCESCOLOR")))),e&&e.useBones&&e.computeBonesUsingShaders&&e.skeleton){l.push(S.MatricesIndicesKind),l.push(S.MatricesWeightsKind),e.numBoneInfluencers>4&&(l.push(S.MatricesIndicesExtraKind),l.push(S.MatricesWeightsExtraKind));const b=e.skeleton;o.push("#define NUM_BONE_INFLUENCERS "+e.numBoneInfluencers),h=new Pd,h.addCPUSkinningFallback(0,e),b.isUsingTextureForMatrices?(o.push("#define BONETEXTURE"),c.indexOf("boneTextureWidth")===-1&&c.push("boneTextureWidth"),this._options.samplers.indexOf("boneSampler")===-1&&this._options.samplers.push("boneSampler")):(o.push("#define BonesPerMesh "+(b.bones.length+1)),c.indexOf("mBones")===-1&&c.push("mBones"))}else o.push("#define NUM_BONE_INFLUENCERS 0");let _=0;const p=e?e.morphTargetManager:null;if(p){const b=o.indexOf("#define UV1")!==-1,x=o.indexOf("#define UV2")!==-1,E=o.indexOf("#define TANGENT")!==-1,R=o.indexOf("#define NORMAL")!==-1,C=o.indexOf("#define VERTEXCOLOR")!==-1;_=Kv(p,o,l,e,!0,R,E,b,x,C),p.isUsingTextureForTargets&&(c.indexOf("morphTargetTextureIndices")===-1&&c.push("morphTargetTextureIndices"),this._options.samplers.indexOf("morphTargets")===-1&&this._options.samplers.push("morphTargets")),_>0&&(c=c.slice(),c.push("morphTargetInfluences"),c.push("morphTargetCount"),c.push("morphTargetTextureInfo"),c.push("morphTargetTextureIndices"))}else o.push("#define NUM_MORPH_INFLUENCERS 0");if(e){const b=e.bakedVertexAnimationManager;b&&b.isEnabled&&(o.push("#define BAKED_VERTEX_ANIMATION_TEXTURE"),c.indexOf("bakedVertexAnimationSettings")===-1&&c.push("bakedVertexAnimationSettings"),c.indexOf("bakedVertexAnimationTextureSizeInverted")===-1&&c.push("bakedVertexAnimationTextureSizeInverted"),c.indexOf("bakedVertexAnimationTime")===-1&&c.push("bakedVertexAnimationTime"),this._options.samplers.indexOf("bakedVertexAnimationTexture")===-1&&this._options.samplers.push("bakedVertexAnimationTexture")),jv(l,e,o)}for(const b in this._textures)if(!this._textures[b].isReady())return!1;e&&this.needAlphaTestingForMesh(e)&&o.push("#define ALPHATEST"),this._options.useClipPlane!==!1&&(Ah(c),Hv(this,r,o)),r.fogEnabled&&(e!=null&&e.applyFog)&&r.fogMode!==Je.FOGMODE_NONE&&(o.push("#define FOG"),c.indexOf("view")===-1&&c.push("view"),c.indexOf("vFogInfos")===-1&&c.push("vFogInfos"),c.indexOf("vFogColor")===-1&&c.push("vFogColor")),this._useLogarithmicDepth&&(o.push("#define LOGARITHMICDEPTH"),c.indexOf("logarithmicDepthConstant")===-1&&c.push("logarithmicDepthConstant")),this.customShaderNameResolve&&(c=c.slice(),f=f.slice(),d=d.slice(),u=this.customShaderNameResolve(this.name,c,f,d,o,l));const g=s?i._getDrawWrapper(void 0,!0):this._drawWrapper,m=(g==null?void 0:g.effect)??null,v=(g==null?void 0:g.defines)??null,T=o.join(`
`);let A=m;return v!==T&&(A=a.createEffect(u,{attributes:l,uniformsNames:c,uniformBuffersNames:f,samplers:d,defines:T,fallbacks:h,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousMorphTargets:_},shaderLanguage:this._options.shaderLanguage,extraInitializationsAsync:this._options.extraInitializationsAsync},a),s?i.setEffect(A,T,this._materialContext):g&&g.setEffect(A,T),this._onEffectCreatedObservable&&(Ru.effect=A,Ru.subMesh=i??(e==null?void 0:e.subMeshes[0])??null,this._onEffectCreatedObservable.notifyObservers(Ru))),g._wasPreviouslyUsingInstances=!!t,A!=null&&A.isReady()?(m!==A&&r.resetCachedMaterial(),g._wasPreviouslyReady=!0,!0):!1}bindOnlyWorldMatrix(e,t){const i=t??this.getEffect();if(!i)return;const s=this._options.uniforms;s.indexOf("world")!==-1&&i.setMatrix("world",e);const r=this.getScene();s.indexOf("worldView")!==-1&&(e.multiplyToRef(r.getViewMatrix(),this._cachedWorldViewMatrix),i.setMatrix("worldView",this._cachedWorldViewMatrix)),s.indexOf("worldViewProjection")!==-1&&(e.multiplyToRef(r.getTransformMatrix(),this._cachedWorldViewProjectionMatrix),i.setMatrix("worldViewProjection",this._cachedWorldViewProjectionMatrix)),s.indexOf("view")!==-1&&i.setMatrix("view",r.getViewMatrix())}bindForSubMesh(e,t,i){var s;this.bind(e,t,(s=i._drawWrapperOverride)==null?void 0:s.effect,i)}bind(e,t,i,s){var c;const r=s&&this._storeEffectOnSubMeshes,a=i??(r?s.effect:this.getEffect());if(!a)return;const o=this.getScene();this._activeEffect=a,this.bindOnlyWorldMatrix(e,i);const l=this._options.uniformBuffers;let h=!1;if(a&&l&&l.length>0&&o.getEngine().supportsUniformBuffers)for(let f=0;f<l.length;++f)switch(l[f]){case"Mesh":t&&(t.getMeshUniformBuffer().bindToEffect(a,"Mesh"),t.transferToEffect(e));break;case"Scene":Yv(a,o.getSceneUniformBuffer()),o.finalizeSceneUbo(),h=!0;break}const u=t&&r?this._mustRebind(o,a,s,t.visibility):o.getCachedMaterial()!==this;if(a&&u){!h&&this._options.uniforms.indexOf("view")!==-1&&a.setMatrix("view",o.getViewMatrix()),!h&&this._options.uniforms.indexOf("projection")!==-1&&a.setMatrix("projection",o.getProjectionMatrix()),!h&&this._options.uniforms.indexOf("viewProjection")!==-1&&(a.setMatrix("viewProjection",o.getTransformMatrix()),this._multiview&&a.setMatrix("viewProjectionR",o._transformMatrixR)),o.activeCamera&&this._options.uniforms.indexOf("cameraPosition")!==-1&&a.setVector3("cameraPosition",o.activeCamera.globalPosition),qv(t,a),Eh(a,this,o),this._useLogarithmicDepth&&Ed(r?s.materialDefines:a.defines,a,o),t&&Sd(o,t,a);let f;for(f in this._textures)a.setTexture(f,this._textures[f]);for(f in this._textureArrays)a.setTextureArray(f,this._textureArrays[f]);for(f in this._ints)a.setInt(f,this._ints[f]);for(f in this._uints)a.setUInt(f,this._uints[f]);for(f in this._floats)a.setFloat(f,this._floats[f]);for(f in this._floatsArrays)a.setArray(f,this._floatsArrays[f]);for(f in this._colors3)a.setColor3(f,this._colors3[f]);for(f in this._colors3Arrays)a.setArray3(f,this._colors3Arrays[f]);for(f in this._colors4){const m=this._colors4[f];a.setFloat4(f,m.r,m.g,m.b,m.a)}for(f in this._colors4Arrays)a.setArray4(f,this._colors4Arrays[f]);for(f in this._vectors2)a.setVector2(f,this._vectors2[f]);for(f in this._vectors3)a.setVector3(f,this._vectors3[f]);for(f in this._vectors4)a.setVector4(f,this._vectors4[f]);for(f in this._quaternions)a.setQuaternion(f,this._quaternions[f]);for(f in this._matrices)a.setMatrix(f,this._matrices[f]);for(f in this._matrixArrays)a.setMatrices(f,this._matrixArrays[f]);for(f in this._matrices3x3)a.setMatrix3x3(f,this._matrices3x3[f]);for(f in this._matrices2x2)a.setMatrix2x2(f,this._matrices2x2[f]);for(f in this._vectors2Arrays)a.setArray2(f,this._vectors2Arrays[f]);for(f in this._vectors3Arrays)a.setArray3(f,this._vectors3Arrays[f]);for(f in this._vectors4Arrays)a.setArray4(f,this._vectors4Arrays[f]);for(f in this._quaternionsArrays)a.setArray4(f,this._quaternionsArrays[f]);for(f in this._uniformBuffers){const m=this._uniformBuffers[f].getBuffer();m&&a.bindUniformBuffer(m,f)}const d=o.getEngine(),_=d.setExternalTexture;if(_)for(f in this._externalTextures)_.call(d,f,this._externalTextures[f]);const p=d.setTextureSampler;if(p)for(f in this._textureSamplers)p.call(d,f,this._textureSamplers[f]);const g=d.setStorageBuffer;if(g)for(f in this._storageBuffers)g.call(d,f,this._storageBuffers[f])}if(a&&t&&(u||!this.isFrozen)){Id(t,a),t.morphTargetManager&&t.morphTargetManager.isUsingTextureForTargets&&t.morphTargetManager._bind(a);const f=t.bakedVertexAnimationManager;if(f&&f.isEnabled){const d=r?s._drawWrapper:this._drawWrapper;(c=t.bakedVertexAnimationManager)==null||c.bind(a,!!d._wasPreviouslyUsingInstances)}}this._afterBind(t,a,s)}getActiveTextures(){const e=super.getActiveTextures();for(const t in this._textures)e.push(this._textures[t]);for(const t in this._textureArrays){const i=this._textureArrays[t];for(let s=0;s<i.length;s++)e.push(i[s])}return e}hasTexture(e){if(super.hasTexture(e))return!0;for(const t in this._textures)if(this._textures[t]===e)return!0;for(const t in this._textureArrays){const i=this._textureArrays[t];for(let s=0;s<i.length;s++)if(i[s]===e)return!0}return!1}clone(e){const t=Ie.Clone(()=>new bn(e,this.getScene(),this._shaderPath,this._options,this._storeEffectOnSubMeshes),this);t.name=e,t.id=e,typeof t._shaderPath=="object"&&(t._shaderPath={...t._shaderPath}),this._options={...this._options},Object.keys(this._options).forEach(i=>{const s=this._options[i];Array.isArray(s)&&(this._options[i]=s.slice(0))}),this.stencil.copyTo(t.stencil);for(const i in this._textures)t.setTexture(i,this._textures[i]);for(const i in this._textureArrays)t.setTextureArray(i,this._textureArrays[i]);for(const i in this._externalTextures)t.setExternalTexture(i,this._externalTextures[i]);for(const i in this._ints)t.setInt(i,this._ints[i]);for(const i in this._uints)t.setUInt(i,this._uints[i]);for(const i in this._floats)t.setFloat(i,this._floats[i]);for(const i in this._floatsArrays)t.setFloats(i,this._floatsArrays[i]);for(const i in this._colors3)t.setColor3(i,this._colors3[i]);for(const i in this._colors3Arrays)t._colors3Arrays[i]=this._colors3Arrays[i];for(const i in this._colors4)t.setColor4(i,this._colors4[i]);for(const i in this._colors4Arrays)t._colors4Arrays[i]=this._colors4Arrays[i];for(const i in this._vectors2)t.setVector2(i,this._vectors2[i]);for(const i in this._vectors3)t.setVector3(i,this._vectors3[i]);for(const i in this._vectors4)t.setVector4(i,this._vectors4[i]);for(const i in this._quaternions)t.setQuaternion(i,this._quaternions[i]);for(const i in this._quaternionsArrays)t._quaternionsArrays[i]=this._quaternionsArrays[i];for(const i in this._matrices)t.setMatrix(i,this._matrices[i]);for(const i in this._matrixArrays)t._matrixArrays[i]=this._matrixArrays[i].slice();for(const i in this._matrices3x3)t.setMatrix3x3(i,this._matrices3x3[i]);for(const i in this._matrices2x2)t.setMatrix2x2(i,this._matrices2x2[i]);for(const i in this._vectors2Arrays)t.setArray2(i,this._vectors2Arrays[i]);for(const i in this._vectors3Arrays)t.setArray3(i,this._vectors3Arrays[i]);for(const i in this._vectors4Arrays)t.setArray4(i,this._vectors4Arrays[i]);for(const i in this._uniformBuffers)t.setUniformBuffer(i,this._uniformBuffers[i]);for(const i in this._textureSamplers)t.setTextureSampler(i,this._textureSamplers[i]);for(const i in this._storageBuffers)t.setStorageBuffer(i,this._storageBuffers[i]);return t}dispose(e,t,i){if(t){let s;for(s in this._textures)this._textures[s].dispose();for(s in this._textureArrays){const r=this._textureArrays[s];for(let a=0;a<r.length;a++)r[a].dispose()}}this._textures={},super.dispose(e,t,i)}serialize(){const e=Ie.Serialize(this);e.customType="BABYLON.ShaderMaterial",e.uniqueId=this.uniqueId,e.options=this._options,e.shaderPath=this._shaderPath,e.storeEffectOnSubMeshes=this._storeEffectOnSubMeshes;let t;e.stencil=this.stencil.serialize(),e.textures={};for(t in this._textures)e.textures[t]=this._textures[t].serialize();e.textureArrays={};for(t in this._textureArrays){e.textureArrays[t]=[];const i=this._textureArrays[t];for(let s=0;s<i.length;s++)e.textureArrays[t].push(i[s].serialize())}e.ints={};for(t in this._ints)e.ints[t]=this._ints[t];e.uints={};for(t in this._uints)e.uints[t]=this._uints[t];e.floats={};for(t in this._floats)e.floats[t]=this._floats[t];e.floatsArrays={};for(t in this._floatsArrays)e.floatsArrays[t]=this._floatsArrays[t];e.colors3={};for(t in this._colors3)e.colors3[t]=this._colors3[t].asArray();e.colors3Arrays={};for(t in this._colors3Arrays)e.colors3Arrays[t]=this._colors3Arrays[t];e.colors4={};for(t in this._colors4)e.colors4[t]=this._colors4[t].asArray();e.colors4Arrays={};for(t in this._colors4Arrays)e.colors4Arrays[t]=this._colors4Arrays[t];e.vectors2={};for(t in this._vectors2){const i=this._vectors2[t];e.vectors2[t]=[i.x,i.y]}e.vectors3={};for(t in this._vectors3){const i=this._vectors3[t];e.vectors3[t]=[i.x,i.y,i.z]}e.vectors4={};for(t in this._vectors4){const i=this._vectors4[t];e.vectors4[t]=[i.x,i.y,i.z,i.w]}e.quaternions={};for(t in this._quaternions)e.quaternions[t]=this._quaternions[t].asArray();e.matrices={};for(t in this._matrices)e.matrices[t]=this._matrices[t].asArray();e.matrixArray={};for(t in this._matrixArrays)e.matrixArray[t]=this._matrixArrays[t];e.matrices3x3={};for(t in this._matrices3x3)e.matrices3x3[t]=this._matrices3x3[t];e.matrices2x2={};for(t in this._matrices2x2)e.matrices2x2[t]=this._matrices2x2[t];e.vectors2Arrays={};for(t in this._vectors2Arrays)e.vectors2Arrays[t]=this._vectors2Arrays[t];e.vectors3Arrays={};for(t in this._vectors3Arrays)e.vectors3Arrays[t]=this._vectors3Arrays[t];e.vectors4Arrays={};for(t in this._vectors4Arrays)e.vectors4Arrays[t]=this._vectors4Arrays[t];e.quaternionsArrays={};for(t in this._quaternionsArrays)e.quaternionsArrays[t]=this._quaternionsArrays[t];return e}static Parse(e,t,i){const s=Ie.Parse(()=>new bn(e.name,t,e.shaderPath,e.options,e.storeEffectOnSubMeshes),e,t,i);let r;e.stencil&&s.stencil.parse(e.stencil,t,i);for(r in e.textures)s.setTexture(r,ie.Parse(e.textures[r],t,i));for(r in e.textureArrays){const a=e.textureArrays[r],o=[];for(let l=0;l<a.length;l++)o.push(ie.Parse(a[l],t,i));s.setTextureArray(r,o)}for(r in e.ints)s.setInt(r,e.ints[r]);for(r in e.uints)s.setUInt(r,e.uints[r]);for(r in e.floats)s.setFloat(r,e.floats[r]);for(r in e.floatsArrays)s.setFloats(r,e.floatsArrays[r]);for(r in e.colors3)s.setColor3(r,fe.FromArray(e.colors3[r]));for(r in e.colors3Arrays){const a=e.colors3Arrays[r].reduce((o,l,h)=>(h%3===0?o.push([l]):o[o.length-1].push(l),o),[]).map(o=>fe.FromArray(o));s.setColor3Array(r,a)}for(r in e.colors4)s.setColor4(r,K.FromArray(e.colors4[r]));for(r in e.colors4Arrays){const a=e.colors4Arrays[r].reduce((o,l,h)=>(h%4===0?o.push([l]):o[o.length-1].push(l),o),[]).map(o=>K.FromArray(o));s.setColor4Array(r,a)}for(r in e.vectors2)s.setVector2(r,ne.FromArray(e.vectors2[r]));for(r in e.vectors3)s.setVector3(r,y.FromArray(e.vectors3[r]));for(r in e.vectors4)s.setVector4(r,Oe.FromArray(e.vectors4[r]));for(r in e.quaternions)s.setQuaternion(r,se.FromArray(e.quaternions[r]));for(r in e.matrices)s.setMatrix(r,L.FromArray(e.matrices[r]));for(r in e.matrixArray)s._matrixArrays[r]=new Float32Array(e.matrixArray[r]);for(r in e.matrices3x3)s.setMatrix3x3(r,e.matrices3x3[r]);for(r in e.matrices2x2)s.setMatrix2x2(r,e.matrices2x2[r]);for(r in e.vectors2Arrays)s.setArray2(r,e.vectors2Arrays[r]);for(r in e.vectors3Arrays)s.setArray3(r,e.vectors3Arrays[r]);for(r in e.vectors4Arrays)s.setArray4(r,e.vectors4Arrays[r]);for(r in e.quaternionsArrays)s.setArray4(r,e.quaternionsArrays[r]);return s}static ParseFromFileAsync(e,t,i,s=""){return new Promise((r,a)=>{const o=new Wt;o.addEventListener("readystatechange",()=>{if(o.readyState==4)if(o.status==200){const l=JSON.parse(o.responseText),h=this.Parse(l,i||Ae.LastCreatedScene,s);e&&(h.name=e),r(h)}else a("Unable to load the ShaderMaterial")}),o.open("GET",t),o.send()})}static ParseFromSnippetAsync(e,t,i=""){return new Promise((s,r)=>{const a=new Wt;a.addEventListener("readystatechange",()=>{if(a.readyState==4)if(a.status==200){const o=JSON.parse(JSON.parse(a.responseText).jsonPayload),l=JSON.parse(o.shaderMaterial),h=this.Parse(l,t||Ae.LastCreatedScene,i);h.snippetId=e,s(h)}else r("Unable to load the snippet "+e)}),a.open("GET",this.SnippetUrl+"/"+e.replace(/#/g,"/")),a.send()})}}bn.SnippetUrl="https://snippet.babylonjs.com";bn.CreateFromSnippetAsync=bn.ParseFromSnippetAsync;Tt("BABYLON.ShaderMaterial",bn);O._LinesMeshParser=(n,e)=>Ks.Parse(n,e);class Ks extends O{_isShaderMaterial(e){return e.getClassName()==="ShaderMaterial"}constructor(e,t=null,i=null,s=null,r,a,o,l){super(e,t,i,s,r),this.useVertexColor=a,this.useVertexAlpha=o,this.color=new fe(1,1,1),this.alpha=1,this._shaderLanguage=0,s&&(this.color=s.color.clone(),this.alpha=s.alpha,this.useVertexColor=s.useVertexColor,this.useVertexAlpha=s.useVertexAlpha),this.intersectionThreshold=.1;const h=[],u={attributes:[S.PositionKind],uniforms:["world","viewProjection"],needAlphaBlending:!0,defines:h,useClipPlane:null,shaderLanguage:0};this.useVertexAlpha?u.defines.push("#define VERTEXALPHA"):u.needAlphaBlending=!1,this.useVertexColor?(u.defines.push("#define VERTEXCOLOR"),u.attributes.push(S.ColorKind)):(u.uniforms.push("color"),this._color4=new K),l?this.material=l:(this.getScene().getEngine().isWebGPU&&!Ks.ForceGLSL&&(this._shaderLanguage=1),u.shaderLanguage=this._shaderLanguage,u.extraInitializationsAsync=async()=>{this._shaderLanguage===1?await Promise.all([De(()=>import("./color.vertex-BEpqgzdD.js"),__vite__mapDeps([24,6,7,8])),De(()=>import("./color.fragment-Di-XzAkI.js"),__vite__mapDeps([25,13,14]))]):await Promise.all([De(()=>import("./color.vertex-DI0fiEKS.js"),__vite__mapDeps([26,20,22])),De(()=>import("./color.fragment-D5fZFW3m.js"),[])])},this.material=new bn("colorShader",this.getScene(),"color",u,!1),this.material.doNotSerialize=!0)}isReady(){return this._lineMaterial.isReady(this,!!this._userInstancedBuffersStorage||this.hasThinInstances)?super.isReady():!1}getClassName(){return"LinesMesh"}get material(){return this._lineMaterial}set material(e){this._lineMaterial=e,this._lineMaterial.fillMode=Y.LineListDrawMode}get checkCollisions(){return!1}set checkCollisions(e){}_bind(e,t){if(!this._geometry)return this;const i=this.isUnIndexed?null:this._geometry.getIndexBuffer();if(!this._userInstancedBuffersStorage||this.hasThinInstances?this._geometry._bind(t,i):this._geometry._bind(t,i,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects),!this.useVertexColor&&this._isShaderMaterial(this._lineMaterial)){const{r:s,g:r,b:a}=this.color;this._color4.set(s,r,a,this.alpha),this._lineMaterial.setColor4("color",this._color4)}return this}_draw(e,t,i){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const s=this.getScene().getEngine();return this._unIndexed?s.drawArraysType(Y.LineListDrawMode,e.verticesStart,e.verticesCount,i):s.drawElementsType(Y.LineListDrawMode,e.indexStart,e.indexCount,i),this}dispose(e,t=!1,i){i||this._lineMaterial.dispose(!1,!1,!0),super.dispose(e)}clone(e,t=null,i){return new Ks(e,this.getScene(),t,this,i)}createInstance(e){const t=new uy(e,this);if(this.instancedBuffers){t.instancedBuffers={};for(const i in this.instancedBuffers)t.instancedBuffers[i]=this.instancedBuffers[i]}return t}serialize(e){super.serialize(e),e.color=this.color.asArray(),e.alpha=this.alpha}static Parse(e,t){const i=new Ks(e.name,t);return i.color=fe.FromArray(e.color),i.alpha=e.alpha,i}}Ks.ForceGLSL=!1;class uy extends wh{constructor(e,t){super(e,t),this.intersectionThreshold=t.intersectionThreshold}getClassName(){return"InstancedLinesMesh"}}it.prototype.disableEdgesRendering=function(){return this._edgesRenderer&&(this._edgesRenderer.dispose(),this._edgesRenderer=null),this};it.prototype.enableEdgesRendering=function(n=.95,e=!1,t){return this.disableEdgesRendering(),this._edgesRenderer=new Dh(this,n,e,!0,t),this};Object.defineProperty(it.prototype,"edgesRenderer",{get:function(){return this._edgesRenderer},enumerable:!0,configurable:!0});Ks.prototype.enableEdgesRendering=function(n=.95,e=!1){return this.disableEdgesRendering(),this._edgesRenderer=new d6(this,n,e),this};uy.prototype.enableEdgesRendering=function(n=.95,e=!1){return Ks.prototype.enableEdgesRendering.apply(this,arguments),this};class f6{constructor(){this.edges=[],this.edgesConnectedCount=0}}class Dh{get linesPositions(){return this._linesPositions}get linesNormals(){return this._linesNormals}get linesIndices(){return this._linesIndices}get lineShader(){return this._lineShader}set lineShader(e){this._lineShader=e}static _GetShader(e,t){if(!e._edgeRenderLineShader){const i=new bn("lineShader",e,"line",{attributes:["position","normal"],uniforms:["world","viewProjection","color","width","aspectRatio"],uniformBuffers:["Scene","Mesh"],shaderLanguage:t,extraInitializationsAsync:async()=>{t===1?await Promise.all([De(()=>import("./line.vertex-CR9xK3r9.js"),__vite__mapDeps([27,7,10,11])),De(()=>import("./line.fragment-CRlNXNNe.js"),__vite__mapDeps([28,13,10,15]))]):await Promise.all([De(()=>import("./line.vertex-BiwKpHgo.js"),__vite__mapDeps([29,18])),De(()=>import("./line.fragment-DThy3t1r.js"),[])])}},!1);i.disableDepthWrite=!0,i.backFaceCulling=!1,i.checkReadyOnEveryCall=e.getEngine().isWebGPU,e._edgeRenderLineShader=i,e.onDisposeObservable.add(()=>{e._edgeRenderLineShader.dispose(),e._edgeRenderLineShader=null})}return e._edgeRenderLineShader}get shaderLanguage(){return this._shaderLanguage}constructor(e,t=.95,i=!1,s=!0,r){this.edgesWidthScalerForOrthographic=1e3,this.edgesWidthScalerForPerspective=50,this._linesPositions=new Array,this._linesNormals=new Array,this._linesIndices=new Array,this._buffers={},this._buffersForInstances={},this._checkVerticesInsteadOfIndices=!1,this.isEnabled=!0,this.customInstances=new ti(32),this._shaderLanguage=0,this._source=e,this._checkVerticesInsteadOfIndices=i,this._options=r??null,this._epsilon=t;const a=this._source.getScene().getEngine();a.isWebGPU&&(this._drawWrapper=new o0(a),this._shaderLanguage=1),this._prepareRessources(),s&&((r==null?void 0:r.useAlternateEdgeFinder)??!0?this._generateEdgesLinesAlternate():this._generateEdgesLines()),this._meshRebuildObserver=this._source.onRebuildObservable.add(()=>{this._rebuild()}),this._meshDisposeObserver=this._source.onDisposeObservable.add(()=>{this.dispose()})}_prepareRessources(){this._lineShader||(this._lineShader=Dh._GetShader(this._source.getScene(),this._shaderLanguage))}_rebuild(){let e=this._buffers[S.PositionKind];e&&e._rebuild(),e=this._buffers[S.NormalKind],e&&e._rebuild();const i=this._source.getScene().getEngine();this._ib=i.createIndexBuffer(this._linesIndices)}dispose(){var t;this._source.onRebuildObservable.remove(this._meshRebuildObserver),this._source.onDisposeObservable.remove(this._meshDisposeObserver);let e=this._buffers[S.PositionKind];e&&(e.dispose(),this._buffers[S.PositionKind]=null),e=this._buffers[S.NormalKind],e&&(e.dispose(),this._buffers[S.NormalKind]=null),this._ib&&this._source.getScene().getEngine()._releaseBuffer(this._ib),(t=this._drawWrapper)==null||t.dispose()}_processEdgeForAdjacencies(e,t,i,s,r){return e===i&&t===s||e===s&&t===i?0:e===s&&t===r||e===r&&t===s?1:e===r&&t===i||e===i&&t===r?2:-1}_processEdgeForAdjacenciesWithVertices(e,t,i,s,r){return e.equalsWithEpsilon(i,1e-10)&&t.equalsWithEpsilon(s,1e-10)||e.equalsWithEpsilon(s,1e-10)&&t.equalsWithEpsilon(i,1e-10)?0:e.equalsWithEpsilon(s,1e-10)&&t.equalsWithEpsilon(r,1e-10)||e.equalsWithEpsilon(r,1e-10)&&t.equalsWithEpsilon(s,1e-10)?1:e.equalsWithEpsilon(r,1e-10)&&t.equalsWithEpsilon(i,1e-10)||e.equalsWithEpsilon(i,1e-10)&&t.equalsWithEpsilon(r,1e-10)?2:-1}_checkEdge(e,t,i,s,r){let a;t===void 0?a=!0:a=y.Dot(i[e],i[t])<this._epsilon,a&&this.createLine(s,r,this._linesPositions.length/3)}createLine(e,t,i){this._linesPositions.push(e.x,e.y,e.z,e.x,e.y,e.z,t.x,t.y,t.z,t.x,t.y,t.z),this._linesNormals.push(t.x,t.y,t.z,-1,t.x,t.y,t.z,1,e.x,e.y,e.z,-1,e.x,e.y,e.z,1),this._linesIndices.push(i,i+1,i+2,i,i+2,i+3)}_tessellateTriangle(e,t,i,s){const r=(R,C,I)=>{I>=0&&C.push(I);for(let D=0;D<R.length;++D)C.push(R[D][0])};let a=0;e[1].length>=e[0].length&&e[1].length>=e[2].length?a=1:e[2].length>=e[0].length&&e[2].length>=e[1].length&&(a=2);for(let R=0;R<3;++R)R===a?e[R].sort((C,I)=>C[1]<I[1]?-1:C[1]>I[1]?1:0):e[R].sort((C,I)=>C[1]>I[1]?-1:C[1]<I[1]?1:0);const o=[],l=[];r(e[a],o,-1);const h=o.length;for(let R=a+2;R>=a+1;--R)r(e[R%3],l,R!==a+2?s[i[t+(R+1)%3]]:-1);const u=l.length,c=0,f=0;i.push(s[i[t+a]],o[0],l[0]),i.push(s[i[t+(a+1)%3]],l[u-1],o[h-1]);const d=h<=u,_=d?h:u,p=d?u:h,g=d?h-1:u-1,m=d?0:1;let v=h+u-2,T=d?c:f,A=d?f:c;const b=d?o:l,x=d?l:o;let E=0;for(;v-- >0;){m?i.push(b[T],x[A]):i.push(x[A],b[T]),E+=_;let R;E>=p&&T<g?(R=b[++T],E-=p):R=x[++A],i.push(R)}i[t+0]=i[i.length-3],i[t+1]=i[i.length-2],i[t+2]=i[i.length-1],i.length=i.length-3}_generateEdgesLinesAlternate(){var h,u,c,f,d,_;const e=this._source.getVerticesData(S.PositionKind);let t=this._source.getIndices();if(!t||!e)return;Array.isArray(t)||(t=Array.from(t));const i=((h=this._options)==null?void 0:h.useFastVertexMerger)??!0,s=i?Math.round(-Math.log(((u=this._options)==null?void 0:u.epsilonVertexMerge)??1e-6)/Math.log(10)):((c=this._options)==null?void 0:c.epsilonVertexMerge)??1e-6,r=[],a=[];if(i){const p={};for(let g=0;g<e.length;g+=3){const m=e[g+0],v=e[g+1],T=e[g+2],A=m.toFixed(s)+"|"+v.toFixed(s)+"|"+T.toFixed(s);if(p[A]!==void 0)r.push(p[A]);else{const b=g/3;p[A]=b,r.push(b),a.push(b)}}}else for(let p=0;p<e.length;p+=3){const g=e[p+0],m=e[p+1],v=e[p+2];let T=!1;for(let A=0;A<p&&!T;A+=3){const b=e[A+0],x=e[A+1],E=e[A+2];if(Math.abs(g-b)<s&&Math.abs(m-x)<s&&Math.abs(v-E)<s){r.push(A/3),T=!0;break}}T||(r.push(p/3),a.push(p/3))}if((f=this._options)!=null&&f.applyTessellation){const p=((d=this._options)==null?void 0:d.epsilonVertexAligned)??1e-6,g=[];for(let m=0;m<t.length;m+=3){let v;for(let T=0;T<3;++T){const A=r[t[m+T]],b=r[t[m+(T+1)%3]],x=r[t[m+(T+2)%3]];if(A===b)continue;const E=e[A*3+0],R=e[A*3+1],C=e[A*3+2],I=e[b*3+0],D=e[b*3+1],w=e[b*3+2],z=Math.sqrt((I-E)*(I-E)+(D-R)*(D-R)+(w-C)*(w-C));for(let F=0;F<a.length-1;F++){const W=a[F];if(W===A||W===b||W===x)continue;const X=e[W*3+0],he=e[W*3+1],H=e[W*3+2],G=Math.sqrt((X-E)*(X-E)+(he-R)*(he-R)+(H-C)*(H-C)),k=Math.sqrt((X-I)*(X-I)+(he-D)*(he-D)+(H-w)*(H-w));Math.abs(G+k-z)<p&&(v||(v={index:m,edgesPoints:[[],[],[]]},g.push(v)),v.edgesPoints[T].push([W,G]))}}}for(let m=0;m<g.length;++m){const v=g[m];this._tessellateTriangle(v.edgesPoints,v.index,t,r)}g.length=0}const o={};for(let p=0;p<t.length;p+=3){let g;for(let m=0;m<3;++m){let v=r[t[p+m]],T=r[t[p+(m+1)%3]];const A=r[t[p+(m+2)%3]];if(v===T||(v===A||T===A)&&((_=this._options)!=null&&_.removeDegeneratedTriangles))continue;if(N.Vector3[0].copyFromFloats(e[v*3+0],e[v*3+1],e[v*3+2]),N.Vector3[1].copyFromFloats(e[T*3+0],e[T*3+1],e[T*3+2]),N.Vector3[2].copyFromFloats(e[A*3+0],e[A*3+1],e[A*3+2]),g||(N.Vector3[1].subtractToRef(N.Vector3[0],N.Vector3[3]),N.Vector3[2].subtractToRef(N.Vector3[1],N.Vector3[4]),g=y.Cross(N.Vector3[3],N.Vector3[4]),g.normalize()),v>T){const E=v;v=T,T=E}const b=v+"_"+T,x=o[b];x?x.done||(y.Dot(g,x.normal)<this._epsilon&&this.createLine(N.Vector3[0],N.Vector3[1],this._linesPositions.length/3),x.done=!0):o[b]={normal:g,done:!1,index:p,i:m}}}for(const p in o){const g=o[p];if(!g.done){const m=r[t[g.index+g.i]],v=r[t[g.index+(g.i+1)%3]];N.Vector3[0].copyFromFloats(e[m*3+0],e[m*3+1],e[m*3+2]),N.Vector3[1].copyFromFloats(e[v*3+0],e[v*3+1],e[v*3+2]),this.createLine(N.Vector3[0],N.Vector3[1],this._linesPositions.length/3)}}const l=this._source.getScene().getEngine();this._buffers[S.PositionKind]=new S(l,this._linesPositions,S.PositionKind,!1),this._buffers[S.NormalKind]=new S(l,this._linesNormals,S.NormalKind,!1,!1,4),this._buffersForInstances[S.PositionKind]=this._buffers[S.PositionKind],this._buffersForInstances[S.NormalKind]=this._buffers[S.NormalKind],this._ib=l.createIndexBuffer(this._linesIndices),this._indicesCount=this._linesIndices.length}_generateEdgesLines(){const e=this._source.getVerticesData(S.PositionKind),t=this._source.getIndices();if(!t||!e)return;const i=[],s=[];let r,a;for(r=0;r<t.length;r+=3){a=new f6;const l=t[r],h=t[r+1],u=t[r+2];a.p0=new y(e[l*3],e[l*3+1],e[l*3+2]),a.p1=new y(e[h*3],e[h*3+1],e[h*3+2]),a.p2=new y(e[u*3],e[u*3+1],e[u*3+2]);const c=y.Cross(a.p1.subtract(a.p0),a.p2.subtract(a.p1));c.normalize(),s.push(c),i.push(a)}for(r=0;r<i.length;r++){a=i[r];for(let l=r+1;l<i.length;l++){const h=i[l];if(a.edgesConnectedCount===3)break;if(h.edgesConnectedCount===3)continue;const u=t[l*3],c=t[l*3+1],f=t[l*3+2];for(let d=0;d<3;d++){let _=0;if(a.edges[d]===void 0){switch(d){case 0:this._checkVerticesInsteadOfIndices?_=this._processEdgeForAdjacenciesWithVertices(a.p0,a.p1,h.p0,h.p1,h.p2):_=this._processEdgeForAdjacencies(t[r*3],t[r*3+1],u,c,f);break;case 1:this._checkVerticesInsteadOfIndices?_=this._processEdgeForAdjacenciesWithVertices(a.p1,a.p2,h.p0,h.p1,h.p2):_=this._processEdgeForAdjacencies(t[r*3+1],t[r*3+2],u,c,f);break;case 2:this._checkVerticesInsteadOfIndices?_=this._processEdgeForAdjacenciesWithVertices(a.p2,a.p0,h.p0,h.p1,h.p2):_=this._processEdgeForAdjacencies(t[r*3+2],t[r*3],u,c,f);break}if(_!==-1&&(a.edges[d]=l,h.edges[_]=r,a.edgesConnectedCount++,h.edgesConnectedCount++,a.edgesConnectedCount===3))break}}}}for(r=0;r<i.length;r++){const l=i[r];this._checkEdge(r,l.edges[0],s,l.p0,l.p1),this._checkEdge(r,l.edges[1],s,l.p1,l.p2),this._checkEdge(r,l.edges[2],s,l.p2,l.p0)}const o=this._source.getScene().getEngine();this._buffers[S.PositionKind]=new S(o,this._linesPositions,S.PositionKind,!1),this._buffers[S.NormalKind]=new S(o,this._linesNormals,S.NormalKind,!1,!1,4),this._buffersForInstances[S.PositionKind]=this._buffers[S.PositionKind],this._buffersForInstances[S.NormalKind]=this._buffers[S.NormalKind],this._ib=o.createIndexBuffer(this._linesIndices),this._indicesCount=this._linesIndices.length}isReady(){return this._lineShader.isReady(this._source,this._source.hasInstances&&this.customInstances.length>0||this._source.hasThinInstances)}render(){const e=this._source.getScene(),t=this._lineShader._getDrawWrapper();if(this._drawWrapper&&this._lineShader._setDrawWrapper(this._drawWrapper),!this.isReady()||!e.activeCamera){this._lineShader._setDrawWrapper(t);return}const i=this._source.hasInstances&&this.customInstances.length>0,s=i||this._source.hasThinInstances;let r=0;if(s)if(this._buffersForInstances.world0=this._source.getVertexBuffer("world0"),this._buffersForInstances.world1=this._source.getVertexBuffer("world1"),this._buffersForInstances.world2=this._source.getVertexBuffer("world2"),this._buffersForInstances.world3=this._source.getVertexBuffer("world3"),i){const o=this._source._instanceDataStorage;if(r=this.customInstances.length,!o.instancesData){this._source.getScene()._activeMeshesFrozen||this.customInstances.reset();return}if(!o.isFrozen){let l=0;for(let h=0;h<r;++h)this.customInstances.data[h].copyToArray(o.instancesData,l),l+=16;o.instancesBuffer.updateDirectly(o.instancesData,0,r)}}else r=this._source.thinInstanceCount;const a=e.getEngine();this._lineShader._preBind(),this._source.edgesColor.a!==1?a.setAlphaMode(2):a.setAlphaMode(0),a.bindBuffers(s?this._buffersForInstances:this._buffers,this._ib,this._lineShader.getEffect()),e.resetCachedMaterial(),this._lineShader.setColor4("color",this._source.edgesColor),e.activeCamera.mode===be.ORTHOGRAPHIC_CAMERA?this._lineShader.setFloat("width",this._source.edgesWidth/this.edgesWidthScalerForOrthographic):this._lineShader.setFloat("width",this._source.edgesWidth/this.edgesWidthScalerForPerspective),this._lineShader.setFloat("aspectRatio",a.getAspectRatio(e.activeCamera)),this._lineShader.bind(this._source.getWorldMatrix(),this._source),a.drawElementsType(Y.TriangleFillMode,0,this._indicesCount,r),this._lineShader.unbind(),s&&a.unbindInstanceAttributes(),this._source.getScene()._activeMeshesFrozen||this.customInstances.reset(),this._lineShader._setDrawWrapper(t)}}class d6 extends Dh{constructor(e,t=.95,i=!1){super(e,t,i,!1),this._generateEdgesLines()}_generateEdgesLines(){const e=this._source.getVerticesData(S.PositionKind),t=this._source.getIndices();if(!t||!e)return;const i=N.Vector3[0],s=N.Vector3[1],r=t.length-1;for(let o=0,l=0;o<r;o+=2,l+=4)y.FromArrayToRef(e,3*t[o],i),y.FromArrayToRef(e,3*t[o+1],s),this.createLine(i,s,l);const a=this._source.getScene().getEngine();this._buffers[S.PositionKind]=new S(a,this._linesPositions,S.PositionKind,!1),this._buffers[S.NormalKind]=new S(a,this._linesNormals,S.NormalKind,!1,!1,4),this._ib=a.createIndexBuffer(this._linesIndices),this._indicesCount=this._linesIndices.length}}class Ts{constructor(){this.materials=[]}parseMTL(e,t,i,s){if(t instanceof ArrayBuffer)return;const r=t.split(`
`),a=/\s+/;let o,l=null;for(let h=0;h<r.length;h++){const u=r[h].trim();if(u.length===0||u.charAt(0)==="#")continue;const c=u.indexOf(" ");let f=c>=0?u.substring(0,c):u;f=f.toLowerCase();const d=c>=0?u.substring(c+1).trim():"";if(f==="newmtl")l&&this.materials.push(l),e._blockEntityCollection=!!s,l=new ee(d,e),l._parentContainer=s,e._blockEntityCollection=!1;else if(f==="kd"&&l)o=d.split(a,3).map(parseFloat),l.diffuseColor=fe.FromArray(o);else if(f==="ka"&&l)o=d.split(a,3).map(parseFloat),l.ambientColor=fe.FromArray(o);else if(f==="ks"&&l)o=d.split(a,3).map(parseFloat),l.specularColor=fe.FromArray(o);else if(f==="ke"&&l)o=d.split(a,3).map(parseFloat),l.emissiveColor=fe.FromArray(o);else if(f==="ns"&&l)l.specularPower=parseFloat(d);else if(f==="d"&&l)l.alpha=parseFloat(d);else if(f==="map_ka"&&l)l.ambientTexture=Ts._GetTexture(i,d,e);else if(f==="map_kd"&&l)l.diffuseTexture=Ts._GetTexture(i,d,e);else if(f==="map_ks"&&l)l.specularTexture=Ts._GetTexture(i,d,e);else if(f!=="map_ns")if(f==="map_bump"&&l){const _=d.split(a),p=_.indexOf("-bm");let g=null;p>=0&&(g=_[p+1],_.splice(p,2)),l.bumpTexture=Ts._GetTexture(i,_.join(" "),e),l.bumpTexture&&g!==null&&(l.bumpTexture.level=parseFloat(g))}else f==="map_d"&&l&&(l.opacityTexture=Ts._GetTexture(i,d,e))}l&&this.materials.push(l)}static _GetTexture(e,t,i){if(!t)return null;let s=e;if(e==="file:"){let r=t.lastIndexOf("\\");r===-1&&(r=t.lastIndexOf("/")),r>-1?s+=t.substring(r+1):s+=t}else s+=t;return new ie(s,i,!1,Ts.INVERT_TEXTURE_Y)}}Ts.INVERT_TEXTURE_Y=!0;class Ye{constructor(e,t,i){this._positions=[],this._normals=[],this._uvs=[],this._colors=[],this._extColors=[],this._meshesFromObj=[],this._indicesForBabylon=[],this._wrappedPositionForBabylon=[],this._wrappedUvsForBabylon=[],this._wrappedColorsForBabylon=[],this._wrappedNormalsForBabylon=[],this._tuplePosNorm=[],this._curPositionInIndices=0,this._hasMeshes=!1,this._unwrappedPositionsForBabylon=[],this._unwrappedColorsForBabylon=[],this._unwrappedNormalsForBabylon=[],this._unwrappedUVForBabylon=[],this._triangles=[],this._materialNameFromObj="",this._objMeshName="",this._increment=1,this._isFirstMaterial=!0,this._grayColor=new K(.5,.5,.5,1),this._hasLineData=!1,this._materialToUse=e,this._babylonMeshesArray=t,this._loadingOptions=i}_isInArray(e,t){e[t[0]]||(e[t[0]]={normals:[],idx:[]});const i=e[t[0]].normals.indexOf(t[1]);return i===-1?-1:e[t[0]].idx[i]}_isInArrayUV(e,t){e[t[0]]||(e[t[0]]={normals:[],idx:[],uv:[]});const i=e[t[0]].normals.indexOf(t[1]);return i!=1&&t[2]===e[t[0]].uv[i]?e[t[0]].idx[i]:-1}_setData(e,t,i,s,r,a,o){let l;this._loadingOptions.optimizeWithUV?l=this._isInArrayUV(this._tuplePosNorm,[e,i,t]):l=this._isInArray(this._tuplePosNorm,[e,i]),l===-1?(this._indicesForBabylon.push(this._wrappedPositionForBabylon.length),this._wrappedPositionForBabylon.push(s),r=r??new ne(0,0),this._wrappedUvsForBabylon.push(r),this._wrappedNormalsForBabylon.push(a),o!==void 0&&this._wrappedColorsForBabylon.push(o),this._tuplePosNorm[e].normals.push(i),this._tuplePosNorm[e].idx.push(this._curPositionInIndices++),this._loadingOptions.optimizeWithUV&&this._tuplePosNorm[e].uv.push(t)):this._indicesForBabylon.push(l)}_unwrapData(){try{for(let e=0;e<this._wrappedPositionForBabylon.length;e++)this._unwrappedPositionsForBabylon.push(this._wrappedPositionForBabylon[e].x*this._handednessSign,this._wrappedPositionForBabylon[e].y,this._wrappedPositionForBabylon[e].z),this._unwrappedNormalsForBabylon.push(this._wrappedNormalsForBabylon[e].x*this._handednessSign,this._wrappedNormalsForBabylon[e].y,this._wrappedNormalsForBabylon[e].z),this._unwrappedUVForBabylon.push(this._wrappedUvsForBabylon[e].x,this._wrappedUvsForBabylon[e].y),this._loadingOptions.importVertexColors&&this._unwrappedColorsForBabylon.push(this._wrappedColorsForBabylon[e].r,this._wrappedColorsForBabylon[e].g,this._wrappedColorsForBabylon[e].b,this._wrappedColorsForBabylon[e].a);this._wrappedPositionForBabylon.length=0,this._wrappedNormalsForBabylon.length=0,this._wrappedUvsForBabylon.length=0,this._wrappedColorsForBabylon.length=0,this._tuplePosNorm.length=0,this._curPositionInIndices=0}catch{throw new Error("Unable to unwrap data while parsing OBJ data.")}}_getTriangles(e,t){for(let i=t;i<e.length-1;i++)this._pushTriangle(e,i)}_getColor(e){if(this._loadingOptions.importVertexColors)return this._extColors[e]??this._colors[e]}_setDataForCurrentFaceWithPattern1(e,t){this._getTriangles(e,t);for(let i=0;i<this._triangles.length;i++){const s=parseInt(this._triangles[i])-1;this._setData(s,0,0,this._positions[s],ne.Zero(),y.Up(),this._getColor(s))}this._triangles.length=0}_setDataForCurrentFaceWithPattern2(e,t){this._getTriangles(e,t);for(let i=0;i<this._triangles.length;i++){const s=this._triangles[i].split("/"),r=parseInt(s[0])-1,a=parseInt(s[1])-1;this._setData(r,a,0,this._positions[r],this._uvs[a]??ne.Zero(),y.Up(),this._getColor(r))}this._triangles.length=0}_setDataForCurrentFaceWithPattern3(e,t){this._getTriangles(e,t);for(let i=0;i<this._triangles.length;i++){const s=this._triangles[i].split("/"),r=parseInt(s[0])-1,a=parseInt(s[1])-1,o=parseInt(s[2])-1;this._setData(r,a,o,this._positions[r],this._uvs[a]??ne.Zero(),this._normals[o]??y.Up())}this._triangles.length=0}_setDataForCurrentFaceWithPattern4(e,t){this._getTriangles(e,t);for(let i=0;i<this._triangles.length;i++){const s=this._triangles[i].split("//"),r=parseInt(s[0])-1,a=parseInt(s[1])-1;this._setData(r,1,a,this._positions[r],ne.Zero(),this._normals[a],this._getColor(r))}this._triangles.length=0}_setDataForCurrentFaceWithPattern5(e,t){this._getTriangles(e,t);for(let i=0;i<this._triangles.length;i++){const s=this._triangles[i].split("/"),r=this._positions.length+parseInt(s[0]),a=this._uvs.length+parseInt(s[1]),o=this._normals.length+parseInt(s[2]);this._setData(r,a,o,this._positions[r],this._uvs[a],this._normals[o],this._getColor(r))}this._triangles.length=0}_addPreviousObjMesh(){this._meshesFromObj.length>0&&(this._handledMesh=this._meshesFromObj[this._meshesFromObj.length-1],this._unwrapData(),this._loadingOptions.useLegacyBehavior&&this._indicesForBabylon.reverse(),this._handledMesh.indices=this._indicesForBabylon.slice(),this._handledMesh.positions=this._unwrappedPositionsForBabylon.slice(),this._handledMesh.normals=this._unwrappedNormalsForBabylon.slice(),this._handledMesh.uvs=this._unwrappedUVForBabylon.slice(),this._handledMesh.hasLines=this._hasLineData,this._loadingOptions.importVertexColors&&(this._handledMesh.colors=this._unwrappedColorsForBabylon.slice()),this._indicesForBabylon.length=0,this._unwrappedPositionsForBabylon.length=0,this._unwrappedColorsForBabylon.length=0,this._unwrappedNormalsForBabylon.length=0,this._unwrappedUVForBabylon.length=0,this._hasLineData=!1)}_optimizeNormals(e){const t=e.getVerticesData(S.PositionKind),i=e.getVerticesData(S.NormalKind),s={};if(!t||!i)return;for(let a=0;a<t.length/3;a++){const o=t[a*3+0],l=t[a*3+1],h=t[a*3+2],u=o+"_"+l+"_"+h;let c=s[u];c||(c=[],s[u]=c),c.push(a)}const r=new y;for(const a in s){const o=s[a];if(o.length<2)continue;const l=o[0];for(let h=1;h<o.length;++h){const u=o[h];i[l*3+0]+=i[u*3+0],i[l*3+1]+=i[u*3+1],i[l*3+2]+=i[u*3+2]}r.copyFromFloats(i[l*3+0],i[l*3+1],i[l*3+2]),r.normalize();for(let h=0;h<o.length;++h){const u=o[h];i[u*3+0]=r.x,i[u*3+1]=r.y,i[u*3+2]=r.z}}e.setVerticesData(S.NormalKind,i)}static _IsLineElement(e){return e.startsWith("l")}static _IsObjectElement(e){return e.startsWith("o")}static _IsGroupElement(e){return e.startsWith("g")}static _GetZbrushMRGB(e,t){if(!e.startsWith("mrgb"))return null;if(e=e.replace("mrgb","").trim(),t)return[];const i=/[a-z0-9]/g,s=e.match(i);if(!s||s.length%8!==0)return[];const r=[];for(let a=0;a<s.length/8;a++){const o=s[a*8+2]+s[a*8+3],l=s[a*8+4]+s[a*8+5],h=s[a*8+6]+s[a*8+7];r.push(new K(parseInt(o,16)/255,parseInt(l,16)/255,parseInt(h,16)/255,1))}return r}parse(e,t,i,s,r){var u;t=t.replace(/#MRGB/g,"mrgb"),t=t.replace(/#.*$/gm,"").trim(),this._loadingOptions.useLegacyBehavior?(this._pushTriangle=(c,f)=>this._triangles.push(c[0],c[f],c[f+1]),this._handednessSign=1):i.useRightHandedSystem?(this._pushTriangle=(c,f)=>this._triangles.push(c[0],c[f+1],c[f]),this._handednessSign=1):(this._pushTriangle=(c,f)=>this._triangles.push(c[0],c[f],c[f+1]),this._handednessSign=-1);const a=t.split(`
`),o=[];let l=[];o.push(l);for(let c=0;c<a.length;c++){const f=a[c].trim().replace(/\s\s/g," ");if(!(f.length===0||f.charAt(0)==="#"))if((Ye._IsGroupElement(f)||Ye._IsObjectElement(f))&&(l=[],o.push(l)),Ye._IsLineElement(f)){const d=f.split(" ");for(let _=1;_<d.length-1;_++)l.push(`l ${d[_]} ${d[_+1]}`)}else l.push(f)}const h=o.flat();for(let c=0;c<h.length;c++){const f=h[c].trim().replace(/\s\s/g," ");let d;if(!(f.length===0||f.charAt(0)==="#"))if(Ye.VertexPattern.test(f)){if(d=f.match(/[^ ]+/g),this._positions.push(new y(parseFloat(d[1]),parseFloat(d[2]),parseFloat(d[3]))),this._loadingOptions.importVertexColors)if(d.length>=7){const _=parseFloat(d[4]),p=parseFloat(d[5]),g=parseFloat(d[6]);this._colors.push(new K(_>1?_/255:_,p>1?p/255:p,g>1?g/255:g,d.length===7||d[7]===void 0?1:parseFloat(d[7])))}else this._colors.push(this._grayColor)}else if((d=Ye.NormalPattern.exec(f))!==null)this._normals.push(new y(parseFloat(d[1]),parseFloat(d[2]),parseFloat(d[3])));else if((d=Ye.UVPattern.exec(f))!==null)this._uvs.push(new ne(parseFloat(d[1])*this._loadingOptions.UVScaling.x,parseFloat(d[2])*this._loadingOptions.UVScaling.y));else if((d=Ye.FacePattern3.exec(f))!==null)this._setDataForCurrentFaceWithPattern3(d[1].trim().split(" "),1);else if((d=Ye.FacePattern4.exec(f))!==null)this._setDataForCurrentFaceWithPattern4(d[1].trim().split(" "),1);else if((d=Ye.FacePattern5.exec(f))!==null)this._setDataForCurrentFaceWithPattern5(d[1].trim().split(" "),1);else if((d=Ye.FacePattern2.exec(f))!==null)this._setDataForCurrentFaceWithPattern2(d[1].trim().split(" "),1);else if((d=Ye.FacePattern1.exec(f))!==null)this._setDataForCurrentFaceWithPattern1(d[1].trim().split(" "),1);else if((d=Ye.LinePattern1.exec(f))!==null)this._setDataForCurrentFaceWithPattern1(d[1].trim().split(" "),0),this._hasLineData=!0;else if((d=Ye.LinePattern2.exec(f))!==null)this._setDataForCurrentFaceWithPattern2(d[1].trim().split(" "),0),this._hasLineData=!0;else if(d=Ye._GetZbrushMRGB(f,!this._loadingOptions.importVertexColors))d.forEach(_=>{this._extColors.push(_)});else if((d=Ye.LinePattern3.exec(f))!==null)this._setDataForCurrentFaceWithPattern3(d[1].trim().split(" "),0),this._hasLineData=!0;else if(Ye.GroupDescriptor.test(f)||Ye.ObjectDescriptor.test(f)){const _={name:f.substring(2).trim(),indices:null,positions:null,normals:null,uvs:null,colors:null,materialName:this._materialNameFromObj,isObject:Ye.ObjectDescriptor.test(f)};this._addPreviousObjMesh(),this._meshesFromObj.push(_),this._hasMeshes=!0,this._isFirstMaterial=!0,this._increment=1}else if(Ye.UseMtlDescriptor.test(f)){if(this._materialNameFromObj=f.substring(7).trim(),!this._isFirstMaterial||!this._hasMeshes){this._addPreviousObjMesh();const _={name:(this._objMeshName||"mesh")+"_mm"+this._increment.toString(),indices:null,positions:null,normals:null,uvs:null,colors:null,materialName:this._materialNameFromObj,isObject:!1};this._increment++,this._meshesFromObj.push(_),this._hasMeshes=!0}this._hasMeshes&&this._isFirstMaterial&&(this._meshesFromObj[this._meshesFromObj.length-1].materialName=this._materialNameFromObj,this._isFirstMaterial=!1)}else Ye.MtlLibGroupDescriptor.test(f)?r(f.substring(7).trim()):Ye.SmoothDescriptor.test(f)||U.Log("Unhandled expression at line : "+f)}if(this._hasMeshes&&(this._handledMesh=this._meshesFromObj[this._meshesFromObj.length-1],this._loadingOptions.useLegacyBehavior&&this._indicesForBabylon.reverse(),this._unwrapData(),this._handledMesh.indices=this._indicesForBabylon,this._handledMesh.positions=this._unwrappedPositionsForBabylon,this._handledMesh.normals=this._unwrappedNormalsForBabylon,this._handledMesh.uvs=this._unwrappedUVForBabylon,this._handledMesh.hasLines=this._hasLineData,this._loadingOptions.importVertexColors&&(this._handledMesh.colors=this._unwrappedColorsForBabylon)),!this._hasMeshes){let c=null;if(this._indicesForBabylon.length)this._loadingOptions.useLegacyBehavior&&this._indicesForBabylon.reverse(),this._unwrapData();else{for(const f of this._positions)this._unwrappedPositionsForBabylon.push(f.x,f.y,f.z);if(this._normals.length)for(const f of this._normals)this._unwrappedNormalsForBabylon.push(f.x,f.y,f.z);if(this._uvs.length)for(const f of this._uvs)this._unwrappedUVForBabylon.push(f.x,f.y);if(this._extColors.length)for(const f of this._extColors)this._unwrappedColorsForBabylon.push(f.r,f.g,f.b,f.a);else if(this._colors.length)for(const f of this._colors)this._unwrappedColorsForBabylon.push(f.r,f.g,f.b,f.a);this._materialNameFromObj||(c=new ee(Jt.RandomId(),i),c.pointsCloud=!0,this._materialNameFromObj=c.name,this._normals.length||(c.disableLighting=!0,c.emissiveColor=fe.White()))}this._meshesFromObj.push({name:Jt.RandomId(),indices:this._indicesForBabylon,positions:this._unwrappedPositionsForBabylon,colors:this._unwrappedColorsForBabylon,normals:this._unwrappedNormalsForBabylon,uvs:this._unwrappedUVForBabylon,materialName:this._materialNameFromObj,directMaterial:c,isObject:!0,hasLines:this._hasLineData})}for(let c=0;c<this._meshesFromObj.length;c++){if(e&&this._meshesFromObj[c].name){if(e instanceof Array){if(e.indexOf(this._meshesFromObj[c].name)===-1)continue}else if(this._meshesFromObj[c].name!==e)continue}this._handledMesh=this._meshesFromObj[c],i._blockEntityCollection=!!s;const f=new O(this._meshesFromObj[c].name,i);if(f._parentContainer=s,i._blockEntityCollection=!1,this._handledMesh._babylonMesh=f,!this._handledMesh.isObject){for(let _=c-1;_>=0;--_)if(this._meshesFromObj[_].isObject&&this._meshesFromObj[_]._babylonMesh){f.parent=this._meshesFromObj[_]._babylonMesh;break}}if(this._materialToUse.push(this._meshesFromObj[c].materialName),this._handledMesh.hasLines&&(f._internalMetadata??(f._internalMetadata={}),f._internalMetadata._isLine=!0),((u=this._handledMesh.positions)==null?void 0:u.length)===0){this._babylonMeshesArray.push(f);continue}const d=new Q;if(d.uvs=this._handledMesh.uvs,d.indices=this._handledMesh.indices,d.positions=this._handledMesh.positions,this._loadingOptions.computeNormals){const _=new Array;Q.ComputeNormals(this._handledMesh.positions,this._handledMesh.indices,_),d.normals=_}else d.normals=this._handledMesh.normals;this._loadingOptions.importVertexColors&&(d.colors=this._handledMesh.colors),d.applyToMesh(f),this._loadingOptions.invertY&&(f.scaling.y*=-1),this._loadingOptions.optimizeNormals&&this._optimizeNormals(f),this._babylonMeshesArray.push(f),this._handledMesh.directMaterial&&(f.material=this._handledMesh.directMaterial)}}}Ye.ObjectDescriptor=/^o/;Ye.GroupDescriptor=/^g/;Ye.MtlLibGroupDescriptor=/^mtllib /;Ye.UseMtlDescriptor=/^usemtl /;Ye.SmoothDescriptor=/^s /;Ye.VertexPattern=/^v(\s+[\d|.|+|\-|e|E]+){3,7}/;Ye.NormalPattern=/^vn(\s+[\d|.|+|\-|e|E]+)( +[\d|.|+|\-|e|E]+)( +[\d|.|+|\-|e|E]+)/;Ye.UVPattern=/^vt(\s+[\d|.|+|\-|e|E]+)( +[\d|.|+|\-|e|E]+)/;Ye.FacePattern1=/^f\s+(([\d]{1,}[\s]?){3,})+/;Ye.FacePattern2=/^f\s+((([\d]{1,}\/[\d]{1,}[\s]?){3,})+)/;Ye.FacePattern3=/^f\s+((([\d]{1,}\/[\d]{1,}\/[\d]{1,}[\s]?){3,})+)/;Ye.FacePattern4=/^f\s+((([\d]{1,}\/\/[\d]{1,}[\s]?){3,})+)/;Ye.FacePattern5=/^f\s+(((-[\d]{1,}\/-[\d]{1,}\/-[\d]{1,}[\s]?){3,})+)/;Ye.LinePattern1=/^l\s+(([\d]{1,}[\s]?){2,})+/;Ye.LinePattern2=/^l\s+((([\d]{1,}\/[\d]{1,}[\s]?){2,})+)/;Ye.LinePattern3=/^l\s+((([\d]{1,}\/[\d]{1,}\/[\d]{1,}[\s]?){2,})+)/;class cy{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.particleSystems=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.sounds=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(e){this._environmentTexture=e}getNodes(){let e=[];return e=e.concat(this.meshes),e=e.concat(this.lights),e=e.concat(this.cameras),e=e.concat(this.transformNodes),this.skeletons.forEach(t=>e=e.concat(t.bones)),e}}class _6 extends cy{}class p6{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){this.rootNodes.slice(0).forEach(e=>{e.dispose()}),this.rootNodes.length=0,this.skeletons.slice(0).forEach(e=>{e.dispose()}),this.skeletons.length=0,this.animationGroups.slice(0).forEach(e=>{e.dispose()}),this.animationGroups.length=0}}class g6 extends cy{constructor(e){super(),this._wasAddedToScene=!1,e=e||Ae.LastCreatedScene,e&&(this.scene=e,this.proceduralTextures=[],e.onDisposeObservable.add(()=>{this._wasAddedToScene||this.dispose()}),this._onContextRestoredObserver=e.getEngine().onContextRestoredObservable.add(()=>{for(const t of this.geometries)t._rebuild();for(const t of this.meshes)t._rebuild();for(const t of this.particleSystems)t.rebuild();for(const t of this.textures)t._rebuild()}))}_topologicalSort(e){const t=new Map;for(const o of e)t.set(o.uniqueId,o);const i={dependsOn:new Map,dependedBy:new Map};for(const o of e){const l=o.uniqueId;i.dependsOn.set(l,new Set),i.dependedBy.set(l,new Set)}for(const o of e){const l=o.uniqueId,h=i.dependsOn.get(l);if(o instanceof wh){const c=o.sourceMesh;t.has(c.uniqueId)&&(h.add(c.uniqueId),i.dependedBy.get(c.uniqueId).add(l))}const u=i.dependedBy.get(l);for(const c of o.getDescendants()){const f=c.uniqueId;t.has(f)&&(u.add(f),i.dependsOn.get(f).add(l))}}const s=[],r=[];for(const o of e){const l=o.uniqueId;i.dependsOn.get(l).size===0&&(r.push(o),t.delete(l))}const a=r;for(;a.length>0;){const o=a.shift();s.push(o);const l=i.dependedBy.get(o.uniqueId);for(const h of Array.from(l.values())){const u=i.dependsOn.get(h);u.delete(o.uniqueId),u.size===0&&t.get(h)&&(a.push(t.get(h)),t.delete(h))}}return t.size>0&&(U.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),t.forEach(o=>U.Error(o.name))),s}_addNodeAndDescendantsToList(e,t,i,s){if(!(!i||s&&!s(i)||t.has(i.uniqueId))){e.push(i),t.add(i.uniqueId);for(const r of i.getDescendants(!0))this._addNodeAndDescendantsToList(e,t,r,s)}}_isNodeInContainer(e){return e instanceof it&&this.meshes.indexOf(e)!==-1||e instanceof Re&&this.transformNodes.indexOf(e)!==-1||e instanceof Be&&this.lights.indexOf(e)!==-1||e instanceof be&&this.cameras.indexOf(e)!==-1}_isValidHierarchy(){for(const e of this.meshes)if(e.parent&&!this._isNodeInContainer(e.parent))return U.Warn(`Node ${e.name} has a parent that is not in the container.`),!1;for(const e of this.transformNodes)if(e.parent&&!this._isNodeInContainer(e.parent))return U.Warn(`Node ${e.name} has a parent that is not in the container.`),!1;for(const e of this.lights)if(e.parent&&!this._isNodeInContainer(e.parent))return U.Warn(`Node ${e.name} has a parent that is not in the container.`),!1;for(const e of this.cameras)if(e.parent&&!this._isNodeInContainer(e.parent))return U.Warn(`Node ${e.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(e,t=!1,i){this._isValidHierarchy()||Z.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const s={},r={},a=new p6,o=[],l=[],h={doNotInstantiate:!0,...i},u=(p,g)=>{if(s[p.uniqueId]=g.uniqueId,r[g.uniqueId]=g,e&&(g.name=e(p.name)),g instanceof O){const m=g;if(m.morphTargetManager){const v=p.morphTargetManager;m.morphTargetManager=v.clone();for(let T=0;T<v.numTargets;T++){const A=v.getTarget(T),b=m.morphTargetManager.getTarget(T);s[A.uniqueId]=b.uniqueId,r[b.uniqueId]=b}}}},c=[],f=new Set;for(const p of this.transformNodes)p.parent===null&&this._addNodeAndDescendantsToList(c,f,p,h.predicate);for(const p of this.meshes)p.parent===null&&this._addNodeAndDescendantsToList(c,f,p,h.predicate);const d=this._topologicalSort(c),_=(p,g)=>{if(u(p,g),p.parent){const m=s[p.parent.uniqueId],v=r[m];v?g.parent=v:g.parent=p.parent}if(g.position&&p.position&&g.position.copyFrom(p.position),g.rotationQuaternion&&p.rotationQuaternion&&g.rotationQuaternion.copyFrom(p.rotationQuaternion),g.rotation&&p.rotation&&g.rotation.copyFrom(p.rotation),g.scaling&&p.scaling&&g.scaling.copyFrom(p.scaling),g.material){const m=g;if(m.material)if(t){const v=p.material;if(l.indexOf(v)===-1){let T=v.clone(e?e(v.name):"Clone of "+v.name);if(l.push(v),s[v.uniqueId]=T.uniqueId,r[T.uniqueId]=T,v.getClassName()==="MultiMaterial"){const A=v;for(const b of A.subMaterials)b&&(T=b.clone(e?e(b.name):"Clone of "+b.name),l.push(b),s[b.uniqueId]=T.uniqueId,r[T.uniqueId]=T);A.subMaterials=A.subMaterials.map(b=>b&&r[s[b.uniqueId]])}}m.getClassName()!=="InstancedMesh"&&(m.material=r[s[v.uniqueId]])}else m.material.getClassName()==="MultiMaterial"?this.scene.multiMaterials.indexOf(m.material)===-1&&this.scene.addMultiMaterial(m.material):this.scene.materials.indexOf(m.material)===-1&&this.scene.addMaterial(m.material)}g.parent===null&&a.rootNodes.push(g)};return d.forEach(p=>{if(p.getClassName()==="InstancedMesh"){const g=p,m=g.sourceMesh,v=s[m.uniqueId],A=(typeof v=="number"?r[v]:m).createInstance(g.name);_(g,A)}else{let g=!0;p.getClassName()==="TransformNode"||p.getClassName()==="Node"||p.skeleton||!p.getTotalVertices||p.getTotalVertices()===0?g=!1:h.doNotInstantiate&&(typeof h.doNotInstantiate=="function"?g=!h.doNotInstantiate(p):g=!h.doNotInstantiate);const m=g?p.createInstance(`instance of ${p.name}`):p.clone(`Clone of ${p.name}`,null,!0);if(!m)throw new Error(`Could not clone or instantiate node on Asset Container ${p.name}`);_(p,m)}}),this.skeletons.forEach(p=>{if(h.predicate&&!h.predicate(p))return;const g=p.clone(e?e(p.name):"Clone of "+p.name);for(const m of this.meshes)if(m.skeleton===p&&!m.isAnInstance){const v=r[s[m.uniqueId]];if(!v||v.isAnInstance||(v.skeleton=g,o.indexOf(g)!==-1))continue;o.push(g);for(const T of g.bones)T._linkedTransformNode&&(T._linkedTransformNode=r[s[T._linkedTransformNode.uniqueId]])}a.skeletons.push(g)}),this.animationGroups.forEach(p=>{if(h.predicate&&!h.predicate(p))return;const g=p.clone(e?e(p.name):"Clone of "+p.name,m=>r[s[m.uniqueId]]||m);a.animationGroups.push(g)}),a}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||Z.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.scene.environmentTexture=this.environmentTexture);for(const e of this.scene._serializableComponents)e.addFromContainer(this);this.scene.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(e=null){const t=[];this.cameras.forEach(i=>{e&&!e(i)||(this.scene.addCamera(i),t.push(i))}),this.lights.forEach(i=>{e&&!e(i)||(this.scene.addLight(i),t.push(i))}),this.meshes.forEach(i=>{e&&!e(i)||(this.scene.addMesh(i),t.push(i))}),this.skeletons.forEach(i=>{e&&!e(i)||this.scene.addSkeleton(i)}),this.animations.forEach(i=>{e&&!e(i)||this.scene.addAnimation(i)}),this.animationGroups.forEach(i=>{e&&!e(i)||this.scene.addAnimationGroup(i)}),this.multiMaterials.forEach(i=>{e&&!e(i)||this.scene.addMultiMaterial(i)}),this.materials.forEach(i=>{e&&!e(i)||this.scene.addMaterial(i)}),this.morphTargetManagers.forEach(i=>{e&&!e(i)||this.scene.addMorphTargetManager(i)}),this.geometries.forEach(i=>{e&&!e(i)||this.scene.addGeometry(i)}),this.transformNodes.forEach(i=>{e&&!e(i)||(this.scene.addTransformNode(i),t.push(i))}),this.actionManagers.forEach(i=>{e&&!e(i)||this.scene.addActionManager(i)}),this.textures.forEach(i=>{e&&!e(i)||this.scene.addTexture(i)}),this.reflectionProbes.forEach(i=>{e&&!e(i)||this.scene.addReflectionProbe(i)});for(const i of t)i.parent&&this.scene.getNodes().indexOf(i.parent)===-1&&(i.setParent?i.setParent(null):i.parent=null)}removeAllFromScene(){this._isValidHierarchy()||Z.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.scene.environmentTexture&&(this.scene.environmentTexture=null);for(const e of this.scene._serializableComponents)e.removeFromContainer(this)}removeFromScene(e=null){this.cameras.forEach(t=>{e&&!e(t)||this.scene.removeCamera(t)}),this.lights.forEach(t=>{e&&!e(t)||this.scene.removeLight(t)}),this.meshes.forEach(t=>{e&&!e(t)||this.scene.removeMesh(t,!0)}),this.skeletons.forEach(t=>{e&&!e(t)||this.scene.removeSkeleton(t)}),this.animations.forEach(t=>{e&&!e(t)||this.scene.removeAnimation(t)}),this.animationGroups.forEach(t=>{e&&!e(t)||this.scene.removeAnimationGroup(t)}),this.multiMaterials.forEach(t=>{e&&!e(t)||this.scene.removeMultiMaterial(t)}),this.materials.forEach(t=>{e&&!e(t)||this.scene.removeMaterial(t)}),this.morphTargetManagers.forEach(t=>{e&&!e(t)||this.scene.removeMorphTargetManager(t)}),this.geometries.forEach(t=>{e&&!e(t)||this.scene.removeGeometry(t)}),this.transformNodes.forEach(t=>{e&&!e(t)||this.scene.removeTransformNode(t)}),this.actionManagers.forEach(t=>{e&&!e(t)||this.scene.removeActionManager(t)}),this.textures.forEach(t=>{e&&!e(t)||this.scene.removeTexture(t)}),this.reflectionProbes.forEach(t=>{e&&!e(t)||this.scene.removeReflectionProbe(t)})}dispose(){this.cameras.slice(0).forEach(e=>{e.dispose()}),this.cameras.length=0,this.lights.slice(0).forEach(e=>{e.dispose()}),this.lights.length=0,this.meshes.slice(0).forEach(e=>{e.dispose()}),this.meshes.length=0,this.skeletons.slice(0).forEach(e=>{e.dispose()}),this.skeletons.length=0,this.animationGroups.slice(0).forEach(e=>{e.dispose()}),this.animationGroups.length=0,this.multiMaterials.slice(0).forEach(e=>{e.dispose()}),this.multiMaterials.length=0,this.materials.slice(0).forEach(e=>{e.dispose()}),this.materials.length=0,this.geometries.slice(0).forEach(e=>{e.dispose()}),this.geometries.length=0,this.transformNodes.slice(0).forEach(e=>{e.dispose()}),this.transformNodes.length=0,this.actionManagers.slice(0).forEach(e=>{e.dispose()}),this.actionManagers.length=0,this.textures.slice(0).forEach(e=>{e.dispose()}),this.textures.length=0,this.reflectionProbes.slice(0).forEach(e=>{e.dispose()}),this.reflectionProbes.length=0,this.morphTargetManagers.slice(0).forEach(e=>{e.dispose()}),this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const e of this.scene._serializableComponents)e.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.scene.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(e,t,i){if(!(!e||!t))for(const s of e){let r=!0;if(i){for(const a of i)if(s===a){r=!1;break}}r&&(t.push(s),s._parentContainer=this)}}moveAllFromScene(e){this._wasAddedToScene=!1,e===void 0&&(e=new _6);for(const t in this)Object.prototype.hasOwnProperty.call(this,t)&&(this[t]=this[t]||(t==="_environmentTexture"?null:[]),this._moveAssets(this.scene[t],this[t],e[t]));this.environmentTexture=this.scene.environmentTexture,this.removeAllFromScene()}createRootMesh(){const e=new O("assetContainerRootMesh",this.scene);return this.meshes.forEach(t=>{t.parent||e.addChild(t)}),this.meshes.unshift(e),e}mergeAnimationsTo(e=Ae.LastCreatedScene,t,i=null){if(!e)return U.Error("No scene available to merge animations to"),[];const s=i||(o=>{let l=null;const h=o.animations.length?o.animations[0].targetProperty:"",u=o.name.split(".").join("").split("_primitive")[0];switch(h){case"position":case"rotationQuaternion":l=e.getTransformNodeByName(o.name)||e.getTransformNodeByName(u);break;case"influence":l=e.getMorphTargetByName(o.name)||e.getMorphTargetByName(u);break;default:l=e.getNodeByName(o.name)||e.getNodeByName(u)}return l});this.getNodes().forEach(o=>{const l=s(o);if(l!==null){for(const h of o.animations){const u=l.animations.filter(c=>c.targetProperty===h.targetProperty);for(const c of u){const f=l.animations.indexOf(c,0);f>-1&&l.animations.splice(f,1)}}l.animations=l.animations.concat(o.animations)}});const a=[];return this.animationGroups.slice().forEach(o=>{a.push(o.clone(o.name,s)),o.animatables.forEach(l=>{l.stop()})}),t.forEach(o=>{const l=s(o.target);l&&(e.beginAnimation(l,o.fromFrame,o.toFrame,o.loopAnimation,o.speedRatio,o.onAnimationEnd?o.onAnimationEnd:void 0,void 0,!0,void 0,o.onAnimationLoop?o.onAnimationLoop:void 0),e.stopAnimation(o.target))}),a}populateRootNodes(){this.rootNodes.length=0,this.meshes.forEach(e=>{!e.parent&&this.rootNodes.indexOf(e)===-1&&this.rootNodes.push(e)}),this.transformNodes.forEach(e=>{!e.parent&&this.rootNodes.indexOf(e)===-1&&this.rootNodes.push(e)}),this.lights.forEach(e=>{!e.parent&&this.rootNodes.indexOf(e)===-1&&this.rootNodes.push(e)}),this.cameras.forEach(e=>{!e.parent&&this.rootNodes.indexOf(e)===-1&&this.rootNodes.push(e)})}addAllAssetsToContainer(e){if(!e)return;const t=[],i=new Set;for(t.push(e);t.length>0;){const s=t.pop();if(s instanceof O?(s.geometry&&this.geometries.indexOf(s.geometry)===-1&&this.geometries.push(s.geometry),this.meshes.push(s)):s instanceof Re?this.transformNodes.push(s):s instanceof Be?this.lights.push(s):s instanceof be&&this.cameras.push(s),s instanceof it){if(s.material&&this.materials.indexOf(s.material)===-1){this.materials.push(s.material);for(const r of s.material.getActiveTextures())this.textures.indexOf(r)===-1&&this.textures.push(r)}s.skeleton&&this.skeletons.indexOf(s.skeleton)===-1&&this.skeletons.push(s.skeleton),s.morphTargetManager&&this.morphTargetManagers.indexOf(s.morphTargetManager)===-1&&this.morphTargetManagers.push(s.morphTargetManager)}for(const r of s.getChildren())i.has(r)||t.push(r);i.add(s)}this.populateRootNodes()}_getByTags(e,t,i){if(t===void 0)return e;const s=[];for(const r in e){const a=e[r];Ve&&Ve.MatchesQuery(a,t)&&(!i||i(a))&&s.push(a)}return s}getMeshesByTags(e,t){return this._getByTags(this.meshes,e,t)}getCamerasByTags(e,t){return this._getByTags(this.cameras,e,t)}getLightsByTags(e,t){return this._getByTags(this.lights,e,t)}getMaterialsByTags(e,t){return this._getByTags(this.materials,e,t).concat(this._getByTags(this.multiMaterials,e,t))}getTransformNodesByTags(e,t){return this._getByTags(this.transformNodes,e,t)}}const Iu={name:"obj",extensions:".obj"};class Ot{static get INVERT_TEXTURE_Y(){return Ts.INVERT_TEXTURE_Y}static set INVERT_TEXTURE_Y(e){Ts.INVERT_TEXTURE_Y=e}constructor(e){this.name=Iu.name,this.extensions=Iu.extensions,this._assetContainer=null,this._loadingOptions={...Ot._DefaultLoadingOptions,...e??{}}}static get _DefaultLoadingOptions(){return{computeNormals:Ot.COMPUTE_NORMALS,optimizeNormals:Ot.OPTIMIZE_NORMALS,importVertexColors:Ot.IMPORT_VERTEX_COLORS,invertY:Ot.INVERT_Y,invertTextureY:Ot.INVERT_TEXTURE_Y,UVScaling:Ot.UV_SCALING,materialLoadingFailsSilently:Ot.MATERIAL_LOADING_FAILS_SILENTLY,optimizeWithUV:Ot.OPTIMIZE_WITH_UV,skipMaterials:Ot.SKIP_MATERIALS,useLegacyBehavior:Ot.USE_LEGACY_BEHAVIOR}}_loadMTL(e,t,i,s){const r=t+e;Z.LoadFile(r,i,void 0,void 0,!1,(a,o)=>{s(r,o)})}createPlugin(e){return new Ot(e[Iu.name])}canDirectLoad(){return!1}importMeshAsync(e,t,i,s){return this._parseSolid(e,t,i,s).then(r=>({meshes:r,particleSystems:[],skeletons:[],animationGroups:[],transformNodes:[],geometries:[],lights:[],spriteManagers:[]}))}loadAsync(e,t,i){return this.importMeshAsync(null,e,t,i).then(()=>{})}loadAssetContainerAsync(e,t,i){const s=new g6(e);return this._assetContainer=s,this.importMeshAsync(null,e,t,i).then(r=>(r.meshes.forEach(a=>s.meshes.push(a)),r.meshes.forEach(a=>{const o=a.material;o&&s.materials.indexOf(o)==-1&&(s.materials.push(o),o.getActiveTextures().forEach(h=>{s.textures.indexOf(h)==-1&&s.textures.push(h)}))}),this._assetContainer=null,s)).catch(r=>{throw this._assetContainer=null,r})}_parseSolid(e,t,i,s){let r="";const a=new Ts,o=[],l=[];i=i.replace(/#.*$/gm,"").trim(),new Ye(o,l,this._loadingOptions).parse(e,i,t,this._assetContainer,c=>{r=c});const u=[];return r!==""&&!this._loadingOptions.skipMaterials&&u.push(new Promise((c,f)=>{this._loadMTL(r,s,d=>{try{a.parseMTL(t,d,s,this._assetContainer);for(let _=0;_<a.materials.length;_++){let p=0;const g=[];let m;for(;(m=o.indexOf(a.materials[_].name,p))>-1;)g.push(m),p=m+1;if(m===-1&&g.length===0)a.materials[_].dispose();else for(let v=0;v<g.length;v++){const T=l[g[v]],A=a.materials[_];T.material=A,T.getTotalIndices()||(A.pointsCloud=!0)}}c()}catch(_){Z.Warn(`Error processing MTL file: '${r}'`),this._loadingOptions.materialLoadingFailsSilently?c():f(_)}},(d,_)=>{Z.Warn(`Error downloading MTL file: '${r}'`),this._loadingOptions.materialLoadingFailsSilently?c():f(_)})})),Promise.all(u).then(()=>{const c=f=>{var d;return!!(((d=f._internalMetadata)==null?void 0:d._isLine)??!1)};return l.forEach(f=>{if(c(f)){let d=f.material??new ee(f.name+"_line",t);d.getBindedMeshes().filter(p=>!c(p)).length>0&&(d=d.clone(d.name+"_line")??d),d.wireframe=!0,f.material=d,f._internalMetadata&&(f._internalMetadata._isLine=void 0)}}),l})}}Ot.OPTIMIZE_WITH_UV=!0;Ot.INVERT_Y=!1;Ot.IMPORT_VERTEX_COLORS=!1;Ot.COMPUTE_NORMALS=!1;Ot.OPTIMIZE_NORMALS=!1;Ot.UV_SCALING=new ne(1,1);Ot.SKIP_MATERIALS=!1;Ot.MATERIAL_LOADING_FAILS_SILENTLY=!0;Ot.USE_LEGACY_BEHAVIOR=!1;sy(new Ot);class Ge{constructor(e,t,i=Number.MAX_VALUE,s=Ue){this.origin=e,this.direction=t,this.length=i,this.epsilon=s}clone(){return new Ge(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(e,t,i=0){const s=Ge._TmpVector3[0].copyFromFloats(e.x-i,e.y-i,e.z-i),r=Ge._TmpVector3[1].copyFromFloats(t.x+i,t.y+i,t.z+i);let a=0,o=Number.MAX_VALUE,l,h,u,c;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<s.x||this.origin.x>r.x)return!1}else if(l=1/this.direction.x,h=(s.x-this.origin.x)*l,u=(r.x-this.origin.x)*l,u===-1/0&&(u=1/0),h>u&&(c=h,h=u,u=c),a=Math.max(h,a),o=Math.min(u,o),a>o)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<s.y||this.origin.y>r.y)return!1}else if(l=1/this.direction.y,h=(s.y-this.origin.y)*l,u=(r.y-this.origin.y)*l,u===-1/0&&(u=1/0),h>u&&(c=h,h=u,u=c),a=Math.max(h,a),o=Math.min(u,o),a>o)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<s.z||this.origin.z>r.z)return!1}else if(l=1/this.direction.z,h=(s.z-this.origin.z)*l,u=(r.z-this.origin.z)*l,u===-1/0&&(u=1/0),h>u&&(c=h,h=u,u=c),a=Math.max(h,a),o=Math.min(u,o),a>o)return!1;return!0}intersectsBox(e,t=0){return this.intersectsBoxMinMax(e.minimum,e.maximum,t)}intersectsSphere(e,t=0){const i=e.center.x-this.origin.x,s=e.center.y-this.origin.y,r=e.center.z-this.origin.z,a=i*i+s*s+r*r,o=e.radius+t,l=o*o;if(a<=l)return!0;const h=i*this.direction.x+s*this.direction.y+r*this.direction.z;return h<0?!1:a-h*h<=l}intersectsTriangle(e,t,i){const s=Ge._TmpVector3[0],r=Ge._TmpVector3[1],a=Ge._TmpVector3[2],o=Ge._TmpVector3[3],l=Ge._TmpVector3[4];t.subtractToRef(e,s),i.subtractToRef(e,r),y.CrossToRef(this.direction,r,a);const h=y.Dot(s,a);if(h===0)return null;const u=1/h;this.origin.subtractToRef(e,o);const c=y.Dot(o,a)*u;if(c<-this.epsilon||c>1+this.epsilon)return null;y.CrossToRef(o,s,l);const f=y.Dot(this.direction,l)*u;if(f<-this.epsilon||c+f>1+this.epsilon)return null;const d=y.Dot(r,l)*u;return d>this.length?null:new Uc(1-c-f,c,d)}intersectsPlane(e){let t;const i=y.Dot(e.normal,this.direction);if(Math.abs(i)<999999997475243e-21)return null;{const s=y.Dot(e.normal,this.origin);return t=(-e.d-s)/i,t<0?t<-999999997475243e-21?null:0:t}}intersectsAxis(e,t=0){switch(e){case"y":{const i=(this.origin.y-t)/this.direction.y;return i>0?null:new y(this.origin.x+this.direction.x*-i,t,this.origin.z+this.direction.z*-i)}case"x":{const i=(this.origin.x-t)/this.direction.x;return i>0?null:new y(t,this.origin.y+this.direction.y*-i,this.origin.z+this.direction.z*-i)}case"z":{const i=(this.origin.z-t)/this.direction.z;return i>0?null:new y(this.origin.x+this.direction.x*-i,this.origin.y+this.direction.y*-i,t)}default:return null}}intersectsMesh(e,t,i,s=!1,r,a=!1){const o=N.Matrix[0];return e.getWorldMatrix().invertToRef(o),this._tmpRay?Ge.TransformToRef(this,o,this._tmpRay):this._tmpRay=Ge.Transform(this,o),e.intersects(this._tmpRay,t,i,s,r,a)}intersectsMeshes(e,t,i){i?i.length=0:i=[];for(let s=0;s<e.length;s++){const r=this.intersectsMesh(e[s],t);r.hit&&i.push(r)}return i.sort(this._comparePickingInfo),i}_comparePickingInfo(e,t){return e.distance<t.distance?-1:e.distance>t.distance?1:0}intersectionSegment(e,t,i){const s=this.origin,r=N.Vector3[0],a=N.Vector3[1],o=N.Vector3[2],l=N.Vector3[3];t.subtractToRef(e,r),this.direction.scaleToRef(Ge._Rayl,o),s.addToRef(o,a),e.subtractToRef(s,l);const h=y.Dot(r,r),u=y.Dot(r,o),c=y.Dot(o,o),f=y.Dot(r,l),d=y.Dot(o,l),_=h*c-u*u;let p,g=_,m,v=_;_<Ge._Smallnum?(p=0,g=1,m=d,v=c):(p=u*d-c*f,m=h*d-u*f,p<0?(p=0,m=d,v=c):p>g&&(p=g,m=d+u,v=c)),m<0?(m=0,-f<0?p=0:-f>h?p=g:(p=-f,g=h)):m>v&&(m=v,-f+u<0?p=0:-f+u>h?p=g:(p=-f+u,g=h));const T=Math.abs(p)<Ge._Smallnum?0:p/g,A=Math.abs(m)<Ge._Smallnum?0:m/v,b=N.Vector3[4];o.scaleToRef(A,b);const x=N.Vector3[5];r.scaleToRef(T,x),x.addInPlace(l);const E=N.Vector3[6];return x.subtractToRef(b,E),A>0&&A<=this.length&&E.lengthSquared()<i*i?x.length():-1}update(e,t,i,s,r,a,o,l=!1){if(l){Ge._RayDistant||(Ge._RayDistant=Ge.Zero()),Ge._RayDistant.unprojectRayToRef(e,t,i,s,L.IdentityReadOnly,a,o);const h=N.Matrix[0];r.invertToRef(h),Ge.TransformToRef(Ge._RayDistant,h,this)}else this.unprojectRayToRef(e,t,i,s,r,a,o);return this}static Zero(){return new Ge(y.Zero(),y.Zero())}static CreateNew(e,t,i,s,r,a,o){return Ge.Zero().update(e,t,i,s,r,a,o)}static CreateNewFromTo(e,t,i=L.IdentityReadOnly){const s=new Ge(new y(0,0,0),new y(0,0,0));return Ge.CreateFromToToRef(e,t,s,i)}static CreateFromToToRef(e,t,i,s=L.IdentityReadOnly){i.origin.copyFrom(e);const r=t.subtractToRef(e,i.direction),a=Math.sqrt(r.x*r.x+r.y*r.y+r.z*r.z);return i.length=a,i.direction.normalize(),Ge.TransformToRef(i,s,i)}static Transform(e,t){const i=new Ge(new y(0,0,0),new y(0,0,0));return Ge.TransformToRef(e,t,i),i}static TransformToRef(e,t,i){y.TransformCoordinatesToRef(e.origin,t,i.origin),y.TransformNormalToRef(e.direction,t,i.direction),i.length=e.length,i.epsilon=e.epsilon;const s=i.direction,r=s.length();if(!(r===0||r===1)){const a=1/r;s.x*=a,s.y*=a,s.z*=a,i.length*=r}return i}unprojectRayToRef(e,t,i,s,r,a,o){const l=N.Matrix[0];r.multiplyToRef(a,l),l.multiplyToRef(o,l),l.invert();const h=Ae.LastCreatedEngine,u=N.Vector3[0];u.x=e/i*2-1,u.y=-(t/s*2-1),u.z=h!=null&&h.useReverseDepthBuffer?1:h!=null&&h.isNDCHalfZRange?0:-1;const c=N.Vector3[1].copyFromFloats(u.x,u.y,1-1e-8),f=N.Vector3[2],d=N.Vector3[3];y._UnprojectFromInvertedMatrixToRef(u,l,f),y._UnprojectFromInvertedMatrixToRef(c,l,d),this.origin.copyFrom(f),d.subtractToRef(f,this.direction),this.direction.normalize()}}Ge._TmpVector3=Ws(6,y.Zero);Ge._RayDistant=Ge.Zero();Ge._Smallnum=1e-8;Ge._Rayl=1e9;function Oh(n,e,t,i,s,r=!1){const a=Ge.Zero();return Fh(n,e,t,i,a,s,r),a}function Fh(n,e,t,i,s,r,a=!1,o=!1){const l=n.getEngine();if(!r&&!(r=n.activeCamera))return n;const h=r.viewport,u=l.getRenderHeight(),{x:c,y:f,width:d,height:_}=h.toGlobal(l.getRenderWidth(),u),p=1/l.getHardwareScalingLevel();return e=e*p-c,t=t*p-(u-f-_),s.update(e,t,d,_,i||L.IdentityReadOnly,a?L.IdentityReadOnly:r.getViewMatrix(),r.getProjectionMatrix(),o),n}function m6(n,e,t,i){const s=Ge.Zero();return fy(n,e,t,s,i),s}function fy(n,e,t,i,s){if(!xn)return n;const r=n.getEngine();if(!s&&!(s=n.activeCamera))throw new Error("Active camera not set");const a=s.viewport,o=r.getRenderHeight(),{x:l,y:h,width:u,height:c}=a.toGlobal(r.getRenderWidth(),o),f=L.Identity(),d=1/r.getHardwareScalingLevel();return e=e*d-l,t=t*d-(o-h-c),i.update(e,t,u,c,f,f,s.getProjectionMatrix()),n}function dy(n,e,t,i,s,r,a,o){const l=e(i,t.enableDistantPicking),h=t.intersects(l,s,a,r,i,o);return!h||!h.hit||!s&&n!=null&&h.distance>=n.distance?null:h}function kd(n,e,t,i,s,r){let a=null;const o=!!(n.activeCameras&&n.activeCameras.length>1&&n.cameraToUseForPointers!==n.activeCamera),l=n.cameraToUseForPointers||n.activeCamera,h=dy;for(let u=0;u<n.meshes.length;u++){const c=n.meshes[u];if(t){if(!t(c,-1))continue}else if(!c.isEnabled()||!c.isVisible||!c.isPickable)continue;const f=o&&c.isWorldMatrixCameraDependent(),d=c.computeWorldMatrix(f,l);if(c.hasThinInstances&&c.thinInstanceEnablePicking){const _=h(a,e,c,d,!0,!0,r);if(_){if(s)return _;const p=N.Matrix[1],g=c.thinInstanceGetWorldMatrices();for(let m=0;m<g.length;m++){if(t&&!t(c,m))continue;g[m].multiplyToRef(d,p);const T=h(a,e,c,p,i,s,r,!0);if(T&&(a=T,a.thinInstanceIndex=m,i))return a}}}else{const _=h(a,e,c,d,i,s,r);if(_&&(a=_,i))return a}}return a||new xn}function _y(n,e,t,i){if(!xn)return null;const s=[],r=!!(n.activeCameras&&n.activeCameras.length>1&&n.cameraToUseForPointers!==n.activeCamera),a=n.cameraToUseForPointers||n.activeCamera,o=dy;for(let l=0;l<n.meshes.length;l++){const h=n.meshes[l];if(t){if(!t(h,-1))continue}else if(!h.isEnabled()||!h.isVisible||!h.isPickable)continue;const u=r&&h.isWorldMatrixCameraDependent(),c=h.computeWorldMatrix(u,a);if(h.hasThinInstances&&h.thinInstanceEnablePicking){if(o(null,e,h,c,!0,!0,i)){const d=N.Matrix[1],_=h.thinInstanceGetWorldMatrices();for(let p=0;p<_.length;p++){if(t&&!t(h,p))continue;_[p].multiplyToRef(c,d);const m=o(null,e,h,d,!1,!1,i,!0);m&&(m.thinInstanceIndex=p,s.push(m))}}}else{const f=o(null,e,h,c,!1,!1,i);f&&s.push(f)}}return s}function v6(n,e,t,i,s,r){if(!xn)return null;const a=kd(n,o=>(n._tempPickingRay||(n._tempPickingRay=Ge.Zero()),Fh(n,e,t,o,n._tempPickingRay,r||null),n._tempPickingRay),i,s,!0);return a&&(a.ray=Oh(n,e,t,L.Identity(),r||null)),a}function y6(n,e,t,i,s,r,a,o=!1){const l=kd(n,(h,u)=>(n._tempPickingRay||(n._tempPickingRay=Ge.Zero()),Fh(n,e,t,h,n._tempPickingRay,r||null,!1,u),n._tempPickingRay),i,s,!1,a);return l&&(l.ray=Oh(n,e,t,L.Identity(),r||null)),l}function x6(n,e,t,i,s){const r=kd(n,a=>(n._pickWithRayInverseMatrix||(n._pickWithRayInverseMatrix=L.Identity()),a.invertToRef(n._pickWithRayInverseMatrix),n._cachedRayForTransform||(n._cachedRayForTransform=Ge.Zero()),Ge.TransformToRef(e,n._pickWithRayInverseMatrix,n._cachedRayForTransform),n._cachedRayForTransform),t,i,!1,s);return r&&(r.ray=e),r}function b6(n,e,t,i,s,r){return _y(n,a=>Oh(n,e,t,a,s||null),i,r)}function T6(n,e,t,i){return _y(n,s=>(n._pickWithRayInverseMatrix||(n._pickWithRayInverseMatrix=L.Identity()),s.invertToRef(n._pickWithRayInverseMatrix),n._cachedRayForTransform||(n._cachedRayForTransform=Ge.Zero()),Ge.TransformToRef(e,n._pickWithRayInverseMatrix,n._cachedRayForTransform),n._cachedRayForTransform),t,i)}function Kg(n,e,t=100,i,s){i||(i=n.getWorldMatrix()),e.length=t,s?e.origin.copyFrom(s):e.origin.copyFrom(n.position);const r=N.Vector3[2];r.set(0,0,n._scene.useRightHandedSystem?-1:1);const a=N.Vector3[3];return y.TransformNormalToRef(r,i,a),y.NormalizeToRef(a,e.direction),e}function A6(n,e){e&&(e.prototype.getForwardRay=function(t=100,i,s){return Kg(this,new Ge(y.Zero(),y.Zero(),t),t,i,s)},e.prototype.getForwardRayToRef=function(t,i=100,s,r){return Kg(this,t,i,s,r)}),n&&(Ad._IsPickingAvailable=!0,n.prototype.createPickingRay=function(t,i,s,r,a=!1){return Oh(this,t,i,s,r,a)})}A6(Je,be);Je.prototype.createPickingRayToRef=function(n,e,t,i,s,r=!1,a=!1){return Fh(this,n,e,t,i,s,r,a)};Je.prototype.createPickingRayInCameraSpace=function(n,e,t){return m6(this,n,e,t)};Je.prototype.createPickingRayInCameraSpaceToRef=function(n,e,t,i){return fy(this,n,e,t,i)};Je.prototype.pickWithBoundingInfo=function(n,e,t,i,s){return v6(this,n,e,t,i,s)};Je.prototype.pick=function(n,e,t,i,s,r,a=!1){return y6(this,n,e,t,i,s,r,a)};Je.prototype.pickWithRay=function(n,e,t,i){return x6(this,n,e,t,i)};Je.prototype.multiPick=function(n,e,t,i,s){return b6(this,n,e,t,i,s)};Je.prototype.multiPickWithRay=function(n,e,t){return T6(this,n,e,t)};class Da{constructor(e,t,i,s=""){this.defines="",this.onCompiled=null,this.onError=null,this.uniqueId=0,this.onCompileObservable=new q,this.onErrorObservable=new q,this.onBindObservable=new q,this._wasPreviouslyReady=!1,this._isReady=!1,this._compilationError="",this._key="",this._computeSourceCodeOverride="",this._pipelineContext=null,this._computeSourceCode="",this._rawComputeSourceCode="",this._shaderLanguage=1,this.name=e,this._key=s,this._engine=i,this.uniqueId=Da._UniqueIdSeed++,this.defines=t.defines??"",this.onError=t.onError,this.onCompiled=t.onCompiled,this._entryPoint=t.entryPoint??"main",this._shaderStore=ye.GetShadersStore(this._shaderLanguage),this._shaderRepository=ye.GetShadersRepository(this._shaderLanguage),this._includeShaderStore=ye.GetIncludesShadersStore(this._shaderLanguage);let r;const a=zt()?this._engine.getHostDocument():null;typeof e=="string"?r=e:e.computeSource?r="source:"+e.computeSource:e.computeElement?r=(a==null?void 0:a.getElementById(e.computeElement))||e.computeElement:r=e.compute||e;const o={defines:this.defines.split(`
`),indexParameters:void 0,isFragment:!1,shouldUseHighPrecisionShader:!1,processor:null,supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:this._shaderRepository,includesShadersStore:this._includeShaderStore,version:(this._engine.version*100).toString(),platformName:this._engine.shaderPlatformName,processingContext:null,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:(l,h,u)=>{if(!u)return h;for(const c of u){const d=c.replace("#define","").replace(";","").trim().split(" ");if(d.length===2){const _=d[0],p=d[1];(!isNaN(parseInt(p))||!isNaN(parseFloat(p)))&&(h=`const ${_} = ${p};
`+h)}}return h}};this._loadShader(r,"Compute","",l=>{ed(o),KT(l,o,h=>{this._rawComputeSourceCode=l,t.processFinalCode&&(h=t.processFinalCode(h));const u=td(h,"",o);this._useFinalCode(u.vertexCode,e)},this._engine)})}_useFinalCode(e,t){if(t){const i=t.computeElement||t.compute||t.spectorName||t;this._computeSourceCode="//#define SHADER_NAME compute:"+i+`
`+e}else this._computeSourceCode=e;this._prepareEffect()}get key(){return this._key}isReady(){try{return this._isReadyInternal()}catch{return!1}}_isReadyInternal(){return this._isReady?!0:this._pipelineContext?this._pipelineContext.isReady:!1}getEngine(){return this._engine}getPipelineContext(){return this._pipelineContext}getCompilationError(){return this._compilationError}executeWhenCompiled(e){if(this.isReady()){e(this);return}this.onCompileObservable.add(t=>{e(t)}),(!this._pipelineContext||this._pipelineContext.isAsync)&&this._checkIsReady(null)}_checkIsReady(e){gh(()=>this._isReadyInternal(),()=>{},t=>{this._processCompilationErrors(t,e)},void 0,void 0,!1)}_loadShader(e,t,i,s){if(typeof HTMLElement<"u"&&e instanceof HTMLElement){const a=$f(e);s(a);return}if(e.substring(0,7)==="source:"){s(e.substring(7));return}if(e.substring(0,7)==="base64:"){const a=window.atob(e.substring(7));s(a);return}if(this._shaderStore[e+t+"Shader"]){s(this._shaderStore[e+t+"Shader"]);return}if(i&&this._shaderStore[e+i+"Shader"]){s(this._shaderStore[e+i+"Shader"]);return}let r;e[0]==="."||e[0]==="/"||e.indexOf("http")>-1?r=e:r=this._shaderRepository+e,this._engine._loadFile(r+"."+t.toLowerCase()+".fx",s)}get computeSourceCode(){var e;return this._computeSourceCodeOverride?this._computeSourceCodeOverride:((e=this._pipelineContext)==null?void 0:e._getComputeShaderCode())??this._computeSourceCode}get rawComputeSourceCode(){return this._rawComputeSourceCode}_prepareEffect(){const e=this.defines,t=this._pipelineContext;this._isReady=!1;try{const i=this._engine;this._pipelineContext=i.createComputePipelineContext(),this._pipelineContext._name=this._key,i._prepareComputePipelineContext(this._pipelineContext,this._computeSourceCodeOverride?this._computeSourceCodeOverride:this._computeSourceCode,this._rawComputeSourceCode,this._computeSourceCodeOverride?null:e,this._entryPoint),i._executeWhenComputeStateIsCompiled(this._pipelineContext,s=>{if(s&&s.numErrors>0){this._processCompilationErrors(s,t);return}this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),t&&this.getEngine()._deleteComputePipelineContext(t)}),this._pipelineContext.isAsync&&this._checkIsReady(t)}catch(i){this._processCompilationErrors(i,t)}}_processCompilationErrors(e,t=null){var i;if(this._compilationError="",U.Error("Unable to compile compute effect:"),this.defines&&U.Error(`Defines:
`+this.defines),Da.LogShaderCodeOnCompilationError){const s=(i=this._pipelineContext)==null?void 0:i._getComputeShaderCode();s&&(U.Error("Compute code:"),U.Error(s))}if(typeof e=="string")this._compilationError=e,U.Error("Error: "+this._compilationError);else for(const s of e.messages){let r="";s.line!==void 0&&(r+="Line "+s.line+", "),s.offset!==void 0&&(r+="Offset "+s.offset+", "),s.length!==void 0&&(r+="Length "+s.length+", "),r+=s.type+": "+s.text,this._compilationError&&(this._compilationError+=`
`),this._compilationError+=r,U.Error(r)}t&&(this._pipelineContext=t,this._isReady=!0),this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this)}dispose(){this._pipelineContext&&this._pipelineContext.dispose(),this._engine._releaseComputeEffect(this)}static RegisterShader(e,t){ye.GetShadersStore(1)[`${e}ComputeShader`]=t}}Da._UniqueIdSeed=0;Da.LogShaderCodeOnCompilationError=!0;class Lh{getBindGroups(e,t,i){if(!i)throw new Error("WebGPUComputeContext.getBindGroups: bindingsMapping is required until browsers support reflection for wgsl shaders!");if(this._bindGroups.length===0){const s=this._bindGroupEntries.length>0;for(const r in e){const a=e[r],o=i[r],l=o.group,h=o.binding,u=a.type,c=a.object;let f=a.indexInGroupEntries,d=this._bindGroupEntries[l];switch(d||(d=this._bindGroupEntries[l]=[]),u){case 5:{const _=c;f!==void 0&&s?d[f].resource=this._cacheSampler.getSampler(_):(a.indexInGroupEntries=d.length,d.push({binding:h,resource:this._cacheSampler.getSampler(_)}));break}case 0:case 4:{const _=c,p=_._texture._hardwareTexture;f!==void 0&&s?(u===0&&(d[f++].resource=this._cacheSampler.getSampler(_._texture)),d[f].resource=p.view):(a.indexInGroupEntries=d.length,u===0&&d.push({binding:h-1,resource:this._cacheSampler.getSampler(_._texture)}),d.push({binding:h,resource:p.view}));break}case 1:{const _=c,p=_._texture._hardwareTexture;p.textureAdditionalUsages&8||U.Error(`computeDispatch: The texture (name=${_.name}, uniqueId=${_.uniqueId}) is not a storage texture!`,50),f!==void 0&&s?d[f].resource=p.viewForWriting:(a.indexInGroupEntries=d.length,d.push({binding:h,resource:p.viewForWriting}));break}case 6:{const p=c.underlyingResource;f!==void 0&&s?d[f].resource=this._device.importExternalTexture({source:p}):(a.indexInGroupEntries=d.length,d.push({binding:h,resource:this._device.importExternalTexture({source:p})}));break}case 2:case 3:case 7:{const _=u===7?c:c.getBuffer(),p=_.underlyingResource;f!==void 0&&s?(d[f].resource.buffer=p,d[f].resource.size=_.capacity):(a.indexInGroupEntries=d.length,d.push({binding:h,resource:{buffer:p,offset:0,size:_.capacity}}));break}}}for(let r=0;r<this._bindGroupEntries.length;++r){const a=this._bindGroupEntries[r];if(!a){this._bindGroups[r]=void 0;continue}this._bindGroups[r]=this._device.createBindGroup({layout:t.getBindGroupLayout(r),entries:a})}this._bindGroups.length=this._bindGroupEntries.length}return this._bindGroups}constructor(e,t){this._device=e,this._cacheSampler=t,this.uniqueId=Lh._Counter++,this._bindGroupEntries=[],this.clear()}clear(){this._bindGroups=[]}}Lh._Counter=0;class E6{get isAsync(){return!1}get isReady(){return this.isAsync,!1}constructor(e){this._name="unnamed",this.engine=e}_getComputeShaderCode(){var e;return(e=this.sources)==null?void 0:e.compute}dispose(){}}const Xg={};je.prototype.createComputeContext=function(){return new Lh(this._device,this._cacheSampler)};je.prototype.createComputeEffect=function(n,e){const i=(typeof n=="string"?n:n.computeToken||n.computeSource||n.computeElement||n.compute)+"@"+e.defines;if(this._compiledComputeEffects[i]){const r=this._compiledComputeEffects[i];return e.onCompiled&&r.isReady()&&e.onCompiled(r),r}const s=new Da(n,e,this,i);return this._compiledComputeEffects[i]=s,s};je.prototype.createComputePipelineContext=function(){return new E6(this)};je.prototype.areAllComputeEffectsReady=function(){for(const n in this._compiledComputeEffects)if(!this._compiledComputeEffects[n].isReady())return!1;return!0};je.prototype.computeDispatch=function(n,e,t,i,s=1,r=1,a,o){this._computeDispatch(n,e,t,i,s,r,void 0,void 0,a,o)};je.prototype.computeDispatchIndirect=function(n,e,t,i,s=0,r,a){this._computeDispatch(n,e,t,void 0,void 0,void 0,i,s,r,a)};je.prototype._computeDispatch=function(n,e,t,i,s,r,a,o,l,h){this._endCurrentRenderPass();const u=n._pipelineContext,c=e;u.computePipeline||(u.computePipeline=this._device.createComputePipeline({layout:"auto",compute:u.stage})),h&&this._timestampQuery.startPass(Xg,this._timestampIndex);const f=this._renderEncoder.beginComputePass(Xg);f.setPipeline(u.computePipeline);const d=c.getBindGroups(t,u.computePipeline,l);for(let _=0;_<d.length;++_){const p=d[_];p&&f.setBindGroup(_,p)}a!==void 0?f.dispatchWorkgroupsIndirect(a.underlyingResource,o):i+s+r>0&&f.dispatchWorkgroups(i,s,r),f.end(),h&&(this._timestampQuery.endPass(this._timestampIndex,h),this._timestampIndex+=2)};je.prototype.releaseComputeEffects=function(){for(const n in this._compiledComputeEffects){const e=this._compiledComputeEffects[n].getPipelineContext();this._deleteComputePipelineContext(e)}this._compiledComputeEffects={}};je.prototype._prepareComputePipelineContext=function(n,e,t,i,s){const r=n;this.dbgShowShaderCode&&(U.Log(i),U.Log(e)),r.sources={compute:e,rawCompute:t},r.stage=this._createComputePipelineStageDescriptor(e,i,s)};je.prototype._releaseComputeEffect=function(n){this._compiledComputeEffects[n._key]&&(delete this._compiledComputeEffects[n._key],this._deleteComputePipelineContext(n.getPipelineContext()))};je.prototype._rebuildComputeEffects=function(){for(const n in this._compiledComputeEffects){const e=this._compiledComputeEffects[n];e._pipelineContext=null,e._wasPreviouslyReady=!1,e._prepareEffect()}};je.prototype._executeWhenComputeStateIsCompiled=function(n,e){n.stage.module.getCompilationInfo().then(t=>{const i={numErrors:0,messages:[]};for(const s of t.messages)s.type==="error"&&i.numErrors++,i.messages.push({type:s.type,text:s.message,line:s.lineNum,column:s.linePos,length:s.length,offset:s.offset});e(i)})};je.prototype._deleteComputePipelineContext=function(n){n&&n.dispose()};je.prototype._createComputePipelineStageDescriptor=function(n,e,t){return e?e="//"+e.split(`
`).join(`
//`)+`
`:e="",{module:this._device.createShaderModule({code:e+n}),entryPoint:t}};je.prototype._debugPushGroup=function(n,e){this._options.enableGPUDebugMarkers&&(e===0||e===1?(e===1&&(this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this._endCurrentRenderPass()),this._renderEncoder.pushDebugGroup(n)):this._currentRenderPass?(this._currentRenderPass.pushDebugGroup(n),this._debugStackRenderPass.push(n)):this._pendingDebugCommands.push(["push",n,e]))};je.prototype._debugPopGroup=function(n){this._options.enableGPUDebugMarkers&&(n===0||n===1?(n===1&&(this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this._endCurrentRenderPass()),this._renderEncoder.popDebugGroup()):this._currentRenderPass?(this._currentRenderPass.popDebugGroup(),this._debugStackRenderPass.pop()):this._pendingDebugCommands.push(["pop",null,n]))};je.prototype._debugInsertMarker=function(n,e){this._options.enableGPUDebugMarkers&&(e===0||e===1?(e===1&&(this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this._endCurrentRenderPass()),this._renderEncoder.insertDebugMarker(n)):this._currentRenderPass?this._currentRenderPass.insertDebugMarker(n):this._pendingDebugCommands.push(["insert",n,e]))};je.prototype._debugFlushPendingCommands=function(){if(this._debugStackRenderPass.length!==0){const n=this._debugStackRenderPass.slice();this._debugStackRenderPass.length=0;for(let e=0;e<n.length;++e)this._debugPushGroup(n[e],2)}for(let n=0;n<this._pendingDebugCommands.length;++n){const[e,t,i]=this._pendingDebugCommands[n];switch(e){case"push":this._debugPushGroup(t,i);break;case"pop":this._debugPopGroup(i);break;case"insert":this._debugInsertMarker(t,i);break}}this._pendingDebugCommands.length=0};je.prototype.createDynamicTexture=function(n,e,t,i){const s=new gt(this,4);return s.baseWidth=n,s.baseHeight=e,t&&(n=this.needPOTTextures?Yi(n,this._caps.maxTextureSize):n,e=this.needPOTTextures?Yi(e,this._caps.maxTextureSize):e),s.width=n,s.height=e,s.isReady=!1,s.generateMipMaps=t,s.samplingMode=i,this.updateTextureSamplingMode(i,s),this._internalTexturesCache.push(s),n&&e&&this._textureHelper.createGPUTextureForInternalTexture(s,n,e),s};je.prototype.updateDynamicTexture=function(n,e,t,i=!1,s,r,a){var u;if(!n)return;const o=e.width,l=e.height;let h=n._hardwareTexture;(u=n._hardwareTexture)!=null&&u.underlyingResource||(h=this._textureHelper.createGPUTextureForInternalTexture(n,o,l)),this._textureHelper.updateTexture(e,n,o,l,n.depth,h.format,0,0,t,i,0,0,a),n.generateMipMaps&&this._generateMipmaps(n),n._dynamicTextureSource=e,n._premulAlpha=i,n.invertY=t||!1,n.isReady=!0};je.prototype.unBindMultiColorAttachmentFramebuffer=function(n,e=!1,t){t&&t(),this._endCurrentRenderPass(),e||this.generateMipMapsMultiFramebuffer(n),this._currentRenderTarget=null,this._mrtAttachments=[],this._cacheRenderPipeline.setMRT([]),this._cacheRenderPipeline.setMRTAttachments(this._mrtAttachments)};je.prototype.createMultipleRenderTarget=function(n,e,t){let i=!1,s=!0,r=!1,a=!1,o=15,l=1,h=1;const u=0,c=3,f=!1,d=5,_=3553;let p=[],g=[],m=[],v=[],T=[],A=[],b=[],x=[],E=[],R=[],C=!1;const I=this._createHardwareRenderTargetWrapper(!0,!1,n);e!==void 0&&(i=e.generateMipMaps??!1,s=e.generateDepthBuffer??!0,r=e.generateStencilBuffer??!1,a=e.generateDepthTexture??!1,l=e.textureCount??1,o=e.depthTextureFormat??15,p=e.types||p,g=e.samplingModes||g,m=e.useSRGBBuffers||m,v=e.formats||v,T=e.targetTypes||T,A=e.faceIndex||A,b=e.layerIndex||b,x=e.layerCounts||x,E=e.labels||E,R=e.creationFlags||R,h=e.samples??h,C=e.dontCreateTextures??!1);const D=n.width??n,w=n.height??n,z=[],F=[],W=[];I.label=(e==null?void 0:e.label)??"MultiRenderTargetWrapper",I._generateDepthBuffer=s,I._generateStencilBuffer=r,I._attachments=F,I._defaultAttachments=W;let X=null;(s||r||a)&&!C&&(a||(s&&r?o=13:s?o=14:o=19),X=I.createDepthStencilTexture(0,!1,r,1,o,I.label+"-DepthStencil"));const he=e!==void 0&&typeof e=="object"&&e.createMipMaps&&!i;for(let H=0;H<l;H++){let G=g[H]||c,k=p[H]||u;const M=v[H]||d,V=(m[H]||f)&&this._caps.supportSRGBBuffers,j=T[H]||_,ae=x[H]??1,ge=R[H];if((k===1&&!this._caps.textureFloatLinearFiltering||k===2&&!this._caps.textureHalfFloatLinearFiltering)&&(G=1),k===1&&!this._caps.textureFloat&&(k=0,U.Warn("Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type")),F.push(H+1),W.push(t?H+1:H===0?1:0),j===-1||C)continue;const $=new gt(this,6);switch(z[H]=$,j){case 34067:$.isCube=!0;break;case 32879:$.is3D=!0,$.baseDepth=$.depth=ae;break;case 35866:$.is2DArray=!0,$.baseDepth=$.depth=ae;break}$.baseWidth=D,$.baseHeight=w,$.width=D,$.height=w,$.isReady=!0,$.samples=1,$.generateMipMaps=i,$.samplingMode=G,$.type=k,$._cachedWrapU=0,$._cachedWrapV=0,$._useSRGBBuffer=V,$.format=M,$.label=E[H]??I.label+"-Texture"+H,this._internalTexturesCache.push($),he&&($.generateMipMaps=!0),this._textureHelper.createGPUTextureForInternalTexture($,void 0,void 0,void 0,ge,!0),he&&($.generateMipMaps=!1)}return X&&(X.incrementReferences(),z[l]=X,this._internalTexturesCache.push(X)),I.setTextures(z),I.setLayerAndFaceIndices(b,A),C?I._samples=h:this.updateMultipleRenderTargetTextureSampleCount(I,h),I};je.prototype.updateMultipleRenderTargetTextureSampleCount=function(n,e){if(!n||!n.textures||n.textures.length===0||n.textures[0].samples===e)return e;const t=n.textures.length;if(t===0)return 1;e=Math.min(e,this.getCaps().maxMSAASamples);for(let s=0;s<t;++s){const a=n.textures[s]._hardwareTexture;a==null||a.releaseMSAATexture(n.getBaseArrayLayer(s))}const i=n._depthStencilTexture===n.textures[t-1];for(let s=0;s<t;++s){const r=n.textures[s];this._textureHelper.createMSAATexture(r,e,!1,n.getBaseArrayLayer(s)),r.samples=e}return n._depthStencilTexture&&!i&&(this._textureHelper.createMSAATexture(n._depthStencilTexture,e),n._depthStencilTexture.samples=e),n._samples=e,e};je.prototype.generateMipMapsMultiFramebuffer=function(n){const e=n;if(!e.isMulti)return;const i=e._attachments.length;for(let s=0;s<i;s++){const r=e.textures[s];r.generateMipMaps&&!r.isCube&&!r.is3D&&this._generateMipmaps(r)}};je.prototype.resolveMultiFramebuffer=function(n){throw new Error("resolveMultiFramebuffer is not yet implemented in WebGPU!")};je.prototype.bindAttachments=function(n){n.length===0||!this._currentRenderTarget||(this._mrtAttachments=n,this._currentRenderPass&&this._cacheRenderPipeline.setMRTAttachments(n))};je.prototype.buildTextureLayout=function(n){const e=[];for(let t=0;t<n.length;t++)n[t]?e.push(t+1):e.push(0);return e};je.prototype.restoreSingleAttachment=function(){};je.prototype.restoreSingleAttachmentForRenderTarget=function(){};function S6(n){return!!(n&&n.underlyingResource!==void 0)}je.prototype.updateVideoTexture=function(n,e,t){var s;if(!n||n._isDisabled)return;this._videoTextureSupported===void 0&&(this._videoTextureSupported=!0);let i=n._hardwareTexture;if((s=n._hardwareTexture)!=null&&s.underlyingResource||(i=this._textureHelper.createGPUTextureForInternalTexture(n)),S6(e)){if(e.isReady()){try{this._textureHelper.copyVideoToTexture(e,n,i.format,!t),n.generateMipMaps&&this._generateMipmaps(n)}catch{}n.isReady=!0}}else e&&this.createImageBitmap(e).then(r=>{this._textureHelper.updateTexture(r,n,n.width,n.height,n.depth,i.format,0,0,!t,!1,0,0),n.generateMipMaps&&this._generateMipmaps(n),n.isReady=!0}).catch(()=>{n.isReady=!0})};var R6={value:()=>{}};function py(){for(var n=0,e=arguments.length,t={},i;n<e;++n){if(!(i=arguments[n]+"")||i in t||/[\s.]/.test(i))throw new Error("illegal type: "+i);t[i]=[]}return new rl(t)}function rl(n){this._=n}function I6(n,e){return n.trim().split(/^|\s+/).map(function(t){var i="",s=t.indexOf(".");if(s>=0&&(i=t.slice(s+1),t=t.slice(0,s)),t&&!e.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:i}})}rl.prototype=py.prototype={constructor:rl,on:function(n,e){var t=this._,i=I6(n+"",t),s,r=-1,a=i.length;if(arguments.length<2){for(;++r<a;)if((s=(n=i[r]).type)&&(s=C6(t[s],n.name)))return s;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++r<a;)if(s=(n=i[r]).type)t[s]=Yg(t[s],n.name,e);else if(e==null)for(s in t)t[s]=Yg(t[s],n.name,null);return this},copy:function(){var n={},e=this._;for(var t in e)n[t]=e[t].slice();return new rl(n)},call:function(n,e){if((s=arguments.length-2)>0)for(var t=new Array(s),i=0,s,r;i<s;++i)t[i]=arguments[i+2];if(!this._.hasOwnProperty(n))throw new Error("unknown type: "+n);for(r=this._[n],i=0,s=r.length;i<s;++i)r[i].value.apply(e,t)},apply:function(n,e,t){if(!this._.hasOwnProperty(n))throw new Error("unknown type: "+n);for(var i=this._[n],s=0,r=i.length;s<r;++s)i[s].value.apply(e,t)}};function C6(n,e){for(var t=0,i=n.length,s;t<i;++t)if((s=n[t]).name===e)return s.value}function Yg(n,e,t){for(var i=0,s=n.length;i<s;++i)if(n[i].name===e){n[i]=R6,n=n.slice(0,i).concat(n.slice(i+1));break}return t!=null&&n.push({name:e,value:t}),n}var zc="http://www.w3.org/1999/xhtml";const jg={svg:"http://www.w3.org/2000/svg",xhtml:zc,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Bh(n){var e=n+="",t=e.indexOf(":");return t>=0&&(e=n.slice(0,t))!=="xmlns"&&(n=n.slice(t+1)),jg.hasOwnProperty(e)?{space:jg[e],local:n}:n}function M6(n){return function(){var e=this.ownerDocument,t=this.namespaceURI;return t===zc&&e.documentElement.namespaceURI===zc?e.createElement(n):e.createElementNS(t,n)}}function P6(n){return function(){return this.ownerDocument.createElementNS(n.space,n.local)}}function Vd(n){var e=Bh(n);return(e.local?P6:M6)(e)}function w6(){}function Gd(n){return n==null?w6:function(){return this.querySelector(n)}}function D6(n){typeof n!="function"&&(n=Gd(n));for(var e=this._groups,t=e.length,i=new Array(t),s=0;s<t;++s)for(var r=e[s],a=r.length,o=i[s]=new Array(a),l,h,u=0;u<a;++u)(l=r[u])&&(h=n.call(l,l.__data__,u,r))&&("__data__"in l&&(h.__data__=l.__data__),o[u]=h);return new ji(i,this._parents)}function O6(n){return n==null?[]:Array.isArray(n)?n:Array.from(n)}function F6(){return[]}function gy(n){return n==null?F6:function(){return this.querySelectorAll(n)}}function L6(n){return function(){return O6(n.apply(this,arguments))}}function B6(n){typeof n=="function"?n=L6(n):n=gy(n);for(var e=this._groups,t=e.length,i=[],s=[],r=0;r<t;++r)for(var a=e[r],o=a.length,l,h=0;h<o;++h)(l=a[h])&&(i.push(n.call(l,l.__data__,h,a)),s.push(l));return new ji(i,s)}function my(n){return function(){return this.matches(n)}}function vy(n){return function(e){return e.matches(n)}}var N6=Array.prototype.find;function U6(n){return function(){return N6.call(this.children,n)}}function k6(){return this.firstElementChild}function V6(n){return this.select(n==null?k6:U6(typeof n=="function"?n:vy(n)))}var G6=Array.prototype.filter;function z6(){return Array.from(this.children)}function W6(n){return function(){return G6.call(this.children,n)}}function H6(n){return this.selectAll(n==null?z6:W6(typeof n=="function"?n:vy(n)))}function K6(n){typeof n!="function"&&(n=my(n));for(var e=this._groups,t=e.length,i=new Array(t),s=0;s<t;++s)for(var r=e[s],a=r.length,o=i[s]=[],l,h=0;h<a;++h)(l=r[h])&&n.call(l,l.__data__,h,r)&&o.push(l);return new ji(i,this._parents)}function yy(n){return new Array(n.length)}function X6(){return new ji(this._enter||this._groups.map(yy),this._parents)}function Hl(n,e){this.ownerDocument=n.ownerDocument,this.namespaceURI=n.namespaceURI,this._next=null,this._parent=n,this.__data__=e}Hl.prototype={constructor:Hl,appendChild:function(n){return this._parent.insertBefore(n,this._next)},insertBefore:function(n,e){return this._parent.insertBefore(n,e)},querySelector:function(n){return this._parent.querySelector(n)},querySelectorAll:function(n){return this._parent.querySelectorAll(n)}};function Y6(n){return function(){return n}}function j6(n,e,t,i,s,r){for(var a=0,o,l=e.length,h=r.length;a<h;++a)(o=e[a])?(o.__data__=r[a],i[a]=o):t[a]=new Hl(n,r[a]);for(;a<l;++a)(o=e[a])&&(s[a]=o)}function q6(n,e,t,i,s,r,a){var o,l,h=new Map,u=e.length,c=r.length,f=new Array(u),d;for(o=0;o<u;++o)(l=e[o])&&(f[o]=d=a.call(l,l.__data__,o,e)+"",h.has(d)?s[o]=l:h.set(d,l));for(o=0;o<c;++o)d=a.call(n,r[o],o,r)+"",(l=h.get(d))?(i[o]=l,l.__data__=r[o],h.delete(d)):t[o]=new Hl(n,r[o]);for(o=0;o<u;++o)(l=e[o])&&h.get(f[o])===l&&(s[o]=l)}function $6(n){return n.__data__}function Z6(n,e){if(!arguments.length)return Array.from(this,$6);var t=e?q6:j6,i=this._parents,s=this._groups;typeof n!="function"&&(n=Y6(n));for(var r=s.length,a=new Array(r),o=new Array(r),l=new Array(r),h=0;h<r;++h){var u=i[h],c=s[h],f=c.length,d=Q6(n.call(u,u&&u.__data__,h,i)),_=d.length,p=o[h]=new Array(_),g=a[h]=new Array(_),m=l[h]=new Array(f);t(u,c,p,g,m,d,e);for(var v=0,T=0,A,b;v<_;++v)if(A=p[v]){for(v>=T&&(T=v+1);!(b=g[T])&&++T<_;);A._next=b||null}}return a=new ji(a,i),a._enter=o,a._exit=l,a}function Q6(n){return typeof n=="object"&&"length"in n?n:Array.from(n)}function J6(){return new ji(this._exit||this._groups.map(yy),this._parents)}function eS(n,e,t){var i=this.enter(),s=this,r=this.exit();return typeof n=="function"?(i=n(i),i&&(i=i.selection())):i=i.append(n+""),e!=null&&(s=e(s),s&&(s=s.selection())),t==null?r.remove():t(r),i&&s?i.merge(s).order():s}function tS(n){for(var e=n.selection?n.selection():n,t=this._groups,i=e._groups,s=t.length,r=i.length,a=Math.min(s,r),o=new Array(s),l=0;l<a;++l)for(var h=t[l],u=i[l],c=h.length,f=o[l]=new Array(c),d,_=0;_<c;++_)(d=h[_]||u[_])&&(f[_]=d);for(;l<s;++l)o[l]=t[l];return new ji(o,this._parents)}function iS(){for(var n=this._groups,e=-1,t=n.length;++e<t;)for(var i=n[e],s=i.length-1,r=i[s],a;--s>=0;)(a=i[s])&&(r&&a.compareDocumentPosition(r)^4&&r.parentNode.insertBefore(a,r),r=a);return this}function sS(n){n||(n=nS);function e(c,f){return c&&f?n(c.__data__,f.__data__):!c-!f}for(var t=this._groups,i=t.length,s=new Array(i),r=0;r<i;++r){for(var a=t[r],o=a.length,l=s[r]=new Array(o),h,u=0;u<o;++u)(h=a[u])&&(l[u]=h);l.sort(e)}return new ji(s,this._parents).order()}function nS(n,e){return n<e?-1:n>e?1:n>=e?0:NaN}function rS(){var n=arguments[0];return arguments[0]=this,n.apply(null,arguments),this}function aS(){return Array.from(this)}function oS(){for(var n=this._groups,e=0,t=n.length;e<t;++e)for(var i=n[e],s=0,r=i.length;s<r;++s){var a=i[s];if(a)return a}return null}function lS(){let n=0;for(const e of this)++n;return n}function hS(){return!this.node()}function uS(n){for(var e=this._groups,t=0,i=e.length;t<i;++t)for(var s=e[t],r=0,a=s.length,o;r<a;++r)(o=s[r])&&n.call(o,o.__data__,r,s);return this}function cS(n){return function(){this.removeAttribute(n)}}function fS(n){return function(){this.removeAttributeNS(n.space,n.local)}}function dS(n,e){return function(){this.setAttribute(n,e)}}function _S(n,e){return function(){this.setAttributeNS(n.space,n.local,e)}}function pS(n,e){return function(){var t=e.apply(this,arguments);t==null?this.removeAttribute(n):this.setAttribute(n,t)}}function gS(n,e){return function(){var t=e.apply(this,arguments);t==null?this.removeAttributeNS(n.space,n.local):this.setAttributeNS(n.space,n.local,t)}}function mS(n,e){var t=Bh(n);if(arguments.length<2){var i=this.node();return t.local?i.getAttributeNS(t.space,t.local):i.getAttribute(t)}return this.each((e==null?t.local?fS:cS:typeof e=="function"?t.local?gS:pS:t.local?_S:dS)(t,e))}function xy(n){return n.ownerDocument&&n.ownerDocument.defaultView||n.document&&n||n.defaultView}function vS(n){return function(){this.style.removeProperty(n)}}function yS(n,e,t){return function(){this.style.setProperty(n,e,t)}}function xS(n,e,t){return function(){var i=e.apply(this,arguments);i==null?this.style.removeProperty(n):this.style.setProperty(n,i,t)}}function bS(n,e,t){return arguments.length>1?this.each((e==null?vS:typeof e=="function"?xS:yS)(n,e,t??"")):Oa(this.node(),n)}function Oa(n,e){return n.style.getPropertyValue(e)||xy(n).getComputedStyle(n,null).getPropertyValue(e)}function TS(n){return function(){delete this[n]}}function AS(n,e){return function(){this[n]=e}}function ES(n,e){return function(){var t=e.apply(this,arguments);t==null?delete this[n]:this[n]=t}}function SS(n,e){return arguments.length>1?this.each((e==null?TS:typeof e=="function"?ES:AS)(n,e)):this.node()[n]}function by(n){return n.trim().split(/^|\s+/)}function zd(n){return n.classList||new Ty(n)}function Ty(n){this._node=n,this._names=by(n.getAttribute("class")||"")}Ty.prototype={add:function(n){var e=this._names.indexOf(n);e<0&&(this._names.push(n),this._node.setAttribute("class",this._names.join(" ")))},remove:function(n){var e=this._names.indexOf(n);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(n){return this._names.indexOf(n)>=0}};function Ay(n,e){for(var t=zd(n),i=-1,s=e.length;++i<s;)t.add(e[i])}function Ey(n,e){for(var t=zd(n),i=-1,s=e.length;++i<s;)t.remove(e[i])}function RS(n){return function(){Ay(this,n)}}function IS(n){return function(){Ey(this,n)}}function CS(n,e){return function(){(e.apply(this,arguments)?Ay:Ey)(this,n)}}function MS(n,e){var t=by(n+"");if(arguments.length<2){for(var i=zd(this.node()),s=-1,r=t.length;++s<r;)if(!i.contains(t[s]))return!1;return!0}return this.each((typeof e=="function"?CS:e?RS:IS)(t,e))}function PS(){this.textContent=""}function wS(n){return function(){this.textContent=n}}function DS(n){return function(){var e=n.apply(this,arguments);this.textContent=e??""}}function OS(n){return arguments.length?this.each(n==null?PS:(typeof n=="function"?DS:wS)(n)):this.node().textContent}function FS(){this.innerHTML=""}function LS(n){return function(){this.innerHTML=n}}function BS(n){return function(){var e=n.apply(this,arguments);this.innerHTML=e??""}}function NS(n){return arguments.length?this.each(n==null?FS:(typeof n=="function"?BS:LS)(n)):this.node().innerHTML}function US(){this.nextSibling&&this.parentNode.appendChild(this)}function kS(){return this.each(US)}function VS(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function GS(){return this.each(VS)}function zS(n){var e=typeof n=="function"?n:Vd(n);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function WS(){return null}function HS(n,e){var t=typeof n=="function"?n:Vd(n),i=e==null?WS:typeof e=="function"?e:Gd(e);return this.select(function(){return this.insertBefore(t.apply(this,arguments),i.apply(this,arguments)||null)})}function KS(){var n=this.parentNode;n&&n.removeChild(this)}function XS(){return this.each(KS)}function YS(){var n=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(n,this.nextSibling):n}function jS(){var n=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(n,this.nextSibling):n}function qS(n){return this.select(n?jS:YS)}function $S(n){return arguments.length?this.property("__data__",n):this.node().__data__}function ZS(n){return function(e){n.call(this,e,this.__data__)}}function QS(n){return n.trim().split(/^|\s+/).map(function(e){var t="",i=e.indexOf(".");return i>=0&&(t=e.slice(i+1),e=e.slice(0,i)),{type:e,name:t}})}function JS(n){return function(){var e=this.__on;if(e){for(var t=0,i=-1,s=e.length,r;t<s;++t)r=e[t],(!n.type||r.type===n.type)&&r.name===n.name?this.removeEventListener(r.type,r.listener,r.options):e[++i]=r;++i?e.length=i:delete this.__on}}}function eR(n,e,t){return function(){var i=this.__on,s,r=ZS(e);if(i){for(var a=0,o=i.length;a<o;++a)if((s=i[a]).type===n.type&&s.name===n.name){this.removeEventListener(s.type,s.listener,s.options),this.addEventListener(s.type,s.listener=r,s.options=t),s.value=e;return}}this.addEventListener(n.type,r,t),s={type:n.type,name:n.name,value:e,listener:r,options:t},i?i.push(s):this.__on=[s]}}function tR(n,e,t){var i=QS(n+""),s,r=i.length,a;if(arguments.length<2){var o=this.node().__on;if(o){for(var l=0,h=o.length,u;l<h;++l)for(s=0,u=o[l];s<r;++s)if((a=i[s]).type===u.type&&a.name===u.name)return u.value}return}for(o=e?eR:JS,s=0;s<r;++s)this.each(o(i[s],e,t));return this}function Sy(n,e,t){var i=xy(n),s=i.CustomEvent;typeof s=="function"?s=new s(e,t):(s=i.document.createEvent("Event"),t?(s.initEvent(e,t.bubbles,t.cancelable),s.detail=t.detail):s.initEvent(e,!1,!1)),n.dispatchEvent(s)}function iR(n,e){return function(){return Sy(this,n,e)}}function sR(n,e){return function(){return Sy(this,n,e.apply(this,arguments))}}function nR(n,e){return this.each((typeof e=="function"?sR:iR)(n,e))}function*rR(){for(var n=this._groups,e=0,t=n.length;e<t;++e)for(var i=n[e],s=0,r=i.length,a;s<r;++s)(a=i[s])&&(yield a)}var Ry=[null];function ji(n,e){this._groups=n,this._parents=e}function d0(){return new ji([[document.documentElement]],Ry)}function aR(){return this}ji.prototype=d0.prototype={constructor:ji,select:D6,selectAll:B6,selectChild:V6,selectChildren:H6,filter:K6,data:Z6,enter:X6,exit:J6,join:eS,merge:tS,selection:aR,order:iS,sort:sS,call:rS,nodes:aS,node:oS,size:lS,empty:hS,each:uS,attr:mS,style:bS,property:SS,classed:MS,text:OS,html:NS,raise:kS,lower:GS,append:zS,insert:HS,remove:XS,clone:qS,datum:$S,on:tR,dispatch:nR,[Symbol.iterator]:rR};function oR(n){return typeof n=="string"?new ji([[document.querySelector(n)]],[document.documentElement]):new ji([[n]],Ry)}function Iy(n){return oR(Vd(n).call(document.documentElement))}function Wd(n,e,t){n.prototype=e.prototype=t,t.constructor=n}function Cy(n,e){var t=Object.create(n.prototype);for(var i in e)t[i]=e[i];return t}function _0(){}var qo=.7,Kl=1/qo,va="\\s*([+-]?\\d+)\\s*",$o="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Xs="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",lR=/^#([0-9a-f]{3,8})$/,hR=new RegExp(`^rgb\\(${va},${va},${va}\\)$`),uR=new RegExp(`^rgb\\(${Xs},${Xs},${Xs}\\)$`),cR=new RegExp(`^rgba\\(${va},${va},${va},${$o}\\)$`),fR=new RegExp(`^rgba\\(${Xs},${Xs},${Xs},${$o}\\)$`),dR=new RegExp(`^hsl\\(${$o},${Xs},${Xs}\\)$`),_R=new RegExp(`^hsla\\(${$o},${Xs},${Xs},${$o}\\)$`),qg={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Wd(_0,Zo,{copy(n){return Object.assign(new this.constructor,this,n)},displayable(){return this.rgb().displayable()},hex:$g,formatHex:$g,formatHex8:pR,formatHsl:gR,formatRgb:Zg,toString:Zg});function $g(){return this.rgb().formatHex()}function pR(){return this.rgb().formatHex8()}function gR(){return My(this).formatHsl()}function Zg(){return this.rgb().formatRgb()}function Zo(n){var e,t;return n=(n+"").trim().toLowerCase(),(e=lR.exec(n))?(t=e[1].length,e=parseInt(e[1],16),t===6?Qg(e):t===3?new Fi(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):t===8?V0(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):t===4?V0(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=hR.exec(n))?new Fi(e[1],e[2],e[3],1):(e=uR.exec(n))?new Fi(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=cR.exec(n))?V0(e[1],e[2],e[3],e[4]):(e=fR.exec(n))?V0(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=dR.exec(n))?t1(e[1],e[2]/100,e[3]/100,1):(e=_R.exec(n))?t1(e[1],e[2]/100,e[3]/100,e[4]):qg.hasOwnProperty(n)?Qg(qg[n]):n==="transparent"?new Fi(NaN,NaN,NaN,0):null}function Qg(n){return new Fi(n>>16&255,n>>8&255,n&255,1)}function V0(n,e,t,i){return i<=0&&(n=e=t=NaN),new Fi(n,e,t,i)}function mR(n){return n instanceof _0||(n=Zo(n)),n?(n=n.rgb(),new Fi(n.r,n.g,n.b,n.opacity)):new Fi}function Wc(n,e,t,i){return arguments.length===1?mR(n):new Fi(n,e,t,i??1)}function Fi(n,e,t,i){this.r=+n,this.g=+e,this.b=+t,this.opacity=+i}Wd(Fi,Wc,Cy(_0,{brighter(n){return n=n==null?Kl:Math.pow(Kl,n),new Fi(this.r*n,this.g*n,this.b*n,this.opacity)},darker(n){return n=n==null?qo:Math.pow(qo,n),new Fi(this.r*n,this.g*n,this.b*n,this.opacity)},rgb(){return this},clamp(){return new Fi(Sr(this.r),Sr(this.g),Sr(this.b),Xl(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Jg,formatHex:Jg,formatHex8:vR,formatRgb:e1,toString:e1}));function Jg(){return`#${xr(this.r)}${xr(this.g)}${xr(this.b)}`}function vR(){return`#${xr(this.r)}${xr(this.g)}${xr(this.b)}${xr((isNaN(this.opacity)?1:this.opacity)*255)}`}function e1(){const n=Xl(this.opacity);return`${n===1?"rgb(":"rgba("}${Sr(this.r)}, ${Sr(this.g)}, ${Sr(this.b)}${n===1?")":`, ${n})`}`}function Xl(n){return isNaN(n)?1:Math.max(0,Math.min(1,n))}function Sr(n){return Math.max(0,Math.min(255,Math.round(n)||0))}function xr(n){return n=Sr(n),(n<16?"0":"")+n.toString(16)}function t1(n,e,t,i){return i<=0?n=e=t=NaN:t<=0||t>=1?n=e=NaN:e<=0&&(n=NaN),new As(n,e,t,i)}function My(n){if(n instanceof As)return new As(n.h,n.s,n.l,n.opacity);if(n instanceof _0||(n=Zo(n)),!n)return new As;if(n instanceof As)return n;n=n.rgb();var e=n.r/255,t=n.g/255,i=n.b/255,s=Math.min(e,t,i),r=Math.max(e,t,i),a=NaN,o=r-s,l=(r+s)/2;return o?(e===r?a=(t-i)/o+(t<i)*6:t===r?a=(i-e)/o+2:a=(e-t)/o+4,o/=l<.5?r+s:2-r-s,a*=60):o=l>0&&l<1?0:a,new As(a,o,l,n.opacity)}function yR(n,e,t,i){return arguments.length===1?My(n):new As(n,e,t,i??1)}function As(n,e,t,i){this.h=+n,this.s=+e,this.l=+t,this.opacity=+i}Wd(As,yR,Cy(_0,{brighter(n){return n=n==null?Kl:Math.pow(Kl,n),new As(this.h,this.s,this.l*n,this.opacity)},darker(n){return n=n==null?qo:Math.pow(qo,n),new As(this.h,this.s,this.l*n,this.opacity)},rgb(){var n=this.h%360+(this.h<0)*360,e=isNaN(n)||isNaN(this.s)?0:this.s,t=this.l,i=t+(t<.5?t:1-t)*e,s=2*t-i;return new Fi(Cu(n>=240?n-240:n+120,s,i),Cu(n,s,i),Cu(n<120?n+240:n-120,s,i),this.opacity)},clamp(){return new As(i1(this.h),G0(this.s),G0(this.l),Xl(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const n=Xl(this.opacity);return`${n===1?"hsl(":"hsla("}${i1(this.h)}, ${G0(this.s)*100}%, ${G0(this.l)*100}%${n===1?")":`, ${n})`}`}}));function i1(n){return n=(n||0)%360,n<0?n+360:n}function G0(n){return Math.max(0,Math.min(1,n||0))}function Cu(n,e,t){return(n<60?e+(t-e)*n/60:n<180?t:n<240?e+(t-e)*(240-n)/60:e)*255}const Py=n=>()=>n;function xR(n,e){return function(t){return n+t*e}}function bR(n,e,t){return n=Math.pow(n,t),e=Math.pow(e,t)-n,t=1/t,function(i){return Math.pow(n+i*e,t)}}function TR(n){return(n=+n)==1?wy:function(e,t){return t-e?bR(e,t,n):Py(isNaN(e)?t:e)}}function wy(n,e){var t=e-n;return t?xR(n,t):Py(isNaN(n)?e:n)}const s1=function n(e){var t=TR(e);function i(s,r){var a=t((s=Wc(s)).r,(r=Wc(r)).r),o=t(s.g,r.g),l=t(s.b,r.b),h=wy(s.opacity,r.opacity);return function(u){return s.r=a(u),s.g=o(u),s.b=l(u),s.opacity=h(u),s+""}}return i.gamma=n,i}(1);function Fn(n,e){return n=+n,e=+e,function(t){return n*(1-t)+e*t}}var Hc=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Mu=new RegExp(Hc.source,"g");function AR(n){return function(){return n}}function ER(n){return function(e){return n(e)+""}}function SR(n,e){var t=Hc.lastIndex=Mu.lastIndex=0,i,s,r,a=-1,o=[],l=[];for(n=n+"",e=e+"";(i=Hc.exec(n))&&(s=Mu.exec(e));)(r=s.index)>t&&(r=e.slice(t,r),o[a]?o[a]+=r:o[++a]=r),(i=i[0])===(s=s[0])?o[a]?o[a]+=s:o[++a]=s:(o[++a]=null,l.push({i:a,x:Fn(i,s)})),t=Mu.lastIndex;return t<e.length&&(r=e.slice(t),o[a]?o[a]+=r:o[++a]=r),o.length<2?l[0]?ER(l[0].x):AR(e):(e=l.length,function(h){for(var u=0,c;u<e;++u)o[(c=l[u]).i]=c.x(h);return o.join("")})}var n1=180/Math.PI,Kc={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Dy(n,e,t,i,s,r){var a,o,l;return(a=Math.sqrt(n*n+e*e))&&(n/=a,e/=a),(l=n*t+e*i)&&(t-=n*l,i-=e*l),(o=Math.sqrt(t*t+i*i))&&(t/=o,i/=o,l/=o),n*i<e*t&&(n=-n,e=-e,l=-l,a=-a),{translateX:s,translateY:r,rotate:Math.atan2(e,n)*n1,skewX:Math.atan(l)*n1,scaleX:a,scaleY:o}}var z0;function RR(n){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(n+"");return e.isIdentity?Kc:Dy(e.a,e.b,e.c,e.d,e.e,e.f)}function IR(n){return n==null||(z0||(z0=document.createElementNS("http://www.w3.org/2000/svg","g")),z0.setAttribute("transform",n),!(n=z0.transform.baseVal.consolidate()))?Kc:(n=n.matrix,Dy(n.a,n.b,n.c,n.d,n.e,n.f))}function Oy(n,e,t,i){function s(h){return h.length?h.pop()+" ":""}function r(h,u,c,f,d,_){if(h!==c||u!==f){var p=d.push("translate(",null,e,null,t);_.push({i:p-4,x:Fn(h,c)},{i:p-2,x:Fn(u,f)})}else(c||f)&&d.push("translate("+c+e+f+t)}function a(h,u,c,f){h!==u?(h-u>180?u+=360:u-h>180&&(h+=360),f.push({i:c.push(s(c)+"rotate(",null,i)-2,x:Fn(h,u)})):u&&c.push(s(c)+"rotate("+u+i)}function o(h,u,c,f){h!==u?f.push({i:c.push(s(c)+"skewX(",null,i)-2,x:Fn(h,u)}):u&&c.push(s(c)+"skewX("+u+i)}function l(h,u,c,f,d,_){if(h!==c||u!==f){var p=d.push(s(d)+"scale(",null,",",null,")");_.push({i:p-4,x:Fn(h,c)},{i:p-2,x:Fn(u,f)})}else(c!==1||f!==1)&&d.push(s(d)+"scale("+c+","+f+")")}return function(h,u){var c=[],f=[];return h=n(h),u=n(u),r(h.translateX,h.translateY,u.translateX,u.translateY,c,f),a(h.rotate,u.rotate,c,f),o(h.skewX,u.skewX,c,f),l(h.scaleX,h.scaleY,u.scaleX,u.scaleY,c,f),h=u=null,function(d){for(var _=-1,p=f.length,g;++_<p;)c[(g=f[_]).i]=g.x(d);return c.join("")}}}var CR=Oy(RR,"px, ","px)","deg)"),MR=Oy(IR,", ",")",")"),Fa=0,ao=0,eo=0,Fy=1e3,Yl,oo,jl=0,Fr=0,Nh=0,Qo=typeof performance=="object"&&performance.now?performance:Date,Ly=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(n){setTimeout(n,17)};function Hd(){return Fr||(Ly(PR),Fr=Qo.now()+Nh)}function PR(){Fr=0}function ql(){this._call=this._time=this._next=null}ql.prototype=By.prototype={constructor:ql,restart:function(n,e,t){if(typeof n!="function")throw new TypeError("callback is not a function");t=(t==null?Hd():+t)+(e==null?0:+e),!this._next&&oo!==this&&(oo?oo._next=this:Yl=this,oo=this),this._call=n,this._time=t,Xc()},stop:function(){this._call&&(this._call=null,this._time=1/0,Xc())}};function By(n,e,t){var i=new ql;return i.restart(n,e,t),i}function wR(){Hd(),++Fa;for(var n=Yl,e;n;)(e=Fr-n._time)>=0&&n._call.call(void 0,e),n=n._next;--Fa}function r1(){Fr=(jl=Qo.now())+Nh,Fa=ao=0;try{wR()}finally{Fa=0,OR(),Fr=0}}function DR(){var n=Qo.now(),e=n-jl;e>Fy&&(Nh-=e,jl=n)}function OR(){for(var n,e=Yl,t,i=1/0;e;)e._call?(i>e._time&&(i=e._time),n=e,e=e._next):(t=e._next,e._next=null,e=n?n._next=t:Yl=t);oo=n,Xc(i)}function Xc(n){if(!Fa){ao&&(ao=clearTimeout(ao));var e=n-Fr;e>24?(n<1/0&&(ao=setTimeout(r1,n-Qo.now()-Nh)),eo&&(eo=clearInterval(eo))):(eo||(jl=Qo.now(),eo=setInterval(DR,Fy)),Fa=1,Ly(r1))}}function a1(n,e,t){var i=new ql;return e=e==null?0:+e,i.restart(s=>{i.stop(),n(s+e)},e,t),i}var FR=py("start","end","cancel","interrupt"),LR=[],Ny=0,o1=1,Yc=2,al=3,l1=4,jc=5,ol=6;function Uh(n,e,t,i,s,r){var a=n.__transition;if(!a)n.__transition={};else if(t in a)return;BR(n,t,{name:e,index:i,group:s,on:FR,tween:LR,time:r.time,delay:r.delay,duration:r.duration,ease:r.ease,timer:null,state:Ny})}function Kd(n,e){var t=ws(n,e);if(t.state>Ny)throw new Error("too late; already scheduled");return t}function js(n,e){var t=ws(n,e);if(t.state>al)throw new Error("too late; already running");return t}function ws(n,e){var t=n.__transition;if(!t||!(t=t[e]))throw new Error("transition not found");return t}function BR(n,e,t){var i=n.__transition,s;i[e]=t,t.timer=By(r,0,t.time);function r(h){t.state=o1,t.timer.restart(a,t.delay,t.time),t.delay<=h&&a(h-t.delay)}function a(h){var u,c,f,d;if(t.state!==o1)return l();for(u in i)if(d=i[u],d.name===t.name){if(d.state===al)return a1(a);d.state===l1?(d.state=ol,d.timer.stop(),d.on.call("interrupt",n,n.__data__,d.index,d.group),delete i[u]):+u<e&&(d.state=ol,d.timer.stop(),d.on.call("cancel",n,n.__data__,d.index,d.group),delete i[u])}if(a1(function(){t.state===al&&(t.state=l1,t.timer.restart(o,t.delay,t.time),o(h))}),t.state=Yc,t.on.call("start",n,n.__data__,t.index,t.group),t.state===Yc){for(t.state=al,s=new Array(f=t.tween.length),u=0,c=-1;u<f;++u)(d=t.tween[u].value.call(n,n.__data__,t.index,t.group))&&(s[++c]=d);s.length=c+1}}function o(h){for(var u=h<t.duration?t.ease.call(null,h/t.duration):(t.timer.restart(l),t.state=jc,1),c=-1,f=s.length;++c<f;)s[c].call(n,u);t.state===jc&&(t.on.call("end",n,n.__data__,t.index,t.group),l())}function l(){t.state=ol,t.timer.stop(),delete i[e];for(var h in i)return;delete n.__transition}}function NR(n,e){var t=n.__transition,i,s,r=!0,a;if(t){e=e==null?null:e+"";for(a in t){if((i=t[a]).name!==e){r=!1;continue}s=i.state>Yc&&i.state<jc,i.state=ol,i.timer.stop(),i.on.call(s?"interrupt":"cancel",n,n.__data__,i.index,i.group),delete t[a]}r&&delete n.__transition}}function UR(n){return this.each(function(){NR(this,n)})}function kR(n,e){var t,i;return function(){var s=js(this,n),r=s.tween;if(r!==t){i=t=r;for(var a=0,o=i.length;a<o;++a)if(i[a].name===e){i=i.slice(),i.splice(a,1);break}}s.tween=i}}function VR(n,e,t){var i,s;if(typeof t!="function")throw new Error;return function(){var r=js(this,n),a=r.tween;if(a!==i){s=(i=a).slice();for(var o={name:e,value:t},l=0,h=s.length;l<h;++l)if(s[l].name===e){s[l]=o;break}l===h&&s.push(o)}r.tween=s}}function GR(n,e){var t=this._id;if(n+="",arguments.length<2){for(var i=ws(this.node(),t).tween,s=0,r=i.length,a;s<r;++s)if((a=i[s]).name===n)return a.value;return null}return this.each((e==null?kR:VR)(t,n,e))}function Xd(n,e,t){var i=n._id;return n.each(function(){var s=js(this,i);(s.value||(s.value={}))[e]=t.apply(this,arguments)}),function(s){return ws(s,i).value[e]}}function Uy(n,e){var t;return(typeof e=="number"?Fn:e instanceof Zo?s1:(t=Zo(e))?(e=t,s1):SR)(n,e)}function zR(n){return function(){this.removeAttribute(n)}}function WR(n){return function(){this.removeAttributeNS(n.space,n.local)}}function HR(n,e,t){var i,s=t+"",r;return function(){var a=this.getAttribute(n);return a===s?null:a===i?r:r=e(i=a,t)}}function KR(n,e,t){var i,s=t+"",r;return function(){var a=this.getAttributeNS(n.space,n.local);return a===s?null:a===i?r:r=e(i=a,t)}}function XR(n,e,t){var i,s,r;return function(){var a,o=t(this),l;return o==null?void this.removeAttribute(n):(a=this.getAttribute(n),l=o+"",a===l?null:a===i&&l===s?r:(s=l,r=e(i=a,o)))}}function YR(n,e,t){var i,s,r;return function(){var a,o=t(this),l;return o==null?void this.removeAttributeNS(n.space,n.local):(a=this.getAttributeNS(n.space,n.local),l=o+"",a===l?null:a===i&&l===s?r:(s=l,r=e(i=a,o)))}}function jR(n,e){var t=Bh(n),i=t==="transform"?MR:Uy;return this.attrTween(n,typeof e=="function"?(t.local?YR:XR)(t,i,Xd(this,"attr."+n,e)):e==null?(t.local?WR:zR)(t):(t.local?KR:HR)(t,i,e))}function qR(n,e){return function(t){this.setAttribute(n,e.call(this,t))}}function $R(n,e){return function(t){this.setAttributeNS(n.space,n.local,e.call(this,t))}}function ZR(n,e){var t,i;function s(){var r=e.apply(this,arguments);return r!==i&&(t=(i=r)&&$R(n,r)),t}return s._value=e,s}function QR(n,e){var t,i;function s(){var r=e.apply(this,arguments);return r!==i&&(t=(i=r)&&qR(n,r)),t}return s._value=e,s}function JR(n,e){var t="attr."+n;if(arguments.length<2)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;var i=Bh(n);return this.tween(t,(i.local?ZR:QR)(i,e))}function eI(n,e){return function(){Kd(this,n).delay=+e.apply(this,arguments)}}function tI(n,e){return e=+e,function(){Kd(this,n).delay=e}}function iI(n){var e=this._id;return arguments.length?this.each((typeof n=="function"?eI:tI)(e,n)):ws(this.node(),e).delay}function sI(n,e){return function(){js(this,n).duration=+e.apply(this,arguments)}}function nI(n,e){return e=+e,function(){js(this,n).duration=e}}function rI(n){var e=this._id;return arguments.length?this.each((typeof n=="function"?sI:nI)(e,n)):ws(this.node(),e).duration}function aI(n,e){if(typeof e!="function")throw new Error;return function(){js(this,n).ease=e}}function oI(n){var e=this._id;return arguments.length?this.each(aI(e,n)):ws(this.node(),e).ease}function lI(n,e){return function(){var t=e.apply(this,arguments);if(typeof t!="function")throw new Error;js(this,n).ease=t}}function hI(n){if(typeof n!="function")throw new Error;return this.each(lI(this._id,n))}function uI(n){typeof n!="function"&&(n=my(n));for(var e=this._groups,t=e.length,i=new Array(t),s=0;s<t;++s)for(var r=e[s],a=r.length,o=i[s]=[],l,h=0;h<a;++h)(l=r[h])&&n.call(l,l.__data__,h,r)&&o.push(l);return new Tn(i,this._parents,this._name,this._id)}function cI(n){if(n._id!==this._id)throw new Error;for(var e=this._groups,t=n._groups,i=e.length,s=t.length,r=Math.min(i,s),a=new Array(i),o=0;o<r;++o)for(var l=e[o],h=t[o],u=l.length,c=a[o]=new Array(u),f,d=0;d<u;++d)(f=l[d]||h[d])&&(c[d]=f);for(;o<i;++o)a[o]=e[o];return new Tn(a,this._parents,this._name,this._id)}function fI(n){return(n+"").trim().split(/^|\s+/).every(function(e){var t=e.indexOf(".");return t>=0&&(e=e.slice(0,t)),!e||e==="start"})}function dI(n,e,t){var i,s,r=fI(e)?Kd:js;return function(){var a=r(this,n),o=a.on;o!==i&&(s=(i=o).copy()).on(e,t),a.on=s}}function _I(n,e){var t=this._id;return arguments.length<2?ws(this.node(),t).on.on(n):this.each(dI(t,n,e))}function pI(n){return function(){var e=this.parentNode;for(var t in this.__transition)if(+t!==n)return;e&&e.removeChild(this)}}function gI(){return this.on("end.remove",pI(this._id))}function mI(n){var e=this._name,t=this._id;typeof n!="function"&&(n=Gd(n));for(var i=this._groups,s=i.length,r=new Array(s),a=0;a<s;++a)for(var o=i[a],l=o.length,h=r[a]=new Array(l),u,c,f=0;f<l;++f)(u=o[f])&&(c=n.call(u,u.__data__,f,o))&&("__data__"in u&&(c.__data__=u.__data__),h[f]=c,Uh(h[f],e,t,f,h,ws(u,t)));return new Tn(r,this._parents,e,t)}function vI(n){var e=this._name,t=this._id;typeof n!="function"&&(n=gy(n));for(var i=this._groups,s=i.length,r=[],a=[],o=0;o<s;++o)for(var l=i[o],h=l.length,u,c=0;c<h;++c)if(u=l[c]){for(var f=n.call(u,u.__data__,c,l),d,_=ws(u,t),p=0,g=f.length;p<g;++p)(d=f[p])&&Uh(d,e,t,p,f,_);r.push(f),a.push(u)}return new Tn(r,a,e,t)}var yI=d0.prototype.constructor;function xI(){return new yI(this._groups,this._parents)}function bI(n,e){var t,i,s;return function(){var r=Oa(this,n),a=(this.style.removeProperty(n),Oa(this,n));return r===a?null:r===t&&a===i?s:s=e(t=r,i=a)}}function ky(n){return function(){this.style.removeProperty(n)}}function TI(n,e,t){var i,s=t+"",r;return function(){var a=Oa(this,n);return a===s?null:a===i?r:r=e(i=a,t)}}function AI(n,e,t){var i,s,r;return function(){var a=Oa(this,n),o=t(this),l=o+"";return o==null&&(l=o=(this.style.removeProperty(n),Oa(this,n))),a===l?null:a===i&&l===s?r:(s=l,r=e(i=a,o))}}function EI(n,e){var t,i,s,r="style."+e,a="end."+r,o;return function(){var l=js(this,n),h=l.on,u=l.value[r]==null?o||(o=ky(e)):void 0;(h!==t||s!==u)&&(i=(t=h).copy()).on(a,s=u),l.on=i}}function SI(n,e,t){var i=(n+="")=="transform"?CR:Uy;return e==null?this.styleTween(n,bI(n,i)).on("end.style."+n,ky(n)):typeof e=="function"?this.styleTween(n,AI(n,i,Xd(this,"style."+n,e))).each(EI(this._id,n)):this.styleTween(n,TI(n,i,e),t).on("end.style."+n,null)}function RI(n,e,t){return function(i){this.style.setProperty(n,e.call(this,i),t)}}function II(n,e,t){var i,s;function r(){var a=e.apply(this,arguments);return a!==s&&(i=(s=a)&&RI(n,a,t)),i}return r._value=e,r}function CI(n,e,t){var i="style."+(n+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(e==null)return this.tween(i,null);if(typeof e!="function")throw new Error;return this.tween(i,II(n,e,t??""))}function MI(n){return function(){this.textContent=n}}function PI(n){return function(){var e=n(this);this.textContent=e??""}}function wI(n){return this.tween("text",typeof n=="function"?PI(Xd(this,"text",n)):MI(n==null?"":n+""))}function DI(n){return function(e){this.textContent=n.call(this,e)}}function OI(n){var e,t;function i(){var s=n.apply(this,arguments);return s!==t&&(e=(t=s)&&DI(s)),e}return i._value=n,i}function FI(n){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(n==null)return this.tween(e,null);if(typeof n!="function")throw new Error;return this.tween(e,OI(n))}function LI(){for(var n=this._name,e=this._id,t=Vy(),i=this._groups,s=i.length,r=0;r<s;++r)for(var a=i[r],o=a.length,l,h=0;h<o;++h)if(l=a[h]){var u=ws(l,e);Uh(l,n,t,h,a,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new Tn(i,this._parents,n,t)}function BI(){var n,e,t=this,i=t._id,s=t.size();return new Promise(function(r,a){var o={value:a},l={value:function(){--s===0&&r()}};t.each(function(){var h=js(this,i),u=h.on;u!==n&&(e=(n=u).copy(),e._.cancel.push(o),e._.interrupt.push(o),e._.end.push(l)),h.on=e}),s===0&&r()})}var NI=0;function Tn(n,e,t,i){this._groups=n,this._parents=e,this._name=t,this._id=i}function Vy(){return++NI}var an=d0.prototype;Tn.prototype={constructor:Tn,select:mI,selectAll:vI,selectChild:an.selectChild,selectChildren:an.selectChildren,filter:uI,merge:cI,selection:xI,transition:LI,call:an.call,nodes:an.nodes,node:an.node,size:an.size,empty:an.empty,each:an.each,on:_I,attr:jR,attrTween:JR,style:SI,styleTween:CI,text:wI,textTween:FI,remove:gI,tween:GR,delay:iI,duration:rI,ease:oI,easeVarying:hI,end:BI,[Symbol.iterator]:an[Symbol.iterator]};function UI(n){return((n*=2)<=1?n*n*n:(n-=2)*n*n+2)/2}var kI={time:null,delay:0,duration:250,ease:UI};function VI(n,e){for(var t;!(t=n.__transition)||!(t=t[e]);)if(!(n=n.parentNode))throw new Error(`transition ${e} not found`);return t}function GI(n){var e,t;n instanceof Tn?(e=n._id,n=n._name):(e=Vy(),(t=kI).time=Hd(),n=n==null?null:n+"");for(var i=this._groups,s=i.length,r=0;r<s;++r)for(var a=i[r],o=a.length,l,h=0;h<o;++h)(l=a[h])&&Uh(l,n,e,h,a,t||VI(l,e));return new Tn(i,this._parents,n,e)}d0.prototype.interrupt=UR;d0.prototype.transition=GI;function lo(n,e,t){this.k=n,this.x=e,this.y=t}lo.prototype={constructor:lo,scale:function(n){return n===1?this:new lo(this.k*n,this.x,this.y)},translate:function(n,e){return n===0&e===0?this:new lo(this.k,this.x+this.k*n,this.y+this.k*e)},apply:function(n){return[n[0]*this.k+this.x,n[1]*this.k+this.y]},applyX:function(n){return n*this.k+this.x},applyY:function(n){return n*this.k+this.y},invert:function(n){return[(n[0]-this.x)/this.k,(n[1]-this.y)/this.k]},invertX:function(n){return(n-this.x)/this.k},invertY:function(n){return(n-this.y)/this.k},rescaleX:function(n){return n.copy().domain(n.range().map(this.invertX,this).map(n.invert,n))},rescaleY:function(n){return n.copy().domain(n.range().map(this.invertY,this).map(n.invert,n))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};lo.prototype;function Gy(n){let e=n.pathArray;const t=n.closeArray||!1,i=n.closePath||!1,s=n.invertUV||!1,r=Math.floor(e[0].length/2);let a=n.offset||r;a=a>r?r:Math.floor(a);const o=n.sideOrientation===0?0:n.sideOrientation||Q.DEFAULTSIDE,l=n.uvs,h=n.colors,u=[],c=[],f=[],d=[],_=[],p=[],g=[],m=[];let v;const T=[],A=[];let b,x,E;if(e.length<2){const pe=[],Pe=[];for(x=0;x<e[0].length-a;x++)pe.push(e[0][x]),Pe.push(e[0][x+a]);e=[pe,Pe]}let R=0;const C=i?1:0,I=t?1:0;let D,w;v=e[0].length;let z,F;for(b=0;b<e.length+I;b++){for(g[b]=0,_[b]=[0],D=b===e.length?e[0]:e[b],w=D.length,v=v<w?v:w,E=0;E<w;)u.push(D[E].x,D[E].y,D[E].z),E>0&&(z=D[E].subtract(D[E-1]).length(),F=z+g[b],_[b].push(F),g[b]=F),E++;i&&(E--,u.push(D[0].x,D[0].y,D[0].z),z=D[E].subtract(D[0]).length(),F=z+g[b],_[b].push(F),g[b]=F),T[b]=w+C,A[b]=R,R+=w+C}let W,X,he=null,H=null;for(x=0;x<v+C;x++)for(m[x]=0,p[x]=[0],b=0;b<e.length-1+I;b++)W=e[b],X=b===e.length-1?e[0]:e[b+1],x===v?(he=W[0],H=X[0]):(he=W[x],H=X[x]),z=H.subtract(he).length(),F=z+m[x],p[x].push(F),m[x]=F;let G,k;if(l)for(b=0;b<l.length;b++)d.push(l[b].x,l[b].y);else for(b=0;b<e.length+I;b++)for(x=0;x<v+C;x++)G=g[b]!=0?_[b][x]/g[b]:0,k=m[x]!=0?p[x][b]/m[x]:0,s?d.push(k,G):d.push(G,k);b=0;let M=0,V=T[b]-1,j=T[b+1]-1,ae=V<j?V:j,ge=A[1]-A[0];const $=T.length-1;for(;M<=ae&&b<$;)c.push(M,M+ge,M+1),c.push(M+ge+1,M+1,M+ge),M+=1,M===ae&&(b++,ge=A[b+1]-A[b],V=T[b]-1,j=T[b+1]-1,M=A[b],ae=V<j?V+M:j+M);if(Q.ComputeNormals(u,c,f),i){let pe=0,Pe=0;for(b=0;b<e.length;b++){pe=A[b]*3,b+1<e.length?Pe=(A[b+1]-1)*3:Pe=f.length-3,f[pe]=(f[pe]+f[Pe])*.5,f[pe+1]=(f[pe+1]+f[Pe+1])*.5,f[pe+2]=(f[pe+2]+f[Pe+2])*.5;const me=Math.sqrt(f[pe]*f[pe]+f[pe+1]*f[pe+1]+f[pe+2]*f[pe+2]);f[pe]/=me,f[pe+1]/=me,f[pe+2]/=me,f[Pe]=f[pe],f[Pe+1]=f[pe+1],f[Pe+2]=f[pe+2]}}if(t){let pe=A[0]*3,Pe=A[e.length]*3;for(x=0;x<v+C;x++){f[pe]=(f[pe]+f[Pe])*.5,f[pe+1]=(f[pe+1]+f[Pe+1])*.5,f[pe+2]=(f[pe+2]+f[Pe+2])*.5;const me=Math.sqrt(f[pe]*f[pe]+f[pe+1]*f[pe+1]+f[pe+2]*f[pe+2]);f[pe]/=me,f[pe+1]/=me,f[pe+2]/=me,f[Pe]=f[pe],f[Pe+1]=f[pe+1],f[Pe+2]=f[pe+2],pe+=3,Pe+=3}}Q._ComputeSides(o,u,c,f,d,n.frontUVs,n.backUVs);let le=null;if(h){le=new Float32Array(h.length*4);for(let pe=0;pe<h.length;pe++)le[pe*4]=h[pe].r,le[pe*4+1]=h[pe].g,le[pe*4+2]=h[pe].b,le[pe*4+3]=h[pe].a}const xe=new Q,ue=new Float32Array(u),Se=new Float32Array(f),ze=new Float32Array(d);return xe.indices=c,xe.positions=ue,xe.normals=Se,xe.uvs=ze,le&&xe.set(le,S.ColorKind),i&&(xe._idx=A),xe}function Lr(n,e,t=null){const i=e.pathArray,s=e.closeArray,r=e.closePath,a=O._GetDefaultSideOrientation(e.sideOrientation),o=e.instance,l=e.updatable;if(o){const h=N.Vector3[0].setAll(Number.MAX_VALUE),u=N.Vector3[1].setAll(-Number.MAX_VALUE),c=d=>{let _=i[0].length;const p=o;let g=0;const m=p._originalBuilderSideOrientation===O.DOUBLESIDE?2:1;for(let v=1;v<=m;++v)for(let T=0;T<i.length;++T){const A=i[T],b=A.length;_=_<b?_:b;for(let x=0;x<_;++x){const E=A[x];d[g]=E.x,d[g+1]=E.y,d[g+2]=E.z,h.minimizeInPlaceFromFloats(E.x,E.y,E.z),u.maximizeInPlaceFromFloats(E.x,E.y,E.z),g+=3}if(p._creationDataStorage&&p._creationDataStorage.closePath){const x=A[0];d[g]=x.x,d[g+1]=x.y,d[g+2]=x.z,g+=3}}},f=o.getVerticesData(S.PositionKind);if(c(f),o.hasBoundingInfo?o.getBoundingInfo().reConstruct(h,u,o._worldMatrix):o.buildBoundingInfo(h,u,o._worldMatrix),o.updateVerticesData(S.PositionKind,f,!1,!1),e.colors){const d=o.getVerticesData(S.ColorKind);for(let _=0,p=0;_<e.colors.length;_++,p+=4){const g=e.colors[_];d[p]=g.r,d[p+1]=g.g,d[p+2]=g.b,d[p+3]=g.a}o.updateVerticesData(S.ColorKind,d,!1,!1)}if(e.uvs){const d=o.getVerticesData(S.UVKind);for(let _=0;_<e.uvs.length;_++)d[_*2]=e.uvs[_].x,d[_*2+1]=e.uvs[_].y;o.updateVerticesData(S.UVKind,d,!1,!1)}if(!o.areNormalsFrozen||o.isFacetDataEnabled){const d=o.getIndices(),_=o.getVerticesData(S.NormalKind),p=o.isFacetDataEnabled?o.getFacetDataParameters():null;if(Q.ComputeNormals(f,d,_,p),o._creationDataStorage&&o._creationDataStorage.closePath){let g=0,m=0;for(let v=0;v<i.length;v++)g=o._creationDataStorage.idx[v]*3,v+1<i.length?m=(o._creationDataStorage.idx[v+1]-1)*3:m=_.length-3,_[g]=(_[g]+_[m])*.5,_[g+1]=(_[g+1]+_[m+1])*.5,_[g+2]=(_[g+2]+_[m+2])*.5,_[m]=_[g],_[m+1]=_[g+1],_[m+2]=_[g+2]}o.areNormalsFrozen||o.updateVerticesData(S.NormalKind,_,!1,!1)}return o}else{const h=new O(n,t);h._originalBuilderSideOrientation=a,h._creationDataStorage=new ey;const u=Gy(e);return r&&(h._creationDataStorage.idx=u._idx),h._creationDataStorage.closePath=r,h._creationDataStorage.closeArray=s,u.applyToMesh(h,l),h}}Q.CreateRibbon=Gy;O.CreateRibbon=(n,e,t=!1,i,s,r,a=!1,o,l)=>Lr(n,{pathArray:e,closeArray:t,closePath:i,offset:s,updatable:a,sideOrientation:o,instance:l},r);function zy(n){const e=[],t=[],i=[],s=[],r=n.radius||.5,a=n.tessellation||64,o=n.arc&&(n.arc<=0||n.arc>1)?1:n.arc||1,l=n.sideOrientation===0?0:n.sideOrientation||Q.DEFAULTSIDE;e.push(0,0,0),s.push(.5,.5);const h=Math.PI*2*o,u=o===1?h/a:h/(a-1);let c=0;for(let _=0;_<a;_++){const p=Math.cos(c),g=Math.sin(c),m=(p+1)/2,v=(1-g)/2;e.push(r*p,r*g,0),s.push(m,v),c+=u}o===1&&(e.push(e[3],e[4],e[5]),s.push(s[2],s[3]));const f=e.length/3;for(let _=1;_<f-1;_++)t.push(_+1,0,_);Q.ComputeNormals(e,t,i),Q._ComputeSides(l,e,t,i,s,n.frontUVs,n.backUVs);const d=new Q;return d.indices=t,d.positions=e,d.normals=i,d.uvs=s,d}function Wy(n,e={},t=null){const i=new O(n,t);return e.sideOrientation=O._GetDefaultSideOrientation(e.sideOrientation),i._originalBuilderSideOrientation=e.sideOrientation,zy(e).applyToMesh(i,e.updatable),i}Q.CreateDisc=zy;O.CreateDisc=(n,e,t,i=null,s,r)=>Wy(n,{radius:e,tessellation:t,sideOrientation:r,updatable:s},i);O._GroundMeshParser=(n,e)=>p0.Parse(n,e);class p0 extends O{constructor(e,t){super(e,t),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(e,t=32){this._subdivisionsX=e,this._subdivisionsY=e,this.subdivide(e);const i=this;i.createOrUpdateSubmeshesOctree&&i.createOrUpdateSubmeshesOctree(t)}getHeightAtCoordinates(e,t){const i=this.getWorldMatrix(),s=N.Matrix[5];i.invertToRef(s);const r=N.Vector3[8];if(y.TransformCoordinatesFromFloatsToRef(e,0,t,s,r),e=r.x,t=r.z,e<this._minX||e>=this._maxX||t<=this._minZ||t>this._maxZ)return this.position.y;(!this._heightQuads||this._heightQuads.length==0)&&(this._initHeightQuads(),this._computeHeightQuads());const a=this._getFacetAt(e,t),o=-(a.x*e+a.z*t+a.w)/a.y;return y.TransformCoordinatesFromFloatsToRef(0,o,0,i,r),r.y}getNormalAtCoordinates(e,t){const i=new y(0,1,0);return this.getNormalAtCoordinatesToRef(e,t,i),i}getNormalAtCoordinatesToRef(e,t,i){const s=this.getWorldMatrix(),r=N.Matrix[5];s.invertToRef(r);const a=N.Vector3[8];if(y.TransformCoordinatesFromFloatsToRef(e,0,t,r,a),e=a.x,t=a.z,e<this._minX||e>this._maxX||t<this._minZ||t>this._maxZ)return this;(!this._heightQuads||this._heightQuads.length==0)&&(this._initHeightQuads(),this._computeHeightQuads());const o=this._getFacetAt(e,t);return y.TransformNormalFromFloatsToRef(o.x,o.y,o.z,s,i),this}updateCoordinateHeights(){return(!this._heightQuads||this._heightQuads.length==0)&&this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(e,t){const i=Math.floor((e+this._maxX)*this._subdivisionsX/this._width),s=Math.floor(-(t+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),r=this._heightQuads[s*this._subdivisionsX+i];let a;return t<r.slope.x*e+r.slope.y?a=r.facet1:a=r.facet2,a}_initHeightQuads(){const e=this._subdivisionsX,t=this._subdivisionsY;this._heightQuads=new Array;for(let i=0;i<t;i++)for(let s=0;s<e;s++){const r={slope:ne.Zero(),facet1:new Oe(0,0,0,0),facet2:new Oe(0,0,0,0)};this._heightQuads[i*e+s]=r}return this}_computeHeightQuads(){const e=this.getVerticesData(S.PositionKind);if(!e)return this;const t=N.Vector3[3],i=N.Vector3[2],s=N.Vector3[1],r=N.Vector3[0],a=N.Vector3[4],o=N.Vector3[5],l=N.Vector3[6],h=N.Vector3[7],u=N.Vector3[8];let c=0,f=0,d=0,_=0,p=0,g=0,m=0;const v=this._subdivisionsX,T=this._subdivisionsY;for(let A=0;A<T;A++)for(let b=0;b<v;b++){c=b*3,f=A*(v+1)*3,d=(A+1)*(v+1)*3,t.x=e[f+c],t.y=e[f+c+1],t.z=e[f+c+2],i.x=e[f+c+3],i.y=e[f+c+4],i.z=e[f+c+5],s.x=e[d+c],s.y=e[d+c+1],s.z=e[d+c+2],r.x=e[d+c+3],r.y=e[d+c+4],r.z=e[d+c+5],_=(r.z-t.z)/(r.x-t.x),p=t.z-_*t.x,i.subtractToRef(t,a),s.subtractToRef(t,o),r.subtractToRef(t,l),y.CrossToRef(l,o,h),y.CrossToRef(a,l,u),h.normalize(),u.normalize(),g=-(h.x*t.x+h.y*t.y+h.z*t.z),m=-(u.x*i.x+u.y*i.y+u.z*i.z);const x=this._heightQuads[A*v+b];x.slope.copyFromFloats(_,p),x.facet1.copyFromFloats(h.x,h.y,h.z,g),x.facet2.copyFromFloats(u.x,u.y,u.z,m)}return this}serialize(e){super.serialize(e),e.subdivisionsX=this._subdivisionsX,e.subdivisionsY=this._subdivisionsY,e.minX=this._minX,e.maxX=this._maxX,e.minZ=this._minZ,e.maxZ=this._maxZ,e.width=this._width,e.height=this._height}static Parse(e,t){const i=new p0(e.name,t);return i._subdivisionsX=e.subdivisionsX||1,i._subdivisionsY=e.subdivisionsY||1,i._minX=e.minX,i._maxX=e.maxX,i._minZ=e.minZ,i._maxZ=e.maxZ,i._width=e.width,i._height=e.height,i}}function Hy(n){const e=[],t=[],i=[],s=[];let r,a;const o=n.width||n.size||1,l=n.height||n.size||1,h=(n.subdivisionsX||n.subdivisions||1)|0,u=(n.subdivisionsY||n.subdivisions||1)|0;for(r=0;r<=u;r++)for(a=0;a<=h;a++){const f=new y(a*o/h-o/2,0,(u-r)*l/u-l/2),d=new y(0,1,0);t.push(f.x,f.y,f.z),i.push(d.x,d.y,d.z),s.push(a/h,1-r/u)}for(r=0;r<u;r++)for(a=0;a<h;a++)e.push(a+1+(r+1)*(h+1)),e.push(a+1+r*(h+1)),e.push(a+r*(h+1)),e.push(a+(r+1)*(h+1)),e.push(a+1+(r+1)*(h+1)),e.push(a+r*(h+1));const c=new Q;return c.indices=e,c.positions=t,c.normals=i,c.uvs=s,c}function Ky(n){const e=n.xmin!==void 0&&n.xmin!==null?n.xmin:-1,t=n.zmin!==void 0&&n.zmin!==null?n.zmin:-1,i=n.xmax!==void 0&&n.xmax!==null?n.xmax:1,s=n.zmax!==void 0&&n.zmax!==null?n.zmax:1,r=n.subdivisions||{w:1,h:1},a=n.precision||{w:1,h:1},o=[],l=[],h=[],u=[];let c,f,d,_;r.h=r.h<1?1:r.h,r.w=r.w<1?1:r.w,a.w=a.w<1?1:a.w,a.h=a.h<1?1:a.h;const p={w:(i-e)/r.w,h:(s-t)/r.h};function g(v,T,A,b){const x=l.length/3,E=a.w+1;for(c=0;c<a.h;c++)for(f=0;f<a.w;f++){const I=[x+f+c*E,x+(f+1)+c*E,x+(f+1)+(c+1)*E,x+f+(c+1)*E];o.push(I[1]),o.push(I[2]),o.push(I[3]),o.push(I[0]),o.push(I[1]),o.push(I[3])}const R=y.Zero(),C=new y(0,1,0);for(c=0;c<=a.h;c++)for(R.z=c*(b-T)/a.h+T,f=0;f<=a.w;f++)R.x=f*(A-v)/a.w+v,R.y=0,l.push(R.x,R.y,R.z),h.push(C.x,C.y,C.z),u.push(f/a.w,c/a.h)}for(d=0;d<r.h;d++)for(_=0;_<r.w;_++)g(e+_*p.w,t+d*p.h,e+(_+1)*p.w,t+(d+1)*p.h);const m=new Q;return m.indices=o,m.positions=l,m.normals=h,m.uvs=u,m}function Xy(n){const e=[],t=[],i=[],s=[];let r,a;const o=n.colorFilter||new fe(.3,.59,.11),l=n.alphaFilter||0;let h=!1;if(n.minHeight>n.maxHeight){h=!0;const c=n.maxHeight;n.maxHeight=n.minHeight,n.minHeight=c}for(r=0;r<=n.subdivisions;r++)for(a=0;a<=n.subdivisions;a++){const c=new y(a*n.width/n.subdivisions-n.width/2,0,(n.subdivisions-r)*n.height/n.subdivisions-n.height/2),f=(c.x+n.width/2)/n.width*(n.bufferWidth-1)|0,d=(1-(c.z+n.height/2)/n.height)*(n.bufferHeight-1)|0,_=(f+d*n.bufferWidth)*4;let p=n.buffer[_]/255,g=n.buffer[_+1]/255,m=n.buffer[_+2]/255;const v=n.buffer[_+3]/255;h&&(p=1-p,g=1-g,m=1-m);const T=p*o.r+g*o.g+m*o.b;v>=l?c.y=n.minHeight+(n.maxHeight-n.minHeight)*T:c.y=n.minHeight-Ue,n.heightBuffer&&(n.heightBuffer[r*(n.subdivisions+1)+a]=c.y),t.push(c.x,c.y,c.z),i.push(0,0,0),s.push(a/n.subdivisions,1-r/n.subdivisions)}for(r=0;r<n.subdivisions;r++)for(a=0;a<n.subdivisions;a++){const c=a+1+(r+1)*(n.subdivisions+1),f=a+1+r*(n.subdivisions+1),d=a+r*(n.subdivisions+1),_=a+(r+1)*(n.subdivisions+1),p=t[c*3+1]>=n.minHeight,g=t[f*3+1]>=n.minHeight,m=t[d*3+1]>=n.minHeight;p&&g&&m&&(e.push(c),e.push(f),e.push(d)),t[_*3+1]>=n.minHeight&&p&&m&&(e.push(_),e.push(c),e.push(d))}Q.ComputeNormals(t,e,i);const u=new Q;return u.indices=e,u.positions=t,u.normals=i,u.uvs=s,u}function Yy(n,e={},t){const i=new p0(n,t);return i._setReady(!1),i._subdivisionsX=e.subdivisionsX||e.subdivisions||1,i._subdivisionsY=e.subdivisionsY||e.subdivisions||1,i._width=e.width||1,i._height=e.height||1,i._maxX=i._width/2,i._maxZ=i._height/2,i._minX=-i._maxX,i._minZ=-i._maxZ,Hy(e).applyToMesh(i,e.updatable),i._setReady(!0),i}function jy(n,e,t=null){const i=new O(n,t);return Ky(e).applyToMesh(i,e.updatable),i}function qy(n,e,t={},i=null){const s=t.width||10,r=t.height||10,a=t.subdivisions||1,o=t.minHeight||0,l=t.maxHeight||1,h=t.colorFilter||new fe(.3,.59,.11),u=t.alphaFilter||0,c=t.updatable,f=t.onReady;i=i||Ae.LastCreatedScene;const d=new p0(n,i);d._subdivisionsX=a,d._subdivisionsY=a,d._width=s,d._height=r,d._maxX=d._width/2,d._maxZ=d._height/2,d._minX=-d._maxX,d._minZ=-d._maxZ,d._setReady(!1);let _;t.passHeightBufferInCallback&&(_=new Float32Array((a+1)*(a+1)));const p=(g,m,v)=>{Xy({width:s,height:r,subdivisions:a,minHeight:o,maxHeight:l,colorFilter:h,buffer:g,bufferWidth:m,bufferHeight:v,alphaFilter:u,heightBuffer:_}).applyToMesh(d,c),f&&f(d,_),d._setReady(!0)};if(typeof e=="string"){const g=m=>{const v=m.width,T=m.height;if(i.isDisposed)return;const A=i==null?void 0:i.getEngine().resizeImageBitmap(m,v,T);p(A,v,T)};Z.LoadImage(e,g,t.onError?t.onError:()=>{},i.offlineProvider)}else p(e.data,e.width,e.height);return d}Q.CreateGround=Hy;Q.CreateTiledGround=Ky;Q.CreateGroundFromHeightMap=Xy;O.CreateGround=(n,e,t,i,s,r)=>Yy(n,{width:e,height:t,subdivisions:i,updatable:r},s);O.CreateTiledGround=(n,e,t,i,s,r,a,o,l)=>jy(n,{xmin:e,zmin:t,xmax:i,zmax:s,subdivisions:r,precision:a,updatable:l},o);O.CreateGroundFromHeightMap=(n,e,t,i,s,r,a,o,l,h,u)=>qy(n,e,{width:t,height:i,subdivisions:s,minHeight:r,maxHeight:a,updatable:l,onReady:h,alphaFilter:u},o);function $y(n){let t=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const i=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],s=[];let r=[];const a=n.width||n.size||1,o=n.height||n.size||1,l=n.depth||n.size||1,h=n.wrap||!1;let u=n.topBaseAt===void 0?1:n.topBaseAt,c=n.bottomBaseAt===void 0?0:n.bottomBaseAt;u=(u+4)%4,c=(c+4)%4;const f=[2,0,3,1],d=[2,0,1,3];let _=f[u],p=d[c],g=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(h){t=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],g=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let E=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],R=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const C=[17,18,19,16],I=[22,23,20,21];for(;_>0;)E.unshift(E.pop()),C.unshift(C.pop()),_--;for(;p>0;)R.unshift(R.pop()),I.unshift(I.pop()),p--;E=E.flat(),R=R.flat(),g=g.concat(E).concat(R),t.push(C[0],C[2],C[3],C[0],C[1],C[2]),t.push(I[0],I[2],I[3],I[0],I[1],I[2])}const m=[a/2,o/2,l/2];r=g.reduce((E,R,C)=>E.concat(R*m[C%3]),[]);const v=n.sideOrientation===0?0:n.sideOrientation||Q.DEFAULTSIDE,T=n.faceUV||new Array(6),A=n.faceColors,b=[];for(let E=0;E<6;E++)T[E]===void 0&&(T[E]=new Oe(0,0,1,1)),A&&A[E]===void 0&&(A[E]=new K(1,1,1,1));for(let E=0;E<6;E++)if(s.push(T[E].z,T[E].w),s.push(T[E].x,T[E].w),s.push(T[E].x,T[E].y),s.push(T[E].z,T[E].y),A)for(let R=0;R<4;R++)b.push(A[E].r,A[E].g,A[E].b,A[E].a);Q._ComputeSides(v,r,t,i,s,n.frontUVs,n.backUVs);const x=new Q;if(x.indices=t,x.positions=r,x.normals=i,x.uvs=s,A){const E=v===Q.DOUBLESIDE?b.concat(b):b;x.colors=E}return x}function Zy(n,e={},t=null){const i=new O(n,t);return e.sideOrientation=O._GetDefaultSideOrientation(e.sideOrientation),i._originalBuilderSideOrientation=e.sideOrientation,$y(e).applyToMesh(i,e.updatable),i}Q.CreateBox=$y;O.CreateBox=(n,e,t=null,i,s)=>Zy(n,{size:e,sideOrientation:s,updatable:i},t);function To(n){const e=n.pattern||O.NO_FLIP,t=n.tileWidth||n.tileSize||1,i=n.tileHeight||n.tileSize||1,s=n.alignHorizontal||0,r=n.alignVertical||0,a=n.width||n.size||1,o=Math.floor(a/t);let l=a-o*t;const h=n.height||n.size||1,u=Math.floor(h/i);let c=h-u*i;const f=t*o/2,d=i*u/2;let _=0,p=0,g=0,m=0,v=0,T=0;if(l>0||c>0){switch(g=-f,m=-d,v=f,T=d,s){case O.CENTER:l/=2,g-=l,v+=l;break;case O.LEFT:v+=l,_=-l/2;break;case O.RIGHT:g-=l,_=l/2;break}switch(r){case O.CENTER:c/=2,m-=c,T+=c;break;case O.BOTTOM:T+=c,p=-c/2;break;case O.TOP:m-=c,p=c/2;break}}const A=[],b=[],x=[];x[0]=[0,0,1,0,1,1,0,1],x[1]=[0,0,1,0,1,1,0,1],(e===O.ROTATE_TILE||e===O.ROTATE_ROW)&&(x[1]=[1,1,0,1,0,0,1,0]),(e===O.FLIP_TILE||e===O.FLIP_ROW)&&(x[1]=[1,0,0,0,0,1,1,1]),(e===O.FLIP_N_ROTATE_TILE||e===O.FLIP_N_ROTATE_ROW)&&(x[1]=[0,1,1,1,1,0,0,0]);let E=[];const R=[],C=[];let I=0;for(let F=0;F<u;F++)for(let W=0;W<o;W++)A.push(-f+W*t+_,-d+F*i+p,0),A.push(-f+(W+1)*t+_,-d+F*i+p,0),A.push(-f+(W+1)*t+_,-d+(F+1)*i+p,0),A.push(-f+W*t+_,-d+(F+1)*i+p,0),C.push(I,I+1,I+3,I+1,I+2,I+3),e===O.FLIP_TILE||e===O.ROTATE_TILE||e===O.FLIP_N_ROTATE_TILE?E=E.concat(x[(W%2+F%2)%2]):e===O.FLIP_ROW||e===O.ROTATE_ROW||e===O.FLIP_N_ROTATE_ROW?E=E.concat(x[F%2]):E=E.concat(x[0]),R.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),b.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),I+=4;if(l>0||c>0){const F=c>0&&(r===O.CENTER||r===O.TOP),W=c>0&&(r===O.CENTER||r===O.BOTTOM),X=l>0&&(s===O.CENTER||s===O.RIGHT),he=l>0&&(s===O.CENTER||s===O.LEFT);let H=[],G,k,M,V;if(F&&X&&(A.push(g+_,m+p,0),A.push(-f+_,m+p,0),A.push(-f+_,m+c+p,0),A.push(g+_,m+c+p,0),C.push(I,I+1,I+3,I+1,I+2,I+3),I+=4,G=1-l/t,k=1-c/i,M=1,V=1,H=[G,k,M,k,M,V,G,V],e===O.ROTATE_ROW&&(H=[1-G,1-k,1-M,1-k,1-M,1-V,1-G,1-V]),e===O.FLIP_ROW&&(H=[1-G,k,1-M,k,1-M,V,1-G,V]),e===O.FLIP_N_ROTATE_ROW&&(H=[G,1-k,M,1-k,M,1-V,G,1-V]),E=E.concat(H),R.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),b.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),F&&he&&(A.push(f+_,m+p,0),A.push(v+_,m+p,0),A.push(v+_,m+c+p,0),A.push(f+_,m+c+p,0),C.push(I,I+1,I+3,I+1,I+2,I+3),I+=4,G=0,k=1-c/i,M=l/t,V=1,H=[G,k,M,k,M,V,G,V],(e===O.ROTATE_ROW||e===O.ROTATE_TILE&&o%2===0)&&(H=[1-G,1-k,1-M,1-k,1-M,1-V,1-G,1-V]),(e===O.FLIP_ROW||e===O.FLIP_TILE&&o%2===0)&&(H=[1-G,k,1-M,k,1-M,V,1-G,V]),(e===O.FLIP_N_ROTATE_ROW||e===O.FLIP_N_ROTATE_TILE&&o%2===0)&&(H=[G,1-k,M,1-k,M,1-V,G,1-V]),E=E.concat(H),R.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),b.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),W&&X&&(A.push(g+_,d+p,0),A.push(-f+_,d+p,0),A.push(-f+_,T+p,0),A.push(g+_,T+p,0),C.push(I,I+1,I+3,I+1,I+2,I+3),I+=4,G=1-l/t,k=0,M=1,V=c/i,H=[G,k,M,k,M,V,G,V],(e===O.ROTATE_ROW&&u%2===1||e===O.ROTATE_TILE&&u%1===0)&&(H=[1-G,1-k,1-M,1-k,1-M,1-V,1-G,1-V]),(e===O.FLIP_ROW&&u%2===1||e===O.FLIP_TILE&&u%2===0)&&(H=[1-G,k,1-M,k,1-M,V,1-G,V]),(e===O.FLIP_N_ROTATE_ROW&&u%2===1||e===O.FLIP_N_ROTATE_TILE&&u%2===0)&&(H=[G,1-k,M,1-k,M,1-V,G,1-V]),E=E.concat(H),R.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),b.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),W&&he&&(A.push(f+_,d+p,0),A.push(v+_,d+p,0),A.push(v+_,T+p,0),A.push(f+_,T+p,0),C.push(I,I+1,I+3,I+1,I+2,I+3),I+=4,G=0,k=0,M=l/t,V=c/i,H=[G,k,M,k,M,V,G,V],(e===O.ROTATE_ROW&&u%2===1||e===O.ROTATE_TILE&&(u+o)%2===1)&&(H=[1-G,1-k,1-M,1-k,1-M,1-V,1-G,1-V]),(e===O.FLIP_ROW&&u%2===1||e===O.FLIP_TILE&&(u+o)%2===1)&&(H=[1-G,k,1-M,k,1-M,V,1-G,V]),(e===O.FLIP_N_ROTATE_ROW&&u%2===1||e===O.FLIP_N_ROTATE_TILE&&(u+o)%2===1)&&(H=[G,1-k,M,1-k,M,1-V,G,1-V]),E=E.concat(H),R.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),b.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),F){const j=[];G=0,k=1-c/i,M=1,V=1,j[0]=[G,k,M,k,M,V,G,V],j[1]=[G,k,M,k,M,V,G,V],(e===O.ROTATE_TILE||e===O.ROTATE_ROW)&&(j[1]=[1-G,1-k,1-M,1-k,1-M,1-V,1-G,1-V]),(e===O.FLIP_TILE||e===O.FLIP_ROW)&&(j[1]=[1-G,k,1-M,k,1-M,V,1-G,V]),(e===O.FLIP_N_ROTATE_TILE||e===O.FLIP_N_ROTATE_ROW)&&(j[1]=[G,1-k,M,1-k,M,1-V,G,1-V]);for(let ae=0;ae<o;ae++)A.push(-f+ae*t+_,m+p,0),A.push(-f+(ae+1)*t+_,m+p,0),A.push(-f+(ae+1)*t+_,m+c+p,0),A.push(-f+ae*t+_,m+c+p,0),C.push(I,I+1,I+3,I+1,I+2,I+3),I+=4,e===O.FLIP_TILE||e===O.ROTATE_TILE||e===O.FLIP_N_ROTATE_TILE?E=E.concat(j[(ae+1)%2]):e===O.FLIP_ROW||e===O.ROTATE_ROW||e===O.FLIP_N_ROTATE_ROW?E=E.concat(j[1]):E=E.concat(j[0]),R.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),b.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(W){const j=[];G=0,k=0,M=1,V=c/i,j[0]=[G,k,M,k,M,V,G,V],j[1]=[G,k,M,k,M,V,G,V],(e===O.ROTATE_TILE||e===O.ROTATE_ROW)&&(j[1]=[1-G,1-k,1-M,1-k,1-M,1-V,1-G,1-V]),(e===O.FLIP_TILE||e===O.FLIP_ROW)&&(j[1]=[1-G,k,1-M,k,1-M,V,1-G,V]),(e===O.FLIP_N_ROTATE_TILE||e===O.FLIP_N_ROTATE_ROW)&&(j[1]=[G,1-k,M,1-k,M,1-V,G,1-V]);for(let ae=0;ae<o;ae++)A.push(-f+ae*t+_,T-c+p,0),A.push(-f+(ae+1)*t+_,T-c+p,0),A.push(-f+(ae+1)*t+_,T+p,0),A.push(-f+ae*t+_,T+p,0),C.push(I,I+1,I+3,I+1,I+2,I+3),I+=4,e===O.FLIP_TILE||e===O.ROTATE_TILE||e===O.FLIP_N_ROTATE_TILE?E=E.concat(j[(ae+u)%2]):e===O.FLIP_ROW||e===O.ROTATE_ROW||e===O.FLIP_N_ROTATE_ROW?E=E.concat(j[u%2]):E=E.concat(j[0]),R.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),b.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(X){const j=[];G=1-l/t,k=0,M=1,V=1,j[0]=[G,k,M,k,M,V,G,V],j[1]=[G,k,M,k,M,V,G,V],(e===O.ROTATE_TILE||e===O.ROTATE_ROW)&&(j[1]=[1-G,1-k,1-M,1-k,1-M,1-V,1-G,1-V]),(e===O.FLIP_TILE||e===O.FLIP_ROW)&&(j[1]=[1-G,k,1-M,k,1-M,V,1-G,V]),(e===O.FLIP_N_ROTATE_TILE||e===O.FLIP_N_ROTATE_ROW)&&(j[1]=[G,1-k,M,1-k,M,1-V,G,1-V]);for(let ae=0;ae<u;ae++)A.push(g+_,-d+ae*i+p,0),A.push(g+l+_,-d+ae*i+p,0),A.push(g+l+_,-d+(ae+1)*i+p,0),A.push(g+_,-d+(ae+1)*i+p,0),C.push(I,I+1,I+3,I+1,I+2,I+3),I+=4,e===O.FLIP_TILE||e===O.ROTATE_TILE||e===O.FLIP_N_ROTATE_TILE?E=E.concat(j[(ae+1)%2]):e===O.FLIP_ROW||e===O.ROTATE_ROW||e===O.FLIP_N_ROTATE_ROW?E=E.concat(j[ae%2]):E=E.concat(j[0]),R.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),b.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(he){const j=[];G=0,k=0,M=l/i,V=1,j[0]=[G,k,M,k,M,V,G,V],j[1]=[G,k,M,k,M,V,G,V],(e===O.ROTATE_TILE||e===O.ROTATE_ROW)&&(j[1]=[1-G,1-k,1-M,1-k,1-M,1-V,1-G,1-V]),(e===O.FLIP_TILE||e===O.FLIP_ROW)&&(j[1]=[1-G,k,1-M,k,1-M,V,1-G,V]),(e===O.FLIP_N_ROTATE_TILE||e===O.FLIP_N_ROTATE_ROW)&&(j[1]=[G,1-k,M,1-k,M,1-V,G,1-V]);for(let ae=0;ae<u;ae++)A.push(v-l+_,-d+ae*i+p,0),A.push(v+_,-d+ae*i+p,0),A.push(v+_,-d+(ae+1)*i+p,0),A.push(v-l+_,-d+(ae+1)*i+p,0),C.push(I,I+1,I+3,I+1,I+2,I+3),I+=4,e===O.FLIP_TILE||e===O.ROTATE_TILE||e===O.FLIP_N_ROTATE_TILE?E=E.concat(j[(ae+o)%2]):e===O.FLIP_ROW||e===O.ROTATE_ROW||e===O.FLIP_N_ROTATE_ROW?E=E.concat(j[ae%2]):E=E.concat(j[0]),R.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),b.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const D=n.sideOrientation===0?0:n.sideOrientation||Q.DEFAULTSIDE;Q._ComputeSides(D,A,C,b,E,n.frontUVs,n.backUVs);const w=new Q;w.indices=C,w.positions=A,w.normals=b,w.uvs=E;const z=D===Q.DOUBLESIDE?R.concat(R):R;return w.colors=z,w}function zI(n,e,t=null){const i=new O(n,t);return e.sideOrientation=O._GetDefaultSideOrientation(e.sideOrientation),i._originalBuilderSideOrientation=e.sideOrientation,To(e).applyToMesh(i,e.updatable),i}Q.CreateTiledPlane=To;function Qy(n){const t=n.faceUV||new Array(6),i=n.faceColors,s=n.pattern||O.NO_FLIP,r=n.width||n.size||1,a=n.height||n.size||1,o=n.depth||n.size||1,l=n.tileWidth||n.tileSize||1,h=n.tileHeight||n.tileSize||1,u=n.alignHorizontal||0,c=n.alignVertical||0,f=n.sideOrientation===0?0:n.sideOrientation||Q.DEFAULTSIDE;for(let M=0;M<6;M++)t[M]===void 0&&(t[M]=new Oe(0,0,1,1)),i&&i[M]===void 0&&(i[M]=new K(1,1,1,1));const d=r/2,_=a/2,p=o/2,g=[];for(let M=0;M<2;M++)g[M]=To({pattern:s,tileWidth:l,tileHeight:h,width:r,height:a,alignVertical:c,alignHorizontal:u,sideOrientation:f});for(let M=2;M<4;M++)g[M]=To({pattern:s,tileWidth:l,tileHeight:h,width:o,height:a,alignVertical:c,alignHorizontal:u,sideOrientation:f});let m=c;c===O.BOTTOM?m=O.TOP:c===O.TOP&&(m=O.BOTTOM);for(let M=4;M<6;M++)g[M]=To({pattern:s,tileWidth:l,tileHeight:h,width:r,height:o,alignVertical:m,alignHorizontal:u,sideOrientation:f});let v=[],T=[],A=[],b=[];const x=[],E=[],R=[],C=[];let I=0,D=0;for(let M=0;M<6;M++){const V=g[M].positions.length;E[M]=[],R[M]=[];for(let j=0;j<V/3;j++)E[M].push(new y(g[M].positions[3*j],g[M].positions[3*j+1],g[M].positions[3*j+2])),R[M].push(new y(g[M].normals[3*j],g[M].normals[3*j+1],g[M].normals[3*j+2]));I=g[M].uvs.length,C[M]=[];for(let j=0;j<I;j+=2)C[M][j]=t[M].x+(t[M].z-t[M].x)*g[M].uvs[j],C[M][j+1]=t[M].y+(t[M].w-t[M].y)*g[M].uvs[j+1];if(A=A.concat(C[M]),b=b.concat(g[M].indices.map(j=>j+D)),D+=E[M].length,i)for(let j=0;j<4;j++)x.push(i[M].r,i[M].g,i[M].b,i[M].a)}const w=new y(0,0,p),z=L.RotationY(Math.PI);v=E[0].map(M=>y.TransformNormal(M,z).add(w)).map(M=>[M.x,M.y,M.z]).reduce((M,V)=>M.concat(V),[]),T=R[0].map(M=>y.TransformNormal(M,z)).map(M=>[M.x,M.y,M.z]).reduce((M,V)=>M.concat(V),[]),v=v.concat(E[1].map(M=>M.subtract(w)).map(M=>[M.x,M.y,M.z]).reduce((M,V)=>M.concat(V),[])),T=T.concat(R[1].map(M=>[M.x,M.y,M.z]).reduce((M,V)=>M.concat(V),[]));const F=new y(d,0,0),W=L.RotationY(-Math.PI/2);v=v.concat(E[2].map(M=>y.TransformNormal(M,W).add(F)).map(M=>[M.x,M.y,M.z]).reduce((M,V)=>M.concat(V),[])),T=T.concat(R[2].map(M=>y.TransformNormal(M,W)).map(M=>[M.x,M.y,M.z]).reduce((M,V)=>M.concat(V),[]));const X=L.RotationY(Math.PI/2);v=v.concat(E[3].map(M=>y.TransformNormal(M,X).subtract(F)).map(M=>[M.x,M.y,M.z]).reduce((M,V)=>M.concat(V),[])),T=T.concat(R[3].map(M=>y.TransformNormal(M,X)).map(M=>[M.x,M.y,M.z]).reduce((M,V)=>M.concat(V),[]));const he=new y(0,_,0),H=L.RotationX(Math.PI/2);v=v.concat(E[4].map(M=>y.TransformNormal(M,H).add(he)).map(M=>[M.x,M.y,M.z]).reduce((M,V)=>M.concat(V),[])),T=T.concat(R[4].map(M=>y.TransformNormal(M,H)).map(M=>[M.x,M.y,M.z]).reduce((M,V)=>M.concat(V),[]));const G=L.RotationX(-Math.PI/2);v=v.concat(E[5].map(M=>y.TransformNormal(M,G).subtract(he)).map(M=>[M.x,M.y,M.z]).reduce((M,V)=>M.concat(V),[])),T=T.concat(R[5].map(M=>y.TransformNormal(M,G)).map(M=>[M.x,M.y,M.z]).reduce((M,V)=>M.concat(V),[])),Q._ComputeSides(f,v,b,T,A);const k=new Q;if(k.indices=b,k.positions=v,k.normals=T,k.uvs=A,i){const M=f===Q.DOUBLESIDE?x.concat(x):x;k.colors=M}return k}function WI(n,e,t=null){const i=new O(n,t);return e.sideOrientation=O._GetDefaultSideOrientation(e.sideOrientation),i._originalBuilderSideOrientation=e.sideOrientation,Qy(e).applyToMesh(i,e.updatable),i}Q.CreateTiledBox=Qy;function Jy(n){const e=(n.segments||32)|0,t=n.diameterX||n.diameter||1,i=n.diameterY||n.diameter||1,s=n.diameterZ||n.diameter||1,r=n.arc&&(n.arc<=0||n.arc>1)?1:n.arc||1,a=n.slice&&n.slice<=0?1:n.slice||1,o=n.sideOrientation===0?0:n.sideOrientation||Q.DEFAULTSIDE,l=!!n.dedupTopBottomIndices,h=new y(t/2,i/2,s/2),u=2+e,c=2*u,f=[],d=[],_=[],p=[];for(let m=0;m<=u;m++){const v=m/u,T=v*Math.PI*a;for(let A=0;A<=c;A++){const b=A/c,x=b*Math.PI*2*r,E=L.RotationZ(-T),R=L.RotationY(x),C=y.TransformCoordinates(y.Up(),E),I=y.TransformCoordinates(C,R),D=I.multiply(h),w=I.divide(h).normalize();d.push(D.x,D.y,D.z),_.push(w.x,w.y,w.z),p.push(b,v)}if(m>0){const A=d.length/3;for(let b=A-2*(c+1);b+c+2<A;b++)l?(m>1&&(f.push(b),f.push(b+1),f.push(b+c+1)),(m<u||a<1)&&(f.push(b+c+1),f.push(b+1),f.push(b+c+2))):(f.push(b),f.push(b+1),f.push(b+c+1),f.push(b+c+1),f.push(b+1),f.push(b+c+2))}}Q._ComputeSides(o,d,f,_,p,n.frontUVs,n.backUVs);const g=new Q;return g.indices=f,g.positions=d,g.normals=_,g.uvs=p,g}function ex(n,e={},t=null){const i=new O(n,t);return e.sideOrientation=O._GetDefaultSideOrientation(e.sideOrientation),i._originalBuilderSideOrientation=e.sideOrientation,Jy(e).applyToMesh(i,e.updatable),i}Q.CreateSphere=Jy;O.CreateSphere=(n,e,t,i,s,r)=>ex(n,{segments:e,diameterX:t,diameterY:t,diameterZ:t,sideOrientation:r,updatable:s},i);function tx(n){const e=n.height||2;let t=n.diameterTop===0?0:n.diameterTop||n.diameter||1,i=n.diameterBottom===0?0:n.diameterBottom||n.diameter||1;t=t||1e-5,i=i||1e-5;const s=(n.tessellation||24)|0,r=(n.subdivisions||1)|0,a=!!n.hasRings,o=!!n.enclose,l=n.cap===0?0:n.cap||O.CAP_ALL,h=n.arc&&(n.arc<=0||n.arc>1)?1:n.arc||1,u=n.sideOrientation===0?0:n.sideOrientation||Q.DEFAULTSIDE,c=n.faceUV||new Array(3),f=n.faceColors,d=h!==1&&o?2:0,_=a?r:1,p=2+(1+d)*_;let g;for(g=0;g<p;g++)f&&f[g]===void 0&&(f[g]=new K(1,1,1,1));for(g=0;g<p;g++)c&&c[g]===void 0&&(c[g]=new Oe(0,0,1,1));const m=[],v=[],T=[],A=[],b=[],x=Math.PI*2*h/s;let E,R,C;const I=(i-t)/2/e,D=y.Zero(),w=y.Zero(),z=y.Zero(),F=y.Zero(),W=y.Zero(),X=ni.Y;let he,H,G,k=1,M=1,V=0,j=0;for(he=0;he<=r;he++)for(R=he/r,C=(R*(t-i)+i)/2,k=a&&he!==0&&he!==r?2:1,G=0;G<k;G++){for(a&&(M+=G),o&&(M+=2*G),H=0;H<=s;H++)E=H*x,D.x=Math.cos(-E)*C,D.y=-e/2+R*e,D.z=Math.sin(-E)*C,t===0&&he===r?(w.x=T[T.length-(s+1)*3],w.y=T[T.length-(s+1)*3+1],w.z=T[T.length-(s+1)*3+2]):(w.x=D.x,w.z=D.z,w.y=Math.sqrt(w.x*w.x+w.z*w.z)*I,w.normalize()),H===0&&(z.copyFrom(D),F.copyFrom(w)),v.push(D.x,D.y,D.z),T.push(w.x,w.y,w.z),a?j=V!==M?c[M].y:c[M].w:j=c[M].y+(c[M].w-c[M].y)*R,A.push(c[M].x+(c[M].z-c[M].x)*H/s,j),f&&b.push(f[M].r,f[M].g,f[M].b,f[M].a);h!==1&&o&&(v.push(D.x,D.y,D.z),v.push(0,D.y,0),v.push(0,D.y,0),v.push(z.x,z.y,z.z),y.CrossToRef(X,w,W),W.normalize(),T.push(W.x,W.y,W.z,W.x,W.y,W.z),y.CrossToRef(F,X,W),W.normalize(),T.push(W.x,W.y,W.z,W.x,W.y,W.z),a?j=V!==M?c[M+1].y:c[M+1].w:j=c[M+1].y+(c[M+1].w-c[M+1].y)*R,A.push(c[M+1].x,j),A.push(c[M+1].z,j),a?j=V!==M?c[M+2].y:c[M+2].w:j=c[M+2].y+(c[M+2].w-c[M+2].y)*R,A.push(c[M+2].x,j),A.push(c[M+2].z,j),f&&(b.push(f[M+1].r,f[M+1].g,f[M+1].b,f[M+1].a),b.push(f[M+1].r,f[M+1].g,f[M+1].b,f[M+1].a),b.push(f[M+2].r,f[M+2].g,f[M+2].b,f[M+2].a),b.push(f[M+2].r,f[M+2].g,f[M+2].b,f[M+2].a))),V!==M&&(V=M)}const ae=h!==1&&o?s+4:s;for(he=0,M=0;M<r;M++){let le=0,xe=0,ue=0,Se=0;for(H=0;H<s;H++)le=he*(ae+1)+H,xe=(he+1)*(ae+1)+H,ue=he*(ae+1)+(H+1),Se=(he+1)*(ae+1)+(H+1),m.push(le,xe,ue),m.push(Se,ue,xe);h!==1&&o&&(m.push(le+2,xe+2,ue+2),m.push(Se+2,ue+2,xe+2),m.push(le+4,xe+4,ue+4),m.push(Se+4,ue+4,xe+4)),he=a?he+2:he+1}const ge=le=>{const xe=le?t/2:i/2;if(xe===0)return;let ue,Se,ze;const pe=le?c[p-1]:c[0];let Pe=null;f&&(Pe=le?f[p-1]:f[0]);const me=v.length/3,Ke=le?e/2:-e/2,et=new y(0,Ke,0);v.push(et.x,et.y,et.z),T.push(0,le?1:-1,0);const ft=pe.y+(pe.w-pe.y)*.5;A.push(pe.x+(pe.z-pe.x)*.5,ft),Pe&&b.push(Pe.r,Pe.g,Pe.b,Pe.a);const wt=new ne(.5,.5);for(ze=0;ze<=s;ze++){ue=Math.PI*2*ze*h/s;const mi=Math.cos(-ue),Zt=Math.sin(-ue);Se=new y(mi*xe,Ke,Zt*xe);const li=new ne(mi*wt.x+.5,Zt*wt.y+.5);v.push(Se.x,Se.y,Se.z),T.push(0,le?1:-1,0);const Qs=pe.y+(pe.w-pe.y)*li.y;A.push(pe.x+(pe.z-pe.x)*li.x,Qs),Pe&&b.push(Pe.r,Pe.g,Pe.b,Pe.a)}for(ze=0;ze<s;ze++)le?(m.push(me),m.push(me+(ze+2)),m.push(me+(ze+1))):(m.push(me),m.push(me+(ze+1)),m.push(me+(ze+2)))};(l===O.CAP_START||l===O.CAP_ALL)&&ge(!1),(l===O.CAP_END||l===O.CAP_ALL)&&ge(!0),Q._ComputeSides(u,v,m,T,A,n.frontUVs,n.backUVs);const $=new Q;return $.indices=m,$.positions=v,$.normals=T,$.uvs=A,f&&($.colors=b),$}function ix(n,e={},t){const i=new O(n,t);return e.sideOrientation=O._GetDefaultSideOrientation(e.sideOrientation),i._originalBuilderSideOrientation=e.sideOrientation,tx(e).applyToMesh(i,e.updatable),i}Q.CreateCylinder=tx;O.CreateCylinder=(n,e,t,i,s,r,a,o,l)=>((a===void 0||!(a instanceof Je))&&(a!==void 0&&(l=o||O.DEFAULTSIDE,o=a),a=r,r=1),ix(n,{height:e,diameterTop:t,diameterBottom:i,tessellation:s,subdivisions:r,sideOrientation:l,updatable:o},a));function sx(n){const e=[],t=[],i=[],s=[],r=n.diameter||1,a=n.thickness||.5,o=(n.tessellation||16)|0,l=n.sideOrientation===0?0:n.sideOrientation||Q.DEFAULTSIDE,h=o+1;for(let c=0;c<=o;c++){const f=c/o,d=c*Math.PI*2/o-Math.PI/2,_=L.Translation(r/2,0,0).multiply(L.RotationY(d));for(let p=0;p<=o;p++){const g=1-p/o,m=p*Math.PI*2/o+Math.PI,v=Math.cos(m),T=Math.sin(m);let A=new y(v,T,0),b=A.scale(a/2);const x=new ne(f,g);b=y.TransformCoordinates(b,_),A=y.TransformNormal(A,_),t.push(b.x,b.y,b.z),i.push(A.x,A.y,A.z),s.push(x.x,x.y);const E=(c+1)%h,R=(p+1)%h;e.push(c*h+p),e.push(c*h+R),e.push(E*h+p),e.push(c*h+R),e.push(E*h+R),e.push(E*h+p)}}Q._ComputeSides(l,t,e,i,s,n.frontUVs,n.backUVs);const u=new Q;return u.indices=e,u.positions=t,u.normals=i,u.uvs=s,u}function nx(n,e={},t){const i=new O(n,t);return e.sideOrientation=O._GetDefaultSideOrientation(e.sideOrientation),i._originalBuilderSideOrientation=e.sideOrientation,sx(e).applyToMesh(i,e.updatable),i}Q.CreateTorus=sx;O.CreateTorus=(n,e,t,i,s,r,a)=>nx(n,{diameter:e,thickness:t,tessellation:i,sideOrientation:a,updatable:r},s);function rx(n){const e=[],t=[],i=[],s=[],r=n.radius||2,a=n.tube||.5,o=n.radialSegments||32,l=n.tubularSegments||32,h=n.p||2,u=n.q||3,c=n.sideOrientation===0?0:n.sideOrientation||Q.DEFAULTSIDE,f=g=>{const m=Math.cos(g),v=Math.sin(g),T=u/h*g,A=Math.cos(T),b=r*(2+A)*.5*m,x=r*(2+A)*v*.5,E=r*Math.sin(T)*.5;return new y(b,x,E)};let d,_;for(d=0;d<=o;d++){const m=d%o/o*2*h*Math.PI,v=f(m),T=f(m+.01),A=T.subtract(v);let b=T.add(v);const x=y.Cross(A,b);for(b=y.Cross(x,A),x.normalize(),b.normalize(),_=0;_<l;_++){const R=_%l/l*2*Math.PI,C=-a*Math.cos(R),I=a*Math.sin(R);t.push(v.x+C*b.x+I*x.x),t.push(v.y+C*b.y+I*x.y),t.push(v.z+C*b.z+I*x.z),s.push(d/o),s.push(_/l)}}for(d=0;d<o;d++)for(_=0;_<l;_++){const g=(_+1)%l,m=d*l+_,v=(d+1)*l+_,T=(d+1)*l+g,A=d*l+g;e.push(A),e.push(v),e.push(m),e.push(A),e.push(T),e.push(v)}Q.ComputeNormals(t,e,i),Q._ComputeSides(c,t,e,i,s,n.frontUVs,n.backUVs);const p=new Q;return p.indices=e,p.positions=t,p.normals=i,p.uvs=s,p}function ax(n,e={},t){const i=new O(n,t);return e.sideOrientation=O._GetDefaultSideOrientation(e.sideOrientation),i._originalBuilderSideOrientation=e.sideOrientation,rx(e).applyToMesh(i,e.updatable),i}Q.CreateTorusKnot=rx;O.CreateTorusKnot=(n,e,t,i,s,r,a,o,l,h)=>ax(n,{radius:e,tube:t,radialSegments:i,tubularSegments:s,p:r,q:a,sideOrientation:h,updatable:l},o);function ox(n){const e=[],t=[],i=n.lines,s=n.colors,r=[];let a=0;for(let l=0;l<i.length;l++){const h=i[l];for(let u=0;u<h.length;u++){const{x:c,y:f,z:d}=h[u];if(t.push(c,f,d),s){const _=s[l],{r:p,g,b:m,a:v}=_[u];r.push(p,g,m,v)}u>0&&(e.push(a-1),e.push(a)),a++}}const o=new Q;return o.indices=e,o.positions=t,s&&(o.colors=r),o}function lx(n){const e=n.dashSize||3,t=n.gapSize||1,i=n.dashNb||200,s=n.points,r=[],a=[],o=y.Zero();let l=0,h=0,u=0,c=0,f=0,d=0,_=0;for(_=0;_<s.length-1;_++)s[_+1].subtractToRef(s[_],o),l+=o.length();for(u=l/i,c=e*u/(e+t),_=0;_<s.length-1;_++){s[_+1].subtractToRef(s[_],o),h=Math.floor(o.length()/u),o.normalize();for(let g=0;g<h;g++)f=u*g,r.push(s[_].x+f*o.x,s[_].y+f*o.y,s[_].z+f*o.z),r.push(s[_].x+(f+c)*o.x,s[_].y+(f+c)*o.y,s[_].z+(f+c)*o.z),a.push(d,d+1),d+=2}const p=new Q;return p.positions=r,p.indices=a,p}function hx(n,e,t=null){const i=e.instance,s=e.lines,r=e.colors;if(i){const h=i.getVerticesData(S.PositionKind);let u,c;r&&(u=i.getVerticesData(S.ColorKind));let f=0,d=0;for(let _=0;_<s.length;_++){const p=s[_];for(let g=0;g<p.length;g++)h[f]=p[g].x,h[f+1]=p[g].y,h[f+2]=p[g].z,r&&u&&(c=r[_],u[d]=c[g].r,u[d+1]=c[g].g,u[d+2]=c[g].b,u[d+3]=c[g].a,d+=4),f+=3}return i.updateVerticesData(S.PositionKind,h,!1,!1),r&&u&&i.updateVerticesData(S.ColorKind,u,!1,!1),i.refreshBoundingInfo(),i}const a=!!r,o=new Ks(n,t,null,void 0,void 0,a,e.useVertexAlpha,e.material);return ox(e).applyToMesh(o,e.updatable),o}function ux(n,e,t=null){const i=e.colors?[e.colors]:null;return hx(n,{lines:[e.points],updatable:e.updatable,instance:e.instance,colors:i,useVertexAlpha:e.useVertexAlpha,material:e.material},t)}function cx(n,e,t=null){const i=e.points,s=e.instance,r=e.gapSize||1,a=e.dashSize||3;if(s){const h=u=>{const c=y.Zero(),f=u.length/6;let d=0,_=0,p=0,g=0,m=0,v=0,T=0,A=0;for(T=0;T<i.length-1;T++)i[T+1].subtractToRef(i[T],c),d+=c.length();p=d/f;const b=s._creationDataStorage.dashSize,x=s._creationDataStorage.gapSize;for(g=b*p/(b+x),T=0;T<i.length-1;T++)for(i[T+1].subtractToRef(i[T],c),_=Math.floor(c.length()/p),c.normalize(),A=0;A<_&&v<u.length;)m=p*A,u[v]=i[T].x+m*c.x,u[v+1]=i[T].y+m*c.y,u[v+2]=i[T].z+m*c.z,u[v+3]=i[T].x+(m+g)*c.x,u[v+4]=i[T].y+(m+g)*c.y,u[v+5]=i[T].z+(m+g)*c.z,v+=6,A++;for(;v<u.length;)u[v]=i[T].x,u[v+1]=i[T].y,u[v+2]=i[T].z,v+=3};return(e.dashNb||e.dashSize||e.gapSize||e.useVertexAlpha||e.material)&&U.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),s.updateMeshPositions(h,!1),s}const o=new Ks(n,t,null,void 0,void 0,void 0,e.useVertexAlpha,e.material);return lx(e).applyToMesh(o,e.updatable),o._creationDataStorage=new ey,o._creationDataStorage.dashSize=a,o._creationDataStorage.gapSize=r,o}Q.CreateLineSystem=ox;Q.CreateDashedLines=lx;O.CreateLines=(n,e,t=null,i=!1,s=null)=>ux(n,{points:e,updatable:i,instance:s},t);O.CreateDashedLines=(n,e,t,i,s,r=null,a,o)=>cx(n,{points:e,dashSize:t,gapSize:i,dashNb:s,updatable:a,instance:o},r);class HI extends ne{constructor(e,t){super(e.x,e.y),this.index=t}}class Pu{constructor(){this.elements=[]}add(e){const t=[];return e.forEach(i=>{const s=new HI(i,this.elements.length);t.push(s),this.elements.push(s)}),t}computeBounds(){const e=new ne(this.elements[0].x,this.elements[0].y),t=new ne(this.elements[0].x,this.elements[0].y);return this.elements.forEach(i=>{i.x<e.x?e.x=i.x:i.x>t.x&&(t.x=i.x),i.y<e.y?e.y=i.y:i.y>t.y&&(t.y=i.y)}),{min:e,max:t,width:t.x-e.x,height:t.y-e.y}}}class KI{_addToepoint(e){for(const t of e)this._epoints.push(t.x,t.y)}constructor(e,t,i,s=earcut){this._points=new Pu,this._outlinepoints=new Pu,this._holes=new Array,this._epoints=new Array,this._eholes=new Array,this.bjsEarcut=s,this._name=e,this._scene=i||Ae.LastCreatedScene;let r;t instanceof mh?r=t.getPoints():r=t,this._addToepoint(r),this._points.add(r),this._outlinepoints.add(r),typeof this.bjsEarcut>"u"&&U.Warn("Earcut was not found, the polygon will not be built.")}addHole(e){this._points.add(e);const t=new Pu;return t.add(e),this._holes.push(t),this._eholes.push(this._epoints.length/2),this._addToepoint(e),this}build(e=!1,t=0,i=2){const s=new O(this._name,this._scene),r=this.buildVertexData(t,i);return s.setVerticesData(S.PositionKind,r.positions,e),s.setVerticesData(S.NormalKind,r.normals,e),s.setVerticesData(S.UVKind,r.uvs,e),s.setIndices(r.indices),s}buildVertexData(e=0,t=2){const i=new Q,s=[],r=[],a=[],o=this._points.computeBounds();this._points.elements.forEach(u=>{s.push(0,1,0),r.push(u.x,0,u.y),a.push((u.x-o.min.x)/o.width,(u.y-o.min.y)/o.height)});const l=[],h=this.bjsEarcut(this._epoints,this._eholes,2);for(let u=0;u<h.length;u++)l.push(h[u]);if(e>0){const u=r.length/3;this._points.elements.forEach(f=>{s.push(0,-1,0),r.push(f.x,-e,f.y),a.push(1-(f.x-o.min.x)/o.width,1-(f.y-o.min.y)/o.height)});const c=l.length;for(let f=0;f<c;f+=3){const d=l[f+0],_=l[f+1],p=l[f+2];l.push(p+u),l.push(_+u),l.push(d+u)}this._addSide(r,s,a,l,o,this._outlinepoints,e,!1,t),this._holes.forEach(f=>{this._addSide(r,s,a,l,o,f,e,!0,t)})}return i.indices=l,i.positions=r,i.normals=s,i.uvs=a,i}_addSide(e,t,i,s,r,a,o,l,h){let u=e.length/3,c=0;for(let f=0;f<a.elements.length;f++){const d=a.elements[f],_=a.elements[(f+1)%a.elements.length];e.push(d.x,0,d.y),e.push(d.x,-o,d.y),e.push(_.x,0,_.y),e.push(_.x,-o,_.y);const p=a.elements[(f+a.elements.length-1)%a.elements.length],g=a.elements[(f+2)%a.elements.length];let m=new y(-(_.y-d.y),0,_.x-d.x),v=new y(-(d.y-p.y),0,d.x-p.x),T=new y(-(g.y-_.y),0,g.x-_.x);l||(m=m.scale(-1),v=v.scale(-1),T=T.scale(-1));const A=m.normalizeToNew();let b=v.normalizeToNew(),x=T.normalizeToNew();const E=y.Dot(b,A);E>h?E<Ue-1?b=new y(d.x,0,d.y).subtract(new y(_.x,0,_.y)).normalize():b=v.add(m).normalize():b=A;const R=y.Dot(T,m);R>h?R<Ue-1?x=new y(_.x,0,_.y).subtract(new y(d.x,0,d.y)).normalize():x=T.add(m).normalize():x=A,i.push(c/r.width,0),i.push(c/r.width,1),c+=m.length(),i.push(c/r.width,0),i.push(c/r.width,1),t.push(b.x,b.y,b.z),t.push(b.x,b.y,b.z),t.push(x.x,x.y,x.z),t.push(x.x,x.y,x.z),l?(s.push(u),s.push(u+2),s.push(u+1),s.push(u+1),s.push(u+2),s.push(u+3)):(s.push(u),s.push(u+1),s.push(u+2),s.push(u+1),s.push(u+3),s.push(u+2)),u+=4}}}function fx(n,e,t,i,s,r,a){const o=t||new Array(3),l=i,h=[],u=a||!1;for(let C=0;C<3;C++)o[C]===void 0&&(o[C]=new Oe(0,0,1,1)),l&&l[C]===void 0&&(l[C]=new K(1,1,1,1));const c=n.getVerticesData(S.PositionKind),f=n.getVerticesData(S.NormalKind),d=n.getVerticesData(S.UVKind),_=n.getIndices(),p=c.length/9;let g=0,m=0,v=0,T=0,A=0;const b=[0];if(u)for(let C=p;C<c.length/3;C+=4)m=c[3*(C+2)]-c[3*C],v=c[3*(C+2)+2]-c[3*C+2],T=Math.sqrt(m*m+v*v),A+=T,b.push(A);let x=0,E=0;for(let C=0;C<f.length;C+=3)Math.abs(f[C+1])<.001&&(E=1),Math.abs(f[C+1]-1)<.001&&(E=0),Math.abs(f[C+1]+1)<.001&&(E=2),x=C/3,E===1?(g=x-p,g%4<1.5?u?d[2*x]=o[E].x+(o[E].z-o[E].x)*b[Math.floor(g/4)]/A:d[2*x]=o[E].x:u?d[2*x]=o[E].x+(o[E].z-o[E].x)*b[Math.floor(g/4)+1]/A:d[2*x]=o[E].z,g%2===0?d[2*x+1]=o[E].w:d[2*x+1]=o[E].y):(d[2*x]=(1-d[2*x])*o[E].x+d[2*x]*o[E].z,d[2*x+1]=(1-d[2*x+1])*o[E].y+d[2*x+1]*o[E].w),l&&h.push(l[E].r,l[E].g,l[E].b,l[E].a);Q._ComputeSides(e,c,_,f,d,s,r);const R=new Q;if(R.indices=_,R.positions=c,R.normals=f,R.uvs=d,l){const C=e===Q.DOUBLESIDE?h.concat(h):h;R.colors=C}return R}function Yd(n,e,t=null,i=earcut){e.sideOrientation=O._GetDefaultSideOrientation(e.sideOrientation);const s=e.shape,r=e.holes||[],a=e.depth||0,o=e.smoothingThreshold||2,l=[];let h=[];for(let _=0;_<s.length;_++)l[_]=new ne(s[_].x,s[_].z);l[0].equalsWithEpsilon(l[l.length-1],1e-8)&&l.pop();const c=new KI(n,l,t||Ae.LastCreatedScene,i);for(let _=0;_<r.length;_++){h=[];for(let p=0;p<r[_].length;p++)h.push(new ne(r[_][p].x,r[_][p].z));c.addHole(h)}const f=c.build(!1,a,o);return f._originalBuilderSideOrientation=e.sideOrientation,fx(f,e.sideOrientation,e.faceUV,e.faceColors,e.frontUVs,e.backUVs,e.wrap).applyToMesh(f,e.updatable),f}function jd(n,e,t=null,i=earcut){return Yd(n,e,t,i)}Q.CreatePolygon=fx;O.CreatePolygon=(n,e,t,i,s,r,a=earcut)=>Yd(n,{shape:e,holes:i,updatable:s,sideOrientation:r},t,a);O.ExtrudePolygon=(n,e,t,i,s,r,a,o=earcut)=>jd(n,{shape:e,holes:s,depth:t,updatable:r,sideOrientation:a},i,o);function dx(n,e,t=null){const i=e.path,s=e.shape,r=e.scale||1,a=e.rotation||0,o=e.cap===0?0:e.cap||O.NO_CAP,l=e.updatable,h=O._GetDefaultSideOrientation(e.sideOrientation),u=e.instance||null,c=e.invertUV||!1,f=e.closeShape||!1,d=e.closePath||!1,_=e.capFunction||null;return px(n,s,i,r,a,null,null,d,f,o,!1,t,!!l,h,u,c,e.frontUVs||null,e.backUVs||null,e.firstNormal||null,!!e.adjustFrame,_)}function _x(n,e,t=null){const i=e.path,s=e.shape,r=e.scaleFunction||(()=>1),a=e.rotationFunction||(()=>0),o=e.closePath||e.ribbonCloseArray||!1,l=e.closeShape||e.ribbonClosePath||!1,h=e.cap===0?0:e.cap||O.NO_CAP,u=e.updatable,c=e.firstNormal||null,f=e.adjustFrame||!1,d=O._GetDefaultSideOrientation(e.sideOrientation),_=e.instance,p=e.invertUV||!1,g=e.capFunction||null;return px(n,s,i,null,null,r,a,o,l,h,!0,t,!!u,d,_||null,p,e.frontUVs||null,e.backUVs||null,c,f,g||null)}function px(n,e,t,i,s,r,a,o,l,h,u,c,f,d,_,p,g,m,v,T,A){const b=(I,D,w,z,F,W,X,he,H,G,k)=>{const M=w.getTangents(),V=w.getNormals(),j=w.getBinormals(),ae=w.getDistances();if(k){for(let me=0;me<M.length;me++)if(M[me].x==0&&M[me].y==0&&M[me].z==0&&M[me].copyFrom(M[me-1]),V[me].x==0&&V[me].y==0&&V[me].z==0&&V[me].copyFrom(V[me-1]),j[me].x==0&&j[me].y==0&&j[me].z==0&&j[me].copyFrom(j[me-1]),me>0){let Ke=M[me-1];y.Dot(Ke,M[me])<0&&M[me].scaleInPlace(-1),Ke=V[me-1],y.Dot(Ke,V[me])<0&&V[me].scaleInPlace(-1),Ke=j[me-1],y.Dot(Ke,j[me])<0&&j[me].scaleInPlace(-1)}}let ge=0;const $=()=>F!==null?F:1,xe=G&&he?he:()=>W!==null?W:0,ue=G&&X?X:$;let Se=H===O.NO_CAP||H===O.CAP_END?0:2;const ze=N.Matrix[0];for(let me=0;me<D.length;me++){const Ke=[],et=xe(me,ae[me]),ft=ue(me,ae[me]);L.RotationAxisToRef(M[me],ge,ze);for(let wt=0;wt<I.length;wt++){const mi=M[me].scale(I[wt].z).add(V[me].scale(I[wt].x)).add(j[me].scale(I[wt].y)),Zt=y.Zero();y.TransformCoordinatesToRef(mi,ze,Zt),Zt.scaleInPlace(ft).addInPlace(D[me]),Ke[wt]=Zt}z[Se]=Ke,ge+=et,Se++}const Pe=A||(me=>{const Ke=Array(),et=y.Zero();let ft;for(ft=0;ft<me.length;ft++)et.addInPlace(me[ft]);for(et.scaleInPlace(1/me.length),ft=0;ft<me.length;ft++)Ke.push(et);return Ke});switch(H){case O.NO_CAP:break;case O.CAP_START:z[0]=Pe(z[2]),z[1]=z[2];break;case O.CAP_END:z[Se]=z[Se-1],z[Se+1]=Pe(z[Se-1]);break;case O.CAP_ALL:z[0]=Pe(z[2]),z[1]=z[2],z[Se]=z[Se-1],z[Se+1]=Pe(z[Se-1]);break}return z};let x,E;if(_){const I=_._creationDataStorage;return x=v?I.path3D.update(t,v):I.path3D.update(t),E=b(e,t,I.path3D,I.pathArray,i,s,r,a,I.cap,u,T),_=Lr("",{pathArray:E,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:_},c||void 0),_}x=v?new Ho(t,v):new Ho(t);const R=new Array;h=h<0||h>3?0:h,E=b(e,t,x,R,i,s,r,a,h,u,T);const C=Lr(n,{pathArray:E,closeArray:o,closePath:l,updatable:f,sideOrientation:d,invertUV:p,frontUVs:g||void 0,backUVs:m||void 0},c);return C._creationDataStorage.pathArray=E,C._creationDataStorage.path3D=x,C._creationDataStorage.cap=h,C}O.ExtrudeShape=(n,e,t,i,s,r,a=null,o,l,h)=>{const u={shape:e,path:t,scale:i,rotation:s,cap:r===0?0:r||O.NO_CAP,sideOrientation:l,instance:h,updatable:o};return dx(n,u,a)};O.ExtrudeShapeCustom=(n,e,t,i,s,r,a,o,l,h,u,c)=>{const f={shape:e,path:t,scaleFunction:i,rotationFunction:s,ribbonCloseArray:r,ribbonClosePath:a,cap:o===0?0:o||O.NO_CAP,sideOrientation:u,instance:c,updatable:h};return _x(n,f,l)};function gx(n,e,t=null){const i=e.arc?e.arc<=0||e.arc>1?1:e.arc:1,s=e.closed===void 0?!0:e.closed,r=e.shape,a=e.radius||1,o=e.tessellation||64,l=e.clip||0,h=e.updatable,u=O._GetDefaultSideOrientation(e.sideOrientation),c=e.cap||O.NO_CAP,f=Math.PI*2,d=[],_=e.invertUV||!1;let p=0,g=0;const m=f/o*i;let v,T;for(p=0;p<=o-l;p++){for(T=[],(c==O.CAP_START||c==O.CAP_ALL)&&(T.push(new y(0,r[0].y,0)),T.push(new y(Math.cos(p*m)*r[0].x*a,r[0].y,Math.sin(p*m)*r[0].x*a))),g=0;g<r.length;g++)v=new y(Math.cos(p*m)*r[g].x*a,r[g].y,Math.sin(p*m)*r[g].x*a),T.push(v);(c==O.CAP_END||c==O.CAP_ALL)&&(T.push(new y(Math.cos(p*m)*r[r.length-1].x*a,r[r.length-1].y,Math.sin(p*m)*r[r.length-1].x*a)),T.push(new y(0,r[r.length-1].y,0))),d.push(T)}return Lr(n,{pathArray:d,closeArray:s,sideOrientation:u,updatable:h,invertUV:_,frontUVs:e.frontUVs,backUVs:e.backUVs},t)}O.CreateLathe=(n,e,t,i,s,r,a)=>gx(n,{shape:e,radius:t,tessellation:i,sideOrientation:a,updatable:r},s);function mx(n){const e=[],t=[],i=[],s=[],r=n.width!==void 0?n.width:n.size!==void 0?n.size:1,a=n.height!==void 0?n.height:n.size!==void 0?n.size:1,o=n.sideOrientation===0?0:n.sideOrientation||Q.DEFAULTSIDE,l=r/2,h=a/2;t.push(-l,-h,0),i.push(0,0,-1),s.push(0,0),t.push(l,-h,0),i.push(0,0,-1),s.push(1,0),t.push(l,h,0),i.push(0,0,-1),s.push(1,1),t.push(-l,h,0),i.push(0,0,-1),s.push(0,1),e.push(0),e.push(1),e.push(2),e.push(0),e.push(2),e.push(3),Q._ComputeSides(o,t,e,i,s,n.frontUVs,n.backUVs);const u=new Q;return u.indices=e,u.positions=t,u.normals=i,u.uvs=s,u}function vx(n,e={},t=null){const i=new O(n,t);return e.sideOrientation=O._GetDefaultSideOrientation(e.sideOrientation),i._originalBuilderSideOrientation=e.sideOrientation,mx(e).applyToMesh(i,e.updatable),e.sourcePlane&&(i.translate(e.sourcePlane.normal,-e.sourcePlane.d),i.setDirection(e.sourcePlane.normal.scale(-1))),i}Q.CreatePlane=mx;O.CreatePlane=(n,e,t,i,s)=>vx(n,{size:e,width:e,height:e,sideOrientation:s,updatable:i},t);function yx(n,e,t=null){const i=e.path;let s=e.instance,r=1;e.radius!==void 0?r=e.radius:s&&(r=s._creationDataStorage.radius);const a=e.tessellation||64,o=e.radiusFunction||null;let l=e.cap||O.NO_CAP;const h=e.invertUV||!1,u=e.updatable,c=O._GetDefaultSideOrientation(e.sideOrientation);e.arc=e.arc&&(e.arc<=0||e.arc>1)?1:e.arc||1;const f=(m,v,T,A,b,x,E,R)=>{const C=v.getTangents(),I=v.getNormals(),D=v.getDistances(),z=Math.PI*2/b*R,W=x||(()=>A);let X,he,H,G;const k=N.Matrix[0];let M=E===O.NO_CAP||E===O.CAP_END?0:2;for(let j=0;j<m.length;j++){he=W(j,D[j]),X=Array(),H=I[j];for(let ae=0;ae<b;ae++)L.RotationAxisToRef(C[j],z*ae,k),G=X[ae]?X[ae]:y.Zero(),y.TransformCoordinatesToRef(H,k,G),G.scaleInPlace(he).addInPlace(m[j]),X[ae]=G;T[M]=X,M++}const V=(j,ae)=>{const ge=Array();for(let $=0;$<j;$++)ge.push(m[ae]);return ge};switch(E){case O.NO_CAP:break;case O.CAP_START:T[0]=V(b,0),T[1]=T[2].slice(0);break;case O.CAP_END:T[M]=T[M-1].slice(0),T[M+1]=V(b,m.length-1);break;case O.CAP_ALL:T[0]=V(b,0),T[1]=T[2].slice(0),T[M]=T[M-1].slice(0),T[M+1]=V(b,m.length-1);break}return T};let d,_;if(s){const m=s._creationDataStorage,v=e.arc||m.arc;return d=m.path3D.update(i),_=f(i,d,m.pathArray,r,m.tessellation,o,m.cap,v),s=Lr("",{pathArray:_,instance:s}),m.path3D=d,m.pathArray=_,m.arc=v,m.radius=r,s}d=new Ho(i);const p=new Array;l=l<0||l>3?0:l,_=f(i,d,p,r,a,o,l,e.arc);const g=Lr(n,{pathArray:_,closePath:!0,closeArray:!1,updatable:u,sideOrientation:c,invertUV:h,frontUVs:e.frontUVs,backUVs:e.backUVs},t);return g._creationDataStorage.pathArray=_,g._creationDataStorage.path3D=d,g._creationDataStorage.tessellation=a,g._creationDataStorage.cap=l,g._creationDataStorage.arc=e.arc,g._creationDataStorage.radius=r,g}O.CreateTube=(n,e,t,i,s,r,a,o,l,h)=>yx(n,{path:e,radius:t,tessellation:i,radiusFunction:s,arc:1,cap:r,updatable:o,sideOrientation:l,instance:h},a);function xx(n){const e=[];e[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},e[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},e[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},e[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},e[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},e[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},e[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},e[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},e[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},e[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},e[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},e[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},e[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},e[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},e[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const t=n.type&&(n.type<0||n.type>=e.length)?0:n.type||0,i=n.size,s=n.sizeX||i||1,r=n.sizeY||i||1,a=n.sizeZ||i||1,o=n.custom||e[t],l=o.face.length,h=n.faceUV||new Array(l),u=n.faceColors,c=n.flat===void 0?!0:n.flat,f=n.sideOrientation===0?0:n.sideOrientation||Q.DEFAULTSIDE,d=[],_=[],p=[],g=[],m=[];let v=0,T=0;const A=[];let b=0,x=0,E,R,C,I,D,w;if(c)for(x=0;x<l;x++)u&&u[x]===void 0&&(u[x]=new K(1,1,1,1)),h&&h[x]===void 0&&(h[x]=new Oe(0,0,1,1));if(c)for(x=0;x<l;x++){const F=o.face[x].length;for(C=2*Math.PI/F,I=.5*Math.tan(C/2),D=.5,b=0;b<F;b++)d.push(o.vertex[o.face[x][b]][0]*s,o.vertex[o.face[x][b]][1]*r,o.vertex[o.face[x][b]][2]*a),A.push(v),v++,E=h[x].x+(h[x].z-h[x].x)*(.5+I),R=h[x].y+(h[x].w-h[x].y)*(D-.5),g.push(E,R),w=I*Math.cos(C)-D*Math.sin(C),D=I*Math.sin(C)+D*Math.cos(C),I=w,u&&m.push(u[x].r,u[x].g,u[x].b,u[x].a);for(b=0;b<F-2;b++)_.push(A[0+T],A[b+2+T],A[b+1+T]);T+=F}else{for(b=0;b<o.vertex.length;b++)d.push(o.vertex[b][0]*s,o.vertex[b][1]*r,o.vertex[b][2]*a),g.push(0,0);for(x=0;x<l;x++)for(b=0;b<o.face[x].length-2;b++)_.push(o.face[x][0],o.face[x][b+2],o.face[x][b+1])}Q.ComputeNormals(d,_,p),Q._ComputeSides(f,d,_,p,g,n.frontUVs,n.backUVs);const z=new Q;return z.positions=d,z.indices=_,z.normals=p,z.uvs=g,u&&c&&(z.colors=m),z}function qd(n,e={},t=null){const i=new O(n,t);return e.sideOrientation=O._GetDefaultSideOrientation(e.sideOrientation),i._originalBuilderSideOrientation=e.sideOrientation,xx(e).applyToMesh(i,e.updatable),i}Q.CreatePolyhedron=xx;O.CreatePolyhedron=(n,e,t)=>qd(n,e,t);function bx(n){const e=n.sideOrientation||Q.DEFAULTSIDE,t=n.radius||1,i=n.flat===void 0?!0:n.flat,s=(n.subdivisions||4)|0,r=n.radiusX||t,a=n.radiusY||t,o=n.radiusZ||t,l=(1+Math.sqrt(5))/2,h=[-1,l,-0,1,l,0,-1,-l,0,1,-l,0,0,-1,-l,0,1,-l,0,-1,l,0,1,l,l,0,1,l,0,-1,-l,0,1,-l,0,-1],u=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],c=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],f=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],d=138/1024,_=239/1024,p=60/1024,g=26/1024,m=-40/1024,v=20/1024,T=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],A=[],b=[],x=[],E=[];let R=0;const C=new Array(3),I=new Array(3);let D;for(D=0;D<3;D++)C[D]=y.Zero(),I[D]=ne.Zero();for(let z=0;z<20;z++){for(D=0;D<3;D++){const W=u[3*z+D];C[D].copyFromFloats(h[3*c[W]],h[3*c[W]+1],h[3*c[W]+2]),C[D].normalize(),I[D].copyFromFloats(f[2*W]*d+p+T[z]*m,f[2*W+1]*_+g+T[z]*v)}const F=(W,X,he,H)=>{const G=y.Lerp(C[0],C[2],X/s),k=y.Lerp(C[1],C[2],X/s),M=s===X?C[2]:y.Lerp(G,k,W/(s-X));M.normalize();let V;if(i){const $=y.Lerp(C[0],C[2],H/s),le=y.Lerp(C[1],C[2],H/s);V=y.Lerp($,le,he/(s-H))}else V=new y(M.x,M.y,M.z);V.x/=r,V.y/=a,V.z/=o,V.normalize();const j=ne.Lerp(I[0],I[2],X/s),ae=ne.Lerp(I[1],I[2],X/s),ge=s===X?I[2]:ne.Lerp(j,ae,W/(s-X));b.push(M.x*r,M.y*a,M.z*o),x.push(V.x,V.y,V.z),E.push(ge.x,ge.y),A.push(R),R++};for(let W=0;W<s;W++)for(let X=0;X+W<s;X++)F(X,W,X+1/3,W+1/3),F(X+1,W,X+1/3,W+1/3),F(X,W+1,X+1/3,W+1/3),X+W+1<s&&(F(X+1,W,X+2/3,W+2/3),F(X+1,W+1,X+2/3,W+2/3),F(X,W+1,X+2/3,W+2/3))}Q._ComputeSides(e,b,A,x,E,n.frontUVs,n.backUVs);const w=new Q;return w.indices=A,w.positions=b,w.normals=x,w.uvs=E,w}function Tx(n,e={},t=null){const i=new O(n,t);return e.sideOrientation=O._GetDefaultSideOrientation(e.sideOrientation),i._originalBuilderSideOrientation=e.sideOrientation,bx(e).applyToMesh(i,e.updatable),i}Q.CreateIcoSphere=bx;O.CreateIcoSphere=(n,e,t)=>Tx(n,e,t);const XI=new y(1,0,0),YI=new y(-1,0,0),jI=new y(0,1,0),qI=new y(0,-1,0),$I=new y(0,0,1),ZI=new y(0,0,-1);class $l{constructor(e=y.Zero(),t=y.Up(),i=ne.Zero(),s=0,r=0,a=null,o=null,l=null,h=null){this.position=e,this.normal=t,this.uv=i,this.vertexIdx=s,this.vertexIdxForBones=r,this.localPositionOverride=a,this.localNormalOverride=o,this.matrixIndicesOverride=l,this.matrixWeightsOverride=h}clone(){var e,t,i,s;return new $l(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,(e=this.localPositionOverride)==null?void 0:e.slice(),(t=this.localNormalOverride)==null?void 0:t.slice(),(i=this.matrixIndicesOverride)==null?void 0:i.slice(),(s=this.matrixWeightsOverride)==null?void 0:s.slice())}}function Ax(n,e,t){var X,he,H,G;const i=!!e.skeleton,s=t.localMode||i,r=e.getIndices(),a=i?e.getPositionData(!0,!0):e.getVerticesData(S.PositionKind),o=i?e.getNormalsData(!0,!0):e.getVerticesData(S.NormalKind),l=s?i?e.getVerticesData(S.PositionKind):a:null,h=s?i?e.getVerticesData(S.NormalKind):o:null,u=e.getVerticesData(S.UVKind),c=i?e.getVerticesData(S.MatricesIndicesKind):null,f=i?e.getVerticesData(S.MatricesWeightsKind):null,d=i?e.getVerticesData(S.MatricesIndicesExtraKind):null,_=i?e.getVerticesData(S.MatricesWeightsExtraKind):null,p=t.position||y.Zero();let g=t.normal||y.Up();const m=t.size||y.One(),v=t.angle||0;if(!g){const k=new y(0,0,1),M=e.getScene().activeCamera,V=y.TransformCoordinates(k,M.getWorldMatrix());g=M.globalPosition.subtract(V)}const T=-Math.atan2(g.z,g.x)-Math.PI/2,A=Math.sqrt(g.x*g.x+g.z*g.z),b=Math.atan2(g.y,A),x=new Q;x.indices=[],x.positions=[],x.normals=[],x.uvs=[],x.matricesIndices=i?[]:null,x.matricesWeights=i?[]:null,x.matricesIndicesExtra=d?[]:null,x.matricesWeightsExtra=_?[]:null;let E=0;const R=(k,M)=>{const V=new $l;if(!r||!a||!o)return V;const j=r[k];if(V.vertexIdx=j*3,V.vertexIdxForBones=j*4,V.position=new y(a[j*3],a[j*3+1],a[j*3+2]),y.TransformCoordinatesToRef(V.position,M,V.position),V.normal=new y(o[j*3],o[j*3+1],o[j*3+2]),y.TransformNormalToRef(V.normal,M,V.normal),t.captureUVS&&u){const ae=u[j*2+1];V.uv=new ne(u[j*2],ae)}return V},C=[0,0,0,0],I=(k,M)=>{if(k.length===0)return k;const V=.5*Math.abs(y.Dot(m,M)),j=($,le,xe,ue)=>{for(let Se=0;Se<ue;++Se)if($[xe+Se]===le)return xe+Se;return-1},ae=($,le)=>{const xe=y.GetClipFactor($.position,le.position,M,V);let ue=C,Se=C;if(c&&f){const Kt=$.matrixIndicesOverride?0:$.vertexIdxForBones,ui=$.matrixIndicesOverride??c,Js=$.matrixWeightsOverride??f,za=le.matrixIndicesOverride?0:le.vertexIdxForBones,Zd=le.matrixIndicesOverride??c,Qd=le.matrixWeightsOverride??f;ue=[0,0,0,0],Se=[0,0,0,0];let rr=0;for(let ds=0;ds<4;++ds)if(Js[Kt+ds]>0){const Wa=j(Zd,ui[Kt+ds],za,4);ue[rr]=ui[Kt+ds],Se[rr]=Bl(Js[Kt+ds],Wa>=0?Qd[Wa]:0,xe),rr++}for(let ds=0;ds<4&&rr<4;++ds){const Wa=Zd[za+ds];j(ui,Wa,Kt,4)===-1&&(ue[rr]=Wa,Se[rr]=Bl(0,Qd[za+ds],xe),rr++)}const g0=Se[0]+Se[1]+Se[2]+Se[3];Se[0]/=g0,Se[1]/=g0,Se[2]/=g0,Se[3]/=g0}const ze=$.localPositionOverride?$.localPositionOverride[0]:(l==null?void 0:l[$.vertexIdx])??0,pe=$.localPositionOverride?$.localPositionOverride[1]:(l==null?void 0:l[$.vertexIdx+1])??0,Pe=$.localPositionOverride?$.localPositionOverride[2]:(l==null?void 0:l[$.vertexIdx+2])??0,me=le.localPositionOverride?le.localPositionOverride[0]:(l==null?void 0:l[le.vertexIdx])??0,Ke=le.localPositionOverride?le.localPositionOverride[1]:(l==null?void 0:l[le.vertexIdx+1])??0,et=le.localPositionOverride?le.localPositionOverride[2]:(l==null?void 0:l[le.vertexIdx+2])??0,ft=$.localNormalOverride?$.localNormalOverride[0]:(h==null?void 0:h[$.vertexIdx])??0,wt=$.localNormalOverride?$.localNormalOverride[1]:(h==null?void 0:h[$.vertexIdx+1])??0,mi=$.localNormalOverride?$.localNormalOverride[2]:(h==null?void 0:h[$.vertexIdx+2])??0,Zt=le.localNormalOverride?le.localNormalOverride[0]:(h==null?void 0:h[le.vertexIdx])??0,li=le.localNormalOverride?le.localNormalOverride[1]:(h==null?void 0:h[le.vertexIdx+1])??0,Qs=le.localNormalOverride?le.localNormalOverride[2]:(h==null?void 0:h[le.vertexIdx+2])??0,nr=ft+(Zt-ft)*xe,fs=wt+(li-wt)*xe,hi=mi+(Qs-mi)*xe,Ui=Math.sqrt(nr*nr+fs*fs+hi*hi);return new $l(y.Lerp($.position,le.position,xe),y.Lerp($.normal,le.normal,xe).normalize(),ne.Lerp($.uv,le.uv,xe),-1,-1,l?[ze+(me-ze)*xe,pe+(Ke-pe)*xe,Pe+(et-Pe)*xe]:null,h?[nr/Ui,fs/Ui,hi/Ui]:null,ue,Se)};let ge=null;k.length>3&&(ge=[]);for(let $=0;$<k.length;$+=3){let le=0,xe=null,ue=null,Se=null,ze=null;const pe=y.Dot(k[$].position,M)-V,Pe=y.Dot(k[$+1].position,M)-V,me=y.Dot(k[$+2].position,M)-V,Ke=pe>0,et=Pe>0,ft=me>0;switch(le=(Ke?1:0)+(et?1:0)+(ft?1:0),le){case 0:k.length>3?(ge.push(k[$]),ge.push(k[$+1]),ge.push(k[$+2])):ge=k;break;case 1:if(ge=ge??new Array,Ke&&(xe=k[$+1],ue=k[$+2],Se=ae(k[$],xe),ze=ae(k[$],ue)),et){xe=k[$],ue=k[$+2],Se=ae(k[$+1],xe),ze=ae(k[$+1],ue),ge.push(Se),ge.push(ue.clone()),ge.push(xe.clone()),ge.push(ue.clone()),ge.push(Se.clone()),ge.push(ze);break}ft&&(xe=k[$],ue=k[$+1],Se=ae(k[$+2],xe),ze=ae(k[$+2],ue)),xe&&ue&&Se&&ze&&(ge.push(xe.clone()),ge.push(ue.clone()),ge.push(Se),ge.push(ze),ge.push(Se.clone()),ge.push(ue.clone()));break;case 2:ge=ge??new Array,Ke||(xe=k[$].clone(),ue=ae(xe,k[$+1]),Se=ae(xe,k[$+2]),ge.push(xe),ge.push(ue),ge.push(Se)),et||(xe=k[$+1].clone(),ue=ae(xe,k[$+2]),Se=ae(xe,k[$]),ge.push(xe),ge.push(ue),ge.push(Se)),ft||(xe=k[$+2].clone(),ue=ae(xe,k[$]),Se=ae(xe,k[$+1]),ge.push(xe),ge.push(ue),ge.push(Se));break}}return ge},D=e instanceof O?e:null,w=D==null?void 0:D._thinInstanceDataStorage.matrixData,z=(D==null?void 0:D.thinInstanceCount)||1,F=N.Matrix[0];F.copyFrom(L.IdentityReadOnly);for(let k=0;k<z;++k){if(D!=null&&D.hasThinInstances&&w){const $=k*16;F.setRowFromFloats(0,w[$+0],w[$+1],w[$+2],w[$+3]),F.setRowFromFloats(1,w[$+4],w[$+5],w[$+6],w[$+7]),F.setRowFromFloats(2,w[$+8],w[$+9],w[$+10],w[$+11]),F.setRowFromFloats(3,w[$+12],w[$+13],w[$+14],w[$+15])}const M=L.RotationYawPitchRoll(T,b,v).multiply(L.Translation(p.x,p.y,p.z)),V=L.Invert(M),j=e.getWorldMatrix(),ae=F.multiply(j).multiply(V),ge=new Array(3);for(let $=0;$<r.length;$+=3){let le=ge;if(le[0]=R($,ae),le[1]=R($+1,ae),le[2]=R($+2,ae),!(t.cullBackFaces&&-le[0].normal.z<=0&&-le[1].normal.z<=0&&-le[2].normal.z<=0)&&(le=I(le,XI),!!le&&(le=I(le,YI),!!le&&(le=I(le,jI),!!le&&(le=I(le,qI),!!le&&(le=I(le,$I),!!le&&(le=I(le,ZI),!!le)))))))for(let xe=0;xe<le.length;xe++){const ue=le[xe];if(x.indices.push(E),s?(ue.localPositionOverride?(x.positions[E*3]=ue.localPositionOverride[0],x.positions[E*3+1]=ue.localPositionOverride[1],x.positions[E*3+2]=ue.localPositionOverride[2]):l&&(x.positions[E*3]=l[ue.vertexIdx],x.positions[E*3+1]=l[ue.vertexIdx+1],x.positions[E*3+2]=l[ue.vertexIdx+2]),ue.localNormalOverride?(x.normals[E*3]=ue.localNormalOverride[0],x.normals[E*3+1]=ue.localNormalOverride[1],x.normals[E*3+2]=ue.localNormalOverride[2]):h&&(x.normals[E*3]=h[ue.vertexIdx],x.normals[E*3+1]=h[ue.vertexIdx+1],x.normals[E*3+2]=h[ue.vertexIdx+2])):(ue.position.toArray(x.positions,E*3),ue.normal.toArray(x.normals,E*3)),x.matricesIndices&&x.matricesWeights&&(ue.matrixIndicesOverride?(x.matricesIndices[E*4]=ue.matrixIndicesOverride[0],x.matricesIndices[E*4+1]=ue.matrixIndicesOverride[1],x.matricesIndices[E*4+2]=ue.matrixIndicesOverride[2],x.matricesIndices[E*4+3]=ue.matrixIndicesOverride[3]):(c&&(x.matricesIndices[E*4]=c[ue.vertexIdxForBones],x.matricesIndices[E*4+1]=c[ue.vertexIdxForBones+1],x.matricesIndices[E*4+2]=c[ue.vertexIdxForBones+2],x.matricesIndices[E*4+3]=c[ue.vertexIdxForBones+3]),d&&x.matricesIndicesExtra&&(x.matricesIndicesExtra[E*4]=d[ue.vertexIdxForBones],x.matricesIndicesExtra[E*4+1]=d[ue.vertexIdxForBones+1],x.matricesIndicesExtra[E*4+2]=d[ue.vertexIdxForBones+2],x.matricesIndicesExtra[E*4+3]=d[ue.vertexIdxForBones+3])),ue.matrixWeightsOverride?(x.matricesWeights[E*4]=ue.matrixWeightsOverride[0],x.matricesWeights[E*4+1]=ue.matrixWeightsOverride[1],x.matricesWeights[E*4+2]=ue.matrixWeightsOverride[2],x.matricesWeights[E*4+3]=ue.matrixWeightsOverride[3]):(f&&(x.matricesWeights[E*4]=f[ue.vertexIdxForBones],x.matricesWeights[E*4+1]=f[ue.vertexIdxForBones+1],x.matricesWeights[E*4+2]=f[ue.vertexIdxForBones+2],x.matricesWeights[E*4+3]=f[ue.vertexIdxForBones+3]),_&&x.matricesWeightsExtra&&(x.matricesWeightsExtra[E*4]=_[ue.vertexIdxForBones],x.matricesWeightsExtra[E*4+1]=_[ue.vertexIdxForBones+1],x.matricesWeightsExtra[E*4+2]=_[ue.vertexIdxForBones+2],x.matricesWeightsExtra[E*4+3]=_[ue.vertexIdxForBones+3]))),t.captureUVS)ue.uv.toArray(x.uvs,E*2);else{x.uvs.push(.5+ue.position.x/m.x);const Se=.5+ue.position.y/m.y;x.uvs.push(Se)}E++}}}x.indices.length===0&&(x.indices=null),x.positions.length===0&&(x.positions=null),x.normals.length===0&&(x.normals=null),x.uvs.length===0&&(x.uvs=null),((X=x.matricesIndices)==null?void 0:X.length)===0&&(x.matricesIndices=null),((he=x.matricesWeights)==null?void 0:he.length)===0&&(x.matricesWeights=null),((H=x.matricesIndicesExtra)==null?void 0:H.length)===0&&(x.matricesIndicesExtra=null),((G=x.matricesWeightsExtra)==null?void 0:G.length)===0&&(x.matricesWeightsExtra=null);const W=new O(n,e.getScene());return x.applyToMesh(W),s?(W.skeleton=e.skeleton,W.parent=e):(W.position=p.clone(),W.rotation=new y(b,T,v)),W.computeWorldMatrix(!0),W.refreshBoundingInfo(!0,!0),W}O.CreateDecal=(n,e,t,i,s,r)=>Ax(n,e,{position:t,normal:i,size:s,angle:r});function Ex(n={subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6}){const e=Math.max(n.subdivisions?n.subdivisions:2,1)|0,t=Math.max(n.tessellation?n.tessellation:16,3)|0,i=Math.max(n.height?n.height:1,0),s=Math.max(n.radius?n.radius:.25,0),r=Math.max(n.capSubdivisions?n.capSubdivisions:6,1)|0,a=t,o=e,l=Math.max(n.radiusTop?n.radiusTop:s,0),h=Math.max(n.radiusBottom?n.radiusBottom:s,0),u=i-(l+h),c=0,f=2*Math.PI,d=Math.max(n.topCapSubdivisions?n.topCapSubdivisions:r,1),_=Math.max(n.bottomCapSubdivisions?n.bottomCapSubdivisions:r,1),p=Math.acos((h-l)/i);let g=[];const m=[],v=[],T=[];let A=0;const b=[],x=u*.5,E=Math.PI*.5;let R,C;const I=y.Zero(),D=y.Zero(),w=Math.cos(p),z=Math.sin(p),F=new ne(l*z,x+l*w).subtract(new ne(h*z,-x+h*w)).length(),W=l*p+F+h*(E-p);let X=0;for(C=0;C<=d;C++){const k=[],M=E-p*(C/d);X+=l*p/d;const V=Math.cos(M),j=Math.sin(M),ae=V*l;for(R=0;R<=a;R++){const ge=R/a,$=ge*f+c,le=Math.sin($),xe=Math.cos($);D.x=ae*le,D.y=x+j*l,D.z=ae*xe,m.push(D.x,D.y,D.z),I.set(V*le,j,V*xe),v.push(I.x,I.y,I.z),T.push(ge,1-X/W),k.push(A),A++}b.push(k)}const he=i-l-h+w*l-w*h,H=z*(h-l)/he;for(C=1;C<=o;C++){const k=[];X+=F/o;const M=z*(C*(h-l)/o+l);for(R=0;R<=a;R++){const V=R/a,j=V*f+c,ae=Math.sin(j),ge=Math.cos(j);D.x=M*ae,D.y=x+w*l-C*he/o,D.z=M*ge,m.push(D.x,D.y,D.z),I.set(ae,H,ge).normalize(),v.push(I.x,I.y,I.z),T.push(V,1-X/W),k.push(A),A++}b.push(k)}for(C=1;C<=_;C++){const k=[],M=E-p-(Math.PI-p)*(C/_);X+=h*p/_;const V=Math.cos(M),j=Math.sin(M),ae=V*h;for(R=0;R<=a;R++){const ge=R/a,$=ge*f+c,le=Math.sin($),xe=Math.cos($);D.x=ae*le,D.y=-x+j*h,D.z=ae*xe,m.push(D.x,D.y,D.z),I.set(V*le,j,V*xe),v.push(I.x,I.y,I.z),T.push(ge,1-X/W),k.push(A),A++}b.push(k)}for(R=0;R<a;R++)for(C=0;C<d+o+_;C++){const k=b[C][R],M=b[C+1][R],V=b[C+1][R+1],j=b[C][R+1];g.push(k),g.push(M),g.push(j),g.push(M),g.push(V),g.push(j)}if(g=g.reverse(),n.orientation&&!n.orientation.equals(y.Up())){const k=new L;n.orientation.clone().scale(Math.PI*.5).cross(y.Up()).toQuaternion().toRotationMatrix(k);const M=y.Zero();for(let V=0;V<m.length;V+=3)M.set(m[V],m[V+1],m[V+2]),y.TransformCoordinatesToRef(M.clone(),k,M),m[V]=M.x,m[V+1]=M.y,m[V+2]=M.z}const G=new Q;return G.positions=m,G.normals=v,G.uvs=T,G.indices=g,G}function Sx(n,e={orientation:y.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},t=null){const i=new O(n,t);return Ex(e).applyToMesh(i,e.updatable),i}O.CreateCapsule=(n,e,t)=>Sx(n,e,t);Q.CreateCapsule=Ex;class ht{constructor(e=0,t=0){this.x=e,this.y=t,e!==Math.floor(e)&&(e=Math.floor(e),U.Warn("x is not an integer, floor(x) used")),t!==Math.floor(t)&&(t=Math.floor(t),U.Warn("y is not an integer, floor(y) used"))}clone(){return new ht(this.x,this.y)}rotate60About(e){const t=this.x;return this.x=e.x+e.y-this.y,this.y=t+this.y-e.x,this}rotateNeg60About(e){const t=this.x;return this.x=t+this.y-e.y,this.y=e.x+e.y-t,this}rotate120(e,t){e!==Math.floor(e)&&(e=Math.floor(e),U.Warn("m not an integer only floor(m) used")),t!==Math.floor(t)&&(t=Math.floor(t),U.Warn("n not an integer only floor(n) used"));const i=this.x;return this.x=e-i-this.y,this.y=t+i,this}rotateNeg120(e,t){e!==Math.floor(e)&&(e=Math.floor(e),U.Warn("m is not an integer, floor(m) used")),t!==Math.floor(t)&&(t=Math.floor(t),U.Warn("n is not an integer,   floor(n) used"));const i=this.x;return this.x=this.y-t,this.y=e+t-i-this.y,this}toCartesianOrigin(e,t){const i=y.Zero();return i.x=e.x+2*this.x*t+this.y*t,i.y=e.y+Math.sqrt(3)*this.y*t,i}static Zero(){return new ht(0,0)}}class Rx{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new qc("icosahedron","Regular",[[0,It,-1],[-It,1,0],[-1,0,-It],[1,0,-It],[It,1,0],[0,It,1],[-1,0,It],[-It,-1,0],[0,-It,-1],[It,-1,0],[1,0,It],[0,-It,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let e=12;const t={},i=this.m,s=this.n;let r=i,a=1,o=0;s!==0&&(r=Pc(i,s)),a=i/r,o=s/r;let l,h,u,c,f;const d=ht.Zero(),_=new ht(i,s),p=new ht(-s,i+s),g=ht.Zero(),m=ht.Zero(),v=ht.Zero();let T=[],A,b,x,E;const R=[],C=this.vertByDist,I=(D,w,z,F)=>{A=D+"|"+z,b=w+"|"+F,A in t||b in t?A in t&&!(b in t)?t[b]=t[A]:b in t&&!(A in t)&&(t[A]=t[b]):(t[A]=e,t[b]=e,e++),C[z][0]>2?R[t[A]]=[-C[z][0],C[z][1],t[A]]:R[t[A]]=[T[C[z][0]],C[z][1],t[A]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let D=0;D<20;D++){if(T=this.IDATA.face[D],u=T[2],c=T[1],f=T[0],x=d.x+"|"+d.y,A=D+"|"+x,A in t||(t[A]=u,R[u]=[T[C[x][0]],C[x][1]]),x=_.x+"|"+_.y,A=D+"|"+x,A in t||(t[A]=c,R[c]=[T[C[x][0]],C[x][1]]),x=p.x+"|"+p.y,A=D+"|"+x,A in t||(t[A]=f,R[f]=[T[C[x][0]],C[x][1]]),l=this.IDATA.edgematch[D][0],h=this.IDATA.edgematch[D][1],h==="B")for(let w=1;w<r;w++)m.x=i-w*(a+o),m.y=s+w*a,v.x=-w*o,v.y=w*(a+o),x=m.x+"|"+m.y,E=v.x+"|"+v.y,I(D,l,x,E);if(h==="O")for(let w=1;w<r;w++)v.x=-w*o,v.y=w*(a+o),g.x=w*a,g.y=w*o,x=v.x+"|"+v.y,E=g.x+"|"+g.y,I(D,l,x,E);if(l=this.IDATA.edgematch[D][2],h=this.IDATA.edgematch[D][3],h&&h==="A")for(let w=1;w<r;w++)g.x=w*a,g.y=w*o,m.x=i-(r-w)*(a+o),m.y=s+(r-w)*a,x=g.x+"|"+g.y,E=m.x+"|"+m.y,I(D,l,x,E);for(let w=0;w<this.vertices.length;w++)x=this.vertices[w].x+"|"+this.vertices[w].y,A=D+"|"+x,A in t||(t[A]=e++,C[x][0]>2?R[t[A]]=[-C[x][0],C[x][1],t[A]]:R[t[A]]=[T[C[x][0]],C[x][1],t[A]])}this.closestTo=R,this.vecToidx=t}calcCoeffs(){const e=this.m,t=this.n,i=Math.sqrt(3)/3,s=e*e+t*t+e*t;this.coau=(e+t)/s,this.cobu=-t/s,this.coav=-i*(e-t)/s,this.cobv=i*(2*e+t)/s}createInnerFacets(){const e=this.m,t=this.n;for(let i=0;i<t+e+1;i++)for(let s=this.min[i];s<this.max[i]+1;s++)s<this.max[i]&&s<this.max[i+1]+1&&this.innerFacets.push(["|"+s+"|"+i,"|"+s+"|"+(i+1),"|"+(s+1)+"|"+i]),i>0&&s<this.max[i-1]&&s+1<this.max[i]+1&&this.innerFacets.push(["|"+s+"|"+i,"|"+(s+1)+"|"+i,"|"+(s+1)+"|"+(i-1)])}edgeVecsABOB(){const e=this.m,t=this.n,i=new ht(-t,e+t);for(let s=1;s<e+t;s++){const r=new ht(this.min[s],s),a=new ht(this.min[s-1],s-1),o=new ht(this.min[s+1],s+1),l=r.clone(),h=a.clone(),u=o.clone();l.rotate60About(i),h.rotate60About(i),u.rotate60About(i);const c=new ht(this.max[l.y],l.y),f=new ht(this.max[l.y-1],l.y-1),d=new ht(this.max[l.y-1]-1,l.y-1);(l.x!==c.x||l.y!==c.y)&&(l.x!==f.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([r,f,d]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([r,d,c])):l.y===u.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([r,a,f]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([r,f,o])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([r,a,f]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([r,f,c])))}}mapABOBtoOBOA(){const e=new ht(0,0);for(let t=0;t<this.isoVecsABOB.length;t++){const i=[];for(let s=0;s<3;s++)e.x=this.isoVecsABOB[t][s].x,e.y=this.isoVecsABOB[t][s].y,this.vertexTypes[t][s]===0&&e.rotateNeg120(this.m,this.n),i.push(e.clone());this.isoVecsOBOA.push(i)}}mapABOBtoBAOA(){const e=new ht(0,0);for(let t=0;t<this.isoVecsABOB.length;t++){const i=[];for(let s=0;s<3;s++)e.x=this.isoVecsABOB[t][s].x,e.y=this.isoVecsABOB[t][s].y,this.vertexTypes[t][s]===1&&e.rotate120(this.m,this.n),i.push(e.clone());this.isoVecsBAOA.push(i)}}MapToFace(e,t){const i=this.IDATA.face[e],s=i[2],r=i[1],a=i[0],o=y.FromArray(this.IDATA.vertex[s]),l=y.FromArray(this.IDATA.vertex[r]),h=y.FromArray(this.IDATA.vertex[a]),u=l.subtract(o),c=h.subtract(o),f=u.scale(this.coau).add(c.scale(this.cobu)),d=u.scale(this.coav).add(c.scale(this.cobv));let _,p=N.Vector3[0];for(let g=0;g<this.cartesian.length;g++)p=f.scale(this.cartesian[g].x).add(d.scale(this.cartesian[g].y)).add(o),p.x,p.y,p.z,_=e+"|"+this.vertices[g].x+"|"+this.vertices[g].y,t.vertex[this.vecToidx[_]]=[p.x,p.y,p.z]}build(e,t){const i=[],s=ht.Zero(),r=new ht(e,t),a=new ht(-t,e+t);i.push(s,r,a);for(let b=t;b<e+1;b++)for(let x=0;x<e+1-b;x++)i.push(new ht(x,b));if(t>0){const b=Pc(e,t),x=e/b,E=t/b;for(let C=1;C<b;C++)i.push(new ht(C*x,C*E)),i.push(new ht(-C*E,C*(x+E))),i.push(new ht(e-C*(x+E),t+C*x));const R=e/t;for(let C=1;C<t;C++)for(let I=0;I<C*R;I++)i.push(new ht(I,C)),i.push(new ht(I,C).rotate120(e,t)),i.push(new ht(I,C).rotateNeg120(e,t))}i.sort((b,x)=>b.x-x.x),i.sort((b,x)=>b.y-x.y);const o=new Array(e+t+1),l=new Array(e+t+1);for(let b=0;b<o.length;b++)o[b]=1/0,l[b]=-1/0;let h=0,u=0;const c=i.length;for(let b=0;b<c;b++)u=i[b].x,h=i[b].y,o[h]=Math.min(u,o[h]),l[h]=Math.max(u,l[h]);const f=(b,x)=>{const E=b.clone();return x==="A"&&E.rotateNeg120(e,t),x==="B"&&E.rotate120(e,t),E.x<0?E.y:E.x+E.y},d=[],_=[],p=[],g=[],m={},v=[];let T=-1,A=-1;for(let b=0;b<c;b++)d[b]=i[b].toCartesianOrigin(new ht(0,0),.5),_[b]=f(i[b],"O"),p[b]=f(i[b],"A"),g[b]=f(i[b],"B"),_[b]===p[b]&&p[b]===g[b]?(T=3,A=_[b]):_[b]===p[b]?(T=4,A=_[b]):p[b]===g[b]?(T=5,A=p[b]):g[b]===_[b]&&(T=6,A=_[b]),_[b]<p[b]&&_[b]<g[b]&&(T=2,A=_[b]),p[b]<_[b]&&p[b]<g[b]&&(T=1,A=p[b]),g[b]<p[b]&&g[b]<_[b]&&(T=0,A=g[b]),v.push([T,A,i[b].x,i[b].y]);v.sort((b,x)=>b[2]-x[2]),v.sort((b,x)=>b[3]-x[3]),v.sort((b,x)=>b[1]-x[1]),v.sort((b,x)=>b[0]-x[0]);for(let b=0;b<v.length;b++)m[v[b][2]+"|"+v[b][3]]=[v[b][0],v[b][1],b];return this.m=e,this.n=t,this.vertices=i,this.vertByDist=m,this.cartesian=d,this.min=o,this.max=l,this}}class qc{constructor(e,t,i,s){this.name=e,this.category=t,this.vertex=i,this.face=s}}class kh extends qc{innerToData(e,t){for(let i=0;i<t.innerFacets.length;i++)this.face.push(t.innerFacets[i].map(s=>t.vecToidx[e+s]))}mapABOBtoDATA(e,t){const i=t.IDATA.edgematch[e][0];for(let s=0;s<t.isoVecsABOB.length;s++){const r=[];for(let a=0;a<3;a++)t.vertexTypes[s][a]===0?r.push(e+"|"+t.isoVecsABOB[s][a].x+"|"+t.isoVecsABOB[s][a].y):r.push(i+"|"+t.isoVecsABOB[s][a].x+"|"+t.isoVecsABOB[s][a].y);this.face.push([t.vecToidx[r[0]],t.vecToidx[r[1]],t.vecToidx[r[2]]])}}mapOBOAtoDATA(e,t){const i=t.IDATA.edgematch[e][0];for(let s=0;s<t.isoVecsOBOA.length;s++){const r=[];for(let a=0;a<3;a++)t.vertexTypes[s][a]===1?r.push(e+"|"+t.isoVecsOBOA[s][a].x+"|"+t.isoVecsOBOA[s][a].y):r.push(i+"|"+t.isoVecsOBOA[s][a].x+"|"+t.isoVecsOBOA[s][a].y);this.face.push([t.vecToidx[r[0]],t.vecToidx[r[1]],t.vecToidx[r[2]]])}}mapBAOAtoDATA(e,t){const i=t.IDATA.edgematch[e][2];for(let s=0;s<t.isoVecsBAOA.length;s++){const r=[];for(let a=0;a<3;a++)t.vertexTypes[s][a]===1?r.push(e+"|"+t.isoVecsBAOA[s][a].x+"|"+t.isoVecsBAOA[s][a].y):r.push(i+"|"+t.isoVecsBAOA[s][a].x+"|"+t.isoVecsBAOA[s][a].y);this.face.push([t.vecToidx[r[0]],t.vecToidx[r[1]],t.vecToidx[r[2]]])}}orderData(e){const t=[];for(let a=0;a<13;a++)t[a]=[];const i=e.closestTo;for(let a=0;a<i.length;a++)i[a][0]>-1?i[a][1]>0&&t[i[a][0]].push([a,i[a][1]]):t[12].push([a,i[a][0]]);const s=[];for(let a=0;a<12;a++)s[a]=a;let r=12;for(let a=0;a<12;a++){t[a].sort((o,l)=>o[1]-l[1]);for(let o=0;o<t[a].length;o++)s[t[a][o][0]]=r++}for(let a=0;a<t[12].length;a++)s[t[12][a][0]]=r++;for(let a=0;a<this.vertex.length;a++)this.vertex[a].push(s[a]);this.vertex.sort((a,o)=>a[3]-o[3]);for(let a=0;a<this.vertex.length;a++)this.vertex[a].pop();for(let a=0;a<this.face.length;a++)for(let o=0;o<this.face[a].length;o++)this.face[a][o]=s[this.face[a][o]];this.sharedNodes=t[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(e,t){const i=[],s=[];let r=t.pop();s.push(r);let a=this.face[r].indexOf(e);a=(a+2)%3;let o=this.face[r][a];i.push(o);let l=0;for(;t.length>0;)r=t[l],this.face[r].indexOf(o)>-1?(a=(this.face[r].indexOf(o)+1)%3,o=this.face[r][a],i.push(o),s.push(r),t.splice(l,1),l=0):l++;return this.adjacentFaces.push(i),s}toGoldbergPolyhedronData(){const e=new qc("GeoDual","Goldberg",[],[]);e.name="GD dual";const t=this.vertex.length,i=new Array(t);for(let h=0;h<t;h++)i[h]=[];for(let h=0;h<this.face.length;h++)for(let u=0;u<3;u++)i[this.face[h][u]].push(h);let s=0,r=0,a=0,o=[],l=[];this.adjacentFaces=[];for(let h=0;h<i.length;h++)e.face[h]=this.setOrder(h,i[h].concat([])),i[h].forEach(u=>{s=0,r=0,a=0,o=this.face[u];for(let c=0;c<3;c++)l=this.vertex[o[c]],s+=l[0],r+=l[1],a+=l[2];e.vertex[u]=[s/3,r/3,a/3]});return e}static BuildGeodesicData(e){const t=new kh("Geodesic-m-n","Geodesic",[[0,It,-1],[-It,1,0],[-1,0,-It],[1,0,-It],[It,1,0],[0,It,1],[-1,0,It],[-It,-1,0],[0,-It,-1],[It,-1,0],[1,0,It],[0,-It,1]],[]);e.setIndices(),e.calcCoeffs(),e.createInnerFacets(),e.edgeVecsABOB(),e.mapABOBtoOBOA(),e.mapABOBtoBAOA();for(let s=0;s<e.IDATA.face.length;s++)e.MapToFace(s,t),t.innerToData(s,e),e.IDATA.edgematch[s][1]==="B"&&t.mapABOBtoDATA(s,e),e.IDATA.edgematch[s][1]==="O"&&t.mapOBOAtoDATA(s,e),e.IDATA.edgematch[s][3]==="A"&&t.mapBAOAtoDATA(s,e);t.orderData(e);const i=1;return t.vertex=t.vertex.map(function(s){const r=s[0],a=s[1],o=s[2],l=Math.sqrt(r*r+a*a+o*o);return s[0]*=i/l,s[1]*=i/l,s[2]*=i/l,s}),t}}function QI(n,e,t=null){let i=e.m||1;i!==Math.floor(i)&&(i=Math.floor(i),U.Warn("m not an integer only floor(m) used"));let s=e.n||0;if(s!==Math.floor(s)&&(s=Math.floor(s),U.Warn("n not an integer only floor(n) used")),s>i){const h=s;s=i,i=h,U.Warn("n > m therefore m and n swapped")}const r=new Rx;r.build(i,s);const o={custom:kh.BuildGeodesicData(r),size:e.size,sizeX:e.sizeX,sizeY:e.sizeY,sizeZ:e.sizeZ,faceUV:e.faceUV,faceColors:e.faceColors,flat:e.flat,updatable:e.updatable,sideOrientation:e.sideOrientation,frontUVs:e.frontUVs,backUVs:e.backUVs};return qd(n,o,t)}O._GoldbergMeshParser=(n,e)=>Vh.Parse(n,e);class Vh extends O{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(e,t){return t===void 0?(e>this.goldbergData.nbUnsharedFaces-1&&(U.Warn("Maximum number of unshared faces used"),e=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+e):(e>11&&(U.Warn("Last pole used"),e=11),t>this.goldbergData.nbFacesAtPole-1&&(U.Warn("Maximum number of faces at a pole used"),t=this.goldbergData.nbFacesAtPole-1),12+e*this.goldbergData.nbFacesAtPole+t)}_changeGoldbergFaceColors(e){for(let i=0;i<e.length;i++){const s=e[i][0],r=e[i][1],a=e[i][2];for(let o=s;o<r+1;o++)this.goldbergData.faceColors[o]=a}const t=[];for(let i=0;i<12;i++)for(let s=0;s<5;s++)t.push(this.goldbergData.faceColors[i].r,this.goldbergData.faceColors[i].g,this.goldbergData.faceColors[i].b,this.goldbergData.faceColors[i].a);for(let i=12;i<this.goldbergData.faceColors.length;i++)for(let s=0;s<6;s++)t.push(this.goldbergData.faceColors[i].r,this.goldbergData.faceColors[i].g,this.goldbergData.faceColors[i].b,this.goldbergData.faceColors[i].a);return t}setGoldbergFaceColors(e){const t=this._changeGoldbergFaceColors(e);this.setVerticesData(S.ColorKind,t)}updateGoldbergFaceColors(e){const t=this._changeGoldbergFaceColors(e);this.updateVerticesData(S.ColorKind,t)}_changeGoldbergFaceUVs(e){const t=this.getVerticesData(S.UVKind);for(let i=0;i<e.length;i++){const s=e[i][0],r=e[i][1],a=e[i][2],o=e[i][3],l=e[i][4],h=[],u=[];let c,f;for(let d=0;d<5;d++)c=a.x+o*Math.cos(l+d*Math.PI/2.5),f=a.y+o*Math.sin(l+d*Math.PI/2.5),c<0&&(c=0),c>1&&(c=1),h.push(c,f);for(let d=0;d<6;d++)c=a.x+o*Math.cos(l+d*Math.PI/3),f=a.y+o*Math.sin(l+d*Math.PI/3),c<0&&(c=0),c>1&&(c=1),u.push(c,f);for(let d=s;d<Math.min(12,r+1);d++)for(let _=0;_<5;_++)t[10*d+2*_]=h[2*_],t[10*d+2*_+1]=h[2*_+1];for(let d=Math.max(12,s);d<r+1;d++)for(let _=0;_<6;_++)t[12*d-24+2*_]=u[2*_],t[12*d-23+2*_]=u[2*_+1]}return t}setGoldbergFaceUVs(e){const t=this._changeGoldbergFaceUVs(e);this.setVerticesData(S.UVKind,t)}updateGoldbergFaceUVs(e){const t=this._changeGoldbergFaceUVs(e);this.updateVerticesData(S.UVKind,t)}placeOnGoldbergFaceAt(e,t,i){const s=y.RotationFromAxis(this.goldbergData.faceXaxis[t],this.goldbergData.faceYaxis[t],this.goldbergData.faceZaxis[t]);e.rotation=s,e.position=this.goldbergData.faceCenters[t].add(this.goldbergData.faceXaxis[t].scale(i.x)).add(this.goldbergData.faceYaxis[t].scale(i.y)).add(this.goldbergData.faceZaxis[t].scale(i.z))}serialize(e){super.serialize(e),e.type="GoldbergMesh";const t={};if(t.adjacentFaces=this.goldbergData.adjacentFaces,t.nbSharedFaces=this.goldbergData.nbSharedFaces,t.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,t.nbFaces=this.goldbergData.nbFaces,t.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){t.faceColors=[];for(const i of this.goldbergData.faceColors)t.faceColors.push(i.asArray())}if(this.goldbergData.faceCenters){t.faceCenters=[];for(const i of this.goldbergData.faceCenters)t.faceCenters.push(i.asArray())}if(this.goldbergData.faceZaxis){t.faceZaxis=[];for(const i of this.goldbergData.faceZaxis)t.faceZaxis.push(i.asArray())}if(this.goldbergData.faceYaxis){t.faceYaxis=[];for(const i of this.goldbergData.faceYaxis)t.faceYaxis.push(i.asArray())}if(this.goldbergData.faceXaxis){t.faceXaxis=[];for(const i of this.goldbergData.faceXaxis)t.faceXaxis.push(i.asArray())}e.goldbergData=t}static Parse(e,t){const i=e.goldbergData;i.faceColors=i.faceColors.map(r=>K.FromArray(r)),i.faceCenters=i.faceCenters.map(r=>y.FromArray(r)),i.faceZaxis=i.faceZaxis.map(r=>y.FromArray(r)),i.faceXaxis=i.faceXaxis.map(r=>y.FromArray(r)),i.faceYaxis=i.faceYaxis.map(r=>y.FromArray(r));const s=new Vh(e.name,t);return s.goldbergData=i,s}}function JI(n,e){const t=n.size,i=n.sizeX||t||1,s=n.sizeY||t||1,r=n.sizeZ||t||1,a=n.sideOrientation===0?0:n.sideOrientation||Q.DEFAULTSIDE,o=[],l=[],h=[],u=[];let c=1/0,f=-1/0,d=1/0,_=-1/0;for(let m=0;m<e.vertex.length;m++)c=Math.min(c,e.vertex[m][0]*i),f=Math.max(f,e.vertex[m][0]*i),d=Math.min(d,e.vertex[m][1]*s),_=Math.max(_,e.vertex[m][1]*s);let p=0;for(let m=0;m<e.face.length;m++){const v=e.face[m],T=y.FromArray(e.vertex[v[0]]),A=y.FromArray(e.vertex[v[2]]),b=y.FromArray(e.vertex[v[1]]),x=A.subtract(T),E=b.subtract(T),R=y.Cross(E,x).normalize();for(let C=0;C<v.length;C++){h.push(R.x,R.y,R.z);const I=e.vertex[v[C]];o.push(I[0]*i,I[1]*s,I[2]*r);const D=(I[1]*s-d)/(_-d);u.push((I[0]*i-c)/(f-c),D)}for(let C=0;C<v.length-2;C++)l.push(p,p+C+2,p+C+1);p+=v.length}Q._ComputeSides(a,o,l,h,u);const g=new Q;return g.positions=o,g.indices=l,g.normals=h,g.uvs=u,g}function eC(n,e,t=null){const i=e.size,s=e.sizeX||i||1,r=e.sizeY||i||1,a=e.sizeZ||i||1;let o=e.m||1;o!==Math.floor(o)&&(o=Math.floor(o),U.Warn("m not an integer only floor(m) used"));let l=e.n||0;if(l!==Math.floor(l)&&(l=Math.floor(l),U.Warn("n not an integer only floor(n) used")),l>o){const _=l;l=o,o=_,U.Warn("n > m therefore m and n swapped")}const h=new Rx;h.build(o,l);const u=kh.BuildGeodesicData(h),c=u.toGoldbergPolyhedronData(),f=new Vh(n,t);e.sideOrientation=O._GetDefaultSideOrientation(e.sideOrientation),f._originalBuilderSideOrientation=e.sideOrientation,JI(e,c).applyToMesh(f,e.updatable),f.goldbergData.nbSharedFaces=u.sharedNodes,f.goldbergData.nbUnsharedFaces=u.poleNodes,f.goldbergData.adjacentFaces=u.adjacentFaces,f.goldbergData.nbFaces=f.goldbergData.nbSharedFaces+f.goldbergData.nbUnsharedFaces,f.goldbergData.nbFacesAtPole=(f.goldbergData.nbUnsharedFaces-12)/12;for(let _=0;_<u.vertex.length;_++)f.goldbergData.faceCenters.push(y.FromArray(u.vertex[_])),f.goldbergData.faceCenters[_].x*=s,f.goldbergData.faceCenters[_].y*=r,f.goldbergData.faceCenters[_].z*=a,f.goldbergData.faceColors.push(new K(1,1,1,1));for(let _=0;_<c.face.length;_++){const p=c.face[_],g=y.FromArray(c.vertex[p[0]]),m=y.FromArray(c.vertex[p[2]]),v=y.FromArray(c.vertex[p[1]]),T=m.subtract(g),A=v.subtract(g),b=y.Cross(A,T).normalize(),x=y.Cross(A,b).normalize();f.goldbergData.faceXaxis.push(A.normalize()),f.goldbergData.faceYaxis.push(b),f.goldbergData.faceZaxis.push(x)}return f}class tC{constructor(e){this._paths=[],this._tempPaths=[],this._holes=[],this._resolution=e}moveTo(e,t){this._currentPath=new mh(e,t),this._tempPaths.push(this._currentPath)}lineTo(e,t){this._currentPath.addLineTo(e,t)}quadraticCurveTo(e,t,i,s){this._currentPath.addQuadraticCurveTo(e,t,i,s,this._resolution)}bezierCurveTo(e,t,i,s,r,a){this._currentPath.addBezierCurveTo(e,t,i,s,r,a,this._resolution)}extractHoles(){for(const e of this._tempPaths)e.area()>0?this._holes.push(e):this._paths.push(e);if(!this._paths.length&&this._holes.length){const e=this._holes;this._holes=this._paths,this._paths=e}this._tempPaths.length=0}get paths(){return this._paths}get holes(){return this._holes}}function iC(n,e,t,i,s,r){const a=r.glyphs[n]||r.glyphs["?"];if(!a)return null;const o=new tC(s);if(a.o){const l=a.o.split(" ");for(let h=0,u=l.length;h<u;)switch(l[h++]){case"m":{const f=parseInt(l[h++])*e+t,d=parseInt(l[h++])*e+i;o.moveTo(f,d);break}case"l":{const f=parseInt(l[h++])*e+t,d=parseInt(l[h++])*e+i;o.lineTo(f,d);break}case"q":{const f=parseInt(l[h++])*e+t,d=parseInt(l[h++])*e+i,_=parseInt(l[h++])*e+t,p=parseInt(l[h++])*e+i;o.quadraticCurveTo(_,p,f,d);break}case"b":{const f=parseInt(l[h++])*e+t,d=parseInt(l[h++])*e+i,_=parseInt(l[h++])*e+t,p=parseInt(l[h++])*e+i,g=parseInt(l[h++])*e+t,m=parseInt(l[h++])*e+i;o.bezierCurveTo(_,p,g,m,f,d);break}}}return o.extractHoles(),{offsetX:a.ha*e,shapePath:o}}function sC(n,e,t,i){const s=Array.from(n),r=e/i.resolution,a=(i.boundingBox.yMax-i.boundingBox.yMin+i.underlineThickness)*r,o=[];let l=0,h=0;for(let u=0;u<s.length;u++){const c=s[u];if(c===`
`)l=0,h-=a;else{const f=iC(c,r,l,h,t,i);f&&(l+=f.offsetX,o.push(f.shapePath))}}return o}function nC(n,e,t,i={size:50,resolution:8,depth:1},s=null,r=earcut){var u,c;const a=sC(e,i.size||50,i.resolution||8,t),o=[];let l=0;for(const f of a){if(!f.paths.length)continue;const d=f.holes.slice();for(const _ of f.paths){const p=[],g=[],m=_.getPoints();for(const A of m)g.push(new y(A.x,0,A.y));const v=d.slice();for(const A of v){const b=A.getPoints();let x=!1;for(const R of b)if(_.isPointInside(R)){x=!0;break}if(!x)continue;const E=[];for(const R of b)E.push(new y(R.x,0,R.y));p.push(E),d.splice(d.indexOf(A),1)}if(!p.length&&d.length)for(const A of d){const b=A.getPoints(),x=[];for(const E of b)x.push(new y(E.x,0,E.y));p.push(x)}const T=jd(n,{shape:g,holes:p.length?p:void 0,depth:i.depth||1,faceUV:i.faceUV||((u=i.perLetterFaceUV)==null?void 0:u.call(i,l)),faceColors:i.faceColors||((c=i.perLetterFaceColors)==null?void 0:c.call(i,l)),sideOrientation:O._GetDefaultSideOrientation(i.sideOrientation||O.DOUBLESIDE)},s,r);o.push(T),l++}}const h=O.MergeMeshes(o,!0,!0);if(h){const f=h.getBoundingInfo().boundingBox;h.position.x+=-(f.minimumWorld.x+f.maximumWorld.x)/2,h.position.y+=-(f.minimumWorld.y+f.maximumWorld.y)/2,h.position.z+=-(f.minimumWorld.z+f.maximumWorld.z)/2+f.extendSize.z,h.name=n;const d=new Re("pivot",s);d.rotation.x=-Math.PI/2,h.parent=d,h.bakeCurrentTransformIntoVertices(),h.parent=null,d.dispose()}return h}const Ti={CreateBox:Zy,CreateTiledBox:WI,CreateSphere:ex,CreateDisc:Wy,CreateIcoSphere:Tx,CreateRibbon:Lr,CreateCylinder:ix,CreateTorus:nx,CreateTorusKnot:ax,CreateLineSystem:hx,CreateLines:ux,CreateDashedLines:cx,ExtrudeShape:dx,ExtrudeShapeCustom:_x,CreateLathe:gx,CreateTiledPlane:zI,CreatePlane:vx,CreateGround:Yy,CreateTiledGround:jy,CreateGroundFromHeightMap:qy,CreatePolygon:Yd,ExtrudePolygon:jd,CreateTube:yx,CreatePolyhedron:qd,CreateGeodesic:QI,CreateGoldberg:eC,CreateDecal:Ax,CreateCapsule:Sx,CreateText:nC};O.prototype.thinInstanceAdd=function(n,e=!0){if(!this.getScene().getEngine().getCaps().instancedArrays)return U.Error("Thin Instances are not supported on this device as Instanced Array extension not supported"),-1;this._thinInstanceUpdateBufferSize("matrix",Array.isArray(n)?n.length:1);const t=this._thinInstanceDataStorage.instancesCount;if(Array.isArray(n))for(let i=0;i<n.length;++i)this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,n[i],i===n.length-1&&e);else this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,n,e);return t};O.prototype.thinInstanceAddSelf=function(n=!0){return this.thinInstanceAdd(L.IdentityReadOnly,n)};O.prototype.thinInstanceRegisterAttribute=function(n,e){n===S.ColorKind&&(n=S.ColorInstanceKind),this.removeVerticesData(n),this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.strides[n]=e,this._userThinInstanceBuffersStorage.sizes[n]=e*Math.max(32,this._thinInstanceDataStorage.instancesCount),this._userThinInstanceBuffersStorage.data[n]=new Float32Array(this._userThinInstanceBuffersStorage.sizes[n]),this._userThinInstanceBuffersStorage.vertexBuffers[n]=new S(this.getEngine(),this._userThinInstanceBuffersStorage.data[n],n,!0,!1,e,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[n])};O.prototype.thinInstanceSetMatrixAt=function(n,e,t=!0){if(!this._thinInstanceDataStorage.matrixData||n>=this._thinInstanceDataStorage.instancesCount)return!1;const i=this._thinInstanceDataStorage.matrixData;return e.copyToArray(i,n*16),this._thinInstanceDataStorage.worldMatrices&&(this._thinInstanceDataStorage.worldMatrices[n]=e),t&&(this.thinInstanceBufferUpdated("matrix"),this.doNotSyncBoundingInfo||this.thinInstanceRefreshBoundingInfo(!1)),!0};O.prototype.thinInstanceSetAttributeAt=function(n,e,t,i=!0){return n===S.ColorKind&&(n=S.ColorInstanceKind),!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.data[n]||e>=this._thinInstanceDataStorage.instancesCount?!1:(this._thinInstanceUpdateBufferSize(n,0),this._userThinInstanceBuffersStorage.data[n].set(t,e*this._userThinInstanceBuffersStorage.strides[n]),i&&this.thinInstanceBufferUpdated(n),!0)};Object.defineProperty(O.prototype,"thinInstanceCount",{get:function(){return this._thinInstanceDataStorage.instancesCount},set:function(n){var i;const e=this._thinInstanceDataStorage.matrixData??((i=this.source)==null?void 0:i._thinInstanceDataStorage.matrixData),t=e?e.length/16:0;n<=t&&(this._thinInstanceDataStorage.instancesCount=n)},enumerable:!0,configurable:!0});O.prototype._thinInstanceCreateMatrixBuffer=function(n,e,t=!0){const i=new Pa(this.getEngine(),e,!t,16,!1,!0);for(let s=0;s<4;s++)this.setVerticesBuffer(i.createVertexBuffer(n+s,s*4,4));return i};O.prototype.thinInstanceSetBuffer=function(n,e,t=0,i=!0){var s,r,a;t=t||16,n==="matrix"?((s=this._thinInstanceDataStorage.matrixBuffer)==null||s.dispose(),this._thinInstanceDataStorage.matrixBuffer=null,this._thinInstanceDataStorage.matrixBufferSize=e?e.length:32*t,this._thinInstanceDataStorage.matrixData=e,this._thinInstanceDataStorage.worldMatrices=null,e!==null?(this._thinInstanceDataStorage.instancesCount=e.length/t,this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",e,i),this.doNotSyncBoundingInfo||this.thinInstanceRefreshBoundingInfo(!1)):(this._thinInstanceDataStorage.instancesCount=0,this.doNotSyncBoundingInfo||this.refreshBoundingInfo())):n==="previousMatrix"?((r=this._thinInstanceDataStorage.previousMatrixBuffer)==null||r.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=null,this._thinInstanceDataStorage.previousMatrixData=e,e!==null&&(this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",e,i))):(n===S.ColorKind&&(n=S.ColorInstanceKind),e===null?(a=this._userThinInstanceBuffersStorage)!=null&&a.data[n]&&(this.removeVerticesData(n),delete this._userThinInstanceBuffersStorage.data[n],delete this._userThinInstanceBuffersStorage.strides[n],delete this._userThinInstanceBuffersStorage.sizes[n],delete this._userThinInstanceBuffersStorage.vertexBuffers[n]):(this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.data[n]=e,this._userThinInstanceBuffersStorage.strides[n]=t,this._userThinInstanceBuffersStorage.sizes[n]=e.length,this._userThinInstanceBuffersStorage.vertexBuffers[n]=new S(this.getEngine(),e,n,!i,!1,t,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[n])))};O.prototype.thinInstanceBufferUpdated=function(n){var e,t,i;n==="matrix"?(this.thinInstanceAllowAutomaticStaticBufferRecreation&&this._thinInstanceDataStorage.matrixBuffer&&!this._thinInstanceDataStorage.matrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(n),(e=this._thinInstanceDataStorage.matrixBuffer)==null||e.updateDirectly(this._thinInstanceDataStorage.matrixData,0,this._thinInstanceDataStorage.instancesCount)):n==="previousMatrix"?(this.thinInstanceAllowAutomaticStaticBufferRecreation&&this._thinInstanceDataStorage.previousMatrixBuffer&&!this._thinInstanceDataStorage.previousMatrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(n),(t=this._thinInstanceDataStorage.previousMatrixBuffer)==null||t.updateDirectly(this._thinInstanceDataStorage.previousMatrixData,0,this._thinInstanceDataStorage.instancesCount)):(n===S.ColorKind&&(n=S.ColorInstanceKind),(i=this._userThinInstanceBuffersStorage)!=null&&i.vertexBuffers[n]&&(this.thinInstanceAllowAutomaticStaticBufferRecreation&&!this._userThinInstanceBuffersStorage.vertexBuffers[n].isUpdatable()&&this._thinInstanceRecreateBuffer(n),this._userThinInstanceBuffersStorage.vertexBuffers[n].updateDirectly(this._userThinInstanceBuffersStorage.data[n],0)))};O.prototype.thinInstancePartialBufferUpdate=function(n,e,t){var i;n==="matrix"?this._thinInstanceDataStorage.matrixBuffer&&this._thinInstanceDataStorage.matrixBuffer.updateDirectly(e,t):(n===S.ColorKind&&(n=S.ColorInstanceKind),(i=this._userThinInstanceBuffersStorage)!=null&&i.vertexBuffers[n]&&this._userThinInstanceBuffersStorage.vertexBuffers[n].updateDirectly(e,t))};O.prototype.thinInstanceGetWorldMatrices=function(){if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return[];const n=this._thinInstanceDataStorage.matrixData;if(!this._thinInstanceDataStorage.worldMatrices){this._thinInstanceDataStorage.worldMatrices=[];for(let e=0;e<this._thinInstanceDataStorage.instancesCount;++e)this._thinInstanceDataStorage.worldMatrices[e]=L.FromArray(n,e*16)}return this._thinInstanceDataStorage.worldMatrices};O.prototype.thinInstanceRefreshBoundingInfo=function(n=!1,e=!1,t=!1){if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return;const i=this._thinInstanceDataStorage.boundingVectors;if(n||!this.rawBoundingInfo){i.length=0,this.refreshBoundingInfo(e,t);const a=this.getBoundingInfo();this.rawBoundingInfo=new Oi(a.minimum,a.maximum)}const s=this.getBoundingInfo(),r=this._thinInstanceDataStorage.matrixData;if(i.length===0)for(let a=0;a<s.boundingBox.vectors.length;++a)i.push(s.boundingBox.vectors[a].clone());N.Vector3[0].setAll(Number.POSITIVE_INFINITY),N.Vector3[1].setAll(Number.NEGATIVE_INFINITY);for(let a=0;a<this._thinInstanceDataStorage.instancesCount;++a){L.FromArrayToRef(r,a*16,N.Matrix[0]);for(let o=0;o<i.length;++o)y.TransformCoordinatesToRef(i[o],N.Matrix[0],N.Vector3[2]),N.Vector3[0].minimizeInPlace(N.Vector3[2]),N.Vector3[1].maximizeInPlace(N.Vector3[2])}s.reConstruct(N.Vector3[0],N.Vector3[1]),this._updateBoundingInfo()};O.prototype._thinInstanceRecreateBuffer=function(n,e=!0){var t,i,s;n==="matrix"?((t=this._thinInstanceDataStorage.matrixBuffer)==null||t.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",this._thinInstanceDataStorage.matrixData,e)):n==="previousMatrix"?this._scene.needsPreviousWorldMatrices&&((i=this._thinInstanceDataStorage.previousMatrixBuffer)==null||i.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.previousMatrixData??this._thinInstanceDataStorage.matrixData,e)):(n===S.ColorKind&&(n=S.ColorInstanceKind),(s=this._userThinInstanceBuffersStorage.vertexBuffers[n])==null||s.dispose(),this._userThinInstanceBuffersStorage.vertexBuffers[n]=new S(this.getEngine(),this._userThinInstanceBuffersStorage.data[n],n,!e,!1,this._userThinInstanceBuffersStorage.strides[n],!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[n]))};O.prototype._thinInstanceUpdateBufferSize=function(n,e=1){var l,h,u;n===S.ColorKind&&(n=S.ColorInstanceKind);const t=n==="matrix";if(!t&&(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.strides[n]))return;const i=t?16:this._userThinInstanceBuffersStorage.strides[n],s=t?this._thinInstanceDataStorage.matrixBufferSize:this._userThinInstanceBuffersStorage.sizes[n];let r=t?this._thinInstanceDataStorage.matrixData:this._userThinInstanceBuffersStorage.data[n];const a=(this._thinInstanceDataStorage.instancesCount+e)*i;let o=s;for(;o<a;)o*=2;if(!r||s!=o){if(!r)r=new Float32Array(o);else{const c=new Float32Array(o);c.set(r,0),r=c}t?((l=this._thinInstanceDataStorage.matrixBuffer)==null||l.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",r,!1),this._thinInstanceDataStorage.matrixData=r,this._thinInstanceDataStorage.matrixBufferSize=o,this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData&&((h=this._thinInstanceDataStorage.previousMatrixBuffer)==null||h.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",r,!1))):((u=this._userThinInstanceBuffersStorage.vertexBuffers[n])==null||u.dispose(),this._userThinInstanceBuffersStorage.data[n]=r,this._userThinInstanceBuffersStorage.sizes[n]=o,this._userThinInstanceBuffersStorage.vertexBuffers[n]=new S(this.getEngine(),r,n,!0,!1,i,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[n]))}};O.prototype._thinInstanceInitializeUserStorage=function(){this._userThinInstanceBuffersStorage||(this._userThinInstanceBuffersStorage={data:{},sizes:{},vertexBuffers:{},strides:{}})};O.prototype._disposeThinInstanceSpecificData=function(){var n;(n=this._thinInstanceDataStorage)!=null&&n.matrixBuffer&&(this._thinInstanceDataStorage.matrixBuffer.dispose(),this._thinInstanceDataStorage.matrixBuffer=null)};class pi extends qt{_gatherImports(e,t){e?(this._webGPUReady=!0,t.push(Promise.all([De(()=>import("./kernelBlur.fragment-BhqP3nMH.js"),__vite__mapDeps([30,31])),De(()=>import("./kernelBlur.vertex-CYaH3h2O.js"),__vite__mapDeps([32,31]))]))):t.push(Promise.all([De(()=>import("./kernelBlur.fragment-Co0W9BfG.js"),__vite__mapDeps([33,34])),De(()=>import("./kernelBlur.vertex-rUs1cgim.js"),__vite__mapDeps([35,34]))]))}constructor(e,t=null,i,s,r){const a=!!(r!=null&&r.blockCompilation);super({...r,name:e,engine:t||oe.LastCreatedEngine,useShaderStore:!0,useAsPostProcess:!0,fragmentShader:pi.FragmentUrl,uniforms:pi.Uniforms,samplers:pi.Samplers,vertexUrl:pi.VertexUrl,blockCompilation:!0}),this._packedFloat=!1,this._staticDefines="",this.textureWidth=0,this.textureHeight=0,this.options.blockCompilation=a,i!==void 0&&(this.direction=i),s!==void 0&&(this.kernel=s)}set kernel(e){this._idealKernel!==e&&(e=Math.max(e,1),this._idealKernel=e,this._kernel=this._nearestBestKernel(e),this.options.blockCompilation||this._updateParameters())}get kernel(){return this._idealKernel}set packedFloat(e){this._packedFloat!==e&&(this._packedFloat=e,this.options.blockCompilation||this._updateParameters())}get packedFloat(){return this._packedFloat}bind(){super.bind(),this._drawWrapper.effect.setFloat2("delta",1/this.textureWidth*this.direction.x,1/this.textureHeight*this.direction.y)}_updateParameters(e,t){const i=this._kernel,s=(i-1)/2;let r=[],a=[],o=0;for(let g=0;g<i;g++){const m=g/(i-1),v=this._gaussianWeight(m*2-1);r[g]=g-s,a[g]=v,o+=v}for(let g=0;g<a.length;g++)a[g]/=o;const l=[],h=[],u=[];for(let g=0;g<=s;g+=2){const m=Math.min(g+1,Math.floor(s));if(g===m)u.push({o:r[g],w:a[g]});else{const T=m===s,A=a[g]+a[m]*(T?.5:1),b=r[g]+1/(1+a[g]/a[m]);b===0?(u.push({o:r[g],w:a[g]}),u.push({o:r[g+1],w:a[g+1]})):(u.push({o:b,w:A}),u.push({o:-b,w:A}))}}for(let g=0;g<u.length;g++)h[g]=u[g].o,l[g]=u[g].w;r=h,a=l;const c=this.options.engine.getCaps().maxVaryingVectors-(this.options.shaderLanguage===1?1:0),f=Math.max(c,0)-1;let d=Math.min(r.length,f),_="";_+=this._staticDefines,this._staticDefines.indexOf("DOF")!=-1&&(_+=`#define CENTER_WEIGHT ${this._glslFloat(a[d-1])}
`,d--);for(let g=0;g<d;g++)_+=`#define KERNEL_OFFSET${g} ${this._glslFloat(r[g])}
`,_+=`#define KERNEL_WEIGHT${g} ${this._glslFloat(a[g])}
`;let p=0;for(let g=f;g<r.length;g++)_+=`#define KERNEL_DEP_OFFSET${p} ${this._glslFloat(r[g])}
`,_+=`#define KERNEL_DEP_WEIGHT${p} ${this._glslFloat(a[g])}
`,p++;this.packedFloat&&(_+="#define PACKEDFLOAT 1"),this.options.blockCompilation=!1,this.updateEffect(_,null,null,{varyingCount:d,depCount:p},e,t)}_nearestBestKernel(e){const t=Math.round(e);for(const i of[t,t-1,t+1,t-2,t+2])if(i%2!==0&&Math.floor(i/2)%2===0&&i>0)return Math.max(i,3);return Math.max(t,3)}_gaussianWeight(e){const t=.3333333333333333,i=Math.sqrt(2*Math.PI)*t,s=-(e*e/(2*t*t));return 1/i*Math.exp(s)}_glslFloat(e,t=8){return e.toFixed(t).replace(/0+$/,"")}}pi.VertexUrl="kernelBlur";pi.FragmentUrl="kernelBlur";pi.Uniforms=["delta","direction"];pi.Samplers=["circleOfConfusionSampler"];class Jn extends pt{get direction(){return this._effectWrapper.direction}set direction(e){this._effectWrapper.direction=e}set kernel(e){this._effectWrapper.kernel=e}get kernel(){return this._effectWrapper.kernel}set packedFloat(e){this._effectWrapper.packedFloat=e}get packedFloat(){return this._effectWrapper.packedFloat}getClassName(){return"BlurPostProcess"}constructor(e,t,i,s,r=null,a=ie.BILINEAR_SAMPLINGMODE,o,l,h=0,u="",c=!1,f=5){const d=typeof s=="number"?c:!!s.blockCompilation,_={uniforms:pi.Uniforms,samplers:pi.Samplers,size:typeof s=="number"?s:void 0,camera:r,samplingMode:a,engine:o,reusable:l,textureType:h,vertexUrl:pi.VertexUrl,indexParameters:{varyingCount:0,depCount:0},textureFormat:f,defines:u,...s,blockCompilation:!0};super(e,pi.FragmentUrl,{effectWrapper:typeof s=="number"||!s.effectWrapper?new pi(e,o,void 0,void 0,_):void 0,..._}),this._effectWrapper.options.blockCompilation=d,this.direction=t,this.onApplyObservable.add(()=>{this._effectWrapper.textureWidth=this._outputTexture?this._outputTexture.width:this.width,this._effectWrapper.textureHeight=this._outputTexture?this._outputTexture.height:this.height}),this.kernel=i}updateEffect(e=null,t=null,i=null,s,r,a){this._effectWrapper._updateParameters(r,a)}static _Parse(e,t,i,s){return Ie.Parse(()=>new Jn(e.name,e.direction,e.kernel,e.options,t,e.renderTargetSamplingMode,i.getEngine(),e.reusable,e.textureType,void 0,!1),e,i,s)}}P([mv()],Jn.prototype,"direction",null);P([B()],Jn.prototype,"kernel",null);P([B()],Jn.prototype,"packedFloat",null);Tt("BABYLON.BlurPostProcess",Jn);class Ys extends qt{constructor(e,t=null,i,s,r){super({...r,name:e,engine:t||oe.LastCreatedEngine,useShaderStore:!0,useAsPostProcess:!0,fragmentShader:Ys.FragmentUrl,uniforms:Ys.Uniforms}),this.direction=i,this.kernel=s,this.textureWidth=0,this.textureHeight=0}_gatherImports(e,t){e?(this._webGPUReady=!0,t.push(De(()=>import("./glowBlurPostProcess.fragment-C3IOJefW.js"),[]))):t.push(De(()=>import("./glowBlurPostProcess.fragment-oP8oMz3n.js"),[])),super._gatherImports(e,t)}bind(){super.bind(),this._drawWrapper.effect.setFloat2("screenSize",this.textureWidth,this.textureHeight),this._drawWrapper.effect.setVector2("direction",this.direction),this._drawWrapper.effect.setFloat("blurWidth",this.kernel)}}Ys.FragmentUrl="glowBlurPostProcess";Ys.Uniforms=["screenSize","direction","blurWidth"];class Rr{get camera(){return this._options.camera}set camera(e){this._options.camera=e}get renderingGroupId(){return this._options.renderingGroupId}set renderingGroupId(e){this._options.renderingGroupId=e}get objectRenderer(){return this._objectRenderer}get shaderLanguage(){return this._shaderLanguage}setMaterialForRendering(e,t){if(this._objectRenderer.setMaterialForRendering(e,t),Array.isArray(e))for(let i=0;i<e.length;++i){const s=e[i];t?this._materialForRendering[s.uniqueId]=[s,t]:delete this._materialForRendering[s.uniqueId]}else t?this._materialForRendering[e.uniqueId]=[e,t]:delete this._materialForRendering[e.uniqueId]}getEffectIntensity(e){return this._effectIntensity[e.uniqueId]??1}setEffectIntensity(e,t){this._effectIntensity[e.uniqueId]=t}constructor(e,t,i=!1,s=!1,r){this._additionalImportShadersAsync=r,this._vertexBuffers={},this._dontCheckIfReady=!1,this._shouldRender=!0,this._emissiveTextureAndColor={texture:null,color:new K},this._effectIntensity={},this._postProcesses=[],this.neutralColor=new K,this.isEnabled=!0,this.disableBoundingBoxesFromEffectLayer=!1,this.onDisposeObservable=new q,this.onBeforeRenderLayerObservable=new q,this.onBeforeComposeObservable=new q,this.onBeforeRenderMeshToEffect=new q,this.onAfterRenderMeshToEffect=new q,this.onAfterComposeObservable=new q,this.onBeforeBlurObservable=new q,this.onAfterBlurObservable=new q,this._shaderLanguage=0,this._materialForRendering={},this._shadersLoaded=!1,this.name=e,this._scene=t||Ae.LastCreatedScene,this._dontCheckIfReady=s,this._scene.getEngine().isWebGPU&&!i&&!Rr.ForceGLSL&&(this._shaderLanguage=1),this._engine=this._scene.getEngine(),this._mergeDrawWrapper=[],this._generateIndexBuffer(),this._generateVertexBuffer()}getEffectName(){return""}isReady(e,t){return!0}needStencil(){return!1}_createMergeEffect(){throw new Error("Effect Layer: no merge effect defined")}_createTextureAndPostProcesses(){}_internalCompose(e,t){}_setEmissiveTextureAndColor(e,t,i){}_numInternalDraws(){return 1}_init(e){this._options={mainTextureRatio:.5,mainTextureFixedSize:0,mainTextureType:0,alphaBlendingMode:2,camera:null,renderingGroupId:-1,...e},this._createObjectRenderer()}_generateIndexBuffer(){const e=[];e.push(0),e.push(1),e.push(2),e.push(0),e.push(2),e.push(3),this._indexBuffer=this._engine.createIndexBuffer(e)}_generateVertexBuffer(){const e=[];e.push(1,1),e.push(-1,1),e.push(-1,-1),e.push(1,-1);const t=new S(this._engine,e,S.PositionKind,!1,!1,2);this._vertexBuffers[S.PositionKind]=t}_createObjectRenderer(){this._objectRenderer=new os(`ObjectRenderer for thin effect layer ${this.name}`,this._scene,{doNotChangeAspectRatio:!0}),this._objectRenderer.activeCamera=this._options.camera,this._objectRenderer.renderParticles=!1,this._objectRenderer.renderList=null;const e=!!this._scene.getBoundingBoxRenderer;let t=!1;e&&(this._objectRenderer.onBeforeRenderObservable.add(()=>{t=this._scene.getBoundingBoxRenderer().enabled,this._scene.getBoundingBoxRenderer().enabled=!this.disableBoundingBoxesFromEffectLayer&&t}),this._objectRenderer.onAfterRenderObservable.add(()=>{this._scene.getBoundingBoxRenderer().enabled=t})),this._objectRenderer.customIsReadyFunction=(i,s,r)=>{if((r||s===0)&&i.subMeshes)for(let a=0;a<i.subMeshes.length;++a){const o=i.subMeshes[a],l=o.getMaterial(),h=o.getRenderingMesh();if(!l)continue;const c=h._getInstancesRenderList(o._id,!!o.getReplacementMesh()).hardwareInstancedRendering[o._id]||h.hasThinInstances;if(this._setEmissiveTextureAndColor(h,o,l),!this._isSubMeshReady(o,c,this._emissiveTextureAndColor.texture))return!1}return!0},this._objectRenderer.customRenderFunction=(i,s,r,a)=>{this.onBeforeRenderLayerObservable.notifyObservers(this);let o;const l=this._scene.getEngine();if(a.length){for(l.setColorWrite(!1),o=0;o<a.length;o++)this._renderSubMesh(a.data[o]);l.setColorWrite(!0)}for(o=0;o<i.length;o++)this._renderSubMesh(i.data[o]);for(o=0;o<s.length;o++)this._renderSubMesh(s.data[o]);const h=l.getAlphaMode();for(o=0;o<r.length;o++){const u=r.data[o],c=u.getMaterial();if(c&&c.needDepthPrePass){const f=c.getScene().getEngine();f.setColorWrite(!1),this._renderSubMesh(u),f.setColorWrite(!0)}this._renderSubMesh(u,!0)}l.setAlphaMode(h)}}_addCustomEffectDefines(e){}_internalIsSubMeshReady(e,t,i){var T;const s=this._scene.getEngine(),r=e.getMesh(),a=(T=r._internalAbstractMeshDataInfo._materialForRenderPass)==null?void 0:T[s.currentRenderPassId];if(a)return a.isReadyForSubMesh(r,e,t);const o=e.getMaterial();if(!o)return!1;if(this._useMeshMaterial(e.getRenderingMesh()))return o.isReadyForSubMesh(e.getMesh(),e,t);const l=[],h=[S.PositionKind];let u=!1,c=!1;const f=!1;if(o){const A=o.needAlphaTestingForMesh(r),b=o.getAlphaTestTexture(),x=b&&b.hasAlpha&&(o.useAlphaFromDiffuseTexture||o._useAlphaFromAlbedoTexture);b&&(A||x)&&(l.push("#define DIFFUSE"),r.isVerticesDataPresent(S.UV2Kind)&&b.coordinatesIndex===1?(l.push("#define DIFFUSEUV2"),c=!0):r.isVerticesDataPresent(S.UVKind)&&(l.push("#define DIFFUSEUV1"),u=!0),A&&(l.push("#define ALPHATEST"),l.push("#define ALPHATESTVALUE 0.4")),b.gammaSpace||l.push("#define DIFFUSE_ISLINEAR"));const E=o.opacityTexture;E&&(l.push("#define OPACITY"),r.isVerticesDataPresent(S.UV2Kind)&&E.coordinatesIndex===1?(l.push("#define OPACITYUV2"),c=!0):r.isVerticesDataPresent(S.UVKind)&&(l.push("#define OPACITYUV1"),u=!0))}i&&(l.push("#define EMISSIVE"),r.isVerticesDataPresent(S.UV2Kind)&&i.coordinatesIndex===1?(l.push("#define EMISSIVEUV2"),c=!0):r.isVerticesDataPresent(S.UVKind)&&(l.push("#define EMISSIVEUV1"),u=!0),i.gammaSpace||l.push("#define EMISSIVE_ISLINEAR")),r.useVertexColors&&r.isVerticesDataPresent(S.ColorKind)&&r.hasVertexAlpha&&o.transparencyMode!==Y.MATERIAL_OPAQUE&&(h.push(S.ColorKind),l.push("#define VERTEXALPHA")),u&&(h.push(S.UVKind),l.push("#define UV1")),c&&(h.push(S.UV2Kind),l.push("#define UV2"));const d=new Pd;if(r.useBones&&r.computeBonesUsingShaders){h.push(S.MatricesIndicesKind),h.push(S.MatricesWeightsKind),r.numBoneInfluencers>4&&(h.push(S.MatricesIndicesExtraKind),h.push(S.MatricesWeightsExtraKind)),l.push("#define NUM_BONE_INFLUENCERS "+r.numBoneInfluencers);const A=r.skeleton;A&&A.isUsingTextureForMatrices?l.push("#define BONETEXTURE"):l.push("#define BonesPerMesh "+(A?A.bones.length+1:0)),r.numBoneInfluencers>0&&d.addCPUSkinningFallback(0,r)}else l.push("#define NUM_BONE_INFLUENCERS 0");const _=r.morphTargetManager?Kv(r.morphTargetManager,l,h,r,!0,!1,!1,u,c,f):0;t&&(l.push("#define INSTANCES"),Rd(h),e.getRenderingMesh().hasThinInstances&&l.push("#define THIN_INSTANCES")),Hv(o,this._scene,l),this._addCustomEffectDefines(l);const p=e._getDrawWrapper(void 0,!0),g=p.defines,m=l.join(`
`);if(g!==m){const A=["world","mBones","viewProjection","glowColor","morphTargetInfluences","morphTargetCount","boneTextureWidth","diffuseMatrix","emissiveMatrix","opacityMatrix","opacityIntensity","morphTargetTextureInfo","morphTargetTextureIndices","glowIntensity"];Ah(A),p.setEffect(this._engine.createEffect("glowMapGeneration",h,A,["diffuseSampler","emissiveSampler","opacitySampler","boneSampler","morphTargets"],m,d,void 0,void 0,{maxSimultaneousMorphTargets:_},this._shaderLanguage,this._shadersLoaded?void 0:async()=>{await this._importShadersAsync(),this._shadersLoaded=!0}),m)}return p.effect.isReady()&&(this._dontCheckIfReady||!this._dontCheckIfReady&&this.isLayerReady())}_isSubMeshReady(e,t,i){return this._internalIsSubMeshReady(e,t,i)}async _importShadersAsync(){var e;this._shaderLanguage===1?await Promise.all([De(()=>import("./glowMapGeneration.vertex-CkMxMiUB.js"),__vite__mapDeps([36,6,9,7])),De(()=>import("./glowMapGeneration.fragment-BRebCg6z.js"),__vite__mapDeps([37,13]))]):await Promise.all([De(()=>import("./glowMapGeneration.vertex-00l4OXPB.js"),__vite__mapDeps([38,20,21])),De(()=>import("./glowMapGeneration.fragment-DJZRbsyI.js"),__vite__mapDeps([39,19]))]),(e=this._additionalImportShadersAsync)==null||e.call(this)}_internalIsLayerReady(){let e=!0;for(let i=0;i<this._postProcesses.length;i++)e=this._postProcesses[i].isReady()&&e;const t=this._numInternalDraws();for(let i=0;i<t;++i){let s=this._mergeDrawWrapper[i];s||(s=this._mergeDrawWrapper[i]=new o0(this._engine),s.setEffect(this._createMergeEffect())),e=s.effect.isReady()&&e}return e}isLayerReady(){return this._internalIsLayerReady()}compose(){if(!this._dontCheckIfReady&&!this.isLayerReady())return!1;const e=this._scene.getEngine(),t=this._numInternalDraws();this.onBeforeComposeObservable.notifyObservers(this);const i=e.getAlphaMode();for(let s=0;s<t;++s){const r=this._mergeDrawWrapper[s];e.enableEffect(r),e.setState(!1),e.bindBuffers(this._vertexBuffers,this._indexBuffer,r.effect),e.setAlphaMode(this._options.alphaBlendingMode),this._internalCompose(r.effect,s)}return e.setAlphaMode(i),this.onAfterComposeObservable.notifyObservers(this),!0}_internalHasMesh(e){return this.renderingGroupId===-1||e.renderingGroupId===this.renderingGroupId}hasMesh(e){return this._internalHasMesh(e)}_internalShouldRender(){return this.isEnabled&&this._shouldRender}shouldRender(){return this._internalShouldRender()}_shouldRenderMesh(e){return!0}_internalCanRenderMesh(e,t){return!t.needAlphaBlendingForMesh(e)}_canRenderMesh(e,t){return this._internalCanRenderMesh(e,t)}_renderSubMesh(e,t=!1){var p;if(!this._internalShouldRender())return;const i=e.getMaterial(),s=e.getMesh(),r=e.getReplacementMesh(),a=e.getRenderingMesh(),o=e.getEffectiveMesh(),l=this._scene,h=l.getEngine();if(o._internalAbstractMeshDataInfo._isActiveIntermediate=!1,!i||!this._canRenderMesh(a,i))return;let u=i._getEffectiveOrientation(a);o._getWorldMatrixDeterminant()<0&&(u=u===Y.ClockWiseSideOrientation?Y.CounterClockWiseSideOrientation:Y.ClockWiseSideOrientation);const f=u===Y.ClockWiseSideOrientation;h.setState(i.backFaceCulling,i.zOffset,void 0,f,i.cullBackFaces,void 0,i.zOffsetUnits);const d=a._getInstancesRenderList(e._id,!!r);if(d.mustReturn||!this._shouldRenderMesh(a))return;const _=d.hardwareInstancedRendering[e._id]||a.hasThinInstances;if(this._setEmissiveTextureAndColor(a,e,i),this.onBeforeRenderMeshToEffect.notifyObservers(s),this._useMeshMaterial(a))e.getMaterial()._glowModeEnabled=!0,a.render(e,t,r||void 0),e.getMaterial()._glowModeEnabled=!1;else if(this._isSubMeshReady(e,_,this._emissiveTextureAndColor.texture)){const g=(p=o._internalAbstractMeshDataInfo._materialForRenderPass)==null?void 0:p[h.currentRenderPassId];let m=e._getDrawWrapper();if(!m&&g&&(m=g._getDrawWrapper()),!m)return;const v=m.effect;if(h.enableEffect(m),_||a._bind(e,v,i.fillMode),g?g.bindForSubMesh(o.getWorldMatrix(),o,e):(v.setMatrix("viewProjection",l.getTransformMatrix()),v.setMatrix("world",o.getWorldMatrix()),v.setFloat4("glowColor",this._emissiveTextureAndColor.color.r,this._emissiveTextureAndColor.color.g,this._emissiveTextureAndColor.color.b,this._emissiveTextureAndColor.color.a)),!g){const T=i.needAlphaTestingForMesh(o),A=i.getAlphaTestTexture(),b=A&&A.hasAlpha&&(i.useAlphaFromDiffuseTexture||i._useAlphaFromAlbedoTexture);if(A&&(T||b)){v.setTexture("diffuseSampler",A);const E=A.getTextureMatrix();E&&v.setMatrix("diffuseMatrix",E)}const x=i.opacityTexture;if(x){v.setTexture("opacitySampler",x),v.setFloat("opacityIntensity",x.level);const E=x.getTextureMatrix();E&&v.setMatrix("opacityMatrix",E)}if(this._emissiveTextureAndColor.texture&&(v.setTexture("emissiveSampler",this._emissiveTextureAndColor.texture),v.setMatrix("emissiveMatrix",this._emissiveTextureAndColor.texture.getTextureMatrix())),a.useBones&&a.computeBonesUsingShaders&&a.skeleton){const E=a.skeleton;if(E.isUsingTextureForMatrices){const R=E.getTransformMatrixTexture(a);if(!R)return;v.setTexture("boneSampler",R),v.setFloat("boneTextureWidth",4*(E.bones.length+1))}else v.setMatrices("mBones",E.getTransformMatrices(a))}Id(a,v),a.morphTargetManager&&a.morphTargetManager.isUsingTextureForTargets&&a.morphTargetManager._bind(v),t&&h.setAlphaMode(i.alphaMode),v.setFloat("glowIntensity",this.getEffectIntensity(a)),Eh(v,i,l)}a._processRendering(o,e,v,i.fillMode,d,_,(T,A)=>v.setMatrix("world",A))}else this._objectRenderer.resetRefreshCounter();this.onAfterRenderMeshToEffect.notifyObservers(s)}_useMeshMaterial(e){return!1}_rebuild(){const e=this._vertexBuffers[S.PositionKind];e&&e._rebuild(),this._generateIndexBuffer()}dispose(){const e=this._vertexBuffers[S.PositionKind];e&&(e.dispose(),this._vertexBuffers[S.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null);for(const t of this._mergeDrawWrapper)t.dispose();this._mergeDrawWrapper=[],this._objectRenderer.dispose(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onBeforeRenderLayerObservable.clear(),this.onBeforeComposeObservable.clear(),this.onBeforeRenderMeshToEffect.clear(),this.onAfterRenderMeshToEffect.clear(),this.onAfterComposeObservable.clear()}}Rr.ForceGLSL=!1;class qs{get _shouldRender(){return this._thinEffectLayer._shouldRender}set _shouldRender(e){this._thinEffectLayer._shouldRender=e}get _emissiveTextureAndColor(){return this._thinEffectLayer._emissiveTextureAndColor}set _emissiveTextureAndColor(e){this._thinEffectLayer._emissiveTextureAndColor=e}get _effectIntensity(){return this._thinEffectLayer._effectIntensity}set _effectIntensity(e){this._thinEffectLayer._effectIntensity=e}static get ForceGLSL(){return Rr.ForceGLSL}static set ForceGLSL(e){Rr.ForceGLSL=e}get name(){return this._thinEffectLayer.name}set name(e){this._thinEffectLayer.name=e}get neutralColor(){return this._thinEffectLayer.neutralColor}set neutralColor(e){this._thinEffectLayer.neutralColor=e}get isEnabled(){return this._thinEffectLayer.isEnabled}set isEnabled(e){this._thinEffectLayer.isEnabled=e}get camera(){return this._thinEffectLayer.camera}get renderingGroupId(){return this._thinEffectLayer.renderingGroupId}set renderingGroupId(e){this._thinEffectLayer.renderingGroupId=e}get disableBoundingBoxesFromEffectLayer(){return this._thinEffectLayer.disableBoundingBoxesFromEffectLayer}set disableBoundingBoxesFromEffectLayer(e){this._thinEffectLayer.disableBoundingBoxesFromEffectLayer=e}get mainTexture(){return this._mainTexture}get _shaderLanguage(){return this._thinEffectLayer.shaderLanguage}get shaderLanguage(){return this._thinEffectLayer.shaderLanguage}setMaterialForRendering(e,t){this._thinEffectLayer.setMaterialForRendering(e,t)}getEffectIntensity(e){return this._thinEffectLayer.getEffectIntensity(e)}setEffectIntensity(e,t){this._thinEffectLayer.setEffectIntensity(e,t)}constructor(e,t,i=!1,s){this._maxSize=0,this._mainTextureDesiredSize={width:0,height:0},this._postProcesses=[],this._textures=[],this.onDisposeObservable=new q,this.onBeforeRenderMainTextureObservable=new q,this.onBeforeComposeObservable=new q,this.onBeforeRenderMeshToEffect=new q,this.onAfterRenderMeshToEffect=new q,this.onAfterComposeObservable=new q,this.onSizeChangedObservable=new q,this._internalThinEffectLayer=!s,s||(s=new Rr(e,t,i,!1,this._importShadersAsync.bind(this)),s.getEffectName=this.getEffectName.bind(this),s.isReady=this.isReady.bind(this),s._createMergeEffect=this._createMergeEffect.bind(this),s._createTextureAndPostProcesses=this._createTextureAndPostProcesses.bind(this),s._internalCompose=this._internalRender.bind(this),s._setEmissiveTextureAndColor=this._setEmissiveTextureAndColor.bind(this),s._numInternalDraws=this._numInternalDraws.bind(this),s._addCustomEffectDefines=this._addCustomEffectDefines.bind(this),s.hasMesh=this.hasMesh.bind(this),s.shouldRender=this.shouldRender.bind(this),s._shouldRenderMesh=this._shouldRenderMesh.bind(this),s._canRenderMesh=this._canRenderMesh.bind(this),s._useMeshMaterial=this._useMeshMaterial.bind(this)),this._thinEffectLayer=s,this.name=e,this._scene=t||Ae.LastCreatedScene,qs._SceneComponentInitialization(this._scene),this._engine=this._scene.getEngine(),this._maxSize=this._engine.getCaps().maxTextureSize,this._scene.effectLayers.push(this),this._thinEffectLayer.onDisposeObservable.add(()=>{this.onDisposeObservable.notifyObservers(this)}),this._thinEffectLayer.onBeforeRenderLayerObservable.add(()=>{this.onBeforeRenderMainTextureObservable.notifyObservers(this)}),this._thinEffectLayer.onBeforeComposeObservable.add(()=>{this.onBeforeComposeObservable.notifyObservers(this)}),this._thinEffectLayer.onBeforeRenderMeshToEffect.add(r=>{this.onBeforeRenderMeshToEffect.notifyObservers(r)}),this._thinEffectLayer.onAfterRenderMeshToEffect.add(r=>{this.onAfterRenderMeshToEffect.notifyObservers(r)}),this._thinEffectLayer.onAfterComposeObservable.add(()=>{this.onAfterComposeObservable.notifyObservers(this)})}get _shadersLoaded(){return this._thinEffectLayer._shadersLoaded}set _shadersLoaded(e){this._thinEffectLayer._shadersLoaded=e}_numInternalDraws(){return this._internalThinEffectLayer?1:this._thinEffectLayer._numInternalDraws()}_init(e){this._effectLayerOptions={mainTextureRatio:.5,alphaBlendingMode:2,camera:null,renderingGroupId:-1,mainTextureType:0,generateStencilBuffer:!1,...e},this._setMainTextureSize(),this._thinEffectLayer._init(e),this._createMainTexture(),this._createTextureAndPostProcesses()}_setMainTextureSize(){this._effectLayerOptions.mainTextureFixedSize?(this._mainTextureDesiredSize.width=this._effectLayerOptions.mainTextureFixedSize,this._mainTextureDesiredSize.height=this._effectLayerOptions.mainTextureFixedSize):(this._mainTextureDesiredSize.width=this._engine.getRenderWidth()*this._effectLayerOptions.mainTextureRatio,this._mainTextureDesiredSize.height=this._engine.getRenderHeight()*this._effectLayerOptions.mainTextureRatio,this._mainTextureDesiredSize.width=this._engine.needPOTTextures?Yi(this._mainTextureDesiredSize.width,this._maxSize):this._mainTextureDesiredSize.width,this._mainTextureDesiredSize.height=this._engine.needPOTTextures?Yi(this._mainTextureDesiredSize.height,this._maxSize):this._mainTextureDesiredSize.height),this._mainTextureDesiredSize.width=Math.floor(this._mainTextureDesiredSize.width),this._mainTextureDesiredSize.height=Math.floor(this._mainTextureDesiredSize.height)}_createMainTexture(){this._mainTexture=new Rn("EffectLayerMainRTT",{width:this._mainTextureDesiredSize.width,height:this._mainTextureDesiredSize.height},this._scene,{type:this._effectLayerOptions.mainTextureType,samplingMode:ie.TRILINEAR_SAMPLINGMODE,generateStencilBuffer:this._effectLayerOptions.generateStencilBuffer,existingObjectRenderer:this._thinEffectLayer.objectRenderer}),this._mainTexture.activeCamera=this._effectLayerOptions.camera,this._mainTexture.wrapU=ie.CLAMP_ADDRESSMODE,this._mainTexture.wrapV=ie.CLAMP_ADDRESSMODE,this._mainTexture.anisotropicFilteringLevel=1,this._mainTexture.updateSamplingMode(ie.BILINEAR_SAMPLINGMODE),this._mainTexture.renderParticles=!1,this._mainTexture.renderList=null,this._mainTexture.ignoreCameraViewport=!0,this._mainTexture.onClearObservable.add(e=>{e.clear(this.neutralColor,!0,!0,!0)})}_addCustomEffectDefines(e){}_isReady(e,t,i){return this._internalThinEffectLayer?this._thinEffectLayer._internalIsSubMeshReady(e,t,i):this._thinEffectLayer._isSubMeshReady(e,t,i)}async _importShadersAsync(){}_arePostProcessAndMergeReady(){return this._internalThinEffectLayer?this._thinEffectLayer._internalIsLayerReady():this._thinEffectLayer.isLayerReady()}isLayerReady(){return this._arePostProcessAndMergeReady()&&this._mainTexture.isReady()}render(){if(!this._thinEffectLayer.compose())return;const e=this._mainTexture.getSize();this._setMainTextureSize(),(e.width!==this._mainTextureDesiredSize.width||e.height!==this._mainTextureDesiredSize.height)&&this._mainTextureDesiredSize.width!==0&&this._mainTextureDesiredSize.height!==0&&(this.onSizeChangedObservable.notifyObservers(this),this._disposeTextureAndPostProcesses(),this._createMainTexture(),this._createTextureAndPostProcesses())}hasMesh(e){return this._internalThinEffectLayer?this._thinEffectLayer._internalHasMesh(e):this._thinEffectLayer.hasMesh(e)}shouldRender(){return this._internalThinEffectLayer?this._thinEffectLayer._internalShouldRender():this._thinEffectLayer.shouldRender()}_shouldRenderMesh(e){return this._internalThinEffectLayer?!0:this._thinEffectLayer._shouldRenderMesh(e)}_canRenderMesh(e,t){return this._internalThinEffectLayer?this._thinEffectLayer._internalCanRenderMesh(e,t):this._thinEffectLayer._canRenderMesh(e,t)}_shouldRenderEmissiveTextureForMesh(){return!0}_useMeshMaterial(e){return this._internalThinEffectLayer?!1:this._thinEffectLayer._useMeshMaterial(e)}_rebuild(){this._thinEffectLayer._rebuild()}_disposeTextureAndPostProcesses(){this._mainTexture.dispose();for(let e=0;e<this._postProcesses.length;e++)this._postProcesses[e]&&this._postProcesses[e].dispose();this._postProcesses=[];for(let e=0;e<this._textures.length;e++)this._textures[e]&&this._textures[e].dispose();this._textures=[]}dispose(){this._thinEffectLayer.dispose(),this._disposeTextureAndPostProcesses();const e=this._scene.effectLayers.indexOf(this,0);e>-1&&this._scene.effectLayers.splice(e,1),this.onDisposeObservable.clear(),this.onBeforeRenderMainTextureObservable.clear(),this.onBeforeComposeObservable.clear(),this.onBeforeRenderMeshToEffect.clear(),this.onAfterRenderMeshToEffect.clear(),this.onAfterComposeObservable.clear(),this.onSizeChangedObservable.clear()}getClassName(){return"EffectLayer"}static Parse(e,t,i){return Z.Instantiate(e.customType).Parse(e,t,i)}}qs._SceneComponentInitialization=n=>{throw Ee("EffectLayerSceneComponent")};P([B()],qs.prototype,"name",null);P([sd()],qs.prototype,"neutralColor",null);P([B()],qs.prototype,"isEnabled",null);P([T4()],qs.prototype,"camera",null);P([B()],qs.prototype,"renderingGroupId",null);P([B()],qs.prototype,"disableBoundingBoxesFromEffectLayer",null);class ns extends Rr{set blurHorizontalSize(e){this._horizontalBlurPostprocess.kernel=e,this._options.blurHorizontalSize=e}set blurVerticalSize(e){this._verticalBlurPostprocess.kernel=e,this._options.blurVerticalSize=e}get blurHorizontalSize(){return this._horizontalBlurPostprocess.kernel}get blurVerticalSize(){return this._verticalBlurPostprocess.kernel}constructor(e,t,i,s=!1){super(e,t,i!==void 0?!!i.forceGLSL:!1),this.innerGlow=!0,this.outerGlow=!0,this._instanceGlowingMeshStencilReference=ns.GlowingMeshStencilReference++,this._meshes={},this._excludedMeshes={},this._mainObjectRendererRenderPassId=-1,this.neutralColor=ns.NeutralColor,this._options={mainTextureRatio:.5,blurTextureSizeRatio:.5,mainTextureFixedSize:0,blurHorizontalSize:1,blurVerticalSize:1,alphaBlendingMode:2,camera:null,renderingGroupId:-1,forceGLSL:!1,mainTextureType:0,isStroke:!1,...i},this._init(this._options),this._shouldRender=!1,s&&this._createTextureAndPostProcesses()}getClassName(){return"HighlightLayer"}async _importShadersAsync(){this._shaderLanguage===1?await Promise.all([De(()=>import("./glowMapMerge.fragment-DZvu9jkB.js"),[]),De(()=>import("./glowMapMerge.vertex-DN8Wkz4x.js"),[]),De(()=>import("./glowBlurPostProcess.fragment-C3IOJefW.js"),[])]):await Promise.all([De(()=>import("./glowMapMerge.fragment-C8DQCog8.js"),[]),De(()=>import("./glowMapMerge.vertex-De-rBjnO.js"),[]),De(()=>import("./glowBlurPostProcess.fragment-oP8oMz3n.js"),[])]),await super._importShadersAsync()}getEffectName(){return ns.EffectName}_numInternalDraws(){return 2}_createMergeEffect(){return this._engine.createEffect("glowMapMerge",[S.PositionKind],["offset"],["textureSampler"],this._options.isStroke?`#define STROKE 
`:void 0,void 0,void 0,void 0,void 0,this._shaderLanguage,this._shadersLoaded?void 0:async()=>{await this._importShadersAsync(),this._shadersLoaded=!0})}_createTextureAndPostProcesses(){this._options.alphaBlendingMode===2?(this._downSamplePostprocess=new Dr("HighlightLayerPPP",this._scene.getEngine()),this._horizontalBlurPostprocess=new Ys("HighlightLayerHBP",this._scene.getEngine(),new ne(1,0),this._options.blurHorizontalSize),this._verticalBlurPostprocess=new Ys("HighlightLayerVBP",this._scene.getEngine(),new ne(0,1),this._options.blurVerticalSize),this._postProcesses=[this._downSamplePostprocess,this._horizontalBlurPostprocess,this._verticalBlurPostprocess]):(this._horizontalBlurPostprocess=new pi("HighlightLayerHBP",this._scene.getEngine(),new ne(1,0),this._options.blurHorizontalSize/2),this._verticalBlurPostprocess=new pi("HighlightLayerVBP",this._scene.getEngine(),new ne(0,1),this._options.blurVerticalSize/2),this._postProcesses=[this._horizontalBlurPostprocess,this._verticalBlurPostprocess])}needStencil(){return!0}isReady(e,t){const i=e.getMaterial(),s=e.getRenderingMesh();if(!i||!s||!this._meshes)return!1;let r=null;const a=this._meshes[s.uniqueId];return a&&a.glowEmissiveOnly&&i&&(r=i.emissiveTexture),super._isSubMeshReady(e,t,r)}_canRenderMesh(e,t){return!0}_internalCompose(e,t){this.bindTexturesForCompose(e);const i=this._engine;i.cacheStencilState(),i.setStencilOperationPass(7681),i.setStencilOperationFail(7680),i.setStencilOperationDepthFail(7680),i.setStencilMask(0),i.setStencilBuffer(!0),i.setStencilFunctionReference(this._instanceGlowingMeshStencilReference),this.outerGlow&&t===0&&(e.setFloat("offset",0),i.setStencilFunction(517),i.drawElementsType(Y.TriangleFillMode,0,6)),this.innerGlow&&t===1&&(e.setFloat("offset",1),i.setStencilFunction(514),i.drawElementsType(Y.TriangleFillMode,0,6)),i.restoreStencilState()}_setEmissiveTextureAndColor(e,t,i){const s=this._meshes[e.uniqueId];s?this._emissiveTextureAndColor.color.set(s.color.r,s.color.g,s.color.b,1):this._emissiveTextureAndColor.color.set(this.neutralColor.r,this.neutralColor.g,this.neutralColor.b,this.neutralColor.a),s&&s.glowEmissiveOnly&&i?(this._emissiveTextureAndColor.texture=i.emissiveTexture,this._emissiveTextureAndColor.color.set(1,1,1,1)):this._emissiveTextureAndColor.texture=null}shouldRender(){return!!(this._meshes&&super.shouldRender())}_shouldRenderMesh(e){return this._excludedMeshes&&this._excludedMeshes[e.uniqueId]?!1:super.hasMesh(e)}_addCustomEffectDefines(e){e.push("#define HIGHLIGHT")}addExcludedMesh(e){if(!this._excludedMeshes)return;if(!this._excludedMeshes[e.uniqueId]){const i={mesh:e,beforeBind:null,afterRender:null,stencilState:!1};i.beforeBind=e.onBeforeBindObservable.add(s=>{this._mainObjectRendererRenderPassId!==-1&&this._mainObjectRendererRenderPassId!==this._engine.currentRenderPassId||(i.stencilState=s.getEngine().getStencilBuffer(),s.getEngine().setStencilBuffer(!1))}),i.afterRender=e.onAfterRenderObservable.add(s=>{this._mainObjectRendererRenderPassId!==-1&&this._mainObjectRendererRenderPassId!==this._engine.currentRenderPassId||s.getEngine().setStencilBuffer(i.stencilState)}),this._excludedMeshes[e.uniqueId]=i}}removeExcludedMesh(e){if(!this._excludedMeshes)return;const t=this._excludedMeshes[e.uniqueId];t&&(t.beforeBind&&e.onBeforeBindObservable.remove(t.beforeBind),t.afterRender&&e.onAfterRenderObservable.remove(t.afterRender)),this._excludedMeshes[e.uniqueId]=null}hasMesh(e){return!this._meshes||!super.hasMesh(e)?!1:!!this._meshes[e.uniqueId]}addMesh(e,t,i=!1){if(!this._meshes)return;const s=this._meshes[e.uniqueId];s?s.color=t:(this._meshes[e.uniqueId]={mesh:e,color:t,observerHighlight:e.onBeforeBindObservable.add(r=>{this._mainObjectRendererRenderPassId!==-1&&this._mainObjectRendererRenderPassId!==this._engine.currentRenderPassId||this.isEnabled&&(this._excludedMeshes&&this._excludedMeshes[r.uniqueId]?this._defaultStencilReference(r):r.getScene().getEngine().setStencilFunctionReference(this._instanceGlowingMeshStencilReference))}),observerDefault:e.onAfterRenderObservable.add(r=>{this._mainObjectRendererRenderPassId!==-1&&this._mainObjectRendererRenderPassId!==this._engine.currentRenderPassId||this.isEnabled&&this._defaultStencilReference(r)}),glowEmissiveOnly:i},e.onDisposeObservable.add(()=>{this._disposeMesh(e)})),this._shouldRender=!0}removeMesh(e){if(!this._meshes)return;const t=this._meshes[e.uniqueId];t&&(t.observerHighlight&&e.onBeforeBindObservable.remove(t.observerHighlight),t.observerDefault&&e.onAfterRenderObservable.remove(t.observerDefault),delete this._meshes[e.uniqueId]),this._shouldRender=!1;for(const i in this._meshes)if(this._meshes[i]){this._shouldRender=!0;break}}removeAllMeshes(){if(this._meshes){for(const e in this._meshes)if(Object.prototype.hasOwnProperty.call(this._meshes,e)){const t=this._meshes[e];t&&this.removeMesh(t.mesh)}}}_defaultStencilReference(e){e.getScene().getEngine().setStencilFunctionReference(ns.NormalMeshStencilReference)}_disposeMesh(e){this.removeMesh(e),this.removeExcludedMesh(e)}dispose(){if(this._meshes){for(const e in this._meshes){const t=this._meshes[e];t&&t.mesh&&(t.observerHighlight&&t.mesh.onBeforeBindObservable.remove(t.observerHighlight),t.observerDefault&&t.mesh.onAfterRenderObservable.remove(t.observerDefault))}this._meshes=null}if(this._excludedMeshes){for(const e in this._excludedMeshes){const t=this._excludedMeshes[e];t&&(t.beforeBind&&t.mesh.onBeforeBindObservable.remove(t.beforeBind),t.afterRender&&t.mesh.onAfterRenderObservable.remove(t.afterRender))}this._excludedMeshes=null}super.dispose()}}ns.EffectName="HighlightLayer";ns.NeutralColor=new K(0,0,0,0);ns.GlowingMeshStencilReference=2;ns.NormalMeshStencilReference=1;Je.prototype.getHighlightLayerByName=function(n){var e;for(let t=0;t<((e=this.effectLayers)==null?void 0:e.length);t++)if(this.effectLayers[t].name===n&&this.effectLayers[t].getEffectName()===us.EffectName)return this.effectLayers[t];return null};class h1 extends pt{constructor(e,t,i,s,r=null,a=ie.BILINEAR_SAMPLINGMODE,o,l){const h={uniforms:Ys.Uniforms,size:typeof s=="number"?s:void 0,camera:r,samplingMode:a,engine:o,reusable:l,...s};super(e,Ys.FragmentUrl,{effectWrapper:typeof s=="number"||!s.effectWrapper?new Ys(e,o,t,i,h):void 0,...h}),this.direction=t,this.kernel=i,this.onApplyObservable.add(()=>{this._effectWrapper.textureWidth=this.width,this._effectWrapper.textureHeight=this.height})}_gatherImports(e,t){e?(this._webGPUReady=!0,t.push(De(()=>import("./glowBlurPostProcess.fragment-C3IOJefW.js"),[]))):t.push(De(()=>import("./glowBlurPostProcess.fragment-oP8oMz3n.js"),[])),super._gatherImports(e,t)}}class us extends qs{static get NeutralColor(){return ns.NeutralColor}static set NeutralColor(e){ns.NeutralColor=e}get innerGlow(){return this._thinEffectLayer.innerGlow}set innerGlow(e){this._thinEffectLayer.innerGlow=e}get outerGlow(){return this._thinEffectLayer.outerGlow}set outerGlow(e){this._thinEffectLayer.outerGlow=e}set blurHorizontalSize(e){this._thinEffectLayer.blurHorizontalSize=e}set blurVerticalSize(e){this._thinEffectLayer.blurVerticalSize=e}get blurHorizontalSize(){return this._thinEffectLayer.blurHorizontalSize}get blurVerticalSize(){return this._thinEffectLayer.blurVerticalSize}constructor(e,t,i){super(e,t,i!==void 0?!!i.forceGLSL:!1,new ns(e,t,i)),this.onBeforeBlurObservable=new q,this.onAfterBlurObservable=new q,this._engine.isStencilEnable||U.Warn("Rendering the Highlight Layer requires the stencil to be active on the canvas. var engine = new Engine(canvas, antialias, { stencil: true }"),this._options={mainTextureRatio:.5,blurTextureSizeRatio:.5,mainTextureFixedSize:0,blurHorizontalSize:1,blurVerticalSize:1,alphaBlendingMode:2,camera:null,renderingGroupId:-1,mainTextureType:0,forceGLSL:!1,isStroke:!1,...i},this._init(this._options),this._shouldRender=!1}getEffectName(){return us.EffectName}_numInternalDraws(){return 2}_createMergeEffect(){return this._thinEffectLayer._createMergeEffect()}_createTextureAndPostProcesses(){let e=this._mainTextureDesiredSize.width*this._options.blurTextureSizeRatio,t=this._mainTextureDesiredSize.height*this._options.blurTextureSizeRatio;e=this._engine.needPOTTextures?Yi(e,this._maxSize):e,t=this._engine.needPOTTextures?Yi(t,this._maxSize):t;let i=0;this._engine.getCaps().textureHalfFloatRender?i=2:i=0,this._blurTexture=new Rn("HighlightLayerBlurRTT",{width:e,height:t},this._scene,!1,!0,i),this._blurTexture.wrapU=ie.CLAMP_ADDRESSMODE,this._blurTexture.wrapV=ie.CLAMP_ADDRESSMODE,this._blurTexture.anisotropicFilteringLevel=16,this._blurTexture.updateSamplingMode(ie.TRILINEAR_SAMPLINGMODE),this._blurTexture.renderParticles=!1,this._blurTexture.ignoreCameraViewport=!0,this._textures=[this._blurTexture],this._thinEffectLayer.bindTexturesForCompose=s=>{s.setTexture("textureSampler",this._blurTexture)},this._thinEffectLayer._createTextureAndPostProcesses(),this._options.alphaBlendingMode===2?(this._downSamplePostprocess=new l0("HighlightLayerPPP",{size:this._options.blurTextureSizeRatio,samplingMode:ie.BILINEAR_SAMPLINGMODE,engine:this._scene.getEngine(),effectWrapper:this._thinEffectLayer._postProcesses[0]}),this._downSamplePostprocess.externalTextureSamplerBinding=!0,this._downSamplePostprocess.onApplyObservable.add(s=>{s.setTexture("textureSampler",this._mainTexture)}),this._horizontalBlurPostprocess=new h1("HighlightLayerHBP",new ne(1,0),this._options.blurHorizontalSize,{samplingMode:ie.BILINEAR_SAMPLINGMODE,engine:this._scene.getEngine(),effectWrapper:this._thinEffectLayer._postProcesses[1]}),this._horizontalBlurPostprocess.onApplyObservable.add(s=>{s.setFloat2("screenSize",e,t)}),this._verticalBlurPostprocess=new h1("HighlightLayerVBP",new ne(0,1),this._options.blurVerticalSize,{samplingMode:ie.BILINEAR_SAMPLINGMODE,engine:this._scene.getEngine(),effectWrapper:this._thinEffectLayer._postProcesses[2]}),this._verticalBlurPostprocess.onApplyObservable.add(s=>{s.setFloat2("screenSize",e,t)}),this._postProcesses=[this._downSamplePostprocess,this._horizontalBlurPostprocess,this._verticalBlurPostprocess]):(this._horizontalBlurPostprocess=new Jn("HighlightLayerHBP",new ne(1,0),this._options.blurHorizontalSize/2,{size:{width:e,height:t},samplingMode:ie.BILINEAR_SAMPLINGMODE,engine:this._scene.getEngine(),textureType:i,effectWrapper:this._thinEffectLayer._postProcesses[0]}),this._horizontalBlurPostprocess.width=e,this._horizontalBlurPostprocess.height=t,this._horizontalBlurPostprocess.externalTextureSamplerBinding=!0,this._horizontalBlurPostprocess.onApplyObservable.add(s=>{s.setTexture("textureSampler",this._mainTexture)}),this._verticalBlurPostprocess=new Jn("HighlightLayerVBP",new ne(0,1),this._options.blurVerticalSize/2,{size:{width:e,height:t},samplingMode:ie.BILINEAR_SAMPLINGMODE,engine:this._scene.getEngine(),textureType:i}),this._postProcesses=[this._horizontalBlurPostprocess,this._verticalBlurPostprocess]),this._mainTexture.onAfterUnbindObservable.add(()=>{this.onBeforeBlurObservable.notifyObservers(this);const s=this._blurTexture.renderTarget;s&&(this._scene.postProcessManager.directRender(this._postProcesses,s,!0),this._engine.unBindFramebuffer(s,!0)),this.onAfterBlurObservable.notifyObservers(this)}),this._postProcesses.map(s=>{s.autoClear=!1})}needStencil(){return this._thinEffectLayer.needStencil()}isReady(e,t){return this._thinEffectLayer.isReady(e,t)}_internalRender(e,t){this._thinEffectLayer._internalCompose(e,t)}shouldRender(){return this._thinEffectLayer.shouldRender()}_shouldRenderMesh(e){return this._thinEffectLayer._shouldRenderMesh(e)}_canRenderMesh(e,t){return this._thinEffectLayer._canRenderMesh(e,t)}_addCustomEffectDefines(e){this._thinEffectLayer._addCustomEffectDefines(e)}_setEmissiveTextureAndColor(e,t,i){this._thinEffectLayer._setEmissiveTextureAndColor(e,t,i)}addExcludedMesh(e){this._thinEffectLayer.addExcludedMesh(e)}removeExcludedMesh(e){this._thinEffectLayer.removeExcludedMesh(e)}hasMesh(e){return this._thinEffectLayer.hasMesh(e)}addMesh(e,t,i=!1){this._thinEffectLayer.addMesh(e,t,i)}removeMesh(e){this._thinEffectLayer.removeMesh(e)}removeAllMeshes(){this._thinEffectLayer.removeAllMeshes()}_disposeMesh(e){this._thinEffectLayer._disposeMesh(e)}getClassName(){return"HighlightLayer"}serialize(){const e=Ie.Serialize(this);e.customType="BABYLON.HighlightLayer",e.meshes=[];const t=this._thinEffectLayer._meshes;if(t)for(const s in t){const r=t[s];r&&e.meshes.push({glowEmissiveOnly:r.glowEmissiveOnly,color:r.color.asArray(),meshId:r.mesh.id})}e.excludedMeshes=[];const i=this._thinEffectLayer._excludedMeshes;if(i)for(const s in i){const r=i[s];r&&e.excludedMeshes.push(r.mesh.id)}return e}static Parse(e,t,i){const s=Ie.Parse(()=>new us(e.name,t,e.options),e,t,i);let r;for(r=0;r<e.excludedMeshes.length;r++){const a=t.getMeshById(e.excludedMeshes[r]);a&&s.addExcludedMesh(a)}for(r=0;r<e.meshes.length;r++){const a=e.meshes[r],o=t.getMeshById(a.meshId);o&&s.addMesh(o,fe.FromArray(a.color),a.glowEmissiveOnly)}return s}}us.EffectName="HighlightLayer";P([B()],us.prototype,"innerGlow",null);P([B()],us.prototype,"outerGlow",null);P([B()],us.prototype,"blurHorizontalSize",null);P([B()],us.prototype,"blurVerticalSize",null);P([B("options")],us.prototype,"_options",void 0);Tt("BABYLON.HighlightLayer",us);const u1="clipPlaneFragmentDeclaration",rC=`#ifdef CLIPPLANE
varying float fClipDistance;
#endif
#ifdef CLIPPLANE2
varying float fClipDistance2;
#endif
#ifdef CLIPPLANE3
varying float fClipDistance3;
#endif
#ifdef CLIPPLANE4
varying float fClipDistance4;
#endif
#ifdef CLIPPLANE5
varying float fClipDistance5;
#endif
#ifdef CLIPPLANE6
varying float fClipDistance6;
#endif
`;ye.IncludesShadersStore[u1]||(ye.IncludesShadersStore[u1]=rC);const c1="logDepthDeclaration",aC=`#ifdef LOGARITHMICDEPTH
uniform float logarithmicDepthConstant;varying float vFragmentDepth;
#endif
`;ye.IncludesShadersStore[c1]||(ye.IncludesShadersStore[c1]=aC);const f1="fogFragmentDeclaration",oC=`#ifdef FOG
#define FOGMODE_NONE 0.
#define FOGMODE_EXP 1.
#define FOGMODE_EXP2 2.
#define FOGMODE_LINEAR 3.
#define E 2.71828
uniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()
{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)
{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}
else if (FOGMODE_EXP==vFogInfos.x)
{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}
else if (FOGMODE_EXP2==vFogInfos.x)
{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}
return clamp(fogCoeff,0.0,1.0);}
#endif
`;ye.IncludesShadersStore[f1]||(ye.IncludesShadersStore[f1]=oC);const d1="clipPlaneFragment",lC=`#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)
if (false) {}
#endif
#ifdef CLIPPLANE
else if (fClipDistance>0.0)
{discard;}
#endif
#ifdef CLIPPLANE2
else if (fClipDistance2>0.0)
{discard;}
#endif
#ifdef CLIPPLANE3
else if (fClipDistance3>0.0)
{discard;}
#endif
#ifdef CLIPPLANE4
else if (fClipDistance4>0.0)
{discard;}
#endif
#ifdef CLIPPLANE5
else if (fClipDistance5>0.0)
{discard;}
#endif
#ifdef CLIPPLANE6
else if (fClipDistance6>0.0)
{discard;}
#endif
`;ye.IncludesShadersStore[d1]||(ye.IncludesShadersStore[d1]=lC);const _1="fogFragment",hC=`#ifdef FOG
float fog=CalcFogFactor();
#ifdef PBR
fog=toLinearSpace(fog);
#endif
color.rgb=mix(vFogColor,color.rgb,fog);
#endif
`;ye.IncludesShadersStore[_1]||(ye.IncludesShadersStore[_1]=hC);const p1="logDepthFragment",uC=`#ifdef LOGARITHMICDEPTH
gl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;
#endif
`;ye.IncludesShadersStore[p1]||(ye.IncludesShadersStore[p1]=uC);const g1="imageProcessingCompatibility",cC=`#ifdef IMAGEPROCESSINGPOSTPROCESS
gl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));
#endif
`;ye.IncludesShadersStore[g1]||(ye.IncludesShadersStore[g1]=cC);const m1="gridPixelShader",fC=`#extension GL_OES_standard_derivatives : enable
#define SQRT2 1.41421356
#define PI 3.14159
precision highp float;uniform float visibility;uniform vec3 mainColor;uniform vec3 lineColor;uniform vec4 gridControl;uniform vec3 gridOffset;varying vec3 vPosition;varying vec3 vNormal;
#ifdef LOGARITHMICDEPTH
#extension GL_EXT_frag_depth : enable
#endif
#include<clipPlaneFragmentDeclaration>
#include<logDepthDeclaration>
#include<fogFragmentDeclaration>
#ifdef OPACITY
varying vec2 vOpacityUV;uniform sampler2D opacitySampler;uniform vec2 vOpacityInfos;
#endif
float getDynamicVisibility(float position) {float majorGridFrequency=gridControl.y;if (floor(position+0.5)==floor(position/majorGridFrequency+0.5)*majorGridFrequency)
{return 1.0;}
return gridControl.z;}
float getAnisotropicAttenuation(float differentialLength) {const float maxNumberOfLines=10.0;return clamp(1.0/(differentialLength+1.0)-1.0/maxNumberOfLines,0.0,1.0);}
float isPointOnLine(float position,float differentialLength) {float fractionPartOfPosition=position-floor(position+0.5); 
fractionPartOfPosition/=differentialLength; 
#ifdef ANTIALIAS
fractionPartOfPosition=clamp(fractionPartOfPosition,-1.,1.);float result=0.5+0.5*cos(fractionPartOfPosition*PI); 
return result;
#else
return abs(fractionPartOfPosition)<SQRT2/4. ? 1. : 0.;
#endif
}
float contributionOnAxis(float position) {float differentialLength=length(vec2(dFdx(position),dFdy(position)));differentialLength*=SQRT2; 
float result=isPointOnLine(position,differentialLength);float dynamicVisibility=getDynamicVisibility(position);result*=dynamicVisibility;float anisotropicAttenuation=getAnisotropicAttenuation(differentialLength);result*=anisotropicAttenuation;return result;}
float normalImpactOnAxis(float x) {float normalImpact=clamp(1.0-3.0*abs(x*x*x),0.0,1.0);return normalImpact;}
#define CUSTOM_FRAGMENT_DEFINITIONS
void main(void) {
#define CUSTOM_FRAGMENT_MAIN_BEGIN
#include<clipPlaneFragment>
float gridRatio=gridControl.x;vec3 gridPos=(vPosition+gridOffset.xyz)/gridRatio;float x=contributionOnAxis(gridPos.x);float y=contributionOnAxis(gridPos.y);float z=contributionOnAxis(gridPos.z);vec3 normal=normalize(vNormal);x*=normalImpactOnAxis(normal.x);y*=normalImpactOnAxis(normal.y);z*=normalImpactOnAxis(normal.z);
#ifdef MAX_LINE
float grid=clamp(max(max(x,y),z),0.,1.);
#else
float grid=clamp(x+y+z,0.,1.);
#endif
vec3 color=mix(mainColor,lineColor,grid);
#ifdef FOG
#include<fogFragment>
#endif
float opacity=1.0;
#ifdef TRANSPARENT
opacity=clamp(grid,0.08,gridControl.w*grid);
#endif
#ifdef OPACITY
opacity*=texture2D(opacitySampler,vOpacityUV).a;
#endif
gl_FragColor=vec4(color.rgb,opacity*visibility);
#ifdef TRANSPARENT
#ifdef PREMULTIPLYALPHA
gl_FragColor.rgb*=opacity;
#endif
#else
#endif
#include<logDepthFragment>
#include<imageProcessingCompatibility>
#define CUSTOM_FRAGMENT_MAIN_END
}
`;ye.ShadersStore[m1]||(ye.ShadersStore[m1]=fC);const v1="instancesDeclaration",dC=`#ifdef INSTANCES
attribute vec4 world0;attribute vec4 world1;attribute vec4 world2;attribute vec4 world3;
#ifdef INSTANCESCOLOR
attribute vec4 instanceColor;
#endif
#if defined(THIN_INSTANCES) && !defined(WORLD_UBO)
uniform mat4 world;
#endif
#if defined(VELOCITY) || defined(PREPASS_VELOCITY) || defined(PREPASS_VELOCITY_LINEAR) || defined(VELOCITY_LINEAR)
attribute vec4 previousWorld0;attribute vec4 previousWorld1;attribute vec4 previousWorld2;attribute vec4 previousWorld3;
#ifdef THIN_INSTANCES
uniform mat4 previousWorld;
#endif
#endif
#else
#if !defined(WORLD_UBO)
uniform mat4 world;
#endif
#if defined(VELOCITY) || defined(PREPASS_VELOCITY) || defined(PREPASS_VELOCITY_LINEAR) || defined(VELOCITY_LINEAR)
uniform mat4 previousWorld;
#endif
#endif
`;ye.IncludesShadersStore[v1]||(ye.IncludesShadersStore[v1]=dC);const y1="fogVertexDeclaration",_C=`#ifdef FOG
varying vec3 vFogDistance;
#endif
`;ye.IncludesShadersStore[y1]||(ye.IncludesShadersStore[y1]=_C);const x1="clipPlaneVertexDeclaration",pC=`#ifdef CLIPPLANE
uniform vec4 vClipPlane;varying float fClipDistance;
#endif
#ifdef CLIPPLANE2
uniform vec4 vClipPlane2;varying float fClipDistance2;
#endif
#ifdef CLIPPLANE3
uniform vec4 vClipPlane3;varying float fClipDistance3;
#endif
#ifdef CLIPPLANE4
uniform vec4 vClipPlane4;varying float fClipDistance4;
#endif
#ifdef CLIPPLANE5
uniform vec4 vClipPlane5;varying float fClipDistance5;
#endif
#ifdef CLIPPLANE6
uniform vec4 vClipPlane6;varying float fClipDistance6;
#endif
`;ye.IncludesShadersStore[x1]||(ye.IncludesShadersStore[x1]=pC);const b1="instancesVertex",gC=`#ifdef INSTANCES
mat4 finalWorld=mat4(world0,world1,world2,world3);
#if defined(PREPASS_VELOCITY) || defined(VELOCITY) || defined(PREPASS_VELOCITY_LINEAR) || defined(VELOCITY_LINEAR)
mat4 finalPreviousWorld=mat4(previousWorld0,previousWorld1,
previousWorld2,previousWorld3);
#endif
#ifdef THIN_INSTANCES
finalWorld=world*finalWorld;
#if defined(PREPASS_VELOCITY) || defined(VELOCITY) || defined(PREPASS_VELOCITY_LINEAR) || defined(VELOCITY_LINEAR)
finalPreviousWorld=previousWorld*finalPreviousWorld;
#endif
#endif
#else
mat4 finalWorld=world;
#if defined(PREPASS_VELOCITY) || defined(VELOCITY) || defined(PREPASS_VELOCITY_LINEAR) || defined(VELOCITY_LINEAR)
mat4 finalPreviousWorld=previousWorld;
#endif
#endif
`;ye.IncludesShadersStore[b1]||(ye.IncludesShadersStore[b1]=gC);const T1="fogVertex",mC=`#ifdef FOG
vFogDistance=(view*worldPos).xyz;
#endif
`;ye.IncludesShadersStore[T1]||(ye.IncludesShadersStore[T1]=mC);const A1="clipPlaneVertex",vC=`#ifdef CLIPPLANE
fClipDistance=dot(worldPos,vClipPlane);
#endif
#ifdef CLIPPLANE2
fClipDistance2=dot(worldPos,vClipPlane2);
#endif
#ifdef CLIPPLANE3
fClipDistance3=dot(worldPos,vClipPlane3);
#endif
#ifdef CLIPPLANE4
fClipDistance4=dot(worldPos,vClipPlane4);
#endif
#ifdef CLIPPLANE5
fClipDistance5=dot(worldPos,vClipPlane5);
#endif
#ifdef CLIPPLANE6
fClipDistance6=dot(worldPos,vClipPlane6);
#endif
`;ye.IncludesShadersStore[A1]||(ye.IncludesShadersStore[A1]=vC);const E1="logDepthVertex",yC=`#ifdef LOGARITHMICDEPTH
vFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;
#endif
`;ye.IncludesShadersStore[E1]||(ye.IncludesShadersStore[E1]=yC);const S1="gridVertexShader",xC=`precision highp float;attribute vec3 position;attribute vec3 normal;
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#include<instancesDeclaration>
uniform mat4 projection;uniform mat4 view;varying vec3 vPosition;varying vec3 vNormal;
#include<logDepthDeclaration>
#include<fogVertexDeclaration>
#ifdef OPACITY
varying vec2 vOpacityUV;uniform mat4 opacityMatrix;uniform vec2 vOpacityInfos;
#endif
#include<clipPlaneVertexDeclaration>
#define CUSTOM_VERTEX_DEFINITIONS
void main(void) {
#define CUSTOM_VERTEX_MAIN_BEGIN
#include<instancesVertex>
vec4 worldPos=finalWorld*vec4(position,1.0);
#include<fogVertex>
vec4 cameraSpacePosition=view*worldPos;gl_Position=projection*cameraSpacePosition;
#ifdef OPACITY
#ifndef UV1
vec2 uv=vec2(0.,0.);
#endif
#ifndef UV2
vec2 uv2=vec2(0.,0.);
#endif
if (vOpacityInfos.x==0.)
{vOpacityUV=vec2(opacityMatrix*vec4(uv,1.0,0.0));}
else
{vOpacityUV=vec2(opacityMatrix*vec4(uv2,1.0,0.0));}
#endif 
#include<clipPlaneVertex>
#include<logDepthVertex>
vPosition=position;vNormal=normal;
#define CUSTOM_VERTEX_MAIN_END
}`;ye.ShadersStore[S1]||(ye.ShadersStore[S1]=xC);class bC extends Cd{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.OPACITY=!1,this.ANTIALIAS=!1,this.TRANSPARENT=!1,this.FOG=!1,this.PREMULTIPLYALPHA=!1,this.MAX_LINE=!1,this.UV1=!1,this.UV2=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class oi extends Md{constructor(e,t){super(e,t),this.mainColor=fe.Black(),this.lineColor=fe.Teal(),this.gridRatio=1,this.gridOffset=y.Zero(),this.majorUnitFrequency=10,this.minorUnitVisibility=.33,this.opacity=1,this.antialias=!0,this.preMultiplyAlpha=!1,this.useMaxLine=!1,this._gridControl=new Oe(this.gridRatio,this.majorUnitFrequency,this.minorUnitVisibility,this.opacity)}needAlphaBlending(){return this.opacity<1||this._opacityTexture&&this._opacityTexture.isReady()}needAlphaBlendingForMesh(e){return e.visibility<1||this.needAlphaBlending()}isReadyForSubMesh(e,t,i){const s=t._drawWrapper;if(this.isFrozen&&s.effect&&s._wasPreviouslyReady&&s._wasPreviouslyUsingInstances===i)return!0;t.materialDefines||(t.materialDefines=new bC);const r=t.materialDefines,a=this.getScene();if(this._isReadyForSubMesh(t))return!0;if(r.TRANSPARENT!==this.opacity<1&&(r.TRANSPARENT=!r.TRANSPARENT,r.markAsUnprocessed()),r.PREMULTIPLYALPHA!=this.preMultiplyAlpha&&(r.PREMULTIPLYALPHA=!r.PREMULTIPLYALPHA,r.markAsUnprocessed()),r.MAX_LINE!==this.useMaxLine&&(r.MAX_LINE=!r.MAX_LINE,r.markAsUnprocessed()),r.ANTIALIAS!==this.antialias&&(r.ANTIALIAS=!r.ANTIALIAS,r.markAsUnprocessed()),r._areTexturesDirty&&(r._needUVs=!1,a.texturesEnabled&&this._opacityTexture&&Le.OpacityTextureEnabled))if(this._opacityTexture.isReady())r._needUVs=!0,r.OPACITY=!0;else return!1;if(Zv(e,a,this._useLogarithmicDepth,!1,this.fogEnabled,!1,r),Qv(a,a.getEngine(),this,r,!!i),r.isDirty){r.markAsProcessed(),a.resetCachedMaterial(),Jv(e,r,!1,!1);const o=[S.PositionKind,S.NormalKind];r.UV1&&o.push(S.UVKind),r.UV2&&o.push(S.UV2Kind),r.IMAGEPROCESSINGPOSTPROCESS=a.imageProcessingConfiguration.applyByPostProcess,$v(o,r);const l=["projection","mainColor","lineColor","gridControl","gridOffset","vFogInfos","vFogColor","world","view","opacityMatrix","vOpacityInfos","visibility","logarithmicDepthConstant"],h=r.toString();Ah(l),t.setEffect(a.getEngine().createEffect("grid",o,l,["opacitySampler"],h,void 0,this.onCompiled,this.onError),r,this._materialContext)}return!t.effect||!t.effect.isReady()?!1:(r._renderId=a.getRenderId(),s._wasPreviouslyReady=!0,s._wasPreviouslyUsingInstances=!!i,!0)}bindForSubMesh(e,t,i){const s=this.getScene(),r=i.materialDefines;if(!r)return;const a=i.effect;a&&(this._activeEffect=a,this._activeEffect.setFloat("visibility",t.visibility),(!r.INSTANCES||r.THIN_INSTANCE)&&this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("view",s.getViewMatrix()),this._activeEffect.setMatrix("projection",s.getProjectionMatrix()),this._mustRebind(s,a,i)&&(this._activeEffect.setColor3("mainColor",this.mainColor),this._activeEffect.setColor3("lineColor",this.lineColor),this._activeEffect.setVector3("gridOffset",this.gridOffset),this._gridControl.x=this.gridRatio,this._gridControl.y=Math.round(this.majorUnitFrequency),this._gridControl.z=this.minorUnitVisibility,this._gridControl.w=this.opacity,this._activeEffect.setVector4("gridControl",this._gridControl),this._opacityTexture&&Le.OpacityTextureEnabled&&(this._activeEffect.setTexture("opacitySampler",this._opacityTexture),this._activeEffect.setFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),this._activeEffect.setMatrix("opacityMatrix",this._opacityTexture.getTextureMatrix())),Eh(a,this,s),this._useLogarithmicDepth&&Ed(r,a,s)),Sd(s,t,this._activeEffect),this._afterBind(t,this._activeEffect,i))}dispose(e){super.dispose(e)}clone(e){return Ie.Clone(()=>new oi(e,this.getScene()),this)}serialize(){const e=super.serialize();return e.customType="BABYLON.GridMaterial",e}getClassName(){return"GridMaterial"}static Parse(e,t,i){return Ie.Parse(()=>new oi(e.name,t),e,t,i)}}P([En()],oi.prototype,"mainColor",void 0);P([En()],oi.prototype,"lineColor",void 0);P([B()],oi.prototype,"gridRatio",void 0);P([cs()],oi.prototype,"gridOffset",void 0);P([B()],oi.prototype,"majorUnitFrequency",void 0);P([B()],oi.prototype,"minorUnitVisibility",void 0);P([B()],oi.prototype,"opacity",void 0);P([B()],oi.prototype,"antialias",void 0);P([B()],oi.prototype,"preMultiplyAlpha",void 0);P([B()],oi.prototype,"useMaxLine",void 0);P([Zi("opacityTexture")],oi.prototype,"_opacityTexture",void 0);P([Ze("_markAllSubMeshesAsTexturesDirty")],oi.prototype,"opacityTexture",void 0);Tt("BABYLON.GridMaterial",oi);Fe.prototype.createDynamicTexture=function(n,e,t,i){const s=new gt(this,4);return s.baseWidth=n,s.baseHeight=e,t&&(n=this.needPOTTextures?Yi(n,this._caps.maxTextureSize):n,e=this.needPOTTextures?Yi(e,this._caps.maxTextureSize):e),s.width=n,s.height=e,s.isReady=!1,s.generateMipMaps=t,s.samplingMode=i,this.updateTextureSamplingMode(i,s),this._internalTexturesCache.push(s),s};Fe.prototype.updateDynamicTexture=function(n,e,t,i=!1,s,r=!1,a=!1){if(!n)return;const o=this._gl,l=o.TEXTURE_2D,h=this._bindTextureDirectly(l,n,!0,r);this._unpackFlipY(t===void 0?n.invertY:t),i&&o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const u=this._getWebGLTextureType(n.type),c=this._getInternalFormat(s||n.format),f=this._getRGBABufferInternalSizedFormat(n.type,c);o.texImage2D(l,0,f,c,u,e),n.generateMipMaps&&o.generateMipmap(l),h||this._bindTextureDirectly(l,null),i&&o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),s&&(n.format=s),n._dynamicTextureSource=e,n._premulAlpha=i,n.invertY=t||!1,n.isReady=!0};class Jo extends ie{constructor(e,t,i,s=!1,r=3,a=5,o){const l=!i||i._isScene,h=l?i:i==null?void 0:i.scene,u=l?!s:i;super(null,h,u,o,r,void 0,void 0,void 0,void 0,a),this.name=e,this.wrapU=ie.CLAMP_ADDRESSMODE,this.wrapV=ie.CLAMP_ADDRESSMODE,this._generateMipMaps=s;const c=this._getEngine();if(!c)return;if(t.getContext)this._canvas=t,this._ownCanvas=!1,this._texture=c.createDynamicTexture(this._canvas.width,this._canvas.height,s,r);else{this._canvas=c.createCanvas(1,1),this._ownCanvas=!0;const d=t;d.width||d.width===0?this._texture=c.createDynamicTexture(d.width,d.height,s,r):this._texture=c.createDynamicTexture(t,t,s,r)}const f=this.getSize();this._canvas.width!==f.width&&(this._canvas.width=f.width),this._canvas.height!==f.height&&(this._canvas.height=f.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(e){this._canvas.width=e.width,this._canvas.height=e.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(e.width,e.height,this._generateMipMaps,this.samplingMode)}scale(e){const t=this.getSize();t.width*=e,t.height*=e,this._recreate(t)}scaleTo(e,t){const i=this.getSize();i.width=e,i.height=t,this._recreate(i)}getContext(){return this._context}clear(e){const t=this.getSize();e&&(this._context.fillStyle=e),this._context.clearRect(0,0,t.width,t.height)}update(e,t=!1,i=!1){this._getEngine().updateDynamicTexture(this._texture,this._canvas,e===void 0?!0:e,t,this._format||void 0,void 0,i)}drawText(e,t,i,s,r,a,o,l=!0){const h=this.getSize();if(a&&(this._context.fillStyle=a,this._context.fillRect(0,0,h.width,h.height)),this._context.font=s,t==null){const u=this._context.measureText(e);t=(h.width-u.width)/2}if(i==null){const u=parseInt(s.replace(/\D/g,""));i=h.height/2+u/3.65}this._context.fillStyle=r||"",this._context.fillText(e,t,i),l&&this.update(o)}dispose(){var e,t;super.dispose(),this._ownCanvas&&((t=(e=this._canvas)==null?void 0:e.remove)==null||t.call(e)),this._canvas=null,this._context=null}clone(){const e=this.getScene();if(!e)return this;const t=this.getSize(),i=new Jo(this.name,t,e,this._generateMipMaps);return i.hasAlpha=this.hasAlpha,i.level=this.level,i.wrapU=this.wrapU,i.wrapV=this.wrapV,i}serialize(){const e=this.getScene();e&&!e.isReady()&&U.Warn("The scene must be ready before serializing the dynamic texture");const t=super.serialize();return Jo._IsCanvasElement(this._canvas)&&(t.base64String=this._canvas.toDataURL()),t.invertY=this._invertY,t.samplingMode=this.samplingMode,t}static _IsCanvasElement(e){return e.toDataURL!==void 0}_rebuild(){this.update()}}Rt.AddNodeConstructor("Light_Type_3",(n,e)=>()=>new La(n,y.Zero(),e));class La extends Be{constructor(e,t,i){super(e,i),this.groundColor=new fe(0,0,0),this.direction=t||y.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"HemisphericLight"}setDirectionToTarget(e){return this.direction=y.Normalize(e.subtract(y.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(e,t){const i=y.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",i.x,i.y,i.z,0,t),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.intensity),t),this}transferToNodeMaterialEffect(e,t){const i=y.Normalize(this.direction);return e.setFloat3(t,i.x,i.y,i.z),this}computeWorldMatrix(){return this._worldMatrix||(this._worldMatrix=L.Identity()),this._worldMatrix}getTypeID(){return Be.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(e,t){e["HEMILIGHT"+t]=!0}}P([En()],La.prototype,"groundColor",void 0);P([cs()],La.prototype,"direction",void 0);Tt("BABYLON.HemisphericLight",La);function Ft(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */Ft=()=>n;var n={},e=Object.prototype,t=e.hasOwnProperty,i=typeof Symbol=="function"?Symbol:{},s=i.iterator||"@@iterator",r=i.asyncIterator||"@@asyncIterator",a=i.toStringTag||"@@toStringTag";function o(I,D,w){return Object.defineProperty(I,D,{value:w,enumerable:!0,configurable:!0,writable:!0}),I[D]}try{o({},"")}catch{o=(D,w,z)=>D[w]=z}function l(I,D,w,z){var F=D&&D.prototype instanceof c?D:c,W=Object.create(F.prototype),X=new E(z||[]);return W._invoke=((he,H,G)=>{var k="suspendedStart";return(M,V)=>{if(k==="executing")throw new Error("Generator is already running");if(k==="completed"){if(M==="throw")throw V;return C()}for(G.method=M,G.arg=V;;){var j=G.delegate;if(j){var ae=A(j,G);if(ae){if(ae===u)continue;return ae}}if(G.method==="next")G.sent=G._sent=G.arg;else if(G.method==="throw"){if(k==="suspendedStart")throw k="completed",G.arg;G.dispatchException(G.arg)}else G.method==="return"&&G.abrupt("return",G.arg);k="executing";var ge=h(he,H,G);if(ge.type==="normal"){if(k=G.done?"completed":"suspendedYield",ge.arg===u)continue;return{value:ge.arg,done:G.done}}ge.type==="throw"&&(k="completed",G.method="throw",G.arg=ge.arg)}}})(I,w,X),W}function h(I,D,w){try{return{type:"normal",arg:I.call(D,w)}}catch(z){return{type:"throw",arg:z}}}n.wrap=l;var u={};function c(){}function f(){}function d(){}var _={};o(_,s,function(){return this});var p=Object.getPrototypeOf,g=p&&p(p(R([])));g&&g!==e&&t.call(g,s)&&(_=g);var m=d.prototype=c.prototype=Object.create(_);function v(I){["next","throw","return"].forEach(function(D){o(I,D,function(w){return this._invoke(D,w)})})}function T(I,D){function w(F,W,X,he){var H=h(I[F],I,W);if(H.type!=="throw"){var G=H.arg,k=G.value;return k&&typeof k=="object"&&t.call(k,"__await")?D.resolve(k.__await).then(M=>{w("next",M,X,he)},M=>{w("throw",M,X,he)}):D.resolve(k).then(M=>{G.value=M,X(G)},M=>w("throw",M,X,he))}he(H.arg)}var z;this._invoke=(F,W)=>{function X(){return new D((he,H)=>{w(F,W,he,H)})}return z=z?z.then(X,X):X()}}function A(I,D){var w=I.iterator[D.method];if(w===void 0){if(D.delegate=null,D.method==="throw"){if(I.iterator.return&&(D.method="return",D.arg=void 0,A(I,D),D.method==="throw"))return u;D.method="throw",D.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var z=h(w,I.iterator,D.arg);if(z.type==="throw")return D.method="throw",D.arg=z.arg,D.delegate=null,u;var F=z.arg;return F?F.done?(D[I.resultName]=F.value,D.next=I.nextLoc,D.method!=="return"&&(D.method="next",D.arg=void 0),D.delegate=null,u):F:(D.method="throw",D.arg=new TypeError("iterator result is not an object"),D.delegate=null,u)}function b(I){var D={tryLoc:I[0]};1 in I&&(D.catchLoc=I[1]),2 in I&&(D.finallyLoc=I[2],D.afterLoc=I[3]),this.tryEntries.push(D)}function x(I){var D=I.completion||{};D.type="normal",delete D.arg,I.completion=D}function E(I){this.tryEntries=[{tryLoc:"root"}],I.forEach(b,this),this.reset(!0)}function R(I){if(I){var D=I[s];if(D)return D.call(I);if(typeof I.next=="function")return I;if(!isNaN(I.length)){var w=-1,z=function F(){for(;++w<I.length;)if(t.call(I,w))return F.value=I[w],F.done=!1,F;return F.value=void 0,F.done=!0,F};return z.next=z}}return{next:C}}function C(){return{value:void 0,done:!0}}return f.prototype=d,o(m,"constructor",d),o(d,"constructor",f),f.displayName=o(d,a,"GeneratorFunction"),n.isGeneratorFunction=I=>{var D=typeof I=="function"&&I.constructor;return!!D&&(D===f||(D.displayName||D.name)==="GeneratorFunction")},n.mark=I=>(Object.setPrototypeOf?Object.setPrototypeOf(I,d):(I.__proto__=d,o(I,a,"GeneratorFunction")),I.prototype=Object.create(m),I),n.awrap=I=>({__await:I}),v(T.prototype),o(T.prototype,r,function(){return this}),n.AsyncIterator=T,n.async=(I,D,w,z,F)=>{F===void 0&&(F=Promise);var W=new T(l(I,D,w,z),F);return n.isGeneratorFunction(D)?W:W.next().then(X=>X.done?X.value:W.next())},v(m),o(m,a,"Generator"),o(m,s,function(){return this}),o(m,"toString",()=>"[object Generator]"),n.keys=I=>{var D=[];for(var w in I)D.push(w);return D.reverse(),function z(){for(;D.length;){var F=D.pop();if(F in I)return z.value=F,z.done=!1,z}return z.done=!0,z}},n.values=R,E.prototype={constructor:E,reset:function(I){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(x),!I)for(var D in this)D.charAt(0)==="t"&&t.call(this,D)&&!isNaN(+D.slice(1))&&(this[D]=void 0)},stop:function(){this.done=!0;var I=this.tryEntries[0].completion;if(I.type==="throw")throw I.arg;return this.rval},dispatchException:function(I){if(this.done)throw I;var D=this;function w(H,G){return W.type="throw",W.arg=I,D.next=H,G&&(D.method="next",D.arg=void 0),!!G}for(var z=this.tryEntries.length-1;z>=0;--z){var F=this.tryEntries[z],W=F.completion;if(F.tryLoc==="root")return w("end");if(F.tryLoc<=this.prev){var X=t.call(F,"catchLoc"),he=t.call(F,"finallyLoc");if(X&&he){if(this.prev<F.catchLoc)return w(F.catchLoc,!0);if(this.prev<F.finallyLoc)return w(F.finallyLoc)}else if(X){if(this.prev<F.catchLoc)return w(F.catchLoc,!0)}else{if(!he)throw new Error("try statement without catch or finally");if(this.prev<F.finallyLoc)return w(F.finallyLoc)}}}},abrupt:function(I,D){for(var w=this.tryEntries.length-1;w>=0;--w){var z=this.tryEntries[w];if(z.tryLoc<=this.prev&&t.call(z,"finallyLoc")&&this.prev<z.finallyLoc){var F=z;break}}F&&(I==="break"||I==="continue")&&F.tryLoc<=D&&D<=F.finallyLoc&&(F=null);var W=F?F.completion:{};return W.type=I,W.arg=D,F?(this.method="next",this.next=F.finallyLoc,u):this.complete(W)},complete:function(I,D){if(I.type==="throw")throw I.arg;return I.type==="break"||I.type==="continue"?this.next=I.arg:I.type==="return"?(this.rval=this.arg=I.arg,this.method="return",this.next="end"):I.type==="normal"&&D&&(this.next=D),u},finish:function(I){for(var D=this.tryEntries.length-1;D>=0;--D){var w=this.tryEntries[D];if(w.finallyLoc===I)return this.complete(w.completion,w.afterLoc),x(w),u}},catch:function(I){for(var D=this.tryEntries.length-1;D>=0;--D){var w=this.tryEntries[D];if(w.tryLoc===I){var z=w.completion;if(z.type==="throw"){var F=z.arg;x(w)}return F}}throw new Error("illegal catch attempt")},delegateYield:function(I,D,w){return this.delegate={iterator:R(I),resultName:D,nextLoc:w},this.method==="next"&&(this.arg=void 0),u}},n}function $c(n){return $c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?e=>typeof e:e=>e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e,$c(n)}function R1(n,e,t,i,s,r,a){try{var o=n[r](a),l=o.value}catch(h){return void t(h)}o.done?e(l):Promise.resolve(l).then(i,s)}function Vs(n){return function(){var e=this,t=arguments;return new Promise((i,s)=>{var r=n.apply(e,t);function a(l){R1(r,i,s,a,o,"next",l)}function o(l){R1(r,i,s,a,o,"throw",l)}a(void 0)})}}function kt(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function I1(n,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}}function Vt(n,e,t){return e&&I1(n.prototype,e),t&&I1(n,t),Object.defineProperty(n,"prototype",{writable:!1}),n}function Ix(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function $s(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&Zc(n,e)}function Zl(n){return Zl=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Zl(n)}function Zc(n,e){return Zc=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,i){return t.__proto__=i,t},Zc(n,e)}function TC(n,e){if(e&&(typeof e=="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(n)}function Zs(n){var e=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],()=>{})),!0}catch{return!1}}();return function(){var t,i=Zl(n);if(e){var s=Zl(this).constructor;t=Reflect.construct(i,arguments,s)}else t=i.apply(this,arguments);return TC(this,t)}}function C1(n,e){return function(t){if(Array.isArray(t))return t}(n)||function(t,i){var s=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(s!=null){var r,a,o=[],l=!0,h=!1;try{for(s=s.call(t);!(l=(r=s.next()).done)&&(o.push(r.value),!i||o.length!==i);l=!0);}catch(u){h=!0,a=u}finally{try{l||s.return==null||s.return()}finally{if(h)throw a}}return o}}(n,e)||$d(n,e)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function M1(n){return function(e){if(Array.isArray(e))return Qc(e)}(n)||function(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}(n)||$d(n)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function $d(n,e){if(n){if(typeof n=="string")return Qc(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?Qc(n,e):void 0}}function Qc(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,i=new Array(e);t<e;t++)i[t]=n[t];return i}function Hr(n,e,t,i){var s=Number(n.substring(1));return s=s||0,t?s+e:s+i}function Ql(){return new Promise(n=>setTimeout(n)).then(()=>Date.now())}var AC=Math.PI/2,EC=new y(2,2,2),P1=function(){function n(){kt(this,n),this.tool=0,this.start=y.Zero(),this.end=y.Zero(),this.extruding=!1,this.gcodeLineNumber=0,this.gcodeFilePosition=0,this.color=null,this.feedRate=0,this.layerHeight=0,this.isPerimeter=!1}return Vt(n,[{key:"length",value:function(){return y.Distance(this.start,this.end)}},{key:"renderLine",value:function(e){var t=[this.start,this.end],i=Ti.CreateLines("lines",t,e);i.enableEdgesRendering(),i.edgesWidth=10,i.edgesColor=new K(1,1,0,1)}},{key:"renderLinev4",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:.4,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;this.layerHeight===0&&(this.layerHeight=this.start.y);var i={},s=this.length()+t,r=this.start.add(this.end).divide(EC),a=this.end.subtract(this.start),o=Math.sqrt(Math.pow(a.x,2)+Math.pow(a.y,2)+Math.pow(a.z,2)),l=Math.atan2(a.z,a.x),h=Math.acos(a.y/o);return i.matrix=L.Compose(new y(s,this.layerHeight,e),se.FromEulerVector(new y(0,-l,AC-h)),r),i.color=this.color,i.props={gcodeLineNumber:this.gcodeLineNumber,gcodeFilePosition:this.gcodeFilePosition,originalColor:this.color},i}},{key:"renderParticle",value:function(e){e.position.x=this.start.x,e.position.y=this.start.y,e.position.z=this.start.z,e.color=this.color}},{key:"getPoints",value:function(){return{points:[this.start,this.end],colors:[this.color,this.color]}}},{key:"getColor",value:function(){return this.extruding?new K(1,1,1,1):new K(1,0,0,1)}},{key:"getVoxelSegments",value:function(e,t){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=arguments.length>3?arguments[3]:void 0,r=new Array,a=y.Distance(this.start,this.end);if(!(a<.1)){var o=Math.round(100*(a/(e/2)-1))/100,l=Math.atan2(this.end.z-this.start.z,this.end.x-this.start.x);s&&(this.start.y-=e/2,this.end.y-=e/2);var h=this.start.clone(),u=0;r.push(h.clone());var c=e/2*Math.cos(l),f=e/2*Math.sin(l),d=0;for(o!==0&&(d=(this.end.y-this.start.y)/o);u<o;){if(h.x+=c,h.y+=d,h.z+=f,r.push(h.clone()),i>e)for(var _=h.x-i;_<=h.x+i;_+=e)for(var p=h.z-i;p<h.z+i;p+=e)r.push(new y(_,h.y,p));u++}if(r.push(this.end.clone()),this.layerHeight>t&&s){for(var g=[],m=0;m<r.length;m++)for(var v=r[m],T=1;T<Math.ceil(this.layerHeight/t);T++)g.push(new y(v.x,v.y-T*t,v.z));r.push.apply(r,g)}return r}}}]),n}(),Jc={Extruder:"Extruder"},Kr=.3,W0=function(){function n(){kt(this,n),this.name="",this.color=new K(0,0,1,1),this.updateDarkerValue(),this.diameter=.4,this.toolType=Jc.Extruder}return Vt(n,[{key:"colorString",get:function(){return this.color.toHexString()},set:function(e){this.color=K.FromHexString(e+"FF"),this.updateDarkerValue()}},{key:"updateDarkerValue",value:function(){this.color.r<.3&&this.color.g<.3&&this.color.b<.3?this.colorDarker=this.color.add(new K(Kr,Kr,Kr,0)):this.colorDarker=this.color.subtract(new K(Kr,Kr,Kr,0))}},{key:"isAdditive",value:function(){return this.toolType===Jc.Extruder}},{key:"getDiameter",value:function(){return this.diameter}},{key:"toJson",value:function(){return JSON.stringify(this)}}],[{key:"fromJson",value:function(e){var t;t=$c(e)==="object"?e:JSON.parse(e);var i=new n;return i.name=t.name,i.color=new K(t.color.r,t.color.g,t.color.b,t.color.a),i.diameter=parseFloat(t.diameter),i.toolType=t.toolType,i}}]),n}();new Array;var lr={Block:1,Line:2,Point:3,Voxel:5},ln={Color:0,Feed:1,Feature:2},Gh=function(){function n(e,t,i,s,r){kt(this,n),this.scene=e,this.specularColor=t,this.loadingProgressCallback=i,this.renderFuncs=s,this.solidMat,this.transparentMat,this.previousFilePosition=0,this.currentFilePosition=0,this.tools=r,this.scrubDistance=10,this.progressColor=new K(0,1,0,1),this.isLoading=!0,this.vertexAlpha=!1,this.forceRedraw=!1,this.material=null,this.fadeRate=.2,this.transparentValue=.25,this.renderRange=0,this.g1AsExtrusion=!1,this.progressMode=!1,this.hasMixing=!1,this.colorMode=ln.Color,this.renderAnimation=!0,this.timeStamp=0,this.persistTravels=!1}return Vt(n,[{key:"updateFilePosition",value:function(e){this.previousFilePosition=this.currentFilePosition-5,this.currentFilePosition=e+5}},{key:"updateLiveTrackingShowSolid",value:function(e){this.liveTrackingShowSolid=e}},{key:"lerp",value:function(e,t,i){return e+(t-e)*i}},{key:"doScrub",value:function(e,t,i){return Math.abs(e-this.currentFilePosition)>5e4||this.currentFilePosition<e&&Math.abs(e-this.currentFilePosition)>this.scrubDistance&&e>=t-1e3&&e<=i+1e3}},{key:"getTransparentValue",value:function(){return this.vertexAlpha?this.transparentValue:0}},{key:"canUpdateColor",value:function(){return this.colorMode==ln.Color&&!this.hasMixing}},{key:"forceDraw",value:function(){this.timeStamp=0}}]),n}(),SC=function(n){$s(t,Gh);var e=Zs(t);function t(i,s,r,a,o,l){var h;return kt(this,t),(h=e.call(this,i,s,r,a,o)).meshIndex=l??0,h.lostInSpace=L.Identity().setTranslation(new y(1e4,1e4,1e4)),h.additiveColor=new K(0,1,0,.8),h}return Vt(t,[{key:"buildBox",value:function(){if(this.solidMat)try{this.solidMat.dispose(),this.solidMat=null}catch{console.warn("nothing to dispose")}if(this.transparentMat)try{this.transparentMat.dispose(),this.transparentMat=null}catch{console.warn("nothing to dispose")}var i=Ti.CreateBox("box",{width:1,height:1,depth:1,sideOrientation:O.FRONTSIDE},this.scene);return this.material=new ee("mat",this.scene),this.material.specularColor=this.specularColor,i.material=this.material,this.vertexAlpha&&(i.hasVertexAlpha=!0,i.material.forceDepthWrite=!0,i.material.alpha=.99),i}},{key:"render",value:function(i){for(var s=this,r=new Array(i.length),a=0,o=new Array(i.length),l=0;l<i.length;l++){var h=i[l];if(h==null)break;var u=this.tools[h.tool];if(h.extruding){var c=h.renderLinev4(this.g1AsExtrusion?1:u.getDiameter(),.1),f={};f.matrix=c.matrix,f.color=c.color,f.tool=h.tool,r[a++]=f,o[l]=c.props.gcodeFilePosition}}for(var d=new Float32Array(16*a),_=new Float32Array(4*a),p=new Array(a),g=0;g<a;g++){var m=r[g];m.matrix.copyToArray(d,16*g),m.color.toArray(_,4*g),_[4*g+3]=this.getTransparentValue(),p[l]=!1}var v=this.buildBox();v.alphaIndex=this.meshIndex,v.renderingGroupId=2,v.thinInstanceSetBuffer("matrix",d,16,!1),v.thinInstanceSetBuffer("color",_,4,!1),v.thinInstanceRefreshBoundingInfo();var T=function(){for(var I=E,D=E,w=0;w<a;w++){var z=16*w,F=4*w;if(s.canUpdateColor()&&(r[w].color=s.hasMixing?r[w].color:s.tools[r[w].tool].color),!E||s.progressMode){if(!p[w])if(s.progressMode){if(o[w]<=s.currentFilePosition){_[F]=s.progressColor.r,_[F+1]=s.progressColor.g,_[F+2]=s.progressColor.b,_[F+3]=1,I=!0;continue}r[w].color.toArray(_,F),_[F+3]=s.getTransparentValue(),I=!0,r[w].matrix.copyToArray(d,z),D=!0}else{if(o[w]<=s.currentFilePosition&&_[F+3]<.5&&(s.renderAnimation&&s.progressColor.toArray(_,F),_[F+3]=s.renderAnimation?.9:2,I=!0,r[w].matrix.copyToArray(d,z),D=!0,s.renderAnimation))continue;if(_[F+3]>.5&&_[F+3]<1){_[F+3]+=.02;var W=10*(_[F+3]-.9);_[F]=s.lerp(s.progressColor.r,r[w].color.r,W),_[F+1]=s.lerp(s.progressColor.g,r[w].color.g,W),_[F+2]=s.lerp(s.progressColor.b,r[w].color.b,W),I=!0}_[F+3]>=1&&!p[w]&&(r[w].color.toArray(_,F),_[F+3]=1,p[w]=!0,I=!0)}}else o[w]<=s.currentFilePosition?(r[w].color.toArray(_,F),r[w].matrix.copyToArray(d,16*w),_[F+3]=1,p[w]=!0):(s.getTransparentValue()===0?s.lostInSpace.copyToArray(d,16*w):r[w].matrix.copyToArray(d,16*w),_[F+3]=s.getTransparentValue(),p[w]=!1)}I&&v.thinInstanceBufferUpdated("color"),D&&(v.thinInstanceBufferUpdated("matrix"),v.thinInstanceRefreshBoundingInfo())};if(i.length!==0){var A=i[0].gcodeFilePosition,b=i.slice(-1)[0].gcodeFilePosition,x=0,E=!1,R=!1;this.timeStamp=Date.now();var C=function(){if(!(s.isLoading||Date.now()-s.timeStamp<200)){if(s.timeStamp=Date.now(),s.doScrub(x,A,b)||s.forceRedraw){E=!0,s.forceRedraw=!1,x=0;for(var I=0;I<p.length;I++)p[I]=!1;R&&v.unfreezeWorldMatrix(),T()}else s.currentFilePosition>=A-3e4&&s.currentFilePosition<=b+3e4?(E=!1,R&&v.unfreezeWorldMatrix(),T()):R||(v.freezeWorldMatrix(),R=!0);x=s.currentFilePosition}};this.renderFuncs.push(C),this.scene.registerBeforeRender(C)}}}]),t}(),RC=function(n){$s(t,Gh);var e=Zs(t);function t(i,s,r,a,o,l){var h;return kt(this,t),(h=e.call(this,i,s,r,a,o)).meshIndex=l??0,h.lostInSpace=L.Identity().setTranslation(new y(1e4,1e4,1e4)),h.additiveColor=new K(0,1,0,.8),h}return Vt(t,[{key:"buildCylinder",value:function(){if(this.solidMat)try{this.solidMat.dispose(),this.solidMat=null}catch{console.warn("nothing to dispose")}if(this.transparentMat)try{this.transparentMat.dispose(),this.transparentMat=null}catch{console.warn("nothing to dispose")}var i=Ti.CreateCylinder("box",{height:1,diameter:1},this.scene);return i.locallyTranslate(new y(0,0,0)),i.rotate(new y(0,0,1),Math.PI/2,zi.WORLD),i.bakeCurrentTransformIntoVertices(),this.material=new ee("mat",this.scene),this.material.specularColor=this.specularColor,i.material=this.material,this.vertexAlpha&&(i.hasVertexAlpha=!0,i.material.forceDepthWrite=!0,i.material.alpha=.99),i}},{key:"render",value:function(i){for(var s=this,r=new Array(i.length),a=0,o=new Array(i.length),l=0;l<i.length;l++){var h=i[l];if(h==null)break;var u=this.tools[h.tool];if(h.extruding){var c=h.renderLinev4(this.g1AsExtrusion?1:u.getDiameter(),.1),f={};f.matrix=c.matrix,f.color=c.color,f.tool=h.tool,r[a++]=f,o[l]=c.props.gcodeFilePosition}}for(var d=new Float32Array(16*a),_=new Float32Array(4*a),p=new Array(a),g=0;g<a;g++){var m=r[g];m.matrix.copyToArray(d,16*g),m.color.toArray(_,4*g),_[4*g+3]=this.getTransparentValue(),p[g]=!1}var v=this.buildCylinder();v.thinInstanceSetBuffer("matrix",d,16,!1),v.thinInstanceSetBuffer("color",_,4,!1),v.thinInstanceRefreshBoundingInfo(),v.alphaIndex=this.meshIndex,v.renderingGroupId=2;var T=function(){for(var I=E,D=E,w=0;w<a;w++){var z=16*w,F=4*w;if(s.canUpdateColor()&&(r[w].color=s.hasMixing?r[w].color:s.tools[r[w].tool].color),!E||s.progressMode){if(!p[w])if(s.progressMode){if(o[w]<=s.currentFilePosition){_[F]=s.progressColor.r,_[F+1]=s.progressColor.g,_[F+2]=s.progressColor.b,_[F+3]=1,I=!0;continue}r[w].color.toArray(_,F),_[F+3]=s.getTransparentValue(),I=!0,r[w].matrix.copyToArray(d,z),D=!0}else{if(o[w]<=s.currentFilePosition&&_[F+3]<.5&&(s.renderAnimation&&s.progressColor.toArray(_,F),_[F+3]=s.renderAnimation?.9:2,I=!0,r[w].matrix.copyToArray(d,z),D=!0,s.renderAnimation))continue;if(_[F+3]>.5&&_[F+3]<1){_[F+3]+=.02;var W=10*(_[F+3]-.9);_[F]=s.lerp(s.progressColor.r,r[w].color.r,W),_[F+1]=s.lerp(s.progressColor.g,r[w].color.g,W),_[F+2]=s.lerp(s.progressColor.b,r[w].color.b,W)}_[F+3]>=1&&!p[w]&&(r[w].color.toArray(_,F),_[F+3]=1,p[w]=!0,I=!0)}}else o[w]<=s.currentFilePosition?(r[w].color.toArray(_,F),r[w].matrix.copyToArray(d,z),_[F+3]=1,p[w]=!0):(s.getTransparentValue()===0?s.lostInSpace.copyToArray(d,z):r[w].matrix.copyToArray(d,z),_[F+3]=s.getTransparentValue(),p[w]=!1)}I&&v.thinInstanceBufferUpdated("color"),D&&(v.thinInstanceBufferUpdated("matrix"),v.thinInstanceRefreshBoundingInfo())};if(i.length!==0){var A=i[0].gcodeFilePosition,b=i.slice(-1)[0].gcodeFilePosition,x=0,E=!1,R=!1;this.timeStamp=Date.now();var C=function(){if(!(s.isLoading||Date.now()-s.timeStamp<200)){if(s.timeStamp=Date.now(),s.doScrub(x,A,b)||s.forceRedraw){E=!0,s.forceRedraw=!1,x=0;for(var I=0;I<p.length;I++)p[I]=!1;R&&v.unfreezeWorldMatrix(),T()}else s.currentFilePosition>=A-3e4&&s.currentFilePosition<=b+3e4?(E=!1,R&&v.unfreezeWorldMatrix(),T()):R||(R=!0,v.freezeWorldMatrix());x=s.currentFilePosition}};this.renderFuncs.push(C),this.scene.registerBeforeRender(C)}}}]),t}(),IC=Vt(function n(e,t){kt(this,n),this.filePosition=e,this.add=t,this.complete=!1}),Cx=function(n){$s(i,Gh);var e,t=Zs(i);function i(s,r,a,o,l,h,u){var c;return kt(this,i),(c=t.call(this,s,r,a,o,l)).voxelWidth=parseFloat(h),c.voxelHeight=parseFloat(u),c.solidMat,c.transparentMat,c.hasSubtractive=!1,c.lostInSpace=L.Identity().setTranslation(new y(1e4,1e4,1e4)),c.clearColor=new K(1,0,0,0),c.additiveColor=new K(0,1,0,.8),c.subtractiveColor=new K(1,0,0,.8),c}return Vt(i,[{key:"buildBox",value:function(){if(this.solidMat)try{this.solidMat.dispose(),this.solidMat=null}catch{}if(this.transparentMat)try{this.transparentMat.dispose(),this.transparentMat=null}catch{}var s=Ti.CreateBox("box",{width:this.voxelWidth,height:this.voxelHeight,depth:this.voxelWidth},this.scene);return s.hasVertexAlpha=!0,s.updateFacetData=!0,this.material=new ee("mat",this.scene),this.material.needDepthPrePass=!0,this.material.forceDepthWrite=!0,this.material.backFaceCulling=!1,s.material=this.material,s}},{key:"render",value:(e=Vs(Ft().mark(function s(r){var a,o,l,h,u,c,f,d,_,p,g,m,v,T,A,b,x,E,R,C,I,D=this;return Ft().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:for(this.isLoading=!0,a=parseInt(300/this.voxelWidth)+1,o=a,l=parseInt(300/this.voxelHeight)+1,h=new Array(o),u=0;u<=l;u++)h[u]=new Object;c=0,f=new Date,d=0;case 10:if(!(d<r.length)){w.next=63;break}if((_=r[d])!=null){w.next=14;break}return w.abrupt("break",63);case 14:if(p=this.tools[_.tool],_.extruding){w.next=17;break}return w.abrupt("continue",60);case 17:if((g=_.getVoxelSegments(this.voxelWidth,this.voxelHeight,p.getDiameter()/2,p.isAdditive()))!==void 0&&g.length!==0){w.next=20;break}return w.abrupt("continue",60);case 20:m=new IC(_.gcodeFilePosition,p.isAdditive()),v=0;case 22:if(!(v<g.length)){w.next=60;break}if(T=g[v],A=Math.floor(T.x/this.voxelWidth),b=Math.floor(T.y/this.voxelHeight),x=Math.floor(T.z/this.voxelWidth),b<0&&(b=0),b!==c&&p.isAdditive()&&(c=b),p.toolType!=="Extruder"){w.next=35;break}E=null;try{E=h[b][A][x]}catch{E=null}if(E)E.voxelEvents.push(m);else try{Object.prototype.hasOwnProperty.call(h[b],A)||(h[b][A]={}),h[b][A][x]={color:_.color,voxelEvents:[m]}}catch(z){console.log(z),console.log("".concat(A,"  ").concat(b," ").concat(x))}w.next=51;break;case 35:this.hasSubtractive=!0,R=b;case 37:if(!(R<=c+1)){w.next=51;break}w.prev=38,h[R][A][x]?h[R][A][x].voxelEvents.push(m):(Object.prototype.hasOwnProperty.call(h[R],A)||(h[R][A]={}),h[R][A][x]={color:_.color,voxelEvents:[m]}),w.next=48;break;case 42:if(w.prev=42,w.t0=w.catch(38),!(R<0)){w.next=46;break}return w.abrupt("continue",48);case 46:Object.prototype.hasOwnProperty.call(h[R],A)||(h[R][A]={}),h[R][A][x]={color:_.color,voxelEvents:[m]};case 48:R++,w.next=37;break;case 51:if(r[d]=null,!(d%1e4==0||new Date-f>5e3)){w.next=57;break}return f=new Date,this.loadingProgressCallback(d/r.length,"Generating Voxel Map..."),w.next=57,Ql();case 57:v++,w.next=22;break;case 60:d++,w.next=10;break;case 63:this.loadingProgressCallback(d/r.length,"Rendering Voxel..."),C=Ft().mark(function z(F){var W,X,he,H,G,k,M,V,j,ae,ge,$,le,xe,ue,Se,ze,pe,Pe,me,Ke,et,ft,wt,mi,Zt,li,Qs,nr;return Ft().wrap(fs=>{for(;;)switch(fs.prev=fs.next){case 0:if(W=[],h[F]!==void 0){fs.next=3;break}return fs.abrupt("return","continue");case 3:for(X=999999999999,he=-999999999999,H=[],G=0,k=Object.entries(h[F]);G<k.length;G++)for(M=C1(k[G],2),V=M[0],j=M[1],ae=0,ge=Object.entries(j);ae<ge.length;ae++)le=C1(ge[ae],2),xe=le[0],(ue=le[1]).voxelEvents[0].filePosition<X&&(X=ue.voxelEvents[0].filePosition),ue.voxelEvents.slice()[0].filePosition>he&&(he=ue.voxelEvents[0].filePosition),($=H).push.apply($,M1(ue.voxelEvents.map(hi=>hi.filePosition))),ue.color.a=1,(Se={matrix:L.Identity(),color:ue.color.clone(),voxelEvents:ue.voxelEvents,lastDrawnCount:0}).matrix.setTranslation(new y(V*D.voxelWidth,F*D.voxelHeight,xe*D.voxelWidth)),W.push(Se);for(ze=0,H=H.sort((hi,Ui)=>hi-Ui),H=M1(new Set(H)),W.length,h[F]=null,(pe=D.buildBox()).alphaIndex=F,pe.renderingGroupId=1,Pe=new Float32Array(16*W.length),me=new Float32Array(4*W.length),Ke=0;Ke<W.length;Ke++){et=W[Ke];try{et&&(et.matrix.copyToArray(Pe,16*Ke),et.color.toArray(me,4*Ke),D.hasSubtractive||delete et.matrix)}catch(hi){console.log(hi)}}if(pe.thinInstanceSetBuffer("matrix",Pe,16,!1),pe.thinInstanceSetBuffer("color",me,4,!1),pe.thinInstanceRefreshBoundingInfo(),ft=()=>{for(var hi=!1,Ui=!1,Kt=0;Kt<W.length;Kt++){var ui=W[Kt];Zt&&(D.clearColor.toArray(me,4*Kt),D.hasSubtractive&&D.lostInSpace.copyToArray(Pe,16*Kt));var Js=ui.voxelEvents.filter(za=>za.filePosition<D.currentFilePosition).slice(-1)[0];Js!=null&&(Js.add?(Js.filePosition>wt&&Js.filePosition<=D.currentFilePosition&&(ui.lastDrawnCount=0,D.hasSubtractive&&ui.matrix.copyToArray(Pe,16*Kt)),Zt&&(ui.lastDrawnCount=i.drawDelay),ui.lastDrawnCount<i.drawDelay?(D.additiveColor.toArray(me,4*Kt),ui.lastDrawnCount++):(ui.color.toArray(me,4*Kt),D.hasSubtractive&&ui.matrix.copyToArray(Pe,16*Kt))):(Js.filePosition>=wt&&Js.filePosition<=D.currentFilePosition&&(ui.lastDrawnCount=0),Zt&&(ui.lastDrawnCount=i.drawDelay),ui.lastDrawnCount<i.drawDelay?(D.subtractiveColor.toArray(me,4*Kt),ui.lastDrawnCount++):(hi=!0,D.clearColor.toArray(me,4*Kt),D.hasSubtractive&&D.lostInSpace.copyToArray(Pe,16*Kt),Ui=!0)))}pe.thinInstanceBufferUpdated("color"),hi&&pe.thinInstanceRefreshBoundingInfo(),Ui&&(pe.thinInstanceRefreshBoundingInfo(),pe.thinInstanceBufferUpdated("matrix"))},wt=0,mi=!0,Zt=!1,li=Number.MAX_VALUE,Qs=Date.now(),nr=()=>{if(!(D.isLoading||Date.now()-Qs<200)){if(Qs=Date.now(),D.doScrub(wt,X,he)||mi||D.forceRedraw){ze=0,Zt=!0,D.forceRedraw=!1;for(var hi=0;hi<W.length;hi++)W[hi].voxelEvents.forEach(Kt=>Kt.complete=!1);ft(),mi=!1}else if(ze<H.length-1&&H[ze]<D.currentFilePosition){Zt=!1,li=0,ft();for(var Ui=ze;Ui<H.length&&(ze=Ui,!(H[Ui]>D.currentFilePosition));Ui++);}else li<10&&(li++,ft());wt=D.currentFilePosition}},D.loadingProgressCallback&&D.loadingProgressCallback(F/c,"Rendering Voxels..."),D.renderFuncs.push(nr),D.scene.registerBeforeRender(nr),!(new Date-f>1e3)){fs.next=36;break}return f=new Date,fs.next=36,Ql();case 36:case"end":return fs.stop()}},z,this)}),I=0;case 67:if(!(I<c)){w.next=75;break}return w.delegateYield(C(I),"t1",69);case 69:if(w.t1!=="continue"){w.next=72;break}return w.abrupt("continue",72);case 72:I++,w.next=67;break;case 75:this.isLoading=!1,this.loadingProgressCallback(1),h=null;case 78:case"end":return w.stop()}},s,this,[[38,42]])})),function(s){return e.apply(this,arguments)})}]),i}();Ix(Cx,"drawDelay",5);var w1=function(n){$s(t,Gh);var e=Zs(t);function t(i,s,r,a,o,l){var h;return kt(this,t),(h=e.call(this,i,s,r,a,o)).meshIndex=l??0,h.additiveColor=new K(0,1,0,.8),h.travels=!1,h.travelColorArray=[new K(1,0,0,1),new K(1,0,0,1)],h}return Vt(t,[{key:"render",value:function(i){var s=this,r=new Array(i.length);this.renderMode="Line Rendering";for(var a=new Array(i.length),o=new Array(i.length),l=new Array(i.length),h=new Array(i.length),u=new Array(i.length),c=new Array(i.length),f=0;f<i.length;f++){var d=i[f];if(d==null)break;var _=this.tools[d.tool];r[f]=d.gcodeFilePosition;var p=d.getPoints(this.scene);a[f]=p.points,o[f]=this.travels?this.travelColorArray:p.colors,u[f]=d.tool,c[f]=d.isPerimeter,l[f]=_.isAdditive()&&!this.travels,h[f]=!1}var g=Ti.CreateLineSystem(this.travels?"travels":"lineMesh",{lines:a,colors:o,updatable:!0},this.scene);a=null,g.isVisible=!0,g.isPickable=!1,g.markVerticesDataAsUpdatable(S.ColorKind),g.material.backFaceCulling=!1,g.material.forceDepthWrite=!0,g.material.specularColor=this.specularColor,g.alphaIndex=this.meshIndex,g.renderingGroupId=2;var m=r[0],v=r.slice(-1)[0],T=0,A=!1,b=0,x=function(){var C=g.getVerticesData(S.ColorKind);if(C){var I=-1,D=-1;if(A){for(var w=0;w<r.length;w++){var z=8*w;s.canUpdateColor()&&!s.travels&&(c[w]?o[w]=[s.tools[u[w]].color,s.tools[u[w]].color]:o[w]=[s.tools[u[w]].colorDarker,s.tools[u[w]].colorDarker]),s.travels&&!s.persistTravels?(C[z+3]=0,C[z+7]=0,h[w]=r[w]<=s.currentFilePosition):s.travels&&s.persistTravels?(o[w][0].toArray(C,z),o[w][1].toArray(C,z+4),C[z+3]=r[w]<=s.currentFilePosition?1:0,C[z+7]=r[w]<=s.currentFilePosition?1:0,h[w]=r[w]<=s.currentFilePosition):r[w]<=s.currentFilePosition&&!s.progressMode?(o[w][0].toArray(C,z),o[w][1].toArray(C,z+4),C[z+3]=l[w]?1:0,C[z+7]=l[w]?1:0,h[w]=!0):(s.progressMode&&(o[w][0].toArray(C,z),o[w][1].toArray(C,z+4),C[z+3]=s.getTransparentValue(),C[z+7]=s.getTransparentValue()),C[z+3]=l[w]?s.getTransparentValue():0,C[z+7]=l[w]?s.getTransparentValue():0,h[w]=!1)}b=0,g.updateVerticesData(S.ColorKind,C,!0)}for(var F=b;F<r.length;F++)r[F]<=s.currentFilePosition&&(I=F),r[F]<=s.currentFilePosition&&(D=F);for(var W=h.findIndex(G=>G===!1);W<=I;W++){var X=8*W;if(l[W]||s.travels&&s.persistTravels){if(h[W])continue;s.progressMode||C[X+3]<=.5?(C[X]=s.progressColor.r,C[X+1]=s.progressColor.g,C[X+2]=s.progressColor.b,C[X+3]=.9,C[X+4]=s.progressColor.r,C[X+5]=s.progressColor.g,C[X+6]=s.progressColor.b,C[X+7]=.9):C[X+3]<1?(C[X+3]+=.02,C[X+7]+=.02):C[X+3]>=1&&(C[X]=o[W][0].r,C[X+1]=o[W][0].g,C[X+2]=o[W][0].b,C[X+3]=1,C[X+4]=o[W][1].r,C[X+5]=o[W][1].g,C[X+6]=o[W][1].b,C[X+7]=1,h[W]=!0)}else{if(h[W])continue;C[X+3]===0?(C[X]=1,C[X+1]=0,C[X+2]=0,C[X+3]=.9,C[X+4]=1,C[X+5]=0,C[X+6]=0,C[X+7]=.9):C[X+3]<1?(C[X+3]+=.02,C[X+7]+=.02):(C[X+3]=1e-4,C[X+7]=1e-4,h[W]=!0)}b=W}for(var he=I;he<D;he++){var H=8*he;C[H+3]=1,C[H+7]=1}g.updateVerticesData(S.ColorKind,C,!0)}else console.log("Error")},E=Date.now(),R=function(){if(!(s.isLoading||Date.now()-E<200)){if(E=Date.now(),s.doScrub(T,m,v)||s.forceRedraw){s.forceRedraw=!1,A=!0;for(var C=0;C<h.length;C++)h[C]=!1;b=0,T=0,x()}else s.currentFilePosition>=m-3e4&&s.currentFilePosition<=v+3e4&&(A=!1,x());T=s.currentFilePosition}};this.renderFuncs.push(R),this.scene.registerBeforeRender(R)}}]),t}(),Vr=function(){function n(){kt(this,n),Ix(this,"unknownFeatureColor",new K(.5,.5,.5,1)),this.feature=null,this.perimeter=!0,this.support=!1,this.missingFeatures=[]}return Vt(n,[{key:"isTypeComment",value:function(e){return!1}},{key:"getFeatureColor",value:function(e){return new K(1,1,1,1)}},{key:"isPerimeter",value:function(){return this.perimeter}},{key:"isSupport",value:function(){return this.support}},{key:"processComments",value:function(e,t){}},{key:"reportMissingFeature",value:function(e){this.missingFeatures.includes(e)||(console.error("Missing feature ".concat(e)),this.missingFeatures.push(e))}}]),n}(),CC=function(n){$s(t,Vr);var e=Zs(t);function t(){var i;return kt(this,t),(i=e.call(this)).featureList={Perimeter:{color:new K(1,.9,.3,1),perimeter:!1,support:!1},"External perimeter":{color:new K(1,.5,.2,1),perimeter:!0,support:!1},"Internal infill":{color:new K(.59,.19,.16,1),perimeter:!1,support:!1},"Solid infill":{color:new K(.59,.19,.8,1),perimeter:!1,support:!1},"Top solid infill":{color:new K(.95,.25,.25,1),perimeter:!0,support:!1},"Bridge infill":{color:new K(.3,.5,.73,1),perimeter:!1,support:!1},"Gap fill":{color:new K(1,1,1,1),perimeter:!1,support:!1},Skirt:{color:new K(0,.53,.43,1),perimeter:!1,support:!1},"Skirt/Brim":{color:new K(0,.53,.43,1),perimeter:!1,support:!1},"Supported material":{color:new K(0,1,0,1),perimeter:!1,support:!0},"Supported material interface":{color:new K(0,.5,0,1),perimeter:!1,support:!0},Custom:{color:new K(.5,.5,.5,1),perimeter:!1,support:!1},Unknown:{color:new K(.5,.5,.5,1),perimeter:!1,support:!1},"Support material":{color:new K(.5,.5,.5,1),perimeter:!1,support:!0},"Support material interface":{color:new K(.5,.5,.5,1),perimeter:!1,support:!0},"Overhang perimeter":{color:new K(.5,.5,.5,1),perimeter:!0,support:!1},"Wipe tower":{color:new K(.5,.5,.5,1),perimeter:!0,support:!1}},i}return Vt(t,[{key:"isTypeComment",value:function(i){return!!i.trim().startsWith(";TYPE:")&&(this.feature=i.substring(6).trim(),!0)}},{key:"getFeatureColor",value:function(){if(Object.prototype.hasOwnProperty.call(this.featureList,this.feature))try{return this.featureList[this.feature].color}catch{this.reportMissingFeature(this.feature)}return this.unknownFeatureColor}},{key:"isPerimeter",value:function(){try{return this.featureList[this.feature].perimeter}catch{return this.reportMissingFeature(this.feature),!0}}},{key:"isSupport",value:function(){try{return this.featureList[this.feature].support}catch{return this.reportMissingFeature(this.feature),!1}}},{key:"processComments",value:function(i,s){try{for(var r=i.length-350;r<i.length-1;r++){var a=i[r];if(a.includes("nozzle_diameter"))for(var o=a.indexOf("=")+1,l=a.substring(o).split(","),h=0;h<l.length;h++)s.tools.length<h&&(s.tools[h].diameter=l[h])}}catch(u){console.error(u)}}}]),t}(),MC=function(n){$s(t,Vr);var e=Zs(t);function t(){var i;return kt(this,t),(i=e.call(this)).featureList={SKIN:{color:new K(1,.9,.3,1),perimeter:!0,support:!1},"WALL-OUTER":{color:new K(1,.5,.2,1),perimeter:!0,support:!1},"WALL-INNER":{color:new K(.59,.19,.16,1),perimeter:!1,support:!1},FILL:{color:new K(.95,.25,.25,1),perimeter:!1,support:!1},SKIRT:{color:new K(0,.53,.43,1),perimeter:!1,support:!1},SUPPORT:{color:new K(0,.53,.43,1),perimeter:!1,support:!0},CUSTOM:{color:new K(.5,.5,.5,1),perimeter:!1,support:!1},UNKNOWN:{color:new K(.5,.5,.5,1),perimeter:!1,support:!1}},i}return Vt(t,[{key:"isTypeComment",value:function(i){return!!i.trim().startsWith(";TYPE:")&&(this.feature=i.substring(6).trim(),!0)}},{key:"getFeatureColor",value:function(){if(Object.prototype.hasOwnProperty.call(this.featureList,this.feature))try{return this.featureList[this.feature].color}catch{this.reportMissingFeature(this.feature)}return this.unknownFeatureColor}},{key:"isPerimeter",value:function(){try{return this.featureList[this.feature].perimeter}catch{return this.reportMissingFeature(this.feature),!0}}},{key:"isSupport",value:function(){try{return this.featureList[this.feature].support}catch{return this.reportMissingFeature(this.feature),!1}}}]),t}(),PC=function(n){$s(t,Vr);var e=Zs(t);function t(){var i;return kt(this,t),(i=e.call(this)).featureList={Perimeter:{color:new K(1,.9,.3,1),perimeter:!1,support:!1},"External perimeter":{color:new K(1,.5,.2,1),perimeter:!0,support:!1},"Internal infill":{color:new K(.59,.19,.16,1),perimeter:!1,support:!1},"Solid infill":{color:new K(.59,.19,.8,1),perimeter:!1,support:!1},"Top solid infill":{color:new K(.95,.25,.25,1),perimeter:!0,support:!1},"Bridge infill":{color:new K(.3,.5,.73,1),perimeter:!1,support:!1},"Gap fill":{color:new K(1,1,1,1),perimeter:!1,support:!1},Skirt:{color:new K(0,.53,.43,1),perimeter:!1,support:!1},"Skirt/Brim":{color:new K(0,.53,.43,1),perimeter:!1,support:!1},"Supported material":{color:new K(0,1,0,1),perimeter:!1,support:!0},"Supported material interface":{color:new K(0,.5,0,1),perimeter:!1,support:!0},Custom:{color:new K(.5,.5,.5,1),perimeter:!1,support:!1},Unknown:{color:new K(.5,.5,.5,1),perimeter:!1,support:!1},"Support material":{color:new K(.5,.5,.5,1),perimeter:!1,support:!1},"Support material interface":{color:new K(.5,.5,.5,1),perimeter:!1,support:!1},"Overhang perimeter":{color:new K(.5,.5,.5,1),perimeter:!0,support:!1},"Wipe tower":{color:new K(.5,.5,.5,1),perimeter:!1,support:!1}},i}return Vt(t,[{key:"isTypeComment",value:function(i){return!!i.trim().startsWith(";TYPE:")&&(this.feature=i.substring(6).trim(),!0)}},{key:"getFeatureColor",value:function(){if(Object.prototype.hasOwnProperty.call(this.featureList,this.feature))try{return this.featureList[this.feature].color}catch{this.reportMissingFeature(this.feature)}return this.unknownFeatureColor}},{key:"isPerimeter",value:function(){try{return this.featureList[this.feature].perimeter}catch{return this.reportMissingFeature(this.feature),!0}}},{key:"isSupport",value:function(){try{return this.featureList[this.feature].support}catch{return this.reportMissingFeature(this.feature),!1}}}]),t}(),wC=function(n){$s(t,Vr);var e=Zs(t);function t(){var i;return kt(this,t),(i=e.call(this)).featureList={"WALL-OUTER":{color:new K(.47,.18,.18,1),perimeter:!0,support:!1},"WALL-INNER":{color:new K(0,.55,0,1),perimeter:!1,support:!1},FILL:{color:new K(.9,.2,.2,1),perimeter:!1,support:!1},"SOLID-FILL":{color:new K(.95,.25,.25,1),perimeter:!1,support:!1},BRIDGE:{color:new K(.9,.15,.195,1),perimeter:!1,support:!1},SKIRT:{color:new K(.31,.12,.33,1),perimeter:!1,support:!1},SUPPORT:{color:new K(0,.53,.43,1),perimeter:!1,support:!0},"DENSE-SUPPORT":{color:new K(0,.28,.55,1),perimeter:!1,support:!0},RAFT:{color:new K(.59,.49,.2,1),perimeter:!1,support:!1},CUSTOM:{color:new K(.5,.5,.5,1),perimeter:!1,support:!1},UNKNOWN:{color:new K(.5,.5,.5,1),perimeter:!1,support:!1}},i}return Vt(t,[{key:"isTypeComment",value:function(i){return!!i.trim().startsWith(";TYPE:")&&(this.feature=i.substring(6).trim(),!0)}},{key:"getFeatureColor",value:function(){if(Object.prototype.hasOwnProperty.call(this.featureList,this.feature))try{return this.featureList[this.feature].color}catch{this.reportMissingFeature(this.feature)}return this.unknownFeatureColor}},{key:"isPerimeter",value:function(){try{return this.featureList[this.feature].perimeter}catch{return this.reportMissingFeature(this.feature),!0}}},{key:"isSupport",value:function(){try{return this.featureList[this.feature].support}catch{return this.reportMissingFeature(this.feature),!1}}}]),t}(),DC=function(n){$s(t,Vr);var e=Zs(t);function t(){var i;return kt(this,t),(i=e.call(this)).featureList={shells:{color:new K(1,.9,.3,1),perimeter:!0,support:!1},"sparse infill":{color:new K(.59,.19,.16,1),perimeter:!1,support:!1},"solid fill":{color:new K(.59,.19,.8,1),perimeter:!0,support:!1},Unknown:{color:new K(.5,.5,.5,1),perimeter:!1,support:!1},"Support material":{color:new K(.5,.5,.5,1),perimeter:!1,support:!0},"Support material interface":{color:new K(.5,.5,.5,1),perimeter:!1,support:!0},"Overhang perimeter":{color:new K(.5,.5,.5,1),perimeter:!0,support:!1},"Wipe tower":{color:new K(.5,.5,.5,1),perimeter:!0,support:!1}},i}return Vt(t,[{key:"isTypeComment",value:function(i){return!!i.trim().startsWith("; feature")&&(this.feature=i.substring(9).trim(),!0)}},{key:"getFeatureColor",value:function(){if(Object.prototype.hasOwnProperty.call(this.featureList,this.feature))try{return this.featureList[this.feature].color}catch{this.reportMissingFeature(this.feature)}return this.unknownFeatureColor}},{key:"isPerimeter",value:function(){try{return this.featureList[this.feature].perimeter}catch{return this.reportMissingFeature(this.feature),!0}}},{key:"isSupport",value:function(){try{return this.featureList[this.feature].support}catch{return this.reportMissingFeature(this.feature),!1}}},{key:"processComments",value:function(i,s){try{for(var r=i.length-350;r<i.length-1;r++){var a=i[r];if(a.includes("nozzle_diameter"))for(var o=a.indexOf("=")+1,l=a.substring(o).split(","),h=0;h<l.length;h++)s.tools.length<h&&(s.tools[h].diameter=l[h])}}catch(u){console.error(u)}}}]),t}(),OC=function(n){$s(t,Vr);var e=Zs(t);function t(){var i;return kt(this,t),(i=e.call(this)).featureList={"Outer wall":{color:new K(1,.9,.3,1),perimeter:!0,support:!1},"Inner wall":{color:new K(1,.49,.22,1),perimeter:!1,support:!1},"Overhang wall":{color:new K(.15,.16,.75,1),perimeter:!1,support:!1},"Sparse infill":{color:new K(.69,.19,.16,1),perimeter:!1,support:!1},"Internal solid infill":{color:new K(.59,.33,.8,1),perimeter:!1,support:!1},"Top surface":{color:new K(.7,.22,.22,1),perimeter:!0,support:!1},"Bottom surface":{color:new K(.4,.36,.78,1),perimeter:!0,support:!1},Bridge:{color:new K(.3,.5,.73,1),perimeter:!1,support:!1},Custom:{color:new K(.37,.82,.58,1),perimeter:!1,support:!1},Support:{color:new K(0,1,0,1),perimeter:!1,support:!0},"Support interface":{color:new K(.12,.38,.13,1),perimeter:!1,support:!0},"Prime tower":{color:new K(.7,.89,.67,1),perimeter:!1,support:!1},"Internal Bridge":{color:new K(.3,.5,.73,1),perimeter:!1,support:!1},Skirt:{color:new K(0,.53,.43,1),perimeter:!1,support:!1}},i}return Vt(t,[{key:"isTypeComment",value:function(i){return!!i.trim().startsWith(";TYPE:")&&(this.feature=i.substring(6).trim(),!0)}},{key:"getFeatureColor",value:function(){if(Object.prototype.hasOwnProperty.call(this.featureList,this.feature))try{return this.featureList[this.feature].color}catch{this.reportMissingFeature(this.feature)}return this.unknownFeatureColor}},{key:"isPerimeter",value:function(){try{return this.featureList[this.feature].perimeter}catch{return this.reportMissingFeature(this.feature),!0}}},{key:"isSupport",value:function(){try{return this.featureList[this.feature].support}catch{return this.reportMissingFeature(this.feature),!1}}},{key:"processComments",value:function(i,s){try{for(var r=i.length-350;r<i.length-1;r++){var a=i[r];if(a.includes("nozzle_diameter"))for(var o=a.indexOf("=")+1,l=Number(a.substring(o)),h=0;h<s.tools.length;h++)s.tools.length<h&&(s.tools[h].diameter=l)}}catch(u){console.error(u)}}}]),t}(),FC=function(){function n(){kt(this,n)}return Vt(n,null,[{key:"getSlicer",value:function(e){if(!e)return null;var t=e.substring(0,1e4);return t.includes("; generated by PrusaSlicer")?new CC:t.includes(";Generated with Cura_SteamEngine")?new MC:t.includes("; generated by SuperSlicer")?new PC:t.includes("Sliced by ideaMaker")?new wC:t.includes("; Generated by Kiri:Moto")?new DC:t.includes("generated by OrcaSlicer ")?new OC:new Vr}}]),n}(),D1=1e6,LC=function(){function n(){kt(this,n),this.currentPosition=new y(0,0,0),this.currentColor=new K(.25,.25,.25,1),this.currentTool=0,this.renderVersion=lr.Line,this.absolute=!0,this.linesIndex=0,this.lines=[],this.renderedLines=[],this.currentLineNumber=0,this.lastFilePositionIndex=0,this.travels=[],this.sps,this.maxHeight=0,this.minHeight=0,this.lineCount=0,this.renderMode="",this.extruderCount=10,this.layerDictionary=[],this.previousLayerHeight=0,this.currentLayerHeight=0,this.liveTracking=!1,this.liveTrackingShowSolid=localStorage.getItem("showSolid")==="true",this.gcodeLineIndex=[],this.gcodeFilePosition=0,this.refreshTime=200,this.timeStamp=0,this.lineLengthTolerance=.05,this.tools=new Array;for(var a=["#00FFFF","#FF00FF","#FFFF00","#000000","#FFFFFF"],o=0;o<5;o++){var l=new W0;l.color=K.FromHexString(a[o]),l.diameter=.4,this.tools.push(l)}this.progressColor=new K(0,1,0,1),this.keepProgressColor=!1,this.lineMeshIndex=0,this.scene=null,this.renderFuncs=new Array,this.meshBreakPoint=1e5,this.feedRateTrimming=!1,this.currentFeedRate=0,this.feedValues=0,this.numChanges=0,this.avgFeed=0,this.maxFeedRate=0,this.minFeedRate=Number.MAX_VALUE,this.underspeedPercent=1,this.colorMode=Number.parseInt(localStorage.getItem("processorColorMode"),10),this.colorMode||this.setColorMode(ln.Color),this.minColorRate=Number.parseInt(localStorage.getItem("minColorRate"),10),this.minColorRate||(this.minColorRate=1200,localStorage.setItem("minColorRate",this.minColorRate)),this.maxColorRate=Number.parseInt(localStorage.getItem("maxColorRate"),10),this.maxColorRate||(this.maxColorRate=3600,localStorage.setItem("maxColorRate",this.maxColorRate)),this.minFeedColorString=localStorage.getItem("minFeedColor"),this.minFeedColorString||(this.minFeedColorString="#0000FF"),this.minFeedColor=K.FromHexString(this.minFeedColorString.padEnd(9,"F")),this.maxFeedColorString=localStorage.getItem("maxFeedColor"),this.maxFeedColorString||(this.maxFeedColorString="#FF0000"),this.maxFeedColor=K.FromHexString(this.maxFeedColorString.padEnd(9,"F")),this.everyNthRow=0,this.currentRowIdx=-1,this.currentZ=0,this.renderTravels=!0,this.persistTravels=!1,this.vertexAlpha=!1,this.forceWireMode=localStorage.getItem("forceWireMode")==="true",this.spreadLines=!1,this.spreadLineAmount=10,this.debug=!1,this.specularColor=new fe(0,0,0),this.cancelLoad=!1,this.loadingProgressCallback=()=>{},this.hasSpindle=!1,this.voxelWidth=1,this.voxelHeight=1,this.forceVoxels=!1,this.renderInstances=new Array,this.meshIndex=0,this.highQualityExtrusion=!1,this.perimeterOnly=!1,this.lastUpdate=Date.now(),this.g1AsExtrusion=!1,this.firstGCodeByte=0,this.lastGCodeByte=0,this.zBelt=!1,this.gantryAngle=45*Math.PI/180,this.hyp=Math.cos(this.gantryAngle),this.adj=Math.tan(this.gantryAngle),this.currentZ=0,this.beltLength=100,this.nozzleStartPosition=new y(0,0,0),this.nozzlePosition=new y(0,0,0),this.nozzleFeedRate=0,this.firmwareRetraction=!1,this.inches=!1,this.fixRadius=!1,this.csysContainers=new Array,this.lastCommand="G0",this.arcPlane="XY",this.workplaceOffsets=[new y(0,0,0),new y(0,0,0)],this.currentWorkplace=0,this.progressMode=!1,this.transparentValue=.25,this.hasMixing=!1,this.renderAnimation=!0}var e,t,i,s,r;return Vt(n,[{key:"doUpdate",value:function(){this.lastUpdate=Date.now()}},{key:"setProgressColor",value:function(a){var o=this;this.progressColor=K.FromHexString(a.padEnd(9,"F")),this.renderInstances.forEach(l=>l.progressColor=o.progressColor)}},{key:"getMaxHeight",value:function(){return this.maxHeight+1}},{key:"getMinHeight",value:function(){return this.minHeight}},{key:"setRenderQualitySettings",value:function(a,o){if(this.forceVoxels)return this.renderVersion=lr.Voxel,this.meshBreakPoint=D1,void(this.lines=new Array(D1));this.lines=new Array(1.5*this.meshBreakPoint),o===void 0&&(o=1);var l=0,h=this.forceWireMode?2:1,u=2;switch(this.refreshTime=5e3,this.everyNthRow=1,this.renderTravels=!0,o){case 1:h=2,this.refreshTime=3e4,l=25e3,u=50,this.renderTravels=!1;break;case 2:h=2,this.refreshTime=3e4,l=5e5,u=10,this.renderTravels=!1;break;case 3:l=1e6,u=3;break;case 4:l=15e6,u=2;break;case 5:l=25e6;break;default:return this.renderVersion=lr.Block,void(this.everyNthRow=1)}for(var c=h;c<4;c++){var f=void 0;switch(c){case 1:f=24;break;case 2:f=2;break;case 3:f=1}for(var d=this.everyNthRow;d<=u;d++)if(this.debug&&console.log("Mode: "+c+"  NRow: "+d+"   vertexcount: "+a*f/d),a*f/d<l)return this.renderVersion=c,void(this.everyNthRow=d)}}},{key:"initVariables",value:function(){this.currentPosition=new y(this.workplaceOffsets[this.currentWorkplace].x,this.workplaceOffsets[this.currentWorkplace].z,this.workplaceOffsets[this.currentWorkplace].y),this.cancelLoad=!1,this.absolute=!0,this.currentZ=0,this.currentRowIdx=-1,this.gcodeLineIndex=[],this.lineMeshIndex=0,this.previousLayerHeight=this.currentPosition.y,this.currentLayerHeight=this.currentPosition.y,this.minFeedRate=Number.MAX_VALUE,this.maxFeedRate=0,this.hasSpindle=!1,this.currentColor=new K(1,1,1,1),this.slicer=null,this.skip=!1,this.isSupport=!1,this.currentTool=0,this.firstGCodeByte=0,this.lastGCodeByte=0,this.layerDictionary=[],this.lastZExtrusion=0,this.renderedLines=[],this.beltLength=0,this.lastCommand="G0",this.lines=new Array(1.5*this.meshBreakPoint),this.linesIndex=0,this.hasMixing=!1,this.workplaceOffsets.length===0&&(this.workplaceOffsets=[new y(0,0,0)],this.currentWorkplace=0)}},{key:"g0g1",value:function(a,o,l,h,u){var c,f,d=a.split(/(?=[GXYZEFUVAB])/),_=new P1,p=!1;_.tool=this.currentTool,_.gcodeLineNumber=o,_.gcodeFilePosition=l,_.start=this.currentPosition.clone(),_.feedRate=this.currentFeedRate,_.isPerimeter=this.slicer.isPerimeter(),u[0]!=="G1"&&u[0]!=="G01"||!this.g1AsExtrusion||(_.extruding=!0,_.color=(c=(f=this.tools[this.currentTool])===null||f===void 0?void 0:f.color.clone())!==null&&c!==void 0?c:this.tools[0].color.clone(),this.maxHeight=this.zBelt?this.currentPosition.z:this.currentPosition.y),this.zBelt&&(d=d.sort().reverse());for(var g=0;g<d.length;g++){var m=d[g];switch(m[0]){case"X":this.zBelt?this.currentPosition.x=Number(m.substring(1)):this.currentPosition.x=this.absolute?Number(m.substring(1))+this.workplaceOffsets[this.currentWorkplace].x:this.currentPosition.x+Number(m.substring(1)),p=!0;break;case"Y":this.zBelt?(this.currentPosition.y=Number(m.substring(1))*this.hyp,this.currentPosition.z=this.currentZ+this.currentPosition.y*this.adj):this.currentPosition.z=this.absolute?Number(m.substring(1))+this.workplaceOffsets[this.currentWorkplace].y:this.currentPosition.z+Number(m.substring(1)),p=!0;break;case"Z":this.zBelt?(this.currentZ=-Number(m.substring(1)),this.currentPosition.z=this.currentZ+this.currentPosition.y*this.adj,p=!0):(this.currentPosition.y=this.absolute?Number(m.substring(1))+this.workplaceOffsets[this.currentWorkplace].z:this.currentPosition.y+Number(m.substring(1)),this.lastY&&this.lastY===this.currentPosition.y||(this.lastY=this.currentPosition.y,this.lastY===void 0&&(this.lastY=0)),this.currentPosition.y<this.minHeight&&(this.minHeight=this.currentPosition.y),this.spreadLines&&(this.currentPosition.y*=this.spreadLineAmount));break;case"E":Number(m.substring(1))>0&&(_.extruding=!0,this.maxHeight=this.currentPosition.y);break;case"F":if(this.currentFeedRate=Number(m.substring(1)),_.feedRate=this.currentFeedRate,this.currentFeedRate>this.maxFeedRate&&(this.maxFeedRate=this.currentFeedRate),this.currentFeedRate<this.minFeedRate&&(this.minFeedRate=this.currentFeedRate),this.colorMode===ln.Feed){var v=(this.currentFeedRate-this.minColorRate)/(this.maxColorRate-this.minColorRate);this.currentColor=v>=1?this.maxFeedColor:v<=0?this.minFeedColor:K.Lerp(this.minFeedColor,this.maxFeedColor,v)}}}if(this.zBelt&&(this.beltLength=this.currentPosition.z<this.beltLength?this.currentPosition.z:this.beltLength),!(_.extruding&&this.skip||(_.end=this.currentPosition.clone(),this.debug,this.feedRateTrimming&&(this.feedValues+=this.currentFeedRate,this.numChanges++,this.avgFeed=this.feedValues/this.numChanges*this.underspeedPercent),this.everyNthRow>1&&_.extruding&&(this.currentPosition.y>this.currentZ&&(this.currentRowIdx++,this.currentRowIdx%3==0&&this.currentRowIdx++,this.currentZ=this.currentPosition.y),this.currentRowIdx%this.everyNthRow==0&&this.currentRowIdx>2)))){var T=this.hasSpindle&&u[0]==="G1",A=this.g1AsExtrusion||_.length()>=this.lineLengthTolerance;h&&(this.renderedLines.push(_),_.extruding&&this.lastZExtrusion<this.currentPosition.y&&(this.layerDictionary.push(l),this.lastZExtrusion=this.currentPosition.y),T||A&&_.extruding?(this.currentColor===null&&(this.currentColor=new K(1,1,1,1)),_.color=this.currentColor.clone(),this.lines[this.linesIndex++]=_,this.zBelt&&this.currentZ<this.currentLayerHeight&&!this.isSupport?(this.previousLayerHeight=this.currentLayerHeight,this.currentLayerHeight=this.currentZ):!this.zBelt&&this.currentPosition.y>this.currentLayerHeight&&!this.isSupport&&p&&(this.previousLayerHeight=this.currentLayerHeight,this.currentLayerHeight=this.currentPosition.y)):this.renderTravels&&!_.extruding&&(_.color=new K(1,0,0,1),this.travels.push(_)),this.zBelt?_.layerHeight=Math.abs(this.currentLayerHeight-this.previousLayerHeight):this.g1AsExtrusion?_.layerHeight=1:_.layerHeight=this.currentLayerHeight-this.previousLayerHeight)}}},{key:"g2g3",value:function(a,o,l,h){var u=this,c=a.split(/(?=[GXYZIJKFREUVAB])/),f=a.indexOf("E")>0||this.g1AsExtrusion,d=c.filter(g=>g==="G2"||g==="G02"),_={position:this.currentPosition.clone(),points:[]};try{_=function(g,m,v,T,A,b,x){for(var E=new y(m.x,m.z,m.y),R=E.clone(),C=0,I=0,D=0,w=g.some(Qs=>Qs.includes("G2")),z=0;z<g.length;z++){var F=g[z];switch(F[0]){case"X":R.x=Hr(F,R.x,v,x.x);break;case"Y":R.y=Hr(F,R.y,v,x.y);break;case"Z":R.z=Hr(F,R.z,v,x.z);break;case"I":C=Hr(F,C,!1,0);break;case"J":case"K":I=Hr(F,I,!1,0);break;case"R":D=Hr(F,D,!1,0)}}var W="x",X="y",he="z";switch(b){case"XY":W="x",X="y",he="z";break;case"XZ":W="z",X="x",he="y";var H=I;I=C,C=H;break;case"YZ":W="y",X="z",he="x"}if(D){var G=R[W]-E[W],k=R[X]-E[X],M=Math.pow(G,2)+Math.pow(k,2);if(M===0)return{position:E.clone(),points:[]};var V=Math.pow(D,2)-M/4,j=0;if(V>=0)j=Math.sqrt(V/M);else if(V<-.02*Math.pow(D,2)){if(!A)return console.error("G2/G3: Radius too small"),{position:{x:R.x,y:R.z,z:R.y},points:[]};var ae=Math.sqrt(Math.pow(G/2,2)+Math.pow(k/2,2));V=Math.pow(ae,2)-M/4,j=Math.sqrt(V/M)}(w&&D<0||!w&&D>0)&&(j=-j),C=G/2+k*j,I=k/2-G*j}else if(C===0&&I===0)return{position:E.clone(),points:[]};var ge,$=E[W]===R[W]&&E[X]===R[X],le=E[W]+C,xe=E[X]+I,ue=Math.sqrt(C*C+I*I),Se=Math.atan2(-I,-C),ze=Math.atan2(R[X]-xe,R[W]-le);$?ge=2*Math.PI:(ge=w?Se-ze:ze-Se)<0&&(ge+=2*Math.PI);var pe=ue*ge/T;pe<1&&(pe=1);var Pe=ge/pe;Pe*=w?-1:1;for(var me=new Array,Ke=(R[he]-E[he])/pe,et=E[W],ft=E[X],wt=E[he],mi=Se,Zt=0;Zt<pe-1;Zt++){mi+=Pe,et=le+ue*Math.cos(mi),ft=xe+ue*Math.sin(mi),wt+=Ke;var li={};li[W]=et,li[X]=ft,li[he]=wt,me.push({x:li.x,y:li.z,z:li.y})}return me.push({x:R.x,y:R.z,z:R.y}),{position:{x:R.x,y:R.z,z:R.y},points:me}}(c,this.currentPosition,!this.absolute,.1,this.fixRadius,this.arcPlane,this.workplaceOffsets[this.currentWorkplace])}catch(g){console.error("Arc Error",g)}var p=this.currentPosition.clone();_.points.forEach((g,m)=>{var v=new P1;v.tool=u.currentTool,v.gcodeLineNumber=o,v.gcodeFilePosition=l,v.feedRate=u.currentFeedRate,v.isPerimeter=u.slicer.isPerimeter(),u.g1AsExtrusion?v.layerHeight=1:v.layerHeight=u.currentLayerHeight-u.previousLayerHeight,v.start=p.clone(),v.end=new y(g.x,g.y,g.z),v.extruding=f,v.color=f?u.currentColor.clone():new K(1,0,0,1),u.debug&&(v.color=d?new K(0,1,1,1):new K(1,1,0,1),m===0&&(v.color=new K(0,1,0,1))),p=v.end.clone(),u.debug&&console.log(v),h&&(u.renderedLines.push(v),v.extruding?u.lines[u.linesIndex++]=v:u.travels.push(v))}),this.currentPosition=new y(p.x,p.y,p.z),this.currentPosition.y>this.currentLayerHeight&&!this.isSupport&&(this.previousLayerHeight=this.currentLayerHeight,this.currentLayerHeight=this.currentPosition.y)}},{key:"m567",value:function(a){var o=a.split(/(?=[PE])/),l=[1,1,1];if(this.colorMode!==ln.Feed){for(var h=1;h<o.length;h++){var u=o[h];u[0]==="E"&&(this.extruderPercentage=u.substring(1).split(":"))}for(var c=0;c<this.extruderPercentage.length;c++)l[0]-=(1-this.tools[c].color.r)*this.extruderPercentage[c],l[1]-=(1-this.tools[c].color.g)*this.extruderPercentage[c],l[2]-=(1-this.tools[c].color.b)*this.extruderPercentage[c];this.currentColor=new K(l[0],l[1],l[2],.1)}}},{key:"processGcodeFile",value:(r=Vs(Ft().mark(function a(o,l,h){var u,c,f,d,_,p;return Ft().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(this.initVariables(),this.slicer=FC.getSlicer(o),this.meshIndex=0,this.currentTool=0,l==null&&(l=4),o&&o.length!==0){g.next=7;break}return g.abrupt("return");case 7:c=o.split(`
`),this.slicer.processComments(c,this),typeof h=="function"&&h(),this.lineCount=c.length,this.debug&&console.info("Line Count : ".concat(this.lineCount)),this.setRenderQualitySettings(this.lineCount,l),this.tools.length===0&&this.tools.push(new W0),this.currentColor=(u=this.tools[0].color)!==null&&u!==void 0?u:new W0().color,c.reverse(),f=0,d=0,this.timeStamp=Date.now();case 19:if(!c.length){g.next=36;break}if(!this.cancelLoad){g.next=23;break}return this.cancelLoad=!1,g.abrupt("return");case 23:if(_=c.pop(),f+=_.length+1,d++,_.trim(),_.startsWith(";")?this.slicer&&this.slicer.isTypeComment(_)&&(this.isSupport=this.slicer.isSupport(),this.colorMode===ln.Feature&&(this.currentColor=this.slicer.getFeatureColor())):(this.slicer&&this.slicer.isTypeComment(_),p=!this.perimeterOnly||this.slicer&&this.slicer.isPerimeter()||this.g1AsExtrusion,this.firstGCodeByte===0&&_.length>0&&(this.firstGCodeByte=f),this.lastGCodeByte=f,this.processLine(_,d,f,p)),!(Date.now()-this.timeStamp>10)){g.next=33;break}return this.loadingProgressCallback&&this.loadingProgressCallback(f/o.length,"Loading File..."),g.next=32,Ql();case 32:this.timeStamp=g.sent;case 33:this.doUpdate(),g.next=19;break;case 36:if(this.layerDictionary.push(o.length),!this.renderTravels){g.next=40;break}return g.next=40,this.createTravelLines(this.scene);case 40:this.loadingProgressCallback&&this.loadingProgressCallback(1),o={};case 42:case"end":return g.stop()}},a,this)})),function(a,o,l){return r.apply(this,arguments)})},{key:"loadingComplete",value:function(){this.renderInstances.forEach(a=>a.isLoading=!1),this.updateFilePosition(Number.MAX_VALUE-1),this.updateFilePosition(Number.MAX_VALUE)}},{key:"processLine",value:(s=Vs(Ft().mark(function a(o,l,h){var u,c,f,d,_,p,g,m,v,T,A,b,x,E=arguments;return Ft().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:if(u=!(E.length>3&&E[3]!==void 0)||E[3],(c=o.indexOf(";"))>-1&&(o=o.substring(0,c-1).trim()),o=o.toUpperCase(),(d=o.match(/[GM]+[0-9.]+/g))===null&&o.match(/[XYZ]+[+-]?[0-9.]+/g)!==null&&(d=this.lastCommand),_=o.trim().split(/[GM]+[0-9.]+/g),!d){R.next=62;break}p=0;case 9:if(!(p<d.length)){R.next=60;break}R.t0=d[p],R.next=R.t0==="G0"||R.t0==="G1"||R.t0==="G00"||R.t0==="G01"?13:R.t0==="G2"||R.t0==="G3"||R.t0==="G02"||R.t0==="G03"?15:R.t0==="G10"?17:R.t0==="G11"?19:R.t0==="G17"?21:R.t0==="G18"?23:R.t0==="G19"?25:R.t0==="G20"?27:R.t0==="G28"?29:R.t0==="G53"?32:R.t0==="G54"||R.t0==="G55"||R.t0==="G56"||R.t0==="G57"||R.t0==="G58"||R.t0==="G59"?33:R.t0==="G59.1"||R.t0==="G59.2"||R.t0==="G59.2"?36:R.t0==="G90"?39:R.t0==="G91"?41:R.t0==="G92"?43:R.t0==="S"?44:R.t0==="M3"||R.t0==="M4"?46:R.t0==="M567"?51:R.t0==="M600"?54:56;break;case 13:return this.g0g1(_[1+p],l,h,u,d),R.abrupt("break",56);case 15:return this.g2g3(d[p]+" "+_[1+p],l,h,u),R.abrupt("break",56);case 17:return this.firmwareRetraction=!0,R.abrupt("break",56);case 19:return this.firmwareRetraction=!1,R.abrupt("break",56);case 21:return this.arcPlane="XY",R.abrupt("break",56);case 23:return this.arcPlane="XZ",R.abrupt("break",56);case 25:return this.arcPlane="YZ",R.abrupt("break",56);case 27:return this.inches=!0,R.abrupt("break",56);case 29:return(f=o.split(/(?=[GXYZ])/)).length===1||o==="G28 W"?this.currentPosition=new y(this.workplaceOffsets[this.currentWorkplace].x,this.workplaceOffsets[this.currentWorkplace].z,this.workplaceOffsets[this.currentWorkplace].y):(f.some(C=>C.trim()==="X")&&(this.currentPosition.x=this.workplaceOffsets[this.currentWorkplace].x),f.some(C=>C.trim()==="Y")&&(this.currentPosition.z=this.workplaceOffsets[this.currentWorkplace].y),f.some(C=>C.trim()==="Z")&&(this.currentPosition.y=this.workplaceOffsets[this.currentWorkplace].z)),R.abrupt("break",56);case 32:return R.abrupt("break",56);case 33:return this.currentWorkplace=54-Number(d[p].substring(1)),this.currentPosition=this.workplaceOffsets[this.currentWorkplace].clone(),R.abrupt("break",56);case 36:return this.currentWorkplace=10*(58.6-Number(d[p].substring(1))),this.currentPosition=this.workplaceOffsets[this.currentWorkplace].clone(),R.abrupt("break",56);case 39:return this.absolute=!0,R.abrupt("break",56);case 41:return this.absolute=!1,R.abrupt("break",56);case 43:return R.abrupt("break",56);case 44:return this.hasSpindle=!0,R.abrupt("break",56);case 46:return g=o.split(/(?=[SM])/),(m=(m=g.filter(C=>C.startsWith("S")))[0]?Number(m[0].substring(1)):0)>0&&(this.hasSpindle=!0),R.abrupt("break",56);case 51:return this.hasMixing=!0,this.m567(o),R.abrupt("break",56);case 54:try{this.currentTool++,this.currentTool>=this.tools.length&&(this.currentTool=0),this.colorMode!==ln.Feed&&(this.currentColor=this.tools[this.currentTool].color.clone())}catch(C){console.log(C)}return R.abrupt("break",56);case 56:this.lastCommand=d;case 57:p++,R.next=9;break;case 60:R.next=64;break;case 62:o.startsWith("T")&&(v=Number.parseInt(o.substring(1),10),isNaN(v)||(this.currentPosition.z+=10,this.currentTool=v,this.currentTool>=this.tools.length?this.currentTool=this.currentTool%this.tools.length:v<0&&(this.currentTool=0),this.colorMode!==ln.Feed&&((x=Number(o.substring(1))%this.extruderCount)<0&&(x=0),this.currentColor=(T=(A=this.tools[x])===null||A===void 0||(b=A.color)===null||b===void 0?void 0:b.clone())!==null&&T!==void 0?T:new fe(1,0,0)))),this.debug;case 64:if(!(this.linesIndex>=this.meshBreakPoint)){R.next=71;break}return R.next=67,this.createMesh(this.scene);case 67:return R.next=69,Ql();case 69:this.doUpdate(),this.meshIndex++;case 71:case"end":return R.stop()}},a,this)})),function(a,o,l){return s.apply(this,arguments)})},{key:"createMesh",value:(i=Vs(Ft().mark(function a(o){var l,h,u;return Ft().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(this.zBelt&&(l=this.lines[this.linesIndex-1].layerHeight,this.lines.forEach(f=>{f.layerHeight=l})),this.renderVersion===lr.Line||this.renderVersion===lr.Point?h=new w1(o,this.specularColor,this.loadingProgressCallback,this.renderFuncs,this.tools,this.meshIndex):this.renderVersion===lr.Block?h=this.highQualityExtrusion?new RC(o,this.specularColor,this.loadingProgressCallback,this.renderFuncs,this.tools,this.meshIndex):new SC(o,this.specularColor,this.loadingProgressCallback,this.renderFuncs,this.tools,this.meshIndex):this.renderVersion===lr.Voxel&&(h=new Cx(o,this.specularColor,this.loadingProgressCallback,this.renderFuncs,this.tools,this.voxelWidth,this.voxelHeight)),h.progressColor=this.progressColor,h.vertexAlpha=this.vertexAlpha,h.g1AsExtrusion=this.g1AsExtrusion,h.progressMode=this.progressMode,h.transparentValue=this.transparentValue,h.hasMixing=this.hasMixing,h.colorMode=this.colorMode,h.renderAnimation=this.renderAnimation,h.persistTravels=this.persistTravels,this.renderInstances.push(h),!((u=this.lines.slice(0,this.linesIndex-1))!=null&&u.length>0)){c.next=16;break}return c.next=16,h.render(u);case 16:this.linesIndex=0;case 17:case"end":return c.stop()}},a,this)})),function(a){return i.apply(this,arguments)})},{key:"chunk",value:function(a,o){for(var l=[],h=0,u=a.length;h<u;h+=o)l.push(a.slice(h,h+o));return l}},{key:"createTravelLines",value:(t=Vs(Ft().mark(function a(o){var l,h,u;return Ft().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:l=this.chunk(this.travels,2e4),h=0;case 2:if(!(h<l.length)){c.next=13;break}return(u=new w1(o,this.specularColor,this.loadingProgressCallback,this.renderFuncs,this.tools,this.meshIndex)).travels=!0,u.meshIndex=this.meshIndex+1e3,u.persistTravels=this.persistTravels,c.next=9,u.render(l[h]);case 9:this.renderInstances.push(u);case 10:h++,c.next=2;break;case 13:this.travels=[];case 14:case"end":return c.stop()}},a,this)})),function(a){return t.apply(this,arguments)})},{key:"updateFilePosition",value:function(a){this.renderInstances.forEach(l=>l.updateFilePosition(a));try{a<this.renderedLines[this.lastFilePositionIndex].gcodeFilePosition&&(this.lastFilePositionIndex=0,this.currentLineNumber=0)}catch{this.lastFilePositionIndex=0,this.currentLineNumber=0}for(var o=this.lastFilePositionIndex;o<this.renderedLines.length&&!(this.renderedLines[o].gcodeFilePosition>a+5);o++)this.currentLineNumber=this.renderedLines[o].gcodeLineNumber,this.nozzleStartPosition=this.renderedLines[o].start,this.nozzlePosition=this.renderedLines[o].end,this.nozzleFeedRate=this.renderedLines[o].feedRate,this.lastFilePositionIndex=o;this.doUpdate()}},{key:"updateFilePositionIndex",value:function(a){var o=this;a>=this.renderedLines.length||(this.currentLineNumber=this.renderedLines[a].gcodeLineNumber,this.nozzleStartPosition=this.renderedLines[a].start,this.nozzlePosition=this.renderedLines[a].end,this.nozzleFeedRate=this.renderedLines[a].feedRate,this.lastFilePositionIndex=a,this.renderInstances.forEach(l=>l.updateFilePosition(o.renderedLines[a].gcodeFilePosition)),this.doUpdate())}},{key:"doFinalPass",value:function(){var a=this;this.liveTracking=!0,this.gcodeFilePosition=Number.MAX_VALUE,setTimeout(()=>{a.liveTracking=!1},this.refreshTime+200)}},{key:"updateMesh",value:function(){this.renderVersion===1?console.log("Version 1"):this.renderVersion===2&&console.log("Version 2")}},{key:"unregisterEvents",value:function(){for(var a=0;a<this.renderFuncs.length;a++)this.scene.unregisterBeforeRender(this.renderFuncs[a]),delete this.renderFuncs[a];this.renderFuncs=[];for(var o=0;o<this.renderInstances.length;o++)delete this.renderInstances[o];this.renderInstances=[]}},{key:"setLiveTracking",value:function(a){this.liveTracking=a}},{key:"setColorMode",value:function(a){a||(this.colorMode=ln.Color),localStorage.setItem("processorColorMode",a),this.colorMode=a}},{key:"updateMinFeedColor",value:function(a){localStorage.setItem("minFeedColor",a),this.minFeedColorString=a,this.minFeedColor=K.FromHexString(a.padEnd(9,"F"))}},{key:"updateMaxFeedColor",value:function(a){localStorage.setItem("maxFeedColor",a),this.maxFeedColorString=a,this.maxFeedColor=K.FromHexString(a.padEnd(9,"F"))}},{key:"updateColorRate",value:function(a,o){localStorage.setItem("minColorRate",a),localStorage.setItem("maxColorRate",o),this.minColorRate=a,this.maxColorRate=o}},{key:"updateForceWireMode",value:function(a){this.forceWireMode=a,localStorage.setItem("forceWireMode",a)}},{key:"setLiveTrackingShowSolid",value:function(a){this.liveTrackingShowSolid=a,localStorage.setItem("showSolid",a)}},{key:"setAlpha",value:function(a){this.vertexAlpha=a}},{key:"resetTools",value:function(){this.tools.length=0}},{key:"addTool",value:function(a,o){var l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Jc.Extruder,h=new W0;h.color=K.FromHexString(a.padEnd(9,"F")),h.updateDarkerValue(),h.diameter=o,h.toolType=l,this.tools.push(h)}},{key:"updateTool",value:function(a,o,l){l<this.tools.length&&(this.tools[l].color=K.FromHexString(a.padEnd(9,"F")),this.tools[l].updateDarkerValue(),this.tools[l].diameter=o)}},{key:"forceRedraw",value:function(){for(var a=0;a<this.renderInstances.length;a++)this.renderInstances[a].forceRedraw=!0;this.doUpdate()}},{key:"forceRender",value:function(){for(var a=0;a<this.renderInstances.length;a++)this.renderInstances[a].timeStamp=0}},{key:"useHighQualityExtrusion",value:function(a){this.highQualityExtrusion=a}},{key:"setVoxelMode",value:function(a){this.forceVoxels=a}},{key:"useSpecularColor",value:function(a){var o=a?new fe(.4,.4,.4):new fe(0,0,0);this.specularColor=o,this.renderInstances.forEach(l=>{if(l.material!==null&&Object.prototype.hasOwnProperty.call(l.material,"specularColor"))try{l.material.specularColor=o}catch(h){console.error(h)}}),this.scene&&this.scene.render(!0,!0)}},{key:"g1AsExtrusion",value:function(a){this.g1AsExtrusion=a}},{key:"cancel",value:(e=Vs(Ft().mark(function a(){return Ft().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return this.cancelLoad=!0,o.next=3,this.pauseProcessing();case 3:case"end":return o.stop()}},a,this)})),function(){return e.apply(this,arguments)})},{key:"setZBeltAngle",value:function(a){this.gantryAngle=(90-a)*Math.PI/180,this.hyp=Math.cos(this.gantryAngle),this.adj=Math.tan(this.gantryAngle)}},{key:"setTransparencyValue",value:function(a){this.transparentValue=a,this.renderInstances.forEach(o=>{o.transparentValue=a})}},{key:"setRenderAnimation",value:function(a){var o=this;this.renderAnimation=a,this.renderInstances.forEach(l=>l.renderAnimation=o.renderAnimation)}},{key:"setTravelPersistence",value:function(a){var o=this;this.persistTravels=a,this.renderInstances.forEach(l=>{l.persistTravels=o.persistTravels})}}]),n}(),O1=0,BC=1,NC=function(){function n(e){kt(this,n),this.buildVolume={x:{min:0,max:100},y:{min:0,max:100},z:{min:0,max:100}};var t=localStorage.getItem("buildVolume");t!==null&&(this.buildVolume=JSON.parse(t)),this.renderMode=Number.parseInt(localStorage.getItem("renderBedMode"),10),this.renderMode||(this.renderMode=O1),this.bedMesh,this.isDelta=!1,this.scene=e,this.registerClipIgnore=()=>{},this.bedLineColor="#0000FF",this.getBedColor()||this.setBedColor("#0000FF"),this.planeMaterial=this.buildGridMaterial(),this.boxMaterial=new ee("bedBoxMaterial",this.scene),this.boxMaterial.alpha=0,this.debug=!1}return Vt(n,[{key:"setRenderMode",value:function(e){this.renderMode=e,localStorage.setItem("renderBedMode",this.renderMode),this.bedMesh&&(this.scene.removeMesh(this.bedMesh),this.bedMesh.dispose(!1,!0)),this.buildBed(),this.scene.render()}},{key:"buildBed",value:function(){if(!(this.renderMode>1||this.debug)){if(this.bedMesh&&this.bedMesh.isDisposed()&&(this.bedMesh=null),this.bedMesh)return this.bedMesh;switch(this.renderMode){case O1:this.buildFlatBed();break;case BC:this.buildBox()}return this.bedMesh}}},{key:"setDelta",value:function(e){this.isDelta=e,this.setRenderMode(this.renderMode)}},{key:"buildFlatBed",value:function(){var e=this.getCenter(),t=this.getSize();if(this.isDelta){var i=Math.abs(this.buildVolume.x.max-this.buildVolume.x.min)/2;this.bedMesh=Ti.CreateDisc("BuildPlate",{radius:i},this.scene),this.bedMesh.rotationQuaternion=se.RotationAxis(new y(1,0,0),Math.PI/2),this.bedMesh.material=this.planeMaterial}else{var s=t.x,r=t.y;this.bedMesh=Ti.CreatePlane("BuildPlate",{width:s,height:r},this.scene),this.bedMesh.material=this.planeMaterial,this.bedMesh.rotationQuaternion=se.RotationAxis(new y(1,0,0),Math.PI/2),this.bedMesh.translate(new y(e.x,0,e.y),1,zi.WORLD)}this.registerClipIgnore(this.bedMesh)}},{key:"getCenter",value:function(){return{x:(this.buildVolume.x.max+this.buildVolume.x.min)/2,y:(this.buildVolume.y.max+this.buildVolume.y.min)/2,z:(this.buildVolume.z.max+this.buildVolume.z.min)/2}}},{key:"getSize",value:function(){return{x:Math.abs(this.buildVolume.x.max-this.buildVolume.x.min),y:Math.abs(this.buildVolume.y.max-this.buildVolume.y.min),z:Math.abs(this.buildVolume.z.max-this.buildVolume.z.min)}}},{key:"buildBox",value:function(){var e=this,t=this.getSize(),i=this.getCenter();if(this.isDelta)this.bedMesh=Ti.CreateCylinder("bed",{diameterTop:t.x,diameterBottom:t.x,height:t.z},this.scene),this.bedMesh.position.x=i.x,this.bedMesh.position.y=i.z,this.bedMesh.position.z=i.x,this.bedMesh.alpha=0,this.bedMesh.diffuseColor=new K(0,0,0,0),this.bedMesh.isPickable=!1,this.bedMesh.enableEdgesRendering(void 0,!0),this.bedMesh.renderingGroupId=2,this.scene.setRenderingAutoClearDepthStencil(2,!1,!1,!1),new us("hl",this.scene,{isStroke:!0,blurTextureSizeRatio:3}).addMesh(this.bedMesh,this.getBedColor4()),this.bedMesh.onBeforeRenderObservable.add(()=>{e.scene.getEngine().setColorWrite(!1)}),this.bedMesh.onAfterRenderObservable.add(()=>{e.scene.getEngine().setColorWrite(!0)}),this.registerClipIgnore(this.bedMesh);else{this.bedMesh=Ti.CreateBox("bed",{width:t.x,depth:t.y,height:t.z},this.scene);var s=this.getCenter();this.bedMesh.position.x=s.x-this.buildVolume.x.min,this.bedMesh.position.y=s.z-this.buildVolume.z.min,this.bedMesh.position.z=s.y-this.buildVolume.y.min,this.bedMesh.diffuseColor=new K(0,0,0,0),this.bedMesh.enableEdgesRendering(),this.bedMesh.edgesWidth=100,this.bedMesh.material=this.boxMaterial,this.bedMesh.isPickable=!1,this.bedMesh.edgesColor=this.getBedColor4(),this.registerClipIgnore(this.bedMesh)}}},{key:"setVisibility",value:function(e){this.bedMesh&&this.bedMesh.setEnabled(e)}},{key:"commitBedSize",value:function(){localStorage.setItem("buildVolume",JSON.stringify(this.buildVolume)),this.setRenderMode(this.renderMode)}},{key:"buildGridMaterial",value:function(){var e=new oi("bedMaterial",this.scene);return e.mainColor=new K(0,0,0,0),e.lineColor=fe.FromHexString(this.getBedColor()),e.gridRatio=5,e.opacity=.8,e.majorUnitFrequency=10,e.minorUnitVisibility=.6,e.gridOffset=new y(0,0,0),e}},{key:"getBedColor",value:function(){return localStorage.getItem("bedLineColor")}},{key:"setBedColor",value:function(e){localStorage.setItem("bedLineColor",e),this.renderMode>1||this.planeMaterial&&(this.planeMaterial=this.buildGridMaterial(),this.dispose(),this.buildBed(),this.scene.render())}},{key:"getBedColor4",value:function(){return K.FromHexString(this.getBedColor().padEnd(9,"F"))}},{key:"dispose",value:function(){this.bedMesh&&!this.bedMesh.isDisposed&&this.bedMesh.dispose(!1,!0)}}]),n}(),UC=function(){function n(e){kt(this,n),this.scene=e,this.checkerBoard="iVBORw0KGgoAAAANSUhEUgAAAQEAAAEBCAIAAAD3joeqAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAALnSURBVHhe7dZBEYQwFAVBWBtogAv+IhIEsZd4yGG6L/lPwFRl31jqPM/neeZghd98oUoD1GmAOg1QpwHqNECdBqjTAHUaoE4D1GmAOg1QpwHqNECdBqjTAHUaoE4D1GmAOg1QpwHqNECdBqjTAHUaoE4D1GmAOg1QpwHqNECdBqjTAHUaoE4D1GmAOg1QpwHqNECdBqjTAHUaoE4D1GmAOg1QpwHqNECdBqjTAHUaoE4D1GmAOg1QpwHqNECdBqjTAHUaoE4D1GmAOg1QpwHqNECdBqjTAHUaoE4D1GmAOg1QpwHqNECdBqjTAHUaoE4D1GmAOg1QpwHqNECdBqjTAHUaoE4D1GmAOg1QpwHqNECdBqjTAHUaoE4D1GmAOg1QpwHqNECdBqjTAHUaoE4D1GmAOg1QpwHqNECdBqjTAHUaoE4D1GmAOg1QpwHqNECdBqjTAHUaoE4D1GmAOg1QpwHqNECdBqjTAHUaoE4D1GmAOg1QpwHqNECdBqjb7/ueJyscxzHGmIMV9u/75skK7/te1zUHK/gLUacB6jRAnQao0wB1GqBOA9RpgDoNUKcB6jRAnQao0wB1GqBOA9RpgDoNUKcB6jRAnQao0wB1GqBOA9RpgDoNUKcB6jRAnQao0wB1GqBOA9RpgDoNUKcB6jRAnQao0wB1GqBOA9RpgDoNUKcB6jRAnQao0wB1GqBOA9RpgDoNUKcB6jRAnQao0wB1GqBOA9RpgDoNUKcB6jRAnQao0wB1GqBOA9RpgDoNUKcB6jRAnQao0wB1GqBOA9RpgDoNUKcB6jRAnQao0wB1GqBOA9RpgDoNUKcB6jRAnQao0wB1GqBOA9RpgDoNUKcB6jRAnQao0wB1GqBOA9RpgDoNUKcB6jRAnQao0wB1GqBOA9RpgDoNUKcB6jRAnQao0wB1GqBOA9RpgDoNUKcB6jRAnQao0wB1GqBOA9RpgDoNUKcB6jRAnQao0wB1GqBOA7Rt2x+drw1hSNi5LQAAAABJRU5ErkJggg==",this.xmark="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPQAAADPCAMAAAD1TAyiAAAAkFBMVEX39/eZAAD8//+TAACWAACRAAD4+vr5/PyaAAD39fX18vLy6enr29v18PDm0dG1Y2PewMDYtbWuUFDkzc2jLy+iKSnLlpbRpKS/enrIjo6hJCTbu7u8dHSxWFi4a2vEh4eoOzudEhKdEBDPn5+pQUHq2dmsSUmnODjUqqqhJye0YGCeGRnIk5OrTEy6b2+fHh7/wUBWAAAIiElEQVR4nO2d2ULbOhRF4yNFijNAQiCBMoShhBTo7f//3bUc2kLIIOnsI6ut90v7hLS8ZCVWZJ1Op02bNm3atGnTps0fGGOsizGm6Z4kiiHqDMeT+Wo1vxwPS6IGwI2lqt3qqlf/WPH2DZnpYqnVz3SL5cXUpuWumnucL66Xp1WW14v5UUlWsDlDw0VPaV28i9aqWAyTYRsqJ8fVRdfrXlT/VP9/nvTFOkDDY/UB+Be4uhmSUKMbXRgsis990EqfD0Q6YMvz7cjrZs9Ledm2v7MLVQdG+EFO07udyC7q5UhaNk2KPV3QxSW6A/TQ3Yfs0n0QpTblsTrQgRvsRyhdHWiwln0lSG0Hp3tHWi37dASkpkMX+Y36WIzaDvVBZjeZD2HUXp5r6nMhajPw64C+R7mmC09mMeqK2cNzTX2HoaaJN7MQtRn0PJkr6q+ITy4zCGAWmc2st2dYB2gZ0GIhMJvZR3/PdQcu2a7tKkg0nrqatwM70Otz2yx7gU2Cqe1jcPuaO6/QLFQ0ljrcs2t/wJvBTXiTSGr7GMHMVW0uI0TjqKM8u+ZHnFbpOK5VDHWcZ9f6ijWBxzVaU7MXr2I9V+N7ybjk5ihudNfUJ8wHPZrGMlfUjPFt5/HQheZRc5gLNY5vmv5jNMyjpinjehf6Nf6mpu8c6Io6+r5mea5afo6/qc0Lp2WGa57nKreMmYzXcrRrpucqvXjmzsHVwMPUEa7Znqt2m4SOoeZ7Lopuo9CFvg38GYDGbM88aP4ld9SdEGoIc6HimeOesTYT5JrGgNFVJR6aviJUF/rJ2zXGc1F8Y3w5iX3I2oi3a5RnfR3/OW0fMNC+rlGeC71gfCPjf2D+7IXPbAZjLtSE8UBdgkx7ucYx81bJ6BpHfdrf3xGKXJraljPOuk3sGtm26LO9s1nQr0eHmprx1vvDl713d+V0DzVdYubtOsw1YHrFXf/K9c4RThMgM+dpuk4fdlMXe1wj7+dK9BFzTZI4y2SfssM11DPrm8lb7OG9HiEd2uYa67lQ/D0YZgjt0RbXWM+FmiF+oF5B+6RfNqZWCv4xeP/f5yyPvevVObZXdx+oaQ69pkXB/MnyV7+usdTvXWMnSjdzo3ZLWjD1b9doz2qM2xBgT2So0Z670P2hMq7hnsF7YiVc5+25pvbbH+qbajbL3bML3YBd++++9IqaSmzRBFOHbAP0iAwznhoZKeacqeWY86WWZM6VWpY5T2ppZrf5JjdqeWb4kyY7WvyFsJra9z2WJNGwZ8kD1Bm5TsWck2vcmoEHdSau03muqbNwndJzTZ2B67Se86BO7bmmvgCv3YZmmJ456B3Mv4a5YdcNMTfpWjfG3KDrBpkbc90oc0OuG2ZuwLVuntnrNBAo8/2geWZHndB1xZzHeWAJXWfDnNB1RszJXGfFnMj1xm6V5pPAtdaZMeN3Unxmzs2zC3gP3CfmL8gjqGARpd6zg7jZCFLrL5kyC1Jn69kF+U7Ce+Z8PbuIuM7as4uA68w9u9AEu2uoKJ6yZ+4Yc4Zl1qs0p88yYvpPaNMqd2pTQl/5WEf4GFZuTAn37AJ5LUMqIp5dMnYt5NlF5Upt+kKeXbp5jnCxsb1Olq7N6Ickc5auTf+LLHOGrsU9u2TmOoFnF/WaEXUSzzX1RTbUiTzX1Lm4Tua5ps7DdVLmTKjNwKeEwN9F7X+cPo666fvaDO5TMzfuOqSEAJKacQgVgLkBzzW1VMEPH+ZGPDdK3ZjnBqltc54bo7bD5J9VjVPHH7P+51JXnptPYuoMPLskpc7Cs4u6SUadiWcXwWJsm8xNo75LItfRJUFkksQ1HWXFnMR1dswJXGfILO46S2Zh15ky1+WL/jlmV75IiJoYNZXEo05E9l0hymN86Cb2cVzENU3BR6bNRi9garhrQOmXD+nOCL3cpNGu8Z4Jv0kF/Mkl4Nn9WTP6hqVG/gpgJTyvqbGuu2PYCDfg5+d32yjQrgvU2y2mDzy4v9jY9Ai+rzXqtgbWpXDZ2C5jRmfIP9/lHl3/xow9f/vTRmasa1Ydz9+BlioouvNPncK6ZlcpcKFz6OjbtmHdjDAlquog7urAkvIHssVz3UgJpOaVJK5Dr0DRWz3X1B0cNauC0jr2HtWZnZ5rapxr/vjGVcza47luCOeaU8izDi1ww27/Szc46i63+AjdYjriccw6jJpTh7lOH1ag7fAx6yhq9cCbyWC3tNdx+qZzC6keytxwZUGvi3oep286iK/5mvmrtcV8SnuXTTB0wm+QC42ZvEPKJli+azY04ot3WHkMvuscoEPLY7Af37kTGQC6G1zih+tazXkfWfx7OqasEbNUFffLiZ0xoeNKOfEK+XSZx/1YZkm+2PJVLNcvzG+hzG9k8SW76Dm6Yf6jZcmB5pQpi6fmLyJwCqzzSrNFU6s+k5kzfWtmOTqKK9AFWBiMv6k1uyRIHDViCZheIpkBJUFiRjigUG3V8CxukEHKoES4hqz1d0YxN7UClX4Jdq2vMEVbIw44xpW7CS3adM+eutcpg5lRnl3CCn50p6Af5W1otXdsWaOQ0hfAoyLoJui2Rpdy8neNfaUj6K1w+JHjvq6xm4HNwB9aomwCLXxuMPSrO/bRc4QJHS3vc+Qu/vVi67f/V/eEjtOn8YEzCLREoVo79Dj5QP8QO6LY9vcuK6jlQGKbux08HRpiail47KOhy7tdHVB6RTItG7P/o0OrC6GW32JpdaY+Dzet7mcduXoNNL7fja1u5SstWju90kr/vtG0Vur6siPasDUPxVZsrV6kBtjHGLJHDzdf77RL7/Z6Ni7l26Vy/qQ2prTqai8nJllBEGOJyr5LSWTTnB1r6XH2vVBK1RdbqW7veT6gHGqgiKa61J3H8fzi9fX1YjIedFJd7sZjjF3H/CPAbdq0adOmTZs2bbD5H8lJpKRvNiuNAAAAAElFTkSuQmCC",this.buildObjectMeshes=new Array,this.labels=new Array,this.labelSVGS=new Array,this.baseMaterial=null,this.highlightMaterial=null,this.cancelledMaterial=null,this.cancelledHighlightMaterial=null,this.showCancelObjects=!1,this.objectCallback=null,this.renderFailedCallback=null,this.labelCallback=null,this.registerClipIgnore=null,this.getMaxHeight=null,this.alphaLevel=.5,this.observableControls=null,this.showLabel=localStorage.getItem("showObjectLabels"),this.showLabel===null?this.showLabel=!0:this.showLabel=JSON.parse(this.showLabel),this.rebuildMaterials()}return Vt(n,[{key:"setBuildMaterial",value:function(e,t,i){i||(i=this.alphaLevel);var s=new ee(e,this.scene);return s.diffuseColor=t,s.specularColor=new fe(0,0,0),s.alpha=i,s.needAlphaTesting=()=>!0,s.separateCullingPass=!0,s.backFaceCulling=!0,s}},{key:"rebuildMaterials",value:function(){this.baseMaterial=this.setBuildMaterial("BuildObjectBaseMaterial",new K(.1,.5,.1),.25),this.highlightMaterial=this.setBuildMaterial("BuildObjectHighlightMateria",new fe(.8,.8,.8)),this.cancelledMaterial=this.setBuildMaterial("BuildObjectHighlightMateria",new fe(1,0,0),.4),this.cancelledHighlightMaterial=this.setBuildMaterial("BuildObjectHighlightMateria",new fe(1,1,0),.6);var e=ie.CreateFromBase64String(this.xmark,"checkerboard",this.scene);this.cancelledMaterial.diffuseTexture=e,this.cancelledHighlightMaterial.diffuseTexture=e}},{key:"loadObjectBoundaries",value:function(e){if(this.rebuildMaterials(),this.buildObjectMeshes.length>0){for(var t=0;t<this.buildObjectMeshes.length;t++)this.buildObjectMeshes[t].dispose();this.labelSVGS.forEach(o=>window.URL.revokeObjectURL(o)),this.buildObjectMeshes=new Array,this.labels=new Array}if(e)for(var i=0;i<e.length;i++){var s=e[i],r=Ti.CreateTiledBox("OBJECTMESH:"+s.name,{pattern:O.CAP_ALL,alignVertical:O.TOP,alignHorizontal:O.LEFT,tileHeight:4,tileWidth:4,width:Math.abs(s.x[1]-s.x[0]),height:this.getMaxHeight()+10,depth:Math.abs(s.y[1]-s.y[0]),sideOrientation:O.FRONTSIDE},this.scene);r.position.x=(s.x[1]+s.x[0])/2,r.position.y=this.getMaxHeight()/2-4,r.position.z=(s.y[1]+s.y[0])/2,r.alphaIndex=5e6,r.isPickable=!0,s.index=i,r.metadata=s,r.enablePointerMoveEvents=!0,r.renderingGroupId=3,this.setObjectTexture(r),r.setEnabled(this.showCancelObjects),this.registerClipIgnore(r),this.buildObjectMeshes.push(r);var a=this.makeTextPlane(s.name,s.cancelled?"yellow":"white",20);a.position=new y(0,this.getMaxHeight()/2+10,0),a.isPickable=!1,a.metadata=s,a.parent=r,a.setEnabled(this.showLabel),this.labels.push(a)}}},{key:"makeTextPlane",value:function(e,t,i){var s=Iy("svg").attr("width",800).attr("height",200).attr("fill","none");s.append("text").attr("x",400).attr("y",100).attr("font-family","Verdana").attr("font-size","50px").attr("text-anchor","middle").attr("alignment-baseline","middle").attr("fill","black").attr("stroke",t).attr("stroke-width",2).attr("text-rendering","optimizeLegibility").text(e);var r=s.attr("title","test2").attr("version",1.1).attr("xmlns","http://www.w3.org/2000/svg").node(),a=new XMLSerializer().serializeToString(r),o=new Blob(['<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">'+a],{type:"image/svg+xml"}),l=window.URL.createObjectURL(o);this.labelSVGS.push(l);var h=Ti.CreatePlane("TextPlane",{width:i,height:8},this.scene);return h.material=new ee("TextPlaneMaterial",this.scene),h.material.backFaceCulling=!1,h.material.specularColor=new fe(0,0,0),h.material.diffuseTexture=new ie(l,this.scene),h.material.diffuseTexture.hasAlpha=!0,h.billboardMode=7,this.registerClipIgnore(h),h}},{key:"buildObservables",value:function(){var e=this;if(!this.observableControls){var t=0,i=!1,s=0;this.observableControls=this.scene.onPointerObservable.add(r=>{var a=r.pickInfo;switch(r.type){case we.POINTERDOWN:i=!0,s=Date.now();break;case we.POINTERUP:if(i=!1,Date.now()-s>200)return;e.handleClick(a);break;case we.POINTERMOVE:if(i||Date.now()-t<100)return;t=Date.now(),e.handlePointerMove(a)}})}}},{key:"clearObservables",value:function(){this.observableControls&&(this.scene.onPointerObservable.remove(this.observableControls),this.observableControls=null)}},{key:"showObjectSelection",value:function(e){this.showCancelObjects=e,this.buildObjectMeshes.forEach(t=>t.setEnabled(e)),e?this.buildObservables():this.clearObservables()}},{key:"setObjectTexture",value:function(e){e.metadata&&(e.metadata.cancelled?(e.material=this.cancelledMaterial,e.enableEdgesRendering(),e.edgesWidth=15,e.edgesColor=new K(1,0,0,1)):(e.material=this.baseMaterial,e.enableEdgesRendering(),e.edgesWidth=15,e.edgesColor=new K(0,1,0,1)))}},{key:"handleClick",value:function(e){this.showCancelObjects&&e.hit&&e.pickedMesh&&e.pickedMesh.name.includes("OBJECTMESH")&&this.objectCallback&&this.objectCallback(e.pickedMesh.metadata)}},{key:"handlePointerMove",value:function(e){var t=this;this.showCancelObjects&&(this.buildObjectMeshes.forEach(i=>t.setObjectTexture(i)),e.hit&&e.pickedMesh&&e.pickedMesh.name.includes("OBJECTMESH")?(e.pickedMesh.material=e.pickedMesh.metadata.cancelled?this.cancelledHighlightMaterial:this.highlightMaterial,this.labelCallback&&this.labelCallback(e.pickedMesh.metadata.name)):this.labelCallback&&this.labelCallback(""))}},{key:"showLabels",value:function(e){localStorage.setItem("showObjectLabels",e),this.showLabel=e,this.labels.forEach(t=>t.setEnabled(e))}}]),n}(),kC=function(){function n(e){kt(this,n),this.visible=localStorage.getItem("axesVisible"),this.visible===null?this.visible=!0:this.visible=JSON.parse(this.visible),this.scene=e,this.registerClipIgnore=()=>{},this.axesMesh=null,this.axesMeshPosition=null,this.size=50,this.debug=!1}return Vt(n,[{key:"show",value:function(e){localStorage.setItem("axesVisible",e),this.axesMesh&&this.axesMesh.setEnabled(e),this.scene.render()}},{key:"makeTextPlane",value:function(e,t,i){var s=new Jo("DynamicTexture",50,this.scene,!0);s.hasAlpha=!0,s.drawText(e,5,40,"bold 36px Arial",t,"transparent",!0);var r=O.CreatePlane("TextPlane",i,this.scene,!0);return r.material=new ee("TextPlaneMaterial",this.scene),r.material.backFaceCulling=!1,r.material.specularColor=new fe(0,0,0),r.material.diffuseTexture=s,r}},{key:"resize",value:function(e){this.size=e,this.axesMesh.dispose(!1,!0),this.render()}},{key:"render",value:function(e){var t=this;if(!this.debug)if(!this.axesMesh||this.axesMesh.isDisposed()){this.axesMesh=new O("axis",this.scene),this.registerClipIgnore(this.axesMesh);var i=O.CreateLines("axisX",[y.Zero(),new y(this.size,0,0),new y(.95*this.size,.05*this.size,0),new y(this.size,0,0),new y(.95*this.size,-.05*this.size,0)],this.scene);i.color=new fe(1,0,0),i.parent=this.axesMesh;var s=this.makeTextPlane("X","red",this.size/10);s.billboardMode=7,s.position=new y(.9*this.size,.05*this.size,0),s.parent=this.axesMesh;var r=O.CreateLines("axisZ",[y.Zero(),new y(0,0,this.size),new y(0,-.05*this.size,.95*this.size),new y(0,0,this.size),new y(0,.05*this.size,.95*this.size)],this.scene);r.color=new fe(0,1,0),r.parent=this.axesMesh;var a=this.makeTextPlane("Y","green",this.size/10);a.billboardMode=7,a.position=new y(0,.05*this.size,.9*this.size),a.parent=this.axesMesh;var o=O.CreateLines("axisY",[y.Zero(),new y(0,this.size,0),new y(-.05*this.size,.95*this.size,0),new y(0,this.size,0),new y(.05*this.size,.95*this.size,0)],this.scene);o.color=new fe(0,0,1),o.parent=this.axesMesh;var l=this.makeTextPlane("Z","blue",this.size/10);l.billboardMode=7,l.position=new y(0,.9*this.size,-.05*this.size),l.parent=this.axesMesh,this.axesMesh.setEnabled(this.visible),this.axesMesh.getChildren().forEach(h=>t.registerClipIgnore(h)),e&&(this.axesMesh.position=e)}else e&&(this.axesMesh.position=e)}},{key:"dispose",value:function(){this.axesMesh&&this.axesMesh.dispose(!1,!0)}}]),n}(),tt=null;function Xr(n,e,t){var i=function(s,r,a,o,l,h){var u=arguments.length>6&&arguments[6]!==void 0?arguments[6]:75,c=Iy("svg").attr("width",400).attr("height",300);c.append("rect").attr("x",0).attr("y",0).attr("width",400).attr("height",300).attr("fill","#333333"),c.append("text").attr("x",200).attr("y",150).attr("font-family","Roboto").attr("font-size",u+"px").attr("text-anchor","middle").attr("alignment-baseline","middle").attr("fill",o).attr("stroke",a).attr("stroke-width",2).attr("text-rendering","optimizeLegibility").text(r);var f=c.attr("title","test2").attr("version",1.1).attr("xmlns","http://www.w3.org/2000/svg").node(),d='<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">',_=new XMLSerializer().serializeToString(f),p=new Blob([d+_],{type:"image/svg+xml"}),g=window.URL.createObjectURL(p),m=Ti.CreatePlane("TextPlane",{width:l,height:h},s);return m.material=new ee("TextPlaneMaterial",s),m.material.backFaceCulling=!1,m.material.specularColor=new fe(0,0,0),m.material.diffuseTexture=new ie(g,s),m.material.diffuseTexture.hasAlpha=!1,m}(n,e,"white","white",6,6,90);i.name=e,i.lookAt(t),i.position=t.scale(-3),e==="Top"&&i.rotate(ni.Z,Math.PI/2,zi.LOCAL),e==="Bottom"&&i.rotate(ni.Z,-Math.PI/2,zi.LOCAL),i.metadata={x:Math.sign(t.x),y:Math.sign(t.y),z:Math.sign(t.z)},i.isPickable=!0}function Mn(n,e,t){var i=Ti.CreateSphere(e,{diameter:1.1},n),s=y.Zero();s.x=t.x-.25*Math.sign(t.x),s.y=t.y-.1*Math.sign(t.y),s.z=t.z-.25*Math.sign(t.z),i.metadata={x:-1*Math.sign(t.x),y:-1*Math.sign(t.y),z:-1*Math.sign(t.z)},i.position=s,i.isPickable=!0}var ef,wu=null;function Qi(n,e,t){wu||((wu=new ee("edgematerial",n)).diffuseColor=new fe(.5,.5,.5));var i=Ti.CreateBox(e,{width:.35,height:5.8,depth:.35},n),s=y.Zero();t.y!==0&&(i.rotate(ni.Z,Math.PI/2,zi.WORLD),t.x!==0&&i.rotate(ni.Y,Math.PI/2,zi.WORLD),i.bakeCurrentTransformIntoVertices()),s.x=t.x-Math.sign(t.x),s.y=t.y-Math.sign(t.y),s.z=t.z-Math.sign(t.z),i.metadata={x:-1*Math.sign(t.x),y:-1*Math.sign(t.y),z:-1*Math.sign(t.z)},i.position=s,i.material=wu}function VC(n,e,t){(tt=new Je(n)).autoClear=!1;var i=new st("camera1",5*Math.PI/8,5*Math.PI/8,13,new y(0,0,0),tt);i.viewport=new Ca(.85,.85,.15,.15),i.viewport.toGlobal(200,200),e.afterRender=()=>{tt.render(),i.alpha=t.alpha,i.beta=t.beta,i.radius=15},new La("light1",new y(0,1,0),tt).intensity=.8,new La("light2",new y(-1,-.5,0),tt).intensity=.8;var s=3.9;Qi(tt,"FrontLeft",new y(-3.9,0,-3.9)),Qi(tt,"BackLeft",new y(-3.9,0,s)),Qi(tt,"BackRight",new y(s,0,s)),Qi(tt,"FrontRight",new y(s,0,-3.9)),Qi(tt,"TopFront",new y(0,s,-3.9)),Qi(tt,"TopBack",new y(0,s,s)),Qi(tt,"TopLeft",new y(-3.9,s,0)),Qi(tt,"TopRight",new y(s,s,0)),Qi(tt,"BottomFront",new y(0,-3.9,-3.9)),Qi(tt,"BottomBack",new y(0,-3.9,s)),Qi(tt,"BottomLeft",new y(-3.9,-3.9,0)),Qi(tt,"BottomRight",new y(s,-3.9,0)),Mn(tt,"FrontTopLeft",new y(-3,3,-3)),Mn(tt,"FrontTopRight",new y(3,3,-3)),Mn(tt,"BackTopLeft",new y(-3,3,3)),Mn(tt,"BackTopRight",new y(3,3,3)),Mn(tt,"FrontBottomLeft",new y(-3,-3,-3)),Mn(tt,"FrontBottomRight",new y(3,-3,-3)),Mn(tt,"BackBottomLeft",new y(-3,-3,3)),Mn(tt,"BackBottomRight",new y(3,-3,3)),Xr(tt,"Front",new y(0,0,1)),Xr(tt,"Right",new y(-1,0,0)),Xr(tt,"Back",new y(0,0,-1)),Xr(tt,"Left",new y(1,0,0)),Xr(tt,"Top",new y(0,-1,0)),Xr(tt,"Bottom",new y(0,1,0)),tt.onPointerDown=(r,a)=>{a.distance>0&&ef&&(ef(a.pickedMesh.metadata),tt.render(!0))}}var GC=function(){function n(e){kt(this,n),this.visible=!0,this.scene=e,this.workplacePoints=[],this.workplaceMeshes=[],this.registerClipIgnore=()=>{}}return Vt(n,[{key:"setOffsets",value:function(e){this.workplacePoints=e,this.render()}},{key:"makeTextPlane",value:function(e,t,i){var s=new Jo("DynamicTexture",50,this.scene,!0);s.hasAlpha=!0,s.drawText(e,5,40,"bold 36px Arial",t,"transparent",!0);var r=O.CreatePlane("TextPlane",i,this.scene,!0);return r.material=new ee("TextPlaneMaterial",this.scene),r.material.backFaceCulling=!1,r.material.specularColor=new fe(0,0,0),r.material.diffuseTexture=s,r}},{key:"render",value:function(){if(this.workplaceMeshes.length>0){for(var e=0;e<this.workplaceMeshes.length;e++)this.workplaceMeshes[e].dispose(!1,!0);this.workplaceMeshes=[]}if(this.visible)for(var t=0;t<this.workplacePoints.length;t++){var i=this.workplacePoints[t];if(!y.ZeroReadOnly.equals(i)){var s=this.makeTextPlane(t+1,"white",5);s.position=new y(i.x+1,i.z+2,i.y),s.billboardMode=7,s.isVisible=!0,s.renderingGroupId=2,this.registerClipIgnore(s),this.workplaceMeshes.push(s);var r=Ti.CreateBox("box",{size:1},this.scene);r.renderingGroupId=2,r.position=new y(i.x,i.z,i.y),r.isVisible=!0,this.registerClipIgnore(r),this.workplaceMeshes.push(r)}}}}]),n}(),zC=function(){function n(r){kt(this,n),this.lastLoadKey="lastLoadFailed",this.fileData=null,this.fileDataArray=null,this.fileSize=0,this.gcodeProcessor=new LC,this.maxHeight=0,this.minHeight=0,this.sceneBackgroundColor="#000000",this.canvas=r,this.scene={},this.loading=!1,this.toolVisible=!1,this.travelVisible=!1,this.debug=!1,this.zTopClipValue=1e6,this.zBottomClipValue=-1e6,this.cancelHitTimer=0,this.pause=!1,this.hqNozzle=!0,this.cameraInertia=localStorage.getItem("cameraInertia")==="true",this.bed=null,this.buildObjects=null,this.axes=null,this.workplace=null,this.renderQuality=Number(localStorage.getItem("renderQuality")),this.renderQuality!==void 0&&this.renderQuality!==null||(this.renderQuality=1),this.renderTimeout=1e3,this.simulation=!1,this.simulationLastUpdate=0,this.simulationTimeToMove=0,this.simulationCurrentLine=null,this.simulationMultiplier=1,this.simulationUpdatePosition=()=>{},this.simulationStopped=()=>{},this.simLine=y.Zero(),this.isMMS=!1}var e,t,i,s;return Vt(n,[{key:"getMaxHeight",value:function(){return this.maxHeight}},{key:"getMinHeight",value:function(){return this.minHeight}},{key:"setCameraType",value:function(r){this.scene.activeCamera=r?this.orbitCamera:this.flyCamera}},{key:"setZClipPlane",value:function(r,a){this.zTopClipValue=-r,this.zBottomClipValue=a,a>r&&(this.zTopClipValue=a+1),this.scene.clipPlane=new _i(0,1,0,this.zTopClipValue),this.scene.clipPlane2=new _i(0,-1,0,this.zBottomClipValue),this.scene.render()}},{key:"isArcRotateCameraStopped",value:function(r){return r.inertialAlphaOffset===0&&r.inertialBetaOffset===0&&r.inertialRadiusOffset===0&&r.inertialPanningX===0&&r.inertialPanningY===0}},{key:"init",value:(s=Vs(Ft().mark(function r(a){var o,l,h=this;return Ft().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return a===void 0&&(a=!1),console.info("GCode Viewer - Sindarius - ".concat("3.7.16"," ")),u.next=4,je.IsSupportedAsync;case 4:if(!u.sent||!a){u.next=13;break}return console.log("WebGPU Supported"),this.engine=new je(this.canvas,{doNotHandleContextLost:!0}),u.next=10,this.engine.initAsync();case 10:console.log(this.engine),u.next=15;break;case 13:console.log("WebGPU Not Supported"),this.engine=new oe(this.canvas,!0,{doNotHandleContextLost:!0});case 15:this.engine.enableOfflineSupport=!1,this.engine.setHardwareScalingLevel(1/window.devicePixelRatio),this.scene=new Je(this.engine),this.scene.performancePriority=Vc.BackwardCompatible,this.debug,this.scene.clearColor=fe.FromHexString(this.getBackgroundColor()),this.bed=new NC(this.scene),this.bed.registerClipIgnore=c=>{h.registerClipIgnore(c)},o=this.bed.getCenter(),this.orbitCamera=new st("Camera",Math.PI/2,2.356194,250,new y(o.x,-2,o.y),this.scene),this.orbitCamera.attachControl(!1),this.orbitCamera.invertRotation=!1,this.orbitCamera.attachControl(this.canvas,!1),this.orbitCamera.maxZ=1e5,this.orbitCamera.lowerRadiusLimit=5,this.updateCameraInertiaProperties(),(l=new Rh("light2",new y(0,1,-1),this.scene)).diffuse=new fe(1,1,1),l.specular=new fe(1,1,1),this.engine.runRenderLoop(()=>{if(!document.hidden){if(h.simulation){if(h.pause)return}else if(h.pause||Date.now()-h.gcodeProcessor.lastUpdate>h.renderTimeout&&h.isArcRotateCameraStopped(h.orbitCamera))return;if(h.simulation)try{h.runSimulation(),h.gcodeProcessor.doUpdate()}catch{h.simulation=!1,h.simulationStopped()}h.scene.render(!0),l.position=h.scene.cameras[0].position}}),this.buildObjects=new UC(this.scene),this.buildObjects.getMaxHeight=()=>h.gcodeProcessor.getMaxHeight(),this.buildObjects.registerClipIgnore=c=>{h.registerClipIgnore(c)},this.bed.buildBed(),this.axes=new kC(this.scene),this.axes.registerClipIgnore=c=>{h.registerClipIgnore(c)},this.axes.render(),this.workplace=new GC(this.scene),this.workplace.registerClipIgnore=c=>{h.registerClipIgnore(c)},this.workplace.setOffsets(this.gcodeProcessor.workplaceOffsets),this.workplace.render(),this.resetCamera(),VC(this.engine,this.scene,this.orbitCamera),ef=c=>{console.log("viewbox callback",c),h.setViewboxCameraPosition(c)},setTimeout(()=>{h.forceRender()},1e3);case 50:case"end":return u.stop()}},r,this)})),function(r){return s.apply(this,arguments)})},{key:"setViewboxCameraPosition",value:function(r){var a=this.bed.getCenter(),o=this.bed.getSize();this.scene.activeCamera.radius=1.5*o.x,this.scene.activeCamera.target=new y(a.x,a.z,a.y);var l=y.Zero(),h=(r.x===0?1:0)+(r.y===0?1:0)+(r.z===0?1:0)==2?1.75:1.35;switch(r.x){case 1:l.x=a.x-o.x*h;break;case 0:l.x=a.x;break;case-1:l.x=a.x+o.x*h}switch(r.y){case 1:l.y=a.z-o.z*h;break;case 0:l.y=a.z;break;case-1:l.y=a.z+o.z*h}switch(r.z){case 1:l.z=a.y-o.y*h;break;case 0:l.z=a.y;break;case-1:l.z=a.y+o.y*h}r.x===0&&r.z===0?(this.scene.activeCamera.target=new y(a.x,0,a.y),this.scene.activeCamera.position=l,this.scene.activeCamera.alpha=3*Math.PI/2):this.scene.activeCamera.position=l,this.scene.render(!0),this.scene.render(!0)}},{key:"resize",value:function(){this.engine.resize(),this.scene.render(!0)}},{key:"refreshUI",value:function(){setTimeout(()=>{},0)}},{key:"resetCamera",value:function(){var r=this.bed.getCenter(),a=this.bed.getSize();this.bed.isDelta?(this.scene.activeCamera.radius=r.x,this.scene.activeCamera.target=new y(r.x,-2,r.y),this.scene.activeCamera.position=new y(-a.x,a.z,-a.x)):(this.scene.activeCamera.radius=3*r.x,this.scene.activeCamera.target=new y(r.x,-2,r.y),this.scene.activeCamera.position=new y(-a.x/2,a.z,-a.y/2)),this.scene.render(!0),this.scene.render(!0)}},{key:"lastLoadFailed",value:function(){return!!localStorage&&localStorage.getItem(this.lastLoadKey)==="true"}},{key:"setLoadFlag",value:function(){localStorage&&localStorage.setItem(this.lastLoadKey,"true")}},{key:"clearLoadFlag",value:function(){localStorage&&(localStorage.setItem(this.lastLoadKey,""),localStorage.removeItem(this.lastLoadKey))}},{key:"processFile",value:(i=Vs(Ft().mark(function r(a){return Ft().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:this.clearScene(),this.refreshUI(),a?(this.fileData=a,this.fileSize=a.length):(this.fileData=0,this.fileSize=0),this.fileDataArray=[];try{this.fileData===null&&this.fileData===""||(this.fileDataArray=this.fileData.split(`
`))}catch{this.fileDataArray=[]}return this.gcodeProcessor.setProgressColor(this.getProgressColor()),this.gcodeProcessor.scene=this.scene,this.lastLoadFailed()&&(console.error("Last rendering failed dropping to SBC quality"),this.updateRenderQuality(1),this.clearLoadFlag()),this.setLoadFlag(),o.next=11,this.gcodeProcessor.processGcodeFile(a,this.renderQuality);case 11:return this.clearLoadFlag(),o.next=14,this.gcodeProcessor.createMesh(this.scene);case 14:this.gcodeProcessor.loadingComplete(),this.maxHeight=this.gcodeProcessor.getMaxHeight(),this.minHeight=this.gcodeProcessor.getMinHeight(),this.toggleTravels(this.travelVisible),this.setCursorVisiblity(this.toolCursorVisible),this.gcodeProcessor.zBelt&&(this.bed.buildVolume.y.min=this.gcodeProcessor.beltLength,this.bed.buildVolume.y.max=0,this.bed.dispose(),this.bed.buildBed());case 20:case"end":return o.stop()}},r,this)})),function(r){return i.apply(this,arguments)})},{key:"toggleTravels",value:function(r){var a,o=function(h,u){var c=typeof Symbol<"u"&&h[Symbol.iterator]||h["@@iterator"];if(!c){if(Array.isArray(h)||(c=$d(h))||u){c&&(h=c);var f=0,d=()=>{};return{s:d,n:()=>f>=h.length?{done:!0}:{done:!1,value:h[f++]},e:m=>{throw m},f:d}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var _,p=!0,g=!1;return{s:()=>{c=c.call(h)},n:()=>{var m=c.next();return p=m.done,m},e:m=>{g=!0,_=m},f:()=>{try{p||c.return==null||c.return()}finally{if(g)throw _}}}}(this.scene.meshes);try{for(o.s();!(a=o.n()).done;){var l=a.value;l.name==="travels"&&(l.isVisible=r)}}catch(h){o.e(h)}finally{o.f()}this.travelVisible=r,this.scene.render(!0)}},{key:"getProgressColor",value:function(){var r=localStorage.getItem("progressColor");return r===null&&(r="#FFFFFF"),r}},{key:"setProgressColor",value:function(r){localStorage.setItem("progressColor",r),this.gcodeProcessor.setProgressColor(r)}},{key:"getBackgroundColor",value:function(){var r=localStorage.getItem("sceneBackgroundColor");return r===null&&(r="#000000"),r}},{key:"setBackgroundColor",value:function(r){this.scene!==null&&this.scene!==void 0&&(r.length>7&&(r=r.substring(0,7)),this.scene.clearColor=fe.FromHexString(r),this.scene.render()),localStorage.setItem("sceneBackgroundColor",r)}},{key:"clearScene",value:function(r){this.fileData&&r&&(this.fileData=""),this.gcodeProcessor.unregisterEvents();for(var a=this.scene.meshes.length-1;a>=0;a--){var o=this.scene.meshes[a];o&&this.debug&&console.log("Disposing ".concat(o.name)),this.scene.removeMesh(o),o&&typeof o.dispose=="function"&&o.dispose(!1,!0)}for(var l=this.scene.materials.length-1;l>=0;l--){var h=this.scene.materials[l];h.name==="solidMaterial"&&(h&&this.debug&&console.log("Disposing ".concat(h.name)),this.scene.removeMaterial(h),h&&typeof h.dispose=="function"&&h.dispose(!1,!0))}this.toolCursor&&(this.toolCursor.dispose(!1,!0),this.toolCursor=void 0),this.buildtoolCursor(),this.bed.buildBed(),this.axes.render(),this.workplace.render()}},{key:"reload",value:(t=Vs(Ft().mark(function r(){return Ft().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return this.clearScene(),a.next=3,this.processFile(this.fileData);case 3:case"end":return a.stop()}},r,this)})),function(){return t.apply(this,arguments)})},{key:"getRenderMode",value:function(){return this.gcodeProcessor.renderMode}},{key:"setCursorVisiblity",value:function(r){this.scene!==void 0&&(this.toolCursor===void 0&&this.buildtoolCursor(),this.toolCursorMesh.isVisible=r,this.toolCursorVisible=r,this.scene.render())}},{key:"updateToolPosition",value:function(r){var a=0,o=0,l=0;if(this.buildtoolCursor(),r instanceof y)a=r.x,o=r.z,l=r.y;else for(var h=0;h<r.length;h++)switch(r[h].axes){case"X":a=r[h].position;break;case"Y":o=r[h].position;break;case"Z":l=r[h].position*(this.gcodeProcessor.spreadLines?this.gcodeProcessor.spreadLineAmount:1)}this.toolCursor.setAbsolutePosition(new y(a,l,o)),this.toolCursorMesh.isVisible&&this.scene.render()}},{key:"buildtoolCursor",value:function(){if(this.toolCursor===void 0){this.toolCursor=new Re("toolCursorContainer"),Or.ShowLoadingScreen=!1,Or.Append("",`data:# WaveFront *.obj file (generated by Autodesk ATF)

g JRNozzle

v 0.429187 -3.010668 2.826259
v 0.421210 -3.010485 2.813202
v 0.412190 -3.010277 2.801026
v 0.401522 -3.010032 2.790242
v 0.389909 -3.009764 2.780255
v 0.392210 -2.909791 2.780255
v 0.403822 -2.910058 2.790242
v 0.414490 -2.910303 2.801026
v 0.423510 -2.910511 2.813202
v 0.431487 -2.910695 2.826259
v 0.373704 -3.009392 2.770250
v 0.356792 -3.009002 2.762005
v 0.338760 -3.008588 2.756557
v 0.320082 -3.008158 2.752720
v 0.322382 -2.908184 2.752720
v 0.341060 -2.908614 2.756557
v 0.359093 -2.909029 2.762005
v 0.376004 -2.909418 2.770250
v 0.294312 -3.007565 2.749930
v 0.268495 -3.006971 2.747890
v 0.242609 -3.006376 2.746972
v 0.216685 -3.005779 2.746676
v 0.218985 -2.905806 2.746676
v 0.244909 -2.906402 2.746972
v 0.270795 -2.906998 2.747890
v 0.296612 -2.907591 2.749930
v 0.137458 -3.003956 2.746676
v 0.139758 -2.903983 2.746676
v 0.137458 -3.003956 3.015984
v 0.139758 -2.903983 3.015984
v 0.230784 -3.006103 3.015984
v 0.233084 -2.906130 3.015984
v 0.251108 -3.006571 3.015850
v 0.271425 -3.007038 3.015480
v 0.291729 -3.007506 3.014692
v 0.312025 -3.007973 3.013633
v 0.314326 -2.907999 3.013633
v 0.294029 -2.907532 3.014692
v 0.273725 -2.907065 3.015480
v 0.253408 -2.906598 3.015850
v 0.327664 -3.008332 3.012024
v 0.343112 -3.008688 3.009541
v 0.358225 -3.009035 3.005526
v 0.373124 -3.009378 3.000537
v 0.375424 -2.909405 3.000537
v 0.360525 -2.909062 3.005526
v 0.345412 -2.908714 3.009541
v 0.329964 -2.908359 3.012024
v 0.388822 -3.009739 2.992940
v 0.403254 -3.010071 2.983797
v 0.415441 -3.010352 2.971906
v 0.426166 -3.010599 2.958227
v 0.428466 -2.910625 2.958227
v 0.417742 -2.910378 2.971906
v 0.405555 -2.910098 2.983797
v 0.391122 -2.909766 2.992940
v 0.432998 -3.010756 2.942842
v 0.438146 -3.010874 2.927042
v 0.440638 -3.010932 2.910586
v 0.441608 -3.010954 2.893754
v 0.443908 -2.910980 2.893754
v 0.442938 -2.910958 2.910586
v 0.440446 -2.910901 2.927042
v 0.435298 -2.910782 2.942842
v 0.441038 -3.010941 2.876383
v 0.439178 -3.010898 2.859264
v 0.434976 -3.010801 2.842606
v 0.437276 -2.910828 2.842606
v 0.441478 -2.910924 2.859264
v 0.443338 -2.910967 2.876383
v 0.510093 -3.012529 2.628475
v 0.551628 -3.013485 2.651463
v 0.590608 -3.014382 2.677637
v 0.625121 -3.015176 2.709380
v 0.656797 -3.015905 2.744661
v 0.659097 -2.915931 2.744661
v 0.627421 -2.915202 2.709380
v 0.592908 -2.914408 2.677637
v 0.553928 -2.913511 2.651463
v 0.512393 -2.912556 2.628475
v 0.679846 -3.016435 2.786804
v 0.697041 -3.016831 2.830679
v 0.705168 -3.017017 2.877239
v 0.708160 -3.017086 2.925319
v 0.710460 -2.917113 2.925319
v 0.707468 -2.917044 2.877239
v 0.699341 -2.916857 2.830679
v 0.682146 -2.916461 2.786804
v 0.706219 -3.017042 2.960458
v 0.700958 -3.016921 2.994740
v 0.689832 -3.016665 3.027509
v 0.674925 -3.016322 3.059302
v 0.677225 -2.916348 3.059302
v 0.692133 -2.916691 3.027509
v 0.703258 -2.916947 2.994740
v 0.708519 -2.917068 2.960458
v 0.656164 -3.015890 3.084796
v 0.635398 -3.015412 3.108227
v 0.611325 -3.014858 3.128259
v 0.585291 -3.014260 3.146273
v 0.587591 -2.914286 3.146273
v 0.613625 -2.914885 3.128259
v 0.637698 -2.915439 3.108227
v 0.658464 -2.915917 3.084796
v 0.556876 -3.013606 3.161195
v 0.527664 -3.012934 3.173934
v 0.497122 -3.012231 3.183026
v 0.465779 -3.011510 3.189926
v 0.468079 -2.911536 3.189926
v 0.499422 -2.912257 3.183026
v 0.529964 -2.912960 3.173934
v 0.559176 -2.913632 3.161195
v 0.427819 -3.010637 3.194504
v 0.389776 -3.009761 3.197889
v 0.351607 -3.008883 3.199454
v 0.313368 -3.008003 3.200000
v 0.315668 -2.908030 3.200000
v 0.353907 -2.908910 3.199454
v 0.392076 -2.909788 3.197889
v 0.430119 -2.910663 3.194504
v -0.119022 -2.998056 3.200000
v -0.116722 -2.898082 3.200000
v -0.119022 -2.998056 2.200000
v -0.116722 -2.898082 2.200000
v 0.137458 -3.003956 2.200000
v 0.139758 -2.903983 2.200000
v 0.137458 -3.003956 2.566689
v 0.139758 -2.903983 2.566689
v 0.256907 -3.006704 2.566689
v 0.259207 -2.906731 2.566689
v 0.528882 -3.012962 2.200000
v 0.531182 -2.912988 2.200000
v 0.843786 -3.020207 2.200000
v 0.846086 -2.920233 2.200000
v -0.361403 -2.992479 3.200000
v -0.848178 -2.981280 3.200000
v -0.845878 -2.881306 3.200000
v -0.359103 -2.892506 3.200000
v -0.848178 -2.981280 3.015984
v -0.845878 -2.881306 3.015984
v -0.619226 -2.986547 3.015984
v -0.616926 -2.886574 3.015984
v -0.619226 -2.986547 2.617310
v -0.616926 -2.886574 2.617310
v -0.619316 -2.986545 2.592175
v -0.619616 -2.986539 2.567043
v -0.620298 -2.986523 2.541920
v -0.621240 -2.986501 2.516802
v -0.618940 -2.886528 2.516802
v -0.617998 -2.886549 2.541920
v -0.617316 -2.886565 2.567043
v -0.617016 -2.886572 2.592175
v -0.623187 -2.986456 2.498146
v -0.626433 -2.986382 2.479806
v -0.631888 -2.986256 2.462004
v -0.638697 -2.986100 2.444533
v -0.636397 -2.886126 2.444533
v -0.629588 -2.886283 2.462004
v -0.624133 -2.886408 2.479806
v -0.620887 -2.886483 2.498146
v -0.649070 -2.985861 2.428224
v -0.661200 -2.985582 2.413707
v -0.676153 -2.985238 2.402066
v -0.692746 -2.984856 2.392096
v -0.690446 -2.884882 2.392096
v -0.673853 -2.885264 2.402066
v -0.658900 -2.885608 2.413707
v -0.646770 -2.885887 2.428224
v -0.719047 -2.984251 2.383107
v -0.745835 -2.983635 2.376701
v -0.773318 -2.983002 2.373986
v -0.801179 -2.982361 2.373271
v -0.798879 -2.882388 2.373271
v -0.771018 -2.883029 2.373986
v -0.743535 -2.883661 2.376701
v -0.716747 -2.884277 2.383107
v -0.823764 -2.981842 2.373764
v -0.846217 -2.981325 2.375333
v -0.868428 -2.980814 2.378851
v -0.890477 -2.980307 2.383680
v -0.888177 -2.880333 2.383680
v -0.866128 -2.880841 2.378851
v -0.843917 -2.881352 2.375333
v -0.821464 -2.881868 2.373764
v -0.907395 -2.979918 2.388908
v -0.924242 -2.979530 2.394350
v -0.940967 -2.979145 2.400154
v -0.957618 -2.978762 2.406179
v -0.955318 -2.878789 2.406179
v -0.938667 -2.879172 2.400154
v -0.921942 -2.879557 2.394350
v -0.905095 -2.879944 2.388908
v -0.981789 -2.978206 2.406179
v -0.979489 -2.878233 2.406179
v -0.981789 -2.978206 2.203967
v -0.979489 -2.878233 2.203967
v -0.955081 -2.978821 2.199277
v -0.928288 -2.979437 2.195213
v -0.901363 -2.980056 2.192119
v -0.874363 -2.980678 2.189575
v -0.872063 -2.880704 2.189575
v -0.899063 -2.880083 2.192119
v -0.925988 -2.879463 2.195213
v -0.952781 -2.878847 2.199277
v -0.841836 -2.981426 2.187396
v -0.809288 -2.982175 2.185732
v -0.776708 -2.982924 2.184901
v -0.744109 -2.983674 2.184553
v -0.741809 -2.883701 2.184553
v -0.774408 -2.882951 2.184901
v -0.806988 -2.882201 2.185732
v -0.839536 -2.881452 2.187396
v -0.700655 -2.984674 2.185766
v -0.657537 -2.985666 2.189337
v -0.615019 -2.986644 2.197134
v -0.572898 -2.987613 2.207723
v -0.570598 -2.887640 2.207723
v -0.612719 -2.886671 2.197134
v -0.655237 -2.885693 2.189337
v -0.698355 -2.884701 2.185766
v -0.541154 -2.988344 2.220145
v -0.510585 -2.989047 2.234674
v -0.482032 -2.989704 2.252818
v -0.454729 -2.990332 2.273203
v -0.452429 -2.890358 2.273203
v -0.479732 -2.889730 2.252818
v -0.508284 -2.889073 2.234674
v -0.538854 -2.888370 2.220145
v -0.433234 -2.990827 2.294554
v -0.413950 -2.991270 2.317498
v -0.398331 -2.991630 2.343084
v -0.384902 -2.991939 2.370248
v -0.382602 -2.891965 2.370248
v -0.396031 -2.891656 2.343084
v -0.411649 -2.891297 2.317498
v -0.430934 -2.890853 2.294554
v -0.374848 -2.992170 2.400254
v -0.367099 -2.992348 2.430703
v -0.363132 -2.992439 2.461879
v -0.361403 -2.992479 2.493486
v -0.359103 -2.892506 2.493486
v -0.360832 -2.892466 2.461879
v -0.364799 -2.892375 2.430703
v -0.372548 -2.892196 2.400254
v -1.800595 -2.959368 1.700000
v 1.662591 -3.039045 1.700000
v 1.662591 -3.039045 3.700000
v -1.800595 -2.959368 3.700000
v 0.500000 0.000000 7.700000
v 0.492808 0.084500 7.700000
v 0.471439 0.166570 7.700000
v 0.436507 0.243847 7.700000
v 0.389018 0.314110 7.700000
v 0.330337 0.375336 7.700000
v 0.262154 0.425765 7.700000
v 0.186428 0.463945 7.700000
v 0.105340 0.488778 7.700000
v 0.021221 0.499549 7.700000
v -0.063509 0.495950 7.700000
v -0.146411 0.478083 7.700000
v -0.225102 0.446463 7.700000
v -0.297317 0.401999 7.700000
v -0.360978 0.345969 7.700000
v -0.414255 0.279987 7.700000
v -0.455614 0.205951 7.700000
v -0.483866 0.125989 7.700000
v -0.498199 0.042403 7.700000
v -0.498199 -0.042403 7.700000
v -0.483866 -0.125989 7.700000
v -0.455614 -0.205951 7.700000
v -0.414255 -0.279987 7.700000
v -0.360978 -0.345969 7.700000
v -0.297317 -0.401999 7.700000
v -0.225102 -0.446463 7.700000
v -0.146411 -0.478083 7.700000
v -0.063509 -0.495950 7.700000
v 0.021221 -0.499549 7.700000
v 0.105340 -0.488778 7.700000
v 0.186428 -0.463945 7.700000
v 0.262154 -0.425765 7.700000
v 0.330337 -0.375336 7.700000
v 0.389018 -0.314110 7.700000
v 0.436507 -0.243847 7.700000
v 0.471439 -0.166570 7.700000
v 0.492808 -0.084500 7.700000
v 0.500000 0.000000 3.700000
v 0.492808 -0.084500 3.700000
v 0.471439 -0.166570 3.700000
v 0.436507 -0.243847 3.700000
v 0.389018 -0.314110 3.700000
v 0.330337 -0.375336 3.700000
v 0.262154 -0.425765 3.700000
v 0.186428 -0.463945 3.700000
v 0.105340 -0.488778 3.700000
v 0.021221 -0.499549 3.700000
v -0.063509 -0.495950 3.700000
v -0.146411 -0.478083 3.700000
v -0.225102 -0.446463 3.700000
v -0.297317 -0.401999 3.700000
v -0.360978 -0.345969 3.700000
v -0.414255 -0.279987 3.700000
v -0.455614 -0.205951 3.700000
v -0.483866 -0.125989 3.700000
v -0.498199 -0.042403 3.700000
v -0.498199 0.042403 3.700000
v -0.483866 0.125989 3.700000
v -0.455614 0.205951 3.700000
v -0.414255 0.279987 3.700000
v -0.360978 0.345969 3.700000
v -0.297317 0.401999 3.700000
v -0.225102 0.446463 3.700000
v -0.146411 0.478083 3.700000
v -0.063509 0.495950 3.700000
v 0.021221 0.499549 3.700000
v 0.105340 0.488778 3.700000
v 0.186428 0.463945 3.700000
v 0.262154 0.425765 3.700000
v 0.330337 0.375336 3.700000
v 0.389018 0.314110 3.700000
v 0.436507 0.243847 3.700000
v 0.471439 0.166570 3.700000
v 0.492808 0.084500 3.700000
v 0.500000 -0.000000 6.366667
v 0.500000 -0.000000 5.033333
v 0.492404 0.086824 6.366667
v 0.492404 0.086824 5.033333
v 0.469846 0.171010 6.366667
v 0.469846 0.171010 5.033333
v 0.433013 0.250000 6.366667
v 0.433013 0.250000 5.033333
v 0.383022 0.321394 6.366667
v 0.383022 0.321394 5.033333
v 0.321394 0.383022 6.366667
v 0.321394 0.383022 5.033333
v 0.250000 0.433013 6.366667
v 0.250000 0.433013 5.033333
v 0.171010 0.469846 6.366667
v 0.171010 0.469846 5.033333
v 0.086824 0.492404 6.366667
v 0.086824 0.492404 5.033333
v -0.000000 0.500000 6.366667
v -0.000000 0.500000 5.033333
v -0.086824 0.492404 6.366667
v -0.086824 0.492404 5.033333
v -0.171010 0.469846 6.366667
v -0.171010 0.469846 5.033333
v -0.250000 0.433013 6.366667
v -0.250000 0.433013 5.033333
v -0.321394 0.383022 6.366667
v -0.321394 0.383022 5.033333
v -0.383022 0.321394 6.366667
v -0.383022 0.321394 5.033333
v -0.433013 0.250000 6.366667
v -0.433013 0.250000 5.033333
v -0.469846 0.171010 6.366667
v -0.469846 0.171010 5.033333
v -0.492404 0.086824 6.366667
v -0.492404 0.086824 5.033333
v -0.500000 0.000000 6.366667
v -0.500000 0.000000 5.033333
v -0.492404 -0.086824 6.366667
v -0.492404 -0.086824 5.033333
v -0.469846 -0.171010 6.366667
v -0.469846 -0.171010 5.033333
v -0.433013 -0.250000 6.366667
v -0.433013 -0.250000 5.033333
v -0.383022 -0.321394 6.366667
v -0.383022 -0.321394 5.033333
v -0.321394 -0.383022 6.366667
v -0.321394 -0.383022 5.033333
v -0.250000 -0.433013 6.366667
v -0.250000 -0.433013 5.033333
v -0.171010 -0.469846 6.366667
v -0.171010 -0.469846 5.033333
v -0.086824 -0.492404 6.366667
v -0.086824 -0.492404 5.033333
v -0.000000 -0.500000 6.366667
v -0.000000 -0.500000 5.033333
v 0.086824 -0.492404 6.366667
v 0.086824 -0.492404 5.033333
v 0.171010 -0.469846 6.366667
v 0.171010 -0.469846 5.033333
v 0.250000 -0.433013 6.366667
v 0.250000 -0.433013 5.033333
v 0.321394 -0.383022 6.366667
v 0.321394 -0.383022 5.033333
v 0.383022 -0.321394 6.366667
v 0.383022 -0.321394 5.033333
v 0.433013 -0.250000 6.366667
v 0.433013 -0.250000 5.033333
v 0.469846 -0.171010 6.366667
v 0.469846 -0.171010 5.033333
v 0.492404 -0.086824 6.366667
v 0.492404 -0.086824 5.033333
v 1.292723 0.000000 7.700000
v 1.285145 -0.139768 7.700000
v 1.262500 -0.277897 7.700000
v 1.225053 -0.412768 7.700000
v 1.173244 -0.542800 7.700000
v 1.107679 -0.666468 7.700000
v 1.029128 -0.782323 7.700000
v 0.938511 -0.889005 7.700000
v 0.836891 -0.985264 7.700000
v 0.725459 -1.069973 7.700000
v 0.605522 -1.142136 7.700000
v 0.478486 -1.200910 7.700000
v 0.345840 -1.245603 7.700000
v 0.209139 -1.275693 7.700000
v 0.069987 -1.290827 7.700000
v -0.069987 -1.290827 7.700000
v -0.209139 -1.275693 7.700000
v -0.345840 -1.245603 7.700000
v -0.478486 -1.200910 7.700000
v -0.605522 -1.142136 7.700000
v -0.725459 -1.069973 7.700000
v -0.836891 -0.985264 7.700000
v -0.938511 -0.889005 7.700000
v -1.029128 -0.782323 7.700000
v -1.107679 -0.666468 7.700000
v -1.173244 -0.542800 7.700000
v -1.225053 -0.412768 7.700000
v -1.262500 -0.277897 7.700000
v -1.285145 -0.139768 7.700000
v -1.292723 0.000000 7.700000
v -1.285145 0.139768 7.700000
v -1.262500 0.277897 7.700000
v -1.225053 0.412768 7.700000
v -1.173244 0.542800 7.700000
v -1.107679 0.666468 7.700000
v -1.029128 0.782323 7.700000
v -0.938511 0.889005 7.700000
v -0.836891 0.985264 7.700000
v -0.725459 1.069973 7.700000
v -0.605522 1.142136 7.700000
v -0.478486 1.200910 7.700000
v -0.345840 1.245603 7.700000
v -0.209139 1.275693 7.700000
v -0.069987 1.290827 7.700000
v 0.069987 1.290827 7.700000
v 0.209139 1.275693 7.700000
v 0.345840 1.245603 7.700000
v 0.478486 1.200910 7.700000
v 0.605522 1.142136 7.700000
v 0.725459 1.069973 7.700000
v 0.836891 0.985264 7.700000
v 0.938511 0.889005 7.700000
v 1.029128 0.782323 7.700000
v 1.107679 0.666468 7.700000
v 1.173244 0.542800 7.700000
v 1.225053 0.412768 7.700000
v 1.262500 0.277897 7.700000
v 1.285145 0.139768 7.700000
v 1.292723 0.000000 3.700000
v 1.285145 0.139768 3.700000
v 1.262500 0.277897 3.700000
v 1.225053 0.412768 3.700000
v 1.173244 0.542800 3.700000
v 1.107679 0.666468 3.700000
v 1.029128 0.782323 3.700000
v 0.938511 0.889005 3.700000
v 0.836891 0.985264 3.700000
v 0.725459 1.069973 3.700000
v 0.605522 1.142136 3.700000
v 0.478486 1.200910 3.700000
v 0.345840 1.245603 3.700000
v 0.209139 1.275693 3.700000
v 0.069987 1.290827 3.700000
v -0.069987 1.290827 3.700000
v -0.209139 1.275693 3.700000
v -0.345840 1.245603 3.700000
v -0.478486 1.200910 3.700000
v -0.605522 1.142136 3.700000
v -0.725459 1.069973 3.700000
v -0.836891 0.985264 3.700000
v -0.938511 0.889005 3.700000
v -1.029128 0.782323 3.700000
v -1.107679 0.666468 3.700000
v -1.173244 0.542800 3.700000
v -1.225053 0.412768 3.700000
v -1.262500 0.277897 3.700000
v -1.285145 0.139768 3.700000
v -1.292723 0.000000 3.700000
v -1.285145 -0.139768 3.700000
v -1.262500 -0.277897 3.700000
v -1.225053 -0.412768 3.700000
v -1.173244 -0.542800 3.700000
v -1.107679 -0.666468 3.700000
v -1.029128 -0.782323 3.700000
v -0.938511 -0.889005 3.700000
v -0.836891 -0.985264 3.700000
v -0.725459 -1.069973 3.700000
v -0.605522 -1.142136 3.700000
v -0.478486 -1.200910 3.700000
v -0.345840 -1.245603 3.700000
v -0.209139 -1.275693 3.700000
v -0.069987 -1.290827 3.700000
v 0.069987 -1.290827 3.700000
v 0.209139 -1.275693 3.700000
v 0.345840 -1.245603 3.700000
v 0.478486 -1.200910 3.700000
v 0.605522 -1.142136 3.700000
v 0.725459 -1.069973 3.700000
v 0.836891 -0.985264 3.700000
v 0.938511 -0.889005 3.700000
v 1.029128 -0.782323 3.700000
v 1.107679 -0.666468 3.700000
v 1.173244 -0.542800 3.700000
v 1.225053 -0.412768 3.700000
v 1.262500 -0.277897 3.700000
v 1.285145 -0.139768 3.700000
v 1.292723 0.000000 5.700000
v 1.285145 -0.139768 5.700000
v 1.262500 -0.277897 5.700000
v 1.225053 -0.412768 5.700000
v 1.173244 -0.542800 5.700000
v 1.107679 -0.666468 5.700000
v 1.029128 -0.782323 5.700000
v 0.938511 -0.889005 5.700000
v 0.836891 -0.985264 5.700000
v 0.725459 -1.069973 5.700000
v 0.605522 -1.142136 5.700000
v 0.478486 -1.200910 5.700000
v 0.345840 -1.245603 5.700000
v 0.209139 -1.275693 5.700000
v 0.069987 -1.290827 5.700000
v -0.069987 -1.290827 5.700000
v -0.209139 -1.275693 5.700000
v -0.345840 -1.245603 5.700000
v -0.478486 -1.200910 5.700000
v -0.605522 -1.142136 5.700000
v -0.725459 -1.069973 5.700000
v -0.836891 -0.985264 5.700000
v -0.938511 -0.889005 5.700000
v -1.029128 -0.782323 5.700000
v -1.107679 -0.666468 5.700000
v -1.173244 -0.542800 5.700000
v -1.225053 -0.412768 5.700000
v -1.262500 -0.277897 5.700000
v -1.285145 -0.139768 5.700000
v -1.292723 0.000000 5.700000
v -1.285145 0.139768 5.700000
v -1.262500 0.277897 5.700000
v -1.225053 0.412768 5.700000
v -1.173244 0.542800 5.700000
v -1.107679 0.666468 5.700000
v -1.029128 0.782323 5.700000
v -0.938511 0.889005 5.700000
v -0.836891 0.985264 5.700000
v -0.725459 1.069973 5.700000
v -0.605522 1.142136 5.700000
v -0.478486 1.200910 5.700000
v -0.345840 1.245603 5.700000
v -0.209139 1.275693 5.700000
v -0.069987 1.290827 5.700000
v 0.069987 1.290827 5.700000
v 0.209139 1.275693 5.700000
v 0.345840 1.245603 5.700000
v 0.478486 1.200910 5.700000
v 0.605522 1.142136 5.700000
v 0.725459 1.069973 5.700000
v 0.836891 0.985264 5.700000
v 0.938511 0.889005 5.700000
v 1.029128 0.782323 5.700000
v 1.107679 0.666468 5.700000
v 1.173244 0.542800 5.700000
v 1.225053 0.412768 5.700000
v 1.262500 0.277897 5.700000
v 1.285145 0.139768 5.700000
v 3.463185 -0.079677 3.700000
v 1.800595 2.959368 3.700000
v -1.662591 3.039045 3.700000
v -3.463185 0.079677 3.700000
v 1.800595 2.959368 1.700000
v 3.463185 -0.079677 1.700000
v -3.463185 0.079677 1.700000
v -1.662591 3.039045 1.700000
v -1.292723 -0.000000 1.700000
v -1.285145 -0.139768 1.700000
v -1.262500 -0.277897 1.700000
v -1.225053 -0.412768 1.700000
v -1.173244 -0.542800 1.700000
v -1.107679 -0.666468 1.700000
v -1.029128 -0.782323 1.700000
v -0.938511 -0.889005 1.700000
v -0.836891 -0.985264 1.700000
v -0.725459 -1.069973 1.700000
v -0.605522 -1.142136 1.700000
v -0.478486 -1.200910 1.700000
v -0.345840 -1.245603 1.700000
v -0.209139 -1.275693 1.700000
v -0.069987 -1.290827 1.700000
v 0.069987 -1.290827 1.700000
v 0.209139 -1.275693 1.700000
v 0.345840 -1.245603 1.700000
v 0.478486 -1.200910 1.700000
v 0.605522 -1.142136 1.700000
v 0.725459 -1.069973 1.700000
v 0.836891 -0.985264 1.700000
v 0.938511 -0.889005 1.700000
v 1.029128 -0.782323 1.700000
v 1.107679 -0.666468 1.700000
v 1.173244 -0.542800 1.700000
v 1.225053 -0.412768 1.700000
v 1.262500 -0.277897 1.700000
v 1.285145 -0.139768 1.700000
v 1.292723 0.000000 1.700000
v 1.285145 0.139768 1.700000
v 1.262500 0.277897 1.700000
v 1.225053 0.412768 1.700000
v 1.173244 0.542800 1.700000
v 1.107679 0.666468 1.700000
v 1.029128 0.782323 1.700000
v 0.938511 0.889005 1.700000
v 0.836891 0.985264 1.700000
v 0.725459 1.069973 1.700000
v 0.605522 1.142136 1.700000
v 0.478486 1.200910 1.700000
v 0.345840 1.245603 1.700000
v 0.209139 1.275693 1.700000
v 0.069987 1.290827 1.700000
v -0.069987 1.290827 1.700000
v -0.209139 1.275693 1.700000
v -0.345840 1.245603 1.700000
v -0.478486 1.200910 1.700000
v -0.605522 1.142136 1.700000
v -0.725459 1.069973 1.700000
v -0.836891 0.985264 1.700000
v -0.938511 0.889005 1.700000
v -1.029128 0.782323 1.700000
v -1.107679 0.666468 1.700000
v -1.173244 0.542800 1.700000
v -1.225053 0.412768 1.700000
v -1.262500 0.277897 1.700000
v -1.285145 0.139768 1.700000
v -0.200000 -0.000000 0.000000
v -0.193185 0.051764 0.000000
v -0.173205 0.100000 0.000000
v -0.141421 0.141421 0.000000
v -0.100000 0.173205 0.000000
v -0.051764 0.193185 0.000000
v 0.000000 0.200000 0.000000
v 0.051764 0.193185 0.000000
v 0.100000 0.173205 0.000000
v 0.141421 0.141421 0.000000
v 0.173205 0.100000 0.000000
v 0.193185 0.051764 0.000000
v 0.200000 0.000000 0.000000
v 0.193185 -0.051764 0.000000
v 0.173205 -0.100000 0.000000
v 0.141421 -0.141421 0.000000
v 0.100000 -0.173205 0.000000
v 0.051764 -0.193185 0.000000
v 0.000000 -0.200000 0.000000
v -0.051764 -0.193185 0.000000
v -0.100000 -0.173205 0.000000
v -0.141421 -0.141421 0.000000
v -0.173205 -0.100000 0.000000
v -0.193185 -0.051764 0.000000
v 0.000000 0.000000 0.428901
v -0.500000 -0.000000 0.000000
v -0.492808 -0.084500 0.000000
v -0.471439 -0.166570 0.000000
v -0.436507 -0.243847 0.000000
v -0.389018 -0.314110 0.000000
v -0.330337 -0.375336 0.000000
v -0.262154 -0.425765 0.000000
v -0.186428 -0.463945 0.000000
v -0.105340 -0.488778 0.000000
v -0.021221 -0.499549 0.000000
v 0.063509 -0.495950 0.000000
v 0.146411 -0.478083 0.000000
v 0.225102 -0.446463 0.000000
v 0.297317 -0.401999 0.000000
v 0.360978 -0.345969 0.000000
v 0.414255 -0.279987 0.000000
v 0.455614 -0.205951 0.000000
v 0.483866 -0.125989 0.000000
v 0.498199 -0.042403 0.000000
v 0.498199 0.042403 0.000000
v 0.483866 0.125989 0.000000
v 0.455614 0.205951 0.000000
v 0.414255 0.279987 0.000000
v 0.360978 0.345969 0.000000
v 0.297317 0.401999 0.000000
v 0.225102 0.446463 0.000000
v 0.146411 0.478083 0.000000
v 0.063509 0.495950 0.000000
v -0.021221 0.499549 0.000000
v -0.105340 0.488778 0.000000
v -0.186428 0.463945 0.000000
v -0.262154 0.425765 0.000000
v -0.330337 0.375336 0.000000
v -0.389018 0.314110 0.000000
v -0.436507 0.243847 0.000000
v -0.471439 0.166570 0.000000
v -0.492808 0.084500 0.000000
vt -0.006050 0.000000 0.000000
vt -0.004537 0.000000 0.000000
vt -0.006050 0.010000 0.000000
vt -0.004537 0.010000 0.000000
vt -0.003025 0.000000 0.000000
vt -0.003025 0.010000 0.000000
vt -0.001512 0.000000 0.000000
vt -0.001512 0.010000 0.000000
vt -0.000000 0.000000 0.000000
vt -0.000000 0.010000 0.000000
vt -0.007508 0.000000 0.000000
vt -0.005631 0.000000 0.000000
vt -0.007508 0.010000 0.000000
vt -0.005631 0.010000 0.000000
vt -0.003754 0.000000 0.000000
vt -0.003754 0.010000 0.000000
vt -0.001877 0.000000 0.000000
vt -0.001877 0.010000 0.000000
vt -0.000000 0.000000 0.000000
vt -0.000000 0.010000 0.000000
vt -0.010360 0.000000 0.000000
vt -0.007770 0.000000 0.000000
vt -0.010360 0.010000 0.000000
vt -0.007770 0.010000 0.000000
vt -0.005180 0.000000 0.000000
vt -0.005180 0.010000 0.000000
vt -0.002590 0.000000 0.000000
vt -0.002590 0.010000 0.000000
vt -0.000000 0.000000 0.000000
vt -0.000000 0.010000 0.000000
vt -0.007925 -0.000000 0.000000
vt -0.000000 0.000000 0.000000
vt -0.007925 0.010000 0.000000
vt 0.000000 0.010000 0.000000
vt -0.026931 0.000000 0.000000
vt -0.000000 0.000000 0.000000
vt -0.026931 0.010000 0.000000
vt -0.000000 0.010000 0.000000
vt -0.009335 -0.000000 0.000000
vt -0.000000 0.000000 0.000000
vt -0.009335 0.010000 0.000000
vt -0.000000 0.010000 0.000000
vt -0.008130 0.000000 0.000000
vt -0.006097 0.000000 0.000000
vt -0.008130 0.010000 0.000000
vt -0.006097 0.010000 0.000000
vt -0.004065 0.000000 0.000000
vt -0.004065 0.010000 0.000000
vt -0.002032 0.000000 0.000000
vt -0.002032 0.010000 0.000000
vt -0.000000 0.000000 0.000000
vt -0.000000 0.010000 0.000000
vt -0.006251 0.000000 0.000000
vt -0.004688 0.000000 0.000000
vt -0.006251 0.010000 0.000000
vt -0.004688 0.010000 0.000000
vt -0.003125 0.000000 0.000000
vt -0.003125 0.010000 0.000000
vt -0.001563 0.000000 0.000000
vt -0.001563 0.010000 0.000000
vt -0.000000 0.000000 0.000000
vt -0.000000 0.010000 0.000000
vt -0.006789 0.000000 0.000000
vt -0.005091 0.000000 0.000000
vt -0.006789 0.010000 0.000000
vt -0.005091 0.010000 0.000000
vt -0.003394 0.000000 0.000000
vt -0.003394 0.010000 0.000000
vt -0.001697 0.000000 0.000000
vt -0.001697 0.010000 0.000000
vt -0.000000 0.000000 0.000000
vt -0.000000 0.010000 0.000000
vt -0.006630 0.000000 0.000000
vt -0.004972 0.000000 0.000000
vt -0.006630 0.010000 0.000000
vt -0.004972 0.010000 0.000000
vt -0.003315 0.000000 0.000000
vt -0.003315 0.010000 0.000000
vt -0.001657 0.000000 0.000000
vt -0.001657 0.010000 0.000000
vt -0.000000 0.000000 0.000000
vt -0.000000 0.010000 0.000000
vt -0.006865 0.000000 0.000000
vt -0.005149 0.000000 0.000000
vt -0.006865 0.010000 0.000000
vt -0.005149 0.010000 0.000000
vt -0.003432 0.000000 0.000000
vt -0.003432 0.010000 0.000000
vt -0.001716 0.000000 0.000000
vt -0.001716 0.010000 0.000000
vt -0.000000 0.000000 0.000000
vt -0.000000 0.010000 0.000000
vt -0.018718 0.000000 0.000000
vt -0.014039 0.000000 0.000000
vt -0.018718 0.010000 0.000000
vt -0.014039 0.010000 0.000000
vt -0.009359 0.000000 0.000000
vt -0.009359 0.010000 0.000000
vt -0.004680 0.000000 0.000000
vt -0.004680 0.010000 0.000000
vt -0.000000 0.000000 0.000000
vt -0.000000 0.010000 0.000000
vt -0.018784 0.000000 0.000000
vt -0.014088 0.000000 0.000000
vt -0.018784 0.010000 0.000000
vt -0.014088 0.010000 0.000000
vt -0.009392 0.000000 0.000000
vt -0.009392 0.010000 0.000000
vt -0.004696 0.000000 0.000000
vt -0.004696 0.010000 0.000000
vt -0.000000 0.000000 0.000000
vt -0.000000 0.010000 0.000000
vt -0.013807 0.000000 0.000000
vt -0.010355 0.000000 0.000000
vt -0.013807 0.010000 0.000000
vt -0.010355 0.010000 0.000000
vt -0.006903 0.000000 0.000000
vt -0.006903 0.010000 0.000000
vt -0.003452 0.000000 0.000000
vt -0.003452 0.010000 0.000000
vt -0.000000 0.000000 0.000000
vt -0.000000 0.010000 0.000000
vt -0.012491 0.000000 0.000000
vt -0.009368 0.000000 0.000000
vt -0.012491 0.010000 0.000000
vt -0.009368 0.010000 0.000000
vt -0.006245 0.000000 0.000000
vt -0.006245 0.010000 0.000000
vt -0.003123 0.000000 0.000000
vt -0.003123 0.010000 0.000000
vt -0.000000 0.000000 0.000000
vt -0.000000 0.010000 0.000000
vt -0.012726 0.000000 0.000000
vt -0.009545 0.000000 0.000000
vt -0.012726 0.010000 0.000000
vt -0.009545 0.010000 0.000000
vt -0.006363 0.000000 0.000000
vt -0.006363 0.010000 0.000000
vt -0.003182 0.000000 0.000000
vt -0.003182 0.010000 0.000000
vt -0.000000 0.000000 0.000000
vt -0.000000 0.010000 0.000000
vt -0.015278 0.000000 0.000000
vt -0.011459 0.000000 0.000000
vt -0.015278 0.010000 0.000000
vt -0.011459 0.010000 0.000000
vt -0.007639 0.000000 0.000000
vt -0.007639 0.010000 0.000000
vt -0.003820 0.000000 0.000000
vt -0.003820 0.010000 0.000000
vt -0.000000 0.000000 0.000000
vt -0.000000 0.010000 0.000000
vt -0.043251 0.000000 0.000000
vt -0.000000 0.000000 0.000000
vt -0.043251 0.010000 0.000000
vt 0.000000 0.010000 0.000000
vt -0.100000 0.000000 0.000000
vt -0.000000 0.000000 0.000000
vt -0.100000 0.010000 0.000000
vt 0.000000 0.010000 0.000000
vt -0.025655 -0.000000 0.000000
vt -0.000000 0.000000 0.000000
vt -0.025655 0.010000 0.000000
vt -0.000000 0.010000 0.000000
vt -0.036669 0.000000 0.000000
vt -0.000000 0.000000 0.000000
vt -0.036669 0.010000 0.000000
vt -0.000000 0.010000 0.000000
vt -0.011948 -0.000000 0.000000
vt -0.000000 0.000000 0.000000
vt -0.011948 0.010000 0.000000
vt -0.000000 0.010000 0.000000
vt -0.045659 0.000000 0.000000
vt -0.000000 0.000000 0.000000
vt -0.045659 0.010000 0.000000
vt 0.000000 0.010000 0.000000
vt -0.031499 -0.000000 0.000000
vt -0.000000 0.000000 0.000000
vt -0.031499 0.010000 0.000000
vt 0.000000 0.010000 0.000000
vt -0.054314 0.000000 0.000000
vt -0.000000 0.000000 0.000000
vt -0.054314 0.010000 0.000000
vt 0.000000 0.010000 0.000000
vt 0.091303 -0.049228 0.000000
vt 0.057925 -0.006380 0.000000
vt 0.059804 -0.049228 0.000000
vt 0.032599 -0.012559 0.000000
vt 0.033759 0.005561 0.000000
vt 0.031169 0.005470 0.000000
vt 0.062079 -0.004081 0.000000
vt 0.036341 0.005765 0.000000
vt 0.038919 0.006044 0.000000
vt 0.040787 0.006428 0.000000
vt 0.042591 0.006973 0.000000
vt 0.044282 0.007797 0.000000
vt 0.045903 0.008798 0.000000
vt 0.047065 0.009796 0.000000
vt 0.048132 0.010875 0.000000
vt 0.049034 0.012093 0.000000
vt 0.065978 -0.001464 0.000000
vt 0.049832 0.013398 0.000000
vt 0.069431 0.001710 0.000000
vt 0.050411 0.015033 0.000000
vt 0.072599 0.005238 0.000000
vt 0.050831 0.016699 0.000000
vt 0.074905 0.009453 0.000000
vt 0.051017 0.018411 0.000000
vt 0.076625 0.013840 0.000000
vt 0.077437 0.018496 0.000000
vt 0.051075 0.020148 0.000000
vt 0.077737 0.023304 0.000000
vt 0.050977 0.021831 0.000000
vt 0.077543 0.026818 0.000000
vt 0.050728 0.023476 0.000000
vt 0.077016 0.030246 0.000000
vt 0.075904 0.033523 0.000000
vt 0.050213 0.025057 0.000000
vt 0.074412 0.036702 0.000000
vt 0.072536 0.039252 0.000000
vt 0.070459 0.041595 0.000000
vt 0.049530 0.026595 0.000000
vt 0.068051 0.043598 0.000000
vt 0.065447 0.045400 0.000000
vt 0.062604 0.046892 0.000000
vt 0.048457 0.027963 0.000000
vt 0.059682 0.048166 0.000000
vt 0.047238 0.029152 0.000000
vt 0.056627 0.049075 0.000000
vt 0.053492 0.049765 0.000000
vt 0.045794 0.030066 0.000000
vt 0.049695 0.050223 0.000000
vt 0.044224 0.030826 0.000000
vt 0.045890 0.050561 0.000000
vt 0.042734 0.031325 0.000000
vt 0.041222 0.031726 0.000000
vt 0.042072 0.050718 0.000000
vt 0.039677 0.031975 0.000000
vt 0.038247 0.050772 0.000000
vt 0.038113 0.032136 0.000000
vt 0.036083 0.032242 0.000000
vt 0.034052 0.032320 0.000000
vt 0.032019 0.032357 0.000000
vt 0.029987 0.032371 0.000000
vt 0.020651 0.032371 0.000000
vt -0.005003 0.050772 0.000000
vt 0.020651 0.005440 0.000000
vt -0.005003 -0.049228 0.000000
vt 0.020651 -0.012559 0.000000
vt 0.020651 -0.049228 0.000000
vt 0.028576 0.005440 0.000000
vt -0.048690 0.000000 0.000000
vt -0.000000 0.000000 0.000000
vt -0.048690 0.010000 0.000000
vt 0.000000 0.010000 0.000000
vt -0.018402 0.000000 0.000000
vt -0.000000 0.000000 0.000000
vt -0.018402 0.010000 0.000000
vt -0.000000 0.010000 0.000000
vt -0.022901 0.000000 0.000000
vt -0.000000 0.000000 0.000000
vt -0.022901 0.010000 0.000000
vt -0.000000 0.010000 0.000000
vt -0.039867 0.000000 0.000000
vt -0.000000 0.000000 0.000000
vt -0.039867 0.010000 0.000000
vt -0.000000 0.010000 0.000000
vt -0.010053 0.000000 0.000000
vt -0.007540 0.000000 0.000000
vt -0.010053 0.010000 0.000000
vt -0.007540 0.010000 0.000000
vt -0.005026 0.000000 0.000000
vt -0.005026 0.010000 0.000000
vt -0.002513 0.000000 0.000000
vt -0.002513 0.010000 0.000000
vt -0.000000 0.000000 0.000000
vt -0.000000 0.010000 0.000000
vt -0.007435 0.000000 0.000000
vt -0.005576 0.000000 0.000000
vt -0.007435 0.010000 0.000000
vt -0.005576 0.010000 0.000000
vt -0.003718 0.000000 0.000000
vt -0.003718 0.010000 0.000000
vt -0.001859 0.000000 0.000000
vt -0.001859 0.010000 0.000000
vt -0.000000 0.000000 0.000000
vt -0.000000 0.010000 0.000000
vt -0.007532 0.000000 0.000000
vt -0.005649 0.000000 0.000000
vt -0.007532 0.010000 0.000000
vt -0.005649 0.010000 0.000000
vt -0.003766 0.000000 0.000000
vt -0.003766 0.010000 0.000000
vt -0.001883 0.000000 0.000000
vt -0.001883 0.010000 0.000000
vt -0.000000 0.000000 0.000000
vt -0.000000 0.010000 0.000000
vt -0.011010 0.000000 0.000000
vt -0.008258 0.000000 0.000000
vt -0.011010 0.010000 0.000000
vt -0.008258 0.010000 0.000000
vt -0.005505 0.000000 0.000000
vt -0.005505 0.010000 0.000000
vt -0.002753 0.000000 0.000000
vt -0.002753 0.010000 0.000000
vt -0.000000 0.000000 0.000000
vt -0.000000 0.010000 0.000000
vt -0.008993 0.000000 0.000000
vt -0.006745 0.000000 0.000000
vt -0.008993 0.010000 0.000000
vt -0.006745 0.010000 0.000000
vt -0.004497 0.000000 0.000000
vt -0.004497 0.010000 0.000000
vt -0.002248 0.000000 0.000000
vt -0.002248 0.010000 0.000000
vt -0.000000 0.000000 0.000000
vt -0.000000 0.010000 0.000000
vt -0.007083 0.000000 0.000000
vt -0.005312 0.000000 0.000000
vt -0.007083 0.010000 0.000000
vt -0.005312 0.010000 0.000000
vt -0.003541 0.000000 0.000000
vt -0.003541 0.010000 0.000000
vt -0.001771 0.000000 0.000000
vt -0.001771 0.010000 0.000000
vt -0.000000 0.000000 0.000000
vt -0.000000 0.010000 0.000000
vt -0.002418 -0.000000 0.000000
vt -0.000000 0.000000 0.000000
vt -0.002418 0.010000 0.000000
vt 0.000000 0.010000 0.000000
vt -0.020221 0.000000 0.000000
vt -0.000000 0.000000 0.000000
vt -0.020221 0.010000 0.000000
vt 0.000000 0.010000 0.000000
vt -0.010841 0.000000 0.000000
vt -0.008131 0.000000 0.000000
vt -0.010841 0.010000 0.000000
vt -0.008131 0.010000 0.000000
vt -0.005421 0.000000 0.000000
vt -0.005421 0.010000 0.000000
vt -0.002710 0.000000 0.000000
vt -0.002710 0.010000 0.000000
vt -0.000000 0.000000 0.000000
vt -0.000000 0.010000 0.000000
vt -0.013039 0.000000 0.000000
vt -0.009779 0.000000 0.000000
vt -0.013039 0.010000 0.000000
vt -0.009779 0.010000 0.000000
vt -0.006519 0.000000 0.000000
vt -0.006519 0.010000 0.000000
vt -0.003260 0.000000 0.000000
vt -0.003260 0.010000 0.000000
vt -0.000000 0.000000 0.000000
vt -0.000000 0.010000 0.000000
vt -0.017283 0.000000 0.000000
vt -0.012962 0.000000 0.000000
vt -0.017283 0.010000 0.000000
vt -0.012962 0.010000 0.000000
vt -0.008641 0.000000 0.000000
vt -0.008641 0.010000 0.000000
vt -0.004321 0.000000 0.000000
vt -0.004321 0.010000 0.000000
vt -0.000000 0.000000 0.000000
vt -0.000000 0.010000 0.000000
vt -0.013513 0.000000 0.000000
vt -0.010135 0.000000 0.000000
vt -0.013513 0.010000 0.000000
vt -0.010135 0.010000 0.000000
vt -0.006756 0.000000 0.000000
vt -0.006756 0.010000 0.000000
vt -0.003378 0.000000 0.000000
vt -0.003378 0.010000 0.000000
vt -0.000000 0.000000 0.000000
vt -0.000000 0.010000 0.000000
vt -0.011957 0.000000 0.000000
vt -0.008967 0.000000 0.000000
vt -0.011957 0.010000 0.000000
vt -0.008967 0.010000 0.000000
vt -0.005978 0.000000 0.000000
vt -0.005978 0.010000 0.000000
vt -0.002989 0.000000 0.000000
vt -0.002989 0.010000 0.000000
vt -0.000000 0.000000 0.000000
vt -0.000000 0.010000 0.000000
vt -0.012546 0.000000 0.000000
vt -0.009409 0.000000 0.000000
vt -0.012546 0.010000 0.000000
vt -0.009409 0.010000 0.000000
vt -0.006273 0.000000 0.000000
vt -0.006273 0.010000 0.000000
vt -0.003136 0.000000 0.000000
vt -0.003136 0.010000 0.000000
vt -0.000000 0.000000 0.000000
vt -0.000000 0.010000 0.000000
vt -0.070651 0.000000 0.000000
vt -0.000000 0.000000 0.000000
vt -0.070651 0.010000 0.000000
vt -0.000000 0.010000 0.000000
vt -0.029248 0.050772 0.000000
vt -0.055037 0.032371 0.000000
vt -0.029248 -0.019879 0.000000
vt -0.055037 -0.007497 0.000000
vt -0.055046 -0.010010 0.000000
vt -0.077938 0.050772 0.000000
vt -0.077938 0.032371 0.000000
vt -0.055076 -0.012523 0.000000
vt -0.055144 -0.015036 0.000000
vt -0.055238 -0.017547 0.000000
vt -0.055433 -0.019413 0.000000
vt -0.034504 -0.037478 0.000000
vt -0.032942 -0.034919 0.000000
vt -0.031598 -0.032203 0.000000
vt -0.055758 -0.021247 0.000000
vt -0.038583 -0.041907 0.000000
vt -0.036433 -0.039772 0.000000
vt -0.056304 -0.023027 0.000000
vt -0.044170 -0.045760 0.000000
vt -0.041314 -0.043946 0.000000
vt -0.047228 -0.047213 0.000000
vt -0.056985 -0.024774 0.000000
vt -0.050403 -0.048455 0.000000
vt -0.058022 -0.026405 0.000000
vt -0.054616 -0.049514 0.000000
vt -0.059235 -0.027857 0.000000
vt -0.060731 -0.029021 0.000000
vt -0.058869 -0.050294 0.000000
vt -0.062391 -0.030018 0.000000
vt -0.063182 -0.050651 0.000000
vt -0.065022 -0.030917 0.000000
vt -0.067701 -0.031558 0.000000
vt -0.067529 -0.050772 0.000000
vt -0.070450 -0.031829 0.000000
vt -0.070789 -0.050738 0.000000
vt -0.073237 -0.031901 0.000000
vt -0.074048 -0.050654 0.000000
vt -0.075496 -0.031851 0.000000
vt -0.077304 -0.050488 0.000000
vt -0.077742 -0.031694 0.000000
vt -0.080557 -0.050270 0.000000
vt -0.079964 -0.031343 0.000000
vt -0.083258 -0.050016 0.000000
vt -0.082169 -0.030860 0.000000
vt -0.083862 -0.030337 0.000000
vt -0.085951 -0.049706 0.000000
vt -0.085547 -0.029793 0.000000
vt -0.088631 -0.049300 0.000000
vt -0.087220 -0.029212 0.000000
vt -0.091303 -0.048831 0.000000
vt -0.088885 -0.028610 0.000000
vt -0.091303 -0.028610 0.000000
vt -0.030593 -0.029202 0.000000
vt -0.029818 -0.026157 0.000000
vt -0.029421 -0.023040 0.000000
vt 0.346410 0.000000 0.000000
vt 0.168202 0.050000 0.000000
vt 0.000000 0.000000 0.000000
vt 0.114336 0.048934 0.000000
vt 0.110023 0.048577 0.000000
vt 0.346410 0.200000 0.000000
vt 0.264508 0.050000 0.000000
vt 0.233009 0.050000 0.000000
vt 0.193857 0.050000 0.000000
vt 0.205805 0.086669 0.000000
vt 0.193857 0.086669 0.000000
vt 0.000000 0.200000 0.000000
vt 0.168202 0.150000 0.000000
vt 0.211452 0.150000 0.000000
vt 0.215277 0.149945 0.000000
vt 0.081902 0.070618 0.000000
vt 0.095267 0.131598 0.000000
vt 0.095267 0.150000 0.000000
vt 0.143957 0.150000 0.000000
vt 0.143957 0.079349 0.000000
vt 0.143784 0.076188 0.000000
vt 0.143388 0.073070 0.000000
vt 0.142612 0.070025 0.000000
vt 0.141607 0.067025 0.000000
vt 0.140263 0.064308 0.000000
vt 0.138701 0.061750 0.000000
vt 0.136772 0.059455 0.000000
vt 0.134622 0.057320 0.000000
vt 0.131891 0.055282 0.000000
vt 0.129035 0.053467 0.000000
vt 0.125977 0.052014 0.000000
vt 0.122802 0.050772 0.000000
vt 0.118589 0.049713 0.000000
vt 0.105677 0.048455 0.000000
vt 0.102416 0.048490 0.000000
vt 0.099157 0.048573 0.000000
vt 0.095901 0.048740 0.000000
vt 0.092648 0.048957 0.000000
vt 0.089947 0.049212 0.000000
vt 0.087254 0.049521 0.000000
vt 0.084574 0.049928 0.000000
vt 0.081902 0.050397 0.000000
vt 0.118168 0.091731 0.000000
vt 0.084320 0.070618 0.000000
vt 0.118159 0.089217 0.000000
vt 0.118129 0.086704 0.000000
vt 0.118061 0.084192 0.000000
vt 0.117967 0.081680 0.000000
vt 0.117772 0.079815 0.000000
vt 0.085985 0.070015 0.000000
vt 0.117447 0.077981 0.000000
vt 0.087658 0.069435 0.000000
vt 0.116902 0.076200 0.000000
vt 0.089344 0.068891 0.000000
vt 0.091036 0.068368 0.000000
vt 0.093241 0.067885 0.000000
vt 0.095463 0.067533 0.000000
vt 0.097709 0.067376 0.000000
vt 0.116221 0.074453 0.000000
vt 0.099968 0.067327 0.000000
vt 0.115183 0.072822 0.000000
vt 0.102755 0.067399 0.000000
vt 0.113970 0.071371 0.000000
vt 0.105504 0.067670 0.000000
vt 0.108183 0.068311 0.000000
vt 0.110814 0.069210 0.000000
vt 0.112474 0.070207 0.000000
vt 0.118168 0.131598 0.000000
vt 0.248110 0.108680 0.000000
vt 0.245804 0.104466 0.000000
vt 0.242636 0.100938 0.000000
vt 0.239184 0.097764 0.000000
vt 0.235285 0.095146 0.000000
vt 0.231130 0.092848 0.000000
vt 0.219095 0.149789 0.000000
vt 0.222900 0.149450 0.000000
vt 0.226697 0.148993 0.000000
vt 0.229832 0.148303 0.000000
vt 0.232887 0.147393 0.000000
vt 0.235809 0.146120 0.000000
vt 0.238652 0.144627 0.000000
vt 0.241256 0.142826 0.000000
vt 0.243664 0.140823 0.000000
vt 0.245741 0.138480 0.000000
vt 0.247617 0.135930 0.000000
vt 0.249109 0.132751 0.000000
vt 0.250221 0.129474 0.000000
vt 0.250748 0.126046 0.000000
vt 0.250942 0.122532 0.000000
vt 0.250643 0.117724 0.000000
vt 0.249830 0.113068 0.000000
vt 0.400000 0.148589 0.000000
vt 0.400000 0.157080 0.000000
vt 0.266667 0.157080 0.000000
vt 0.266667 -0.157080 0.000000
vt 0.400000 -0.157080 0.000000
vt 0.400000 -0.148589 0.000000
vt 0.266667 -0.148353 0.000000
vt 0.400000 -0.140098 0.000000
vt 0.266667 -0.139626 0.000000
vt 0.400000 -0.131607 0.000000
vt 0.266667 -0.130900 0.000000
vt 0.400000 -0.123116 0.000000
vt 0.266667 -0.122173 0.000000
vt 0.400000 -0.114626 0.000000
vt 0.266667 -0.113446 0.000000
vt 0.400000 -0.106135 0.000000
vt 0.266667 -0.104720 0.000000
vt 0.400000 -0.097644 0.000000
vt 0.266667 -0.095993 0.000000
vt 0.400000 -0.089153 0.000000
vt 0.266667 -0.087266 0.000000
vt 0.400000 -0.080663 0.000000
vt 0.266667 -0.078540 0.000000
vt 0.400000 -0.072172 0.000000
vt 0.266667 -0.069813 0.000000
vt 0.400000 -0.063681 0.000000
vt 0.266667 -0.061087 0.000000
vt 0.400000 -0.055190 0.000000
vt 0.266667 -0.052360 0.000000
vt 0.400000 -0.046699 0.000000
vt 0.266667 -0.043633 0.000000
vt 0.400000 -0.038209 0.000000
vt 0.266667 -0.034907 0.000000
vt 0.400000 -0.029718 0.000000
vt 0.266667 -0.026180 0.000000
vt 0.400000 -0.021227 0.000000
vt 0.266667 -0.017453 0.000000
vt 0.400000 -0.012736 0.000000
vt 0.266667 -0.008727 0.000000
vt 0.400000 -0.004245 0.000000
vt 0.266667 0.000000 0.000000
vt 0.400000 0.004245 0.000000
vt 0.266667 0.008727 0.000000
vt 0.400000 0.012736 0.000000
vt 0.266667 0.017453 0.000000
vt 0.400000 0.021227 0.000000
vt 0.266667 0.026180 0.000000
vt 0.400000 0.029718 0.000000
vt 0.266667 0.034907 0.000000
vt 0.400000 0.038209 0.000000
vt 0.266667 0.043633 0.000000
vt 0.400000 0.046699 0.000000
vt 0.266667 0.052360 0.000000
vt 0.400000 0.055190 0.000000
vt 0.266667 0.061087 0.000000
vt 0.400000 0.063681 0.000000
vt 0.266667 0.069813 0.000000
vt 0.400000 0.072172 0.000000
vt 0.266667 0.078540 0.000000
vt 0.400000 0.080663 0.000000
vt 0.266667 0.087266 0.000000
vt 0.400000 0.089153 0.000000
vt 0.266667 0.095993 0.000000
vt 0.400000 0.097644 0.000000
vt 0.266667 0.104720 0.000000
vt 0.400000 0.106135 0.000000
vt 0.266667 0.113446 0.000000
vt 0.400000 0.114626 0.000000
vt 0.266667 0.122173 0.000000
vt 0.400000 0.123116 0.000000
vt 0.266667 0.130900 0.000000
vt 0.400000 0.131607 0.000000
vt 0.266667 0.139626 0.000000
vt 0.400000 0.140098 0.000000
vt 0.266667 0.148353 0.000000
vt 0.000000 -0.148589 0.000000
vt 0.000000 -0.157080 0.000000
vt 0.133333 -0.157080 0.000000
vt 0.133333 0.157080 0.000000
vt 0.000000 0.157080 0.000000
vt 0.000000 0.148589 0.000000
vt 0.133333 0.148353 0.000000
vt 0.000000 0.140098 0.000000
vt 0.133333 0.139626 0.000000
vt 0.000000 0.131607 0.000000
vt 0.133333 0.130900 0.000000
vt 0.000000 0.123116 0.000000
vt 0.133333 0.122173 0.000000
vt 0.000000 0.114626 0.000000
vt 0.133333 0.113446 0.000000
vt 0.000000 0.106135 0.000000
vt 0.133333 0.104720 0.000000
vt 0.000000 0.097644 0.000000
vt 0.133333 0.095993 0.000000
vt 0.000000 0.089153 0.000000
vt 0.133333 0.087266 0.000000
vt 0.000000 0.080663 0.000000
vt 0.133333 0.078540 0.000000
vt 0.000000 0.072172 0.000000
vt 0.133333 0.069813 0.000000
vt 0.000000 0.063681 0.000000
vt 0.133333 0.061087 0.000000
vt 0.000000 0.055190 0.000000
vt 0.133333 0.052360 0.000000
vt 0.000000 0.046699 0.000000
vt 0.133333 0.043633 0.000000
vt 0.000000 0.038209 0.000000
vt 0.133333 0.034907 0.000000
vt 0.000000 0.029718 0.000000
vt 0.133333 0.026180 0.000000
vt 0.000000 0.021227 0.000000
vt 0.133333 0.017453 0.000000
vt 0.000000 0.012736 0.000000
vt 0.133333 0.008727 0.000000
vt 0.000000 0.004245 0.000000
vt 0.133333 0.000000 0.000000
vt 0.000000 -0.004245 0.000000
vt 0.133333 -0.008727 0.000000
vt 0.000000 -0.012736 0.000000
vt 0.133333 -0.017453 0.000000
vt 0.000000 -0.021227 0.000000
vt 0.133333 -0.026180 0.000000
vt 0.000000 -0.029718 0.000000
vt 0.133333 -0.034907 0.000000
vt 0.000000 -0.038209 0.000000
vt 0.133333 -0.043633 0.000000
vt 0.000000 -0.046699 0.000000
vt 0.133333 -0.052360 0.000000
vt 0.000000 -0.055190 0.000000
vt 0.133333 -0.061087 0.000000
vt -0.000000 -0.063681 0.000000
vt 0.133333 -0.069813 0.000000
vt 0.000000 -0.072172 0.000000
vt 0.133333 -0.078540 0.000000
vt 0.000000 -0.080663 0.000000
vt 0.133333 -0.087266 0.000000
vt 0.000000 -0.089153 0.000000
vt 0.133333 -0.095993 0.000000
vt 0.000000 -0.097644 0.000000
vt 0.133333 -0.104720 0.000000
vt 0.000000 -0.106135 0.000000
vt 0.133333 -0.113446 0.000000
vt 0.000000 -0.114626 0.000000
vt 0.133333 -0.122173 0.000000
vt 0.000000 -0.123116 0.000000
vt 0.133333 -0.130900 0.000000
vt 0.000000 -0.131607 0.000000
vt 0.133333 -0.139626 0.000000
vt 0.000000 -0.140098 0.000000
vt 0.133333 -0.148353 0.000000
vt -0.400000 0.392117 0.000000
vt -0.200000 0.392117 0.000000
vt -0.400000 0.406121 0.000000
vt -0.200000 0.406121 0.000000
vt -0.400000 -0.406121 0.000000
vt -0.200000 -0.406121 0.000000
vt -0.400000 -0.392117 0.000000
vt -0.200000 -0.392117 0.000000
vt -0.400000 -0.378113 0.000000
vt -0.200000 -0.378113 0.000000
vt -0.400000 -0.364108 0.000000
vt -0.200000 -0.364108 0.000000
vt -0.400000 -0.350104 0.000000
vt -0.200000 -0.350104 0.000000
vt -0.400000 -0.336100 0.000000
vt -0.200000 -0.336100 0.000000
vt -0.400000 -0.322096 0.000000
vt -0.200000 -0.322096 0.000000
vt -0.400000 -0.308092 0.000000
vt -0.200000 -0.308092 0.000000
vt -0.400000 -0.294088 0.000000
vt -0.200000 -0.294088 0.000000
vt -0.400000 -0.280083 0.000000
vt -0.200000 -0.280083 0.000000
vt -0.400000 -0.266079 0.000000
vt -0.200000 -0.266079 0.000000
vt -0.400000 -0.252075 0.000000
vt -0.200000 -0.252075 0.000000
vt -0.400000 -0.238071 0.000000
vt -0.200000 -0.238071 0.000000
vt -0.400000 -0.224067 0.000000
vt -0.200000 -0.224067 0.000000
vt -0.400000 -0.210063 0.000000
vt -0.200000 -0.210063 0.000000
vt -0.400000 -0.196058 0.000000
vt -0.200000 -0.196058 0.000000
vt -0.400000 -0.182054 0.000000
vt -0.200000 -0.182054 0.000000
vt -0.400000 -0.168050 0.000000
vt -0.200000 -0.168050 0.000000
vt -0.400000 -0.154046 0.000000
vt -0.200000 -0.154046 0.000000
vt -0.400000 -0.140042 0.000000
vt -0.200000 -0.140042 0.000000
vt -0.400000 -0.126038 0.000000
vt -0.200000 -0.126038 0.000000
vt -0.400000 -0.112033 0.000000
vt -0.200000 -0.112033 0.000000
vt -0.400000 -0.098029 0.000000
vt -0.200000 -0.098029 0.000000
vt -0.400000 -0.084025 0.000000
vt -0.200000 -0.084025 0.000000
vt -0.400000 -0.070021 0.000000
vt -0.200000 -0.070021 0.000000
vt -0.400000 -0.056017 0.000000
vt -0.200000 -0.056017 0.000000
vt -0.400000 -0.042013 0.000000
vt -0.200000 -0.042013 0.000000
vt -0.400000 -0.028008 0.000000
vt -0.200000 -0.028008 0.000000
vt -0.400000 -0.014004 0.000000
vt -0.200000 -0.014004 0.000000
vt -0.400000 0.000000 0.000000
vt -0.200000 0.000000 0.000000
vt -0.400000 0.014004 0.000000
vt -0.200000 0.014004 0.000000
vt -0.400000 0.028008 0.000000
vt -0.200000 0.028008 0.000000
vt -0.400000 0.042013 0.000000
vt -0.200000 0.042013 0.000000
vt -0.400000 0.056017 0.000000
vt -0.200000 0.056017 0.000000
vt -0.400000 0.070021 0.000000
vt -0.200000 0.070021 0.000000
vt -0.400000 0.084025 0.000000
vt -0.200000 0.084025 0.000000
vt -0.400000 0.098029 0.000000
vt -0.200000 0.098029 0.000000
vt -0.400000 0.112033 0.000000
vt -0.200000 0.112033 0.000000
vt -0.400000 0.126038 0.000000
vt -0.200000 0.126038 0.000000
vt -0.400000 0.140042 0.000000
vt -0.200000 0.140042 0.000000
vt -0.400000 0.154046 0.000000
vt -0.200000 0.154046 0.000000
vt -0.400000 0.168050 0.000000
vt -0.200000 0.168050 0.000000
vt -0.400000 0.182054 0.000000
vt -0.200000 0.182054 0.000000
vt -0.400000 0.196058 0.000000
vt -0.200000 0.196058 0.000000
vt -0.400000 0.210063 0.000000
vt -0.200000 0.210063 0.000000
vt -0.400000 0.224067 0.000000
vt -0.200000 0.224067 0.000000
vt -0.400000 0.238071 0.000000
vt -0.200000 0.238071 0.000000
vt -0.400000 0.252075 0.000000
vt -0.200000 0.252075 0.000000
vt -0.400000 0.266079 0.000000
vt -0.200000 0.266079 0.000000
vt -0.400000 0.280083 0.000000
vt -0.200000 0.280083 0.000000
vt -0.400000 0.294088 0.000000
vt -0.200000 0.294088 0.000000
vt -0.400000 0.308092 0.000000
vt -0.200000 0.308092 0.000000
vt -0.400000 0.322096 0.000000
vt -0.200000 0.322096 0.000000
vt -0.400000 0.336100 0.000000
vt -0.200000 0.336100 0.000000
vt -0.400000 0.350104 0.000000
vt -0.200000 0.350104 0.000000
vt -0.400000 0.364108 0.000000
vt -0.200000 0.364108 0.000000
vt -0.400000 0.378113 0.000000
vt -0.200000 0.378113 0.000000
vt -0.000000 -0.392117 0.000000
vt -0.000000 -0.406121 0.000000
vt -0.000000 0.406121 0.000000
vt -0.000000 0.392117 0.000000
vt -0.000000 0.378113 0.000000
vt -0.000000 0.364108 0.000000
vt -0.000000 0.350104 0.000000
vt -0.000000 0.336100 0.000000
vt -0.000000 0.322096 0.000000
vt -0.000000 0.308092 0.000000
vt -0.000000 0.294088 0.000000
vt -0.000000 0.280083 0.000000
vt -0.000000 0.266079 0.000000
vt -0.000000 0.252075 0.000000
vt -0.000000 0.238071 0.000000
vt -0.000000 0.224067 0.000000
vt -0.000000 0.210063 0.000000
vt -0.000000 0.196058 0.000000
vt -0.000000 0.182054 0.000000
vt -0.000000 0.168050 0.000000
vt -0.000000 0.154046 0.000000
vt -0.000000 0.140042 0.000000
vt -0.000000 0.126038 0.000000
vt -0.000000 0.112033 0.000000
vt -0.000000 0.098029 0.000000
vt -0.000000 0.084025 0.000000
vt -0.000000 0.070021 0.000000
vt -0.000000 0.056017 0.000000
vt -0.000000 0.042013 0.000000
vt -0.000000 0.028008 0.000000
vt -0.000000 0.014004 0.000000
vt -0.000000 0.000000 0.000000
vt -0.000000 -0.014004 0.000000
vt -0.000000 -0.028008 0.000000
vt -0.000000 -0.042013 0.000000
vt -0.000000 -0.056017 0.000000
vt -0.000000 -0.070021 0.000000
vt -0.000000 -0.084025 0.000000
vt -0.000000 -0.098029 0.000000
vt -0.000000 -0.112033 0.000000
vt -0.000000 -0.126038 0.000000
vt -0.000000 -0.140042 0.000000
vt -0.000000 -0.154046 0.000000
vt -0.000000 -0.168050 0.000000
vt -0.000000 -0.182054 0.000000
vt -0.000000 -0.196058 0.000000
vt -0.000000 -0.210063 0.000000
vt -0.000000 -0.224067 0.000000
vt -0.000000 -0.238071 0.000000
vt -0.000000 -0.252075 0.000000
vt -0.000000 -0.266079 0.000000
vt -0.000000 -0.280083 0.000000
vt -0.000000 -0.294088 0.000000
vt -0.000000 -0.308092 0.000000
vt -0.000000 -0.322096 0.000000
vt -0.000000 -0.336100 0.000000
vt -0.000000 -0.350104 0.000000
vt -0.000000 -0.364108 0.000000
vt -0.000000 -0.378113 0.000000
vt -0.049281 0.008450 0.000000
vt -0.128515 0.013977 0.000000
vt -0.050000 -0.000000 0.000000
vt -0.129272 -0.000000 0.000000
vt -0.128515 -0.013977 0.000000
vt -0.126250 0.027790 0.000000
vt -0.047144 0.016657 0.000000
vt -0.122505 0.041277 0.000000
vt -0.117324 0.054280 0.000000
vt -0.043651 0.024385 0.000000
vt -0.110768 0.066647 0.000000
vt -0.038902 0.031411 0.000000
vt -0.102913 0.078232 0.000000
vt -0.093851 0.088900 0.000000
vt -0.033034 0.037534 0.000000
vt -0.083689 0.098526 0.000000
vt -0.072546 0.106997 0.000000
vt -0.026215 0.042576 0.000000
vt -0.060552 0.114214 0.000000
vt -0.018643 0.046394 0.000000
vt -0.047849 0.120091 0.000000
vt -0.034584 0.124560 0.000000
vt -0.010534 0.048878 0.000000
vt -0.020914 0.127569 0.000000
vt -0.002122 0.049955 0.000000
vt -0.006999 0.129083 0.000000
vt 0.006999 0.129083 0.000000
vt 0.006351 0.049595 0.000000
vt 0.020914 0.127569 0.000000
vt 0.014641 0.047808 0.000000
vt 0.034584 0.124560 0.000000
vt 0.047849 0.120091 0.000000
vt 0.022510 0.044646 0.000000
vt 0.060552 0.114214 0.000000
vt 0.072546 0.106997 0.000000
vt 0.029732 0.040200 0.000000
vt 0.083689 0.098526 0.000000
vt 0.036098 0.034597 0.000000
vt 0.093851 0.088900 0.000000
vt 0.102913 0.078232 0.000000
vt 0.041425 0.027999 0.000000
vt 0.110768 0.066647 0.000000
vt 0.045561 0.020595 0.000000
vt 0.117324 0.054280 0.000000
vt 0.122505 0.041277 0.000000
vt 0.048387 0.012599 0.000000
vt 0.126250 0.027790 0.000000
vt 0.049820 0.004240 0.000000
vt 0.128515 0.013977 0.000000
vt 0.129272 0.000000 0.000000
vt 0.049820 -0.004240 0.000000
vt 0.128515 -0.013977 0.000000
vt 0.126250 -0.027790 0.000000
vt 0.048387 -0.012599 0.000000
vt 0.122505 -0.041277 0.000000
vt 0.045561 -0.020595 0.000000
vt 0.117324 -0.054280 0.000000
vt 0.110768 -0.066647 0.000000
vt 0.041425 -0.027999 0.000000
vt 0.102913 -0.078232 0.000000
vt 0.036098 -0.034597 0.000000
vt 0.093851 -0.088900 0.000000
vt 0.083689 -0.098526 0.000000
vt 0.029732 -0.040200 0.000000
vt 0.072546 -0.106997 0.000000
vt 0.022510 -0.044646 0.000000
vt 0.060552 -0.114214 0.000000
vt 0.047849 -0.120091 0.000000
vt 0.014641 -0.047808 0.000000
vt 0.034584 -0.124560 0.000000
vt 0.020914 -0.127569 0.000000
vt 0.006351 -0.049595 0.000000
vt 0.006999 -0.129083 0.000000
vt -0.002122 -0.049955 0.000000
vt -0.006999 -0.129083 0.000000
vt -0.020914 -0.127569 0.000000
vt -0.010534 -0.048878 0.000000
vt -0.034584 -0.124560 0.000000
vt -0.018643 -0.046394 0.000000
vt -0.047849 -0.120091 0.000000
vt -0.060552 -0.114214 0.000000
vt -0.026215 -0.042576 0.000000
vt -0.072546 -0.106997 0.000000
vt -0.033034 -0.037534 0.000000
vt -0.083689 -0.098526 0.000000
vt -0.093851 -0.088900 0.000000
vt -0.038902 -0.031411 0.000000
vt -0.102913 -0.078232 0.000000
vt -0.110768 -0.066647 0.000000
vt -0.043651 -0.024385 0.000000
vt -0.117324 -0.054280 0.000000
vt -0.047144 -0.016657 0.000000
vt -0.122505 -0.041277 0.000000
vt -0.126250 -0.027790 0.000000
vt -0.049281 -0.008450 0.000000
vt 0.180059 0.295937 0.000000
vt 0.110768 0.066647 0.000000
vt 0.346319 -0.007968 0.000000
vt 0.117324 0.054280 0.000000
vt 0.122505 0.041277 0.000000
vt -0.166259 0.303904 0.000000
vt 0.006999 0.129083 0.000000
vt 0.020914 0.127569 0.000000
vt 0.034584 0.124560 0.000000
vt -0.346319 0.007968 0.000000
vt -0.102913 0.078232 0.000000
vt -0.093851 0.088900 0.000000
vt -0.083689 0.098526 0.000000
vt -0.180059 -0.295937 0.000000
vt -0.110768 -0.066647 0.000000
vt -0.117324 -0.054280 0.000000
vt -0.122505 -0.041277 0.000000
vt 0.166259 -0.303904 0.000000
vt -0.006999 -0.129083 0.000000
vt -0.020914 -0.127569 0.000000
vt -0.034584 -0.124560 0.000000
vt 0.102913 -0.078232 0.000000
vt 0.093851 -0.088900 0.000000
vt 0.083689 -0.098526 0.000000
vt 0.128515 0.013977 0.000000
vt 0.129272 0.000000 0.000000
vt 0.128515 -0.013977 0.000000
vt 0.126250 -0.027790 0.000000
vt 0.122505 -0.041277 0.000000
vt 0.117324 -0.054280 0.000000
vt 0.110768 -0.066647 0.000000
vt 0.072546 -0.106997 0.000000
vt 0.060552 -0.114214 0.000000
vt 0.047849 -0.120091 0.000000
vt 0.034584 -0.124560 0.000000
vt 0.020914 -0.127569 0.000000
vt 0.006999 -0.129083 0.000000
vt -0.047849 -0.120091 0.000000
vt -0.060552 -0.114214 0.000000
vt -0.072546 -0.106997 0.000000
vt -0.083689 -0.098526 0.000000
vt -0.093851 -0.088900 0.000000
vt -0.102913 -0.078232 0.000000
vt -0.126250 -0.027790 0.000000
vt -0.128515 -0.013977 0.000000
vt -0.129272 0.000000 0.000000
vt -0.128515 0.013977 0.000000
vt -0.126250 0.027790 0.000000
vt -0.122505 0.041277 0.000000
vt -0.117324 0.054280 0.000000
vt -0.110768 0.066647 0.000000
vt -0.072546 0.106997 0.000000
vt -0.060552 0.114214 0.000000
vt -0.047849 0.120091 0.000000
vt -0.034584 0.124560 0.000000
vt -0.020914 0.127569 0.000000
vt -0.006999 0.129083 0.000000
vt 0.047849 0.120091 0.000000
vt 0.060552 0.114214 0.000000
vt 0.072546 0.106997 0.000000
vt 0.083689 0.098526 0.000000
vt 0.093851 0.088900 0.000000
vt 0.102913 0.078232 0.000000
vt 0.126250 0.027790 0.000000
vt 0.346319 0.007968 0.000000
vt 0.110768 -0.066647 0.000000
vt 0.180059 -0.295937 0.000000
vt 0.102913 -0.078232 0.000000
vt 0.093851 -0.088900 0.000000
vt 0.166259 0.303904 0.000000
vt 0.102913 0.078232 0.000000
vt 0.110768 0.066647 0.000000
vt 0.117324 0.054280 0.000000
vt -0.180059 0.295937 0.000000
vt -0.006999 0.129083 0.000000
vt 0.006999 0.129083 0.000000
vt 0.020914 0.127569 0.000000
vt -0.346319 -0.007968 0.000000
vt -0.110768 0.066647 0.000000
vt -0.102913 0.078232 0.000000
vt -0.093851 0.088900 0.000000
vt -0.166259 -0.303904 0.000000
vt -0.102913 -0.078232 0.000000
vt -0.110768 -0.066647 0.000000
vt -0.117324 -0.054280 0.000000
vt 0.006999 -0.129083 0.000000
vt -0.006999 -0.129083 0.000000
vt -0.020914 -0.127569 0.000000
vt -0.128515 -0.013977 0.000000
vt -0.129272 -0.000000 0.000000
vt -0.128515 0.013977 0.000000
vt -0.126250 0.027790 0.000000
vt -0.122505 0.041277 0.000000
vt -0.117324 0.054280 0.000000
vt -0.083689 0.098526 0.000000
vt -0.072546 0.106997 0.000000
vt -0.060552 0.114214 0.000000
vt -0.047849 0.120091 0.000000
vt -0.034584 0.124560 0.000000
vt -0.020914 0.127569 0.000000
vt 0.034584 0.124560 0.000000
vt 0.047849 0.120091 0.000000
vt 0.060552 0.114214 0.000000
vt 0.072546 0.106997 0.000000
vt 0.083689 0.098526 0.000000
vt 0.093851 0.088900 0.000000
vt 0.122505 0.041277 0.000000
vt 0.126250 0.027790 0.000000
vt 0.128515 0.013977 0.000000
vt 0.129272 -0.000000 0.000000
vt 0.128515 -0.013977 0.000000
vt 0.126250 -0.027790 0.000000
vt 0.122505 -0.041277 0.000000
vt 0.117324 -0.054280 0.000000
vt 0.083689 -0.098526 0.000000
vt 0.072546 -0.106997 0.000000
vt 0.060552 -0.114214 0.000000
vt 0.047849 -0.120091 0.000000
vt 0.034584 -0.124560 0.000000
vt 0.020914 -0.127569 0.000000
vt -0.034584 -0.124560 0.000000
vt -0.047849 -0.120091 0.000000
vt -0.060552 -0.114214 0.000000
vt -0.072546 -0.106997 0.000000
vt -0.083689 -0.098526 0.000000
vt -0.093851 -0.088900 0.000000
vt -0.122505 -0.041277 0.000000
vt -0.126250 -0.027790 0.000000
vt 0.000000 0.000000 0.000000
vt 0.346410 0.000000 0.000000
vt 0.000000 0.200000 0.000000
vt 0.346410 0.200000 0.000000
vt 0.217487 0.107025 0.000000
vt 0.219108 0.108026 0.000000
vt 0.209288 0.131469 0.000000
vt 0.220270 0.109024 0.000000
vt 0.221337 0.110103 0.000000
vt 0.222239 0.111320 0.000000
vt 0.223616 0.114261 0.000000
vt 0.224037 0.115926 0.000000
vt 0.223037 0.112626 0.000000
vt 0.224223 0.117638 0.000000
vt 0.211318 0.131363 0.000000
vt 0.224280 0.119375 0.000000
vt 0.212882 0.131202 0.000000
vt 0.224183 0.121059 0.000000
vt 0.214427 0.130954 0.000000
vt 0.215939 0.130553 0.000000
vt 0.223933 0.122704 0.000000
vt 0.217429 0.130054 0.000000
vt 0.223418 0.124284 0.000000
vt 0.219000 0.129294 0.000000
vt 0.221662 0.127191 0.000000
vt 0.220443 0.128380 0.000000
vt 0.222735 0.125823 0.000000
vt 0.207257 0.131548 0.000000
vt 0.209546 0.104993 0.000000
vt 0.212124 0.105272 0.000000
vt 0.213992 0.105656 0.000000
vt 0.206964 0.104789 0.000000
vt 0.205225 0.131585 0.000000
vt 0.204374 0.104697 0.000000
vt 0.203192 0.131598 0.000000
vt 0.201781 0.104668 0.000000
vt 0.193857 0.131598 0.000000
vt 0.193857 0.104668 0.000000
vt 0.215796 0.106201 0.000000
vt 0.000000 0.000000 0.000000
vt 0.346410 0.000000 0.000000
vt 0.000000 0.200000 0.000000
vt 0.346410 0.200000 0.000000
vt 0.000000 0.000000 0.000000
vt 0.346410 0.000000 0.000000
vt 0.000000 0.200000 0.000000
vt 0.346410 0.200000 0.000000
vt 0.000000 0.000000 0.000000
vt 0.346410 0.000000 0.000000
vt 0.000000 0.200000 0.000000
vt 0.346410 0.200000 0.000000
vt 0.000000 0.000000 0.000000
vt 0.346410 0.000000 0.000000
vt 0.000000 0.200000 0.000000
vt 0.346410 0.200000 0.000000
vt 0.049281 -0.008450 0.000000
vt 0.050000 0.000000 0.000000
vt -0.041425 -0.027999 0.000000
vt 0.049281 0.008450 0.000000
vt 0.047144 0.016657 0.000000
vt 0.043651 0.024385 0.000000
vt 0.038902 0.031411 0.000000
vt 0.033034 0.037534 0.000000
vt 0.026215 0.042576 0.000000
vt 0.018643 0.046394 0.000000
vt 0.010534 0.048878 0.000000
vt 0.002122 0.049955 0.000000
vt -0.006351 0.049595 0.000000
vt -0.014641 0.047808 0.000000
vt -0.022510 0.044646 0.000000
vt -0.029732 0.040200 0.000000
vt -0.036098 0.034597 0.000000
vt -0.041425 0.027999 0.000000
vt -0.045561 -0.020595 0.000000
vt -0.045561 0.020595 0.000000
vt -0.048387 -0.012599 0.000000
vt -0.048387 0.012599 0.000000
vt -0.049820 -0.004240 0.000000
vt -0.049820 0.004240 0.000000
vt -0.036098 -0.034597 0.000000
vt 0.038902 -0.031411 0.000000
vt 0.043651 -0.024385 0.000000
vt 0.047144 -0.016657 0.000000
vt 0.033034 -0.037534 0.000000
vt -0.029732 -0.040200 0.000000
vt 0.026215 -0.042576 0.000000
vt -0.022510 -0.044646 0.000000
vt 0.018643 -0.046394 0.000000
vt -0.014641 -0.047808 0.000000
vt 0.010534 -0.048878 0.000000
vt -0.006351 -0.049595 0.000000
vt 0.002122 -0.049955 0.000000
vt 0.000000 0.028798 0.000000
vt 0.047324 0.028798 0.000000
vt 0.000000 0.031416 0.000000
vt 0.000000 0.023562 0.000000
vt 0.047324 0.023562 0.000000
vt 0.000000 0.026180 0.000000
vt 0.000000 0.018326 0.000000
vt 0.047324 0.018326 0.000000
vt 0.000000 0.020944 0.000000
vt 0.000000 0.013090 0.000000
vt 0.047324 0.013090 0.000000
vt 0.000000 0.015708 0.000000
vt 0.000000 0.007854 0.000000
vt 0.047324 0.007854 0.000000
vt 0.000000 0.010472 0.000000
vt 0.000000 0.002618 0.000000
vt 0.047324 0.002618 0.000000
vt 0.000000 0.005236 0.000000
vt 0.000000 -0.002618 0.000000
vt 0.047324 -0.002618 0.000000
vt 0.000000 0.000000 0.000000
vt 0.000000 -0.007854 0.000000
vt 0.047324 -0.007854 0.000000
vt 0.000000 -0.005236 0.000000
vt 0.000000 -0.013090 0.000000
vt 0.047324 -0.013090 0.000000
vt 0.000000 -0.010472 0.000000
vt -0.000000 -0.018326 0.000000
vt 0.047324 -0.018326 0.000000
vt 0.000000 -0.015708 0.000000
vt 0.000000 -0.023562 0.000000
vt 0.047324 -0.023562 0.000000
vt -0.000000 -0.020944 0.000000
vt 0.000000 -0.028798 0.000000
vt 0.047324 -0.028798 0.000000
vt 0.000000 -0.026180 0.000000
vt 0.000000 -0.031416 0.000000
vt 0.047324 -0.031416 0.000000
vt 0.047324 -0.010472 0.000000
vt 0.047324 0.010472 0.000000
vt 0.047324 -0.026180 0.000000
vt 0.047324 -0.020944 0.000000
vt 0.047324 -0.015708 0.000000
vt 0.047324 -0.005236 0.000000
vt 0.047324 0.000000 0.000000
vt 0.047324 0.005236 0.000000
vt 0.047324 0.015708 0.000000
vt 0.047324 0.020944 0.000000
vt 0.047324 0.026180 0.000000
vt -0.187574 -0.271890 0.000000
vt -0.187574 -0.281600 0.000000
vt -0.000000 -0.281600 0.000000
vt -0.000000 0.281600 0.000000
vt -0.187574 0.281600 0.000000
vt -0.187574 0.271890 0.000000
vt -0.000000 0.266379 0.000000
vt -0.187574 0.262180 0.000000
vt -0.000000 0.251157 0.000000
vt -0.187574 0.252469 0.000000
vt -0.187574 0.242759 0.000000
vt -0.000000 0.235935 0.000000
vt -0.187574 0.233049 0.000000
vt -0.000000 0.220714 0.000000
vt -0.187574 0.223338 0.000000
vt -0.187574 0.213628 0.000000
vt -0.000000 0.205492 0.000000
vt -0.187574 0.203917 0.000000
vt -0.187574 0.194207 0.000000
vt -0.000000 0.190270 0.000000
vt -0.187574 0.184497 0.000000
vt -0.000000 0.175049 0.000000
vt -0.187574 0.174786 0.000000
vt -0.187574 0.165076 0.000000
vt -0.000000 0.159827 0.000000
vt -0.187574 0.155366 0.000000
vt 0.000000 0.144606 0.000000
vt -0.187574 0.145655 0.000000
vt -0.187574 0.135945 0.000000
vt -0.000000 0.129384 0.000000
vt -0.187574 0.126235 0.000000
vt -0.000000 0.114162 0.000000
vt -0.187574 0.116524 0.000000
vt -0.187574 0.106814 0.000000
vt -0.000000 0.098941 0.000000
vt -0.187574 0.097104 0.000000
vt -0.187574 0.087393 0.000000
vt -0.000000 0.083719 0.000000
vt -0.187574 0.077683 0.000000
vt -0.000000 0.068497 0.000000
vt -0.187574 0.067972 0.000000
vt -0.187574 0.058262 0.000000
vt -0.000000 0.053276 0.000000
vt -0.187574 0.048552 0.000000
vt -0.000000 0.038054 0.000000
vt -0.187574 0.038841 0.000000
vt -0.187574 0.029131 0.000000
vt -0.000000 0.022832 0.000000
vt -0.187574 0.019421 0.000000
vt -0.000000 0.007611 0.000000
vt -0.187574 0.009710 0.000000
vt -0.187574 0.000000 0.000000
vt -0.000000 -0.007611 0.000000
vt -0.187574 -0.009710 0.000000
vt -0.187574 -0.019421 0.000000
vt -0.000000 -0.022832 0.000000
vt -0.187574 -0.029131 0.000000
vt -0.000000 -0.038054 0.000000
vt -0.187574 -0.038841 0.000000
vt -0.187574 -0.048552 0.000000
vt -0.000000 -0.053276 0.000000
vt -0.187574 -0.058262 0.000000
vt -0.000000 -0.068497 0.000000
vt -0.187574 -0.067972 0.000000
vt -0.187574 -0.077683 0.000000
vt -0.000000 -0.083719 0.000000
vt -0.187574 -0.087393 0.000000
vt -0.000000 -0.098941 0.000000
vt -0.187574 -0.097104 0.000000
vt -0.187574 -0.106814 0.000000
vt -0.000000 -0.114162 0.000000
vt -0.187574 -0.116524 0.000000
vt -0.187574 -0.126235 0.000000
vt -0.000000 -0.129384 0.000000
vt -0.187574 -0.135945 0.000000
vt 0.000000 -0.144606 0.000000
vt -0.187574 -0.145655 0.000000
vt -0.187574 -0.155366 0.000000
vt -0.000000 -0.159827 0.000000
vt -0.187574 -0.165076 0.000000
vt -0.000000 -0.175049 0.000000
vt -0.187574 -0.174786 0.000000
vt -0.187574 -0.184497 0.000000
vt -0.000000 -0.190270 0.000000
vt -0.187574 -0.194207 0.000000
vt -0.000000 -0.205492 0.000000
vt -0.187574 -0.203917 0.000000
vt -0.187574 -0.213628 0.000000
vt -0.000000 -0.220714 0.000000
vt -0.187574 -0.223338 0.000000
vt -0.187574 -0.233049 0.000000
vt -0.000000 -0.235935 0.000000
vt -0.187574 -0.242759 0.000000
vt -0.000000 -0.251157 0.000000
vt -0.187574 -0.252469 0.000000
vt -0.187574 -0.262180 0.000000
vt -0.000000 -0.266379 0.000000
vt 0.019319 -0.005176 0.000000
vt 0.049281 -0.008450 0.000000
vt 0.020000 -0.000000 0.000000
vt 0.050000 -0.000000 0.000000
vt 0.049281 0.008450 0.000000
vt 0.047144 -0.016657 0.000000
vt 0.017321 -0.010000 0.000000
vt 0.043651 -0.024385 0.000000
vt 0.038902 -0.031411 0.000000
vt 0.014142 -0.014142 0.000000
vt 0.033034 -0.037534 0.000000
vt 0.010000 -0.017321 0.000000
vt 0.026215 -0.042576 0.000000
vt 0.018643 -0.046394 0.000000
vt 0.005176 -0.019319 0.000000
vt 0.010534 -0.048878 0.000000
vt -0.000000 -0.020000 0.000000
vt 0.002122 -0.049955 0.000000
vt -0.006351 -0.049595 0.000000
vt -0.005176 -0.019319 0.000000
vt -0.014641 -0.047808 0.000000
vt -0.022510 -0.044646 0.000000
vt -0.010000 -0.017321 0.000000
vt -0.029732 -0.040200 0.000000
vt -0.014142 -0.014142 0.000000
vt -0.036098 -0.034597 0.000000
vt -0.041425 -0.027999 0.000000
vt -0.017321 -0.010000 0.000000
vt -0.045561 -0.020595 0.000000
vt -0.019319 -0.005176 0.000000
vt -0.048387 -0.012599 0.000000
vt -0.049820 -0.004240 0.000000
vt -0.020000 0.000000 0.000000
vt -0.049820 0.004240 0.000000
vt -0.019319 0.005176 0.000000
vt -0.048387 0.012599 0.000000
vt -0.045561 0.020595 0.000000
vt -0.017321 0.010000 0.000000
vt -0.041425 0.027999 0.000000
vt -0.014142 0.014142 0.000000
vt -0.036098 0.034597 0.000000
vt -0.029732 0.040200 0.000000
vt -0.010000 0.017321 0.000000
vt -0.022510 0.044646 0.000000
vt -0.005176 0.019319 0.000000
vt -0.014641 0.047808 0.000000
vt -0.006351 0.049595 0.000000
vt -0.000000 0.020000 0.000000
vt 0.002122 0.049955 0.000000
vt 0.010534 0.048878 0.000000
vt 0.005176 0.019319 0.000000
vt 0.018643 0.046394 0.000000
vt 0.010000 0.017321 0.000000
vt 0.026215 0.042576 0.000000
vt 0.033034 0.037534 0.000000
vt 0.014142 0.014142 0.000000
vt 0.038902 0.031411 0.000000
vt 0.017321 0.010000 0.000000
vt 0.043651 0.024385 0.000000
vt 0.047144 0.016657 0.000000
vt 0.019319 0.005176 0.000000
vn 0.086061 -0.001980 -0.050888
vn 0.083729 -0.001926 -0.054642
vn 0.086061 -0.001980 -0.050888
vn 0.083729 -0.001926 -0.054642
vn 0.075681 -0.001741 -0.065341
vn 0.075681 -0.001741 -0.065341
vn 0.067174 -0.001545 -0.074062
vn 0.067174 -0.001545 -0.074062
vn 0.064164 -0.001476 -0.076687
vn 0.064164 -0.001476 -0.076687
vn 0.053891 -0.001240 -0.084227
vn 0.049685 -0.001143 -0.086776
vn 0.053891 -0.001240 -0.084227
vn 0.049685 -0.001143 -0.086776
vn 0.036164 -0.000832 -0.093228
vn 0.036164 -0.000832 -0.093228
vn 0.023042 -0.000530 -0.097308
vn 0.023042 -0.000530 -0.097308
vn 0.018655 -0.000429 -0.098244
vn 0.018655 -0.000429 -0.098244
vn 0.011240 -0.000259 -0.099366
vn 0.009796 -0.000225 -0.099519
vn 0.011240 -0.000259 -0.099366
vn 0.009796 -0.000225 -0.099519
vn 0.005542 -0.000128 -0.099846
vn 0.005542 -0.000128 -0.099846
vn 0.001942 -0.000045 -0.099981
vn 0.001942 -0.000045 -0.099981
vn 0.000743 -0.000017 -0.099997
vn 0.000743 -0.000017 -0.099997
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn -0.099974 0.002300 -0.000000
vn -0.099974 0.002300 -0.000000
vn -0.099974 0.002300 -0.000000
vn -0.099974 0.002300 -0.000000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000466 -0.000011 0.099999
vn 0.001046 -0.000024 0.099995
vn 0.000466 -0.000011 0.099999
vn 0.001046 -0.000024 0.099995
vn 0.002786 -0.000064 0.099961
vn 0.002786 -0.000064 0.099961
vn 0.004763 -0.000110 0.099886
vn 0.004763 -0.000110 0.099886
vn 0.005429 -0.000125 0.099852
vn 0.005429 -0.000125 0.099852
vn 0.009292 -0.000214 0.099567
vn 0.012107 -0.000279 0.099264
vn 0.009292 -0.000214 0.099567
vn 0.012107 -0.000279 0.099264
vn 0.020556 -0.000473 0.097863
vn 0.020556 -0.000473 0.097863
vn 0.029728 -0.000684 0.095476
vn 0.029728 -0.000684 0.095476
vn 0.032728 -0.000753 0.094490
vn 0.032728 -0.000753 0.094490
vn 0.041872 -0.000963 0.090806
vn 0.046881 -0.001079 0.088323
vn 0.041872 -0.000963 0.090806
vn 0.046881 -0.001079 0.088323
vn 0.061464 -0.001414 0.078868
vn 0.061464 -0.001414 0.078868
vn 0.075900 -0.001746 0.065086
vn 0.075900 -0.001746 0.065086
vn 0.079979 -0.001840 0.060000
vn 0.079979 -0.001840 0.060000
vn 0.090669 -0.002086 0.042128
vn 0.092694 -0.002133 0.037461
vn 0.090669 -0.002086 0.042128
vn 0.092694 -0.002133 0.037461
vn 0.097366 -0.002240 0.022692
vn 0.097366 -0.002240 0.022692
vn 0.099584 -0.002291 0.008814
vn 0.099584 -0.002291 0.008814
vn 0.099884 -0.002298 0.004241
vn 0.099884 -0.002298 0.004241
vn 0.099953 -0.002300 -0.002042
vn 0.099807 -0.002296 -0.005778
vn 0.099953 -0.002300 -0.002042
vn 0.099807 -0.002296 -0.005778
vn 0.098500 -0.002266 -0.017104
vn 0.098500 -0.002266 -0.017104
vn 0.095225 -0.002191 -0.030455
vn 0.095225 -0.002191 -0.030455
vn 0.093711 -0.002156 -0.034838
vn 0.093711 -0.002156 -0.034838
vn -0.047162 0.001085 0.088174
vn -0.050864 0.001170 0.086090
vn -0.047162 0.001085 0.088174
vn -0.050864 0.001170 0.086090
vn -0.061592 0.001417 0.078768
vn -0.061592 0.001417 0.078768
vn -0.072233 0.001662 0.069135
vn -0.072233 0.001662 0.069135
vn -0.075421 0.001735 0.065640
vn -0.075421 0.001735 0.065640
vn -0.086698 0.001995 0.049794
vn -0.089635 0.002062 0.044287
vn -0.086698 0.001995 0.049794
vn -0.089635 0.002062 0.044287
vn -0.096421 0.002218 0.026422
vn -0.096421 0.002218 0.026422
vn -0.099488 0.002289 0.009841
vn -0.099488 0.002289 0.009841
vn -0.099876 0.002298 0.004416
vn -0.099876 0.002298 0.004416
vn -0.099896 0.002298 -0.003929
vn -0.099593 0.002291 -0.008713
vn -0.099896 0.002298 -0.003929
vn -0.099593 0.002291 -0.008713
vn -0.097230 0.002237 -0.023268
vn -0.097230 0.002237 -0.023268
vn -0.092010 0.002117 -0.039112
vn -0.092010 0.002117 -0.039112
vn -0.089726 0.002064 -0.044102
vn -0.089726 0.002064 -0.044102
vn -0.081389 0.001872 -0.058072
vn -0.078698 0.001811 -0.061671
vn -0.081389 0.001872 -0.058072
vn -0.078698 0.001811 -0.061671
vn -0.069513 0.001599 -0.071871
vn -0.069513 0.001599 -0.071871
vn -0.059264 0.001363 -0.080535
vn -0.059264 0.001363 -0.080535
vn -0.055671 0.001281 -0.083061
vn -0.055671 0.001281 -0.083061
vn -0.047526 0.001093 -0.087977
vn -0.044336 0.001020 -0.089629
vn -0.047526 0.001093 -0.087977
vn -0.044336 0.001020 -0.089629
vn -0.034310 0.000789 -0.093927
vn -0.034310 0.000789 -0.093927
vn -0.023835 0.000548 -0.097116
vn -0.023835 0.000548 -0.097116
vn -0.020317 0.000467 -0.097913
vn -0.020317 0.000467 -0.097913
vn -0.012483 0.000287 -0.099217
vn -0.010931 0.000251 -0.099401
vn -0.012483 0.000287 -0.099217
vn -0.010931 0.000251 -0.099401
vn -0.006322 0.000145 -0.099800
vn -0.006322 0.000145 -0.099800
vn -0.002316 0.000053 -0.099973
vn -0.002316 0.000053 -0.099973
vn -0.000982 0.000023 -0.099995
vn -0.000982 0.000023 -0.099995
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.099974 -0.002300 0.000000
vn 0.099974 -0.002300 0.000000
vn 0.099974 -0.002300 0.000000
vn 0.099974 -0.002300 0.000000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn -0.099974 0.002300 -0.000000
vn -0.099974 0.002300 -0.000000
vn -0.099974 0.002300 -0.000000
vn -0.099974 0.002300 -0.000000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.080290 -0.001847 0.059583
vn 0.080290 -0.001847 0.059583
vn 0.080290 -0.001847 0.059583
vn 0.080290 -0.001847 0.059583
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn -0.078868 0.001814 -0.061454
vn -0.078868 0.001814 -0.061454
vn -0.078868 0.001814 -0.061454
vn -0.078868 0.001814 -0.061454
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.099974 -0.002300 0.000000
vn 0.099974 -0.002300 0.000000
vn 0.099974 -0.002300 0.000000
vn 0.099974 -0.002300 0.000000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.099974 -0.002300 0.000000
vn 0.099974 -0.002300 0.000000
vn 0.099974 -0.002300 0.000000
vn 0.099974 -0.002300 0.000000
vn 0.099973 -0.002300 -0.000220
vn 0.099972 -0.002300 -0.000638
vn 0.099973 -0.002300 -0.000220
vn 0.099972 -0.002300 -0.000638
vn 0.099956 -0.002300 -0.001890
vn 0.099956 -0.002300 -0.001890
vn 0.099916 -0.002299 -0.003403
vn 0.099916 -0.002299 -0.003403
vn 0.099897 -0.002298 -0.003921
vn 0.099897 -0.002298 -0.003921
vn 0.099549 -0.002290 -0.009210
vn 0.099161 -0.002281 -0.012727
vn 0.099549 -0.002290 -0.009210
vn 0.099161 -0.002281 -0.012727
vn 0.097223 -0.002237 -0.023298
vn 0.097223 -0.002237 -0.023298
vn 0.094013 -0.002163 -0.034014
vn 0.094013 -0.002163 -0.034014
vn 0.092695 -0.002133 -0.037459
vn 0.092695 -0.002133 -0.037459
vn 0.085457 -0.001966 -0.051897
vn 0.081991 -0.001886 -0.057218
vn 0.085457 -0.001966 -0.051897
vn 0.081991 -0.001886 -0.057218
vn 0.069198 -0.001592 -0.072174
vn 0.069198 -0.001592 -0.072174
vn 0.054828 -0.001261 -0.083620
vn 0.054828 -0.001261 -0.083620
vn 0.049798 -0.001146 -0.086711
vn 0.049798 -0.001146 -0.086711
vn 0.033800 -0.000778 -0.094111
vn 0.029330 -0.000675 -0.095600
vn 0.033800 -0.000778 -0.094111
vn 0.029330 -0.000675 -0.095600
vn 0.015918 -0.000366 -0.098724
vn 0.015918 -0.000366 -0.098724
vn 0.004973 -0.000114 -0.099876
vn 0.004973 -0.000114 -0.099876
vn 0.001365 -0.000031 -0.099991
vn 0.001365 -0.000031 -0.099991
vn -0.001389 0.000032 -0.099990
vn -0.003775 0.000087 -0.099929
vn -0.001389 0.000032 -0.099990
vn -0.003775 0.000087 -0.099929
vn -0.010964 0.000252 -0.099397
vn -0.010964 0.000252 -0.099397
vn -0.019476 0.000448 -0.098084
vn -0.019476 0.000448 -0.098084
vn -0.022336 0.000514 -0.097472
vn -0.022336 0.000514 -0.097472
vn -0.029303 0.000674 -0.095608
vn -0.029913 0.000688 -0.095419
vn -0.029303 0.000674 -0.095608
vn -0.029913 0.000688 -0.095419
vn -0.031734 0.000730 -0.094828
vn -0.031734 0.000730 -0.094828
vn -0.033594 0.000773 -0.094185
vn -0.033594 0.000773 -0.094185
vn -0.034212 0.000787 -0.093962
vn -0.034212 0.000787 -0.093962
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.099974 -0.002300 0.000000
vn 0.099974 -0.002300 0.000000
vn 0.099974 -0.002300 0.000000
vn 0.099974 -0.002300 0.000000
vn 0.017666 -0.000406 0.098426
vn 0.016520 -0.000380 0.098625
vn 0.017666 -0.000406 0.098426
vn 0.016520 -0.000380 0.098625
vn 0.013102 -0.000301 0.099138
vn 0.013102 -0.000301 0.099138
vn 0.010056 -0.000231 0.099493
vn 0.010056 -0.000231 0.099493
vn 0.009039 -0.000208 0.099590
vn 0.009039 -0.000208 0.099590
vn 0.006942 -0.000160 0.099759
vn 0.006154 -0.000142 0.099810
vn 0.006942 -0.000160 0.099759
vn 0.006154 -0.000142 0.099810
vn 0.003791 -0.000087 0.099928
vn 0.003791 -0.000087 0.099928
vn 0.001560 -0.000036 0.099988
vn 0.001560 -0.000036 0.099988
vn 0.000816 -0.000019 0.099997
vn 0.000816 -0.000019 0.099997
vn -0.001881 0.000043 0.099982
vn -0.004603 0.000106 0.099894
vn -0.001881 0.000043 0.099982
vn -0.004603 0.000106 0.099894
vn -0.012812 0.000295 0.099175
vn -0.012812 0.000295 0.099175
vn -0.022270 0.000512 0.097487
vn -0.022270 0.000512 0.097487
vn -0.025412 0.000585 0.096716
vn -0.025412 0.000585 0.096716
vn -0.035332 0.000813 0.093547
vn -0.038594 0.000888 0.092248
vn -0.035332 0.000813 0.093547
vn -0.038594 0.000888 0.092248
vn -0.048195 0.001109 0.087613
vn -0.048195 0.001109 0.087613
vn -0.057783 0.001329 0.081605
vn -0.057783 0.001329 0.081605
vn -0.060791 0.001399 0.079388
vn -0.060791 0.001399 0.079388
vn -0.069391 0.001596 0.071989
vn -0.072520 0.001668 0.068833
vn -0.069391 0.001596 0.071989
vn -0.072520 0.001668 0.068833
vn -0.081175 0.001868 0.058371
vn -0.081175 0.001868 0.058371
vn -0.088273 0.002031 0.046943
vn -0.088273 0.002031 0.046943
vn -0.090254 0.002076 0.043010
vn -0.090254 0.002076 0.043010
vn -0.094395 0.002172 0.032938
vn -0.095543 0.002198 0.029439
vn -0.094395 0.002172 0.032938
vn -0.095543 0.002198 0.029439
vn -0.098230 0.002260 0.018593
vn -0.098230 0.002260 0.018593
vn -0.099665 0.002293 0.007845
vn -0.099665 0.002293 0.007845
vn -0.099882 0.002298 0.004281
vn -0.099882 0.002298 0.004281
vn -0.099974 0.002300 -0.000000
vn -0.099974 0.002300 -0.000000
vn -0.099974 0.002300 -0.000000
vn -0.099974 0.002300 -0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.098562 0.016900 0.000000
vn -0.100000 0.000000 0.000000
vn -0.100000 0.000000 0.000000
vn -0.098562 -0.016900 0.000000
vn -0.098481 -0.017365 0.000000
vn -0.094288 -0.033314 0.000000
vn -0.093969 -0.034202 0.000000
vn -0.087301 -0.048769 0.000000
vn -0.086603 -0.050000 0.000000
vn -0.077804 -0.062822 0.000000
vn -0.076604 -0.064279 0.000000
vn -0.066067 -0.075067 0.000000
vn -0.064279 -0.076604 0.000000
vn -0.052431 -0.085153 0.000000
vn -0.050000 -0.086603 0.000000
vn -0.037286 -0.092789 0.000000
vn -0.034202 -0.093969 0.000000
vn -0.021068 -0.097756 0.000000
vn -0.017365 -0.098481 0.000000
vn -0.004244 -0.099910 0.000000
vn 0.000000 -0.100000 0.000000
vn 0.012702 -0.099190 0.000000
vn 0.017365 -0.098481 0.000000
vn 0.029282 -0.095617 0.000000
vn 0.034202 -0.093969 0.000000
vn 0.045020 -0.089293 0.000000
vn 0.050000 -0.086603 0.000000
vn 0.059463 -0.080400 0.000000
vn 0.064279 -0.076604 0.000000
vn 0.072196 -0.069194 0.000000
vn 0.076604 -0.064279 0.000000
vn 0.082851 -0.055997 0.000000
vn 0.086603 -0.050000 0.000000
vn 0.091123 -0.041190 0.000000
vn 0.093969 -0.034202 0.000000
vn 0.096773 -0.025198 0.000000
vn 0.098481 -0.017365 0.000000
vn 0.099640 -0.008481 0.000000
vn 0.100000 0.000000 0.000000
vn 0.099640 0.008481 0.000000
vn 0.098481 0.017365 0.000000
vn 0.096773 0.025198 0.000000
vn 0.093969 0.034202 0.000000
vn 0.091123 0.041190 0.000000
vn 0.086603 0.050000 0.000000
vn 0.082851 0.055997 0.000000
vn 0.076604 0.064279 0.000000
vn 0.072196 0.069194 0.000000
vn 0.064279 0.076604 0.000000
vn 0.059463 0.080400 0.000000
vn 0.050000 0.086603 0.000000
vn 0.045020 0.089293 0.000000
vn 0.034202 0.093969 0.000000
vn 0.029282 0.095617 0.000000
vn 0.017365 0.098481 0.000000
vn 0.012702 0.099190 0.000000
vn 0.000000 0.100000 0.000000
vn -0.004244 0.099910 0.000000
vn -0.017365 0.098481 0.000000
vn -0.021068 0.097756 0.000000
vn -0.034202 0.093969 0.000000
vn -0.037286 0.092789 0.000000
vn -0.050000 0.086603 0.000000
vn -0.052431 0.085153 0.000000
vn -0.064279 0.076604 0.000000
vn -0.066067 0.075067 0.000000
vn -0.076604 0.064279 0.000000
vn -0.077804 0.062822 0.000000
vn -0.086603 0.050000 0.000000
vn -0.087301 0.048769 0.000000
vn -0.093969 0.034202 0.000000
vn -0.094288 0.033314 0.000000
vn -0.098481 0.017365 0.000000
vn -0.098562 -0.016900 0.000000
vn -0.100000 -0.000000 0.000000
vn -0.100000 -0.000000 0.000000
vn -0.098562 0.016900 0.000000
vn -0.098481 0.017365 0.000000
vn -0.094288 0.033314 0.000000
vn -0.093969 0.034202 0.000000
vn -0.087301 0.048769 0.000000
vn -0.086603 0.050000 0.000000
vn -0.077804 0.062822 0.000000
vn -0.076604 0.064279 0.000000
vn -0.066067 0.075067 0.000000
vn -0.064279 0.076604 0.000000
vn -0.052431 0.085153 0.000000
vn -0.050000 0.086603 0.000000
vn -0.037286 0.092789 0.000000
vn -0.034202 0.093969 0.000000
vn -0.021068 0.097756 0.000000
vn -0.017365 0.098481 0.000000
vn -0.004244 0.099910 0.000000
vn 0.000000 0.100000 0.000000
vn 0.012702 0.099190 0.000000
vn 0.017365 0.098481 0.000000
vn 0.029282 0.095617 0.000000
vn 0.034202 0.093969 0.000000
vn 0.045020 0.089293 0.000000
vn 0.050000 0.086603 0.000000
vn 0.059463 0.080400 0.000000
vn 0.064279 0.076604 0.000000
vn 0.072196 0.069194 0.000000
vn 0.076604 0.064279 0.000000
vn 0.082851 0.055997 0.000000
vn 0.086603 0.050000 0.000000
vn 0.091123 0.041190 0.000000
vn 0.093969 0.034202 0.000000
vn 0.096773 0.025198 0.000000
vn 0.098481 0.017365 0.000000
vn 0.099640 0.008481 0.000000
vn 0.100000 0.000000 0.000000
vn 0.099640 -0.008481 0.000000
vn 0.098481 -0.017365 0.000000
vn 0.096773 -0.025198 0.000000
vn 0.093969 -0.034202 0.000000
vn 0.091123 -0.041190 0.000000
vn 0.086603 -0.050000 0.000000
vn 0.082851 -0.055997 0.000000
vn 0.076604 -0.064279 0.000000
vn 0.072196 -0.069194 0.000000
vn 0.064279 -0.076604 0.000000
vn 0.059463 -0.080400 0.000000
vn 0.050000 -0.086603 0.000000
vn 0.045020 -0.089293 0.000000
vn 0.034202 -0.093969 0.000000
vn 0.029282 -0.095617 0.000000
vn 0.017365 -0.098481 0.000000
vn 0.012702 -0.099190 0.000000
vn 0.000000 -0.100000 0.000000
vn -0.004244 -0.099910 0.000000
vn -0.017365 -0.098481 0.000000
vn -0.021068 -0.097756 0.000000
vn -0.034202 -0.093969 0.000000
vn -0.037286 -0.092789 0.000000
vn -0.050000 -0.086603 0.000000
vn -0.052431 -0.085153 0.000000
vn -0.064279 -0.076604 0.000000
vn -0.066067 -0.075067 0.000000
vn -0.076604 -0.064279 0.000000
vn -0.077804 -0.062822 0.000000
vn -0.086603 -0.050000 0.000000
vn -0.087301 -0.048769 0.000000
vn -0.093969 -0.034202 0.000000
vn -0.094288 -0.033314 0.000000
vn -0.098481 -0.017365 0.000000
vn 0.099414 -0.010812 0.000000
vn 0.099414 -0.010812 0.000000
vn 0.100000 -0.000000 0.000000
vn 0.100000 -0.000000 0.000000
vn 0.099414 0.010812 0.000000
vn 0.099414 0.010812 0.000000
vn 0.097662 0.021497 0.000000
vn 0.097662 0.021497 0.000000
vn 0.094765 0.031930 0.000000
vn 0.094765 0.031930 0.000000
vn 0.090758 0.041989 0.000000
vn 0.090758 0.041989 0.000000
vn 0.085686 0.051555 0.000000
vn 0.085686 0.051555 0.000000
vn 0.079609 0.060517 0.000000
vn 0.079609 0.060517 0.000000
vn 0.072600 0.068770 0.000000
vn 0.072600 0.068770 0.000000
vn 0.064739 0.076216 0.000000
vn 0.064739 0.076216 0.000000
vn 0.056119 0.082769 0.000000
vn 0.056119 0.082769 0.000000
vn 0.046841 0.088351 0.000000
vn 0.046841 0.088351 0.000000
vn 0.037014 0.092898 0.000000
vn 0.037014 0.092898 0.000000
vn 0.026753 0.096355 0.000000
vn 0.026753 0.096355 0.000000
vn 0.016178 0.098683 0.000000
vn 0.016178 0.098683 0.000000
vn 0.005414 0.099853 0.000000
vn 0.005414 0.099853 0.000000
vn -0.005414 0.099853 -0.000000
vn -0.005414 0.099853 -0.000000
vn -0.016178 0.098683 -0.000000
vn -0.016178 0.098683 -0.000000
vn -0.026753 0.096355 -0.000000
vn -0.026753 0.096355 -0.000000
vn -0.037014 0.092898 -0.000000
vn -0.037014 0.092898 -0.000000
vn -0.046841 0.088351 -0.000000
vn -0.046841 0.088351 -0.000000
vn -0.056119 0.082769 -0.000000
vn -0.056119 0.082769 -0.000000
vn -0.064739 0.076216 -0.000000
vn -0.064739 0.076216 -0.000000
vn -0.072600 0.068770 -0.000000
vn -0.072600 0.068770 -0.000000
vn -0.079609 0.060517 -0.000000
vn -0.079609 0.060517 -0.000000
vn -0.085686 0.051555 -0.000000
vn -0.085686 0.051555 -0.000000
vn -0.090758 0.041989 -0.000000
vn -0.090758 0.041989 -0.000000
vn -0.094765 0.031930 -0.000000
vn -0.094765 0.031930 -0.000000
vn -0.097662 0.021497 -0.000000
vn -0.097662 0.021497 -0.000000
vn -0.099414 0.010812 -0.000000
vn -0.099414 0.010812 -0.000000
vn -0.100000 0.000000 0.000000
vn -0.100000 0.000000 0.000000
vn -0.099414 -0.010812 0.000000
vn -0.099414 -0.010812 0.000000
vn -0.097662 -0.021497 0.000000
vn -0.097662 -0.021497 0.000000
vn -0.094765 -0.031930 0.000000
vn -0.094765 -0.031930 0.000000
vn -0.090758 -0.041989 0.000000
vn -0.090758 -0.041989 0.000000
vn -0.085686 -0.051555 0.000000
vn -0.085686 -0.051555 0.000000
vn -0.079609 -0.060517 0.000000
vn -0.079609 -0.060517 0.000000
vn -0.072600 -0.068770 0.000000
vn -0.072600 -0.068770 0.000000
vn -0.064739 -0.076216 0.000000
vn -0.064739 -0.076216 0.000000
vn -0.056119 -0.082769 0.000000
vn -0.056119 -0.082769 0.000000
vn -0.046841 -0.088351 0.000000
vn -0.046841 -0.088351 0.000000
vn -0.037014 -0.092898 0.000000
vn -0.037014 -0.092898 0.000000
vn -0.026753 -0.096355 0.000000
vn -0.026753 -0.096355 0.000000
vn -0.016178 -0.098683 0.000000
vn -0.016178 -0.098683 0.000000
vn -0.005414 -0.099853 0.000000
vn -0.005414 -0.099853 0.000000
vn 0.005414 -0.099853 0.000000
vn 0.005414 -0.099853 0.000000
vn 0.016178 -0.098683 0.000000
vn 0.016178 -0.098683 0.000000
vn 0.026753 -0.096355 0.000000
vn 0.026753 -0.096355 0.000000
vn 0.037014 -0.092898 0.000000
vn 0.037014 -0.092898 0.000000
vn 0.046841 -0.088351 0.000000
vn 0.046841 -0.088351 0.000000
vn 0.056119 -0.082769 0.000000
vn 0.056119 -0.082769 0.000000
vn 0.064739 -0.076216 0.000000
vn 0.064739 -0.076216 0.000000
vn 0.072600 -0.068770 0.000000
vn 0.072600 -0.068770 0.000000
vn 0.079609 -0.060517 0.000000
vn 0.079609 -0.060517 0.000000
vn 0.085686 -0.051555 0.000000
vn 0.085686 -0.051555 0.000000
vn 0.090758 -0.041989 0.000000
vn 0.090758 -0.041989 0.000000
vn 0.094765 -0.031930 0.000000
vn 0.094765 -0.031930 0.000000
vn 0.097662 -0.021497 0.000000
vn 0.097662 -0.021497 0.000000
vn 0.099414 0.010812 0.000000
vn 0.100000 0.000000 0.000000
vn 0.099414 -0.010812 0.000000
vn 0.097662 -0.021497 0.000000
vn 0.094765 -0.031930 0.000000
vn 0.090758 -0.041989 0.000000
vn 0.085686 -0.051555 0.000000
vn 0.079609 -0.060517 0.000000
vn 0.072600 -0.068770 0.000000
vn 0.064739 -0.076216 0.000000
vn 0.056119 -0.082769 0.000000
vn 0.046841 -0.088351 0.000000
vn 0.037014 -0.092898 0.000000
vn 0.026753 -0.096355 0.000000
vn 0.016178 -0.098683 0.000000
vn 0.005414 -0.099853 0.000000
vn -0.005414 -0.099853 0.000000
vn -0.016178 -0.098683 0.000000
vn -0.026753 -0.096355 0.000000
vn -0.037014 -0.092898 0.000000
vn -0.046841 -0.088351 0.000000
vn -0.056119 -0.082769 0.000000
vn -0.064739 -0.076216 0.000000
vn -0.072600 -0.068770 0.000000
vn -0.079609 -0.060517 0.000000
vn -0.085686 -0.051555 0.000000
vn -0.090758 -0.041989 0.000000
vn -0.094765 -0.031930 0.000000
vn -0.097662 -0.021497 0.000000
vn -0.099414 -0.010812 0.000000
vn -0.100000 0.000000 0.000000
vn -0.099414 0.010812 -0.000000
vn -0.097662 0.021497 -0.000000
vn -0.094765 0.031930 -0.000000
vn -0.090758 0.041989 -0.000000
vn -0.085686 0.051555 -0.000000
vn -0.079609 0.060517 -0.000000
vn -0.072600 0.068770 -0.000000
vn -0.064739 0.076216 -0.000000
vn -0.056119 0.082769 -0.000000
vn -0.046841 0.088351 -0.000000
vn -0.037014 0.092898 -0.000000
vn -0.026753 0.096355 -0.000000
vn -0.016178 0.098683 -0.000000
vn -0.005414 0.099853 -0.000000
vn 0.005414 0.099853 0.000000
vn 0.016178 0.098683 0.000000
vn 0.026753 0.096355 0.000000
vn 0.037014 0.092898 0.000000
vn 0.046841 0.088351 0.000000
vn 0.056119 0.082769 0.000000
vn 0.064739 0.076216 0.000000
vn 0.072600 0.068770 0.000000
vn 0.079609 0.060517 0.000000
vn 0.085686 0.051555 0.000000
vn 0.090758 0.041989 0.000000
vn 0.094765 0.031930 0.000000
vn 0.097662 0.021497 0.000000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.085430 -0.051979 0.000000
vn 0.085430 -0.051979 0.000000
vn 0.085430 -0.051979 0.000000
vn 0.085430 -0.051979 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.002300 -0.099974 0.000000
vn -0.087730 -0.047995 0.000000
vn -0.087730 -0.047995 0.000000
vn -0.087730 -0.047995 0.000000
vn -0.087730 -0.047995 0.000000
vn -0.085430 0.051979 0.000000
vn -0.085430 0.051979 0.000000
vn -0.085430 0.051979 0.000000
vn -0.085430 0.051979 0.000000
vn 0.002300 0.099974 0.000000
vn 0.002300 0.099974 0.000000
vn 0.002300 0.099974 0.000000
vn 0.002300 0.099974 0.000000
vn 0.087730 0.047995 0.000000
vn 0.087730 0.047995 0.000000
vn 0.087730 0.047995 0.000000
vn 0.087730 0.047995 0.000000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.000000 0.000000 0.100000
vn 0.087543 -0.023457 -0.042262
vn 0.087543 -0.023457 -0.042262
vn 0.090631 -0.000000 -0.042262
vn 0.064086 -0.064086 -0.042262
vn 0.064086 -0.064086 -0.042262
vn 0.078489 -0.045315 -0.042262
vn 0.023457 -0.087543 -0.042262
vn 0.023457 -0.087543 -0.042262
vn 0.045315 -0.078489 -0.042262
vn -0.023457 -0.087543 -0.042262
vn -0.023457 -0.087543 -0.042262
vn -0.000000 -0.090631 -0.042262
vn -0.064086 -0.064086 -0.042262
vn -0.064086 -0.064086 -0.042262
vn -0.045315 -0.078489 -0.042262
vn -0.087543 -0.023457 -0.042262
vn -0.087543 -0.023457 -0.042262
vn -0.078489 -0.045315 -0.042262
vn -0.087543 0.023457 -0.042262
vn -0.087543 0.023457 -0.042262
vn -0.090631 0.000000 -0.042262
vn -0.064086 0.064086 -0.042262
vn -0.064086 0.064086 -0.042262
vn -0.078489 0.045315 -0.042262
vn -0.023457 0.087543 -0.042262
vn -0.023457 0.087543 -0.042262
vn -0.045315 0.078489 -0.042262
vn 0.023457 0.087543 -0.042262
vn 0.023457 0.087543 -0.042262
vn -0.000000 0.090631 -0.042262
vn 0.064086 0.064086 -0.042262
vn 0.064086 0.064086 -0.042262
vn 0.045315 0.078489 -0.042262
vn 0.087543 0.023457 -0.042262
vn 0.087543 0.023457 -0.042262
vn 0.078489 0.045315 -0.042262
vn 0.090631 0.000000 -0.042262
vn -0.045315 0.078489 -0.042262
vn -0.045315 -0.078489 -0.042262
vn 0.078489 0.045315 -0.042262
vn 0.045315 0.078489 -0.042262
vn -0.000000 0.090631 -0.042262
vn -0.078489 0.045315 -0.042262
vn -0.090631 0.000000 -0.042262
vn -0.078489 -0.045315 -0.042262
vn -0.000000 -0.090631 -0.042262
vn 0.045315 -0.078489 -0.042262
vn 0.078489 -0.045315 -0.042262
vn -0.090099 -0.009799 -0.042262
vn -0.090631 -0.000000 -0.042262
vn -0.090631 -0.000000 -0.042262
vn -0.090099 0.009799 -0.042262
vn -0.089327 0.015317 -0.042262
vn -0.088512 0.019483 -0.042262
vn -0.085454 0.030193 -0.042262
vn -0.085887 0.028939 -0.042262
vn -0.082254 0.038055 -0.042262
vn -0.079122 0.044200 -0.042262
vn -0.077658 0.046725 -0.042262
vn -0.070514 0.056936 -0.042262
vn -0.072151 0.054847 -0.042262
vn -0.065798 0.062327 -0.042262
vn -0.059877 0.068034 -0.042262
vn -0.058673 0.069075 -0.042262
vn -0.050861 0.075014 -0.042262
vn -0.047518 0.077175 -0.042262
vn -0.042452 0.080073 -0.042262
vn -0.033792 0.084095 -0.042262
vn -0.033546 0.084194 -0.042262
vn -0.024246 0.087327 -0.042262
vn -0.019094 0.088597 -0.042262
vn -0.014662 0.089437 -0.042262
vn -0.003846 0.090549 -0.042262
vn -0.004907 0.090498 -0.042262
vn 0.004907 0.090498 -0.042262
vn 0.011512 0.089897 -0.042262
vn 0.014662 0.089437 -0.042262
vn 0.026539 0.086658 -0.042262
vn 0.024246 0.087327 -0.042262
vn 0.033546 0.084194 -0.042262
vn 0.040802 0.080927 -0.042262
vn 0.042452 0.080073 -0.042262
vn 0.050861 0.075014 -0.042262
vn 0.053892 0.072867 -0.042262
vn 0.058673 0.069075 -0.042262
vn 0.065431 0.062711 -0.042262
vn 0.065798 0.062327 -0.042262
vn 0.072151 0.054847 -0.042262
vn 0.075088 0.050751 -0.042262
vn 0.077658 0.046725 -0.042262
vn 0.082585 0.037331 -0.042262
vn 0.082254 0.038055 -0.042262
vn 0.085887 0.028939 -0.042262
vn 0.087706 0.022837 -0.042262
vn 0.088512 0.019483 -0.042262
vn 0.090304 0.007686 -0.042262
vn 0.090099 0.009799 -0.042262
vn 0.090631 0.000000 -0.042262
vn 0.090304 -0.007686 -0.042262
vn 0.090099 -0.009799 -0.042262
vn 0.088512 -0.019483 -0.042262
vn 0.087706 -0.022837 -0.042262
vn 0.085887 -0.028939 -0.042262
vn 0.082585 -0.037331 -0.042262
vn 0.082254 -0.038055 -0.042262
vn 0.077658 -0.046725 -0.042262
vn 0.075088 -0.050751 -0.042262
vn 0.072151 -0.054847 -0.042262
vn 0.065431 -0.062711 -0.042262
vn 0.065798 -0.062327 -0.042262
vn 0.058673 -0.069075 -0.042262
vn 0.053892 -0.072867 -0.042262
vn 0.050861 -0.075014 -0.042262
vn 0.040802 -0.080927 -0.042262
vn 0.042452 -0.080073 -0.042262
vn 0.033546 -0.084194 -0.042262
vn 0.026539 -0.086658 -0.042262
vn 0.024246 -0.087327 -0.042262
vn 0.014662 -0.089437 -0.042262
vn 0.011512 -0.089897 -0.042262
vn 0.004907 -0.090498 -0.042262
vn -0.003846 -0.090549 -0.042262
vn -0.004907 -0.090498 -0.042262
vn -0.014662 -0.089437 -0.042262
vn -0.019094 -0.088597 -0.042262
vn -0.024246 -0.087327 -0.042262
vn -0.033792 -0.084095 -0.042262
vn -0.033546 -0.084194 -0.042262
vn -0.042452 -0.080073 -0.042262
vn -0.047518 -0.077175 -0.042262
vn -0.050861 -0.075014 -0.042262
vn -0.059877 -0.068034 -0.042262
vn -0.058673 -0.069075 -0.042262
vn -0.065798 -0.062327 -0.042262
vn -0.070514 -0.056936 -0.042262
vn -0.072151 -0.054847 -0.042262
vn -0.077658 -0.046725 -0.042262
vn -0.079122 -0.044200 -0.042262
vn -0.082254 -0.038055 -0.042262
vn -0.085454 -0.030193 -0.042262
vn -0.085887 -0.028939 -0.042262
vn -0.088512 -0.019483 -0.042262
vn -0.089327 -0.015317 -0.042262
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
vn 0.000000 0.000000 -0.100000
usemtl Brass_-_Polished
f 1/1/1 2/2/2 10/3/3
f 10/3/3 2/2/2 9/4/4
f 9/4/4 2/2/2 3/5/5
f 9/4/4 3/5/5 8/6/6
f 8/6/6 3/5/5 4/7/7
f 8/6/6 4/7/7 7/8/8
f 7/8/8 4/7/7 5/9/9
f 7/8/8 5/9/9 6/10/10
f 5/11/11 11/12/12 6/13/13
f 6/13/13 11/12/12 18/14/14
f 18/14/14 11/12/12 12/15/15
f 18/14/14 12/15/15 17/16/16
f 17/16/16 12/15/15 13/17/17
f 17/16/16 13/17/17 16/18/18
f 16/18/18 13/17/17 14/19/19
f 16/18/18 14/19/19 15/20/20
f 14/21/21 19/22/22 15/23/23
f 15/23/23 19/22/22 26/24/24
f 26/24/24 19/22/22 20/25/25
f 26/24/24 20/25/25 25/26/26
f 25/26/26 20/25/25 21/27/27
f 25/26/26 21/27/27 24/28/28
f 24/28/28 21/27/27 22/29/29
f 24/28/28 22/29/29 23/30/30
f 22/31/31 27/32/32 23/33/33
f 23/33/33 27/32/32 28/34/34
f 27/35/35 29/36/36 28/37/37
f 28/37/37 29/36/36 30/38/38
f 29/39/39 31/40/40 30/41/41
f 30/41/41 31/40/40 32/42/42
f 31/43/43 33/44/44 32/45/45
f 32/45/45 33/44/44 40/46/46
f 40/46/46 33/44/44 34/47/47
f 40/46/46 34/47/47 39/48/48
f 39/48/48 34/47/47 35/49/49
f 39/48/48 35/49/49 38/50/50
f 38/50/50 35/49/49 36/51/51
f 38/50/50 36/51/51 37/52/52
f 36/53/53 41/54/54 37/55/55
f 37/55/55 41/54/54 48/56/56
f 48/56/56 41/54/54 42/57/57
f 48/56/56 42/57/57 47/58/58
f 47/58/58 42/57/57 43/59/59
f 47/58/58 43/59/59 46/60/60
f 46/60/60 43/59/59 44/61/61
f 46/60/60 44/61/61 45/62/62
f 44/63/63 49/64/64 45/65/65
f 45/65/65 49/64/64 56/66/66
f 56/66/66 49/64/64 50/67/67
f 56/66/66 50/67/67 55/68/68
f 55/68/68 50/67/67 51/69/69
f 55/68/68 51/69/69 54/70/70
f 54/70/70 51/69/69 52/71/71
f 54/70/70 52/71/71 53/72/72
f 52/73/73 57/74/74 53/75/75
f 53/75/75 57/74/74 64/76/76
f 64/76/76 57/74/74 58/77/77
f 64/76/76 58/77/77 63/78/78
f 63/78/78 58/77/77 59/79/79
f 63/78/78 59/79/79 62/80/80
f 62/80/80 59/79/79 60/81/81
f 62/80/80 60/81/81 61/82/82
f 60/83/83 65/84/84 61/85/85
f 61/85/85 65/84/84 70/86/86
f 70/86/86 65/84/84 66/87/87
f 70/86/86 66/87/87 69/88/88
f 69/88/88 66/87/87 67/89/89
f 69/88/88 67/89/89 68/90/90
f 68/90/90 67/89/89 1/91/91
f 68/90/90 1/91/91 10/92/92
f 71/93/93 72/94/94 80/95/95
f 80/95/95 72/94/94 79/96/96
f 79/96/96 72/94/94 73/97/97
f 79/96/96 73/97/97 78/98/98
f 78/98/98 73/97/97 74/99/99
f 78/98/98 74/99/99 77/100/100
f 77/100/100 74/99/99 75/101/101
f 77/100/100 75/101/101 76/102/102
f 75/103/103 81/104/104 76/105/105
f 76/105/105 81/104/104 88/106/106
f 88/106/106 81/104/104 82/107/107
f 88/106/106 82/107/107 87/108/108
f 87/108/108 82/107/107 83/109/109
f 87/108/108 83/109/109 86/110/110
f 86/110/110 83/109/109 84/111/111
f 86/110/110 84/111/111 85/112/112
f 84/113/113 89/114/114 85/115/115
f 85/115/115 89/114/114 96/116/116
f 96/116/116 89/114/114 90/117/117
f 96/116/116 90/117/117 95/118/118
f 95/118/118 90/117/117 91/119/119
f 95/118/118 91/119/119 94/120/120
f 94/120/120 91/119/119 92/121/121
f 94/120/120 92/121/121 93/122/122
f 92/123/123 97/124/124 93/125/125
f 93/125/125 97/124/124 104/126/126
f 104/126/126 97/124/124 98/127/127
f 104/126/126 98/127/127 103/128/128
f 103/128/128 98/127/127 99/129/129
f 103/128/128 99/129/129 102/130/130
f 102/130/130 99/129/129 100/131/131
f 102/130/130 100/131/131 101/132/132
f 100/133/133 105/134/134 101/135/135
f 101/135/135 105/134/134 112/136/136
f 112/136/136 105/134/134 106/137/137
f 112/136/136 106/137/137 111/138/138
f 111/138/138 106/137/137 107/139/139
f 111/138/138 107/139/139 110/140/140
f 110/140/140 107/139/139 108/141/141
f 110/140/140 108/141/141 109/142/142
f 108/143/143 113/144/144 109/145/145
f 109/145/145 113/144/144 120/146/146
f 120/146/146 113/144/144 114/147/147
f 120/146/146 114/147/147 119/148/148
f 119/148/148 114/147/147 115/149/149
f 119/148/148 115/149/149 118/150/150
f 118/150/150 115/149/149 116/151/151
f 118/150/150 116/151/151 117/152/152
f 116/153/153 121/154/154 117/155/155
f 117/155/155 121/154/154 122/156/156
f 121/157/157 123/158/158 122/159/159
f 122/159/159 123/158/158 124/160/160
f 123/161/161 125/162/162 124/163/163
f 124/163/163 125/162/162 126/164/164
f 125/165/165 127/166/166 126/167/167
f 126/167/167 127/166/166 128/168/168
f 127/169/169 129/170/170 128/171/171
f 128/171/171 129/170/170 130/172/172
f 129/173/173 131/174/174 130/175/175
f 130/175/175 131/174/174 132/176/176
f 131/177/177 133/178/178 132/179/179
f 132/179/179 133/178/178 134/180/180
f 133/181/181 71/182/182 134/183/183
f 134/183/183 71/182/182 80/184/184
f 134/185/185 80/186/186 132/187/187
f 132/187/187 80/186/186 130/188/188
f 130/188/188 80/186/186 25/189/189
f 130/188/188 25/189/189 24/190/190
f 80/186/186 79/191/191 25/189/189
f 25/189/189 79/191/191 26/192/192
f 26/192/192 79/191/191 15/193/193
f 15/193/193 79/191/191 16/194/194
f 16/194/194 79/191/191 17/195/195
f 17/195/195 79/191/191 18/196/196
f 18/196/196 79/191/191 6/197/197
f 6/197/197 79/191/191 7/198/198
f 7/198/198 79/191/191 8/199/199
f 8/199/199 79/191/191 9/200/200
f 9/200/200 79/191/191 78/201/201
f 9/200/200 78/201/201 10/202/202
f 10/202/202 78/201/201 77/203/203
f 10/202/202 77/203/203 68/204/204
f 68/204/204 77/203/203 76/205/205
f 68/204/204 76/205/205 69/206/206
f 69/206/206 76/205/205 88/207/207
f 69/206/206 88/207/207 70/208/208
f 70/208/208 88/207/207 87/209/209
f 70/208/208 87/209/209 86/210/210
f 70/208/208 86/210/210 61/211/211
f 61/211/211 86/210/210 85/212/212
f 61/211/211 85/212/212 62/213/213
f 62/213/213 85/212/212 96/214/214
f 62/213/213 96/214/214 63/215/215
f 63/215/215 96/214/214 95/216/216
f 63/215/215 95/216/216 94/217/217
f 63/215/215 94/217/217 64/218/218
f 64/218/218 94/217/217 93/219/219
f 64/218/218 93/219/219 104/220/220
f 104/220/220 103/221/221 64/218/218
f 64/218/218 103/221/221 53/222/222
f 53/222/222 103/221/221 102/223/223
f 53/222/222 102/223/223 101/224/224
f 101/224/224 112/225/225 53/222/222
f 53/222/222 112/225/225 54/226/226
f 54/226/226 112/225/225 111/227/227
f 54/226/226 111/227/227 55/228/228
f 55/228/228 111/227/227 110/229/229
f 55/228/228 110/229/229 109/230/230
f 55/228/228 109/230/230 56/231/231
f 56/231/231 109/230/230 120/232/232
f 56/231/231 120/232/232 45/233/233
f 45/233/233 120/232/232 119/234/234
f 45/233/233 119/234/234 46/235/235
f 46/235/235 119/234/234 47/236/236
f 47/236/236 119/234/234 118/237/237
f 47/236/236 118/237/237 48/238/238
f 48/238/238 118/237/237 117/239/239
f 48/238/238 117/239/239 37/240/240
f 37/240/240 117/239/239 38/241/241
f 38/241/241 117/239/239 39/242/242
f 39/242/242 117/239/239 40/243/243
f 40/243/243 117/239/239 32/244/244
f 32/244/244 117/239/239 30/245/245
f 30/245/245 117/239/239 122/246/246
f 30/245/245 122/246/246 28/247/247
f 28/247/247 122/246/246 124/248/248
f 28/247/247 124/248/248 128/249/249
f 128/249/249 124/248/248 126/250/250
f 28/247/247 128/249/249 23/251/251
f 23/251/251 128/249/249 130/188/188
f 23/251/251 130/188/188 24/190/190
f 135/252/252 136/253/253 138/254/254
f 138/254/254 136/253/253 137/255/255
f 136/256/256 139/257/257 137/258/258
f 137/258/258 139/257/257 140/259/259
f 139/260/260 141/261/261 140/262/262
f 140/262/262 141/261/261 142/263/263
f 141/264/264 143/265/265 142/266/266
f 142/266/266 143/265/265 144/267/267
f 143/268/268 145/269/269 144/270/270
f 144/270/270 145/269/269 152/271/271
f 152/271/271 145/269/269 146/272/272
f 152/271/271 146/272/272 151/273/273
f 151/273/273 146/272/272 147/274/274
f 151/273/273 147/274/274 150/275/275
f 150/275/275 147/274/274 148/276/276
f 150/275/275 148/276/276 149/277/277
f 148/278/278 153/279/279 149/280/280
f 149/280/280 153/279/279 160/281/281
f 160/281/281 153/279/279 154/282/282
f 160/281/281 154/282/282 159/283/283
f 159/283/283 154/282/282 155/284/284
f 159/283/283 155/284/284 158/285/285
f 158/285/285 155/284/284 156/286/286
f 158/285/285 156/286/286 157/287/287
f 156/288/288 161/289/289 157/290/290
f 157/290/290 161/289/289 168/291/291
f 168/291/291 161/289/289 162/292/292
f 168/291/291 162/292/292 167/293/293
f 167/293/293 162/292/292 163/294/294
f 167/293/293 163/294/294 166/295/295
f 166/295/295 163/294/294 164/296/296
f 166/295/295 164/296/296 165/297/297
f 164/298/298 169/299/299 165/300/300
f 165/300/300 169/299/299 176/301/301
f 176/301/301 169/299/299 170/302/302
f 176/301/301 170/302/302 175/303/303
f 175/303/303 170/302/302 171/304/304
f 175/303/303 171/304/304 174/305/305
f 174/305/305 171/304/304 172/306/306
f 174/305/305 172/306/306 173/307/307
f 172/308/308 177/309/309 173/310/310
f 173/310/310 177/309/309 184/311/311
f 184/311/311 177/309/309 178/312/312
f 184/311/311 178/312/312 183/313/313
f 183/313/313 178/312/312 179/314/314
f 183/313/313 179/314/314 182/315/315
f 182/315/315 179/314/314 180/316/316
f 182/315/315 180/316/316 181/317/317
f 180/318/318 185/319/319 181/320/320
f 181/320/320 185/319/319 192/321/321
f 192/321/321 185/319/319 186/322/322
f 192/321/321 186/322/322 191/323/323
f 191/323/323 186/322/322 187/324/324
f 191/323/323 187/324/324 190/325/325
f 190/325/325 187/324/324 188/326/326
f 190/325/325 188/326/326 189/327/327
f 188/328/328 193/329/329 189/330/330
f 189/330/330 193/329/329 194/331/331
f 193/332/332 195/333/333 194/334/334
f 194/334/334 195/333/333 196/335/335
f 195/336/336 197/337/337 196/338/338
f 196/338/338 197/337/337 204/339/339
f 204/339/339 197/337/337 198/340/340
f 204/339/339 198/340/340 203/341/341
f 203/341/341 198/340/340 199/342/342
f 203/341/341 199/342/342 202/343/343
f 202/343/343 199/342/342 200/344/344
f 202/343/343 200/344/344 201/345/345
f 200/346/346 205/347/347 201/348/348
f 201/348/348 205/347/347 212/349/349
f 212/349/349 205/347/347 206/350/350
f 212/349/349 206/350/350 211/351/351
f 211/351/351 206/350/350 207/352/352
f 211/351/351 207/352/352 210/353/353
f 210/353/353 207/352/352 208/354/354
f 210/353/353 208/354/354 209/355/355
f 208/356/356 213/357/357 209/358/358
f 209/358/358 213/357/357 220/359/359
f 220/359/359 213/357/357 214/360/360
f 220/359/359 214/360/360 219/361/361
f 219/361/361 214/360/360 215/362/362
f 219/361/361 215/362/362 218/363/363
f 218/363/363 215/362/362 216/364/364
f 218/363/363 216/364/364 217/365/365
f 216/366/366 221/367/367 217/368/368
f 217/368/368 221/367/367 228/369/369
f 228/369/369 221/367/367 222/370/370
f 228/369/369 222/370/370 227/371/371
f 227/371/371 222/370/370 223/372/372
f 227/371/371 223/372/372 226/373/373
f 226/373/373 223/372/372 224/374/374
f 226/373/373 224/374/374 225/375/375
f 224/376/376 229/377/377 225/378/378
f 225/378/378 229/377/377 236/379/379
f 236/379/379 229/377/377 230/380/380
f 236/379/379 230/380/380 235/381/381
f 235/381/381 230/380/380 231/382/382
f 235/381/381 231/382/382 234/383/383
f 234/383/383 231/382/382 232/384/384
f 234/383/383 232/384/384 233/385/385
f 232/386/386 237/387/387 233/388/388
f 233/388/388 237/387/387 244/389/389
f 244/389/389 237/387/387 238/390/390
f 244/389/389 238/390/390 243/391/391
f 243/391/391 238/390/390 239/392/392
f 243/391/391 239/392/392 242/393/393
f 242/393/393 239/392/392 240/394/394
f 242/393/393 240/394/394 241/395/395
f 240/396/396 135/397/397 241/398/398
f 241/398/398 135/397/397 138/399/399
f 138/400/400 142/401/401 241/402/402
f 241/402/402 142/401/401 144/403/403
f 241/402/402 144/403/403 152/404/404
f 138/400/400 137/405/405 142/401/401
f 142/401/401 137/405/405 140/406/406
f 152/404/404 151/407/407 241/402/402
f 241/402/402 151/407/407 150/408/408
f 241/402/402 150/408/408 149/409/409
f 160/410/410 235/411/411 149/409/409
f 149/409/409 235/411/411 234/412/412
f 149/409/409 234/412/412 233/413/413
f 159/414/414 225/415/415 160/410/410
f 160/410/410 225/415/415 236/416/416
f 160/410/410 236/416/416 235/411/411
f 158/417/417 227/418/418 159/414/414
f 159/414/414 227/418/418 226/419/419
f 159/414/414 226/419/419 225/415/415
f 227/418/418 158/417/417 228/420/420
f 228/420/420 158/417/417 157/421/421
f 228/420/420 157/421/421 217/422/422
f 217/422/422 157/421/421 168/423/423
f 217/422/422 168/423/423 218/424/424
f 218/424/424 168/423/423 167/425/425
f 218/424/424 167/425/425 166/426/426
f 218/424/424 166/426/426 219/427/427
f 219/427/427 166/426/426 165/428/428
f 219/427/427 165/428/428 220/429/429
f 220/429/429 165/428/428 176/430/430
f 220/429/429 176/430/430 175/431/431
f 220/429/429 175/431/431 209/432/432
f 209/432/432 175/431/431 174/433/433
f 209/432/432 174/433/433 210/434/434
f 210/434/434 174/433/433 173/435/435
f 210/434/434 173/435/435 211/436/436
f 211/436/436 173/435/435 184/437/437
f 211/436/436 184/437/437 212/438/438
f 212/438/438 184/437/437 183/439/439
f 212/438/438 183/439/439 201/440/440
f 201/440/440 183/439/439 182/441/441
f 201/440/440 182/441/441 202/442/442
f 202/442/442 182/441/441 181/443/443
f 202/442/442 181/443/443 192/444/444
f 202/442/442 192/444/444 203/445/445
f 203/445/445 192/444/444 191/446/446
f 203/445/445 191/446/446 204/447/447
f 204/447/447 191/446/446 190/448/448
f 204/447/447 190/448/448 196/449/449
f 196/449/449 190/448/448 189/450/450
f 196/449/449 189/450/450 194/451/451
f 233/413/413 244/452/452 149/409/409
f 149/409/409 244/452/452 243/453/453
f 149/409/409 243/453/453 242/454/454
f 242/454/454 241/402/402 149/409/409
f 246/455/455 123/456/456 245/457/457
f 245/457/457 123/456/456 214/458/458
f 245/457/457 214/458/458 213/459/459
f 247/460/460 133/461/461 246/455/455
f 246/455/455 133/461/461 131/462/462
f 246/455/455 131/462/462 125/463/463
f 125/463/463 131/462/462 129/464/464
f 125/463/463 129/464/464 127/465/465
f 248/466/466 121/467/467 247/460/460
f 247/460/460 121/467/467 116/468/468
f 247/460/460 116/468/468 115/469/469
f 245/457/457 193/470/470 248/466/466
f 248/466/466 193/470/470 139/471/471
f 248/466/466 139/471/471 136/472/472
f 136/472/472 135/473/473 248/466/466
f 248/466/466 135/473/473 121/467/467
f 135/473/473 240/474/474 121/467/467
f 121/467/467 240/474/474 123/456/456
f 123/456/456 240/474/474 239/475/475
f 123/456/456 239/475/475 238/476/476
f 238/476/476 237/477/477 123/456/456
f 123/456/456 237/477/477 232/478/478
f 123/456/456 232/478/478 231/479/479
f 231/479/479 230/480/480 123/456/456
f 123/456/456 230/480/480 229/481/481
f 123/456/456 229/481/481 224/482/482
f 224/482/482 223/483/483 123/456/456
f 123/456/456 223/483/483 222/484/484
f 123/456/456 222/484/484 221/485/485
f 221/485/485 216/486/486 123/456/456
f 123/456/456 216/486/486 215/487/487
f 123/456/456 215/487/487 214/458/458
f 213/459/459 208/488/488 245/457/457
f 245/457/457 208/488/488 207/489/489
f 245/457/457 207/489/489 206/490/490
f 206/490/490 205/491/491 245/457/457
f 245/457/457 205/491/491 200/492/492
f 245/457/457 200/492/492 199/493/493
f 199/493/493 198/494/494 245/457/457
f 245/457/457 198/494/494 197/495/495
f 245/457/457 197/495/495 195/496/496
f 195/496/496 193/470/470 245/457/457
f 139/471/471 193/470/470 143/497/497
f 143/497/497 193/470/470 188/498/498
f 143/497/497 188/498/498 145/499/499
f 145/499/499 188/498/498 146/500/500
f 146/500/500 188/498/498 147/501/501
f 147/501/501 188/498/498 148/502/502
f 148/502/502 188/498/498 153/503/503
f 153/503/503 188/498/498 187/504/504
f 153/503/503 187/504/504 154/505/505
f 154/505/505 187/504/504 186/506/506
f 154/505/505 186/506/506 155/507/507
f 155/507/507 186/506/506 185/508/508
f 155/507/507 185/508/508 180/509/509
f 180/509/509 179/510/510 155/507/507
f 155/507/507 179/510/510 178/511/511
f 155/507/507 178/511/511 177/512/512
f 155/507/507 177/512/512 156/513/513
f 156/513/513 177/512/512 172/514/514
f 156/513/513 172/514/514 161/515/515
f 161/515/515 172/514/514 171/516/516
f 161/515/515 171/516/516 162/517/517
f 162/517/517 171/516/516 170/518/518
f 162/517/517 170/518/518 169/519/519
f 164/520/520 163/521/521 169/519/519
f 169/519/519 163/521/521 162/517/517
f 143/497/497 141/522/522 139/471/471
f 81/523/523 75/524/524 133/461/461
f 133/461/461 75/524/524 74/525/525
f 133/461/461 74/525/525 73/526/526
f 73/526/526 72/527/527 133/461/461
f 133/461/461 72/527/527 71/528/528
f 125/463/463 123/456/456 246/455/455
f 115/469/469 114/529/529 247/460/460
f 247/460/460 114/529/529 113/530/530
f 247/460/460 113/530/530 108/531/531
f 108/531/531 107/532/532 247/460/460
f 247/460/460 107/532/532 106/533/533
f 247/460/460 106/533/533 105/534/534
f 105/534/534 100/535/535 247/460/460
f 247/460/460 100/535/535 99/536/536
f 247/460/460 99/536/536 98/537/537
f 98/537/537 97/538/538 247/460/460
f 247/460/460 97/538/538 92/539/539
f 247/460/460 92/539/539 91/540/540
f 91/540/540 90/541/541 247/460/460
f 247/460/460 90/541/541 89/542/542
f 247/460/460 89/542/542 84/543/543
f 84/543/543 83/544/544 247/460/460
f 247/460/460 83/544/544 82/545/545
f 247/460/460 82/545/545 133/461/461
f 133/461/461 82/545/545 81/523/523
f 285/546/546 249/547/547 323/548/548
f 323/549/548 249/550/547 250/551/549
f 323/549/548 250/551/549 325/552/550
f 325/552/550 250/551/549 251/553/551
f 325/552/550 251/553/551 327/554/552
f 327/554/552 251/553/551 252/555/553
f 327/554/552 252/555/553 329/556/554
f 329/556/554 252/555/553 253/557/555
f 329/556/554 253/557/555 331/558/556
f 331/558/556 253/557/555 254/559/557
f 331/558/556 254/559/557 333/560/558
f 333/560/558 254/559/557 255/561/559
f 333/560/558 255/561/559 335/562/560
f 335/562/560 255/561/559 256/563/561
f 335/562/560 256/563/561 337/564/562
f 337/564/562 256/563/561 257/565/563
f 337/564/562 257/565/563 339/566/564
f 339/566/564 257/565/563 258/567/565
f 339/566/564 258/567/565 341/568/566
f 341/568/566 258/567/565 259/569/567
f 341/568/566 259/569/567 343/570/568
f 343/570/568 259/569/567 260/571/569
f 343/570/568 260/571/569 345/572/570
f 345/572/570 260/571/569 261/573/571
f 345/572/570 261/573/571 347/574/572
f 347/574/572 261/573/571 262/575/573
f 347/574/572 262/575/573 349/576/574
f 349/576/574 262/575/573 263/577/575
f 349/576/574 263/577/575 351/578/576
f 351/578/576 263/577/575 264/579/577
f 351/578/576 264/579/577 353/580/578
f 353/580/578 264/579/577 265/581/579
f 353/580/578 265/581/579 355/582/580
f 355/582/580 265/581/579 266/583/581
f 355/582/580 266/583/581 357/584/582
f 357/584/582 266/583/581 267/585/583
f 357/584/582 267/585/583 359/586/584
f 359/586/584 267/585/583 268/587/585
f 359/586/584 268/587/585 361/588/586
f 361/588/586 268/587/585 269/589/587
f 361/588/586 269/589/587 363/590/588
f 363/590/588 269/589/587 270/591/589
f 363/590/588 270/591/589 365/592/590
f 365/592/590 270/591/589 271/593/591
f 365/592/590 271/593/591 367/594/592
f 367/594/592 271/593/591 272/595/593
f 367/594/592 272/595/593 369/596/594
f 369/596/594 272/595/593 273/597/595
f 369/596/594 273/597/595 371/598/596
f 371/598/596 273/597/595 274/599/597
f 371/598/596 274/599/597 373/600/598
f 373/600/598 274/599/597 275/601/599
f 373/600/598 275/601/599 375/602/600
f 375/602/600 275/601/599 276/603/601
f 375/602/600 276/603/601 377/604/602
f 377/604/602 276/603/601 277/605/603
f 377/604/602 277/605/603 379/606/604
f 379/606/604 277/605/603 278/607/605
f 379/606/604 278/607/605 381/608/606
f 381/608/606 278/607/605 279/609/607
f 381/608/606 279/609/607 383/610/608
f 383/610/608 279/609/607 280/611/609
f 383/610/608 280/611/609 385/612/610
f 385/612/610 280/611/609 281/613/611
f 385/612/610 281/613/611 387/614/612
f 387/614/612 281/613/611 282/615/613
f 387/614/612 282/615/613 389/616/614
f 389/616/614 282/615/613 283/617/615
f 389/616/614 283/617/615 391/618/616
f 391/618/616 283/617/615 284/619/617
f 391/618/616 284/619/617 393/620/618
f 393/620/618 284/619/617 285/546/546
f 393/620/618 285/546/546 323/548/548
f 322/621/619 286/622/620 324/623/621
f 324/624/621 286/625/620 287/626/622
f 324/624/621 287/626/622 394/627/623
f 394/627/623 287/626/622 288/628/624
f 394/627/623 288/628/624 392/629/625
f 392/629/625 288/628/624 289/630/626
f 392/629/625 289/630/626 390/631/627
f 390/631/627 289/630/626 290/632/628
f 390/631/627 290/632/628 388/633/629
f 388/633/629 290/632/628 291/634/630
f 388/633/629 291/634/630 386/635/631
f 386/635/631 291/634/630 292/636/632
f 386/635/631 292/636/632 384/637/633
f 384/637/633 292/636/632 293/638/634
f 384/637/633 293/638/634 382/639/635
f 382/639/635 293/638/634 294/640/636
f 382/639/635 294/640/636 380/641/637
f 380/641/637 294/640/636 295/642/638
f 380/641/637 295/642/638 378/643/639
f 378/643/639 295/642/638 296/644/640
f 378/643/639 296/644/640 376/645/641
f 376/645/641 296/644/640 297/646/642
f 376/645/641 297/646/642 374/647/643
f 374/647/643 297/646/642 298/648/644
f 374/647/643 298/648/644 372/649/645
f 372/649/645 298/648/644 299/650/646
f 372/649/645 299/650/646 370/651/647
f 370/651/647 299/650/646 300/652/648
f 370/651/647 300/652/648 368/653/649
f 368/653/649 300/652/648 301/654/650
f 368/653/649 301/654/650 366/655/651
f 366/655/651 301/654/650 302/656/652
f 366/655/651 302/656/652 364/657/653
f 364/657/653 302/656/652 303/658/654
f 364/657/653 303/658/654 362/659/655
f 362/659/655 303/658/654 304/660/656
f 362/659/655 304/660/656 360/661/657
f 360/661/657 304/660/656 305/662/658
f 360/661/657 305/662/658 358/663/659
f 358/663/659 305/662/658 306/664/660
f 358/663/659 306/664/660 356/665/661
f 356/665/661 306/664/660 307/666/662
f 356/665/661 307/666/662 354/667/663
f 354/667/663 307/666/662 308/668/664
f 354/667/663 308/668/664 352/669/665
f 352/669/665 308/668/664 309/670/666
f 352/669/665 309/670/666 350/671/667
f 350/671/667 309/670/666 310/672/668
f 350/671/667 310/672/668 348/673/669
f 348/673/669 310/672/668 311/674/670
f 348/673/669 311/674/670 346/675/671
f 346/675/671 311/674/670 312/676/672
f 346/675/671 312/676/672 344/677/673
f 344/677/673 312/676/672 313/678/674
f 344/677/673 313/678/674 342/679/675
f 342/679/675 313/678/674 314/680/676
f 342/679/675 314/680/676 340/681/677
f 340/681/677 314/680/676 315/682/678
f 340/681/677 315/682/678 338/683/679
f 338/683/679 315/682/678 316/684/680
f 338/683/679 316/684/680 336/685/681
f 336/685/681 316/684/680 317/686/682
f 336/685/681 317/686/682 334/687/683
f 334/687/683 317/686/682 318/688/684
f 334/687/683 318/688/684 332/689/685
f 332/689/685 318/688/684 319/690/686
f 332/689/685 319/690/686 330/691/687
f 330/691/687 319/690/686 320/692/688
f 330/691/687 320/692/688 328/693/689
f 328/693/689 320/692/688 321/694/690
f 328/693/689 321/694/690 326/695/691
f 326/695/691 321/694/690 322/621/619
f 326/695/691 322/621/619 324/623/621
f 323/548/548 324/624/621 393/620/618
f 393/620/618 324/624/621 394/627/623
f 393/620/618 394/627/623 391/618/616
f 391/618/616 394/627/623 392/629/625
f 391/618/616 392/629/625 389/616/614
f 389/616/614 392/629/625 390/631/627
f 389/616/614 390/631/627 387/614/612
f 387/614/612 390/631/627 388/633/629
f 387/614/612 388/633/629 385/612/610
f 385/612/610 388/633/629 386/635/631
f 385/612/610 386/635/631 383/610/608
f 383/610/608 386/635/631 384/637/633
f 383/610/608 384/637/633 381/608/606
f 381/608/606 384/637/633 382/639/635
f 381/608/606 382/639/635 379/606/604
f 379/606/604 382/639/635 380/641/637
f 379/606/604 380/641/637 377/604/602
f 377/604/602 380/641/637 378/643/639
f 377/604/602 378/643/639 375/602/600
f 375/602/600 378/643/639 376/645/641
f 375/602/600 376/645/641 373/600/598
f 373/600/598 376/645/641 374/647/643
f 373/600/598 374/647/643 371/598/596
f 371/598/596 374/647/643 372/649/645
f 371/598/596 372/649/645 369/596/594
f 369/596/594 372/649/645 370/651/647
f 369/596/594 370/651/647 367/594/592
f 367/594/592 370/651/647 368/653/649
f 367/594/592 368/653/649 365/592/590
f 365/592/590 368/653/649 366/655/651
f 365/592/590 366/655/651 363/590/588
f 363/590/588 366/655/651 364/657/653
f 363/590/588 364/657/653 361/588/586
f 361/588/586 364/657/653 362/659/655
f 361/588/586 362/659/655 359/586/584
f 359/586/584 362/659/655 360/661/657
f 359/586/584 360/661/657 357/584/582
f 357/584/582 360/661/657 358/663/659
f 357/584/582 358/663/659 355/582/580
f 355/582/580 358/663/659 356/665/661
f 355/582/580 356/665/661 353/580/578
f 353/580/578 356/665/661 354/667/663
f 353/580/578 354/667/663 351/578/576
f 351/578/576 354/667/663 352/669/665
f 351/578/576 352/669/665 349/576/574
f 349/576/574 352/669/665 350/671/667
f 349/576/574 350/671/667 347/574/572
f 347/574/572 350/671/667 348/673/669
f 347/574/572 348/673/669 345/572/570
f 345/572/570 348/673/669 346/675/671
f 345/572/570 346/675/671 343/570/568
f 343/570/568 346/675/671 344/677/673
f 343/570/568 344/677/673 341/568/566
f 341/568/566 344/677/673 342/679/675
f 341/568/566 342/679/675 339/566/564
f 339/566/564 342/679/675 340/681/677
f 339/566/564 340/681/677 337/564/562
f 337/564/562 340/681/677 338/683/679
f 337/564/562 338/683/679 335/562/560
f 335/562/560 338/683/679 336/685/681
f 335/562/560 336/685/681 333/560/558
f 333/560/558 336/685/681 334/687/683
f 333/560/558 334/687/683 331/558/556
f 331/558/556 334/687/683 332/689/685
f 331/558/556 332/689/685 329/556/554
f 329/556/554 332/689/685 330/691/687
f 329/556/554 330/691/687 327/554/552
f 327/554/552 330/691/687 328/693/689
f 327/554/552 328/693/689 325/552/550
f 325/552/550 328/693/689 326/695/691
f 325/552/550 326/695/691 323/549/548
f 323/549/548 326/695/691 324/623/621
f 396/696/692 512/697/693 395/698/694
f 395/698/694 512/697/693 511/699/695
f 395/700/694 511/701/695 452/702/696
f 452/702/696 511/701/695 568/703/697
f 452/702/696 568/703/697 451/704/698
f 451/704/698 568/703/697 567/705/699
f 451/704/698 567/705/699 450/706/700
f 450/706/700 567/705/699 566/707/701
f 450/706/700 566/707/701 449/708/702
f 449/708/702 566/707/701 565/709/703
f 449/708/702 565/709/703 448/710/704
f 448/710/704 565/709/703 564/711/705
f 448/710/704 564/711/705 447/712/706
f 447/712/706 564/711/705 563/713/707
f 447/712/706 563/713/707 446/714/708
f 446/714/708 563/713/707 562/715/709
f 446/714/708 562/715/709 445/716/710
f 445/716/710 562/715/709 561/717/711
f 445/716/710 561/717/711 444/718/712
f 444/718/712 561/717/711 560/719/713
f 444/718/712 560/719/713 443/720/714
f 443/720/714 560/719/713 559/721/715
f 443/720/714 559/721/715 442/722/716
f 442/722/716 559/721/715 558/723/717
f 442/722/716 558/723/717 441/724/718
f 441/724/718 558/723/717 557/725/719
f 441/724/718 557/725/719 440/726/720
f 440/726/720 557/725/719 556/727/721
f 440/726/720 556/727/721 439/728/722
f 439/728/722 556/727/721 555/729/723
f 439/728/722 555/729/723 438/730/724
f 438/730/724 555/729/723 554/731/725
f 438/730/724 554/731/725 437/732/726
f 437/732/726 554/731/725 553/733/727
f 437/732/726 553/733/727 436/734/728
f 436/734/728 553/733/727 552/735/729
f 436/734/728 552/735/729 435/736/730
f 435/736/730 552/735/729 551/737/731
f 435/736/730 551/737/731 434/738/732
f 434/738/732 551/737/731 550/739/733
f 434/738/732 550/739/733 433/740/734
f 433/740/734 550/739/733 549/741/735
f 433/740/734 549/741/735 432/742/736
f 432/742/736 549/741/735 548/743/737
f 432/742/736 548/743/737 431/744/738
f 431/744/738 548/743/737 547/745/739
f 431/744/738 547/745/739 430/746/740
f 430/746/740 547/745/739 546/747/741
f 430/746/740 546/747/741 429/748/742
f 429/748/742 546/747/741 545/749/743
f 429/748/742 545/749/743 428/750/744
f 428/750/744 545/749/743 544/751/745
f 428/750/744 544/751/745 427/752/746
f 427/752/746 544/751/745 543/753/747
f 427/752/746 543/753/747 426/754/748
f 426/754/748 543/753/747 542/755/749
f 426/754/748 542/755/749 425/756/750
f 425/756/750 542/755/749 541/757/751
f 425/756/750 541/757/751 424/758/752
f 424/758/752 541/757/751 540/759/753
f 424/758/752 540/759/753 423/760/754
f 423/760/754 540/759/753 539/761/755
f 423/760/754 539/761/755 422/762/756
f 422/762/756 539/761/755 538/763/757
f 422/762/756 538/763/757 421/764/758
f 421/764/758 538/763/757 537/765/759
f 421/764/758 537/765/759 420/766/760
f 420/766/760 537/765/759 536/767/761
f 420/766/760 536/767/761 419/768/762
f 419/768/762 536/767/761 535/769/763
f 419/768/762 535/769/763 418/770/764
f 418/770/764 535/769/763 534/771/765
f 418/770/764 534/771/765 417/772/766
f 417/772/766 534/771/765 533/773/767
f 417/772/766 533/773/767 416/774/768
f 416/774/768 533/773/767 532/775/769
f 416/774/768 532/775/769 415/776/770
f 415/776/770 532/775/769 531/777/771
f 415/776/770 531/777/771 414/778/772
f 414/778/772 531/777/771 530/779/773
f 414/778/772 530/779/773 413/780/774
f 413/780/774 530/779/773 529/781/775
f 413/780/774 529/781/775 412/782/776
f 412/782/776 529/781/775 528/783/777
f 412/782/776 528/783/777 411/784/778
f 411/784/778 528/783/777 527/785/779
f 411/784/778 527/785/779 410/786/780
f 410/786/780 527/785/779 526/787/781
f 410/786/780 526/787/781 409/788/782
f 409/788/782 526/787/781 525/789/783
f 409/788/782 525/789/783 408/790/784
f 408/790/784 525/789/783 524/791/785
f 408/790/784 524/791/785 407/792/786
f 407/792/786 524/791/785 523/793/787
f 407/792/786 523/793/787 406/794/788
f 406/794/788 523/793/787 522/795/789
f 406/794/788 522/795/789 405/796/790
f 405/796/790 522/795/789 521/797/791
f 405/796/790 521/797/791 404/798/792
f 404/798/792 521/797/791 520/799/793
f 404/798/792 520/799/793 403/800/794
f 403/800/794 520/799/793 519/801/795
f 403/800/794 519/801/795 402/802/796
f 402/802/796 519/801/795 518/803/797
f 402/802/796 518/803/797 401/804/798
f 401/804/798 518/803/797 517/805/799
f 401/804/798 517/805/799 400/806/800
f 400/806/800 517/805/799 516/807/801
f 400/806/800 516/807/801 399/808/802
f 399/808/802 516/807/801 515/809/803
f 399/808/802 515/809/803 398/810/804
f 398/810/804 515/809/803 514/811/805
f 398/810/804 514/811/805 397/812/806
f 397/812/806 514/811/805 513/813/807
f 397/812/806 513/813/807 396/696/692
f 396/696/692 513/813/807 512/697/693
f 454/814/808 568/703/697 453/815/809
f 453/815/809 568/703/697 511/701/695
f 453/816/809 511/699/695 510/817/810
f 510/817/810 511/699/695 512/697/693
f 510/817/810 512/697/693 509/818/811
f 509/818/811 512/697/693 513/813/807
f 509/818/811 513/813/807 508/819/812
f 508/819/812 513/813/807 514/811/805
f 508/819/812 514/811/805 507/820/813
f 507/820/813 514/811/805 515/809/803
f 507/820/813 515/809/803 506/821/814
f 506/821/814 515/809/803 516/807/801
f 506/821/814 516/807/801 505/822/815
f 505/822/815 516/807/801 517/805/799
f 505/822/815 517/805/799 504/823/816
f 504/823/816 517/805/799 518/803/797
f 504/823/816 518/803/797 503/824/817
f 503/824/817 518/803/797 519/801/795
f 503/824/817 519/801/795 502/825/818
f 502/825/818 519/801/795 520/799/793
f 502/825/818 520/799/793 501/826/819
f 501/826/819 520/799/793 521/797/791
f 501/826/819 521/797/791 500/827/820
f 500/827/820 521/797/791 522/795/789
f 500/827/820 522/795/789 499/828/821
f 499/828/821 522/795/789 523/793/787
f 499/828/821 523/793/787 498/829/822
f 498/829/822 523/793/787 524/791/785
f 498/829/822 524/791/785 497/830/823
f 497/830/823 524/791/785 525/789/783
f 497/830/823 525/789/783 496/831/824
f 496/831/824 525/789/783 526/787/781
f 496/831/824 526/787/781 495/832/825
f 495/832/825 526/787/781 527/785/779
f 495/832/825 527/785/779 494/833/826
f 494/833/826 527/785/779 528/783/777
f 494/833/826 528/783/777 493/834/827
f 493/834/827 528/783/777 529/781/775
f 493/834/827 529/781/775 492/835/828
f 492/835/828 529/781/775 530/779/773
f 492/835/828 530/779/773 491/836/829
f 491/836/829 530/779/773 531/777/771
f 491/836/829 531/777/771 490/837/830
f 490/837/830 531/777/771 532/775/769
f 490/837/830 532/775/769 489/838/831
f 489/838/831 532/775/769 533/773/767
f 489/838/831 533/773/767 488/839/832
f 488/839/832 533/773/767 534/771/765
f 488/839/832 534/771/765 487/840/833
f 487/840/833 534/771/765 535/769/763
f 487/840/833 535/769/763 486/841/834
f 486/841/834 535/769/763 536/767/761
f 486/841/834 536/767/761 485/842/835
f 485/842/835 536/767/761 537/765/759
f 485/842/835 537/765/759 484/843/836
f 484/843/836 537/765/759 538/763/757
f 484/843/836 538/763/757 483/844/837
f 483/844/837 538/763/757 539/761/755
f 483/844/837 539/761/755 482/845/838
f 482/845/838 539/761/755 540/759/753
f 482/845/838 540/759/753 481/846/839
f 481/846/839 540/759/753 541/757/751
f 481/846/839 541/757/751 480/847/840
f 480/847/840 541/757/751 542/755/749
f 480/847/840 542/755/749 479/848/841
f 479/848/841 542/755/749 543/753/747
f 479/848/841 543/753/747 478/849/842
f 478/849/842 543/753/747 544/751/745
f 478/849/842 544/751/745 477/850/843
f 477/850/843 544/751/745 545/749/743
f 477/850/843 545/749/743 476/851/844
f 476/851/844 545/749/743 546/747/741
f 476/851/844 546/747/741 475/852/845
f 475/852/845 546/747/741 547/745/739
f 475/852/845 547/745/739 474/853/846
f 474/853/846 547/745/739 548/743/737
f 474/853/846 548/743/737 473/854/847
f 473/854/847 548/743/737 549/741/735
f 473/854/847 549/741/735 472/855/848
f 472/855/848 549/741/735 550/739/733
f 472/855/848 550/739/733 471/856/849
f 471/856/849 550/739/733 551/737/731
f 471/856/849 551/737/731 470/857/850
f 470/857/850 551/737/731 552/735/729
f 470/857/850 552/735/729 469/858/851
f 469/858/851 552/735/729 553/733/727
f 469/858/851 553/733/727 468/859/852
f 468/859/852 553/733/727 554/731/725
f 468/859/852 554/731/725 467/860/853
f 467/860/853 554/731/725 555/729/723
f 467/860/853 555/729/723 466/861/854
f 466/861/854 555/729/723 556/727/721
f 466/861/854 556/727/721 465/862/855
f 465/862/855 556/727/721 557/725/719
f 465/862/855 557/725/719 464/863/856
f 464/863/856 557/725/719 558/723/717
f 464/863/856 558/723/717 463/864/857
f 463/864/857 558/723/717 559/721/715
f 463/864/857 559/721/715 462/865/858
f 462/865/858 559/721/715 560/719/713
f 462/865/858 560/719/713 461/866/859
f 461/866/859 560/719/713 561/717/711
f 461/866/859 561/717/711 460/867/860
f 460/867/860 561/717/711 562/715/709
f 460/867/860 562/715/709 459/868/861
f 459/868/861 562/715/709 563/713/707
f 459/868/861 563/713/707 458/869/862
f 458/869/862 563/713/707 564/711/705
f 458/869/862 564/711/705 457/870/863
f 457/870/863 564/711/705 565/709/703
f 457/870/863 565/709/703 456/871/864
f 456/871/864 565/709/703 566/707/701
f 456/871/864 566/707/701 455/872/865
f 455/872/865 566/707/701 567/705/699
f 455/872/865 567/705/699 454/814/808
f 454/814/808 567/705/699 568/703/697
f 285/873/866 396/874/867 249/875/868
f 249/875/868 396/874/867 395/876/869
f 249/875/868 395/876/869 452/877/870
f 396/874/867 285/873/866 397/878/871
f 397/878/871 285/873/866 284/879/872
f 397/878/871 284/879/872 398/880/873
f 398/880/873 284/879/872 399/881/874
f 399/881/874 284/879/872 283/882/875
f 399/881/874 283/882/875 400/883/876
f 400/883/876 283/882/875 282/884/877
f 400/883/876 282/884/877 401/885/878
f 401/885/878 282/884/877 402/886/879
f 402/886/879 282/884/877 281/887/880
f 402/886/879 281/887/880 403/888/881
f 403/888/881 281/887/880 404/889/882
f 404/889/882 281/887/880 280/890/883
f 404/889/882 280/890/883 405/891/884
f 405/891/884 280/890/883 279/892/885
f 405/891/884 279/892/885 406/893/886
f 406/893/886 279/892/885 407/894/887
f 407/894/887 279/892/885 278/895/888
f 407/894/887 278/895/888 408/896/889
f 408/896/889 278/895/888 277/897/890
f 408/896/889 277/897/890 409/898/891
f 409/898/891 277/897/890 410/899/892
f 410/899/892 277/897/890 276/900/893
f 410/899/892 276/900/893 411/901/894
f 411/901/894 276/900/893 275/902/895
f 411/901/894 275/902/895 412/903/896
f 412/903/896 275/902/895 413/904/897
f 413/904/897 275/902/895 274/905/898
f 413/904/897 274/905/898 414/906/899
f 414/906/899 274/905/898 415/907/900
f 415/907/900 274/905/898 273/908/901
f 415/907/900 273/908/901 416/909/902
f 416/909/902 273/908/901 272/910/903
f 416/909/902 272/910/903 417/911/904
f 417/911/904 272/910/903 418/912/905
f 418/912/905 272/910/903 271/913/906
f 418/912/905 271/913/906 419/914/907
f 419/914/907 271/913/906 270/915/908
f 419/914/907 270/915/908 420/916/909
f 420/916/909 270/915/908 421/917/910
f 421/917/910 270/915/908 269/918/911
f 421/917/910 269/918/911 422/919/912
f 422/919/912 269/918/911 268/920/913
f 422/919/912 268/920/913 423/921/914
f 423/921/914 268/920/913 424/922/915
f 424/922/915 268/920/913 267/923/916
f 424/922/915 267/923/916 425/924/917
f 425/924/917 267/923/916 426/925/918
f 426/925/918 267/923/916 266/926/919
f 426/925/918 266/926/919 427/927/920
f 427/927/920 266/926/919 265/928/921
f 427/927/920 265/928/921 428/929/922
f 428/929/922 265/928/921 429/930/923
f 429/930/923 265/928/921 264/931/924
f 429/930/923 264/931/924 430/932/925
f 430/932/925 264/931/924 263/933/926
f 430/932/925 263/933/926 431/934/927
f 431/934/927 263/933/926 432/935/928
f 432/935/928 263/933/926 262/936/929
f 432/935/928 262/936/929 433/937/930
f 433/937/930 262/936/929 261/938/931
f 433/937/930 261/938/931 434/939/932
f 434/939/932 261/938/931 435/940/933
f 435/940/933 261/938/931 260/941/934
f 435/940/933 260/941/934 436/942/935
f 436/942/935 260/941/934 437/943/936
f 437/943/936 260/941/934 259/944/937
f 437/943/936 259/944/937 438/945/938
f 438/945/938 259/944/937 258/946/939
f 438/945/938 258/946/939 439/947/940
f 439/947/940 258/946/939 440/948/941
f 440/948/941 258/946/939 257/949/942
f 440/948/941 257/949/942 441/950/943
f 441/950/943 257/949/942 256/951/944
f 441/950/943 256/951/944 442/952/945
f 442/952/945 256/951/944 443/953/946
f 443/953/946 256/951/944 255/954/947
f 443/953/946 255/954/947 444/955/948
f 444/955/948 255/954/947 254/956/949
f 444/955/948 254/956/949 445/957/950
f 445/957/950 254/956/949 446/958/951
f 446/958/951 254/956/949 253/959/952
f 446/958/951 253/959/952 447/960/953
f 447/960/953 253/959/952 448/961/954
f 448/961/954 253/959/952 252/962/955
f 448/961/954 252/962/955 449/963/956
f 449/963/956 252/962/955 251/964/957
f 449/963/956 251/964/957 450/965/958
f 450/965/958 251/964/957 451/966/959
f 451/966/959 251/964/957 250/967/960
f 451/966/959 250/967/960 452/877/870
f 452/877/870 250/967/960 249/875/868
f 570/968/961 458/969/962 569/970/963
f 569/970/963 458/969/962 457/971/964
f 569/970/963 457/971/964 456/972/965
f 571/973/966 467/974/967 570/968/961
f 570/968/961 467/974/967 466/975/968
f 570/968/961 466/975/968 465/976/969
f 572/977/970 476/978/971 571/973/966
f 571/973/966 476/978/971 475/979/972
f 571/973/966 475/979/972 474/980/973
f 248/981/974 487/982/975 572/977/970
f 572/977/970 487/982/975 486/983/976
f 572/977/970 486/983/976 485/984/977
f 247/985/978 496/986/979 248/981/974
f 248/981/974 496/986/979 495/987/980
f 248/981/974 495/987/980 494/988/981
f 569/970/963 505/989/982 247/985/978
f 247/985/978 505/989/982 504/990/983
f 247/985/978 504/990/983 503/991/984
f 454/992/985 453/993/986 569/970/963
f 569/970/963 453/993/986 510/994/987
f 569/970/963 510/994/987 509/995/988
f 509/995/988 508/996/989 569/970/963
f 569/970/963 508/996/989 507/997/990
f 569/970/963 507/997/990 506/998/991
f 506/998/991 505/989/982 569/970/963
f 503/991/984 502/999/992 247/985/978
f 247/985/978 502/999/992 501/1000/993
f 247/985/978 501/1000/993 500/1001/994
f 500/1001/994 499/1002/995 247/985/978
f 247/985/978 499/1002/995 498/1003/996
f 247/985/978 498/1003/996 497/1004/997
f 497/1004/997 496/986/979 247/985/978
f 494/988/981 493/1005/998 248/981/974
f 248/981/974 493/1005/998 492/1006/999
f 248/981/974 492/1006/999 491/1007/1000
f 491/1007/1000 490/1008/1001 248/981/974
f 248/981/974 490/1008/1001 489/1009/1002
f 248/981/974 489/1009/1002 488/1010/1003
f 488/1010/1003 487/982/975 248/981/974
f 485/984/977 484/1011/1004 572/977/970
f 572/977/970 484/1011/1004 483/1012/1005
f 572/977/970 483/1012/1005 482/1013/1006
f 482/1013/1006 481/1014/1007 572/977/970
f 572/977/970 481/1014/1007 480/1015/1008
f 572/977/970 480/1015/1008 479/1016/1009
f 479/1016/1009 478/1017/1010 572/977/970
f 572/977/970 478/1017/1010 477/1018/1011
f 572/977/970 477/1018/1011 476/978/971
f 474/980/973 473/1019/1012 571/973/966
f 571/973/966 473/1019/1012 472/1020/1013
f 571/973/966 472/1020/1013 471/1021/1014
f 471/1021/1014 470/1022/1015 571/973/966
f 571/973/966 470/1022/1015 469/1023/1016
f 571/973/966 469/1023/1016 468/1024/1017
f 468/1024/1017 467/974/967 571/973/966
f 465/976/969 464/1025/1018 570/968/961
f 570/968/961 464/1025/1018 463/1026/1019
f 570/968/961 463/1026/1019 462/1027/1020
f 462/1027/1020 461/1028/1021 570/968/961
f 570/968/961 461/1028/1021 460/1029/1022
f 570/968/961 460/1029/1022 459/1030/1023
f 459/1030/1023 458/969/962 570/968/961
f 456/972/965 455/1031/1024 569/970/963
f 569/970/963 455/1031/1024 454/992/985
f 574/1032/1025 611/1033/1026 573/1034/1027
f 573/1034/1027 611/1033/1026 612/1035/1028
f 573/1034/1027 612/1035/1028 613/1036/1029
f 246/1037/1030 600/1038/1031 574/1032/1025
f 574/1032/1025 600/1038/1031 601/1039/1032
f 574/1032/1025 601/1039/1032 602/1040/1033
f 245/1041/1034 591/1042/1035 246/1037/1030
f 246/1037/1030 591/1042/1035 592/1043/1036
f 246/1037/1030 592/1043/1036 593/1044/1037
f 575/1045/1038 582/1046/1039 245/1041/1034
f 245/1041/1034 582/1046/1039 583/1047/1040
f 245/1041/1034 583/1047/1040 584/1048/1041
f 576/1049/1042 629/1050/1043 575/1045/1038
f 575/1045/1038 629/1050/1043 630/1051/1044
f 575/1045/1038 630/1051/1044 631/1052/1045
f 573/1034/1027 620/1053/1046 576/1049/1042
f 576/1049/1042 620/1053/1046 621/1054/1047
f 576/1049/1042 621/1054/1047 622/1055/1048
f 634/1056/1049 577/1057/1050 575/1045/1038
f 575/1045/1038 577/1057/1050 578/1058/1051
f 575/1045/1038 578/1058/1051 579/1059/1052
f 579/1059/1052 580/1060/1053 575/1045/1038
f 575/1045/1038 580/1060/1053 581/1061/1054
f 575/1045/1038 581/1061/1054 582/1046/1039
f 584/1048/1041 585/1062/1055 245/1041/1034
f 245/1041/1034 585/1062/1055 586/1063/1056
f 245/1041/1034 586/1063/1056 587/1064/1057
f 587/1064/1057 588/1065/1058 245/1041/1034
f 245/1041/1034 588/1065/1058 589/1066/1059
f 245/1041/1034 589/1066/1059 590/1067/1060
f 590/1067/1060 591/1042/1035 245/1041/1034
f 593/1044/1037 594/1068/1061 246/1037/1030
f 246/1037/1030 594/1068/1061 595/1069/1062
f 246/1037/1030 595/1069/1062 596/1070/1063
f 596/1070/1063 597/1071/1064 246/1037/1030
f 246/1037/1030 597/1071/1064 598/1072/1065
f 246/1037/1030 598/1072/1065 599/1073/1066
f 599/1073/1066 600/1038/1031 246/1037/1030
f 602/1040/1033 603/1074/1067 574/1032/1025
f 574/1032/1025 603/1074/1067 604/1075/1068
f 574/1032/1025 604/1075/1068 605/1076/1069
f 605/1076/1069 606/1077/1070 574/1032/1025
f 574/1032/1025 606/1077/1070 607/1078/1071
f 574/1032/1025 607/1078/1071 608/1079/1072
f 608/1079/1072 609/1080/1073 574/1032/1025
f 574/1032/1025 609/1080/1073 610/1081/1074
f 574/1032/1025 610/1081/1074 611/1033/1026
f 613/1036/1029 614/1082/1075 573/1034/1027
f 573/1034/1027 614/1082/1075 615/1083/1076
f 573/1034/1027 615/1083/1076 616/1084/1077
f 616/1084/1077 617/1085/1078 573/1034/1027
f 573/1034/1027 617/1085/1078 618/1086/1079
f 573/1034/1027 618/1086/1079 619/1087/1080
f 619/1087/1080 620/1053/1046 573/1034/1027
f 622/1055/1048 623/1088/1081 576/1049/1042
f 576/1049/1042 623/1088/1081 624/1089/1082
f 576/1049/1042 624/1089/1082 625/1090/1083
f 625/1090/1083 626/1091/1084 576/1049/1042
f 576/1049/1042 626/1091/1084 627/1092/1085
f 576/1049/1042 627/1092/1085 628/1093/1086
f 628/1093/1086 629/1050/1043 576/1049/1042
f 631/1052/1045 632/1094/1087 575/1045/1038
f 575/1045/1038 632/1094/1087 633/1095/1088
f 575/1045/1038 633/1095/1088 634/1056/1049
f 246/1096/1089 574/1097/1090 247/1098/1091
f 247/1098/1091 574/1097/1090 569/1099/1092
f 11/1100/1093 5/1101/1094 35/1102/1095
f 35/1102/1095 5/1101/1094 4/1103/1096
f 35/1102/1095 4/1103/1096 3/1104/1097
f 3/1104/1097 2/1105/1098 35/1102/1095
f 35/1102/1095 2/1105/1098 67/1106/1099
f 35/1102/1095 67/1106/1099 66/1107/1100
f 2/1105/1098 1/1108/1101 67/1106/1099
f 66/1107/1100 65/1109/1102 35/1102/1095
f 35/1102/1095 65/1109/1102 36/1110/1103
f 36/1110/1103 65/1109/1102 60/1111/1104
f 36/1110/1103 60/1111/1104 41/1112/1105
f 41/1112/1105 60/1111/1104 59/1113/1106
f 41/1112/1105 59/1113/1106 42/1114/1107
f 42/1114/1107 59/1113/1106 43/1115/1108
f 43/1115/1108 59/1113/1106 58/1116/1109
f 43/1115/1108 58/1116/1109 44/1117/1110
f 44/1117/1110 58/1116/1109 57/1118/1111
f 44/1117/1110 57/1118/1111 49/1119/1112
f 49/1119/1112 57/1118/1111 51/1120/1113
f 49/1119/1112 51/1120/1113 50/1121/1114
f 57/1118/1111 52/1122/1115 51/1120/1113
f 34/1123/1116 19/1124/1117 35/1102/1095
f 35/1102/1095 19/1124/1117 14/1125/1118
f 35/1102/1095 14/1125/1118 13/1126/1119
f 19/1124/1117 34/1123/1116 20/1127/1120
f 20/1127/1120 34/1123/1116 33/1128/1121
f 20/1127/1120 33/1128/1121 21/1129/1122
f 21/1129/1122 33/1128/1121 31/1130/1123
f 21/1129/1122 31/1130/1123 22/1131/1124
f 22/1131/1124 31/1130/1123 29/1132/1125
f 22/1131/1124 29/1132/1125 27/1133/1126
f 13/1126/1119 12/1134/1127 35/1102/1095
f 35/1102/1095 12/1134/1127 11/1100/1093
f 575/1135/1128 245/1136/1129 572/1137/1130
f 572/1137/1130 245/1136/1129 248/1138/1131
f 576/1139/1132 575/1140/1133 571/1141/1134
f 571/1141/1134 575/1140/1133 572/1142/1135
f 573/1143/1136 576/1144/1137 570/1145/1138
f 570/1145/1138 576/1144/1137 571/1146/1139
f 574/1147/1140 573/1148/1141 569/1149/1142
f 569/1149/1142 573/1148/1141 570/1150/1143
f 287/1151/1144 286/1152/1145 301/1153/1146
f 301/1153/1146 286/1152/1145 322/1154/1147
f 301/1153/1146 322/1154/1147 321/1155/1148
f 321/1155/1148 320/1156/1149 301/1153/1146
f 301/1153/1146 320/1156/1149 319/1157/1150
f 301/1153/1146 319/1157/1150 318/1158/1151
f 318/1158/1151 317/1159/1152 301/1153/1146
f 301/1153/1146 317/1159/1152 316/1160/1153
f 301/1153/1146 316/1160/1153 315/1161/1154
f 315/1161/1154 314/1162/1155 301/1153/1146
f 301/1153/1146 314/1162/1155 313/1163/1156
f 301/1153/1146 313/1163/1156 312/1164/1157
f 312/1164/1157 311/1165/1158 301/1153/1146
f 301/1153/1146 311/1165/1158 310/1166/1159
f 301/1153/1146 310/1166/1159 309/1167/1160
f 309/1167/1160 308/1168/1161 301/1153/1146
f 301/1153/1146 308/1168/1161 302/1169/1162
f 302/1169/1162 308/1168/1161 307/1170/1163
f 302/1169/1162 307/1170/1163 303/1171/1164
f 303/1171/1164 307/1170/1163 306/1172/1165
f 303/1171/1164 306/1172/1165 304/1173/1166
f 304/1173/1166 306/1172/1165 305/1174/1167
f 300/1175/1168 290/1176/1169 301/1153/1146
f 301/1153/1146 290/1176/1169 289/1177/1170
f 301/1153/1146 289/1177/1170 288/1178/1171
f 290/1176/1169 300/1175/1168 291/1179/1172
f 291/1179/1172 300/1175/1168 299/1180/1173
f 291/1179/1172 299/1180/1173 292/1181/1174
f 292/1181/1174 299/1180/1173 298/1182/1175
f 292/1181/1174 298/1182/1175 293/1183/1176
f 293/1183/1176 298/1182/1175 297/1184/1177
f 293/1183/1176 297/1184/1177 294/1185/1178
f 294/1185/1178 297/1184/1177 296/1186/1179
f 294/1185/1178 296/1186/1179 295/1187/1180
f 288/1178/1171 287/1151/1144 301/1153/1146
f 636/1188/1181 659/1189/1182 635/1190/1183
f 638/1191/1184 659/1192/1185 637/1193/1186
f 640/1194/1187 659/1195/1188 639/1196/1189
f 642/1197/1190 659/1198/1191 641/1199/1192
f 644/1200/1193 659/1201/1194 643/1202/1195
f 646/1203/1196 659/1204/1197 645/1205/1198
f 648/1206/1199 659/1207/1200 647/1208/1201
f 650/1209/1202 659/1210/1203 649/1211/1204
f 652/1212/1205 659/1213/1206 651/1214/1207
f 654/1215/1208 659/1216/1209 653/1217/1210
f 656/1218/1211 659/1219/1212 655/1220/1213
f 658/1221/1214 659/1222/1215 657/1223/1216
f 635/1224/1183 659/1225/1217 658/1221/1214
f 651/1214/1207 659/1226/1218 650/1209/1202
f 643/1202/1195 659/1227/1219 642/1197/1190
f 657/1223/1216 659/1228/1220 656/1218/1211
f 655/1220/1213 659/1229/1221 654/1215/1208
f 653/1217/1210 659/1230/1222 652/1212/1205
f 649/1211/1204 659/1231/1223 648/1206/1199
f 647/1208/1201 659/1232/1224 646/1203/1196
f 645/1205/1198 659/1233/1225 644/1200/1193
f 641/1199/1192 659/1234/1226 640/1194/1187
f 639/1196/1189 659/1235/1227 638/1191/1184
f 637/1193/1186 659/1236/1228 636/1188/1181
f 578/1237/1229 577/1238/1230 660/1239/1231
f 660/1240/1231 577/1241/1230 634/1242/1232
f 660/1240/1231 634/1242/1232 696/1243/1233
f 696/1243/1233 634/1242/1232 633/1244/1234
f 696/1243/1233 633/1244/1234 695/1245/1235
f 695/1245/1235 633/1244/1234 632/1246/1236
f 695/1245/1235 632/1246/1236 631/1247/1237
f 695/1245/1235 631/1247/1237 694/1248/1238
f 694/1248/1238 631/1247/1237 630/1249/1239
f 694/1248/1238 630/1249/1239 693/1250/1240
f 693/1250/1240 630/1249/1239 629/1251/1241
f 693/1250/1240 629/1251/1241 628/1252/1242
f 693/1250/1240 628/1252/1242 692/1253/1243
f 692/1253/1243 628/1252/1242 627/1254/1244
f 692/1253/1243 627/1254/1244 626/1255/1245
f 692/1253/1243 626/1255/1245 691/1256/1246
f 691/1256/1246 626/1255/1245 625/1257/1247
f 691/1256/1246 625/1257/1247 690/1258/1248
f 690/1258/1248 625/1257/1247 624/1259/1249
f 690/1258/1248 624/1259/1249 623/1260/1250
f 690/1258/1248 623/1260/1250 689/1261/1251
f 689/1261/1251 623/1260/1250 622/1262/1252
f 689/1261/1251 622/1262/1252 688/1263/1253
f 688/1263/1253 622/1262/1252 621/1264/1254
f 688/1263/1253 621/1264/1254 620/1265/1255
f 688/1263/1253 620/1265/1255 687/1266/1256
f 687/1266/1256 620/1265/1255 619/1267/1257
f 687/1266/1256 619/1267/1257 686/1268/1258
f 686/1268/1258 619/1267/1257 618/1269/1259
f 686/1268/1258 618/1269/1259 617/1270/1260
f 686/1268/1258 617/1270/1260 685/1271/1261
f 685/1271/1261 617/1270/1260 616/1272/1262
f 685/1271/1261 616/1272/1262 615/1273/1263
f 685/1271/1261 615/1273/1263 684/1274/1264
f 684/1274/1264 615/1273/1263 614/1275/1265
f 684/1274/1264 614/1275/1265 683/1276/1266
f 683/1276/1266 614/1275/1265 613/1277/1267
f 683/1276/1266 613/1277/1267 612/1278/1268
f 683/1276/1266 612/1278/1268 682/1279/1269
f 682/1279/1269 612/1278/1268 611/1280/1270
f 682/1279/1269 611/1280/1270 681/1281/1271
f 681/1281/1271 611/1280/1270 610/1282/1272
f 681/1281/1271 610/1282/1272 609/1283/1273
f 681/1281/1271 609/1283/1273 680/1284/1274
f 680/1284/1274 609/1283/1273 608/1285/1275
f 680/1284/1274 608/1285/1275 679/1286/1276
f 679/1286/1276 608/1285/1275 607/1287/1277
f 679/1286/1276 607/1287/1277 606/1288/1278
f 679/1286/1276 606/1288/1278 678/1289/1279
f 678/1289/1279 606/1288/1278 605/1290/1280
f 678/1289/1279 605/1290/1280 604/1291/1281
f 678/1289/1279 604/1291/1281 677/1292/1282
f 677/1292/1282 604/1291/1281 603/1293/1283
f 677/1292/1282 603/1293/1283 676/1294/1284
f 676/1294/1284 603/1293/1283 602/1295/1285
f 676/1294/1284 602/1295/1285 601/1296/1286
f 676/1294/1284 601/1296/1286 675/1297/1287
f 675/1297/1287 601/1296/1286 600/1298/1288
f 675/1297/1287 600/1298/1288 674/1299/1289
f 674/1299/1289 600/1298/1288 599/1300/1290
f 674/1299/1289 599/1300/1290 598/1301/1291
f 674/1299/1289 598/1301/1291 673/1302/1292
f 673/1302/1292 598/1301/1291 597/1303/1293
f 673/1302/1292 597/1303/1293 672/1304/1294
f 672/1304/1294 597/1303/1293 596/1305/1295
f 672/1304/1294 596/1305/1295 595/1306/1296
f 672/1304/1294 595/1306/1296 671/1307/1297
f 671/1307/1297 595/1306/1296 594/1308/1298
f 671/1307/1297 594/1308/1298 593/1309/1299
f 671/1307/1297 593/1309/1299 670/1310/1300
f 670/1310/1300 593/1309/1299 592/1311/1301
f 670/1310/1300 592/1311/1301 669/1312/1302
f 669/1312/1302 592/1311/1301 591/1313/1303
f 669/1312/1302 591/1313/1303 590/1314/1304
f 669/1312/1302 590/1314/1304 668/1315/1305
f 668/1315/1305 590/1314/1304 589/1316/1306
f 668/1315/1305 589/1316/1306 667/1317/1307
f 667/1317/1307 589/1316/1306 588/1318/1308
f 667/1317/1307 588/1318/1308 587/1319/1309
f 667/1317/1307 587/1319/1309 666/1320/1310
f 666/1320/1310 587/1319/1309 586/1321/1311
f 666/1320/1310 586/1321/1311 665/1322/1312
f 665/1322/1312 586/1321/1311 585/1323/1313
f 665/1322/1312 585/1323/1313 584/1324/1314
f 665/1322/1312 584/1324/1314 664/1325/1315
f 664/1325/1315 584/1324/1314 583/1326/1316
f 664/1325/1315 583/1326/1316 582/1327/1317
f 664/1325/1315 582/1327/1317 663/1328/1318
f 663/1328/1318 582/1327/1317 581/1329/1319
f 663/1328/1318 581/1329/1319 662/1330/1320
f 662/1330/1320 581/1329/1319 580/1331/1321
f 662/1330/1320 580/1331/1321 579/1332/1322
f 662/1330/1320 579/1332/1322 661/1333/1323
f 661/1333/1323 579/1332/1322 578/1237/1229
f 661/1333/1323 578/1237/1229 660/1239/1231
f 658/1334/1324 661/1335/1325 635/1336/1326
f 635/1336/1326 661/1335/1325 660/1337/1327
f 635/1336/1326 660/1337/1327 696/1338/1328
f 661/1335/1325 658/1334/1324 662/1339/1329
f 662/1339/1329 658/1334/1324 657/1340/1330
f 662/1339/1329 657/1340/1330 663/1341/1331
f 663/1341/1331 657/1340/1330 664/1342/1332
f 664/1342/1332 657/1340/1330 656/1343/1333
f 664/1342/1332 656/1343/1333 665/1344/1334
f 665/1344/1334 656/1343/1333 655/1345/1335
f 665/1344/1334 655/1345/1335 666/1346/1336
f 666/1346/1336 655/1345/1335 667/1347/1337
f 667/1347/1337 655/1345/1335 654/1348/1338
f 667/1347/1337 654/1348/1338 668/1349/1339
f 668/1349/1339 654/1348/1338 653/1350/1340
f 668/1349/1339 653/1350/1340 669/1351/1341
f 669/1351/1341 653/1350/1340 670/1352/1342
f 670/1352/1342 653/1350/1340 652/1353/1343
f 670/1352/1342 652/1353/1343 671/1354/1344
f 671/1354/1344 652/1353/1343 672/1355/1345
f 672/1355/1345 652/1353/1343 651/1356/1346
f 672/1355/1345 651/1356/1346 673/1357/1347
f 673/1357/1347 651/1356/1346 650/1358/1348
f 673/1357/1347 650/1358/1348 674/1359/1349
f 674/1359/1349 650/1358/1348 675/1360/1350
f 675/1360/1350 650/1358/1348 649/1361/1351
f 675/1360/1350 649/1361/1351 676/1362/1352
f 676/1362/1352 649/1361/1351 648/1363/1353
f 676/1362/1352 648/1363/1353 677/1364/1354
f 677/1364/1354 648/1363/1353 678/1365/1355
f 678/1365/1355 648/1363/1353 647/1366/1356
f 678/1365/1355 647/1366/1356 679/1367/1357
f 679/1367/1357 647/1366/1356 646/1368/1358
f 679/1367/1357 646/1368/1358 680/1369/1359
f 680/1369/1359 646/1368/1358 681/1370/1360
f 681/1370/1360 646/1368/1358 645/1371/1361
f 681/1370/1360 645/1371/1361 682/1372/1362
f 682/1372/1362 645/1371/1361 644/1373/1363
f 682/1372/1362 644/1373/1363 683/1374/1364
f 683/1374/1364 644/1373/1363 684/1375/1365
f 684/1375/1365 644/1373/1363 643/1376/1366
f 684/1375/1365 643/1376/1366 685/1377/1367
f 685/1377/1367 643/1376/1366 642/1378/1368
f 685/1377/1367 642/1378/1368 686/1379/1369
f 686/1379/1369 642/1378/1368 687/1380/1370
f 687/1380/1370 642/1378/1368 641/1381/1371
f 687/1380/1370 641/1381/1371 688/1382/1372
f 688/1382/1372 641/1381/1371 689/1383/1373
f 689/1383/1373 641/1381/1371 640/1384/1374
f 689/1383/1373 640/1384/1374 690/1385/1375
f 690/1385/1375 640/1384/1374 639/1386/1376
f 690/1385/1375 639/1386/1376 691/1387/1377
f 691/1387/1377 639/1386/1376 692/1388/1378
f 692/1388/1378 639/1386/1376 638/1389/1379
f 692/1388/1378 638/1389/1379 693/1390/1380
f 693/1390/1380 638/1389/1379 637/1391/1381
f 693/1390/1380 637/1391/1381 694/1392/1382
f 694/1392/1382 637/1391/1381 695/1393/1383
f 695/1393/1383 637/1391/1381 636/1394/1384
f 695/1393/1383 636/1394/1384 696/1338/1328
f 696/1338/1328 636/1394/1384 635/1336/1326
# 696 vertices
# 1394 texture params
# 1384 normals
# 1388 facets

# 1 groups
`,this.scene,void 0,void 0,void 0,".obj"),this.hqNozzle&&(this.toolCursorMesh=this.scene.getMeshByName("JRNozzle"),this.toolCursorMesh.parent=this.toolCursor,this.gcodeProcessor.zBelt?this.toolCursorMesh.rotate(ni.X,Math.PI/2-45*Math.PI/180,zi.LOCAL):this.toolCursorMesh.rotate(ni.X,Math.PI/2-Math.PI/180,zi.LOCAL),this.toolCursorMesh.rotate(ni.Y,Math.PI,zi.LOCAL),this.toolCursorMesh.rotate(ni.Z,Math.PI,zi.LOCAL),this.toolCursorMesh.scaling=new y(-1,1,1)),this.toolCursorMesh.isVisible=this.toolCursorVisible,this.toolCursorMesh.renderingGroupId=2,this.registerClipIgnore(this.toolCursorMesh);var r=new ee("nozzleMaterial",this.scene);this.toolCursorMesh.material=r,r.diffuseColor=new fe(1,.766,.336)}}},{key:"updateRenderQuality",value:function(r){this.renderQuality=r,localStorage&&localStorage.setItem("renderQuality",r)}},{key:"registerClipIgnore",value:function(r){var a=this;r!=null&&(r.onBeforeRenderObservable.add(()=>{a.scene.clipPlane=null,a.scene.clipPlane2=null}),r.onAfterRenderObservable.add(()=>{a.scene.clipPlane=new _i(0,1,0,a.zTopClipValue),a.scene.clipPlane2=new _i(0,-1,0,a.zBottomClipValue)}))}},{key:"updateCameraInertiaProperties",value:function(){this.cameraInertia?(this.orbitCamera.speed=2,this.orbitCamera.inertia=.9,this.orbitCamera.panningInertia=.9,this.orbitCamera.inputs.attached.keyboard.angularSpeed=.005,this.orbitCamera.inputs.attached.keyboard.zoomingSensibility=2,this.orbitCamera.inputs.attached.keyboard.panningSensibility=2,this.orbitCamera.angularSensibilityX=1e3,this.orbitCamera.angularSensibilityY=1e3,this.orbitCamera.panningSensibility=10,this.orbitCamera.wheelPrecision=1):(this.orbitCamera.speed=500,this.orbitCamera.inertia=0,this.orbitCamera.panningInertia=0,this.orbitCamera.inputs.attached.keyboard.angularSpeed=.05,this.orbitCamera.inputs.attached.keyboard.zoomingSensibility=.5,this.orbitCamera.inputs.attached.keyboard.panningSensibility=.5,this.orbitCamera.angularSensibilityX=200,this.orbitCamera.angularSensibilityY=200,this.orbitCamera.panningSensibility=2,this.orbitCamera.wheelPrecision=.25)}},{key:"setCameraInertia",value:function(r){this.cameraInertia=r,localStorage.setItem("cameraInertia",r),this.updateCameraInertiaProperties()}},{key:"forceRender",value:function(){this.scene&&this.scene.render(!0)}},{key:"getLayers",value:function(){return this.gcodeProcessor.layerDictionary}},{key:"getGCodeLine",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:5;try{var a=Math.max(0,this.gcodeProcessor.currentLineNumber-r),o=Math.min(this.gcodeProcessor.currentLineNumber,this.fileDataArray.length-1);return this.fileDataArray.slice(a,o).join(`\r
`).trim()}catch{return""}}},{key:"getGCodeLineNumber",value:function(){return this.gcodeProcessor.currentLineNumber}},{key:"goToGCodeLine",value:function(r){}},{key:"simulateToolPosition",value:function(){this.updateToolPosition(this.gcodeProcessor.nozzlePosition)}},{key:"setZBelt",value:function(r,a){this.gcodeProcessor.zBelt=r,r&&(this.gcodeProcessor.setZBeltAngle(a),this.toolCursorMesh.rotate(ni.X,Math.PI/2-a*Math.PI/180,zi.LOCAL))}},{key:"setWorkplaceVisiblity",value:function(r){this.workplace.visible=r,this.workplace.setOffsets(this.gcodeProcessor.workplaceOffsets),this.workplace.render(),this.scene.render()}},{key:"startSimulation",value:function(){this.gcodeProcessor.lastFilePositionIndex>=this.gcodeProcessor.renderedLines.length-1&&this.gcodeProcessor.updateFilePositionIndex(1),this.simulation=!0,this.gcodeProcessor.doUpdate()}},{key:"stopSimulation",value:function(){this.simulation=!1,this.simulationStopped()}},{key:"clamp",value:function(r,a,o){return Math.min(Math.max(r,a),o)}},{key:"runSimulation",value:function(){if(this.gcodeProcessor.renderedLines.length!==0){if(this.gcodeProcessor.lastFilePositionIndex>=this.gcodeProcessor.renderedLines.length-1&&(this.simulation=!1,this.simulationStopped()),this.simulationCurrentLine!=this.gcodeProcessor.renderedLines[this.gcodeProcessor.lastFilePositionIndex]){this.simulationCurrentLine=this.gcodeProcessor.renderedLines[this.gcodeProcessor.lastFilePositionIndex],this.updateToolPosition(this.simulationCurrentLine.start),this.simulationLastUpdate=0;var r=this.isMMS?this.simulationCurrentLine.feedRate:this.simulationCurrentLine.feedRate/60;this.simulationTimeToMove=this.simulationCurrentLine.length()/r*1e3,this.simulationUpdatePosition(this.simulationCurrentLine.gcodeFilePosition)}this.simLine=this.simulationCurrentLine.start.clone(),this.simulationLastUpdate+=this.engine.getDeltaTime()*this.simulationMultiplier*this.scene.getAnimationRatio();var a=this.clamp(this.simulationLastUpdate/this.simulationTimeToMove,0,1);if(y.LerpToRef(this.simulationCurrentLine.start,this.simulationCurrentLine.end,a,this.simLine),this.updateToolPosition(this.simLine),this.simulationLastUpdate>=this.simulationTimeToMove||this.simulationTimeToMove==1/0||this.simulationTimeToMove==0){var o=this.simulationMultiplier>10?this.simulationMultiplier:1,l=this.scene.getAnimationRatio();l>3&&(o+=~~l),this.gcodeProcessor.updateFilePositionIndex(this.gcodeProcessor.lastFilePositionIndex+o)}}}},{key:"getCameraPosition",value:function(){return this.scene.cameras[0].position}},{key:"getCameraTarget",value:function(){return this.scene.cameras[0].target}},{key:"setCameraPosition",value:function(r,a,o){var l=Number(r),h=Number(a),u=Number(o);l!==NaN&&h!==NaN&&u!==NaN&&(this.scene.activeCamera.position=new y(Number(r),Number(o),Number(a)),this.forceRender())}},{key:"setCameraTarget",value:function(r,a,o){var l=Number(r),h=Number(a),u=Number(o);l!==NaN&&h!==NaN&&u!==NaN&&(this.scene.activeCamera.target=new y(Number(r),Number(o),Number(a)),this.forceRender())}},{key:"createScreenshot",value:(e=Vs(Ft().mark(function r(){var a,o,l,h,u=arguments;return Ft().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return a=u.length>0&&u[0]!==void 0?u[0]:1920,o=u.length>1&&u[1]!==void 0?u[1]:1080,l=this.scene.clearColor,this.scene.clearColor=new K(0,0,0,0),this.displayViewBox(!1),this.gcodeProcessor.forceRender(),this.gcodeProcessor.doUpdate(),this.scene.render(!0,!0),this.scene.onAfterRenderObservable.addOnce(()=>{}),c.next=13,u6.CreateScreenshotAsync(this.engine,this.scene.activeCamera,{width:a,height:o});case 13:return h=c.sent,this.scene.clearColor=l,c.abrupt("return",h);case 16:case"end":return c.stop()}},r,this)})),function(){return e.apply(this,arguments)})},{key:"displayViewBox",value:function(r){(function(a){tt.meshes.forEach(o=>{o.setEnabled(a)})})(r)}}]),n}();const WC=n=>n<1024?n+" B":n<1048576?(n/1024).toFixed(1)+" KB":(n/1048576).toFixed(1)+" MB",HC=n=>n||"Unknown file",KC=30*60*1e3,XC=({setSelectedView:n,selectedFilePath:e,sendMessage:t,showToast:i,refreshState:s})=>{const[r,a]=Ne.useState(!0),[o,l]=Ne.useState(KC),[h,u]=Ne.useState(null),[c,f]=Ne.useState(null),d=Ne.useRef(null),_=Ne.useRef(null),p=HC(e);Ne.useEffect(()=>{p&&(async()=>{try{try{const A=await t("server.files.metadata",{filename:p});console.log("File metadata:",A),A&&A.estimated_time&&l(A.estimated_time*1e3),A&&A.size&&u(WC(A.size))}catch(A){console.error("Error fetching metadata:",A)}const T=await(await fetch(`/server/files/gcodes/${p}`,{method:"GET"})).text();f(T)}catch(v){console.error("Error fetching file details:",v)}})()},[p,t]),Ne.useEffect(()=>{if(d.current&&c){const m=d.current,v=document.createElement("canvas");v.className="w-full h-full",m.appendChild(v);const T=new zC(v);_.current=T;const A=async()=>{try{await T.init(),T.gcodeProcessor.asyncMode=!0,T.updateRenderQuality(4),T.setBackgroundColor("#0F0F0F"),T.bed.setBedColor("#ffffff"),T.setCursorVisiblity(!1),T.setZClipPlane(1e6,-1e6),T.bed.isDelta=!0,T.bed.buildVolume.x.min=0,T.bed.buildVolume.y.min=0,T.bed.buildVolume.z.min=0,T.bed.buildVolume.x.max=150,T.bed.buildVolume.y.max=150,T.bed.buildVolume.z.max=250,T.gcodeProcessor.useSpecularColor(!1),T.gcodeProcessor.resetTools(),T.gcodeProcessor.addTool("#FF5722",.4),T.gcodeProcessor.setColorMode(0),await T.processFile(c),T.gcodeProcessor.updateFilePosition(T.fileSize)}catch(b){console.error("Error initializing GCode viewer:",b)}finally{a(!1)}};setTimeout(()=>A(),0)}},[c]),Ne.useEffect(()=>()=>{_.current&&(_.current=null,d.current&&(d.current.innerHTML=""))},[]);const g=async()=>{try{a(!0),await t("printer.print.start",{filename:p}),i(`Print started: ${p}`),s()}catch(m){console.error("Error starting print:",m),i(`Failed to start print: ${m.message}`),a(!1)}};return J.jsxs(Ra,{children:[J.jsx(ph,{title:"Preview",showBack:!0,onBack:()=>n("home")}),J.jsxs("div",{className:"flex flex-col p-4 h-full",children:[J.jsxs("div",{className:"w-full aspect-square rounded-lg mb-2 relative",children:[r&&J.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-opacity-75 rounded-lg",children:J.jsx("div",{className:"animate-spin h-8 w-8 border-4 border-t-transparent border-[var(--text-color)] rounded-full"})}),J.jsx("div",{className:"w-full h-full rounded-lg absolute overflow-hidden",ref:d})]}),J.jsxs("div",{className:"text-lg mb-1",children:[p,J.jsx("div",{className:"text-sm",children:h})]}),J.jsxs("div",{className:"flex items-center justify-center mb-2 gap-2",children:[J.jsx(Y2,{className:"w-5 h-5"}),J.jsx("div",{className:"text-2xl font-medium",children:yT(o)})]}),J.jsx("button",{onClick:g,disabled:r,className:"mt-auto w-full rounded-lg py-3 flex items-center justify-center gap-2",children:r?J.jsxs(J.Fragment,{children:[J.jsx("div",{className:"animate-spin h-5 w-5 border-2 border-t-transparent border-[var(--text-color)] rounded-full"}),"Preparing..."]}):J.jsxs(J.Fragment,{children:[J.jsx(cT,{className:"w-5 h-5"}),"Print"]})})]})]})},YC="/assets/3dprinting-DF2X7oPd.gif",jC=({gif:n,isPaused:e,filename:t})=>J.jsxs("div",{className:"mb-6",children:[J.jsx("div",{className:"w-full aspect-square rounded-lg mb-2",children:J.jsx("img",{src:n,alt:"Print Livestream",className:"w-full h-full object-cover rounded-lg",style:{animationPlayState:e?"paused":"running"}})}),J.jsx("div",{className:"text-lg",children:t||"Unknown File"})]}),qC=({isPaused:n,onPauseResume:e,onStop:t,isPending:i})=>J.jsxs("div",{className:"flex gap-4 mt-4",children:[J.jsx("button",{onClick:e,className:`flex-1 rounded-lg py-3 flex items-center justify-center ${i?"opacity-50 cursor-not-allowed":""}`,disabled:i,children:n?J.jsx(uT,{className:"w-5 h-5"}):J.jsx(hT,{className:"w-5 h-5"})}),J.jsx("button",{onClick:t,className:`flex-1 bg-red-500 text-white rounded-lg py-3 flex items-center justify-center ${i?"opacity-50 cursor-not-allowed":"active:bg-red-600"}`,disabled:i,children:J.jsx(dT,{className:"w-5 h-5"})})]}),$C=({progress:n,remainingTime:e})=>J.jsxs("div",{className:"mt-6",children:[J.jsx("div",{style:{backgroundColor:"var(--button-background)"},className:"w-full rounded-full h-2",children:J.jsx("div",{className:"bg-blue-500 rounded-full h-2 transition-all duration-300 ease-linear",style:{width:`${n}%`}})}),J.jsxs("div",{className:"text-right text-sm mt-1",children:[e," remaining"]})]}),ZC=({onCancel:n,onStop:e})=>J.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4",children:J.jsx("div",{style:{backgroundColor:"var(--background-color)"},className:"bg-background-color rounded-lg p-6 max-w-sm w-full",children:J.jsxs("div",{className:"flex gap-4",children:[J.jsx("button",{onClick:n,className:"flex-1 py-2 rounded-lg",children:"Cancel"}),J.jsx("button",{onClick:e,className:"flex-1 py-2 bg-red-500 rounded-lg",children:"STOP PRINT"})]})})}),QC=({setSelectedView:n,printerState:e,sendMessage:t,refreshState:i})=>{const[s,r]=Ne.useState(!1),[a,o]=Ne.useState(null),l=e.printStatus==="paused",h=a!==null,u=()=>{if(!e.estimatedTime)return 0;const _=e.elapsedTime/e.estimatedTime*100;return Math.min(Math.max(_,0),100)},c=()=>{if(!e.estimatedTime)return"Calculating...";const _=Math.max(0,e.estimatedTime-e.elapsedTime),p=Math.floor(_/60),g=Math.floor(_%60);return`${p}m ${g}s`},f=async()=>{try{l?(o("resuming"),await t("printer.print.resume",{})):(o("pausing"),await t("printer.print.pause",{})),await i(),setTimeout(()=>o(null),1e3)}catch(_){console.error("Error toggling pause/resume:",_),o(null)}},d=async()=>{try{o("stopping"),await t("printer.print.cancel",{}),r(!1),await i(),o(null)}catch(_){console.error("Error stopping print:",_),o(null)}};return J.jsxs(Ra,{children:[J.jsx(ph,{title:a?a.charAt(0).toUpperCase()+a.slice(1):e.printStatus.charAt(0).toUpperCase()+e.printStatus.slice(1),onBack:()=>n("home")}),J.jsxs("div",{className:"flex-1 flex flex-col p-4",children:[J.jsx(jC,{gif:YC,isPaused:l,filename:e.filename}),J.jsx(qC,{isPaused:l,onPauseResume:f,onStop:()=>r(!0),isPending:h}),J.jsx($C,{progress:u(),remainingTime:c()})]}),s&&J.jsx(ZC,{onCancel:()=>r(!1),onStop:d,disabled:h})]})},Du={formatFileSize:n=>n<1024?`${n} B`:n<1048576?`${(n/1024).toFixed(1)} KB`:`${(n/1048576).toFixed(1)} MB`,getFilename:n=>n.split("/").pop()||n,formatDate:n=>new Date(n*1e3).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})},JC=({setSelectedView:n,currentFiles:e,setSelectedFilePath:t})=>{const i=[...e].sort((o,l)=>l.modified-o.modified),s=o=>{t(o.path),n("prepare")},r=({file:o})=>J.jsx("button",{onClick:()=>s(o),className:"w-full flex items-center p-4 mb-2 rounded-lg transition-colors",children:J.jsxs("div",{className:"flex-1 text-left overflow-hidden",children:[J.jsx("div",{className:"font-medium truncate max-w-full",children:Du.getFilename(o.path)}),J.jsxs("div",{className:"text-sm flex items-center gap-4 mt-1",children:[J.jsxs("span",{className:"flex items-center gap-1",children:[J.jsx(aT,{className:"w-4 h-4"}),Du.formatDate(o.modified)]}),J.jsxs("span",{className:"flex items-center gap-1",children:[J.jsx(Y2,{className:"w-4 h-4"}),Du.formatFileSize(o.size)]})]})]})}),a=()=>J.jsxs("div",{className:"flex flex-col items-center justify-center h-full",children:[J.jsx(oT,{className:"w-12 h-12 mb-2"}),J.jsx("p",{children:"No print files found"})]});return J.jsxs(Ra,{children:[J.jsx(ph,{title:"File History",showBack:!0,onBack:()=>n("home")}),J.jsx("div",{className:"flex-1 flex flex-col p-4 overflow-auto",children:i&&i.length>0?i.map((o,l)=>J.jsx(r,{file:o},`${o.path}-${l}`)):J.jsx(a,{})})]})},e5=({printerState:n,klippyState:e,setSelectedView:t,showToast:i,sendMessage:s,socket:r})=>{var o;const a=async()=>{await s("printer.firmware_restart")};return J.jsxs(Ra,{className:"flex flex-col items-center justify-center p-6 gap-6",children:[J.jsx(ph,{title:"Settings",showBack:!0,onBack:()=>t("home")}),J.jsx("div",{className:"flex items-center justify-center mt-4 mb-4",children:J.jsx("span",{className:`text-sm font-medium ${e==="ready"?"text-green-500":"text-red-500"}`,children:((o=e[0])==null?void 0:o.toUpperCase())+(e==null?void 0:e.slice(1))})}),J.jsx("button",{onClick:a,className:"flex items-center justify-center gap-2 rounded-lg px-6 py-3 transition-colors mb-4",children:"Restart Firmware"})]})},t5=({message:n})=>J.jsx("div",{className:`
      fixed top-4 left-1/2 transform -translate-x-1/2 
      bg-gray-800 text-white px-4 py-2 rounded-lg
      transition-opacity duration-300 
      ${n?"opacity-100":"opacity-0 pointer-events-none"}
    `,children:n}),i5=5e3,s5=1e4,n5=n=>{const[e,t]=Ne.useState(null),[i,s]=Ne.useState(null),r=Ne.useRef(new Map),a=Ne.useRef(1),o=u=>{r.current.forEach(({reject:c})=>{c(u||new Error("Connection closed"))}),r.current.clear()},l=Ne.useCallback(()=>{try{const c=`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/websocket`;console.log("Connecting to Moonraker:",c);const f=new WebSocket(c);f.onopen=()=>{console.log("WebSocket connected"),t(f),s(null)},f.onmessage=d=>{try{const _=JSON.parse(d.data);if(_.method==="notify_proc_stat_update")return;if(console.log("Received:",_),n(_),_.id){const p=r.current.get(_.id);if(p){const{resolve:g,reject:m,timeoutId:v}=p;clearTimeout(v),_.error?m(new Error(_.error.message||"Unknown error")):g(_.result),r.current.delete(_.id)}}}catch(_){console.error("Error processing message:",_)}},f.onclose=d=>{console.log("WebSocket closed:",d.code),t(null),o(new Error(`Connection closed: ${d.reason||"Unknown reason"}`)),setTimeout(()=>l(),i5)},f.onerror=d=>{console.error("WebSocket error:",d),s(d.message||"Connection error")}}catch(u){console.error("Failed to establish connection:",u),s(u.message)}},[]),h=Ne.useCallback((u,c={})=>!e||e.readyState!==WebSocket.OPEN?Promise.reject(new Error("WebSocket not connected")):new Promise((f,d)=>{const _=a.current++,p={jsonrpc:"2.0",method:u,params:c,id:_},g=setTimeout(()=>{r.current.has(_)&&(r.current.delete(_),d(new Error(`Request timeout: ${u}`)))},s5);r.current.set(_,{resolve:f,reject:d,timeoutId:g});try{e.send(JSON.stringify(p)),console.log("Sent:",p)}catch(m){clearTimeout(g),r.current.delete(_),d(m)}}),[e]);return Ne.useEffect(()=>(l(),()=>{e&&(e.close(),o())}),[]),{sendMessage:h,socket:e,error:i}},r5=(n,e)=>{const[t,i]=Ne.useState({printStatus:null,filename:null,elapsedTime:0,estimatedTime:0}),[s,r]=Ne.useState("Loading"),a=Ne.useCallback(h=>{i(u=>({...u,...h}))},[i]),o=Ne.useCallback(async()=>{try{const h=await e("server.info",{}),u=await e("printer.objects.query",{objects:{print_stats:null}});if(r(h.klippy_state),a({printStatus:u.status.print_stats.state,filename:u.status.print_stats.filename}),u.status.print_stats.state==="printing"||u.status.print_stats.state==="paused"){const c=await e("server.files.metadata",{filename:u.status.print_stats.filename});a({estimatedTime:c.estimated_time||0,elapsedTime:u.status.print_stats.print_duration})}}catch(h){console.error("Error refreshing printer state:",h)}},[e]),l=Ne.useCallback(h=>{var u;if((u=h.method)!=null&&u.startsWith("notify_klippy_")){const c=h.method.split("_").pop();r(c)}else if(h.method==="notify_status_update"){const c=h.params[0];c.print_stats&&a({printStatus:c.print_stats.state,filename:c.print_stats.filename,elapsedTime:c.print_stats.print_duration})}else if(h.method==="notify_gcode_response"){const c=h.params[0];(c.includes("// PAUSE called with")||c.includes("// RESUME called with")||c.includes("File opened:"))&&o()}else if(h.method==="notify_history_changed"){const c=h.params[0];c.action==="started"?o():c.action==="finished"&&a({printStatus:"idle",filename:null,elapsedTime:0,estimatedTime:0})}},[a,o]);return Ne.useEffect(()=>{if(!n){console.warn("Cannot initialize printer, socket not open");return}o()},[n]),Ne.useEffect(()=>{console.log("printer state updated",t)},[t]),{printerState:t,klippyState:s,processWebSocketUpdate:l,refreshState:o}},a5=()=>{const[n,e]=Ne.useState("home"),[t,i]=Ne.useState(null),s=Ne.useRef(()=>{}),{sendMessage:r,socket:a}=n5(g=>s.current(g)),{printerState:o,klippyState:l,processWebSocketUpdate:h,refreshState:u}=r5(a,r);Ne.useEffect(()=>{s.current=h},[h]);const[c,f]=Ne.useState([]),[d,_]=Ne.useState(null),p=g=>{i(g),setTimeout(()=>i(null),3e3)};return Ne.useEffect(()=>{l=="ready"&&(o.printStatus==="printing"||o.printStatus==="paused")?e("printing"):e("home")},[l,o.printStatus]),Ne.useEffect(()=>{u()},[]),J.jsxs("div",{className:"h-screen flex flex-col bg-inherit overflow-x-hidden",children:[n==="home"&&J.jsx(vT,{printerState:o,klippyState:l,setSelectedView:e,showToast:p,selectedFilePath:d,setSelectedFilePath:_,currentFiles:c,setCurrentFiles:f,sendMessage:r,socket:a}),n==="settings"&&J.jsx(e5,{printerState:o,klippyState:l,setSelectedView:e,showToast:p,sendMessage:r,socket:a}),n==="prepare"&&J.jsx(XC,{setSelectedView:e,selectedFilePath:d,sendMessage:r,showToast:p,refreshState:u}),n==="printing"&&J.jsx(QC,{setSelectedView:e,printerState:o,sendMessage:r,refreshState:u}),n==="history"&&J.jsx(JC,{setSelectedView:e,currentFiles:c,setSelectedFilePath:_}),J.jsx(t5,{message:t})]})};function o5(){return J.jsx(a5,{})}X2(document.getElementById("root")).render(J.jsx(Ne.StrictMode,{children:J.jsx(o5,{})}));export{re as A,ot as B,lt as C,vA as F,gt as I,od as L,pt as P,nd as R,ye as S,l5 as T,y as V,n4 as _,U as a,Nl as b,fe as c,Ko as d,c4 as e,Bl as f,Z as g,ie as h,gv as i,De as j};
