"use strict";"undefined"==typeof self&&(this.self=this),function(){self.module||(self.module={exports:{}});let e=Date.now(),n=()=>((Date.now()-e)/1e3).toFixed(2).padStart(9,0),c=self.dbug=self.dbug||{level:1,set:e=>{0<=e&&(c.level=Math.min(e,3))},debug:function(){if(c.level<=0)return console.log(n(),"[DBG]",...arguments)},log:function(){if(c.level<=1)return console.log(n(),"|",...arguments)},warn:function(){if(c.level<=2)return console.log(n(),"[WRN]",...arguments)},error:function(){if(c.level<=3)return console.trace(n(),"[ERR]",...arguments)},since:n};self.noop=()=>{};let t=self.gapp=self.gapp||{},s=[];function u(e){return{funcs:e.filter(e=>"function"==typeof e),arrays:e.filter(e=>Array.isArray(e)),strings:e.filter(e=>"string"==typeof e),objects:e.filter(e=>"object"==typeof e&&!Array.isArray(e))}}function a(e,n){return function(){try{return e(...arguments)}catch(e){e.stack?console.log(`[${n}]`,e.stack):console.log({register_fail:n,error:e})}}}t.overlay=Object.assign,t.register=function(){var e=u([...arguments]),n=e.objects||{},t=n.name||n.module||e.strings[0],r,o={fn:n.exec||e.funcs[0],name:t};s.push(o)},t.main=function(){var e=u([...arguments]),n=e.objects[0]||{},t=n.app||e.strings[0];const r=n.post||e.funcs[0],o=n.pre||e.funcs[1];var l=self,f;o&&o(l);for(f of s){let{fn:o,name:s}=f;if(s&&c.debug(t+" | load | "+s),o){let e=s.split("."),n=e.pop(),t=l;for(var i of e)t=t[i]||(c.debug({creating_root:i,for:s}),t[i]={});let r=t[n]||{};a(o,s)(l,e=>{if(e)return t[n]=Object.assign(r,e)})}else c.debug(`${t} | ${f.name} | missing fn()`)}s=null,r&&r(l)}}();"use strict";gapp.register("add.array",[],(t,r)=>{let n={};for(var e in n.flat||(n.flat=function(){try{return[].concat.apply([],this)}catch(t){let r=[];for(var n of this.slice())r.push(...n);return r}}),n.findWith=function(n){for(let t=0,r=this.length;t<r;t++)if(n(this[t]))return t;return-1},n.equals=function(r){if(!r)return!1;if(r.length!==this.length)return!1;for(let t=0;t<this.length;t++)if(r[t]!==this[t])return!1;return!0},n.peek=function(t=1){return this[this.length-t]},n.drop=function(t=0,r=0){for(;0<t--;)this.shift();for(;0<r--;)this.pop();return this},n.append=function(t,r){return r?this.appendAll(t):(this.push(t),this)},n.appendAll=function(n){if(n&&0<n.length)if(1e4<n.length)for(let t=0,r=n.length;t<r;t++)this.push(n[t]);else this.push(...n);return this},n.addOnce=function(t){return this.contains(t)||this.push(t),this},n.clone=function(){return this.map(t=>t.clone(...arguments))},n.xray=function(r){const n=[],e=this.length;for(let t=0;t<e;t++)n.push(this[t].xray(r));return n},n.xout=function(t,e){t&&console.log(`${t} [${this.length}]`),e=e||"  ",this.forEach((t,r)=>{var n;t.xout?t.xout(null,e+r+e):t.xray&&(n=t.xray(),console.log(e,n),Object.values(n).forEach(t=>{t.xout&&t.xout(null,e+e)}))})},n.remove=function(t){var r=this.indexOf(t);return 0<=r?this.splice(r,1):null},n.removeAll=function(n){for(let t=0,r=n.length;t<r;t++)this.remove(n[t])},n.last=function(){return 0===this.length?null:this[this.length-1]},n.contains=function(t){return 0<=this.indexOf(t)},n.toFloat32=function(){return new Float32Array(this)},n.toUint32=function(){return Uint32Array.from(this)},n.forEachPair=function(t,r){let n=this,e=0,i=r||2,o=n.length;for(;e<o;)t(n[e],n[(e+1)%o],e),e+=i},n.show=function(r,n){n=n||function(t){console.log(t)},this.forEach(function(t){n(t[r]())})},n.uniq=function(){return this.slice().sort().filter((t,r,n)=>!r||t!=n[r-1])},n.hasNaN=function(){return 0<this.filter(t=>isNaN(t)).length},n.group=function(e){let t=new Array(Math.ceil(this.length/e)),i=0;for(let n=0;n<this.length;n+=e){let r=new Array(e);for(let t=0;t<e;t++)r[t]=this[n+t];t[i++]=r}return t},Array.handle=function(i){return function(){let r=[...arguments],n=r.shift();if(Array.isArray(n)){let t=[];for(var e of n.slice())t.push(i(e,...r));return t}return i(n,...r)}},n)Object.defineProperty(Array.prototype,e,{value:n[e],enumerable:!1});Float32Array.prototype.toShared=function(){const t=new Float32Array(new SharedArrayBuffer(this.buffer.byteLength));return t.set(this),t},Float32Array.prototype.toFloat32=function(){return this},ArrayBuffer.prototype.textDecode=function(t="utf-8"){return new TextDecoder(t).decode(this)},String.prototype.reverse=function(){return this.split("").reverse().join("")},Object.clone=function(t){return t&&JSON.parse(JSON.stringify(t))},Object.toArray=function(t){let r=[];for(var[n,e]of Object.entries(t))r.push({key:n,value:e});return r},Math.bound=function(t,r,n){return Math.max(r,Math.min(n,t))},Number.prototype.round=function(t){if(0===t)return 0|this.valueOf();var r=Math.pow(10,t||3);return Math.round(this.valueOf()*r)/r}});"use strict";gapp.register("add.class",[],(t,s)=>{self.ArrayWriter=class i{constructor(){this.pos=0,this.array=[]}seek(t){var s=this.pos;return this.pos=t,s}skip(t){return this.writeBytes(new Array(t).fill(0),t),this.pos}writeU8(t){this.array[this.pos++]=255&t}writeU16(t){this.array[this.pos++]=t>>8&255,this.array[this.pos++]=255&t}writeU32(t){this.array[this.pos++]=t>>24&255,this.array[this.pos++]=t>>16&255,this.array[this.pos++]=t>>8&255,this.array[this.pos++]=255&t}writeBytes(t){this.array.appendAll(t),this.pos+=t.length}toBuffer(){return new Uint8ClampedArray(this.array).buffer}},self.DataWriter=class r{constructor(t,s){this.view=t,this.pos=s||0}skip(t){var s=this.pos;return this.pos+=t,s}writeU8(t){try{return this.view.setUint8(this.pos,t),this.skip(1)}catch(t){throw console.log({pos:this.pos,err:t}),t}}writeU16(t,s){return this.view.setUint16(this.pos,t,s),this.skip(2)}writeU32(t,s){return this.view.setUint32(this.pos,t,s),this.skip(4)}writeI32(t,s){return this.view.setInt32(this.pos,t,s),this.skip(4)}writeUB64(t,s){return this.view.setBigUint64(this.pos,t,s),this.skip(8)}writeB64(t,s){return this.view.setBigInt64(this.pos,t,s),this.skip(8)}writeF32(t,s){return this.view.setFloat32(this.pos,t,s),this.skip(4)}writeF64(t,s){return this.view.setFloat64(this.pos,t,s),this.skip(8)}},self.DataReader=class e{constructor(t,s){this.view=t,this.pos=s||0}skip(t){var s=this.pos;return this.pos+=t,s}readBytes(t){var s=this.view.buffer.slice(this.pos,this.pos+t);return this.pos+=t,s}readU8(){return this.view.getUint8(this.pos++)}readU16(t){var s=this.view.getUint16(this.pos,t);return this.pos+=2,s}readU32(t){var s=this.view.getUint32(this.pos,t);return this.pos+=4,s}readI32(t){var s=this.view.getInt32(this.pos,t);return this.pos+=4,s}readB64(t){var s=this.view.getBigInt64(this.pos,t);return this.pos+=8,s}readUB64(t){var s=this.view.getBigUint64(this.pos,t);return this.pos+=8,s}readF32(t){var s=this.view.getFloat32(this.pos,t);return this.pos+=4,s}readF64(t){var s=this.view.getFloat64(this.pos,t);return this.pos+=8,s}}});!function t(e,i){"object"==typeof exports&&"object"==typeof module?module.exports=i():"function"==typeof define&&define.amd?define([],i):"object"==typeof exports?exports.ThreeBundle=i():e.ThreeBundle=i()}(this,()=>(()=>{"use strict";var n={d:(t,e)=>{for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},t={};n.r(t),n.d(t,{BufferGeometryUtils:()=>r,Line2:()=>Z_,LineGeometry:()=>Y_,LineMaterial:()=>C_,LineSegments2:()=>q_,LineSegmentsGeometry:()=>A_,SVGLoader:()=>i,THREE:()=>e});var e={};n.r(e),n.d(e,{ACESFilmicToneMapping:()=>g,AddEquation:()=>Rt,AddOperation:()=>d,AdditiveAnimationBlendMode:()=>We,AdditiveBlending:()=>Tt,AgXToneMapping:()=>_,AlphaFormat:()=>B,AlwaysCompare:()=>Li,AlwaysDepth:()=>te,AlwaysStencilFunc:()=>wi,AmbientLight:()=>vv,AnimationAction:()=>u0,AnimationClip:()=>kg,AnimationLoader:()=>Jg,AnimationMixer:()=>p0,AnimationObjectGroup:()=>c0,AnimationUtils:()=>Ag,ArcCurve:()=>Em,ArrayCamera:()=>wd,ArrowHelper:()=>s_,AttachedBindMode:()=>x,Audio:()=>Wv,AudioAnalyser:()=>Jv,AudioContext:()=>Iv,AudioListener:()=>Hv,AudioLoader:()=>Lv,AxesHelper:()=>o_,BackSide:()=>Yt,BasicDepthPacking:()=>Ye,BasicShadowMap:()=>l,BatchedMesh:()=>Jp,Bone:()=>_p,BooleanKeyframeTrack:()=>Ug,Box2:()=>A0,Box3:()=>nr,Box3Helper:()=>e_,BoxGeometry:()=>fs,BoxHelper:()=>t_,BufferAttribute:()=>Ia,BufferGeometry:()=>Ya,BufferGeometryLoader:()=>wv,ByteType:()=>U,Cache:()=>Hg,Camera:()=>rh,CameraHelper:()=>K0,CanvasTexture:()=>bm,CapsuleGeometry:()=>tf,CatmullRomCurve3:()=>Lm,CineonToneMapping:()=>f,CircleGeometry:()=>ef,ClampToEdgeWrapping:()=>nt,Clock:()=>Bv,Color:()=>ya,ColorKeyframeTrack:()=>Ng,ColorManagement:()=>On,CompressedArrayTexture:()=>Mm,CompressedCubeTexture:()=>Sm,CompressedTexture:()=>xm,CompressedTextureLoader:()=>Kg,ConeGeometry:()=>rf,ConstantAlphaFactor:()=>Kt,ConstantColorFactor:()=>Xt,CubeCamera:()=>uh,CubeReflectionMapping:()=>b,CubeRefractionMapping:()=>w,CubeTexture:()=>dh,CubeTextureLoader:()=>Qg,CubeUVReflectionMapping:()=>_t,CubicBezierCurve:()=>Hm,CubicBezierCurve3:()=>Wm,CubicInterpolant:()=>Rg,CullFaceBack:()=>Mt,CullFaceFront:()=>St,CullFaceFrontBack:()=>o,CullFaceNone:()=>xt,Curve:()=>wm,CurvePath:()=>Km,CustomBlending:()=>Ct,CustomToneMapping:()=>v,CylinderGeometry:()=>nf,Cylindrical:()=>w0,Data3DTexture:()=>Kn,DataArrayTexture:()=>Zn,DataTexture:()=>yp,DataTextureLoader:()=>tv,DataUtils:()=>Ca,DecrementStencilOp:()=>pi,DecrementWrapStencilOp:()=>fi,DefaultLoadingManager:()=>Xg,DepthFormat:()=>dt,DepthStencilFormat:()=>pt,DepthTexture:()=>cc,DetachedBindMode:()=>M,DirectionalLight:()=>gv,DirectionalLightHelper:()=>Y0,DiscreteInterpolant:()=>Ig,DisplayP3ColorSpace:()=>ni,DodecahedronGeometry:()=>sf,DoubleSide:()=>Zt,DstAlphaFactor:()=>kt,DstColorFactor:()=>Gt,DynamicCopyUsage:()=>ki,DynamicDrawUsage:()=>Ni,DynamicReadUsage:()=>Bi,EdgesGeometry:()=>uf,EllipseCurve:()=>Tm,EqualCompare:()=>Ai,EqualDepth:()=>ne,EqualStencilFunc:()=>yi,EquirectangularReflectionMapping:()=>T,EquirectangularRefractionMapping:()=>C,Euler:()=>kr,EventDispatcher:()=>ji,ExtrudeGeometry:()=>Yf,FileLoader:()=>Zg,Float16BufferAttribute:()=>za,Float32BufferAttribute:()=>ka,FloatType:()=>ct,Fog:()=>Fd,FogExp2:()=>Bd,FramebufferTexture:()=>ym,FrontSide:()=>qt,Frustum:()=>xh,GLBufferAttribute:()=>_0,GLSL1:()=>Gi,GLSL3:()=>Hi,GreaterCompare:()=>Ri,GreaterDepth:()=>ae,GreaterEqualCompare:()=>Ii,GreaterEqualDepth:()=>re,GreaterEqualStencilFunc:()=>bi,GreaterStencilFunc:()=>Mi,GridHelper:()=>H0,Group:()=>Td,HalfFloatType:()=>de,HemisphereLight:()=>nv,HemisphereLightHelper:()=>G0,IcosahedronGeometry:()=>Kf,ImageBitmapLoader:()=>Rv,ImageLoader:()=>$g,ImageUtils:()=>kn,IncrementStencilOp:()=>di,IncrementWrapStencilOp:()=>mi,InstancedBufferAttribute:()=>bp,InstancedBufferGeometry:()=>bv,InstancedInterleavedBuffer:()=>v0,InstancedMesh:()=>Ip,Int16BufferAttribute:()=>Da,Int32BufferAttribute:()=>Ba,Int8BufferAttribute:()=>La,IntType:()=>D,InterleavedBuffer:()=>kd,InterleavedBufferAttribute:()=>Gd,Interpolant:()=>Cg,InterpolateDiscrete:()=>Be,InterpolateLinear:()=>Fe,InterpolateSmooth:()=>ze,InvertStencilOp:()=>gi,KeepStencilOp:()=>ci,KeyframeTrack:()=>Lg,LOD:()=>op,LatheGeometry:()=>Qm,Layers:()=>Vr,LessCompare:()=>Ei,LessDepth:()=>ee,LessEqualCompare:()=>Ci,LessEqualDepth:()=>ie,LessEqualStencilFunc:()=>xi,LessStencilFunc:()=>_i,Light:()=>iv,LightProbe:()=>xv,Line:()=>am,Line3:()=>P0,LineBasicMaterial:()=>Kp,LineCurve:()=>Xm,LineCurve3:()=>jm,LineDashedMaterial:()=>yg,LineLoop:()=>cm,LineSegments:()=>hm,LinearDisplayP3ColorSpace:()=>ri,LinearFilter:()=>lt,LinearInterpolant:()=>Pg,LinearMipMapLinearFilter:()=>L,LinearMipMapNearestFilter:()=>I,LinearMipmapLinearFilter:()=>le,LinearMipmapNearestFilter:()=>ht,LinearSRGBColorSpace:()=>ii,LinearToneMapping:()=>p,LinearTransfer:()=>ai,Loader:()=>jg,LoaderUtils:()=>Sv,LoadingManager:()=>Wg,LoopOnce:()=>Ne,LoopPingPong:()=>Oe,LoopRepeat:()=>De,LuminanceAlphaFormat:()=>k,LuminanceFormat:()=>z,MOUSE:()=>a,Material:()=>Sa,MaterialLoader:()=>Mv,MathUtils:()=>xn,Matrix2:()=>T0,Matrix3:()=>Sn,Matrix4:()=>Pr,MaxEquation:()=>Ut,Mesh:()=>ds,MeshBasicMaterial:()=>ba,MeshDepthMaterial:()=>cd,MeshDistanceMaterial:()=>ud,MeshLambertMaterial:()=>vg,MeshMatcapMaterial:()=>_g,MeshNormalMaterial:()=>gg,MeshPhongMaterial:()=>mg,MeshPhysicalMaterial:()=>pg,MeshStandardMaterial:()=>dg,MeshToonMaterial:()=>fg,MinEquation:()=>Lt,MirroredRepeatWrapping:()=>rt,MixOperation:()=>u,MultiplyBlending:()=>At,MultiplyOperation:()=>c,NearestFilter:()=>at,NearestMipMapLinearFilter:()=>P,NearestMipMapNearestFilter:()=>R,NearestMipmapLinearFilter:()=>ot,NearestMipmapNearestFilter:()=>st,NeutralToneMapping:()=>y,NeverCompare:()=>Ti,NeverDepth:()=>Qt,NeverStencilFunc:()=>vi,NoBlending:()=>bt,NoColorSpace:()=>ti,NoToneMapping:()=>oe,NormalAnimationBlendMode:()=>He,NormalBlending:()=>wt,NotEqualCompare:()=>Pi,NotEqualDepth:()=>se,NotEqualStencilFunc:()=>Si,NumberKeyframeTrack:()=>Dg,Object3D:()=>na,ObjectLoader:()=>Tv,ObjectSpaceNormalMap:()=>Qe,OctahedronGeometry:()=>$f,OneFactor:()=>Dt,OneMinusConstantAlphaFactor:()=>$t,OneMinusConstantColorFactor:()=>Jt,OneMinusDstAlphaFactor:()=>Vt,OneMinusDstColorFactor:()=>Ht,OneMinusSrcAlphaFactor:()=>zt,OneMinusSrcColorFactor:()=>Bt,OrthographicCamera:()=>Oh,P3Primaries:()=>li,PCFShadowMap:()=>E,PCFSoftShadowMap:()=>h,PMREMGenerator:()=>Zh,Path:()=>$m,PerspectiveCamera:()=>lh,Plane:()=>vh,PlaneGeometry:()=>bh,PlaneHelper:()=>i_,PointLight:()=>mv,PointLightHelper:()=>F0,Points:()=>gm,PointsMaterial:()=>um,PolarGridHelper:()=>W0,PolyhedronGeometry:()=>af,PositionalAudio:()=>Zv,PropertyBinding:()=>h0,PropertyMixer:()=>Kv,QuadraticBezierCurve:()=>qm,QuadraticBezierCurve3:()=>Ym,Quaternion:()=>Qn,QuaternionKeyframeTrack:()=>Bg,QuaternionLinearInterpolant:()=>Og,RED_GREEN_RGTC2_Format:()=>Le,RED_RGTC1_Format:()=>Pe,REVISION:()=>jt,RGBADepthPacking:()=>Ze,RGBAFormat:()=>ut,RGBAIntegerFormat:()=>_e,RGBA_ASTC_10x10_Format:()=>we,RGBA_ASTC_10x5_Format:()=>Me,RGBA_ASTC_10x6_Format:()=>Se,RGBA_ASTC_10x8_Format:()=>be,RGBA_ASTC_12x10_Format:()=>Te,RGBA_ASTC_12x12_Format:()=>Ee,RGBA_ASTC_4x4_Format:()=>et,RGBA_ASTC_5x4_Format:()=>mt,RGBA_ASTC_5x5_Format:()=>ft,RGBA_ASTC_6x5_Format:()=>gt,RGBA_ASTC_6x6_Format:()=>vt,RGBA_ASTC_8x5_Format:()=>yt,RGBA_ASTC_8x6_Format:()=>ye,RGBA_ASTC_8x8_Format:()=>xe,RGBA_BPTC_Format:()=>Ae,RGBA_ETC2_EAC_Format:()=>tt,RGBA_PVRTC_2BPPV1_Format:()=>K,RGBA_PVRTC_4BPPV1_Format:()=>J,RGBA_S3TC_DXT1_Format:()=>X,RGBA_S3TC_DXT3_Format:()=>j,RGBA_S3TC_DXT5_Format:()=>q,RGBDepthPacking:()=>Je,RGBFormat:()=>F,RGBIntegerFormat:()=>H,RGB_BPTC_SIGNED_Format:()=>Ce,RGB_BPTC_UNSIGNED_Format:()=>Re,RGB_ETC1_Format:()=>$,RGB_ETC2_Format:()=>Q,RGB_PVRTC_2BPPV1_Format:()=>Z,RGB_PVRTC_4BPPV1_Format:()=>Y,RGB_S3TC_DXT1_Format:()=>W,RGDepthPacking:()=>Ke,RGFormat:()=>G,RGIntegerFormat:()=>ve,RawShaderMaterial:()=>ug,Ray:()=>Rr,Raycaster:()=>x0,Rec709Primaries:()=>oi,RectAreaLight:()=>_v,RedFormat:()=>V,RedIntegerFormat:()=>ge,ReinhardToneMapping:()=>m,RenderTarget:()=>qn,RepeatWrapping:()=>it,ReplaceStencilOp:()=>ui,ReverseSubtractEquation:()=>It,RingGeometry:()=>Qf,SIGNED_RED_GREEN_RGTC2_Format:()=>Ue,SIGNED_RED_RGTC1_Format:()=>Ie,SRGBColorSpace:()=>ei,SRGBTransfer:()=>si,Scene:()=>zd,ShaderChunk:()=>wh,ShaderLib:()=>Eh,ShaderMaterial:()=>nh,ShadowMaterial:()=>cg,Shape:()=>df,ShapeGeometry:()=>tg,ShapePath:()=>l_,ShapeUtils:()=>Xf,ShortType:()=>N,Skeleton:()=>Sp,SkeletonHelper:()=>O0,SkinnedMesh:()=>vp,Source:()=>Gn,Sphere:()=>Mr,SphereGeometry:()=>ig,Spherical:()=>b0,SphericalHarmonics3:()=>yv,SplineCurve:()=>Zm,SpotLight:()=>hv,SpotLightHelper:()=>L0,Sprite:()=>np,SpriteMaterial:()=>Hd,SrcAlphaFactor:()=>Ft,SrcAlphaSaturateFactor:()=>Wt,SrcColorFactor:()=>Ot,StaticCopyUsage:()=>zi,StaticDrawUsage:()=>Ui,StaticReadUsage:()=>Oi,StereoCamera:()=>Ov,StreamCopyUsage:()=>Vi,StreamDrawUsage:()=>Di,StreamReadUsage:()=>Fi,StringKeyframeTrack:()=>Fg,SubtractEquation:()=>Pt,SubtractiveBlending:()=>Et,TOUCH:()=>s,TangentSpaceNormalMap:()=>$e,TetrahedronGeometry:()=>ng,Texture:()=>Xn,TextureLoader:()=>ev,TextureUtils:()=>Md,TorusGeometry:()=>rg,TorusKnotGeometry:()=>ag,Triangle:()=>ma,TriangleFanDrawMode:()=>qe,TriangleStripDrawMode:()=>je,TrianglesDrawMode:()=>Xe,TubeGeometry:()=>sg,UVMapping:()=>S,Uint16BufferAttribute:()=>Oa,Uint32BufferAttribute:()=>Fa,Uint8BufferAttribute:()=>Ua,Uint8ClampedBufferAttribute:()=>Na,Uniform:()=>m0,UniformsGroup:()=>g0,UniformsLib:()=>Th,UniformsUtils:()=>xs,UnsignedByteType:()=>he,UnsignedInt248Type:()=>fe,UnsignedInt5999Type:()=>O,UnsignedIntType:()=>ue,UnsignedShort4444Type:()=>pe,UnsignedShort5551Type:()=>me,UnsignedShortType:()=>ce,VSMShadowMap:()=>A,Vector2:()=>Mn,Vector3:()=>tr,Vector4:()=>jn,VectorKeyframeTrack:()=>zg,VideoTexture:()=>_m,WebGL3DRenderTarget:()=>$n,WebGLArrayRenderTarget:()=>Jn,WebGLCoordinateSystem:()=>Wi,WebGLCubeRenderTarget:()=>ph,WebGLMultipleRenderTargets:()=>h_,WebGLRenderTarget:()=>Yn,WebGLRenderer:()=>Od,WebGLUtils:()=>bd,WebGPUCoordinateSystem:()=>Xi,WireframeGeometry:()=>og,WrapAroundEnding:()=>Ge,ZeroCurvatureEnding:()=>ke,ZeroFactor:()=>Nt,ZeroSlopeEnding:()=>Ve,ZeroStencilOp:()=>hi,createCanvasElement:()=>Cn});var i={};n.r(i),n.d(i,{SVGLoader:()=>u_});var r={};n.r(r),n.d(r,{computeMikkTSpaceTangents:()=>d_,computeMorphedAttributes:()=>S_,deepCloneAttribute:()=>f_,deinterleaveAttribute:()=>v_,deinterleaveGeometry:()=>__,estimateBytesUsed:()=>y_,interleaveAttributes:()=>g_,mergeAttributes:()=>m_,mergeGeometries:()=>p_,mergeGroups:()=>b_,mergeVertices:()=>x_,toCreasedNormals:()=>w_,toTrianglesDrawMode:()=>M_});const jt="167",a={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},s={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},xt=0,Mt=1,St=2,o=3,l=0,E=1,h=2,A=3,qt=0,Yt=1,Zt=2,bt=0,wt=1,Tt=2,Et=3,At=4,Ct=5,Rt=100,Pt=101,It=102,Lt=103,Ut=104,Nt=200,Dt=201,Ot=202,Bt=203,Ft=204,zt=205,kt=206,Vt=207,Gt=208,Ht=209,Wt=210,Xt=211,Jt=212,Kt=213,$t=214,Qt=0,te=1,ee=2,ie=3,ne=4,re=5,ae=6,se=7,c=0,u=1,d=2,oe=0,p=1,m=2,f=3,g=4,v=5,_=6,y=7,x="attached",M="detached",S=300,b=301,w=302,T=303,C=304,_t=306,it=1e3,nt=1001,rt=1002,at=1003,st=1004,R=1004,ot=1005,P=1005,lt=1006,ht=1007,I=1007,le=1008,L=1008,he=1009,U=1010,N=1011,ce=1012,D=1013,ue=1014,ct=1015,de=1016,pe=1017,me=1018,fe=1020,O=35902,B=1021,F=1022,ut=1023,z=1024,k=1025,dt=1026,pt=1027,V=1028,ge=1029,G=1030,ve=1031,H=1032,_e=1033,W=33776,X=33777,j=33778,q=33779,Y=35840,Z=35841,J=35842,K=35843,$=36196,Q=37492,tt=37496,et=37808,mt=37809,ft=37810,gt=37811,vt=37812,yt=37813,ye=37814,xe=37815,Me=37816,Se=37817,be=37818,we=37819,Te=37820,Ee=37821,Ae=36492,Ce=36494,Re=36495,Pe=36283,Ie=36284,Le=36285,Ue=36286,Ne=2200,De=2201,Oe=2202,Be=2300,Fe=2301,ze=2302,ke=2400,Ve=2401,Ge=2402,He=2500,We=2501,Xe=0,je=1,qe=2,Ye=3200,Ze=3201,Je=3202,Ke=3203,$e=0,Qe=1,ti="",ei="srgb",ii="srgb-linear",ni="display-p3",ri="display-p3-linear",ai="linear",si="srgb",oi="rec709",li="p3",hi=0,ci=7680,ui=7681,di=7682,pi=7683,mi=34055,fi=34056,gi=5386,vi=512,_i=513,yi=514,xi=515,Mi=516,Si=517,bi=518,wi=519,Ti=512,Ei=513,Ai=514,Ci=515,Ri=516,Pi=517,Ii=518,Li=519,Ui=35044,Ni=35048,Di=35040,Oi=35045,Bi=35049,Fi=35041,zi=35046,ki=35050,Vi=35042,Gi="100",Hi="300 es",Wi=2e3,Xi=2001;class ji{addEventListener(t,e){void 0===this._listeners&&(this._listeners={});const i=this._listeners;void 0===i[t]&&(i[t]=[]),-1===i[t].indexOf(e)&&i[t].push(e)}hasEventListener(t,e){if(void 0===this._listeners)return!1;const i=this._listeners;return void 0!==i[t]&&-1!==i[t].indexOf(e)}removeEventListener(t,e){if(void 0!==this._listeners){var i,n;const r=this._listeners[t];void 0===r||-1!==(n=r.indexOf(e))&&r.splice(n,1)}}dispatchEvent(i){if(void 0!==this._listeners){var t;const e=this._listeners[i.type];if(void 0!==e){i.target=this;const n=e.slice(0);for(let t=0,e=n.length;t<e;t++)n[t].call(this,i);i.target=null}}}}const qi=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let Yi=1234567;const Zi=Math.PI/180,Ji=180/Math.PI;function Ki(){var t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,i=4294967295*Math.random()|0,n=4294967295*Math.random()|0;const r=qi[255&t]+qi[t>>8&255]+qi[t>>16&255]+qi[t>>24&255]+"-"+qi[255&e]+qi[e>>8&255]+"-"+qi[e>>16&15|64]+qi[e>>24&255]+"-"+qi[63&i|128]+qi[i>>8&255]+"-"+qi[i>>16&255]+qi[i>>24&255]+qi[255&n]+qi[n>>8&255]+qi[n>>16&255]+qi[n>>24&255];return r.toLowerCase()}function $i(t,e,i){return Math.max(e,Math.min(i,t))}function Qi(t,e){return(t%e+e)%e}function tn(t,e,i,n,r){return n+(t-e)*(r-n)/(i-e)}function en(t,e,i){return t!==e?(i-t)/(e-t):0}function nn(t,e,i){return(1-i)*t+i*e}function rn(t,e,i,n){return nn(t,e,1-Math.exp(-i*n))}function an(t,e=1){return e-Math.abs(Qi(t,2*e)-e)}function sn(t,e,i){return t<=e?0:i<=t?1:(t=(t-e)/(i-e))*t*(3-2*t)}function on(t,e,i){return t<=e?0:i<=t?1:(t=(t-e)/(i-e))*t*t*(t*(6*t-15)+10)}function ln(t,e){return t+Math.floor(Math.random()*(e-t+1))}function hn(t,e){return t+Math.random()*(e-t)}function cn(t){return t*(.5-Math.random())}function un(t){void 0!==t&&(Yi=t);var e=Yi+=1831565813,e=Math.imul(e^e>>>15,1|e);return(((e^=e+Math.imul(e^e>>>7,61|e))^e>>>14)>>>0)/4294967296}function dn(t){return t*Zi}function pn(t){return t*Ji}function mn(t){return 0==(t&t-1)&&0!==t}function fn(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function gn(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}function vn(t,e,i,n,r){const a=Math.cos,s=Math.sin;var o=a(i/2),l=s(i/2),h=a((e+n)/2),c=s((e+n)/2),u=a((e-n)/2),d=s((e-n)/2),p=a((n-e)/2),m=s((n-e)/2);switch(r){case"XYX":t.set(o*c,l*u,l*d,o*h);break;case"YZY":t.set(l*d,o*c,l*u,o*h);break;case"ZXZ":t.set(l*u,l*d,o*c,o*h);break;case"XZX":t.set(o*c,l*m,l*p,o*h);break;case"YXY":t.set(l*p,o*c,l*m,o*h);break;case"ZYZ":t.set(l*m,l*p,o*c,o*h);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}}function _n(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return t/4294967295;case Uint16Array:return t/65535;case Uint8Array:return t/255;case Int32Array:return Math.max(t/2147483647,-1);case Int16Array:return Math.max(t/32767,-1);case Int8Array:return Math.max(t/127,-1);default:throw new Error("Invalid component type.")}}function yn(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return Math.round(4294967295*t);case Uint16Array:return Math.round(65535*t);case Uint8Array:return Math.round(255*t);case Int32Array:return Math.round(2147483647*t);case Int16Array:return Math.round(32767*t);case Int8Array:return Math.round(127*t);default:throw new Error("Invalid component type.")}}const xn={DEG2RAD:Zi,RAD2DEG:Ji,generateUUID:Ki,clamp:$i,euclideanModulo:Qi,mapLinear:tn,inverseLerp:en,lerp:nn,damp:rn,pingpong:an,smoothstep:sn,smootherstep:on,randInt:ln,randFloat:hn,randFloatSpread:cn,seededRandom:un,degToRad:dn,radToDeg:pn,isPowerOfTwo:mn,ceilPowerOfTwo:fn,floorPowerOfTwo:gn,setQuaternionFromProperEuler:vn,normalize:yn,denormalize:_n};class Mn{constructor(t=0,e=0){Mn.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){var e=this.x,i=this.y,n=t.elements;return this.x=n[0]*e+n[3]*i+n[6],this.y=n[1]*e+n[4]*i+n[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){var t;return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){var e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;var i=this.dot(t)/e;return Math.acos($i(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){var e=this.x-t.x,i=this.y-t.y;return e*e+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){var i=Math.cos(e),n=Math.sin(e),r=this.x-t.x,a=this.y-t.y;return this.x=r*i-a*n+t.x,this.y=r*n+a*i+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Sn{constructor(t,e,i,n,r,a,s,o,l){Sn.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==t&&this.set(t,e,i,n,r,a,s,o,l)}set(t,e,i,n,r,a,s,o,l){const h=this.elements;return h[0]=t,h[1]=n,h[2]=s,h[3]=e,h[4]=r,h[5]=o,h[6]=i,h[7]=a,h[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements;var i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this}extractBasis(t,e,i){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(t){var e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){var i=t.elements,n=e.elements;const r=this.elements;var a=i[0],s=i[3],o=i[6],l=i[1],h=i[4],c=i[7],u=i[2],d=i[5],p=i[8],m=n[0],f=n[3],g=n[6],v=n[1],_=n[4],y=n[7],x=n[2],M=n[5],S=n[8];return r[0]=a*m+s*v+o*x,r[3]=a*f+s*_+o*M,r[6]=a*g+s*y+o*S,r[1]=l*m+h*v+c*x,r[4]=l*f+h*_+c*M,r[7]=l*g+h*y+c*S,r[2]=u*m+d*v+p*x,r[5]=u*f+d*_+p*M,r[8]=u*g+d*y+p*S,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){var t=this.elements,e=t[0],i=t[1],n=t[2],r=t[3],a=t[4],s=t[5],o=t[6],l=t[7],h=t[8];return e*a*h-e*s*l-i*r*h+i*s*o+n*r*l-n*a*o}invert(){const t=this.elements,e=t[0],i=t[1],n=t[2],r=t[3],a=t[4],s=t[5],o=t[6],l=t[7],h=t[8],c=h*a-s*l,u=s*o-h*r,d=l*r-a*o,p=e*c+i*u+n*d;if(0==p)return this.set(0,0,0,0,0,0,0,0,0);var m=1/p;return t[0]=c*m,t[1]=(n*l-h*i)*m,t[2]=(s*i-n*a)*m,t[3]=u*m,t[4]=(h*e-n*o)*m,t[5]=(n*r-s*e)*m,t[6]=d*m,t[7]=(i*o-l*e)*m,t[8]=(a*e-i*r)*m,this}transpose(){var t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){var e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,i,n,r,a,s){var o=Math.cos(r),l=Math.sin(r);return this.set(i*o,i*l,-i*(o*a+l*s)+a+t,-n*l,n*o,-n*(-l*a+o*s)+s+e,0,0,1),this}scale(t,e){return this.premultiply(bn.makeScale(t,e)),this}rotate(t){return this.premultiply(bn.makeRotation(-t)),this}translate(t,e){return this.premultiply(bn.makeTranslation(t,e)),this}makeTranslation(t,e){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,e,0,0,1),this}makeRotation(t){var e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,i,e,0,0,0,1),this}makeScale(t,e){return this.set(t,0,0,0,e,0,0,0,1),this}equals(t){var e=this.elements,i=t.elements;for(let t=0;t<9;t++)if(e[t]!==i[t])return!1;return!0}fromArray(e,i=0){for(let t=0;t<9;t++)this.elements[t]=e[t+i];return this}toArray(t=[],e=0){var i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t}clone(){return(new this.constructor).fromArray(this.elements)}}const bn=new Sn;function wn(e){for(let t=e.length-1;0<=t;--t)if(65535<=e[t])return 1}const Tn={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function En(t,e){return new Tn[t](e)}function An(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}function Cn(){const t=An("canvas");return t.style.display="block",t}const Rn={};function Pn(t){t in Rn||(Rn[t]=!0,console.warn(t))}function In(n,r,a){return new Promise(function(t,e){function i(){switch(n.clientWaitSync(r,n.SYNC_FLUSH_COMMANDS_BIT,0)){case n.WAIT_FAILED:e();break;case n.TIMEOUT_EXPIRED:setTimeout(i,a);break;default:t()}}setTimeout(i,a)})}const Ln=(new Sn).set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),Un=(new Sn).set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),Nn={[ii]:{transfer:ai,primaries:oi,luminanceCoefficients:[.2126,.7152,.0722],toReference:t=>t,fromReference:t=>t},[ei]:{transfer:si,primaries:oi,luminanceCoefficients:[.2126,.7152,.0722],toReference:t=>t.convertSRGBToLinear(),fromReference:t=>t.convertLinearToSRGB()},[ri]:{transfer:ai,primaries:li,luminanceCoefficients:[.2289,.6917,.0793],toReference:t=>t.applyMatrix3(Un),fromReference:t=>t.applyMatrix3(Ln)},[ni]:{transfer:si,primaries:li,luminanceCoefficients:[.2289,.6917,.0793],toReference:t=>t.convertSRGBToLinear().applyMatrix3(Un),fromReference:t=>t.applyMatrix3(Ln).convertLinearToSRGB()}},Dn=new Set([ii,ri]),On={enabled:!0,_workingColorSpace:ii,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(t){if(!Dn.has(t))throw new Error(`Unsupported working color space, "${t}".`);this._workingColorSpace=t},convert:function(t,e,i){if(!1===this.enabled||e===i||!e||!i)return t;const n=Nn[e].toReference,r=Nn[i].fromReference;return r(n(t))},fromWorkingColorSpace:function(t,e){return this.convert(t,this._workingColorSpace,e)},toWorkingColorSpace:function(t,e){return this.convert(t,e,this._workingColorSpace)},getPrimaries:function(t){return Nn[t].primaries},getTransfer:function(t){return t===ti?ai:Nn[t].transfer},getLuminanceCoefficients:function(t,e=this._workingColorSpace){return t.fromArray(Nn[e].luminanceCoefficients)}};function Bn(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function Fn(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}let zn;class kn{static getDataURL(t){if(/^data:/i.test(t.src))return t.src;if("undefined"==typeof HTMLCanvasElement)return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{void 0===zn&&(zn=An("canvas")),zn.width=t.width,zn.height=t.height;const i=zn.getContext("2d");t instanceof ImageData?i.putImageData(t,0,0):i.drawImage(t,0,0,t.width,t.height),e=zn}return 2048<e.width||2048<e.height?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}static sRGBToLinear(t){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){const i=An("canvas");i.width=t.width,i.height=t.height;const n=i.getContext("2d");n.drawImage(t,0,0,t.width,t.height);var e=n.getImageData(0,0,t.width,t.height);const r=e.data;for(let t=0;t<r.length;t++)r[t]=255*Bn(r[t]/255);return n.putImageData(e,0,0),i}if(t.data){const a=t.data.slice(0);for(let t=0;t<a.length;t++)a instanceof Uint8Array||a instanceof Uint8ClampedArray?a[t]=Math.floor(255*Bn(a[t]/255)):a[t]=Bn(a[t]);return{data:a,width:t.width,height:t.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}let Vn=0;class Gn{constructor(t=null){this.isSource=!0,Object.defineProperty(this,"id",{value:Vn++}),this.uuid=Ki(),this.data=t,this.dataReady=!0,this.version=0}set needsUpdate(t){!0===t&&this.version++}toJSON(t){var e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.images[this.uuid])return t.images[this.uuid];const n={uuid:this.uuid,url:""};var r=this.data;if(null!==r){let i;if(Array.isArray(r)){i=[];for(let t=0,e=r.length;t<e;t++)r[t].isDataTexture?i.push(Hn(r[t].image)):i.push(Hn(r[t]))}else i=Hn(r);n.url=i}return e||(t.images[this.uuid]=n),n}}function Hn(t){return"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?kn.getDataURL(t):t.data?{data:Array.from(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let Wn=0;class Xn extends ji{constructor(t=Xn.DEFAULT_IMAGE,e=Xn.DEFAULT_MAPPING,i=nt,n=nt,r=lt,a=le,s=ut,o=he,l=Xn.DEFAULT_ANISOTROPY,h=ti){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Wn++}),this.uuid=Ki(),this.name="",this.source=new Gn(t),this.mipmaps=[],this.mapping=e,this.channel=0,this.wrapS=i,this.wrapT=n,this.magFilter=r,this.minFilter=a,this.anisotropy=l,this.format=s,this.internalFormat=null,this.type=o,this.offset=new Mn(0,0),this.repeat=new Mn(1,1),this.center=new Mn(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Sn,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=h,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){var e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const i={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return 0<Object.keys(this.userData).length&&(i.userData=this.userData),e||(t.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==S)return t;if(t.applyMatrix3(this.matrix),t.x<0||1<t.x)switch(this.wrapS){case it:t.x=t.x-Math.floor(t.x);break;case nt:t.x=t.x<0?0:1;break;case rt:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||1<t.y)switch(this.wrapT){case it:t.y=t.y-Math.floor(t.y);break;case nt:t.y=t.y<0?0:1;break;case rt:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){!0===t&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(t){!0===t&&this.pmremVersion++}}Xn.DEFAULT_IMAGE=null,Xn.DEFAULT_MAPPING=S,Xn.DEFAULT_ANISOTROPY=1;class jn{constructor(t=0,e=0,i=0,n=1){jn.prototype.isVector4=!0,this.x=t,this.y=e,this.z=i,this.w=n}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,i,n){return this.x=t,this.y=e,this.z=i,this.w=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){var e=this.x,i=this.y,n=this.z,r=this.w,a=t.elements;return this.x=a[0]*e+a[4]*i+a[8]*n+a[12]*r,this.y=a[1]*e+a[5]*i+a[9]*n+a[13]*r,this.z=a[2]*e+a[6]*i+a[10]*n+a[14]*r,this.w=a[3]*e+a[7]*i+a[11]*n+a[15]*r,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);var e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,i,n,r;var a=.01,s=.1,o=t.elements,l=o[0],h=o[4],c=o[8],u=o[1],d=o[5],p=o[9],m=o[2],f=o[6],g=o[10];if(Math.abs(h-u)<a&&Math.abs(c-m)<a&&Math.abs(p-f)<a){if(Math.abs(h+u)<.1&&Math.abs(c+m)<.1&&Math.abs(p+f)<.1&&Math.abs(l+d+g-3)<.1)return this.set(1,0,0,0),this;e=Math.PI;var v=(l+1)/2,_=(d+1)/2,y=(g+1)/2,x=(h+u)/4,M=(c+m)/4,S=(p+f)/4;return _<v&&y<v?r=v<a?(i=0,n=.707106781):(i=Math.sqrt(v),n=x/i,M/i):y<_?r=_<a?(i=.707106781,n=0,.707106781):(n=Math.sqrt(_),i=x/n,S/n):y<a?(i=.707106781,n=.707106781,r=0):(r=Math.sqrt(y),i=M/r,n=S/r),this.set(i,n,r,e),this}let b=Math.sqrt((f-p)*(f-p)+(c-m)*(c-m)+(u-h)*(u-h));return Math.abs(b)<.001&&(b=1),this.x=(f-p)/b,this.y=(c-m)/b,this.z=(u-h)/b,this.w=Math.acos((l+d+g-1)/2),this}setFromMatrixPosition(t){var e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this.w=e[15],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this.w=t.w+(e.w-t.w)*i,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class qn extends ji{constructor(t=1,e=1,i={}){super(),this.isRenderTarget=!0,this.width=t,this.height=e,this.depth=1,this.scissor=new jn(0,0,t,e),this.scissorTest=!1,this.viewport=new jn(0,0,t,e);var n={width:t,height:e,depth:1};i=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:lt,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},i);const r=new Xn(n,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.colorSpace);r.flipY=!1,r.generateMipmaps=i.generateMipmaps,r.internalFormat=i.internalFormat,this.textures=[];var a=i.count;for(let t=0;t<a;t++)this.textures[t]=r.clone(),this.textures[t].isRenderTargetTexture=!0;this.depthBuffer=i.depthBuffer,this.stencilBuffer=i.stencilBuffer,this.resolveDepthBuffer=i.resolveDepthBuffer,this.resolveStencilBuffer=i.resolveStencilBuffer,this.depthTexture=i.depthTexture,this.samples=i.samples}get texture(){return this.textures[0]}set texture(t){this.textures[0]=t}setSize(i,n,r=1){if(this.width!==i||this.height!==n||this.depth!==r){this.width=i,this.height=n,this.depth=r;for(let t=0,e=this.textures.length;t<e;t++)this.textures[t].image.width=i,this.textures[t].image.height=n,this.textures[t].image.depth=r;this.dispose()}this.viewport.set(0,0,i,n),this.scissor.set(0,0,i,n)}clone(){return(new this.constructor).copy(this)}copy(i){this.width=i.width,this.height=i.height,this.depth=i.depth,this.scissor.copy(i.scissor),this.scissorTest=i.scissorTest,this.viewport.copy(i.viewport);for(let t=this.textures.length=0,e=i.textures.length;t<e;t++)this.textures[t]=i.textures[t].clone(),this.textures[t].isRenderTargetTexture=!0;var t=Object.assign({},i.texture.image);return this.texture.source=new Gn(t),this.depthBuffer=i.depthBuffer,this.stencilBuffer=i.stencilBuffer,this.resolveDepthBuffer=i.resolveDepthBuffer,this.resolveStencilBuffer=i.resolveStencilBuffer,null!==i.depthTexture&&(this.depthTexture=i.depthTexture.clone()),this.samples=i.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Yn extends qn{constructor(t=1,e=1,i={}){super(t,e,i),this.isWebGLRenderTarget=!0}}class Zn extends Xn{constructor(t=null,e=1,i=1,n=1){super(null),this.isDataArrayTexture=!0,this.image={data:t,width:e,height:i,depth:n},this.magFilter=at,this.minFilter=at,this.wrapR=nt,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(t){this.layerUpdates.add(t)}clearLayerUpdates(){this.layerUpdates.clear()}}class Jn extends Yn{constructor(t=1,e=1,i=1,n={}){super(t,e,n),this.isWebGLArrayRenderTarget=!0,this.depth=i,this.texture=new Zn(null,t,e,i),this.texture.isRenderTargetTexture=!0}}class Kn extends Xn{constructor(t=null,e=1,i=1,n=1){super(null),this.isData3DTexture=!0,this.image={data:t,width:e,height:i,depth:n},this.magFilter=at,this.minFilter=at,this.wrapR=nt,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class $n extends Yn{constructor(t=1,e=1,i=1,n={}){super(t,e,n),this.isWebGL3DRenderTarget=!0,this.depth=i,this.texture=new Kn(null,t,e,i),this.texture.isRenderTargetTexture=!0}}class Qn{constructor(t=0,e=0,i=0,n=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=i,this._w=n}static slerpFlat(t,e,i,n,r,a,s){let o=i[n+0],l=i[n+1],h=i[n+2],c=i[n+3];var u=r[a+0],d=r[a+1],p=r[a+2],m=r[a+3];if(0===s)return t[e+0]=o,t[e+1]=l,t[e+2]=h,void(t[e+3]=c);if(1===s)return t[e+0]=u,t[e+1]=d,t[e+2]=p,void(t[e+3]=m);if(c!==m||o!==u||l!==d||h!==p){let t=1-s;var f=o*u+l*d+h*p+c*m,g=0<=f?1:-1,v=1-f*f,_,y;v>Number.EPSILON&&(_=Math.sqrt(v),y=Math.atan2(_,f*g),t=Math.sin(t*y)/_,s=Math.sin(s*y)/_);var x=s*g,M;o=o*t+u*x,l=l*t+d*x,h=h*t+p*x,c=c*t+m*x,t===1-s&&(M=1/Math.sqrt(o*o+l*l+h*h+c*c),o*=M,l*=M,h*=M,c*=M)}t[e]=o,t[e+1]=l,t[e+2]=h,t[e+3]=c}static multiplyQuaternionsFlat(t,e,i,n,r,a){var s=i[n],o=i[n+1],l=i[n+2],h=i[n+3],c=r[a],u=r[a+1],d=r[a+2],p=r[a+3];return t[e]=s*p+h*c+o*d-l*u,t[e+1]=o*p+h*u+l*c-s*d,t[e+2]=l*p+h*d+s*u-o*c,t[e+3]=h*p-s*c-o*u-l*d,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,i,n){return this._x=t,this._y=e,this._z=i,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e=!0){var i=t._x,n=t._y,r=t._z,a=t._order;const s=Math.cos,o=Math.sin;var l=s(i/2),h=s(n/2),c=s(r/2),u=o(i/2),d=o(n/2),p=o(r/2);switch(a){case"XYZ":this._x=u*h*c+l*d*p,this._y=l*d*c-u*h*p,this._z=l*h*p+u*d*c,this._w=l*h*c-u*d*p;break;case"YXZ":this._x=u*h*c+l*d*p,this._y=l*d*c-u*h*p,this._z=l*h*p-u*d*c,this._w=l*h*c+u*d*p;break;case"ZXY":this._x=u*h*c-l*d*p,this._y=l*d*c+u*h*p,this._z=l*h*p+u*d*c,this._w=l*h*c-u*d*p;break;case"ZYX":this._x=u*h*c-l*d*p,this._y=l*d*c+u*h*p,this._z=l*h*p-u*d*c,this._w=l*h*c+u*d*p;break;case"YZX":this._x=u*h*c+l*d*p,this._y=l*d*c+u*h*p,this._z=l*h*p-u*d*c,this._w=l*h*c-u*d*p;break;case"XZY":this._x=u*h*c-l*d*p,this._y=l*d*c-u*h*p,this._z=l*h*p+u*d*c,this._w=l*h*c+u*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return!0===e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){var i=e/2,n=Math.sin(i);return this._x=t.x*n,this._y=t.y*n,this._z=t.z*n,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(t){var e=t.elements,i=e[0],n=e[4],r=e[8],a=e[1],s=e[5],o=e[9],l=e[2],h=e[6],c=e[10],u=i+s+c,d,p,m,f;return 0<u?(d=.5/Math.sqrt(u+1),this._w=.25/d,this._x=(h-o)*d,this._y=(r-l)*d,this._z=(a-n)*d):s<i&&c<i?(p=2*Math.sqrt(1+i-s-c),this._w=(h-o)/p,this._x=.25*p,this._y=(n+a)/p,this._z=(r+l)/p):c<s?(m=2*Math.sqrt(1+s-i-c),this._w=(r-l)/m,this._x=(n+a)/m,this._y=.25*m,this._z=(o+h)/m):(f=2*Math.sqrt(1+c-i-s),this._w=(a-n)/f,this._x=(r+l)/f,this._y=(o+h)/f,this._z=.25*f),this._onChangeCallback(),this}setFromUnitVectors(t,e){let i=t.dot(e)+1;return i<Number.EPSILON?(i=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0):(this._x=0,this._y=-t.z,this._z=t.y)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x),this._w=i,this.normalize()}angleTo(t){return 2*Math.acos(Math.abs($i(this.dot(t),-1,1)))}rotateTowards(t,e){var i=this.angleTo(t);if(0===i)return this;var n=Math.min(1,e/i);return this.slerp(t,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){var t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(this._x=this._x*(t=1/t),this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){var i=t._x,n=t._y,r=t._z,a=t._w,s=e._x,o=e._y,l=e._z,h=e._w;return this._x=i*h+a*s+n*l-r*o,this._y=n*h+a*o+r*s-i*l,this._z=r*h+a*l+i*o-n*s,this._w=a*h-i*s-n*o-r*l,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);var i=this._x,n=this._y,r=this._z,a=this._w;let s=a*t._w+i*t._x+n*t._y+r*t._z;if(s<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,s=-s):this.copy(t),1<=s)return this._w=a,this._x=i,this._y=n,this._z=r,this;var o=1-s*s;if(o<=Number.EPSILON){var l=1-e;return this._w=l*a+e*this._w,this._x=l*i+e*this._x,this._y=l*n+e*this._y,this._z=l*r+e*this._z,this.normalize(),this}var h=Math.sqrt(o),c=Math.atan2(h,s),u=Math.sin((1-e)*c)/h,d=Math.sin(e*c)/h;return this._w=a*u+this._w*d,this._x=i*u+this._x*d,this._y=n*u+this._y*d,this._z=r*u+this._z*d,this._onChangeCallback(),this}slerpQuaternions(t,e,i){return this.copy(t).slerp(e,i)}random(){var t=2*Math.PI*Math.random(),e=2*Math.PI*Math.random(),i=Math.random(),n=Math.sqrt(1-i),r=Math.sqrt(i);return this.set(n*Math.sin(t),n*Math.cos(t),r*Math.sin(e),r*Math.cos(e))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class tr{constructor(t=0,e=0,i=0){tr.prototype.isVector3=!0,this.x=t,this.y=e,this.z=i}set(t,e,i){return void 0===i&&(i=this.z),this.x=t,this.y=e,this.z=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(ir.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(ir.setFromAxisAngle(t,e))}applyMatrix3(t){var e=this.x,i=this.y,n=this.z,r=t.elements;return this.x=r[0]*e+r[3]*i+r[6]*n,this.y=r[1]*e+r[4]*i+r[7]*n,this.z=r[2]*e+r[5]*i+r[8]*n,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){var e=this.x,i=this.y,n=this.z,r=t.elements,a=1/(r[3]*e+r[7]*i+r[11]*n+r[15]);return this.x=(r[0]*e+r[4]*i+r[8]*n+r[12])*a,this.y=(r[1]*e+r[5]*i+r[9]*n+r[13])*a,this.z=(r[2]*e+r[6]*i+r[10]*n+r[14])*a,this}applyQuaternion(t){var e=this.x,i=this.y,n=this.z,r=t.x,a=t.y,s=t.z,o=t.w,l=2*(a*n-s*i),h=2*(s*e-r*n),c=2*(r*i-a*e);return this.x=e+o*l+a*c-s*h,this.y=i+o*h+s*l-r*c,this.z=n+o*c+r*h-a*l,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){var e=this.x,i=this.y,n=this.z,r=t.elements;return this.x=r[0]*e+r[4]*i+r[8]*n,this.y=r[1]*e+r[5]*i+r[9]*n,this.z=r[2]*e+r[6]*i+r[10]*n,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){var i=t.x,n=t.y,r=t.z,a=e.x,s=e.y,o=e.z;return this.x=n*o-r*s,this.y=r*a-i*o,this.z=i*s-n*a,this}projectOnVector(t){var e=t.lengthSq();if(0===e)return this.set(0,0,0);var i=t.dot(this)/e;return this.copy(t).multiplyScalar(i)}projectOnPlane(t){return er.copy(this).projectOnVector(t),this.sub(er)}reflect(t){return this.sub(er.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){var e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;var i=this.dot(t)/e;return Math.acos($i(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){var e=this.x-t.x,i=this.y-t.y,n=this.z-t.z;return e*e+i*i+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,i){var n=Math.sin(e)*t;return this.x=n*Math.sin(i),this.y=Math.cos(e)*t,this.z=n*Math.cos(i),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,i){return this.x=t*Math.sin(e),this.y=i,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){var e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){var e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),n=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=i,this.z=n,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){var t=Math.random()*Math.PI*2,e=2*Math.random()-1,i=Math.sqrt(1-e*e);return this.x=i*Math.cos(t),this.y=e,this.z=i*Math.sin(t),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const er=new tr,ir=new Qn;class nr{constructor(t=new tr(1/0,1/0,1/0),e=new tr(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(i){this.makeEmpty();for(let t=0,e=i.length;t<e;t+=3)this.expandByPoint(ar.fromArray(i,t));return this}setFromBufferAttribute(i){this.makeEmpty();for(let t=0,e=i.count;t<e;t++)this.expandByPoint(ar.fromBufferAttribute(i,t));return this}setFromPoints(i){this.makeEmpty();for(let t=0,e=i.length;t<e;t++)this.expandByPoint(i[t]);return this}setFromCenterAndSize(t,e){var i=ar.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(i,n=!1){i.updateWorldMatrix(!1,!1);const t=i.geometry;if(void 0!==t){var r=t.getAttribute("position");if(!0===n&&void 0!==r&&!0!==i.isInstancedMesh)for(let t=0,e=r.count;t<e;t++)!0===i.isMesh?i.getVertexPosition(t,ar):ar.fromBufferAttribute(r,t),ar.applyMatrix4(i.matrixWorld),this.expandByPoint(ar);else void 0!==i.boundingBox?(null===i.boundingBox&&i.computeBoundingBox(),sr.copy(i.boundingBox)):(null===t.boundingBox&&t.computeBoundingBox(),sr.copy(t.boundingBox)),sr.applyMatrix4(i.matrixWorld),this.union(sr)}var a=i.children;for(let t=0,e=a.length;t<e;t++)this.expandByObject(a[t],n);return this}containsPoint(t){return t.x>=this.min.x&&t.x<=this.max.x&&t.y>=this.min.y&&t.y<=this.max.y&&t.z>=this.min.z&&t.z<=this.max.z}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return t.max.x>=this.min.x&&t.min.x<=this.max.x&&t.max.y>=this.min.y&&t.min.y<=this.max.y&&t.max.z>=this.min.z&&t.min.z<=this.max.z}intersectsSphere(t){return this.clampPoint(t.center,ar),ar.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,i;return i=0<t.normal.x?(e=t.normal.x*this.min.x,t.normal.x*this.max.x):(e=t.normal.x*this.max.x,t.normal.x*this.min.x),0<t.normal.y?(e+=t.normal.y*this.min.y,i+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,i+=t.normal.y*this.min.y),0<t.normal.z?(e+=t.normal.z*this.min.z,i+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,i+=t.normal.z*this.min.z),e<=-t.constant&&i>=-t.constant}intersectsTriangle(t){return!this.isEmpty()&&(this.getCenter(pr),mr.subVectors(this.max,pr),or.subVectors(t.a,pr),lr.subVectors(t.b,pr),hr.subVectors(t.c,pr),cr.subVectors(lr,or),ur.subVectors(hr,lr),dr.subVectors(or,hr),!!vr(e=[0,-cr.z,cr.y,0,-ur.z,ur.y,0,-dr.z,dr.y,cr.z,0,-cr.x,ur.z,0,-ur.x,dr.z,0,-dr.x,-cr.y,cr.x,0,-ur.y,ur.x,0,-dr.y,dr.x,0],or,lr,hr,mr)&&(!!vr(e=[1,0,0,0,1,0,0,0,1],or,lr,hr,mr)&&(fr.crossVectors(cr,ur),vr(e=[fr.x,fr.y,fr.z],or,lr,hr,mr))));var e}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,ar).distanceTo(t)}getBoundingSphere(t){return this.isEmpty()?t.makeEmpty():(this.getCenter(t.center),t.radius=.5*this.getSize(ar).length()),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()||(rr[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),rr[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),rr[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),rr[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),rr[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),rr[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),rr[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),rr[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(rr)),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const rr=[new tr,new tr,new tr,new tr,new tr,new tr,new tr,new tr],ar=new tr,sr=new nr,or=new tr,lr=new tr,hr=new tr,cr=new tr,ur=new tr,dr=new tr,pr=new tr,mr=new tr,fr=new tr,gr=new tr;function vr(i,n,r,a,s){for(let t=0,e=i.length-3;t<=e;t+=3){gr.fromArray(i,t);var o=s.x*Math.abs(gr.x)+s.y*Math.abs(gr.y)+s.z*Math.abs(gr.z),l=n.dot(gr),h=r.dot(gr),c=a.dot(gr);if(Math.max(-Math.max(l,h,c),Math.min(l,h,c))>o)return!1}return!0}const _r=new nr,yr=new tr,xr=new tr;class Mr{constructor(t=new tr,e=-1){this.isSphere=!0,this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(i,t){const n=this.center;void 0!==t?n.copy(t):_r.setFromPoints(i).getCenter(n);let r=0;for(let t=0,e=i.length;t<e;t++)r=Math.max(r,n.distanceToSquared(i[t]));return this.radius=Math.sqrt(r),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){var e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){var i=this.center.distanceToSquared(t);return e.copy(t),i>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?t.makeEmpty():(t.set(this.center,this.center),t.expandByScalar(this.radius)),t}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;yr.subVectors(t,this.center);var e=yr.lengthSq(),i,n;return e>this.radius*this.radius&&(n=.5*((i=Math.sqrt(e))-this.radius),this.center.addScaledVector(yr,n/i),this.radius+=n),this}union(t){return t.isEmpty()||(this.isEmpty()?this.copy(t):!0===this.center.equals(t.center)?this.radius=Math.max(this.radius,t.radius):(xr.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(yr.copy(t.center).add(xr)),this.expandByPoint(yr.copy(t.center).sub(xr)))),this}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const Sr=new tr,br=new tr,wr=new tr,Tr=new tr,Er=new tr,Ar=new tr,Cr=new tr;class Rr{constructor(t=new tr,e=new tr(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.origin).addScaledVector(this.direction,t)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,Sr)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);var i=e.dot(this.direction);return i<0?e.copy(this.origin):e.copy(this.origin).addScaledVector(this.direction,i)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){var e=Sr.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(Sr.copy(this.origin).addScaledVector(this.direction,e),Sr.distanceToSquared(t))}distanceSqToSegment(t,e,i,n){br.copy(t).add(e).multiplyScalar(.5),wr.copy(e).sub(t).normalize(),Tr.copy(this.origin).sub(br);var r=.5*t.distanceTo(e),a=-this.direction.dot(wr),s=Tr.dot(this.direction),o=-Tr.dot(wr),l=Tr.lengthSq(),h=Math.abs(1-a*a),c;let u,d,p,m;return p=0<h?(u=a*o-s,d=a*s-o,m=r*h,0<=u?d>=-m?d<=m?(c=1/h,u*=c,d*=c,u*(u+a*d+2*s)+d*(a*u+d+2*o)+l):(d=r,u=Math.max(0,-(a*d+s)),-u*u+d*(d+2*o)+l):(d=-r,u=Math.max(0,-(a*d+s)),-u*u+d*(d+2*o)+l):d<=-m?(u=Math.max(0,-(-a*r+s)),d=0<u?-r:Math.min(Math.max(-r,-o),r),-u*u+d*(d+2*o)+l):d<=m?(u=0,d=Math.min(Math.max(-r,-o),r),d*(d+2*o)+l):(u=Math.max(0,-(a*r+s)),d=0<u?r:Math.min(Math.max(-r,-o),r),-u*u+d*(d+2*o)+l)):(d=0<a?-r:r,u=Math.max(0,-(a*d+s)),-u*u+d*(d+2*o)+l),i&&i.copy(this.origin).addScaledVector(this.direction,u),n&&n.copy(br).addScaledVector(wr,d),p}intersectSphere(t,e){Sr.subVectors(t.center,this.origin);var i=Sr.dot(this.direction),n=Sr.dot(Sr)-i*i,r=t.radius*t.radius;if(r<n)return null;var a=Math.sqrt(r-n),s=i-a,o=i+a;return o<0?null:s<0?this.at(o,e):this.at(s,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){var e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;var i=-(this.origin.dot(t.normal)+t.constant)/e;return 0<=i?i:null}intersectPlane(t,e){var i=this.distanceToPlane(t);return null===i?null:this.at(i,e)}intersectsPlane(t){var e=t.distanceToPoint(this.origin),i;return 0===e||t.normal.dot(this.direction)*e<0}intersectBox(t,e){let i,n,r,a,s,o;var l=1/this.direction.x,h=1/this.direction.y,c=1/this.direction.z,u=this.origin;return n=0<=l?(i=(t.min.x-u.x)*l,(t.max.x-u.x)*l):(i=(t.max.x-u.x)*l,(t.min.x-u.x)*l),a=0<=h?(r=(t.min.y-u.y)*h,(t.max.y-u.y)*h):(r=(t.max.y-u.y)*h,(t.min.y-u.y)*h),i>a||r>n?null:((r>i||isNaN(i))&&(i=r),(a<n||isNaN(n))&&(n=a),o=0<=c?(s=(t.min.z-u.z)*c,(t.max.z-u.z)*c):(s=(t.max.z-u.z)*c,(t.min.z-u.z)*c),i>o||s>n?null:((s>i||i!=i)&&(i=s),(o<n||n!=n)&&(n=o),n<0?null:this.at(0<=i?i:n,e)))}intersectsBox(t){return null!==this.intersectBox(t,Sr)}intersectTriangle(t,e,i,n,r){Er.subVectors(e,t),Ar.subVectors(i,t),Cr.crossVectors(Er,Ar);let a=this.direction.dot(Cr),s;if(0<a){if(n)return null;s=1}else{if(!(a<0))return null;s=-1,a=-a}Tr.subVectors(this.origin,t);var o=s*this.direction.dot(Ar.crossVectors(Tr,Ar));if(o<0)return null;var l=s*this.direction.dot(Er.cross(Tr));if(l<0)return null;if(o+l>a)return null;var h=-s*Tr.dot(Cr);return h<0?null:this.at(h/a,r)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class Pr{constructor(t,e,i,n,r,a,s,o,l,h,c,u,d,p,m,f){Pr.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==t&&this.set(t,e,i,n,r,a,s,o,l,h,c,u,d,p,m,f)}set(t,e,i,n,r,a,s,o,l,h,c,u,d,p,m,f){const g=this.elements;return g[0]=t,g[4]=e,g[8]=i,g[12]=n,g[1]=r,g[5]=a,g[9]=s,g[13]=o,g[2]=l,g[6]=h,g[10]=c,g[14]=u,g[3]=d,g[7]=p,g[11]=m,g[15]=f,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Pr).fromArray(this.elements)}copy(t){const e=this.elements;var i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this}copyPosition(t){const e=this.elements,i=t.elements;return e[12]=i[12],e[13]=i[13],e[14]=i[14],this}setFromMatrix3(t){var e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,i){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(t,e,i){return this.set(t.x,e.x,i.x,0,t.y,e.y,i.y,0,t.z,e.z,i.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements;var i=t.elements,n=1/Ir.setFromMatrixColumn(t,0).length(),r=1/Ir.setFromMatrixColumn(t,1).length(),a=1/Ir.setFromMatrixColumn(t,2).length();return e[0]=i[0]*n,e[1]=i[1]*n,e[2]=i[2]*n,e[3]=0,e[4]=i[4]*r,e[5]=i[5]*r,e[6]=i[6]*r,e[7]=0,e[8]=i[8]*a,e[9]=i[9]*a,e[10]=i[10]*a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){const e=this.elements;var i=t.x,n=t.y,r=t.z,a=Math.cos(i),s=Math.sin(i),o=Math.cos(n),l=Math.sin(n),h=Math.cos(r),c=Math.sin(r),u,d,p,m,f,g,v,_,y,x,M,S,b,w,T,E,A,C,R,P,I,L,U,N;return"XYZ"===t.order?(u=a*h,d=a*c,p=s*h,m=s*c,e[0]=o*h,e[4]=-o*c,e[8]=l,e[1]=d+p*l,e[5]=u-m*l,e[9]=-s*o,e[2]=m-u*l,e[6]=p+d*l,e[10]=a*o):"YXZ"===t.order?(f=o*h,g=o*c,v=l*h,_=l*c,e[0]=f+_*s,e[4]=v*s-g,e[8]=a*l,e[1]=a*c,e[5]=a*h,e[9]=-s,e[2]=g*s-v,e[6]=_+f*s,e[10]=a*o):"ZXY"===t.order?(y=o*h,x=o*c,M=l*h,S=l*c,e[0]=y-S*s,e[4]=-a*c,e[8]=M+x*s,e[1]=x+M*s,e[5]=a*h,e[9]=S-y*s,e[2]=-a*l,e[6]=s,e[10]=a*o):"ZYX"===t.order?(b=a*h,w=a*c,T=s*h,E=s*c,e[0]=o*h,e[4]=T*l-w,e[8]=b*l+E,e[1]=o*c,e[5]=E*l+b,e[9]=w*l-T,e[2]=-l,e[6]=s*o,e[10]=a*o):"YZX"===t.order?(A=a*o,C=a*l,R=s*o,P=s*l,e[0]=o*h,e[4]=P-A*c,e[8]=R*c+C,e[1]=c,e[5]=a*h,e[9]=-s*h,e[2]=-l*h,e[6]=C*c+R,e[10]=A-P*c):"XZY"===t.order&&(I=a*o,L=a*l,U=s*o,N=s*l,e[0]=o*h,e[4]=-c,e[8]=l*h,e[1]=I*c+N,e[5]=a*h,e[9]=L*c-U,e[2]=U*c-L,e[6]=s*h,e[10]=N*c+I),e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(Ur,t,Nr)}lookAt(t,e,i){const n=this.elements;return Br.subVectors(t,e),0===Br.lengthSq()&&(Br.z=1),Br.normalize(),Dr.crossVectors(i,Br),0===Dr.lengthSq()&&(1===Math.abs(i.z)?Br.x+=1e-4:Br.z+=1e-4,Br.normalize(),Dr.crossVectors(i,Br)),Dr.normalize(),Or.crossVectors(Br,Dr),n[0]=Dr.x,n[4]=Or.x,n[8]=Br.x,n[1]=Dr.y,n[5]=Or.y,n[9]=Br.y,n[2]=Dr.z,n[6]=Or.z,n[10]=Br.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){var i=t.elements,n=e.elements;const r=this.elements;var a=i[0],s=i[4],o=i[8],l=i[12],h=i[1],c=i[5],u=i[9],d=i[13],p=i[2],m=i[6],f=i[10],g=i[14],v=i[3],_=i[7],y=i[11],x=i[15],M=n[0],S=n[4],b=n[8],w=n[12],T=n[1],E=n[5],A=n[9],C=n[13],R=n[2],P=n[6],I=n[10],L=n[14],U=n[3],N=n[7],D=n[11],O=n[15];return r[0]=a*M+s*T+o*R+l*U,r[4]=a*S+s*E+o*P+l*N,r[8]=a*b+s*A+o*I+l*D,r[12]=a*w+s*C+o*L+l*O,r[1]=h*M+c*T+u*R+d*U,r[5]=h*S+c*E+u*P+d*N,r[9]=h*b+c*A+u*I+d*D,r[13]=h*w+c*C+u*L+d*O,r[2]=p*M+m*T+f*R+g*U,r[6]=p*S+m*E+f*P+g*N,r[10]=p*b+m*A+f*I+g*D,r[14]=p*w+m*C+f*L+g*O,r[3]=v*M+_*T+y*R+x*U,r[7]=v*S+_*E+y*P+x*N,r[11]=v*b+_*A+y*I+x*D,r[15]=v*w+_*C+y*L+x*O,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){var t=this.elements,e=t[0],i=t[4],n=t[8],r=t[12],a=t[1],s=t[5],o=t[9],l=t[13],h=t[2],c=t[6],u=t[10],d=t[14],p,m,f,g;return t[3]*(+r*o*c-n*l*c-r*s*u+i*l*u+n*s*d-i*o*d)+t[7]*(+e*o*d-e*l*u+r*a*u-n*a*d+n*l*h-r*o*h)+t[11]*(+e*l*c-e*s*d-r*a*c+i*a*d+r*s*h-i*l*h)+t[15]*(-n*s*h-e*o*c+e*s*u+n*a*c-i*a*u+i*o*h)}transpose(){const t=this.elements;var e,e=t[1];return t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,i){const n=this.elements;return t.isVector3?(n[12]=t.x,n[13]=t.y,n[14]=t.z):(n[12]=t,n[13]=e,n[14]=i),this}invert(){const t=this.elements,e=t[0],i=t[1],n=t[2],r=t[3],a=t[4],s=t[5],o=t[6],l=t[7],h=t[8],c=t[9],u=t[10],d=t[11],p=t[12],m=t[13],f=t[14],g=t[15],v=c*f*l-m*u*l+m*o*d-s*f*d-c*o*g+s*u*g,_=p*u*l-h*f*l-p*o*d+a*f*d+h*o*g-a*u*g,y=h*m*l-p*c*l+p*s*d-a*m*d-h*s*g+a*c*g,x=p*c*o-h*m*o-p*s*u+a*m*u+h*s*f-a*c*f;var M=e*v+i*_+n*y+r*x;if(0==M)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);var S=1/M;return t[0]=v*S,t[1]=(m*u*r-c*f*r-m*n*d+i*f*d+c*n*g-i*u*g)*S,t[2]=(s*f*r-m*o*r+m*n*l-i*f*l-s*n*g+i*o*g)*S,t[3]=(c*o*r-s*u*r-c*n*l+i*u*l+s*n*d-i*o*d)*S,t[4]=_*S,t[5]=(h*f*r-p*u*r+p*n*d-e*f*d-h*n*g+e*u*g)*S,t[6]=(p*o*r-a*f*r-p*n*l+e*f*l+a*n*g-e*o*g)*S,t[7]=(a*u*r-h*o*r+h*n*l-e*u*l-a*n*d+e*o*d)*S,t[8]=y*S,t[9]=(p*c*r-h*m*r-p*i*d+e*m*d+h*i*g-e*c*g)*S,t[10]=(a*m*r-p*s*r+p*i*l-e*m*l-a*i*g+e*s*g)*S,t[11]=(h*s*r-a*c*r-h*i*l+e*c*l+a*i*d-e*s*d)*S,t[12]=x*S,t[13]=(h*m*n-p*c*n+p*i*u-e*m*u-h*i*f+e*c*f)*S,t[14]=(p*s*n-a*m*n-p*i*o+e*m*o+a*i*f-e*s*f)*S,t[15]=(a*c*n-h*s*n+h*i*o-e*c*o-a*i*u+e*s*u)*S,this}scale(t){const e=this.elements;var i=t.x,n=t.y,r=t.z;return e[0]*=i,e[4]*=n,e[8]*=r,e[1]*=i,e[5]*=n,e[9]*=r,e[2]*=i,e[6]*=n,e[10]*=r,e[3]*=i,e[7]*=n,e[11]*=r,this}getMaxScaleOnAxis(){var t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],n=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,i,n))}makeTranslation(t,e,i){return t.isVector3?this.set(1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1):this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this}makeRotationX(t){var e=Math.cos(t),i=Math.sin(t);return this.set(1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1),this}makeRotationY(t){var e=Math.cos(t),i=Math.sin(t);return this.set(e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1),this}makeRotationZ(t){var e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){var i=Math.cos(e),n=Math.sin(e),r=1-i,a=t.x,s=t.y,o=t.z,l=r*a,h=r*s;return this.set(l*a+i,l*s-n*o,l*o+n*s,0,l*s+n*o,h*s+i,h*o-n*a,0,l*o-n*s,h*o+n*a,r*o*o+i,0,0,0,0,1),this}makeScale(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this}makeShear(t,e,i,n,r,a){return this.set(1,i,r,0,t,1,a,0,e,n,1,0,0,0,0,1),this}compose(t,e,i){const n=this.elements;var r=e._x,a=e._y,s=e._z,o=e._w,l=r+r,h=a+a,c=s+s,u=r*l,d=r*h,p=r*c,m=a*h,f=a*c,g=s*c,v=o*l,_=o*h,y=o*c,x=i.x,M=i.y,S=i.z;return n[0]=(1-(m+g))*x,n[1]=(d+y)*x,n[2]=(p-_)*x,n[3]=0,n[4]=(d-y)*M,n[5]=(1-(u+g))*M,n[6]=(f+v)*M,n[7]=0,n[8]=(p+_)*S,n[9]=(f-v)*S,n[10]=(1-(u+m))*S,n[11]=0,n[12]=t.x,n[13]=t.y,n[14]=t.z,n[15]=1,this}decompose(t,e,i){var n=this.elements;let r=Ir.set(n[0],n[1],n[2]).length();var a=Ir.set(n[4],n[5],n[6]).length(),s=Ir.set(n[8],n[9],n[10]).length(),o;this.determinant()<0&&(r=-r),t.x=n[12],t.y=n[13],t.z=n[14],Lr.copy(this);var l=1/r,h=1/a,c=1/s;return Lr.elements[0]*=l,Lr.elements[1]*=l,Lr.elements[2]*=l,Lr.elements[4]*=h,Lr.elements[5]*=h,Lr.elements[6]*=h,Lr.elements[8]*=c,Lr.elements[9]*=c,Lr.elements[10]*=c,e.setFromRotationMatrix(Lr),i.x=r,i.y=a,i.z=s,this}makePerspective(t,e,i,n,r,a,s=Wi){const o=this.elements;var l=2*r/(e-t),h=2*r/(i-n),c=(e+t)/(e-t),u=(i+n)/(i-n);let d,p;if(s===Wi)d=-(a+r)/(a-r),p=-2*a*r/(a-r);else{if(s!==Xi)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+s);d=-a/(a-r),p=-a*r/(a-r)}return o[0]=l,o[4]=0,o[8]=c,o[12]=0,o[1]=0,o[5]=h,o[9]=u,o[13]=0,o[2]=0,o[6]=0,o[10]=d,o[14]=p,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}makeOrthographic(t,e,i,n,r,a,s=Wi){const o=this.elements;var l=1/(e-t),h=1/(i-n),c=1/(a-r),u=(e+t)*l,d=(i+n)*h;let p,m;if(s===Wi)p=(a+r)*c,m=-2*c;else{if(s!==Xi)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+s);p=r*c,m=-1*c}return o[0]=2*l,o[4]=0,o[8]=0,o[12]=-u,o[1]=0,o[5]=2*h,o[9]=0,o[13]=-d,o[2]=0,o[6]=0,o[10]=m,o[14]=-p,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}equals(t){var e=this.elements,i=t.elements;for(let t=0;t<16;t++)if(e[t]!==i[t])return!1;return!0}fromArray(e,i=0){for(let t=0;t<16;t++)this.elements[t]=e[t+i];return this}toArray(t=[],e=0){var i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t[e+9]=i[9],t[e+10]=i[10],t[e+11]=i[11],t[e+12]=i[12],t[e+13]=i[13],t[e+14]=i[14],t[e+15]=i[15],t}}const Ir=new tr,Lr=new Pr,Ur=new tr(0,0,0),Nr=new tr(1,1,1),Dr=new tr,Or=new tr,Br=new tr,Fr=new Pr,zr=new Qn;class kr{constructor(t=0,e=0,i=0,n=kr.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=e,this._z=i,this._order=n}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,i,n=this._order){return this._x=t,this._y=e,this._z=i,this._order=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,i=!0){var n=t.elements,r=n[0],a=n[4],s=n[8],o=n[1],l=n[5],h=n[9],c=n[2],u=n[6],d=n[10];switch(e){case"XYZ":this._y=Math.asin($i(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-h,d),this._z=Math.atan2(-a,r)):(this._x=Math.atan2(u,l),this._z=0);break;case"YXZ":this._x=Math.asin(-$i(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(s,d),this._z=Math.atan2(o,l)):(this._y=Math.atan2(-c,r),this._z=0);break;case"ZXY":this._x=Math.asin($i(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(-c,d),this._z=Math.atan2(-a,l)):(this._y=0,this._z=Math.atan2(o,r));break;case"ZYX":this._y=Math.asin(-$i(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(u,d),this._z=Math.atan2(o,r)):(this._x=0,this._z=Math.atan2(-a,l));break;case"YZX":this._z=Math.asin($i(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-h,l),this._y=Math.atan2(-c,r)):(this._x=0,this._y=Math.atan2(s,d));break;case"XZY":this._z=Math.asin(-$i(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(u,l),this._y=Math.atan2(s,r)):(this._x=Math.atan2(-h,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,!0===i&&this._onChangeCallback(),this}setFromQuaternion(t,e,i){return Fr.makeRotationFromQuaternion(t),this.setFromRotationMatrix(Fr,e,i)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return zr.setFromEuler(this),this.setFromQuaternion(zr,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}kr.DEFAULT_ORDER="XYZ";class Vr{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return 0!=(this.mask&t.mask)}isEnabled(t){return 0!=(this.mask&(1<<t|0))}}let Gr=0;const Hr=new tr,Wr=new Qn,Xr=new Pr,jr=new tr,qr=new tr,Yr=new tr,Zr=new Qn,Jr=new tr(1,0,0),Kr=new tr(0,1,0),$r=new tr(0,0,1),Qr={type:"added"},ta={type:"removed"},ea={type:"childadded",child:null},ia={type:"childremoved",child:null};class na extends ji{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Gr++}),this.uuid=Ki(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=na.DEFAULT_UP.clone();var t=new tr;const e=new kr,i=new Qn;var n=new tr(1,1,1);function r(){i.setFromEuler(e,!1)}function a(){e.setFromQuaternion(i,void 0,!1)}e._onChange(r),i._onChange(a),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new Pr},normalMatrix:{value:new Sn}}),this.matrix=new Pr,this.matrixWorld=new Pr,this.matrixAutoUpdate=na.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=na.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new Vr,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return Wr.setFromAxisAngle(t,e),this.quaternion.multiply(Wr),this}rotateOnWorldAxis(t,e){return Wr.setFromAxisAngle(t,e),this.quaternion.premultiply(Wr),this}rotateX(t){return this.rotateOnAxis(Jr,t)}rotateY(t){return this.rotateOnAxis(Kr,t)}rotateZ(t){return this.rotateOnAxis($r,t)}translateOnAxis(t,e){return Hr.copy(t).applyQuaternion(this.quaternion),this.position.add(Hr.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(Jr,t)}translateY(t){return this.translateOnAxis(Kr,t)}translateZ(t){return this.translateOnAxis($r,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(Xr.copy(this.matrixWorld).invert())}lookAt(t,e,i){t.isVector3?jr.copy(t):jr.set(t,e,i);var n=this.parent;this.updateWorldMatrix(!0,!1),qr.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Xr.lookAt(qr,jr,this.up):Xr.lookAt(jr,qr,this.up),this.quaternion.setFromRotationMatrix(Xr),n&&(Xr.extractRotation(n.matrixWorld),Wr.setFromRotationMatrix(Xr),this.quaternion.premultiply(Wr.invert()))}add(t){if(1<arguments.length){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return t===this?console.error("THREE.Object3D.add: object can't be added as a child of itself.",t):t&&t.isObject3D?(t.removeFromParent(),(t.parent=this).children.push(t),t.dispatchEvent(Qr),ea.child=t,this.dispatchEvent(ea),ea.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this}remove(t){if(1<arguments.length){for(let t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}var e=this.children.indexOf(t);return-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(ta),ia.child=t,this.dispatchEvent(ia),ia.child=null),this}removeFromParent(){const t=this.parent;return null!==t&&t.remove(this),this}clear(){return this.remove(...this.children)}attach(t){return this.updateWorldMatrix(!0,!1),Xr.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),Xr.multiply(t.parent.matrixWorld)),t.applyMatrix4(Xr),t.removeFromParent(),(t.parent=this).children.push(t),t.updateWorldMatrix(!1,!0),t.dispatchEvent(Qr),ea.child=t,this.dispatchEvent(ea),ea.child=null,this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(i,n){if(this[i]===n)return this;for(let t=0,e=this.children.length;t<e;t++){const a=this.children[t];var r=a.getObjectByProperty(i,n);if(void 0!==r)return r}}getObjectsByProperty(i,n,r=[]){this[i]===n&&r.push(this);const a=this.children;for(let t=0,e=a.length;t<e;t++)a[t].getObjectsByProperty(i,n,r);return r}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(qr,t,Yr),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(qr,Zr,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);var e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(i){i(this);const n=this.children;for(let t=0,e=n.length;t<e;t++)n[t].traverse(i)}traverseVisible(i){if(!1!==this.visible){i(this);const n=this.children;for(let t=0,e=n.length;t<e;t++)n[t].traverseVisible(i)}}traverseAncestors(t){const e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(i){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||i)&&(!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),i=!(this.matrixWorldNeedsUpdate=!1));var n=this.children;for(let t=0,e=n.length;t<e;t++){const r=n[t];r.updateMatrixWorld(i)}}updateWorldMatrix(t,e){const i=this.parent;if(!0===t&&null!==i&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),!0===e){var n=this.children;for(let t=0,e=n.length;t<e;t++){const r=n[t];r.updateWorldMatrix(!1,!0)}}}toJSON(i){var t=void 0===i||"string"==typeof i,e,n,r,a,s,o,l,h;const c={};t&&(i={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},c.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const u={};function d(t,e){return void 0===t[e.uuid]&&(t[e.uuid]=e.toJSON(i)),e.uuid}if(u.uuid=this.uuid,u.type=this.type,""!==this.name&&(u.name=this.name),!0===this.castShadow&&(u.castShadow=!0),!0===this.receiveShadow&&(u.receiveShadow=!0),!1===this.visible&&(u.visible=!1),!1===this.frustumCulled&&(u.frustumCulled=!1),0!==this.renderOrder&&(u.renderOrder=this.renderOrder),0<Object.keys(this.userData).length&&(u.userData=this.userData),u.layers=this.layers.mask,u.matrix=this.matrix.toArray(),u.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(u.matrixAutoUpdate=!1),this.isInstancedMesh&&(u.type="InstancedMesh",u.count=this.count,u.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(u.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(u.type="BatchedMesh",u.perObjectFrustumCulled=this.perObjectFrustumCulled,u.sortObjects=this.sortObjects,u.drawRanges=this._drawRanges,u.reservedRanges=this._reservedRanges,u.visibility=this._visibility,u.active=this._active,u.bounds=this._bounds.map(t=>({boxInitialized:t.boxInitialized,boxMin:t.box.min.toArray(),boxMax:t.box.max.toArray(),sphereInitialized:t.sphereInitialized,sphereRadius:t.sphere.radius,sphereCenter:t.sphere.center.toArray()})),u.maxInstanceCount=this._maxInstanceCount,u.maxVertexCount=this._maxVertexCount,u.maxIndexCount=this._maxIndexCount,u.geometryInitialized=this._geometryInitialized,u.geometryCount=this._geometryCount,u.matricesTexture=this._matricesTexture.toJSON(i),null!==this._colorsTexture&&(u.colorsTexture=this._colorsTexture.toJSON(i)),null!==this.boundingSphere&&(u.boundingSphere={center:u.boundingSphere.center.toArray(),radius:u.boundingSphere.radius}),null!==this.boundingBox&&(u.boundingBox={min:u.boundingBox.min.toArray(),max:u.boundingBox.max.toArray()})),this.isScene)this.background&&(this.background.isColor?u.background=this.background.toJSON():this.background.isTexture&&(u.background=this.background.toJSON(i).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(u.environment=this.environment.toJSON(i).uuid);else if(this.isMesh||this.isLine||this.isPoints){u.geometry=d(i.geometries,this.geometry);var p=this.geometry.parameters;if(void 0!==p&&void 0!==p.shapes){var m=p.shapes;if(Array.isArray(m))for(let t=0,e=m.length;t<e;t++){var f=m[t];d(i.shapes,f)}else d(i.shapes,m)}}if(this.isSkinnedMesh&&(u.bindMode=this.bindMode,u.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(d(i.skeletons,this.skeleton),u.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const _=[];for(let t=0,e=this.material.length;t<e;t++)_.push(d(i.materials,this.material[t]));u.material=_}else u.material=d(i.materials,this.material);if(0<this.children.length){u.children=[];for(let t=0;t<this.children.length;t++)u.children.push(this.children[t].toJSON(i).object)}if(0<this.animations.length){u.animations=[];for(let t=0;t<this.animations.length;t++){var g=this.animations[t];u.animations.push(d(i.animations,g))}}return t&&(e=v(i.geometries),n=v(i.materials),r=v(i.textures),a=v(i.images),s=v(i.shapes),o=v(i.skeletons),l=v(i.animations),h=v(i.nodes),0<e.length&&(c.geometries=e),0<n.length&&(c.materials=n),0<r.length&&(c.textures=r),0<a.length&&(c.images=a),0<s.length&&(c.shapes=s),0<o.length&&(c.skeletons=o),0<l.length&&(c.animations=l),0<h.length&&(c.nodes=h)),c.object=u,c;function v(t){const e=[];for(const i in t){const n=t[i];delete n.metadata,e.push(n)}return e}}clone(t){return(new this.constructor).copy(this,t)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let t=0;t<e.children.length;t++){const i=e.children[t];this.add(i.clone())}return this}}na.DEFAULT_UP=new tr(0,1,0),na.DEFAULT_MATRIX_AUTO_UPDATE=!0,na.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const ra=new tr,aa=new tr,sa=new tr,oa=new tr,la=new tr,ha=new tr,ca=new tr,ua=new tr,da=new tr,pa=new tr;class ma{constructor(t=new tr,e=new tr,i=new tr){this.a=t,this.b=e,this.c=i}static getNormal(t,e,i,n){n.subVectors(i,e),ra.subVectors(t,e),n.cross(ra);var r=n.lengthSq();return 0<r?n.multiplyScalar(1/Math.sqrt(r)):n.set(0,0,0)}static getBarycoord(t,e,i,n,r){ra.subVectors(n,e),aa.subVectors(i,e),sa.subVectors(t,e);var a=ra.dot(ra),s=ra.dot(aa),o=ra.dot(sa),l=aa.dot(aa),h=aa.dot(sa),c=a*l-s*s;if(0==c)return r.set(0,0,0),null;var u=1/c,d=(l*o-s*h)*u,p=(a*h-s*o)*u;return r.set(1-d-p,p,d)}static containsPoint(t,e,i,n){return null!==this.getBarycoord(t,e,i,n,oa)&&(0<=oa.x&&0<=oa.y&&oa.x+oa.y<=1)}static getInterpolation(t,e,i,n,r,a,s,o){return null===this.getBarycoord(t,e,i,n,oa)?(o.x=0,o.y=0,"z"in o&&(o.z=0),"w"in o&&(o.w=0),null):(o.setScalar(0),o.addScaledVector(r,oa.x),o.addScaledVector(a,oa.y),o.addScaledVector(s,oa.z),o)}static isFrontFacing(t,e,i,n){return ra.subVectors(i,e),aa.subVectors(t,e),ra.cross(aa).dot(n)<0}set(t,e,i){return this.a.copy(t),this.b.copy(e),this.c.copy(i),this}setFromPointsAndIndices(t,e,i,n){return this.a.copy(t[e]),this.b.copy(t[i]),this.c.copy(t[n]),this}setFromAttributeAndIndices(t,e,i,n){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,i),this.c.fromBufferAttribute(t,n),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return ra.subVectors(this.c,this.b),aa.subVectors(this.a,this.b),.5*ra.cross(aa).length()}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return ma.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return ma.getBarycoord(t,this.a,this.b,this.c,e)}getInterpolation(t,e,i,n,r){return ma.getInterpolation(t,this.a,this.b,this.c,e,i,n,r)}containsPoint(t){return ma.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return ma.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){var i=this.a,n=this.b,r=this.c;let a,s;la.subVectors(n,i),ha.subVectors(r,i),ua.subVectors(t,i);var o=la.dot(ua),l=ha.dot(ua);if(o<=0&&l<=0)return e.copy(i);da.subVectors(t,n);var h=la.dot(da),c=ha.dot(da);if(0<=h&&c<=h)return e.copy(n);var u=o*c-h*l;if(u<=0&&0<=o&&h<=0)return a=o/(o-h),e.copy(i).addScaledVector(la,a);pa.subVectors(t,r);var d=la.dot(pa),p=ha.dot(pa);if(0<=p&&d<=p)return e.copy(r);var m=d*l-o*p;if(m<=0&&0<=l&&p<=0)return s=l/(l-p),e.copy(i).addScaledVector(ha,s);var f=h*p-d*c;if(f<=0&&0<=c-h&&0<=d-p)return ca.subVectors(r,n),s=(c-h)/(c-h+(d-p)),e.copy(n).addScaledVector(ca,s);var g=1/(f+m+u);return a=m*g,s=u*g,e.copy(i).addScaledVector(la,a).addScaledVector(ha,s)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}const fa={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},ga={h:0,s:0,l:0},va={h:0,s:0,l:0};function _a(t,e,i){return i<0&&(i+=1),1<i&&--i,i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+6*(e-t)*(2/3-i):t}class ya{constructor(t,e,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,e,i)}set(t,e,i){var n;return void 0===e&&void 0===i?(n=t)&&n.isColor?this.copy(n):"number"==typeof n?this.setHex(n):"string"==typeof n&&this.setStyle(n):this.setRGB(t,e,i),this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,e=ei){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,On.toWorkingColorSpace(this,e),this}setRGB(t,e,i,n=On.workingColorSpace){return this.r=t,this.g=e,this.b=i,On.toWorkingColorSpace(this,n),this}setHSL(t,e,i,n=On.workingColorSpace){var r,a;return t=Qi(t,1),e=$i(e,0,1),i=$i(i,0,1),0===e?this.r=this.g=this.b=i:(this.r=_a(a=2*i-(r=i<=.5?i*(1+e):i+e-i*e),r,t+1/3),this.g=_a(a,r,t),this.b=_a(a,r,t-1/3)),On.toWorkingColorSpace(this,n),this}setStyle(e,i=ei){function n(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let r;if(r=/^(\w+)\(([^\)]*)\)/.exec(e)){let t;var a=r[1],s=r[2];switch(a){case"rgb":case"rgba":if(t=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return n(t[4]),this.setRGB(Math.min(255,parseInt(t[1],10))/255,Math.min(255,parseInt(t[2],10))/255,Math.min(255,parseInt(t[3],10))/255,i);if(t=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return n(t[4]),this.setRGB(Math.min(100,parseInt(t[1],10))/100,Math.min(100,parseInt(t[2],10))/100,Math.min(100,parseInt(t[3],10))/100,i);break;case"hsl":case"hsla":if(t=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return n(t[4]),this.setHSL(parseFloat(t[1])/360,parseFloat(t[2])/100,parseFloat(t[3])/100,i);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){const o=r[1];var t=o.length;if(3===t)return this.setRGB(parseInt(o.charAt(0),16)/15,parseInt(o.charAt(1),16)/15,parseInt(o.charAt(2),16)/15,i);if(6===t)return this.setHex(parseInt(o,16),i);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&0<e.length)return this.setColorName(e,i);return this}setColorName(t,e=ei){var i=fa[t.toLowerCase()];return void 0!==i?this.setHex(i,e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=Bn(t.r),this.g=Bn(t.g),this.b=Bn(t.b),this}copyLinearToSRGB(t){return this.r=Fn(t.r),this.g=Fn(t.g),this.b=Fn(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=ei){return On.fromWorkingColorSpace(xa.copy(this),t),65536*Math.round($i(255*xa.r,0,255))+256*Math.round($i(255*xa.g,0,255))+Math.round($i(255*xa.b,0,255))}getHexString(t=ei){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,e=On.workingColorSpace){On.fromWorkingColorSpace(xa.copy(this),e);var i=xa.r,n=xa.g,r=xa.b,a=Math.max(i,n,r),s=Math.min(i,n,r);let o,l;var h=(s+a)/2;if(s===a)o=0,l=0;else{var c=a-s;switch(l=h<=.5?c/(a+s):c/(2-a-s),a){case i:o=(n-r)/c+(n<r?6:0);break;case n:o=(r-i)/c+2;break;case r:o=(i-n)/c+4}o/=6}return t.h=o,t.s=l,t.l=h,t}getRGB(t,e=On.workingColorSpace){return On.fromWorkingColorSpace(xa.copy(this),e),t.r=xa.r,t.g=xa.g,t.b=xa.b,t}getStyle(t=ei){On.fromWorkingColorSpace(xa.copy(this),t);const e=xa.r,i=xa.g,n=xa.b;return t!==ei?`color(${t} ${e.toFixed(3)} ${i.toFixed(3)} ${n.toFixed(3)})`:`rgb(${Math.round(255*e)},${Math.round(255*i)},${Math.round(255*n)})`}offsetHSL(t,e,i){return this.getHSL(ga),this.setHSL(ga.h+t,ga.s+e,ga.l+i)}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,i){return this.r=t.r+(e.r-t.r)*i,this.g=t.g+(e.g-t.g)*i,this.b=t.b+(e.b-t.b)*i,this}lerpHSL(t,e){this.getHSL(ga),t.getHSL(va);var i=nn(ga.h,va.h,e),n=nn(ga.s,va.s,e),r=nn(ga.l,va.l,e);return this.setHSL(i,n,r),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){var e=this.r,i=this.g,n=this.b,r=t.elements;return this.r=r[0]*e+r[3]*i+r[6]*n,this.g=r[1]*e+r[4]*i+r[7]*n,this.b=r[2]*e+r[5]*i+r[8]*n,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const xa=new ya;ya.NAMES=fa;let Ma=0;class Sa extends ji{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Ma++}),this.uuid=Ki(),this.name="",this.type="Material",this.blending=wt,this.side=qt,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=Ft,this.blendDst=zt,this.blendEquation=Rt,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new ya(0,0,0),this.blendAlpha=0,this.depthFunc=ie,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=wi,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=ci,this.stencilZFail=ci,this.stencilZPass=ci,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){0<this._alphaTest!=0<t&&this.version++,this._alphaTest=t}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(void 0!==t)for(const i in t){var e=t[i];if(void 0!==e){const n=this[i];void 0!==n?n&&n.isColor?n.set(e):n&&n.isVector3&&e&&e.isVector3?n.copy(e):this[i]=e:console.warn(`THREE.Material: '${i}' is not a property of THREE.${this.type}.`)}else console.warn(`THREE.Material: parameter '${i}' has value of undefined.`)}}toJSON(t){var e=void 0===t||"string"==typeof t,i,n;e&&(t={textures:{},images:{}});const r={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function a(t){const e=[];for(const i in t){const n=t[i];delete n.metadata,e.push(n)}return e}return r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),void 0!==this.roughness&&(r.roughness=this.roughness),void 0!==this.metalness&&(r.metalness=this.metalness),void 0!==this.sheen&&(r.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(r.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(r.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),void 0!==this.emissiveIntensity&&1!==this.emissiveIntensity&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(r.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(r.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(r.shininess=this.shininess),void 0!==this.clearcoat&&(r.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(r.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(r.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(r.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(r.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,r.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.dispersion&&(r.dispersion=this.dispersion),void 0!==this.iridescence&&(r.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(r.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(r.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(r.iridescenceMap=this.iridescenceMap.toJSON(t).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(r.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(t).uuid),void 0!==this.anisotropy&&(r.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(r.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(r.anisotropyMap=this.anisotropyMap.toJSON(t).uuid),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(t).uuid,r.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(t).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(t).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(t).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(t).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(r.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(r.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(t).uuid,void 0!==this.combine&&(r.combine=this.combine)),void 0!==this.envMapRotation&&(r.envMapRotation=this.envMapRotation.toArray()),void 0!==this.envMapIntensity&&(r.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(r.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(r.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.transmission&&(r.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(r.transmissionMap=this.transmissionMap.toJSON(t).uuid),void 0!==this.thickness&&(r.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(r.thicknessMap=this.thicknessMap.toJSON(t).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(r.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(r.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(r.size=this.size),null!==this.shadowSide&&(r.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==wt&&(r.blending=this.blending),this.side!==qt&&(r.side=this.side),!0===this.vertexColors&&(r.vertexColors=!0),this.opacity<1&&(r.opacity=this.opacity),!0===this.transparent&&(r.transparent=!0),this.blendSrc!==Ft&&(r.blendSrc=this.blendSrc),this.blendDst!==zt&&(r.blendDst=this.blendDst),this.blendEquation!==Rt&&(r.blendEquation=this.blendEquation),null!==this.blendSrcAlpha&&(r.blendSrcAlpha=this.blendSrcAlpha),null!==this.blendDstAlpha&&(r.blendDstAlpha=this.blendDstAlpha),null!==this.blendEquationAlpha&&(r.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(r.blendColor=this.blendColor.getHex()),0!==this.blendAlpha&&(r.blendAlpha=this.blendAlpha),this.depthFunc!==ie&&(r.depthFunc=this.depthFunc),!1===this.depthTest&&(r.depthTest=this.depthTest),!1===this.depthWrite&&(r.depthWrite=this.depthWrite),!1===this.colorWrite&&(r.colorWrite=this.colorWrite),255!==this.stencilWriteMask&&(r.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==wi&&(r.stencilFunc=this.stencilFunc),0!==this.stencilRef&&(r.stencilRef=this.stencilRef),255!==this.stencilFuncMask&&(r.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==ci&&(r.stencilFail=this.stencilFail),this.stencilZFail!==ci&&(r.stencilZFail=this.stencilZFail),this.stencilZPass!==ci&&(r.stencilZPass=this.stencilZPass),!0===this.stencilWrite&&(r.stencilWrite=this.stencilWrite),void 0!==this.rotation&&0!==this.rotation&&(r.rotation=this.rotation),!0===this.polygonOffset&&(r.polygonOffset=!0),0!==this.polygonOffsetFactor&&(r.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(r.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(r.linewidth=this.linewidth),void 0!==this.dashSize&&(r.dashSize=this.dashSize),void 0!==this.gapSize&&(r.gapSize=this.gapSize),void 0!==this.scale&&(r.scale=this.scale),!0===this.dithering&&(r.dithering=!0),0<this.alphaTest&&(r.alphaTest=this.alphaTest),!0===this.alphaHash&&(r.alphaHash=!0),!0===this.alphaToCoverage&&(r.alphaToCoverage=!0),!0===this.premultipliedAlpha&&(r.premultipliedAlpha=!0),!0===this.forceSinglePass&&(r.forceSinglePass=!0),!0===this.wireframe&&(r.wireframe=!0),1<this.wireframeLinewidth&&(r.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(r.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(r.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(r.flatShading=!0),!1===this.visible&&(r.visible=!1),!1===this.toneMapped&&(r.toneMapped=!1),!1===this.fog&&(r.fog=!1),0<Object.keys(this.userData).length&&(r.userData=this.userData),e&&(i=a(t.textures),n=a(t.images),0<i.length&&(r.textures=i),0<n.length&&(r.images=n)),r}clone(){return(new this.constructor).copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.blendColor.copy(t.blendColor),this.blendAlpha=t.blendAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let i=null;if(null!==e){var n=e.length;i=new Array(n);for(let t=0;t!==n;++t)i[t]=e[t].clone()}return this.clippingPlanes=i,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaHash=t.alphaHash,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.forceSinglePass=t.forceSinglePass,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){!0===t&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}onBeforeRender(){console.warn("Material: onBeforeRender() has been removed.")}}class ba extends Sa{constructor(t){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new ya(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new kr,this.combine=c,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}const wa=Ta();function Ta(){var t=new ArrayBuffer(4),e=new Float32Array(t),i=new Uint32Array(t);const n=new Uint32Array(512),r=new Uint32Array(512);for(let t=0;t<256;++t){var a=t-127;a<-27?(n[t]=0,n[256|t]=32768,r[t]=24,r[256|t]=24):a<-14?(n[t]=1024>>-a-14,n[256|t]=1024>>-a-14|32768,r[t]=-a-1,r[256|t]=-a-1):a<=15?(n[t]=15+a<<10,n[256|t]=15+a<<10|32768,r[t]=13,r[256|t]=13):a<128?(n[t]=31744,n[256|t]=64512,r[t]=24,r[256|t]=24):(n[t]=31744,n[256|t]=64512,r[t]=13,r[256|t]=13)}const s=new Uint32Array(2048),o=new Uint32Array(64),l=new Uint32Array(64);for(let i=1;i<1024;++i){let t=i<<13,e=0;for(;0==(8388608&t);)t<<=1,e-=8388608;t&=-8388609,e+=947912704,s[i]=t|e}for(let t=1024;t<2048;++t)s[t]=939524096+(t-1024<<13);for(let t=1;t<31;++t)o[t]=t<<23;o[31]=1199570944,o[32]=2147483648;for(let t=33;t<63;++t)o[t]=2147483648+(t-32<<23);o[63]=3347054592;for(let t=1;t<64;++t)32!==t&&(l[t]=1024);return{floatView:e,uint32View:i,baseTable:n,shiftTable:r,mantissaTable:s,exponentTable:o,offsetTable:l}}function Ea(t){65504<Math.abs(t)&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),t=$i(t,-65504,65504),wa.floatView[0]=t;var e=wa.uint32View[0],i=e>>23&511;return wa.baseTable[i]+((8388607&e)>>wa.shiftTable[i])}function Aa(t){var e=t>>10;return wa.uint32View[0]=wa.mantissaTable[wa.offsetTable[e]+(1023&t)]+wa.exponentTable[e],wa.floatView[0]}const Ca={toHalfFloat:Ea,fromHalfFloat:Aa},Ra=new tr,Pa=new Mn;class Ia{constructor(t,e,i=!1){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=i,this.usage=Ui,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=ct,this.version=0}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}get updateRange(){return Pn("THREE.BufferAttribute: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(t){return this.usage=t,this}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this.gpuType=t.gpuType,this}copyAt(i,n,r){i*=this.itemSize,r*=n.itemSize;for(let t=0,e=this.itemSize;t<e;t++)this.array[i+t]=n.array[r+t];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(i){if(2===this.itemSize)for(let t=0,e=this.count;t<e;t++)Pa.fromBufferAttribute(this,t),Pa.applyMatrix3(i),this.setXY(t,Pa.x,Pa.y);else if(3===this.itemSize)for(let t=0,e=this.count;t<e;t++)Ra.fromBufferAttribute(this,t),Ra.applyMatrix3(i),this.setXYZ(t,Ra.x,Ra.y,Ra.z);return this}applyMatrix4(i){for(let t=0,e=this.count;t<e;t++)Ra.fromBufferAttribute(this,t),Ra.applyMatrix4(i),this.setXYZ(t,Ra.x,Ra.y,Ra.z);return this}applyNormalMatrix(i){for(let t=0,e=this.count;t<e;t++)Ra.fromBufferAttribute(this,t),Ra.applyNormalMatrix(i),this.setXYZ(t,Ra.x,Ra.y,Ra.z);return this}transformDirection(i){for(let t=0,e=this.count;t<e;t++)Ra.fromBufferAttribute(this,t),Ra.transformDirection(i),this.setXYZ(t,Ra.x,Ra.y,Ra.z);return this}set(t,e=0){return this.array.set(t,e),this}getComponent(t,e){let i=this.array[t*this.itemSize+e];return this.normalized&&(i=_n(i,this.array)),i}setComponent(t,e,i){return this.normalized&&(i=yn(i,this.array)),this.array[t*this.itemSize+e]=i,this}getX(t){let e=this.array[t*this.itemSize];return this.normalized&&(e=_n(e,this.array)),e}setX(t,e){return this.normalized&&(e=yn(e,this.array)),this.array[t*this.itemSize]=e,this}getY(t){let e=this.array[t*this.itemSize+1];return this.normalized&&(e=_n(e,this.array)),e}setY(t,e){return this.normalized&&(e=yn(e,this.array)),this.array[t*this.itemSize+1]=e,this}getZ(t){let e=this.array[t*this.itemSize+2];return this.normalized&&(e=_n(e,this.array)),e}setZ(t,e){return this.normalized&&(e=yn(e,this.array)),this.array[t*this.itemSize+2]=e,this}getW(t){let e=this.array[t*this.itemSize+3];return this.normalized&&(e=_n(e,this.array)),e}setW(t,e){return this.normalized&&(e=yn(e,this.array)),this.array[t*this.itemSize+3]=e,this}setXY(t,e,i){return t*=this.itemSize,this.normalized&&(e=yn(e,this.array),i=yn(i,this.array)),this.array[t+0]=e,this.array[t+1]=i,this}setXYZ(t,e,i,n){return t*=this.itemSize,this.normalized&&(e=yn(e,this.array),i=yn(i,this.array),n=yn(n,this.array)),this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=n,this}setXYZW(t,e,i,n,r){return t*=this.itemSize,this.normalized&&(e=yn(e,this.array),i=yn(i,this.array),n=yn(n,this.array),r=yn(r,this.array)),this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=n,this.array[t+3]=r,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(t.name=this.name),this.usage!==Ui&&(t.usage=this.usage),t}}class La extends Ia{constructor(t,e,i){super(new Int8Array(t),e,i)}}class Ua extends Ia{constructor(t,e,i){super(new Uint8Array(t),e,i)}}class Na extends Ia{constructor(t,e,i){super(new Uint8ClampedArray(t),e,i)}}class Da extends Ia{constructor(t,e,i){super(new Int16Array(t),e,i)}}class Oa extends Ia{constructor(t,e,i){super(new Uint16Array(t),e,i)}}class Ba extends Ia{constructor(t,e,i){super(new Int32Array(t),e,i)}}class Fa extends Ia{constructor(t,e,i){super(new Uint32Array(t),e,i)}}class za extends Ia{constructor(t,e,i){super(new Uint16Array(t),e,i),this.isFloat16BufferAttribute=!0}getX(t){let e=Aa(this.array[t*this.itemSize]);return this.normalized&&(e=_n(e,this.array)),e}setX(t,e){return this.normalized&&(e=yn(e,this.array)),this.array[t*this.itemSize]=Ea(e),this}getY(t){let e=Aa(this.array[t*this.itemSize+1]);return this.normalized&&(e=_n(e,this.array)),e}setY(t,e){return this.normalized&&(e=yn(e,this.array)),this.array[t*this.itemSize+1]=Ea(e),this}getZ(t){let e=Aa(this.array[t*this.itemSize+2]);return this.normalized&&(e=_n(e,this.array)),e}setZ(t,e){return this.normalized&&(e=yn(e,this.array)),this.array[t*this.itemSize+2]=Ea(e),this}getW(t){let e=Aa(this.array[t*this.itemSize+3]);return this.normalized&&(e=_n(e,this.array)),e}setW(t,e){return this.normalized&&(e=yn(e,this.array)),this.array[t*this.itemSize+3]=Ea(e),this}setXY(t,e,i){return t*=this.itemSize,this.normalized&&(e=yn(e,this.array),i=yn(i,this.array)),this.array[t+0]=Ea(e),this.array[t+1]=Ea(i),this}setXYZ(t,e,i,n){return t*=this.itemSize,this.normalized&&(e=yn(e,this.array),i=yn(i,this.array),n=yn(n,this.array)),this.array[t+0]=Ea(e),this.array[t+1]=Ea(i),this.array[t+2]=Ea(n),this}setXYZW(t,e,i,n,r){return t*=this.itemSize,this.normalized&&(e=yn(e,this.array),i=yn(i,this.array),n=yn(n,this.array),r=yn(r,this.array)),this.array[t+0]=Ea(e),this.array[t+1]=Ea(i),this.array[t+2]=Ea(n),this.array[t+3]=Ea(r),this}}class ka extends Ia{constructor(t,e,i){super(new Float32Array(t),e,i)}}let Va=0;const Ga=new Pr,Ha=new na,Wa=new tr,Xa=new nr,ja=new nr,qa=new tr;class Ya extends ji{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Va++}),this.uuid=Ki(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(wn(t)?Fa:Oa)(t,1):this.index=t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return void 0!==this.attributes[t]}addGroup(t,e,i=0){this.groups.push({start:t,count:e,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0);const i=this.attributes.normal;var n;void 0!==i&&(n=(new Sn).getNormalMatrix(t),i.applyNormalMatrix(n),i.needsUpdate=!0);const r=this.attributes.tangent;return void 0!==r&&(r.transformDirection(t),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(t){return Ga.makeRotationFromQuaternion(t),this.applyMatrix4(Ga),this}rotateX(t){return Ga.makeRotationX(t),this.applyMatrix4(Ga),this}rotateY(t){return Ga.makeRotationY(t),this.applyMatrix4(Ga),this}rotateZ(t){return Ga.makeRotationZ(t),this.applyMatrix4(Ga),this}translate(t,e,i){return Ga.makeTranslation(t,e,i),this.applyMatrix4(Ga),this}scale(t,e,i){return Ga.makeScale(t,e,i),this.applyMatrix4(Ga),this}lookAt(t){return Ha.lookAt(t),Ha.updateMatrix(),this.applyMatrix4(Ha.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Wa).negate(),this.translate(Wa.x,Wa.y,Wa.z),this}setFromPoints(i){const n=[];for(let t=0,e=i.length;t<e;t++){var r=i[t];n.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new ka(n,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new nr);var t=this.attributes.position,i=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),void this.boundingBox.set(new tr(-1/0,-1/0,-1/0),new tr(1/0,1/0,1/0));if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),i)for(let t=0,e=i.length;t<e;t++){var n=i[t];Xa.setFromBufferAttribute(n),this.morphTargetsRelative?(qa.addVectors(this.boundingBox.min,Xa.min),this.boundingBox.expandByPoint(qa),qa.addVectors(this.boundingBox.max,Xa.max),this.boundingBox.expandByPoint(qa)):(this.boundingBox.expandByPoint(Xa.min),this.boundingBox.expandByPoint(Xa.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Mr);var n=this.attributes.position,r=this.morphAttributes.position;if(n&&n.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),void this.boundingSphere.set(new tr,1/0);if(n){const l=this.boundingSphere.center;if(Xa.setFromBufferAttribute(n),r)for(let t=0,e=r.length;t<e;t++){var a=r[t];ja.setFromBufferAttribute(a),this.morphTargetsRelative?(qa.addVectors(Xa.min,ja.min),Xa.expandByPoint(qa),qa.addVectors(Xa.max,ja.max),Xa.expandByPoint(qa)):(Xa.expandByPoint(ja.min),Xa.expandByPoint(ja.max))}Xa.getCenter(l);let i=0;for(let t=0,e=n.count;t<e;t++)qa.fromBufferAttribute(n,t),i=Math.max(i,l.distanceToSquared(qa));if(r)for(let t=0,e=r.length;t<e;t++){var s=r[t],o=this.morphTargetsRelative;for(let t=0,e=s.count;t<e;t++)qa.fromBufferAttribute(s,t),o&&(Wa.fromBufferAttribute(n,t),qa.add(Wa)),i=Math.max(i,l.distanceToSquared(qa))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const n=this.index;var t=this.attributes;if(null!==n&&void 0!==t.position&&void 0!==t.normal&&void 0!==t.uv){const d=t.position,p=t.normal,m=t.uv;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new Ia(new Float32Array(4*d.count),4));const f=this.getAttribute("tangent"),g=[],v=[];for(let t=0;t<d.count;t++)g[t]=new tr,v[t]=new tr;const _=new tr,y=new tr,x=new tr,M=new Mn,S=new Mn,b=new Mn,w=new tr,T=new tr;let i=this.groups;0===i.length&&(i=[{start:0,count:n.count}]);for(let t=0,e=i.length;t<e;++t){var r=i[t],a=r.start,s;for(let t=a,e=a+r.count;t<e;t+=3)c(n.getX(t+0),n.getX(t+1),n.getX(t+2))}const E=new tr,A=new tr,C=new tr,R=new tr;for(let t=0,e=i.length;t<e;++t){var o=i[t],l=o.start,h;for(let t=l,e=l+o.count;t<e;t+=3)u(n.getX(t+0)),u(n.getX(t+1)),u(n.getX(t+2))}function c(t,e,i){_.fromBufferAttribute(d,t),y.fromBufferAttribute(d,e),x.fromBufferAttribute(d,i),M.fromBufferAttribute(m,t),S.fromBufferAttribute(m,e),b.fromBufferAttribute(m,i),y.sub(_),x.sub(_),S.sub(M),b.sub(M);var n=1/(S.x*b.y-b.x*S.y);isFinite(n)&&(w.copy(y).multiplyScalar(b.y).addScaledVector(x,-S.y).multiplyScalar(n),T.copy(x).multiplyScalar(S.x).addScaledVector(y,-b.x).multiplyScalar(n),g[t].add(w),g[e].add(w),g[i].add(w),v[t].add(T),v[e].add(T),v[i].add(T))}function u(t){C.fromBufferAttribute(p,t),R.copy(C);var e=g[t];E.copy(e),E.sub(C.multiplyScalar(C.dot(e))).normalize(),A.crossVectors(R,e);var i,n=A.dot(v[t])<0?-1:1;f.setXYZW(t,E.x,E.y,E.z,n)}}else console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)")}computeVertexNormals(){const n=this.index;var r=this.getAttribute("position");if(void 0!==r){let i=this.getAttribute("normal");if(void 0===i)i=new Ia(new Float32Array(3*r.count),3),this.setAttribute("normal",i);else for(let t=0,e=i.count;t<e;t++)i.setXYZ(t,0,0,0);const l=new tr,h=new tr,c=new tr,u=new tr,d=new tr,p=new tr,m=new tr,f=new tr;if(n)for(let t=0,e=n.count;t<e;t+=3){var a=n.getX(t+0),s=n.getX(t+1),o=n.getX(t+2);l.fromBufferAttribute(r,a),h.fromBufferAttribute(r,s),c.fromBufferAttribute(r,o),m.subVectors(c,h),f.subVectors(l,h),m.cross(f),u.fromBufferAttribute(i,a),d.fromBufferAttribute(i,s),p.fromBufferAttribute(i,o),u.add(m),d.add(m),p.add(m),i.setXYZ(a,u.x,u.y,u.z),i.setXYZ(s,d.x,d.y,d.z),i.setXYZ(o,p.x,p.y,p.z)}else for(let t=0,e=r.count;t<e;t+=3)l.fromBufferAttribute(r,t+0),h.fromBufferAttribute(r,t+1),c.fromBufferAttribute(r,t+2),m.subVectors(c,h),f.subVectors(l,h),m.cross(f),i.setXYZ(t+0,m.x,m.y,m.z),i.setXYZ(t+1,m.x,m.y,m.z),i.setXYZ(t+2,m.x,m.y,m.z);this.normalizeNormals(),i.needsUpdate=!0}}normalizeNormals(){const i=this.attributes.normal;for(let t=0,e=i.count;t<e;t++)qa.fromBufferAttribute(i,t),qa.normalize(),i.setXYZ(t,qa.x,qa.y,qa.z)}toNonIndexed(){function i(i,n){const r=i.array;var a=i.itemSize,t=i.normalized;const s=new r.constructor(n.length*a);let o=0,l=0;for(let t=0,e=n.length;t<e;t++){o=i.isInterleavedBufferAttribute?n[t]*i.data.stride+i.offset:n[t]*a;for(let t=0;t<a;t++)s[l++]=r[o++]}return new Ia(s,a,t)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const n=new Ya;var r=this.index.array,t=this.attributes;for(const d in t){var e,a=i(t[d],r);n.setAttribute(d,a)}var s=this.morphAttributes;for(const p in s){const m=[];var o=s[p];for(let t=0,e=o.length;t<e;t++){var l,h=i(o[t],r);m.push(h)}n.morphAttributes[p]=m}n.morphTargetsRelative=this.morphTargetsRelative;var c=this.groups;for(let t=0,e=c.length;t<e;t++){var u=c[t];n.addGroup(u.start,u.count,u.materialIndex)}return n}toJSON(){const i={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),0<Object.keys(this.userData).length&&(i.userData=this.userData),void 0!==this.parameters){var t=this.parameters;for(const h in t)void 0!==t[h]&&(i[h]=t[h]);return i}i.data={attributes:{}};var e=this.index;null!==e&&(i.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});var n=this.attributes;for(const c in n){const u=n[c];i.data.attributes[c]=u.toJSON(i.data)}const r={};let a=!1;for(const d in this.morphAttributes){var s=this.morphAttributes[d];const p=[];for(let t=0,e=s.length;t<e;t++){const m=s[t];p.push(m.toJSON(i.data))}0<p.length&&(r[d]=p,a=!0)}a&&(i.data.morphAttributes=r,i.data.morphTargetsRelative=this.morphTargetsRelative);var o=this.groups;0<o.length&&(i.data.groups=JSON.parse(JSON.stringify(o)));const l=this.boundingSphere;return null!==l&&(i.data.boundingSphere={center:l.center.toArray(),radius:l.radius}),i}clone(){return(new this.constructor).copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;var i={};this.name=t.name;const e=t.index;null!==e&&this.setIndex(e.clone(i));var n=t.attributes;for(const h in n){const c=n[h];this.setAttribute(h,c.clone(i))}var r=t.morphAttributes;for(const u in r){const d=[],p=r[u];for(let t=0,e=p.length;t<e;t++)d.push(p[t].clone(i));this.morphAttributes[u]=d}this.morphTargetsRelative=t.morphTargetsRelative;var a=t.groups;for(let t=0,e=a.length;t<e;t++){var s=a[t];this.addGroup(s.start,s.count,s.materialIndex)}const o=t.boundingBox;null!==o&&(this.boundingBox=o.clone());const l=t.boundingSphere;return null!==l&&(this.boundingSphere=l.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const Za=new Pr,Ja=new Rr,Ka=new Mr,$a=new tr,Qa=new tr,ts=new tr,es=new tr,is=new tr,ns=new tr,rs=new Mn,as=new Mn,ss=new Mn,os=new tr,ls=new tr,hs=new tr,cs=new tr,us=new tr;class ds extends na{constructor(t=new Ya,e=new ba){super(),this.isMesh=!0,this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}updateMorphTargets(){var t,e=this.geometry.morphAttributes,i=Object.keys(e);if(0<i.length){var n=e[i[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,e=n.length;t<e;t++){var r=n[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=t}}}}getVertexPosition(i,n){var t=this.geometry,e=t.attributes.position,r=t.morphAttributes.position,a=t.morphTargetsRelative;n.fromBufferAttribute(e,i);var s=this.morphTargetInfluences;if(r&&s){ns.set(0,0,0);for(let t=0,e=r.length;t<e;t++){var o=s[t],l=r[t];0!==o&&(is.fromBufferAttribute(l,i),a?ns.addScaledVector(is,o):ns.addScaledVector(is.sub(n),o))}n.add(ns)}return n}raycast(t,e){const i=this.geometry;var n=this.material,r=this.matrixWorld;if(void 0!==n){if(null===i.boundingSphere&&i.computeBoundingSphere(),Ka.copy(i.boundingSphere),Ka.applyMatrix4(r),Ja.copy(t.ray).recast(t.near),!1===Ka.containsPoint(Ja.origin)){if(null===Ja.intersectSphere(Ka,$a))return;if(Ja.origin.distanceToSquared($a)>(t.far-t.near)**2)return}Za.copy(r).invert(),Ja.copy(t.ray).applyMatrix4(Za),null!==i.boundingBox&&!1===Ja.intersectsBox(i.boundingBox)||this._computeIntersections(t,e,Ja)}}_computeIntersections(i,n,r){let a;var t=this.geometry,s=this.material;const o=t.index;var l=t.attributes.position,h=t.attributes.uv,c=t.attributes.uv1,u=t.attributes.normal,d=t.groups,p=t.drawRange,e,m,f,g;if(null!==o)if(Array.isArray(s))for(let t=0,e=d.length;t<e;t++){var v=d[t],_=s[v.materialIndex],y,x;for(let t=Math.max(v.start,p.start),e=Math.min(o.count,Math.min(v.start+v.count,p.start+p.count));t<e;t+=3){var M=o.getX(t),S=o.getX(t+1),b=o.getX(t+2);a=ms(this,_,i,r,h,c,u,M,S,b),a&&(a.faceIndex=Math.floor(t/3),a.face.materialIndex=v.materialIndex,n.push(a))}}else for(let t=Math.max(0,p.start),e=Math.min(o.count,p.start+p.count);t<e;t+=3){var w=o.getX(t),T=o.getX(t+1),E=o.getX(t+2);a=ms(this,s,i,r,h,c,u,w,T,E),a&&(a.faceIndex=Math.floor(t/3),n.push(a))}else if(void 0!==l){if(Array.isArray(s))for(let t=0,e=d.length;t<e;t++){var A=d[t],C=s[A.materialIndex],R,P;for(let t=Math.max(A.start,p.start),e=Math.min(l.count,Math.min(A.start+A.count,p.start+p.count));t<e;t+=3){var I=t,L=t+1,U=t+2;a=ms(this,C,i,r,h,c,u,I,L,U),a&&(a.faceIndex=Math.floor(t/3),a.face.materialIndex=A.materialIndex,n.push(a))}}else for(let t=Math.max(0,p.start),e=Math.min(l.count,p.start+p.count);t<e;t+=3){var N=t,D=t+1,O=t+2;a=ms(this,s,i,r,h,c,u,N,D,O),a&&(a.faceIndex=Math.floor(t/3),n.push(a))}}}}function ps(t,e,i,n,r,a,s,o){let l;if(l=e.side===Yt?n.intersectTriangle(s,a,r,!0,o):n.intersectTriangle(r,a,s,e.side===qt,o),null===l)return null;us.copy(o),us.applyMatrix4(t.matrixWorld);var h=i.ray.origin.distanceTo(us);return h<i.near||h>i.far?null:{distance:h,point:us.clone(),object:t}}function ms(t,e,i,n,r,a,s,o,l,h){t.getVertexPosition(o,Qa),t.getVertexPosition(l,ts),t.getVertexPosition(h,es);const c=ps(t,e,i,n,Qa,ts,es,cs);var u;return c&&(r&&(rs.fromBufferAttribute(r,o),as.fromBufferAttribute(r,l),ss.fromBufferAttribute(r,h),c.uv=ma.getInterpolation(cs,Qa,ts,es,rs,as,ss,new Mn)),a&&(rs.fromBufferAttribute(a,o),as.fromBufferAttribute(a,l),ss.fromBufferAttribute(a,h),c.uv1=ma.getInterpolation(cs,Qa,ts,es,rs,as,ss,new Mn)),s&&(os.fromBufferAttribute(s,o),ls.fromBufferAttribute(s,l),hs.fromBufferAttribute(s,h),c.normal=ma.getInterpolation(cs,Qa,ts,es,os,ls,hs,new tr),0<c.normal.dot(n.direction)&&c.normal.multiplyScalar(-1)),u={a:o,b:l,c:h,normal:new tr,materialIndex:0},ma.getNormal(Qa,ts,es,u.normal),c.face=u),c}class fs extends Ya{constructor(t=1,e=1,i=1,n=1,r=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:i,widthSegments:n,heightSegments:r,depthSegments:a};const A=this;n=Math.floor(n),r=Math.floor(r),a=Math.floor(a);const C=[],R=[],P=[],I=[];let L=0,U=0;function s(i,n,r,a,s,t,e,o,l,h,c){var u=t/l,d=e/h,p=t/2,m=e/2,f=o/2,g=l+1,v=h+1;let _=0,y=0;const x=new tr;for(let e=0;e<v;e++){var M=e*d-m;for(let t=0;t<g;t++){var S=t*u-p;x[i]=S*a,x[n]=M*s,x[r]=f,R.push(x.x,x.y,x.z),x[i]=0,x[n]=0,x[r]=0<o?1:-1,P.push(x.x,x.y,x.z),I.push(t/l),I.push(1-e/h),_+=1}}for(let e=0;e<h;e++)for(let t=0;t<l;t++){var b=L+t+g*e,w=L+t+g*(e+1),T=L+(t+1)+g*(e+1),E=L+(t+1)+g*e;C.push(b,w,E),C.push(w,T,E),y+=6}A.addGroup(U,y,c),U+=y,L+=_}s("z","y","x",-1,-1,i,e,t,a,r,0),s("z","y","x",1,-1,i,e,-t,a,r,1),s("x","z","y",1,1,t,i,e,n,a,2),s("x","z","y",1,-1,t,i,-e,n,a,3),s("x","y","z",1,-1,t,e,i,n,r,4),s("x","y","z",-1,-1,t,e,-i,n,r,5),this.setIndex(C),this.setAttribute("position",new ka(R,3)),this.setAttribute("normal",new ka(P,3)),this.setAttribute("uv",new ka(I,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new fs(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}function gs(t){const e={};for(const i in t){e[i]={};for(const n in t[i]){const r=t[i][n];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[i][n]=null):e[i][n]=r.clone():Array.isArray(r)?e[i][n]=r.slice():e[i][n]=r}}return e}function vs(e){const i={};for(let t=0;t<e.length;t++){var n=gs(e[t]);for(const r in n)i[r]=n[r]}return i}function _s(e){const i=[];for(let t=0;t<e.length;t++)i.push(e[t].clone());return i}function ys(t){var e=t.getRenderTarget();return null===e?t.outputColorSpace:!0===e.isXRRenderTarget?e.texture.colorSpace:On.workingColorSpace}const xs={clone:gs,merge:vs};var Ms="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",Ss="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",bs,ws,Ts,Es,As,Cs,Rs,Ps,Is,Ls,Us,Ns,Ds,Os,Bs,Fs,zs,ks,Vs,Gs,Hs,Ws,Xs,js,qs,Ys,Zs,Js,Ks,$s,Qs,to,eo,io,no,ro,ao,so,oo,lo,ho,co,uo,po,mo,fo,go,vo,_o,yo,xo,Mo,So,bo,wo,To,Eo,Ao,Co,Ro,Po,Io,Lo,Uo,No,Do,Oo,Bo,Fo,zo,ko,Vo,Go,Ho,Wo,Xo,jo,qo,Yo,Zo,Jo,Ko,$o,Qo,tl,el,il,nl,rl,al,sl,ol,ll,hl,cl,ul,dl,pl,ml,fl,gl,vl,_l,yl,xl,Ml,Sl,bl,wl,Tl,El,Al,Cl,Rl,Pl,Il,Ll,Ul,Nl,Dl,Ol,Bl,Fl,zl,kl,Vl,Gl,Hl,Wl,Xl,jl,ql,Yl,Zl,Jl,Kl,$l,Ql,th,eh,ih;class nh extends Sa{constructor(t){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=Ms,this.fragmentShader=Ss,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==t&&this.setValues(t)}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=gs(t.uniforms),this.uniformsGroups=_s(t.uniformsGroups),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.fog=t.fog,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){const e=super.toJSON(t);e.glslVersion=this.glslVersion,e.uniforms={};for(const r in this.uniforms){var i;const a=this.uniforms[r].value;a&&a.isTexture?e.uniforms[r]={type:"t",value:a.toJSON(t).uuid}:a&&a.isColor?e.uniforms[r]={type:"c",value:a.getHex()}:a&&a.isVector2?e.uniforms[r]={type:"v2",value:a.toArray()}:a&&a.isVector3?e.uniforms[r]={type:"v3",value:a.toArray()}:a&&a.isVector4?e.uniforms[r]={type:"v4",value:a.toArray()}:a&&a.isMatrix3?e.uniforms[r]={type:"m3",value:a.toArray()}:a&&a.isMatrix4?e.uniforms[r]={type:"m4",value:a.toArray()}:e.uniforms[r]={value:a}}0<Object.keys(this.defines).length&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e.lights=this.lights,e.clipping=this.clipping;const n={};for(const s in this.extensions)!0===this.extensions[s]&&(n[s]=!0);return 0<Object.keys(n).length&&(e.extensions=n),e}}class rh extends na{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Pr,this.projectionMatrix=new Pr,this.projectionMatrixInverse=new Pr,this.coordinateSystem=Wi}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this.coordinateSystem=t.coordinateSystem,this}getWorldDirection(t){return super.getWorldDirection(t).negate()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}const ah=new tr,sh=new Mn,oh=new Mn;class lh extends rh{constructor(t=50,e=1,i=.1,n=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=i,this.far=n,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){var e=.5*this.getFilmHeight()/t;this.fov=2*Ji*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){var t=Math.tan(.5*Zi*this.fov);return.5*this.getFilmHeight()/t}getEffectiveFOV(){return 2*Ji*Math.atan(Math.tan(.5*Zi*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(t,e,i){ah.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),e.set(ah.x,ah.y).multiplyScalar(-t/ah.z),ah.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),i.set(ah.x,ah.y).multiplyScalar(-t/ah.z)}getViewSize(t,e){return this.getViewBounds(t,sh,oh),e.subVectors(oh,sh)}setViewOffset(t,e,i,n,r,a){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){var t=this.near;let e=t*Math.tan(.5*Zi*this.fov)/this.zoom,i=2*e,n=this.aspect*i,r=-.5*n;var a=this.view,s,o;null!==this.view&&this.view.enabled&&(s=a.fullWidth,o=a.fullHeight,r+=a.offsetX*n/s,e-=a.offsetY*i/o,n*=a.width/s,i*=a.height/o);var l=this.filmOffset;0!==l&&(r+=t*l/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+n,e,e-i,t,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}const hh=-90,ch=1;class uh extends na{constructor(t,e,i){super(),this.type="CubeCamera",this.renderTarget=i,this.coordinateSystem=null,this.activeMipmapLevel=0;const n=new lh(hh,1,t,e);n.layers=this.layers,this.add(n);const r=new lh(hh,1,t,e);r.layers=this.layers,this.add(r);const a=new lh(hh,1,t,e);a.layers=this.layers,this.add(a);const s=new lh(hh,1,t,e);s.layers=this.layers,this.add(s);const o=new lh(hh,1,t,e);o.layers=this.layers,this.add(o);const l=new lh(hh,1,t,e);l.layers=this.layers,this.add(l)}updateCoordinateSystem(){var t=this.coordinateSystem,e=this.children.concat();const[i,n,r,a,s,o]=e;for(const l of e)this.remove(l);if(t===Wi)i.up.set(0,1,0),i.lookAt(1,0,0),n.up.set(0,1,0),n.lookAt(-1,0,0),r.up.set(0,0,-1),r.lookAt(0,1,0),a.up.set(0,0,1),a.lookAt(0,-1,0),s.up.set(0,1,0),s.lookAt(0,0,1),o.up.set(0,1,0),o.lookAt(0,0,-1);else{if(t!==Xi)throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+t);i.up.set(0,-1,0),i.lookAt(-1,0,0),n.up.set(0,-1,0),n.lookAt(1,0,0),r.up.set(0,0,1),r.lookAt(0,1,0),a.up.set(0,0,-1),a.lookAt(0,-1,0),s.up.set(0,-1,0),s.lookAt(0,0,1),o.up.set(0,-1,0),o.lookAt(0,0,-1)}for(const h of e)this.add(h),h.updateMatrixWorld()}update(t,e){null===this.parent&&this.updateMatrixWorld();const{renderTarget:i,activeMipmapLevel:n}=this;this.coordinateSystem!==t.coordinateSystem&&(this.coordinateSystem=t.coordinateSystem,this.updateCoordinateSystem());var[r,a,s,o,l,h]=this.children,c=t.getRenderTarget(),u=t.getActiveCubeFace(),d=t.getActiveMipmapLevel(),p=t.xr.enabled;t.xr.enabled=!1;var m=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,t.setRenderTarget(i,0,n),t.render(e,r),t.setRenderTarget(i,1,n),t.render(e,a),t.setRenderTarget(i,2,n),t.render(e,s),t.setRenderTarget(i,3,n),t.render(e,o),t.setRenderTarget(i,4,n),t.render(e,l),i.texture.generateMipmaps=m,t.setRenderTarget(i,5,n),t.render(e,h),t.setRenderTarget(c,u,d),t.xr.enabled=p,i.texture.needsPMREMUpdate=!0}}class dh extends Xn{constructor(t,e,i,n,r,a,s,o,l,h){super(t=void 0!==t?t:[],e=void 0!==e?e:b,i,n,r,a,s,o,l,h),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(t){this.image=t}}class ph extends Yn{constructor(t=1,e={}){super(t,t,e),this.isWebGLCubeRenderTarget=!0;var i={width:t,height:t,depth:1},n=[i,i,i,i,i,i];this.texture=new dh(n,e.mapping,e.wrapS,e.wrapT,e.magFilter,e.minFilter,e.format,e.type,e.anisotropy,e.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==e.generateMipmaps&&e.generateMipmaps,this.texture.minFilter=void 0!==e.minFilter?e.minFilter:lt}fromEquirectangularTexture(t,e){this.texture.type=e.type,this.texture.colorSpace=e.colorSpace,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;var i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},n=new fs(5,5,5);const r=new nh({name:"CubemapFromEquirect",uniforms:gs(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:Yt,blending:bt});r.uniforms.tEquirect.value=e;const a=new ds(n,r);var s=e.minFilter;e.minFilter===le&&(e.minFilter=lt);const o=new uh(1,10,this);return o.update(t,a),e.minFilter=s,a.geometry.dispose(),a.material.dispose(),this}clear(e,i,n,r){var t=e.getRenderTarget();for(let t=0;t<6;t++)e.setRenderTarget(this,t),e.clear(i,n,r);e.setRenderTarget(t)}}const mh=new tr,fh=new tr,gh=new Sn;class vh{constructor(t=new tr(1,0,0),e=0){this.isPlane=!0,this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,i,n){return this.normal.set(t,e,i),this.constant=n,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,i){var n=mh.subVectors(i,e).cross(fh.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(n,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){var t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(t).addScaledVector(this.normal,-this.distanceToPoint(t))}intersectLine(t,e){var i=t.delta(mh),n=this.normal.dot(i);if(0===n)return 0===this.distanceToPoint(t.start)?e.copy(t.start):null;var r=-(t.start.dot(this.normal)+this.constant)/n;return r<0||1<r?null:e.copy(t.start).addScaledVector(i,r)}intersectsLine(t){var e=this.distanceToPoint(t.start),i=this.distanceToPoint(t.end);return e<0&&0<i||i<0&&0<e}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){var i=e||gh.getNormalMatrix(t);const n=this.coplanarPoint(mh).applyMatrix4(t);var r=this.normal.applyMatrix3(i).normalize();return this.constant=-n.dot(r),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const _h=new Mr,yh=new tr;class xh{constructor(t=new vh,e=new vh,i=new vh,n=new vh,r=new vh,a=new vh){this.planes=[t,e,i,n,r,a]}set(t,e,i,n,r,a){const s=this.planes;return s[0].copy(t),s[1].copy(e),s[2].copy(i),s[3].copy(n),s[4].copy(r),s[5].copy(a),this}copy(e){const i=this.planes;for(let t=0;t<6;t++)i[t].copy(e.planes[t]);return this}setFromProjectionMatrix(t,e=Wi){const i=this.planes;var n=t.elements,r=n[0],a=n[1],s=n[2],o=n[3],l=n[4],h=n[5],c=n[6],u=n[7],d=n[8],p=n[9],m=n[10],f=n[11],g=n[12],v=n[13],_=n[14],y=n[15];if(i[0].setComponents(o-r,u-l,f-d,y-g).normalize(),i[1].setComponents(o+r,u+l,f+d,y+g).normalize(),i[2].setComponents(o+a,u+h,f+p,y+v).normalize(),i[3].setComponents(o-a,u-h,f-p,y-v).normalize(),i[4].setComponents(o-s,u-c,f-m,y-_).normalize(),e===Wi)i[5].setComponents(o+s,u+c,f+m,y+_).normalize();else{if(e!==Xi)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+e);i[5].setComponents(s,c,m,_).normalize()}return this}intersectsObject(t){if(void 0!==t.boundingSphere)null===t.boundingSphere&&t.computeBoundingSphere(),_h.copy(t.boundingSphere).applyMatrix4(t.matrixWorld);else{const e=t.geometry;null===e.boundingSphere&&e.computeBoundingSphere(),_h.copy(e.boundingSphere).applyMatrix4(t.matrixWorld)}return this.intersectsSphere(_h)}intersectsSprite(t){return _h.center.set(0,0,0),_h.radius=.7071067811865476,_h.applyMatrix4(t.matrixWorld),this.intersectsSphere(_h)}intersectsSphere(t){const e=this.planes;var i=t.center,n=-t.radius,r;for(let t=0;t<6;t++){if(e[t].distanceToPoint(i)<n)return!1}return!0}intersectsBox(e){var i=this.planes;for(let t=0;t<6;t++){const n=i[t];if(yh.x=(0<n.normal.x?e.max:e.min).x,yh.y=(0<n.normal.y?e.max:e.min).y,yh.z=(0<n.normal.z?e.max:e.min).z,n.distanceToPoint(yh)<0)return!1}return!0}containsPoint(e){const i=this.planes;for(let t=0;t<6;t++)if(i[t].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function Mh(){let i=null,t=!1,n=null,r=null;function a(t,e){n(t,e),r=i.requestAnimationFrame(a)}return{start:function(){!0!==t&&null!==n&&(r=i.requestAnimationFrame(a),t=!0)},stop:function(){i.cancelAnimationFrame(r),t=!1},setAnimationLoop:function(t){n=t},setContext:function(t){i=t}}}function Sh(o){const r=new WeakMap;function a(t,e){var i=t.array,n=t.usage,r=i.byteLength,a=o.createBuffer();o.bindBuffer(e,a),o.bufferData(e,i,n),t.onUploadCallback();let s;if(i instanceof Float32Array)s=o.FLOAT;else if(i instanceof Uint16Array)s=t.isFloat16BufferAttribute?o.HALF_FLOAT:o.UNSIGNED_SHORT;else if(i instanceof Int16Array)s=o.SHORT;else if(i instanceof Uint32Array)s=o.UNSIGNED_INT;else if(i instanceof Int32Array)s=o.INT;else if(i instanceof Int8Array)s=o.BYTE;else if(i instanceof Uint8Array)s=o.UNSIGNED_BYTE;else{if(!(i instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+i);s=o.UNSIGNED_BYTE}return{buffer:a,type:s,bytesPerElement:i.BYTES_PER_ELEMENT,version:t.version,size:r}}function s(t,e,i){var n=e.array;const r=e._updateRange;var a=e.updateRanges;if(o.bindBuffer(i,t),-1===r.count&&0===a.length&&o.bufferSubData(i,0,n),0!==a.length){for(let t=0,e=a.length;t<e;t++){var s=a[t];o.bufferSubData(i,s.start*n.BYTES_PER_ELEMENT,n,s.start,s.count)}e.clearUpdateRanges()}-1!==r.count&&(o.bufferSubData(i,r.offset*n.BYTES_PER_ELEMENT,n,r.offset,r.count),r.count=-1),e.onUploadCallback()}function t(t){return t.isInterleavedBufferAttribute&&(t=t.data),r.get(t)}function e(t){t.isInterleavedBufferAttribute&&(t=t.data);var e=r.get(t);e&&(o.deleteBuffer(e.buffer),r.delete(t))}function i(t,e){if((t=t.isInterleavedBufferAttribute?t.data:t).isGLBufferAttribute){var i=r.get(t);(!i||i.version<t.version)&&r.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version})}else{const n=r.get(t);if(void 0===n)r.set(t,a(t,e));else if(n.version<t.version){if(n.size!==t.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");s(n.buffer,t,e),n.version=t.version}}}return{get:t,remove:e,update:i}}class bh extends Ya{constructor(t=1,e=1,i=1,n=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:i,heightSegments:n};var r=t/2,a=e/2,s=Math.floor(i),o=Math.floor(n),l=s+1,h=o+1,c=t/s,u=e/o;const d=[],p=[],m=[],f=[];for(let e=0;e<h;e++){var g=e*u-a;for(let t=0;t<l;t++){var v=t*c-r;p.push(v,-g,0),m.push(0,0,1),f.push(t/s),f.push(1-e/o)}}for(let e=0;e<o;e++)for(let t=0;t<s;t++){var _=t+l*e,y=t+l*(e+1),x=t+1+l*(e+1),M=t+1+l*e;d.push(_,y,M),d.push(y,x,M)}this.setIndex(d),this.setAttribute("position",new ka(p,3)),this.setAttribute("normal",new ka(m,3)),this.setAttribute("uv",new ka(f,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new bh(t.width,t.height,t.widthSegments,t.heightSegments)}}const wh={alphahash_fragment:"#ifdef USE_ALPHAHASH\n\tif ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;\n#endif",alphahash_pars_fragment:"#ifdef USE_ALPHAHASH\n\tconst float ALPHA_HASH_SCALE = 0.05;\n\tfloat hash2D( vec2 value ) {\n\t\treturn fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );\n\t}\n\tfloat hash3D( vec3 value ) {\n\t\treturn hash2D( vec2( hash2D( value.xy ), value.z ) );\n\t}\n\tfloat getAlphaHashThreshold( vec3 position ) {\n\t\tfloat maxDeriv = max(\n\t\t\tlength( dFdx( position.xyz ) ),\n\t\t\tlength( dFdy( position.xyz ) )\n\t\t);\n\t\tfloat pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );\n\t\tvec2 pixScales = vec2(\n\t\t\texp2( floor( log2( pixScale ) ) ),\n\t\t\texp2( ceil( log2( pixScale ) ) )\n\t\t);\n\t\tvec2 alpha = vec2(\n\t\t\thash3D( floor( pixScales.x * position.xyz ) ),\n\t\t\thash3D( floor( pixScales.y * position.xyz ) )\n\t\t);\n\t\tfloat lerpFactor = fract( log2( pixScale ) );\n\t\tfloat x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;\n\t\tfloat a = min( lerpFactor, 1.0 - lerpFactor );\n\t\tvec3 cases = vec3(\n\t\t\tx * x / ( 2.0 * a * ( 1.0 - a ) ),\n\t\t\t( x - 0.5 * a ) / ( 1.0 - a ),\n\t\t\t1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )\n\t\t);\n\t\tfloat threshold = ( x < ( 1.0 - a ) )\n\t\t\t? ( ( x < a ) ? cases.x : cases.y )\n\t\t\t: cases.z;\n\t\treturn clamp( threshold , 1.0e-6, 1.0 );\n\t}\n#endif",alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\t#ifdef ALPHA_TO_COVERAGE\n\tdiffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );\n\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\tif ( diffuseColor.a < alphaTest ) discard;\n\t#endif\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_CLEARCOAT ) \n\t\tclearcoatSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_SHEEN ) \n\t\tsheenSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometryNormal, geometryViewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",batching_pars_vertex:"#ifdef USE_BATCHING\n\t#if ! defined( GL_ANGLE_multi_draw )\n\t#define gl_DrawID _gl_DrawID\n\tuniform int _gl_DrawID;\n\t#endif\n\tuniform highp sampler2D batchingTexture;\n\tuniform highp usampler2D batchingIdTexture;\n\tmat4 getBatchingMatrix( const in float i ) {\n\t\tint size = textureSize( batchingTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n\tfloat getIndirectIndex( const in int i ) {\n\t\tint size = textureSize( batchingIdTexture, 0 ).x;\n\t\tint x = i % size;\n\t\tint y = i / size;\n\t\treturn float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );\n\t}\n#endif\n#ifdef USE_BATCHING_COLOR\n\tuniform sampler2D batchingColorTexture;\n\tvec3 getBatchingColor( const in float i ) {\n\t\tint size = textureSize( batchingColorTexture, 0 ).x;\n\t\tint j = int( i );\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\treturn texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;\n\t}\n#endif",batching_vertex:"#ifdef USE_BATCHING\n\tmat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );\n#endif",begin_vertex:"vec3 transformed = vec3( position );\n#ifdef USE_ALPHAHASH\n\tvPosition = vec3( position );\n#endif",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"float G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n} // validated",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\treturn vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vBumpMapUv );\n\t\tvec2 dSTdy = dFdy( vBumpMapUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );\n\t\tvec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#ifdef ALPHA_TO_COVERAGE\n\t\tfloat distanceToPlane, distanceGradient;\n\t\tfloat clipOpacity = 1.0;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\tclipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\tif ( clipOpacity == 0.0 ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tfloat unionClipOpacity = 1.0;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\t\tunionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tclipOpacity *= 1.0 - unionClipOpacity;\n\t\t#endif\n\t\tdiffuseColor.a *= clipOpacity;\n\t\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tbool clipped = true;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tif ( clipped ) discard;\n\t\t#endif\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif\n#ifdef USE_BATCHING_COLOR\n\tvec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );\n\tvColor.xyz *= batchingColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\n#ifdef USE_ALPHAHASH\n\tvarying vec3 vPosition;\n#endif\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n} // validated",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = objectTangent;\n#endif\n#ifdef USE_BATCHING\n\tmat3 bm = mat3( batchingMatrix );\n\ttransformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );\n\ttransformedNormal = bm * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = bm * transformedTangent;\n\t#endif\n#endif\n#ifdef USE_INSTANCING\n\tmat3 im = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );\n\ttransformedNormal = im * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = im * transformedTangent;\n\t#endif\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\ttransformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",colorspace_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment:"\nconst mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(\n\tvec3( 0.8224621, 0.177538, 0.0 ),\n\tvec3( 0.0331941, 0.9668058, 0.0 ),\n\tvec3( 0.0170827, 0.0723974, 0.9105199 )\n);\nconst mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.2249401, - 0.2249404, 0.0 ),\n\tvec3( - 0.0420569, 1.0420571, 0.0 ),\n\tvec3( - 0.0196376, - 0.0786361, 1.0982735 )\n);\nvec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {\n\treturn vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );\n}\nvec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {\n\treturn vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );\n}\nvec4 LinearTransferOETF( in vec4 value ) {\n\treturn value;\n}\nvec4 sRGBTransferOETF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform mat3 envMapRotation;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#ifdef USE_ENVMAP\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\t#ifdef USE_ANISOTROPY\n\t\tvec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {\n\t\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\t\tvec3 bentNormal = cross( bitangent, viewDir );\n\t\t\t\tbentNormal = normalize( cross( bentNormal, bitangent ) );\n\t\t\t\tbentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );\n\t\t\t\treturn getIBLRadiance( viewDir, bentNormal, roughness );\n\t\t\t#else\n\t\t\t\treturn vec3( 0.0 );\n\t\t\t#endif\n\t\t}\n\t#endif\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\n#if defined( USE_LIGHT_PROBES )\n\tuniform vec3 lightProbe[ 9 ];\n#endif\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif ( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef USE_SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULAR_COLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n\t\t#endif\n\t\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_DISPERSION\n\tmaterial.dispersion = dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\t#ifdef USE_ANISOTROPYMAP\n\t\tmat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );\n\t\tvec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;\n\t\tvec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;\n\t#else\n\t\tvec2 anisotropyV = anisotropyVector;\n\t#endif\n\tmaterial.anisotropy = length( anisotropyV );\n\tif( material.anisotropy == 0.0 ) {\n\t\tanisotropyV = vec2( 1.0, 0.0 );\n\t} else {\n\t\tanisotropyV /= material.anisotropy;\n\t\tmaterial.anisotropy = saturate( material.anisotropy );\n\t}\n\tmaterial.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );\n\tmaterial.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;\n\tmaterial.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\tfloat dispersion;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat anisotropy;\n\t\tfloat alphaT;\n\t\tvec3 anisotropyT;\n\t\tvec3 anisotropyB;\n\t#endif\n};\nvec3 clearcoatSpecularDirect = vec3( 0.0 );\nvec3 clearcoatSpecularIndirect = vec3( 0.0 );\nvec3 sheenSpecularDirect = vec3( 0.0 );\nvec3 sheenSpecularIndirect = vec3(0.0 );\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\n#ifdef USE_ANISOTROPY\n\tfloat V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {\n\t\tfloat gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );\n\t\tfloat gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );\n\t\tfloat v = 0.5 / ( gv + gl );\n\t\treturn saturate(v);\n\t}\n\tfloat D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {\n\t\tfloat a2 = alphaT * alphaB;\n\t\thighp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );\n\t\thighp float v2 = dot( v, v );\n\t\tfloat w2 = a2 / v2;\n\t\treturn RECIPROCAL_PI * a2 * pow2 ( w2 );\n\t}\n#endif\n#ifdef USE_CLEARCOAT\n\tvec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n\t\tvec3 f0 = material.clearcoatF0;\n\t\tfloat f90 = material.clearcoatF90;\n\t\tfloat roughness = material.clearcoatRoughness;\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n\tvec3 f0 = material.specularColor;\n\tfloat f90 = material.specularF90;\n\tfloat roughness = material.roughness;\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t#ifdef USE_IRIDESCENCE\n\t\tF = mix( F, material.iridescenceFresnel, material.iridescence );\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat dotTL = dot( material.anisotropyT, lightDir );\n\t\tfloat dotTV = dot( material.anisotropyT, viewDir );\n\t\tfloat dotTH = dot( material.anisotropyT, halfDir );\n\t\tfloat dotBL = dot( material.anisotropyB, lightDir );\n\t\tfloat dotBV = dot( material.anisotropyB, viewDir );\n\t\tfloat dotBH = dot( material.anisotropyB, halfDir );\n\t\tfloat V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );\n\t\tfloat D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );\n\t#else\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t#endif\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometryNormal;\n\t\tvec3 viewDir = geometryViewDir;\n\t\tvec3 position = geometryPosition;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nvec3 geometryPosition = - vViewPosition;\nvec3 geometryNormal = normal;\nvec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\nvec3 geometryClearcoatNormal = vec3( 0.0 );\n#ifdef USE_CLEARCOAT\n\tgeometryClearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometryViewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometryPosition, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometryPosition, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if defined( USE_LIGHT_PROBES )\n\t\tirradiance += getLightProbeIrradiance( lightProbe, geometryNormal );\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometryNormal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\t#ifdef USE_ANISOTROPY\n\t\tradiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );\n\t#else\n\t\tradiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF )\n\tgl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\tvFragDepth = 1.0 + gl_Position.w;\n\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t#if defined( USE_POINTS_UV )\n\t\tvec2 uv = vUv;\n\t#else\n\t\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_POINTS_UV )\n\tvarying vec2 vUv;\n#else\n\t#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t\tuniform mat3 uvTransform;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphinstance_vertex:"#ifdef USE_INSTANCING_MORPH\n\tfloat morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\tfloat morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tmorphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;\n\t}\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t}\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_INSTANCING_MORPH\n\t\tuniform float morphTargetBaseInfluence;\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t#endif\n\tuniform sampler2DArray morphTargetsTexture;\n\tuniform ivec2 morphTargetsTextureSize;\n\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t}\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t}\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal *= faceDirection;\n\t#endif\n#endif\n#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn = getTangentFrame( - vViewPosition, normal,\n\t\t#if defined( USE_NORMALMAP )\n\t\t\tvNormalMapUv\n\t\t#elif defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tvClearcoatNormalMapUv\n\t\t#else\n\t\t\tvUv\n\t\t#endif\n\t\t);\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn[0] *= faceDirection;\n\t\ttbn[1] *= faceDirection;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn2[0] *= faceDirection;\n\t\ttbn2[1] *= faceDirection;\n\t#endif\n#endif\nvec3 nonPerturbedNormal = normal;",normal_fragment_maps:"#ifdef USE_NORMALMAP_OBJECTSPACE\n\tnormal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n\tvec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\tnormal = normalize( tbn * mapN );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef USE_NORMALMAP_OBJECTSPACE\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )\n\tmat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( uv.st );\n\t\tvec2 st1 = dFdy( uv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n\t\treturn mat3( T * scale, B * scale, N );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = nonPerturbedNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\tclearcoatNormal = normalize( tbn2 * clearcoatMapN );\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",opaque_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;\nconst float Inv255 = 1. / 255.;\nconst vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );\nconst vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );\nconst vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );\nconst vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );\nvec4 packDepthToRGBA( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec4( 0., 0., 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec4( 1., 1., 1., 1. );\n\tfloat vuf;\n\tfloat af = modf( v * PackFactors.a, vuf );\n\tfloat bf = modf( vuf * ShiftRight8, vuf );\n\tfloat gf = modf( vuf * ShiftRight8, vuf );\n\treturn vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );\n}\nvec3 packDepthToRGB( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec3( 0., 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec3( 1., 1., 1. );\n\tfloat vuf;\n\tfloat bf = modf( v * PackFactors.b, vuf );\n\tfloat gf = modf( vuf * ShiftRight8, vuf );\n\treturn vec3( vuf * Inv255, gf * PackUpscale, bf );\n}\nvec2 packDepthToRG( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec2( 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec2( 1., 1. );\n\tfloat vuf;\n\tfloat gf = modf( v * 256., vuf );\n\treturn vec2( vuf * Inv255, gf );\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors4 );\n}\nfloat unpackRGBToDepth( const in vec3 v ) {\n\treturn dot( v, UnpackFactors3 );\n}\nfloat unpackRGToDepth( const in vec2 v ) {\n\treturn v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;\n}\nvec4 pack2HalfToRGBA( const in vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( const in vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn depth * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * depth - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_BATCHING\n\tmvPosition = batchingMatrix * mvPosition;\n#endif\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n\tuniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn mix( 1.0, shadow, shadowIntensity );\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tfloat shadow = 1.0;\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\t\n\t\tfloat lightToPositionLength = length( lightToPosition );\n\t\tif ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {\n\t\t\tfloat dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\t\tdp += shadowBias;\n\t\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\t\tshadow = (\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t\t) * ( 1.0 / 9.0 );\n\t\t\t#else\n\t\t\t\tshadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t\t#endif\n\t\t}\n\t\treturn mix( 1.0, shadow, shadowIntensity );\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tuniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tint size = textureSize( boneTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn saturate( toneMappingExposure * color );\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nconst mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.6605, - 0.1246, - 0.0182 ),\n\tvec3( - 0.5876, 1.1329, - 0.1006 ),\n\tvec3( - 0.0728, - 0.0083, 1.1187 )\n);\nconst mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(\n\tvec3( 0.6274, 0.0691, 0.0164 ),\n\tvec3( 0.3293, 0.9195, 0.0880 ),\n\tvec3( 0.0433, 0.0113, 0.8956 )\n);\nvec3 agxDefaultContrastApprox( vec3 x ) {\n\tvec3 x2 = x * x;\n\tvec3 x4 = x2 * x2;\n\treturn + 15.5 * x4 * x2\n\t\t- 40.14 * x4 * x\n\t\t+ 31.96 * x4\n\t\t- 6.868 * x2 * x\n\t\t+ 0.4298 * x2\n\t\t+ 0.1191 * x\n\t\t- 0.00232;\n}\nvec3 AgXToneMapping( vec3 color ) {\n\tconst mat3 AgXInsetMatrix = mat3(\n\t\tvec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),\n\t\tvec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),\n\t\tvec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )\n\t);\n\tconst mat3 AgXOutsetMatrix = mat3(\n\t\tvec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),\n\t\tvec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),\n\t\tvec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )\n\t);\n\tconst float AgxMinEv = - 12.47393;\tconst float AgxMaxEv = 4.026069;\n\tcolor *= toneMappingExposure;\n\tcolor = LINEAR_SRGB_TO_LINEAR_REC2020 * color;\n\tcolor = AgXInsetMatrix * color;\n\tcolor = max( color, 1e-10 );\tcolor = log2( color );\n\tcolor = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );\n\tcolor = clamp( color, 0.0, 1.0 );\n\tcolor = agxDefaultContrastApprox( color );\n\tcolor = AgXOutsetMatrix * color;\n\tcolor = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );\n\tcolor = LINEAR_REC2020_TO_LINEAR_SRGB * color;\n\tcolor = clamp( color, 0.0, 1.0 );\n\treturn color;\n}\nvec3 NeutralToneMapping( vec3 color ) {\n\tconst float StartCompression = 0.8 - 0.04;\n\tconst float Desaturation = 0.15;\n\tcolor *= toneMappingExposure;\n\tfloat x = min( color.r, min( color.g, color.b ) );\n\tfloat offset = x < 0.08 ? x - 6.25 * x * x : 0.04;\n\tcolor -= offset;\n\tfloat peak = max( color.r, max( color.g, color.b ) );\n\tif ( peak < StartCompression ) return color;\n\tfloat d = 1. - StartCompression;\n\tfloat newPeak = 1. - d * d / ( peak + d - StartCompression );\n\tcolor *= newPeak / peak;\n\tfloat g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );\n\treturn mix( color, vec3( newPeak ), g );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmitted = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tfloat w0( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n\t}\n\tfloat w1( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n\t}\n\tfloat w2( float a ){\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n\t}\n\tfloat w3( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * a * a );\n\t}\n\tfloat g0( float a ) {\n\t\treturn w0( a ) + w1( a );\n\t}\n\tfloat g1( float a ) {\n\t\treturn w2( a ) + w3( a );\n\t}\n\tfloat h0( float a ) {\n\t\treturn - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n\t}\n\tfloat h1( float a ) {\n\t\treturn 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n\t}\n\tvec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n\t\tuv = uv * texelSize.zw + 0.5;\n\t\tvec2 iuv = floor( uv );\n\t\tvec2 fuv = fract( uv );\n\t\tfloat g0x = g0( fuv.x );\n\t\tfloat g1x = g1( fuv.x );\n\t\tfloat h0x = h0( fuv.x );\n\t\tfloat h1x = h1( fuv.x );\n\t\tfloat h0y = h0( fuv.y );\n\t\tfloat h1y = h1( fuv.y );\n\t\tvec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\treturn g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n\t\t\tg1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n\t}\n\tvec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n\t\tvec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n\t\tvec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n\t\tvec2 fLodSizeInv = 1.0 / fLodSize;\n\t\tvec2 cLodSizeInv = 1.0 / cLodSize;\n\t\tvec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n\t\tvec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n\t\treturn mix( fSample, cSample, fract( lod ) );\n\t}\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\treturn textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n\t}\n\tvec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn vec3( 1.0 );\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec4 transmittedLight;\n\t\tvec3 transmittance;\n\t\t#ifdef USE_DISPERSION\n\t\t\tfloat halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;\n\t\t\tvec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );\n\t\t\tfor ( int i = 0; i < 3; i ++ ) {\n\t\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );\n\t\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\t\n\t\t\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\t\trefractionCoords += 1.0;\n\t\t\t\trefractionCoords /= 2.0;\n\t\t\n\t\t\t\tvec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );\n\t\t\t\ttransmittedLight[ i ] = transmissionSample[ i ];\n\t\t\t\ttransmittedLight.a += transmissionSample.a;\n\t\t\t\ttransmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];\n\t\t\t}\n\t\t\ttransmittedLight.a /= 3.0;\n\t\t\n\t\t#else\n\t\t\n\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\trefractionCoords += 1.0;\n\t\t\trefractionCoords /= 2.0;\n\t\t\ttransmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\t\ttransmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\t\n\t\t#endif\n\t\tvec3 attenuatedColor = transmittance * transmittedLight.rgb;\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\tfloat transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );\n\t}\n#endif",uv_pars_fragment:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_pars_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tuniform mat3 mapTransform;\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform mat3 alphaMapTransform;\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tuniform mat3 lightMapTransform;\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tuniform mat3 aoMapTransform;\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tuniform mat3 bumpMapTransform;\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tuniform mat3 normalMapTransform;\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tuniform mat3 displacementMapTransform;\n\tvarying vec2 vDisplacementMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tuniform mat3 emissiveMapTransform;\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tuniform mat3 metalnessMapTransform;\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tuniform mat3 roughnessMapTransform;\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tuniform mat3 anisotropyMapTransform;\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tuniform mat3 clearcoatMapTransform;\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform mat3 clearcoatNormalMapTransform;\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform mat3 clearcoatRoughnessMapTransform;\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tuniform mat3 sheenColorMapTransform;\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tuniform mat3 sheenRoughnessMapTransform;\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tuniform mat3 iridescenceMapTransform;\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform mat3 iridescenceThicknessMapTransform;\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tuniform mat3 specularMapTransform;\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tuniform mat3 specularColorMapTransform;\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tuniform mat3 specularIntensityMapTransform;\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvUv = vec3( uv, 1 ).xy;\n#endif\n#ifdef USE_MAP\n\tvMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ALPHAMAP\n\tvAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_LIGHTMAP\n\tvLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_AOMAP\n\tvAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_BUMPMAP\n\tvBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_NORMALMAP\n\tvNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tvDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_METALNESSMAP\n\tvMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULARMAP\n\tvSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tvTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_THICKNESSMAP\n\tvThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_BATCHING\n\t\tworldPosition = batchingMatrix * worldPosition;\n\t#endif\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nuniform mat3 backgroundRotation;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",depth_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#elif DEPTH_PACKING == 3202\n\t\tgl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );\n\t#elif DEPTH_PACKING == 3203\n\t\tgl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef USE_SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULAR_COLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_DISPERSION\n\tuniform float dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\tuniform vec2 anisotropyVector;\n\t#ifdef USE_ANISOTROPYMAP\n\t\tuniform sampler2D anisotropyMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;\n\t#endif\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\nvoid main() {\n\t#ifdef USE_POINTS_UV\n\t\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\t#endif\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}"},Th={common:{diffuse:{value:new ya(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Sn},alphaMap:{value:null},alphaMapTransform:{value:new Sn},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Sn}},envmap:{envMap:{value:null},envMapRotation:{value:new Sn},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Sn}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Sn}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Sn},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Sn},normalScale:{value:new Mn(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Sn},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Sn}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Sn}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Sn}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new ya(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new ya(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Sn},alphaTest:{value:0},uvTransform:{value:new Sn}},sprite:{diffuse:{value:new ya(16777215)},opacity:{value:1},center:{value:new Mn(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Sn},alphaMap:{value:null},alphaMapTransform:{value:new Sn},alphaTest:{value:0}}},Eh={basic:{uniforms:vs([Th.common,Th.specularmap,Th.envmap,Th.aomap,Th.lightmap,Th.fog]),vertexShader:wh.meshbasic_vert,fragmentShader:wh.meshbasic_frag},lambert:{uniforms:vs([Th.common,Th.specularmap,Th.envmap,Th.aomap,Th.lightmap,Th.emissivemap,Th.bumpmap,Th.normalmap,Th.displacementmap,Th.fog,Th.lights,{emissive:{value:new ya(0)}}]),vertexShader:wh.meshlambert_vert,fragmentShader:wh.meshlambert_frag},phong:{uniforms:vs([Th.common,Th.specularmap,Th.envmap,Th.aomap,Th.lightmap,Th.emissivemap,Th.bumpmap,Th.normalmap,Th.displacementmap,Th.fog,Th.lights,{emissive:{value:new ya(0)},specular:{value:new ya(1118481)},shininess:{value:30}}]),vertexShader:wh.meshphong_vert,fragmentShader:wh.meshphong_frag},standard:{uniforms:vs([Th.common,Th.envmap,Th.aomap,Th.lightmap,Th.emissivemap,Th.bumpmap,Th.normalmap,Th.displacementmap,Th.roughnessmap,Th.metalnessmap,Th.fog,Th.lights,{emissive:{value:new ya(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:wh.meshphysical_vert,fragmentShader:wh.meshphysical_frag},toon:{uniforms:vs([Th.common,Th.aomap,Th.lightmap,Th.emissivemap,Th.bumpmap,Th.normalmap,Th.displacementmap,Th.gradientmap,Th.fog,Th.lights,{emissive:{value:new ya(0)}}]),vertexShader:wh.meshtoon_vert,fragmentShader:wh.meshtoon_frag},matcap:{uniforms:vs([Th.common,Th.bumpmap,Th.normalmap,Th.displacementmap,Th.fog,{matcap:{value:null}}]),vertexShader:wh.meshmatcap_vert,fragmentShader:wh.meshmatcap_frag},points:{uniforms:vs([Th.points,Th.fog]),vertexShader:wh.points_vert,fragmentShader:wh.points_frag},dashed:{uniforms:vs([Th.common,Th.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:wh.linedashed_vert,fragmentShader:wh.linedashed_frag},depth:{uniforms:vs([Th.common,Th.displacementmap]),vertexShader:wh.depth_vert,fragmentShader:wh.depth_frag},normal:{uniforms:vs([Th.common,Th.bumpmap,Th.normalmap,Th.displacementmap,{opacity:{value:1}}]),vertexShader:wh.meshnormal_vert,fragmentShader:wh.meshnormal_frag},sprite:{uniforms:vs([Th.sprite,Th.fog]),vertexShader:wh.sprite_vert,fragmentShader:wh.sprite_frag},background:{uniforms:{uvTransform:{value:new Sn},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:wh.background_vert,fragmentShader:wh.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new Sn}},vertexShader:wh.backgroundCube_vert,fragmentShader:wh.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:wh.cube_vert,fragmentShader:wh.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:wh.equirect_vert,fragmentShader:wh.equirect_frag},distanceRGBA:{uniforms:vs([Th.common,Th.displacementmap,{referencePosition:{value:new tr},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:wh.distanceRGBA_vert,fragmentShader:wh.distanceRGBA_frag},shadow:{uniforms:vs([Th.lights,Th.fog,{color:{value:new ya(0)},opacity:{value:1}}]),vertexShader:wh.shadow_vert,fragmentShader:wh.shadow_frag}};Eh.physical={uniforms:vs([Eh.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Sn},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Sn},clearcoatNormalScale:{value:new Mn(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Sn},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Sn},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Sn},sheen:{value:0},sheenColor:{value:new ya(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Sn},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Sn},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Sn},transmissionSamplerSize:{value:new Mn},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Sn},attenuationDistance:{value:0},attenuationColor:{value:new ya(0)},specularColor:{value:new ya(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Sn},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Sn},anisotropyVector:{value:new Mn},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Sn}}]),vertexShader:wh.meshphysical_vert,fragmentShader:wh.meshphysical_frag};const Ah={r:0,b:0,g:0},Ch=new kr,Rh=new Pr;function Ph(r,n,a,s,o,t,l){const h=new ya(0);let c=!0===t?0:1,u,d,p=null,m=0,f=null;function g(t){let e=!0===t.isScene?t.background:null;var i;return e&&e.isTexture&&(i=0<t.backgroundBlurriness,e=(i?a:n).get(e)),e}function e(t){let e=!1;var i=g(t);null===i?v(h,c):i&&i.isColor&&(v(i,1),e=!0);var n=r.xr.getEnvironmentBlendMode();"additive"===n?s.buffers.color.setClear(0,0,0,1,l):"alpha-blend"===n&&s.buffers.color.setClear(0,0,0,0,l),(r.autoClear||e)&&(s.buffers.depth.setTest(!0),s.buffers.depth.setMask(!0),s.buffers.color.setMask(!0),r.clear(r.autoClearColor,r.autoClearDepth,r.autoClearStencil))}function i(t,e){const i=g(e);i&&(i.isCubeTexture||i.mapping===_t)?(void 0===d&&(d=new ds(new fs(1,1,1),new nh({name:"BackgroundCubeMaterial",uniforms:gs(Eh.backgroundCube.uniforms),vertexShader:Eh.backgroundCube.vertexShader,fragmentShader:Eh.backgroundCube.fragmentShader,side:Yt,depthTest:!1,depthWrite:!1,fog:!1})),d.geometry.deleteAttribute("normal"),d.geometry.deleteAttribute("uv"),d.onBeforeRender=function(t,e,i){this.matrixWorld.copyPosition(i.matrixWorld)},Object.defineProperty(d.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),o.update(d)),Ch.copy(e.backgroundRotation),Ch.x*=-1,Ch.y*=-1,Ch.z*=-1,i.isCubeTexture&&!1===i.isRenderTargetTexture&&(Ch.y*=-1,Ch.z*=-1),d.material.uniforms.envMap.value=i,d.material.uniforms.flipEnvMap.value=i.isCubeTexture&&!1===i.isRenderTargetTexture?-1:1,d.material.uniforms.backgroundBlurriness.value=e.backgroundBlurriness,d.material.uniforms.backgroundIntensity.value=e.backgroundIntensity,d.material.uniforms.backgroundRotation.value.setFromMatrix4(Rh.makeRotationFromEuler(Ch)),d.material.toneMapped=On.getTransfer(i.colorSpace)!==si,p===i&&m===i.version&&f===r.toneMapping||(d.material.needsUpdate=!0,p=i,m=i.version,f=r.toneMapping),d.layers.enableAll(),t.unshift(d,d.geometry,d.material,0,0,null)):i&&i.isTexture&&(void 0===u&&(u=new ds(new bh(2,2),new nh({name:"BackgroundMaterial",uniforms:gs(Eh.background.uniforms),vertexShader:Eh.background.vertexShader,fragmentShader:Eh.background.fragmentShader,side:qt,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),Object.defineProperty(u.material,"map",{get:function(){return this.uniforms.t2D.value}}),o.update(u)),u.material.uniforms.t2D.value=i,u.material.uniforms.backgroundIntensity.value=e.backgroundIntensity,u.material.toneMapped=On.getTransfer(i.colorSpace)!==si,!0===i.matrixAutoUpdate&&i.updateMatrix(),u.material.uniforms.uvTransform.value.copy(i.matrix),p===i&&m===i.version&&f===r.toneMapping||(u.material.needsUpdate=!0,p=i,m=i.version,f=r.toneMapping),u.layers.enableAll(),t.unshift(u,u.geometry,u.material,0,0,null))}function v(t,e){t.getRGB(Ah,ys(r)),s.buffers.color.setClear(Ah.r,Ah.g,Ah.b,e,l)}return{getClearColor:function(){return h},setClearColor:function(t,e=1){h.set(t),c=e,v(h,c)},getClearAlpha:function(){return c},setClearAlpha:function(t){c=t,v(h,c)},render:e,addToRenderList:i}}function Ih(x,M){const r=x.getParameter(x.MAX_VERTEX_ATTRIBS),o={},t=p(null);let u=t,l=!1;function e(t,e,i,n,r){var a=!1,s=d(n,i,e);u!==s&&(u=s,c(u.object)),(a=m(t,n,i,r))&&f(t,n,i,r),null!==r&&M.update(r,x.ELEMENT_ARRAY_BUFFER),(a||l)&&(l=!1,g(t,e,i,n),null!==r&&x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,M.get(r).buffer))}function h(){return x.createVertexArray()}function c(t){return x.bindVertexArray(t)}function a(t){return x.deleteVertexArray(t)}function d(t,e,i){var n=!0===i.wireframe;let r=o[t.id];void 0===r&&(r={},o[t.id]=r);let a=r[e.id];void 0===a&&(a={},r[e.id]=a);let s=a[n];return void 0===s&&(s=p(h()),a[n]=s),s}function p(t){const e=[],i=[],n=[];for(let t=0;t<r;t++)e[t]=0,i[t]=0,n[t]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:e,enabledAttributes:i,attributeDivisors:n,object:t,attributes:{},index:null}}function m(e,t,i,n){var r=u.attributes,a=t.attributes;let s=0;var o=i.getAttributes(),l;for(const c in o){if(0<=o[c].location){var h=r[c];let t=a[c];if(void 0===t&&("instanceMatrix"===c&&e.instanceMatrix&&(t=e.instanceMatrix),"instanceColor"===c&&e.instanceColor&&(t=e.instanceColor)),void 0===h)return!0;if(h.attribute!==t)return!0;if(t&&h.data!==t.data)return!0;s++}}return u.attributesNum!==s||u.index!==n}function f(e,t,i,n){const r={};var a=t.attributes;let s=0;var o=i.getAttributes(),l;for(const h in o){if(0<=o[h].location){let t=a[h];void 0===t&&("instanceMatrix"===h&&e.instanceMatrix&&(t=e.instanceMatrix),"instanceColor"===h&&e.instanceColor&&(t=e.instanceColor));const c={};c.attribute=t,t&&t.data&&(c.data=t.data),r[h]=c,s++}}u.attributes=r,u.attributesNum=s,u.index=n}function S(){const i=u.newAttributes;for(let t=0,e=i.length;t<e;t++)i[t]=0}function b(t){w(t,0)}function w(t,e){const i=u.newAttributes,n=u.enabledAttributes,r=u.attributeDivisors;i[t]=1,0===n[t]&&(x.enableVertexAttribArray(t),n[t]=1),r[t]!==e&&(x.vertexAttribDivisor(t,e),r[t]=e)}function T(){var i=u.newAttributes;const n=u.enabledAttributes;for(let t=0,e=n.length;t<e;t++)n[t]!==i[t]&&(x.disableVertexAttribArray(t),n[t]=0)}function E(t,e,i,n,r,a,s){!0===s?x.vertexAttribIPointer(t,e,i,r,a):x.vertexAttribPointer(t,e,i,n,r,a)}function g(t,e,i,n){S();var r=n.attributes,a=i.getAttributes(),s=e.defaultAttributeValues;for(const y in a){var o=a[y];if(0<=o.location){let e=r[y];if(void 0===e&&("instanceMatrix"===y&&t.instanceMatrix&&(e=t.instanceMatrix),"instanceColor"===y&&t.instanceColor&&(e=t.instanceColor)),void 0!==e){var l=e.normalized,h=e.itemSize,c=M.get(e);if(void 0!==c){var u=c.buffer,d=c.type,p=c.bytesPerElement,m=d===x.INT||d===x.UNSIGNED_INT||e.gpuType===D;if(e.isInterleavedBufferAttribute){var f=e.data,g=f.stride,v=e.offset;if(f.isInstancedInterleavedBuffer){for(let t=0;t<o.locationSize;t++)w(o.location+t,f.meshPerAttribute);!0!==t.isInstancedMesh&&void 0===n._maxInstanceCount&&(n._maxInstanceCount=f.meshPerAttribute*f.count)}else for(let t=0;t<o.locationSize;t++)b(o.location+t);x.bindBuffer(x.ARRAY_BUFFER,u);for(let t=0;t<o.locationSize;t++)E(o.location+t,h/o.locationSize,d,l,g*p,(v+h/o.locationSize*t)*p,m)}else{if(e.isInstancedBufferAttribute){for(let t=0;t<o.locationSize;t++)w(o.location+t,e.meshPerAttribute);!0!==t.isInstancedMesh&&void 0===n._maxInstanceCount&&(n._maxInstanceCount=e.meshPerAttribute*e.count)}else for(let t=0;t<o.locationSize;t++)b(o.location+t);x.bindBuffer(x.ARRAY_BUFFER,u);for(let t=0;t<o.locationSize;t++)E(o.location+t,h/o.locationSize,d,l,h*p,h/o.locationSize*t*p,m)}}}else if(void 0!==s){var _=s[y];if(void 0!==_)switch(_.length){case 2:x.vertexAttrib2fv(o.location,_);break;case 3:x.vertexAttrib3fv(o.location,_);break;case 4:x.vertexAttrib4fv(o.location,_);break;default:x.vertexAttrib1fv(o.location,_)}}}}T()}function i(){v();for(const t in o){const e=o[t];for(const i in e){const n=e[i];for(const r in n)a(n[r].object),delete n[r];delete e[i]}delete o[t]}}function n(t){if(void 0!==o[t.id]){const e=o[t.id];for(const i in e){const n=e[i];for(const r in n)a(n[r].object),delete n[r];delete e[i]}delete o[t.id]}}function s(t){for(const e in o){const i=o[e];if(void 0!==i[t.id]){const n=i[t.id];for(const r in n)a(n[r].object),delete n[r];delete i[t.id]}}}function v(){_(),l=!0,u!==t&&(u=t,c(u.object))}function _(){t.geometry=null,t.program=null,t.wireframe=!1}return{setup:e,reset:v,resetDefaultState:_,dispose:i,releaseStatesOfGeometry:n,releaseStatesOfProgram:s,initAttributes:S,enableAttribute:b,disableUnusedAttributes:T}}function Lh(n,s,o){let l;function t(t){l=t}function e(t,e){n.drawArrays(l,t,e),o.update(e,l,1)}function h(t,e,i){0!==i&&(n.drawArraysInstanced(l,t,e,i),o.update(e,l,i))}function i(t,i,n){if(0!==n){const r=s.get("WEBGL_multi_draw");r.multiDrawArraysWEBGL(l,t,0,i,0,n);let e=0;for(let t=0;t<n;t++)e+=i[t];o.update(e,l,1)}}function r(i,n,r,a){if(0!==r){const t=s.get("WEBGL_multi_draw");if(null===t)for(let t=0;t<i.length;t++)h(i[t],n[t],a[t]);else{t.multiDrawArraysInstancedWEBGL(l,i,0,n,0,a,0,r);let e=0;for(let t=0;t<r;t++)e+=n[t];for(let t=0;t<a.length;t++)o.update(e,l,a[t])}}}this.setMode=t,this.render=e,this.renderInstances=h,this.renderMultiDraw=i,this.renderMultiDrawInstances=r}function Uh(i,n,t,r){let e;function a(){return void 0!==e||(e=!0===n.has("EXT_texture_filter_anisotropic")?(t=n.get("EXT_texture_filter_anisotropic"),i.getParameter(t.MAX_TEXTURE_MAX_ANISOTROPY_EXT)):0),e;var t}function s(t){return t===ut||r.convert(t)===i.getParameter(i.IMPLEMENTATION_COLOR_READ_FORMAT)}function o(t){var e=t===de&&(n.has("EXT_color_buffer_half_float")||n.has("EXT_color_buffer_float"));return!(t!==he&&r.convert(t)!==i.getParameter(i.IMPLEMENTATION_COLOR_READ_TYPE)&&t!==ct&&!e)}function l(t){if("highp"===t){if(0<i.getShaderPrecisionFormat(i.VERTEX_SHADER,i.HIGH_FLOAT).precision&&0<i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT).precision)return"highp";t="mediump"}return"mediump"===t&&0<i.getShaderPrecisionFormat(i.VERTEX_SHADER,i.MEDIUM_FLOAT).precision&&0<i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.MEDIUM_FLOAT).precision?"mediump":"lowp"}let h=void 0!==t.precision?t.precision:"highp";var c=l(h);c!==h&&(console.warn("THREE.WebGLRenderer:",h,"not supported, using",c,"instead."),h=c);var u=!0===t.logarithmicDepthBuffer,d=i.getParameter(i.MAX_TEXTURE_IMAGE_UNITS),p=i.getParameter(i.MAX_VERTEX_TEXTURE_IMAGE_UNITS),m=i.getParameter(i.MAX_TEXTURE_SIZE),f=i.getParameter(i.MAX_CUBE_MAP_TEXTURE_SIZE),g=i.getParameter(i.MAX_VERTEX_ATTRIBS),v=i.getParameter(i.MAX_VERTEX_UNIFORM_VECTORS),_=i.getParameter(i.MAX_VARYING_VECTORS),y=i.getParameter(i.MAX_FRAGMENT_UNIFORM_VECTORS),x=0<p,M=i.getParameter(i.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:a,getMaxPrecision:l,textureFormatReadable:s,textureTypeReadable:o,precision:h,logarithmicDepthBuffer:u,maxTextures:d,maxVertexTextures:p,maxTextureSize:m,maxCubemapSize:f,maxAttributes:g,maxVertexUniforms:v,maxVaryings:_,maxFragmentUniforms:y,vertexTextures:x,maxSamples:M}}function Nh(h){const l=this;let c=null,u=0,d=!1,p=!1;const m=new vh,f=new Sn,g={value:null,needsUpdate:!1};function v(){g.value!==c&&(g.value=c,g.needsUpdate=0<u),l.numPlanes=u,l.numIntersection=0}function _(i,t,n,e){var r=null!==i?i.length:0;let a=null;if(0!==r){if(a=g.value,!0!==e||null===a){var s=n+4*r,o=t.matrixWorldInverse;f.getNormalMatrix(o),(null===a||a.length<s)&&(a=new Float32Array(s));for(let t=0,e=n;t!==r;++t,e+=4)m.copy(i[t]).applyMatrix4(o,f),m.normal.toArray(a,e),a[e+3]=m.constant}g.value=a,g.needsUpdate=!0}return l.numPlanes=r,l.numIntersection=0,a}this.uniform=g,this.numPlanes=0,this.numIntersection=0,this.init=function(t,e){var i=0!==t.length||e||0!==u||d;return d=e,u=t.length,i},this.beginShadows=function(){p=!0,_(null)},this.endShadows=function(){p=!1},this.setGlobalState=function(t,e){c=_(t,e,0)},this.setState=function(t,i,n){var r=t.clippingPlanes,a=t.clipIntersection,e=t.clipShadows;const s=h.get(t);if(!d||null===r||0===r.length||p&&!e)p?_(null):v();else{var o=p?0:u,l=4*o;let e=s.clippingState||null;g.value=e,e=_(r,i,l,n);for(let t=0;t!==l;++t)e[t]=c[t];s.clippingState=e,this.numIntersection=a?this.numPlanes:0,this.numPlanes+=o}}}function Dh(a){let s=new WeakMap;function o(t,e){return e===T?t.mapping=b:e===C&&(t.mapping=w),t}function t(t){if(t&&t.isTexture){var e=t.mapping,i;if(e===T||e===C){if(s.has(t))return o(s.get(t).texture,t.mapping);var n=t.image;if(n&&0<n.height){const r=new ph(n.height);return r.fromEquirectangularTexture(a,t),s.set(t,r),t.addEventListener("dispose",l),o(r.texture,t.mapping)}return null}}return t}function l(t){const e=t.target;e.removeEventListener("dispose",l);const i=s.get(e);void 0!==i&&(s.delete(e),i.dispose())}function e(){s=new WeakMap}return{get:t,dispose:e}}class Oh extends rh{constructor(t=-1,e=1,i=1,n=-1,r=.1,a=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=i,this.bottom=n,this.near=r,this.far=a,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this}setViewOffset(t,e,i,n,r,a){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){var t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,n=(this.top+this.bottom)/2,r,a;let s=i-t,o=i+t,l=n+e,h=n-e;null!==this.view&&this.view.enabled&&(r=(this.right-this.left)/this.view.fullWidth/this.zoom,a=(this.top-this.bottom)/this.view.fullHeight/this.zoom,s+=r*this.view.offsetX,o=s+r*this.view.width,l-=a*this.view.offsetY,h=l-a*this.view.height),this.projectionMatrix.makeOrthographic(s,o,l,h,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}const Bh=4,Fh=[.125,.215,.35,.446,.526,.582],zh=20,kh=new Oh,Vh=new ya;let Gh=null,Hh=0,Wh=0,Xh=!1;var jh=(1+Math.sqrt(5))/2,qh=1/jh;const Yh=[new tr(-jh,qh,0),new tr(jh,qh,0),new tr(-qh,0,jh),new tr(qh,0,jh),new tr(0,jh,-qh),new tr(0,jh,qh),new tr(-1,1,-1),new tr(1,1,-1),new tr(-1,1,1),new tr(1,1,1)];class Zh{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(t,e=0,i=.1,n=100){Gh=this._renderer.getRenderTarget(),Hh=this._renderer.getActiveCubeFace(),Wh=this._renderer.getActiveMipmapLevel(),Xh=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(256);const r=this._allocateTargets();return r.depthBuffer=!0,this._sceneToCubeUV(t,i,n,r),0<e&&this._blur(r,0,0,e),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(t,e=null){return this._fromTexture(t,e)}fromCubemap(t,e=null){return this._fromTexture(t,e)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=ec(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=tc(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(t){this._lodMax=Math.floor(Math.log2(t)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let t=0;t<this._lodPlanes.length;t++)this._lodPlanes[t].dispose()}_cleanup(t){this._renderer.setRenderTarget(Gh,Hh,Wh),this._renderer.xr.enabled=Xh,t.scissorTest=!1,$h(t,0,0,t.width,t.height)}_fromTexture(t,e){t.mapping===b||t.mapping===w?this._setSize(0===t.image.length?16:t.image[0].width||t.image[0].image.width):this._setSize(t.image.width/4),Gh=this._renderer.getRenderTarget(),Hh=this._renderer.getActiveCubeFace(),Wh=this._renderer.getActiveMipmapLevel(),Xh=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;var i=e||this._allocateTargets();return this._textureToCubeUV(t,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){var t=3*Math.max(this._cubeSize,112),e=4*this._cubeSize,i={magFilter:lt,minFilter:lt,generateMipmaps:!1,type:de,format:ut,colorSpace:ii,depthBuffer:!1},n=Kh(t,e,i),r;return null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.width===t&&this._pingPongRenderTarget.height===e||(null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=Kh(t,e,i),{_lodMax:r}=this,{sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=Jh(r),this._blurMaterial=Qh(r,t,e)),n}_compileMaterial(t){var e=new ds(this._lodPlanes[0],t);this._renderer.compile(e,kh)}_sceneToCubeUV(e,t,i,n){var r=90,a=1;const s=new lh(90,1,t,i);var o=[1,-1,1,1,1,1],l=[1,1,1,-1,-1,-1];const h=this._renderer;var c=h.autoClear,u=h.toneMapping;h.getClearColor(Vh),h.toneMapping=oe,h.autoClear=!1;const d=new ba({name:"PMREM.Background",side:Yt,depthWrite:!1,depthTest:!1}),p=new ds(new fs,d);let m=!1;var f=e.background;f?f.isColor&&(d.color.copy(f),e.background=null,m=!0):(d.color.copy(Vh),m=!0);for(let t=0;t<6;t++){var g=t%3;0==g?(s.up.set(0,o[t],0),s.lookAt(l[t],0,0)):1==g?(s.up.set(0,0,o[t]),s.lookAt(0,l[t],0)):(s.up.set(0,o[t],0),s.lookAt(0,0,l[t]));var v=this._cubeSize;$h(n,g*v,2<t?v:0,v,v),h.setRenderTarget(n),m&&h.render(p,s),h.render(e,s)}p.geometry.dispose(),p.material.dispose(),h.toneMapping=u,h.autoClear=c,e.background=f}_textureToCubeUV(t,e){const i=this._renderer;var n=t.mapping===b||t.mapping===w;n?(null===this._cubemapMaterial&&(this._cubemapMaterial=ec()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===t.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=tc());var r=n?this._cubemapMaterial:this._equirectMaterial,a=new ds(this._lodPlanes[0],r);const s=r.uniforms;s.envMap.value=t;var o=this._cubeSize;$h(e,0,0,3*o,2*o),i.setRenderTarget(e),i.render(a,kh)}_applyPMREM(e){const t=this._renderer;var i=t.autoClear;t.autoClear=!1;var n=this._lodPlanes.length;for(let t=1;t<n;t++){var r=Math.sqrt(this._sigmas[t]*this._sigmas[t]-this._sigmas[t-1]*this._sigmas[t-1]),a=Yh[(n-t-1)%Yh.length];this._blur(e,t-1,t,r,a)}t.autoClear=i}_blur(t,e,i,n,r){var a=this._pingPongRenderTarget;this._halfBlur(t,a,e,i,n,"latitudinal",r),this._halfBlur(a,t,i,i,n,"longitudinal",r)}_halfBlur(t,e,i,n,r,a,s){const o=this._renderer;var l=this._blurMaterial;"latitudinal"!==a&&"longitudinal"!==a&&console.error("blur direction must be either latitudinal or longitudinal!");var h=3,c=new ds(this._lodPlanes[n],l);const u=l.uniforms;var d=this._sizeLods[i]-1,p=isFinite(r)?Math.PI/(2*d):2*Math.PI/39,m=r/p,f=isFinite(r)?1+Math.floor(3*m):20;20<f&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${f} samples when the maximum is set to 20`);const g=[];let v=0;for(let t=0;t<20;++t){const M=t/m;var _=Math.exp(-M*M/2);g.push(_),0===t?v+=_:t<f&&(v+=2*_)}for(let t=0;t<g.length;t++)g[t]=g[t]/v;u.envMap.value=t.texture,u.samples.value=f,u.weights.value=g,u.latitudinal.value="latitudinal"===a,s&&(u.poleAxis.value=s);var{_lodMax:y}=this;u.dTheta.value=p,u.mipInt.value=y-i;var x=this._sizeLods[n];const M=3*x*(y-4<n?n-y+4:0);var S=4*(this._cubeSize-x);$h(e,M,S,3*x,2*x),o.setRenderTarget(e),o.render(c,kh)}}function Jh(i){const n=[],r=[],a=[];let s=i;var t=i-4+1+Fh.length;for(let e=0;e<t;e++){var o=Math.pow(2,s);r.push(o);let t=1/o;e>i-4?t=Fh[e-i+4-1]:0===e&&(t=0),a.push(t);var l=1/(o-2),h=-l,c=1+l,u=[h,h,c,h,c,c,h,h,c,c,h,c],d=6,p=6,m=3,f=2,g=1;const M=new Float32Array(108),S=new Float32Array(72),b=new Float32Array(36);for(let t=0;t<6;t++){var v=t%3*2/3-1,_=2<t?0:-1,y;M.set([v,_,0,v+2/3,_,0,v+2/3,1+_,0,v,_,0,v+2/3,1+_,0,v,1+_,0],18*t),S.set(u,12*t);var x=[t,t,t,t,t,t];b.set(x,6*t)}const w=new Ya;w.setAttribute("position",new Ia(M,3)),w.setAttribute("uv",new Ia(S,2)),w.setAttribute("faceIndex",new Ia(b,1)),n.push(w),4<s&&s--}return{lodPlanes:n,sizeLods:r,sigmas:a}}function Kh(t,e,i){const n=new Yn(t,e,i);return n.texture.mapping=_t,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function $h(t,e,i,n,r){t.viewport.set(e,i,n,r),t.scissor.set(e,i,n,r)}function Qh(t,e,i){var n=new Float32Array(20),r=new tr(0,1,0),a;return new nh({name:"SphericalGaussianBlur",defines:{n:20,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/i,CUBEUV_MAX_MIP:t+".0"},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:ic(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:bt,depthTest:!1,depthWrite:!1})}function tc(){return new nh({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:ic(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:bt,depthTest:!1,depthWrite:!1})}function ec(){return new nh({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:ic(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:bt,depthTest:!1,depthWrite:!1})}function ic(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function nc(s){let o=new WeakMap,l=null;function t(e){if(e&&e.isTexture){var t=e.mapping,i=t===T||t===C,n=t===b||t===w;if(i||n){let t=o.get(e);var r=void 0!==t?t.texture.pmremVersion:0;if(e.isRenderTargetTexture&&e.pmremVersion!==r)return null===l&&(l=new Zh(s)),t=i?l.fromEquirectangular(e,t):l.fromCubemap(e,t),t.texture.pmremVersion=e.pmremVersion,o.set(e,t),t.texture;if(void 0!==t)return t.texture;var a=e.image;return i&&a&&0<a.height||n&&a&&h(a)?(null===l&&(l=new Zh(s)),t=i?l.fromEquirectangular(e):l.fromCubemap(e),t.texture.pmremVersion=e.pmremVersion,o.set(e,t),e.addEventListener("dispose",c),t.texture):null}}return e}function h(e){let i=0;var t=6;for(let t=0;t<6;t++)void 0!==e[t]&&i++;return 6===i}function c(t){const e=t.target;e.removeEventListener("dispose",c);const i=o.get(e);void 0!==i&&(o.delete(e),i.dispose())}function e(){o=new WeakMap,null!==l&&(l.dispose(),l=null)}return{get:t,dispose:e}}function rc(i){const n={};function r(t){if(void 0!==n[t])return n[t];let e;switch(t){case"WEBGL_depth_texture":e=i.getExtension("WEBGL_depth_texture")||i.getExtension("MOZ_WEBGL_depth_texture")||i.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":e=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":e=i.getExtension("WEBGL_compressed_texture_s3tc")||i.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":e=i.getExtension("WEBGL_compressed_texture_pvrtc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:e=i.getExtension(t)}return n[t]=e,e}return{has:function(t){return null!==r(t)},init:function(){r("EXT_color_buffer_float"),r("WEBGL_clip_cull_distance"),r("OES_texture_float_linear"),r("EXT_color_buffer_half_float"),r("WEBGL_multisampled_render_to_texture"),r("WEBGL_render_shared_exponent")},get:function(t){var e=r(t);return null===e&&Pn("THREE.WebGLRenderer: "+t+" extension not supported."),e}}}function ac(s,f,o,l){const h={},g=new WeakMap;function c(t){const e=t.target;null!==e.index&&f.remove(e.index);for(const r in e.attributes)f.remove(e.attributes[r]);for(const a in e.morphAttributes){var i=e.morphAttributes[a];for(let t=0,e=i.length;t<e;t++)f.remove(i[t])}e.removeEventListener("dispose",c),delete h[e.id];var n=g.get(e);n&&(f.remove(n),g.delete(e)),l.releaseStatesOfGeometry(e),!0===e.isInstancedBufferGeometry&&delete e._maxInstanceCount,o.memory.geometries--}function t(t,e){return!0===h[e.id]||(e.addEventListener("dispose",c),h[e.id]=!0,o.memory.geometries++),e}function e(t){var e=t.attributes;for(const r in e)f.update(e[r],s.ARRAY_BUFFER);var i=t.morphAttributes;for(const a in i){var n=i[a];for(let t=0,e=n.length;t<e;t++)f.update(n[t],s.ARRAY_BUFFER)}}function n(t){const i=[];var e=t.index,n=t.attributes.position;let r=0;if(null!==e){var a=e.array;r=e.version;for(let t=0,e=a.length;t<e;t+=3){var s=a[t+0],o=a[t+1],l=a[t+2];i.push(s,o,o,l,l,s)}}else{if(void 0===n)return;var h=n.array;r=n.version;for(let t=0,e=h.length/3-1;t<e;t+=3){var c=t+0,u=t+1,d=t+2;i.push(c,u,u,d,d,c)}}const p=new(wn(i)?Fa:Oa)(i,1);p.version=r;var m=g.get(t);m&&f.remove(m),g.set(t,p)}function i(t){var e=g.get(t),i;return(!e||null!==(i=t.index)&&e.version<i.version)&&n(t),g.get(t)}return{get:t,update:e,getWireframeAttribute:i}}function sc(n,s,o){let l;function t(t){l=t}let h,c;function e(t){h=t.type,c=t.bytesPerElement}function i(t,e){n.drawElements(l,e,h,t*c),o.update(e,l,1)}function u(t,e,i){0!==i&&(n.drawElementsInstanced(l,e,h,t*c,i),o.update(e,l,i))}function r(t,i,n){if(0!==n){const r=s.get("WEBGL_multi_draw");r.multiDrawElementsWEBGL(l,i,0,h,t,0,n);let e=0;for(let t=0;t<n;t++)e+=i[t];o.update(e,l,1)}}function a(i,n,r,a){if(0!==r){const t=s.get("WEBGL_multi_draw");if(null===t)for(let t=0;t<i.length;t++)u(i[t]/c,n[t],a[t]);else{t.multiDrawElementsInstancedWEBGL(l,n,0,h,i,0,a,0,r);let e=0;for(let t=0;t<r;t++)e+=n[t];for(let t=0;t<a.length;t++)o.update(e,l,a[t])}}}this.setMode=t,this.setIndex=e,this.render=i,this.renderInstances=u,this.renderMultiDraw=r,this.renderMultiDrawInstances=a}function oc(n){var t;const r={frame:0,calls:0,triangles:0,points:0,lines:0};function e(t,e,i){switch(r.calls++,e){case n.TRIANGLES:r.triangles+=i*(t/3);break;case n.LINES:r.lines+=i*(t/2);break;case n.LINE_STRIP:r.lines+=i*(t-1);break;case n.LINE_LOOP:r.lines+=i*t;break;case n.POINTS:r.points+=i*t;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",e)}}function i(){r.calls=0,r.triangles=0,r.points=0,r.lines=0}return{memory:{geometries:0,textures:0},render:r,programs:null,autoReset:!0,reset:i,update:e}}function lc(b,w,T){const E=new WeakMap,A=new jn;function t(t,n,i){var r=t.morphTargetInfluences,e=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,a=void 0!==e?e.length:0;let s=E.get(n);if(void 0===s||s.count!==a){void 0!==s&&s.texture.dispose();var o=void 0!==n.morphAttributes.position,l=void 0!==n.morphAttributes.normal,h=void 0!==n.morphAttributes.color,c=n.morphAttributes.position||[],u=n.morphAttributes.normal||[],d=n.morphAttributes.color||[];let t=!0==h?3:!0==l?2:!0==o?1:0,e=n.attributes.position.count*t,i=1;e>w.maxTextureSize&&(i=Math.ceil(e/w.maxTextureSize),e=w.maxTextureSize);const M=new Float32Array(e*i*4*a),S=new Zn(M,e,i,a);S.type=ct,S.needsUpdate=!0;var p=4*t;for(let t=0;t<a;t++){var m=c[t],f=u[t],g=d[t],v=e*i*4*t;for(let t=0;t<m.count;t++){var _=t*p;!0==o&&(A.fromBufferAttribute(m,t),M[v+_]=A.x,M[v+_+1]=A.y,M[v+_+2]=A.z,M[v+_+3]=0),!0==l&&(A.fromBufferAttribute(f,t),M[v+_+4]=A.x,M[v+_+5]=A.y,M[v+_+6]=A.z,M[v+_+7]=0),!0==h&&(A.fromBufferAttribute(g,t),M[v+_+8]=A.x,M[v+_+9]=A.y,M[v+_+10]=A.z,M[v+_+11]=4===g.itemSize?A.w:1)}}function y(){S.dispose(),E.delete(n),n.removeEventListener("dispose",y)}s={count:a,texture:S,size:new Mn(e,i)},E.set(n,s),n.addEventListener("dispose",y)}if(!0===t.isInstancedMesh&&null!==t.morphTexture)i.getUniforms().setValue(b,"morphTexture",t.morphTexture,T);else{let e=0;for(let t=0;t<r.length;t++)e+=r[t];var x=n.morphTargetsRelative?1:1-e;i.getUniforms().setValue(b,"morphTargetBaseInfluence",x),i.getUniforms().setValue(b,"morphTargetInfluences",r)}i.getUniforms().setValue(b,"morphTargetsTexture",s.texture,T),i.getUniforms().setValue(b,"morphTargetsTextureSize",s.size)}return{update:t}}function hc(a,s,o,l){let h=new WeakMap;function t(t){var e=l.render.frame,i=t.geometry,n=s.get(t,i);if(h.get(n)!==e&&(s.update(n),h.set(n,e)),t.isInstancedMesh&&(!1===t.hasEventListener("dispose",c)&&t.addEventListener("dispose",c),h.get(t)!==e&&(o.update(t.instanceMatrix,a.ARRAY_BUFFER),null!==t.instanceColor&&o.update(t.instanceColor,a.ARRAY_BUFFER),h.set(t,e))),t.isSkinnedMesh){const r=t.skeleton;h.get(r)!==e&&(r.update(),h.set(r,e))}return n}function e(){h=new WeakMap}function c(t){const e=t.target;e.removeEventListener("dispose",c),o.remove(e.instanceMatrix),null!==e.instanceColor&&o.remove(e.instanceColor)}return{update:t,dispose:e}}class cc extends Xn{constructor(t,e,i,n,r,a,s,o,l,h=dt){if(h!==dt&&h!==pt)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");super(null,n,r,a,s,o,h,i=void 0===(i=void 0===i&&h===dt?ue:i)&&h===pt?fe:i,l),this.isDepthTexture=!0,this.image={width:t,height:e},this.magFilter=void 0!==s?s:at,this.minFilter=void 0!==o?o:at,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(t){return super.copy(t),this.compareFunction=t.compareFunction,this}toJSON(t){const e=super.toJSON(t);return null!==this.compareFunction&&(e.compareFunction=this.compareFunction),e}}const uc=new Xn,dc=new cc(1,1),pc=new Zn,mc=new Kn,fc=new dh,gc=[],vc=[],_c=new Float32Array(16),yc=new Float32Array(9),xc=new Float32Array(4);function Mc(i,n,r){const t=i[0];if(t<=0||0<t)return i;var e=n*r;let a=gc[e];if(void 0===a&&(a=new Float32Array(e),gc[e]=a),0!==n){t.toArray(a,0);for(let t=1,e=0;t!==n;++t)e+=r,i[t].toArray(a,e)}return a}function Sc(i,n){if(i.length===n.length){for(let t=0,e=i.length;t<e;t++)if(i[t]!==n[t])return;return 1}}function bc(i,n){for(let t=0,e=n.length;t<e;t++)i[t]=n[t]}function wc(e,i){let n=vc[i];void 0===n&&(n=new Int32Array(i),vc[i]=n);for(let t=0;t!==i;++t)n[t]=e.allocateTextureUnit();return n}function Tc(t,e){const i=this.cache;i[0]!==e&&(t.uniform1f(this.addr,e),i[0]=e)}function Ec(t,e){const i=this.cache;void 0!==e.x?i[0]===e.x&&i[1]===e.y||(t.uniform2f(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y):Sc(i,e)||(t.uniform2fv(this.addr,e),bc(i,e))}function Ac(t,e){const i=this.cache;void 0!==e.x?i[0]===e.x&&i[1]===e.y&&i[2]===e.z||(t.uniform3f(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z):void 0!==e.r?i[0]===e.r&&i[1]===e.g&&i[2]===e.b||(t.uniform3f(this.addr,e.r,e.g,e.b),i[0]=e.r,i[1]=e.g,i[2]=e.b):Sc(i,e)||(t.uniform3fv(this.addr,e),bc(i,e))}function Cc(t,e){const i=this.cache;void 0!==e.x?i[0]===e.x&&i[1]===e.y&&i[2]===e.z&&i[3]===e.w||(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w):Sc(i,e)||(t.uniform4fv(this.addr,e),bc(i,e))}function Rc(t,e){var i=this.cache,n=e.elements;void 0===n?Sc(i,e)||(t.uniformMatrix2fv(this.addr,!1,e),bc(i,e)):Sc(i,n)||(xc.set(n),t.uniformMatrix2fv(this.addr,!1,xc),bc(i,n))}function Pc(t,e){var i=this.cache,n=e.elements;void 0===n?Sc(i,e)||(t.uniformMatrix3fv(this.addr,!1,e),bc(i,e)):Sc(i,n)||(yc.set(n),t.uniformMatrix3fv(this.addr,!1,yc),bc(i,n))}function Ic(t,e){var i=this.cache,n=e.elements;void 0===n?Sc(i,e)||(t.uniformMatrix4fv(this.addr,!1,e),bc(i,e)):Sc(i,n)||(_c.set(n),t.uniformMatrix4fv(this.addr,!1,_c),bc(i,n))}function Lc(t,e){const i=this.cache;i[0]!==e&&(t.uniform1i(this.addr,e),i[0]=e)}function Uc(t,e){const i=this.cache;void 0!==e.x?i[0]===e.x&&i[1]===e.y||(t.uniform2i(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y):Sc(i,e)||(t.uniform2iv(this.addr,e),bc(i,e))}function Nc(t,e){const i=this.cache;void 0!==e.x?i[0]===e.x&&i[1]===e.y&&i[2]===e.z||(t.uniform3i(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z):Sc(i,e)||(t.uniform3iv(this.addr,e),bc(i,e))}function Dc(t,e){const i=this.cache;void 0!==e.x?i[0]===e.x&&i[1]===e.y&&i[2]===e.z&&i[3]===e.w||(t.uniform4i(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w):Sc(i,e)||(t.uniform4iv(this.addr,e),bc(i,e))}function Oc(t,e){const i=this.cache;i[0]!==e&&(t.uniform1ui(this.addr,e),i[0]=e)}function Bc(t,e){const i=this.cache;void 0!==e.x?i[0]===e.x&&i[1]===e.y||(t.uniform2ui(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y):Sc(i,e)||(t.uniform2uiv(this.addr,e),bc(i,e))}function Fc(t,e){const i=this.cache;void 0!==e.x?i[0]===e.x&&i[1]===e.y&&i[2]===e.z||(t.uniform3ui(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z):Sc(i,e)||(t.uniform3uiv(this.addr,e),bc(i,e))}function zc(t,e){const i=this.cache;void 0!==e.x?i[0]===e.x&&i[1]===e.y&&i[2]===e.z&&i[3]===e.w||(t.uniform4ui(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w):Sc(i,e)||(t.uniform4uiv(this.addr,e),bc(i,e))}function kc(t,e,i){const n=this.cache;var r=i.allocateTextureUnit();n[0]!==r&&(t.uniform1i(this.addr,r),n[0]=r);let a;a=this.type===t.SAMPLER_2D_SHADOW?(dc.compareFunction=Ci,dc):uc,i.setTexture2D(e||a,r)}function Vc(t,e,i){const n=this.cache;var r=i.allocateTextureUnit();n[0]!==r&&(t.uniform1i(this.addr,r),n[0]=r),i.setTexture3D(e||mc,r)}function Gc(t,e,i){const n=this.cache;var r=i.allocateTextureUnit();n[0]!==r&&(t.uniform1i(this.addr,r),n[0]=r),i.setTextureCube(e||fc,r)}function Hc(t,e,i){const n=this.cache;var r=i.allocateTextureUnit();n[0]!==r&&(t.uniform1i(this.addr,r),n[0]=r),i.setTexture2DArray(e||pc,r)}function Wc(t){switch(t){case 5126:return Tc;case 35664:return Ec;case 35665:return Ac;case 35666:return Cc;case 35674:return Rc;case 35675:return Pc;case 35676:return Ic;case 5124:case 35670:return Lc;case 35667:case 35671:return Uc;case 35668:case 35672:return Nc;case 35669:case 35673:return Dc;case 5125:return Oc;case 36294:return Bc;case 36295:return Fc;case 36296:return zc;case 35678:case 36198:case 36298:case 36306:case 35682:return kc;case 35679:case 36299:case 36307:return Vc;case 35680:case 36300:case 36308:case 36293:return Gc;case 36289:case 36303:case 36311:case 36292:return Hc}}function Xc(t,e){t.uniform1fv(this.addr,e)}function jc(t,e){var i=Mc(e,this.size,2);t.uniform2fv(this.addr,i)}function qc(t,e){var i=Mc(e,this.size,3);t.uniform3fv(this.addr,i)}function Yc(t,e){var i=Mc(e,this.size,4);t.uniform4fv(this.addr,i)}function Zc(t,e){var i=Mc(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,i)}function Jc(t,e){var i=Mc(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,i)}function Kc(t,e){var i=Mc(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,i)}function $c(t,e){t.uniform1iv(this.addr,e)}function Qc(t,e){t.uniform2iv(this.addr,e)}function tu(t,e){t.uniform3iv(this.addr,e)}function eu(t,e){t.uniform4iv(this.addr,e)}function iu(t,e){t.uniform1uiv(this.addr,e)}function nu(t,e){t.uniform2uiv(this.addr,e)}function ru(t,e){t.uniform3uiv(this.addr,e)}function au(t,e){t.uniform4uiv(this.addr,e)}function su(t,e,i){var n=this.cache,r=e.length,a=wc(i,r);Sc(n,a)||(t.uniform1iv(this.addr,a),bc(n,a));for(let t=0;t!==r;++t)i.setTexture2D(e[t]||uc,a[t])}function ou(t,e,i){var n=this.cache,r=e.length,a=wc(i,r);Sc(n,a)||(t.uniform1iv(this.addr,a),bc(n,a));for(let t=0;t!==r;++t)i.setTexture3D(e[t]||mc,a[t])}function lu(t,e,i){var n=this.cache,r=e.length,a=wc(i,r);Sc(n,a)||(t.uniform1iv(this.addr,a),bc(n,a));for(let t=0;t!==r;++t)i.setTextureCube(e[t]||fc,a[t])}function hu(t,e,i){var n=this.cache,r=e.length,a=wc(i,r);Sc(n,a)||(t.uniform1iv(this.addr,a),bc(n,a));for(let t=0;t!==r;++t)i.setTexture2DArray(e[t]||pc,a[t])}function cu(t){switch(t){case 5126:return Xc;case 35664:return jc;case 35665:return qc;case 35666:return Yc;case 35674:return Zc;case 35675:return Jc;case 35676:return Kc;case 5124:case 35670:return $c;case 35667:case 35671:return Qc;case 35668:case 35672:return tu;case 35669:case 35673:return eu;case 5125:return iu;case 36294:return nu;case 36295:return ru;case 36296:return au;case 35678:case 36198:case 36298:case 36306:case 35682:return su;case 35679:case 36299:case 36307:return ou;case 35680:case 36300:case 36308:case 36293:return lu;case 36289:case 36303:case 36311:case 36292:return hu}}class uu{constructor(t,e,i){this.id=t,this.addr=i,this.cache=[],this.type=e.type,this.setValue=Wc(e.type)}}class du{constructor(t,e,i){this.id=t,this.addr=i,this.cache=[],this.type=e.type,this.size=e.size,this.setValue=cu(e.type)}}class pu{constructor(t){this.id=t,this.seq=[],this.map={}}setValue(i,n,r){var a=this.seq;for(let t=0,e=a.length;t!==e;++t){const s=a[t];s.setValue(i,n[s.id],r)}}}const mu=/(\w+)(\])?(\[|\.)?/g;function fu(t,e){t.seq.push(e),t.map[e.id]=e}function gu(t,i,n){var r=t.name,a=r.length;for(mu.lastIndex=0;;){var s=mu.exec(r),o=mu.lastIndex;let e=s[1];var l="]"===s[2],h=s[3],c;if(l&&(e|=0),void 0===h||"["===h&&o+2===a){fu(n,new(void 0===h?uu:du)(e,t,i));break}{let t=n.map[e];void 0===t&&(t=new pu(e),fu(n,t)),n=t}}}class vu{constructor(e,i){this.seq=[],this.map={};var n=e.getProgramParameter(i,e.ACTIVE_UNIFORMS);for(let t=0;t<n;++t){var r=e.getActiveUniform(i,t),a;gu(r,e.getUniformLocation(i,r.name),this)}}setValue(t,e,i,n){const r=this.map[e];void 0!==r&&r.setValue(t,i,n)}setOptional(t,e,i){var n=e[i];void 0!==n&&this.setValue(t,i,n)}static upload(i,n,r,a){for(let t=0,e=n.length;t!==e;++t){const s=n[t],o=r[s.id];!1!==o.needsUpdate&&s.setValue(i,o.value,a)}}static seqWithValue(i,n){const r=[];for(let t=0,e=i.length;t!==e;++t){var a=i[t];a.id in n&&r.push(a)}return r}}function _u(t,e,i){var n=t.createShader(e);return t.shaderSource(n,i),t.compileShader(n),n}const yu=37297;let xu=0;function Mu(t,e){var i=t.split("\n");const n=[];var r=Math.max(e-6,0),a=Math.min(e+6,i.length);for(let t=r;t<a;t++){var s=t+1;n.push(`${s===e?">":" "} ${s}: `+i[t])}return n.join("\n")}function Su(t){var e=On.getPrimaries(On.workingColorSpace),i=On.getPrimaries(t);let n;switch(e===i?n="":e===li&&i===oi?n="LinearDisplayP3ToLinearSRGB":e===oi&&i===li&&(n="LinearSRGBToLinearDisplayP3"),t){case ii:case ri:return[n,"LinearTransferOETF"];case ei:case ni:return[n,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",t),[n,"LinearTransferOETF"]}}function bu(t,e,i){var n=t.getShaderParameter(e,t.COMPILE_STATUS),r=t.getShaderInfoLog(e).trim();if(n&&""===r)return"";var a=/ERROR: 0:(\d+)/.exec(r);if(a){var s=parseInt(a[1]);return i.toUpperCase()+"\n\n"+r+"\n\n"+Mu(t.getShaderSource(e),s)}return r}function wu(t,e){var i=Su(e);return`vec4 ${t}( vec4 value ) { return ${i[0]}( ${i[1]}( value ) ); }`}function Tu(t,e){let i;switch(e){case p:i="Linear";break;case m:i="Reinhard";break;case f:i="OptimizedCineon";break;case g:i="ACESFilmic";break;case _:i="AgX";break;case y:i="Neutral";break;case v:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),i="Linear"}return"vec3 "+t+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}const Eu=new tr;function Au(){var t,e,i;return On.getLuminanceCoefficients(Eu),["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${Eu.x.toFixed(4)}, ${Eu.y.toFixed(4)}, ${Eu.z.toFixed(4)} );`,"\treturn dot( weights, rgb );","}"].join("\n")}function Cu(t){const e=[t.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",t.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""];return e.filter(Iu).join("\n")}function Ru(t){const e=[];for(const n in t){var i=t[n];!1!==i&&e.push("#define "+n+" "+i)}return e.join("\n")}function Pu(i,n){const r={};var t=i.getProgramParameter(n,i.ACTIVE_ATTRIBUTES);for(let e=0;e<t;e++){var a=i.getActiveAttrib(n,e),s=a.name;let t=1;a.type===i.FLOAT_MAT2&&(t=2),a.type===i.FLOAT_MAT3&&(t=3),a.type===i.FLOAT_MAT4&&(t=4),r[s]={type:a.type,location:i.getAttribLocation(n,s),locationSize:t}}return r}function Iu(t){return""!==t}function Lu(t,e){var i=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,i).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function Uu(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const Nu=/^[ \t]*#include +<([\w\d./]+)>/gm;function Du(t){return t.replace(Nu,Bu)}const Ou=new Map;function Bu(t,e){let i=wh[e];if(void 0===i){var n=Ou.get(e);if(void 0===n)throw new Error("Can not resolve #include <"+e+">");i=wh[n],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,n)}return Du(i)}const Fu=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function zu(t){return t.replace(Fu,ku)}function ku(t,e,i,n){let r="";for(let t=parseInt(e);t<parseInt(i);t++)r+=n.replace(/\[\s*i\s*\]/g,"[ "+t+" ]").replace(/UNROLLED_LOOP_INDEX/g,t);return r}function Vu(t){let e=`precision ${t.precision} float;
	precision ${t.precision} int;
	precision ${t.precision} sampler2D;
	precision ${t.precision} samplerCube;
	precision ${t.precision} sampler3D;
	precision ${t.precision} sampler2DArray;
	precision ${t.precision} sampler2DShadow;
	precision ${t.precision} samplerCubeShadow;
	precision ${t.precision} sampler2DArrayShadow;
	precision ${t.precision} isampler2D;
	precision ${t.precision} isampler3D;
	precision ${t.precision} isamplerCube;
	precision ${t.precision} isampler2DArray;
	precision ${t.precision} usampler2D;
	precision ${t.precision} usampler3D;
	precision ${t.precision} usamplerCube;
	precision ${t.precision} usampler2DArray;
	`;return"highp"===t.precision?e+="\n#define HIGH_PRECISION":"mediump"===t.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===t.precision&&(e+="\n#define LOW_PRECISION"),e}function Gu(t){let e="SHADOWMAP_TYPE_BASIC";return t.shadowMapType===E?e="SHADOWMAP_TYPE_PCF":t.shadowMapType===h?e="SHADOWMAP_TYPE_PCF_SOFT":t.shadowMapType===A&&(e="SHADOWMAP_TYPE_VSM"),e}function Hu(t){let e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case b:case w:e="ENVMAP_TYPE_CUBE";break;case _t:e="ENVMAP_TYPE_CUBE_UV"}return e}function Wu(t){let e="ENVMAP_MODE_REFLECTION";return t.envMap&&t.envMapMode===w&&(e="ENVMAP_MODE_REFRACTION"),e}function Xu(t){let e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case c:e="ENVMAP_BLENDING_MULTIPLY";break;case u:e="ENVMAP_BLENDING_MIX";break;case d:e="ENVMAP_BLENDING_ADD"}return e}function ju(t){var e=t.envMapCubeUVHeight;if(null===e)return null;var i=Math.log2(e)-2,n=1/e,r;return{texelWidth:1/(3*Math.max(Math.pow(2,i),112)),texelHeight:n,maxMip:i}}function qu(l,t,e,i){const h=l.getContext();var n=e.defines,r=e.vertexShader,a=e.fragmentShader,s=Gu(e),o=Hu(e),c=Wu(e),u=Xu(e),d=ju(e);const p=Cu(e),m=Ru(n),f=h.createProgram();let g,v,_=e.glslVersion?"#version "+e.glslVersion+"\n":"";e.isRawShaderMaterial?(g=["#define SHADER_TYPE "+e.shaderType,"#define SHADER_NAME "+e.shaderName,m].filter(Iu).join("\n"),0<g.length&&(g+="\n"),v=["#define SHADER_TYPE "+e.shaderType,"#define SHADER_NAME "+e.shaderName,m].filter(Iu).join("\n"),0<v.length&&(v+="\n")):(g=[Vu(e),"#define SHADER_TYPE "+e.shaderType,"#define SHADER_NAME "+e.shaderName,m,e.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",e.batching?"#define USE_BATCHING":"",e.batchingColor?"#define USE_BATCHING_COLOR":"",e.instancing?"#define USE_INSTANCING":"",e.instancingColor?"#define USE_INSTANCING_COLOR":"",e.instancingMorph?"#define USE_INSTANCING_MORPH":"",e.useFog&&e.fog?"#define USE_FOG":"",e.useFog&&e.fogExp2?"#define FOG_EXP2":"",e.map?"#define USE_MAP":"",e.envMap?"#define USE_ENVMAP":"",e.envMap?"#define "+c:"",e.lightMap?"#define USE_LIGHTMAP":"",e.aoMap?"#define USE_AOMAP":"",e.bumpMap?"#define USE_BUMPMAP":"",e.normalMap?"#define USE_NORMALMAP":"",e.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",e.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",e.displacementMap?"#define USE_DISPLACEMENTMAP":"",e.emissiveMap?"#define USE_EMISSIVEMAP":"",e.anisotropy?"#define USE_ANISOTROPY":"",e.anisotropyMap?"#define USE_ANISOTROPYMAP":"",e.clearcoatMap?"#define USE_CLEARCOATMAP":"",e.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",e.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",e.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",e.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",e.specularMap?"#define USE_SPECULARMAP":"",e.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",e.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",e.roughnessMap?"#define USE_ROUGHNESSMAP":"",e.metalnessMap?"#define USE_METALNESSMAP":"",e.alphaMap?"#define USE_ALPHAMAP":"",e.alphaHash?"#define USE_ALPHAHASH":"",e.transmission?"#define USE_TRANSMISSION":"",e.transmissionMap?"#define USE_TRANSMISSIONMAP":"",e.thicknessMap?"#define USE_THICKNESSMAP":"",e.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",e.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",e.mapUv?"#define MAP_UV "+e.mapUv:"",e.alphaMapUv?"#define ALPHAMAP_UV "+e.alphaMapUv:"",e.lightMapUv?"#define LIGHTMAP_UV "+e.lightMapUv:"",e.aoMapUv?"#define AOMAP_UV "+e.aoMapUv:"",e.emissiveMapUv?"#define EMISSIVEMAP_UV "+e.emissiveMapUv:"",e.bumpMapUv?"#define BUMPMAP_UV "+e.bumpMapUv:"",e.normalMapUv?"#define NORMALMAP_UV "+e.normalMapUv:"",e.displacementMapUv?"#define DISPLACEMENTMAP_UV "+e.displacementMapUv:"",e.metalnessMapUv?"#define METALNESSMAP_UV "+e.metalnessMapUv:"",e.roughnessMapUv?"#define ROUGHNESSMAP_UV "+e.roughnessMapUv:"",e.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+e.anisotropyMapUv:"",e.clearcoatMapUv?"#define CLEARCOATMAP_UV "+e.clearcoatMapUv:"",e.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+e.clearcoatNormalMapUv:"",e.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+e.clearcoatRoughnessMapUv:"",e.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+e.iridescenceMapUv:"",e.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+e.iridescenceThicknessMapUv:"",e.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+e.sheenColorMapUv:"",e.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+e.sheenRoughnessMapUv:"",e.specularMapUv?"#define SPECULARMAP_UV "+e.specularMapUv:"",e.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+e.specularColorMapUv:"",e.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+e.specularIntensityMapUv:"",e.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+e.transmissionMapUv:"",e.thicknessMapUv?"#define THICKNESSMAP_UV "+e.thicknessMapUv:"",e.vertexTangents&&!1===e.flatShading?"#define USE_TANGENT":"",e.vertexColors?"#define USE_COLOR":"",e.vertexAlphas?"#define USE_COLOR_ALPHA":"",e.vertexUv1s?"#define USE_UV1":"",e.vertexUv2s?"#define USE_UV2":"",e.vertexUv3s?"#define USE_UV3":"",e.pointsUvs?"#define USE_POINTS_UV":"",e.flatShading?"#define FLAT_SHADED":"",e.skinning?"#define USE_SKINNING":"",e.morphTargets?"#define USE_MORPHTARGETS":"",e.morphNormals&&!1===e.flatShading?"#define USE_MORPHNORMALS":"",e.morphColors?"#define USE_MORPHCOLORS":"",0<e.morphTargetsCount?"#define MORPHTARGETS_TEXTURE_STRIDE "+e.morphTextureStride:"",0<e.morphTargetsCount?"#define MORPHTARGETS_COUNT "+e.morphTargetsCount:"",e.doubleSided?"#define DOUBLE_SIDED":"",e.flipSided?"#define FLIP_SIDED":"",e.shadowMapEnabled?"#define USE_SHADOWMAP":"",e.shadowMapEnabled?"#define "+s:"",e.sizeAttenuation?"#define USE_SIZEATTENUATION":"",0<e.numLightProbes?"#define USE_LIGHT_PROBES":"",e.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","\tuniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","\tattribute vec2 uv1;","#endif","#ifdef USE_UV2","\tattribute vec2 uv2;","#endif","#ifdef USE_UV3","\tattribute vec2 uv3;","#endif","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Iu).join("\n"),v=[Vu(e),"#define SHADER_TYPE "+e.shaderType,"#define SHADER_NAME "+e.shaderName,m,e.useFog&&e.fog?"#define USE_FOG":"",e.useFog&&e.fogExp2?"#define FOG_EXP2":"",e.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",e.map?"#define USE_MAP":"",e.matcap?"#define USE_MATCAP":"",e.envMap?"#define USE_ENVMAP":"",e.envMap?"#define "+o:"",e.envMap?"#define "+c:"",e.envMap?"#define "+u:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",e.lightMap?"#define USE_LIGHTMAP":"",e.aoMap?"#define USE_AOMAP":"",e.bumpMap?"#define USE_BUMPMAP":"",e.normalMap?"#define USE_NORMALMAP":"",e.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",e.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",e.emissiveMap?"#define USE_EMISSIVEMAP":"",e.anisotropy?"#define USE_ANISOTROPY":"",e.anisotropyMap?"#define USE_ANISOTROPYMAP":"",e.clearcoat?"#define USE_CLEARCOAT":"",e.clearcoatMap?"#define USE_CLEARCOATMAP":"",e.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",e.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",e.dispersion?"#define USE_DISPERSION":"",e.iridescence?"#define USE_IRIDESCENCE":"",e.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",e.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",e.specularMap?"#define USE_SPECULARMAP":"",e.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",e.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",e.roughnessMap?"#define USE_ROUGHNESSMAP":"",e.metalnessMap?"#define USE_METALNESSMAP":"",e.alphaMap?"#define USE_ALPHAMAP":"",e.alphaTest?"#define USE_ALPHATEST":"",e.alphaHash?"#define USE_ALPHAHASH":"",e.sheen?"#define USE_SHEEN":"",e.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",e.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",e.transmission?"#define USE_TRANSMISSION":"",e.transmissionMap?"#define USE_TRANSMISSIONMAP":"",e.thicknessMap?"#define USE_THICKNESSMAP":"",e.vertexTangents&&!1===e.flatShading?"#define USE_TANGENT":"",e.vertexColors||e.instancingColor||e.batchingColor?"#define USE_COLOR":"",e.vertexAlphas?"#define USE_COLOR_ALPHA":"",e.vertexUv1s?"#define USE_UV1":"",e.vertexUv2s?"#define USE_UV2":"",e.vertexUv3s?"#define USE_UV3":"",e.pointsUvs?"#define USE_POINTS_UV":"",e.gradientMap?"#define USE_GRADIENTMAP":"",e.flatShading?"#define FLAT_SHADED":"",e.doubleSided?"#define DOUBLE_SIDED":"",e.flipSided?"#define FLIP_SIDED":"",e.shadowMapEnabled?"#define USE_SHADOWMAP":"",e.shadowMapEnabled?"#define "+s:"",e.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",0<e.numLightProbes?"#define USE_LIGHT_PROBES":"",e.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",e.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",e.toneMapping!==oe?"#define TONE_MAPPING":"",e.toneMapping!==oe?wh.tonemapping_pars_fragment:"",e.toneMapping!==oe?Tu("toneMapping",e.toneMapping):"",e.dithering?"#define DITHERING":"",e.opaque?"#define OPAQUE":"",wh.colorspace_pars_fragment,wu("linearToOutputTexel",e.outputColorSpace),Au(),e.useDepthPacking?"#define DEPTH_PACKING "+e.depthPacking:"","\n"].filter(Iu).join("\n")),r=Uu(r=Lu(r=Du(r),e),e),a=Uu(a=Lu(a=Du(a),e),e),r=zu(r),a=zu(a),!0!==e.isRawShaderMaterial&&(_="#version 300 es\n",g=[p,"#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+g,v=["#define varying in",e.glslVersion===Hi?"":"layout(location = 0) out highp vec4 pc_fragColor;",e.glslVersion===Hi?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+v);var y=_+g+r,x=_+v+a;const M=_u(h,h.VERTEX_SHADER,y),S=_u(h,h.FRAGMENT_SHADER,x);function b(i){if(l.debug.checkShaderErrors){var n=h.getProgramInfoLog(f).trim(),r=h.getShaderInfoLog(M).trim(),a=h.getShaderInfoLog(S).trim(),s,o;let t=!0,e=!0;!1===h.getProgramParameter(f,h.LINK_STATUS)?(t=!1,"function"==typeof l.debug.onShaderError?l.debug.onShaderError(h,f,M,S):(s=bu(h,M,"vertex"),o=bu(h,S,"fragment"),console.error("THREE.WebGLProgram: Shader Error "+h.getError()+" - VALIDATE_STATUS "+h.getProgramParameter(f,h.VALIDATE_STATUS)+"\n\nMaterial Name: "+i.name+"\nMaterial Type: "+i.type+"\n\nProgram Info Log: "+n+"\n"+s+"\n"+o))):""!==n?console.warn("THREE.WebGLProgram: Program Info Log:",n):""!==r&&""!==a||(e=!1),e&&(i.diagnostics={runnable:t,programLog:n,vertexShader:{log:r,prefix:g},fragmentShader:{log:a,prefix:v}})}h.deleteShader(M),h.deleteShader(S),w=new vu(h,f),T=Pu(h,f)}h.attachShader(f,M),h.attachShader(f,S),void 0!==e.index0AttributeName?h.bindAttribLocation(f,0,e.index0AttributeName):!0===e.morphTargets&&h.bindAttribLocation(f,0,"position"),h.linkProgram(f);let w;this.getUniforms=function(){return void 0===w&&b(this),w};let T,E=!(this.getAttributes=function(){return void 0===T&&b(this),T})===e.rendererExtensionParallelShaderCompile;return this.isReady=function(){return!1===E&&(E=h.getProgramParameter(f,yu)),E},this.destroy=function(){i.releaseStatesOfProgram(this),h.deleteProgram(f),this.program=void 0},this.type=e.shaderType,this.name=e.shaderName,this.id=xu++,this.cacheKey=t,this.usedTimes=1,this.program=f,this.vertexShader=M,this.fragmentShader=S,this}let Yu=0;class Zu{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(t){var e=t.vertexShader,i=t.fragmentShader;const n=this._getShaderStage(e),r=this._getShaderStage(i),a=this._getShaderCacheForMaterial(t);return!1===a.has(n)&&(a.add(n),n.usedTimes++),!1===a.has(r)&&(a.add(r),r.usedTimes++),this}remove(t){var e;for(const i of this.materialCache.get(t))i.usedTimes--,0===i.usedTimes&&this.shaderCache.delete(i.code);return this.materialCache.delete(t),this}getVertexShaderID(t){return this._getShaderStage(t.vertexShader).id}getFragmentShaderID(t){return this._getShaderStage(t.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(t){const e=this.materialCache;let i=e.get(t);return void 0===i&&(i=new Set,e.set(t,i)),i}_getShaderStage(t){const e=this.shaderCache;let i=e.get(t);return void 0===i&&(i=new Ju(t),e.set(t,i)),i}}class Ju{constructor(t){this.id=Yu++,this.code=t,this.usedTimes=0}}function Ku(at,st,ot,lt,ht,e,ct){const i=new Vr,ut=new Zu,dt=new Set,a=[],pt=ht.logarithmicDepthBuffer,mt=ht.vertexTextures;let ft=ht.precision;const gt={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function vt(t){return dt.add(t),0===t?"uv":"uv"+t}function t(t,e,i,n,r){var a=n.fog,s=r.geometry,o=t.isMeshStandardMaterial?n.environment:null,l=(t.isMeshStandardMaterial?ot:st).get(t.envMap||o),h=l&&l.mapping===_t?l.image.height:null,c=gt[t.type];null!==t.precision&&(ft=ht.getMaxPrecision(t.precision),ft!==t.precision&&console.warn("THREE.WebGLProgram.getParameters:",t.precision,"not supported, using",ft,"instead."));var u=s.morphAttributes.position||s.morphAttributes.normal||s.morphAttributes.color,d=void 0!==u?u.length:0,p;let m=0;void 0!==s.morphAttributes.position&&(m=1),void 0!==s.morphAttributes.normal&&(m=2),void 0!==s.morphAttributes.color&&(m=3);let f,g,v,_;c?(p=Eh[c],f=p.vertexShader,g=p.fragmentShader):(f=t.vertexShader,g=t.fragmentShader,ut.update(t),v=ut.getVertexShaderID(t),_=ut.getFragmentShaderID(t));var y=at.getRenderTarget(),x=!0===r.isInstancedMesh,M=!0===r.isBatchedMesh,S=!!t.map,b=!!t.matcap,w=!!l,T=!!t.aoMap,E=!!t.lightMap,A=!!t.bumpMap,C=!!t.normalMap,R=!!t.displacementMap,P=!!t.emissiveMap,I=!!t.metalnessMap,L=!!t.roughnessMap,U=0<t.anisotropy,N=0<t.clearcoat,D=0<t.dispersion,O=0<t.iridescence,B=0<t.sheen,F=0<t.transmission,z=U&&!!t.anisotropyMap,k=N&&!!t.clearcoatMap,V=N&&!!t.clearcoatNormalMap,G=N&&!!t.clearcoatRoughnessMap,H=O&&!!t.iridescenceMap,W=O&&!!t.iridescenceThicknessMap,X=B&&!!t.sheenColorMap,j=B&&!!t.sheenRoughnessMap,q=!!t.specularMap,Y=!!t.specularColorMap,Z=!!t.specularIntensityMap,J=F&&!!t.transmissionMap,K=F&&!!t.thicknessMap,$=!!t.gradientMap,Q=!!t.alphaMap,tt=0<t.alphaTest,et=!!t.alphaHash,it=!!t.extensions;let nt=oe;t.toneMapped&&(null!==y&&!0!==y.isXRRenderTarget||(nt=at.toneMapping));const rt={shaderID:c,shaderType:t.type,shaderName:t.name,vertexShader:f,fragmentShader:g,defines:t.defines,customVertexShaderID:v,customFragmentShaderID:_,isRawShaderMaterial:!0===t.isRawShaderMaterial,glslVersion:t.glslVersion,precision:ft,batching:M,batchingColor:M&&null!==r._colorsTexture,instancing:x,instancingColor:x&&null!==r.instanceColor,instancingMorph:x&&null!==r.morphTexture,supportsVertexTextures:mt,outputColorSpace:null===y?at.outputColorSpace:!0===y.isXRRenderTarget?y.texture.colorSpace:ii,alphaToCoverage:!!t.alphaToCoverage,map:S,matcap:b,envMap:w,envMapMode:w&&l.mapping,envMapCubeUVHeight:h,aoMap:T,lightMap:E,bumpMap:A,normalMap:C,displacementMap:mt&&R,emissiveMap:P,normalMapObjectSpace:C&&t.normalMapType===Qe,normalMapTangentSpace:C&&t.normalMapType===$e,metalnessMap:I,roughnessMap:L,anisotropy:U,anisotropyMap:z,clearcoat:N,clearcoatMap:k,clearcoatNormalMap:V,clearcoatRoughnessMap:G,dispersion:D,iridescence:O,iridescenceMap:H,iridescenceThicknessMap:W,sheen:B,sheenColorMap:X,sheenRoughnessMap:j,specularMap:q,specularColorMap:Y,specularIntensityMap:Z,transmission:F,transmissionMap:J,thicknessMap:K,gradientMap:$,opaque:!1===t.transparent&&t.blending===wt&&!1===t.alphaToCoverage,alphaMap:Q,alphaTest:tt,alphaHash:et,combine:t.combine,mapUv:S&&vt(t.map.channel),aoMapUv:T&&vt(t.aoMap.channel),lightMapUv:E&&vt(t.lightMap.channel),bumpMapUv:A&&vt(t.bumpMap.channel),normalMapUv:C&&vt(t.normalMap.channel),displacementMapUv:R&&vt(t.displacementMap.channel),emissiveMapUv:P&&vt(t.emissiveMap.channel),metalnessMapUv:I&&vt(t.metalnessMap.channel),roughnessMapUv:L&&vt(t.roughnessMap.channel),anisotropyMapUv:z&&vt(t.anisotropyMap.channel),clearcoatMapUv:k&&vt(t.clearcoatMap.channel),clearcoatNormalMapUv:V&&vt(t.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:G&&vt(t.clearcoatRoughnessMap.channel),iridescenceMapUv:H&&vt(t.iridescenceMap.channel),iridescenceThicknessMapUv:W&&vt(t.iridescenceThicknessMap.channel),sheenColorMapUv:X&&vt(t.sheenColorMap.channel),sheenRoughnessMapUv:j&&vt(t.sheenRoughnessMap.channel),specularMapUv:q&&vt(t.specularMap.channel),specularColorMapUv:Y&&vt(t.specularColorMap.channel),specularIntensityMapUv:Z&&vt(t.specularIntensityMap.channel),transmissionMapUv:J&&vt(t.transmissionMap.channel),thicknessMapUv:K&&vt(t.thicknessMap.channel),alphaMapUv:Q&&vt(t.alphaMap.channel),vertexTangents:!!s.attributes.tangent&&(C||U),vertexColors:t.vertexColors,vertexAlphas:!0===t.vertexColors&&!!s.attributes.color&&4===s.attributes.color.itemSize,pointsUvs:!0===r.isPoints&&!!s.attributes.uv&&(S||Q),fog:!!a,useFog:!0===t.fog,fogExp2:!!a&&a.isFogExp2,flatShading:!0===t.flatShading,sizeAttenuation:!0===t.sizeAttenuation,logarithmicDepthBuffer:pt,skinning:!0===r.isSkinnedMesh,morphTargets:void 0!==s.morphAttributes.position,morphNormals:void 0!==s.morphAttributes.normal,morphColors:void 0!==s.morphAttributes.color,morphTargetsCount:d,morphTextureStride:m,numDirLights:e.directional.length,numPointLights:e.point.length,numSpotLights:e.spot.length,numSpotLightMaps:e.spotLightMap.length,numRectAreaLights:e.rectArea.length,numHemiLights:e.hemi.length,numDirLightShadows:e.directionalShadowMap.length,numPointLightShadows:e.pointShadowMap.length,numSpotLightShadows:e.spotShadowMap.length,numSpotLightShadowsWithMaps:e.numSpotLightShadowsWithMaps,numLightProbes:e.numLightProbes,numClippingPlanes:ct.numPlanes,numClipIntersection:ct.numIntersection,dithering:t.dithering,shadowMapEnabled:at.shadowMap.enabled&&0<i.length,shadowMapType:at.shadowMap.type,toneMapping:nt,decodeVideoTexture:S&&!0===t.map.isVideoTexture&&On.getTransfer(t.map.colorSpace)===si,premultipliedAlpha:t.premultipliedAlpha,doubleSided:t.side===Zt,flipSided:t.side===Yt,useDepthPacking:0<=t.depthPacking,depthPacking:t.depthPacking||0,index0AttributeName:t.index0AttributeName,extensionClipCullDistance:it&&!0===t.extensions.clipCullDistance&&lt.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(it&&!0===t.extensions.multiDraw||M)&&lt.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:lt.has("KHR_parallel_shader_compile"),customProgramCacheKey:t.customProgramCacheKey()};return rt.vertexUv1s=dt.has(1),rt.vertexUv2s=dt.has(2),rt.vertexUv3s=dt.has(3),dt.clear(),rt}function n(t){const e=[];if(t.shaderID?e.push(t.shaderID):(e.push(t.customVertexShaderID),e.push(t.customFragmentShaderID)),void 0!==t.defines)for(const i in t.defines)e.push(i),e.push(t.defines[i]);return!1===t.isRawShaderMaterial&&(r(e,t),s(e,t),e.push(at.outputColorSpace)),e.push(t.customProgramCacheKey),e.join()}function r(t,e){t.push(e.precision),t.push(e.outputColorSpace),t.push(e.envMapMode),t.push(e.envMapCubeUVHeight),t.push(e.mapUv),t.push(e.alphaMapUv),t.push(e.lightMapUv),t.push(e.aoMapUv),t.push(e.bumpMapUv),t.push(e.normalMapUv),t.push(e.displacementMapUv),t.push(e.emissiveMapUv),t.push(e.metalnessMapUv),t.push(e.roughnessMapUv),t.push(e.anisotropyMapUv),t.push(e.clearcoatMapUv),t.push(e.clearcoatNormalMapUv),t.push(e.clearcoatRoughnessMapUv),t.push(e.iridescenceMapUv),t.push(e.iridescenceThicknessMapUv),t.push(e.sheenColorMapUv),t.push(e.sheenRoughnessMapUv),t.push(e.specularMapUv),t.push(e.specularColorMapUv),t.push(e.specularIntensityMapUv),t.push(e.transmissionMapUv),t.push(e.thicknessMapUv),t.push(e.combine),t.push(e.fogExp2),t.push(e.sizeAttenuation),t.push(e.morphTargetsCount),t.push(e.morphAttributeCount),t.push(e.numDirLights),t.push(e.numPointLights),t.push(e.numSpotLights),t.push(e.numSpotLightMaps),t.push(e.numHemiLights),t.push(e.numRectAreaLights),t.push(e.numDirLightShadows),t.push(e.numPointLightShadows),t.push(e.numSpotLightShadows),t.push(e.numSpotLightShadowsWithMaps),t.push(e.numLightProbes),t.push(e.shadowMapType),t.push(e.toneMapping),t.push(e.numClippingPlanes),t.push(e.numClipIntersection),t.push(e.depthPacking)}function s(t,e){i.disableAll(),e.supportsVertexTextures&&i.enable(0),e.instancing&&i.enable(1),e.instancingColor&&i.enable(2),e.instancingMorph&&i.enable(3),e.matcap&&i.enable(4),e.envMap&&i.enable(5),e.normalMapObjectSpace&&i.enable(6),e.normalMapTangentSpace&&i.enable(7),e.clearcoat&&i.enable(8),e.iridescence&&i.enable(9),e.alphaTest&&i.enable(10),e.vertexColors&&i.enable(11),e.vertexAlphas&&i.enable(12),e.vertexUv1s&&i.enable(13),e.vertexUv2s&&i.enable(14),e.vertexUv3s&&i.enable(15),e.vertexTangents&&i.enable(16),e.anisotropy&&i.enable(17),e.alphaHash&&i.enable(18),e.batching&&i.enable(19),e.dispersion&&i.enable(20),e.batchingColor&&i.enable(21),t.push(i.mask),i.disableAll(),e.fog&&i.enable(0),e.useFog&&i.enable(1),e.flatShading&&i.enable(2),e.logarithmicDepthBuffer&&i.enable(3),e.skinning&&i.enable(4),e.morphTargets&&i.enable(5),e.morphNormals&&i.enable(6),e.morphColors&&i.enable(7),e.premultipliedAlpha&&i.enable(8),e.shadowMapEnabled&&i.enable(9),e.doubleSided&&i.enable(10),e.flipSided&&i.enable(11),e.useDepthPacking&&i.enable(12),e.dithering&&i.enable(13),e.transmission&&i.enable(14),e.sheen&&i.enable(15),e.opaque&&i.enable(16),e.pointsUvs&&i.enable(17),e.decodeVideoTexture&&i.enable(18),e.alphaToCoverage&&i.enable(19),t.push(i.mask)}function o(t){var e=gt[t.type],i;let n;return n=e?(i=Eh[e],xs.clone(i.uniforms)):t.uniforms,n}function l(t,i){let n;for(let t=0,e=a.length;t<e;t++){var r=a[t];if(r.cacheKey===i){n=r,++n.usedTimes;break}}return void 0===n&&(n=new qu(at,i,t,e),a.push(n)),n}function h(t){var e;0==--t.usedTimes&&(e=a.indexOf(t),a[e]=a[a.length-1],a.pop(),t.destroy())}function c(t){ut.remove(t)}function u(){ut.dispose()}return{getParameters:t,getProgramCacheKey:n,getUniforms:o,acquireProgram:l,releaseProgram:h,releaseShaderCache:c,programs:a,dispose:u}}function $u(){let n=new WeakMap;function t(t){let e=n.get(t);return void 0===e&&(e={},n.set(t,e)),e}function e(t){n.delete(t)}function i(t,e,i){n.get(t)[e]=i}function r(){n=new WeakMap}return{get:t,remove:e,update:i,dispose:r}}function Qu(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function td(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function ed(){const o=[];let l=0;const h=[],c=[],u=[];function t(){l=0,h.length=0,c.length=0,u.length=0}function d(t,e,i,n,r,a){let s=o[l];return void 0===s?(s={id:t.id,object:t,geometry:e,material:i,groupOrder:n,renderOrder:t.renderOrder,z:r,group:a},o[l]=s):(s.id=t.id,s.object=t,s.geometry=e,s.material=i,s.groupOrder=n,s.renderOrder=t.renderOrder,s.z=r,s.group=a),l++,s}function e(t,e,i,n,r,a){var s=d(t,e,i,n,r,a);(0<i.transmission?c:!0===i.transparent?u:h).push(s)}function i(t,e,i,n,r,a){var s=d(t,e,i,n,r,a);(0<i.transmission?c:!0===i.transparent?u:h).unshift(s)}function n(t,e){1<h.length&&h.sort(t||Qu),1<c.length&&c.sort(e||td),1<u.length&&u.sort(e||td)}function r(){for(let t=l,e=o.length;t<e;t++){const i=o[t];if(null===i.id)break;i.id=null,i.object=null,i.geometry=null,i.material=null,i.group=null}}return{opaque:h,transmissive:c,transparent:u,init:t,push:e,unshift:i,finish:r,sort:n}}function id(){let r=new WeakMap;function t(t,e){const i=r.get(t);let n;return void 0===i?(n=new ed,r.set(t,[n])):e>=i.length?(n=new ed,i.push(n)):n=i[e],n}function e(){r=new WeakMap}return{get:t,dispose:e}}function nd(){const i={};return{get:function(t){if(void 0!==i[t.id])return i[t.id];let e;switch(t.type){case"DirectionalLight":e={direction:new tr,color:new ya};break;case"SpotLight":e={position:new tr,direction:new tr,color:new ya,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":e={position:new tr,color:new ya,distance:0,decay:0};break;case"HemisphereLight":e={direction:new tr,skyColor:new ya,groundColor:new ya};break;case"RectAreaLight":e={color:new ya,position:new tr,halfWidth:new tr,halfHeight:new tr}}return i[t.id]=e,e}}}function rd(){const i={};return{get:function(t){if(void 0!==i[t.id])return i[t.id];let e;switch(t.type){case"DirectionalLight":case"SpotLight":e={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Mn};break;case"PointLight":e={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Mn,shadowCameraNear:1,shadowCameraFar:1e3}}return i[t.id]=e,e}}}let ad=0;function sd(t,e){return(e.castShadow?2:0)-(t.castShadow?2:0)+(e.map?1:0)-(t.map?1:0)}function od(e){const U=new nd,N=rd(),D={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let t=0;t<9;t++)D.probe.push(new tr);const f=new tr,g=new Pr,v=new Pr;function t(i){let n=0,r=0,a=0;for(let t=0;t<9;t++)D.probe[t].set(0,0,0);let s=0,o=0,l=0,h=0,c=0,u=0,d=0,p=0,m=0,f=0,g=0;i.sort(sd);for(let t=0,e=i.length;t<e;t++){var v=i[t],_=v.color,y=v.intensity,x=v.distance,M=v.shadow&&v.shadow.map?v.shadow.map.texture:null;if(v.isAmbientLight)n+=_.r*y,r+=_.g*y,a+=_.b*y;else if(v.isLightProbe){for(let t=0;t<9;t++)D.probe[t].addScaledVector(v.sh.coefficients[t],y);g++}else if(v.isDirectionalLight){const w=U.get(v);if(w.color.copy(v.color).multiplyScalar(v.intensity),v.castShadow){var S=v.shadow;const T=N.get(v);T.shadowIntensity=S.intensity,T.shadowBias=S.bias,T.shadowNormalBias=S.normalBias,T.shadowRadius=S.radius,T.shadowMapSize=S.mapSize,D.directionalShadow[s]=T,D.directionalShadowMap[s]=M,D.directionalShadowMatrix[s]=v.shadow.matrix,u++}D.directional[s]=w,s++}else if(v.isSpotLight){const E=U.get(v);E.position.setFromMatrixPosition(v.matrixWorld),E.color.copy(_).multiplyScalar(y),E.distance=x,E.coneCos=Math.cos(v.angle),E.penumbraCos=Math.cos(v.angle*(1-v.penumbra)),E.decay=v.decay,D.spot[l]=E;const A=v.shadow;if(v.map&&(D.spotLightMap[m]=v.map,m++,A.updateMatrices(v),v.castShadow&&f++),D.spotLightMatrix[l]=A.matrix,v.castShadow){const C=N.get(v);C.shadowIntensity=A.intensity,C.shadowBias=A.bias,C.shadowNormalBias=A.normalBias,C.shadowRadius=A.radius,C.shadowMapSize=A.mapSize,D.spotShadow[l]=C,D.spotShadowMap[l]=M,p++}l++}else if(v.isRectAreaLight){const R=U.get(v);R.color.copy(_).multiplyScalar(y),R.halfWidth.set(.5*v.width,0,0),R.halfHeight.set(0,.5*v.height,0),D.rectArea[h]=R,h++}else if(v.isPointLight){const P=U.get(v);if(P.color.copy(v.color).multiplyScalar(v.intensity),P.distance=v.distance,P.decay=v.decay,v.castShadow){var b=v.shadow;const I=N.get(v);I.shadowIntensity=b.intensity,I.shadowBias=b.bias,I.shadowNormalBias=b.normalBias,I.shadowRadius=b.radius,I.shadowMapSize=b.mapSize,I.shadowCameraNear=b.camera.near,I.shadowCameraFar=b.camera.far,D.pointShadow[o]=I,D.pointShadowMap[o]=M,D.pointShadowMatrix[o]=v.shadow.matrix,d++}D.point[o]=P,o++}else if(v.isHemisphereLight){const L=U.get(v);L.skyColor.copy(v.color).multiplyScalar(y),L.groundColor.copy(v.groundColor).multiplyScalar(y),D.hemi[c]=L,c++}}0<h&&(!0===e.has("OES_texture_float_linear")?(D.rectAreaLTC1=Th.LTC_FLOAT_1,D.rectAreaLTC2=Th.LTC_FLOAT_2):(D.rectAreaLTC1=Th.LTC_HALF_1,D.rectAreaLTC2=Th.LTC_HALF_2)),D.ambient[0]=n,D.ambient[1]=r,D.ambient[2]=a;const t=D.hash;t.directionalLength===s&&t.pointLength===o&&t.spotLength===l&&t.rectAreaLength===h&&t.hemiLength===c&&t.numDirectionalShadows===u&&t.numPointShadows===d&&t.numSpotShadows===p&&t.numSpotMaps===m&&t.numLightProbes===g||(D.directional.length=s,D.spot.length=l,D.rectArea.length=h,D.point.length=o,D.hemi.length=c,D.directionalShadow.length=u,D.directionalShadowMap.length=u,D.pointShadow.length=d,D.pointShadowMap.length=d,D.spotShadow.length=p,D.spotShadowMap.length=p,D.directionalShadowMatrix.length=u,D.pointShadowMatrix.length=d,D.spotLightMatrix.length=p+m-f,D.spotLightMap.length=m,D.numSpotLightShadowsWithMaps=f,D.numLightProbes=g,t.directionalLength=s,t.pointLength=o,t.spotLength=l,t.rectAreaLength=h,t.hemiLength=c,t.numDirectionalShadows=u,t.numPointShadows=d,t.numSpotShadows=p,t.numSpotMaps=m,t.numLightProbes=g,D.version=ad++)}function i(i,t){let n=0,r=0,a=0,s=0,o=0;var l=t.matrixWorldInverse;for(let t=0,e=i.length;t<e;t++){var h=i[t];if(h.isDirectionalLight){const c=D.directional[n];c.direction.setFromMatrixPosition(h.matrixWorld),f.setFromMatrixPosition(h.target.matrixWorld),c.direction.sub(f),c.direction.transformDirection(l),n++}else if(h.isSpotLight){const u=D.spot[a];u.position.setFromMatrixPosition(h.matrixWorld),u.position.applyMatrix4(l),u.direction.setFromMatrixPosition(h.matrixWorld),f.setFromMatrixPosition(h.target.matrixWorld),u.direction.sub(f),u.direction.transformDirection(l),a++}else if(h.isRectAreaLight){const d=D.rectArea[s];d.position.setFromMatrixPosition(h.matrixWorld),d.position.applyMatrix4(l),v.identity(),g.copy(h.matrixWorld),g.premultiply(l),v.extractRotation(g),d.halfWidth.set(.5*h.width,0,0),d.halfHeight.set(0,.5*h.height,0),d.halfWidth.applyMatrix4(v),d.halfHeight.applyMatrix4(v),s++}else if(h.isPointLight){const p=D.point[r];p.position.setFromMatrixPosition(h.matrixWorld),p.position.applyMatrix4(l),r++}else if(h.isHemisphereLight){const m=D.hemi[o];m.direction.setFromMatrixPosition(h.matrixWorld),m.direction.transformDirection(l),o++}}}return{setup:t,setupView:i,state:D}}function ld(t){const e=new od(t),i=[],n=[];function r(t){h.camera=t,i.length=0,n.length=0}function a(t){i.push(t)}function s(t){n.push(t)}function o(){e.setup(i)}function l(t){e.setupView(i,t)}const h={lightsArray:i,shadowsArray:n,camera:null,lights:e,transmissionRenderTarget:{}};return{init:r,state:h,setupLights:o,setupLightsView:l,pushLight:a,pushShadow:s}}function hd(r){let a=new WeakMap;function t(t,e=0){const i=a.get(t);let n;return void 0===i?(n=new ld(r),a.set(t,[n])):e>=i.length?(n=new ld(r),i.push(n)):n=i[e],n}function e(){a=new WeakMap}return{get:t,dispose:e}}class cd extends Sa{constructor(t){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=Ye,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}}class ud extends Sa{constructor(t){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(t)}copy(t){return super.copy(t),this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}}const dd="void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",pd="uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}";function md(f,m,t){let g=new xh;const v=new Mn,_=new Mn,y=new jn,h=new cd({depthPacking:Ze}),c=new ud,u={},x=t.maxTextureSize,d={[qt]:Yt,[Yt]:qt,[Zt]:Zt},n=new nh({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Mn},radius:{value:4}},vertexShader:dd,fragmentShader:pd}),r=n.clone();r.defines.HORIZONTAL_PASS=1;const e=new Ya;e.setAttribute("position",new Ia(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const a=new ds(e,n),M=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=E;let S=this.type;function b(t,e){var i=m.update(a);n.defines.VSM_SAMPLES!==t.blurSamples&&(n.defines.VSM_SAMPLES=t.blurSamples,r.defines.VSM_SAMPLES=t.blurSamples,n.needsUpdate=!0,r.needsUpdate=!0),null===t.mapPass&&(t.mapPass=new Yn(v.x,v.y)),n.uniforms.shadow_pass.value=t.map.texture,n.uniforms.resolution.value=t.mapSize,n.uniforms.radius.value=t.radius,f.setRenderTarget(t.mapPass),f.clear(),f.renderBufferDirect(e,null,i,n,a,null),r.uniforms.shadow_pass.value=t.mapPass.texture,r.uniforms.resolution.value=t.mapSize,r.uniforms.radius.value=t.radius,f.setRenderTarget(t.map),f.clear(),f.renderBufferDirect(e,null,i,r,a,null)}function w(t,i,e,n){let r=null;var a=!0===e.isPointLight?t.customDistanceMaterial:t.customDepthMaterial;if(void 0!==a)r=a;else if(r=!0===e.isPointLight?c:h,f.localClippingEnabled&&!0===i.clipShadows&&Array.isArray(i.clippingPlanes)&&0!==i.clippingPlanes.length||i.displacementMap&&0!==i.displacementScale||i.alphaMap&&0<i.alphaTest||i.map&&0<i.alphaTest){var s=r.uuid,o=i.uuid;let t=u[s];void 0===t&&(t={},u[s]=t);let e=t[o];void 0===e&&(e=r.clone(),t[o]=e,i.addEventListener("dispose",p)),r=e}if(r.visible=i.visible,r.wireframe=i.wireframe,n===A?r.side=null!==i.shadowSide?i.shadowSide:i.side:r.side=null!==i.shadowSide?i.shadowSide:d[i.side],r.alphaMap=i.alphaMap,r.alphaTest=i.alphaTest,r.map=i.map,r.clipShadows=i.clipShadows,r.clippingPlanes=i.clippingPlanes,r.clipIntersection=i.clipIntersection,r.displacementMap=i.displacementMap,r.displacementScale=i.displacementScale,r.displacementBias=i.displacementBias,r.wireframeLinewidth=i.wireframeLinewidth,r.linewidth=i.linewidth,!0===e.isPointLight&&!0===r.isMeshDistanceMaterial){const l=f.properties.get(r);l.light=e}return r}function T(i,n,r,a,s){if(!1!==i.visible){var t=i.layers.test(n.layers);if(t&&(i.isMesh||i.isLine||i.isPoints)&&(i.castShadow||i.receiveShadow&&s===A)&&(!i.frustumCulled||g.intersectsObject(i))){i.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,i.matrixWorld);var o=m.update(i),l=i.material,e;if(Array.isArray(l)){var h=o.groups;for(let t=0,e=h.length;t<e;t++){var c=h[t],u=l[c.materialIndex],d;u&&u.visible&&(d=w(i,u,a,s),i.onBeforeShadow(f,i,n,r,o,d,c),f.renderBufferDirect(r,null,o,d,i,c),i.onAfterShadow(f,i,n,r,o,d,c))}}else{l.visible&&(e=w(i,l,a,s),i.onBeforeShadow(f,i,n,r,o,e,null),f.renderBufferDirect(r,null,o,e,i,null),i.onAfterShadow(f,i,n,r,o,e,null))}}var p=i.children;for(let t=0,e=p.length;t<e;t++)T(p[t],n,r,a,s)}}function p(t){const e=t.target;e.removeEventListener("dispose",p);for(const n in u){const r=u[n];var i=t.target.uuid;if(i in r){const a=r[i];a.dispose(),delete r[i]}}}this.render=function(i,n,r){if(!1!==M.enabled&&(!1!==M.autoUpdate||!1!==M.needsUpdate)&&0!==i.length){var t=f.getRenderTarget(),e=f.getActiveCubeFace(),a=f.getActiveMipmapLevel();const p=f.state;p.setBlending(bt),p.buffers.color.setClear(1,1,1,1),p.buffers.depth.setTest(!0),p.setScissorTest(!1);var s=S!==A&&this.type===A,o=S===A&&this.type!==A;for(let t=0,e=i.length;t<e;t++){var l=i[t];const m=l.shadow;if(void 0!==m){if(!1!==m.autoUpdate||!1!==m.needsUpdate){v.copy(m.mapSize);var h=m.getFrameExtents(),c;v.multiply(h),_.copy(m.mapSize),(v.x>x||v.y>x)&&(v.x>x&&(_.x=Math.floor(x/h.x),v.x=_.x*h.x,m.mapSize.x=_.x),v.y>x&&(_.y=Math.floor(x/h.y),v.y=_.y*h.y,m.mapSize.y=_.y)),null!==m.map&&!0!=s&&!0!=o||(c=this.type!==A?{minFilter:at,magFilter:at}:{},null!==m.map&&m.map.dispose(),m.map=new Yn(v.x,v.y,c),m.map.texture.name=l.name+".shadowMap",m.camera.updateProjectionMatrix()),f.setRenderTarget(m.map),f.clear();var u=m.getViewportCount();for(let t=0;t<u;t++){var d=m.getViewport(t);y.set(_.x*d.x,_.y*d.y,_.x*d.z,_.y*d.w),p.viewport(y),m.updateMatrices(l,t),g=m.getFrustum(),T(n,r,m.camera,l,this.type)}!0!==m.isPointLightShadow&&this.type===A&&b(m,r),m.needsUpdate=!1}}else console.warn("THREE.WebGLShadowMap:",l,"has no shadow.")}S=this.type,M.needsUpdate=!1,f.setRenderTarget(t,e,a)}}}function fd(c){function t(){let e=!1;const a=new jn;let i=null;const s=new jn(0,0,0,0);return{setMask:function(t){i===t||e||(c.colorMask(t,t,t,t),i=t)},setLocked:function(t){e=t},setClear:function(t,e,i,n,r){!0===r&&(t*=n,e*=n,i*=n),a.set(t,e,i,n),!1===s.equals(a)&&(c.clearColor(t,e,i,n),s.copy(a))},reset:function(){e=!1,i=null,s.set(-1,0,0,0)}}}function e(){let e=!1,i=null,n=null,r=null;return{setTest:function(t){(t?G:H)(c.DEPTH_TEST)},setMask:function(t){i===t||e||(c.depthMask(t),i=t)},setFunc:function(t){if(n!==t){switch(t){case Qt:c.depthFunc(c.NEVER);break;case te:c.depthFunc(c.ALWAYS);break;case ee:c.depthFunc(c.LESS);break;case ie:c.depthFunc(c.LEQUAL);break;case ne:c.depthFunc(c.EQUAL);break;case re:c.depthFunc(c.GEQUAL);break;case ae:c.depthFunc(c.GREATER);break;case se:c.depthFunc(c.NOTEQUAL);break;default:c.depthFunc(c.LEQUAL)}n=t}},setLocked:function(t){e=t},setClear:function(t){r!==t&&(c.clearDepth(t),r=t)},reset:function(){e=!1,i=null,n=null,r=null}}}function i(){let e=!1,i=null,n=null,r=null,a=null,s=null,o=null,l=null,h=null;return{setTest:function(t){e||(t?G:H)(c.STENCIL_TEST)},setMask:function(t){i===t||e||(c.stencilMask(t),i=t)},setFunc:function(t,e,i){n===t&&r===e&&a===i||(c.stencilFunc(t,e,i),n=t,r=e,a=i)},setOp:function(t,e,i){s===t&&o===e&&l===i||(c.stencilOp(t,e,i),s=t,o=e,l=i)},setLocked:function(t){e=t},setClear:function(t){h!==t&&(c.clearStencil(t),h=t)},reset:function(){e=!1,i=null,n=null,r=null,a=null,s=null,o=null,l=null,h=null}}}const r=new t,a=new e,s=new i,o=new WeakMap,l=new WeakMap;let n={},h={},u=new WeakMap,d=[],p=null,m=!1,f=null,g=null,v=null,_=null,y=null,x=null,M=null,S=new ya(0,0,0),b=0,w=!1,T=null,E=null,A=null,C=null,R=null;const P=c.getParameter(c.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let I=!1,L=0;const U=c.getParameter(c.VERSION);-1!==U.indexOf("WebGL")?(L=parseFloat(/^WebGL (\d)/.exec(U)[1]),I=1<=L):-1!==U.indexOf("OpenGL ES")&&(L=parseFloat(/^OpenGL ES (\d)/.exec(U)[1]),I=2<=L);let N=null,D={};var O=c.getParameter(c.SCISSOR_BOX),B=c.getParameter(c.VIEWPORT);const F=(new jn).fromArray(O),z=(new jn).fromArray(B);function k(e,i,n,r){var a=new Uint8Array(4),t=c.createTexture();c.bindTexture(e,t),c.texParameteri(e,c.TEXTURE_MIN_FILTER,c.NEAREST),c.texParameteri(e,c.TEXTURE_MAG_FILTER,c.NEAREST);for(let t=0;t<n;t++)e===c.TEXTURE_3D||e===c.TEXTURE_2D_ARRAY?c.texImage3D(i,0,c.RGBA,1,1,r,0,c.RGBA,c.UNSIGNED_BYTE,a):c.texImage2D(i+t,0,c.RGBA,1,1,0,c.RGBA,c.UNSIGNED_BYTE,a);return t}const V={};function G(t){!0!==n[t]&&(c.enable(t),n[t]=!0)}function H(t){!1!==n[t]&&(c.disable(t),n[t]=!1)}function W(t,e){return h[t]!==e&&(c.bindFramebuffer(t,e),h[t]=e,t===c.DRAW_FRAMEBUFFER&&(h[c.FRAMEBUFFER]=e),t===c.FRAMEBUFFER&&(h[c.DRAW_FRAMEBUFFER]=e),!0)}function X(t,e){let i=d,n=!1;if(t){i=u.get(e),void 0===i&&(i=[],u.set(e,i));var r=t.textures;if(i.length!==r.length||i[0]!==c.COLOR_ATTACHMENT0){for(let t=0,e=r.length;t<e;t++)i[t]=c.COLOR_ATTACHMENT0+t;i.length=r.length,n=!0}}else i[0]!==c.BACK&&(i[0]=c.BACK,n=!0);n&&c.drawBuffers(i)}function j(t){return p!==t&&(c.useProgram(t),p=t,!0)}V[c.TEXTURE_2D]=k(c.TEXTURE_2D,c.TEXTURE_2D,1),V[c.TEXTURE_CUBE_MAP]=k(c.TEXTURE_CUBE_MAP,c.TEXTURE_CUBE_MAP_POSITIVE_X,6),V[c.TEXTURE_2D_ARRAY]=k(c.TEXTURE_2D_ARRAY,c.TEXTURE_2D_ARRAY,1,1),V[c.TEXTURE_3D]=k(c.TEXTURE_3D,c.TEXTURE_3D,1,1),r.setClear(0,0,0,1),a.setClear(1),s.setClear(0),G(c.DEPTH_TEST),a.setFunc(ie),K(!1),$(Mt),G(c.CULL_FACE),Z(bt);const q={[Rt]:c.FUNC_ADD,[Pt]:c.FUNC_SUBTRACT,[It]:c.FUNC_REVERSE_SUBTRACT};q[Lt]=c.MIN,q[Ut]=c.MAX;const Y={[Nt]:c.ZERO,[Dt]:c.ONE,[Ot]:c.SRC_COLOR,[Ft]:c.SRC_ALPHA,[Wt]:c.SRC_ALPHA_SATURATE,[Gt]:c.DST_COLOR,[kt]:c.DST_ALPHA,[Bt]:c.ONE_MINUS_SRC_COLOR,[zt]:c.ONE_MINUS_SRC_ALPHA,[Ht]:c.ONE_MINUS_DST_COLOR,[Vt]:c.ONE_MINUS_DST_ALPHA,[Xt]:c.CONSTANT_COLOR,[Jt]:c.ONE_MINUS_CONSTANT_COLOR,[Kt]:c.CONSTANT_ALPHA,[$t]:c.ONE_MINUS_CONSTANT_ALPHA};function Z(t,e,i,n,r,a,s,o,l,h){if(t!==bt){if(!1===m&&(G(c.BLEND),m=!0),t===Ct)r=r||e,a=a||i,s=s||n,e===g&&r===y||(c.blendEquationSeparate(q[e],q[r]),g=e,y=r),i===v&&n===_&&a===x&&s===M||(c.blendFuncSeparate(Y[i],Y[n],Y[a],Y[s]),v=i,_=n,x=a,M=s),!1!==o.equals(S)&&l===b||(c.blendColor(o.r,o.g,o.b,l),S.copy(o),b=l),f=t,w=!1;else if(t!==f||h!==w){if(g===Rt&&y===Rt||(c.blendEquation(c.FUNC_ADD),g=Rt,y=Rt),h)switch(t){case wt:c.blendFuncSeparate(c.ONE,c.ONE_MINUS_SRC_ALPHA,c.ONE,c.ONE_MINUS_SRC_ALPHA);break;case Tt:c.blendFunc(c.ONE,c.ONE);break;case Et:c.blendFuncSeparate(c.ZERO,c.ONE_MINUS_SRC_COLOR,c.ZERO,c.ONE);break;case At:c.blendFuncSeparate(c.ZERO,c.SRC_COLOR,c.ZERO,c.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case wt:c.blendFuncSeparate(c.SRC_ALPHA,c.ONE_MINUS_SRC_ALPHA,c.ONE,c.ONE_MINUS_SRC_ALPHA);break;case Tt:c.blendFunc(c.SRC_ALPHA,c.ONE);break;case Et:c.blendFuncSeparate(c.ZERO,c.ONE_MINUS_SRC_COLOR,c.ZERO,c.ONE);break;case At:c.blendFunc(c.ZERO,c.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}v=null,_=null,x=null,M=null,S.set(0,0,0),b=0,f=t,w=h}}else!0===m&&(H(c.BLEND),m=!1)}function J(t,e){(t.side===Zt?H:G)(c.CULL_FACE);let i=t.side===Yt;e&&(i=!i),K(i),t.blending===wt&&!1===t.transparent?Z(bt):Z(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.blendColor,t.blendAlpha,t.premultipliedAlpha),a.setFunc(t.depthFunc),a.setTest(t.depthTest),a.setMask(t.depthWrite),r.setMask(t.colorWrite);var n=t.stencilWrite;s.setTest(n),n&&(s.setMask(t.stencilWriteMask),s.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),s.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),tt(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits),(!0===t.alphaToCoverage?G:H)(c.SAMPLE_ALPHA_TO_COVERAGE)}function K(t){T!==t&&(t?c.frontFace(c.CW):c.frontFace(c.CCW),T=t)}function $(t){t!==xt?(G(c.CULL_FACE),t!==E&&(t===Mt?c.cullFace(c.BACK):t===St?c.cullFace(c.FRONT):c.cullFace(c.FRONT_AND_BACK))):H(c.CULL_FACE),E=t}function Q(t){t!==A&&(I&&c.lineWidth(t),A=t)}function tt(t,e,i){t?(G(c.POLYGON_OFFSET_FILL),C===e&&R===i||(c.polygonOffset(e,i),C=e,R=i)):H(c.POLYGON_OFFSET_FILL)}function et(t){(t?G:H)(c.SCISSOR_TEST)}function it(t){void 0===t&&(t=c.TEXTURE0+P-1),N!==t&&(c.activeTexture(t),N=t)}function nt(t,e,i){void 0===i&&(i=null===N?c.TEXTURE0+P-1:N);let n=D[i];void 0===n&&(n={type:void 0,texture:void 0},D[i]=n),n.type===t&&n.texture===e||(N!==i&&(c.activeTexture(i),N=i),c.bindTexture(t,e||V[t]),n.type=t,n.texture=e)}function rt(){const t=D[N];void 0!==t&&void 0!==t.type&&(c.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)}function at(){try{c.compressedTexImage2D.apply(c,arguments)}catch(t){console.error("THREE.WebGLState:",t)}}function st(){try{c.compressedTexImage3D.apply(c,arguments)}catch(t){console.error("THREE.WebGLState:",t)}}function ot(){try{c.texSubImage2D.apply(c,arguments)}catch(t){console.error("THREE.WebGLState:",t)}}function lt(){try{c.texSubImage3D.apply(c,arguments)}catch(t){console.error("THREE.WebGLState:",t)}}function ht(){try{c.compressedTexSubImage2D.apply(c,arguments)}catch(t){console.error("THREE.WebGLState:",t)}}function ct(){try{c.compressedTexSubImage3D.apply(c,arguments)}catch(t){console.error("THREE.WebGLState:",t)}}function ut(){try{c.texStorage2D.apply(c,arguments)}catch(t){console.error("THREE.WebGLState:",t)}}function dt(){try{c.texStorage3D.apply(c,arguments)}catch(t){console.error("THREE.WebGLState:",t)}}function pt(){try{c.texImage2D.apply(c,arguments)}catch(t){console.error("THREE.WebGLState:",t)}}function mt(){try{c.texImage3D.apply(c,arguments)}catch(t){console.error("THREE.WebGLState:",t)}}function ft(t){!1===F.equals(t)&&(c.scissor(t.x,t.y,t.z,t.w),F.copy(t))}function gt(t){!1===z.equals(t)&&(c.viewport(t.x,t.y,t.z,t.w),z.copy(t))}function vt(t,e){let i=l.get(e);var n;void 0===i&&(i=new WeakMap,l.set(e,i)),void 0===(n=i.get(t))&&(n=c.getUniformBlockIndex(e,t.name),i.set(t,n))}function _t(t,e){const i=l.get(e);var n=i.get(t);o.get(e)!==n&&(c.uniformBlockBinding(e,n,t.__bindingPointIndex),o.set(e,n))}function yt(){c.disable(c.BLEND),c.disable(c.CULL_FACE),c.disable(c.DEPTH_TEST),c.disable(c.POLYGON_OFFSET_FILL),c.disable(c.SCISSOR_TEST),c.disable(c.STENCIL_TEST),c.disable(c.SAMPLE_ALPHA_TO_COVERAGE),c.blendEquation(c.FUNC_ADD),c.blendFunc(c.ONE,c.ZERO),c.blendFuncSeparate(c.ONE,c.ZERO,c.ONE,c.ZERO),c.blendColor(0,0,0,0),c.colorMask(!0,!0,!0,!0),c.clearColor(0,0,0,0),c.depthMask(!0),c.depthFunc(c.LESS),c.clearDepth(1),c.stencilMask(4294967295),c.stencilFunc(c.ALWAYS,0,4294967295),c.stencilOp(c.KEEP,c.KEEP,c.KEEP),c.clearStencil(0),c.cullFace(c.BACK),c.frontFace(c.CCW),c.polygonOffset(0,0),c.activeTexture(c.TEXTURE0),c.bindFramebuffer(c.FRAMEBUFFER,null),c.bindFramebuffer(c.DRAW_FRAMEBUFFER,null),c.bindFramebuffer(c.READ_FRAMEBUFFER,null),c.useProgram(null),c.lineWidth(1),c.scissor(0,0,c.canvas.width,c.canvas.height),c.viewport(0,0,c.canvas.width,c.canvas.height),n={},N=null,D={},h={},u=new WeakMap,d=[],p=null,m=!1,f=null,g=null,v=null,_=null,y=null,x=null,M=null,S=new ya(0,0,0),b=0,w=!1,T=null,E=null,A=null,C=null,R=null,F.set(0,0,c.canvas.width,c.canvas.height),z.set(0,0,c.canvas.width,c.canvas.height),r.reset(),a.reset(),s.reset()}return{buffers:{color:r,depth:a,stencil:s},enable:G,disable:H,bindFramebuffer:W,drawBuffers:X,useProgram:j,setBlending:Z,setMaterial:J,setFlipSided:K,setCullFace:$,setLineWidth:Q,setPolygonOffset:tt,setScissorTest:et,activeTexture:it,bindTexture:nt,unbindTexture:rt,compressedTexImage2D:at,compressedTexImage3D:st,texImage2D:pt,texImage3D:mt,updateUBOMapping:vt,uniformBlockBinding:_t,texStorage2D:ut,texStorage3D:dt,texSubImage2D:ot,texSubImage3D:lt,compressedTexSubImage2D:ht,compressedTexSubImage3D:ct,scissor:ft,viewport:gt,reset:yt}}function gd(t,e){var i=t.image&&t.image.width?t.image.width/t.image.height:1;return e<i?(t.repeat.x=1,t.repeat.y=i/e,t.offset.x=0,t.offset.y=(1-t.repeat.y)/2):(t.repeat.x=e/i,t.repeat.y=1,t.offset.x=(1-t.repeat.x)/2,t.offset.y=0),t}function vd(t,e){var i=t.image&&t.image.width?t.image.width/t.image.height:1;return e<i?(t.repeat.x=e/i,t.repeat.y=1,t.offset.x=(1-t.repeat.x)/2,t.offset.y=0):(t.repeat.x=1,t.repeat.y=i/e,t.offset.x=0,t.offset.y=(1-t.repeat.y)/2),t}function _d(t){return t.repeat.x=1,t.repeat.y=1,t.offset.x=0,t.offset.y=0,t}function yd(t,e,i,n){var r=xd(n);switch(i){case B:case z:return t*e;case k:return t*e*2;case V:case ge:return t*e/r.components*r.byteLength;case G:case ve:return t*e*2/r.components*r.byteLength;case F:return t*e*3/r.components*r.byteLength;case ut:case _e:return t*e*4/r.components*r.byteLength;case W:case X:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*8;case j:case q:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*16;case Z:case K:return Math.max(t,16)*Math.max(e,8)/4;case Y:case J:return Math.max(t,8)*Math.max(e,8)/2;case $:case Q:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*8;case tt:case et:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*16;case mt:return Math.floor((t+4)/5)*Math.floor((e+3)/4)*16;case ft:return Math.floor((t+4)/5)*Math.floor((e+4)/5)*16;case gt:return Math.floor((t+5)/6)*Math.floor((e+4)/5)*16;case vt:return Math.floor((t+5)/6)*Math.floor((e+5)/6)*16;case yt:return Math.floor((t+7)/8)*Math.floor((e+4)/5)*16;case ye:return Math.floor((t+7)/8)*Math.floor((e+5)/6)*16;case xe:return Math.floor((t+7)/8)*Math.floor((e+7)/8)*16;case Me:return Math.floor((t+9)/10)*Math.floor((e+4)/5)*16;case Se:return Math.floor((t+9)/10)*Math.floor((e+5)/6)*16;case be:return Math.floor((t+9)/10)*Math.floor((e+7)/8)*16;case we:return Math.floor((t+9)/10)*Math.floor((e+9)/10)*16;case Te:return Math.floor((t+11)/12)*Math.floor((e+9)/10)*16;case Ee:return Math.floor((t+11)/12)*Math.floor((e+11)/12)*16;case Ae:case Ce:case Re:return Math.ceil(t/4)*Math.ceil(e/4)*16;case Pe:case Ie:return Math.ceil(t/4)*Math.ceil(e/4)*8;case Le:case Ue:return Math.ceil(t/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${i} format.`)}function xd(t){switch(t){case he:case U:return{byteLength:1,components:1};case ce:case N:case de:return{byteLength:2,components:1};case pe:case me:return{byteLength:2,components:4};case ue:case D:case ct:return{byteLength:4,components:1};case O:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${t}.`)}const Md={contain:gd,cover:vd,fill:_d,getByteLength:yd};function Sd(C,o,R,P,I,L,m){const f=o.has("WEBGL_multisampled_render_to_texture")?o.get("WEBGL_multisampled_render_to_texture"):null,u="undefined"!=typeof navigator&&/OculusBrowser/g.test(navigator.userAgent),e=new Mn,i=new WeakMap;let h;const l=new WeakMap;let n=!1;try{n="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(t){}function c(t,e){return n?new OffscreenCanvas(t,e):An("canvas")}function U(t,e,i){let n=1;var r=et(t);if((r.width>i||r.height>i)&&(n=i/Math.max(r.width,r.height)),n<1){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap||"undefined"!=typeof VideoFrame&&t instanceof VideoFrame){var a=Math.floor(n*r.width),s=Math.floor(n*r.height);void 0===h&&(h=c(a,s));const o=e?c(a,s):h;o.width=a,o.height=s;const l=o.getContext("2d");return l.drawImage(t,0,0,a,s),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+r.width+"x"+r.height+") to ("+a+"x"+s+")."),o}return"data"in t&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+r.width+"x"+r.height+")."),t}return t}function N(t){return t.generateMipmaps&&t.minFilter!==at&&t.minFilter!==lt}function D(t){C.generateMipmap(t)}function O(t,e,i,n,r=!1){if(null!==t){if(void 0!==C[t])return C[t];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+t+"'")}let a=e;var s;return e===C.RED&&(i===C.FLOAT&&(a=C.R32F),i===C.HALF_FLOAT&&(a=C.R16F),i===C.UNSIGNED_BYTE&&(a=C.R8)),e===C.RED_INTEGER&&(i===C.UNSIGNED_BYTE&&(a=C.R8UI),i===C.UNSIGNED_SHORT&&(a=C.R16UI),i===C.UNSIGNED_INT&&(a=C.R32UI),i===C.BYTE&&(a=C.R8I),i===C.SHORT&&(a=C.R16I),i===C.INT&&(a=C.R32I)),e===C.RG&&(i===C.FLOAT&&(a=C.RG32F),i===C.HALF_FLOAT&&(a=C.RG16F),i===C.UNSIGNED_BYTE&&(a=C.RG8)),e===C.RG_INTEGER&&(i===C.UNSIGNED_BYTE&&(a=C.RG8UI),i===C.UNSIGNED_SHORT&&(a=C.RG16UI),i===C.UNSIGNED_INT&&(a=C.RG32UI),i===C.BYTE&&(a=C.RG8I),i===C.SHORT&&(a=C.RG16I),i===C.INT&&(a=C.RG32I)),e===C.RGB&&i===C.UNSIGNED_INT_5_9_9_9_REV&&(a=C.RGB9_E5),e===C.RGBA&&(s=r?ai:On.getTransfer(n),i===C.FLOAT&&(a=C.RGBA32F),i===C.HALF_FLOAT&&(a=C.RGBA16F),i===C.UNSIGNED_BYTE&&(a=s===si?C.SRGB8_ALPHA8:C.RGBA8),i===C.UNSIGNED_SHORT_4_4_4_4&&(a=C.RGBA4),i===C.UNSIGNED_SHORT_5_5_5_1&&(a=C.RGB5_A1)),a!==C.R16F&&a!==C.R32F&&a!==C.RG16F&&a!==C.RG32F&&a!==C.RGBA16F&&a!==C.RGBA32F||o.get("EXT_color_buffer_float"),a}function B(t,e){let i;return t?null===e||e===ue||e===fe?i=C.DEPTH24_STENCIL8:e===ct?i=C.DEPTH32F_STENCIL8:e===ce&&(i=C.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):null===e||e===ue||e===fe?i=C.DEPTH_COMPONENT24:e===ct?i=C.DEPTH_COMPONENT32F:e===ce&&(i=C.DEPTH_COMPONENT16),i}function F(t,e){return!0===N(t)||t.isFramebufferTexture&&t.minFilter!==at&&t.minFilter!==lt?Math.log2(Math.max(e.width,e.height))+1:void 0!==t.mipmaps&&0<t.mipmaps.length?t.mipmaps.length:t.isCompressedTexture&&Array.isArray(t.image)?e.mipmaps.length:1}function d(t){const e=t.target;e.removeEventListener("dispose",d),r(e),e.isVideoTexture&&i.delete(e)}function g(t){const e=t.target;e.removeEventListener("dispose",g),a(e)}function r(t){var e=P.get(t);if(void 0!==e.__webglInit){var i=t.source,n=l.get(i);if(n){const r=n[e.__cacheKey];r.usedTimes--,0===r.usedTimes&&p(t),0===Object.keys(n).length&&l.delete(i)}P.remove(t)}}function p(t){var e=P.get(t);C.deleteTexture(e.__webglTexture);var i=t.source;const n=l.get(i);delete n[e.__cacheKey],m.memory.textures--}function a(t){var i=P.get(t);if(t.depthTexture&&t.depthTexture.dispose(),t.isWebGLCubeRenderTarget)for(let e=0;e<6;e++){if(Array.isArray(i.__webglFramebuffer[e]))for(let t=0;t<i.__webglFramebuffer[e].length;t++)C.deleteFramebuffer(i.__webglFramebuffer[e][t]);else C.deleteFramebuffer(i.__webglFramebuffer[e]);i.__webglDepthbuffer&&C.deleteRenderbuffer(i.__webglDepthbuffer[e])}else{if(Array.isArray(i.__webglFramebuffer))for(let t=0;t<i.__webglFramebuffer.length;t++)C.deleteFramebuffer(i.__webglFramebuffer[t]);else C.deleteFramebuffer(i.__webglFramebuffer);if(i.__webglDepthbuffer&&C.deleteRenderbuffer(i.__webglDepthbuffer),i.__webglMultisampledFramebuffer&&C.deleteFramebuffer(i.__webglMultisampledFramebuffer),i.__webglColorRenderbuffer)for(let t=0;t<i.__webglColorRenderbuffer.length;t++)i.__webglColorRenderbuffer[t]&&C.deleteRenderbuffer(i.__webglColorRenderbuffer[t]);i.__webglDepthRenderbuffer&&C.deleteRenderbuffer(i.__webglDepthRenderbuffer)}var n=t.textures;for(let t=0,e=n.length;t<e;t++){var r=P.get(n[t]);r.__webglTexture&&(C.deleteTexture(r.__webglTexture),m.memory.textures--),P.remove(n[t])}P.remove(t)}let s=0;function t(){s=0}function v(){var t=s;return t>=I.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+t+" texture units while this GPU supports only "+I.maxTextures),s+=1,t}function _(t){const e=[];return e.push(t.wrapS),e.push(t.wrapT),e.push(t.wrapR||0),e.push(t.magFilter),e.push(t.minFilter),e.push(t.anisotropy),e.push(t.internalFormat),e.push(t.format),e.push(t.type),e.push(t.generateMipmaps),e.push(t.premultiplyAlpha),e.push(t.flipY),e.push(t.unpackAlignment),e.push(t.colorSpace),e.join()}function y(t,e){var i=P.get(t);if(t.isVideoTexture&&Q(t),!1===t.isRenderTargetTexture&&0<t.version&&i.__version!==t.version){var n=t.image;if(null===n)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==n.complete)return void E(i,t,e);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}R.bindTexture(C.TEXTURE_2D,i.__webglTexture,C.TEXTURE0+e)}function x(t,e){var i=P.get(t);0<t.version&&i.__version!==t.version?E(i,t,e):R.bindTexture(C.TEXTURE_2D_ARRAY,i.__webglTexture,C.TEXTURE0+e)}function M(t,e){var i=P.get(t);0<t.version&&i.__version!==t.version?E(i,t,e):R.bindTexture(C.TEXTURE_3D,i.__webglTexture,C.TEXTURE0+e)}function S(t,e){var i=P.get(t);0<t.version&&i.__version!==t.version?A(i,t,e):R.bindTexture(C.TEXTURE_CUBE_MAP,i.__webglTexture,C.TEXTURE0+e)}const b={[it]:C.REPEAT,[nt]:C.CLAMP_TO_EDGE,[rt]:C.MIRRORED_REPEAT},w={[at]:C.NEAREST,[st]:C.NEAREST_MIPMAP_NEAREST,[ot]:C.NEAREST_MIPMAP_LINEAR,[lt]:C.LINEAR,[ht]:C.LINEAR_MIPMAP_NEAREST,[le]:C.LINEAR_MIPMAP_LINEAR},T={[Ti]:C.NEVER,[Li]:C.ALWAYS,[Ei]:C.LESS,[Ci]:C.LEQUAL,[Ai]:C.EQUAL,[Ii]:C.GEQUAL,[Ri]:C.GREATER,[Pi]:C.NOTEQUAL};function z(t,e){var i;e.type!==ct||!1!==o.has("OES_texture_float_linear")||e.magFilter!==lt&&e.magFilter!==ht&&e.magFilter!==ot&&e.magFilter!==le&&e.minFilter!==lt&&e.minFilter!==ht&&e.minFilter!==ot&&e.minFilter!==le||console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),C.texParameteri(t,C.TEXTURE_WRAP_S,b[e.wrapS]),C.texParameteri(t,C.TEXTURE_WRAP_T,b[e.wrapT]),t!==C.TEXTURE_3D&&t!==C.TEXTURE_2D_ARRAY||C.texParameteri(t,C.TEXTURE_WRAP_R,b[e.wrapR]),C.texParameteri(t,C.TEXTURE_MAG_FILTER,w[e.magFilter]),C.texParameteri(t,C.TEXTURE_MIN_FILTER,w[e.minFilter]),e.compareFunction&&(C.texParameteri(t,C.TEXTURE_COMPARE_MODE,C.COMPARE_REF_TO_TEXTURE),C.texParameteri(t,C.TEXTURE_COMPARE_FUNC,T[e.compareFunction])),!0===o.has("EXT_texture_filter_anisotropic")&&e.magFilter!==at&&(e.minFilter!==ot&&e.minFilter!==le||e.type===ct&&!1===o.has("OES_texture_float_linear")||(1<e.anisotropy||P.get(e).__currentAnisotropy)&&(i=o.get("EXT_texture_filter_anisotropic"),C.texParameterf(t,i.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(e.anisotropy,I.getMaxAnisotropy())),P.get(e).__currentAnisotropy=e.anisotropy))}function k(t,e){let i=!1;void 0===t.__webglInit&&(t.__webglInit=!0,e.addEventListener("dispose",d));var n=e.source;let r=l.get(n);void 0===r&&(r={},l.set(n,r));var a=_(e),s;return a!==t.__cacheKey&&(void 0===r[a]&&(r[a]={texture:C.createTexture(),usedTimes:0},m.memory.textures++,i=!0),r[a].usedTimes++,void 0!==(s=r[t.__cacheKey])&&(r[t.__cacheKey].usedTimes--,0===s.usedTimes&&p(e)),t.__cacheKey=a,t.__webglTexture=r[a].texture),i}function E(t,a,e){let s=C.TEXTURE_2D;(a.isDataArrayTexture||a.isCompressedArrayTexture)&&(s=C.TEXTURE_2D_ARRAY),a.isData3DTexture&&(s=C.TEXTURE_3D);var o=k(t,a),l=a.source;R.bindTexture(s,t.__webglTexture,C.TEXTURE0+e);const h=P.get(l);if(l.version!==h.__version||!0===o){R.activeTexture(C.TEXTURE0+e);var c=On.getPrimaries(On.workingColorSpace),u=a.colorSpace===ti?null:On.getPrimaries(a.colorSpace),d=a.colorSpace===ti||c===u?C.NONE:C.BROWSER_DEFAULT_WEBGL;C.pixelStorei(C.UNPACK_FLIP_Y_WEBGL,a.flipY),C.pixelStorei(C.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a.premultiplyAlpha),C.pixelStorei(C.UNPACK_ALIGNMENT,a.unpackAlignment),C.pixelStorei(C.UNPACK_COLORSPACE_CONVERSION_WEBGL,d);let n=U(a.image,!1,I.maxTextureSize);n=tt(a,n);var p=L.convert(a.format,a.colorSpace),m=L.convert(a.type);let r=O(a.internalFormat,p,m,a.colorSpace,a.isVideoTexture);z(s,a);let i;var f=a.mipmaps,g=!0!==a.isVideoTexture,v=void 0===h.__version||!0===o,_=l.dataReady,y=F(a,n),x,M;if(a.isDepthTexture)r=B(a.format===pt,a.type),v&&(g?R.texStorage2D(C.TEXTURE_2D,1,r,n.width,n.height):R.texImage2D(C.TEXTURE_2D,0,r,n.width,n.height,0,p,m,null));else if(a.isDataTexture)if(0<f.length){g&&v&&R.texStorage2D(C.TEXTURE_2D,y,r,f[0].width,f[0].height);for(let t=0,e=f.length;t<e;t++)i=f[t],g?_&&R.texSubImage2D(C.TEXTURE_2D,t,0,0,i.width,i.height,p,m,i.data):R.texImage2D(C.TEXTURE_2D,t,r,i.width,i.height,0,p,m,i.data);a.generateMipmaps=!1}else g?(v&&R.texStorage2D(C.TEXTURE_2D,y,r,n.width,n.height),_&&R.texSubImage2D(C.TEXTURE_2D,0,0,0,n.width,n.height,p,m,n.data)):R.texImage2D(C.TEXTURE_2D,0,r,n.width,n.height,0,p,m,n.data);else if(a.isCompressedTexture)if(a.isCompressedArrayTexture){g&&v&&R.texStorage3D(C.TEXTURE_2D_ARRAY,y,r,f[0].width,f[0].height,n.depth);for(let t=0,e=f.length;t<e;t++)if(i=f[t],a.format!==ut)if(null!==p)if(g){if(_)if(0<a.layerUpdates.size){var S=yd(i.width,i.height,a.format,a.type);for(const E of a.layerUpdates){var b=i.data.subarray(E*S/i.data.BYTES_PER_ELEMENT,(E+1)*S/i.data.BYTES_PER_ELEMENT);R.compressedTexSubImage3D(C.TEXTURE_2D_ARRAY,t,0,0,E,i.width,i.height,1,p,b,0,0)}a.clearLayerUpdates()}else R.compressedTexSubImage3D(C.TEXTURE_2D_ARRAY,t,0,0,0,i.width,i.height,n.depth,p,i.data,0,0)}else R.compressedTexImage3D(C.TEXTURE_2D_ARRAY,t,r,i.width,i.height,n.depth,0,i.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else g?_&&R.texSubImage3D(C.TEXTURE_2D_ARRAY,t,0,0,0,i.width,i.height,n.depth,p,m,i.data):R.texImage3D(C.TEXTURE_2D_ARRAY,t,r,i.width,i.height,n.depth,0,p,m,i.data)}else{g&&v&&R.texStorage2D(C.TEXTURE_2D,y,r,f[0].width,f[0].height);for(let t=0,e=f.length;t<e;t++)i=f[t],a.format!==ut?null!==p?g?_&&R.compressedTexSubImage2D(C.TEXTURE_2D,t,0,0,i.width,i.height,p,i.data):R.compressedTexImage2D(C.TEXTURE_2D,t,r,i.width,i.height,0,i.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):g?_&&R.texSubImage2D(C.TEXTURE_2D,t,0,0,i.width,i.height,p,m,i.data):R.texImage2D(C.TEXTURE_2D,t,r,i.width,i.height,0,p,m,i.data)}else if(a.isDataArrayTexture)if(g){if(v&&R.texStorage3D(C.TEXTURE_2D_ARRAY,y,r,n.width,n.height,n.depth),_)if(0<a.layerUpdates.size){var w=yd(n.width,n.height,a.format,a.type);for(const A of a.layerUpdates){var T=n.data.subarray(A*w/n.data.BYTES_PER_ELEMENT,(A+1)*w/n.data.BYTES_PER_ELEMENT);R.texSubImage3D(C.TEXTURE_2D_ARRAY,0,0,0,A,n.width,n.height,1,p,m,T)}a.clearLayerUpdates()}else R.texSubImage3D(C.TEXTURE_2D_ARRAY,0,0,0,0,n.width,n.height,n.depth,p,m,n.data)}else R.texImage3D(C.TEXTURE_2D_ARRAY,0,r,n.width,n.height,n.depth,0,p,m,n.data);else if(a.isData3DTexture)g?(v&&R.texStorage3D(C.TEXTURE_3D,y,r,n.width,n.height,n.depth),_&&R.texSubImage3D(C.TEXTURE_3D,0,0,0,0,n.width,n.height,n.depth,p,m,n.data)):R.texImage3D(C.TEXTURE_3D,0,r,n.width,n.height,n.depth,0,p,m,n.data);else if(a.isFramebufferTexture){if(v)if(g)R.texStorage2D(C.TEXTURE_2D,y,r,n.width,n.height);else{let e=n.width,i=n.height;for(let t=0;t<y;t++)R.texImage2D(C.TEXTURE_2D,t,r,e,i,0,p,m,null),e>>=1,i>>=1}}else if(0<f.length){g&&v&&(x=et(f[0]),R.texStorage2D(C.TEXTURE_2D,y,r,x.width,x.height));for(let t=0,e=f.length;t<e;t++)i=f[t],g?_&&R.texSubImage2D(C.TEXTURE_2D,t,0,0,p,m,i):R.texImage2D(C.TEXTURE_2D,t,r,p,m,i);a.generateMipmaps=!1}else{g?(v&&(M=et(n),R.texStorage2D(C.TEXTURE_2D,y,r,M.width,M.height)),_&&R.texSubImage2D(C.TEXTURE_2D,0,0,0,p,m,n)):R.texImage2D(C.TEXTURE_2D,0,r,p,m,n)}N(a)&&D(s),h.__version=l.version,a.onUpdate&&a.onUpdate(a)}t.__version=a.version}function A(t,n,e){if(6===n.image.length){var r=k(t,n),a=n.source;R.bindTexture(C.TEXTURE_CUBE_MAP,t.__webglTexture,C.TEXTURE0+e);const b=P.get(a);if(a.version!==b.__version||!0===r){R.activeTexture(C.TEXTURE0+e);var s=On.getPrimaries(On.workingColorSpace),o=n.colorSpace===ti?null:On.getPrimaries(n.colorSpace),l=n.colorSpace===ti||s===o?C.NONE:C.BROWSER_DEFAULT_WEBGL;C.pixelStorei(C.UNPACK_FLIP_Y_WEBGL,n.flipY),C.pixelStorei(C.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.premultiplyAlpha),C.pixelStorei(C.UNPACK_ALIGNMENT,n.unpackAlignment),C.pixelStorei(C.UNPACK_COLORSPACE_CONVERSION_WEBGL,l);var h=n.isCompressedTexture||n.image[0].isCompressedTexture,c=n.image[0]&&n.image[0].isDataTexture;const w=[];for(let t=0;t<6;t++)w[t]=h||c?c?n.image[t].image:n.image[t]:U(n.image[t],!0,I.maxCubemapSize),w[t]=tt(n,w[t]);var u=w[0],d=L.convert(n.format,n.colorSpace),p=L.convert(n.type),m=O(n.internalFormat,d,p,n.colorSpace),f=!0!==n.isVideoTexture,g=void 0===b.__version||!0===r,v=a.dataReady,_;let t=F(n,u);z(C.TEXTURE_CUBE_MAP,n);let i;if(h){f&&g&&R.texStorage2D(C.TEXTURE_CUBE_MAP,t,m,u.width,u.height);for(let e=0;e<6;e++){i=w[e].mipmaps;for(let t=0;t<i.length;t++){var y=i[t];n.format!==ut?null!==d?f?v&&R.compressedTexSubImage2D(C.TEXTURE_CUBE_MAP_POSITIVE_X+e,t,0,0,y.width,y.height,d,y.data):R.compressedTexImage2D(C.TEXTURE_CUBE_MAP_POSITIVE_X+e,t,m,y.width,y.height,0,y.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):f?v&&R.texSubImage2D(C.TEXTURE_CUBE_MAP_POSITIVE_X+e,t,0,0,y.width,y.height,d,p,y.data):R.texImage2D(C.TEXTURE_CUBE_MAP_POSITIVE_X+e,t,m,y.width,y.height,0,d,p,y.data)}}}else{i=n.mipmaps,f&&g&&(0<i.length&&t++,_=et(w[0]),R.texStorage2D(C.TEXTURE_CUBE_MAP,t,m,_.width,_.height));for(let e=0;e<6;e++)if(c){f?v&&R.texSubImage2D(C.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,0,0,w[e].width,w[e].height,d,p,w[e].data):R.texImage2D(C.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,m,w[e].width,w[e].height,0,d,p,w[e].data);for(let t=0;t<i.length;t++){var x,M=i[t].image[e].image;f?v&&R.texSubImage2D(C.TEXTURE_CUBE_MAP_POSITIVE_X+e,t+1,0,0,M.width,M.height,d,p,M.data):R.texImage2D(C.TEXTURE_CUBE_MAP_POSITIVE_X+e,t+1,m,M.width,M.height,0,d,p,M.data)}}else{f?v&&R.texSubImage2D(C.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,0,0,d,p,w[e]):R.texImage2D(C.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,m,d,p,w[e]);for(let t=0;t<i.length;t++){var S=i[t];f?v&&R.texSubImage2D(C.TEXTURE_CUBE_MAP_POSITIVE_X+e,t+1,0,0,d,p,S.image[e]):R.texImage2D(C.TEXTURE_CUBE_MAP_POSITIVE_X+e,t+1,m,d,p,S.image[e])}}}N(n)&&D(C.TEXTURE_CUBE_MAP),b.__version=a.version,n.onUpdate&&n.onUpdate(n)}t.__version=n.version}}function V(t,e,i,n,r,a){var s=L.convert(i.format,i.colorSpace),o=L.convert(i.type),l=O(i.internalFormat,s,o,i.colorSpace),h,c,u;P.get(e).__hasExternalTextures||(c=Math.max(1,e.width>>a),u=Math.max(1,e.height>>a),r===C.TEXTURE_3D||r===C.TEXTURE_2D_ARRAY?R.texImage3D(r,a,l,c,u,e.depth,0,s,o,null):R.texImage2D(r,a,l,c,u,0,s,o,null)),R.bindFramebuffer(C.FRAMEBUFFER,t),$(e)?f.framebufferTexture2DMultisampleEXT(C.FRAMEBUFFER,n,r,P.get(i).__webglTexture,0,K(e)):(r===C.TEXTURE_2D||r>=C.TEXTURE_CUBE_MAP_POSITIVE_X&&r<=C.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&C.framebufferTexture2D(C.FRAMEBUFFER,n,r,P.get(i).__webglTexture,a),R.bindFramebuffer(C.FRAMEBUFFER,null)}function G(t,e,i){if(C.bindRenderbuffer(C.RENDERBUFFER,t),e.depthBuffer){var n=e.depthTexture,r=n&&n.isDepthTexture?n.type:null,a=B(e.stencilBuffer,r),s=e.stencilBuffer?C.DEPTH_STENCIL_ATTACHMENT:C.DEPTH_ATTACHMENT,o=K(e),l;$(e)?f.renderbufferStorageMultisampleEXT(C.RENDERBUFFER,o,a,e.width,e.height):i?C.renderbufferStorageMultisample(C.RENDERBUFFER,o,a,e.width,e.height):C.renderbufferStorage(C.RENDERBUFFER,a,e.width,e.height),C.framebufferRenderbuffer(C.FRAMEBUFFER,s,C.RENDERBUFFER,t)}else{var h=e.textures;for(let t=0;t<h.length;t++){var c=h[t],u=L.convert(c.format,c.colorSpace),d=L.convert(c.type),p=O(c.internalFormat,u,d,c.colorSpace),m=K(e);i&&!1===$(e)?C.renderbufferStorageMultisample(C.RENDERBUFFER,m,p,e.width,e.height):$(e)?f.renderbufferStorageMultisampleEXT(C.RENDERBUFFER,m,p,e.width,e.height):C.renderbufferStorage(C.RENDERBUFFER,p,e.width,e.height)}}C.bindRenderbuffer(C.RENDERBUFFER,null)}function H(t,e){var i;if(e&&e.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(R.bindFramebuffer(C.FRAMEBUFFER,t),!e.depthTexture||!e.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");P.get(e.depthTexture).__webglTexture&&e.depthTexture.image.width===e.width&&e.depthTexture.image.height===e.height||(e.depthTexture.image.width=e.width,e.depthTexture.image.height=e.height,e.depthTexture.needsUpdate=!0),y(e.depthTexture,0);var n=P.get(e.depthTexture).__webglTexture,r=K(e);if(e.depthTexture.format===dt)$(e)?f.framebufferTexture2DMultisampleEXT(C.FRAMEBUFFER,C.DEPTH_ATTACHMENT,C.TEXTURE_2D,n,0,r):C.framebufferTexture2D(C.FRAMEBUFFER,C.DEPTH_ATTACHMENT,C.TEXTURE_2D,n,0);else{if(e.depthTexture.format!==pt)throw new Error("Unknown depthTexture format");$(e)?f.framebufferTexture2DMultisampleEXT(C.FRAMEBUFFER,C.DEPTH_STENCIL_ATTACHMENT,C.TEXTURE_2D,n,0,r):C.framebufferTexture2D(C.FRAMEBUFFER,C.DEPTH_STENCIL_ATTACHMENT,C.TEXTURE_2D,n,0)}}function W(e){const i=P.get(e);var t=!0===e.isWebGLCubeRenderTarget;if(e.depthTexture&&!i.__autoAllocateDepthBuffer){if(t)throw new Error("target.depthTexture not supported in Cube render targets");H(i.__webglFramebuffer,e)}else if(t){i.__webglDepthbuffer=[];for(let t=0;t<6;t++)R.bindFramebuffer(C.FRAMEBUFFER,i.__webglFramebuffer[t]),i.__webglDepthbuffer[t]=C.createRenderbuffer(),G(i.__webglDepthbuffer[t],e,!1)}else R.bindFramebuffer(C.FRAMEBUFFER,i.__webglFramebuffer),i.__webglDepthbuffer=C.createRenderbuffer(),G(i.__webglDepthbuffer,e,!1);R.bindFramebuffer(C.FRAMEBUFFER,null)}function X(t,e,i){var n=P.get(t);void 0!==e&&V(n.__webglFramebuffer,t,t.texture,C.COLOR_ATTACHMENT0,C.TEXTURE_2D,0),void 0!==i&&W(t)}function j(i){const n=i.texture,r=P.get(i),t=P.get(n);i.addEventListener("dispose",g);var a=i.textures,e=!0===i.isWebGLCubeRenderTarget,s=1<a.length;if(s||(void 0===t.__webglTexture&&(t.__webglTexture=C.createTexture()),t.__version=n.version,m.memory.textures++),e){r.__webglFramebuffer=[];for(let e=0;e<6;e++)if(n.mipmaps&&0<n.mipmaps.length){r.__webglFramebuffer[e]=[];for(let t=0;t<n.mipmaps.length;t++)r.__webglFramebuffer[e][t]=C.createFramebuffer()}else r.__webglFramebuffer[e]=C.createFramebuffer()}else{if(n.mipmaps&&0<n.mipmaps.length){r.__webglFramebuffer=[];for(let t=0;t<n.mipmaps.length;t++)r.__webglFramebuffer[t]=C.createFramebuffer()}else r.__webglFramebuffer=C.createFramebuffer();if(s)for(let t=0,e=a.length;t<e;t++){const p=P.get(a[t]);void 0===p.__webglTexture&&(p.__webglTexture=C.createTexture(),m.memory.textures++)}if(0<i.samples&&!1===$(i)){r.__webglMultisampledFramebuffer=C.createFramebuffer(),r.__webglColorRenderbuffer=[],R.bindFramebuffer(C.FRAMEBUFFER,r.__webglMultisampledFramebuffer);for(let t=0;t<a.length;t++){const n=a[t];r.__webglColorRenderbuffer[t]=C.createRenderbuffer(),C.bindRenderbuffer(C.RENDERBUFFER,r.__webglColorRenderbuffer[t]);var o=L.convert(n.format,n.colorSpace),l=L.convert(n.type),h=O(n.internalFormat,o,l,n.colorSpace,!0===i.isXRRenderTarget),c=K(i);C.renderbufferStorageMultisample(C.RENDERBUFFER,c,h,i.width,i.height),C.framebufferRenderbuffer(C.FRAMEBUFFER,C.COLOR_ATTACHMENT0+t,C.RENDERBUFFER,r.__webglColorRenderbuffer[t])}C.bindRenderbuffer(C.RENDERBUFFER,null),i.depthBuffer&&(r.__webglDepthRenderbuffer=C.createRenderbuffer(),G(r.__webglDepthRenderbuffer,i,!0)),R.bindFramebuffer(C.FRAMEBUFFER,null)}}if(e){R.bindTexture(C.TEXTURE_CUBE_MAP,t.__webglTexture),z(C.TEXTURE_CUBE_MAP,n);for(let e=0;e<6;e++)if(n.mipmaps&&0<n.mipmaps.length)for(let t=0;t<n.mipmaps.length;t++)V(r.__webglFramebuffer[e][t],i,n,C.COLOR_ATTACHMENT0,C.TEXTURE_CUBE_MAP_POSITIVE_X+e,t);else V(r.__webglFramebuffer[e],i,n,C.COLOR_ATTACHMENT0,C.TEXTURE_CUBE_MAP_POSITIVE_X+e,0);N(n)&&D(C.TEXTURE_CUBE_MAP),R.unbindTexture()}else if(s){for(let t=0,e=a.length;t<e;t++){var u=a[t],d=P.get(u);R.bindTexture(C.TEXTURE_2D,d.__webglTexture),z(C.TEXTURE_2D,u),V(r.__webglFramebuffer,i,u,C.COLOR_ATTACHMENT0+t,C.TEXTURE_2D,0),N(u)&&D(C.TEXTURE_2D)}R.unbindTexture()}else{let e=C.TEXTURE_2D;if((i.isWebGL3DRenderTarget||i.isWebGLArrayRenderTarget)&&(e=i.isWebGL3DRenderTarget?C.TEXTURE_3D:C.TEXTURE_2D_ARRAY),R.bindTexture(e,t.__webglTexture),z(e,n),n.mipmaps&&0<n.mipmaps.length)for(let t=0;t<n.mipmaps.length;t++)V(r.__webglFramebuffer[t],i,n,C.COLOR_ATTACHMENT0,e,t);else V(r.__webglFramebuffer,i,n,C.COLOR_ATTACHMENT0,e,0);N(n)&&D(e),R.unbindTexture()}i.depthBuffer&&W(i)}function q(i){var n=i.textures;for(let t=0,e=n.length;t<e;t++){var r=n[t],a,s;N(r)&&(a=i.isWebGLCubeRenderTarget?C.TEXTURE_CUBE_MAP:C.TEXTURE_2D,s=P.get(r).__webglTexture,R.bindTexture(a,s),D(a),R.unbindTexture())}}const Y=[],Z=[];function J(i){if(0<i.samples)if(!1===$(i)){var n=i.textures,r=i.width,a=i.height;let e=C.COLOR_BUFFER_BIT;var s=i.stencilBuffer?C.DEPTH_STENCIL_ATTACHMENT:C.DEPTH_ATTACHMENT,o=P.get(i),l=1<n.length,h;if(l)for(let t=0;t<n.length;t++)R.bindFramebuffer(C.FRAMEBUFFER,o.__webglMultisampledFramebuffer),C.framebufferRenderbuffer(C.FRAMEBUFFER,C.COLOR_ATTACHMENT0+t,C.RENDERBUFFER,null),R.bindFramebuffer(C.FRAMEBUFFER,o.__webglFramebuffer),C.framebufferTexture2D(C.DRAW_FRAMEBUFFER,C.COLOR_ATTACHMENT0+t,C.TEXTURE_2D,null,0);R.bindFramebuffer(C.READ_FRAMEBUFFER,o.__webglMultisampledFramebuffer),R.bindFramebuffer(C.DRAW_FRAMEBUFFER,o.__webglFramebuffer);for(let t=0;t<n.length;t++){i.resolveDepthBuffer&&(i.depthBuffer&&(e|=C.DEPTH_BUFFER_BIT),i.stencilBuffer&&i.resolveStencilBuffer&&(e|=C.STENCIL_BUFFER_BIT)),l&&(C.framebufferRenderbuffer(C.READ_FRAMEBUFFER,C.COLOR_ATTACHMENT0,C.RENDERBUFFER,o.__webglColorRenderbuffer[t]),h=P.get(n[t]).__webglTexture,C.framebufferTexture2D(C.DRAW_FRAMEBUFFER,C.COLOR_ATTACHMENT0,C.TEXTURE_2D,h,0)),C.blitFramebuffer(0,0,r,a,0,0,r,a,e,C.NEAREST),!0===u&&(Y.length=0,Z.length=0,Y.push(C.COLOR_ATTACHMENT0+t),i.depthBuffer&&!1===i.resolveDepthBuffer&&(Y.push(s),Z.push(s),C.invalidateFramebuffer(C.DRAW_FRAMEBUFFER,Z)),C.invalidateFramebuffer(C.READ_FRAMEBUFFER,Y))}if(R.bindFramebuffer(C.READ_FRAMEBUFFER,null),R.bindFramebuffer(C.DRAW_FRAMEBUFFER,null),l)for(let t=0;t<n.length;t++){R.bindFramebuffer(C.FRAMEBUFFER,o.__webglMultisampledFramebuffer),C.framebufferRenderbuffer(C.FRAMEBUFFER,C.COLOR_ATTACHMENT0+t,C.RENDERBUFFER,o.__webglColorRenderbuffer[t]);var c=P.get(n[t]).__webglTexture;R.bindFramebuffer(C.FRAMEBUFFER,o.__webglFramebuffer),C.framebufferTexture2D(C.DRAW_FRAMEBUFFER,C.COLOR_ATTACHMENT0+t,C.TEXTURE_2D,c,0)}R.bindFramebuffer(C.DRAW_FRAMEBUFFER,o.__webglMultisampledFramebuffer)}else{var t;i.depthBuffer&&!1===i.resolveDepthBuffer&&u&&(t=i.stencilBuffer?C.DEPTH_STENCIL_ATTACHMENT:C.DEPTH_ATTACHMENT,C.invalidateFramebuffer(C.DRAW_FRAMEBUFFER,[t]))}}function K(t){return Math.min(I.maxSamples,t.samples)}function $(t){var e=P.get(t);return 0<t.samples&&!0===o.has("WEBGL_multisampled_render_to_texture")&&!1!==e.__useRenderToTexture}function Q(t){var e=m.render.frame;i.get(t)!==e&&(i.set(t,e),t.update())}function tt(t,e){var i=t.colorSpace,n=t.format,r=t.type;return!0===t.isCompressedTexture||!0===t.isVideoTexture||i!==ii&&i!==ti&&(On.getTransfer(i)===si?n===ut&&r===he||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",i)),e}function et(t){return"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement?(e.width=t.naturalWidth||t.width,e.height=t.naturalHeight||t.height):"undefined"!=typeof VideoFrame&&t instanceof VideoFrame?(e.width=t.displayWidth,e.height=t.displayHeight):(e.width=t.width,e.height=t.height),e}this.allocateTextureUnit=v,this.resetTextureUnits=t,this.setTexture2D=y,this.setTexture2DArray=x,this.setTexture3D=M,this.setTextureCube=S,this.rebindTextures=X,this.setupRenderTarget=j,this.updateRenderTargetMipmap=q,this.updateMultisampleRenderTarget=J,this.setupDepthRenderbuffer=W,this.setupFrameBufferTexture=V,this.useMultisampledRTT=$}function bd(r,a){function t(t,e=ti){let i;var n=On.getTransfer(e);if(t===he)return r.UNSIGNED_BYTE;if(t===pe)return r.UNSIGNED_SHORT_4_4_4_4;if(t===me)return r.UNSIGNED_SHORT_5_5_5_1;if(t===O)return r.UNSIGNED_INT_5_9_9_9_REV;if(t===U)return r.BYTE;if(t===N)return r.SHORT;if(t===ce)return r.UNSIGNED_SHORT;if(t===D)return r.INT;if(t===ue)return r.UNSIGNED_INT;if(t===ct)return r.FLOAT;if(t===de)return r.HALF_FLOAT;if(t===B)return r.ALPHA;if(t===F)return r.RGB;if(t===ut)return r.RGBA;if(t===z)return r.LUMINANCE;if(t===k)return r.LUMINANCE_ALPHA;if(t===dt)return r.DEPTH_COMPONENT;if(t===pt)return r.DEPTH_STENCIL;if(t===V)return r.RED;if(t===ge)return r.RED_INTEGER;if(t===G)return r.RG;if(t===ve)return r.RG_INTEGER;if(t===_e)return r.RGBA_INTEGER;if(t===W||t===X||t===j||t===q)if(n===si){if(i=a.get("WEBGL_compressed_texture_s3tc_srgb"),null===i)return null;if(t===W)return i.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(t===X)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(t===j)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(t===q)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(i=a.get("WEBGL_compressed_texture_s3tc"),null===i)return null;if(t===W)return i.COMPRESSED_RGB_S3TC_DXT1_EXT;if(t===X)return i.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(t===j)return i.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(t===q)return i.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(t===Y||t===Z||t===J||t===K){if(i=a.get("WEBGL_compressed_texture_pvrtc"),null===i)return null;if(t===Y)return i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(t===Z)return i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(t===J)return i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(t===K)return i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(t===$||t===Q||t===tt){if(i=a.get("WEBGL_compressed_texture_etc"),null===i)return null;if(t===$||t===Q)return n===si?i.COMPRESSED_SRGB8_ETC2:i.COMPRESSED_RGB8_ETC2;if(t===tt)return n===si?i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:i.COMPRESSED_RGBA8_ETC2_EAC}if(t===et||t===mt||t===ft||t===gt||t===vt||t===yt||t===ye||t===xe||t===Me||t===Se||t===be||t===we||t===Te||t===Ee){if(i=a.get("WEBGL_compressed_texture_astc"),null===i)return null;if(t===et)return n===si?i.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:i.COMPRESSED_RGBA_ASTC_4x4_KHR;if(t===mt)return n===si?i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:i.COMPRESSED_RGBA_ASTC_5x4_KHR;if(t===ft)return n===si?i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:i.COMPRESSED_RGBA_ASTC_5x5_KHR;if(t===gt)return n===si?i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:i.COMPRESSED_RGBA_ASTC_6x5_KHR;if(t===vt)return n===si?i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:i.COMPRESSED_RGBA_ASTC_6x6_KHR;if(t===yt)return n===si?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:i.COMPRESSED_RGBA_ASTC_8x5_KHR;if(t===ye)return n===si?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:i.COMPRESSED_RGBA_ASTC_8x6_KHR;if(t===xe)return n===si?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:i.COMPRESSED_RGBA_ASTC_8x8_KHR;if(t===Me)return n===si?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:i.COMPRESSED_RGBA_ASTC_10x5_KHR;if(t===Se)return n===si?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:i.COMPRESSED_RGBA_ASTC_10x6_KHR;if(t===be)return n===si?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:i.COMPRESSED_RGBA_ASTC_10x8_KHR;if(t===we)return n===si?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:i.COMPRESSED_RGBA_ASTC_10x10_KHR;if(t===Te)return n===si?i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:i.COMPRESSED_RGBA_ASTC_12x10_KHR;if(t===Ee)return n===si?i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:i.COMPRESSED_RGBA_ASTC_12x12_KHR}if(t===Ae||t===Ce||t===Re){if(i=a.get("EXT_texture_compression_bptc"),null===i)return null;if(t===Ae)return n===si?i.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:i.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(t===Ce)return i.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(t===Re)return i.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}if(t===Pe||t===Ie||t===Le||t===Ue){if(i=a.get("EXT_texture_compression_rgtc"),null===i)return null;if(t===Ae)return i.COMPRESSED_RED_RGTC1_EXT;if(t===Ie)return i.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(t===Le)return i.COMPRESSED_RED_GREEN_RGTC2_EXT;if(t===Ue)return i.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return t===fe?r.UNSIGNED_INT_24_8:void 0!==r[t]?r[t]:null}return{convert:t}}class wd extends lh{constructor(t=[]){super(),this.isArrayCamera=!0,this.cameras=t}}class Td extends na{constructor(){super(),this.isGroup=!0,this.type="Group"}}const Ed={type:"move"};class Ad{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new Td,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new Td,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new tr,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new tr),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new Td,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new tr,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new tr),this._grip}dispatchEvent(t){return null!==this._targetRay&&this._targetRay.dispatchEvent(t),null!==this._grip&&this._grip.dispatchEvent(t),null!==this._hand&&this._hand.dispatchEvent(t),this}connect(t){if(t&&t.hand){var e=this._hand;if(e)for(const i of t.hand.values())this._getHandJoint(e,i)}return this.dispatchEvent({type:"connected",data:t}),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(t,e,i){let n=null,r=null,a=null;const s=this._targetRay,o=this._grip,l=this._hand;if(t&&"visible-blurred"!==e.session.visibilityState){if(l&&t.hand){a=!0;for(const f of t.hand.values()){var h=e.getJointPose(f,i);const g=this._getHandJoint(l,f);null!==h&&(g.matrix.fromArray(h.transform.matrix),g.matrix.decompose(g.position,g.rotation,g.scale),g.matrixWorldNeedsUpdate=!0,g.jointRadius=h.radius),g.visible=null!==h}const m=l.joints["index-finger-tip"];var c=l.joints["thumb-tip"],u=m.position.distanceTo(c.position),d=.02,p=.005;l.inputState.pinching&&.025<u?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!l.inputState.pinching&&u<=.015&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else null!==o&&t.gripSpace&&(r=e.getPose(t.gripSpace,i),null!==r&&(o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,r.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(r.linearVelocity)):o.hasLinearVelocity=!1,r.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(r.angularVelocity)):o.hasAngularVelocity=!1));null!==s&&(n=e.getPose(t.targetRaySpace,i),null===n&&null!==r&&(n=r),null!==n&&(s.matrix.fromArray(n.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),s.matrixWorldNeedsUpdate=!0,n.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(n.linearVelocity)):s.hasLinearVelocity=!1,n.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(n.angularVelocity)):s.hasAngularVelocity=!1,this.dispatchEvent(Ed)))}return null!==s&&(s.visible=null!==n),null!==o&&(o.visible=null!==r),null!==l&&(l.visible=null!==a),this}_getHandJoint(t,e){if(void 0===t.joints[e.jointName]){const i=new Td;i.matrixAutoUpdate=!1,i.visible=!1,t.joints[e.jointName]=i,t.add(i)}return t.joints[e.jointName]}}const Cd=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,Rd=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class Pd{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(t,e,i){if(null===this.texture){var n=new Xn;const r=t.properties.get(n);r.__webglTexture=e.texture,e.depthNear==i.depthNear&&e.depthFar==i.depthFar||(this.depthNear=e.depthNear,this.depthFar=e.depthFar),this.texture=n}}getMesh(t){var e,i;return null!==this.texture&&null===this.mesh&&(e=t.cameras[0].viewport,i=new nh({vertexShader:Cd,fragmentShader:Rd,uniforms:{depthColor:{value:this.texture},depthWidth:{value:e.z},depthHeight:{value:e.w}}}),this.mesh=new ds(new bh(20,20),i)),this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class Id extends ji{constructor(h,r){super();const c=this;let u=null,a=1,d=null,i="local-floor",s=1,p=null,m=null,f=null,g=null,v=null,_=null;const y=new Pd,o=r.getContextAttributes();let l=null,x=null;const M=[],S=[],b=new Mn;let w=null;const n=new lh;n.layers.enable(1),n.viewport=new jn;const T=new lh;T.layers.enable(2),T.viewport=new jn;const E=[n,T],A=new wd;A.layers.enable(1),A.layers.enable(2);let C=null,R=null;function P(t){var e=S.indexOf(t.inputSource);if(-1!==e){const i=M[e];void 0!==i&&(i.update(t.inputSource,t.frame,p||d),i.dispatchEvent({type:t.type,data:t.inputSource}))}}function I(){u.removeEventListener("select",P),u.removeEventListener("selectstart",P),u.removeEventListener("selectend",P),u.removeEventListener("squeeze",P),u.removeEventListener("squeezestart",P),u.removeEventListener("squeezeend",P),u.removeEventListener("end",I),u.removeEventListener("inputsourceschange",L);for(let t=0;t<M.length;t++){var e=S[t];null!==e&&(S[t]=null,M[t].disconnect(e))}C=null,R=null,y.reset(),h.setRenderTarget(l),v=null,g=null,f=null,u=null,x=null,z.stop(),c.isPresenting=!1,h.setPixelRatio(w),h.setSize(b.width,b.height,!1),c.dispatchEvent({type:"sessionend"})}function L(i){for(let t=0;t<i.removed.length;t++){var e=i.removed[t],n=S.indexOf(e);0<=n&&(S[n]=null,M[n].disconnect(e))}for(let t=0;t<i.added.length;t++){var r=i.added[t];let e=S.indexOf(r);if(-1===e){for(let t=0;t<M.length;t++){if(t>=S.length){S.push(r),e=t;break}if(null===S[t]){S[t]=r,e=t;break}}if(-1===e)break}const a=M[e];a&&a.connect(r)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(t){let e=M[t];return void 0===e&&(e=new Ad,M[t]=e),e.getTargetRaySpace()},this.getControllerGrip=function(t){let e=M[t];return void 0===e&&(e=new Ad,M[t]=e),e.getGripSpace()},this.getHand=function(t){let e=M[t];return void 0===e&&(e=new Ad,M[t]=e),e.getHandSpace()},this.setFramebufferScaleFactor=function(t){a=t,!0===c.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(t){i=t,!0===c.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return p||d},this.setReferenceSpace=function(t){p=t},this.getBaseLayer=function(){return null!==g?g:v},this.getBinding=function(){return f},this.getFrame=function(){return _},this.getSession=function(){return u},this.setSession=async function(t){if(u=t,null!==u){if(l=h.getRenderTarget(),u.addEventListener("select",P),u.addEventListener("selectstart",P),u.addEventListener("selectend",P),u.addEventListener("squeeze",P),u.addEventListener("squeezestart",P),u.addEventListener("squeezeend",P),u.addEventListener("end",I),u.addEventListener("inputsourceschange",L),!0!==o.xrCompatible&&await r.makeXRCompatible(),w=h.getPixelRatio(),h.getSize(b),void 0===u.renderState.layers){var e={antialias:o.antialias,alpha:!0,depth:o.depth,stencil:o.stencil,framebufferScaleFactor:a};v=new XRWebGLLayer(u,r,e),u.updateRenderState({baseLayer:v}),h.setPixelRatio(1),h.setSize(v.framebufferWidth,v.framebufferHeight,!1),x=new Yn(v.framebufferWidth,v.framebufferHeight,{format:ut,type:he,colorSpace:h.outputColorSpace,stencilBuffer:o.stencil})}else{let t=null,e=null,i=null;o.depth&&(i=o.stencil?r.DEPTH24_STENCIL8:r.DEPTH_COMPONENT24,t=o.stencil?pt:dt,e=o.stencil?fe:ue);var n={colorFormat:r.RGBA8,depthFormat:i,scaleFactor:a};f=new XRWebGLBinding(u,r),g=f.createProjectionLayer(n),u.updateRenderState({layers:[g]}),h.setPixelRatio(1),h.setSize(g.textureWidth,g.textureHeight,!1),x=new Yn(g.textureWidth,g.textureHeight,{format:ut,type:he,depthTexture:new cc(g.textureWidth,g.textureHeight,e,void 0,void 0,void 0,void 0,void 0,void 0,t),stencilBuffer:o.stencil,colorSpace:h.outputColorSpace,samples:o.antialias?4:0,resolveDepthBuffer:!1===g.ignoreDepthValues})}x.isXRRenderTarget=!0,this.setFoveation(s),p=null,d=await u.requestReferenceSpace(i),z.setContext(u),z.start(),c.isPresenting=!0,c.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(null!==u)return u.environmentBlendMode},this.getDepthTexture=function(){return y.getDepthTexture()};const U=new tr,N=new tr;function D(t,e,i){U.setFromMatrixPosition(e.matrixWorld),N.setFromMatrixPosition(i.matrixWorld);var n=U.distanceTo(N),r=e.projectionMatrix.elements,a=i.projectionMatrix.elements,s=r[14]/(r[10]-1),o=r[14]/(r[10]+1),l=(r[9]+1)/r[5],h=(r[9]-1)/r[5],c=(r[8]-1)/r[0],u=(a[8]+1)/a[0],d=s*c,p=s*u,m=n/(u-c),f=m*-c;e.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.translateX(f),t.translateZ(m),t.matrixWorld.compose(t.position,t.quaternion,t.scale),t.matrixWorldInverse.copy(t.matrixWorld).invert();var g=s+m,v=o+m,_,y,x,M;t.projectionMatrix.makePerspective(d-f,n-f+p,l*o/v*g,h*o/v*g,g,v),t.projectionMatrixInverse.copy(t.projectionMatrix).invert()}function O(t,e){null===e?t.matrixWorld.copy(t.matrix):t.matrixWorld.multiplyMatrices(e.matrixWorld,t.matrix),t.matrixWorldInverse.copy(t.matrixWorld).invert()}function B(t,e,i){null===i?t.matrix.copy(e.matrixWorld):(t.matrix.copy(i.matrixWorld),t.matrix.invert(),t.matrix.multiply(e.matrixWorld)),t.matrix.decompose(t.position,t.quaternion,t.scale),t.updateMatrixWorld(!0),t.projectionMatrix.copy(e.projectionMatrix),t.projectionMatrixInverse.copy(e.projectionMatrixInverse),t.isPerspectiveCamera&&(t.fov=2*Ji*Math.atan(1/t.projectionMatrix.elements[5]),t.zoom=1)}this.updateCamera=function(t){if(null!==u){null!==y.texture&&(t.near=y.depthNear,t.far=y.depthFar),A.near=T.near=n.near=t.near,A.far=T.far=n.far=t.far,C===A.near&&R===A.far||(u.updateRenderState({depthNear:A.near,depthFar:A.far}),C=A.near,R=A.far,n.near=C,n.far=R,T.near=C,T.far=R,n.updateProjectionMatrix(),T.updateProjectionMatrix(),t.updateProjectionMatrix());var e=t.parent,i=A.cameras;O(A,e);for(let t=0;t<i.length;t++)O(i[t],e);2===i.length?D(A,n,T):A.projectionMatrix.copy(n.projectionMatrix),B(t,A,e)}},this.getCamera=function(){return A},this.getFoveation=function(){if(null!==g||null!==v)return s},this.setFoveation=function(t){s=t,null!==g&&(g.fixedFoveation=t),null!==v&&void 0!==v.fixedFoveation&&(v.fixedFoveation=t)},this.hasDepthSensing=function(){return null!==y.texture},this.getDepthSensingMesh=function(){return y.getMesh(A)};let F=null;function t(t,e){if(m=e.getViewerPose(p||d),_=e,null!==m){var r=m.views,i;null!==v&&(h.setRenderTargetFramebuffer(x,v.framebuffer),h.setRenderTarget(x));let n=!1;r.length!==A.cameras.length&&(A.cameras.length=0,n=!0);for(let i=0;i<r.length;i++){var a=r[i],s;let t=null;null!==v?t=v.getViewport(a):(s=f.getViewSubImage(g,a),t=s.viewport,0===i&&(h.setRenderTargetTextures(x,s.colorTexture,g.ignoreDepthValues?void 0:s.depthStencilTexture),h.setRenderTarget(x)));let e=E[i];void 0===e&&(e=new lh,e.layers.enable(i),e.viewport=new jn,E[i]=e),e.matrix.fromArray(a.transform.matrix),e.matrix.decompose(e.position,e.quaternion,e.scale),e.projectionMatrix.fromArray(a.projectionMatrix),e.projectionMatrixInverse.copy(e.projectionMatrix).invert(),e.viewport.set(t.x,t.y,t.width,t.height),0===i&&(A.matrix.copy(e.matrix),A.matrix.decompose(A.position,A.quaternion,A.scale)),!0===n&&A.cameras.push(e)}const o=u.enabledFeatures;o&&o.includes("depth-sensing")&&((i=f.getDepthInformation(r[0]))&&i.isValid&&i.texture&&y.init(h,i,u.renderState))}for(let t=0;t<M.length;t++){var n=S[t];const l=M[t];null!==n&&void 0!==l&&l.update(n,e,p||d)}F&&F(t,e),e.detectedPlanes&&c.dispatchEvent({type:"planesdetected",data:e}),_=null}const z=new Mh;z.setAnimationLoop(t),this.setAnimationLoop=function(t){F=t},this.dispose=function(){}}}const Ld=new kr,Ud=new Pr;function Nd(i,a){function s(t,e){!0===t.matrixAutoUpdate&&t.updateMatrix(),e.value.copy(t.matrix)}function t(t,e){e.color.getRGB(t.fogColor.value,ys(i)),e.isFog?(t.fogNear.value=e.near,t.fogFar.value=e.far):e.isFogExp2&&(t.fogDensity.value=e.density)}function e(t,e,i,n,r){e.isMeshBasicMaterial||e.isMeshLambertMaterial?o(t,e):e.isMeshToonMaterial?(o(t,e),p(t,e)):e.isMeshPhongMaterial?(o(t,e),d(t,e)):e.isMeshStandardMaterial?(o(t,e),m(t,e),e.isMeshPhysicalMaterial&&f(t,e,r)):e.isMeshMatcapMaterial?(o(t,e),g(t,e)):e.isMeshDepthMaterial?o(t,e):e.isMeshDistanceMaterial?(o(t,e),v(t,e)):e.isMeshNormalMaterial?o(t,e):e.isLineBasicMaterial?(l(t,e),e.isLineDashedMaterial&&h(t,e)):e.isPointsMaterial?c(t,e,i,n):e.isSpriteMaterial?u(t,e):e.isShadowMaterial?(t.color.value.copy(e.color),t.opacity.value=e.opacity):e.isShaderMaterial&&(e.uniformsNeedUpdate=!1)}function o(t,e){t.opacity.value=e.opacity,e.color&&t.diffuse.value.copy(e.color),e.emissive&&t.emissive.value.copy(e.emissive).multiplyScalar(e.emissiveIntensity),e.map&&(t.map.value=e.map,s(e.map,t.mapTransform)),e.alphaMap&&(t.alphaMap.value=e.alphaMap,s(e.alphaMap,t.alphaMapTransform)),e.bumpMap&&(t.bumpMap.value=e.bumpMap,s(e.bumpMap,t.bumpMapTransform),t.bumpScale.value=e.bumpScale,e.side===Yt&&(t.bumpScale.value*=-1)),e.normalMap&&(t.normalMap.value=e.normalMap,s(e.normalMap,t.normalMapTransform),t.normalScale.value.copy(e.normalScale),e.side===Yt&&t.normalScale.value.negate()),e.displacementMap&&(t.displacementMap.value=e.displacementMap,s(e.displacementMap,t.displacementMapTransform),t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap,s(e.emissiveMap,t.emissiveMapTransform)),e.specularMap&&(t.specularMap.value=e.specularMap,s(e.specularMap,t.specularMapTransform)),0<e.alphaTest&&(t.alphaTest.value=e.alphaTest);var i=a.get(e),n=i.envMap,r=i.envMapRotation;n&&(t.envMap.value=n,Ld.copy(r),Ld.x*=-1,Ld.y*=-1,Ld.z*=-1,n.isCubeTexture&&!1===n.isRenderTargetTexture&&(Ld.y*=-1,Ld.z*=-1),t.envMapRotation.value.setFromMatrix4(Ud.makeRotationFromEuler(Ld)),t.flipEnvMap.value=n.isCubeTexture&&!1===n.isRenderTargetTexture?-1:1,t.reflectivity.value=e.reflectivity,t.ior.value=e.ior,t.refractionRatio.value=e.refractionRatio),e.lightMap&&(t.lightMap.value=e.lightMap,t.lightMapIntensity.value=e.lightMapIntensity,s(e.lightMap,t.lightMapTransform)),e.aoMap&&(t.aoMap.value=e.aoMap,t.aoMapIntensity.value=e.aoMapIntensity,s(e.aoMap,t.aoMapTransform))}function l(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,e.map&&(t.map.value=e.map,s(e.map,t.mapTransform))}function h(t,e){t.dashSize.value=e.dashSize,t.totalSize.value=e.dashSize+e.gapSize,t.scale.value=e.scale}function c(t,e,i,n){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.size.value=e.size*i,t.scale.value=.5*n,e.map&&(t.map.value=e.map,s(e.map,t.uvTransform)),e.alphaMap&&(t.alphaMap.value=e.alphaMap,s(e.alphaMap,t.alphaMapTransform)),0<e.alphaTest&&(t.alphaTest.value=e.alphaTest)}function u(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.rotation.value=e.rotation,e.map&&(t.map.value=e.map,s(e.map,t.mapTransform)),e.alphaMap&&(t.alphaMap.value=e.alphaMap,s(e.alphaMap,t.alphaMapTransform)),0<e.alphaTest&&(t.alphaTest.value=e.alphaTest)}function d(t,e){t.specular.value.copy(e.specular),t.shininess.value=Math.max(e.shininess,1e-4)}function p(t,e){e.gradientMap&&(t.gradientMap.value=e.gradientMap)}function m(t,e){t.metalness.value=e.metalness,e.metalnessMap&&(t.metalnessMap.value=e.metalnessMap,s(e.metalnessMap,t.metalnessMapTransform)),t.roughness.value=e.roughness,e.roughnessMap&&(t.roughnessMap.value=e.roughnessMap,s(e.roughnessMap,t.roughnessMapTransform)),e.envMap&&(t.envMapIntensity.value=e.envMapIntensity)}function f(t,e,i){t.ior.value=e.ior,0<e.sheen&&(t.sheenColor.value.copy(e.sheenColor).multiplyScalar(e.sheen),t.sheenRoughness.value=e.sheenRoughness,e.sheenColorMap&&(t.sheenColorMap.value=e.sheenColorMap,s(e.sheenColorMap,t.sheenColorMapTransform)),e.sheenRoughnessMap&&(t.sheenRoughnessMap.value=e.sheenRoughnessMap,s(e.sheenRoughnessMap,t.sheenRoughnessMapTransform))),0<e.clearcoat&&(t.clearcoat.value=e.clearcoat,t.clearcoatRoughness.value=e.clearcoatRoughness,e.clearcoatMap&&(t.clearcoatMap.value=e.clearcoatMap,s(e.clearcoatMap,t.clearcoatMapTransform)),e.clearcoatRoughnessMap&&(t.clearcoatRoughnessMap.value=e.clearcoatRoughnessMap,s(e.clearcoatRoughnessMap,t.clearcoatRoughnessMapTransform)),e.clearcoatNormalMap&&(t.clearcoatNormalMap.value=e.clearcoatNormalMap,s(e.clearcoatNormalMap,t.clearcoatNormalMapTransform),t.clearcoatNormalScale.value.copy(e.clearcoatNormalScale),e.side===Yt&&t.clearcoatNormalScale.value.negate())),0<e.dispersion&&(t.dispersion.value=e.dispersion),0<e.iridescence&&(t.iridescence.value=e.iridescence,t.iridescenceIOR.value=e.iridescenceIOR,t.iridescenceThicknessMinimum.value=e.iridescenceThicknessRange[0],t.iridescenceThicknessMaximum.value=e.iridescenceThicknessRange[1],e.iridescenceMap&&(t.iridescenceMap.value=e.iridescenceMap,s(e.iridescenceMap,t.iridescenceMapTransform)),e.iridescenceThicknessMap&&(t.iridescenceThicknessMap.value=e.iridescenceThicknessMap,s(e.iridescenceThicknessMap,t.iridescenceThicknessMapTransform))),0<e.transmission&&(t.transmission.value=e.transmission,t.transmissionSamplerMap.value=i.texture,t.transmissionSamplerSize.value.set(i.width,i.height),e.transmissionMap&&(t.transmissionMap.value=e.transmissionMap,s(e.transmissionMap,t.transmissionMapTransform)),t.thickness.value=e.thickness,e.thicknessMap&&(t.thicknessMap.value=e.thicknessMap,s(e.thicknessMap,t.thicknessMapTransform)),t.attenuationDistance.value=e.attenuationDistance,t.attenuationColor.value.copy(e.attenuationColor)),0<e.anisotropy&&(t.anisotropyVector.value.set(e.anisotropy*Math.cos(e.anisotropyRotation),e.anisotropy*Math.sin(e.anisotropyRotation)),e.anisotropyMap&&(t.anisotropyMap.value=e.anisotropyMap,s(e.anisotropyMap,t.anisotropyMapTransform))),t.specularIntensity.value=e.specularIntensity,t.specularColor.value.copy(e.specularColor),e.specularColorMap&&(t.specularColorMap.value=e.specularColorMap,s(e.specularColorMap,t.specularColorMapTransform)),e.specularIntensityMap&&(t.specularIntensityMap.value=e.specularIntensityMap,s(e.specularIntensityMap,t.specularIntensityMapTransform))}function g(t,e){e.matcap&&(t.matcap.value=e.matcap)}function v(t,e){var i=a.get(e).light;t.referencePosition.value.setFromMatrixPosition(i.matrixWorld),t.nearDistance.value=i.shadow.camera.near,t.farDistance.value=i.shadow.camera.far}return{refreshFogUniforms:t,refreshMaterialUniforms:e}}function Dd(u,a,t,s){let d={},o={},n=[];const e=u.getParameter(u.MAX_UNIFORM_BUFFER_BINDINGS);function i(t,e){var i=e.program;s.uniformBlockBinding(t,i)}function r(t,e){var i;void 0===(i=d[t.id])&&(m(t),i=l(t),d[t.id]=i,t.addEventListener("dispose",g));var n=e.program;s.updateUBOMapping(t,n);var r=a.render.frame;o[t.id]!==r&&(c(t),o[t.id]=r)}function l(t){var e=h();t.__bindingPointIndex=e;var i=u.createBuffer(),n=t.__size,r=t.usage;return u.bindBuffer(u.UNIFORM_BUFFER,i),u.bufferData(u.UNIFORM_BUFFER,n,r),u.bindBuffer(u.UNIFORM_BUFFER,null),u.bindBufferBase(u.UNIFORM_BUFFER,e,i),i}function h(){for(let t=0;t<e;t++)if(-1===n.indexOf(t))return n.push(t),t;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function c(t){var e=d[t.id],n=t.uniforms,r=t.__cache;u.bindBuffer(u.UNIFORM_BUFFER,e);for(let i=0,t=n.length;i<t;i++){var a=Array.isArray(n[i])?n[i]:[n[i]];for(let t=0,e=a.length;t<e;t++){const h=a[t];if(!0===p(h,i,t,r)){var s=h.__offset,o=Array.isArray(h.value)?h.value:[h.value];let e=0;for(let t=0;t<o.length;t++){const c=o[t];var l=f(c);"number"==typeof c||"boolean"==typeof c?(h.__data[0]=c,u.bufferSubData(u.UNIFORM_BUFFER,s+e,h.__data)):c.isMatrix3?(h.__data[0]=c.elements[0],h.__data[1]=c.elements[1],h.__data[2]=c.elements[2],h.__data[3]=0,h.__data[4]=c.elements[3],h.__data[5]=c.elements[4],h.__data[6]=c.elements[5],h.__data[7]=0,h.__data[8]=c.elements[6],h.__data[9]=c.elements[7],h.__data[10]=c.elements[8],h.__data[11]=0):(c.toArray(h.__data,e),e+=l.storage/Float32Array.BYTES_PER_ELEMENT)}u.bufferSubData(u.UNIFORM_BUFFER,s,h.__data)}}}u.bindBuffer(u.UNIFORM_BUFFER,null)}function p(t,e,i,n){const r=t.value;var a=e+"_"+i;if(void 0===n[a])return"number"==typeof r||"boolean"==typeof r?n[a]=r:n[a]=r.clone(),!0;{const s=n[a];if("number"==typeof r||"boolean"==typeof r){if(s!==r)return n[a]=r,!0}else if(!1===s.equals(r))return s.copy(r),!0}return!1}function m(t){var i=t.uniforms;let n=0;var e=16;for(let t=0,e=i.length;t<e;t++){var r=Array.isArray(i[t])?i[t]:[i[t]];for(let t=0,e=r.length;t<e;t++){const u=r[t];var a=Array.isArray(u.value)?u.value:[u.value];for(let t=0,e=a.length;t<e;t++){var s,o=f(a[t]);const c=n%16;var l=c%o.boundary,h=c+l;n+=l,0!=h&&16-h<o.storage&&(n+=16-h),u.__data=new Float32Array(o.storage/Float32Array.BYTES_PER_ELEMENT),u.__offset=n,n+=o.storage}}}const c=n%16;return 0<c&&(n+=16-c),t.__size=n,t.__cache={},this}function f(t){const e={boundary:0,storage:0};return"number"==typeof t||"boolean"==typeof t?(e.boundary=4,e.storage=4):t.isVector2?(e.boundary=8,e.storage=8):t.isVector3||t.isColor?(e.boundary=16,e.storage=12):t.isVector4?(e.boundary=16,e.storage=16):t.isMatrix3?(e.boundary=48,e.storage=48):t.isMatrix4?(e.boundary=64,e.storage=64):t.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",t),e}function g(t){const e=t.target;e.removeEventListener("dispose",g);var i=n.indexOf(e.__bindingPointIndex);n.splice(i,1),u.deleteBuffer(d[e.id]),delete d[e.id],delete o[e.id]}function v(){for(const t in d)u.deleteBuffer(d[t]);n=[],d={},o={}}return{bind:i,update:r,dispose:v}}class Od{constructor(t={}){const{canvas:n=Cn(),context:e=null,depth:i=!0,stencil:g=!1,alpha:r=!1,antialias:a=!1,premultipliedAlpha:s=!0,preserveDrawingBuffer:o=!1,powerPreference:l="default",failIfMajorPerformanceCaveat:h=!1}=t;this.isWebGLRenderer=!0;let c;if(null!==e){if("undefined"!=typeof WebGLRenderingContext&&e instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");c=e.getContextAttributes().alpha}else c=r;const d=new Uint32Array(4),p=new Int32Array(4);let m=null,L=null;const u=[],f=[];this.domElement=n,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=ei,this.toneMapping=oe,this.toneMappingExposure=1;const U=this;let v=!1,_=0,y=0,N=null,D=-1,O=null;const x=new jn,M=new jn;let S=null;const b=new ya(0);let w=0,T=n.width,B=n.height,F=1,E=null,A=null;const C=new jn(0,0,T,B),R=new jn(0,0,T,B);let P=!1;const I=new xh;let z=!1,k=!1;const V=new Pr,G=new tr,H=new jn,W={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let X=!1;function j(){return null===N?F:1}let q=e;function Y(t,e){return n.getContext(t,e)}try{var Z={alpha:!0,depth:i,stencil:g,antialias:a,premultipliedAlpha:s,preserveDrawingBuffer:o,powerPreference:l,failIfMajorPerformanceCaveat:h};if("setAttribute"in n&&n.setAttribute("data-engine","three.js r"+jt),n.addEventListener("webglcontextlost",bt,!1),n.addEventListener("webglcontextrestored",wt,!1),n.addEventListener("webglcontextcreationerror",Tt,!1),null===q){var J="webgl2";if(q=Y(J,Z),null===q)throw Y(J)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(t){throw console.error("THREE.WebGLRenderer: "+t.message),t}let K,$,Q,tt,et,it,nt,rt,at,st,ot,lt,ht,ct,ut,dt,pt,mt,ft,gt,vt,_t,yt,xt;function Mt(){K=new rc(q),K.init(),_t=new bd(q,K),$=new Uh(q,K,t,_t),Q=new fd(q),tt=new oc(q),et=new $u,it=new Sd(q,K,Q,et,$,_t,tt),nt=new Dh(U),rt=new nc(U),at=new Sh(q),yt=new Ih(q,at),st=new ac(q,at,tt,yt),ot=new hc(q,st,at,tt),ft=new lc(q,$,it),dt=new Nh(et),lt=new Ku(U,nt,rt,K,$,yt,dt),ht=new Nd(U,et),ct=new id,ut=new hd(K),mt=new Ph(U,nt,rt,Q,ot,c,s),pt=new md(U,ot,$),xt=new Dd(q,tt,$,Q),gt=new Lh(q,K,tt),vt=new sc(q,K,tt),tt.programs=lt.programs,U.capabilities=$,U.extensions=K,U.properties=et,U.renderLists=ct,U.shadowMap=pt,U.state=Q,U.info=tt}Mt();const St=new Id(U,q);function bt(t){t.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),v=!0}function wt(){console.log("THREE.WebGLRenderer: Context Restored."),v=!1;var t=tt.autoReset,e=pt.enabled,i=pt.autoUpdate,n=pt.needsUpdate,r=pt.type;Mt(),tt.autoReset=t,pt.enabled=e,pt.autoUpdate=i,pt.needsUpdate=n,pt.type=r}function Tt(t){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",t.statusMessage)}function Et(t){const e=t.target;e.removeEventListener("dispose",Et),At(e)}function At(t){Ct(t),et.remove(t)}function Ct(t){const e=et.get(t).programs;void 0!==e&&(e.forEach(function(t){lt.releaseProgram(t)}),t.isShaderMaterial&&lt.releaseShaderCache(t))}function Rt(t,e,i){!0===t.transparent&&t.side===Zt&&!1===t.forceSinglePass?(t.side=Yt,t.needsUpdate=!0,kt(t,e,i),t.side=qt,t.needsUpdate=!0,kt(t,e,i),t.side=Zt):kt(t,e,i)}this.xr=St,this.getContext=function(){return q},this.getContextAttributes=function(){return q.getContextAttributes()},this.forceContextLoss=function(){const t=K.get("WEBGL_lose_context");t&&t.loseContext()},this.forceContextRestore=function(){const t=K.get("WEBGL_lose_context");t&&t.restoreContext()},this.getPixelRatio=function(){return F},this.setPixelRatio=function(t){void 0!==t&&(F=t,this.setSize(T,B,!1))},this.getSize=function(t){return t.set(T,B)},this.setSize=function(t,e,i=!0){St.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(T=t,B=e,n.width=Math.floor(t*F),n.height=Math.floor(e*F),!0===i&&(n.style.width=t+"px",n.style.height=e+"px"),this.setViewport(0,0,t,e))},this.getDrawingBufferSize=function(t){return t.set(T*F,B*F).floor()},this.setDrawingBufferSize=function(t,e,i){T=t,B=e,F=i,n.width=Math.floor(t*i),n.height=Math.floor(e*i),this.setViewport(0,0,t,e)},this.getCurrentViewport=function(t){return t.copy(x)},this.getViewport=function(t){return t.copy(C)},this.setViewport=function(t,e,i,n){t.isVector4?C.set(t.x,t.y,t.z,t.w):C.set(t,e,i,n),Q.viewport(x.copy(C).multiplyScalar(F).round())},this.getScissor=function(t){return t.copy(R)},this.setScissor=function(t,e,i,n){t.isVector4?R.set(t.x,t.y,t.z,t.w):R.set(t,e,i,n),Q.scissor(M.copy(R).multiplyScalar(F).round())},this.getScissorTest=function(){return P},this.setScissorTest=function(t){Q.setScissorTest(P=t)},this.setOpaqueSort=function(t){E=t},this.setTransparentSort=function(t){A=t},this.getClearColor=function(t){return t.copy(mt.getClearColor())},this.setClearColor=function(){mt.setClearColor.apply(mt,arguments)},this.getClearAlpha=function(){return mt.getClearAlpha()},this.setClearAlpha=function(){mt.setClearAlpha.apply(mt,arguments)},this.clear=function(t=!0,e=!0,i=!0){let n=0;if(t){let t=!1;var r,a,s,o,l,h,c,u;null!==N&&(r=N.texture.format,t=r===_e||r===ve||r===ge),t?(s=(a=N.texture.type)===he||a===ue||a===ce||a===fe||a===pe||a===me,o=mt.getClearColor(),l=mt.getClearAlpha(),h=o.r,c=o.g,u=o.b,s?(d[0]=h,d[1]=c,d[2]=u,d[3]=l,q.clearBufferuiv(q.COLOR,0,d)):(p[0]=h,p[1]=c,p[2]=u,p[3]=l,q.clearBufferiv(q.COLOR,0,p))):n|=q.COLOR_BUFFER_BIT}e&&(n|=q.DEPTH_BUFFER_BIT),i&&(n|=q.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),q.clear(n)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){n.removeEventListener("webglcontextlost",bt,!1),n.removeEventListener("webglcontextrestored",wt,!1),n.removeEventListener("webglcontextcreationerror",Tt,!1),ct.dispose(),ut.dispose(),et.dispose(),nt.dispose(),rt.dispose(),ot.dispose(),yt.dispose(),xt.dispose(),lt.dispose(),St.dispose(),St.removeEventListener("sessionstart",Lt),St.removeEventListener("sessionend",Ut),Nt.stop()},this.renderBufferDirect=function(t,e,i,n,r,a){null===e&&(e=W);var s=r.isMesh&&r.matrixWorld.determinant()<0,o=Ht(t,e,i,n,r);Q.setMaterial(n,s);let l=i.index,h=1;if(!0===n.wireframe){if(l=st.getWireframeAttribute(i),void 0===l)return;h=2}var c=i.drawRange,u=i.attributes.position,d,p,m;let f=c.start*h,g=(c.start+c.count)*h;null!==a&&(f=Math.max(f,a.start*h),g=Math.min(g,(a.start+a.count)*h)),null!==l?(f=Math.max(f,0),g=Math.min(g,l.count)):null!=u&&(f=Math.max(f,0),g=Math.min(g,u.count));const v=g-f;if(!(v<0||v===1/0)){yt.setup(r,n,o,i,l);let e=gt;if(null!==l&&(d=at.get(l),e=vt,e.setIndex(d)),r.isMesh)!0===n.wireframe?(Q.setLineWidth(n.wireframeLinewidth*j()),e.setMode(q.LINES)):e.setMode(q.TRIANGLES);else if(r.isLine){let t=n.linewidth;void 0===t&&(t=1),Q.setLineWidth(t*j()),r.isLineSegments?e.setMode(q.LINES):r.isLineLoop?e.setMode(q.LINE_LOOP):e.setMode(q.LINE_STRIP)}else r.isPoints?e.setMode(q.POINTS):r.isSprite&&e.setMode(q.TRIANGLES);if(r.isBatchedMesh)if(null!==r._multiDrawInstances)e.renderMultiDrawInstances(r._multiDrawStarts,r._multiDrawCounts,r._multiDrawCount,r._multiDrawInstances);else if(K.get("WEBGL_multi_draw"))e.renderMultiDraw(r._multiDrawStarts,r._multiDrawCounts,r._multiDrawCount);else{var _=r._multiDrawStarts,y=r._multiDrawCounts;const v=r._multiDrawCount;var x=l?at.get(l).bytesPerElement:1;const M=et.get(n).currentProgram.getUniforms();for(let t=0;t<v;t++)M.setValue(q,"_gl_DrawID",t),e.render(_[t]/x,y[t])}else r.isInstancedMesh?e.renderInstances(f,v,r.count):i.isInstancedBufferGeometry?(p=void 0!==i._maxInstanceCount?i._maxInstanceCount:1/0,m=Math.min(i.instanceCount,p),e.renderInstances(f,v,m)):e.render(f,v)}},this.compile=function(t,e,r=null){null===r&&(r=t),L=ut.get(r),L.init(e),f.push(L),r.traverseVisible(function(t){t.isLight&&t.layers.test(e.layers)&&(L.pushLight(t),t.castShadow&&L.pushShadow(t))}),t!==r&&t.traverseVisible(function(t){t.isLight&&t.layers.test(e.layers)&&(L.pushLight(t),t.castShadow&&L.pushShadow(t))}),L.setupLights();const a=new Set;return t.traverse(function(e){var i=e.material;if(i)if(Array.isArray(i))for(let t=0;t<i.length;t++){var n=i[t];Rt(n,r,e),a.add(n)}else Rt(i,r,e),a.add(i)}),f.pop(),L=null,a},this.compileAsync=function(i,t,e=null){const n=this.compile(i,t,e);return new Promise(t=>{function e(){n.forEach(function(t){var e;const i=et.get(t).currentProgram;i.isReady()&&n.delete(t)}),0!==n.size?setTimeout(e,10):t(i)}null!==K.get("KHR_parallel_shader_compile")?e():setTimeout(e,10)})};let Pt=null;function It(t){Pt&&Pt(t)}function Lt(){Nt.stop()}function Ut(){Nt.start()}const Nt=new Mh;function Dt(i,n,r,a){if(!1!==i.visible){var t,e,s;if(i.layers.test(n.layers))if(i.isGroup)r=i.renderOrder;else if(i.isLOD)!0===i.autoUpdate&&i.update(n);else if(i.isLight)L.pushLight(i),i.castShadow&&L.pushShadow(i);else if(i.isSprite){i.frustumCulled&&!I.intersectsSprite(i)||(a&&H.setFromMatrixPosition(i.matrixWorld).applyMatrix4(V),e=ot.update(i),(s=i.material).visible&&m.push(i,e,s,r,H.z,null))}else if((i.isMesh||i.isLine||i.isPoints)&&(!i.frustumCulled||I.intersectsObject(i))){const d=ot.update(i);var o=i.material;if(a&&(void 0!==i.boundingSphere?(null===i.boundingSphere&&i.computeBoundingSphere(),H.copy(i.boundingSphere.center)):(null===d.boundingSphere&&d.computeBoundingSphere(),H.copy(d.boundingSphere.center)),H.applyMatrix4(i.matrixWorld).applyMatrix4(V)),Array.isArray(o)){var l=d.groups;for(let t=0,e=l.length;t<e;t++){var h=l[t],c=o[h.materialIndex];c&&c.visible&&m.push(i,d,c,r,H.z,h)}}else o.visible&&m.push(i,d,o,r,H.z,null)}var u=i.children;for(let t=0,e=u.length;t<e;t++)Dt(u[t],n,r,a)}}function Ot(t,e,i,n){var r=t.opaque,a=t.transmissive,s=t.transparent;L.setupLightsView(i),!0===z&&dt.setGlobalState(U.clippingPlanes,i),n&&Q.viewport(x.copy(n)),0<r.length&&Ft(r,e,i),0<a.length&&Ft(a,e,i),0<s.length&&Ft(s,e,i),Q.buffers.depth.setTest(!0),Q.buffers.depth.setMask(!0),Q.buffers.color.setMask(!0),Q.setPolygonOffset(!1)}function Bt(t,n,r,a){var e;if(null===(!0===r.isScene?r.overrideMaterial:null)){void 0===L.state.transmissionRenderTarget[a.id]&&(L.state.transmissionRenderTarget[a.id]=new Yn(1,1,{generateMipmaps:!0,type:K.has("EXT_color_buffer_half_float")||K.has("EXT_color_buffer_float")?de:he,minFilter:le,samples:4,stencilBuffer:g,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:On.workingColorSpace}));const p=L.state.transmissionRenderTarget[a.id];var i=a.viewport||x;p.setSize(i.z,i.w);var s=U.getRenderTarget();U.setRenderTarget(p),U.getClearColor(b),w=U.getClearAlpha(),w<1&&U.setClearColor(16777215,.5),U.clear(),X&&mt.render(r);var o=U.toneMapping;U.toneMapping=oe;var l=a.viewport;if(void 0!==a.viewport&&(a.viewport=void 0),L.setupLightsView(a),!0===z&&dt.setGlobalState(U.clippingPlanes,a),Ft(t,r,a),it.updateMultisampleRenderTarget(p),it.updateRenderTargetMipmap(p),!1===K.has("WEBGL_multisampled_render_to_texture")){let i=!1;for(let t=0,e=n.length;t<e;t++){var h=n[t];const m=h.object;var c=h.geometry;const f=h.material;var u=h.group,d;f.side===Zt&&m.layers.test(a.layers)&&(d=f.side,f.side=Yt,f.needsUpdate=!0,zt(m,r,a,c,f,u),f.side=d,f.needsUpdate=!0,i=!0)}!0===i&&(it.updateMultisampleRenderTarget(p),it.updateRenderTargetMipmap(p))}U.setRenderTarget(s),U.setClearColor(b,w),void 0!==l&&(a.viewport=l),U.toneMapping=o}}function Ft(i,n,r){var a=!0===n.isScene?n.overrideMaterial:null;for(let t=0,e=i.length;t<e;t++){var s=i[t];const c=s.object;var o=s.geometry,l=null===a?s.material:a,h=s.group;c.layers.test(r.layers)&&zt(c,n,r,o,l,h)}}function zt(t,e,i,n,r,a){t.onBeforeRender(U,e,i,n,r,a),t.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),!0===r.transparent&&r.side===Zt&&!1===r.forceSinglePass?(r.side=Yt,r.needsUpdate=!0,U.renderBufferDirect(i,e,n,r,t,a),r.side=qt,r.needsUpdate=!0,U.renderBufferDirect(i,e,n,r,t,a),r.side=Zt):U.renderBufferDirect(i,e,n,r,t,a),t.onAfterRender(U,e,i,n,r,a)}function kt(t,e,i){!0!==e.isScene&&(e=W);const n=et.get(t);var r=L.state.lights,a=L.state.shadowsArray,s=r.state.version;const o=lt.getParameters(t,r.state,a,e,i);var l=lt.getProgramCacheKey(o);let h=n.programs;n.environment=t.isMeshStandardMaterial?e.environment:null,n.fog=e.fog,n.envMap=(t.isMeshStandardMaterial?rt:nt).get(t.envMap||n.environment),n.envMapRotation=null!==n.environment&&null===t.envMap?e.environmentRotation:t.envMapRotation,void 0===h&&(t.addEventListener("dispose",Et),h=new Map,n.programs=h);let c=h.get(l);if(void 0!==c){if(n.currentProgram===c&&n.lightsStateVersion===s)return Gt(t,o),c}else o.uniforms=lt.getUniforms(t),t.onBeforeCompile(o,U),c=lt.acquireProgram(o,l),h.set(l,c),n.uniforms=o.uniforms;const u=n.uniforms;return(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(u.clippingPlanes=dt.uniform),Gt(t,o),n.needsLights=Xt(t),n.lightsStateVersion=s,n.needsLights&&(u.ambientLightColor.value=r.state.ambient,u.lightProbe.value=r.state.probe,u.directionalLights.value=r.state.directional,u.directionalLightShadows.value=r.state.directionalShadow,u.spotLights.value=r.state.spot,u.spotLightShadows.value=r.state.spotShadow,u.rectAreaLights.value=r.state.rectArea,u.ltc_1.value=r.state.rectAreaLTC1,u.ltc_2.value=r.state.rectAreaLTC2,u.pointLights.value=r.state.point,u.pointLightShadows.value=r.state.pointShadow,u.hemisphereLights.value=r.state.hemi,u.directionalShadowMap.value=r.state.directionalShadowMap,u.directionalShadowMatrix.value=r.state.directionalShadowMatrix,u.spotShadowMap.value=r.state.spotShadowMap,u.spotLightMatrix.value=r.state.spotLightMatrix,u.spotLightMap.value=r.state.spotLightMap,u.pointShadowMap.value=r.state.pointShadowMap,u.pointShadowMatrix.value=r.state.pointShadowMatrix),n.currentProgram=c,n.uniformsList=null,c}function Vt(t){var e;return null===t.uniformsList&&(e=t.currentProgram.getUniforms(),t.uniformsList=vu.seqWithValue(e.seq,t.uniforms)),t.uniformsList}function Gt(t,e){const i=et.get(t);i.outputColorSpace=e.outputColorSpace,i.batching=e.batching,i.batchingColor=e.batchingColor,i.instancing=e.instancing,i.instancingColor=e.instancingColor,i.instancingMorph=e.instancingMorph,i.skinning=e.skinning,i.morphTargets=e.morphTargets,i.morphNormals=e.morphNormals,i.morphColors=e.morphColors,i.morphTargetsCount=e.morphTargetsCount,i.numClippingPlanes=e.numClippingPlanes,i.numIntersection=e.numClipIntersection,i.vertexAlphas=e.vertexAlphas,i.vertexTangents=e.vertexTangents,i.toneMapping=e.toneMapping}function Ht(t,e,i,n,r){!0!==e.isScene&&(e=W),it.resetTextureUnits();var a=e.fog,s=n.isMeshStandardMaterial?e.environment:null,o=null===N?U.outputColorSpace:!0===N.isXRRenderTarget?N.texture.colorSpace:ii,l=(n.isMeshStandardMaterial?rt:nt).get(n.envMap||s),h=!0===n.vertexColors&&!!i.attributes.color&&4===i.attributes.color.itemSize,c=!!i.attributes.tangent&&(!!n.normalMap||0<n.anisotropy),u=!!i.morphAttributes.position,d=!!i.morphAttributes.normal,p=!!i.morphAttributes.color;let m=oe;n.toneMapped&&(null!==N&&!0!==N.isXRRenderTarget||(m=U.toneMapping));var f=i.morphAttributes.position||i.morphAttributes.normal||i.morphAttributes.color,g=void 0!==f?f.length:0;const v=et.get(n);var _=L.state.lights,y;!0===z&&(!0!==k&&t===O||(y=t===O&&n.id===D,dt.setState(n,t,y)));let x=!1;n.version===v.__version?(v.needsLights&&v.lightsStateVersion!==_.state.version||v.outputColorSpace!==o||r.isBatchedMesh&&!1===v.batching||!r.isBatchedMesh&&!0===v.batching||r.isBatchedMesh&&!0===v.batchingColor&&null===r.colorTexture||r.isBatchedMesh&&!1===v.batchingColor&&null!==r.colorTexture||r.isInstancedMesh&&!1===v.instancing||!r.isInstancedMesh&&!0===v.instancing||r.isSkinnedMesh&&!1===v.skinning||!r.isSkinnedMesh&&!0===v.skinning||r.isInstancedMesh&&!0===v.instancingColor&&null===r.instanceColor||r.isInstancedMesh&&!1===v.instancingColor&&null!==r.instanceColor||r.isInstancedMesh&&!0===v.instancingMorph&&null===r.morphTexture||r.isInstancedMesh&&!1===v.instancingMorph&&null!==r.morphTexture||v.envMap!==l||!0===n.fog&&v.fog!==a||void 0!==v.numClippingPlanes&&(v.numClippingPlanes!==dt.numPlanes||v.numIntersection!==dt.numIntersection)||v.vertexAlphas!==h||v.vertexTangents!==c||v.morphTargets!==u||v.morphNormals!==d||v.morphColors!==p||v.toneMapping!==m||v.morphTargetsCount!==g)&&(x=!0):(x=!0,v.__version=n.version);let M=v.currentProgram;!0===x&&(M=kt(n,e,r));let S=!1,b=!1,w=!1;const T=M.getUniforms(),E=v.uniforms;if(Q.useProgram(M.program)&&(S=!0,b=!0,w=!0),n.id!==D&&(D=n.id,b=!0),S||O!==t){T.setValue(q,"projectionMatrix",t.projectionMatrix),T.setValue(q,"viewMatrix",t.matrixWorldInverse);const P=T.map.cameraPosition;void 0!==P&&P.setValue(q,G.setFromMatrixPosition(t.matrixWorld)),$.logarithmicDepthBuffer&&T.setValue(q,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial)&&T.setValue(q,"isOrthographic",!0===t.isOrthographicCamera),O!==t&&(O=t,b=!0,w=!0)}if(r.isSkinnedMesh){T.setOptional(q,r,"bindMatrix"),T.setOptional(q,r,"bindMatrixInverse");const I=r.skeleton;I&&(null===I.boneTexture&&I.computeBoneTexture(),T.setValue(q,"boneTexture",I.boneTexture,it))}r.isBatchedMesh&&(T.setOptional(q,r,"batchingTexture"),T.setValue(q,"batchingTexture",r._matricesTexture,it),T.setOptional(q,r,"batchingIdTexture"),T.setValue(q,"batchingIdTexture",r._indirectTexture,it),T.setOptional(q,r,"batchingColorTexture"),null!==r._colorsTexture&&T.setValue(q,"batchingColorTexture",r._colorsTexture,it));var A=i.morphAttributes;if(void 0===A.position&&void 0===A.normal&&void 0===A.color||ft.update(r,i,M),!b&&v.receiveShadow===r.receiveShadow||(v.receiveShadow=r.receiveShadow,T.setValue(q,"receiveShadow",r.receiveShadow)),n.isMeshGouraudMaterial&&null!==n.envMap&&(E.envMap.value=l,E.flipEnvMap.value=l.isCubeTexture&&!1===l.isRenderTargetTexture?-1:1),n.isMeshStandardMaterial&&null===n.envMap&&null!==e.environment&&(E.envMapIntensity.value=e.environmentIntensity),b&&(T.setValue(q,"toneMappingExposure",U.toneMappingExposure),v.needsLights&&Wt(E,w),a&&!0===n.fog&&ht.refreshFogUniforms(E,a),ht.refreshMaterialUniforms(E,n,F,B,L.state.transmissionRenderTarget[t.id]),vu.upload(q,Vt(v),E,it)),n.isShaderMaterial&&!0===n.uniformsNeedUpdate&&(vu.upload(q,Vt(v),E,it),n.uniformsNeedUpdate=!1),n.isSpriteMaterial&&T.setValue(q,"center",r.center),T.setValue(q,"modelViewMatrix",r.modelViewMatrix),T.setValue(q,"normalMatrix",r.normalMatrix),T.setValue(q,"modelMatrix",r.matrixWorld),n.isShaderMaterial||n.isRawShaderMaterial){var C=n.uniformsGroups;for(let t=0,e=C.length;t<e;t++){var R=C[t];xt.update(R,M),xt.bind(R,M)}}return M}function Wt(t,e){t.ambientLightColor.needsUpdate=e,t.lightProbe.needsUpdate=e,t.directionalLights.needsUpdate=e,t.directionalLightShadows.needsUpdate=e,t.pointLights.needsUpdate=e,t.pointLightShadows.needsUpdate=e,t.spotLights.needsUpdate=e,t.spotLightShadows.needsUpdate=e,t.rectAreaLights.needsUpdate=e,t.hemisphereLights.needsUpdate=e}function Xt(t){return t.isMeshLambertMaterial||t.isMeshToonMaterial||t.isMeshPhongMaterial||t.isMeshStandardMaterial||t.isShadowMaterial||t.isShaderMaterial&&!0===t.lights}Nt.setAnimationLoop(It),"undefined"!=typeof self&&Nt.setContext(self),this.setAnimationLoop=function(t){Pt=t,St.setAnimationLoop(t),null===t?Nt.stop():Nt.start()},St.addEventListener("sessionstart",Lt),St.addEventListener("sessionend",Ut),this.render=function(i,t){if(void 0===t||!0===t.isCamera){if(!0!==v){var e;!0===i.matrixWorldAutoUpdate&&i.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),!0===St.enabled&&!0===St.isPresenting&&(!0===St.cameraAutoUpdate&&St.updateCamera(t),t=St.getCamera()),!0===i.isScene&&i.onBeforeRender(U,i,t,N),L=ut.get(i,f.length),L.init(t),f.push(L),V.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),I.setFromProjectionMatrix(V),k=this.localClippingEnabled,z=dt.init(this.clippingPlanes,k),m=ct.get(i,u.length),m.init(),u.push(m),!0!==St.enabled||!0!==St.isPresenting||null!==(e=U.xr.getDepthSensingMesh())&&Dt(e,t,-1/0,U.sortObjects),Dt(i,t,0,U.sortObjects),m.finish(),!0===U.sortObjects&&m.sort(E,A),X=!1===St.enabled||!1===St.isPresenting||!1===St.hasDepthSensing(),X&&mt.addToRenderList(m,i),this.info.render.frame++,!0===z&&dt.beginShadows();var n=L.state.shadowsArray;pt.render(n,i,t),!0===z&&dt.endShadows(),!0===this.info.autoReset&&this.info.reset();var r=m.opaque,a=m.transmissive;if(L.setupLights(),t.isArrayCamera){var s=t.cameras,o;if(0<a.length)for(let t=0,e=s.length;t<e;t++){Bt(r,a,i,s[t])}X&&mt.render(i);for(let t=0,e=s.length;t<e;t++){var l=s[t];Ot(m,i,l,l.viewport)}}else 0<a.length&&Bt(r,a,i,t),X&&mt.render(i),Ot(m,i,t);null!==N&&(it.updateMultisampleRenderTarget(N),it.updateRenderTargetMipmap(N)),!0===i.isScene&&i.onAfterRender(U,i,t),yt.resetDefaultState(),D=-1,O=null,f.pop(),0<f.length?(L=f[f.length-1],!0===z&&dt.setGlobalState(U.clippingPlanes,L.state.camera)):L=null,u.pop(),m=0<u.length?u[u.length-1]:null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.getActiveCubeFace=function(){return _},this.getActiveMipmapLevel=function(){return y},this.getRenderTarget=function(){return N},this.setRenderTargetTextures=function(t,e,i){et.get(t.texture).__webglTexture=e,et.get(t.depthTexture).__webglTexture=i;const n=et.get(t);n.__hasExternalTextures=!0,n.__autoAllocateDepthBuffer=void 0===i,n.__autoAllocateDepthBuffer||!0===K.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),n.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(t,e){const i=et.get(t);i.__webglFramebuffer=e,i.__useDefaultFramebuffer=void 0===e},this.setRenderTarget=function(t,e=0,i=0){N=t,_=e,y=i;let n=!0,r=null,a=!1,s=!1;var o,l,h,c,u,d,p;S=t?(void 0!==(o=et.get(t)).__useDefaultFramebuffer?(Q.bindFramebuffer(q.FRAMEBUFFER,null),n=!1):void 0===o.__webglFramebuffer?it.setupRenderTarget(t):o.__hasExternalTextures&&it.rebindTextures(t,et.get(t.texture).__webglTexture,et.get(t.depthTexture).__webglTexture),((l=t.texture).isData3DTexture||l.isDataArrayTexture||l.isCompressedArrayTexture)&&(s=!0),h=et.get(t).__webglFramebuffer,t.isWebGLCubeRenderTarget?(r=Array.isArray(h[e])?h[e][i]:h[e],a=!0):r=0<t.samples&&!1===it.useMultisampledRTT(t)?et.get(t).__webglMultisampledFramebuffer:Array.isArray(h)?h[i]:h,x.copy(t.viewport),M.copy(t.scissor),t.scissorTest):(x.copy(C).multiplyScalar(F).floor(),M.copy(R).multiplyScalar(F).floor(),P),Q.bindFramebuffer(q.FRAMEBUFFER,r)&&n&&Q.drawBuffers(t,r),Q.viewport(x),Q.scissor(M),Q.setScissorTest(S),a?(u=et.get(t.texture),q.framebufferTexture2D(q.FRAMEBUFFER,q.COLOR_ATTACHMENT0,q.TEXTURE_CUBE_MAP_POSITIVE_X+e,u.__webglTexture,i)):s&&(d=et.get(t.texture),p=e||0,q.framebufferTextureLayer(q.FRAMEBUFFER,q.COLOR_ATTACHMENT0,d.__webglTexture,i||0,p)),D=-1},this.readRenderTargetPixels=function(e,i,n,r,a,s,o){if(e&&e.isWebGLRenderTarget){let t=et.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==o&&(t=t[o]),t){Q.bindFramebuffer(q.FRAMEBUFFER,t);try{var l=e.texture,h=l.format,c=l.type;if(!$.textureFormatReadable(h))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!$.textureTypeReadable(c))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");0<=i&&i<=e.width-r&&0<=n&&n<=e.height-a&&q.readPixels(i,n,r,a,_t.convert(h),_t.convert(c),s)}finally{const t=null!==N?et.get(N).__webglFramebuffer:null;Q.bindFramebuffer(q.FRAMEBUFFER,t)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.readRenderTargetPixelsAsync=async function(t,e,i,n,r,a,s){if(!t||!t.isWebGLRenderTarget)throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let o=et.get(t).__webglFramebuffer;if(t.isWebGLCubeRenderTarget&&void 0!==s&&(o=o[s]),o){Q.bindFramebuffer(q.FRAMEBUFFER,o);try{var l=t.texture,h=l.format,c=l.type;if(!$.textureFormatReadable(h))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!$.textureTypeReadable(c))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");if(0<=e&&e<=t.width-n&&0<=i&&i<=t.height-r){var u=q.createBuffer();q.bindBuffer(q.PIXEL_PACK_BUFFER,u),q.bufferData(q.PIXEL_PACK_BUFFER,a.byteLength,q.STREAM_READ),q.readPixels(e,i,n,r,_t.convert(h),_t.convert(c),0),q.flush();var d=q.fenceSync(q.SYNC_GPU_COMMANDS_COMPLETE,0);await In(q,d,4);try{q.bindBuffer(q.PIXEL_PACK_BUFFER,u),q.getBufferSubData(q.PIXEL_PACK_BUFFER,0,a)}finally{q.deleteBuffer(u),q.deleteSync(d)}return a}}finally{const o=null!==N?et.get(N).__webglFramebuffer:null;Q.bindFramebuffer(q.FRAMEBUFFER,o)}}},this.copyFramebufferToTexture=function(t,e=null,i=0){!0!==t.isTexture&&(Pn("WebGLRenderer: copyFramebufferToTexture function signature has changed."),e=arguments[0]||null,t=arguments[1]);var n=Math.pow(2,-i),r=Math.floor(t.image.width*n),a=Math.floor(t.image.height*n),s=null!==e?e.x:0,o=null!==e?e.y:0;it.setTexture2D(t,0),q.copyTexSubImage2D(q.TEXTURE_2D,i,0,0,s,o,r,a),Q.unbindTexture()},this.copyTextureToTexture=function(t,e,i=null,n=null,r=0){!0!==t.isTexture&&(Pn("WebGLRenderer: copyTextureToTexture function signature has changed."),n=arguments[0]||null,t=arguments[1],e=arguments[2],r=arguments[3]||0,i=null);let a,s,o,l,h,c;l=null!==i?(a=i.max.x-i.min.x,s=i.max.y-i.min.y,o=i.min.x,i.min.y):(a=t.image.width,s=t.image.height,o=0),c=null!==n?(h=n.x,n.y):h=0;var u=_t.convert(e.format),d=_t.convert(e.type);it.setTexture2D(e,0),q.pixelStorei(q.UNPACK_FLIP_Y_WEBGL,e.flipY),q.pixelStorei(q.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),q.pixelStorei(q.UNPACK_ALIGNMENT,e.unpackAlignment);var p=q.getParameter(q.UNPACK_ROW_LENGTH),m=q.getParameter(q.UNPACK_IMAGE_HEIGHT),f=q.getParameter(q.UNPACK_SKIP_PIXELS),g=q.getParameter(q.UNPACK_SKIP_ROWS),v=q.getParameter(q.UNPACK_SKIP_IMAGES),_=t.isCompressedTexture?t.mipmaps[r]:t.image;q.pixelStorei(q.UNPACK_ROW_LENGTH,_.width),q.pixelStorei(q.UNPACK_IMAGE_HEIGHT,_.height),q.pixelStorei(q.UNPACK_SKIP_PIXELS,o),q.pixelStorei(q.UNPACK_SKIP_ROWS,l),t.isDataTexture?q.texSubImage2D(q.TEXTURE_2D,r,h,c,a,s,u,d,_.data):t.isCompressedTexture?q.compressedTexSubImage2D(q.TEXTURE_2D,r,h,c,_.width,_.height,u,_.data):q.texSubImage2D(q.TEXTURE_2D,r,h,c,a,s,u,d,_),q.pixelStorei(q.UNPACK_ROW_LENGTH,p),q.pixelStorei(q.UNPACK_IMAGE_HEIGHT,m),q.pixelStorei(q.UNPACK_SKIP_PIXELS,f),q.pixelStorei(q.UNPACK_SKIP_ROWS,g),q.pixelStorei(q.UNPACK_SKIP_IMAGES,v),0===r&&e.generateMipmaps&&q.generateMipmap(q.TEXTURE_2D),Q.unbindTexture()},this.copyTextureToTexture3D=function(t,e,i=null,n=null,r=0){!0!==t.isTexture&&(Pn("WebGLRenderer: copyTextureToTexture3D function signature has changed."),i=arguments[0]||null,n=arguments[1]||null,t=arguments[2],e=arguments[3],r=arguments[4]||0);let a,s,o,l,h,c,u,d,p;var m=t.isCompressedTexture?t.mipmaps[r]:t.image;c=null!==i?(a=i.max.x-i.min.x,s=i.max.y-i.min.y,o=i.max.z-i.min.z,l=i.min.x,h=i.min.y,i.min.z):(a=m.width,s=m.height,o=m.depth,l=0,h=0),p=null!==n?(u=n.x,d=n.y,n.z):(u=0,d=0);var f=_t.convert(e.format),g=_t.convert(e.type);let v;if(e.isData3DTexture)it.setTexture3D(e,0),v=q.TEXTURE_3D;else{if(!e.isDataArrayTexture&&!e.isCompressedArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");it.setTexture2DArray(e,0),v=q.TEXTURE_2D_ARRAY}q.pixelStorei(q.UNPACK_FLIP_Y_WEBGL,e.flipY),q.pixelStorei(q.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),q.pixelStorei(q.UNPACK_ALIGNMENT,e.unpackAlignment);var _=q.getParameter(q.UNPACK_ROW_LENGTH),y=q.getParameter(q.UNPACK_IMAGE_HEIGHT),x=q.getParameter(q.UNPACK_SKIP_PIXELS),M=q.getParameter(q.UNPACK_SKIP_ROWS),S=q.getParameter(q.UNPACK_SKIP_IMAGES);q.pixelStorei(q.UNPACK_ROW_LENGTH,m.width),q.pixelStorei(q.UNPACK_IMAGE_HEIGHT,m.height),q.pixelStorei(q.UNPACK_SKIP_PIXELS,l),q.pixelStorei(q.UNPACK_SKIP_ROWS,h),q.pixelStorei(q.UNPACK_SKIP_IMAGES,c),t.isDataTexture||t.isData3DTexture?q.texSubImage3D(v,r,u,d,p,a,s,o,f,g,m.data):e.isCompressedArrayTexture?q.compressedTexSubImage3D(v,r,u,d,p,a,s,o,f,m.data):q.texSubImage3D(v,r,u,d,p,a,s,o,f,g,m),q.pixelStorei(q.UNPACK_ROW_LENGTH,_),q.pixelStorei(q.UNPACK_IMAGE_HEIGHT,y),q.pixelStorei(q.UNPACK_SKIP_PIXELS,x),q.pixelStorei(q.UNPACK_SKIP_ROWS,M),q.pixelStorei(q.UNPACK_SKIP_IMAGES,S),0===r&&e.generateMipmaps&&q.generateMipmap(v),Q.unbindTexture()},this.initRenderTarget=function(t){void 0===et.get(t).__webglFramebuffer&&it.setupRenderTarget(t)},this.initTexture=function(t){t.isCubeTexture?it.setTextureCube(t,0):t.isData3DTexture?it.setTexture3D(t,0):t.isDataArrayTexture||t.isCompressedArrayTexture?it.setTexture2DArray(t,0):it.setTexture2D(t,0),Q.unbindTexture()},this.resetState=function(){_=0,y=0,N=null,Q.reset(),yt.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Wi}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(t){this._outputColorSpace=t;const e=this.getContext();e.drawingBufferColorSpace=t===ni?"display-p3":"srgb",e.unpackColorSpace=On.workingColorSpace===ri?"display-p3":"srgb"}}class Bd{constructor(t,e=25e-5){this.isFogExp2=!0,this.name="",this.color=new ya(t),this.density=e}clone(){return new Bd(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class Fd{constructor(t,e=1,i=1e3){this.isFog=!0,this.name="",this.color=new ya(t),this.near=e,this.far=i}clone(){return new Fd(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class zd extends na{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new kr,this.environmentIntensity=1,this.environmentRotation=new kr,this.overrideMaterial=null,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),this.backgroundBlurriness=t.backgroundBlurriness,this.backgroundIntensity=t.backgroundIntensity,this.backgroundRotation.copy(t.backgroundRotation),this.environmentIntensity=t.environmentIntensity,this.environmentRotation.copy(t.environmentRotation),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return null!==this.fog&&(e.object.fog=this.fog.toJSON()),0<this.backgroundBlurriness&&(e.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(e.object.backgroundIntensity=this.backgroundIntensity),e.object.backgroundRotation=this.backgroundRotation.toArray(),1!==this.environmentIntensity&&(e.object.environmentIntensity=this.environmentIntensity),e.object.environmentRotation=this.environmentRotation.toArray(),e}}class kd{constructor(t,e){this.isInterleavedBuffer=!0,this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.usage=Ui,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.version=0,this.uuid=Ki()}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}get updateRange(){return Pn("THREE.InterleavedBuffer: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(t){return this.usage=t,this}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(i,n,r){i*=this.stride,r*=n.stride;for(let t=0,e=this.stride;t<e;t++)this.array[i+t]=n.array[r+t];return this}set(t,e=0){return this.array.set(t,e),this}clone(t){void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Ki()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);var e=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]);const i=new this.constructor(e,this.stride);return i.setUsage(this.usage),i}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Ki()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const Vd=new tr;class Gd{constructor(t,e,i,n=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=t,this.itemSize=e,this.offset=i,this.normalized=n}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(i){for(let t=0,e=this.data.count;t<e;t++)Vd.fromBufferAttribute(this,t),Vd.applyMatrix4(i),this.setXYZ(t,Vd.x,Vd.y,Vd.z);return this}applyNormalMatrix(i){for(let t=0,e=this.count;t<e;t++)Vd.fromBufferAttribute(this,t),Vd.applyNormalMatrix(i),this.setXYZ(t,Vd.x,Vd.y,Vd.z);return this}transformDirection(i){for(let t=0,e=this.count;t<e;t++)Vd.fromBufferAttribute(this,t),Vd.transformDirection(i),this.setXYZ(t,Vd.x,Vd.y,Vd.z);return this}getComponent(t,e){let i=this.array[t*this.data.stride+this.offset+e];return this.normalized&&(i=_n(i,this.array)),i}setComponent(t,e,i){return this.normalized&&(i=yn(i,this.array)),this.data.array[t*this.data.stride+this.offset+e]=i,this}setX(t,e){return this.normalized&&(e=yn(e,this.array)),this.data.array[t*this.data.stride+this.offset]=e,this}setY(t,e){return this.normalized&&(e=yn(e,this.array)),this.data.array[t*this.data.stride+this.offset+1]=e,this}setZ(t,e){return this.normalized&&(e=yn(e,this.array)),this.data.array[t*this.data.stride+this.offset+2]=e,this}setW(t,e){return this.normalized&&(e=yn(e,this.array)),this.data.array[t*this.data.stride+this.offset+3]=e,this}getX(t){let e=this.data.array[t*this.data.stride+this.offset];return this.normalized&&(e=_n(e,this.array)),e}getY(t){let e=this.data.array[t*this.data.stride+this.offset+1];return this.normalized&&(e=_n(e,this.array)),e}getZ(t){let e=this.data.array[t*this.data.stride+this.offset+2];return this.normalized&&(e=_n(e,this.array)),e}getW(t){let e=this.data.array[t*this.data.stride+this.offset+3];return this.normalized&&(e=_n(e,this.array)),e}setXY(t,e,i){return t=t*this.data.stride+this.offset,this.normalized&&(e=yn(e,this.array),i=yn(i,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=i,this}setXYZ(t,e,i,n){return t=t*this.data.stride+this.offset,this.normalized&&(e=yn(e,this.array),i=yn(i,this.array),n=yn(n,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=n,this}setXYZW(t,e,i,n,r){return t=t*this.data.stride+this.offset,this.normalized&&(e=yn(e,this.array),i=yn(i,this.array),n=yn(n,this.array),r=yn(r,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=n,this.data.array[t+3]=r,this}clone(t){if(void 0!==t)return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new Gd(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized);{console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const i=[];for(let t=0;t<this.count;t++){var e=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)i.push(this.data.array[e+t])}return new Ia(new this.array.constructor(i),this.itemSize,this.normalized)}}toJSON(t){if(void 0!==t)return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized};{console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const i=[];for(let t=0;t<this.count;t++){var e=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)i.push(this.data.array[e+t])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:i,normalized:this.normalized}}}}class Hd extends Sa{constructor(t){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new ya(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}let Wd;const Xd=new tr,jd=new tr,qd=new tr,Yd=new Mn,Zd=new Mn,Jd=new Pr,Kd=new tr,$d=new tr,Qd=new tr,tp=new Mn,ep=new Mn,ip=new Mn;class np extends na{constructor(t=new Hd){var e,i;super(),this.isSprite=!0,this.type="Sprite",void 0===Wd&&(Wd=new Ya,e=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),i=new kd(e,5),Wd.setIndex([0,1,2,0,2,3]),Wd.setAttribute("position",new Gd(i,3,0,!1)),Wd.setAttribute("uv",new Gd(i,2,3,!1))),this.geometry=Wd,this.material=t,this.center=new Mn(.5,.5)}raycast(t,e){null===t.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),jd.setFromMatrixScale(this.matrixWorld),Jd.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),qd.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&jd.multiplyScalar(-qd.z);var i=this.material.rotation;let n,r;0!==i&&(r=Math.cos(i),n=Math.sin(i));var a=this.center,s,o;rp(Kd.set(-.5,-.5,0),qd,a,jd,n,r),rp($d.set(.5,-.5,0),qd,a,jd,n,r),rp(Qd.set(.5,.5,0),qd,a,jd,n,r),tp.set(0,0),ep.set(1,0),ip.set(1,1),null===(s=t.ray.intersectTriangle(Kd,$d,Qd,!1,Xd))&&(rp($d.set(-.5,.5,0),qd,a,jd,n,r),ep.set(0,1),null===(s=t.ray.intersectTriangle(Kd,Qd,$d,!1,Xd)))||((o=t.ray.origin.distanceTo(Xd))<t.near||o>t.far||e.push({distance:o,point:Xd.clone(),uv:ma.getInterpolation(Xd,Kd,$d,Qd,tp,ep,ip,new Mn),face:null,object:this}))}copy(t,e){return super.copy(t,e),void 0!==t.center&&this.center.copy(t.center),this.material=t.material,this}}function rp(t,e,i,n,r,a){Yd.subVectors(t,i).addScalar(.5).multiply(n),void 0!==r?(Zd.x=a*Yd.x-r*Yd.y,Zd.y=r*Yd.x+a*Yd.y):Zd.copy(Yd),t.copy(e),t.x+=Zd.x,t.y+=Zd.y,t.applyMatrix4(Jd)}const ap=new tr,sp=new tr;class op extends na{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(t){super.copy(t,!1);var i=t.levels;for(let t=0,e=i.length;t<e;t++){const n=i[t];this.addLevel(n.object.clone(),n.distance,n.hysteresis)}return this.autoUpdate=t.autoUpdate,this}addLevel(t,e=0,i=0){e=Math.abs(e);const n=this.levels;let r;for(r=0;r<n.length&&!(e<n[r].distance);r++);return n.splice(r,0,{distance:e,hysteresis:i,object:t}),this.add(t),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(i){var n=this.levels;if(0<n.length){let e,t;for(e=1,t=n.length;e<t;e++){let t=n[e].distance;if(n[e].object.visible&&(t-=t*n[e].hysteresis),i<t)break}return n[e-1].object}return null}raycast(t,e){var i,n;0<this.levels.length&&(ap.setFromMatrixPosition(this.matrixWorld),n=t.ray.origin.distanceTo(ap),this.getObjectForDistance(n).raycast(t,e))}update(i){const n=this.levels;if(1<n.length){ap.setFromMatrixPosition(i.matrixWorld),sp.setFromMatrixPosition(this.matrixWorld);var r=ap.distanceTo(sp)/i.zoom;n[0].object.visible=!0;let e,t;for(e=1,t=n.length;e<t;e++){let t=n[e].distance;if(n[e].object.visible&&(t-=t*n[e].hysteresis),!(r>=t))break;n[e-1].object.visible=!1,n[e].object.visible=!0}for(this._currentLevel=e-1;e<t;e++)n[e].object.visible=!1}}toJSON(t){const i=super.toJSON(t);!1===this.autoUpdate&&(i.object.autoUpdate=!1),i.object.levels=[];var n=this.levels;for(let t=0,e=n.length;t<e;t++){var r=n[t];i.object.levels.push({object:r.object.uuid,distance:r.distance,hysteresis:r.hysteresis})}return i}}const lp=new tr,hp=new jn,cp=new jn,up=new tr,dp=new Pr,pp=new tr,mp=new Mr,fp=new Pr,gp=new Rr;class vp extends ds{constructor(t,e){super(t,e),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=x,this.bindMatrix=new Pr,this.bindMatrixInverse=new Pr,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const t=this.geometry;null===this.boundingBox&&(this.boundingBox=new nr),this.boundingBox.makeEmpty();var e=t.getAttribute("position");for(let t=0;t<e.count;t++)this.getVertexPosition(t,pp),this.boundingBox.expandByPoint(pp)}computeBoundingSphere(){const t=this.geometry;null===this.boundingSphere&&(this.boundingSphere=new Mr),this.boundingSphere.makeEmpty();var e=t.getAttribute("position");for(let t=0;t<e.count;t++)this.getVertexPosition(t,pp),this.boundingSphere.expandByPoint(pp)}copy(t,e){return super.copy(t,e),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this}raycast(t,e){var i=this.material,n=this.matrixWorld;void 0!==i&&(null===this.boundingSphere&&this.computeBoundingSphere(),mp.copy(this.boundingSphere),mp.applyMatrix4(n),!1!==t.ray.intersectsSphere(mp)&&(fp.copy(n).invert(),gp.copy(t.ray).applyMatrix4(fp),null!==this.boundingBox&&!1===gp.intersectsBox(this.boundingBox)||this._computeIntersections(t,e,gp)))}getVertexPosition(t,e){return super.getVertexPosition(t,e),this.applyBoneTransform(t,e),e}bind(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const i=new jn,n=this.geometry.attributes.skinWeight;for(let t=0,e=n.count;t<e;t++){i.fromBufferAttribute(n,t);var r=1/i.manhattanLength();r!=1/0?i.multiplyScalar(r):i.set(1,0,0,0),n.setXYZW(t,i.x,i.y,i.z,i.w)}}updateMatrixWorld(t){super.updateMatrixWorld(t),this.bindMode===x?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===M?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(t,e){var i=this.skeleton,n=this.geometry;hp.fromBufferAttribute(n.attributes.skinIndex,t),cp.fromBufferAttribute(n.attributes.skinWeight,t),lp.copy(e).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(let t=0;t<4;t++){var r=cp.getComponent(t),a;0!==r&&(a=hp.getComponent(t),dp.multiplyMatrices(i.bones[a].matrixWorld,i.boneInverses[a]),e.addScaledVector(up.copy(lp).applyMatrix4(dp),r))}return e.applyMatrix4(this.bindMatrixInverse)}}class _p extends na{constructor(){super(),this.isBone=!0,this.type="Bone"}}class yp extends Xn{constructor(t=null,e=1,i=1,n,r,a,s,o,l=at,h=at,c,u){super(null,a,s,o,l,h,n,r,c,u),this.isDataTexture=!0,this.image={data:t,width:e,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const xp=new Pr,Mp=new Pr;class Sp{constructor(t=[],e=[]){this.uuid=Ki(),this.bones=t.slice(0),this.boneInverses=e,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){var t=this.bones,e=this.boneInverses;if(this.boneMatrices=new Float32Array(16*t.length),0===e.length)this.calculateInverses();else if(t.length!==e.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let t=0,e=this.bones.length;t<e;t++)this.boneInverses.push(new Pr)}}calculateInverses(){for(let t=this.boneInverses.length=0,e=this.bones.length;t<e;t++){const i=new Pr;this.bones[t]&&i.copy(this.bones[t].matrixWorld).invert(),this.boneInverses.push(i)}}pose(){for(let t=0,e=this.bones.length;t<e;t++){const i=this.bones[t];i&&i.matrixWorld.copy(this.boneInverses[t]).invert()}for(let t=0,e=this.bones.length;t<e;t++){const n=this.bones[t];n&&(n.parent&&n.parent.isBone?(n.matrix.copy(n.parent.matrixWorld).invert(),n.matrix.multiply(n.matrixWorld)):n.matrix.copy(n.matrixWorld),n.matrix.decompose(n.position,n.quaternion,n.scale))}}update(){var i=this.bones,n=this.boneInverses,r=this.boneMatrices;const t=this.boneTexture;for(let t=0,e=i.length;t<e;t++){var a=i[t]?i[t].matrixWorld:Mp;xp.multiplyMatrices(a,n[t]),xp.toArray(r,16*t)}null!==t&&(t.needsUpdate=!0)}clone(){return new Sp(this.bones,this.boneInverses)}computeBoneTexture(){var t=Math.sqrt(4*this.bones.length),t=4*Math.ceil(t/4);t=Math.max(t,4);const e=new Float32Array(t*t*4);e.set(this.boneMatrices);const i=new yp(e,t,t,ut,ct);return i.needsUpdate=!0,this.boneMatrices=e,this.boneTexture=i,this}getBoneByName(i){for(let t=0,e=this.bones.length;t<e;t++){var n=this.bones[t];if(n.name===i)return n}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(i,n){this.uuid=i.uuid;for(let e=0,t=i.bones.length;e<t;e++){var r=i.bones[e];let t=n[r];void 0===t&&(console.warn("THREE.Skeleton: No bone found with UUID:",r),t=new _p),this.bones.push(t),this.boneInverses.push((new Pr).fromArray(i.boneInverses[e]))}return this.init(),this}toJSON(){const i={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};i.uuid=this.uuid;var n=this.bones,r=this.boneInverses;for(let t=0,e=n.length;t<e;t++){var a=n[t];i.bones.push(a.uuid);const s=r[t];i.boneInverses.push(s.toArray())}return i}}class bp extends Ia{constructor(t,e,i,n=1){super(t,e,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=n}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){const t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}const wp=new Pr,Tp=new Pr,Ep=[],Ap=new nr,Cp=new Pr,Rp=new ds,Pp=new Mr;class Ip extends ds{constructor(t,e,i){super(t,e),this.isInstancedMesh=!0,this.instanceMatrix=new bp(new Float32Array(16*i),16),this.instanceColor=null,this.morphTexture=null,this.count=i,this.boundingBox=null,this.boundingSphere=null;for(let t=0;t<i;t++)this.setMatrixAt(t,Cp)}computeBoundingBox(){const e=this.geometry;var i=this.count;null===this.boundingBox&&(this.boundingBox=new nr),null===e.boundingBox&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let t=0;t<i;t++)this.getMatrixAt(t,wp),Ap.copy(e.boundingBox).applyMatrix4(wp),this.boundingBox.union(Ap)}computeBoundingSphere(){const e=this.geometry;var i=this.count;null===this.boundingSphere&&(this.boundingSphere=new Mr),null===e.boundingSphere&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let t=0;t<i;t++)this.getMatrixAt(t,wp),Pp.copy(e.boundingSphere).applyMatrix4(wp),this.boundingSphere.union(Pp)}copy(t,e){return super.copy(t,e),this.instanceMatrix.copy(t.instanceMatrix),null!==t.morphTexture&&(this.morphTexture=t.morphTexture.clone()),null!==t.instanceColor&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this}getColorAt(t,e){e.fromArray(this.instanceColor.array,3*t)}getMatrixAt(t,e){e.fromArray(this.instanceMatrix.array,16*t)}getMorphAt(t,e){const i=e.morphTargetInfluences;var n=this.morphTexture.source.data.data,r,a=t*(i.length+1)+1;for(let t=0;t<i.length;t++)i[t]=n[a+t]}raycast(t,n){var e=this.matrixWorld,r=this.count;if(Rp.geometry=this.geometry,Rp.material=this.material,void 0!==Rp.material&&(null===this.boundingSphere&&this.computeBoundingSphere(),Pp.copy(this.boundingSphere),Pp.applyMatrix4(e),!1!==t.ray.intersectsSphere(Pp)))for(let i=0;i<r;i++){this.getMatrixAt(i,wp),Tp.multiplyMatrices(e,wp),Rp.matrixWorld=Tp,Rp.raycast(t,Ep);for(let t=0,e=Ep.length;t<e;t++){const a=Ep[t];a.instanceId=i,a.object=this,n.push(a)}Ep.length=0}}setColorAt(t,e){null===this.instanceColor&&(this.instanceColor=new bp(new Float32Array(3*this.instanceMatrix.count).fill(1),3)),e.toArray(this.instanceColor.array,3*t)}setMatrixAt(t,e){e.toArray(this.instanceMatrix.array,16*t)}setMorphAt(t,e){var i=e.morphTargetInfluences,n=i.length+1;null===this.morphTexture&&(this.morphTexture=new yp(new Float32Array(n*this.count),n,this.count,V,ct));const r=this.morphTexture.source.data.data;let a=0;for(let t=0;t<i.length;t++)a+=i[t];var s=this.geometry.morphTargetsRelative?1:1-a,o=n*t;r[o]=s,r.set(i,1+o)}updateMorphTargets(){}dispose(){return this.dispatchEvent({type:"dispose"}),null!==this.morphTexture&&(this.morphTexture.dispose(),this.morphTexture=null),this}}function Lp(t,e){return t.z-e.z}function Up(t,e){return e.z-t.z}class Np{constructor(){this.index=0,this.pool=[],this.list=[]}push(t,e,i){const n=this.pool,r=this.list;this.index>=n.length&&n.push({start:-1,count:-1,z:-1,index:-1});const a=n[this.index];r.push(a),this.index++,a.start=t.start,a.count=t.count,a.z=e,a.index=i}reset(){this.list.length=0,this.index=0}}const Dp=new Pr,Op=new Pr,Bp=new Pr,Fp=new ya(1,1,1),zp=new Pr,kp=new xh,Vp=new nr,Gp=new Mr,Hp=new tr,Wp=new tr,Xp=new tr,jp=new Np,qp=new ds,Yp=[];function Zp(i,n,r=0){var a=n.itemSize;if(i.isInterleavedBufferAttribute||i.array.constructor!==n.array.constructor){var t=i.count;for(let e=0;e<t;e++)for(let t=0;t<a;t++)n.setComponent(e+r,t,i.getComponent(e,t))}else n.array.set(i.array,r*a);n.needsUpdate=!0}class Jp extends ds{get maxInstanceCount(){return this._maxInstanceCount}constructor(t,e,i=2*e,n){super(new Ya,n),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._drawInfo=[],this._drawRanges=[],this._reservedRanges=[],this._bounds=[],this._maxInstanceCount=t,this._maxVertexCount=e,this._maxIndexCount=i,this._geometryInitialized=!1,this._geometryCount=0,this._multiDrawCounts=new Int32Array(t),this._multiDrawStarts=new Int32Array(t),this._multiDrawCount=0,this._multiDrawInstances=null,this._visibilityChanged=!0,this._matricesTexture=null,this._indirectTexture=null,this._colorsTexture=null,this._initMatricesTexture(),this._initIndirectTexture()}_initMatricesTexture(){var t=Math.sqrt(4*this._maxInstanceCount),t=4*Math.ceil(t/4);t=Math.max(t,4);var e=new Float32Array(t*t*4),i=new yp(e,t,t,ut,ct);this._matricesTexture=i}_initIndirectTexture(){var t=Math.sqrt(this._maxInstanceCount),t=Math.ceil(t),e=new Uint32Array(t*t),i=new yp(e,t,t,ge,ue);this._indirectTexture=i}_initColorsTexture(){var t=Math.sqrt(this._maxIndexCount),t=Math.ceil(t),e=new Float32Array(t*t*4).fill(1);const i=new yp(e,t,t,ut,ct);i.colorSpace=On.workingColorSpace,this._colorsTexture=i}_initializeGeometry(t){const e=this.geometry;var i=this._maxVertexCount,n=this._maxIndexCount,r,a;if(!1===this._geometryInitialized){for(const l in t.attributes){const{array:h,itemSize:c,normalized:u}=t.getAttribute(l);var s=new h.constructor(i*c),o=new Ia(s,c,u);e.setAttribute(l,o)}null!==t.getIndex()&&(a=new(65535<i?Uint32Array:Uint16Array)(n),e.setIndex(new Ia(a,1))),this._geometryInitialized=!0}}_validateGeometry(t){const e=this.geometry;if(Boolean(t.getIndex())!==Boolean(e.getIndex()))throw new Error('BatchedMesh: All geometries must consistently have "index".');for(const r in e.attributes){if(!t.hasAttribute(r))throw new Error(`BatchedMesh: Added geometry missing "${r}". All geometries must have consistent attributes.`);var i=t.getAttribute(r),n=e.getAttribute(r);if(i.itemSize!==n.itemSize||i.normalized!==n.normalized)throw new Error("BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}setCustomSort(t){return this.customSort=t,this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new nr);var e=this._geometryCount;const i=this.boundingBox;var n=this._drawInfo,r;i.makeEmpty();for(let t=0;t<e;t++){!1!==n[t].active&&(r=n[t].geometryIndex,this.getMatrixAt(t,Dp),this.getBoundingBoxAt(r,Vp).applyMatrix4(Dp),i.union(Vp))}}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Mr);const i=this.boundingSphere;var n=this._drawInfo,r;i.makeEmpty();for(let t=0,e=n.length;t<e;t++){!1!==n[t].active&&(r=n[t].geometryIndex,this.getMatrixAt(t,Dp),this.getBoundingSphereAt(r,Gp).applyMatrix4(Dp),i.union(Gp))}}addInstance(t){if(this._drawInfo.length>=this._maxInstanceCount)throw new Error("BatchedMesh: Maximum item count reached.");this._drawInfo.push({visible:!0,active:!0,geometryIndex:t});var e=this._drawInfo.length-1;const i=this._matricesTexture;var n=i.image.data;Bp.toArray(n,16*e),i.needsUpdate=!0;const r=this._colorsTexture;return r&&(Fp.toArray(r.image.data,4*e),r.needsUpdate=!0),e}addGeometry(t,e=-1,i=-1){if(this._initializeGeometry(t),this._validateGeometry(t),this._drawInfo.length>=this._maxInstanceCount)throw new Error("BatchedMesh: Maximum item count reached.");const n={vertexStart:-1,vertexCount:-1,indexStart:-1,indexCount:-1};let r=null;const a=this._reservedRanges,s=this._drawRanges,o=this._bounds;0!==this._geometryCount&&(r=a[a.length-1]),n.vertexCount=-1===e?t.getAttribute("position").count:e,null===r?n.vertexStart=0:n.vertexStart=r.vertexStart+r.vertexCount;var l=t.getIndex(),h=null!==l;if(h&&(n.indexCount=-1===i?l.count:i,null===r?n.indexStart=0:n.indexStart=r.indexStart+r.indexCount),-1!==n.indexStart&&n.indexStart+n.indexCount>this._maxIndexCount||n.vertexStart+n.vertexCount>this._maxVertexCount)throw new Error("BatchedMesh: Reserved space request exceeds the maximum buffer size.");var c=this._geometryCount;return this._geometryCount++,a.push(n),s.push({start:h?n.indexStart:n.vertexStart,count:-1}),o.push({boxInitialized:!1,box:new nr,sphereInitialized:!1,sphere:new Mr}),this.setGeometryAt(c,t),c}setGeometryAt(t,e){if(t>=this._geometryCount)throw new Error("BatchedMesh: Maximum geometry count reached.");this._validateGeometry(e);const i=this.geometry;var n=null!==i.getIndex();const r=i.getIndex(),a=e.getIndex();var s=this._reservedRanges[t];if(n&&a.count>s.indexCount||e.attributes.position.count>s.vertexCount)throw new Error("BatchedMesh: Reserved space not large enough for provided geometry.");var o=s.vertexStart,l=s.vertexCount;for(const g in i.attributes){var h=e.getAttribute(g);const v=i.getAttribute(g);Zp(h,v,o);var c=h.itemSize;for(let t=h.count,e=l;t<e;t++){var u=o+t;for(let t=0;t<c;t++)v.setComponent(u,t,0)}v.needsUpdate=!0,v.addUpdateRange(o*c,l*c)}if(n){var d=s.indexStart;for(let t=0;t<a.count;t++)r.setX(d+t,o+a.getX(t));for(let t=a.count,e=s.indexCount;t<e;t++)r.setX(d+t,o);r.needsUpdate=!0,r.addUpdateRange(d,s.indexCount)}const p=this._bounds[t];null!==e.boundingBox?(p.box.copy(e.boundingBox),p.boxInitialized=!0):p.boxInitialized=!1,null!==e.boundingSphere?(p.sphere.copy(e.boundingSphere),p.sphereInitialized=!0):p.sphereInitialized=!1;const m=this._drawRanges[t];var f=e.getAttribute("position");return m.count=(n?a:f).count,this._visibilityChanged=!0,t}getBoundingBoxAt(t,e){if(t>=this._geometryCount)return null;const i=this._bounds[t],n=i.box;var r=this.geometry;if(!1===i.boxInitialized){n.makeEmpty();const o=r.index;var a=r.attributes.position,s=this._drawRanges[t];for(let e=s.start,t=s.start+s.count;e<t;e++){let t=e;o&&(t=o.getX(t)),n.expandByPoint(Hp.fromBufferAttribute(a,t))}i.boxInitialized=!0}return e.copy(n),e}getBoundingSphereAt(t,e){if(t>=this._geometryCount)return null;const n=this._bounds[t],r=n.sphere;var a=this.geometry;if(!1===n.sphereInitialized){r.makeEmpty(),this.getBoundingBoxAt(t,Vp),Vp.getCenter(r.center);const l=a.index;var s=a.attributes.position,o=this._drawRanges[t];let i=0;for(let e=o.start,t=o.start+o.count;e<t;e++){let t=e;l&&(t=l.getX(t)),Hp.fromBufferAttribute(s,t),i=Math.max(i,r.center.distanceToSquared(Hp))}r.radius=Math.sqrt(i),n.sphereInitialized=!0}return e.copy(r),e}setMatrixAt(t,e){var i=this._drawInfo;const n=this._matricesTexture;var r=this._matricesTexture.image.data;return t>=i.length||!1===i[t].active||(e.toArray(r,16*t),n.needsUpdate=!0),this}getMatrixAt(t,e){var i=this._drawInfo,n=this._matricesTexture.image.data;return t>=i.length||!1===i[t].active?null:e.fromArray(n,16*t)}setColorAt(t,e){null===this._colorsTexture&&this._initColorsTexture();const i=this._colorsTexture;var n=this._colorsTexture.image.data,r=this._drawInfo;return t>=r.length||!1===r[t].active||(e.toArray(n,4*t),i.needsUpdate=!0),this}getColorAt(t,e){var i=this._colorsTexture.image.data,n=this._drawInfo;return t>=n.length||!1===n[t].active?null:e.fromArray(i,4*t)}setVisibleAt(t,e){const i=this._drawInfo;return t>=i.length||!1===i[t].active||i[t].visible===e||(i[t].visible=e,this._visibilityChanged=!0),this}getVisibleAt(t){var e=this._drawInfo;return!(t>=e.length||!1===e[t].active)&&e[t].visible}raycast(e,n){var r=this._drawInfo,a=this._drawRanges,s=this.matrixWorld,t=this.geometry;qp.material=this.material,qp.geometry.index=t.index,qp.geometry.attributes=t.attributes,null===qp.geometry.boundingBox&&(qp.geometry.boundingBox=new nr),null===qp.geometry.boundingSphere&&(qp.geometry.boundingSphere=new Mr);for(let i=0,t=r.length;i<t;i++)if(r[i].visible&&r[i].active){var o=r[i].geometryIndex,l=a[o];qp.geometry.setDrawRange(l.start,l.count),this.getMatrixAt(i,qp.matrixWorld).premultiply(s),this.getBoundingBoxAt(o,qp.geometry.boundingBox),this.getBoundingSphereAt(o,qp.geometry.boundingSphere),qp.raycast(e,Yp);for(let t=0,e=Yp.length;t<e;t++){const h=Yp[t];h.object=this,h.batchId=i,n.push(h)}Yp.length=0}qp.material=null,qp.geometry.index=null,qp.geometry.attributes={},qp.geometry.setDrawRange(0,1/0)}copy(t){return super.copy(t),this.geometry=t.geometry.clone(),this.perObjectFrustumCulled=t.perObjectFrustumCulled,this.sortObjects=t.sortObjects,this.boundingBox=null!==t.boundingBox?t.boundingBox.clone():null,this.boundingSphere=null!==t.boundingSphere?t.boundingSphere.clone():null,this._drawRanges=t._drawRanges.map(t=>({...t})),this._reservedRanges=t._reservedRanges.map(t=>({...t})),this._drawInfo=t._drawInfo.map(t=>({...t})),this._bounds=t._bounds.map(t=>({boxInitialized:t.boxInitialized,box:t.box.clone(),sphereInitialized:t.sphereInitialized,sphere:t.sphere.clone()})),this._maxInstanceCount=t._maxInstanceCount,this._maxVertexCount=t._maxVertexCount,this._maxIndexCount=t._maxIndexCount,this._geometryInitialized=t._geometryInitialized,this._geometryCount=t._geometryCount,this._multiDrawCounts=t._multiDrawCounts.slice(),this._multiDrawStarts=t._multiDrawStarts.slice(),this._matricesTexture=t._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.data.slice(),null!==this._colorsTexture&&(this._colorsTexture=t._colorsTexture.clone(),this._colorsTexture.image.data=this._colorsTexture.image.data.slice()),this}dispose(){return this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this._indirectTexture.dispose(),(this._indirectTexture=null)!==this._colorsTexture&&(this._colorsTexture.dispose(),this._colorsTexture=null),this}onBeforeRender(t,e,n,r,a){if(this._visibilityChanged||this.perObjectFrustumCulled||this.sortObjects){var s=r.getIndex(),o=null===s?1:s.array.BYTES_PER_ELEMENT,l=this._drawInfo;const g=this._multiDrawStarts,v=this._multiDrawCounts;var h=this._drawRanges,c=this.perObjectFrustumCulled;const _=this._indirectTexture,y=_.image.data;c&&(zp.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse).multiply(this.matrixWorld),kp.setFromProjectionMatrix(zp,t.coordinateSystem));let i=0;if(this.sortObjects){Op.copy(this.matrixWorld).invert(),Hp.setFromMatrixPosition(n.matrixWorld).applyMatrix4(Op),Wp.set(0,0,-1).transformDirection(n.matrixWorld).transformDirection(Op);for(let e=0,t=l.length;e<t;e++)if(l[e].visible&&l[e].active){var u=l[e].geometryIndex,d;this.getMatrixAt(e,Dp),this.getBoundingSphereAt(u,Gp).applyMatrix4(Dp);let t=!1;c&&(t=!kp.intersectsSphere(Gp)),t||(d=Xp.subVectors(Gp.center,Hp).dot(Wp),jp.push(h[u],d,e))}const x=jp.list,M=this.customSort;null===M?x.sort(a.transparent?Up:Lp):M.call(this,x,n);for(let t=0,e=x.length;t<e;t++){var p=x[t];g[i]=p.start*o,v[i]=p.count,y[i]=p.index,i++}jp.reset()}else for(let e=0,t=l.length;e<t;e++)if(l[e].visible&&l[e].active){var m=l[e].geometryIndex,f;let t=!1;c&&(this.getMatrixAt(e,Dp),this.getBoundingSphereAt(m,Gp).applyMatrix4(Dp),t=!kp.intersectsSphere(Gp)),t||(f=h[m],g[i]=f.start*o,v[i]=f.count,y[i]=e,i++)}_.needsUpdate=!0,this._multiDrawCount=i,this._visibilityChanged=!1}}onBeforeShadow(t,e,i,n,r,a){this.onBeforeRender(t,null,n,r,a)}}class Kp extends Sa{constructor(t){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new ya(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.fog=t.fog,this}}const $p=new tr,Qp=new tr,tm=new Pr,em=new Rr,im=new Mr,nm=new tr,rm=new tr;class am extends na{constructor(t=new Ya,e=new Kp){super(),this.isLine=!0,this.type="Line",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}computeLineDistances(){const t=this.geometry;if(null===t.index){var i=t.attributes.position;const n=[0];for(let t=1,e=i.count;t<e;t++)$p.fromBufferAttribute(i,t-1),Qp.fromBufferAttribute(i,t),n[t]=n[t-1],n[t]+=$p.distanceTo(Qp);t.setAttribute("lineDistance",new ka(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(i,n){const t=this.geometry;var e=this.matrixWorld,r=i.params.Line.threshold,a=t.drawRange;if(null===t.boundingSphere&&t.computeBoundingSphere(),im.copy(t.boundingSphere),im.applyMatrix4(e),im.radius+=r,!1!==i.ray.intersectsSphere(im)){tm.copy(e).invert(),em.copy(i.ray).applyMatrix4(tm);var s=r/((this.scale.x+this.scale.y+this.scale.z)/3),o=s*s,l=this.isLineSegments?2:1;const b=t.index;var h,c=t.attributes.position;if(null!==b){var u=Math.max(0,a.start),d=Math.min(b.count,a.start+a.count),p,m,f;for(let t=u,e=d-1;t<e;t+=l){var g=b.getX(t),v=b.getX(t+1),_=sm(this,i,em,o,g,v);_&&n.push(_)}this.isLineLoop&&(p=b.getX(d-1),m=b.getX(u),(f=sm(this,i,em,o,p,m))&&n.push(f))}else{var y=Math.max(0,a.start),x=Math.min(c.count,a.start+a.count),M;for(let t=y,e=x-1;t<e;t+=l){var S=sm(this,i,em,o,t,t+1);S&&n.push(S)}!this.isLineLoop||(M=sm(this,i,em,o,x-1,y))&&n.push(M)}}}updateMorphTargets(){var t,e=this.geometry.morphAttributes,i=Object.keys(e);if(0<i.length){var n=e[i[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,e=n.length;t<e;t++){var r=n[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=t}}}}}function sm(t,e,i,n,r,a){var s=t.geometry.attributes.position,o;if($p.fromBufferAttribute(s,r),Qp.fromBufferAttribute(s,a),!(n<i.distanceSqToSegment($p,Qp,nm,rm))){nm.applyMatrix4(t.matrixWorld);var l=e.ray.origin.distanceTo(nm);if(!(l<e.near||l>e.far))return{distance:l,point:rm.clone().applyMatrix4(t.matrixWorld),index:r,face:null,faceIndex:null,object:t}}}const om=new tr,lm=new tr;class hm extends am{constructor(t,e){super(t,e),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const t=this.geometry;if(null===t.index){var i=t.attributes.position;const n=[];for(let t=0,e=i.count;t<e;t+=2)om.fromBufferAttribute(i,t),lm.fromBufferAttribute(i,t+1),n[t]=0===t?0:n[t-1],n[t+1]=n[t]+om.distanceTo(lm);t.setAttribute("lineDistance",new ka(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class cm extends am{constructor(t,e){super(t,e),this.isLineLoop=!0,this.type="LineLoop"}}class um extends Sa{constructor(t){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new ya(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}const dm=new Pr,pm=new Rr,mm=new Mr,fm=new tr;class gm extends na{constructor(t=new Ya,e=new um){super(),this.isPoints=!0,this.type="Points",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}raycast(i,n){const t=this.geometry;var r=this.matrixWorld,e=i.params.Points.threshold,a=t.drawRange;if(null===t.boundingSphere&&t.computeBoundingSphere(),mm.copy(t.boundingSphere),mm.applyMatrix4(r),mm.radius+=e,!1!==i.ray.intersectsSphere(mm)){dm.copy(r).invert(),pm.copy(i.ray).applyMatrix4(dm);var s=e/((this.scale.x+this.scale.y+this.scale.z)/3),o=s*s;const f=t.index;var l,h=t.attributes.position,c,u,d,p;if(null!==f)for(let t=Math.max(0,a.start),e=Math.min(f.count,a.start+a.count);t<e;t++){var m=f.getX(t);fm.fromBufferAttribute(h,m),vm(fm,m,o,r,i,n,this)}else for(let t=Math.max(0,a.start),e=Math.min(h.count,a.start+a.count);t<e;t++)fm.fromBufferAttribute(h,t),vm(fm,t,o,r,i,n,this)}}updateMorphTargets(){var t,e=this.geometry.morphAttributes,i=Object.keys(e);if(0<i.length){var n=e[i[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,e=n.length;t<e;t++){var r=n[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=t}}}}}function vm(t,e,i,n,r,a,s){var o=pm.distanceSqToPoint(t);if(o<i){const h=new tr;pm.closestPointToPoint(t,h),h.applyMatrix4(n);var l=r.ray.origin.distanceTo(h);l<r.near||l>r.far||a.push({distance:l,distanceToRay:Math.sqrt(o),point:h,index:e,face:null,object:s})}}class _m extends Xn{constructor(t,e,i,n,r,a,s,o,l){super(t,e,i,n,r,a,s,o,l),this.isVideoTexture=!0,this.minFilter=void 0!==a?a:lt,this.magFilter=void 0!==r?r:lt,this.generateMipmaps=!1;const h=this;function c(){h.needsUpdate=!0,t.requestVideoFrameCallback(c)}"requestVideoFrameCallback"in t&&t.requestVideoFrameCallback(c)}clone(){return new this.constructor(this.image).copy(this)}update(){var t=this.image,e;!1=="requestVideoFrameCallback"in t&&t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class ym extends Xn{constructor(t,e){super({width:t,height:e}),this.isFramebufferTexture=!0,this.magFilter=at,this.minFilter=at,this.generateMipmaps=!1,this.needsUpdate=!0}}class xm extends Xn{constructor(t,e,i,n,r,a,s,o,l,h,c,u){super(null,a,s,o,l,h,n,r,c,u),this.isCompressedTexture=!0,this.image={width:e,height:i},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}}class Mm extends xm{constructor(t,e,i,n,r,a){super(t,e,i,r,a),this.isCompressedArrayTexture=!0,this.image.depth=n,this.wrapR=nt,this.layerUpdates=new Set}addLayerUpdate(t){this.layerUpdates.add(t)}clearLayerUpdates(){this.layerUpdates.clear()}}class Sm extends xm{constructor(t,e,i){super(void 0,t[0].width,t[0].height,e,i,b),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=t}}class bm extends Xn{constructor(t,e,i,n,r,a,s,o,l){super(t,e,i,n,r,a,s,o,l),this.isCanvasTexture=!0,this.needsUpdate=!0}}class wm{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(t,e){var i=this.getUtoTmapping(t);return this.getPoint(i,e)}getPoints(e=5){const i=[];for(let t=0;t<=e;t++)i.push(this.getPoint(t/e));return i}getSpacedPoints(e=5){const i=[];for(let t=0;t<=e;t++)i.push(this.getPointAt(t/e));return i}getLength(){var t=this.getLengths();return t[t.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const i=[];let n,r=this.getPoint(0),a=0;i.push(0);for(let t=1;t<=e;t++)n=this.getPoint(t/e),a+=n.distanceTo(r),i.push(a),r=n;return this.cacheArcLengths=i,i}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(t,e){var i=this.getLengths();let n=0;var r=i.length;let a;a=e||t*i[r-1];let s=0,o=r-1,l;for(;s<=o;)if(n=Math.floor(s+(o-s)/2),(l=i[n]-a)<0)s=n+1;else{if(!(0<l)){o=n;break}o=n-1}if(n=o,i[n]===a)return n/(r-1);var h=i[n],c=i[n+1],u,d=(a-h)/(c-h),p;return(n+d)/(r-1)}getTangent(t,e){var i=1e-4;let n=t-i,r=t+i;n<0&&(n=0),1<r&&(r=1);var a=this.getPoint(n),s=this.getPoint(r);const o=e||new(a.isVector2?Mn:tr);return o.copy(s).sub(a).normalize(),o}getTangentAt(t,e){var i=this.getUtoTmapping(t);return this.getTangent(i,e)}computeFrenetFrames(i,t){const e=new tr,n=[],r=[],a=[],s=new tr,o=new Pr;for(let t=0;t<=i;t++){var l=t/i;n[t]=this.getTangentAt(l,new tr)}r[0]=new tr,a[0]=new tr;let h=Number.MAX_VALUE;var c=Math.abs(n[0].x),u=Math.abs(n[0].y),d=Math.abs(n[0].z),p;c<=h&&(h=c,e.set(1,0,0)),u<=h&&(h=u,e.set(0,1,0)),d<=h&&e.set(0,0,1),s.crossVectors(n[0],e).normalize(),r[0].crossVectors(n[0],s),a[0].crossVectors(n[0],r[0]);for(let t=1;t<=i;t++){r[t]=r[t-1].clone(),a[t]=a[t-1].clone(),s.crossVectors(n[t-1],n[t]),s.length()>Number.EPSILON&&(s.normalize(),p=Math.acos($i(n[t-1].dot(n[t]),-1,1)),r[t].applyMatrix4(o.makeRotationAxis(s,p))),a[t].crossVectors(n[t],r[t])}if(!0===t){let e=Math.acos($i(r[0].dot(r[i]),-1,1));e/=i,0<n[0].dot(s.crossVectors(r[0],r[i]))&&(e=-e);for(let t=1;t<=i;t++)r[t].applyMatrix4(o.makeRotationAxis(n[t],e*t)),a[t].crossVectors(n[t],r[t])}return{tangents:n,normals:r,binormals:a}}clone(){return(new this.constructor).copy(this)}copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}toJSON(){const t={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}class Tm extends wm{constructor(t=0,e=0,i=1,n=1,r=0,a=2*Math.PI,s=!1,o=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=t,this.aY=e,this.xRadius=i,this.yRadius=n,this.aStartAngle=r,this.aEndAngle=a,this.aClockwise=s,this.aRotation=o}getPoint(t,e=new Mn){const i=e;var n=2*Math.PI;let r=this.aEndAngle-this.aStartAngle;for(var a=Math.abs(r)<Number.EPSILON;r<0;)r+=n;for(;r>n;)r-=n;r<Number.EPSILON&&(r=a?0:n),!0!==this.aClockwise||a||(r===n?r=-n:r-=n);var s=this.aStartAngle+t*r,o,l,h,c;let u=this.aX+this.xRadius*Math.cos(s),d=this.aY+this.yRadius*Math.sin(s);return 0!==this.aRotation&&(o=Math.cos(this.aRotation),l=Math.sin(this.aRotation),h=u-this.aX,c=d-this.aY,u=h*o-c*l+this.aX,d=h*l+c*o+this.aY),i.set(u,d)}copy(t){return super.copy(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}toJSON(){const t=super.toJSON();return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}fromJSON(t){return super.fromJSON(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}}class Em extends Tm{constructor(t,e,i,n,r,a){super(t,e,i,i,n,r,a),this.isArcCurve=!0,this.type="ArcCurve"}}function Am(){let r=0,a=0,s=0,o=0;function h(t,e,i,n){r=t,a=i,s=-3*t+3*e-2*i-n,o=2*t-2*e+i+n}return{initCatmullRom:function(t,e,i,n,r){h(e,i,r*(i-t),r*(n-e))},initNonuniformCatmullRom:function(t,e,i,n,r,a,s){var o=(e-t)/r-(i-t)/(r+a)+(i-e)/a,l=(i-e)/a-(n-e)/(a+s)+(n-i)/s;h(e,i,o*=a,l*=a)},calc:function(t){var e=t*t,i=e*t;return r+a*t+s*e+o*i}}}const Cm=new tr,Rm=new Am,Pm=new Am,Im=new Am;class Lm extends wm{constructor(t=[],e=!1,i="centripetal",n=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=t,this.closed=e,this.curveType=i,this.tension=n}getPoint(t,e=new tr){const i=e;var n=this.points,r=n.length,a=(r-(this.closed?0:1))*t;let s=Math.floor(a),o=a-s;this.closed?s+=0<s?0:(Math.floor(Math.abs(s)/r)+1)*r:0===o&&s===r-1&&(s=r-2,o=1);let l,h;l=this.closed||0<s?n[(s-1)%r]:(Cm.subVectors(n[0],n[1]).add(n[0]),Cm);const c=n[s%r],u=n[(s+1)%r];if(h=this.closed||s+2<r?n[(s+2)%r]:(Cm.subVectors(n[r-1],n[r-2]).add(n[r-1]),Cm),"centripetal"===this.curveType||"chordal"===this.curveType){var d="chordal"===this.curveType?.5:.25;let t=Math.pow(l.distanceToSquared(c),d),e=Math.pow(c.distanceToSquared(u),d),i=Math.pow(u.distanceToSquared(h),d);e<1e-4&&(e=1),t<1e-4&&(t=e),i<1e-4&&(i=e),Rm.initNonuniformCatmullRom(l.x,c.x,u.x,h.x,t,e,i),Pm.initNonuniformCatmullRom(l.y,c.y,u.y,h.y,t,e,i),Im.initNonuniformCatmullRom(l.z,c.z,u.z,h.z,t,e,i)}else"catmullrom"===this.curveType&&(Rm.initCatmullRom(l.x,c.x,u.x,h.x,this.tension),Pm.initCatmullRom(l.y,c.y,u.y,h.y,this.tension),Im.initCatmullRom(l.z,c.z,u.z,h.z,this.tension));return i.set(Rm.calc(o),Pm.calc(o),Im.calc(o)),i}copy(i){super.copy(i),this.points=[];for(let t=0,e=i.points.length;t<e;t++){const n=i.points[t];this.points.push(n.clone())}return this.closed=i.closed,this.curveType=i.curveType,this.tension=i.tension,this}toJSON(){const i=super.toJSON();i.points=[];for(let t=0,e=this.points.length;t<e;t++){const n=this.points[t];i.points.push(n.toArray())}return i.closed=this.closed,i.curveType=this.curveType,i.tension=this.tension,i}fromJSON(i){super.fromJSON(i),this.points=[];for(let t=0,e=i.points.length;t<e;t++){var n=i.points[t];this.points.push((new tr).fromArray(n))}return this.closed=i.closed,this.curveType=i.curveType,this.tension=i.tension,this}}function Um(t,e,i,n,r){var a=.5*(n-e),s=.5*(r-i),o=t*t,l;return(2*i-2*n+a+s)*(t*o)+(-3*i+3*n-2*a-s)*o+a*t+i}function Nm(t,e){var i=1-t;return i*i*e}function Dm(t,e){return 2*(1-t)*t*e}function Om(t,e){return t*t*e}function Bm(t,e,i,n){return Nm(t,e)+Dm(t,i)+Om(t,n)}function Fm(t,e){var i=1-t;return i*i*i*e}function zm(t,e){var i=1-t;return 3*i*i*t*e}function km(t,e){return 3*(1-t)*t*t*e}function Vm(t,e){return t*t*t*e}function Gm(t,e,i,n,r){return Fm(t,e)+zm(t,i)+km(t,n)+Vm(t,r)}class Hm extends wm{constructor(t=new Mn,e=new Mn,i=new Mn,n=new Mn){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=t,this.v1=e,this.v2=i,this.v3=n}getPoint(t,e=new Mn){const i=e;var n=this.v0,r=this.v1,a=this.v2,s=this.v3;return i.set(Gm(t,n.x,r.x,a.x,s.x),Gm(t,n.y,r.y,a.y,s.y)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class Wm extends wm{constructor(t=new tr,e=new tr,i=new tr,n=new tr){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=t,this.v1=e,this.v2=i,this.v3=n}getPoint(t,e=new tr){const i=e;var n=this.v0,r=this.v1,a=this.v2,s=this.v3;return i.set(Gm(t,n.x,r.x,a.x,s.x),Gm(t,n.y,r.y,a.y,s.y),Gm(t,n.z,r.z,a.z,s.z)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class Xm extends wm{constructor(t=new Mn,e=new Mn){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=t,this.v2=e}getPoint(t,e=new Mn){const i=e;return 1===t?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(t).add(this.v1)),i}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e=new Mn){return e.subVectors(this.v2,this.v1).normalize()}getTangentAt(t,e){return this.getTangent(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class jm extends wm{constructor(t=new tr,e=new tr){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=t,this.v2=e}getPoint(t,e=new tr){const i=e;return 1===t?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(t).add(this.v1)),i}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e=new tr){return e.subVectors(this.v2,this.v1).normalize()}getTangentAt(t,e){return this.getTangent(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class qm extends wm{constructor(t=new Mn,e=new Mn,i=new Mn){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=t,this.v1=e,this.v2=i}getPoint(t,e=new Mn){const i=e;var n=this.v0,r=this.v1,a=this.v2;return i.set(Bm(t,n.x,r.x,a.x),Bm(t,n.y,r.y,a.y)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class Ym extends wm{constructor(t=new tr,e=new tr,i=new tr){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=t,this.v1=e,this.v2=i}getPoint(t,e=new tr){const i=e;var n=this.v0,r=this.v1,a=this.v2;return i.set(Bm(t,n.x,r.x,a.x),Bm(t,n.y,r.y,a.y),Bm(t,n.z,r.z,a.z)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class Zm extends wm{constructor(t=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=t}getPoint(t,e=new Mn){const i=e;var n=this.points,r=(n.length-1)*t,a=Math.floor(r),s=r-a,o=n[0===a?a:a-1],l=n[a],h=n[a>n.length-2?n.length-1:a+1],c=n[a>n.length-3?n.length-1:a+2];return i.set(Um(s,o.x,l.x,h.x,c.x),Um(s,o.y,l.y,h.y,c.y)),i}copy(i){super.copy(i),this.points=[];for(let t=0,e=i.points.length;t<e;t++){const n=i.points[t];this.points.push(n.clone())}return this}toJSON(){const i=super.toJSON();i.points=[];for(let t=0,e=this.points.length;t<e;t++){const n=this.points[t];i.points.push(n.toArray())}return i}fromJSON(i){super.fromJSON(i),this.points=[];for(let t=0,e=i.points.length;t<e;t++){var n=i.points[t];this.points.push((new Mn).fromArray(n))}return this}}var Jm=Object.freeze({__proto__:null,ArcCurve:Em,CatmullRomCurve3:Lm,CubicBezierCurve:Hm,CubicBezierCurve3:Wm,EllipseCurve:Tm,LineCurve:Xm,LineCurve3:jm,QuadraticBezierCurve:qm,QuadraticBezierCurve3:Ym,SplineCurve:Zm});class Km extends wm{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(t){this.curves.push(t)}closePath(){const t=this.curves[0].getPoint(0);var e=this.curves[this.curves.length-1].getPoint(1),i;return t.equals(e)||(i=!0===t.isVector2?"LineCurve":"LineCurve3",this.curves.push(new Jm[i](e,t))),this}getPoint(t,e){var i=t*this.getLength(),n=this.getCurveLengths();let r=0;for(;r<n.length;){if(n[r]>=i){var a=n[r]-i;const l=this.curves[r];var s=l.getLength(),o;return l.getPointAt(0===s?0:1-a/s,e)}r++}return null}getLength(){var t=this.getCurveLengths();return t[t.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const i=[];let n=0;for(let t=0,e=this.curves.length;t<e;t++)n+=this.curves[t].getLength(),i.push(n);return this.cacheLengths=i,i}getSpacedPoints(e=40){const i=[];for(let t=0;t<=e;t++)i.push(this.getPoint(t/e));return this.autoClose&&i.push(i[0]),i}getPoints(i=12){const n=[];let r;for(let t=0,e=this.curves;t<e.length;t++){const l=e[t];var a=l.isEllipseCurve?2*i:l.isLineCurve||l.isLineCurve3?1:l.isSplineCurve?i*l.points.length:i,s=l.getPoints(a);for(let t=0;t<s.length;t++){var o=s[t];r&&r.equals(o)||(n.push(o),r=o)}}return this.autoClose&&1<n.length&&!n[n.length-1].equals(n[0])&&n.push(n[0]),n}copy(i){super.copy(i),this.curves=[];for(let t=0,e=i.curves.length;t<e;t++){const n=i.curves[t];this.curves.push(n.clone())}return this.autoClose=i.autoClose,this}toJSON(){const i=super.toJSON();i.autoClose=this.autoClose,i.curves=[];for(let t=0,e=this.curves.length;t<e;t++){const n=this.curves[t];i.curves.push(n.toJSON())}return i}fromJSON(i){super.fromJSON(i),this.autoClose=i.autoClose,this.curves=[];for(let t=0,e=i.curves.length;t<e;t++){var n=i.curves[t];this.curves.push((new Jm[n.type]).fromJSON(n))}return this}}class $m extends Km{constructor(t){super(),this.type="Path",this.currentPoint=new Mn,t&&this.setFromPoints(t)}setFromPoints(i){this.moveTo(i[0].x,i[0].y);for(let t=1,e=i.length;t<e;t++)this.lineTo(i[t].x,i[t].y);return this}moveTo(t,e){return this.currentPoint.set(t,e),this}lineTo(t,e){var i=new Xm(this.currentPoint.clone(),new Mn(t,e));return this.curves.push(i),this.currentPoint.set(t,e),this}quadraticCurveTo(t,e,i,n){var r=new qm(this.currentPoint.clone(),new Mn(t,e),new Mn(i,n));return this.curves.push(r),this.currentPoint.set(i,n),this}bezierCurveTo(t,e,i,n,r,a){var s=new Hm(this.currentPoint.clone(),new Mn(t,e),new Mn(i,n),new Mn(r,a));return this.curves.push(s),this.currentPoint.set(r,a),this}splineThru(t){var e=[this.currentPoint.clone()].concat(t),i=new Zm(e);return this.curves.push(i),this.currentPoint.copy(t[t.length-1]),this}arc(t,e,i,n,r,a){var s=this.currentPoint.x,o=this.currentPoint.y;return this.absarc(t+s,e+o,i,n,r,a),this}absarc(t,e,i,n,r,a){return this.absellipse(t,e,i,i,n,r,a),this}ellipse(t,e,i,n,r,a,s,o){var l=this.currentPoint.x,h=this.currentPoint.y;return this.absellipse(t+l,e+h,i,n,r,a,s,o),this}absellipse(t,e,i,n,r,a,s,o){const l=new Tm(t,e,i,n,r,a,s,o);if(0<this.curves.length){const c=l.getPoint(0);c.equals(this.currentPoint)||this.lineTo(c.x,c.y)}this.curves.push(l);var h=l.getPoint(1);return this.currentPoint.copy(h),this}copy(t){return super.copy(t),this.currentPoint.copy(t.currentPoint),this}toJSON(){const t=super.toJSON();return t.currentPoint=this.currentPoint.toArray(),t}fromJSON(t){return super.fromJSON(t),this.currentPoint.fromArray(t.currentPoint),this}}class Qm extends Ya{constructor(i=[new Mn(0,-.5),new Mn(.5,0),new Mn(0,.5)],n=12,t=0,r=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:i,segments:n,phiStart:t,phiLength:r},n=Math.floor(n),r=$i(r,0,2*Math.PI);const a=[],s=[],o=[],l=[],h=[];var c=1/n;const u=new tr,d=new Mn,e=new tr,p=new tr,m=new tr;let f=0,g=0;for(let t=0;t<=i.length-1;t++)switch(t){case 0:f=i[t+1].x-i[t].x,g=i[t+1].y-i[t].y,e.x=+g,e.y=-f,e.z=0*g,m.copy(e),e.normalize(),l.push(e.x,e.y,e.z);break;case i.length-1:l.push(m.x,m.y,m.z);break;default:f=i[t+1].x-i[t].x,g=i[t+1].y-i[t].y,e.x=+g,e.y=-f,e.z=0*g,p.copy(e),e.x+=m.x,e.y+=m.y,e.z+=m.z,e.normalize(),l.push(e.x,e.y,e.z),m.copy(p)}for(let e=0;e<=n;e++){var v=t+e*c*r,_=Math.sin(v),y=Math.cos(v);for(let t=0;t<=i.length-1;t++){u.x=i[t].x*_,u.y=i[t].y,u.z=i[t].x*y,s.push(u.x,u.y,u.z),d.x=e/n,d.y=t/(i.length-1),o.push(d.x,d.y);var x=l[3*t+0]*_,M=l[3*t+1],S=l[3*t+0]*y;h.push(x,M,S)}}for(let e=0;e<n;e++)for(let t=0;t<i.length-1;t++){var b=t+e*i.length,w,T=b+i.length,E=b+i.length+1,A=b+1;a.push(b,T,A),a.push(E,A,T)}this.setIndex(a),this.setAttribute("position",new ka(s,3)),this.setAttribute("uv",new ka(o,2)),this.setAttribute("normal",new ka(h,3))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Qm(t.points,t.segments,t.phiStart,t.phiLength)}}class tf extends Qm{constructor(t=1,e=1,i=4,n=8){const r=new $m;r.absarc(0,-e/2,t,1.5*Math.PI,0),r.absarc(0,e/2,t,0,.5*Math.PI),super(r.getPoints(i),n),this.type="CapsuleGeometry",this.parameters={radius:t,length:e,capSegments:i,radialSegments:n}}static fromJSON(t){return new tf(t.radius,t.length,t.capSegments,t.radialSegments)}}class ef extends Ya{constructor(i=1,n=32,r=0,a=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:i,segments:n,thetaStart:r,thetaLength:a},n=Math.max(3,n);const e=[],s=[],o=[],l=[],h=new tr,c=new Mn;s.push(0,0,0),o.push(0,0,1),l.push(.5,.5);for(let t=0,e=3;t<=n;t++,e+=3){var u=r+t/n*a;h.x=i*Math.cos(u),h.y=i*Math.sin(u),s.push(h.x,h.y,h.z),o.push(0,0,1),c.x=(s[e]/i+1)/2,c.y=(s[e+1]/i+1)/2,l.push(c.x,c.y)}for(let t=1;t<=n;t++)e.push(t,t+1,0);this.setIndex(e),this.setAttribute("position",new ka(s,3)),this.setAttribute("normal",new ka(o,3)),this.setAttribute("uv",new ka(l,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new ef(t.radius,t.segments,t.thetaStart,t.thetaLength)}}class nf extends Ya{constructor(g=1,v=1,_=1,y=32,x=1,t=!1,M=0,S=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:g,radiusBottom:v,height:_,radialSegments:y,heightSegments:x,openEnded:t,thetaStart:M,thetaLength:S};const b=this;y=Math.floor(y),x=Math.floor(x);const w=[],T=[],E=[],A=[];let C=0;const R=[],P=_/2;let I=0;function e(){const e=new tr,i=new tr;let n=0;var r=(v-g)/_;for(let t=0;t<=x;t++){const f=[];var a=t/x,s=a*(v-g)+g;for(let t=0;t<=y;t++){var o=t/y,l=o*S+M,h=Math.sin(l),c=Math.cos(l);i.x=s*h,i.y=-a*_+P,i.z=s*c,T.push(i.x,i.y,i.z),e.set(h,r,c).normalize(),E.push(e.x,e.y,e.z),A.push(o,1-a),f.push(C++)}R.push(f)}for(let e=0;e<y;e++)for(let t=0;t<x;t++){var u=R[t][e],d=R[t+1][e],p=R[t+1][e+1],m=R[t][e+1];w.push(u,d,m),w.push(d,p,m),n+=6}b.addGroup(I,n,0),I+=n}function i(e){var i=C;const n=new Mn,r=new tr;let a=0;var s=!0===e?g:v,o=!0===e?1:-1;for(let t=1;t<=y;t++)T.push(0,P*o,0),E.push(0,o,0),A.push(.5,.5),C++;var l=C;for(let t=0;t<=y;t++){var h,c=t/y*S+M,u=Math.cos(c),d=Math.sin(c);r.x=s*d,r.y=P*o,r.z=s*u,T.push(r.x,r.y,r.z),E.push(0,o,0),n.x=.5*u+.5,n.y=.5*d*o+.5,A.push(n.x,n.y),C++}for(let t=0;t<y;t++){var p=i+t,m=l+t;!0===e?w.push(m,m+1,p):w.push(m+1,m,p),a+=3}b.addGroup(I,a,!0===e?1:2),I+=a}e(),!1===t&&(0<g&&i(!0),0<v&&i(!1)),this.setIndex(w),this.setAttribute("position",new ka(T,3)),this.setAttribute("normal",new ka(E,3)),this.setAttribute("uv",new ka(A,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new nf(t.radiusTop,t.radiusBottom,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class rf extends nf{constructor(t=1,e=1,i=32,n=1,r=!1,a=0,s=2*Math.PI){super(0,t,e,i,n,r,a,s),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:i,heightSegments:n,openEnded:r,thetaStart:a,thetaLength:s}}static fromJSON(t){return new rf(t.radius,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class af extends Ya{constructor(n=[],a=[],t=1,e=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:n,indices:a,radius:t,detail:e};const c=[],u=[];function i(e){var i=new tr,n=new tr,r=new tr;for(let t=0;t<a.length;t+=3)h(a[t+0],i),h(a[t+1],n),h(a[t+2],r),s(i,n,r,e)}function s(t,i,n,e){var r=e+1;const a=[];for(let e=0;e<=r;e++){a[e]=[];const h=t.clone().lerp(n,e/r);var s=i.clone().lerp(n,e/r),o=r-e;for(let t=0;t<=o;t++)0===t&&e===r?a[e][t]=h:a[e][t]=h.clone().lerp(s,t/o)}for(let e=0;e<r;e++)for(let t=0;t<2*(r-e)-1;t++){var l=Math.floor(t/2);t%2==0?(d(a[e][l+1]),d(a[e+1][l]),d(a[e][l])):(d(a[e][l+1]),d(a[e+1][l+1]),d(a[e+1][l]))}}function r(e){const i=new tr;for(let t=0;t<c.length;t+=3)i.x=c[t+0],i.y=c[t+1],i.z=c[t+2],i.normalize().multiplyScalar(e),c[t+0]=i.x,c[t+1]=i.y,c[t+2]=i.z}function o(){const e=new tr;for(let t=0;t<c.length;t+=3){e.x=c[t+0],e.y=c[t+1],e.z=c[t+2];var i=f(e)/2/Math.PI+.5,n=g(e)/Math.PI+.5;u.push(i,1-n)}p(),l()}function l(){for(let t=0;t<u.length;t+=6){var e=u[t+0],i=u[t+2],n=u[t+4],r=Math.max(e,i,n),a=Math.min(e,i,n);.9<r&&a<.1&&(e<.2&&(u[t+0]+=1),i<.2&&(u[t+2]+=1),n<.2&&(u[t+4]+=1))}}function d(t){c.push(t.x,t.y,t.z)}function h(t,e){var i=3*t;e.x=n[0+i],e.y=n[1+i],e.z=n[2+i]}function p(){const i=new tr,n=new tr,r=new tr,a=new tr,s=new Mn,o=new Mn,l=new Mn;for(let t=0,e=0;t<c.length;t+=9,e+=6){i.set(c[t+0],c[t+1],c[t+2]),n.set(c[t+3],c[t+4],c[t+5]),r.set(c[t+6],c[t+7],c[t+8]),s.set(u[e+0],u[e+1]),o.set(u[e+2],u[e+3]),l.set(u[e+4],u[e+5]),a.copy(i).add(n).add(r).divideScalar(3);var h=f(a);m(s,e+0,i,h),m(o,e+2,n,h),m(l,e+4,r,h)}}function m(t,e,i,n){n<0&&1===t.x&&(u[e]=t.x-1),0===i.x&&0===i.z&&(u[e]=n/2/Math.PI+.5)}function f(t){return Math.atan2(t.z,-t.x)}function g(t){return Math.atan2(-t.y,Math.sqrt(t.x*t.x+t.z*t.z))}i(e),r(t),o(),this.setAttribute("position",new ka(c,3)),this.setAttribute("normal",new ka(c.slice(),3)),this.setAttribute("uv",new ka(u,2)),0===e?this.computeVertexNormals():this.normalizeNormals()}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new af(t.vertices,t.indices,t.radius,t.details)}}class sf extends af{constructor(t=1,e=0){var i=(1+Math.sqrt(5))/2,n=1/i,r,a;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-i,0,-n,i,0,n,-i,0,n,i,-n,-i,0,-n,i,0,n,-i,0,n,i,0,-i,0,-n,i,0,-n,-i,0,n,i,0,n],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],t,e),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new sf(t.radius,t.detail)}}const of=new tr,lf=new tr,hf=new tr,cf=new ma;class uf extends Ya{constructor(t=null,e=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:t,thresholdAngle:e},null!==t){var i=4,n=Math.pow(10,4),r=Math.cos(Zi*e);const v=t.getIndex();var a=t.getAttribute("position"),s=(v||a).count;const _=[0,0,0];var o=["a","b","c"],l,h;const y=new Array(3),x={},M=[];for(let t=0;t<s;t+=3){v?(_[0]=v.getX(t),_[1]=v.getX(t+1),_[2]=v.getX(t+2)):(_[0]=t,_[1]=t+1,_[2]=t+2);const{a:S,b,c:w}=cf;if(S.fromBufferAttribute(a,_[0]),b.fromBufferAttribute(a,_[1]),w.fromBufferAttribute(a,_[2]),cf.getNormal(hf),y[0]=`${Math.round(S.x*n)},${Math.round(S.y*n)},`+Math.round(S.z*n),y[1]=`${Math.round(b.x*n)},${Math.round(b.y*n)},`+Math.round(b.z*n),y[2]=`${Math.round(w.x*n)},${Math.round(w.y*n)},`+Math.round(w.z*n),y[0]!==y[1]&&y[1]!==y[2]&&y[2]!==y[0])for(let t=0;t<3;t++){var c=(t+1)%3,u=y[t],d=y[c],p=cf[o[t]],m=cf[o[c]],f=u+"_"+d,g=d+"_"+u;g in x&&x[g]?(hf.dot(x[g].normal)<=r&&(M.push(p.x,p.y,p.z),M.push(m.x,m.y,m.z)),x[g]=null):f in x||(x[f]={index0:_[t],index1:_[c],normal:hf.clone()})}}for(const T in x){x[T]&&({index0:l,index1:h}=x[T],of.fromBufferAttribute(a,l),lf.fromBufferAttribute(a,h),M.push(of.x,of.y,of.z),M.push(lf.x,lf.y,lf.z))}this.setAttribute("position",new ka(M,3))}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}}class df extends $m{constructor(t){super(t),this.uuid=Ki(),this.type="Shape",this.holes=[]}getPointsHoles(i){const n=[];for(let t=0,e=this.holes.length;t<e;t++)n[t]=this.holes[t].getPoints(i);return n}extractPoints(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}}copy(i){super.copy(i),this.holes=[];for(let t=0,e=i.holes.length;t<e;t++){const n=i.holes[t];this.holes.push(n.clone())}return this}toJSON(){const i=super.toJSON();i.uuid=this.uuid,i.holes=[];for(let t=0,e=this.holes.length;t<e;t++){const n=this.holes[t];i.holes.push(n.toJSON())}return i}fromJSON(i){super.fromJSON(i),this.uuid=i.uuid,this.holes=[];for(let t=0,e=i.holes.length;t<e;t++){var n=i.holes[t];this.holes.push((new $m).fromJSON(n))}return this}}const pf={triangulate:function(e,t,i=2){var n=t&&t.length,r=n?t[0]*i:e.length;let a=mf(e,0,r,i,!0);var s=[];if(!a||a.next===a.prev)return s;let o,l,h,c,u,d,p;if(n&&(a=Mf(e,t,a,i)),e.length>80*i){o=h=e[0],l=c=e[1];for(let t=i;t<r;t+=i)u=e[t],d=e[t+1],u<o&&(o=u),d<l&&(l=d),u>h&&(h=u),d>c&&(c=d);p=Math.max(h-o,c-l),p=0!==p?32767/p:0}return gf(a,s,i,o,l,p,0),s}};function mf(t,e,i,n,r){let a,s;if(r===0<Wf(t,e,i,n))for(a=e;a<i;a+=n)s=Vf(a,t[a],t[a+1],s);else for(a=i-n;a>=e;a-=n)s=Vf(a,t[a],t[a+1],s);return s&&Uf(s,s.next)&&(Gf(s),s=s.next),s}function ff(t,e){if(!t)return t;e=e||t;let i=t,n;do{if(n=!1,i.steiner||!Uf(i,i.next)&&0!==Lf(i.prev,i,i.next))i=i.next;else{if(Gf(i),i=e=i.prev,i===i.next)break;n=!0}}while(n||i!==e);return e}function gf(n,r,a,s,o,l,h){if(n){!h&&l&&Ef(n,s,o,l);let t=n,e,i;for(;n.prev!==n.next;)if(e=n.prev,i=n.next,l?_f(n,s,o,l):vf(n))r.push(e.i/a|0),r.push(n.i/a|0),r.push(i.i/a|0),Gf(n),n=i.next,t=i.next;else if((n=i)===t){h?1===h?gf(n=yf(ff(n),r,a),r,a,s,o,l,2):2===h&&xf(n,r,a,s,o,l):gf(ff(n),r,a,s,o,l,1);break}}}function vf(t){var e=t.prev,i=t,n=t.next;if(!(0<=Lf(e,i,n))){var r=e.x,a=i.x,s=n.x,o=e.y,l=i.y,h=n.y,c=r<a?r<s?r:s:a<s?a:s,u=o<l?o<h?o:h:l<h?l:h,d=a<r?s<r?r:s:s<a?a:s,p=l<o?h<o?o:h:h<l?l:h;let t=n.next;for(;t!==e;){if(t.x>=c&&t.x<=d&&t.y>=u&&t.y<=p&&Pf(r,o,a,l,s,h,t.x,t.y)&&0<=Lf(t.prev,t,t.next))return;t=t.next}return 1}}function _f(i,n,r,a){var s=i.prev,o=i,l=i.next;if(!(0<=Lf(s,o,l))){var h=s.x,c=o.x,u=l.x,d=s.y,p=o.y,m=l.y,f=h<c?h<u?h:u:c<u?c:u,g=d<p?d<m?d:m:p<m?p:m,v=c<h?u<h?h:u:u<c?c:u,_=p<d?m<d?d:m:m<p?p:m,y=Cf(f,g,n,r,a),x=Cf(v,_,n,r,a);let t=i.prevZ,e=i.nextZ;for(;t&&t.z>=y&&e&&e.z<=x;){if(t.x>=f&&t.x<=v&&t.y>=g&&t.y<=_&&t!==s&&t!==l&&Pf(h,d,c,p,u,m,t.x,t.y)&&0<=Lf(t.prev,t,t.next))return;if(t=t.prevZ,e.x>=f&&e.x<=v&&e.y>=g&&e.y<=_&&e!==s&&e!==l&&Pf(h,d,c,p,u,m,e.x,e.y)&&0<=Lf(e.prev,e,e.next))return;e=e.nextZ}for(;t&&t.z>=y;){if(t.x>=f&&t.x<=v&&t.y>=g&&t.y<=_&&t!==s&&t!==l&&Pf(h,d,c,p,u,m,t.x,t.y)&&0<=Lf(t.prev,t,t.next))return;t=t.prevZ}for(;e&&e.z<=x;){if(e.x>=f&&e.x<=v&&e.y>=g&&e.y<=_&&e!==s&&e!==l&&Pf(h,d,c,p,u,m,e.x,e.y)&&0<=Lf(e.prev,e,e.next))return;e=e.nextZ}return 1}}function yf(t,e,i){let n=t;do{var r=n.prev,a=n.next.next;!Uf(r,a)&&Nf(r,n,n.next,a)&&Ff(r,a)&&Ff(a,r)&&(e.push(r.i/i|0),e.push(n.i/i|0),e.push(a.i/i|0),Gf(n),Gf(n.next),n=t=a),n=n.next}while(n!==t);return ff(n)}function xf(t,e,i,n,r,a){let s=t;do{let t=s.next.next;for(;t!==s.prev;){if(s.i!==t.i&&If(s,t)){var o=kf(s,t);return s=ff(s,s.next),o=ff(o,o.next),gf(s,e,i,n,r,a,0),void gf(o,e,i,n,r,a,0)}t=t.next}}while(s=s.next,s!==t)}function Mf(t,e,i,n){const r=[];let a,s,o,l,h;for(a=0,s=e.length;a<s;a++)o=e[a]*n,l=a<s-1?e[a+1]*n:t.length,h=mf(t,o,l,n,!1),h===h.next&&(h.steiner=!0),r.push(Rf(h));for(r.sort(Sf),a=0;a<r.length;a++)i=bf(r[a],i);return i}function Sf(t,e){return t.x-e.x}function bf(t,e){var i=wf(t,e);if(!i)return e;var n=kf(i,t);return ff(n,n.next),ff(i,i.next)}function wf(t,e){let i=e,n=-1/0,r;var a=t.x,s=t.y;do{if(s<=i.y&&s>=i.next.y&&i.next.y!==i.y){var o=i.x+(s-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(o<=a&&o>n&&(n=o,r=i.x<i.next.x?i:i.next,o===a))return r}}while(i=i.next,i!==e);if(!r)return null;var l=r,h=r.x,c=r.y;let u=1/0,d;for(i=r;a>=i.x&&i.x>=h&&a!==i.x&&Pf(s<c?a:n,s,h,c,s<c?n:a,s,i.x,i.y)&&(d=Math.abs(s-i.y)/(a-i.x),Ff(i,t)&&(d<u||d===u&&(i.x>r.x||i.x===r.x&&Tf(r,i)))&&(r=i,u=d)),i=i.next,i!==l;);return r}function Tf(t,e){return Lf(t.prev,t,e.prev)<0&&Lf(e.next,t,t.next)<0}function Ef(t,e,i,n){let r=t;for(;0===r.z&&(r.z=Cf(r.x,r.y,e,i,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next,r!==t;);r.prevZ.nextZ=null,r.prevZ=null,Af(r)}function Af(t){let e,i,n,r,a,s,o,l,h=1;do{for(i=t,t=null,a=null,s=0;i;){for(s++,n=i,o=0,e=0;e<h&&(o++,n=n.nextZ,n);e++);for(l=h;0<o||0<l&&n;)0!==o&&(0===l||!n||i.z<=n.z)?(r=i,i=i.nextZ,o--):(r=n,n=n.nextZ,l--),a?a.nextZ=r:t=r,r.prevZ=a,a=r;i=n}}while(a.nextZ=null,h*=2,1<s);return t}function Cf(t,e,i,n,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*r|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*r|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Rf(t){let e=t,i=t;for(;(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next,e!==t;);return i}function Pf(t,e,i,n,r,a,s,o){return(t-s)*(a-o)<=(r-s)*(e-o)&&(i-s)*(e-o)<=(t-s)*(n-o)&&(r-s)*(n-o)<=(i-s)*(a-o)}function If(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!Bf(t,e)&&(Ff(t,e)&&Ff(e,t)&&zf(t,e)&&(Lf(t.prev,t,e.prev)||Lf(t,e.prev,e))||Uf(t,e)&&0<Lf(t.prev,t,t.next)&&0<Lf(e.prev,e,e.next))}function Lf(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function Uf(t,e){return t.x===e.x&&t.y===e.y}function Nf(t,e,i,n){var r=Of(Lf(t,e,i)),a=Of(Lf(t,e,n)),s=Of(Lf(i,n,t)),o=Of(Lf(i,n,e));return r!==a&&s!==o||(0===r&&Df(t,i,e)||(0===a&&Df(t,n,e)||(0===s&&Df(i,t,n)||!(0!==o||!Df(i,e,n)))))}function Df(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function Of(t){return 0<t?1:t<0?-1:0}function Bf(t,e){let i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&Nf(i,i.next,t,e))return 1}while(i=i.next,i!==t)}function Ff(t,e){return Lf(t.prev,t,t.next)<0?0<=Lf(t,e,t.next)&&0<=Lf(t,t.prev,e):Lf(t,e,t.prev)<0||Lf(t,t.next,e)<0}function zf(t,e){let i=t,n=!1;for(var r=(t.x+e.x)/2,a=(t.y+e.y)/2;i.y>a!=i.next.y>a&&i.next.y!==i.y&&r<(i.next.x-i.x)*(a-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next,i!==t;);return n}function kf(t,e){const i=new Hf(t.i,t.x,t.y),n=new Hf(e.i,e.x,e.y),r=t.next,a=e.prev;return(t.next=e).prev=t,i.next=r,r.prev=i,n.next=i,i.prev=n,a.next=n,n.prev=a,n}function Vf(t,e,i,n){const r=new Hf(t,e,i);return n?(r.next=n.next,(r.prev=n).next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function Gf(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Hf(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Wf(i,n,r,a){let s=0;for(let t=n,e=r-a;t<r;t+=a)s+=(i[e]-i[t])*(i[t+1]+i[e+1]),e=t;return s}class Xf{static area(i){var n=i.length;let r=0;for(let t=n-1,e=0;e<n;t=e++)r+=i[t].x*i[e].y-i[e].x*i[t].y;return.5*r}static isClockWise(t){return Xf.area(t)<0}static triangulateShape(t,e){var i=[];const n=[],r=[];jf(t),qf(i,t);let a=t.length;e.forEach(jf);for(let t=0;t<e.length;t++)n.push(a),a+=e[t].length,qf(i,e[t]);const s=pf.triangulate(i,n);for(let t=0;t<s.length;t+=3)r.push(s.slice(t,t+3));return r}}function jf(t){var e=t.length;2<e&&t[e-1].equals(t[0])&&t.pop()}function qf(e,i){for(let t=0;t<i.length;t++)e.push(i[t].x),e.push(i[t].y)}class Yf extends Ya{constructor(i=new df([new Mn(.5,.5),new Mn(-.5,.5),new Mn(-.5,-.5),new Mn(.5,-.5)]),it={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:i,options:it},i=Array.isArray(i)?i:[i];const nt=this,rt=[],at=[];for(let t=0,e=i.length;t<e;t++){var n;r(i[t])}function r(t){const n=[];var e=void 0!==it.curveSegments?it.curveSegments:12;const u=void 0!==it.steps?it.steps:1;var i=void 0!==it.depth?it.depth:1;let s=void 0===it.bevelEnabled||it.bevelEnabled,r=void 0!==it.bevelThickness?it.bevelThickness:.2,a=void 0!==it.bevelSize?it.bevelSize:r-.1,o=void 0!==it.bevelOffset?it.bevelOffset:0,d=void 0!==it.bevelSegments?it.bevelSegments:3;const l=it.extrudePath,h=void 0!==it.UVGenerator?it.UVGenerator:Zf;let c,p=!1,m,f,g,v;l&&(c=l.getSpacedPoints(u),p=!0,s=!1,m=l.computeFrenetFrames(u,!1),f=new tr,g=new tr,v=new tr),s||(d=0,r=0,a=0,o=0);var _=t.extractPoints(e),y;let x=_.shape;const M=_.holes;if(!Xf.isClockWise(x)){x=x.reverse();for(let t=0,e=M.length;t<e;t++){const et=M[t];Xf.isClockWise(et)&&(M[t]=et.reverse())}}const S=Xf.triangulateShape(x,M),b=x;for(let t=0,e=M.length;t<e;t++){var w=M[t];x=x.concat(w)}function T(t,e,i){return e||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().addScaledVector(e,i)}const E=x.length,A=S.length;function C(t,e,i){let n,r,a;var s=t.x-e.x,o=t.y-e.y,l=i.x-t.x,h=i.y-t.y,c=s*s+o*o,u;if(Math.abs(s*h-o*l)>Number.EPSILON){var d=Math.sqrt(c),p=Math.sqrt(l*l+h*h),m=e.x-o/d,f=e.y+s/d,g,v,_=((i.x-h/p-m)*h-(i.y+l/p-f)*l)/(s*h-o*l);n=m+s*_-t.x,r=f+o*_-t.y;var y=n*n+r*r;if(y<=2)return new Mn(n,r);a=Math.sqrt(y/2)}else{let t=!1;s>Number.EPSILON?l>Number.EPSILON&&(t=!0):s<-Number.EPSILON?l<-Number.EPSILON&&(t=!0):Math.sign(o)===Math.sign(h)&&(t=!0),a=t?(n=-o,r=s,Math.sqrt(c)):(n=s,r=o,Math.sqrt(c/2))}return new Mn(n/a,r/a)}const R=[];for(let t=0,e=b.length,i=e-1,n=t+1;t<e;t++,i++,n++)i===e&&(i=0),n===e&&(n=0),R[t]=C(b[t],b[i],b[n]);const P=[];let I,L=R.concat();for(let t=0,e=M.length;t<e;t++){var U=M[t];I=[];for(let t=0,e=U.length,i=e-1,n=t+1;t<e;t++,i++,n++)i===e&&(i=0),n===e&&(n=0),I[t]=C(U[t],U[i],U[n]);P.push(I),L=L.concat(I)}for(let t=0;t<d;t++){var N=t/d,D=r*Math.cos(N*Math.PI/2);const z=a*Math.sin(N*Math.PI/2)+o;for(let t=0,e=b.length;t<e;t++){var O=T(b[t],R[t],z);J(O.x,O.y,-D)}for(let t=0,e=M.length;t<e;t++){var B=M[t];I=P[t];for(let t=0,e=B.length;t<e;t++){var F=T(B[t],I[t],z);J(F.x,F.y,-D)}}}const z=a+o;for(let t=0;t<E;t++){var k=s?T(x[t],L[t],z):x[t];p?(g.copy(m.normals[0]).multiplyScalar(k.x),f.copy(m.binormals[0]).multiplyScalar(k.y),v.copy(c[0]).add(g).add(f),J(v.x,v.y,v.z)):J(k.x,k.y,0)}for(let e=1;e<=u;e++)for(let t=0;t<E;t++){var V=s?T(x[t],L[t],z):x[t];p?(g.copy(m.normals[e]).multiplyScalar(V.x),f.copy(m.binormals[e]).multiplyScalar(V.y),v.copy(c[e]).add(g).add(f),J(v.x,v.y,v.z)):J(V.x,V.y,i/u*e)}for(let t=d-1;0<=t;t--){var G=t/d,H=r*Math.cos(G*Math.PI/2);const z=a*Math.sin(G*Math.PI/2)+o;for(let t=0,e=b.length;t<e;t++){var W=T(b[t],R[t],z);J(W.x,W.y,i+H)}for(let t=0,e=M.length;t<e;t++){var X=M[t];I=P[t];for(let t=0,e=X.length;t<e;t++){var j=T(X[t],I[t],z);p?J(j.x,j.y+c[u-1].y,c[u-1].x+H):J(j.x,j.y,i+H)}}}function q(){var t=rt.length/3;if(s){var i=0;let e=0*E;for(let t=0;t<A;t++){var n=S[t];K(n[2]+e,n[1]+e,n[0]+e)}i=u+2*d,e=E*i;for(let t=0;t<A;t++){var r=S[t];K(r[0]+e,r[1]+e,r[2]+e)}}else{for(let t=0;t<A;t++){var e=S[t];K(e[2],e[1],e[0])}for(let t=0;t<A;t++){var a=S[t];K(a[0]+E*u,a[1]+E*u,a[2]+E*u)}}nt.addGroup(t,rt.length/3-t,0)}function Y(){var t=rt.length/3;let i=0;Z(b,i),i+=b.length;for(let t=0,e=M.length;t<e;t++){var n=M[t];Z(n,i),i+=n.length}nt.addGroup(t,rt.length/3-t,1)}function Z(t,n){let e=t.length;for(;0<=--e;){var r=e;let i=e-1;i<0&&(i=t.length-1);for(let t=0,e=u+2*d;t<e;t++){var a=E*t,s=E*(t+1),o,l,h,c;$(n+r+a,n+i+a,n+i+s,n+r+s)}}}function J(t,e,i){n.push(t),n.push(e),n.push(i)}function K(t,e,i){Q(t),Q(e),Q(i);var n=rt.length/3,r=h.generateTopUV(nt,rt,n-3,n-2,n-1);tt(r[0]),tt(r[1]),tt(r[2])}function $(t,e,i,n){Q(t),Q(e),Q(n),Q(e),Q(i),Q(n);var r=rt.length/3,a=h.generateSideWallUV(nt,rt,r-6,r-3,r-2,r-1);tt(a[0]),tt(a[1]),tt(a[3]),tt(a[1]),tt(a[2]),tt(a[3])}function Q(t){rt.push(n[3*t+0]),rt.push(n[3*t+1]),rt.push(n[3*t+2])}function tt(t){at.push(t.x),at.push(t.y)}q(),Y()}this.setAttribute("position",new ka(rt,3)),this.setAttribute("uv",new ka(at,2)),this.computeVertexNormals()}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){var t=super.toJSON(),e,i;return Jf(this.parameters.shapes,this.parameters.options,t)}static fromJSON(i,n){const r=[];for(let t=0,e=i.shapes.length;t<e;t++){var a=n[i.shapes[t]];r.push(a)}var t=i.options.extrudePath;return void 0!==t&&(i.options.extrudePath=(new Jm[t.type]).fromJSON(t)),new Yf(r,i.options)}}const Zf={generateTopUV:function(t,e,i,n,r){var a=e[3*i],s=e[3*i+1],o=e[3*n],l=e[3*n+1],h=e[3*r],c=e[3*r+1];return[new Mn(a,s),new Mn(o,l),new Mn(h,c)]},generateSideWallUV:function(t,e,i,n,r,a){var s=e[3*i],o=e[3*i+1],l=e[3*i+2],h=e[3*n],c=e[3*n+1],u=e[3*n+2],d=e[3*r],p=e[3*r+1],m=e[3*r+2],f=e[3*a],g=e[3*a+1],v=e[3*a+2];return Math.abs(o-c)<Math.abs(s-h)?[new Mn(s,1-l),new Mn(h,1-u),new Mn(d,1-m),new Mn(f,1-v)]:[new Mn(o,1-l),new Mn(c,1-u),new Mn(p,1-m),new Mn(g,1-v)]}};function Jf(i,t,n){if(n.shapes=[],Array.isArray(i))for(let t=0,e=i.length;t<e;t++){var r=i[t];n.shapes.push(r.uuid)}else n.shapes.push(i.uuid);return n.options=Object.assign({},t),void 0!==t.extrudePath&&(n.options.extrudePath=t.extrudePath.toJSON()),n}class Kf extends af{constructor(t=1,e=0){var i=(1+Math.sqrt(5))/2,n,r;super([-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],t,e),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new Kf(t.radius,t.detail)}}class $f extends af{constructor(t=1,e=0){var i,n;super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],t,e),this.type="OctahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new $f(t.radius,t.detail)}}class Qf extends Ya{constructor(t=.5,e=1,i=32,n=1,r=0,a=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:i,phiSegments:n,thetaStart:r,thetaLength:a},i=Math.max(3,i);const s=[],o=[],l=[],h=[];let c=t;var u=(e-t)/(n=Math.max(1,n));const d=new tr,p=new Mn;for(let t=0;t<=n;t++){for(let t=0;t<=i;t++){var m=r+t/i*a;d.x=c*Math.cos(m),d.y=c*Math.sin(m),o.push(d.x,d.y,d.z),l.push(0,0,1),p.x=(d.x/e+1)/2,p.y=(d.y/e+1)/2,h.push(p.x,p.y)}c+=u}for(let t=0;t<n;t++){var f=t*(i+1);for(let t=0;t<i;t++){var g=t+f,v,_=g+i+1,y=g+i+2,x=g+1;s.push(g,_,x),s.push(_,y,x)}}this.setIndex(s),this.setAttribute("position",new ka(o,3)),this.setAttribute("normal",new ka(l,3)),this.setAttribute("uv",new ka(h,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Qf(t.innerRadius,t.outerRadius,t.thetaSegments,t.phiSegments,t.thetaStart,t.thetaLength)}}class tg extends Ya{constructor(e=new df([new Mn(0,.5),new Mn(-.5,-.5),new Mn(.5,-.5)]),p=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:p};const m=[],f=[],g=[],v=[];let i=0,_=0;if(!1===Array.isArray(e))n(e);else for(let t=0;t<e.length;t++)n(e[t]),this.addGroup(i,_,t),i+=_,_=0;function n(t){var i=f.length/3,e=t.extractPoints(p);let n=e.shape;const r=e.holes;!1===Xf.isClockWise(n)&&(n=n.reverse());for(let t=0,e=r.length;t<e;t++){const d=r[t];!0===Xf.isClockWise(d)&&(r[t]=d.reverse())}var a=Xf.triangulateShape(n,r);for(let t=0,e=r.length;t<e;t++){var s=r[t];n=n.concat(s)}for(let t=0,e=n.length;t<e;t++){var o=n[t];f.push(o.x,o.y,0),g.push(0,0,1),v.push(o.x,o.y)}for(let t=0,e=a.length;t<e;t++){var l=a[t],h=l[0]+i,c=l[1]+i,u=l[2]+i;m.push(h,c,u),_+=3}}this.setIndex(m),this.setAttribute("position",new ka(f,3)),this.setAttribute("normal",new ka(g,3)),this.setAttribute("uv",new ka(v,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){var t=super.toJSON(),e;return eg(this.parameters.shapes,t)}static fromJSON(i,n){const r=[];for(let t=0,e=i.shapes.length;t<e;t++){var a=n[i.shapes[t]];r.push(a)}return new tg(r,i.curveSegments)}}function eg(i,n){if(n.shapes=[],Array.isArray(i))for(let t=0,e=i.length;t<e;t++){var r=i[t];n.shapes.push(r.uuid)}else n.shapes.push(i.uuid);return n}class ig extends Ya{constructor(i=1,n=32,r=16,a=0,s=2*Math.PI,o=0,l=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:i,widthSegments:n,heightSegments:r,phiStart:a,phiLength:s,thetaStart:o,thetaLength:l},n=Math.max(3,Math.floor(n)),r=Math.max(2,Math.floor(r));var h=Math.min(o+l,Math.PI);let c=0;const u=[],d=new tr,p=new tr,m=[],f=[],g=[],v=[];for(let t=0;t<=r;t++){const w=[];var _=t/r;let e=0;0===t&&0===o?e=.5/n:t===r&&h===Math.PI&&(e=-.5/n);for(let t=0;t<=n;t++){var y=t/n;d.x=-i*Math.cos(a+y*s)*Math.sin(o+_*l),d.y=i*Math.cos(o+_*l),d.z=i*Math.sin(a+y*s)*Math.sin(o+_*l),f.push(d.x,d.y,d.z),p.copy(d).normalize(),g.push(p.x,p.y,p.z),v.push(y+e,1-_),w.push(c++)}u.push(w)}for(let e=0;e<r;e++)for(let t=0;t<n;t++){var x=u[e][t+1],M=u[e][t],S=u[e+1][t],b=u[e+1][t+1];(0!==e||0<o)&&m.push(x,M,b),(e!==r-1||h<Math.PI)&&m.push(M,S,b)}this.setIndex(m),this.setAttribute("position",new ka(f,3)),this.setAttribute("normal",new ka(g,3)),this.setAttribute("uv",new ka(v,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new ig(t.radius,t.widthSegments,t.heightSegments,t.phiStart,t.phiLength,t.thetaStart,t.thetaLength)}}class ng extends af{constructor(t=1,e=0){var i,n;super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],t,e),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new ng(t.radius,t.detail)}}class rg extends Ya{constructor(i=1,n=.4,r=12,a=48,s=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:i,tube:n,radialSegments:r,tubularSegments:a,arc:s},r=Math.floor(r),a=Math.floor(a);const o=[],l=[],h=[],c=[],u=new tr,d=new tr,p=new tr;for(let e=0;e<=r;e++)for(let t=0;t<=a;t++){var m=t/a*s,f=e/r*Math.PI*2;d.x=(i+n*Math.cos(f))*Math.cos(m),d.y=(i+n*Math.cos(f))*Math.sin(m),d.z=n*Math.sin(f),l.push(d.x,d.y,d.z),u.x=i*Math.cos(m),u.y=i*Math.sin(m),p.subVectors(d,u).normalize(),h.push(p.x,p.y,p.z),c.push(t/a),c.push(e/r)}for(let e=1;e<=r;e++)for(let t=1;t<=a;t++){var g=(a+1)*e+t-1,v=(a+1)*(e-1)+t-1,_=(a+1)*(e-1)+t,y=(a+1)*e+t;o.push(g,v,y),o.push(v,_,y)}this.setIndex(o),this.setAttribute("position",new ka(l,3)),this.setAttribute("normal",new ka(h,3)),this.setAttribute("uv",new ka(c,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new rg(t.radius,t.tube,t.radialSegments,t.tubularSegments,t.arc)}}class ag extends Ya{constructor(t=1,i=.4,n=64,r=8,a=2,s=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:i,tubularSegments:n,radialSegments:r,p:a,q:s},n=Math.floor(n),r=Math.floor(r);const o=[],l=[],h=[],c=[],u=new tr,d=new tr;var p=new tr,m=new tr;const f=new tr,g=new tr,v=new tr;for(let e=0;e<=n;++e){var _=e/n*a*Math.PI*2;E(_,a,s,t,p),E(.01+_,a,s,t,m),g.subVectors(m,p),v.addVectors(m,p),f.crossVectors(g,v),v.crossVectors(f,g),f.normalize(),v.normalize();for(let t=0;t<=r;++t){var y=t/r*Math.PI*2,x=-i*Math.cos(y),M=i*Math.sin(y);u.x=p.x+(x*v.x+M*f.x),u.y=p.y+(x*v.y+M*f.y),u.z=p.z+(x*v.z+M*f.z),l.push(u.x,u.y,u.z),d.subVectors(u,p).normalize(),h.push(d.x,d.y,d.z),c.push(e/n),c.push(t/r)}}for(let e=1;e<=n;e++)for(let t=1;t<=r;t++){var S=(r+1)*(e-1)+(t-1),b=(r+1)*e+(t-1),w=(r+1)*e+t,T=(r+1)*(e-1)+t;o.push(S,b,T),o.push(b,w,T)}function E(t,e,i,n,r){var a=Math.cos(t),s=Math.sin(t),o=i/e*t,l=Math.cos(o);r.x=n*(2+l)*.5*a,r.y=n*(2+l)*s*.5,r.z=n*Math.sin(o)*.5}this.setIndex(o),this.setAttribute("position",new ka(l,3)),this.setAttribute("normal",new ka(h,3)),this.setAttribute("uv",new ka(c,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new ag(t.radius,t.tube,t.tubularSegments,t.radialSegments,t.p,t.q)}}class sg extends Ya{constructor(s=new Ym(new tr(-1,-1,0),new tr(-1,1,0),new tr(1,1,0)),o=64,l=1,h=8,t=!1){super(),this.type="TubeGeometry",this.parameters={path:s,tubularSegments:o,radius:l,radialSegments:h,closed:t};const c=s.computeFrenetFrames(o,t);this.tangents=c.tangents,this.normals=c.normals,this.binormals=c.binormals;const u=new tr,d=new tr,i=new Mn;let p=new tr;const m=[],f=[],n=[],g=[];function e(){for(let t=0;t<o;t++)r(t);r(!1===t?o:0),v(),a()}function r(t){p=s.getPointAt(t/o,p);var e=c.normals[t],i=c.binormals[t];for(let t=0;t<=h;t++){var n=t/h*Math.PI*2,r=Math.sin(n),a=-Math.cos(n);d.x=a*e.x+r*i.x,d.y=a*e.y+r*i.y,d.z=a*e.z+r*i.z,d.normalize(),f.push(d.x,d.y,d.z),u.x=p.x+l*d.x,u.y=p.y+l*d.y,u.z=p.z+l*d.z,m.push(u.x,u.y,u.z)}}function a(){for(let e=1;e<=o;e++)for(let t=1;t<=h;t++){var i=(h+1)*(e-1)+(t-1),n=(h+1)*e+(t-1),r=(h+1)*e+t,a=(h+1)*(e-1)+t;g.push(i,n,a),g.push(n,r,a)}}function v(){for(let e=0;e<=o;e++)for(let t=0;t<=h;t++)i.x=e/o,i.y=t/h,n.push(i.x,i.y)}e(),this.setIndex(g),this.setAttribute("position",new ka(m,3)),this.setAttribute("normal",new ka(f,3)),this.setAttribute("uv",new ka(n,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON();return t.path=this.parameters.path.toJSON(),t}static fromJSON(t){return new sg((new Jm[t.path.type]).fromJSON(t.path),t.tubularSegments,t.radius,t.radialSegments,t.closed)}}class og extends Ya{constructor(t=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:t},null!==t){const d=[];var n=new Set;const p=new tr,m=new tr;if(null!==t.index){var r=t.attributes.position;const f=t.index;let i=t.groups;0===i.length&&(i=[{start:0,count:f.count,materialIndex:0}]);for(let t=0,e=i.length;t<e;++t){var a=i[t],s=a.start,o;for(let e=s,t=s+a.count;e<t;e+=3)for(let t=0;t<3;t++){var l=f.getX(e+t),h=f.getX(e+(t+1)%3);p.fromBufferAttribute(r,l),m.fromBufferAttribute(r,h),!0===lg(p,m,n)&&(d.push(p.x,p.y,p.z),d.push(m.x,m.y,m.z))}}}else{var i=t.attributes.position;for(let e=0,t=i.count/3;e<t;e++)for(let t=0;t<3;t++){var c=3*e+t,u=3*e+(t+1)%3;p.fromBufferAttribute(i,c),m.fromBufferAttribute(i,u),!0===lg(p,m,n)&&(d.push(p.x,p.y,p.z),d.push(m.x,m.y,m.z))}}this.setAttribute("position",new ka(d,3))}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}}function lg(t,e,i){var n=`${t.x},${t.y},${t.z}-${e.x},${e.y},`+e.z,r=`${e.x},${e.y},${e.z}-${t.x},${t.y},`+t.z;return!0!==i.has(n)&&!0!==i.has(r)&&(i.add(n),i.add(r),!0)}var hg=Object.freeze({__proto__:null,BoxGeometry:fs,CapsuleGeometry:tf,CircleGeometry:ef,ConeGeometry:rf,CylinderGeometry:nf,DodecahedronGeometry:sf,EdgesGeometry:uf,ExtrudeGeometry:Yf,IcosahedronGeometry:Kf,LatheGeometry:Qm,OctahedronGeometry:$f,PlaneGeometry:bh,PolyhedronGeometry:af,RingGeometry:Qf,ShapeGeometry:tg,SphereGeometry:ig,TetrahedronGeometry:ng,TorusGeometry:rg,TorusKnotGeometry:ag,TubeGeometry:sg,WireframeGeometry:og});class cg extends Sa{constructor(t){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new ya(0),this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.fog=t.fog,this}}class ug extends nh{constructor(t){super(t),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class dg extends Sa{constructor(t){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new ya(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ya(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=$e,this.normalScale=new Mn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new kr,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.envMapIntensity=t.envMapIntensity,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class pg extends dg{constructor(t){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Mn(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return $i(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new ya(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new ya(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new ya(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(t)}get anisotropy(){return this._anisotropy}set anisotropy(t){0<this._anisotropy!=0<t&&this.version++,this._anisotropy=t}get clearcoat(){return this._clearcoat}set clearcoat(t){0<this._clearcoat!=0<t&&this.version++,this._clearcoat=t}get iridescence(){return this._iridescence}set iridescence(t){0<this._iridescence!=0<t&&this.version++,this._iridescence=t}get dispersion(){return this._dispersion}set dispersion(t){0<this._dispersion!=0<t&&this.version++,this._dispersion=t}get sheen(){return this._sheen}set sheen(t){0<this._sheen!=0<t&&this.version++,this._sheen=t}get transmission(){return this._transmission}set transmission(t){0<this._transmission!=0<t&&this.version++,this._transmission=t}copy(t){return super.copy(t),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=t.anisotropy,this.anisotropyRotation=t.anisotropyRotation,this.anisotropyMap=t.anisotropyMap,this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.dispersion=t.dispersion,this.ior=t.ior,this.iridescence=t.iridescence,this.iridescenceMap=t.iridescenceMap,this.iridescenceIOR=t.iridescenceIOR,this.iridescenceThicknessRange=[...t.iridescenceThicknessRange],this.iridescenceThicknessMap=t.iridescenceThicknessMap,this.sheen=t.sheen,this.sheenColor.copy(t.sheenColor),this.sheenColorMap=t.sheenColorMap,this.sheenRoughness=t.sheenRoughness,this.sheenRoughnessMap=t.sheenRoughnessMap,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationColor.copy(t.attenuationColor),this.specularIntensity=t.specularIntensity,this.specularIntensityMap=t.specularIntensityMap,this.specularColor.copy(t.specularColor),this.specularColorMap=t.specularColorMap,this}}class mg extends Sa{constructor(t){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new ya(16777215),this.specular=new ya(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ya(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=$e,this.normalScale=new Mn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new kr,this.combine=c,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class fg extends Sa{constructor(t){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new ya(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ya(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=$e,this.normalScale=new Mn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}class gg extends Sa{constructor(t){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=$e,this.normalScale=new Mn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.flatShading=t.flatShading,this}}class vg extends Sa{constructor(t){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new ya(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ya(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=$e,this.normalScale=new Mn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new kr,this.combine=c,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class _g extends Sa{constructor(t){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new ya(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=$e,this.normalScale=new Mn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.flatShading=t.flatShading,this.fog=t.fog,this}}class yg extends Kp{constructor(t){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}copy(t){return super.copy(t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this}}function xg(t,e,i){return!t||!i&&t.constructor===e?t:"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)}function Mg(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Sg(i){function t(t,e){return i[t]-i[e]}var e=i.length;const n=new Array(e);for(let t=0;t!==e;++t)n[t]=t;return n.sort(t),n}function bg(i,n,r){var a=i.length;const s=new i.constructor(a);for(let t=0,e=0;e!==a;++t){var o=r[t]*n;for(let t=0;t!==n;++t)s[e++]=i[o+t]}return s}function wg(e,i,n,r){let a=1,s=e[0];for(;void 0!==s&&void 0===s[r];)s=e[a++];if(void 0!==s){let t=s[r];if(void 0!==t)if(Array.isArray(t))for(;t=s[r],void 0!==t&&(i.push(s.time),n.push.apply(n,t)),s=e[a++],void 0!==s;);else if(void 0!==t.toArray)for(;t=s[r],void 0!==t&&(i.push(s.time),t.toArray(n,n.length)),s=e[a++],void 0!==s;);else for(;t=s[r],void 0!==t&&(i.push(s.time),n.push(t)),s=e[a++],void 0!==s;);}}function Tg(t,e,i,n,r=30){const a=t.clone();a.name=e;const s=[];for(let t=0;t<a.tracks.length;++t){const c=a.tracks[t];var o=c.getValueSize();const u=[],d=[];for(let e=0;e<c.times.length;++e){var l=c.times[e]*r;if(!(l<i||n<=l)){u.push(c.times[e]);for(let t=0;t<o;++t)d.push(c.values[e*o+t])}}0!==u.length&&(c.times=xg(u,c.times.constructor),c.values=xg(d,c.values.constructor),s.push(c))}a.tracks=s;let h=1/0;for(let t=0;t<a.tracks.length;++t)h>a.tracks[t].times[0]&&(h=a.tracks[t].times[0]);for(let t=0;t<a.tracks.length;++t)a.tracks[t].shift(-1*h);return a.resetDuration(),a}function Eg(e,t=0,i=e,n=30){var r=i.tracks.length,a=t/(n=n<=0?30:n);for(let t=0;t<r;++t){const _=i.tracks[t],y=_.ValueTypeName;if("bool"!==y&&"string"!==y){const x=e.tracks.find(function(t){return t.name===_.name&&t.ValueTypeName===y});if(void 0!==x){let t=0;var s=_.getValueSize();_.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(t=s/3);let e=0;var o=x.getValueSize();x.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(e=o/3);var l=_.times.length-1;let i;if(a<=_.times[0]){var h=t,c=s-t;i=_.values.slice(h,c)}else if(a>=_.times[l]){var u=l*s+t,d=u+s-t;i=_.values.slice(u,d)}else{const M=_.createInterpolant();var p=t,m=s-t;M.evaluate(a),i=M.resultBuffer.slice(p,m)}if("quaternion"===y){const S=(new Qn).fromArray(i).normalize().conjugate();S.toArray(i)}var f=x.times.length;for(let t=0;t<f;++t){var g=t*o+e;if("quaternion"===y)Qn.multiplyQuaternionsFlat(x.values,g,i,0,x.values,g);else{var v=o-2*e;for(let t=0;t<v;++t)x.values[g+t]-=i[t]}}}}}return e.blendMode=We,e}const Ag={convertArray:xg,isTypedArray:Mg,getKeyframeOrder:Sg,sortedArray:bg,flattenJSON:wg,subclip:Tg,makeClipAdditive:Eg};class Cg{constructor(t,e,i,n){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==n?n:new e.constructor(i),this.sampleValues=e,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){var i=this.parameterPositions;let n=this._cachedIndex,r=i[n],a=i[n-1];t:{e:{let t;i:{n:if(!(e<r)){for(var s=n+2;;){if(void 0===r){if(e<a)break n;return n=i.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===s)break;if(a=r,r=i[++n],e<r)break e}t=i.length;break i}if(e>=a)break t;var o=i[1];e<o&&(n=2,a=o);for(var l=n-2;;){if(void 0===a)return this._cachedIndex=0,this.copySampleValue_(0);if(n===l)break;if(r=a,a=i[--n-1],e>=a)break e}t=n,n=0}for(;n<t;){var h=n+t>>>1;e<i[h]?t=h:n=1+h}if(r=i[n],a=i[n-1],void 0===a)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===r)return n=i.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,a,r)}return this.interpolate_(n,a,e,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){const e=this.resultBuffer,i=this.sampleValues,n=this.valueSize,r=t*n;for(let t=0;t!==n;++t)e[t]=i[r+t];return e}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class Rg extends Cg{constructor(t,e,i,n){super(t,e,i,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:ke,endingEnd:ke}}intervalChanged_(t,e,i){var n=this.parameterPositions;let r=t-2,a=t+1,s=n[r],o=n[a];if(void 0===s)switch(this.getSettings_().endingStart){case Ve:r=t,s=2*e-i;break;case Ge:r=n.length-2,s=e+n[r]-n[r+1];break;default:r=t,s=i}if(void 0===o)switch(this.getSettings_().endingEnd){case Ve:a=t,o=2*i-e;break;case Ge:a=1,o=i+n[1]-n[0];break;default:a=t-1,o=e}var l=.5*(i-e),h=this.valueSize;this._weightPrev=l/(e-s),this._weightNext=l/(o-i),this._offsetPrev=r*h,this._offsetNext=a*h}interpolate_(t,e,i,n){const r=this.resultBuffer,a=this.sampleValues,s=this.valueSize,o=t*s,l=o-s,h=this._offsetPrev,c=this._offsetNext,u=this._weightPrev,d=this._weightNext,p=(i-e)/(n-e),m=p*p,f=m*p;var g=-u*f+2*u*m-u*p,v=(1+u)*f+(-1.5-2*u)*m+(-.5+u)*p+1,_=(-1-d)*f+(1.5+d)*m+.5*p,y=d*f-d*m;for(let t=0;t!==s;++t)r[t]=g*a[h+t]+v*a[l+t]+_*a[o+t]+y*a[c+t];return r}}class Pg extends Cg{constructor(t,e,i,n){super(t,e,i,n)}interpolate_(t,e,i,n){const r=this.resultBuffer,a=this.sampleValues,s=this.valueSize,o=t*s,l=o-s,h=(i-e)/(n-e),c=1-h;for(let t=0;t!==s;++t)r[t]=a[l+t]*c+a[o+t]*h;return r}}class Ig extends Cg{constructor(t,e,i,n){super(t,e,i,n)}interpolate_(t){return this.copySampleValue_(t-1)}}class Lg{constructor(t,e,i,n){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=xg(e,this.TimeBufferType),this.values=xg(i,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}static toJSON(t){const e=t.constructor;let i;var n;return e.toJSON!==this.toJSON?i=e.toJSON(t):(i={name:t.name,times:xg(t.times,Array),values:xg(t.values,Array)},(n=t.getInterpolation())!==t.DefaultInterpolation&&(i.interpolation=n)),i.type=t.ValueTypeName,i}InterpolantFactoryMethodDiscrete(t){return new Ig(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new Pg(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new Rg(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let e;switch(t){case Be:e=this.InterpolantFactoryMethodDiscrete;break;case Fe:e=this.InterpolantFactoryMethodLinear;break;case ze:e=this.InterpolantFactoryMethodSmooth}if(void 0!==e)return this.createInterpolant=e,this;var i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(i);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",i),this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Be;case this.InterpolantFactoryMethodLinear:return Fe;case this.InterpolantFactoryMethodSmooth:return ze}}getValueSize(){return this.values.length/this.times.length}shift(i){if(0!==i){const n=this.times;for(let t=0,e=n.length;t!==e;++t)n[t]+=i}return this}scale(i){if(1!==i){const n=this.times;for(let t=0,e=n.length;t!==e;++t)n[t]*=i}return this}trim(t,e){const i=this.times,n=i.length;let r=0,a=n-1;for(;r!==n&&i[r]<t;)++r;for(;-1!==a&&i[a]>e;)--a;var s;return++a,0===r&&a===n||(r>=a&&(a=Math.max(a,1),r=a-1),s=this.getValueSize(),this.times=i.slice(r,a),this.values=this.values.slice(r*s,a*s)),this}validate(){let i=!0;var t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),i=!1);var e=this.times,n=this.values,r=e.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),i=!1);let a=null;for(let t=0;t!==r;t++){var s=e[t];if("number"==typeof s&&isNaN(s)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,t,s),i=!1;break}if(null!==a&&a>s){console.error("THREE.KeyframeTrack: Out of order keys.",this,t,s,a),i=!1;break}a=s}if(void 0!==n&&Mg(n))for(let t=0,e=n.length;t!==e;++t){var o=n[t];if(isNaN(o)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,t,o),i=!1;break}}return i}optimize(){const i=this.times.slice(),n=this.values.slice(),r=this.getValueSize(),a=this.getInterpolation()===ze,s=i.length-1;let o=1;for(let t=1;t<s;++t){let e=!1;var l=i[t],h;if(l!==i[t+1]&&(1!==t||l!==i[0]))if(a)e=!0;else{var c=t*r,u=c-r,d=c+r;for(let t=0;t!==r;++t){var p=n[c+t];if(p!==n[u+t]||p!==n[d+t]){e=!0;break}}}if(e){if(t!==o){i[o]=i[t];var m=t*r,f=o*r;for(let t=0;t!==r;++t)n[f+t]=n[m+t]}++o}}if(0<s){i[o]=i[s];for(let t=s*r,e=o*r,i=0;i!==r;++i)n[e+i]=n[t+i];++o}return o!==i.length?(this.times=i.slice(0,o),this.values=n.slice(0,o*r)):(this.times=i,this.values=n),this}clone(){var t=this.times.slice(),e=this.values.slice();const i=this.constructor,n=new i(this.name,t,e);return n.createInterpolant=this.createInterpolant,n}}Lg.prototype.TimeBufferType=Float32Array,Lg.prototype.ValueBufferType=Float32Array,Lg.prototype.DefaultInterpolation=Fe;class Ug extends Lg{constructor(t,e,i){super(t,e,i)}}Ug.prototype.ValueTypeName="bool",Ug.prototype.ValueBufferType=Array,Ug.prototype.DefaultInterpolation=Be,Ug.prototype.InterpolantFactoryMethodLinear=void 0,Ug.prototype.InterpolantFactoryMethodSmooth=void 0;class Ng extends Lg{}Ng.prototype.ValueTypeName="color";class Dg extends Lg{}Dg.prototype.ValueTypeName="number";class Og extends Cg{constructor(t,e,i,n){super(t,e,i,n)}interpolate_(t,e,i,n){var r=this.resultBuffer,a=this.sampleValues,s=this.valueSize,o=(i-e)/(n-e);let l=t*s;for(var h=l+s;l!==h;l+=4)Qn.slerpFlat(r,0,a,l-s,a,l,o);return r}}class Bg extends Lg{InterpolantFactoryMethodLinear(t){return new Og(this.times,this.values,this.getValueSize(),t)}}Bg.prototype.ValueTypeName="quaternion",Bg.prototype.InterpolantFactoryMethodSmooth=void 0;class Fg extends Lg{constructor(t,e,i){super(t,e,i)}}Fg.prototype.ValueTypeName="string",Fg.prototype.ValueBufferType=Array,Fg.prototype.DefaultInterpolation=Be,Fg.prototype.InterpolantFactoryMethodLinear=void 0,Fg.prototype.InterpolantFactoryMethodSmooth=void 0;class zg extends Lg{}class kg{constructor(t="",e=-1,i=[],n=He){this.name=t,this.tracks=i,this.duration=e,this.blendMode=n,this.uuid=Ki(),this.duration<0&&this.resetDuration()}static parse(t){const i=[],n=t.tracks,r=1/(t.fps||1);for(let t=0,e=n.length;t!==e;++t)i.push(Gg(n[t]).scale(r));const e=new this(t.name,t.duration,i,t.blendMode);return e.uuid=t.uuid,e}static toJSON(t){const i=[],n=t.tracks;var e={name:t.name,duration:t.duration,tracks:i,uuid:t.uuid,blendMode:t.blendMode};for(let t=0,e=n.length;t!==e;++t)i.push(Lg.toJSON(n[t]));return e}static CreateFromMorphTargetSequence(t,n,r,a){var s=n.length;const o=[];for(let i=0;i<s;i++){let t=[],e=[];t.push((i+s-1)%s,i,(i+1)%s),e.push(0,1,0);var l=Sg(t);t=bg(t,1,l),e=bg(e,1,l),a||0!==t[0]||(t.push(s),e.push(e[0])),o.push(new Dg(".morphTargetInfluences["+n[i].name+"]",t,e).scale(1/r))}return new this(t,-1,o)}static findByName(t,e){let i=t;var n;Array.isArray(t)||(i=t.geometry&&t.geometry.animations||t.animations);for(let t=0;t<i.length;t++)if(i[t].name===e)return i[t];return null}static CreateClipsFromMorphTargetSequences(i,t,e){const n={};var r=/^([\w-]*?)([\d]+)$/;for(let t=0,e=i.length;t<e;t++){const l=i[t];var a=l.name.match(r);if(a&&1<a.length){var s=a[1];let t=n[s];t||(n[s]=t=[]),t.push(l)}}const o=[];for(const h in n)o.push(this.CreateFromMorphTargetSequence(h,n[h],t,e));return o}static parseAnimation(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;var i=function(t,e,i,n,r){var a,s;0!==i.length&&(wg(i,a=[],s=[],n),0!==a.length&&r.push(new t(e,a,s)))};const n=[];var r=t.name||"default",a=t.fps||30,s=t.blendMode;let o=t.length||-1;var l=t.hierarchy||[],h;for(let t=0;t<l.length;t++){var c=l[t].keys;if(c&&0!==c.length)if(c[0].morphTargets){const p={};let e;for(e=0;e<c.length;e++)if(c[e].morphTargets)for(let t=0;t<c[e].morphTargets.length;t++)p[c[e].morphTargets[t]]=-1;for(const m in p){const f=[],g=[];for(let t=0;t!==c[e].morphTargets.length;++t){var u=c[e];f.push(u.time),g.push(u.morphTarget===m?1:0)}n.push(new Dg(".morphTargetInfluence["+m+"]",f,g))}o=p.length*a}else{var d=".bones["+e[t].name+"]";i(zg,d+".position",c,"pos",n),i(Bg,d+".quaternion",c,"rot",n),i(zg,d+".scale",c,"scl",n)}}return 0===n.length?null:new this(r,o,n,s)}resetDuration(){var t;let i=0;for(let t=0,e=this.tracks.length;t!==e;++t){var n=this.tracks[t];i=Math.max(i,n.times[n.times.length-1])}return this.duration=i,this}trim(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function Vg(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Dg;case"vector":case"vector2":case"vector3":case"vector4":return zg;case"color":return Ng;case"quaternion":return Bg;case"bool":case"boolean":return Ug;case"string":return Fg}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}function Gg(t){if(void 0===t.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=Vg(t.type);var i,n;return void 0===t.times&&(wg(t.keys,i=[],n=[],"value"),t.times=i,t.values=n),void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}const Hg={enabled:!(zg.prototype.ValueTypeName="vector"),files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};class Wg{constructor(t,e,i){const n=this;let r=!1,a=0,s=0,o=void 0;const l=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=i,this.itemStart=function(t){s++,!1===r&&void 0!==n.onStart&&n.onStart(t,a,s),r=!0},this.itemEnd=function(t){a++,void 0!==n.onProgress&&n.onProgress(t,a,s),a===s&&(r=!1,void 0!==n.onLoad&&n.onLoad())},this.itemError=function(t){void 0!==n.onError&&n.onError(t)},this.resolveURL=function(t){return o?o(t):t},this.setURLModifier=function(t){return o=t,this},this.addHandler=function(t,e){return l.push(t,e),this},this.removeHandler=function(t){var e=l.indexOf(t);return-1!==e&&l.splice(e,2),this},this.getHandler=function(i){for(let t=0,e=l.length;t<e;t+=2){const r=l[t];var n=l[t+1];if(r.global&&(r.lastIndex=0),r.test(i))return n}return null}}}const Xg=new Wg;class jg{constructor(t){this.manager=void 0!==t?t:Xg,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(i,n){const r=this;return new Promise(function(t,e){r.load(i,t,n,e)})}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}}jg.DEFAULT_MATERIAL_NAME="__DEFAULT";const qg={};class Yg extends Error{constructor(t,e){super(t),this.response=e}}class Zg extends jg{constructor(t){super(t)}load(a,t,e,i){void 0===a&&(a=""),void 0!==this.path&&(a=this.path+a),a=this.manager.resolveURL(a);const n=Hg.get(a);if(void 0!==n)return this.manager.itemStart(a),setTimeout(()=>{t&&t(n),this.manager.itemEnd(a)},0),n;if(void 0===qg[a]){qg[a]=[],qg[a].push({onLoad:t,onProgress:e,onError:i});var r=new Request(a,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"});const s=this.mimeType,o=this.responseType;fetch(r).then(t=>{if(200!==t.status&&0!==t.status)throw new Yg(`fetch for "${t.url}" responded with ${t.status}: `+t.statusText,t);{if(0===t.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===t.body||void 0===t.body.getReader)return t;const o=qg[a],n=t.body.getReader();var e=t.headers.get("X-File-Size")||t.headers.get("Content-Length");const l=e?parseInt(e):0,h=0!==l;let s=0;var i=new ReadableStream({start(r){function a(){n.read().then(({done:t,value:e})=>{if(t)r.close();else{s+=e.byteLength;var i=new ProgressEvent("progress",{lengthComputable:h,loaded:s,total:l});for(let t=0,e=o.length;t<e;t++){const n=o[t];n.onProgress&&n.onProgress(i)}r.enqueue(e),a()}},t=>{r.error(t)})}a()}});return new Response(i)}}).then(t=>{switch(o){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"document":return t.text().then(t=>{const e=new DOMParser;return e.parseFromString(t,s)});case"json":return t.json();default:if(void 0===s)return t.text();{const i=/charset="?([^;"\s]*)"?/i,n=i.exec(s);var e=n&&n[1]?n[1].toLowerCase():void 0;const r=new TextDecoder(e);return t.arrayBuffer().then(t=>r.decode(t))}}}).then(i=>{Hg.add(a,i);var n=qg[a];delete qg[a];for(let t=0,e=n.length;t<e;t++){const r=n[t];r.onLoad&&r.onLoad(i)}}).catch(i=>{var n=qg[a];if(void 0===n)throw this.manager.itemError(a),i;delete qg[a];for(let t=0,e=n.length;t<e;t++){const r=n[t];r.onError&&r.onError(i)}this.manager.itemError(a)}).finally(()=>{this.manager.itemEnd(a)}),this.manager.itemStart(a)}else qg[a].push({onLoad:t,onProgress:e,onError:i})}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}}class Jg extends jg{constructor(t){super(t)}load(e,i,t,n){const r=this,a=new Zg(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(t){try{i(r.parse(JSON.parse(t)))}catch(t){n?n(t):console.error(t),r.manager.itemError(e)}},t,n)}parse(e){const i=[];for(let t=0;t<e.length;t++){var n=kg.parse(e[t]);i.push(n)}return i}}class Kg extends jg{constructor(t){super(t)}load(n,r,t,e){const a=this,s=[],o=new xm,l=new Zg(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(a.withCredentials);let h=0;function i(i){l.load(n[i],function(t){var e=a.parse(t,!0);s[i]={width:e.width,height:e.height,format:e.format,mipmaps:e.mipmaps},h+=1,6===h&&(1===e.mipmapCount&&(o.minFilter=lt),o.image=s,o.format=e.format,o.needsUpdate=!0,r&&r(o))},t,e)}if(Array.isArray(n))for(let t=0,e=n.length;t<e;++t)i(t);else l.load(n,function(t){var i=a.parse(t,!0);if(i.isCubemap){var n=i.mipmaps.length/i.mipmapCount;for(let e=0;e<n;e++){s[e]={mipmaps:[]};for(let t=0;t<i.mipmapCount;t++)s[e].mipmaps.push(i.mipmaps[e*i.mipmapCount+t]),s[e].format=i.format,s[e].width=i.width,s[e].height=i.height}o.image=s}else o.image.width=i.width,o.image.height=i.height,o.mipmaps=i.mipmaps;1===i.mipmapCount&&(o.minFilter=lt),o.format=i.format,o.needsUpdate=!0,r&&r(o)},t,e);return o}}class $g extends jg{constructor(t){super(t)}load(e,t,i,n){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,a=Hg.get(e);if(void 0!==a)return r.manager.itemStart(e),setTimeout(function(){t&&t(a),r.manager.itemEnd(e)},0),a;const s=An("img");function o(){h(),Hg.add(e,this),t&&t(this),r.manager.itemEnd(e)}function l(t){h(),n&&n(t),r.manager.itemError(e),r.manager.itemEnd(e)}function h(){s.removeEventListener("load",o,!1),s.removeEventListener("error",l,!1)}return s.addEventListener("load",o,!1),s.addEventListener("error",l,!1),"data:"!==e.slice(0,5)&&void 0!==this.crossOrigin&&(s.crossOrigin=this.crossOrigin),r.manager.itemStart(e),s.src=e,s}}class Qg extends jg{constructor(t){super(t)}load(i,n,t,r){const a=new dh;a.colorSpace=ei;const s=new $g(this.manager);s.setCrossOrigin(this.crossOrigin),s.setPath(this.path);let o=0;function e(e){s.load(i[e],function(t){a.images[e]=t,o++,6===o&&(a.needsUpdate=!0,n&&n(a))},void 0,r)}for(let t=0;t<i.length;++t)e(t);return a}}class tv extends jg{constructor(t){super(t)}load(t,i,e,n){const r=this,a=new yp,s=new Zg(this.manager);return s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setPath(this.path),s.setWithCredentials(r.withCredentials),s.load(t,function(t){let e;try{e=r.parse(t)}catch(t){if(void 0===n)return void console.error(t);n(t)}void 0!==e.image?a.image=e.image:void 0!==e.data&&(a.image.width=e.width,a.image.height=e.height,a.image.data=e.data),a.wrapS=void 0!==e.wrapS?e.wrapS:nt,a.wrapT=void 0!==e.wrapT?e.wrapT:nt,a.magFilter=void 0!==e.magFilter?e.magFilter:lt,a.minFilter=void 0!==e.minFilter?e.minFilter:lt,a.anisotropy=void 0!==e.anisotropy?e.anisotropy:1,void 0!==e.colorSpace&&(a.colorSpace=e.colorSpace),void 0!==e.flipY&&(a.flipY=e.flipY),void 0!==e.format&&(a.format=e.format),void 0!==e.type&&(a.type=e.type),void 0!==e.mipmaps&&(a.mipmaps=e.mipmaps,a.minFilter=le),1===e.mipmapCount&&(a.minFilter=lt),void 0!==e.generateMipmaps&&(a.generateMipmaps=e.generateMipmaps),a.needsUpdate=!0,i&&i(a,e)},e,n),a}}class ev extends jg{constructor(t){super(t)}load(t,e,i,n){const r=new Xn,a=new $g(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(t,function(t){r.image=t,r.needsUpdate=!0,void 0!==e&&e(r)},i,n),r}}class iv extends na{constructor(t,e=1){super(),this.isLight=!0,this.type="Light",this.color=new ya(t),this.intensity=e}dispose(){}copy(t,e){return super.copy(t,e),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){const e=super.toJSON(t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),void 0!==this.target&&(e.object.target=this.target.uuid),e}}class nv extends iv{constructor(t,e,i){super(t,i),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(na.DEFAULT_UP),this.updateMatrix(),this.groundColor=new ya(e)}copy(t,e){return super.copy(t,e),this.groundColor.copy(t.groundColor),this}}const rv=new Pr,av=new tr,sv=new tr;class ov{constructor(t){this.camera=t,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Mn(512,512),this.map=null,this.mapPass=null,this.matrix=new Pr,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new xh,this._frameExtents=new Mn(1,1),this._viewportCount=1,this._viewports=[new jn(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){const e=this.camera,i=this.matrix;av.setFromMatrixPosition(t.matrixWorld),e.position.copy(av),sv.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(sv),e.updateMatrixWorld(),rv.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(rv),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(rv)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.intensity=t.intensity,this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const t={};return 1!==this.intensity&&(t.intensity=this.intensity),0!==this.bias&&(t.bias=this.bias),0!==this.normalBias&&(t.normalBias=this.normalBias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}class lv extends ov{constructor(){super(new lh(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(t){const e=this.camera;var i=2*Ji*t.angle*this.focus,n=this.mapSize.width/this.mapSize.height,r=t.distance||e.far;i===e.fov&&n===e.aspect&&r===e.far||(e.fov=i,e.aspect=n,e.far=r,e.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}}class hv extends iv{constructor(t,e,i=0,n=Math.PI/3,r=0,a=2){super(t,e),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(na.DEFAULT_UP),this.updateMatrix(),this.target=new na,this.distance=i,this.angle=n,this.penumbra=r,this.decay=a,this.map=null,this.shadow=new lv}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}const cv=new Pr,uv=new tr,dv=new tr;class pv extends ov{constructor(){super(new lh(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Mn(4,2),this._viewportCount=6,this._viewports=[new jn(2,1,1,1),new jn(0,1,1,1),new jn(3,1,1,1),new jn(1,1,1,1),new jn(3,0,1,1),new jn(1,0,1,1)],this._cubeDirections=[new tr(1,0,0),new tr(-1,0,0),new tr(0,0,1),new tr(0,0,-1),new tr(0,1,0),new tr(0,-1,0)],this._cubeUps=[new tr(0,1,0),new tr(0,1,0),new tr(0,1,0),new tr(0,1,0),new tr(0,0,1),new tr(0,0,-1)]}updateMatrices(t,e=0){const i=this.camera,n=this.matrix;var r=t.distance||i.far;r!==i.far&&(i.far=r,i.updateProjectionMatrix()),uv.setFromMatrixPosition(t.matrixWorld),i.position.copy(uv),dv.copy(i.position),dv.add(this._cubeDirections[e]),i.up.copy(this._cubeUps[e]),i.lookAt(dv),i.updateMatrixWorld(),n.makeTranslation(-uv.x,-uv.y,-uv.z),cv.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(cv)}}class mv extends iv{constructor(t,e,i=0,n=2){super(t,e),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=n,this.shadow=new pv}get power(){return 4*this.intensity*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}class fv extends ov{constructor(){super(new Oh(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class gv extends iv{constructor(t,e){super(t,e),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(na.DEFAULT_UP),this.updateMatrix(),this.target=new na,this.shadow=new fv}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}class vv extends iv{constructor(t,e){super(t,e),this.isAmbientLight=!0,this.type="AmbientLight"}}class _v extends iv{constructor(t,e,i=10,n=10){super(t,e),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=i,this.height=n}get power(){return this.intensity*this.width*this.height*Math.PI}set power(t){this.intensity=t/(this.width*this.height*Math.PI)}copy(t){return super.copy(t),this.width=t.width,this.height=t.height,this}toJSON(t){const e=super.toJSON(t);return e.object.width=this.width,e.object.height=this.height,e}}class yv{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let t=0;t<9;t++)this.coefficients.push(new tr)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this}getAt(t,e){var i=t.x,n=t.y,r=t.z,a=this.coefficients;return e.copy(a[0]).multiplyScalar(.282095),e.addScaledVector(a[1],.488603*n),e.addScaledVector(a[2],.488603*r),e.addScaledVector(a[3],.488603*i),e.addScaledVector(a[4],i*n*1.092548),e.addScaledVector(a[5],n*r*1.092548),e.addScaledVector(a[6],.315392*(3*r*r-1)),e.addScaledVector(a[7],i*r*1.092548),e.addScaledVector(a[8],.546274*(i*i-n*n)),e}getIrradianceAt(t,e){var i=t.x,n=t.y,r=t.z,a=this.coefficients;return e.copy(a[0]).multiplyScalar(.886227),e.addScaledVector(a[1],1.023328*n),e.addScaledVector(a[2],1.023328*r),e.addScaledVector(a[3],1.023328*i),e.addScaledVector(a[4],.858086*i*n),e.addScaledVector(a[5],.858086*n*r),e.addScaledVector(a[6],.743125*r*r-.247708),e.addScaledVector(a[7],.858086*i*r),e.addScaledVector(a[8],.429043*(i*i-n*n)),e}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,i){for(let t=0;t<9;t++)this.coefficients[t].addScaledVector(e.coefficients[t],i);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,i){for(let t=0;t<9;t++)this.coefficients[t].lerp(e.coefficients[t],i);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(t){return this.set(t.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(e,i=0){const n=this.coefficients;for(let t=0;t<9;t++)n[t].fromArray(e,i+3*t);return this}toArray(e=[],i=0){const n=this.coefficients;for(let t=0;t<9;t++)n[t].toArray(e,i+3*t);return e}static getBasisAt(t,e){var i=t.x,n=t.y,r=t.z;e[0]=.282095,e[1]=.488603*n,e[2]=.488603*r,e[3]=.488603*i,e[4]=1.092548*i*n,e[5]=1.092548*n*r,e[6]=.315392*(3*r*r-1),e[7]=1.092548*i*r,e[8]=.546274*(i*i-n*n)}}class xv extends iv{constructor(t=new yv,e=1){super(void 0,e),this.isLightProbe=!0,this.sh=t}copy(t){return super.copy(t),this.sh.copy(t.sh),this}fromJSON(t){return this.intensity=t.intensity,this.sh.fromArray(t.sh),this}toJSON(t){const e=super.toJSON(t);return e.object.sh=this.sh.toArray(),e}}class Mv extends jg{constructor(t){super(t),this.textures={}}load(e,i,t,n){const r=this,a=new Zg(r.manager);a.setPath(r.path),a.setRequestHeader(r.requestHeader),a.setWithCredentials(r.withCredentials),a.load(e,function(t){try{i(r.parse(JSON.parse(t)))}catch(t){n?n(t):console.error(t),r.manager.itemError(e)}},t,n)}parse(e){const i=this.textures;function t(t){return void 0===i[t]&&console.warn("THREE.MaterialLoader: Undefined texture",t),i[t]}const n=Mv.createMaterialFromType(e.type);if(void 0!==e.uuid&&(n.uuid=e.uuid),void 0!==e.name&&(n.name=e.name),void 0!==e.color&&void 0!==n.color&&n.color.setHex(e.color),void 0!==e.roughness&&(n.roughness=e.roughness),void 0!==e.metalness&&(n.metalness=e.metalness),void 0!==e.sheen&&(n.sheen=e.sheen),void 0!==e.sheenColor&&(n.sheenColor=(new ya).setHex(e.sheenColor)),void 0!==e.sheenRoughness&&(n.sheenRoughness=e.sheenRoughness),void 0!==e.emissive&&void 0!==n.emissive&&n.emissive.setHex(e.emissive),void 0!==e.specular&&void 0!==n.specular&&n.specular.setHex(e.specular),void 0!==e.specularIntensity&&(n.specularIntensity=e.specularIntensity),void 0!==e.specularColor&&void 0!==n.specularColor&&n.specularColor.setHex(e.specularColor),void 0!==e.shininess&&(n.shininess=e.shininess),void 0!==e.clearcoat&&(n.clearcoat=e.clearcoat),void 0!==e.clearcoatRoughness&&(n.clearcoatRoughness=e.clearcoatRoughness),void 0!==e.dispersion&&(n.dispersion=e.dispersion),void 0!==e.iridescence&&(n.iridescence=e.iridescence),void 0!==e.iridescenceIOR&&(n.iridescenceIOR=e.iridescenceIOR),void 0!==e.iridescenceThicknessRange&&(n.iridescenceThicknessRange=e.iridescenceThicknessRange),void 0!==e.transmission&&(n.transmission=e.transmission),void 0!==e.thickness&&(n.thickness=e.thickness),void 0!==e.attenuationDistance&&(n.attenuationDistance=e.attenuationDistance),void 0!==e.attenuationColor&&void 0!==n.attenuationColor&&n.attenuationColor.setHex(e.attenuationColor),void 0!==e.anisotropy&&(n.anisotropy=e.anisotropy),void 0!==e.anisotropyRotation&&(n.anisotropyRotation=e.anisotropyRotation),void 0!==e.fog&&(n.fog=e.fog),void 0!==e.flatShading&&(n.flatShading=e.flatShading),void 0!==e.blending&&(n.blending=e.blending),void 0!==e.combine&&(n.combine=e.combine),void 0!==e.side&&(n.side=e.side),void 0!==e.shadowSide&&(n.shadowSide=e.shadowSide),void 0!==e.opacity&&(n.opacity=e.opacity),void 0!==e.transparent&&(n.transparent=e.transparent),void 0!==e.alphaTest&&(n.alphaTest=e.alphaTest),void 0!==e.alphaHash&&(n.alphaHash=e.alphaHash),void 0!==e.depthFunc&&(n.depthFunc=e.depthFunc),void 0!==e.depthTest&&(n.depthTest=e.depthTest),void 0!==e.depthWrite&&(n.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(n.colorWrite=e.colorWrite),void 0!==e.blendSrc&&(n.blendSrc=e.blendSrc),void 0!==e.blendDst&&(n.blendDst=e.blendDst),void 0!==e.blendEquation&&(n.blendEquation=e.blendEquation),void 0!==e.blendSrcAlpha&&(n.blendSrcAlpha=e.blendSrcAlpha),void 0!==e.blendDstAlpha&&(n.blendDstAlpha=e.blendDstAlpha),void 0!==e.blendEquationAlpha&&(n.blendEquationAlpha=e.blendEquationAlpha),void 0!==e.blendColor&&void 0!==n.blendColor&&n.blendColor.setHex(e.blendColor),void 0!==e.blendAlpha&&(n.blendAlpha=e.blendAlpha),void 0!==e.stencilWriteMask&&(n.stencilWriteMask=e.stencilWriteMask),void 0!==e.stencilFunc&&(n.stencilFunc=e.stencilFunc),void 0!==e.stencilRef&&(n.stencilRef=e.stencilRef),void 0!==e.stencilFuncMask&&(n.stencilFuncMask=e.stencilFuncMask),void 0!==e.stencilFail&&(n.stencilFail=e.stencilFail),void 0!==e.stencilZFail&&(n.stencilZFail=e.stencilZFail),void 0!==e.stencilZPass&&(n.stencilZPass=e.stencilZPass),void 0!==e.stencilWrite&&(n.stencilWrite=e.stencilWrite),void 0!==e.wireframe&&(n.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(n.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(n.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(n.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(n.rotation=e.rotation),void 0!==e.linewidth&&(n.linewidth=e.linewidth),void 0!==e.dashSize&&(n.dashSize=e.dashSize),void 0!==e.gapSize&&(n.gapSize=e.gapSize),void 0!==e.scale&&(n.scale=e.scale),void 0!==e.polygonOffset&&(n.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(n.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(n.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.dithering&&(n.dithering=e.dithering),void 0!==e.alphaToCoverage&&(n.alphaToCoverage=e.alphaToCoverage),void 0!==e.premultipliedAlpha&&(n.premultipliedAlpha=e.premultipliedAlpha),void 0!==e.forceSinglePass&&(n.forceSinglePass=e.forceSinglePass),void 0!==e.visible&&(n.visible=e.visible),void 0!==e.toneMapped&&(n.toneMapped=e.toneMapped),void 0!==e.userData&&(n.userData=e.userData),void 0!==e.vertexColors&&("number"==typeof e.vertexColors?n.vertexColors=0<e.vertexColors:n.vertexColors=e.vertexColors),void 0!==e.uniforms)for(const a in e.uniforms){var r=e.uniforms[a];switch(n.uniforms[a]={},r.type){case"t":n.uniforms[a].value=t(r.value);break;case"c":n.uniforms[a].value=(new ya).setHex(r.value);break;case"v2":n.uniforms[a].value=(new Mn).fromArray(r.value);break;case"v3":n.uniforms[a].value=(new tr).fromArray(r.value);break;case"v4":n.uniforms[a].value=(new jn).fromArray(r.value);break;case"m3":n.uniforms[a].value=(new Sn).fromArray(r.value);break;case"m4":n.uniforms[a].value=(new Pr).fromArray(r.value);break;default:n.uniforms[a].value=r.value}}if(void 0!==e.defines&&(n.defines=e.defines),void 0!==e.vertexShader&&(n.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(n.fragmentShader=e.fragmentShader),void 0!==e.glslVersion&&(n.glslVersion=e.glslVersion),void 0!==e.extensions)for(const s in e.extensions)n.extensions[s]=e.extensions[s];if(void 0!==e.lights&&(n.lights=e.lights),void 0!==e.clipping&&(n.clipping=e.clipping),void 0!==e.size&&(n.size=e.size),void 0!==e.sizeAttenuation&&(n.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(n.map=t(e.map)),void 0!==e.matcap&&(n.matcap=t(e.matcap)),void 0!==e.alphaMap&&(n.alphaMap=t(e.alphaMap)),void 0!==e.bumpMap&&(n.bumpMap=t(e.bumpMap)),void 0!==e.bumpScale&&(n.bumpScale=e.bumpScale),void 0!==e.normalMap&&(n.normalMap=t(e.normalMap)),void 0!==e.normalMapType&&(n.normalMapType=e.normalMapType),void 0!==e.normalScale){let t=e.normalScale;!1===Array.isArray(t)&&(t=[t,t]),n.normalScale=(new Mn).fromArray(t)}return void 0!==e.displacementMap&&(n.displacementMap=t(e.displacementMap)),void 0!==e.displacementScale&&(n.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(n.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(n.roughnessMap=t(e.roughnessMap)),void 0!==e.metalnessMap&&(n.metalnessMap=t(e.metalnessMap)),void 0!==e.emissiveMap&&(n.emissiveMap=t(e.emissiveMap)),void 0!==e.emissiveIntensity&&(n.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(n.specularMap=t(e.specularMap)),void 0!==e.specularIntensityMap&&(n.specularIntensityMap=t(e.specularIntensityMap)),void 0!==e.specularColorMap&&(n.specularColorMap=t(e.specularColorMap)),void 0!==e.envMap&&(n.envMap=t(e.envMap)),void 0!==e.envMapRotation&&n.envMapRotation.fromArray(e.envMapRotation),void 0!==e.envMapIntensity&&(n.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(n.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(n.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(n.lightMap=t(e.lightMap)),void 0!==e.lightMapIntensity&&(n.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(n.aoMap=t(e.aoMap)),void 0!==e.aoMapIntensity&&(n.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(n.gradientMap=t(e.gradientMap)),void 0!==e.clearcoatMap&&(n.clearcoatMap=t(e.clearcoatMap)),void 0!==e.clearcoatRoughnessMap&&(n.clearcoatRoughnessMap=t(e.clearcoatRoughnessMap)),void 0!==e.clearcoatNormalMap&&(n.clearcoatNormalMap=t(e.clearcoatNormalMap)),void 0!==e.clearcoatNormalScale&&(n.clearcoatNormalScale=(new Mn).fromArray(e.clearcoatNormalScale)),void 0!==e.iridescenceMap&&(n.iridescenceMap=t(e.iridescenceMap)),void 0!==e.iridescenceThicknessMap&&(n.iridescenceThicknessMap=t(e.iridescenceThicknessMap)),void 0!==e.transmissionMap&&(n.transmissionMap=t(e.transmissionMap)),void 0!==e.thicknessMap&&(n.thicknessMap=t(e.thicknessMap)),void 0!==e.anisotropyMap&&(n.anisotropyMap=t(e.anisotropyMap)),void 0!==e.sheenColorMap&&(n.sheenColorMap=t(e.sheenColorMap)),void 0!==e.sheenRoughnessMap&&(n.sheenRoughnessMap=t(e.sheenRoughnessMap)),n}setTextures(t){return this.textures=t,this}static createMaterialFromType(t){const e={ShadowMaterial:cg,SpriteMaterial:Hd,RawShaderMaterial:ug,ShaderMaterial:nh,PointsMaterial:um,MeshPhysicalMaterial:pg,MeshStandardMaterial:dg,MeshPhongMaterial:mg,MeshToonMaterial:fg,MeshNormalMaterial:gg,MeshLambertMaterial:vg,MeshDepthMaterial:cd,MeshDistanceMaterial:ud,MeshBasicMaterial:ba,MeshMatcapMaterial:_g,LineDashedMaterial:yg,LineBasicMaterial:Kp,Material:Sa};return new e[t]}}class Sv{static decodeText(i){if(console.warn("THREE.LoaderUtils: decodeText() has been deprecated with r165 and will be removed with r175. Use TextDecoder instead."),"undefined"!=typeof TextDecoder)return(new TextDecoder).decode(i);let n="";for(let t=0,e=i.length;t<e;t++)n+=String.fromCharCode(i[t]);try{return decodeURIComponent(escape(n))}catch(t){return n}}static extractUrlBase(t){var e=t.lastIndexOf("/");return-1===e?"./":t.slice(0,e+1)}static resolveURL(t,e){return"string"!=typeof t||""===t?"":(/^https?:\/\//i.test(e)&&/^\//.test(t)&&(e=e.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:e+t)}}class bv extends Ya{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(t){return super.copy(t),this.instanceCount=t.instanceCount,this}toJSON(){const t=super.toJSON();return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}}class wv extends jg{constructor(t){super(t)}load(e,i,t,n){const r=this,a=new Zg(r.manager);a.setPath(r.path),a.setRequestHeader(r.requestHeader),a.setWithCredentials(r.withCredentials),a.load(e,function(t){try{i(r.parse(JSON.parse(t)))}catch(t){n?n(t):console.error(t),r.manager.itemError(e)}},t,n)}parse(i){const o={},a={};function n(t,e){if(void 0!==o[e])return o[e];var i,n=t.interleavedBuffers[e],r=l(t,n.buffer),a=En(n.type,r);const s=new kd(a,n.stride);return s.uuid=n.uuid,o[e]=s,s}function l(t,e){if(void 0!==a[e])return a[e];var i,n=t.arrayBuffers[e],r=new Uint32Array(n).buffer;return a[e]=r}const r=new(i.isInstancedBufferGeometry?bv:Ya);var t=i.data.index,e;void 0!==t&&(e=En(t.type,t.array),r.setIndex(new Ia(e,1)));var s=i.data.attributes;for(const M in s){var h=s[M];let t;if(h.isInterleavedBufferAttribute){var c=n(i.data,h.data);t=new Gd(c,h.itemSize,h.offset,h.normalized)}else{var u=En(h.type,h.array);const S=h.isInstancedBufferAttribute?bp:Ia;t=new S(u,h.itemSize,h.normalized)}void 0!==h.name&&(t.name=h.name),void 0!==h.usage&&t.setUsage(h.usage),r.setAttribute(M,t)}var d=i.data.morphAttributes,p;if(d)for(const b in d){var m=d[b];const w=[];for(let e=0,t=m.length;e<t;e++){var f=m[e],g,v;let t;t=f.isInterleavedBufferAttribute?(g=n(i.data,f.data),new Gd(g,f.itemSize,f.offset,f.normalized)):(v=En(f.type,f.array),new Ia(v,f.itemSize,f.normalized)),void 0!==f.name&&(t.name=f.name),w.push(t)}r.morphAttributes[b]=w}i.data.morphTargetsRelative&&(r.morphTargetsRelative=!0);var _=i.data.groups||i.data.drawcalls||i.data.offsets;if(void 0!==_)for(let t=0,e=_.length;t!==e;++t){var y=_[t];r.addGroup(y.start,y.count,y.materialIndex)}var x=i.data.boundingSphere;if(void 0!==x){const T=new tr;void 0!==x.center&&T.fromArray(x.center),r.boundingSphere=new Mr(T,x.radius)}return i.name&&(r.name=i.name),i.userData&&(r.userData=i.userData),r}}class Tv extends jg{constructor(t){super(t)}load(n,r,t,a){const s=this;var e=""===this.path?Sv.extractUrlBase(n):this.path;this.resourcePath=this.resourcePath||e;const i=new Zg(this.manager);i.setPath(this.path),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials),i.load(n,function(t){let e=null;try{e=JSON.parse(t)}catch(t){return void 0!==a&&a(t),void console.error("THREE:ObjectLoader: Can't parse "+n+".",t.message)}const i=e.metadata;if(void 0===i||void 0===i.type||"geometry"===i.type.toLowerCase())return void 0!==a&&a(new Error("THREE.ObjectLoader: Can't load "+n)),void console.error("THREE.ObjectLoader: Can't load "+n);s.parse(e,r)},t,a)}async loadAsync(t,e){var i=this,n=""===this.path?Sv.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||n;const r=new Zg(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials);var a=await r.loadAsync(t,e),s=JSON.parse(a);const o=s.metadata;if(void 0===o||void 0===o.type||"geometry"===o.type.toLowerCase())throw new Error("THREE.ObjectLoader: Can't load "+t);return i.parseAsync(s)}parse(t,e){var i=this.parseAnimations(t.animations),n=this.parseShapes(t.shapes),r=this.parseGeometries(t.geometries,n),a=this.parseImages(t.images,function(){void 0!==e&&e(l)}),s=this.parseTextures(t.textures,a),o=this.parseMaterials(t.materials,s);const l=this.parseObject(t.object,r,o,s,i);var h=this.parseSkeletons(t.skeletons,l);if(this.bindSkeletons(l,h),this.bindLightTargets(l),void 0!==e){let t=!1;for(const c in a)if(a[c].data instanceof HTMLImageElement){t=!0;break}!1===t&&e(l)}return l}async parseAsync(t){var e=this.parseAnimations(t.animations),i=this.parseShapes(t.shapes),n=this.parseGeometries(t.geometries,i),r=await this.parseImagesAsync(t.images),a=this.parseTextures(t.textures,r),s=this.parseMaterials(t.materials,a),o=this.parseObject(t.object,n,s,a,e),l=this.parseSkeletons(t.skeletons,o);return this.bindSkeletons(o,l),this.bindLightTargets(o),o}parseShapes(i){const n={};if(void 0!==i)for(let t=0,e=i.length;t<e;t++){var r=(new df).fromJSON(i[t]);n[r.uuid]=r}return n}parseSkeletons(i,t){const n={},r={};if(t.traverse(function(t){t.isBone&&(r[t.uuid]=t)}),void 0!==i)for(let t=0,e=i.length;t<e;t++){var a=(new Sp).fromJSON(i[t],r);n[a.uuid]=a}return n}parseGeometries(i,n){const r={};if(void 0!==i){const s=new wv;for(let e=0,t=i.length;e<t;e++){let t;var a=i[e];switch(a.type){case"BufferGeometry":case"InstancedBufferGeometry":t=s.parse(a);break;default:a.type in hg?t=hg[a.type].fromJSON(a,n):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${a.type}"`)}t.uuid=a.uuid,void 0!==a.name&&(t.name=a.name),void 0!==a.userData&&(t.userData=a.userData),r[a.uuid]=t}}return r}parseMaterials(i,t){const n={},r={};if(void 0!==i){const s=new Mv;s.setTextures(t);for(let t=0,e=i.length;t<e;t++){var a=i[t];void 0===n[a.uuid]&&(n[a.uuid]=s.parse(a)),r[a.uuid]=n[a.uuid]}}return r}parseAnimations(e){const i={};if(void 0!==e)for(let t=0;t<e.length;t++){var n=e[t],r=kg.parse(n);i[r.uuid]=r}return i}parseImages(i,t){const n=this,r={};let e;function a(t){return n.manager.itemStart(t),e.load(t,function(){n.manager.itemEnd(t)},void 0,function(){n.manager.itemError(t),n.manager.itemEnd(t)})}function s(t){if("string"!=typeof t)return t.data?{data:En(t.type,t.data),width:t.width,height:t.height}:null;var e=t,i;return a(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(e)?e:n.resourcePath+e)}if(void 0!==i&&0<i.length){var o=new Wg(t);e=new $g(o),e.setCrossOrigin(this.crossOrigin);for(let t=0,e=i.length;t<e;t++){var l=i[t],h=l.url;if(Array.isArray(h)){const p=[];for(let t=0,e=h.length;t<e;t++){var c,u=s(h[t]);null!==u&&(u instanceof HTMLImageElement?p.push(u):p.push(new yp(u.data,u.width,u.height)))}r[l.uuid]=new Gn(p)}else{var d=s(l.url);r[l.uuid]=new Gn(d)}}}return r}async parseImagesAsync(i){const n=this,r={};let a;async function s(t){if("string"!=typeof t)return t.data?{data:En(t.type,t.data),width:t.width,height:t.height}:null;var e=t,i=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(e)?e:n.resourcePath+e;return a.loadAsync(i)}if(void 0!==i&&0<i.length){a=new $g(this.manager),a.setCrossOrigin(this.crossOrigin);for(let t=0,e=i.length;t<e;t++){var o=i[t],l=o.url;if(Array.isArray(l)){const d=[];for(let t=0,e=l.length;t<e;t++){var h,c=await s(l[t]);null!==c&&(c instanceof HTMLImageElement?d.push(c):d.push(new yp(c.data,c.width,c.height)))}r[o.uuid]=new Gn(d)}else{var u=await s(o.url);r[o.uuid]=new Gn(u)}}}return r}parseTextures(i,n){function r(t,e){return"number"==typeof t?t:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",t),e[t])}const a={};if(void 0!==i)for(let e=0,t=i.length;e<t;e++){var s=i[e];void 0===s.image&&console.warn('THREE.ObjectLoader: No "image" specified for',s.uuid),void 0===n[s.image]&&console.warn("THREE.ObjectLoader: Undefined image",s.image);var o=n[s.image],l=o.data;let t;Array.isArray(l)?(t=new dh,6===l.length&&(t.needsUpdate=!0)):(t=new(l&&l.data?yp:Xn),l&&(t.needsUpdate=!0)),t.source=o,t.uuid=s.uuid,void 0!==s.name&&(t.name=s.name),void 0!==s.mapping&&(t.mapping=r(s.mapping,Ev)),void 0!==s.channel&&(t.channel=s.channel),void 0!==s.offset&&t.offset.fromArray(s.offset),void 0!==s.repeat&&t.repeat.fromArray(s.repeat),void 0!==s.center&&t.center.fromArray(s.center),void 0!==s.rotation&&(t.rotation=s.rotation),void 0!==s.wrap&&(t.wrapS=r(s.wrap[0],Av),t.wrapT=r(s.wrap[1],Av)),void 0!==s.format&&(t.format=s.format),void 0!==s.internalFormat&&(t.internalFormat=s.internalFormat),void 0!==s.type&&(t.type=s.type),void 0!==s.colorSpace&&(t.colorSpace=s.colorSpace),void 0!==s.minFilter&&(t.minFilter=r(s.minFilter,Cv)),void 0!==s.magFilter&&(t.magFilter=r(s.magFilter,Cv)),void 0!==s.anisotropy&&(t.anisotropy=s.anisotropy),void 0!==s.flipY&&(t.flipY=s.flipY),void 0!==s.generateMipmaps&&(t.generateMipmaps=s.generateMipmaps),void 0!==s.premultiplyAlpha&&(t.premultiplyAlpha=s.premultiplyAlpha),void 0!==s.unpackAlignment&&(t.unpackAlignment=s.unpackAlignment),void 0!==s.compareFunction&&(t.compareFunction=s.compareFunction),void 0!==s.userData&&(t.userData=s.userData),a[s.uuid]=t}return a}parseObject(t,e,a,i,n){let r;function s(t){return void 0===e[t]&&console.warn("THREE.ObjectLoader: Undefined geometry",t),e[t]}function o(i){if(void 0!==i){if(Array.isArray(i)){const r=[];for(let t=0,e=i.length;t<e;t++){var n=i[t];void 0===a[n]&&console.warn("THREE.ObjectLoader: Undefined material",n),r.push(a[n])}return r}return void 0===a[i]&&console.warn("THREE.ObjectLoader: Undefined material",i),a[i]}}function l(t){return void 0===i[t]&&console.warn("THREE.ObjectLoader: Undefined texture",t),i[t]}let h,c;switch(t.type){case"Scene":r=new zd,void 0!==t.background&&(Number.isInteger(t.background)?r.background=new ya(t.background):r.background=l(t.background)),void 0!==t.environment&&(r.environment=l(t.environment)),void 0!==t.fog&&("Fog"===t.fog.type?r.fog=new Fd(t.fog.color,t.fog.near,t.fog.far):"FogExp2"===t.fog.type&&(r.fog=new Bd(t.fog.color,t.fog.density)),""!==t.fog.name&&(r.fog.name=t.fog.name)),void 0!==t.backgroundBlurriness&&(r.backgroundBlurriness=t.backgroundBlurriness),void 0!==t.backgroundIntensity&&(r.backgroundIntensity=t.backgroundIntensity),void 0!==t.backgroundRotation&&r.backgroundRotation.fromArray(t.backgroundRotation),void 0!==t.environmentIntensity&&(r.environmentIntensity=t.environmentIntensity),void 0!==t.environmentRotation&&r.environmentRotation.fromArray(t.environmentRotation);break;case"PerspectiveCamera":r=new lh(t.fov,t.aspect,t.near,t.far),void 0!==t.focus&&(r.focus=t.focus),void 0!==t.zoom&&(r.zoom=t.zoom),void 0!==t.filmGauge&&(r.filmGauge=t.filmGauge),void 0!==t.filmOffset&&(r.filmOffset=t.filmOffset),void 0!==t.view&&(r.view=Object.assign({},t.view));break;case"OrthographicCamera":r=new Oh(t.left,t.right,t.top,t.bottom,t.near,t.far),void 0!==t.zoom&&(r.zoom=t.zoom),void 0!==t.view&&(r.view=Object.assign({},t.view));break;case"AmbientLight":r=new vv(t.color,t.intensity);break;case"DirectionalLight":r=new gv(t.color,t.intensity),r.target=t.target||"";break;case"PointLight":r=new mv(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":r=new _v(t.color,t.intensity,t.width,t.height);break;case"SpotLight":r=new hv(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay),r.target=t.target||"";break;case"HemisphereLight":r=new nv(t.color,t.groundColor,t.intensity);break;case"LightProbe":r=(new xv).fromJSON(t);break;case"SkinnedMesh":h=s(t.geometry),c=o(t.material),r=new vp(h,c),void 0!==t.bindMode&&(r.bindMode=t.bindMode),void 0!==t.bindMatrix&&r.bindMatrix.fromArray(t.bindMatrix),void 0!==t.skeleton&&(r.skeleton=t.skeleton);break;case"Mesh":h=s(t.geometry),c=o(t.material),r=new ds(h,c);break;case"InstancedMesh":h=s(t.geometry),c=o(t.material);var u=t.count,d=t.instanceMatrix,p=t.instanceColor;r=new Ip(h,c,u),r.instanceMatrix=new bp(new Float32Array(d.array),16),void 0!==p&&(r.instanceColor=new bp(new Float32Array(p.array),p.itemSize));break;case"BatchedMesh":h=s(t.geometry),c=o(t.material),r=new Jp(t.maxInstanceCount,t.maxVertexCount,t.maxIndexCount,c),r.geometry=h,r.perObjectFrustumCulled=t.perObjectFrustumCulled,r.sortObjects=t.sortObjects,r._drawRanges=t.drawRanges,r._reservedRanges=t.reservedRanges,r._visibility=t.visibility,r._active=t.active,r._bounds=t.bounds.map(t=>{const e=new nr;e.min.fromArray(t.boxMin),e.max.fromArray(t.boxMax);const i=new Mr;return i.radius=t.sphereRadius,i.center.fromArray(t.sphereCenter),{boxInitialized:t.boxInitialized,box:e,sphereInitialized:t.sphereInitialized,sphere:i}}),r._maxInstanceCount=t.maxInstanceCount,r._maxVertexCount=t.maxVertexCount,r._maxIndexCount=t.maxIndexCount,r._geometryInitialized=t.geometryInitialized,r._geometryCount=t.geometryCount,r._matricesTexture=l(t.matricesTexture.uuid),void 0!==t.colorsTexture&&(r._colorsTexture=l(t.colorsTexture.uuid));break;case"LOD":r=new op;break;case"Line":r=new am(s(t.geometry),o(t.material));break;case"LineLoop":r=new cm(s(t.geometry),o(t.material));break;case"LineSegments":r=new hm(s(t.geometry),o(t.material));break;case"PointCloud":case"Points":r=new gm(s(t.geometry),o(t.material));break;case"Sprite":r=new np(o(t.material));break;case"Group":r=new Td;break;case"Bone":r=new _p;break;default:r=new na}if(r.uuid=t.uuid,void 0!==t.name&&(r.name=t.name),void 0!==t.matrix?(r.matrix.fromArray(t.matrix),void 0!==t.matrixAutoUpdate&&(r.matrixAutoUpdate=t.matrixAutoUpdate),r.matrixAutoUpdate&&r.matrix.decompose(r.position,r.quaternion,r.scale)):(void 0!==t.position&&r.position.fromArray(t.position),void 0!==t.rotation&&r.rotation.fromArray(t.rotation),void 0!==t.quaternion&&r.quaternion.fromArray(t.quaternion),void 0!==t.scale&&r.scale.fromArray(t.scale)),void 0!==t.up&&r.up.fromArray(t.up),void 0!==t.castShadow&&(r.castShadow=t.castShadow),void 0!==t.receiveShadow&&(r.receiveShadow=t.receiveShadow),t.shadow&&(void 0!==t.shadow.intensity&&(r.shadow.intensity=t.shadow.intensity),void 0!==t.shadow.bias&&(r.shadow.bias=t.shadow.bias),void 0!==t.shadow.normalBias&&(r.shadow.normalBias=t.shadow.normalBias),void 0!==t.shadow.radius&&(r.shadow.radius=t.shadow.radius),void 0!==t.shadow.mapSize&&r.shadow.mapSize.fromArray(t.shadow.mapSize),void 0!==t.shadow.camera&&(r.shadow.camera=this.parseObject(t.shadow.camera))),void 0!==t.visible&&(r.visible=t.visible),void 0!==t.frustumCulled&&(r.frustumCulled=t.frustumCulled),void 0!==t.renderOrder&&(r.renderOrder=t.renderOrder),void 0!==t.userData&&(r.userData=t.userData),void 0!==t.layers&&(r.layers.mask=t.layers),void 0!==t.children){var m=t.children;for(let t=0;t<m.length;t++)r.add(this.parseObject(m[t],e,a,i,n))}if(void 0!==t.animations){var f=t.animations;for(let t=0;t<f.length;t++){var g=f[t];r.animations.push(n[g])}}if("LOD"===t.type){void 0!==t.autoUpdate&&(r.autoUpdate=t.autoUpdate);var v=t.levels;for(let t=0;t<v.length;t++){var _=v[t],y=r.getObjectByProperty("uuid",_.object);void 0!==y&&r.addLevel(y,_.distance,_.hysteresis)}}return r}bindSkeletons(t,i){0!==Object.keys(i).length&&t.traverse(function(t){var e;!0===t.isSkinnedMesh&&void 0!==t.skeleton&&(void 0===(e=i[t.skeleton])?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",t.skeleton):t.bind(e,t.bindMatrix))})}bindLightTargets(n){n.traverse(function(t){var e,i;(t.isDirectionalLight||t.isSpotLight)&&(e=t.target,i=n.getObjectByProperty("uuid",e),t.target=void 0!==i?i:new na)})}}const Ev={UVMapping:S,CubeReflectionMapping:b,CubeRefractionMapping:w,EquirectangularReflectionMapping:T,EquirectangularRefractionMapping:C,CubeUVReflectionMapping:_t},Av={RepeatWrapping:it,ClampToEdgeWrapping:nt,MirroredRepeatWrapping:rt},Cv={NearestFilter:at,NearestMipmapNearestFilter:st,NearestMipmapLinearFilter:ot,LinearFilter:lt,LinearMipmapNearestFilter:ht,LinearMipmapLinearFilter:le};class Rv extends jg{constructor(t){super(t),this.isImageBitmapLoader=!0,"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(t){return this.options=t,this}load(e,i,t,n){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,a=Hg.get(e);if(void 0!==a)return r.manager.itemStart(e),a.then?void a.then(t=>{i&&i(t),r.manager.itemEnd(e)}).catch(t=>{n&&n(t)}):(setTimeout(function(){i&&i(a),r.manager.itemEnd(e)},0),a);const s={};s.credentials="anonymous"===this.crossOrigin?"same-origin":"include",s.headers=this.requestHeader;var o=fetch(e,s).then(function(t){return t.blob()}).then(function(t){return createImageBitmap(t,Object.assign(r.options,{colorSpaceConversion:"none"}))}).then(function(t){return Hg.add(e,t),i&&i(t),r.manager.itemEnd(e),t}).catch(function(t){n&&n(t),Hg.remove(e),r.manager.itemError(e),r.manager.itemEnd(e)});Hg.add(e,o),r.manager.itemStart(e)}}let Pv;class Iv{static getContext(){return void 0===Pv&&(Pv=new(window.AudioContext||window.webkitAudioContext)),Pv}static setContext(t){Pv=t}}class Lv extends jg{constructor(t){super(t)}load(e,n,t,i){const r=this,a=new Zg(this.manager);function s(t){i?i(t):console.error(t),r.manager.itemError(e)}a.setResponseType("arraybuffer"),a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(t){try{var e=t.slice(0);const i=Iv.getContext();i.decodeAudioData(e,function(t){n(t)}).catch(s)}catch(t){s(t)}},t,i)}}const Uv=new Pr,Nv=new Pr,Dv=new Pr;class Ov{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new lh,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new lh,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(t){const e=this._cache;var i,n,r,a,s,o;e.focus===t.focus&&e.fov===t.fov&&e.aspect===t.aspect*this.aspect&&e.near===t.near&&e.far===t.far&&e.zoom===t.zoom&&e.eyeSep===this.eyeSep||(e.focus=t.focus,e.fov=t.fov,e.aspect=t.aspect*this.aspect,e.near=t.near,e.far=t.far,e.zoom=t.zoom,e.eyeSep=this.eyeSep,Dv.copy(t.projectionMatrix),r=(n=e.eyeSep/2)*e.near/e.focus,a=e.near*Math.tan(Zi*e.fov*.5)/e.zoom,Nv.elements[12]=-n,Uv.elements[12]=n,s=-a*e.aspect+r,o=a*e.aspect+r,Dv.elements[0]=2*e.near/(o-s),Dv.elements[8]=(o+s)/(o-s),this.cameraL.projectionMatrix.copy(Dv),s=-a*e.aspect-r,o=a*e.aspect-r,Dv.elements[0]=2*e.near/(o-s),Dv.elements[8]=(o+s)/(o-s),this.cameraR.projectionMatrix.copy(Dv)),this.cameraL.matrixWorld.copy(t.matrixWorld).multiply(Nv),this.cameraR.matrixWorld.copy(t.matrixWorld).multiply(Uv)}}class Bv{constructor(t=!0){this.autoStart=t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=Fv(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;return this.autoStart&&!this.running?(this.start(),0):(this.running&&(e=Fv(),t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t),t);var e}}function Fv(){return("undefined"==typeof performance?Date:performance).now()}const zv=new tr,kv=new Qn,Vv=new tr,Gv=new tr;class Hv extends na{constructor(){super(),this.type="AudioListener",this.context=Iv.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Bv}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(t){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=t,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}updateMatrixWorld(t){super.updateMatrixWorld(t);const e=this.context.listener;var i=this.up,n;this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(zv,kv,Vv),Gv.set(0,0,-1).applyQuaternion(kv),e.positionX?(n=this.context.currentTime+this.timeDelta,e.positionX.linearRampToValueAtTime(zv.x,n),e.positionY.linearRampToValueAtTime(zv.y,n),e.positionZ.linearRampToValueAtTime(zv.z,n),e.forwardX.linearRampToValueAtTime(Gv.x,n),e.forwardY.linearRampToValueAtTime(Gv.y,n),e.forwardZ.linearRampToValueAtTime(Gv.z,n),e.upX.linearRampToValueAtTime(i.x,n),e.upY.linearRampToValueAtTime(i.y,n),e.upZ.linearRampToValueAtTime(i.z,n)):(e.setPosition(zv.x,zv.y,zv.z),e.setOrientation(Gv.x,Gv.y,Gv.z,i.x,i.y,i.z))}}class Wv extends na{constructor(t){super(),this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this}setMediaElementSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this}setMediaStreamSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(t),this.connect(),this}setBuffer(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this}play(t=0){if(!0!==this.isPlaying){if(!1!==this.hasPlaybackControl){this._startedAt=this.context.currentTime+t;const e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.loopStart=this.loopStart,e.loopEnd=this.loopEnd,e.onended=this.onEnded.bind(this),e.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}console.warn("THREE.Audio: this Audio has no playback control.")}else console.warn("THREE.Audio: Audio is already playing.")}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,null!==this.source&&(this.source.stop(),this.source.onended=null),this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(0<this.filters.length){this.source.connect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(!1!==this._connected){if(0<this.filters.length){this.source.disconnect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(t){return t=t||[],!0===this._connected?(this.disconnect(),this.filters=t.slice(),this.connect()):this.filters=t.slice(),this}setDetune(t){return this.detune=t,!0===this.isPlaying&&void 0!==this.source.detune&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(t){return this.setFilters(t?[t]:[])}setPlaybackRate(t){if(!1!==this.hasPlaybackControl)return this.playbackRate=t,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(t){if(!1!==this.hasPlaybackControl)return this.loop=t,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(t){return this.loopStart=t,this}setLoopEnd(t){return this.loopEnd=t,this}getVolume(){return this.gain.gain.value}setVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}}const Xv=new tr,jv=new Qn,qv=new tr,Yv=new tr;class Zv extends Wv{constructor(t){super(t),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){super.connect(),this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(t){return this.panner.refDistance=t,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(t){return this.panner.rolloffFactor=t,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(t){return this.panner.distanceModel=t,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(t){return this.panner.maxDistance=t,this}setDirectionalCone(t,e,i){return this.panner.coneInnerAngle=t,this.panner.coneOuterAngle=e,this.panner.coneOuterGain=i,this}updateMatrixWorld(t){if(super.updateMatrixWorld(t),!0!==this.hasPlaybackControl||!1!==this.isPlaying){this.matrixWorld.decompose(Xv,jv,qv),Yv.set(0,0,1).applyQuaternion(jv);const i=this.panner;var e;i.positionX?(e=this.context.currentTime+this.listener.timeDelta,i.positionX.linearRampToValueAtTime(Xv.x,e),i.positionY.linearRampToValueAtTime(Xv.y,e),i.positionZ.linearRampToValueAtTime(Xv.z,e),i.orientationX.linearRampToValueAtTime(Yv.x,e),i.orientationY.linearRampToValueAtTime(Yv.y,e),i.orientationZ.linearRampToValueAtTime(Yv.z,e)):(i.setPosition(Xv.x,Xv.y,Xv.z),i.setOrientation(Yv.x,Yv.y,Yv.z))}}}class Jv{constructor(t,e=2048){this.analyser=t.context.createAnalyser(),this.analyser.fftSize=e,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;var i=this.getFrequencyData();for(let t=0;t<i.length;t++)e+=i[t];return e/i.length}}class Kv{constructor(t,e,i){this.binding=t,this.valueSize=i;let n,r,a;switch(e){case"quaternion":n=this._slerp,r=this._slerpAdditive,a=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*i),this._workIndex=5;break;case"string":case"bool":n=this._select,r=this._select,a=this._setAdditiveIdentityOther,this.buffer=new Array(5*i);break;default:n=this._lerp,r=this._lerpAdditive,a=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*i)}this._mixBufferRegion=n,this._mixBufferRegionAdditive=r,this._setIdentity=a,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(t,e){const i=this.buffer,n=this.valueSize,r=t*n+n;let a=this.cumulativeWeight;if(0===a){for(let t=0;t!==n;++t)i[r+t]=i[t];a=e}else{a+=e;var s=e/a;this._mixBufferRegion(i,r,0,s,n)}this.cumulativeWeight=a}accumulateAdditive(t){var e=this.buffer,i=this.valueSize,n=i*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(e,n,0,t,i),this.cumulativeWeightAdditive+=t}apply(t){const i=this.valueSize,n=this.buffer,r=t*i+i,e=this.cumulativeWeight,a=this.cumulativeWeightAdditive,s=this.binding;var o;this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,e<1&&(o=i*this._origIndex,this._mixBufferRegion(n,r,o,1-e,i)),0<a&&this._mixBufferRegionAdditive(n,r,this._addIndex*i,1,i);for(let t=i,e=i+i;t!==e;++t)if(n[t]!==n[t+i]){s.setValue(n,r);break}}saveOriginalState(){const t=this.binding,i=this.buffer,n=this.valueSize,r=n*this._origIndex;t.getValue(i,r);for(let t=n,e=r;t!==e;++t)i[t]=i[r+t%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){var t=3*this.valueSize;this.binding.setValue(this.buffer,t)}_setAdditiveIdentityNumeric(){var e=this._addIndex*this.valueSize,i=e+this.valueSize;for(let t=e;t<i;t++)this.buffer[t]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){var e=this._origIndex*this.valueSize,i=this._addIndex*this.valueSize;for(let t=0;t<this.valueSize;t++)this.buffer[i+t]=this.buffer[e+t]}_select(e,i,n,t,r){if(.5<=t)for(let t=0;t!==r;++t)e[i+t]=e[n+t]}_slerp(t,e,i,n){Qn.slerpFlat(t,e,t,e,t,i,n)}_slerpAdditive(t,e,i,n,r){var a=this._workIndex*r;Qn.multiplyQuaternionsFlat(t,a,t,e,t,i),Qn.slerpFlat(t,e,t,e,t,a,n)}_lerp(e,i,n,r,a){var s=1-r;for(let t=0;t!==a;++t){var o=i+t;e[o]=e[o]*s+e[n+t]*r}}_lerpAdditive(e,i,n,r,a){for(let t=0;t!==a;++t){var s=i+t;e[s]=e[s]+e[n+t]*r}}}var $v="\\[\\]\\.:\\/";const Qv=new RegExp("["+$v+"]","g");var t0="[^"+$v+"]",e0="[^"+$v.replace("\\.","")+"]",i0,n0,r0,a0;const s0=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",t0)+/(WCOD+)?/.source.replace("WCOD",e0)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",t0)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",t0)+"$"),o0=["material","materials","bones","map"];class l0{constructor(t,e,i){var n=i||h0.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,n)}getValue(t,e){this.bind();const i=this._targetGroup.nCachedObjects_,n=this._bindings[i];void 0!==n&&n.getValue(t,e)}setValue(i,n){const r=this._bindings;for(let t=this._targetGroup.nCachedObjects_,e=r.length;t!==e;++t)r[t].setValue(i,n)}bind(){const i=this._bindings;for(let t=this._targetGroup.nCachedObjects_,e=i.length;t!==e;++t)i[t].bind()}unbind(){const i=this._bindings;for(let t=this._targetGroup.nCachedObjects_,e=i.length;t!==e;++t)i[t].unbind()}}class h0{constructor(t,e,i){this.path=e,this.parsedPath=i||h0.parseTrackName(e),this.node=h0.findNode(t,this.parsedPath.nodeName),this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,e,i){return new(t&&t.isAnimationObjectGroup?h0.Composite:h0)(t,e,i)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(Qv,"")}static parseTrackName(t){var e=s0.exec(t);if(null===e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const i={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]};var n=i.nodeName&&i.nodeName.lastIndexOf("."),r;if(void 0!==n&&-1!==n&&(r=i.nodeName.substring(n+1),-1!==o0.indexOf(r)&&(i.nodeName=i.nodeName.substring(0,n),i.objectName=r)),null===i.propertyName||0===i.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return i}static findNode(t,r){if(void 0===r||""===r||"."===r||-1===r||r===t.name||r===t.uuid)return t;if(t.skeleton){var e=t.skeleton.getBoneByName(r);if(void 0!==e)return e}if(t.children){const a=function(e){for(let t=0;t<e.length;t++){var i=e[t];if(i.name===r||i.uuid===r)return i;var n=a(i.children);if(n)return n}return null};var i=a(t.children);if(i)return i}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,e){t[e]=this.targetObject[this.propertyName]}_getValue_array(i,n){var r=this.resolvedProperty;for(let t=0,e=r.length;t!==e;++t)i[n++]=r[t]}_getValue_arrayElement(t,e){t[e]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,e){this.resolvedProperty.toArray(t,e)}_setValue_direct(t,e){this.targetObject[this.propertyName]=t[e]}_setValue_direct_setNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(i,n){const r=this.resolvedProperty;for(let t=0,e=r.length;t!==e;++t)r[t]=i[n++]}_setValue_array_setNeedsUpdate(i,n){const r=this.resolvedProperty;for(let t=0,e=r.length;t!==e;++t)r[t]=i[n++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(i,n){const r=this.resolvedProperty;for(let t=0,e=r.length;t!==e;++t)r[t]=i[n++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,e){this.resolvedProperty[this.propertyIndex]=t[e]}_setValue_arrayElement_setNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,e){this.resolvedProperty.fromArray(t,e)}_setValue_fromArray_setNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,e){this.bind(),this.getValue(t,e)}_setValue_unbound(t,e){this.bind(),this.setValue(t,e)}bind(){let i=this.node;var t=this.parsedPath,n=t.objectName,r=t.propertyName;let a=t.propertyIndex;if(i||(i=h0.findNode(this.rootNode,t.nodeName),this.node=i),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,i){if(n){let e=t.objectIndex;switch(n){case"materials":if(!i.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!i.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);i=i.material.materials;break;case"bones":if(!i.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);i=i.skeleton.bones;for(let t=0;t<i.length;t++)if(i[t].name===e){e=t;break}break;case"map":if("map"in i){i=i.map;break}if(!i.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!i.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);i=i.material.map;break;default:if(void 0===i[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);i=i[n]}if(void 0!==e){if(void 0===i[e])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,i);i=i[e]}}var s=i[r];if(void 0!==s){let t=this.Versioning.None;this.targetObject=i,void 0!==i.needsUpdate?t=this.Versioning.NeedsUpdate:void 0!==i.matrixWorldNeedsUpdate&&(t=this.Versioning.MatrixWorldNeedsUpdate);let e=this.BindingType.Direct;if(void 0!==a){if("morphTargetInfluences"===r){if(!i.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!i.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==i.morphTargetDictionary[a]&&(a=i.morphTargetDictionary[a])}e=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=a}else void 0!==s.fromArray&&void 0!==s.toArray?(e=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(e=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=r;this.getValue=this.GetterByBindingType[e],this.setValue=this.SetterByBindingTypeAndVersioning[e][t]}else{var e=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+e+"."+r+" but it wasn't found.",i)}}else console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".")}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}h0.Composite=l0,h0.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},h0.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},h0.prototype.GetterByBindingType=[h0.prototype._getValue_direct,h0.prototype._getValue_array,h0.prototype._getValue_arrayElement,h0.prototype._getValue_toArray],h0.prototype.SetterByBindingTypeAndVersioning=[[h0.prototype._setValue_direct,h0.prototype._setValue_direct_setNeedsUpdate,h0.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[h0.prototype._setValue_array,h0.prototype._setValue_array_setNeedsUpdate,h0.prototype._setValue_array_setMatrixWorldNeedsUpdate],[h0.prototype._setValue_arrayElement,h0.prototype._setValue_arrayElement_setNeedsUpdate,h0.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[h0.prototype._setValue_fromArray,h0.prototype._setValue_fromArray_setNeedsUpdate,h0.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class c0{constructor(){this.isAnimationObjectGroup=!0,this.uuid=Ki(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const i={};this._indicesByUUID=i;for(let t=0,e=arguments.length;t!==e;++t)i[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){const n=this._objects,r=this._indicesByUUID,a=this._paths,s=this._parsedPaths,o=this._bindings,l=o.length;let h=void 0,c=n.length,u=this.nCachedObjects_;for(let t=0,e=arguments.length;t!==e;++t){var d=arguments[t],p=d.uuid;let i=r[p];if(void 0===i){i=c++,r[p]=i,n.push(d);for(let t=0,e=l;t!==e;++t)o[t].push(new h0(d,a[t],s[t]))}else if(i<u){h=n[i];var m=--u,f=n[m];r[f.uuid]=i,n[i]=f,r[p]=m,n[m]=d;for(let e=0,t=l;e!==t;++e){const g=o[e],v=g[m];let t=g[i];g[i]=v,void 0===t&&(t=new h0(d,a[e],s[e])),g[m]=t}}else n[i]!==h&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=u}remove(){const i=this._objects,n=this._indicesByUUID,r=this._bindings,a=r.length;let s=this.nCachedObjects_;for(let t=0,e=arguments.length;t!==e;++t){var o=arguments[t],l=o.uuid,h=n[l];if(void 0!==h&&h>=s){var c=s++,u=i[c];n[u.uuid]=h,i[h]=u,n[l]=c,i[c]=o;for(let t=0,e=a;t!==e;++t){const d=r[t],p=d[c],m=d[h];d[h]=p,d[c]=m}}}this.nCachedObjects_=s}uncache(){const i=this._objects,n=this._indicesByUUID,r=this._bindings,a=r.length;let s=this.nCachedObjects_,o=i.length;for(let t=0,e=arguments.length;t!==e;++t){var l,h=arguments[t].uuid,c=n[h];if(void 0!==c)if(delete n[h],c<s){var u=--s,d=i[u],p=--o,m=i[p];n[d.uuid]=c,i[c]=d,n[m.uuid]=u,i[u]=m,i.pop();for(let t=0,e=a;t!==e;++t){const v=r[t],_=v[u],y=v[p];v[c]=_,v[u]=y,v.pop()}}else{var f=--o,g=i[f];0<f&&(n[g.uuid]=c),i[c]=g,i.pop();for(let t=0,e=a;t!==e;++t){const x=r[t];x[c]=x[f],x.pop()}}}this.nCachedObjects_=s}subscribe_(i,n){const t=this._bindingsIndicesByPath;let e=t[i];const r=this._bindings;if(void 0!==e)return r[e];const a=this._paths,s=this._parsedPaths,o=this._objects,l=o.length,h=this.nCachedObjects_,c=new Array(l);e=r.length,t[i]=e,a.push(i),s.push(n),r.push(c);for(let t=h,e=o.length;t!==e;++t){var u=o[t];c[t]=new h0(u,i,n)}return c}unsubscribe_(t){const e=this._bindingsIndicesByPath,i=e[t];if(void 0!==i){const n=this._paths,r=this._parsedPaths,a=this._bindings,s=a.length-1,o=a[s],l=t[s];e[l]=i,a[i]=o,a.pop(),r[i]=r[s],r.pop(),n[i]=n[s],n.pop()}}}class u0{constructor(t,e,i=null,n=e.blendMode){this._mixer=t,this._clip=e,this._localRoot=i,this.blendMode=n;const r=e.tracks,a=r.length,s=new Array(a);var o={endingStart:ke,endingEnd:ke};for(let t=0;t!==a;++t){const l=r[t].createInterpolant(null);s[t]=l,l.settings=o}this._interpolantSettings=o,this._interpolants=s,this._propertyBindings=new Array(a),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=De,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(t){return this._startTime=t,this}setLoop(t,e){return this.loop=t,this.repetitions=e,this}setEffectiveWeight(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(t){return this._scheduleFading(t,0,1)}fadeOut(t){return this._scheduleFading(t,1,0)}crossFadeFrom(t,e,i){var n,r,a,s;return t.fadeOut(e),this.fadeIn(e),i&&(s=(n=this._clip.duration)/(r=t._clip.duration),t.warp(1,r/n,e),this.warp(s,1,e)),this}crossFadeTo(t,e,i){return t.crossFadeFrom(this,e,i)}stopFading(){var t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}setEffectiveTimeScale(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(t){return this.timeScale=this._clip.duration/t,this.stopWarping()}syncWith(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()}halt(t){return this.warp(this._effectiveTimeScale,0,t)}warp(t,e,i){const n=this._mixer,r=n.time,a=this.timeScale;let s=this._timeScaleInterpolant;null===s&&(s=n._lendControlInterpolant(),this._timeScaleInterpolant=s);const o=s.parameterPositions,l=s.sampleValues;return o[0]=r,o[1]=r+i,l[0]=t/a,l[1]=e/a,this}stopWarping(){var t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(t,e,i,n){if(this.enabled){var r=this._startTime,a;null!==r&&(e=(a=(t-r)*i)<0||0===i?0:(this._startTime=null,i*a)),e*=this._updateTimeScale(t);var s=this._updateTime(e),o=this._updateWeight(t);if(0<o){const l=this._interpolants,h=this._propertyBindings;if(this.blendMode===We)for(let t=0,e=l.length;t!==e;++t)l[t].evaluate(s),h[t].accumulateAdditive(o);else{He;for(let t=0,e=l.length;t!==e;++t)l[t].evaluate(s),h[t].accumulate(n,o)}}}else this._updateWeight(t)}_updateWeight(t){let e=0;if(this.enabled){e=this.weight;const n=this._weightInterpolant;var i;null!==n&&(i=n.evaluate(t)[0],e*=i,t>n.parameterPositions[1]&&(this.stopFading(),0===i&&(this.enabled=!1)))}return this._effectiveWeight=e,e}_updateTimeScale(t){let e=0;if(!this.paused){e=this.timeScale;const n=this._timeScaleInterpolant;var i;null!==n&&(i=n.evaluate(t)[0],e*=i,t>n.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e))}return this._effectiveTimeScale=e,e}_updateTime(t){var e=this._clip.duration,i=this.loop;let n=this.time+t,r=this._loopCount;var a=i===Oe,s,o,l;if(0===t)return-1!==r&&a&&1==(1&r)?e-n:n;if(i===Ne){-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(n>=e)n=e;else{if(!(n<0)){this.time=n;break t}n=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(-1===r&&(0<=t?(r=0,this._setEndings(!0,0===this.repetitions,a)):this._setEndings(0===this.repetitions,!0,a)),n>=e||n<0?(s=Math.floor(n/e),n-=e*s,r+=Math.abs(s),(o=this.repetitions-r)<=0?(this.clampWhenFinished?this.paused=!0:this.enabled=!1,n=0<t?e:0,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:0<t?1:-1})):(1==o?this._setEndings(l=t<0,!l,a):this._setEndings(!1,!1,a),this._loopCount=r,this.time=n,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:s}))):this.time=n,a&&1==(1&r))return e-n}return n}_setEndings(t,e,i){const n=this._interpolantSettings;i?(n.endingStart=Ve,n.endingEnd=Ve):(n.endingStart=t?this.zeroSlopeAtStart?Ve:ke:Ge,n.endingEnd=e?this.zeroSlopeAtEnd?Ve:ke:Ge)}_scheduleFading(t,e,i){const n=this._mixer,r=n.time;let a=this._weightInterpolant;null===a&&(a=n._lendControlInterpolant(),this._weightInterpolant=a);const s=a.parameterPositions,o=a.sampleValues;return s[0]=r,o[0]=e,s[1]=r+t,o[1]=i,this}}const d0=new Float32Array(1);class p0 extends ji{constructor(t){super(),this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(t,i){const n=t._localRoot||this._root,r=t._clip.tracks,a=r.length,s=t._propertyBindings,o=t._interpolants,l=n.uuid,e=this._bindingsByRootAndName;let h=e[l];void 0===h&&(h={},e[l]=h);for(let e=0;e!==a;++e){const u=r[e],d=u.name;let t=h[d];if(void 0!==t)++t.referenceCount,s[e]=t;else{if(t=s[e],void 0!==t){null===t._cacheIndex&&(++t.referenceCount,this._addInactiveBinding(t,l,d));continue}var c=i&&i._propertyBindings[e].binding.parsedPath;t=new Kv(h0.create(n,d,c),u.ValueTypeName,u.getValueSize()),++t.referenceCount,this._addInactiveBinding(t,l,d),s[e]=t}o[e].resultBuffer=t.buffer}}_activateAction(t){if(!this._isActiveAction(t)){var e,i,n;null===t._cacheIndex&&(e=(t._localRoot||this._root).uuid,i=t._clip.uuid,n=this._actionsByClip[i],this._bindAction(t,n&&n.knownActions[0]),this._addInactiveAction(t,i,e));var r=t._propertyBindings;for(let t=0,e=r.length;t!==e;++t){const a=r[t];0==a.useCount++&&(this._lendBinding(a),a.saveOriginalState())}this._lendAction(t)}}_deactivateAction(t){if(this._isActiveAction(t)){var i=t._propertyBindings;for(let t=0,e=i.length;t!==e;++t){const n=i[t];0==--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(t)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}}_isActiveAction(t){var e=t._cacheIndex;return null!==e&&e<this._nActiveActions}_addInactiveAction(t,e,i){const n=this._actions,r=this._actionsByClip;let a=r[e];if(void 0===a)a={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,r[e]=a;else{const s=a.knownActions;t._byClipCacheIndex=s.length,s.push(t)}t._cacheIndex=n.length,n.push(t),a.actionByRoot[i]=t}_removeInactiveAction(t){const e=this._actions,i=e[e.length-1],n=t._cacheIndex;i._cacheIndex=n,e[n]=i,e.pop(),t._cacheIndex=null;const r=t._clip.uuid,a=this._actionsByClip,s=a[r],o=s.knownActions,l=o[o.length-1],h=t._byClipCacheIndex;l._byClipCacheIndex=h,o[h]=l,o.pop(),t._byClipCacheIndex=null;const c=s.actionByRoot,u=(t._localRoot||this._root).uuid;delete c[u],0===o.length&&delete a[r],this._removeInactiveBindingsForAction(t)}_removeInactiveBindingsForAction(t){var i=t._propertyBindings;for(let t=0,e=i.length;t!==e;++t){const n=i[t];0==--n.referenceCount&&this._removeInactiveBinding(n)}}_lendAction(t){const e=this._actions,i=t._cacheIndex,n=this._nActiveActions++,r=e[n];t._cacheIndex=n,e[n]=t,r._cacheIndex=i,e[i]=r}_takeBackAction(t){const e=this._actions,i=t._cacheIndex,n=--this._nActiveActions,r=e[n];t._cacheIndex=n,e[n]=t,r._cacheIndex=i,e[i]=r}_addInactiveBinding(t,e,i){const n=this._bindingsByRootAndName,r=this._bindings;let a=n[e];void 0===a&&(a={},n[e]=a),(a[i]=t)._cacheIndex=r.length,r.push(t)}_removeInactiveBinding(t){const e=this._bindings,i=t.binding,n=i.rootNode.uuid,r=i.path,a=this._bindingsByRootAndName,s=a[n],o=e[e.length-1],l=t._cacheIndex;o._cacheIndex=l,e[l]=o,e.pop(),delete s[r],0===Object.keys(s).length&&delete a[n]}_lendBinding(t){const e=this._bindings,i=t._cacheIndex,n=this._nActiveBindings++,r=e[n];t._cacheIndex=n,e[n]=t,r._cacheIndex=i,e[i]=r}_takeBackBinding(t){const e=this._bindings,i=t._cacheIndex,n=--this._nActiveBindings,r=e[n];t._cacheIndex=n,e[n]=t,r._cacheIndex=i,e[i]=r}_lendControlInterpolant(){const t=this._controlInterpolants,e=this._nActiveControlInterpolants++;let i=t[e];return void 0===i&&(i=new Pg(new Float32Array(2),new Float32Array(2),1,d0),i.__cacheIndex=e,t[e]=i),i}_takeBackControlInterpolant(t){const e=this._controlInterpolants,i=t.__cacheIndex,n=--this._nActiveControlInterpolants,r=e[n];t.__cacheIndex=n,e[n]=t,r.__cacheIndex=i,e[i]=r}clipAction(t,e,i){var n=e||this._root,r=n.uuid;let a="string"==typeof t?kg.findByName(n,t):t;var s=null!==a?a.uuid:t,o=this._actionsByClip[s];let l=null;if(void 0===i&&(i=null!==a?a.blendMode:He),void 0!==o){var h=o.actionByRoot[r];if(void 0!==h&&h.blendMode===i)return h;l=o.knownActions[0],null===a&&(a=l._clip)}if(null===a)return null;var c=new u0(this,a,e,i);return this._bindAction(c,l),this._addInactiveAction(c,s,r),c}existingAction(t,e){var i=e||this._root,n=i.uuid,r="string"==typeof t?kg.findByName(i,t):t,a=r?r.uuid:t,s=this._actionsByClip[a];return void 0!==s&&s.actionByRoot[n]||null}stopAllAction(){const e=this._actions,i=this._nActiveActions;for(let t=i-1;0<=t;--t)e[t].stop();return this}update(e){e*=this.timeScale;var i=this._actions,n=this._nActiveActions,r=this.time+=e,a=Math.sign(e),s=this._accuIndex^=1;for(let t=0;t!==n;++t){const h=i[t];h._update(r,e,a,s)}const o=this._bindings,l=this._nActiveBindings;for(let t=0;t!==l;++t)o[t].apply(s);return this}setTime(t){for(let t=this.time=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(t)}getRoot(){return this._root}uncacheClip(t){const i=this._actions,e=t.uuid,n=this._actionsByClip,r=n[e];if(void 0!==r){var a=r.knownActions;for(let t=0,e=a.length;t!==e;++t){const s=a[t];this._deactivateAction(s);const o=s._cacheIndex,l=i[i.length-1];s._cacheIndex=null,s._byClipCacheIndex=null,l._cacheIndex=o,i[o]=l,i.pop(),this._removeInactiveBindingsForAction(s)}delete n[e]}}uncacheRoot(t){var e=t.uuid,i=this._actionsByClip;for(const o in i){var n,r=i[o].actionByRoot[e];void 0!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}var a,s=this._bindingsByRootAndName[e];if(void 0!==s)for(const l in s){const h=s[l];h.restoreOriginalState(),this._removeInactiveBinding(h)}}uncacheAction(t,e){var i=this.existingAction(t,e);null!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}}class m0{constructor(t){this.value=t}clone(){return new m0(void 0===this.value.clone?this.value:this.value.clone())}}let f0=0;class g0 extends ji{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:f0++}),this.name="",this.usage=Ui,this.uniforms=[]}add(t){return this.uniforms.push(t),this}remove(t){var e=this.uniforms.indexOf(t);return-1!==e&&this.uniforms.splice(e,1),this}setName(t){return this.name=t,this}setUsage(t){return this.usage=t,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(t){this.name=t.name,this.usage=t.usage;var i=t.uniforms;for(let t=this.uniforms.length=0,e=i.length;t<e;t++){const n=Array.isArray(i[t])?i[t]:[i[t]];for(let t=0;t<n.length;t++)this.uniforms.push(n[t].clone())}return this}clone(){return(new this.constructor).copy(this)}}class v0 extends kd{constructor(t,e,i=1){super(t,e),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=i}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}clone(t){const e=super.clone(t);return e.meshPerAttribute=this.meshPerAttribute,e}toJSON(t){const e=super.toJSON(t);return e.isInstancedInterleavedBuffer=!0,e.meshPerAttribute=this.meshPerAttribute,e}}class _0{constructor(t,e,i,n,r){this.isGLBufferAttribute=!0,this.name="",this.buffer=t,this.type=e,this.itemSize=i,this.elementSize=n,this.count=r,this.version=0}set needsUpdate(t){!0===t&&this.version++}setBuffer(t){return this.buffer=t,this}setType(t,e){return this.type=t,this.elementSize=e,this}setItemSize(t){return this.itemSize=t,this}setCount(t){return this.count=t,this}}const y0=new Pr;class x0{constructor(t,e,i=0,n=1/0){this.ray=new Rr(t,e),this.near=i,this.far=n,this.camera=null,this.layers=new Vr,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(t,e){this.ray.set(t,e)}setFromCamera(t,e){e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type: "+e.type)}setFromXRController(t){return y0.identity().extractRotation(t.matrixWorld),this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(y0),this}intersectObject(t,e=!0,i=[]){return S0(t,this,i,e),i.sort(M0),i}intersectObjects(i,n=!0,r=[]){for(let t=0,e=i.length;t<e;t++)S0(i[t],this,r,n);return r.sort(M0),r}}function M0(t,e){return t.distance-e.distance}function S0(t,i,n,e){let r=!0;var a;if(t.layers.test(i.layers)&&!1===t.raycast(i,n)&&(r=!1),!0===r&&!0===e){var s=t.children;for(let t=0,e=s.length;t<e;t++)S0(s[t],i,n,!0)}}class b0{constructor(t=1,e=0,i=0){return this.radius=t,this.phi=e,this.theta=i,this}set(t,e,i){return this.radius=t,this.phi=e,this.theta=i,this}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}makeSafe(){var t=1e-6;return this.phi=Math.max(t,Math.min(Math.PI-t,this.phi)),this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,i){return this.radius=Math.sqrt(t*t+e*e+i*i),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,i),this.phi=Math.acos($i(e/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}class w0{constructor(t=1,e=0,i=0){return this.radius=t,this.theta=e,this.y=i,this}set(t,e,i){return this.radius=t,this.theta=e,this.y=i,this}copy(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,i){return this.radius=Math.sqrt(t*t+i*i),this.theta=Math.atan2(t,i),this.y=e,this}clone(){return(new this.constructor).copy(this)}}class T0{constructor(t,e,i,n){T0.prototype.isMatrix2=!0,this.elements=[1,0,0,1],void 0!==t&&this.set(t,e,i,n)}identity(){return this.set(1,0,0,1),this}fromArray(e,i=0){for(let t=0;t<4;t++)this.elements[t]=e[t+i];return this}set(t,e,i,n){const r=this.elements;return r[0]=t,r[2]=e,r[1]=i,r[3]=n,this}}const E0=new Mn;class A0{constructor(t=new Mn(1/0,1/0),e=new Mn(-1/0,-1/0)){this.isBox2=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromPoints(i){this.makeEmpty();for(let t=0,e=i.length;t<e;t++)this.expandByPoint(i[t]);return this}setFromCenterAndSize(t,e){var i=E0.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(t){return this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}containsPoint(t){return t.x>=this.min.x&&t.x<=this.max.x&&t.y>=this.min.y&&t.y<=this.max.y}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(t){return t.max.x>=this.min.x&&t.min.x<=this.max.x&&t.max.y>=this.min.y&&t.min.y<=this.max.y}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,E0).distanceTo(t)}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const C0=new tr,R0=new tr;class P0{constructor(t=new tr,e=new tr){this.start=t,this.end=e}set(t,e){return this.start.copy(t),this.end.copy(e),this}copy(t){return this.start.copy(t.start),this.end.copy(t.end),this}getCenter(t){return t.addVectors(this.start,this.end).multiplyScalar(.5)}delta(t){return t.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(t,e){return this.delta(e).multiplyScalar(t).add(this.start)}closestPointToPointParameter(t,e){C0.subVectors(t,this.start),R0.subVectors(this.end,this.start);var i=R0.dot(R0),n;let r=R0.dot(C0)/i;return e&&(r=$i(r,0,1)),r}closestPointToPoint(t,e,i){var n=this.closestPointToPointParameter(t,e);return this.delta(i).multiplyScalar(n).add(this.start)}applyMatrix4(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this}equals(t){return t.start.equals(this.start)&&t.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}}const I0=new tr;class L0 extends na{constructor(t,e){super(),this.light=t,this.matrixAutoUpdate=!1,this.color=e,this.type="SpotLightHelper";const i=new Ya,n=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let t=0,e=1,i=32;t<32;t++,e++){var r=t/32*Math.PI*2,a=e/32*Math.PI*2;n.push(Math.cos(r),Math.sin(r),1,Math.cos(a),Math.sin(a),1)}i.setAttribute("position",new ka(n,3));var s=new Kp({fog:!1,toneMapped:!1});this.cone=new hm(i,s),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.matrixWorld.copy(this.light.matrixWorld);var t=this.light.distance||1e3,e=t*Math.tan(this.light.angle);this.cone.scale.set(e,e,t),I0.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(I0),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const U0=new tr,N0=new Pr,D0=new Pr;class O0 extends hm{constructor(t){var e=B0(t);const i=new Ya,n=[],r=[];var a=new ya(0,0,1),s=new ya(0,1,0);for(let t=0;t<e.length;t++){var o=e[t];o.parent&&o.parent.isBone&&(n.push(0,0,0),n.push(0,0,0),r.push(a.r,a.g,a.b),r.push(s.r,s.g,s.b))}i.setAttribute("position",new ka(n,3)),i.setAttribute("color",new ka(r,3));var l=new Kp({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(i,l),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=t,this.bones=e,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(t){var i=this.bones;const e=this.geometry,n=e.getAttribute("position");D0.copy(this.root.matrixWorld).invert();for(let t=0,e=0;t<i.length;t++){var r=i[t];r.parent&&r.parent.isBone&&(N0.multiplyMatrices(D0,r.matrixWorld),U0.setFromMatrixPosition(N0),n.setXYZ(e,U0.x,U0.y,U0.z),N0.multiplyMatrices(D0,r.parent.matrixWorld),U0.setFromMatrixPosition(N0),n.setXYZ(e+1,U0.x,U0.y,U0.z),e+=2)}e.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(t)}dispose(){this.geometry.dispose(),this.material.dispose()}}function B0(e){const i=[];!0===e.isBone&&i.push(e);for(let t=0;t<e.children.length;t++)i.push.apply(i,B0(e.children[t]));return i}class F0 extends ds{constructor(t,e,i){var n,r;super(new ig(e,4,2),new ba({wireframe:!0,fog:!1,toneMapped:!1})),this.light=t,this.color=i,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const z0=new tr,k0=new ya,V0=new ya;class G0 extends na{constructor(t,e,i){super(),this.light=t,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,this.type="HemisphereLightHelper";const n=new $f(e);n.rotateY(.5*Math.PI),this.material=new ba({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);var r=n.getAttribute("position"),a=new Float32Array(3*r.count);n.setAttribute("color",new Ia(a,3)),this.add(new ds(n,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const t=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const n=t.geometry.getAttribute("color");k0.copy(this.light.color),V0.copy(this.light.groundColor);for(let t=0,e=n.count;t<e;t++){var i=t<e/2?k0:V0;n.setXYZ(t,i.r,i.g,i.b)}n.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),t.lookAt(z0.setFromMatrixPosition(this.light.matrixWorld).negate())}}class H0 extends hm{constructor(t=10,n=10,r=4473924,a=8947848){r=new ya(r),a=new ya(a);var s=n/2,o=t/n,l=t/2;const h=[],c=[];for(let t=0,e=0,i=-l;t<=n;t++,i+=o){h.push(-l,0,i,l,0,i),h.push(i,0,-l,i,0,l);const u=t===s?r:a;u.toArray(c,e),e+=3,u.toArray(c,e),e+=3,u.toArray(c,e),e+=3,u.toArray(c,e),e+=3}const e=new Ya;e.setAttribute("position",new ka(h,3)),e.setAttribute("color",new ka(c,3));var i=new Kp({vertexColors:!0,toneMapped:!1});super(e,i),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class W0 extends hm{constructor(e=10,i=16,n=8,r=64,a=4473924,s=8947848){a=new ya(a),s=new ya(s);const o=[],l=[];if(1<i)for(let t=0;t<i;t++){var h=t/i*(2*Math.PI),c=Math.sin(h)*e,u=Math.cos(h)*e;o.push(0,0,0),o.push(c,0,u);var d=1&t?a:s;l.push(d.r,d.g,d.b),l.push(d.r,d.g,d.b)}for(let t=0;t<n;t++){var p=1&t?a:s,m=e-e/n*t;for(let t=0;t<r;t++){var f=t/r*(2*Math.PI),g=Math.sin(f)*m,v=Math.cos(f)*m;o.push(g,0,v),l.push(p.r,p.g,p.b),f=(t+1)/r*(2*Math.PI),g=Math.sin(f)*m,v=Math.cos(f)*m,o.push(g,0,v),l.push(p.r,p.g,p.b)}}const t=new Ya;t.setAttribute("position",new ka(o,3)),t.setAttribute("color",new ka(l,3));var _=new Kp({vertexColors:!0,toneMapped:!1});super(t,_),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const X0=new tr,j0=new tr,q0=new tr;class Y0 extends na{constructor(t,e,i){super(),this.light=t,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,this.type="DirectionalLightHelper",void 0===e&&(e=1);let n=new Ya;n.setAttribute("position",new ka([-e,e,0,e,e,0,e,-e,0,-e,-e,0,-e,e,0],3));var r=new Kp({fog:!1,toneMapped:!1});this.lightPlane=new am(n,r),this.add(this.lightPlane),n=new Ya,n.setAttribute("position",new ka([0,0,0,0,0,1],3)),this.targetLine=new am(n,r),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),X0.setFromMatrixPosition(this.light.matrixWorld),j0.setFromMatrixPosition(this.light.target.matrixWorld),q0.subVectors(j0,X0),this.lightPlane.lookAt(j0),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(j0),this.targetLine.scale.z=q0.length()}}const Z0=new tr,J0=new rh;class K0 extends hm{constructor(t){const e=new Ya;var i=new Kp({color:16777215,vertexColors:!0,toneMapped:!1});const n=[],r=[],a={};function s(t,e){o(t),o(e)}function o(t){n.push(0,0,0),r.push(0,0,0),void 0===a[t]&&(a[t]=[]),a[t].push(n.length/3-1)}s("n1","n2"),s("n2","n4"),s("n4","n3"),s("n3","n1"),s("f1","f2"),s("f2","f4"),s("f4","f3"),s("f3","f1"),s("n1","f1"),s("n2","f2"),s("n3","f3"),s("n4","f4"),s("p","n1"),s("p","n2"),s("p","n3"),s("p","n4"),s("u1","u2"),s("u2","u3"),s("u3","u1"),s("c","t"),s("p","c"),s("cn1","cn2"),s("cn3","cn4"),s("cf1","cf2"),s("cf3","cf4"),e.setAttribute("position",new ka(n,3)),e.setAttribute("color",new ka(r,3)),super(e,i),this.type="CameraHelper",this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update();var l=new ya(16755200),h=new ya(16711680),c=new ya(43775),u=new ya(16777215),d=new ya(3355443);this.setColors(l,h,c,u,d)}setColors(t,e,i,n,r){const a=this.geometry,s=a.getAttribute("color");s.setXYZ(0,t.r,t.g,t.b),s.setXYZ(1,t.r,t.g,t.b),s.setXYZ(2,t.r,t.g,t.b),s.setXYZ(3,t.r,t.g,t.b),s.setXYZ(4,t.r,t.g,t.b),s.setXYZ(5,t.r,t.g,t.b),s.setXYZ(6,t.r,t.g,t.b),s.setXYZ(7,t.r,t.g,t.b),s.setXYZ(8,t.r,t.g,t.b),s.setXYZ(9,t.r,t.g,t.b),s.setXYZ(10,t.r,t.g,t.b),s.setXYZ(11,t.r,t.g,t.b),s.setXYZ(12,t.r,t.g,t.b),s.setXYZ(13,t.r,t.g,t.b),s.setXYZ(14,t.r,t.g,t.b),s.setXYZ(15,t.r,t.g,t.b),s.setXYZ(16,t.r,t.g,t.b),s.setXYZ(17,t.r,t.g,t.b),s.setXYZ(18,t.r,t.g,t.b),s.setXYZ(19,t.r,t.g,t.b),s.setXYZ(20,t.r,t.g,t.b),s.setXYZ(21,t.r,t.g,t.b),s.setXYZ(22,t.r,t.g,t.b),s.setXYZ(23,t.r,t.g,t.b),s.setXYZ(24,e.r,e.g,e.b),s.setXYZ(25,e.r,e.g,e.b),s.setXYZ(26,e.r,e.g,e.b),s.setXYZ(27,e.r,e.g,e.b),s.setXYZ(28,e.r,e.g,e.b),s.setXYZ(29,e.r,e.g,e.b),s.setXYZ(30,e.r,e.g,e.b),s.setXYZ(31,e.r,e.g,e.b),s.setXYZ(32,i.r,i.g,i.b),s.setXYZ(33,i.r,i.g,i.b),s.setXYZ(34,i.r,i.g,i.b),s.setXYZ(35,i.r,i.g,i.b),s.setXYZ(36,i.r,i.g,i.b),s.setXYZ(37,i.r,i.g,i.b),s.setXYZ(38,n.r,n.g,n.b),s.setXYZ(39,n.r,n.g,n.b),s.setXYZ(40,r.r,r.g,r.b),s.setXYZ(41,r.r,r.g,r.b),s.setXYZ(42,r.r,r.g,r.b),s.setXYZ(43,r.r,r.g,r.b),s.setXYZ(44,r.r,r.g,r.b),s.setXYZ(45,r.r,r.g,r.b),s.setXYZ(46,r.r,r.g,r.b),s.setXYZ(47,r.r,r.g,r.b),s.setXYZ(48,r.r,r.g,r.b),s.setXYZ(49,r.r,r.g,r.b),s.needsUpdate=!0}update(){const t=this.geometry;var e=this.pointMap,i=1,n=1;J0.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),$0("c",e,t,J0,0,0,-1),$0("t",e,t,J0,0,0,1),$0("n1",e,t,J0,-1,-1,-1),$0("n2",e,t,J0,1,-1,-1),$0("n3",e,t,J0,-1,1,-1),$0("n4",e,t,J0,1,1,-1),$0("f1",e,t,J0,-1,-1,1),$0("f2",e,t,J0,1,-1,1),$0("f3",e,t,J0,-1,1,1),$0("f4",e,t,J0,1,1,1),$0("u1",e,t,J0,.7,1.1,-1),$0("u2",e,t,J0,-.7,1.1,-1),$0("u3",e,t,J0,0,2,-1),$0("cf1",e,t,J0,-1,0,1),$0("cf2",e,t,J0,1,0,1),$0("cf3",e,t,J0,0,-1,1),$0("cf4",e,t,J0,0,1,1),$0("cn1",e,t,J0,-1,0,-1),$0("cn2",e,t,J0,1,0,-1),$0("cn3",e,t,J0,0,-1,-1),$0("cn4",e,t,J0,0,1,-1),t.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function $0(t,e,i,n,r,a,s){Z0.set(r,a,s).unproject(n);var o=e[t];if(void 0!==o){const l=i.getAttribute("position");for(let t=0,e=o.length;t<e;t++)l.setXYZ(o[t],Z0.x,Z0.y,Z0.z)}}const Q0=new nr;class t_ extends hm{constructor(t,e=16776960){var i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Float32Array(24);const r=new Ya;r.setIndex(new Ia(i,1)),r.setAttribute("position",new Ia(n,3)),super(r,new Kp({color:e,toneMapped:!1})),this.object=t,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(t){if(void 0!==t&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&Q0.setFromObject(this.object),!Q0.isEmpty()){var e=Q0.min,i=Q0.max;const n=this.geometry.attributes.position,r=n.array;r[0]=i.x,r[1]=i.y,r[2]=i.z,r[3]=e.x,r[4]=i.y,r[5]=i.z,r[6]=e.x,r[7]=e.y,r[8]=i.z,r[9]=i.x,r[10]=e.y,r[11]=i.z,r[12]=i.x,r[13]=i.y,r[14]=e.z,r[15]=e.x,r[16]=i.y,r[17]=e.z,r[18]=e.x,r[19]=e.y,r[20]=e.z,r[21]=i.x,r[22]=e.y,r[23]=e.z,n.needsUpdate=!0,this.geometry.computeBoundingSphere()}}setFromObject(t){return this.object=t,this.update(),this}copy(t,e){return super.copy(t,e),this.object=t.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class e_ extends hm{constructor(t,e=16776960){var i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1];const r=new Ya;r.setIndex(new Ia(i,1)),r.setAttribute("position",new ka(n,3)),super(r,new Kp({color:e,toneMapped:!1})),this.box=t,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(t){const e=this.box;e.isEmpty()||(e.getCenter(this.position),e.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(t))}dispose(){this.geometry.dispose(),this.material.dispose()}}class i_ extends am{constructor(t,e=1,i=16776960){var n=i,r=[1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0];const a=new Ya;a.setAttribute("position",new ka(r,3)),a.computeBoundingSphere(),super(a,new Kp({color:n,toneMapped:!1})),this.type="PlaneHelper",this.plane=t,this.size=e;var s=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0];const o=new Ya;o.setAttribute("position",new ka(s,3)),o.computeBoundingSphere(),this.add(new ds(o,new ba({color:n,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(t){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(t)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const n_=new tr;let r_,a_;class s_ extends na{constructor(t=new tr(0,0,1),e=new tr(0,0,0),i=1,n=16776960,r=.2*i,a=.2*r){super(),this.type="ArrowHelper",void 0===r_&&(r_=new Ya,r_.setAttribute("position",new ka([0,0,0,0,1,0],3)),a_=new nf(0,.5,1,5,1),a_.translate(0,-.5,0)),this.position.copy(e),this.line=new am(r_,new Kp({color:n,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new ds(a_,new ba({color:n,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(i,r,a)}setDirection(t){var e;.99999<t.y?this.quaternion.set(0,0,0,1):t.y<-.99999?this.quaternion.set(1,0,0,0):(n_.set(t.z,0,-t.x).normalize(),e=Math.acos(t.y),this.quaternion.setFromAxisAngle(n_,e))}setLength(t,e=.2*t,i=.2*e){this.line.scale.set(1,Math.max(1e-4,t-e),1),this.line.updateMatrix(),this.cone.scale.set(i,e,i),this.cone.position.y=t,this.cone.updateMatrix()}setColor(t){this.line.material.color.set(t),this.cone.material.color.set(t)}copy(t){return super.copy(t,!1),this.line.copy(t.line),this.cone.copy(t.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class o_ extends hm{constructor(t=1){var e=[0,0,0,t,0,0,0,0,0,0,t,0,0,0,0,0,0,t],i=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1];const n=new Ya;n.setAttribute("position",new ka(e,3)),n.setAttribute("color",new ka(i,3));var r=new Kp({vertexColors:!0,toneMapped:!1});super(n,r),this.type="AxesHelper"}setColors(t,e,i){const n=new ya;var r=this.geometry.attributes.color.array;return n.set(t),n.toArray(r,0),n.toArray(r,3),n.set(e),n.toArray(r,6),n.toArray(r,9),n.set(i),n.toArray(r,12),n.toArray(r,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class l_{constructor(){this.type="ShapePath",this.color=new ya,this.subPaths=[],this.currentPath=null}moveTo(t,e){return this.currentPath=new $m,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e),this}lineTo(t,e){return this.currentPath.lineTo(t,e),this}quadraticCurveTo(t,e,i,n){return this.currentPath.quadraticCurveTo(t,e,i,n),this}bezierCurveTo(t,e,i,n,r,a){return this.currentPath.bezierCurveTo(t,e,i,n,r,a),this}splineThru(t){return this.currentPath.splineThru(t),this}toShapes(i){function t(i){const n=[];for(let t=0,e=i.length;t<e;t++){var r=i[t];const a=new df;a.curves=r.curves,n.push(a)}return n}function a(s,o){var t=o.length;let l=!1;for(let r=t-1,a=0;a<t;r=a++){let t=o[r],e=o[a],i=e.x-t.x,n=e.y-t.y;if(Math.abs(n)>Number.EPSILON){if(n<0&&(t=o[a],i=-i,e=o[r],n=-n),!(s.y<t.y||s.y>e.y))if(s.y===t.y){if(s.x===t.x)return 1}else{var h=n*(s.x-t.x)-i*(s.y-t.y);if(0==h)return 1;h<0||(l=!l)}}else if(s.y===t.y&&(e.x<=s.x&&s.x<=t.x||t.x<=s.x&&s.x<=e.x))return 1}return l}const n=Xf.isClockWise,r=this.subPaths;if(0===r.length)return[];let s,o,l;const e=[];if(1===r.length)return o=r[0],l=new df,l.curves=o.curves,e.push(l),e;let h=!n(r[0].getPoints());h=i?!h:h;const c=[],u=[];let d=[],p=0;var m,f;u[p]=void 0,d[p]=[];for(let t=0,e=r.length;t<e;t++)o=r[t],m=o.getPoints(),s=n(m),s=i?!s:s,s?(!h&&u[p]&&p++,u[p]={s:new df,p:m},u[p].s.curves=o.curves,h&&p++,d[p]=[]):d[p].push({h:o,p:m[0]});if(!u[0])return t(r);if(1<u.length){let n=!1,r=0;for(let t=0,e=u.length;t<e;t++)c[t]=[];for(let i=0,t=u.length;i<t;i++){var g=d[i];for(let t=0;t<g.length;t++){var v=g[t];let e=!0;for(let t=0;t<u.length;t++)a(v.p,u[t].p)&&(i!==t&&r++,e?(e=!1,c[t].push(v)):n=!0);e&&c[i].push(v)}}0<r&&!1===n&&(d=c)}for(let i=0,t=u.length;i<t;i++){l=u[i].s,e.push(l);for(let t=0,e=(f=d[i]).length;t<e;t++)l.holes.push(f[t].h)}return e}}class h_ extends Yn{constructor(t=1,e=1,i=1,n={}){console.warn('THREE.WebGLMultipleRenderTargets has been deprecated and will be removed in r172. Use THREE.WebGLRenderTarget and set the "count" parameter to enable MRT.'),super(t,e,{...n,count:i}),this.isWebGLMultipleRenderTargets=!0}get texture(){return this.textures}}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:jt}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=jt);const c_=ei;class u_ extends jg{constructor(t){super(t),this.defaultDPI=90,this.defaultUnit="px"}load(e,i,t,n){const r=this,a=new Zg(r.manager);a.setPath(r.path),a.setRequestHeader(r.requestHeader),a.setWithCredentials(r.withCredentials),a.load(e,function(t){try{i(r.parse(t))}catch(t){n?n(t):console.error(t),r.manager.itemError(e)}},t,n)}parse(t){const e=this;function h(i,n){if(1===i.nodeType){var r=b(i);let e=!1,t=null;switch(i.nodeName){case"svg":n=_(i,n);break;case"style":u(i);break;case"g":n=_(i,n);break;case"path":n=_(i,n),i.hasAttribute("d")&&(t=c(i));break;case"rect":n=_(i,n),t=d(i);break;case"polygon":n=_(i,n),t=p(i);break;case"polyline":n=_(i,n),t=m(i);break;case"circle":n=_(i,n),t=f(i);break;case"ellipse":n=_(i,n),t=g(i);break;case"line":n=_(i,n),t=v(i);break;case"defs":e=!0;break;case"use":n=_(i,n);const l=i.getAttributeNS("http://www.w3.org/1999/xlink","href")||"";var a=l.substring(1),s=i.viewportElement.getElementById(a);s?h(s,n):console.warn("SVGLoader: 'use node' references non-existent node id: "+a)}t&&(void 0!==n.fill&&"none"!==n.fill&&t.color.setStyle(n.fill,c_),w(t,z),I.push(t),t.userData={node:i,style:n});var o=i.childNodes;for(let t=0;t<o.length;t++){const i=o[t];e&&"style"!==i.nodeName&&"defs"!==i.nodeName||h(i,n)}r&&(L.pop(),0<L.length?z.copy(L[L.length-1]):z.identity())}}function c(t){const n=new l_,r=new Mn,a=new Mn,s=new Mn;let o=!0,l=!1;const e=t.getAttribute("d");if(""===e||"none"===e)return null;var h=e.match(/[a-df-z][^a-df-z]*/gi);for(let t=0,e=h.length;t<e;t++){const _=h[t];var c=_.charAt(0),u=_.slice(1).trim(),d,p;!0===o&&(l=!0,o=!1);let i;switch(c){case"M":i=M(u);for(let t=0,e=i.length;t<e;t+=2)r.x=i[t+0],r.y=i[t+1],a.x=r.x,a.y=r.y,0===t?n.moveTo(r.x,r.y):n.lineTo(r.x,r.y),0===t&&s.copy(r);break;case"H":i=M(u);for(let t=0,e=i.length;t<e;t++)r.x=i[t],a.x=r.x,a.y=r.y,n.lineTo(r.x,r.y),0===t&&!0===l&&s.copy(r);break;case"V":i=M(u);for(let t=0,e=i.length;t<e;t++)r.y=i[t],a.x=r.x,a.y=r.y,n.lineTo(r.x,r.y),0===t&&!0===l&&s.copy(r);break;case"L":i=M(u);for(let t=0,e=i.length;t<e;t+=2)r.x=i[t+0],r.y=i[t+1],a.x=r.x,a.y=r.y,n.lineTo(r.x,r.y),0===t&&!0===l&&s.copy(r);break;case"C":i=M(u);for(let t=0,e=i.length;t<e;t+=6)n.bezierCurveTo(i[t+0],i[t+1],i[t+2],i[t+3],i[t+4],i[t+5]),a.x=i[t+2],a.y=i[t+3],r.x=i[t+4],r.y=i[t+5],0===t&&!0===l&&s.copy(r);break;case"S":i=M(u);for(let t=0,e=i.length;t<e;t+=4)n.bezierCurveTo(x(r.x,a.x),x(r.y,a.y),i[t+0],i[t+1],i[t+2],i[t+3]),a.x=i[t+0],a.y=i[t+1],r.x=i[t+2],r.y=i[t+3],0===t&&!0===l&&s.copy(r);break;case"Q":i=M(u);for(let t=0,e=i.length;t<e;t+=4)n.quadraticCurveTo(i[t+0],i[t+1],i[t+2],i[t+3]),a.x=i[t+0],a.y=i[t+1],r.x=i[t+2],r.y=i[t+3],0===t&&!0===l&&s.copy(r);break;case"T":i=M(u);for(let t=0,e=i.length;t<e;t+=2){var m=x(r.x,a.x),f=x(r.y,a.y);n.quadraticCurveTo(m,f,i[t+0],i[t+1]),a.x=m,a.y=f,r.x=i[t+0],r.y=i[t+1],0===t&&!0===l&&s.copy(r)}break;case"A":i=M(u,[3,4],7);for(let t=0,e=i.length;t<e;t+=7){i[t+5]==r.x&&i[t+6]==r.y||(d=r.clone(),r.x=i[t+5],r.y=i[t+6],a.x=r.x,a.y=r.y,y(n,i[t],i[t+1],i[t+2],i[t+3],i[t+4],d,r),0===t&&!0===l&&s.copy(r))}break;case"m":i=M(u);for(let t=0,e=i.length;t<e;t+=2)r.x+=i[t+0],r.y+=i[t+1],a.x=r.x,a.y=r.y,0===t?n.moveTo(r.x,r.y):n.lineTo(r.x,r.y),0===t&&s.copy(r);break;case"h":i=M(u);for(let t=0,e=i.length;t<e;t++)r.x+=i[t],a.x=r.x,a.y=r.y,n.lineTo(r.x,r.y),0===t&&!0===l&&s.copy(r);break;case"v":i=M(u);for(let t=0,e=i.length;t<e;t++)r.y+=i[t],a.x=r.x,a.y=r.y,n.lineTo(r.x,r.y),0===t&&!0===l&&s.copy(r);break;case"l":i=M(u);for(let t=0,e=i.length;t<e;t+=2)r.x+=i[t+0],r.y+=i[t+1],a.x=r.x,a.y=r.y,n.lineTo(r.x,r.y),0===t&&!0===l&&s.copy(r);break;case"c":i=M(u);for(let t=0,e=i.length;t<e;t+=6)n.bezierCurveTo(r.x+i[t+0],r.y+i[t+1],r.x+i[t+2],r.y+i[t+3],r.x+i[t+4],r.y+i[t+5]),a.x=r.x+i[t+2],a.y=r.y+i[t+3],r.x+=i[t+4],r.y+=i[t+5],0===t&&!0===l&&s.copy(r);break;case"s":i=M(u);for(let t=0,e=i.length;t<e;t+=4)n.bezierCurveTo(x(r.x,a.x),x(r.y,a.y),r.x+i[t+0],r.y+i[t+1],r.x+i[t+2],r.y+i[t+3]),a.x=r.x+i[t+0],a.y=r.y+i[t+1],r.x+=i[t+2],r.y+=i[t+3],0===t&&!0===l&&s.copy(r);break;case"q":i=M(u);for(let t=0,e=i.length;t<e;t+=4)n.quadraticCurveTo(r.x+i[t+0],r.y+i[t+1],r.x+i[t+2],r.y+i[t+3]),a.x=r.x+i[t+0],a.y=r.y+i[t+1],r.x+=i[t+2],r.y+=i[t+3],0===t&&!0===l&&s.copy(r);break;case"t":i=M(u);for(let t=0,e=i.length;t<e;t+=2){var g=x(r.x,a.x),v=x(r.y,a.y);n.quadraticCurveTo(g,v,r.x+i[t+0],r.y+i[t+1]),a.x=g,a.y=v,r.x=r.x+i[t+0],r.y=r.y+i[t+1],0===t&&!0===l&&s.copy(r)}break;case"a":i=M(u,[3,4],7);for(let t=0,e=i.length;t<e;t+=7){0==i[t+5]&&0==i[t+6]||(p=r.clone(),r.x+=i[t+5],r.y+=i[t+6],a.x=r.x,a.y=r.y,y(n,i[t],i[t+1],i[t+2],i[t+3],i[t+4],p,r),0===t&&!0===l&&s.copy(r))}break;case"Z":case"z":n.currentPath.autoClose=!0,0<n.currentPath.curves.length&&(r.copy(s),n.currentPath.currentPoint.copy(r),o=!0);break;default:console.warn(_)}l=!1}return n}function u(e){if(e.sheet&&e.sheet.cssRules&&e.sheet.cssRules.length)for(let t=0;t<e.sheet.cssRules.length;t++){const r=e.sheet.cssRules[t];if(1===r.type){var i=r.selectorText.split(/,/gm).filter(Boolean).map(t=>t.trim());for(let t=0;t<i.length;t++){var n=Object.fromEntries(Object.entries(r.style).filter(([,t])=>""!==t));o[i[t]]=Object.assign(o[i[t]]||{},n)}}}}function y(n,r,a,s,o,l,h,c){if(0!=r&&0!=a){s=s*Math.PI/180,r=Math.abs(r),a=Math.abs(a);var u=(h.x-c.x)/2,d=(h.y-c.y)/2,p=Math.cos(s)*u+Math.sin(s)*d,m=-Math.sin(s)*u+Math.cos(s)*d;let t=r*r,e=a*a;var f=p*p,g=m*m,v=f/t+g/e,_;1<v&&(r*=_=Math.sqrt(v),a*=_,t=r*r,e=a*a);var y=t*g+e*f,x=(t*e-y)/y;let i=Math.sqrt(Math.max(0,x));o===l&&(i=-i);var M=i*r*m/a,S=-i*a*p/r,b=Math.cos(s)*M-Math.sin(s)*S+(h.x+c.x)/2,w=Math.sin(s)*M+Math.cos(s)*S+(h.y+c.y)/2,T=A(1,0,(p-M)/r,(m-S)/a),E=A((p-M)/r,(m-S)/a,(-p-M)/r,(-m-S)/a)%(2*Math.PI);n.currentPath.absellipse(b,w,r,a,T,T+E,0===l,s)}else n.lineTo(c.x,c.y)}function A(t,e,i,n){var r=t*i+e*n,a=Math.sqrt(t*t+e*e)*Math.sqrt(i*i+n*n);let s=Math.acos(Math.max(-1,Math.min(1,r/a)));return t*n-e*i<0&&(s=-s),s}function d(t){var e=S(t.getAttribute("x")||0),i=S(t.getAttribute("y")||0),n=S(t.getAttribute("rx")||t.getAttribute("ry")||0),r=S(t.getAttribute("ry")||t.getAttribute("rx")||0),a=S(t.getAttribute("width")),s=S(t.getAttribute("height")),o=.448084975506;const l=new l_;return l.moveTo(e+n,i),l.lineTo(e+a-n,i),0===n&&0===r||l.bezierCurveTo(e+a-n*o,i,e+a,i+r*o,e+a,i+r),l.lineTo(e+a,i+s-r),0===n&&0===r||l.bezierCurveTo(e+a,i+s-r*o,e+a-n*o,i+s,e+a-n,i+s),l.lineTo(e+n,i+s),0===n&&0===r||l.bezierCurveTo(e+n*o,i+s,e,i+s-r*o,e,i+s-r),l.lineTo(e,i+r),0===n&&0===r||l.bezierCurveTo(e,i+r*o,e+n*o,i,e+n,i),l}function p(t){function e(t,e,i){var n=S(e),r=S(i);0===s?a.moveTo(n,r):a.lineTo(n,r),s++}var i=/([+-]?\d*\.?\d+(?:e[+-]?\d+)?)(?:,|\s)([+-]?\d*\.?\d+(?:e[+-]?\d+)?)/g;const a=new l_;let s=0;return t.getAttribute("points").replace(i,e),a.currentPath.autoClose=!0,a}function m(t){function e(t,e,i){var n=S(e),r=S(i);0===s?a.moveTo(n,r):a.lineTo(n,r),s++}var i=/([+-]?\d*\.?\d+(?:e[+-]?\d+)?)(?:,|\s)([+-]?\d*\.?\d+(?:e[+-]?\d+)?)/g;const a=new l_;let s=0;return t.getAttribute("points").replace(i,e),a.currentPath.autoClose=!1,a}function f(t){var e=S(t.getAttribute("cx")||0),i=S(t.getAttribute("cy")||0),n=S(t.getAttribute("r")||0);const r=new $m;r.absarc(e,i,n,0,2*Math.PI);const a=new l_;return a.subPaths.push(r),a}function g(t){var e=S(t.getAttribute("cx")||0),i=S(t.getAttribute("cy")||0),n=S(t.getAttribute("rx")||0),r=S(t.getAttribute("ry")||0);const a=new $m;a.absellipse(e,i,n,r,0,2*Math.PI);const s=new l_;return s.subPaths.push(a),s}function v(t){var e=S(t.getAttribute("x1")||0),i=S(t.getAttribute("y1")||0),n=S(t.getAttribute("x2")||0),r=S(t.getAttribute("y2")||0);const a=new l_;return a.moveTo(e,i),a.lineTo(n,r),a.currentPath.autoClose=!1,a}function _(n,r){r=Object.assign({},r);let a={};if(n.hasAttribute("class")){var e=n.getAttribute("class").split(/\s/).filter(Boolean).map(t=>t.trim());for(let t=0;t<e.length;t++)a=Object.assign(a,o["."+e[t]])}function t(t,e,i){void 0===i&&(i=function t(e){return e.startsWith("url")&&console.warn("SVGLoader: url access in attributes is not implemented."),e}),n.hasAttribute(t)&&(r[e]=i(n.getAttribute(t))),a[t]&&(r[e]=i(a[t])),n.style&&""!==n.style[t]&&(r[e]=i(n.style[t]))}function i(t){return Math.max(0,Math.min(1,S(t)))}function s(t){return Math.max(0,S(t))}return n.hasAttribute("id")&&(a=Object.assign(a,o["#"+n.getAttribute("id")])),t("fill","fill"),t("fill-opacity","fillOpacity",i),t("fill-rule","fillRule"),t("opacity","opacity",i),t("stroke","stroke"),t("stroke-opacity","strokeOpacity",i),t("stroke-width","strokeWidth",s),t("stroke-linejoin","strokeLineJoin"),t("stroke-linecap","strokeLineCap"),t("stroke-miterlimit","strokeMiterLimit",s),t("visibility","visibility"),r}function x(t,e){return t-(e-t)}function M(e,i,n){if("string"!=typeof e)throw new TypeError("Invalid input: "+typeof e);const r={SEPARATOR:/[ \t\r\n\,.\-+]/,WHITESPACE:/[ \t\r\n]/,DIGIT:/[\d]/,SIGN:/[-+]/,POINT:/\./,COMMA:/,/,EXP:/e/i,FLAGS:/[01]/};var t=0,a=1,s=2,o=3,l;let h=0,c=!0,u="",d="";const p=[];function m(t,e,i){const n=new SyntaxError('Unexpected character "'+t+'" at index '+e+".");throw n.partial=i,n}function f(){""!==u&&(""===d?p.push(Number(u)):p.push(Number(u)*Math.pow(10,Number(d)))),u="",d=""}var g=e.length;for(let t=0;t<g;t++)if(l=e[t],Array.isArray(i)&&i.includes(p.length%n)&&r.FLAGS.test(l))h=1,u=l,f();else{if(0===h){if(r.WHITESPACE.test(l))continue;if(r.DIGIT.test(l)||r.SIGN.test(l)){h=1,u=l;continue}if(r.POINT.test(l)){h=2,u=l;continue}r.COMMA.test(l)&&(c&&m(l,t,p),c=!0)}if(1===h){if(r.DIGIT.test(l)){u+=l;continue}if(r.POINT.test(l)){u+=l,h=2;continue}if(r.EXP.test(l)){h=3;continue}r.SIGN.test(l)&&1===u.length&&r.SIGN.test(u[0])&&m(l,t,p)}if(2===h){if(r.DIGIT.test(l)){u+=l;continue}if(r.EXP.test(l)){h=3;continue}r.POINT.test(l)&&"."===u[u.length-1]&&m(l,t,p)}if(3===h){if(r.DIGIT.test(l)){d+=l;continue}if(r.SIGN.test(l)){if(""===d){d+=l;continue}1===d.length&&r.SIGN.test(d)&&m(l,t,p)}}r.WHITESPACE.test(l)?(f(),h=0,c=!1):r.COMMA.test(l)?(f(),h=0,c=!0):r.SIGN.test(l)?(f(),h=1,u=l):r.POINT.test(l)?(f(),h=2,u=l):m(l,t,p)}return f(),p}const a=["mm","cm","in","pt","pc","px"],s={mm:{mm:1,cm:.1,in:1/25.4,pt:72/25.4,pc:6/25.4,px:-1},cm:{mm:10,cm:1,in:1/2.54,pt:72/2.54,pc:6/2.54,px:-1},in:{mm:25.4,cm:2.54,in:1,pt:72,pc:6,px:-1},pt:{mm:25.4/72,cm:2.54/72,in:1/72,pt:1,pc:6/72,px:-1},pc:{mm:25.4/6,cm:2.54/6,in:1/6,pt:12,pc:1,px:-1},px:{px:1}};function S(i){let n="px";if("string"==typeof i||i instanceof String)for(let t=0,e=a.length;t<e;t++){var r=a[t];if(i.endsWith(r)){n=r,i=i.substring(0,i.length-r.length);break}}let t=void 0;return"px"===n&&"px"!==e.defaultUnit?t=s.in[e.defaultUnit]/e.defaultDPI:(t=s[n][e.defaultUnit],t<0&&(t=s[n].in*e.defaultDPI)),t*parseFloat(i)}function b(t){if(!(t.hasAttribute("transform")||"use"===t.nodeName&&(t.hasAttribute("x")||t.hasAttribute("y"))))return null;const e=i(t);return 0<L.length&&e.premultiply(L[L.length-1]),z.copy(e),L.push(e),e}function i(t){const e=new Sn,i=U;var n,r;if("use"===t.nodeName&&(t.hasAttribute("x")||t.hasAttribute("y"))&&(n=S(t.getAttribute("x")),r=S(t.getAttribute("y")),e.translate(n,r)),t.hasAttribute("transform")){const d=t.getAttribute("transform").split(")");for(let t=d.length-1;0<=t;t--){const p=d[t].trim();if(""!==p){var a=p.indexOf("("),s=p.length;if(0<a&&a<s){var o=p.slice(0,a),l=M(p.slice(a+1));switch(i.identity(),o){case"translate":if(1<=l.length){var h=l[0];let t=0;2<=l.length&&(t=l[1]),i.translate(h,t)}break;case"rotate":if(1<=l.length){var c=0;let t=0,e=0;c=l[0]*Math.PI/180,3<=l.length&&(t=l[1],e=l[2]),N.makeTranslation(-t,-e),D.makeRotation(c),O.multiplyMatrices(D,N),N.makeTranslation(t,e),i.multiplyMatrices(N,O)}break;case"scale":if(1<=l.length){var u=l[0];let t=u;2<=l.length&&(t=l[1]),i.scale(u,t)}break;case"skewX":1===l.length&&i.set(1,Math.tan(l[0]*Math.PI/180),0,0,1,0,0,0,1);break;case"skewY":1===l.length&&i.set(1,0,0,Math.tan(l[0]*Math.PI/180),1,0,0,0,1);break;case"matrix":6===l.length&&i.set(l[0],l[2],l[4],l[1],l[3],l[5],0,0,1)}}e.premultiply(i)}}}return e}function w(t,S){function i(t){F.set(t.x,t.y,1).applyMatrix3(S),t.set(F.x,F.y)}function n(t){var e=t.xRadius,i=t.yRadius,n=Math.cos(t.aRotation),r=Math.sin(t.aRotation);const a=new tr(e*n,e*r,0),s=new tr(-i*r,i*n,0);var o=a.applyMatrix3(S),l=s.applyMatrix3(S),h=U.set(o.x,l.x,0,o.y,l.y,0,0,0,1),c=N.copy(h).invert();const u=D.copy(c).transpose();var d,p=u.multiply(c).elements,m=P(p[0],p[1],p[4]),f=Math.sqrt(m.rt1),g=Math.sqrt(m.rt2),v;if(t.xRadius=1/f,t.yRadius=1/g,t.aRotation=Math.atan2(m.sn,m.cs),!((t.aEndAngle-t.aStartAngle)%(2*Math.PI)<Number.EPSILON)){const x=N.set(f,0,0,0,g,0,0,0,1);var _=D.set(m.cs,m.sn,0,-m.sn,m.cs,0,0,0,1);const M=x.multiply(_).multiply(h);var y=t=>{var{x:e,y:i}=new tr(Math.cos(t),Math.sin(t),0).applyMatrix3(M);return Math.atan2(i,e)};t.aStartAngle=y(t.aStartAngle),t.aEndAngle=y(t.aEndAngle),T(S)&&(t.aClockwise=!t.aClockwise)}}function r(t){var e=C(S),i=R(S);t.xRadius*=e,t.yRadius*=i;var n=e>Number.EPSILON?Math.atan2(S.elements[1],S.elements[0]):Math.atan2(-S.elements[3],S.elements[4]);t.aRotation+=n,T(S)&&(t.aStartAngle*=-1,t.aEndAngle*=-1,t.aClockwise=!t.aClockwise)}var a=t.subPaths;for(let t=0,e=a.length;t<e;t++){var s,o=a[t].curves;for(let t=0;t<o.length;t++){const l=o[t];l.isLineCurve?(i(l.v1),i(l.v2)):l.isCubicBezierCurve?(i(l.v0),i(l.v1),i(l.v2),i(l.v3)):l.isQuadraticBezierCurve?(i(l.v0),i(l.v1),i(l.v2)):l.isEllipseCurve&&(B.set(l.aX,l.aY),i(B),l.aX=B.x,l.aY=B.y,(E(S)?n:r)(l))}}}function T(t){var e=t.elements;return e[0]*e[4]-e[1]*e[3]<0}function E(t){var e=t.elements,i=e[0]*e[3]+e[1]*e[4];if(0!=i){var n=C(t),r=R(t);return Math.abs(i/(n*r))>Number.EPSILON}}function C(t){var e=t.elements;return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function R(t){var e=t.elements;return Math.sqrt(e[3]*e[3]+e[4]*e[4])}function P(t,e,i){let n,r,a,s,o;var l=t+i,h=t-i,c=Math.sqrt(h*h+4*e*e);return r=0<l?(n=.5*(l+c),o=1/n,t*o*i-e*o*e):l<0?.5*(l-c):(n=.5*c,-.5*c),a=0<h?h+c:h-c,Math.abs(a)>2*Math.abs(e)?(o=-2*e/a,s=1/Math.sqrt(1+o*o),a=o*s):s=0===Math.abs(e)?(a=1,0):(o=-.5*a/e,a=1/Math.sqrt(1+o*o),o*a),0<h&&(o=a,a=-s,s=o),{rt1:n,rt2:r,cs:a,sn:s}}const I=[],o={},L=[],U=new Sn,N=new Sn,D=new Sn,O=new Sn,B=new Mn,F=new tr,z=new Sn;var n=(new DOMParser).parseFromString(t,"image/svg+xml"),r;return h(n.documentElement,{fill:"#000",fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeLineJoin:"miter",strokeLineCap:"butt",strokeMiterLimit:4}),{paths:I,xml:n.documentElement}}static createShapes(e){const t=999999999,b={ORIGIN:0,DESTINATION:1,BETWEEN:2,LEFT:3,RIGHT:4,BEHIND:5,BEYOND:6},w={loc:b.ORIGIN,t:0};function c(e,i,n,r){var a=e.x,s=i.x,t=n.x,o=r.x,l=e.y,h=i.y,c=n.y,u=r.y,d=(o-t)*(l-c)-(u-c)*(a-t),p,m=(u-c)*(s-a)-(o-t)*(h-l),f=d/m,g=((s-a)*(l-c)-(h-l)*(a-t))/m,v,_,y,x;if(0==m&&0!=d||f<=0||1<=f||g<0||1<g)return null;if(0==d&&0==m){for(let t=0;t<2;t++){if(T(0===t?n:r,e,i),w.loc==b.ORIGIN){var M=0===t?n:r;return{x:M.x,y:M.y,t:w.t}}if(w.loc==b.BETWEEN)return{x:+(a+w.t*(s-a)).toPrecision(10),y:+(l+w.t*(h-l)).toPrecision(10),t:w.t}}return null}for(let t=0;t<2;t++)if(T(0===t?n:r,e,i),w.loc==b.ORIGIN){var S=0===t?n:r;return{x:S.x,y:S.y,t:w.t}}return{x:+(a+f*(s-a)).toPrecision(10),y:+(l+f*(h-l)).toPrecision(10),t:f}}function T(t,e,i){var n=i.x-e.x,r=i.y-e.y,a=t.x-e.x,s=t.y-e.y,o=n*s-a*r;if(t.x===e.x&&t.y===e.y)return w.loc=b.ORIGIN,void(w.t=0);if(t.x===i.x&&t.y===i.y)return w.loc=b.DESTINATION,void(w.t=1);if(o<-Number.EPSILON)w.loc=b.LEFT;else if(o>Number.EPSILON)w.loc=b.RIGHT;else if(n*a<0||r*s<0)w.loc=b.BEHIND;else if(Math.sqrt(n*n+r*r)<Math.sqrt(a*a+s*s))w.loc=b.BEYOND;else{let t;t=0!=n?a/n:s/r,w.loc=b.BETWEEN,w.t=t}}function a(e,i){const n=[],r=[];for(let t=1;t<e.length;t++){var a=e[t-1],s=e[t],o,l;for(let t=1;t<i.length;t++){const h=c(a,s,i[t-1],i[t]);null!==h&&void 0===n.find(t=>t.t<=h.t+Number.EPSILON&&t.t>=h.t-Number.EPSILON)&&(n.push(h),r.push(new Mn(h.x,h.y)))}}return r}function g(i,t,e){const n=new Mn;t.getCenter(n);const r=[];return e.forEach(e=>{if(e.boundingBox.containsPoint(n)){const t=a(i,e.points);t.forEach(t=>{r.push({identifier:e.identifier,isCW:e.isCW,point:t})})}}),r.sort((t,e)=>t.point.x-e.point.x),r}function i(r,a,t,e,i){null!=i&&""!==i||(i="nonzero");var n=new Mn,s;r.boundingBox.getCenter(n);const o=g([new Mn(t,n.y),new Mn(e,n.y)],r.boundingBox,a);o.sort((t,e)=>t.point.x-e.point.x);const l=[],h=[];o.forEach(t=>{(t.identifier===r.identifier?l:h).push(t)});var c=l[0].point.x;const u=[];let d=0;for(;d<h.length&&h[d].point.x<c;)0<u.length&&u[u.length-1]===h[d].identifier?u.pop():u.push(h[d].identifier),d++;if(u.push(r.identifier),"evenodd"===i){var p=u.length%2==0,m=u[u.length-2];return{identifier:r.identifier,isHole:p,for:m}}if("nonzero"===i){let e=!0,i=null,n=null;for(let t=0;t<u.length;t++){var f=u[t];e?(n=a[f].isCW,e=!1,i=f):n!==a[f].isCW&&(n=a[f].isCW,e=!0)}return{identifier:r.identifier,isHole:e,for:i}}console.warn('fill-rule: "'+i+'" is currently not implemented.')}let o=t,l=-t,r=e.subPaths.map(e=>{var i=e.getPoints();let n=-t,r=t,a=-t,s=t;for(let t=0;t<i.length;t++){const e=i[t];e.y>n&&(n=e.y),e.y<r&&(r=e.y),e.x>a&&(a=e.x),e.x<s&&(s=e.x)}return l<=a&&(l=a+1),o>=s&&(o=s-1),{curves:e.curves,points:i,isCW:Xf.isClockWise(i),identifier:-1,boundingBox:new A0(new Mn(s,r),new Mn(a,n))}});r=r.filter(t=>1<t.points.length);for(let t=0;t<r.length;t++)r[t].identifier=t;const s=r.map(t=>i(t,r,o,l,e.userData?e.userData.style.fillRule:void 0)),h=[];return r.forEach(e=>{var t;if(!s[e.identifier].isHole){const n=new df;n.curves=e.curves;const i=s.filter(t=>t.isHole&&t.for===e.identifier);i.forEach(t=>{var e=r[t.identifier];const i=new $m;i.curves=e.curves,n.holes.push(i)}),h.push(n)}}),h}static getStrokeStyle(t,e,i,n,r){return{strokeColor:e=void 0!==e?e:"#000",strokeWidth:t=void 0!==t?t:1,strokeLineJoin:i=void 0!==i?i:"miter",strokeLineCap:n=void 0!==n?n:"butt",strokeMiterLimit:r=void 0!==r?r:4}}static pointsToStroke(t,e,i,n){var r=[],a=[],s=[];if(0===u_.pointsToStrokeWithBuffers(t,e,i,n,r,a,s))return null;const o=new Ya;return o.setAttribute("position",new ka(r,3)),o.setAttribute("normal",new ka(a,3)),o.setAttribute("uv",new ka(s,2)),o}static pointsToStrokeWithBuffers(e,o,l,a,h,n,c,t){const u=new Mn,d=new Mn,p=new Mn,m=new Mn,i=new Mn,r=new Mn,s=new Mn,f=new Mn,g=new Mn,v=new Mn,_=new Mn,y=new Mn,x=new Mn,M=new Mn,S=new Mn,b=new Mn,w=new Mn;l=void 0!==l?l:12,a=void 0!==a?a:.001,t=void 0!==t?t:0;var T=(e=tt(e)).length;if(T<2)return 0;var E=e[0].equals(e[T-1]);let A,C=e[0],R;var P=o.strokeWidth/2,I=1/(T-1);let L=0,U,N,D,O,B=!1,F=0,z=3*t,k=2*t;q(e[0],e[1],u).multiplyScalar(P),f.copy(e[0]).sub(u),g.copy(e[0]).add(u),v.copy(f),_.copy(g);for(let t=1;t<T;t++){A=e[t],R=t===T-1?E?e[1]:void 0:e[t+1];const et=u;if(q(C,A,et),p.copy(et).multiplyScalar(P),y.copy(A).sub(p),x.copy(A).add(p),U=L+I,N=!1,void 0!==R){q(A,R,d),p.copy(d).multiplyScalar(P),M.copy(A).sub(p),S.copy(A).add(p),D=!0,p.subVectors(R,C),et.dot(p)<0&&(D=!1),1===t&&(B=D),p.subVectors(R,A),p.normalize();var V=Math.abs(et.dot(p));if(V>Number.EPSILON){var G=P/V;p.multiplyScalar(-G),m.subVectors(A,C),i.copy(m).setLength(G).add(p),b.copy(i).negate();var H=i.length(),W=m.length();m.divideScalar(W),r.subVectors(R,A);var X=r.length();switch(r.divideScalar(X),m.dot(b)<W&&r.dot(b)<X&&(N=!0),w.copy(i).add(A),b.add(A),O=!1,N?D?(S.copy(b),x.copy(b)):(M.copy(b),y.copy(b)):J(),o.strokeLineJoin){case"bevel":K(D,N,U);break;case"round":$(D,N),D?Z(A,y,M,U,0):Z(A,S,x,U,1);break;default:var j=P*o.strokeMiterLimit/H;if(j<1){if("miter-clip"!==o.strokeLineJoin){K(D,N,U);break}$(D,N),D?(r.subVectors(w,y).multiplyScalar(j).add(y),s.subVectors(w,M).multiplyScalar(j).add(M),Y(y,U,0),Y(r,U,0),Y(A,U,.5),Y(A,U,.5),Y(r,U,0),Y(s,U,0),Y(A,U,.5),Y(s,U,0),Y(M,U,0)):(r.subVectors(w,x).multiplyScalar(j).add(x),s.subVectors(w,S).multiplyScalar(j).add(S),Y(x,U,1),Y(r,U,1),Y(A,U,.5),Y(A,U,.5),Y(r,U,1),Y(s,U,1),Y(A,U,.5),Y(s,U,1),Y(S,U,1))}else N?(D?(Y(g,L,1),Y(f,L,0),Y(w,U,0),Y(g,L,1),Y(w,U,0),Y(b,U,1)):(Y(g,L,1),Y(f,L,0),Y(w,U,1),Y(f,L,0),Y(b,U,0),Y(w,U,1)),(D?M:S).copy(w)):D?(Y(y,U,0),Y(w,U,0),Y(A,U,.5),Y(A,U,.5),Y(w,U,0),Y(M,U,0)):(Y(x,U,1),Y(w,U,1),Y(A,U,.5),Y(A,U,.5),Y(w,U,1),Y(S,U,1)),O=!0}}else J()}else J();E||t!==T-1||Q(e[0],v,_,D,!0,L),L=U,C=A,f.copy(M),g.copy(S)}if(E){if(N&&h){let t=w,e=b;B!==D&&(t=b,e=w),D?(O||B)&&(e.toArray(h,0),e.toArray(h,9),O&&t.toArray(h,3)):!O&&B||(e.toArray(h,3),e.toArray(h,9),O&&t.toArray(h,0))}}else Q(A,y,x,D,!1,U);return F;function q(t,e,i){return i.subVectors(e,t),i.set(-i.y,i.x).normalize()}function Y(t,e,i){h&&(h[z]=t.x,h[z+1]=t.y,h[z+2]=0,n&&(n[z]=0,n[z+1]=0,n[z+2]=1),z+=3,c&&(c[k]=e,c[k+1]=i,k+=2)),F+=3}function Z(i,t,e,n,r){u.copy(t).sub(i).normalize(),d.copy(e).sub(i).normalize();let a=Math.PI;var s=u.dot(d);Math.abs(s)<1&&(a=Math.abs(Math.acos(s))),a/=l,p.copy(t);for(let t=0,e=l-1;t<e;t++)m.copy(p).rotateAround(i,a),Y(p,n,r),Y(m,n,r),Y(i,n,.5),p.copy(m);Y(m,n,r),Y(e,n,r),Y(i,n,.5)}function J(){Y(g,L,1),Y(f,L,0),Y(y,U,0),Y(g,L,1),Y(y,U,0),Y(x,U,1)}function K(t,e,i){e?t?(Y(g,L,1),Y(f,L,0),Y(y,U,0),Y(g,L,1),Y(y,U,0),Y(b,U,1),Y(y,i,0),Y(M,i,0),Y(b,i,.5)):(Y(g,L,1),Y(f,L,0),Y(x,U,1),Y(f,L,0),Y(b,U,0),Y(x,U,1),Y(x,i,1),Y(b,i,0),Y(S,i,1)):(t?(Y(y,i,0),Y(M,i,0)):(Y(x,i,1),Y(S,i,0)),Y(A,i,.5))}function $(t,e){e&&(t?(Y(g,L,1),Y(f,L,0),Y(y,U,0),Y(g,L,1),Y(y,U,0),Y(b,U,1),Y(y,L,0),Y(A,U,.5),Y(b,U,1),Y(A,U,.5),Y(M,L,0),Y(b,U,1)):(Y(g,L,1),Y(f,L,0),Y(x,U,1),Y(f,L,0),Y(b,U,0),Y(x,U,1),Y(x,L,1),Y(b,U,0),Y(A,U,.5),Y(A,U,.5),Y(b,U,0),Y(S,L,1)))}function Q(t,e,i,n,r,a){switch(o.strokeLineCap){case"round":r?Z(t,i,e,a,.5):Z(t,e,i,a,.5);break;case"square":var s;r?(u.subVectors(e,t),d.set(u.y,-u.x),p.addVectors(u,d).add(t),m.subVectors(d,u).add(t),n?(p.toArray(h,3),m.toArray(h,0),m.toArray(h,9)):(p.toArray(h,3),(1===c[7]?m:p).toArray(h,9),m.toArray(h,0))):(u.subVectors(i,t),d.set(u.y,-u.x),p.addVectors(u,d).add(t),m.subVectors(d,u).add(t),s=h.length,n?(p.toArray(h,s-3),m.toArray(h,s-6)):(m.toArray(h,s-6),p.toArray(h,s-3)),m.toArray(h,s-12))}}function tt(i){let n=!1;for(let t=1,e=i.length-1;t<e;t++)if(i[t].distanceTo(i[t+1])<a){n=!0;break}if(!n)return i;const r=[];r.push(i[0]);for(let t=1,e=i.length-1;t<e;t++)i[t].distanceTo(i[t+1])>=a&&r.push(i[t]);return r.push(i[i.length-1]),r}}}function d_(t,e,i=!0){if(!e||!e.isReady)throw new Error("BufferGeometryUtils: Initialized MikkTSpace library required.");if(!t.hasAttribute("position")||!t.hasAttribute("normal")||!t.hasAttribute("uv"))throw new Error('BufferGeometryUtils: Tangents require "position", "normal", and "uv" attributes.');function n(i){if(i.normalized||i.isInterleavedBufferAttribute){const n=new Float32Array(i.count*i.itemSize);for(let t=0,e=0;t<i.count;t++)n[e++]=i.getX(t),n[e++]=i.getY(t),2<i.itemSize&&(n[e++]=i.getZ(t));return n}return i.array instanceof Float32Array?i.array:new Float32Array(i.array)}const r=t.index?t.toNonIndexed():t,a=e.generateTangents(n(r.attributes.position),n(r.attributes.normal),n(r.attributes.uv));if(i)for(let t=3;t<a.length;t+=4)a[t]*=-1;return r.setAttribute("tangent",new Ia(a,4)),t!==r&&t.copy(r),t}function p_(i,n=!1){var r=null!==i[0].index;const a=new Set(Object.keys(i[0].attributes)),s=new Set(Object.keys(i[0].morphAttributes)),o={},l={};var h=i[0].morphTargetsRelative;const c=new Ya;let u=0;for(let e=0;e<i.length;++e){var d=i[e];let t=0;if(r!=(null!==d.index))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+e+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const f in d.attributes){if(!a.has(f))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+e+'. All geometries must have compatible attributes; make sure "'+f+'" attribute exists among all geometries, or in none of them.'),null;void 0===o[f]&&(o[f]=[]),o[f].push(d.attributes[f]),t++}if(t!==a.size)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+e+". Make sure all geometries have the same number of attributes."),null;if(h!==d.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+e+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const g in d.morphAttributes){if(!s.has(g))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+e+".  .morphAttributes must be consistent throughout all geometries."),null;void 0===l[g]&&(l[g]=[]),l[g].push(d.morphAttributes[g])}if(n){let t;if(r)t=d.index.count;else{if(void 0===d.attributes.position)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+e+". The geometry must have either an index or a position attribute"),null;t=d.attributes.position.count}c.addGroup(u,t,e),u+=t}}if(r){let e=0;const v=[];for(let t=0;t<i.length;++t){const _=i[t].index;for(let t=0;t<_.count;++t)v.push(_.getX(t)+e);e+=i[t].attributes.position.count}c.setIndex(v)}for(const e in o){var t=m_(o[e]);if(!t)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+e+" attribute."),null;c.setAttribute(e,t)}for(const y in l){var p=l[y][0].length;if(0===p)break;c.morphAttributes=c.morphAttributes||{},c.morphAttributes[y]=[];for(let e=0;e<p;++e){const x=[];for(let t=0;t<l[y].length;++t)x.push(l[y][t][e]);var m=m_(x);if(!m)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+y+" morphAttribute."),null;c.morphAttributes[y].push(m)}}return c}function m_(e){let i,n,r,a=-1,s=0;for(let t=0;t<e.length;++t){var o=e[t];if(void 0===i&&(i=o.array.constructor),i!==o.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(void 0===n&&(n=o.itemSize),n!==o.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(void 0===r&&(r=o.normalized),r!==o.normalized)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;if(-1===a&&(a=o.gpuType),a!==o.gpuType)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.gpuType must be consistent across matching attributes."),null;s+=o.count*n}const l=new i(s),h=new Ia(l,n,r);let c=0;for(let t=0;t<e.length;++t){const p=e[t];if(p.isInterleavedBufferAttribute){var u=c/n;for(let e=0,t=p.count;e<t;e++)for(let t=0;t<n;t++){var d=p.getComponent(e,t);h.setComponent(e+u,t,d)}}else l.set(p.array,c);c+=p.count*n}return void 0!==a&&(h.gpuType=a),h}function f_(t){return t.isInstancedInterleavedBufferAttribute||t.isInterleavedBufferAttribute?v_(t):(new(t.isInstancedBufferAttribute?bp:Ia)).copy(t)}function g_(i){let n,r=0,a=0;for(let t=0,e=i.length;t<e;++t){var s=i[t];if(void 0===n&&(n=s.array.constructor),n!==s.array.constructor)return console.error("AttributeBuffers of different types cannot be interleaved"),null;r+=s.array.length,a+=s.itemSize}var o=new kd(new n(r),a);let l=0;const h=[];var c=["getX","getY","getZ","getW"],u=["setX","setY","setZ","setW"];for(let t=0,e=i.length;t<e;t++){const m=i[t];var d=m.itemSize,p=m.count;const f=new Gd(o,d,l,m.normalized);h.push(f),l+=d;for(let e=0;e<p;e++)for(let t=0;t<d;t++)f[u[t]](e,m[c[t]](e))}return h}function v_(e){const t=e.data.array.constructor;var i=e.count,n=e.itemSize,r=e.normalized,a=new t(i*n);let s;s=e.isInstancedInterleavedBufferAttribute?new bp(a,n,r,e.meshPerAttribute):new Ia(a,n,r);for(let t=0;t<i;t++)s.setX(t,e.getX(t)),2<=n&&s.setY(t,e.getY(t)),3<=n&&s.setZ(t,e.getZ(t)),4<=n&&s.setW(t,e.getW(t));return s}function __(t){const e=t.attributes,i=t.morphTargets,n=new Map;for(const s in e){var r=e[s];r.isInterleavedBufferAttribute&&(n.has(r)||n.set(r,v_(r)),e[s]=n.get(r))}for(const o in i){var a=i[o];a.isInterleavedBufferAttribute&&(n.has(a)||n.set(a,v_(a)),i[o]=n.get(a))}}function y_(t){let e=0;for(const r in t.attributes){var i=t.getAttribute(r);e+=i.count*i.itemSize*i.array.BYTES_PER_ELEMENT}var n=t.getIndex();return e+=n?n.count*n.itemSize*n.array.BYTES_PER_ELEMENT:0,e}function x_(n,t=1e-4){t=Math.max(t,Number.EPSILON);const e={},r=n.getIndex();var i=n.getAttribute("position"),a=(r||i).count;let s=0;var o=Object.keys(n.attributes);const l={},h={},c=[];var u=["getX","getY","getZ","getW"],d=["setX","setY","setZ","setW"];for(let t=0,e=o.length;t<e;t++){const T=o[t],E=n.attributes[T];l[T]=new E.constructor(new E.array.constructor(E.count*E.itemSize),E.itemSize,E.normalized);const A=n.morphAttributes[T];A&&(h[T]||(h[T]=[]),A.forEach((t,e)=>{var i=new t.array.constructor(t.count*t.itemSize);h[T][e]=new t.constructor(i,t.itemSize,t.normalized)}))}var p=.5*t,m=Math.log10(1/t),f=Math.pow(10,m),g=p*f;for(let t=0;t<a;t++){var v=r?r.getX(t):t;let i="";for(let t=0,e=o.length;t<e;t++){var _=o[t];const C=n.getAttribute(_);var y=C.itemSize;for(let t=0;t<y;t++)i+=~~(C[u[t]](v)*f+g)+","}if(i in e)c.push(e[i]);else{for(let t=0,e=o.length;t<e;t++){var x=o[t];const R=n.getAttribute(x),P=n.morphAttributes[x];var M=R.itemSize;const I=l[x],L=h[x];for(let t=0;t<M;t++){var S=u[t],b=d[t];if(I[b](s,R[S](v)),P)for(let t=0,e=P.length;t<e;t++)L[t][b](s,P[t][S](v))}}e[i]=s,c.push(s),s++}}const w=n.clone();for(const U in n.attributes){const N=l[U];if(w.setAttribute(U,new N.constructor(N.array.slice(0,s*N.itemSize),N.itemSize,N.normalized)),U in h)for(let t=0;t<h[U].length;t++){const D=h[U][t];w.morphAttributes[U][t]=new D.constructor(D.array.slice(0,s*D.itemSize),D.itemSize,D.normalized)}}return w.setIndex(c),w}function M_(t,i){if(i===Xe)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),t;if(i!==qe&&i!==je)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",i),t;{let e=t.getIndex();if(null===e){const o=[];var n=t.getAttribute("position");if(void 0===n)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),t;for(let t=0;t<n.count;t++)o.push(t);t.setIndex(o),e=t.getIndex()}var r=e.count-2;const a=[];if(i===qe)for(let t=1;t<=r;t++)a.push(e.getX(0)),a.push(e.getX(t)),a.push(e.getX(t+1));else for(let t=0;t<r;t++)t%2==0?(a.push(e.getX(t)),a.push(e.getX(t+1)),a.push(e.getX(t+2))):(a.push(e.getX(t+2)),a.push(e.getX(t+1)),a.push(e.getX(t)));a.length/3!=r&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const s=t.clone();return s.setIndex(a),s.clearGroups(),s}}function S_(t){const u=new tr,d=new tr,p=new tr,m=new tr,f=new tr,g=new tr,v=new tr,_=new tr,y=new tr;function e(t,e,i,n,r,a,s,o){u.fromBufferAttribute(e,r),d.fromBufferAttribute(e,a),p.fromBufferAttribute(e,s);var l=t.morphTargetInfluences;if(i&&l){v.set(0,0,0),_.set(0,0,0),y.set(0,0,0);for(let t=0,e=i.length;t<e;t++){var h=l[t],c=i[t];0!==h&&(m.fromBufferAttribute(c,r),f.fromBufferAttribute(c,a),g.fromBufferAttribute(c,s),n?(v.addScaledVector(m,h),_.addScaledVector(f,h),y.addScaledVector(g,h)):(v.addScaledVector(m.sub(u),h),_.addScaledVector(f.sub(d),h),y.addScaledVector(g.sub(p),h)))}u.add(v),d.add(_),p.add(y)}t.isSkinnedMesh&&(t.applyBoneTransform(r,u),t.applyBoneTransform(a,d),t.applyBoneTransform(s,p)),o[3*r+0]=u.x,o[3*r+1]=u.y,o[3*r+2]=u.z,o[3*a+0]=d.x,o[3*a+1]=d.y,o[3*a+2]=d.z,o[3*s+0]=p.x,o[3*s+1]=p.y,o[3*s+2]=p.z}var i=t.geometry,n=t.material;let r,a,s;const o=i.index;var l=i.attributes.position,h=i.morphAttributes.position,c=i.morphTargetsRelative,x=i.attributes.normal,M=i.morphAttributes.position,S=i.groups,b=i.drawRange;let w,T,E,A,C,R,P;var I=new Float32Array(l.count*l.itemSize),L=new Float32Array(x.count*x.itemSize),U,N;if(null!==o)if(Array.isArray(n))for(w=0,E=S.length;w<E;w++)for(C=S[w],R=Math.max(C.start,b.start),P=Math.min(C.start+C.count,b.start+b.count),T=R,A=P;T<A;T+=3)r=o.getX(T),a=o.getX(T+1),s=o.getX(T+2),e(t,l,h,c,r,a,s,I),e(t,x,M,c,r,a,s,L);else for(R=Math.max(0,b.start),P=Math.min(o.count,b.start+b.count),w=R,E=P;w<E;w+=3)r=o.getX(w),a=o.getX(w+1),s=o.getX(w+2),e(t,l,h,c,r,a,s,I),e(t,x,M,c,r,a,s,L);else if(Array.isArray(n))for(w=0,E=S.length;w<E;w++)for(C=S[w],R=Math.max(C.start,b.start),P=Math.min(C.start+C.count,b.start+b.count),T=R,A=P;T<A;T+=3)r=T,a=T+1,s=T+2,e(t,l,h,c,r,a,s,I),e(t,x,M,c,r,a,s,L);else for(R=Math.max(0,b.start),P=Math.min(l.count,b.start+b.count),w=R,E=P;w<E;w+=3)r=w,a=w+1,s=w+2,e(t,l,h,c,r,a,s,I),e(t,x,M,c,r,a,s,L);return{positionAttribute:l,normalAttribute:x,morphedPositionAttribute:new ka(I,3),morphedNormalAttribute:new ka(L,3)}}function b_(e){if(0===e.groups.length)return console.warn("THREE.BufferGeometryUtils.mergeGroups(): No groups are defined. Nothing to merge."),e;let i=e.groups;if(i=i.sort((t,e)=>t.materialIndex!==e.materialIndex?t.materialIndex-e.materialIndex:t.start-e.start),null===e.getIndex()){var n=e.getAttribute("position");const d=[];for(let t=0;t<n.count;t+=3)d.push(t,t+1,t+2);e.setIndex(d)}const r=e.getIndex(),a=[];for(let t=0;t<i.length;t++){var s=i[t],o=s.start,l=o+s.count;for(let t=o;t<l;t++)a.push(r.getX(t))}e.dispose(),e.setIndex(a);let h=0;for(let t=0;t<i.length;t++){const p=i[t];p.start=h,h+=p.count}let c=i[0];e.groups=[c];for(let t=1;t<i.length;t++){var u=i[t];c.materialIndex===u.materialIndex?c.count+=u.count:(c=u,e.groups.push(c))}return e}function w_(t,e=Math.PI/3){var i=Math.cos(e);const r=100*(1+1e-10),n=[new tr,new tr,new tr],a=new tr,s=new tr,o=new tr,l=new tr;function h(t){var e,i,n;return~~(t.x*r)+`,${~~(t.y*r)},`+~~(t.z*r)}const c=t.index?t.toNonIndexed():t;var u=c.attributes.position;const d={};for(let t=0,e=u.count/3;t<e;t++){var p=3*t,m=n[0].fromBufferAttribute(u,0+p),f=n[1].fromBufferAttribute(u,1+p),g=n[2].fromBufferAttribute(u,2+p);a.subVectors(g,f),s.subVectors(m,f);var v=(new tr).crossVectors(a,s).normalize();for(let t=0;t<3;t++){var _,y=h(n[t]);y in d||(d[y]=[]),d[y].push(v)}}var x=new Float32Array(3*u.count);const M=new Ia(x,3,!1);for(let t=0,e=u.count/3;t<e;t++){var S=3*t,b=n[0].fromBufferAttribute(u,0+S),w=n[1].fromBufferAttribute(u,1+S),T=n[2].fromBufferAttribute(u,2+S);a.subVectors(T,w),s.subVectors(b,w),o.crossVectors(a,s).normalize();for(let t=0;t<3;t++){var E,A=h(n[t]),C=d[A];l.set(0,0,0);for(let t=0,e=C.length;t<e;t++){var R=C[t];o.dot(R)>i&&l.add(R)}l.normalize(),M.setXYZ(S+t,l.x,l.y,l.z)}}return c.setAttribute("normal",M),c}const T_=new nr,E_=new tr;class A_ extends bv{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry";var t=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],e=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],i;this.setIndex([0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5]),this.setAttribute("position",new ka(t,3)),this.setAttribute("uv",new ka(e,2))}applyMatrix4(t){const e=this.attributes.instanceStart,i=this.attributes.instanceEnd;return void 0!==e&&(e.applyMatrix4(t),i.applyMatrix4(t),e.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}setPositions(t){let e;t instanceof Float32Array?e=t:Array.isArray(t)&&(e=new Float32Array(t));var i=new v0(e,6,1);return this.setAttribute("instanceStart",new Gd(i,3,0)),this.setAttribute("instanceEnd",new Gd(i,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(t){let e;t instanceof Float32Array?e=t:Array.isArray(t)&&(e=new Float32Array(t));var i=new v0(e,6,1);return this.setAttribute("instanceColorStart",new Gd(i,3,0)),this.setAttribute("instanceColorEnd",new Gd(i,3,3)),this}fromWireframeGeometry(t){return this.setPositions(t.attributes.position.array),this}fromEdgesGeometry(t){return this.setPositions(t.attributes.position.array),this}fromMesh(t){return this.fromWireframeGeometry(new og(t.geometry)),this}fromLineSegments(t){var e=t.geometry;return this.setPositions(e.attributes.position.array),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new nr);var t=this.attributes.instanceStart,e=this.attributes.instanceEnd;void 0!==t&&void 0!==e&&(this.boundingBox.setFromBufferAttribute(t),T_.setFromBufferAttribute(e),this.boundingBox.union(T_))}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Mr),null===this.boundingBox&&this.computeBoundingBox();var n=this.attributes.instanceStart,r=this.attributes.instanceEnd;if(void 0!==n&&void 0!==r){const a=this.boundingSphere.center;this.boundingBox.getCenter(a);let i=0;for(let t=0,e=n.count;t<e;t++)E_.fromBufferAttribute(n,t),i=Math.max(i,a.distanceToSquared(E_)),E_.fromBufferAttribute(r,t),i=Math.max(i,a.distanceToSquared(E_));this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(t){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(t)}}Th.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new Mn(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}},Eh.line={uniforms:xs.merge([Th.common,Th.fog,Th.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 tmpFwd = normalize( mix( start.xyz, end.xyz, 0.5 ) );
				vec3 worldUp = normalize( cross( worldDir, tmpFwd ) );
				vec3 worldFwd = cross( worldDir, worldUp );
				worldPos = position.y < 0.5 ? start: end;

				// height offset
				float hw = linewidth * 0.5;
				worldPos.xyz += position.x < 0.0 ? hw * worldUp : - hw * worldUp;

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// cap extension
					worldPos.xyz += position.y < 0.5 ? - hw * worldDir : hw * worldDir;

					// add width to the box
					worldPos.xyz += worldFwd * hw;

					// endcaps
					if ( position.y > 1.0 || position.y < 0.0 ) {

						worldPos.xyz -= worldFwd * 2.0 * hw;

					}

				#endif

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segments overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <colorspace_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};class C_ extends nh{constructor(t){super({type:"LineMaterial",uniforms:xs.clone(Eh.line.uniforms),vertexShader:Eh.line.vertexShader,fragmentShader:Eh.line.fragmentShader,clipping:!0}),this.isLineMaterial=!0,this.setValues(t)}get color(){return this.uniforms.diffuse.value}set color(t){this.uniforms.diffuse.value=t}get worldUnits(){return"WORLD_UNITS"in this.defines}set worldUnits(t){!0===t?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}get linewidth(){return this.uniforms.linewidth.value}set linewidth(t){this.uniforms.linewidth&&(this.uniforms.linewidth.value=t)}get dashed(){return"USE_DASH"in this.defines}set dashed(t){!0===t!==this.dashed&&(this.needsUpdate=!0),!0===t?this.defines.USE_DASH="":delete this.defines.USE_DASH}get dashScale(){return this.uniforms.dashScale.value}set dashScale(t){this.uniforms.dashScale.value=t}get dashSize(){return this.uniforms.dashSize.value}set dashSize(t){this.uniforms.dashSize.value=t}get dashOffset(){return this.uniforms.dashOffset.value}set dashOffset(t){this.uniforms.dashOffset.value=t}get gapSize(){return this.uniforms.gapSize.value}set gapSize(t){this.uniforms.gapSize.value=t}get opacity(){return this.uniforms.opacity.value}set opacity(t){this.uniforms&&(this.uniforms.opacity.value=t)}get resolution(){return this.uniforms.resolution.value}set resolution(t){this.uniforms.resolution.value.copy(t)}get alphaToCoverage(){return"USE_ALPHA_TO_COVERAGE"in this.defines}set alphaToCoverage(t){this.defines&&(!0===t!==this.alphaToCoverage&&(this.needsUpdate=!0),!0===t?this.defines.USE_ALPHA_TO_COVERAGE="":delete this.defines.USE_ALPHA_TO_COVERAGE)}}const R_=new jn,P_=new tr,I_=new tr,L_=new jn,U_=new jn,N_=new jn,D_=new tr,O_=new Pr,B_=new P0,F_=new tr,z_=new nr,k_=new Mr,V_=new jn;let G_,H_;function W_(t,e,i){return V_.set(0,0,-e,1).applyMatrix4(t.projectionMatrix),V_.multiplyScalar(1/V_.w),V_.x=H_/i.width,V_.y=H_/i.height,V_.applyMatrix4(t.projectionMatrixInverse),V_.multiplyScalar(1/V_.w),Math.abs(Math.max(V_.x,V_.y))}function X_(i,n){var r=i.matrixWorld,a=i.geometry,s=a.attributes.instanceStart,o=a.attributes.instanceEnd,t;for(let t=0,e=Math.min(a.instanceCount,s.count);t<e;t++){B_.start.fromBufferAttribute(s,t),B_.end.fromBufferAttribute(o,t),B_.applyMatrix4(r);var l=new tr,h;const c=new tr;G_.distanceSqToSegment(B_.start,B_.end,c,l),c.distanceTo(l)<.5*H_&&n.push({point:c,pointOnLine:l,distance:G_.origin.distanceTo(c),object:i,face:null,faceIndex:t,uv:null,uv1:null})}}function j_(i,t,n){var r=t.projectionMatrix,e,a=i.material.resolution,s=i.matrixWorld,o=i.geometry,l=o.attributes.instanceStart,h=o.attributes.instanceEnd,c=Math.min(o.instanceCount,l.count),u=-t.near,d,p,m,f,g,v,_,y,x,M,S;G_.at(1,N_),N_.w=1,N_.applyMatrix4(t.matrixWorldInverse),N_.applyMatrix4(r),N_.multiplyScalar(1/N_.w),N_.x*=a.x/2,N_.y*=a.y/2,N_.z=0,D_.copy(N_),O_.multiplyMatrices(t.matrixWorldInverse,s);for(let t=0,e=c;t<e;t++){L_.fromBufferAttribute(l,t),U_.fromBufferAttribute(h,t),L_.w=1,U_.w=1,L_.applyMatrix4(O_),U_.applyMatrix4(O_),L_.z>u&&U_.z>u||(L_.z>u?(p=L_.z-U_.z,m=(L_.z-u)/p,L_.lerp(U_,m)):U_.z>u&&(f=U_.z-L_.z,g=(U_.z-u)/f,U_.lerp(L_,g)),L_.applyMatrix4(r),U_.applyMatrix4(r),L_.multiplyScalar(1/L_.w),U_.multiplyScalar(1/U_.w),L_.x*=a.x/2,L_.y*=a.y/2,U_.x*=a.x/2,U_.y*=a.y/2,B_.start.copy(L_),B_.start.z=0,B_.end.copy(U_),B_.end.z=0,v=B_.closestPointToPointParameter(D_,!0),B_.at(v,F_),y=-1<=(_=xn.lerp(L_.z,U_.z,v))&&_<=1,x=D_.distanceTo(F_)<.5*H_,y&&x&&(B_.start.fromBufferAttribute(l,t),B_.end.fromBufferAttribute(h,t),B_.start.applyMatrix4(s),B_.end.applyMatrix4(s),M=new tr,S=new tr,G_.distanceSqToSegment(B_.start,B_.end,S,M),n.push({point:S,pointOnLine:M,distance:G_.origin.distanceTo(S),object:i,face:null,faceIndex:t,uv:null,uv1:null})))}}class q_ extends ds{constructor(t=new A_,e=new C_({color:16777215*Math.random()})){super(t,e),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){const t=this.geometry;var n=t.attributes.instanceStart,r=t.attributes.instanceEnd;const a=new Float32Array(2*n.count);for(let t=0,e=0,i=n.count;t<i;t++,e+=2)P_.fromBufferAttribute(n,t),I_.fromBufferAttribute(r,t),a[e]=0===e?0:a[e-1],a[e+1]=a[e]+P_.distanceTo(I_);var e=new v0(a,2,1);return t.setAttribute("instanceDistanceStart",new Gd(e,1,0)),t.setAttribute("instanceDistanceEnd",new Gd(e,1,1)),this}raycast(t,e){var i=this.material.worldUnits,n=t.camera;null!==n||i||console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');var r=void 0!==t.params.Line2&&t.params.Line2.threshold||0;G_=t.ray;var a=this.matrixWorld;const s=this.geometry;var o=this.material,l,h;H_=o.linewidth+r,null===s.boundingSphere&&s.computeBoundingSphere(),k_.copy(s.boundingSphere).applyMatrix4(a);let c;if(c=i?.5*H_:W_(n,l=Math.max(n.near,k_.distanceToPoint(G_.origin)),o.resolution),k_.radius+=c,!1!==G_.intersectsSphere(k_)){null===s.boundingBox&&s.computeBoundingBox(),z_.copy(s.boundingBox).applyMatrix4(a);let t;t=i?.5*H_:W_(n,h=Math.max(n.near,z_.distanceToPoint(G_.origin)),o.resolution),z_.expandByScalar(t),!1!==G_.intersectsBox(z_)&&(i?X_(this,e):j_(this,n,e))}}onBeforeRender(t){var e=this.material.uniforms;e&&e.resolution&&(t.getViewport(R_),this.material.uniforms.resolution.value.set(R_.z,R_.w))}}class Y_ extends A_{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(e){var i=e.length-3;const n=new Float32Array(2*i);for(let t=0;t<i;t+=3)n[2*t]=e[t],n[2*t+1]=e[t+1],n[2*t+2]=e[t+2],n[2*t+3]=e[t+3],n[2*t+4]=e[t+4],n[2*t+5]=e[t+5];return super.setPositions(n),this}setColors(e){var i=e.length-3;const n=new Float32Array(2*i);for(let t=0;t<i;t+=3)n[2*t]=e[t],n[2*t+1]=e[t+1],n[2*t+2]=e[t+2],n[2*t+3]=e[t+3],n[2*t+4]=e[t+4],n[2*t+5]=e[t+5];return super.setColors(n),this}fromLine(t){var e=t.geometry;return this.setPositions(e.attributes.position.array),this}}class Z_ extends q_{constructor(t=new Y_,e=new C_({color:16777215*Math.random()})){super(t,e),this.isLine2=!0,this.type="Line2"}}return t})());"use strict";gapp.register("add.three",[],(e,t)=>{const{THREE:n,SVGLoader:r,BufferGeometryUtils:o,LineMaterial:i,Line2:s,LineGeometry:u,LineSegments2:a,LineSegmentsGeometry:m}=ThreeBundle;e.THREE=n,n.BufferGeometryUtils=o,n.SVGLoader=r.SVGLoader,n.LineMaterial=i,n.Line2=s,n.LineGeometry=u,n.LineSegments2=a,n.LineSegmentsGeometry=m;let c=n.Mesh.prototype,d=n.Box3.prototype,p=n.BufferGeometry.prototype;n.computeFaceNormal=function(e,t,r){const o=new n.Vector3,i=new n.Vector3;return i.subVectors(r,t),o.subVectors(e,t),i.cross(o),i.normalize(),i},n.addBVH=function(){var{computeBoundsTree:e,disposeBoundsTree:t,acceleratedRaycast:r}=MeshBVHLib;n.BufferGeometry.prototype.computeBoundsTree=e,n.BufferGeometry.prototype.disposeBoundsTree=t,n.Mesh.prototype.raycast=r},n.dispose=function(e){if(e&&(e.geometry&&e.geometry.dispose(),e.material&&e.material.map&&e.material.map.dispose&&e.material.map.dispose(),e.children&&e.children.length))for(var t of e.children)n.dispose(t)},Object.defineProperties(d,{dim:{get:function(){return this.max.clone().sub(this.min)}},mid:{get:function(){return this.dim.clone().multiplyScalar(.5).add(this.min)}}}),c.getBoundingBox=function(e){return this.geometry.getBoundingBox(e)},c.mirrorX=function(){return this.mirror(0)},c.mirrorY=function(){return this.mirror(1)},c.mirrorZ=function(){return this.mirror(2)},c.mirror=function(e){let t,r=this.geometry,o=r.attributes,i=o.position.array,n=o.normal.array;for(t=e||0;t<i.length;t+=3)i[t]=-i[t],n[t]=-n[t];return r.computeVertexNormals(),this},p.getBoundingBox=function(e){return!e&&this.boundingBox||(this.boundingBox=null,this.computeBoundingBox()),this.boundingBox},p.moveMesh=function(t=0,r=0,o=0){let e=this.attributes.position,i=e.array;for(let e=0;e<i.length;e+=3)i[e]+=t,i[e+1]+=r,i[e+2]+=o;return e.needsUpdate=!0,this},p.shallowClone=function(){let e=new n.BufferGeometry;for(var[t,r]of Object.entries(this.attributes))e.setAttribute(t,new n.BufferAttribute(r.array,r.itemSize));return e},n.Object3D.prototype.newGroup=function(){var e=new n.Group;return this.add(e),e},n.Object3D.prototype.removeAll=function(){this.children.slice().forEach(function(e){e.parent=void 0,e.dispatchEvent({type:"removed"})}),this.children=[]}});!function(){"use strict";var L={version:"6.4.2.2",use_lines:!0,use_xyz:!1},t=!1,e,i,i,e;"function"==typeof define&&define.amd&&define(L),"undefined"!=typeof document?window.ClipperLib=L:self.ClipperLib=L,e=t?(i="chrome","Netscape"):(i=navigator.userAgent.toString().toLowerCase(),navigator.appName);var n={},o;-1!=i.indexOf("chrome")&&-1==i.indexOf("chromium")?n.chrome=1:n.chrome=0,-1!=i.indexOf("chromium")?n.chromium=1:n.chromium=0,-1!=i.indexOf("safari")&&-1==i.indexOf("chrome")&&-1==i.indexOf("chromium")?n.safari=1:n.safari=0,-1!=i.indexOf("firefox")?n.firefox=1:n.firefox=0,-1!=i.indexOf("firefox/17")?n.firefox17=1:n.firefox17=0,-1!=i.indexOf("firefox/15")?n.firefox15=1:n.firefox15=0,-1!=i.indexOf("firefox/3")?n.firefox3=1:n.firefox3=0,-1!=i.indexOf("opera")?n.opera=1:n.opera=0,-1!=i.indexOf("msie 10")?n.msie10=1:n.msie10=0,-1!=i.indexOf("msie 9")?n.msie9=1:n.msie9=0,-1!=i.indexOf("msie 8")?n.msie8=1:n.msie8=0,-1!=i.indexOf("msie 7")?n.msie7=1:n.msie7=0,-1!=i.indexOf("msie ")?n.msie=1:n.msie=0;var r=0xdeadbeefcafe,s=!(L.biginteger_used=null);function C(t,e,i){L.biginteger_used=1,null!=t&&("number"==typeof t&&void 0===e?this.fromInt(t):"number"==typeof t?this.fromNumber(t,e,i):null==e&&"string"!=typeof t?this.fromString(t,256):this.fromString(t,e))}function I(){return new C(null,void 0,void 0)}function l(t,e,i,n,o,r){for(;0<=--r;){var s=e*this[t++]+i[n]+o;o=Math.floor(s/67108864),i[n++]=67108863&s}return o}function p(t,e,i,n,o,r){for(var s=32767&e,l=e>>15;0<=--r;){var p=32767&this[t],u=this[t++]>>15,h=l*p+u*s,p;o=((p=s*p+((32767&h)<<15)+i[n]+(1073741823&o))>>>30)+(h>>>15)+l*u+(o>>>30),i[n++]=1073741823&p}return o}function u(t,e,i,n,o,r){for(var s=16383&e,l=e>>14;0<=--r;){var p=16383&this[t],u=this[t++]>>14,h=l*p+u*s,p;o=((p=s*p+((16383&h)<<14)+i[n]+o)>>28)+(h>>14)+l*u,i[n++]=268435455&p}return o}o="Microsoft Internet Explorer"==e?(C.prototype.am=p,30):"Netscape"!=e?(C.prototype.am=l,26):(C.prototype.am=u,28),C.prototype.DB=o,C.prototype.DM=(1<<o)-1,C.prototype.DV=1<<o;var h=52;C.prototype.FV=Math.pow(2,h),C.prototype.F1=h-o,C.prototype.F2=2*o-h;for(var a="0123456789abcdefghijklmnopqrstuvwxyz",f=new Array,d,P,d="0".charCodeAt(0),P=0;P<=9;++P)f[d++]=P;for(d="a".charCodeAt(0),P=10;P<36;++P)f[d++]=P;for(d="A".charCodeAt(0),P=10;P<36;++P)f[d++]=P;function m(t){return a.charAt(t)}function y(t,e){var i=f[t.charCodeAt(e)];return null==i?-1:i}function c(t){for(var e=this.t-1;0<=e;--e)t[e]=this[e];t.t=this.t,t.s=this.s}function v(t){this.t=1,this.s=t<0?-1:0,0<t?this[0]=t:t<-1?this[0]=t+this.DV:this.t=0}function x(t){var e=I();return e.fromInt(t),e}function _(t,e){var i;if(16==e)i=4;else if(8==e)i=3;else if(256==e)i=8;else if(2==e)i=1;else if(32==e)i=5;else{if(4!=e)return void this.fromRadix(t,e);i=2}this.t=0,this.s=0;for(var n=t.length,o=!1,r=0;0<=--n;){var s=8==i?255&t[n]:y(t,n);s<0?"-"==t.charAt(n)&&(o=!0):(o=!1,0==r?this[this.t++]=s:r+i>this.DB?(this[this.t-1]|=(s&(1<<this.DB-r)-1)<<r,this[this.t++]=s>>this.DB-r):this[this.t-1]|=s<<r,(r+=i)>=this.DB&&(r-=this.DB))}8==i&&0!=(128&t[0])&&(this.s=-1,0<r&&(this[this.t-1]|=(1<<this.DB-r)-1<<r)),this.clamp(),o&&C.ZERO.subTo(this,this)}function E(){for(var t=this.s&this.DM;0<this.t&&this[this.t-1]==t;)--this.t}function T(t){if(this.s<0)return"-"+this.negate().toString(t);var e;if(16==t)e=4;else if(8==t)e=3;else if(2==t)e=1;else if(32==t)e=5;else{if(4!=t)return this.toRadix(t);e=2}var i=(1<<e)-1,n,o=!1,r="",s=this.t,l=this.DB-s*this.DB%e;if(0<s--)for(l<this.DB&&0<(n=this[s]>>l)&&(o=!0,r=m(n));0<=s;)l<e?(n=(this[s]&(1<<l)-1)<<e-l,n|=this[--s]>>(l+=this.DB-e)):(n=this[s]>>(l-=e)&i,l<=0&&(l+=this.DB,--s)),(o=0<n?!0:o)&&(r+=m(n));return o?r:"0"}function g(){var t=I();return C.ZERO.subTo(this,t),t}function X(){return this.s<0?this.negate():this}function N(t){var e=this.s-t.s;if(0!=e)return e;var i=this.t,e;if(0!=(e=i-t.t))return this.s<0?-e:e;for(;0<=--i;)if(0!=(e=this[i]-t[i]))return e;return 0}function O(t){var e=1,i;return 0!=(i=t>>>16)&&(t=i,e+=16),0!=(i=t>>8)&&(t=i,e+=8),0!=(i=t>>4)&&(t=i,e+=4),0!=(i=t>>2)&&(t=i,e+=2),0!=(i=t>>1)&&(t=i,e+=1),e}function Y(){return this.t<=0?0:this.DB*(this.t-1)+O(this[this.t-1]^this.s&this.DM)}function S(t,e){for(var i,i=this.t-1;0<=i;--i)e[i+t]=this[i];for(i=t-1;0<=i;--i)e[i]=0;e.t=this.t+t,e.s=this.s}function A(t,e){for(var i=t;i<this.t;++i)e[i-t]=this[i];e.t=Math.max(this.t-t,0),e.s=this.s}function B(t,e){for(var i=t%this.DB,n=this.DB-i,o=(1<<n)-1,r=Math.floor(t/this.DB),s=this.s<<i&this.DM,l,l=this.t-1;0<=l;--l)e[l+r+1]=this[l]>>n|s,s=(this[l]&o)<<i;for(l=r-1;0<=l;--l)e[l]=0;e[r]=s,e.t=this.t+r+1,e.s=this.s,e.clamp()}function D(t,e){e.s=this.s;var i=Math.floor(t/this.DB);if(i>=this.t)e.t=0;else{var n=t%this.DB,o=this.DB-n,r=(1<<n)-1;e[0]=this[i]>>n;for(var s=i+1;s<this.t;++s)e[s-i-1]|=(this[s]&r)<<o,e[s-i]=this[s]>>n;0<n&&(e[this.t-i-1]|=(this.s&r)<<o),e.t=this.t-i,e.clamp()}}function b(t,e){for(var i=0,n=0,o=Math.min(t.t,this.t);i<o;)n+=this[i]-t[i],e[i++]=n&this.DM,n>>=this.DB;if(t.t<this.t){for(n-=t.s;i<this.t;)n+=this[i],e[i++]=n&this.DM,n>>=this.DB;n+=this.s}else{for(n+=this.s;i<t.t;)n-=t[i],e[i++]=n&this.DM,n>>=this.DB;n-=t.s}e.s=n<0?-1:0,n<-1?e[i++]=this.DV+n:0<n&&(e[i++]=n),e.t=i,e.clamp()}function M(t,e){var i=this.abs(),n=t.abs(),o=i.t;for(e.t=o+n.t;0<=--o;)e[o]=0;for(o=0;o<n.t;++o)e[o+i.t]=i.am(0,n[o],e,o,0,i.t);e.s=0,e.clamp(),this.s!=t.s&&C.ZERO.subTo(e,e)}function R(t){for(var e=this.abs(),i=t.t=2*e.t;0<=--i;)t[i]=0;for(i=0;i<e.t-1;++i){var n=e.am(i,e[i],t,2*i,0,1);(t[i+e.t]+=e.am(i+1,2*e[i],t,2*i+1,n,e.t-i-1))>=e.DV&&(t[i+e.t]-=e.DV,t[i+e.t+1]=1)}0<t.t&&(t[t.t-1]+=e.am(i,e[i],t,2*i,0,1)),t.s=0,t.clamp()}function w(t,e,i){var n=t.abs();if(!(n.t<=0)){var o=this.abs();if(o.t<n.t)return null!=e&&e.fromInt(0),void(null!=i&&this.copyTo(i));null==i&&(i=I());var r=I(),s=this.s,l=t.s,p=this.DB-O(n[n.t-1]);0<p?(n.lShiftTo(p,r),o.lShiftTo(p,i)):(n.copyTo(r),o.copyTo(i));var u=r.t,h=r[u-1];if(0!=h){var a=h*(1<<this.F1)+(1<u?r[u-2]>>this.F2:0),f=this.FV/a,d=(1<<this.F1)/a,P=1<<this.F2,m=i.t,y=m-u,c=null==e?I():e;for(r.dlShiftTo(y,c),0<=i.compareTo(c)&&(i[i.t++]=1,i.subTo(c,i)),C.ONE.dlShiftTo(u,c),c.subTo(r,r);r.t<u;)r[r.t++]=0;for(;0<=--y;){var v=i[--m]==h?this.DM:Math.floor(i[m]*f+(i[m-1]+P)*d);if((i[m]+=r.am(0,v,i,y,0,u))<v)for(r.dlShiftTo(y,c),i.subTo(c,i);i[m]<--v;)i.subTo(c,i)}null!=e&&(i.drShiftTo(u,e),s!=l&&C.ZERO.subTo(e,e)),i.t=u,i.clamp(),0<p&&i.rShiftTo(p,i),s<0&&C.ZERO.subTo(i,i)}}}function F(t){var e=I();return this.abs().divRemTo(t,null,e),this.s<0&&0<e.compareTo(C.ZERO)&&t.subTo(e,e),e}function W(t){this.m=t}function Z(t){return t.s<0||0<=t.compareTo(this.m)?t.mod(this.m):t}function q(t){return t}function z(t){t.divRemTo(this.m,null,t)}function H(t,e,i){t.multiplyTo(e,i),this.reduce(i)}function k(t,e){t.squareTo(e),this.reduce(e)}function U(){if(this.t<1)return 0;var t=this[0];if(0==(1&t))return 0;var e=3&t,e;return 0<(e=(e=(e=(e=e*(2-(15&t)*e)&15)*(2-(255&t)*e)&255)*(2-((65535&t)*e&65535))&65535)*(2-t*e%this.DV)%this.DV)?this.DV-e:-e}function J(t){this.m=t,this.mp=t.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<t.DB-15)-1,this.mt2=2*t.t}function j(t){var e=I();return t.abs().dlShiftTo(this.m.t,e),e.divRemTo(this.m,null,e),t.s<0&&0<e.compareTo(C.ZERO)&&this.m.subTo(e,e),e}function G(t){var e=I();return t.copyTo(e),this.reduce(e),e}function V(t){for(;t.t<=this.mt2;)t[t.t++]=0;for(var e=0;e<this.m.t;++e){var i=32767&t[e],n=i*this.mpl+((i*this.mph+(t[e]>>15)*this.mpl&this.um)<<15)&t.DM,i;for(t[i=e+this.m.t]+=this.m.am(0,n,t,e,0,this.m.t);t[i]>=t.DV;)t[i]-=t.DV,t[++i]++}t.clamp(),t.drShiftTo(this.m.t,t),0<=t.compareTo(this.m)&&t.subTo(this.m,t)}function $(t,e){t.squareTo(e),this.reduce(e)}function K(t,e,i){t.multiplyTo(e,i),this.reduce(i)}function Q(){return 0==(0<this.t?1&this[0]:this.s)}function tt(t,e){if(4294967295<t||t<1)return C.ONE;var i=I(),n=I(),o=e.convert(this),r=O(t)-1,s,i,n;for(o.copyTo(i);0<=--r;){e.sqrTo(i,n),0<(t&1<<r)?e.mulTo(n,o,i):(s=i,i=n,n=s)}return e.revert(i)}function et(t,e){var i,i=new(t<256||e.isEven()?W:J)(e);return this.exp(t,i)}function it(){var t=I();return this.copyTo(t),t}function nt(){if(this.s<0){if(1==this.t)return this[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this[0];if(0==this.t)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]}function ot(){return 0==this.t?this.s:this[0]<<24>>24}function rt(){return 0==this.t?this.s:this[0]<<16>>16}function st(t){return Math.floor(Math.LN2*this.DB/Math.log(t))}function lt(){return this.s<0?-1:this.t<=0||1==this.t&&this[0]<=0?0:1}function pt(t){if(null==t&&(t=10),0==this.signum()||t<2||36<t)return"0";var e=this.chunkSize(t),i=Math.pow(t,e),n=x(i),o=I(),r=I(),s="";for(this.divRemTo(n,o,r);0<o.signum();)s=(i+r.intValue()).toString(t).substr(1)+s,o.divRemTo(n,o,r);return r.intValue().toString(t)+s}function ut(t,e){this.fromInt(0);for(var i=this.chunkSize(e=null==e?10:e),n=Math.pow(e,i),o=!1,r=0,s=0,l=0;l<t.length;++l){var p=y(t,l);p<0?"-"==t.charAt(l)&&0==this.signum()&&(o=!0):(s=e*s+p,++r>=i&&(this.dMultiply(n),this.dAddOffset(s,0),s=r=0))}0<r&&(this.dMultiply(Math.pow(e,r)),this.dAddOffset(s,0)),o&&C.ZERO.subTo(this,this)}function ht(t,e,i){if("number"==typeof e)if(t<2)this.fromInt(1);else for(this.fromNumber(t,i),this.testBit(t-1)||this.bitwiseTo(C.ONE.shiftLeft(t-1),vt,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(e);)this.dAddOffset(2,0),this.bitLength()>t&&this.subTo(C.ONE.shiftLeft(t-1),this);else{var n=new Array,o=7&t;n.length=1+(t>>3),e.nextBytes(n),0<o?n[0]&=(1<<o)-1:n[0]=0,this.fromString(n,256)}}function at(){var t=this.t,e=new Array;e[0]=this.s;var i=this.DB-t*this.DB%8,n,o=0;if(0<t--)for(i<this.DB&&(n=this[t]>>i)!=(this.s&this.DM)>>i&&(e[o++]=n|this.s<<this.DB-i);0<=t;)i<8?(n=(this[t]&(1<<i)-1)<<8-i,n|=this[--t]>>(i+=this.DB-8)):(n=this[t]>>(i-=8)&255,i<=0&&(i+=this.DB,--t)),0!=(128&n)&&(n|=-256),0==o&&(128&this.s)!=(128&n)&&++o,(0<o||n!=this.s)&&(e[o++]=n);return e}function ft(t){return 0==this.compareTo(t)}function dt(t){return this.compareTo(t)<0?this:t}function Pt(t){return 0<this.compareTo(t)?this:t}function mt(t,e,i){for(var n,o,r=Math.min(t.t,this.t),n=0;n<r;++n)i[n]=e(this[n],t[n]);if(t.t<this.t){for(o=t.s&this.DM,n=r;n<this.t;++n)i[n]=e(this[n],o);i.t=this.t}else{for(o=this.s&this.DM,n=r;n<t.t;++n)i[n]=e(o,t[n]);i.t=t.t}i.s=e(this.s,t.s),i.clamp()}function yt(t,e){return t&e}function ct(t){var e=I();return this.bitwiseTo(t,yt,e),e}function vt(t,e){return t|e}function Ct(t){var e=I();return this.bitwiseTo(t,vt,e),e}function It(t,e){return t^e}function xt(t){var e=I();return this.bitwiseTo(t,It,e),e}function _t(t,e){return t&~e}function Lt(t){var e=I();return this.bitwiseTo(t,_t,e),e}function Et(){for(var t=I(),e=0;e<this.t;++e)t[e]=this.DM&~this[e];return t.t=this.t,t.s=~this.s,t}function Tt(t){var e=I();return t<0?this.rShiftTo(-t,e):this.lShiftTo(t,e),e}function gt(t){var e=I();return t<0?this.lShiftTo(-t,e):this.rShiftTo(t,e),e}function Xt(t){if(0==t)return-1;var e=0;return 0==(65535&t)&&(t>>=16,e+=16),0==(255&t)&&(t>>=8,e+=8),0==(15&t)&&(t>>=4,e+=4),0==(3&t)&&(t>>=2,e+=2),0==(1&t)&&++e,e}function Nt(){for(var t=0;t<this.t;++t)if(0!=this[t])return t*this.DB+Xt(this[t]);return this.s<0?this.t*this.DB:-1}function Ot(t){for(var e=0;0!=t;)t&=t-1,++e;return e}function Yt(){for(var t=0,e=this.s&this.DM,i=0;i<this.t;++i)t+=Ot(this[i]^e);return t}function St(t){var e=Math.floor(t/this.DB);return e>=this.t?0!=this.s:0!=(this[e]&1<<t%this.DB)}function At(t,e){var i=C.ONE.shiftLeft(t);return this.bitwiseTo(i,e,i),i}function Bt(t){return this.changeBit(t,vt)}function Dt(t){return this.changeBit(t,_t)}function bt(t){return this.changeBit(t,It)}function Mt(t,e){for(var i=0,n=0,o=Math.min(t.t,this.t);i<o;)n+=this[i]+t[i],e[i++]=n&this.DM,n>>=this.DB;if(t.t<this.t){for(n+=t.s;i<this.t;)n+=this[i],e[i++]=n&this.DM,n>>=this.DB;n+=this.s}else{for(n+=this.s;i<t.t;)n+=t[i],e[i++]=n&this.DM,n>>=this.DB;n+=t.s}e.s=n<0?-1:0,0<n?e[i++]=n:n<-1&&(e[i++]=this.DV+n),e.t=i,e.clamp()}function Rt(t){var e=I();return this.addTo(t,e),e}function wt(t){var e=I();return this.subTo(t,e),e}function Ft(t){var e=I();return this.multiplyTo(t,e),e}function Wt(){var t=I();return this.squareTo(t),t}function Zt(t){var e=I();return this.divRemTo(t,e,null),e}function qt(t){var e=I();return this.divRemTo(t,null,e),e}function zt(t){var e=I(),i=I();return this.divRemTo(t,e,i),new Array(e,i)}function Ht(t){this[this.t]=this.am(0,t-1,this,0,0,this.t),++this.t,this.clamp()}function kt(t,e){if(0!=t){for(;this.t<=e;)this[this.t++]=0;for(this[e]+=t;this[e]>=this.DV;)this[e]-=this.DV,++e>=this.t&&(this[this.t++]=0),++this[e]}}function Ut(){}function Jt(t){return t}function jt(t,e,i){t.multiplyTo(e,i)}function Gt(t,e){t.squareTo(e)}function Vt(t){return this.exp(t,new Ut)}function $t(t,e,i){var n=Math.min(this.t+t.t,e),o;for(i.s=0,i.t=n;0<n;)i[--n]=0;for(o=i.t-this.t;n<o;++n)i[n+this.t]=this.am(0,t[n],i,n,0,this.t);for(o=Math.min(t.t,e);n<o;++n)this.am(0,t[n],i,n,0,e-n);i.clamp()}function Kt(t,e,i){var n=i.t=this.t+t.t- --e;for(i.s=0;0<=--n;)i[n]=0;for(n=Math.max(e-this.t,0);n<t.t;++n)i[this.t+n-e]=this.am(e-n,t[n],i,0,0,this.t+n-e);i.clamp(),i.drShiftTo(1,i)}function Qt(t){this.r2=I(),this.q3=I(),C.ONE.dlShiftTo(2*t.t,this.r2),this.mu=this.r2.divide(t),this.m=t}function te(t){if(t.s<0||t.t>2*this.m.t)return t.mod(this.m);if(t.compareTo(this.m)<0)return t;var e=I();return t.copyTo(e),this.reduce(e),e}function ee(t){return t}function ie(t){for(t.drShiftTo(this.m.t-1,this.r2),t.t>this.m.t+1&&(t.t=this.m.t+1,t.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);t.compareTo(this.r2)<0;)t.dAddOffset(1,this.m.t+1);for(t.subTo(this.r2,t);0<=t.compareTo(this.m);)t.subTo(this.m,t)}function ne(t,e){t.squareTo(e),this.reduce(e)}function oe(t,e,i){t.multiplyTo(e,i),this.reduce(i)}function re(t,e){var i=t.bitLength(),n,o=x(1),r;if(i<=0)return o;var n=i<18?1:i<48?3:i<144?4:i<768?5:6,r=new(i<8?W:e.isEven()?Qt:J)(e),s=new Array,l=3,p=n-1,u=(1<<n)-1;if(s[1]=r.convert(this),1<n){var h=I();for(r.sqrTo(s[1],h);l<=u;)s[l]=I(),r.mulTo(h,s[l-2],s[l]),l+=2}for(var a=t.t-1,f,d=!0,P=I(),m,i=O(t[a])-1;0<=a;){for(p<=i?f=t[a]>>i-p&u:(f=(t[a]&(1<<i+1)-1)<<p-i,0<a&&(f|=t[a-1]>>this.DB+i-p)),l=n;0==(1&f);)f>>=1,--l;if((i-=l)<0&&(i+=this.DB,--a),d)s[f].copyTo(o),d=!1;else{for(;1<l;)r.sqrTo(o,P),r.sqrTo(P,o),l-=2;0<l?r.sqrTo(o,P):(m=o,o=P,P=m),r.mulTo(P,s[f],o)}for(;0<=a&&0==(t[a]&1<<i);)r.sqrTo(o,P),m=o,o=P,P=m,--i<0&&(i=this.DB-1,--a)}return r.revert(o)}function se(t){var e=this.s<0?this.negate():this.clone(),i=t.s<0?t.negate():t.clone(),n,e,i;e.compareTo(i)<0&&(n=e,e=i,i=n);var o=e.getLowestSetBit(),r=i.getLowestSetBit();if(r<0)return e;for(0<(r=o<r?o:r)&&(e.rShiftTo(r,e),i.rShiftTo(r,i));0<e.signum();)0<(o=e.getLowestSetBit())&&e.rShiftTo(o,e),0<(o=i.getLowestSetBit())&&i.rShiftTo(o,i),0<=e.compareTo(i)?(e.subTo(i,e),e.rShiftTo(1,e)):(i.subTo(e,i),i.rShiftTo(1,i));return 0<r&&i.lShiftTo(r,i),i}function le(t){if(t<=0)return 0;var e=this.DV%t,i=this.s<0?t-1:0;if(0<this.t)if(0==e)i=this[0]%t;else for(var n=this.t-1;0<=n;--n)i=(e*i+this[n])%t;return i}function pe(t){var e=t.isEven();if(this.isEven()&&e||0==t.signum())return C.ZERO;for(var i=t.clone(),n=this.clone(),o=x(1),r=x(0),s=x(0),l=x(1);0!=i.signum();){for(;i.isEven();)i.rShiftTo(1,i),e?(o.isEven()&&r.isEven()||(o.addTo(this,o),r.subTo(t,r)),o.rShiftTo(1,o)):r.isEven()||r.subTo(t,r),r.rShiftTo(1,r);for(;n.isEven();)n.rShiftTo(1,n),e?(s.isEven()&&l.isEven()||(s.addTo(this,s),l.subTo(t,l)),s.rShiftTo(1,s)):l.isEven()||l.subTo(t,l),l.rShiftTo(1,l);0<=i.compareTo(n)?(i.subTo(n,i),e&&o.subTo(s,o),r.subTo(l,r)):(n.subTo(i,n),e&&s.subTo(o,s),l.subTo(r,l))}return 0!=n.compareTo(C.ONE)?C.ZERO:0<=l.compareTo(t)?l.subtract(t):l.signum()<0?(l.addTo(t,l),l.signum()<0?l.add(t):l):l}W.prototype.convert=Z,W.prototype.revert=q,W.prototype.reduce=z,W.prototype.mulTo=H,W.prototype.sqrTo=k,J.prototype.convert=j,J.prototype.revert=G,J.prototype.reduce=V,J.prototype.mulTo=K,J.prototype.sqrTo=$,C.prototype.copyTo=c,C.prototype.fromInt=v,C.prototype.fromString=_,C.prototype.clamp=E,C.prototype.dlShiftTo=S,C.prototype.drShiftTo=A,C.prototype.lShiftTo=B,C.prototype.rShiftTo=D,C.prototype.subTo=b,C.prototype.multiplyTo=M,C.prototype.squareTo=R,C.prototype.divRemTo=w,C.prototype.invDigit=U,C.prototype.isEven=Q,C.prototype.exp=tt,C.prototype.toString=T,C.prototype.negate=g,C.prototype.abs=X,C.prototype.compareTo=N,C.prototype.bitLength=Y,C.prototype.mod=F,C.prototype.modPowInt=et,C.ZERO=x(0),C.ONE=x(1),Ut.prototype.convert=Jt,Ut.prototype.revert=Jt,Ut.prototype.mulTo=jt,Ut.prototype.sqrTo=Gt,Qt.prototype.convert=te,Qt.prototype.revert=ee,Qt.prototype.reduce=ie,Qt.prototype.mulTo=oe,Qt.prototype.sqrTo=ne;var ue=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],he=(1<<26)/ue[ue.length-1];function ae(t){var e,i=this.abs();if(1==i.t&&i[0]<=ue[ue.length-1]){for(e=0;e<ue.length;++e)if(i[0]==ue[e])return!0;return!1}if(i.isEven())return!1;for(e=1;e<ue.length;){for(var n=ue[e],o=e+1;o<ue.length&&n<he;)n*=ue[o++];for(n=i.modInt(n);e<o;)if(n%ue[e++]==0)return!1}return i.millerRabin(t)}function fe(t){var e=this.subtract(C.ONE),i=e.getLowestSetBit();if(i<=0)return!1;var n=e.shiftRight(i);ue.length<(t=t+1>>1)&&(t=ue.length);for(var o=I(),r=0;r<t;++r){o.fromInt(ue[Math.floor(Math.random()*ue.length)]);var s=o.modPow(n,this);if(0!=s.compareTo(C.ONE)&&0!=s.compareTo(e)){for(var l=1;l++<i&&0!=s.compareTo(e);)if(0==(s=s.modPowInt(2,this)).compareTo(C.ONE))return!1;if(0!=s.compareTo(e))return!1}}return!0}C.prototype.chunkSize=st,C.prototype.toRadix=pt,C.prototype.fromRadix=ut,C.prototype.fromNumber=ht,C.prototype.bitwiseTo=mt,C.prototype.changeBit=At,C.prototype.addTo=Mt,C.prototype.dMultiply=Ht,C.prototype.dAddOffset=kt,C.prototype.multiplyLowerTo=$t,C.prototype.multiplyUpperTo=Kt,C.prototype.modInt=le,C.prototype.millerRabin=fe,C.prototype.clone=it,C.prototype.intValue=nt,C.prototype.byteValue=ot,C.prototype.shortValue=rt,C.prototype.signum=lt,C.prototype.toByteArray=at,C.prototype.equals=ft,C.prototype.min=dt,C.prototype.max=Pt,C.prototype.and=ct,C.prototype.or=Ct,C.prototype.xor=xt,C.prototype.andNot=Lt,C.prototype.not=Et,C.prototype.shiftLeft=Tt,C.prototype.shiftRight=gt,C.prototype.getLowestSetBit=Nt,C.prototype.bitCount=Yt,C.prototype.testBit=St,C.prototype.setBit=Bt,C.prototype.clearBit=Dt,C.prototype.flipBit=bt,C.prototype.add=Rt,C.prototype.subtract=wt,C.prototype.multiply=Ft,C.prototype.divide=Zt,C.prototype.remainder=qt,C.prototype.divideAndRemainder=zt,C.prototype.modPow=re,C.prototype.modInverse=pe,C.prototype.pow=Vt,C.prototype.gcd=se,C.prototype.isProbablePrime=ae,C.prototype.square=Wt;var de=C;de.prototype.IsNegative=function(){return-1==this.compareTo(de.ZERO)},de.op_Equality=function(t,e){return 0==t.compareTo(e)},de.op_Inequality=function(t,e){return 0!=t.compareTo(e)},de.op_GreaterThan=function(t,e){return 0<t.compareTo(e)},de.op_LessThan=function(t,e){return t.compareTo(e)<0},de.op_Addition=function(t,e){return new de(t,void 0,void 0).add(new de(e,void 0,void 0))},de.op_Subtraction=function(t,e){return new de(t,void 0,void 0).subtract(new de(e,void 0,void 0))},de.Int128Mul=function(t,e){return new de(t,void 0,void 0).multiply(new de(e,void 0,void 0))},de.op_Division=function(t,e){return t.divide(e)},de.prototype.ToDouble=function(){return parseFloat(this.toString())};var Pe=function(t,e){var i;if(void 0===Object.getOwnPropertyNames){for(i in e.prototype)void 0!==t.prototype[i]&&t.prototype[i]!==Object.prototype[i]||(t.prototype[i]=e.prototype[i]);for(i in e)void 0===t[i]&&(t[i]=e[i]);t.$baseCtor=e}else{for(var n=Object.getOwnPropertyNames(e.prototype),o=0;o<n.length;o++)void 0===Object.getOwnPropertyDescriptor(t.prototype,n[o])&&Object.defineProperty(t.prototype,n[o],Object.getOwnPropertyDescriptor(e.prototype,n[o]));for(i in e)void 0===t[i]&&(t[i]=e[i]);t.$baseCtor=e}};L.Path=function(){return[]},L.Path.prototype.push=Array.prototype.push,L.Paths=function(){return[]},L.Paths.prototype.push=Array.prototype.push,L.DoublePoint=function(){var t=arguments;this.X=0,this.Y=0,1===t.length?(this.X=t[0].X,this.Y=t[0].Y):2===t.length&&(this.X=t[0],this.Y=t[1])},L.DoublePoint0=function(){this.X=0,this.Y=0},L.DoublePoint0.prototype=L.DoublePoint.prototype,L.DoublePoint1=function(t){this.X=t.X,this.Y=t.Y},L.DoublePoint1.prototype=L.DoublePoint.prototype,L.DoublePoint2=function(t,e){this.X=t,this.Y=e},L.DoublePoint2.prototype=L.DoublePoint.prototype,L.PolyNode=function(){this.m_Parent=null,this.m_polygon=new L.Path,this.m_Index=0,this.m_jointype=0,this.m_endtype=0,this.m_Childs=[],this.IsOpen=!1},L.PolyNode.prototype.IsHoleNode=function(){for(var t=!0,e=this.m_Parent;null!==e;)t=!t,e=e.m_Parent;return t},L.PolyNode.prototype.ChildCount=function(){return this.m_Childs.length},L.PolyNode.prototype.Contour=function(){return this.m_polygon},L.PolyNode.prototype.AddChild=function(t){var e=this.m_Childs.length;this.m_Childs.push(t),t.m_Parent=this,t.m_Index=e},L.PolyNode.prototype.GetNext=function(){return 0<this.m_Childs.length?this.m_Childs[0]:this.GetNextSiblingUp()},L.PolyNode.prototype.GetNextSiblingUp=function(){return null===this.m_Parent?null:this.m_Index===this.m_Parent.m_Childs.length-1?this.m_Parent.GetNextSiblingUp():this.m_Parent.m_Childs[this.m_Index+1]},L.PolyNode.prototype.Childs=function(){return this.m_Childs},L.PolyNode.prototype.Parent=function(){return this.m_Parent},L.PolyNode.prototype.IsHole=function(){return this.IsHoleNode()},L.PolyTree=function(){this.m_AllPolys=[],L.PolyNode.call(this)},L.PolyTree.prototype.Clear=function(){for(var t=0,e=this.m_AllPolys.length;t<e;t++)this.m_AllPolys[t]=null;this.m_AllPolys.length=0,this.m_Childs.length=0},L.PolyTree.prototype.GetFirst=function(){return 0<this.m_Childs.length?this.m_Childs[0]:null},L.PolyTree.prototype.Total=function(){var t=this.m_AllPolys.length;return 0<t&&this.m_Childs[0]!==this.m_AllPolys[0]&&t--,t},Pe(L.PolyTree,L.PolyNode),L.Math_Abs_Int64=L.Math_Abs_Int32=L.Math_Abs_Double=function(t){return Math.abs(t)},L.Math_Max_Int32_Int32=function(t,e){return Math.max(t,e)},n.msie||n.opera||n.safari?L.Cast_Int32=function(t){return 0|t}:L.Cast_Int32=function(t){return~~t},void 0===Number.toInteger&&(Number.toInteger=null),n.chrome?L.Cast_Int64=function(t){return t<-2147483648||2147483647<t?t<0?Math.ceil(t):Math.floor(t):~~t}:n.firefox&&"function"==typeof Number.toInteger?L.Cast_Int64=function(t){return Number.toInteger(t)}:n.msie7||n.msie8?L.Cast_Int64=function(t){return parseInt(t,10)}:n.msie?L.Cast_Int64=function(t){return t<-2147483648||2147483647<t?t<0?Math.ceil(t):Math.floor(t):0|t}:L.Cast_Int64=function(t){return t<0?Math.ceil(t):Math.floor(t)},L.Clear=function(t){t.length=0},L.PI=3.141592653589793,L.PI2=6.283185307179586,L.IntPoint=function(){var t=arguments,e=t.length,i,n,i,n;this.X=0,this.Y=0,L.use_xyz?(this.Z=0,3===e?(this.X=t[0],this.Y=t[1],this.Z=t[2]):2===e?(this.X=t[0],this.Y=t[1],this.Z=0):1===e?t[0]instanceof L.DoublePoint?(this.X=L.Clipper.Round((i=t[0]).X),this.Y=L.Clipper.Round(i.Y),this.Z=0):(void 0===(n=t[0]).Z&&(n.Z=0),this.X=n.X,this.Y=n.Y,this.Z=n.Z):(this.X=0,this.Y=0,this.Z=0)):2===e?(this.X=t[0],this.Y=t[1]):1===e?t[0]instanceof L.DoublePoint?(this.X=L.Clipper.Round((i=t[0]).X),this.Y=L.Clipper.Round(i.Y)):(this.X=(n=t[0]).X,this.Y=n.Y):(this.X=0,this.Y=0)},L.IntPoint.op_Equality=function(t,e){return t.X===e.X&&t.Y===e.Y},L.IntPoint.op_Inequality=function(t,e){return t.X!==e.X||t.Y!==e.Y},L.IntPoint0=function(){this.X=0,this.Y=0,L.use_xyz&&(this.Z=0)},L.IntPoint0.prototype=L.IntPoint.prototype,L.IntPoint1=function(t){this.X=t.X,this.Y=t.Y,L.use_xyz&&(void 0===t.Z?this.Z=0:this.Z=t.Z)},L.IntPoint1.prototype=L.IntPoint.prototype,L.IntPoint1dp=function(t){this.X=L.Clipper.Round(t.X),this.Y=L.Clipper.Round(t.Y),L.use_xyz&&(this.Z=0)},L.IntPoint1dp.prototype=L.IntPoint.prototype,L.IntPoint2=function(t,e,i){this.X=t,this.Y=e,L.use_xyz&&(this.Z=void 0===i?0:i)},L.IntPoint2.prototype=L.IntPoint.prototype,L.IntRect=function(){var t=arguments,e=t.length,i;4===e?(this.left=t[0],this.top=t[1],this.right=t[2],this.bottom=t[3]):1===e?(this.left=(i=t[0]).left,this.top=i.top,this.right=i.right,this.bottom=i.bottom):(this.left=0,this.top=0,this.right=0,this.bottom=0)},L.IntRect0=function(){this.left=0,this.top=0,this.right=0,this.bottom=0},L.IntRect0.prototype=L.IntRect.prototype,L.IntRect1=function(t){this.left=t.left,this.top=t.top,this.right=t.right,this.bottom=t.bottom},L.IntRect1.prototype=L.IntRect.prototype,L.IntRect4=function(t,e,i,n){this.left=t,this.top=e,this.right=i,this.bottom=n},L.IntRect4.prototype=L.IntRect.prototype,L.ClipType={ctIntersection:0,ctUnion:1,ctDifference:2,ctXor:3},L.PolyType={ptSubject:0,ptClip:1},L.PolyFillType={pftEvenOdd:0,pftNonZero:1,pftPositive:2,pftNegative:3},L.JoinType={jtSquare:0,jtRound:1,jtMiter:2},L.EndType={etOpenSquare:0,etOpenRound:1,etOpenButt:2,etClosedLine:3,etClosedPolygon:4},L.EdgeSide={esLeft:0,esRight:1},L.Direction={dRightToLeft:0,dLeftToRight:1},L.TEdge=function(){this.Bot=new L.IntPoint0,this.Curr=new L.IntPoint0,this.Top=new L.IntPoint0,this.Delta=new L.IntPoint0,this.Dx=0,this.PolyTyp=L.PolyType.ptSubject,this.Side=L.EdgeSide.esLeft,this.WindDelta=0,this.WindCnt=0,this.WindCnt2=0,this.OutIdx=0,this.Next=null,this.Prev=null,this.NextInLML=null,this.NextInAEL=null,this.PrevInAEL=null,this.NextInSEL=null,this.PrevInSEL=null},L.IntersectNode=function(){this.Edge1=null,this.Edge2=null,this.Pt=new L.IntPoint0},L.MyIntersectNodeSort=function(){},L.MyIntersectNodeSort.Compare=function(t,e){var i=e.Pt.Y-t.Pt.Y;return 0<i?1:i<0?-1:0},L.LocalMinima=function(){this.Y=0,this.LeftBound=null,this.RightBound=null,this.Next=null},L.Scanbeam=function(){this.Y=0,this.Next=null},L.Maxima=function(){this.X=0,this.Next=null,this.Prev=null},L.OutRec=function(){this.Idx=0,this.IsHole=!1,this.IsOpen=!1,this.FirstLeft=null,this.Pts=null,this.BottomPt=null,this.PolyNode=null},L.OutPt=function(){this.Idx=0,this.Pt=new L.IntPoint0,this.Next=null,this.Prev=null},L.Join=function(){this.OutPt1=null,this.OutPt2=null,this.OffPt=new L.IntPoint0},L.ClipperBase=function(){this.m_MinimaList=null,this.m_CurrentLM=null,this.m_edges=new Array,this.m_UseFullRange=!1,this.m_HasOpenPaths=!1,this.PreserveCollinear=!1,this.m_Scanbeam=null,this.m_PolyOuts=null,this.m_ActiveEdges=null},L.ClipperBase.horizontal=-9007199254740992,L.ClipperBase.Skip=-2,L.ClipperBase.Unassigned=-1,L.ClipperBase.tolerance=1e-20,L.ClipperBase.loRange=47453132,L.ClipperBase.hiRange=0xfffffffffffff,L.ClipperBase.near_zero=function(t){return t>-L.ClipperBase.tolerance&&t<L.ClipperBase.tolerance},L.ClipperBase.IsHorizontal=function(t){return 0===t.Delta.Y},L.ClipperBase.prototype.PointIsVertex=function(t,e){var i=e;do{if(L.IntPoint.op_Equality(i.Pt,t))return!0}while((i=i.Next)!==e);return!1},L.ClipperBase.prototype.PointOnLineSegment=function(t,e,i,n){return n?t.X===e.X&&t.Y===e.Y||t.X===i.X&&t.Y===i.Y||t.X>e.X==t.X<i.X&&t.Y>e.Y==t.Y<i.Y&&de.op_Equality(de.Int128Mul(t.X-e.X,i.Y-e.Y),de.Int128Mul(i.X-e.X,t.Y-e.Y)):t.X===e.X&&t.Y===e.Y||t.X===i.X&&t.Y===i.Y||t.X>e.X==t.X<i.X&&t.Y>e.Y==t.Y<i.Y&&(t.X-e.X)*(i.Y-e.Y)==(i.X-e.X)*(t.Y-e.Y)},L.ClipperBase.prototype.PointOnPolygon=function(t,e,i){for(var n=e;;){if(this.PointOnLineSegment(t,n.Pt,n.Next.Pt,i))return!0;if((n=n.Next)===e)break}return!1},L.ClipperBase.prototype.SlopesEqual=L.ClipperBase.SlopesEqual=function(){var t=arguments,e=t.length,i,n,o,r,s,l,p;return 3===e?(i=t[0],n=t[1],(p=t[2])?de.op_Equality(de.Int128Mul(i.Delta.Y,n.Delta.X),de.Int128Mul(i.Delta.X,n.Delta.Y)):L.Cast_Int64(i.Delta.Y*n.Delta.X)===L.Cast_Int64(i.Delta.X*n.Delta.Y)):4===e?(o=t[0],r=t[1],s=t[2],(p=t[3])?de.op_Equality(de.Int128Mul(o.Y-r.Y,r.X-s.X),de.Int128Mul(o.X-r.X,r.Y-s.Y)):L.Cast_Int64((o.Y-r.Y)*(r.X-s.X))-L.Cast_Int64((o.X-r.X)*(r.Y-s.Y))==0):(o=t[0],r=t[1],s=t[2],l=t[3],(p=t[4])?de.op_Equality(de.Int128Mul(o.Y-r.Y,s.X-l.X),de.Int128Mul(o.X-r.X,s.Y-l.Y)):L.Cast_Int64((o.Y-r.Y)*(s.X-l.X))-L.Cast_Int64((o.X-r.X)*(s.Y-l.Y))==0)},L.ClipperBase.SlopesEqual3=function(t,e,i){return i?de.op_Equality(de.Int128Mul(t.Delta.Y,e.Delta.X),de.Int128Mul(t.Delta.X,e.Delta.Y)):L.Cast_Int64(t.Delta.Y*e.Delta.X)===L.Cast_Int64(t.Delta.X*e.Delta.Y)},L.ClipperBase.SlopesEqual4=function(t,e,i,n){return n?de.op_Equality(de.Int128Mul(t.Y-e.Y,e.X-i.X),de.Int128Mul(t.X-e.X,e.Y-i.Y)):L.Cast_Int64((t.Y-e.Y)*(e.X-i.X))-L.Cast_Int64((t.X-e.X)*(e.Y-i.Y))==0},L.ClipperBase.SlopesEqual5=function(t,e,i,n,o){return o?de.op_Equality(de.Int128Mul(t.Y-e.Y,i.X-n.X),de.Int128Mul(t.X-e.X,i.Y-n.Y)):L.Cast_Int64((t.Y-e.Y)*(i.X-n.X))-L.Cast_Int64((t.X-e.X)*(i.Y-n.Y))==0},L.ClipperBase.prototype.Clear=function(){this.DisposeLocalMinimaList();for(var t=0,e=this.m_edges.length;t<e;++t){for(var i=0,n=this.m_edges[t].length;i<n;++i)this.m_edges[t][i]=null;L.Clear(this.m_edges[t])}L.Clear(this.m_edges),this.m_UseFullRange=!1,this.m_HasOpenPaths=!1},L.ClipperBase.prototype.DisposeLocalMinimaList=function(){for(;null!==this.m_MinimaList;){var t=this.m_MinimaList.Next;this.m_MinimaList=null,this.m_MinimaList=t}this.m_CurrentLM=null},L.ClipperBase.prototype.RangeTest=function(t,e){e.Value?(t.X>L.ClipperBase.hiRange||t.Y>L.ClipperBase.hiRange||-t.X>L.ClipperBase.hiRange||-t.Y>L.ClipperBase.hiRange)&&L.Error("Coordinate outside allowed range in RangeTest()."):(t.X>L.ClipperBase.loRange||t.Y>L.ClipperBase.loRange||-t.X>L.ClipperBase.loRange||-t.Y>L.ClipperBase.loRange)&&(e.Value=!0,this.RangeTest(t,e))},L.ClipperBase.prototype.InitEdge=function(t,e,i,n){t.Next=e,t.Prev=i,t.Curr.X=n.X,t.Curr.Y=n.Y,L.use_xyz&&(t.Curr.Z=n.Z),t.OutIdx=-1},L.ClipperBase.prototype.InitEdge2=function(t,e){t.Curr.Y>=t.Next.Curr.Y?(t.Bot.X=t.Curr.X,t.Bot.Y=t.Curr.Y,L.use_xyz&&(t.Bot.Z=t.Curr.Z),t.Top.X=t.Next.Curr.X,t.Top.Y=t.Next.Curr.Y,L.use_xyz&&(t.Top.Z=t.Next.Curr.Z)):(t.Top.X=t.Curr.X,t.Top.Y=t.Curr.Y,L.use_xyz&&(t.Top.Z=t.Curr.Z),t.Bot.X=t.Next.Curr.X,t.Bot.Y=t.Next.Curr.Y,L.use_xyz&&(t.Bot.Z=t.Next.Curr.Z)),this.SetDx(t),t.PolyTyp=e},L.ClipperBase.prototype.FindNextLocMin=function(t){for(var e;;){for(;L.IntPoint.op_Inequality(t.Bot,t.Prev.Bot)||L.IntPoint.op_Equality(t.Curr,t.Top);)t=t.Next;if(t.Dx!==L.ClipperBase.horizontal&&t.Prev.Dx!==L.ClipperBase.horizontal)break;for(;t.Prev.Dx===L.ClipperBase.horizontal;)t=t.Prev;for(e=t;t.Dx===L.ClipperBase.horizontal;)t=t.Next;if(t.Top.Y!==t.Prev.Bot.Y){e.Prev.Bot.X<t.Bot.X&&(t=e);break}}return t},L.ClipperBase.prototype.ProcessBound=function(t,e){var i,n=t,o,r;if(n.OutIdx===L.ClipperBase.Skip){if(t=n,e){for(;t.Top.Y===t.Next.Bot.Y;)t=t.Next;for(;t!==n&&t.Dx===L.ClipperBase.horizontal;)t=t.Prev}else{for(;t.Top.Y===t.Prev.Bot.Y;)t=t.Prev;for(;t!==n&&t.Dx===L.ClipperBase.horizontal;)t=t.Next}return t===n?n=e?t.Next:t.Prev:(t=e?n.Next:n.Prev,(r=new L.LocalMinima).Next=null,r.Y=t.Bot.Y,r.LeftBound=null,(r.RightBound=t).WindDelta=0,n=this.ProcessBound(t,e),this.InsertLocalMinima(r)),n}if(t.Dx===L.ClipperBase.horizontal&&((i=e?t.Prev:t.Next).Dx===L.ClipperBase.horizontal?i.Bot.X!==t.Bot.X&&i.Top.X!==t.Bot.X&&this.ReverseHorizontal(t):i.Bot.X!==t.Bot.X&&this.ReverseHorizontal(t)),i=t,e){for(;n.Top.Y===n.Next.Bot.Y&&n.Next.OutIdx!==L.ClipperBase.Skip;)n=n.Next;if(n.Dx===L.ClipperBase.horizontal&&n.Next.OutIdx!==L.ClipperBase.Skip){for(o=n;o.Prev.Dx===L.ClipperBase.horizontal;)o=o.Prev;o.Prev.Top.X>n.Next.Top.X&&(n=o.Prev)}for(;t!==n;)t.NextInLML=t.Next,t.Dx===L.ClipperBase.horizontal&&t!==i&&t.Bot.X!==t.Prev.Top.X&&this.ReverseHorizontal(t),t=t.Next;t.Dx===L.ClipperBase.horizontal&&t!==i&&t.Bot.X!==t.Prev.Top.X&&this.ReverseHorizontal(t),n=n.Next}else{for(;n.Top.Y===n.Prev.Bot.Y&&n.Prev.OutIdx!==L.ClipperBase.Skip;)n=n.Prev;if(n.Dx===L.ClipperBase.horizontal&&n.Prev.OutIdx!==L.ClipperBase.Skip){for(o=n;o.Next.Dx===L.ClipperBase.horizontal;)o=o.Next;(o.Next.Top.X===n.Prev.Top.X||o.Next.Top.X>n.Prev.Top.X)&&(n=o.Next)}for(;t!==n;)t.NextInLML=t.Prev,t.Dx===L.ClipperBase.horizontal&&t!==i&&t.Bot.X!==t.Next.Top.X&&this.ReverseHorizontal(t),t=t.Prev;t.Dx===L.ClipperBase.horizontal&&t!==i&&t.Bot.X!==t.Next.Top.X&&this.ReverseHorizontal(t),n=n.Prev}return n},L.ClipperBase.prototype.AddPath=function(t,e,i){L.use_lines?i||e!==L.PolyType.ptClip||L.Error("AddPath: Open paths must be subject."):i||L.Error("AddPath: Open paths have been disabled.");var n=t.length-1;if(i)for(;0<n&&L.IntPoint.op_Equality(t[n],t[0]);)--n;for(;0<n&&L.IntPoint.op_Equality(t[n],t[n-1]);)--n;if(i&&n<2||!i&&n<1)return!1;for(var o=new Array,r=0;r<=n;r++)o.push(new L.TEdge);var s=!0;o[1].Curr.X=t[1].X,o[1].Curr.Y=t[1].Y,L.use_xyz&&(o[1].Curr.Z=t[1].Z);var l={Value:this.m_UseFullRange};this.RangeTest(t[0],l),this.m_UseFullRange=l.Value,l.Value=this.m_UseFullRange,this.RangeTest(t[n],l),this.m_UseFullRange=l.Value,this.InitEdge(o[0],o[1],o[n],t[0]),this.InitEdge(o[n],o[0],o[n-1],t[n]);for(var r=n-1;1<=r;--r)l.Value=this.m_UseFullRange,this.RangeTest(t[r],l),this.m_UseFullRange=l.Value,this.InitEdge(o[r],o[r+1],o[r-1],t[r]);for(var p=o[0],u=p,h=p,a,f;;)if(u.Curr!==u.Next.Curr||!i&&u.Next===p){if(u.Prev===u.Next)break;if(!i||!L.ClipperBase.SlopesEqual4(u.Prev.Curr,u.Curr,u.Next.Curr,this.m_UseFullRange)||this.PreserveCollinear&&this.Pt2IsBetweenPt1AndPt3(u.Prev.Curr,u.Curr,u.Next.Curr)){if((u=u.Next)===h||!i&&u.Next===p)break}else u===p&&(p=u.Next),h=u=(u=this.RemoveEdge(u)).Prev}else{if(u===u.Next)break;u===p&&(p=u.Next),h=u=this.RemoveEdge(u)}if(!i&&u===u.Next||i&&u.Prev===u.Next)return!1;for(i||(this.m_HasOpenPaths=!0,p.Prev.OutIdx=L.ClipperBase.Skip),u=p;this.InitEdge2(u,e),u=u.Next,s&&u.Curr.Y!==p.Curr.Y&&(s=!1),u!==p;);if(s){if(i)return!1;for(u.Prev.OutIdx=L.ClipperBase.Skip,(a=new L.LocalMinima).Next=null,a.Y=u.Bot.Y,a.LeftBound=null,a.RightBound=u,a.RightBound.Side=L.EdgeSide.esRight,a.RightBound.WindDelta=0;u.Bot.X!==u.Prev.Top.X&&this.ReverseHorizontal(u),u.Next.OutIdx!==L.ClipperBase.Skip;)u.NextInLML=u.Next,u=u.Next;return this.InsertLocalMinima(a),this.m_edges.push(o),!0}this.m_edges.push(o);var d=null,a;for(L.IntPoint.op_Equality(u.Prev.Bot,u.Prev.Top)&&(u=u.Next);(u=this.FindNextLocMin(u))!==d;){null===d&&(d=u),(a=new L.LocalMinima).Next=null,a.Y=u.Bot.Y,f=u.Dx<u.Prev.Dx?(a.LeftBound=u.Prev,a.RightBound=u,!1):(a.LeftBound=u,a.RightBound=u.Prev,!0),a.LeftBound.Side=L.EdgeSide.esLeft,a.RightBound.Side=L.EdgeSide.esRight,i?a.LeftBound.Next===a.RightBound?a.LeftBound.WindDelta=-1:a.LeftBound.WindDelta=1:a.LeftBound.WindDelta=0,a.RightBound.WindDelta=-a.LeftBound.WindDelta,(u=this.ProcessBound(a.LeftBound,f)).OutIdx===L.ClipperBase.Skip&&(u=this.ProcessBound(u,f));var P=this.ProcessBound(a.RightBound,!f);P.OutIdx===L.ClipperBase.Skip&&(P=this.ProcessBound(P,!f)),a.LeftBound.OutIdx===L.ClipperBase.Skip?a.LeftBound=null:a.RightBound.OutIdx===L.ClipperBase.Skip&&(a.RightBound=null),this.InsertLocalMinima(a),f||(u=P)}return!0},L.ClipperBase.prototype.AddPaths=function(t,e,i){for(var n=!1,o=0,r=t.length;o<r;++o)this.AddPath(t[o],e,i)&&(n=!0);return n},L.ClipperBase.prototype.Pt2IsBetweenPt1AndPt3=function(t,e,i){return!(L.IntPoint.op_Equality(t,i)||L.IntPoint.op_Equality(t,e)||L.IntPoint.op_Equality(i,e))&&(t.X!==i.X?e.X>t.X==e.X<i.X:e.Y>t.Y==e.Y<i.Y)},L.ClipperBase.prototype.RemoveEdge=function(t){t.Prev.Next=t.Next,t.Next.Prev=t.Prev;var e=t.Next;return t.Prev=null,e},L.ClipperBase.prototype.SetDx=function(t){t.Delta.X=t.Top.X-t.Bot.X,t.Delta.Y=t.Top.Y-t.Bot.Y,0===t.Delta.Y?t.Dx=L.ClipperBase.horizontal:t.Dx=t.Delta.X/t.Delta.Y},L.ClipperBase.prototype.InsertLocalMinima=function(t){if(null===this.m_MinimaList)this.m_MinimaList=t;else if(t.Y>=this.m_MinimaList.Y)t.Next=this.m_MinimaList,this.m_MinimaList=t;else{for(var e=this.m_MinimaList;null!==e.Next&&t.Y<e.Next.Y;)e=e.Next;t.Next=e.Next,e.Next=t}},L.ClipperBase.prototype.PopLocalMinima=function(t,e){return e.v=this.m_CurrentLM,null!==this.m_CurrentLM&&this.m_CurrentLM.Y===t&&(this.m_CurrentLM=this.m_CurrentLM.Next,!0)},L.ClipperBase.prototype.ReverseHorizontal=function(t){var e=t.Top.X;t.Top.X=t.Bot.X,t.Bot.X=e,L.use_xyz&&(e=t.Top.Z,t.Top.Z=t.Bot.Z,t.Bot.Z=e)},L.ClipperBase.prototype.Reset=function(){if(this.m_CurrentLM=this.m_MinimaList,null!==this.m_CurrentLM){this.m_Scanbeam=null;for(var t=this.m_MinimaList;null!==t;){this.InsertScanbeam(t.Y);var e=t.LeftBound;null!==e&&(e.Curr.X=e.Bot.X,e.Curr.Y=e.Bot.Y,L.use_xyz&&(e.Curr.Z=e.Bot.Z),e.OutIdx=L.ClipperBase.Unassigned),null!==(e=t.RightBound)&&(e.Curr.X=e.Bot.X,e.Curr.Y=e.Bot.Y,L.use_xyz&&(e.Curr.Z=e.Bot.Z),e.OutIdx=L.ClipperBase.Unassigned),t=t.Next}this.m_ActiveEdges=null}},L.ClipperBase.prototype.InsertScanbeam=function(t){if(null===this.m_Scanbeam)this.m_Scanbeam=new L.Scanbeam,this.m_Scanbeam.Next=null,this.m_Scanbeam.Y=t;else if(t>this.m_Scanbeam.Y){var e=new L.Scanbeam;e.Y=t,e.Next=this.m_Scanbeam,this.m_Scanbeam=e}else{for(var i=this.m_Scanbeam,n;null!==i.Next&&t<=i.Next.Y;)i=i.Next;t!==i.Y&&((n=new L.Scanbeam).Y=t,n.Next=i.Next,i.Next=n)}},L.ClipperBase.prototype.PopScanbeam=function(t){return null===this.m_Scanbeam?(t.v=0,!1):(t.v=this.m_Scanbeam.Y,this.m_Scanbeam=this.m_Scanbeam.Next,!0)},L.ClipperBase.prototype.LocalMinimaPending=function(){return null!==this.m_CurrentLM},L.ClipperBase.prototype.CreateOutRec=function(){var t=new L.OutRec;return t.Idx=L.ClipperBase.Unassigned,t.IsHole=!1,t.IsOpen=!1,t.FirstLeft=null,t.Pts=null,t.BottomPt=null,t.PolyNode=null,this.m_PolyOuts.push(t),t.Idx=this.m_PolyOuts.length-1,t},L.ClipperBase.prototype.DisposeOutRec=function(t){var e;(e=this.m_PolyOuts[t]).Pts=null,this.m_PolyOuts[t]=e=null},L.ClipperBase.prototype.UpdateEdgeIntoAEL=function(t){null===t.NextInLML&&L.Error("UpdateEdgeIntoAEL: invalid call");var e=t.PrevInAEL,i=t.NextInAEL;return t.NextInLML.OutIdx=t.OutIdx,null!==e?e.NextInAEL=t.NextInLML:this.m_ActiveEdges=t.NextInLML,null!==i&&(i.PrevInAEL=t.NextInLML),t.NextInLML.Side=t.Side,t.NextInLML.WindDelta=t.WindDelta,t.NextInLML.WindCnt=t.WindCnt,t.NextInLML.WindCnt2=t.WindCnt2,(t=t.NextInLML).Curr.X=t.Bot.X,t.Curr.Y=t.Bot.Y,t.PrevInAEL=e,t.NextInAEL=i,L.ClipperBase.IsHorizontal(t)||this.InsertScanbeam(t.Top.Y),t},L.ClipperBase.prototype.SwapPositionsInAEL=function(t,e){var i,n,o,r,s,l;t.NextInAEL!==t.PrevInAEL&&e.NextInAEL!==e.PrevInAEL&&(t.NextInAEL===e?(null!==(i=e.NextInAEL)&&(i.PrevInAEL=t),null!==(n=t.PrevInAEL)&&(n.NextInAEL=e),e.PrevInAEL=n,(e.NextInAEL=t).PrevInAEL=e,t.NextInAEL=i):e.NextInAEL===t?(null!==(o=t.NextInAEL)&&(o.PrevInAEL=e),null!==(r=e.PrevInAEL)&&(r.NextInAEL=t),t.PrevInAEL=r,(t.NextInAEL=e).PrevInAEL=t,e.NextInAEL=o):(s=t.NextInAEL,l=t.PrevInAEL,t.NextInAEL=e.NextInAEL,null!==t.NextInAEL&&(t.NextInAEL.PrevInAEL=t),t.PrevInAEL=e.PrevInAEL,null!==t.PrevInAEL&&(t.PrevInAEL.NextInAEL=t),e.NextInAEL=s,null!==e.NextInAEL&&(e.NextInAEL.PrevInAEL=e),e.PrevInAEL=l,null!==e.PrevInAEL&&(e.PrevInAEL.NextInAEL=e)),null===t.PrevInAEL?this.m_ActiveEdges=t:null===e.PrevInAEL&&(this.m_ActiveEdges=e))},L.ClipperBase.prototype.DeleteFromAEL=function(t){var e=t.PrevInAEL,i=t.NextInAEL;null===e&&null===i&&t!==this.m_ActiveEdges||(null!==e?e.NextInAEL=i:this.m_ActiveEdges=i,null!==i&&(i.PrevInAEL=e),t.NextInAEL=null,t.PrevInAEL=null)},L.Clipper=function(t){void 0===t&&(t=0),this.m_PolyOuts=null,this.m_ClipType=L.ClipType.ctIntersection,this.m_Scanbeam=null,this.m_Maxima=null,this.m_ActiveEdges=null,this.m_SortedEdges=null,this.m_IntersectList=null,this.m_IntersectNodeComparer=null,this.m_ExecuteLocked=!1,this.m_ClipFillType=L.PolyFillType.pftEvenOdd,this.m_SubjFillType=L.PolyFillType.pftEvenOdd,this.m_Joins=null,this.m_GhostJoins=null,this.m_UsingPolyTree=!1,this.ReverseSolution=!1,this.StrictlySimple=!1,L.ClipperBase.call(this),this.m_Scanbeam=null,this.m_Maxima=null,this.m_ActiveEdges=null,this.m_SortedEdges=null,this.m_IntersectList=new Array,this.m_IntersectNodeComparer=L.MyIntersectNodeSort.Compare,this.m_ExecuteLocked=!1,this.m_UsingPolyTree=!1,this.m_PolyOuts=new Array,this.m_Joins=new Array,this.m_GhostJoins=new Array,this.ReverseSolution=0!=(1&t),this.StrictlySimple=0!=(2&t),this.PreserveCollinear=0!=(4&t),L.use_xyz&&(this.ZFillFunction=null)},L.Clipper.ioReverseSolution=1,L.Clipper.ioStrictlySimple=2,L.Clipper.ioPreserveCollinear=4,L.Clipper.prototype.Clear=function(){0!==this.m_edges.length&&(this.DisposeAllPolyPts(),L.ClipperBase.prototype.Clear.call(this))},L.Clipper.prototype.InsertMaxima=function(t){var e=new L.Maxima;if(e.X=t,null===this.m_Maxima)this.m_Maxima=e,this.m_Maxima.Next=null,this.m_Maxima.Prev=null;else if(t<this.m_Maxima.X)e.Next=this.m_Maxima,e.Prev=null,this.m_Maxima=e;else{for(var i=this.m_Maxima;null!==i.Next&&t>=i.Next.X;)i=i.Next;t!==i.X&&(e.Next=i.Next,null!==(e.Prev=i).Next&&(i.Next.Prev=e),i.Next=e)}},L.Clipper.prototype.Execute=function(){var t=arguments,e=t.length,i=t[1]instanceof L.PolyTree;if(4===e&&!i){var n=t[0],o=t[1],r=t[2],s=t[3],l;if(this.m_ExecuteLocked)return!1;this.m_HasOpenPaths&&L.Error("Error: PolyTree struct is needed for open path clipping."),this.m_ExecuteLocked=!0,L.Clear(o),this.m_SubjFillType=r,this.m_ClipFillType=s,this.m_ClipType=n,this.m_UsingPolyTree=!1;try{(l=this.ExecuteInternal())&&this.BuildResult(o)}finally{this.DisposeAllPolyPts(),this.m_ExecuteLocked=!1}return l}if(4===e&&i){var n=t[0],p=t[1],r=t[2],s=t[3],l;if(this.m_ExecuteLocked)return!1;this.m_ExecuteLocked=!0,this.m_SubjFillType=r,this.m_ClipFillType=s,this.m_ClipType=n,this.m_UsingPolyTree=!0;try{(l=this.ExecuteInternal())&&this.BuildResult2(p)}finally{this.DisposeAllPolyPts(),this.m_ExecuteLocked=!1}return l}if(2===e&&!i){var n=t[0],o=t[1];return this.Execute(n,o,L.PolyFillType.pftEvenOdd,L.PolyFillType.pftEvenOdd)}if(2===e&&i){var n=t[0],p=t[1];return this.Execute(n,p,L.PolyFillType.pftEvenOdd,L.PolyFillType.pftEvenOdd)}},L.Clipper.prototype.FixHoleLinkage=function(t){if(null!==t.FirstLeft&&(t.IsHole===t.FirstLeft.IsHole||null===t.FirstLeft.Pts)){for(var e=t.FirstLeft;null!==e&&(e.IsHole===t.IsHole||null===e.Pts);)e=e.FirstLeft;t.FirstLeft=e}},L.Clipper.prototype.ExecuteInternal=function(){try{this.Reset(),this.m_SortedEdges=null,this.m_Maxima=null;var t={},e={},i,n,o;if(!this.PopScanbeam(t))return!1;for(this.InsertLocalMinimaIntoAEL(t.v);this.PopScanbeam(e)||this.LocalMinimaPending();){if(this.ProcessHorizontals(),this.m_GhostJoins.length=0,!this.ProcessIntersections(e.v))return!1;this.ProcessEdgesAtTopOfScanbeam(e.v),t.v=e.v,this.InsertLocalMinimaIntoAEL(t.v)}for(n=0,o=this.m_PolyOuts.length;n<o;n++)null===(i=this.m_PolyOuts[n]).Pts||i.IsOpen||(i.IsHole^this.ReverseSolution)==0<this.Area$1(i)&&this.ReversePolyPtLinks(i.Pts);for(this.JoinCommonEdges(),n=0,o=this.m_PolyOuts.length;n<o;n++)null!==(i=this.m_PolyOuts[n]).Pts&&(i.IsOpen?this.FixupOutPolyline(i):this.FixupOutPolygon(i));return this.StrictlySimple&&this.DoSimplePolygons(),!0}finally{this.m_Joins.length=0,this.m_GhostJoins.length=0}},L.Clipper.prototype.DisposeAllPolyPts=function(){for(var t=0,e=this.m_PolyOuts.length;t<e;++t)this.DisposeOutRec(t);L.Clear(this.m_PolyOuts)},L.Clipper.prototype.AddJoin=function(t,e,i){var n=new L.Join;n.OutPt1=t,n.OutPt2=e,n.OffPt.X=i.X,n.OffPt.Y=i.Y,L.use_xyz&&(n.OffPt.Z=i.Z),this.m_Joins.push(n)},L.Clipper.prototype.AddGhostJoin=function(t,e){var i=new L.Join;i.OutPt1=t,i.OffPt.X=e.X,i.OffPt.Y=e.Y,L.use_xyz&&(i.OffPt.Z=e.Z),this.m_GhostJoins.push(i)},L.Clipper.prototype.SetZ=function(t,e,i){null!==this.ZFillFunction&&0===t.Z&&null!==this.ZFillFunction&&(L.IntPoint.op_Equality(t,e.Bot)?t.Z=e.Bot.Z:L.IntPoint.op_Equality(t,e.Top)?t.Z=e.Top.Z:L.IntPoint.op_Equality(t,i.Bot)?t.Z=i.Bot.Z:L.IntPoint.op_Equality(t,i.Top)?t.Z=i.Top.Z:this.ZFillFunction(e.Bot,e.Top,i.Bot,i.Top,t))},L.Clipper.prototype.InsertLocalMinimaIntoAEL=function(t){for(var e={},i,n;this.PopLocalMinima(t,e);){var i=e.v.LeftBound,n=e.v.RightBound,o=null,r,r;if(null===i?(this.InsertEdgeIntoAEL(n,null),this.SetWindingCount(n),this.IsContributing(n)&&(o=this.AddOutPt(n,n.Bot))):(null===n?(this.InsertEdgeIntoAEL(i,null),this.SetWindingCount(i),this.IsContributing(i)&&(o=this.AddOutPt(i,i.Bot))):(this.InsertEdgeIntoAEL(i,null),this.InsertEdgeIntoAEL(n,i),this.SetWindingCount(i),n.WindCnt=i.WindCnt,n.WindCnt2=i.WindCnt2,this.IsContributing(i)&&(o=this.AddLocalMinPoly(i,n,i.Bot))),this.InsertScanbeam(i.Top.Y)),null!==n&&(L.ClipperBase.IsHorizontal(n)?(null!==n.NextInLML&&this.InsertScanbeam(n.NextInLML.Top.Y),this.AddEdgeToSEL(n)):this.InsertScanbeam(n.Top.Y)),null!==i&&null!==n){if(null!==o&&L.ClipperBase.IsHorizontal(n)&&0<this.m_GhostJoins.length&&0!==n.WindDelta)for(var s=0,l=this.m_GhostJoins.length;s<l;s++){var p=this.m_GhostJoins[s];this.HorzSegmentsOverlap(p.OutPt1.Pt.X,p.OffPt.X,n.Bot.X,n.Top.X)&&this.AddJoin(p.OutPt1,o,p.OffPt)}if(0<=i.OutIdx&&null!==i.PrevInAEL&&i.PrevInAEL.Curr.X===i.Bot.X&&0<=i.PrevInAEL.OutIdx&&L.ClipperBase.SlopesEqual5(i.PrevInAEL.Curr,i.PrevInAEL.Top,i.Curr,i.Top,this.m_UseFullRange)&&0!==i.WindDelta&&0!==i.PrevInAEL.WindDelta&&(r=this.AddOutPt(i.PrevInAEL,i.Bot),this.AddJoin(o,r,i.Top)),i.NextInAEL!==n){0<=n.OutIdx&&0<=n.PrevInAEL.OutIdx&&L.ClipperBase.SlopesEqual5(n.PrevInAEL.Curr,n.PrevInAEL.Top,n.Curr,n.Top,this.m_UseFullRange)&&0!==n.WindDelta&&0!==n.PrevInAEL.WindDelta&&(r=this.AddOutPt(n.PrevInAEL,n.Bot),this.AddJoin(o,r,n.Top));var u=i.NextInAEL;if(null!==u)for(;u!==n;)this.IntersectEdges(n,u,i.Curr),u=u.NextInAEL}}}},L.Clipper.prototype.InsertEdgeIntoAEL=function(t,e){if(null===this.m_ActiveEdges)t.PrevInAEL=null,t.NextInAEL=null,this.m_ActiveEdges=t;else if(null===e&&this.E2InsertsBeforeE1(this.m_ActiveEdges,t))t.PrevInAEL=null,t.NextInAEL=this.m_ActiveEdges,this.m_ActiveEdges.PrevInAEL=t,this.m_ActiveEdges=t;else{for(null===e&&(e=this.m_ActiveEdges);null!==e.NextInAEL&&!this.E2InsertsBeforeE1(e.NextInAEL,t);)e=e.NextInAEL;t.NextInAEL=e.NextInAEL,null!==e.NextInAEL&&(e.NextInAEL.PrevInAEL=t),(t.PrevInAEL=e).NextInAEL=t}},L.Clipper.prototype.E2InsertsBeforeE1=function(t,e){return e.Curr.X===t.Curr.X?e.Top.Y>t.Top.Y?e.Top.X<L.Clipper.TopX(t,e.Top.Y):t.Top.X>L.Clipper.TopX(e,t.Top.Y):e.Curr.X<t.Curr.X},L.Clipper.prototype.IsEvenOddFillType=function(t){return t.PolyTyp===L.PolyType.ptSubject?this.m_SubjFillType===L.PolyFillType.pftEvenOdd:this.m_ClipFillType===L.PolyFillType.pftEvenOdd},L.Clipper.prototype.IsEvenOddAltFillType=function(t){return t.PolyTyp===L.PolyType.ptSubject?this.m_ClipFillType===L.PolyFillType.pftEvenOdd:this.m_SubjFillType===L.PolyFillType.pftEvenOdd},L.Clipper.prototype.IsContributing=function(t){var e,i,i=t.PolyTyp===L.PolyType.ptSubject?(e=this.m_SubjFillType,this.m_ClipFillType):(e=this.m_ClipFillType,this.m_SubjFillType);switch(e){case L.PolyFillType.pftEvenOdd:if(0===t.WindDelta&&1!==t.WindCnt)return!1;break;case L.PolyFillType.pftNonZero:if(1!==Math.abs(t.WindCnt))return!1;break;case L.PolyFillType.pftPositive:if(1!==t.WindCnt)return!1;break;default:if(-1!==t.WindCnt)return!1}switch(this.m_ClipType){case L.ClipType.ctIntersection:switch(i){case L.PolyFillType.pftEvenOdd:case L.PolyFillType.pftNonZero:return 0!==t.WindCnt2;case L.PolyFillType.pftPositive:return 0<t.WindCnt2;default:return t.WindCnt2<0}case L.ClipType.ctUnion:switch(i){case L.PolyFillType.pftEvenOdd:case L.PolyFillType.pftNonZero:return 0===t.WindCnt2;case L.PolyFillType.pftPositive:return t.WindCnt2<=0;default:return 0<=t.WindCnt2}case L.ClipType.ctDifference:if(t.PolyTyp===L.PolyType.ptSubject)switch(i){case L.PolyFillType.pftEvenOdd:case L.PolyFillType.pftNonZero:return 0===t.WindCnt2;case L.PolyFillType.pftPositive:return t.WindCnt2<=0;default:return 0<=t.WindCnt2}else switch(i){case L.PolyFillType.pftEvenOdd:case L.PolyFillType.pftNonZero:return 0!==t.WindCnt2;case L.PolyFillType.pftPositive:return 0<t.WindCnt2;default:return t.WindCnt2<0}case L.ClipType.ctXor:if(0!==t.WindDelta)return!0;switch(i){case L.PolyFillType.pftEvenOdd:case L.PolyFillType.pftNonZero:return 0===t.WindCnt2;case L.PolyFillType.pftPositive:return t.WindCnt2<=0;default:return 0<=t.WindCnt2}}return!0},L.Clipper.prototype.SetWindingCount=function(t){for(var e=t.PrevInAEL;null!==e&&(e.PolyTyp!==t.PolyTyp||0===e.WindDelta);)e=e.PrevInAEL;if(null===e){var i=t.PolyTyp===L.PolyType.ptSubject?this.m_SubjFillType:this.m_ClipFillType;0===t.WindDelta?t.WindCnt=i===L.PolyFillType.pftNegative?-1:1:t.WindCnt=t.WindDelta,t.WindCnt2=0,e=this.m_ActiveEdges}else if(0===t.WindDelta&&this.m_ClipType!==L.ClipType.ctUnion)t.WindCnt=1,t.WindCnt2=e.WindCnt2,e=e.NextInAEL;else if(this.IsEvenOddFillType(t)){if(0===t.WindDelta){for(var n=!0,o=e.PrevInAEL;null!==o;)o.PolyTyp===e.PolyTyp&&0!==o.WindDelta&&(n=!n),o=o.PrevInAEL;t.WindCnt=n?0:1}else t.WindCnt=t.WindDelta;t.WindCnt2=e.WindCnt2,e=e.NextInAEL}else e.WindCnt*e.WindDelta<0?1<Math.abs(e.WindCnt)?e.WindDelta*t.WindDelta<0?t.WindCnt=e.WindCnt:t.WindCnt=e.WindCnt+t.WindDelta:t.WindCnt=0===t.WindDelta?1:t.WindDelta:0===t.WindDelta?t.WindCnt=e.WindCnt<0?e.WindCnt-1:e.WindCnt+1:e.WindDelta*t.WindDelta<0?t.WindCnt=e.WindCnt:t.WindCnt=e.WindCnt+t.WindDelta,t.WindCnt2=e.WindCnt2,e=e.NextInAEL;if(this.IsEvenOddAltFillType(t))for(;e!==t;)0!==e.WindDelta&&(t.WindCnt2=0===t.WindCnt2?1:0),e=e.NextInAEL;else for(;e!==t;)t.WindCnt2+=e.WindDelta,e=e.NextInAEL},L.Clipper.prototype.AddEdgeToSEL=function(t){null===this.m_SortedEdges?((this.m_SortedEdges=t).PrevInSEL=null,t.NextInSEL=null):(t.NextInSEL=this.m_SortedEdges,t.PrevInSEL=null,this.m_SortedEdges.PrevInSEL=t,this.m_SortedEdges=t)},L.Clipper.prototype.PopEdgeFromSEL=function(t){if(t.v=this.m_SortedEdges,null===t.v)return!1;var e=t.v;return this.m_SortedEdges=t.v.NextInSEL,null!==this.m_SortedEdges&&(this.m_SortedEdges.PrevInSEL=null),e.NextInSEL=null,!(e.PrevInSEL=null)},L.Clipper.prototype.CopyAELToSEL=function(){var t=this.m_ActiveEdges;for(this.m_SortedEdges=t;null!==t;)t.PrevInSEL=t.PrevInAEL,t.NextInSEL=t.NextInAEL,t=t.NextInAEL},L.Clipper.prototype.SwapPositionsInSEL=function(t,e){var i,n,i,n,i,n;null===t.NextInSEL&&null===t.PrevInSEL||null===e.NextInSEL&&null===e.PrevInSEL||(t.NextInSEL===e?(null!==(i=e.NextInSEL)&&(i.PrevInSEL=t),null!==(n=t.PrevInSEL)&&(n.NextInSEL=e),e.PrevInSEL=n,(e.NextInSEL=t).PrevInSEL=e,t.NextInSEL=i):e.NextInSEL===t?(null!==(i=t.NextInSEL)&&(i.PrevInSEL=e),null!==(n=e.PrevInSEL)&&(n.NextInSEL=t),t.PrevInSEL=n,(t.NextInSEL=e).PrevInSEL=t,e.NextInSEL=i):(i=t.NextInSEL,n=t.PrevInSEL,t.NextInSEL=e.NextInSEL,null!==t.NextInSEL&&(t.NextInSEL.PrevInSEL=t),t.PrevInSEL=e.PrevInSEL,null!==t.PrevInSEL&&(t.PrevInSEL.NextInSEL=t),e.NextInSEL=i,null!==e.NextInSEL&&(e.NextInSEL.PrevInSEL=e),e.PrevInSEL=n,null!==e.PrevInSEL&&(e.PrevInSEL.NextInSEL=e)),null===t.PrevInSEL?this.m_SortedEdges=t:null===e.PrevInSEL&&(this.m_SortedEdges=e))},L.Clipper.prototype.AddLocalMaxPoly=function(t,e,i){this.AddOutPt(t,i),0===e.WindDelta&&this.AddOutPt(e,i),t.OutIdx===e.OutIdx?(t.OutIdx=-1,e.OutIdx=-1):t.OutIdx<e.OutIdx?this.AppendPolygon(t,e):this.AppendPolygon(e,t)},L.Clipper.prototype.AddLocalMinPoly=function(t,e,i){var n,o,r,s,l,p,r=L.ClipperBase.IsHorizontal(e)||t.Dx>e.Dx?(n=this.AddOutPt(t,i),e.OutIdx=t.OutIdx,t.Side=L.EdgeSide.esLeft,e.Side=L.EdgeSide.esRight,((o=t).PrevInAEL===e?e:o).PrevInAEL):(n=this.AddOutPt(e,i),t.OutIdx=e.OutIdx,t.Side=L.EdgeSide.esRight,e.Side=L.EdgeSide.esLeft,((o=e).PrevInAEL===t?t:o).PrevInAEL);return null!==r&&0<=r.OutIdx&&r.Top.Y<i.Y&&o.Top.Y<i.Y&&((s=L.Clipper.TopX(r,i.Y))===(l=L.Clipper.TopX(o,i.Y))&&0!==o.WindDelta&&0!==r.WindDelta&&L.ClipperBase.SlopesEqual5(new L.IntPoint2(s,i.Y),r.Top,new L.IntPoint2(l,i.Y),o.Top,this.m_UseFullRange)&&(p=this.AddOutPt(r,i),this.AddJoin(n,p,o.Top))),n},L.Clipper.prototype.AddOutPt=function(t,e){if(t.OutIdx<0){var i;(i=this.CreateOutRec()).IsOpen=0===t.WindDelta;var n=new L.OutPt;return(i.Pts=n).Idx=i.Idx,n.Pt.X=e.X,n.Pt.Y=e.Y,L.use_xyz&&(n.Pt.Z=e.Z),(n.Next=n).Prev=n,i.IsOpen||this.SetHoleState(t,i),t.OutIdx=i.Idx,n}var i,o=(i=this.m_PolyOuts[t.OutIdx]).Pts,r=t.Side===L.EdgeSide.esLeft,n;return r&&L.IntPoint.op_Equality(e,o.Pt)?o:!r&&L.IntPoint.op_Equality(e,o.Prev.Pt)?o.Prev:((n=new L.OutPt).Idx=i.Idx,n.Pt.X=e.X,n.Pt.Y=e.Y,L.use_xyz&&(n.Pt.Z=e.Z),n.Next=o,n.Prev=o.Prev,n.Prev.Next=n,o.Prev=n,r&&(i.Pts=n),n)},L.Clipper.prototype.GetLastOutPt=function(t){var e=this.m_PolyOuts[t.OutIdx];return t.Side===L.EdgeSide.esLeft?e.Pts:e.Pts.Prev},L.Clipper.prototype.SwapPoints=function(t,e){var i=new L.IntPoint1(t.Value);t.Value.X=e.Value.X,t.Value.Y=e.Value.Y,L.use_xyz&&(t.Value.Z=e.Value.Z),e.Value.X=i.X,e.Value.Y=i.Y,L.use_xyz&&(e.Value.Z=i.Z)},L.Clipper.prototype.HorzSegmentsOverlap=function(t,e,i,n){var o;return e<t&&(o=t,t=e,e=o),n<i&&(o=i,i=n,n=o),t<n&&i<e},L.Clipper.prototype.SetHoleState=function(t,e){for(var i=t.PrevInAEL,n=null;null!==i;)0<=i.OutIdx&&0!==i.WindDelta&&(null===n?n=i:n.OutIdx===i.OutIdx&&(n=null)),i=i.PrevInAEL;null===n?(e.FirstLeft=null,e.IsHole=!1):(e.FirstLeft=this.m_PolyOuts[n.OutIdx],e.IsHole=!e.FirstLeft.IsHole)},L.Clipper.prototype.GetDx=function(t,e){return t.Y===e.Y?L.ClipperBase.horizontal:(e.X-t.X)/(e.Y-t.Y)},L.Clipper.prototype.FirstIsBottomPt=function(t,e){for(var i=t.Prev;L.IntPoint.op_Equality(i.Pt,t.Pt)&&i!==t;)i=i.Prev;for(var n=Math.abs(this.GetDx(t.Pt,i.Pt)),i=t.Next;L.IntPoint.op_Equality(i.Pt,t.Pt)&&i!==t;)i=i.Next;var o=Math.abs(this.GetDx(t.Pt,i.Pt));for(i=e.Prev;L.IntPoint.op_Equality(i.Pt,e.Pt)&&i!==e;)i=i.Prev;var r=Math.abs(this.GetDx(e.Pt,i.Pt));for(i=e.Next;L.IntPoint.op_Equality(i.Pt,e.Pt)&&i!==e;)i=i.Next;var s=Math.abs(this.GetDx(e.Pt,i.Pt));return Math.max(n,o)===Math.max(r,s)&&Math.min(n,o)===Math.min(r,s)?0<this.Area(t):r<=n&&s<=n||r<=o&&s<=o},L.Clipper.prototype.GetBottomPt=function(t){for(var e=null,i=t.Next;i!==t;)i.Pt.Y>t.Pt.Y?(t=i,e=null):i.Pt.Y===t.Pt.Y&&i.Pt.X<=t.Pt.X&&(i.Pt.X<t.Pt.X?(e=null,t=i):i.Next!==t&&i.Prev!==t&&(e=i)),i=i.Next;if(null!==e)for(;e!==i;)for(this.FirstIsBottomPt(i,e)||(t=e),e=e.Next;L.IntPoint.op_Inequality(e.Pt,t.Pt);)e=e.Next;return t},L.Clipper.prototype.GetLowermostRec=function(t,e){null===t.BottomPt&&(t.BottomPt=this.GetBottomPt(t.Pts)),null===e.BottomPt&&(e.BottomPt=this.GetBottomPt(e.Pts));var i=t.BottomPt,n=e.BottomPt;return i.Pt.Y>n.Pt.Y||!(i.Pt.Y<n.Pt.Y)&&(i.Pt.X<n.Pt.X||!(i.Pt.X>n.Pt.X)&&i.Next!==i&&(n.Next===n||this.FirstIsBottomPt(i,n)))?t:e},L.Clipper.prototype.OutRec1RightOfOutRec2=function(t,e){do{if((t=t.FirstLeft)===e)return!0}while(null!==t);return!1},L.Clipper.prototype.GetOutRec=function(t){for(var e=this.m_PolyOuts[t];e!==this.m_PolyOuts[e.Idx];)e=this.m_PolyOuts[e.Idx];return e},L.Clipper.prototype.AppendPolygon=function(t,e){var i=this.m_PolyOuts[t.OutIdx],n=this.m_PolyOuts[e.OutIdx],o,o=this.OutRec1RightOfOutRec2(i,n)?n:this.OutRec1RightOfOutRec2(n,i)?i:this.GetLowermostRec(i,n),r=i.Pts,s=r.Prev,l=n.Pts,p=l.Prev;t.Side===L.EdgeSide.esLeft?e.Side===L.EdgeSide.esLeft?(this.ReversePolyPtLinks(l),(l.Next=r).Prev=l,(s.Next=p).Prev=s,i.Pts=p):((p.Next=r).Prev=p,(l.Prev=s).Next=l,i.Pts=l):e.Side===L.EdgeSide.esRight?(this.ReversePolyPtLinks(l),(s.Next=p).Prev=s,(l.Next=r).Prev=l):((s.Next=l).Prev=s,(r.Prev=p).Next=r),i.BottomPt=null,o===n&&(n.FirstLeft!==i&&(i.FirstLeft=n.FirstLeft),i.IsHole=n.IsHole),n.Pts=null,n.BottomPt=null,n.FirstLeft=i;var u=t.OutIdx,h=e.OutIdx;t.OutIdx=-1,e.OutIdx=-1;for(var a=this.m_ActiveEdges;null!==a;){if(a.OutIdx===h){a.OutIdx=u,a.Side=t.Side;break}a=a.NextInAEL}n.Idx=i.Idx},L.Clipper.prototype.ReversePolyPtLinks=function(t){if(null!==t)for(var e,i,e=t;i=e.Next,e.Next=e.Prev,e.Prev=i,(e=i)!==t;);},L.Clipper.SwapSides=function(t,e){var i=t.Side;t.Side=e.Side,e.Side=i},L.Clipper.SwapPolyIndexes=function(t,e){var i=t.OutIdx;t.OutIdx=e.OutIdx,e.OutIdx=i},L.Clipper.prototype.IntersectEdges=function(t,e,i){var n=0<=t.OutIdx,o=0<=e.OutIdx,r,s,l,p,u,h,a,f,d;if(L.use_xyz&&this.SetZ(i,t,e),L.use_lines&&(0===t.WindDelta||0===e.WindDelta))return 0===t.WindDelta&&0===e.WindDelta?void 0:void(t.PolyTyp===e.PolyTyp&&t.WindDelta!==e.WindDelta&&this.m_ClipType===L.ClipType.ctUnion?0===t.WindDelta?o&&(this.AddOutPt(t,i),n&&(t.OutIdx=-1)):n&&(this.AddOutPt(e,i),o&&(e.OutIdx=-1)):t.PolyTyp!==e.PolyTyp&&(0!==t.WindDelta||1!==Math.abs(e.WindCnt)||this.m_ClipType===L.ClipType.ctUnion&&0!==e.WindCnt2?0!==e.WindDelta||1!==Math.abs(t.WindCnt)||this.m_ClipType===L.ClipType.ctUnion&&0!==t.WindCnt2||(this.AddOutPt(e,i),o&&(e.OutIdx=-1)):(this.AddOutPt(t,i),n&&(t.OutIdx=-1))));switch(t.PolyTyp===e.PolyTyp?this.IsEvenOddFillType(t)?(r=t.WindCnt,t.WindCnt=e.WindCnt,e.WindCnt=r):(t.WindCnt+e.WindDelta===0?t.WindCnt=-t.WindCnt:t.WindCnt+=e.WindDelta,e.WindCnt-t.WindDelta==0?e.WindCnt=-e.WindCnt:e.WindCnt-=t.WindDelta):(this.IsEvenOddFillType(e)?t.WindCnt2=0===t.WindCnt2?1:0:t.WindCnt2+=e.WindDelta,this.IsEvenOddFillType(t)?e.WindCnt2=0===e.WindCnt2?1:0:e.WindCnt2-=t.WindDelta),p=t.PolyTyp===L.PolyType.ptSubject?(s=this.m_SubjFillType,this.m_ClipFillType):(s=this.m_ClipFillType,this.m_SubjFillType),u=e.PolyTyp===L.PolyType.ptSubject?(l=this.m_SubjFillType,this.m_ClipFillType):(l=this.m_ClipFillType,this.m_SubjFillType),s){case L.PolyFillType.pftPositive:h=t.WindCnt;break;case L.PolyFillType.pftNegative:h=-t.WindCnt;break;default:h=Math.abs(t.WindCnt)}switch(l){case L.PolyFillType.pftPositive:a=e.WindCnt;break;case L.PolyFillType.pftNegative:a=-e.WindCnt;break;default:a=Math.abs(e.WindCnt)}if(n&&o)0!==h&&1!==h||0!==a&&1!==a||t.PolyTyp!==e.PolyTyp&&this.m_ClipType!==L.ClipType.ctXor?this.AddLocalMaxPoly(t,e,i):(this.AddOutPt(t,i),this.AddOutPt(e,i),L.Clipper.SwapSides(t,e),L.Clipper.SwapPolyIndexes(t,e));else if(n)0!==a&&1!==a||(this.AddOutPt(t,i),L.Clipper.SwapSides(t,e),L.Clipper.SwapPolyIndexes(t,e));else if(o)0!==h&&1!==h||(this.AddOutPt(e,i),L.Clipper.SwapSides(t,e),L.Clipper.SwapPolyIndexes(t,e));else if(!(0!==h&&1!==h||0!==a&&1!==a)){switch(p){case L.PolyFillType.pftPositive:f=t.WindCnt2;break;case L.PolyFillType.pftNegative:f=-t.WindCnt2;break;default:f=Math.abs(t.WindCnt2)}switch(u){case L.PolyFillType.pftPositive:d=e.WindCnt2;break;case L.PolyFillType.pftNegative:d=-e.WindCnt2;break;default:d=Math.abs(e.WindCnt2)}if(t.PolyTyp!==e.PolyTyp)this.AddLocalMinPoly(t,e,i);else if(1===h&&1===a)switch(this.m_ClipType){case L.ClipType.ctIntersection:0<f&&0<d&&this.AddLocalMinPoly(t,e,i);break;case L.ClipType.ctUnion:f<=0&&d<=0&&this.AddLocalMinPoly(t,e,i);break;case L.ClipType.ctDifference:(t.PolyTyp===L.PolyType.ptClip&&0<f&&0<d||t.PolyTyp===L.PolyType.ptSubject&&f<=0&&d<=0)&&this.AddLocalMinPoly(t,e,i);break;case L.ClipType.ctXor:this.AddLocalMinPoly(t,e,i)}else L.Clipper.SwapSides(t,e)}},L.Clipper.prototype.DeleteFromSEL=function(t){var e=t.PrevInSEL,i=t.NextInSEL;null===e&&null===i&&t!==this.m_SortedEdges||(null!==e?e.NextInSEL=i:this.m_SortedEdges=i,null!==i&&(i.PrevInSEL=e),t.NextInSEL=null,t.PrevInSEL=null)},L.Clipper.prototype.ProcessHorizontals=function(){for(var t={};this.PopEdgeFromSEL(t);)this.ProcessHorizontal(t.v)},L.Clipper.prototype.GetHorzDirection=function(t,e){t.Bot.X<t.Top.X?(e.Left=t.Bot.X,e.Right=t.Top.X,e.Dir=L.Direction.dLeftToRight):(e.Left=t.Top.X,e.Right=t.Bot.X,e.Dir=L.Direction.dRightToLeft)},L.Clipper.prototype.ProcessHorizontal=function(t){var e={Dir:null,Left:null,Right:null};this.GetHorzDirection(t,e);for(var i=e.Dir,n=e.Left,o=e.Right,r=0===t.WindDelta,s=t,l=null;null!==s.NextInLML&&L.ClipperBase.IsHorizontal(s.NextInLML);)s=s.NextInLML;null===s.NextInLML&&(l=this.GetMaximaPair(s));var p=this.m_Maxima;if(null!==p)if(i===L.Direction.dLeftToRight){for(;null!==p&&p.X<=t.Bot.X;)p=p.Next;null!==p&&p.X>=s.Top.X&&(p=null)}else{for(;null!==p.Next&&p.Next.X<t.Bot.X;)p=p.Next;p.X<=s.Top.X&&(p=null)}for(var u=null,h,a,f,f;;){for(var d=t===s,P=this.GetNextInAEL(t,i),m,m;null!==P;){if(null!==p)if(i===L.Direction.dLeftToRight)for(;null!==p&&p.X<P.Curr.X;)0<=t.OutIdx&&!r&&this.AddOutPt(t,new L.IntPoint2(p.X,t.Bot.Y)),p=p.Next;else for(;null!==p&&p.X>P.Curr.X;)0<=t.OutIdx&&!r&&this.AddOutPt(t,new L.IntPoint2(p.X,t.Bot.Y)),p=p.Prev;if(i===L.Direction.dLeftToRight&&P.Curr.X>o||i===L.Direction.dRightToLeft&&P.Curr.X<n)break;if(P.Curr.X===t.Top.X&&null!==t.NextInLML&&P.Dx<t.NextInLML.Dx)break;if(0<=t.OutIdx&&!r){L.use_xyz&&(i===L.Direction.dLeftToRight?this.SetZ(P.Curr,t,P):this.SetZ(P.Curr,P,t));for(var u=this.AddOutPt(t,P.Curr),y=this.m_SortedEdges,f;null!==y;){0<=y.OutIdx&&this.HorzSegmentsOverlap(t.Bot.X,t.Top.X,y.Bot.X,y.Top.X)&&(f=this.GetLastOutPt(y),this.AddJoin(f,u,y.Top)),y=y.NextInSEL}this.AddGhostJoin(u,t.Bot)}if(P===l&&d)return 0<=t.OutIdx&&this.AddLocalMaxPoly(t,l,t.Top),this.DeleteFromAEL(t),void this.DeleteFromAEL(l);i===L.Direction.dLeftToRight?(m=new L.IntPoint2(P.Curr.X,t.Curr.Y),this.IntersectEdges(t,P,m)):(m=new L.IntPoint2(P.Curr.X,t.Curr.Y),this.IntersectEdges(P,t,m));var a=this.GetNextInAEL(P,i);this.SwapPositionsInAEL(t,P),P=a}if(null===t.NextInLML||!L.ClipperBase.IsHorizontal(t.NextInLML))break;0<=(t=this.UpdateEdgeIntoAEL(t)).OutIdx&&this.AddOutPt(t,t.Bot),this.GetHorzDirection(t,e={Dir:i,Left:n,Right:o}),i=e.Dir,n=e.Left,o=e.Right}if(0<=t.OutIdx&&null===u){u=this.GetLastOutPt(t);for(var y=this.m_SortedEdges,f;null!==y;){0<=y.OutIdx&&this.HorzSegmentsOverlap(t.Bot.X,t.Top.X,y.Bot.X,y.Top.X)&&(f=this.GetLastOutPt(y),this.AddJoin(f,u,y.Top)),y=y.NextInSEL}this.AddGhostJoin(u,t.Top)}null!==t.NextInLML?0<=t.OutIdx?(u=this.AddOutPt(t,t.Top),0!==(t=this.UpdateEdgeIntoAEL(t)).WindDelta&&(h=t.PrevInAEL,a=t.NextInAEL,null!==h&&h.Curr.X===t.Bot.X&&h.Curr.Y===t.Bot.Y&&0===h.WindDelta&&0<=h.OutIdx&&h.Curr.Y>h.Top.Y&&L.ClipperBase.SlopesEqual3(t,h,this.m_UseFullRange)?(f=this.AddOutPt(h,t.Bot),this.AddJoin(u,f,t.Top)):null!==a&&a.Curr.X===t.Bot.X&&a.Curr.Y===t.Bot.Y&&0!==a.WindDelta&&0<=a.OutIdx&&a.Curr.Y>a.Top.Y&&L.ClipperBase.SlopesEqual3(t,a,this.m_UseFullRange)&&(f=this.AddOutPt(a,t.Bot),this.AddJoin(u,f,t.Top)))):this.UpdateEdgeIntoAEL(t):(0<=t.OutIdx&&this.AddOutPt(t,t.Top),this.DeleteFromAEL(t))},L.Clipper.prototype.GetNextInAEL=function(t,e){return e===L.Direction.dLeftToRight?t.NextInAEL:t.PrevInAEL},L.Clipper.prototype.IsMinima=function(t){return null!==t&&t.Prev.NextInLML!==t&&t.Next.NextInLML!==t},L.Clipper.prototype.IsMaxima=function(t,e){return null!==t&&t.Top.Y===e&&null===t.NextInLML},L.Clipper.prototype.IsIntermediate=function(t,e){return t.Top.Y===e&&null!==t.NextInLML},L.Clipper.prototype.GetMaximaPair=function(t){return L.IntPoint.op_Equality(t.Next.Top,t.Top)&&null===t.Next.NextInLML?t.Next:L.IntPoint.op_Equality(t.Prev.Top,t.Top)&&null===t.Prev.NextInLML?t.Prev:null},L.Clipper.prototype.GetMaximaPairEx=function(t){var e=this.GetMaximaPair(t);return null===e||e.OutIdx===L.ClipperBase.Skip||e.NextInAEL===e.PrevInAEL&&!L.ClipperBase.IsHorizontal(e)?null:e},L.Clipper.prototype.ProcessIntersections=function(t){if(null===this.m_ActiveEdges)return!0;try{if(this.BuildIntersectList(t),0===this.m_IntersectList.length)return!0;if(1!==this.m_IntersectList.length&&!this.FixupIntersectionOrder())return!1;this.ProcessIntersectList()}catch(t){this.m_SortedEdges=null,this.m_IntersectList.length=0,L.Error("ProcessIntersections error")}return!(this.m_SortedEdges=null)},L.Clipper.prototype.BuildIntersectList=function(t){if(null!==this.m_ActiveEdges){var e=this.m_ActiveEdges;for(this.m_SortedEdges=e;null!==e;)e.PrevInSEL=e.PrevInAEL,e.NextInSEL=e.NextInAEL,e.Curr.X=L.Clipper.TopX(e,t),e=e.NextInAEL;for(var i=!0;i&&null!==this.m_SortedEdges;){for(i=!1,e=this.m_SortedEdges;null!==e.NextInSEL;){var n=e.NextInSEL,o=new L.IntPoint0,r;e.Curr.X>n.Curr.X?(this.IntersectPoint(e,n,o),o.Y<t&&(o=new L.IntPoint2(L.Clipper.TopX(e,t),t)),(r=new L.IntersectNode).Edge1=e,r.Edge2=n,r.Pt.X=o.X,r.Pt.Y=o.Y,L.use_xyz&&(r.Pt.Z=o.Z),this.m_IntersectList.push(r),this.SwapPositionsInSEL(e,n),i=!0):e=n}if(null===e.PrevInSEL)break;e.PrevInSEL.NextInSEL=null}this.m_SortedEdges=null}},L.Clipper.prototype.EdgesAdjacent=function(t){return t.Edge1.NextInSEL===t.Edge2||t.Edge1.PrevInSEL===t.Edge2},L.Clipper.IntersectNodeSort=function(t,e){return e.Pt.Y-t.Pt.Y},L.Clipper.prototype.FixupIntersectionOrder=function(){this.m_IntersectList.sort(this.m_IntersectNodeComparer),this.CopyAELToSEL();for(var t=this.m_IntersectList.length,e=0;e<t;e++){if(!this.EdgesAdjacent(this.m_IntersectList[e])){for(var i=e+1;i<t&&!this.EdgesAdjacent(this.m_IntersectList[i]);)i++;if(i===t)return!1;var n=this.m_IntersectList[e];this.m_IntersectList[e]=this.m_IntersectList[i],this.m_IntersectList[i]=n}this.SwapPositionsInSEL(this.m_IntersectList[e].Edge1,this.m_IntersectList[e].Edge2)}return!0},L.Clipper.prototype.ProcessIntersectList=function(){for(var t=0,e=this.m_IntersectList.length;t<e;t++){var i=this.m_IntersectList[t];this.IntersectEdges(i.Edge1,i.Edge2,i.Pt),this.SwapPositionsInAEL(i.Edge1,i.Edge2)}this.m_IntersectList.length=0};var me,ye=function(t){return t<0?Math.ceil(t-.5):Math.floor(t+.5)},ce=function(t){return t<0?-Math.round(Math.abs(t)):Math.round(t)},ve=function(t){return t<0?(t-=.5)<-2147483648?Math.ceil(t):0|t:2147483647<(t+=.5)?Math.floor(t):0|t};n.msie?L.Clipper.Round=function(t){return t<0?Math.ceil(t-.5):Math.round(t)}:n.chromium?L.Clipper.Round=ce:n.safari?L.Clipper.Round=ve:L.Clipper.Round=ye,L.Clipper.TopX=function(t,e){return e===t.Top.Y?t.Top.X:t.Bot.X+L.Clipper.Round(t.Dx*(e-t.Bot.Y))},L.Clipper.prototype.IntersectPoint=function(t,e,i){var n,o,n,o,r;if(i.X=0,i.Y=0,t.Dx===e.Dx)return i.Y=t.Curr.Y,void(i.X=L.Clipper.TopX(t,i.Y));if(0===t.Delta.X?(i.X=t.Bot.X,L.ClipperBase.IsHorizontal(e)?i.Y=e.Bot.Y:(o=e.Bot.Y-e.Bot.X/e.Dx,i.Y=L.Clipper.Round(i.X/e.Dx+o))):0===e.Delta.X?(i.X=e.Bot.X,L.ClipperBase.IsHorizontal(t)?i.Y=t.Bot.Y:(n=t.Bot.Y-t.Bot.X/t.Dx,i.Y=L.Clipper.Round(i.X/t.Dx+n))):(n=t.Bot.X-t.Bot.Y*t.Dx,r=((o=e.Bot.X-e.Bot.Y*e.Dx)-n)/(t.Dx-e.Dx),i.Y=L.Clipper.Round(r),Math.abs(t.Dx)<Math.abs(e.Dx)?i.X=L.Clipper.Round(t.Dx*r+n):i.X=L.Clipper.Round(e.Dx*r+o)),i.Y<t.Top.Y||i.Y<e.Top.Y){if(t.Top.Y>e.Top.Y)return i.Y=t.Top.Y,i.X=L.Clipper.TopX(e,t.Top.Y),i.X<t.Top.X;i.Y=e.Top.Y,Math.abs(t.Dx)<Math.abs(e.Dx)?i.X=L.Clipper.TopX(t,i.Y):i.X=L.Clipper.TopX(e,i.Y)}i.Y>t.Curr.Y&&(i.Y=t.Curr.Y,Math.abs(t.Dx)>Math.abs(e.Dx)?i.X=L.Clipper.TopX(e,i.Y):i.X=L.Clipper.TopX(t,i.Y))},L.Clipper.prototype.ProcessEdgesAtTopOfScanbeam=function(t){for(var e=this.m_ActiveEdges,i,n,o,r,r;null!==e;)var s=this.IsMaxima(e,t),l,s,n,n,p,i,r,e=(s=s?null===(l=this.GetMaximaPairEx(e))||!L.ClipperBase.IsHorizontal(l):s)?(this.StrictlySimple&&this.InsertMaxima(e.Top.X),n=e.PrevInAEL,this.DoMaxima(e),null===n?this.m_ActiveEdges:n.NextInAEL):(this.IsIntermediate(e,t)&&L.ClipperBase.IsHorizontal(e.NextInLML)?(0<=(e=this.UpdateEdgeIntoAEL(e)).OutIdx&&this.AddOutPt(e,e.Bot),this.AddEdgeToSEL(e)):(e.Curr.X=L.Clipper.TopX(e,t),e.Curr.Y=t),L.use_xyz&&(e.Top.Y===t?e.Curr.Z=e.Top.Z:e.Bot.Y===t?e.Curr.Z=e.Bot.Z:e.Curr.Z=0),this.StrictlySimple&&(n=e.PrevInAEL,0<=e.OutIdx&&0!==e.WindDelta&&null!==n&&0<=n.OutIdx&&n.Curr.X===e.Curr.X&&0!==n.WindDelta&&(p=new L.IntPoint1(e.Curr),L.use_xyz&&this.SetZ(p,n,e),i=this.AddOutPt(n,p),r=this.AddOutPt(e,p),this.AddJoin(i,r,p))),e.NextInAEL);for(this.ProcessHorizontals(),this.m_Maxima=null,e=this.m_ActiveEdges;null!==e;){this.IsIntermediate(e,t)&&(i=null,0<=e.OutIdx&&(i=this.AddOutPt(e,e.Top)),n=(e=this.UpdateEdgeIntoAEL(e)).PrevInAEL,o=e.NextInAEL,null!==n&&n.Curr.X===e.Bot.X&&n.Curr.Y===e.Bot.Y&&null!==i&&0<=n.OutIdx&&n.Curr.Y===n.Top.Y&&L.ClipperBase.SlopesEqual5(e.Curr,e.Top,n.Curr,n.Top,this.m_UseFullRange)&&0!==e.WindDelta&&0!==n.WindDelta?(r=this.AddOutPt(ePrev2,e.Bot),this.AddJoin(i,r,e.Top)):null!==o&&o.Curr.X===e.Bot.X&&o.Curr.Y===e.Bot.Y&&null!==i&&0<=o.OutIdx&&o.Curr.Y===o.Top.Y&&L.ClipperBase.SlopesEqual5(e.Curr,e.Top,o.Curr,o.Top,this.m_UseFullRange)&&0!==e.WindDelta&&0!==o.WindDelta&&(r=this.AddOutPt(o,e.Bot),this.AddJoin(i,r,e.Top))),e=e.NextInAEL}},L.Clipper.prototype.DoMaxima=function(t){var e=this.GetMaximaPairEx(t);if(null===e)return 0<=t.OutIdx&&this.AddOutPt(t,t.Top),void this.DeleteFromAEL(t);for(var i=t.NextInAEL;null!==i&&i!==e;)this.IntersectEdges(t,i,t.Top),this.SwapPositionsInAEL(t,i),i=t.NextInAEL;-1===t.OutIdx&&-1===e.OutIdx?(this.DeleteFromAEL(t),this.DeleteFromAEL(e)):0<=t.OutIdx&&0<=e.OutIdx?(0<=t.OutIdx&&this.AddLocalMaxPoly(t,e,t.Top),this.DeleteFromAEL(t),this.DeleteFromAEL(e)):L.use_lines&&0===t.WindDelta?(0<=t.OutIdx&&(this.AddOutPt(t,t.Top),t.OutIdx=L.ClipperBase.Unassigned),this.DeleteFromAEL(t),0<=e.OutIdx&&(this.AddOutPt(e,t.Top),e.OutIdx=L.ClipperBase.Unassigned),this.DeleteFromAEL(e)):L.Error("DoMaxima error")},L.Clipper.ReversePaths=function(t){for(var e=0,i=t.length;e<i;e++)t[e].reverse()},L.Clipper.Orientation=function(t){return 0<=L.Clipper.Area(t)},L.Clipper.prototype.PointCount=function(t){if(null===t)return 0;for(var e=0,i=t;e++,(i=i.Next)!==t;);return e},L.Clipper.prototype.BuildResult=function(t){L.Clear(t);for(var e=0,i=this.m_PolyOuts.length;e<i;e++){var n=this.m_PolyOuts[e];if(null!==n.Pts){var o=n.Pts.Prev,r=this.PointCount(o);if(!(r<2)){for(var s=new Array(r),l=0;l<r;l++)s[l]=o.Pt,o=o.Prev;t.push(s)}}}},L.Clipper.prototype.BuildResult2=function(t){t.Clear();for(var e=0,i=this.m_PolyOuts.length;e<i;e++){var n=this.m_PolyOuts[e],o=this.PointCount(n.Pts);if(!(n.IsOpen&&o<2||!n.IsOpen&&o<3)){this.FixHoleLinkage(n);var r=new L.PolyNode;t.m_AllPolys.push(r),(n.PolyNode=r).m_polygon.length=o;for(var s=n.Pts.Prev,l=0;l<o;l++)r.m_polygon[l]=s.Pt,s=s.Prev}}for(var e=0,i=this.m_PolyOuts.length,n;e<i;e++){null!==(n=this.m_PolyOuts[e]).PolyNode&&(n.IsOpen?(n.PolyNode.IsOpen=!0,t.AddChild(n.PolyNode)):(null!==n.FirstLeft&&null!==n.FirstLeft.PolyNode?n.FirstLeft.PolyNode:t).AddChild(n.PolyNode))}},L.Clipper.prototype.FixupOutPolyline=function(t){for(var e,i=(e=t.Pts).Prev;e!==i;){var n,e=e.Next;L.IntPoint.op_Equality(e.Pt,e.Prev.Pt)&&(e===i&&(i=e.Prev),(n=e.Prev).Next=e.Next,e.Next.Prev=n,e=n)}e===e.Prev&&(t.Pts=null)},L.Clipper.prototype.FixupOutPolygon=function(t){var e=null;t.BottomPt=null;for(var i=t.Pts,n=this.PreserveCollinear||this.StrictlySimple;;){if(i.Prev===i||i.Prev===i.Next)return void(t.Pts=null);if(L.IntPoint.op_Equality(i.Pt,i.Next.Pt)||L.IntPoint.op_Equality(i.Pt,i.Prev.Pt)||L.ClipperBase.SlopesEqual4(i.Prev.Pt,i.Pt,i.Next.Pt,this.m_UseFullRange)&&(!n||!this.Pt2IsBetweenPt1AndPt3(i.Prev.Pt,i.Pt,i.Next.Pt)))e=null,i.Prev.Next=i.Next,i.Next.Prev=i.Prev,i=i.Prev;else{if(i===e)break;null===e&&(e=i),i=i.Next}}t.Pts=i},L.Clipper.prototype.DupOutPt=function(t,e){var i=new L.OutPt;return i.Pt.X=t.Pt.X,i.Pt.Y=t.Pt.Y,L.use_xyz&&(i.Pt.Z=t.Pt.Z),i.Idx=t.Idx,e?(i.Next=t.Next,(i.Prev=t).Next.Prev=i,t.Next=i):(i.Prev=t.Prev,(i.Next=t).Prev.Next=i,t.Prev=i),i},L.Clipper.prototype.GetOverlap=function(t,e,i,n,o){return t<e?i<n?(o.Left=Math.max(t,i),o.Right=Math.min(e,n)):(o.Left=Math.max(t,n),o.Right=Math.min(e,i)):i<n?(o.Left=Math.max(e,i),o.Right=Math.min(t,n)):(o.Left=Math.max(e,n),o.Right=Math.min(t,i)),o.Left<o.Right},L.Clipper.prototype.JoinHorz=function(t,e,i,n,o,r){var s=t.Pt.X>e.Pt.X?L.Direction.dRightToLeft:L.Direction.dLeftToRight,l=i.Pt.X>n.Pt.X?L.Direction.dRightToLeft:L.Direction.dLeftToRight;if(s===l)return!1;if(s===L.Direction.dLeftToRight){for(;t.Next.Pt.X<=o.X&&t.Next.Pt.X>=t.Pt.X&&t.Next.Pt.Y===o.Y;)t=t.Next;r&&t.Pt.X!==o.X&&(t=t.Next),e=this.DupOutPt(t,!r),L.IntPoint.op_Inequality(e.Pt,o)&&((t=e).Pt.X=o.X,t.Pt.Y=o.Y,L.use_xyz&&(t.Pt.Z=o.Z),e=this.DupOutPt(t,!r))}else{for(;t.Next.Pt.X>=o.X&&t.Next.Pt.X<=t.Pt.X&&t.Next.Pt.Y===o.Y;)t=t.Next;r||t.Pt.X===o.X||(t=t.Next),e=this.DupOutPt(t,r),L.IntPoint.op_Inequality(e.Pt,o)&&((t=e).Pt.X=o.X,t.Pt.Y=o.Y,L.use_xyz&&(t.Pt.Z=o.Z),e=this.DupOutPt(t,r))}if(l===L.Direction.dLeftToRight){for(;i.Next.Pt.X<=o.X&&i.Next.Pt.X>=i.Pt.X&&i.Next.Pt.Y===o.Y;)i=i.Next;r&&i.Pt.X!==o.X&&(i=i.Next),n=this.DupOutPt(i,!r),L.IntPoint.op_Inequality(n.Pt,o)&&((i=n).Pt.X=o.X,i.Pt.Y=o.Y,L.use_xyz&&(i.Pt.Z=o.Z),n=this.DupOutPt(i,!r))}else{for(;i.Next.Pt.X>=o.X&&i.Next.Pt.X<=i.Pt.X&&i.Next.Pt.Y===o.Y;)i=i.Next;r||i.Pt.X===o.X||(i=i.Next),n=this.DupOutPt(i,r),L.IntPoint.op_Inequality(n.Pt,o)&&((i=n).Pt.X=o.X,i.Pt.Y=o.Y,L.use_xyz&&(i.Pt.Z=o.Z),n=this.DupOutPt(i,r))}return s===L.Direction.dLeftToRight===r?((t.Prev=i).Next=t,(e.Next=n).Prev=e):((t.Next=i).Prev=t,(e.Prev=n).Next=e),!0},L.Clipper.prototype.JoinPoints=function(t,e,i){var n=t.OutPt1,o=new L.OutPt,r=t.OutPt2,s=new L.OutPt,l=t.OutPt1.Pt.Y===t.OffPt.Y;if(l&&L.IntPoint.op_Equality(t.OffPt,t.OutPt1.Pt)&&L.IntPoint.op_Equality(t.OffPt,t.OutPt2.Pt)){if(e!==i)return!1;for(o=t.OutPt1.Next;o!==n&&L.IntPoint.op_Equality(o.Pt,t.OffPt);)o=o.Next;for(var p=o.Pt.Y>t.OffPt.Y,s=t.OutPt2.Next,u;s!==r&&L.IntPoint.op_Equality(s.Pt,t.OffPt);)s=s.Next;return p==s.Pt.Y>t.OffPt.Y?!1:(p?(o=this.DupOutPt(n,!1),s=this.DupOutPt(r,!0),(n.Prev=r).Next=n,(o.Next=s).Prev=o):(o=this.DupOutPt(n,!0),s=this.DupOutPt(r,!1),(n.Next=r).Prev=n,(o.Prev=s).Next=o),t.OutPt1=n,t.OutPt2=o,!0)}if(l){for(o=n;n.Prev.Pt.Y===n.Pt.Y&&n.Prev!==o&&n.Prev!==r;)n=n.Prev;for(;o.Next.Pt.Y===o.Pt.Y&&o.Next!==n&&o.Next!==r;)o=o.Next;if(o.Next===n||o.Next===r)return!1;for(s=r;r.Prev.Pt.Y===r.Pt.Y&&r.Prev!==s&&r.Prev!==o;)r=r.Prev;for(;s.Next.Pt.Y===s.Pt.Y&&s.Next!==r&&s.Next!==n;)s=s.Next;if(s.Next===r||s.Next===n)return!1;var h={Left:null,Right:null};if(!this.GetOverlap(n.Pt.X,o.Pt.X,r.Pt.X,s.Pt.X,h))return!1;var a=h.Left,f=h.Right,d=new L.IntPoint0,P,P=n.Pt.X>=a&&n.Pt.X<=f?(d.X=n.Pt.X,d.Y=n.Pt.Y,L.use_xyz&&(d.Z=n.Pt.Z),n.Pt.X>o.Pt.X):r.Pt.X>=a&&r.Pt.X<=f?(d.X=r.Pt.X,d.Y=r.Pt.Y,L.use_xyz&&(d.Z=r.Pt.Z),r.Pt.X>s.Pt.X):o.Pt.X>=a&&o.Pt.X<=f?(d.X=o.Pt.X,d.Y=o.Pt.Y,L.use_xyz&&(d.Z=o.Pt.Z),o.Pt.X>n.Pt.X):(d.X=s.Pt.X,d.Y=s.Pt.Y,L.use_xyz&&(d.Z=s.Pt.Z),s.Pt.X>r.Pt.X);return t.OutPt1=n,t.OutPt2=r,this.JoinHorz(n,o,r,s,d,P)}for(o=n.Next;L.IntPoint.op_Equality(o.Pt,n.Pt)&&o!==n;)o=o.Next;var m=o.Pt.Y>n.Pt.Y||!L.ClipperBase.SlopesEqual4(n.Pt,o.Pt,t.OffPt,this.m_UseFullRange);if(m){for(o=n.Prev;L.IntPoint.op_Equality(o.Pt,n.Pt)&&o!==n;)o=o.Prev;if(o.Pt.Y>n.Pt.Y||!L.ClipperBase.SlopesEqual4(n.Pt,o.Pt,t.OffPt,this.m_UseFullRange))return!1}for(s=r.Next;L.IntPoint.op_Equality(s.Pt,r.Pt)&&s!==r;)s=s.Next;var y=s.Pt.Y>r.Pt.Y||!L.ClipperBase.SlopesEqual4(r.Pt,s.Pt,t.OffPt,this.m_UseFullRange);if(y){for(s=r.Prev;L.IntPoint.op_Equality(s.Pt,r.Pt)&&s!==r;)s=s.Prev;if(s.Pt.Y>r.Pt.Y||!L.ClipperBase.SlopesEqual4(r.Pt,s.Pt,t.OffPt,this.m_UseFullRange))return!1}return o!==n&&s!==r&&o!==s&&(e!==i||m!=y)&&(m?(o=this.DupOutPt(n,!1),s=this.DupOutPt(r,!0),(n.Prev=r).Next=n,(o.Next=s).Prev=o):(o=this.DupOutPt(n,!0),s=this.DupOutPt(r,!1),(n.Next=r).Prev=n,(o.Prev=s).Next=o),t.OutPt1=n,t.OutPt2=o,!0)},L.Clipper.GetBounds=function(t){for(var e=0,i=t.length;e<i&&0===t[e].length;)e++;if(e===i)return new L.IntRect(0,0,0,0);var n=new L.IntRect;for(n.left=t[e][0].X,n.right=n.left,n.top=t[e][0].Y,n.bottom=n.top;e<i;e++)for(var o=0,r=t[e].length;o<r;o++)t[e][o].X<n.left?n.left=t[e][o].X:t[e][o].X>n.right&&(n.right=t[e][o].X),t[e][o].Y<n.top?n.top=t[e][o].Y:t[e][o].Y>n.bottom&&(n.bottom=t[e][o].Y);return n},L.Clipper.prototype.GetBounds2=function(t){var e=t,i=new L.IntRect;for(i.left=t.Pt.X,i.right=t.Pt.X,i.top=t.Pt.Y,i.bottom=t.Pt.Y,t=t.Next;t!==e;)t.Pt.X<i.left&&(i.left=t.Pt.X),t.Pt.X>i.right&&(i.right=t.Pt.X),t.Pt.Y<i.top&&(i.top=t.Pt.Y),t.Pt.Y>i.bottom&&(i.bottom=t.Pt.Y),t=t.Next;return i},L.Clipper.PointInPolygon=function(t,e){var i=0,n=e.length;if(n<3)return 0;for(var o=e[0],r=1;r<=n;++r){var s=r===n?e[0]:e[r],l,l;if(s.Y===t.Y&&(s.X===t.X||o.Y===t.Y&&s.X>t.X==o.X<t.X))return-1;if(o.Y<t.Y!=s.Y<t.Y)if(o.X>=t.X)if(s.X>t.X)i=1-i;else{if(0===(l=(o.X-t.X)*(s.Y-t.Y)-(s.X-t.X)*(o.Y-t.Y)))return-1;0<l==s.Y>o.Y&&(i=1-i)}else if(s.X>t.X){if(0===(l=(o.X-t.X)*(s.Y-t.Y)-(s.X-t.X)*(o.Y-t.Y)))return-1;0<l==s.Y>o.Y&&(i=1-i)}o=s}return i},L.Clipper.prototype.PointInPolygon=function(t,e){var i=0,n=e,o=t.X,r=t.Y,s=e.Pt.X,l=e.Pt.Y;do{var p=(e=e.Next).Pt.X,u=e.Pt.Y,h,h;if(u===r&&(p===o||l===r&&o<p==s<o))return-1;if(l<r!=u<r)if(o<=s)if(o<p)i=1-i;else{if(0===(h=(s-o)*(u-r)-(p-o)*(l-r)))return-1;0<h==l<u&&(i=1-i)}else if(o<p){if(0===(h=(s-o)*(u-r)-(p-o)*(l-r)))return-1;0<h==l<u&&(i=1-i)}}while(s=p,l=u,n!==e);return i},L.Clipper.prototype.Poly2ContainsPoly1=function(t,e){var i=t;do{var n=this.PointInPolygon(i.Pt,e);if(0<=n)return 0<n}while((i=i.Next)!==t);return!0},L.Clipper.prototype.FixupFirstLefts1=function(t,e){for(var i,n,o=0,r=this.m_PolyOuts.length;o<r;o++)i=this.m_PolyOuts[o],n=L.Clipper.ParseFirstLeft(i.FirstLeft),null!==i.Pts&&n===t&&this.Poly2ContainsPoly1(i.Pts,e.Pts)&&(i.FirstLeft=e)},L.Clipper.prototype.FixupFirstLefts2=function(t,e){for(var i=e.FirstLeft,n,o,r=0,s=this.m_PolyOuts.length;r<s;r++)null!==(n=this.m_PolyOuts[r]).Pts&&n!==e&&n!==t&&((o=L.Clipper.ParseFirstLeft(n.FirstLeft))!==i&&o!==t&&o!==e||(this.Poly2ContainsPoly1(n.Pts,t.Pts)?n.FirstLeft=t:this.Poly2ContainsPoly1(n.Pts,e.Pts)?n.FirstLeft=e:n.FirstLeft!==t&&n.FirstLeft!==e||(n.FirstLeft=i)))},L.Clipper.prototype.FixupFirstLefts3=function(t,e){for(var i,n,o=0,r=this.m_PolyOuts.length;o<r;o++)i=this.m_PolyOuts[o],n=L.Clipper.ParseFirstLeft(i.FirstLeft),null!==i.Pts&&n===t&&(i.FirstLeft=e)},L.Clipper.ParseFirstLeft=function(t){for(;null!==t&&null===t.Pts;)t=t.FirstLeft;return t},L.Clipper.prototype.JoinCommonEdges=function(){for(var t=0,e=this.m_Joins.length;t<e;t++){var i=this.m_Joins[t],n=this.GetOutRec(i.OutPt1.Idx),o=this.GetOutRec(i.OutPt2.Idx),r,r;null!==n.Pts&&null!==o.Pts&&(n.IsOpen||o.IsOpen||(r=n===o?n:this.OutRec1RightOfOutRec2(n,o)?o:this.OutRec1RightOfOutRec2(o,n)?n:this.GetLowermostRec(n,o),this.JoinPoints(i,n,o)&&(n===o?(n.Pts=i.OutPt1,n.BottomPt=null,(o=this.CreateOutRec()).Pts=i.OutPt2,this.UpdateOutPtIdxs(o),this.Poly2ContainsPoly1(o.Pts,n.Pts)?(o.IsHole=!n.IsHole,o.FirstLeft=n,this.m_UsingPolyTree&&this.FixupFirstLefts2(o,n),(o.IsHole^this.ReverseSolution)==0<this.Area$1(o)&&this.ReversePolyPtLinks(o.Pts)):this.Poly2ContainsPoly1(n.Pts,o.Pts)?(o.IsHole=n.IsHole,n.IsHole=!o.IsHole,o.FirstLeft=n.FirstLeft,n.FirstLeft=o,this.m_UsingPolyTree&&this.FixupFirstLefts2(n,o),(n.IsHole^this.ReverseSolution)==0<this.Area$1(n)&&this.ReversePolyPtLinks(n.Pts)):(o.IsHole=n.IsHole,o.FirstLeft=n.FirstLeft,this.m_UsingPolyTree&&this.FixupFirstLefts1(n,o))):(o.Pts=null,o.BottomPt=null,o.Idx=n.Idx,n.IsHole=r.IsHole,r===o&&(n.FirstLeft=o.FirstLeft),o.FirstLeft=n,this.m_UsingPolyTree&&this.FixupFirstLefts3(o,n)))))}},L.Clipper.prototype.UpdateOutPtIdxs=function(t){for(var e=t.Pts;e.Idx=t.Idx,(e=e.Prev)!==t.Pts;);},L.Clipper.prototype.DoSimplePolygons=function(){for(var t=0;t<this.m_PolyOuts.length;){var e=this.m_PolyOuts[t++],i=e.Pts;if(null!==i&&!e.IsOpen)do{for(var n=i.Next,o,r,s;n!==e.Pts;){L.IntPoint.op_Equality(i.Pt,n.Pt)&&n.Next!==i&&n.Prev!==i&&(o=i.Prev,r=n.Prev,(i.Prev=r).Next=i,(n.Prev=o).Next=n,e.Pts=i,(s=this.CreateOutRec()).Pts=n,this.UpdateOutPtIdxs(s),this.Poly2ContainsPoly1(s.Pts,e.Pts)?(s.IsHole=!e.IsHole,s.FirstLeft=e,this.m_UsingPolyTree&&this.FixupFirstLefts2(s,e)):this.Poly2ContainsPoly1(e.Pts,s.Pts)?(s.IsHole=e.IsHole,e.IsHole=!s.IsHole,s.FirstLeft=e.FirstLeft,e.FirstLeft=s,this.m_UsingPolyTree&&this.FixupFirstLefts2(e,s)):(s.IsHole=e.IsHole,s.FirstLeft=e.FirstLeft,this.m_UsingPolyTree&&this.FixupFirstLefts1(e,s)),n=i),n=n.Next}}while((i=i.Next)!==e.Pts)}},L.Clipper.Area=function(t){if(!Array.isArray(t))return 0;var e=t.length;if(e<3)return 0;for(var i=0,n=0,o=e-1;n<e;++n)i+=(t[o].X+t[n].X)*(t[o].Y-t[n].Y),o=n;return.5*-i},L.Clipper.prototype.Area=function(t){var e=t;if(null===t)return 0;for(var i=0;i+=(t.Prev.Pt.X+t.Pt.X)*(t.Prev.Pt.Y-t.Pt.Y),(t=t.Next)!==e;);return.5*i},L.Clipper.prototype.Area$1=function(t){return this.Area(t.Pts)},L.Clipper.SimplifyPolygon=function(t,e){var i=new Array,n=new L.Clipper(0);return n.StrictlySimple=!0,n.AddPath(t,L.PolyType.ptSubject,!0),n.Execute(L.ClipType.ctUnion,i,e,e),i},L.Clipper.SimplifyPolygons=function(t,e){void 0===e&&(e=L.PolyFillType.pftEvenOdd);var i=new Array,n=new L.Clipper(0);return n.StrictlySimple=!0,n.AddPaths(t,L.PolyType.ptSubject,!0),n.Execute(L.ClipType.ctUnion,i,e,e),i},L.Clipper.DistanceSqrd=function(t,e){var i=t.X-e.X,n=t.Y-e.Y;return i*i+n*n},L.Clipper.DistanceFromLineSqrd=function(t,e,i){var n=e.Y-i.Y,o=i.X-e.X,r=n*e.X+o*e.Y,r;return(r=n*t.X+o*t.Y-r)*r/(n*n+o*o)},L.Clipper.SlopesNearCollinear=function(t,e,i,n){return Math.abs(t.X-e.X)>Math.abs(t.Y-e.Y)?t.X>e.X==t.X<i.X?L.Clipper.DistanceFromLineSqrd(t,e,i)<n:e.X>t.X==e.X<i.X?L.Clipper.DistanceFromLineSqrd(e,t,i)<n:L.Clipper.DistanceFromLineSqrd(i,t,e)<n:t.Y>e.Y==t.Y<i.Y?L.Clipper.DistanceFromLineSqrd(t,e,i)<n:e.Y>t.Y==e.Y<i.Y?L.Clipper.DistanceFromLineSqrd(e,t,i)<n:L.Clipper.DistanceFromLineSqrd(i,t,e)<n},L.Clipper.PointsAreClose=function(t,e,i){var n=t.X-e.X,o=t.Y-e.Y;return n*n+o*o<=i},L.Clipper.ExcludeOp=function(t){var e=t.Prev;return e.Next=t.Next,(t.Next.Prev=e).Idx=0,e},L.Clipper.CleanPolygon=function(t,e){void 0===e&&(e=1.415);var i=t.length;if(0===i)return new Array;for(var n=new Array(i),o=0;o<i;++o)n[o]=new L.OutPt;for(var o=0;o<i;++o)n[o].Pt=t[o],n[o].Next=n[(o+1)%i],n[o].Next.Prev=n[o],n[o].Idx=0;for(var r=e*e,s=n[0];0===s.Idx&&s.Next!==s.Prev;)L.Clipper.PointsAreClose(s.Pt,s.Prev.Pt,r)?(s=L.Clipper.ExcludeOp(s),i--):L.Clipper.PointsAreClose(s.Prev.Pt,s.Next.Pt,r)?(L.Clipper.ExcludeOp(s.Next),s=L.Clipper.ExcludeOp(s),i-=2):L.Clipper.SlopesNearCollinear(s.Prev.Pt,s.Pt,s.Next.Pt,r)?(s=L.Clipper.ExcludeOp(s),i--):(s.Idx=1,s=s.Next);i<3&&(i=0);for(var l=new Array(i),o=0;o<i;++o)l[o]=new L.IntPoint1(s.Pt),s=s.Next;return n=null,l},L.Clipper.CleanPolygons=function(t,e){for(var i=new Array(t.length),n=0,o=t.length;n<o;n++)i[n]=L.Clipper.CleanPolygon(t[n],e);return i},L.Clipper.Minkowski=function(t,e,i,n){var o=n?1:0,r=t.length,s=e.length,l=new Array;if(i)for(var p=0;p<s;p++){for(var u=new Array(r),h=0,a=t.length,f=t[h];h<a;f=t[++h])u[h]=new L.IntPoint2(e[p].X+f.X,e[p].Y+f.Y);l.push(u)}else for(var p=0;p<s;p++){for(var u=new Array(r),h=0,a=t.length,f=t[h];h<a;f=t[++h])u[h]=new L.IntPoint2(e[p].X-f.X,e[p].Y-f.Y);l.push(u)}for(var d=new Array,p=0;p<s-1+o;p++)for(var h=0;h<r;h++){var P=new Array;P.push(l[p%s][h%r]),P.push(l[(p+1)%s][h%r]),P.push(l[(p+1)%s][(h+1)%r]),P.push(l[p%s][(h+1)%r]),L.Clipper.Orientation(P)||P.reverse(),d.push(P)}return d},L.Clipper.MinkowskiSum=function(t,e,i){if(e[0]instanceof Array){for(var n=e,o=new L.Paths,r=new L.Clipper,s=0;s<n.length;++s){var l=L.Clipper.Minkowski(t,n[s],!0,i),p;r.AddPaths(l,L.PolyType.ptSubject,!0),i&&(p=L.Clipper.TranslatePath(n[s],t[0]),r.AddPath(p,L.PolyType.ptClip,!0))}return r.Execute(L.ClipType.ctUnion,o,L.PolyFillType.pftNonZero,L.PolyFillType.pftNonZero),o}var p=e,n=L.Clipper.Minkowski(t,p,!0,i),r;return(r=new L.Clipper).AddPaths(n,L.PolyType.ptSubject,!0),r.Execute(L.ClipType.ctUnion,n,L.PolyFillType.pftNonZero,L.PolyFillType.pftNonZero),n},L.Clipper.TranslatePath=function(t,e){for(var i=new L.Path,n=0;n<t.length;n++)i.push(new L.IntPoint2(t[n].X+e.X,t[n].Y+e.Y));return i},L.Clipper.MinkowskiDiff=function(t,e){var i=L.Clipper.Minkowski(t,e,!1,!0),n=new L.Clipper;return n.AddPaths(i,L.PolyType.ptSubject,!0),n.Execute(L.ClipType.ctUnion,i,L.PolyFillType.pftNonZero,L.PolyFillType.pftNonZero),i},L.Clipper.PolyTreeToPaths=function(t){var e=new Array;return L.Clipper.AddPolyNodeToPaths(t,L.Clipper.NodeType.ntAny,e),e},L.Clipper.AddPolyNodeToPaths=function(t,e,i){var n=!0;switch(e){case L.Clipper.NodeType.ntOpen:return;case L.Clipper.NodeType.ntClosed:n=!t.IsOpen}0<t.m_polygon.length&&n&&i.push(t.m_polygon);for(var o=0,r=t.Childs(),s=r.length,l=r[o];o<s;l=r[++o])L.Clipper.AddPolyNodeToPaths(l,e,i)},L.Clipper.OpenPathsFromPolyTree=function(t){for(var e=new L.Paths,i=0,n=t.ChildCount();i<n;i++)t.Childs()[i].IsOpen&&e.push(t.Childs()[i].m_polygon);return e},L.Clipper.ClosedPathsFromPolyTree=function(t){var e=new L.Paths;return L.Clipper.AddPolyNodeToPaths(t,L.Clipper.NodeType.ntClosed,e),e},Pe(L.Clipper,L.ClipperBase),L.Clipper.NodeType={ntAny:0,ntOpen:1,ntClosed:2},L.ClipperOffset=function(t,e){void 0===t&&(t=2),void 0===e&&(e=L.ClipperOffset.def_arc_tolerance),this.m_destPolys=new L.Paths,this.m_srcPoly=new L.Path,this.m_destPoly=new L.Path,this.m_normals=new Array,this.m_delta=0,this.m_sinA=0,this.m_sin=0,this.m_cos=0,this.m_miterLim=0,this.m_StepsPerRad=0,this.m_lowest=new L.IntPoint0,this.m_polyNodes=new L.PolyNode,this.MiterLimit=t,this.ArcTolerance=e,this.m_lowest.X=-1},L.ClipperOffset.two_pi=6.28318530717959,L.ClipperOffset.def_arc_tolerance=.25,L.ClipperOffset.prototype.Clear=function(){L.Clear(this.m_polyNodes.Childs()),this.m_lowest.X=-1},L.ClipperOffset.Round=L.Clipper.Round,L.ClipperOffset.prototype.AddPath=function(t,e,i){var n=t.length-1;if(!(n<0)){var o=new L.PolyNode;if(o.m_jointype=e,(o.m_endtype=i)===L.EndType.etClosedLine||i===L.EndType.etClosedPolygon)for(;0<n&&L.IntPoint.op_Equality(t[0],t[n]);)n--;o.m_polygon.push(t[0]);for(var r=0,s=0,l=1,p;l<=n;l++)L.IntPoint.op_Inequality(o.m_polygon[r],t[l])&&(r++,o.m_polygon.push(t[l]),(t[l].Y>o.m_polygon[s].Y||t[l].Y===o.m_polygon[s].Y&&t[l].X<o.m_polygon[s].X)&&(s=r));i===L.EndType.etClosedPolygon&&r<2||(this.m_polyNodes.AddChild(o),i===L.EndType.etClosedPolygon&&(this.m_lowest.X<0?this.m_lowest=new L.IntPoint2(this.m_polyNodes.ChildCount()-1,s):(p=this.m_polyNodes.Childs()[this.m_lowest.X].m_polygon[this.m_lowest.Y],(o.m_polygon[s].Y>p.Y||o.m_polygon[s].Y===p.Y&&o.m_polygon[s].X<p.X)&&(this.m_lowest=new L.IntPoint2(this.m_polyNodes.ChildCount()-1,s)))))}},L.ClipperOffset.prototype.AddPaths=function(t,e,i){for(var n=0,o=t.length;n<o;n++)this.AddPath(t[n],e,i)},L.ClipperOffset.prototype.FixOrientations=function(){if(0<=this.m_lowest.X&&!L.Clipper.Orientation(this.m_polyNodes.Childs()[this.m_lowest.X].m_polygon))for(var t=0,e;t<this.m_polyNodes.ChildCount();t++){((e=this.m_polyNodes.Childs()[t]).m_endtype===L.EndType.etClosedPolygon||e.m_endtype===L.EndType.etClosedLine&&L.Clipper.Orientation(e.m_polygon))&&e.m_polygon.reverse()}else for(var t=0,e;t<this.m_polyNodes.ChildCount();t++){(e=this.m_polyNodes.Childs()[t]).m_endtype!==L.EndType.etClosedLine||L.Clipper.Orientation(e.m_polygon)||e.m_polygon.reverse()}},L.ClipperOffset.GetUnitNormal=function(t,e){var i=e.X-t.X,n=e.Y-t.Y;if(0==i&&0===n)return new L.DoublePoint2(0,0);var o=1/Math.sqrt(i*i+n*n);return new L.DoublePoint2(n*=o,-(i*=o))},L.ClipperOffset.prototype.DoOffset=function(t){if(this.m_destPolys=new Array,this.m_delta=t,L.ClipperBase.near_zero(t))for(var e=0,i;e<this.m_polyNodes.ChildCount();e++){(i=this.m_polyNodes.Childs()[e]).m_endtype===L.EndType.etClosedPolygon&&this.m_destPolys.push(i.m_polygon)}else{var n;2<this.MiterLimit?this.m_miterLim=2/(this.MiterLimit*this.MiterLimit):this.m_miterLim=.5;var n=this.ArcTolerance<=0?L.ClipperOffset.def_arc_tolerance:this.ArcTolerance>Math.abs(t)*L.ClipperOffset.def_arc_tolerance?Math.abs(t)*L.ClipperOffset.def_arc_tolerance:this.ArcTolerance,o=3.14159265358979/Math.acos(1-n/Math.abs(t));this.m_sin=Math.sin(L.ClipperOffset.two_pi/o),this.m_cos=Math.cos(L.ClipperOffset.two_pi/o),this.m_StepsPerRad=o/L.ClipperOffset.two_pi,t<0&&(this.m_sin=-this.m_sin);for(var e=0;e<this.m_polyNodes.ChildCount();e++){var i=this.m_polyNodes.Childs()[e];this.m_srcPoly=i.m_polygon;var r=this.m_srcPoly.length;if(!(0===r||t<=0&&(r<3||i.m_endtype!==L.EndType.etClosedPolygon)))if(this.m_destPoly=new Array,1!==r){for(var s=this.m_normals.length=0;s<r-1;s++)this.m_normals.push(L.ClipperOffset.GetUnitNormal(this.m_srcPoly[s],this.m_srcPoly[s+1]));if(i.m_endtype===L.EndType.etClosedLine||i.m_endtype===L.EndType.etClosedPolygon?this.m_normals.push(L.ClipperOffset.GetUnitNormal(this.m_srcPoly[r-1],this.m_srcPoly[0])):this.m_normals.push(new L.DoublePoint1(this.m_normals[r-2])),i.m_endtype===L.EndType.etClosedPolygon){for(var l=r-1,s=0;s<r;s++)l=this.OffsetPoint(s,l,i.m_jointype);this.m_destPolys.push(this.m_destPoly)}else if(i.m_endtype===L.EndType.etClosedLine){for(var l=r-1,s=0;s<r;s++)l=this.OffsetPoint(s,l,i.m_jointype);this.m_destPolys.push(this.m_destPoly),this.m_destPoly=new Array;for(var p=this.m_normals[r-1],s=r-1;0<s;s--)this.m_normals[s]=new L.DoublePoint2(-this.m_normals[s-1].X,-this.m_normals[s-1].Y);this.m_normals[0]=new L.DoublePoint2(-p.X,-p.Y),l=0;for(var s=r-1;0<=s;s--)l=this.OffsetPoint(s,l,i.m_jointype);this.m_destPolys.push(this.m_destPoly)}else{for(var l=0,s=1,u,s,u,s;s<r-1;++s)l=this.OffsetPoint(s,l,i.m_jointype);i.m_endtype===L.EndType.etOpenButt?(u=new L.IntPoint2(L.ClipperOffset.Round(this.m_srcPoly[s=r-1].X+this.m_normals[s].X*t),L.ClipperOffset.Round(this.m_srcPoly[s].Y+this.m_normals[s].Y*t)),this.m_destPoly.push(u),u=new L.IntPoint2(L.ClipperOffset.Round(this.m_srcPoly[s].X-this.m_normals[s].X*t),L.ClipperOffset.Round(this.m_srcPoly[s].Y-this.m_normals[s].Y*t)),this.m_destPoly.push(u)):(s=r-1,l=r-2,this.m_sinA=0,this.m_normals[s]=new L.DoublePoint2(-this.m_normals[s].X,-this.m_normals[s].Y),i.m_endtype===L.EndType.etOpenSquare?this.DoSquare(s,l):this.DoRound(s,l));for(var s=r-1;0<s;s--)this.m_normals[s]=new L.DoublePoint2(-this.m_normals[s-1].X,-this.m_normals[s-1].Y);this.m_normals[0]=new L.DoublePoint2(-this.m_normals[1].X,-this.m_normals[1].Y);for(var s=(l=r-1)-1;0<s;--s)l=this.OffsetPoint(s,l,i.m_jointype);i.m_endtype===L.EndType.etOpenButt?(u=new L.IntPoint2(L.ClipperOffset.Round(this.m_srcPoly[0].X-this.m_normals[0].X*t),L.ClipperOffset.Round(this.m_srcPoly[0].Y-this.m_normals[0].Y*t)),this.m_destPoly.push(u),u=new L.IntPoint2(L.ClipperOffset.Round(this.m_srcPoly[0].X+this.m_normals[0].X*t),L.ClipperOffset.Round(this.m_srcPoly[0].Y+this.m_normals[0].Y*t)),this.m_destPoly.push(u)):(l=1,this.m_sinA=0,i.m_endtype===L.EndType.etOpenSquare?this.DoSquare(0,1):this.DoRound(0,1)),this.m_destPolys.push(this.m_destPoly)}}else{if(i.m_jointype===L.JoinType.jtRound)for(var h=1,a=0,s=1;s<=o;s++){this.m_destPoly.push(new L.IntPoint2(L.ClipperOffset.Round(this.m_srcPoly[0].X+h*t),L.ClipperOffset.Round(this.m_srcPoly[0].Y+a*t)));var f=h;h=h*this.m_cos-this.m_sin*a,a=f*this.m_sin+a*this.m_cos}else for(var h=-1,a=-1,s=0;s<4;++s)this.m_destPoly.push(new L.IntPoint2(L.ClipperOffset.Round(this.m_srcPoly[0].X+h*t),L.ClipperOffset.Round(this.m_srcPoly[0].Y+a*t))),h<0?h=1:a<0?a=1:h=-1;this.m_destPolys.push(this.m_destPoly)}}}},L.ClipperOffset.prototype.Execute=function(){var t=arguments,e;if(t[0]instanceof L.PolyTree){var i=t[0],n=t[1],o;if(i.Clear(),this.FixOrientations(),this.DoOffset(n),(o=new L.Clipper(0)).AddPaths(this.m_destPolys,L.PolyType.ptSubject,!0),0<n)o.Execute(L.ClipType.ctUnion,i,L.PolyFillType.pftPositive,L.PolyFillType.pftPositive);else{var r=L.Clipper.GetBounds(this.m_destPolys),s;if((s=new L.Path).push(new L.IntPoint2(r.left-10,r.bottom+10)),s.push(new L.IntPoint2(r.right+10,r.bottom+10)),s.push(new L.IntPoint2(r.right+10,r.top-10)),s.push(new L.IntPoint2(r.left-10,r.top-10)),o.AddPath(s,L.PolyType.ptSubject,!0),o.ReverseSolution=!0,o.Execute(L.ClipType.ctUnion,i,L.PolyFillType.pftNegative,L.PolyFillType.pftNegative),1===i.ChildCount()&&0<i.Childs()[0].ChildCount()){var l=i.Childs()[0];i.Childs()[0]=l.Childs()[0],i.Childs()[0].m_Parent=i;for(var p=1;p<l.ChildCount();p++)i.AddChild(l.Childs()[p])}else i.Clear()}}else{var i=t[0],n=t[1],o,r,s;L.Clear(i),this.FixOrientations(),this.DoOffset(n),(o=new L.Clipper(0)).AddPaths(this.m_destPolys,L.PolyType.ptSubject,!0),0<n?o.Execute(L.ClipType.ctUnion,i,L.PolyFillType.pftPositive,L.PolyFillType.pftPositive):(r=L.Clipper.GetBounds(this.m_destPolys),(s=new L.Path).push(new L.IntPoint2(r.left-10,r.bottom+10)),s.push(new L.IntPoint2(r.right+10,r.bottom+10)),s.push(new L.IntPoint2(r.right+10,r.top-10)),s.push(new L.IntPoint2(r.left-10,r.top-10)),o.AddPath(s,L.PolyType.ptSubject,!0),o.ReverseSolution=!0,o.Execute(L.ClipType.ctUnion,i,L.PolyFillType.pftNegative,L.PolyFillType.pftNegative),0<i.length&&i.splice(0,1))}},L.ClipperOffset.prototype.OffsetPoint=function(t,e,i){var n;if(this.m_sinA=this.m_normals[e].X*this.m_normals[t].Y-this.m_normals[t].X*this.m_normals[e].Y,Math.abs(this.m_sinA*this.m_delta)<1){if(0<this.m_normals[e].X*this.m_normals[t].X+this.m_normals[t].Y*this.m_normals[e].Y)return this.m_destPoly.push(new L.IntPoint2(L.ClipperOffset.Round(this.m_srcPoly[t].X+this.m_normals[e].X*this.m_delta),L.ClipperOffset.Round(this.m_srcPoly[t].Y+this.m_normals[e].Y*this.m_delta))),e}else 1<this.m_sinA?this.m_sinA=1:this.m_sinA<-1&&(this.m_sinA=-1);if(this.m_sinA*this.m_delta<0)this.m_destPoly.push(new L.IntPoint2(L.ClipperOffset.Round(this.m_srcPoly[t].X+this.m_normals[e].X*this.m_delta),L.ClipperOffset.Round(this.m_srcPoly[t].Y+this.m_normals[e].Y*this.m_delta))),this.m_destPoly.push(new L.IntPoint1(this.m_srcPoly[t])),this.m_destPoly.push(new L.IntPoint2(L.ClipperOffset.Round(this.m_srcPoly[t].X+this.m_normals[t].X*this.m_delta),L.ClipperOffset.Round(this.m_srcPoly[t].Y+this.m_normals[t].Y*this.m_delta)));else switch(i){case L.JoinType.jtMiter:var o=this.m_normals[t].X*this.m_normals[e].X+this.m_normals[t].Y*this.m_normals[e].Y+1;o>=this.m_miterLim?this.DoMiter(t,e,o):this.DoSquare(t,e);break;case L.JoinType.jtSquare:this.DoSquare(t,e);break;case L.JoinType.jtRound:this.DoRound(t,e)}return e=t},L.ClipperOffset.prototype.DoSquare=function(t,e){var i=Math.tan(Math.atan2(this.m_sinA,this.m_normals[e].X*this.m_normals[t].X+this.m_normals[e].Y*this.m_normals[t].Y)/4);this.m_destPoly.push(new L.IntPoint2(L.ClipperOffset.Round(this.m_srcPoly[t].X+this.m_delta*(this.m_normals[e].X-this.m_normals[e].Y*i)),L.ClipperOffset.Round(this.m_srcPoly[t].Y+this.m_delta*(this.m_normals[e].Y+this.m_normals[e].X*i)))),this.m_destPoly.push(new L.IntPoint2(L.ClipperOffset.Round(this.m_srcPoly[t].X+this.m_delta*(this.m_normals[t].X+this.m_normals[t].Y*i)),L.ClipperOffset.Round(this.m_srcPoly[t].Y+this.m_delta*(this.m_normals[t].Y-this.m_normals[t].X*i))))},L.ClipperOffset.prototype.DoMiter=function(t,e,i){var n=this.m_delta/i;this.m_destPoly.push(new L.IntPoint2(L.ClipperOffset.Round(this.m_srcPoly[t].X+(this.m_normals[e].X+this.m_normals[t].X)*n),L.ClipperOffset.Round(this.m_srcPoly[t].Y+(this.m_normals[e].Y+this.m_normals[t].Y)*n)))},L.ClipperOffset.prototype.DoRound=function(t,e){for(var i=Math.atan2(this.m_sinA,this.m_normals[e].X*this.m_normals[t].X+this.m_normals[e].Y*this.m_normals[t].Y),n=Math.max(L.Cast_Int32(L.ClipperOffset.Round(this.m_StepsPerRad*Math.abs(i))),1),o=this.m_normals[e].X,r=this.m_normals[e].Y,s,l=0;l<n;++l)this.m_destPoly.push(new L.IntPoint2(L.ClipperOffset.Round(this.m_srcPoly[t].X+o*this.m_delta),L.ClipperOffset.Round(this.m_srcPoly[t].Y+r*this.m_delta))),o=(s=o)*this.m_cos-this.m_sin*r,r=s*this.m_sin+r*this.m_cos;this.m_destPoly.push(new L.IntPoint2(L.ClipperOffset.Round(this.m_srcPoly[t].X+this.m_normals[t].X*this.m_delta),L.ClipperOffset.Round(this.m_srcPoly[t].Y+this.m_normals[t].Y*this.m_delta)))},L.Error=function(t){try{throw new Error(t)}catch(t){alert(t.message)}},L.JS={},L.JS.AreaOfPolygon=function(t,e){return e=e||1,L.Clipper.Area(t)/(e*e)},L.JS.AreaOfPolygons=function(t,e){e=e||1;for(var i=0,n=0;n<t.length;n++)i+=L.Clipper.Area(t[n]);return i/(e*e)},L.JS.BoundsOfPath=function(t,e){return L.JS.BoundsOfPaths([t],e)},L.JS.BoundsOfPaths=function(t,e){e=e||1;var i=L.Clipper.GetBounds(t);return i.left/=e,i.bottom/=e,i.right/=e,i.top/=e,i},L.JS.Clean=function(t,e){if(!(t instanceof Array))return[];var i=t[0]instanceof Array,t=L.JS.Clone(t);if("number"!=typeof e||null===e)return L.Error("Delta is not a number in Clean()."),t;if(0===t.length||1===t.length&&0===t[0].length||e<0)return t;for(var n=(t=!i?[t]:t).length,o,r,s,l,p,u,h,a=[],f=0;f<n;f++)if(0!==(o=(r=t[f]).length))if(o<3)a.push(s=r);else{for(l=e*e,p=(s=r)[0],h=u=1;h<o;h++)(r[h].X-p.X)*(r[h].X-p.X)+(r[h].Y-p.Y)*(r[h].Y-p.Y)<=l||(s[u]=r[h],p=r[h],u++);p=r[u-1],(r[0].X-p.X)*(r[0].X-p.X)+(r[0].Y-p.Y)*(r[0].Y-p.Y)<=l&&u--,u<o&&s.splice(u,o-u),s.length&&a.push(s)}return!i&&a.length?a=a[0]:i||0!==a.length?i&&0===a.length&&(a=[[]]):a=[],a},L.JS.Clone=function(t){if(!(t instanceof Array))return[];if(0===t.length)return[];if(1===t.length&&0===t[0].length)return[[]];for(var e=t[0]instanceof Array,i=(t=!e?[t]:t).length,n,o,r,s,l=new Array(i),o=0;o<i;o++){for(n=t[o].length,s=new Array(n),r=0;r<n;r++)s[r]={X:t[o][r].X,Y:t[o][r].Y};l[o]=s}return l=!e?l[0]:l},L.JS.Lighten=function(t,e){if(!(t instanceof Array))return[];if("number"!=typeof e||null===e)return L.Error("Tolerance is not a number in Lighten()."),L.JS.Clone(t);if(0===t.length||1===t.length&&0===t[0].length||e<0)return L.JS.Clone(t);for(var i=t[0]instanceof Array,n,o,r,s,l,p,u,h,a,f,d,P,m,y,c,v,C,I=(t=!i?[t]:t).length,x=e*e,_=[],n=0;n<I;n++)if(0!==(p=(r=t[n]).length)){for(s=0;s<1e6;s++){for(l=[],r[(p=r.length)-1].X!==r[0].X||r[p-1].Y!==r[0].Y?(P=1,r.push({X:r[0].X,Y:r[0].Y}),p=r.length):P=0,d=[],o=0;o<p-2;o++)u=r[o],a=r[o+1],h=r[o+2],v=u.X,C=u.Y,m=h.X-v,y=h.Y-C,0===m&&0===y||(1<(c=((a.X-v)*m+(a.Y-C)*y)/(m*m+y*y))?(v=h.X,C=h.Y):0<c&&(v+=m*c,C+=y*c)),(f=(m=a.X-v)*m+(y=a.Y-C)*y)<=x&&(d[o+1]=1,o++);for(l.push({X:r[0].X,Y:r[0].Y}),o=1;o<p-1;o++)d[o]||l.push({X:r[o].X,Y:r[o].Y});if(l.push({X:r[p-1].X,Y:r[p-1].Y}),P&&r.pop(),!d.length)break;r=l}l[(p=l.length)-1].X===l[0].X&&l[p-1].Y===l[0].Y&&l.pop(),2<l.length&&_.push(l)}return _=void 0===(_=!i?_[0]:_)?[]:_},L.JS.PerimeterOfPath=function(t,e,i){if(void 0===t)return 0;var n=Math.sqrt,o=0,r,s,l=0,p=0,u=0,h=0,a=t.length;if(a<2)return 0;for(e&&(t[a]=t[0],a++);--a;)l=(r=t[a]).X,p=r.Y,o+=n((l-(u=(s=t[a-1]).X))*(l-u)+(p-(h=s.Y))*(p-h));return e&&t.pop(),o/i},L.JS.PerimeterOfPaths=function(t,e,i){i=i||1;for(var n=0,o=0;o<t.length;o++)n+=L.JS.PerimeterOfPath(t[o],e,i);return n},L.JS.ScaleDownPath=function(t,e){var i,n;for(e=e||1,i=t.length;i--;)(n=t[i]).X=n.X/e,n.Y=n.Y/e},L.JS.ScaleDownPaths=function(t,e){var i,n,o;for(e=e||1,i=t.length;i--;)for(n=t[i].length;n--;)(o=t[i][n]).X=o.X/e,o.Y=o.Y/e},L.JS.ScaleUpPath=function(t,e){var i,n,o=Math.round;for(e=e||1,i=t.length;i--;)(n=t[i]).X=o(n.X*e),n.Y=o(n.Y*e)},L.JS.ScaleUpPaths=function(t,e){var i,n,o,r=Math.round;for(e=e||1,i=t.length;i--;)for(n=t[i].length;n--;)(o=t[i][n]).X=r(o.X*e),o.Y=r(o.Y*e)},L.ExPolygons=function(){return[]},L.ExPolygon=function(){this.outer=null,this.holes=null},L.JS.AddOuterPolyNodeToExPolygons=function(t,e){var i=new L.ExPolygon;i.outer=t.Contour();var n=t.Childs(),o=n.length,r,s,l,p,u,h;for(i.holes=new Array(o),l=0;l<o;l++)for(r=n[l],i.holes[l]=r.Contour(),p=0,h=(u=r.Childs()).length;p<h;p++)s=u[p],L.JS.AddOuterPolyNodeToExPolygons(s,e);e.push(i)},L.JS.ExPolygonsToPaths=function(t){for(var e,i,n,o,r=new L.Paths,e=0,n=t.length;e<n;e++)for(r.push(t[e].outer),i=0,o=t[e].holes.length;i<o;i++)r.push(t[e].holes[i]);return r},L.JS.PolyTreeToExPolygons=function(t){for(var e=new L.ExPolygons,i,n,o,r,n=0,o=t.Childs(),r=o.length;n<r;n++)i=o[n],L.JS.AddOuterPolyNodeToExPolygons(i,e);return e}}();"use strict";function earcut(e,n,r){r=r||2;var t=n&&n.length,i=t?n[0]*r:e.length,x=linkedList(e,0,i,r,!0),a=[],o,u,l,s,v,f,y;if(!x||x.next===x.prev)return a;if(t&&(x=eliminateHoles(e,n,x,r)),e.length>80*r){for(var o=l=e[0],u=s=e[1],p=r;p<i;p+=r)(v=e[p])<o&&(o=v),(f=e[p+1])<u&&(u=f),l<v&&(l=v),s<f&&(s=f);y=0!==(y=Math.max(l-o,s-u))?1/y:0}return earcutLinked(x,a,r,o,u,y),a}function linkedList(e,n,r,t,i){var x,a;if(i===0<signedArea(e,n,r,t))for(x=n;x<r;x+=t)a=insertNode(x,e[x],e[x+1],a);else for(x=r-t;n<=x;x-=t)a=insertNode(x,e[x],e[x+1],a);return a&&equals(a,a.next)&&(removeNode(a),a=a.next),a}function filterPoints(e,n){if(!e)return e;n=n||e;var r=e,t;do{if(t=!1,r.steiner||!equals(r,r.next)&&0!==area(r.prev,r,r.next))r=r.next;else{if(removeNode(r),(r=n=r.prev)===r.next)break;t=!0}}while(t||r!==n);return n}function earcutLinked(e,n,r,t,i,x,a){if(e){!a&&x&&indexCurve(e,t,i,x);for(var o=e,u,l;e.prev!==e.next;)if(u=e.prev,l=e.next,x?isEarHashed(e,t,i,x):isEar(e))n.push(u.i/r),n.push(e.i/r),n.push(l.i/r),removeNode(e),e=l.next,o=l.next;else if((e=l)===o){a?1===a?earcutLinked(e=cureLocalIntersections(filterPoints(e),n,r),n,r,t,i,x,2):2===a&&splitEarcut(e,n,r,t,i,x):earcutLinked(filterPoints(e),n,r,t,i,x,1);break}}}function isEar(e){var n=e.prev,r=e,t=e.next;if(0<=area(n,r,t))return!1;for(var i=e.next.next;i!==e.prev;){if(pointInTriangle(n.x,n.y,r.x,r.y,t.x,t.y,i.x,i.y)&&0<=area(i.prev,i,i.next))return!1;i=i.next}return!0}function isEarHashed(e,n,r,t){var i=e.prev,x=e,a=e.next;if(0<=area(i,x,a))return!1;for(var o=(i.x<x.x?i.x<a.x?i:a:x.x<a.x?x:a).x,u=(i.y<x.y?i.y<a.y?i:a:x.y<a.y?x:a).y,l=(i.x>x.x?i.x>a.x?i:a:x.x>a.x?x:a).x,s=(i.y>x.y?i.y>a.y?i:a:x.y>a.y?x:a).y,v=zOrder(o,u,n,r,t),f=zOrder(l,s,n,r,t),y=e.prevZ,p=e.nextZ;y&&y.z>=v&&p&&p.z<=f;){if(y!==e.prev&&y!==e.next&&pointInTriangle(i.x,i.y,x.x,x.y,a.x,a.y,y.x,y.y)&&0<=area(y.prev,y,y.next))return!1;if(y=y.prevZ,p!==e.prev&&p!==e.next&&pointInTriangle(i.x,i.y,x.x,x.y,a.x,a.y,p.x,p.y)&&0<=area(p.prev,p,p.next))return!1;p=p.nextZ}for(;y&&y.z>=v;){if(y!==e.prev&&y!==e.next&&pointInTriangle(i.x,i.y,x.x,x.y,a.x,a.y,y.x,y.y)&&0<=area(y.prev,y,y.next))return!1;y=y.prevZ}for(;p&&p.z<=f;){if(p!==e.prev&&p!==e.next&&pointInTriangle(i.x,i.y,x.x,x.y,a.x,a.y,p.x,p.y)&&0<=area(p.prev,p,p.next))return!1;p=p.nextZ}return!0}function cureLocalIntersections(e,n,r){var t=e;do{var i=t.prev,x=t.next.next}while(!equals(i,x)&&intersects(i,t,t.next,x)&&locallyInside(i,x)&&locallyInside(x,i)&&(n.push(i.i/r),n.push(t.i/r),n.push(x.i/r),removeNode(t),removeNode(t.next),t=e=x),(t=t.next)!==e);return filterPoints(t)}function splitEarcut(e,n,r,t,i,x){var a=e;do{for(var o=a.next.next;o!==a.prev;){if(a.i!==o.i&&isValidDiagonal(a,o)){var u=splitPolygon(a,o),a=filterPoints(a,a.next),u=filterPoints(u,u.next);return earcutLinked(a,n,r,t,i,x),void earcutLinked(u,n,r,t,i,x)}o=o.next}}while((a=a.next)!==e)}function eliminateHoles(e,n,r,t){for(var i=[],x,a,o,u,l,x=0,a=n.length;x<a;x++)(l=linkedList(e,o=n[x]*t,u=x<a-1?n[x+1]*t:e.length,t,!1))===l.next&&(l.steiner=!0),i.push(getLeftmost(l));for(i.sort(compareX),x=0;x<i.length;x++)r=filterPoints(r=eliminateHole(i[x],r),r.next);return r}function compareX(e,n){return e.x-n.x}function eliminateHole(e,n){var r=findHoleBridge(e,n);if(!r)return n;var t=splitPolygon(r,e),i=filterPoints(r,r.next);return filterPoints(t,t.next),n===r?i:n}function findHoleBridge(e,n){var r=n,t=e.x,i=e.y,x=-1/0,a;do{if(i<=r.y&&i>=r.next.y&&r.next.y!==r.y){var o=r.x+(i-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(o<=t&&x<o){if((x=o)===t){if(i===r.y)return r;if(i===r.next.y)return r.next}a=r.x<r.next.x?r:r.next}}}while((r=r.next)!==n);if(!a)return null;if(t===x)return a;for(var u=a,l=a.x,s=a.y,v=1/0,f,r=a;t>=r.x&&r.x>=l&&t!==r.x&&pointInTriangle(i<s?t:x,i,l,s,i<s?x:t,i,r.x,r.y)&&(f=Math.abs(i-r.y)/(t-r.x),locallyInside(r,e)&&(f<v||f===v&&(r.x>a.x||r.x===a.x&&sectorContainsSector(a,r)))&&(a=r,v=f)),(r=r.next)!==u;);return a}function sectorContainsSector(e,n){return area(e.prev,e,n.prev)<0&&area(n.next,e,e.next)<0}function indexCurve(e,n,r,t){for(var i=e;null===i.z&&(i.z=zOrder(i.x,i.y,n,r,t)),i.prevZ=i.prev,i.nextZ=i.next,(i=i.next)!==e;);i.prevZ.nextZ=null,i.prevZ=null,sortLinked(i)}function sortLinked(e){var n,r,t,i,x,a,o,u,l=1;do{for(r=e,x=e=null,a=0;r;){for(a++,t=r,n=o=0;n<l&&(o++,t=t.nextZ);n++);for(u=l;0<o||0<u&&t;)0!==o&&(0===u||!t||r.z<=t.z)?(r=(i=r).nextZ,o--):(t=(i=t).nextZ,u--),x?x.nextZ=i:e=i,i.prevZ=x,x=i;r=t}}while(x.nextZ=null,l*=2,1<a);return e}function zOrder(e,n,r,t,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=32767*(n-t)*i)|n<<8))|n<<4))|n<<2))|n<<1))<<1}function getLeftmost(e){for(var n=e,r=e;(n.x<r.x||n.x===r.x&&n.y<r.y)&&(r=n),(n=n.next)!==e;);return r}function pointInTriangle(e,n,r,t,i,x,a,o){return 0<=(i-a)*(n-o)-(e-a)*(x-o)&&0<=(e-a)*(t-o)-(r-a)*(n-o)&&0<=(r-a)*(x-o)-(i-a)*(t-o)}function isValidDiagonal(e,n){return e.next.i!==n.i&&e.prev.i!==n.i&&!intersectsPolygon(e,n)&&(locallyInside(e,n)&&locallyInside(n,e)&&middleInside(e,n)&&(area(e.prev,e,n.prev)||area(e,n.prev,n))||equals(e,n)&&0<area(e.prev,e,e.next)&&0<area(n.prev,n,n.next))}function area(e,n,r){return(n.y-e.y)*(r.x-n.x)-(n.x-e.x)*(r.y-n.y)}function equals(e,n){return e.x===n.x&&e.y===n.y}function intersects(e,n,r,t){var i=sign(area(e,n,r)),x=sign(area(e,n,t)),a=sign(area(r,t,e)),o=sign(area(r,t,n));return i!==x&&a!==o||(!(0!==i||!onSegment(e,r,n))||(!(0!==x||!onSegment(e,t,n))||(!(0!==a||!onSegment(r,e,t))||!(0!==o||!onSegment(r,n,t)))))}function onSegment(e,n,r){return n.x<=Math.max(e.x,r.x)&&n.x>=Math.min(e.x,r.x)&&n.y<=Math.max(e.y,r.y)&&n.y>=Math.min(e.y,r.y)}function sign(e){return 0<e?1:e<0?-1:0}function intersectsPolygon(e,n){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==n.i&&r.next.i!==n.i&&intersects(r,r.next,e,n))return!0}while((r=r.next)!==e);return!1}function locallyInside(e,n){return area(e.prev,e,e.next)<0?0<=area(e,n,e.next)&&0<=area(e,e.prev,n):area(e,n,e.prev)<0||area(e,e.next,n)<0}function middleInside(e,n){for(var r=e,t=!1,i=(e.x+n.x)/2,x=(e.y+n.y)/2;r.y>x!=r.next.y>x&&r.next.y!==r.y&&i<(r.next.x-r.x)*(x-r.y)/(r.next.y-r.y)+r.x&&(t=!t),(r=r.next)!==e;);return t}function splitPolygon(e,n){var r=new Node(e.i,e.x,e.y),t=new Node(n.i,n.x,n.y),i=e.next,x=n.prev;return(e.next=n).prev=e,(r.next=i).prev=r,(t.next=r).prev=t,(x.next=t).prev=x,t}function insertNode(e,n,r,t){var i=new Node(e,n,r);return t?(i.next=t.next,(i.prev=t).next.prev=i,t.next=i):(i.prev=i).next=i,i}function removeNode(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Node(e,n,r){this.i=e,this.x=n,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function signedArea(e,n,r,t){for(var i=0,x=n,a=r-t;x<r;x+=t)i+=(e[a]-e[x])*(e[x+1]+e[a+1]),a=x;return i}module.exports=earcut,(module.exports.default=earcut).deviation=function(e,n,r,t){var i=n&&n.length,x=i?n[0]*r:e.length,a=Math.abs(signedArea(e,0,x,r));if(i)for(var o=0,u=n.length;o<u;o++){var l=n[o]*r,s=o<u-1?n[o+1]*r:e.length;a-=Math.abs(signedArea(e,l,s,r))}for(var v=0,o=0;o<t.length;o+=3){var f=t[o]*r,y=t[o+1]*r,p=t[o+2]*r;v+=Math.abs((e[f]-e[p])*(e[1+y]-e[1+f])-(e[f]-e[y])*(e[1+p]-e[1+f]))}return 0===a&&0===v?0:Math.abs((v-a)/a)},earcut.flatten=function(e){for(var n=e[0][0].length,r={vertices:[],holes:[],dimensions:n},t=0,i=0;i<e.length;i++){for(var x=0;x<e[i].length;x++)for(var a=0;a<n;a++)r.vertices.push(e[i][x][a]);0<i&&(t+=e[i-1].length,r.holes.push(t))}return r};!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).TracespaceParser={})}(this,function(e){"use strict";var t="gerber",r="drill",p="mm",h="in",d="leading",v="trailing",y="absolute",E="incremental",N="circle",x="rectangle",_="obround",C="polygon",I="macroShape",n="1",o="20",i="21",u="4",a="5",l="6",s="7",c="shape",f="move",m="segment",g="slot",O="line",R="cwArc",A="ccwArc",w="single",T="multi",b="dark",M="clear",L="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function S(e,t,r){return e(r={path:t,exports:{},require:function(e,t){return k(e,null==t?r.path:t)}},r.exports),r.exports}function k(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}var D=S(function(e){var t,r;t=L,r=function(){var i=Object.prototype.hasOwnProperty,t=Object.prototype.toString,R="boolean"==typeof(new RegExp).sticky;function A(e){return e&&"[object RegExp]"===t.call(e)}function s(e){return e&&"object"==typeof e&&!A(e)&&!Array.isArray(e)}function r(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function w(e){var t;return new RegExp("|"+e).exec("").length-1}function T(e){return"("+e+")"}function b(e){return e.length?"(?:"+e.map(function(e){return"(?:"+e+")"}).join("|")+")":"(?!)";var t}function N(e){if("string"==typeof e)return"(?:"+r(e)+")";if(A(e)){if(e.ignoreCase)throw new Error("RegExp /i flag not allowed");if(e.global)throw new Error("RegExp /g flag is implied");if(e.sticky)throw new Error("RegExp /y flag is implied");if(e.multiline)throw new Error("RegExp /m flag is implied");return e.source}throw new Error("Not a pattern: "+e)}function n(e){for(var t=Object.getOwnPropertyNames(e),r=[],n=0;n<t.length;n++){var o=t[n],i=e[o],u=[].concat(i);if("include"!==o){var a=[];u.forEach(function(e){s(e)?(a.length&&r.push(c(o,a)),r.push(c(o,e)),a=[]):a.push(e)}),a.length&&r.push(c(o,a))}else for(var l=0;l<u.length;l++)r.push({include:u[l]})}return r}function o(e){for(var t=[],r=0;r<e.length;r++){var n=e[r];if(n.include)for(var o=[].concat(n.include),i=0;i<o.length;i++)t.push({include:o[i]});else{if(!n.type)throw new Error("Rule has no type: "+JSON.stringify(n));t.push(c(n.type,n))}}return t}function c(e,t){if((t=!s(t)?{match:t}:t).include)throw new Error("Matching rules cannot also include states");var r={defaultType:e,lineBreaks:!!t.error||!!t.fallback,pop:!1,next:null,push:null,error:!1,fallback:!1,value:null,type:null,shouldThrow:!1},n;for(n in t)i.call(t,n)&&(r[n]=t[n]);if("string"==typeof r.type&&e!==r.type)throw new Error("Type transform cannot be a string (type '"+r.type+"' for token '"+e+"')");var o=r.match;return r.match=Array.isArray(o)?o:o?[o]:[],r.match.sort(function(e,t){return A(e)&&A(t)?0:A(t)?-1:A(e)?1:t.length-e.length}),r}function O(e){return(Array.isArray(e)?o:n)(e)}var x=c("error",{lineBreaks:!0,shouldThrow:!0});function _(e,t){for(var r=null,n=Object.create(null),o=!0,i=null,u=[],a=[],l=0;l<e.length;l++)e[l].fallback&&(o=!1);for(var l=0;l<e.length;l++){var s=e[l];if(s.include)throw new Error("Inheritance is not allowed in stateless lexers");if(s.error||s.fallback){if(r)throw!s.fallback==!r.fallback?new Error("Multiple "+(s.fallback?"fallback":"error")+" rules not allowed (for token '"+s.defaultType+"')"):new Error("fallback and error are mutually exclusive (for token '"+s.defaultType+"')");r=s}var c=s.match.slice(),f;if(o)for(;c.length&&"string"==typeof c[0]&&1===c[0].length;){n[c.shift().charCodeAt(0)]=s}if(s.pop||s.push||s.next){if(!t)throw new Error("State-switching options are not allowed in stateless lexers (for token '"+s.defaultType+"')");if(s.fallback)throw new Error("State-switching options are not allowed on fallback tokens (for token '"+s.defaultType+"')")}if(0!==c.length){o=!1,u.push(s);for(var p=0;p<c.length;p++){var h=c[p];if(A(h))if(null===i)i=h.unicode;else if(i!==h.unicode&&!1===s.fallback)throw new Error("If one rule is /u then all must be")}var d=b(c.map(N)),v=new RegExp(d),y;if(v.test(""))throw new Error("RegExp matches empty string: "+v);if(0<w(d))throw new Error("RegExp has capture groups: "+v+"\nUse (?:  ) instead");if(!s.lineBreaks&&v.test("\n"))throw new Error("Rule should declare lineBreaks: "+v);a.push(T(d))}}var E=r&&r.fallback,m=R&&!E?"ym":"gm",g=R||E?"":"|",O;return!0===i&&(m+="u"),{regexp:new RegExp(b(a)+g,m),groups:u,fast:n,error:r||x}}function e(e){var t=_(O(e));return new I({start:t},"start")}function C(e,t,r){var n=e&&(e.push||e.next);if(n&&!r[n])throw new Error("Missing state '"+n+"' (in token '"+e.defaultType+"' of state '"+t+"')");if(e&&e.pop&&1!=+e.pop)throw new Error("pop must be 1 (in token '"+e.defaultType+"' of state '"+t+"')")}function u(e,t){var r=e.$all?O(e.$all):[];delete e.$all;var n=Object.getOwnPropertyNames(e);t=t||n[0];for(var o=Object.create(null),i=0,u;i<n.length;i++){o[u=n[i]]=O(e[u]).concat(r)}for(var i=0;i<n.length;i++)for(var u,a=o[u=n[i]],l=Object.create(null),s=0;s<a.length;s++){var c=a[s];if(c.include){var f=[s,1];if(c.include!==u&&!l[c.include]){l[c.include]=!0;var p=o[c.include];if(!p)throw new Error("Cannot include nonexistent state '"+c.include+"' (in state '"+u+"')");for(var h=0;h<p.length;h++){var d=p[h];-1===a.indexOf(d)&&f.push(d)}}a.splice.apply(a,f),s--}}for(var v=Object.create(null),i=0,u;i<n.length;i++){v[u=n[i]]=_(o[u],!0)}for(var i=0;i<n.length;i++){for(var y=n[i],E=v[y],m=E.groups,s=0;s<m.length;s++)C(m[s],y,v);for(var g=Object.getOwnPropertyNames(E.fast),s=0;s<g.length;s++)C(E.fast[g[s]],y,v)}return new I(v,t)}function a(e){for(var r=Object.create(null),t=Object.create(null),n=Object.getOwnPropertyNames(e),o=0;o<n.length;o++){var i=n[o],u=e[i],a;(Array.isArray(u)?u:[u]).forEach(function(e){if((t[e.length]=t[e.length]||[]).push(e),"string"!=typeof e)throw new Error("keyword must be string (in keyword '"+i+"')");r[e]=i})}function l(e){return JSON.stringify(e)}var s="",c;for(c in s+="switch (value.length) {\n",t){var f=t[c];s+="case "+c+":\n",s+="switch (value) {\n",f.forEach(function(e){var t=r[e];s+="case "+l(e)+": return "+l(t)+"\n"}),s+="}\n"}return s+="}\n",Function("value",s)}var I=function(e,t){this.startState=t,this.states=e,this.buffer="",this.stack=[],this.reset()};I.prototype.reset=function(e,t){return this.buffer=e||"",this.index=0,this.line=t?t.line:1,this.col=t?t.col:1,this.queuedToken=t?t.queuedToken:null,this.queuedThrow=t?t.queuedThrow:null,this.setState(t?t.state:this.startState),this.stack=t&&t.stack?t.stack.slice():[],this},I.prototype.save=function(){return{line:this.line,col:this.col,state:this.state,stack:this.stack.slice(),queuedToken:this.queuedToken,queuedThrow:this.queuedThrow}},I.prototype.setState=function(e){var t;e&&this.state!==e&&(this.state=e,t=this.states[e],this.groups=t.groups,this.error=t.error,this.re=t.regexp,this.fast=t.fast)},I.prototype.popState=function(){this.setState(this.stack.pop())},I.prototype.pushState=function(e){this.stack.push(this.state),this.setState(e)};var l=R?function(e,t){return e.exec(t)}:function(e,t){var r=e.exec(t);return 0===r[0].length?null:r},f;function p(){return this.value}return I.prototype._getGroup=function(e){for(var t=this.groups.length,r=0;r<t;r++)if(void 0!==e[r+1])return this.groups[r];throw new Error("Cannot find token type for matched text")},I.prototype.next=function(){var e=this.index;if(this.queuedGroup){var t=this._token(this.queuedGroup,this.queuedText,e);return this.queuedGroup=null,this.queuedText="",t}var r=this.buffer,n;if(e!==r.length){if(n=this.fast[r.charCodeAt(e)])return this._token(n,r.charAt(e),e);var o=this.re;o.lastIndex=e;var i=l(o,r),u=this.error;if(null==i)return this._token(u,r.slice(e,r.length),e);var n=this._getGroup(i),a=i[0];return u.fallback&&i.index!==e?(this.queuedGroup=n,this.queuedText=a,this._token(u,r.slice(e,i.index),e)):this._token(n,a,e)}},I.prototype._token=function(e,t,r){var n=0;if(e.lineBreaks){var o=/\n/g,i=1;if("\n"===t)n=1;else for(;o.exec(t);)n++,i=o.lastIndex}var u={type:"function"==typeof e.type&&e.type(t)||e.defaultType,value:"function"==typeof e.value?e.value(t):t,text:t,toString:p,offset:r,lineBreaks:n,line:this.line,col:this.col},a=t.length;if(this.index+=a,this.line+=n,0!==n?this.col=a-i+1:this.col+=a,e.shouldThrow)throw new Error(this.formatError(u,"invalid syntax"));return e.pop?this.popState():e.push?this.pushState(e.push):e.next&&this.setState(e.next),u},"undefined"!=typeof Symbol&&Symbol.iterator&&((f=function(e){this.lexer=e}).prototype.next=function(){var e=this.lexer.next();return{value:e,done:!e}},f.prototype[Symbol.iterator]=function(){return this},I.prototype[Symbol.iterator]=function(){return new f(this)}),I.prototype.formatError=function(e,t){var r,e;null==e&&(e={text:r=this.buffer.slice(this.index),offset:this.index,lineBreaks:-1===r.indexOf("\n")?0:1,line:this.line,col:this.col});var n=Math.max(0,e.offset-e.col+1),o=e.lineBreaks?e.text.indexOf("\n"):e.text.length,i=this.buffer.substring(n,e.offset+o);return t+=" at line "+e.line+" col "+e.col+":\n\n",t+="  "+i+"\n",t+="  "+Array(e.col).join(" ")+"^"},I.prototype.clone=function(){return new I(this.states,this.state)},I.prototype.has=function(e){return!0},{compile:e,states:u,error:Object.freeze({error:!0}),fallback:Object.freeze({fallback:!0}),keywords:a}},e.exports?e.exports=r():t.moo=r()});function P(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function j(){return(j=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t],n;for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function G(e,t){return H(e)||z(e,t)||Z(e,t)||V()}function B(e){return H(e)||F(e)||Z(e)||V()}function U(e){return q(e)||F(e)||Z(e)||W()}function q(e){if(Array.isArray(e))return $(e)}function H(e){if(Array.isArray(e))return e}function F(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function z(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var r=[],n=!0,o=!1,i=void 0;try{for(var u=e[Symbol.iterator](),a;!(n=(a=u.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){o=!0,i=e}finally{try{n||null==u.return||u.return()}finally{if(o)throw i}}return r}}function Z(e,t){if(e){if("string"==typeof e)return $(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(r="Object"===r&&e.constructor?e.constructor.name:r)||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?$(e,t):void 0}}function $(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function W(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function V(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var X="T_CODE",Y="G_CODE",K="M_CODE",J="D_CODE",Q="ASTERISK",ee="PERCENT",te="EQUALS",re="COMMA",ne="OPERATOR",oe="GERBER_FORMAT",ie="GERBER_UNITS",ue="GERBER_TOOL_MACRO",ae="GERBER_TOOL_DEF",le="GERBER_LOAD_POLARITY",se="GERBER_STEP_REPEAT",ce="GERBER_MACRO_VARIABLE",fe="SEMICOLON",pe="DRILL_UNITS",he="DRILL_ZERO_INCLUSION",de="COORD_CHAR",ve="NUMBER",ye="WORD",Ee="WHITESPACE",me="NEWLINE",ge="CATCHALL",Oe="ERROR",Re,Ae=/^0*/,we=function e(t){return t.replace(Ae,"")},Te=function e(t){return we(t.slice(1))||"0"},be=(P(Re={},X,{match:/T\d+/,value:Te}),P(Re,Y,{match:/G\d+/,value:Te}),P(Re,K,{match:/M\d+/,value:Te}),P(Re,J,{match:/D\d+/,value:Te}),P(Re,Q,"*"),P(Re,ee,"%"),P(Re,te,"="),P(Re,oe,{match:/FS[LTDAI]+/,value:function e(t){return t.slice(2)}}),P(Re,ie,{match:/MO(?:IN|MM)/,value:function e(t){return t.slice(2)}}),P(Re,ue,{match:/AM[a-zA-Z_.$][\w.-]*/,value:function e(t){return t.slice(2)}}),P(Re,ae,{match:/ADD\d+[a-zA-Z_.$][\w.-]*/,value:function e(t){return we(t.slice(3))}}),P(Re,le,{match:/LP[DC]/,value:function e(t){return t.slice(2)}}),P(Re,se,"SR"),P(Re,ce,/\$\d+/),P(Re,fe,";"),P(Re,pe,/^(?:METRIC|INCH)/),P(Re,he,{match:/,(?:TZ|LZ)/,value:function e(t){return t.slice(1)}}),P(Re,de,/[XYIJACFSBHZN]/),P(Re,ve,/(?:[+-])?[\d.]+/),P(Re,ne,["x","/","+","-","(",")"]),P(Re,re,","),P(Re,ye,/[a-zA-Z]+/),P(Re,Ee,/[ \t]+/),P(Re,me,{match:/\r?\n/,lineBreaks:!0}),P(Re,ge,/[\S]/),P(Re,Oe,D.error),Re);function Ne(){return D.compile(be)}var xe="root",_e="comment",Ce="done",Ie="units",Me="coordinateFormat",Le="toolDefinition",Se="toolMacro",ke="toolChange",De="loadPolarity",Pe="stepRepeat",je="graphic",Ge="interpolateMode",Be="regionMode",Ue="quadrantMode",qe="unimplemented",He="macroComment",Fe="macroVariable",ze="macroPrimitive",Ze="TOKEN",$e="MIN_TO_MAX";function We(e,t){return{rule:Ze,type:e,value:t}}function Ve(e,t){return{rule:Ze,type:e,value:t,negate:!0}}function Xe(e){return{rule:$e,min:1,max:1,match:e}}function Ye(e){return{rule:$e,min:0,max:1,match:e}}function Ke(e){return{rule:$e,min:0,max:1/0,match:e}}function Je(e){return{rule:$e,min:1,max:1/0,match:e}}function Qe(e,t,r){return{rule:$e,min:e,max:t,match:r}}function et(o){return o.reduce(function(e,t,r){var n=o[r-1];return t.type===ve&&(null==n?void 0:n.type)===de&&(e[n.value.toLowerCase()]=t.value),e},{})}function tt(e){return e.filter(function(e){return e.type===Y}).reduce(function(e,t){return"0"===t.value?f:"1"===t.value?O:"2"===t.value?R:"3"===t.value?A:"5"===t.value?r:e},null)}function rt(e){return e.filter(function(e){return e.type===J}).reduce(function(e,t){return"1"===t.value?m:"2"===t.value?f:"3"===t.value?c:e},null)}function nt(e){return e.map(function(e){return e.value}).join("").trim()}function ot(e,t){var r,n=1<arguments.length&&void 0!==t?t:{},o=null!==(r=n.head)&&void 0!==r?r:e[0],i=n.length?e[e.indexOf(o)+n.length-1]:e[e.length-1];return{start:{line:o.line,column:o.col,offset:o.offset},end:{line:i.line,column:i.col,offset:i.offset}}}var it={rules:[Xe([We(pe),We(K,"71"),We(K,"72")]),Ke([We(re),We(he),We(ve,/^0{1,8}\.0{1,8}$/)]),We(me)],createNodes:function e(t){var r="INCH"===t[0].value||"72"===t[0].value?h:p,n=t.filter(function(e){return e.type===he}).reduce(function(e,t){return"LZ"===t.value?v:"TZ"===t.value?d:e},null),o=t.filter(function(e){return e.type===ve}).reduce(function(e,t){var r,n=G(t.value.split("."),2),o=n[0],i,u=n[1],a;return[(void 0===o?"":o).length,(void 0===u?"":u).length]},null),i=[{type:Ie,position:ot(t.slice(0,2)),units:r}];return(n||o)&&i.push({type:Me,position:ot(t.slice(1)),mode:null,format:o,zeroSuppression:n}),i}},ut={rules:[We(X),Qe(0,12,[We(de,"C"),We(de,"F"),We(de,"S"),We(de,"B"),We(de,"H"),We(de,"Z"),We(ve)]),We(me)],createNodes:function e(t){var r=t[0].value,n=ot(t),o,i=et(t.slice(1,-1)).c,u=void 0===i?null:i,a=null!==u?{type:N,diameter:Number(u)}:null;return a?[{type:Le,hole:null,position:n,shape:a,code:r}]:[{type:ke,position:n,code:r}]}},at={rules:[Xe([We(Y,"0"),We(Y,"1"),We(Y,"2"),We(Y,"3"),We(Y,"5")]),We(me)],createNodes:function e(t){return[{type:Ge,position:ot(t),mode:tt(t)}]}},lt={rules:[Qe(0,2,[We(X),We(Y,"0"),We(Y,"1"),We(Y,"2"),We(Y,"3"),We(Y,"5")]),Qe(2,8,[We(de),We(ve)]),Ye([We(X)]),We(me)],createNodes:function e(t){var r=t.filter(function(e){return e.type===de||e.type===ve}),n=t.find(function(e){return e.type===Y}),o=t.find(function(e){return e.type===X}),i=et(r),u=o?o.value:null,a=tt(t),l=ot(t,{head:r[0],length:r.length+1}),s=ot(t,{head:n,length:2}),c=ot(t,{head:o,length:2}),f=[{type:je,position:l,graphic:null,coordinates:i}];return a&&f.unshift({type:Ge,position:s,mode:a}),u&&f.unshift({type:ke,position:c,code:u}),f}},st={rules:[Qe(2,4,[We(de),We(ve)]),We(Y,"85"),Qe(2,4,[We(de),We(ve)]),We(me)],createNodes:function e(t){var r=t.find(function(e){return e.type===Y}),n=r?t.indexOf(r):-1,o=et(t.slice(0,n)),i=et(t.slice(n)),u={};return Object.keys(o).forEach(function(e){return u["".concat(e,"1")]=o[e]}),Object.keys(i).forEach(function(e){return u["".concat(e,"2")]=i[e]}),[{type:je,position:ot(t),graphic:g,coordinates:u}]}},ct={rules:[Xe([We(K,"30"),We(K,"0")]),We(me)],createNodes:function e(t){return[{type:Ce,position:ot(t)}]}},ft,pt=[ut,at,lt,st,{rules:[We(fe),Ke([Ve(me)]),We(me)],createNodes:function e(t){return[{type:_e,comment:nt(t.slice(1,-1)),position:ot(t)}]}},it,ct].map(function(e){return j({},e,{filetype:r})}),ht="FULL_MATCH",dt="PARTIAL_MATCH",vt="NO_MATCH";function yt(){for(var e=arguments.length,r=new Array(e),t=0;t<e;t++)r[t]=arguments[t];return function(e,t){return Et(e,t,r)}}function Et(e,t,r){for(var n,o=(e=null===e?{candidates:r,tokens:[]}:e).candidates,i=[],u=[].concat(U(e.tokens),[t]),a,a=0;a<o.length;a++){var l=o[a],s=mt(l.rules,u),c;if(s===ht)return{candidates:[],tokens:u,nodes:l.createNodes(u),filetype:l.filetype};s===dt&&i.push(l)}return{candidates:i,tokens:u}}function mt(e,t){for(var r=0,n=0,o=0;r<e.length&&n<t.length;){var i=e[r],u,a;if(gt(i,t[n]))i.rule===Ze||i.rule===$e&&o>=i.max-1?(r++,n++,o=0):i.rule===$e&&(n++,o++);else{if(!(i.rule===$e&&o>=i.min))return vt;o=0,r++}}return r<e.length?dt:ht}function gt(e,t){if(e.rule!==Ze)return!!Array.isArray(e.match)&&e.match.some(function(e){return gt(e,t)});var r=e.type===t.type,n=null==e.value||"string"==typeof e.value&&e.value===t.value||e.value instanceof RegExp&&e.value.test(t.value),o=r&&n;return e.negate?!o:o}var Ot={rules:[We(ve,"0"),Ke([Ve(Q)]),We(Q)],createNodes:wt},Rt={rules:[We(ce),We(te),Je([We(ve),We(ne),We(ce),We(de,"X")]),We(Q)],createNodes:bt},At;function wt(e){var t=e.slice(1,-1).map(function(e){return e.text}).join("").trim();return[{type:He,position:ot(e),comment:t}]}function Tt(e){var t=e[0].value,r=e.slice(2,-1).reduce(function(e,t){var r=e[e.length-1];return t.type!==re?r.push(t):e.push([]),e},[[]]).map(Nt);return[{type:ze,position:ot(e),code:t,modifiers:r}]}function bt(e){var t=e[0].value,r=Nt(e.slice(2,-1));return[{type:Fe,position:ot(e),name:t,value:r}]}function Nt(e){var u=e.map(function(e){return e.type===de?j({},e,{type:ne,value:"x"}):e});return r();function a(){var e;return null!==(e=u[0])&&void 0!==e?e:null}function n(){var e=u.shift();if(e.type===ve)return Number(e.value);if(e.type===ce)return e.value;var t=r();return u.shift(),t}function l(){for(var e=n(),t=a(),r;(null===t||void 0===t?void 0:t.type)===ne&&("x"===t.value||"/"===t.value);){u.shift(),e={left:e,right:n(),operator:t.value},t=a()}return e}function r(){for(var e=l(),t=a();(null===t||void 0===t?void 0:t.type)===ne&&("+"===t.value||"-"===t.value)||(null===t||void 0===t?void 0:t.type)===ve;){var r,n,o="+";t.type===ne&&(u.shift(),o=t.value);var i,e={left:e,right:l(),operator:o},t=a()}return e}}var xt=[{rules:[We(ve),We(re),Je([We(re),We(ve),We(ne),We(ce),We(de,"X")]),We(Q)],createNodes:Tt},Rt,Ot];function _t(e){var t=null,r=[];return e.forEach(function(e){(t=Et(t,e,xt)).nodes&&r.push.apply(r,U(t.nodes)),0===t.candidates.length&&(t=null)}),r}var Ct=function e(t){if(1===t.length){var r,n=G(t,1)[0];return{type:N,diameter:n}}if(2!==t.length)return null;var o=G(t,2),i=o[0],u=o[1];return{type:x,xSize:i,ySize:u}},It={rules:[Xe([We(K,"0"),We(K,"2")]),We(Q)],createNodes:function e(t){return[{type:Ce,position:ot(t)}]}},Mt={rules:[We(Y,"4"),Ke([Ve(Q)]),We(Q)],createNodes:function e(t){return[{type:_e,position:ot(t),comment:nt(t.slice(1,-1))}]}},Lt={rules:[We(ee),We(oe),Ke([Ve(de,"X")]),We(de,"X"),We(ve),We(de,"Y"),We(ve),Ke([Ve(Q)]),We(Q),Qe(0,2,[We(ie),We(Q)]),We(ee)],createNodes:function e(t){var r,n=null,o=null,i=null,u=et(t),a=t.findIndex(function(e){return e.type===Q}),l=t.find(function(e){return e.type===ie}),s,c;t.filter(function(e){return e.type===oe}).forEach(function(e){0<=e.value.indexOf("T")&&(o=v),0<=e.value.indexOf("L")&&(o=d),0<=e.value.indexOf("I")&&(i=E),0<=e.value.indexOf("A")&&(i=y)}),u.x===u.y&&2===(null===(r=u.x)||void 0===r?void 0:r.length)&&(s=Number(u.x[0]),c=Number(u.x[1]),s&&c&&(n=[s,c]));var f=[{type:Me,position:ot(t.slice(1,a+1)),zeroSuppression:o,format:n,mode:i}];return l&&f.push({type:Ie,position:ot(t.slice(1,-1),{head:l}),units:"MM"===l.value?p:h}),f}},St={rules:[We(ee),We(ie),We(Q),We(ee)],createNodes:function e(t){return[{type:Ie,position:ot(t.slice(1,-1)),units:"MM"===t[1].value?p:h}]}},kt={rules:[We(ee),We(ue),We(Q),Ke([Ve(ee)]),We(ee)],createNodes:function e(t){var r=t[1].value,n=ot(t.slice(1,-1)),o=t.slice(3,-1);return[{type:Se,position:n,children:_t(o),name:r}]}},Dt={rules:[We(ee),We(ae),Ke([We(re),We(ve),We(de,"X")]),We(Q),We(ee)],createNodes:function e(t){var r,n=null,o=t[1].value.match(/(\d+)(.+)/),i,u=G(null!=o?o:[],3),a=u[1],l=void 0===a?"":a,s=u[2],c=void 0===s?"":s,f=t.slice(3,-2).filter(function(e){return e.type===ve}).map(function(e){return Number(e.value)}),p,h,d,r,n,v,y,E,m,g,O,R,A,w,T,b;return"C"===c?(h=(p=B(f))[0],d=p.slice(1),r={type:N,diameter:h},n=Ct(d)):"R"===c||"O"===c?(y=(v=B(f))[0],E=v[1],m=v.slice(2),r={type:"R"===c?x:_,xSize:y,ySize:E},n=Ct(m)):"P"===c?(R=(O=B(f))[0],A=O[1],T=void 0===(w=O[2])?null:w,b=O.slice(3),r={type:C,diameter:R,vertices:A,rotation:T},n=Ct(b)):r={type:I,name:c,params:f},[{type:Le,position:ot(t.slice(1,-1)),code:l,shape:r,hole:n}]}},Pt={rules:[Ye([We(Y,"54")]),We(J),We(Q)],createNodes:function e(t){var r;return[{type:ke,position:ot(t),code:null===(r=t.find(function(e){return e.type===J}))||void 0===r?void 0:r.value}]}},jt=function e(t){var r=rt(t),n=et(t),o=tt(t),i=ot(t,{head:o?t[1]:t[0]}),u=[{type:je,position:i,graphic:r,coordinates:n}],a;return o&&(a=ot(t,{head:t[0],length:2}),u.unshift({type:Ge,position:a,mode:o})),u},Gt,Bt,Ut,qt,Ht,Ft,zt,Zt,$t=[{rules:[Ye([We(Y,"1"),We(Y,"2"),We(Y,"3")]),Qe(2,8,[We(de),We(ve)]),Ye([We(J,"1"),We(J,"2"),We(J,"3")]),We(Q)],createNodes:jt},{rules:[Ye([We(Y,"1"),We(Y,"2"),We(Y,"3")]),Xe([We(J,"1"),We(J,"2"),We(J,"3")]),We(Q)],createNodes:jt},{rules:[Xe([We(Y,"1"),We(Y,"2"),We(Y,"3")]),We(Q)],createNodes:function e(t){return[{type:Ge,position:ot(t),mode:tt(t)}]}},Pt,Dt,kt,Mt,{rules:[Xe([We(Y,"36"),We(Y,"37")]),We(Q)],createNodes:function e(t){return[{type:Be,position:ot(t),region:"36"===t[0].value}]}},{rules:[Xe([We(Y,"74"),We(Y,"75")]),We(Q)],createNodes:function e(t){return[{type:Ue,position:ot(t),quadrant:"74"===t[0].value?w:T}]}},{rules:[We(ee),We(le),We(Q),We(ee)],createNodes:function e(t){return[{type:De,position:ot(t.slice(1,-1)),polarity:"D"===t[1].value?b:M}]}},{rules:[We(ee),We(se),Ke([We(de),We(ve)]),We(Q),We(ee)],createNodes:function e(t){var r=et(t),n=Object.keys(r).reduce(function(e,t){return e[t]=Number(r[t]),e},{});return[{type:Pe,position:ot(t.slice(1,-1)),stepRepeat:n}]}},Lt,St,It,{rules:[We(ee),Ke([Ve(Q)]),We(Q),We(ee)],createNodes:function e(t){return[{type:qe,position:ot(t.slice(1,-1)),value:nt(t)}]}}].map(function(e){return j({},e,{filetype:t})}),Wt=yt.apply(void 0,U($t).concat(U(pt)));function Vt(){var h=Ne(),d={type:xe,filetype:null,done:!1,children:[]},v="",y=0,E=h.save();return{lexer:h,feed:e,results:t};function e(e){var t=v,r=y,n=null,o;for(v="",h.reset("".concat(t).concat(e),E);o=h.next();){var i=j({},o,{offset:o.offset+r}),u,a,l,s,c,f,p;v+=o.text,(n=Wt(n,i)).nodes&&(c=(s=n).nodes,p=void 0===(f=s.filetype)?null:f,v="",y+=null!==(u=h.index)&&void 0!==u?u:0,E=h.save(),(a=d.children).push.apply(a,U(c)),d.filetype=null!==(l=d.filetype)&&void 0!==l?l:p,d.done=d.done||c.some(function(e){return e.type===Ce})),0===n.candidates.length&&(n=null)}}function t(){return d}}e.ABSOLUTE=y,e.ASTERISK=Q,e.CATCHALL=ge,e.CCW_ARC=A,e.CIRCLE=N,e.CLEAR=M,e.COMMA=re,e.COMMENT=_e,e.COORDINATE_FORMAT=Me,e.COORD_CHAR=de,e.CW_ARC=R,e.DARK=b,e.DONE=Ce,e.DRILL=r,e.DRILL_UNITS=pe,e.DRILL_ZERO_INCLUSION=he,e.D_CODE=J,e.EQUALS=te,e.ERROR=Oe,e.GERBER=t,e.GERBER_FORMAT=oe,e.GERBER_LOAD_POLARITY=le,e.GERBER_MACRO_VARIABLE=ce,e.GERBER_STEP_REPEAT=se,e.GERBER_TOOL_DEF=ae,e.GERBER_TOOL_MACRO=ue,e.GERBER_UNITS=ie,e.GRAPHIC=je,e.G_CODE=Y,e.IN=h,e.INCREMENTAL=E,e.INTERPOLATE_MODE=Ge,e.LEADING=d,e.LINE=O,e.LOAD_POLARITY=De,e.MACRO_CENTER_LINE=i,e.MACRO_CIRCLE=n,e.MACRO_COMMENT=He,e.MACRO_MOIRE=l,e.MACRO_OUTLINE=u,e.MACRO_POLYGON=a,e.MACRO_PRIMITIVE=ze,e.MACRO_SHAPE=I,e.MACRO_THERMAL=s,e.MACRO_VARIABLE=Fe,e.MACRO_VECTOR_LINE=o,e.MM=p,e.MOVE=f,e.MULTI=T,e.M_CODE=K,e.NEWLINE=me,e.NUMBER=ve,e.OBROUND=_,e.OPERATOR=ne,e.PERCENT=ee,e.POLYGON=C,e.QUADRANT_MODE=Ue,e.RECTANGLE=x,e.REGION_MODE=Be,e.ROOT=xe,e.SEGMENT=m,e.SEMICOLON=fe,e.SHAPE=c,e.SINGLE=w,e.SLOT=g,e.STEP_REPEAT=Pe,e.TOOL_CHANGE=ke,e.TOOL_DEFINITION=Le,e.TOOL_MACRO=Se,e.TRAILING=v,e.T_CODE=X,e.UNIMPLEMENTED=qe,e.UNITS=Ie,e.WHITESPACE=Ee,e.WORD=ye,e.createLexer=Ne,e.createParser=Vt,Object.defineProperty(e,"__esModule",{value:!0})});!function(t){var e,e;"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):(e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).JSZip=t()}(function(){var t,e,r;return function s(a,o,h){function u(r,t){if(!o[r]){if(!a[r]){var e="function"==typeof require&&require;if(!t&&e)return e(r,!0);if(l)return l(r,!0);var n=new Error("Cannot find module '"+r+"'");throw n.code="MODULE_NOT_FOUND",n}var i=o[r]={exports:{}};a[r][0].call(i.exports,function(t){var e=a[r][1][t];return u(e||t)},i,i.exports,s,a,o,h)}return o[r].exports}for(var l="function"==typeof require&&require,t=0;t<h.length;t++)u(h[t]);return u}({1:[function(t,e,r){"use strict";var c=t("./utils"),p=t("./support"),m="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";r.encode=function(t){for(var e=[],r,n,i,s,a,o,h,u=0,l=t.length,f=l,d="string"!==c.getTypeOf(t);u<t.length;)f=l-u,i=d?(r=t[u++],n=u<l?t[u++]:0,u<l?t[u++]:0):(r=t.charCodeAt(u++),n=u<l?t.charCodeAt(u++):0,u<l?t.charCodeAt(u++):0),a=(3&r)<<4|n>>4,o=1<f?(15&n)<<2|i>>6:64,h=2<f?63&i:64,e.push(m.charAt(s=r>>2)+m.charAt(a)+m.charAt(o)+m.charAt(h));return e.join("")},r.decode=function(t){var e,r,n,i,s,a,o,h=0,u=0,l="data:";if(t.substr(0,l.length)===l)throw new Error("Invalid base64 input, it looks like a data url.");var f=3*(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"")).length/4,d;if(t.charAt(t.length-1)===m.charAt(64)&&f--,t.charAt(t.length-2)===m.charAt(64)&&f--,f%1!=0)throw new Error("Invalid base64 input, bad content length.");for(d=new(p.uint8array?Uint8Array:Array)(0|f);h<t.length;)i=m.indexOf(t.charAt(h++)),r=(15&(s=m.indexOf(t.charAt(h++))))<<4|(a=m.indexOf(t.charAt(h++)))>>2,n=(3&a)<<6|(o=m.indexOf(t.charAt(h++))),d[u++]=e=i<<2|s>>4,64!==a&&(d[u++]=r),64!==o&&(d[u++]=n);return d}},{"./support":30,"./utils":32}],2:[function(t,e,r){"use strict";var n=t("./external"),i=t("./stream/DataWorker"),s=t("./stream/Crc32Probe"),a=t("./stream/DataLengthProbe");function o(t,e,r,n,i){this.compressedSize=t,this.uncompressedSize=e,this.crc32=r,this.compression=n,this.compressedContent=i}o.prototype={getContentWorker:function(){var t=new i(n.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new a("data_length")),e=this;return t.on("end",function(){if(this.streamInfo.data_length!==e.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),t},getCompressedWorker:function(){return new i(n.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},o.createWorkerFrom=function(t,e,r){return t.pipe(new s).pipe(new a("uncompressedSize")).pipe(e.compressWorker(r)).pipe(new a("compressedSize")).withStreamInfo("compression",e)},e.exports=o},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(t,e,r){"use strict";var n=t("./stream/GenericWorker");r.STORE={magic:"\0\0",compressWorker:function(t){return new n("STORE compression")},uncompressWorker:function(){return new n("STORE decompression")}},r.DEFLATE=t("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(t,e,r){"use strict";var i=t("./utils");function n(){for(var t,e=[],r=0;r<256;r++){for(var t=r,n=0;n<8;n++)t=1&t?3988292384^t>>>1:t>>>1;e[r]=t}return e}var o=n();function s(t,e,r,n){var i=o,s=n+r;t^=-1;for(var a=n;a<s;a++)t=t>>>8^i[255&(t^e[a])];return-1^t}function a(t,e,r,n){var i=o,s=n+r;t^=-1;for(var a=n;a<s;a++)t=t>>>8^i[255&(t^e.charCodeAt(a))];return-1^t}e.exports=function t(e,r){return void 0!==e&&e.length?("string"!==i.getTypeOf(e)?s:a)(0|r,e,e.length,0):0;var n}},{"./utils":32}],5:[function(t,e,r){"use strict";r.base64=!1,r.binary=!1,r.dir=!1,r.createFolders=!0,r.date=null,r.compression=null,r.compressionOptions=null,r.comment=null,r.unixPermissions=null,r.dosPermissions=null},{}],6:[function(t,e,r){"use strict";var n=null,n="undefined"!=typeof Promise?Promise:t("lie");e.exports={Promise:n}},{lie:37}],7:[function(t,e,r){"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,i=t("pako"),s=t("./utils"),a=t("./stream/GenericWorker"),o=n?"uint8array":"array";function h(t,e){a.call(this,"FlateWorker/"+t),this._pako=null,this._pakoAction=t,this._pakoOptions=e,this.meta={}}r.magic="\b\0",s.inherits(h,a),h.prototype.processChunk=function(t){this.meta=t.meta,null===this._pako&&this._createPako(),this._pako.push(s.transformTo(o,t.data),!1)},h.prototype.flush=function(){a.prototype.flush.call(this),null===this._pako&&this._createPako(),this._pako.push([],!0)},h.prototype.cleanUp=function(){a.prototype.cleanUp.call(this),this._pako=null},h.prototype._createPako=function(){this._pako=new i[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var e=this;this._pako.onData=function(t){e.push({data:t,meta:e.meta})}},r.compressWorker=function(t){return new h("Deflate",t)},r.uncompressWorker=function(){return new h("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(t,e,r){"use strict";var O=t("../utils"),i=t("../stream/GenericWorker"),B=t("../utf8"),R=t("../crc32"),T=t("../signature"),D=function(t,e){for(var r="",n,n=0;n<e;n++)r+=String.fromCharCode(255&t),t>>>=8;return r},F=function(t,e){var r;return(65535&(t?t:e?16893:33204))<<16},N=function(t,e){return 63&(t||0)},n=function(t,e,r,n,i,s){var a=t.file,o=t.compression,h=s!==B.utf8encode,u=O.transformTo("string",s(a.name)),l=O.transformTo("string",B.utf8encode(a.name)),f=a.comment,d=O.transformTo("string",s(f)),c=O.transformTo("string",B.utf8encode(f)),p=l.length!==a.name.length,m=c.length!==f.length,_,g,b="",v="",y="",w=a.dir,k=a.date,x={crc32:0,compressedSize:0,uncompressedSize:0};e&&!r||(x.crc32=t.crc32,x.compressedSize=t.compressedSize,x.uncompressedSize=t.uncompressedSize);var S=0;e&&(S|=8),h||!p&&!m||(S|=2048);var z=0,C=0;w&&(z|=16),"UNIX"===i?(C=798,z|=F(a.unixPermissions,w)):(C=20,z|=N(a.dosPermissions,w)),_=k.getUTCHours(),_<<=6,_|=k.getUTCMinutes(),_<<=5,_|=k.getUTCSeconds()/2,g=k.getUTCFullYear()-1980,g<<=4,g|=k.getUTCMonth()+1,g<<=5,g|=k.getUTCDate(),p&&(v=D(1,1)+D(R(u),4)+l,b+="up"+D(v.length,2)+v),m&&(y=D(1,1)+D(R(d),4)+c,b+="uc"+D(y.length,2)+y);var E="",A,I;return E+="\n\0",E+=D(S,2),E+=o.magic,E+=D(_,2),E+=D(g,2),E+=D(x.crc32,4),E+=D(x.compressedSize,4),E+=D(x.uncompressedSize,4),E+=D(u.length,2),E+=D(b.length,2),{fileRecord:T.LOCAL_FILE_HEADER+E+u+b,dirRecord:T.CENTRAL_FILE_HEADER+D(C,2)+E+D(d.length,2)+"\0\0\0\0"+D(z,4)+D(n,4)+u+b+d}},s=function(t,e,r,n,i){var s="",a=O.transformTo("string",i(n)),s;return T.CENTRAL_DIRECTORY_END+"\0\0\0\0"+D(t,2)+D(t,2)+D(e,4)+D(r,4)+D(a.length,2)+a},a=function(t){var e="",e;return T.DATA_DESCRIPTOR+D(t.crc32,4)+D(t.compressedSize,4)+D(t.uncompressedSize,4)};function o(t,e,r,n){i.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=e,this.zipPlatform=r,this.encodeFileName=n,this.streamFiles=t,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}O.inherits(o,i),o.prototype.push=function(t){var e=t.meta.percent||0,r=this.entriesCount,n=this._sources.length;this.accumulate?this.contentBuffer.push(t):(this.bytesWritten+=t.data.length,i.prototype.push.call(this,{data:t.data,meta:{currentFile:this.currentFile,percent:r?(e+100*(r-n-1))/r:100}}))},o.prototype.openedSource=function(t){this.currentSourceOffset=this.bytesWritten,this.currentFile=t.file.name;var e=this.streamFiles&&!t.file.dir,r;e?(r=n(t,e,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName),this.push({data:r.fileRecord,meta:{percent:0}})):this.accumulate=!0},o.prototype.closedSource=function(t){this.accumulate=!1;var e=this.streamFiles&&!t.file.dir,r=n(t,e,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(r.dirRecord),e)this.push({data:a(t),meta:{percent:100}});else for(this.push({data:r.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},o.prototype.flush=function(){for(var t=this.bytesWritten,e=0;e<this.dirRecords.length;e++)this.push({data:this.dirRecords[e],meta:{percent:100}});var r=this.bytesWritten-t,n=s(this.dirRecords.length,r,t,this.zipComment,this.encodeFileName);this.push({data:n,meta:{percent:100}})},o.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},o.prototype.registerPrevious=function(t){this._sources.push(t);var e=this;return t.on("data",function(t){e.processChunk(t)}),t.on("end",function(){e.closedSource(e.previous.streamInfo),e._sources.length?e.prepareNextSource():e.end()}),t.on("error",function(t){e.error(t)}),this},o.prototype.resume=function(){return!!i.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},o.prototype.error=function(t){var e=this._sources;if(!i.prototype.error.call(this,t))return!1;for(var r=0;r<e.length;r++)try{e[r].error(t)}catch(t){}return!0},o.prototype.lock=function(){i.prototype.lock.call(this);for(var t=this._sources,e=0;e<t.length;e++)t[e].lock()},e.exports=o},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(t,e,r){"use strict";var i=t("../compressions"),n=t("./ZipFileWorker"),u=function(t,e){var r=t||e,n=i[r];if(!n)throw new Error(r+" is not a valid compression method !");return n};r.generateWorker=function(t,a,e){var o=new n(a.streamFiles,e,a.platform,a.encodeFileName),h=0;try{t.forEach(function(t,e){h++;var r=u(e.options.compression,a.compression),n=e.options.compressionOptions||a.compressionOptions||{},i=e.dir,s=e.date;e._compressWorker(r,n).withStreamInfo("file",{name:t,dir:i,date:s,comment:e.comment||"",unixPermissions:e.unixPermissions,dosPermissions:e.dosPermissions}).pipe(o)}),o.entriesCount=h}catch(t){o.error(t)}return o}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(t,e,r){"use strict";function n(){if(!(this instanceof n))return new n;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var t=new n,e;for(e in this)"function"!=typeof this[e]&&(t[e]=this[e]);return t}}(n.prototype=t("./object")).loadAsync=t("./load"),n.support=t("./support"),n.defaults=t("./defaults"),n.version="3.7.1",n.loadAsync=function(t,e){return(new n).loadAsync(t,e)},n.external=t("./external"),e.exports=n},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(t,e,r){"use strict";var n=t("./utils"),s=t("./external"),i=t("./utf8"),h=t("./zipEntries"),a=t("./stream/Crc32Probe"),u=t("./nodejsUtils");function l(n){return new s.Promise(function(t,e){var r=n.decompressed.getContentWorker().pipe(new a);r.on("error",function(t){e(t)}).on("end",function(){r.streamInfo.crc32!==n.decompressed.crc32?e(new Error("Corrupted zip : CRC32 mismatch")):t()}).resume()})}e.exports=function(t,a){var o=this;return a=n.extend(a||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:i.utf8decode}),u.isNode&&u.isStream(t)?s.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):n.prepareContent("the loaded zip file",t,!0,a.optimizedBinaryString,a.base64).then(function(t){var e=new h(a);return e.load(t),e}).then(function t(e){var r=[s.Promise.resolve(e)],n=e.files;if(a.checkCRC32)for(var i=0;i<n.length;i++)r.push(l(n[i]));return s.Promise.all(r)}).then(function t(e){for(var r=e.shift(),n=r.files,i=0;i<n.length;i++){var s=n[i];o.file(s.fileNameStr,s.decompressed,{binary:!0,optimizedBinaryString:!0,date:s.date,dir:s.dir,comment:s.fileCommentStr.length?s.fileCommentStr:null,unixPermissions:s.unixPermissions,dosPermissions:s.dosPermissions,createFolders:a.createFolders})}return r.zipComment.length&&(o.comment=r.zipComment),o})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(t,e,r){"use strict";var n=t("../utils"),i=t("../stream/GenericWorker");function s(t,e){i.call(this,"Nodejs stream input adapter for "+t),this._upstreamEnded=!1,this._bindStream(e)}n.inherits(s,i),s.prototype._bindStream=function(t){var e=this;(this._stream=t).pause(),t.on("data",function(t){e.push({data:t,meta:{percent:0}})}).on("error",function(t){e.isPaused?this.generatedError=t:e.error(t)}).on("end",function(){e.isPaused?e._upstreamEnded=!0:e.end()})},s.prototype.pause=function(){return!!i.prototype.pause.call(this)&&(this._stream.pause(),!0)},s.prototype.resume=function(){return!!i.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},e.exports=s},{"../stream/GenericWorker":28,"../utils":32}],13:[function(t,e,r){"use strict";var i=t("readable-stream").Readable,n;function s(t,e,r){i.call(this,e),this._helper=t;var n=this;t.on("data",function(t,e){n.push(t)||n._helper.pause(),r&&r(e)}).on("error",function(t){n.emit("error",t)}).on("end",function(){n.push(null)})}t("../utils").inherits(s,i),s.prototype._read=function(){this._helper.resume()},e.exports=s},{"../utils":32,"readable-stream":16}],14:[function(t,e,r){"use strict";e.exports={isNode:"undefined"!=typeof Buffer,newBufferFrom:function(t,e){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(t,e);if("number"==typeof t)throw new Error('The "data" argument must not be a number');return new Buffer(t,e)},allocBuffer:function(t){if(Buffer.alloc)return Buffer.alloc(t);var e=new Buffer(t);return e.fill(0),e},isBuffer:function(t){return Buffer.isBuffer(t)},isStream:function(t){return t&&"function"==typeof t.on&&"function"==typeof t.pause&&"function"==typeof t.resume}}},{}],15:[function(t,e,r){"use strict";var i=t("./utf8"),l=t("./utils"),f=t("./stream/GenericWorker"),s=t("./stream/StreamHelper"),d=t("./defaults"),c=t("./compressedObject"),p=t("./zipObject"),a=t("./generate"),m=t("./nodejsUtils"),_=t("./nodejs/NodejsStreamInputAdapter"),o=function(t,e,r){var n=l.getTypeOf(e),i,s=l.extend(r||{},d);s.date=s.date||new Date,null!==s.compression&&(s.compression=s.compression.toUpperCase()),"string"==typeof s.unixPermissions&&(s.unixPermissions=parseInt(s.unixPermissions,8)),s.unixPermissions&&16384&s.unixPermissions&&(s.dir=!0),s.dosPermissions&&16&s.dosPermissions&&(s.dir=!0),s.dir&&(t=b(t)),s.createFolders&&(i=g(t))&&v.call(this,i,!0);var a="string"===n&&!1===s.binary&&!1===s.base64,o;r&&void 0!==r.binary||(s.binary=!a),(e instanceof c&&0===e.uncompressedSize||s.dir||!e||0===e.length)&&(s.base64=!1,s.binary=!0,e="",s.compression="STORE");var h=null,h=e instanceof c||e instanceof f?e:m.isNode&&m.isStream(e)?new _(t,e):l.prepareContent(t,e,s.binary,s.optimizedBinaryString,s.base64),u=new p(t,h,s);this.files[t]=u},g=function(t){var e=(t="/"===t.slice(-1)?t.substring(0,t.length-1):t).lastIndexOf("/");return 0<e?t.substring(0,e):""},b=function(t){return"/"!==t.slice(-1)&&(t+="/"),t},v=function(t,e){return e=void 0!==e?e:d.createFolders,t=b(t),this.files[t]||o.call(this,t,null,{dir:!0,createFolders:e}),this.files[t]},n;function h(t){return"[object RegExp]"===Object.prototype.toString.call(t)}e.exports={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(t){var e,r,n;for(e in this.files)n=this.files[e],(r=e.slice(this.root.length,e.length))&&e.slice(0,this.root.length)===this.root&&t(r,n)},filter:function(r){var n=[];return this.forEach(function(t,e){r(t,e)&&n.push(e)}),n},file:function(t,e,r){if(1!==arguments.length)return t=this.root+t,o.call(this,t,e,r),this;if(h(t)){var n=t;return this.filter(function(t,e){return!e.dir&&n.test(t)})}var i=this.files[this.root+t];return i&&!i.dir?i:null},folder:function(r){if(!r)return this;if(h(r))return this.filter(function(t,e){return e.dir&&r.test(t)});var t=this.root+r,e=v.call(this,t),n=this.clone();return n.root=e.name,n},remove:function(r){r=this.root+r;var t=this.files[r];if(t||("/"!==r.slice(-1)&&(r+="/"),t=this.files[r]),t&&!t.dir)delete this.files[r];else for(var e=this.filter(function(t,e){return e.name.slice(0,r.length)===r}),n=0;n<e.length;n++)delete this.files[e[n].name];return this},generate:function(t){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(t){var e,r={};try{if((r=l.extend(t||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:i.utf8encode})).type=r.type.toLowerCase(),r.compression=r.compression.toUpperCase(),"binarystring"===r.type&&(r.type="string"),!r.type)throw new Error("No output type specified.");l.checkSupport(r.type),"darwin"!==r.platform&&"freebsd"!==r.platform&&"linux"!==r.platform&&"sunos"!==r.platform||(r.platform="UNIX"),"win32"===r.platform&&(r.platform="DOS");var n=r.comment||this.comment||"",e=a.generateWorker(this,r,n)}catch(t){(e=new f("error")).error(t)}return new s(e,r.type||"string",r.mimeType)},generateAsync:function(t,e){return this.generateInternalStream(t).accumulate(e)},generateNodeStream:function(t,e){return(t=t||{}).type||(t.type="nodebuffer"),this.generateInternalStream(t).toNodejsStream(e)}}},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(t,e,r){e.exports=t("stream")},{stream:void 0}],17:[function(t,e,r){"use strict";var n=t("./DataReader"),i;function s(t){n.call(this,t);for(var e=0;e<this.data.length;e++)t[e]=255&t[e]}t("../utils").inherits(s,n),s.prototype.byteAt=function(t){return this.data[this.zero+t]},s.prototype.lastIndexOfSignature=function(t){for(var e=t.charCodeAt(0),r=t.charCodeAt(1),n=t.charCodeAt(2),i=t.charCodeAt(3),s=this.length-4;0<=s;--s)if(this.data[s]===e&&this.data[s+1]===r&&this.data[s+2]===n&&this.data[s+3]===i)return s-this.zero;return-1},s.prototype.readAndCheckSignature=function(t){var e=t.charCodeAt(0),r=t.charCodeAt(1),n=t.charCodeAt(2),i=t.charCodeAt(3),s=this.readData(4);return e===s[0]&&r===s[1]&&n===s[2]&&i===s[3]},s.prototype.readData=function(t){if(this.checkOffset(t),0===t)return[];var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=s},{"../utils":32,"./DataReader":18}],18:[function(t,e,r){"use strict";var n=t("../utils");function i(t){this.data=t,this.length=t.length,this.index=0,this.zero=0}i.prototype={checkOffset:function(t){this.checkIndex(this.index+t)},checkIndex:function(t){if(this.length<this.zero+t||t<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+t+"). Corrupted zip ?")},setIndex:function(t){this.checkIndex(t),this.index=t},skip:function(t){this.setIndex(this.index+t)},byteAt:function(t){},readInt:function(t){var e=0,r;for(this.checkOffset(t),r=this.index+t-1;r>=this.index;r--)e=(e<<8)+this.byteAt(r);return this.index+=t,e},readString:function(t){return n.transformTo("string",this.readData(t))},readData:function(t){},lastIndexOfSignature:function(t){},readAndCheckSignature:function(t){},readDate:function(){var t=this.readInt(4);return new Date(Date.UTC(1980+(t>>25&127),(t>>21&15)-1,t>>16&31,t>>11&31,t>>5&63,(31&t)<<1))}},e.exports=i},{"../utils":32}],19:[function(t,e,r){"use strict";var n=t("./Uint8ArrayReader"),i;function s(t){n.call(this,t)}t("../utils").inherits(s,n),s.prototype.readData=function(t){this.checkOffset(t);var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=s},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(t,e,r){"use strict";var n=t("./DataReader"),i;function s(t){n.call(this,t)}t("../utils").inherits(s,n),s.prototype.byteAt=function(t){return this.data.charCodeAt(this.zero+t)},s.prototype.lastIndexOfSignature=function(t){return this.data.lastIndexOf(t)-this.zero},s.prototype.readAndCheckSignature=function(t){var e;return t===this.readData(4)},s.prototype.readData=function(t){this.checkOffset(t);var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=s},{"../utils":32,"./DataReader":18}],21:[function(t,e,r){"use strict";var n=t("./ArrayReader"),i;function s(t){n.call(this,t)}t("../utils").inherits(s,n),s.prototype.readData=function(t){if(this.checkOffset(t),0===t)return new Uint8Array(0);var e=this.data.subarray(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=s},{"../utils":32,"./ArrayReader":17}],22:[function(t,e,r){"use strict";var n=t("../utils"),i=t("../support"),s=t("./ArrayReader"),a=t("./StringReader"),o=t("./NodeBufferReader"),h=t("./Uint8ArrayReader");e.exports=function(t){var e=n.getTypeOf(t);return n.checkSupport(e),"string"!==e||i.uint8array?"nodebuffer"===e?new o(t):i.uint8array?new h(n.transformTo("uint8array",t)):new s(n.transformTo("array",t)):new a(t)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(t,e,r){"use strict";r.LOCAL_FILE_HEADER="PK",r.CENTRAL_FILE_HEADER="PK",r.CENTRAL_DIRECTORY_END="PK",r.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",r.ZIP64_CENTRAL_DIRECTORY_END="PK",r.DATA_DESCRIPTOR="PK\b"},{}],24:[function(t,e,r){"use strict";var n=t("./GenericWorker"),i=t("../utils");function s(t){n.call(this,"ConvertWorker to "+t),this.destType=t}i.inherits(s,n),s.prototype.processChunk=function(t){this.push({data:i.transformTo(this.destType,t.data),meta:t.meta})},e.exports=s},{"../utils":32,"./GenericWorker":28}],25:[function(t,e,r){"use strict";var n=t("./GenericWorker"),i=t("../crc32"),s;function a(){n.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}t("../utils").inherits(a,n),a.prototype.processChunk=function(t){this.streamInfo.crc32=i(t.data,this.streamInfo.crc32||0),this.push(t)},e.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(t,e,r){"use strict";var n=t("../utils"),i=t("./GenericWorker");function s(t){i.call(this,"DataLengthProbe for "+t),this.propName=t,this.withStreamInfo(t,0)}n.inherits(s,i),s.prototype.processChunk=function(t){var e;t&&(e=this.streamInfo[this.propName]||0,this.streamInfo[this.propName]=e+t.data.length),i.prototype.processChunk.call(this,t)},e.exports=s},{"../utils":32,"./GenericWorker":28}],27:[function(t,e,r){"use strict";var n=t("../utils"),i=t("./GenericWorker"),s=16384;function a(t){i.call(this,"DataWorker");var e=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,t.then(function(t){e.dataIsReady=!0,e.data=t,e.max=t&&t.length||0,e.type=n.getTypeOf(t),e.isPaused||e._tickAndRepeat()},function(t){e.error(t)})}n.inherits(a,i),a.prototype.cleanUp=function(){i.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!i.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,n.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(n.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var t,e=null,r=Math.min(this.max,this.index+s);if(this.index>=this.max)return this.end();switch(this.type){case"string":e=this.data.substring(this.index,r);break;case"uint8array":e=this.data.subarray(this.index,r);break;case"array":case"nodebuffer":e=this.data.slice(this.index,r)}return this.index=r,this.push({data:e,meta:{percent:this.max?this.index/this.max*100:0}})},e.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(t,e,r){"use strict";function n(t){this.name=t||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}n.prototype={push:function(t){this.emit("data",t)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(t){this.emit("error",t)}return!0},error:function(t){return!this.isFinished&&(this.isPaused?this.generatedError=t:(this.isFinished=!0,this.emit("error",t),this.previous&&this.previous.error(t),this.cleanUp()),!0)},on:function(t,e){return this._listeners[t].push(e),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(t,e){if(this._listeners[t])for(var r=0;r<this._listeners[t].length;r++)this._listeners[t][r].call(this,e)},pipe:function(t){return t.registerPrevious(this)},registerPrevious:function(t){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=t.streamInfo,this.mergeStreamInfo(),this.previous=t;var e=this;return t.on("data",function(t){e.processChunk(t)}),t.on("end",function(){e.end()}),t.on("error",function(t){e.error(t)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var t=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),t=!0),this.previous&&this.previous.resume(),!t},flush:function(){},processChunk:function(t){this.push(t)},withStreamInfo:function(t,e){return this.extraStreamInfo[t]=e,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var t in this.extraStreamInfo)this.extraStreamInfo.hasOwnProperty(t)&&(this.streamInfo[t]=this.extraStreamInfo[t])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var t="Worker "+this.name;return this.previous?this.previous+" -> "+t:t}},e.exports=n},{}],29:[function(t,e,r){"use strict";var i=t("../utils"),s=t("./ConvertWorker"),a=t("./GenericWorker"),n=t("../base64"),o=t("../support"),h=t("../external"),u=null;if(o.nodestream)try{u=t("../nodejs/NodejsStreamOutputAdapter")}catch(t){}function l(t,e,r){switch(t){case"blob":return i.newBlob(i.transformTo("arraybuffer",e),r);case"base64":return n.encode(e);default:return i.transformTo(t,e)}}function f(t,e){for(var r,n=0,i=null,s=0,r=0;r<e.length;r++)s+=e[r].length;switch(t){case"string":return e.join("");case"array":return Array.prototype.concat.apply([],e);case"uint8array":for(i=new Uint8Array(s),r=0;r<e.length;r++)i.set(e[r],n),n+=e[r].length;return i;case"nodebuffer":return Buffer.concat(e);default:throw new Error("concat : unsupported type '"+t+"'")}}function d(t,o){return new h.Promise(function(e,r){var n=[],i=t._internalType,s=t._outputType,a=t._mimeType;t.on("data",function(t,e){n.push(t),o&&o(e)}).on("error",function(t){n=[],r(t)}).on("end",function(){try{var t=l(s,f(i,n),a);e(t)}catch(t){r(t)}n=[]}).resume()})}function c(t,e,r){var n=e;switch(e){case"blob":case"arraybuffer":n="uint8array";break;case"base64":n="string"}try{this._internalType=n,this._outputType=e,this._mimeType=r,i.checkSupport(n),this._worker=t.pipe(new s(n)),t.lock()}catch(t){this._worker=new a("error"),this._worker.error(t)}}c.prototype={accumulate:function(t){return d(this,t)},on:function(t,e){var r=this;return"data"===t?this._worker.on(t,function(t){e.call(r,t.data,t.meta)}):this._worker.on(t,function(){i.delay(e,arguments,r)}),this},resume:function(){return i.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(t){if(i.checkSupport("nodestream"),"nodebuffer"!==this._outputType)throw new Error(this._outputType+" is not supported by this method");return new u(this,{objectMode:"nodebuffer"!==this._outputType},t)}},e.exports=c},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(t,e,r){"use strict";if(r.base64=!0,r.array=!0,r.string=!0,r.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,r.nodebuffer="undefined"!=typeof Buffer,r.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)r.blob=!1;else{var n=new ArrayBuffer(0);try{r.blob=0===new Blob([n],{type:"application/zip"}).size}catch(t){try{var i,s=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);s.append(n),r.blob=0===s.getBlob("application/zip").size}catch(t){r.blob=!1}}}try{r.nodestream=!!t("readable-stream").Readable}catch(t){r.nodestream=!1}},{"readable-stream":16}],31:[function(t,e,s){"use strict";for(var h=t("./utils"),u=t("./support"),r=t("./nodejsUtils"),n=t("./stream/GenericWorker"),l=new Array(256),i=0;i<256;i++)l[i]=252<=i?6:248<=i?5:240<=i?4:224<=i?3:192<=i?2:1;l[254]=l[254]=1;var a=function(t){for(var e,r,n,i,s,a=t.length,o=0,i=0;i<a;i++)55296==(64512&(r=t.charCodeAt(i)))&&i+1<a&&56320==(64512&(n=t.charCodeAt(i+1)))&&(r=65536+(r-55296<<10)+(n-56320),i++),o+=r<128?1:r<2048?2:r<65536?3:4;for(e=new(u.uint8array?Uint8Array:Array)(o),i=s=0;s<o;i++)55296==(64512&(r=t.charCodeAt(i)))&&i+1<a&&56320==(64512&(n=t.charCodeAt(i+1)))&&(r=65536+(r-55296<<10)+(n-56320),i++),r<128?e[s++]=r:(r<2048?e[s++]=192|r>>>6:(r<65536?e[s++]=224|r>>>12:(e[s++]=240|r>>>18,e[s++]=128|r>>>12&63),e[s++]=128|r>>>6&63),e[s++]=128|63&r);return e},o=function(t,e){for(var r,r=(e=(e=e||t.length)>t.length?t.length:e)-1;0<=r&&128==(192&t[r]);)r--;return!(r<0)&&0!==r&&r+l[t[r]]>e?r:e},f=function(t){for(var e,r,n,i,s,a=t.length,o=new Array(2*a),n=0,r=0;r<a;)if((i=t[r++])<128)o[n++]=i;else if(4<(s=l[i]))o[n++]=65533,r+=s-1;else{for(i&=2===s?31:3===s?15:7;1<s&&r<a;)i=i<<6|63&t[r++],s--;1<s?o[n++]=65533:i<65536?o[n++]=i:(i-=65536,o[n++]=55296|i>>10&1023,o[n++]=56320|1023&i)}return o.length!==n&&(o.subarray?o=o.subarray(0,n):o.length=n),h.applyFromCharCode(o)};function d(){n.call(this,"utf-8 decode"),this.leftOver=null}function c(){n.call(this,"utf-8 encode")}s.utf8encode=function t(e){return u.nodebuffer?r.newBufferFrom(e,"utf-8"):a(e)},s.utf8decode=function t(e){return u.nodebuffer?h.transformTo("nodebuffer",e).toString("utf-8"):(e=h.transformTo(u.uint8array?"uint8array":"array",e),f(e))},h.inherits(d,n),d.prototype.processChunk=function(t){var e=h.transformTo(u.uint8array?"uint8array":"array",t.data),r,e;this.leftOver&&this.leftOver.length&&(u.uint8array?(r=e,(e=new Uint8Array(r.length+this.leftOver.length)).set(this.leftOver,0),e.set(r,this.leftOver.length)):e=this.leftOver.concat(e),this.leftOver=null);var n=o(e),i=e;n!==e.length&&(u.uint8array?(i=e.subarray(0,n),this.leftOver=e.subarray(n,e.length)):(i=e.slice(0,n),this.leftOver=e.slice(n,e.length))),this.push({data:s.utf8decode(i),meta:t.meta})},d.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:s.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},s.Utf8DecodeWorker=d,h.inherits(c,n),c.prototype.processChunk=function(t){this.push({data:s.utf8encode(t.data),meta:t.meta})},s.Utf8EncodeWorker=c},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(t,e,a){"use strict";var o=t("./support"),h=t("./base64"),r=t("./nodejsUtils"),n=t("set-immediate-shim"),u=t("./external");function l(t){var e=null,e;return s(t,e=new(o.uint8array?Uint8Array:Array)(t.length))}function i(t){return t}function s(t,e){for(var r=0;r<t.length;++r)e[r]=255&t.charCodeAt(r);return e}a.newBlob=function(e,r){a.checkSupport("blob");try{return new Blob([e],{type:r})}catch(t){try{var n,i=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return i.append(e),i.getBlob(r)}catch(t){throw new Error("Bug : can't construct the Blob.")}}};var f={stringifyByChunk:function(t,e,r){var n=[],i=0,s=t.length;if(s<=r)return String.fromCharCode.apply(null,t);for(;i<s;)"array"===e||"nodebuffer"===e?n.push(String.fromCharCode.apply(null,t.slice(i,Math.min(i+r,s)))):n.push(String.fromCharCode.apply(null,t.subarray(i,Math.min(i+r,s)))),i+=r;return n.join("")},stringifyByChar:function(t){for(var e="",r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},applyCanBeUsed:{uint8array:function(){try{return o.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch(t){return!1}}(),nodebuffer:function(){try{return o.nodebuffer&&1===String.fromCharCode.apply(null,r.allocBuffer(1)).length}catch(t){return!1}}()}};function d(t){var e=65536,r=a.getTypeOf(t),n=!0;if("uint8array"===r?n=f.applyCanBeUsed.uint8array:"nodebuffer"===r&&(n=f.applyCanBeUsed.nodebuffer),n)for(;1<e;)try{return f.stringifyByChunk(t,r,e)}catch(t){e=Math.floor(e/2)}return f.stringifyByChar(t)}function c(t,e){for(var r=0;r<t.length;r++)e[r]=t[r];return e}a.applyFromCharCode=d;var p={};p.string={string:i,array:function(t){return s(t,new Array(t.length))},arraybuffer:function(t){return p.string.uint8array(t).buffer},uint8array:function(t){return s(t,new Uint8Array(t.length))},nodebuffer:function(t){return s(t,r.allocBuffer(t.length))}},p.array={string:d,array:i,arraybuffer:function(t){return new Uint8Array(t).buffer},uint8array:function(t){return new Uint8Array(t)},nodebuffer:function(t){return r.newBufferFrom(t)}},p.arraybuffer={string:function(t){return d(new Uint8Array(t))},array:function(t){return c(new Uint8Array(t),new Array(t.byteLength))},arraybuffer:i,uint8array:function(t){return new Uint8Array(t)},nodebuffer:function(t){return r.newBufferFrom(new Uint8Array(t))}},p.uint8array={string:d,array:function(t){return c(t,new Array(t.length))},arraybuffer:function(t){return t.buffer},uint8array:i,nodebuffer:function(t){return r.newBufferFrom(t)}},p.nodebuffer={string:d,array:function(t){return c(t,new Array(t.length))},arraybuffer:function(t){return p.nodebuffer.uint8array(t).buffer},uint8array:function(t){return c(t,new Uint8Array(t.length))},nodebuffer:i},a.transformTo=function(t,e){if(e=e||"",!t)return e;a.checkSupport(t);var r=a.getTypeOf(e),n;return p[r][t](e)},a.getTypeOf=function(t){return"string"==typeof t?"string":"[object Array]"===Object.prototype.toString.call(t)?"array":o.nodebuffer&&r.isBuffer(t)?"nodebuffer":o.uint8array&&t instanceof Uint8Array?"uint8array":o.arraybuffer&&t instanceof ArrayBuffer?"arraybuffer":void 0},a.checkSupport=function(t){var e;if(!o[t.toLowerCase()])throw new Error(t+" is not supported by this platform")},a.MAX_VALUE_16BITS=65535,a.MAX_VALUE_32BITS=-1,a.pretty=function(t){for(var e="",r,n,n=0;n<(t||"").length;n++)e+="\\x"+((r=t.charCodeAt(n))<16?"0":"")+r.toString(16).toUpperCase();return e},a.delay=function(t,e,r){n(function(){t.apply(r||null,e||[])})},a.inherits=function(t,e){var r=function(){};r.prototype=e.prototype,t.prototype=new r},a.extend=function(){for(var t={},e,r,e=0;e<arguments.length;e++)for(r in arguments[e])arguments[e].hasOwnProperty(r)&&void 0===t[r]&&(t[r]=arguments[e][r]);return t},a.prepareContent=function(r,t,n,i,s){var e;return u.Promise.resolve(t).then(function(n){var t;return o.blob&&(n instanceof Blob||-1!==["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(n)))&&"undefined"!=typeof FileReader?new u.Promise(function(e,r){var t=new FileReader;t.onload=function(t){e(t.target.result)},t.onerror=function(t){r(t.target.error)},t.readAsArrayBuffer(n)}):n}).then(function(t){var e=a.getTypeOf(t);return e?("arraybuffer"===e?t=a.transformTo("uint8array",t):"string"===e&&(s?t=h.decode(t):n&&!0!==i&&(t=l(t))),t):u.Promise.reject(new Error("Can't read the data of '"+r+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,"set-immediate-shim":54}],33:[function(t,e,r){"use strict";var n=t("./reader/readerFor"),s=t("./utils"),a=t("./signature"),i=t("./zipEntry"),o=t("./utf8"),h=t("./support");function u(t){this.files=[],this.loadOptions=t}u.prototype={checkSignature:function(t){if(!this.reader.readAndCheckSignature(t)){this.reader.index-=4;var e=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+s.pretty(e)+", expected "+s.pretty(t)+")")}},isSignature:function(t,e){var r=this.reader.index;this.reader.setIndex(t);var n,i=this.reader.readString(4)===e;return this.reader.setIndex(r),i},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var t=this.reader.readData(this.zipCommentLength),e=h.uint8array?"uint8array":"array",r=s.transformTo(e,t);this.zipComment=this.loadOptions.decodeFileName(r)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var t=this.zip64EndOfCentralSize-44,e=0,r,n,i;0<t;)r=this.reader.readInt(2),n=this.reader.readInt(4),i=this.reader.readData(n),this.zip64ExtensibleData[r]={id:r,length:n,value:i}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){for(var t,e,t=0;t<this.files.length;t++)e=this.files[t],this.reader.setIndex(e.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),e.readLocalPart(this.reader),e.handleUTF8(),e.processAttributes()},readCentralDir:function(){var t;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(t=new i({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(t);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var t=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END),e;if(t<0)throw!this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html"):new Error("Corrupted zip: can't find end of central directory");this.reader.setIndex(t);var r=t;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===s.MAX_VALUE_16BITS||this.diskWithCentralDirStart===s.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===s.MAX_VALUE_16BITS||this.centralDirRecords===s.MAX_VALUE_16BITS||this.centralDirSize===s.MAX_VALUE_32BITS||this.centralDirOffset===s.MAX_VALUE_32BITS){if(this.zip64=!0,(t=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(t),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var n=this.centralDirOffset+this.centralDirSize;this.zip64&&(n+=20,n+=12+this.zip64EndOfCentralSize);var i=r-n;if(0<i)this.isSignature(r,a.CENTRAL_FILE_HEADER)||(this.reader.zero=i);else if(i<0)throw new Error("Corrupted zip: missing "+Math.abs(i)+" bytes.")},prepareReader:function(t){this.reader=n(t)},load:function(t){this.prepareReader(t),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},e.exports=u},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utf8":31,"./utils":32,"./zipEntry":34}],34:[function(t,e,r){"use strict";var n=t("./reader/readerFor"),s=t("./utils"),i=t("./compressedObject"),a=t("./crc32"),o=t("./utf8"),h=t("./compressions"),u=t("./support"),l=0,f=3,d=function(t){for(var e in h)if(h.hasOwnProperty(e)&&h[e].magic===t)return h[e];return null};function c(t,e){this.options=t,this.loadOptions=e}c.prototype={isEncrypted:function(){return 1==(1&this.bitFlag)},useUTF8:function(){return 2048==(2048&this.bitFlag)},readLocalPart:function(t){var e,r;if(t.skip(22),this.fileNameLength=t.readInt(2),r=t.readInt(2),this.fileName=t.readData(this.fileNameLength),t.skip(r),-1===this.compressedSize||-1===this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(null===(e=d(this.compressionMethod)))throw new Error("Corrupted zip : compression "+s.pretty(this.compressionMethod)+" unknown (inner file : "+s.transformTo("string",this.fileName)+")");this.decompressed=new i(this.compressedSize,this.uncompressedSize,this.crc32,e,t.readData(this.compressedSize))},readCentralPart:function(t){this.versionMadeBy=t.readInt(2),t.skip(2),this.bitFlag=t.readInt(2),this.compressionMethod=t.readString(2),this.date=t.readDate(),this.crc32=t.readInt(4),this.compressedSize=t.readInt(4),this.uncompressedSize=t.readInt(4);var e=t.readInt(2);if(this.extraFieldsLength=t.readInt(2),this.fileCommentLength=t.readInt(2),this.diskNumberStart=t.readInt(2),this.internalFileAttributes=t.readInt(2),this.externalFileAttributes=t.readInt(4),this.localHeaderOffset=t.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");t.skip(e),this.readExtraFields(t),this.parseZIP64ExtraField(t),this.fileComment=t.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var t=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),0==t&&(this.dosPermissions=63&this.externalFileAttributes),3==t&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(t){var e;this.extraFields[1]&&(e=n(this.extraFields[1].value),this.uncompressedSize===s.MAX_VALUE_32BITS&&(this.uncompressedSize=e.readInt(8)),this.compressedSize===s.MAX_VALUE_32BITS&&(this.compressedSize=e.readInt(8)),this.localHeaderOffset===s.MAX_VALUE_32BITS&&(this.localHeaderOffset=e.readInt(8)),this.diskNumberStart===s.MAX_VALUE_32BITS&&(this.diskNumberStart=e.readInt(4)))},readExtraFields:function(t){var e=t.index+this.extraFieldsLength,r,n,i;for(this.extraFields||(this.extraFields={});t.index+4<e;)r=t.readInt(2),n=t.readInt(2),i=t.readData(n),this.extraFields[r]={id:r,length:n,value:i};t.setIndex(e)},handleUTF8:function(){var t=u.uint8array?"uint8array":"array",e,r,n,i;this.useUTF8()?(this.fileNameStr=o.utf8decode(this.fileName),this.fileCommentStr=o.utf8decode(this.fileComment)):(null!==(e=this.findExtraFieldUnicodePath())?this.fileNameStr=e:(r=s.transformTo(t,this.fileName),this.fileNameStr=this.loadOptions.decodeFileName(r)),null!==(n=this.findExtraFieldUnicodeComment())?this.fileCommentStr=n:(i=s.transformTo(t,this.fileComment),this.fileCommentStr=this.loadOptions.decodeFileName(i)))},findExtraFieldUnicodePath:function(){var t=this.extraFields[28789];if(t){var e=n(t.value);return 1!==e.readInt(1)?null:a(this.fileName)!==e.readInt(4)?null:o.utf8decode(e.readData(t.length-5))}return null},findExtraFieldUnicodeComment:function(){var t=this.extraFields[25461];if(t){var e=n(t.value);return 1!==e.readInt(1)?null:a(this.fileComment)!==e.readInt(4)?null:o.utf8decode(e.readData(t.length-5))}return null}},e.exports=c},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(t,e,r){"use strict";var s=t("./stream/StreamHelper"),n=t("./stream/DataWorker"),a=t("./utf8"),i=t("./compressedObject"),o=t("./stream/GenericWorker"),h=function(t,e,r){this.name=t,this.dir=r.dir,this.date=r.date,this.comment=r.comment,this.unixPermissions=r.unixPermissions,this.dosPermissions=r.dosPermissions,this._data=e,this._dataBinary=r.binary,this.options={compression:r.compression,compressionOptions:r.compressionOptions}};h.prototype={internalStream:function(t){var e=null,r="string";try{if(!t)throw new Error("No output type specified.");var r,n="string"===(r=t.toLowerCase())||"text"===r;"binarystring"!==r&&"text"!==r||(r="string");var e=this._decompressWorker(),i=!this._dataBinary;i&&!n&&(e=e.pipe(new a.Utf8EncodeWorker)),!i&&n&&(e=e.pipe(new a.Utf8DecodeWorker))}catch(t){(e=new o("error")).error(t)}return new s(e,r,"")},async:function(t,e){return this.internalStream(t).accumulate(e)},nodeStream:function(t,e){return this.internalStream(t||"nodebuffer").toNodejsStream(e)},_compressWorker:function(t,e){if(this._data instanceof i&&this._data.compression.magic===t.magic)return this._data.getCompressedWorker();var r=this._decompressWorker();return this._dataBinary||(r=r.pipe(new a.Utf8EncodeWorker)),i.createWorkerFrom(r,t,e)},_decompressWorker:function(){return this._data instanceof i?this._data.getContentWorker():this._data instanceof o?this._data:new n(this._data)}};for(var u=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],l=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},f=0;f<u.length;f++)h.prototype[u[f]]=l;e.exports=h},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(t,f,e){!function(e){"use strict";var t=e.MutationObserver||e.WebKitMutationObserver,r,n,i,s,a,r=t?(n=0,i=new t(u),s=e.document.createTextNode(""),i.observe(s,{characterData:!0}),function(){s.data=n=++n%2}):e.setImmediate||void 0===e.MessageChannel?"document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){u(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(u,0)}:((a=new e.MessageChannel).port1.onmessage=u,function(){a.port2.postMessage(0)}),o,h=[];function u(){var t,e;o=!0;for(var r=h.length;r;){for(e=h,h=[],t=-1;++t<r;)e[t]();r=h.length}o=!1}function l(t){1!==h.push(t)||o||r()}f.exports=l}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],37:[function(t,e,r){"use strict";var i=t("immediate");function u(){}var l={},s=["REJECTED"],a=["FULFILLED"],o=["PENDING"];function n(t){if("function"!=typeof t)throw new TypeError("resolver must be a function");this.state=o,this.queue=[],this.outcome=void 0,t!==u&&c(this,t)}function h(t,e,r){this.promise=t,"function"==typeof e&&(this.onFulfilled=e,this.callFulfilled=this.otherCallFulfilled),"function"==typeof r&&(this.onRejected=r,this.callRejected=this.otherCallRejected)}function f(e,r,n){i(function(){var t;try{t=r(n)}catch(t){return l.reject(e,t)}t===e?l.reject(e,new TypeError("Cannot resolve promise with itself")):l.resolve(e,t)})}function d(e){var r=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof r)return function t(){r.apply(e,arguments)}}function c(e,t){var r=!1;function n(t){r||(r=!0,l.reject(e,t))}function i(t){r||(r=!0,l.resolve(e,t))}function s(){t(i,n)}var a=p(s);"error"===a.status&&n(a.value)}function p(t,e){var r={};try{r.value=t(e),r.status="success"}catch(t){r.status="error",r.value=t}return r}function m(t){return t instanceof this?t:l.resolve(new this(u),t)}function _(t){var e=new this(u);return l.reject(e,t)}function g(t){var n=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var i=t.length,s=!1;if(!i)return this.resolve([]);for(var a=new Array(i),o=0,e=-1,h=new this(u);++e<i;)r(t[e],e);return h;function r(t,e){function r(t){a[e]=t,++o!==i||s||(s=!0,l.resolve(h,a))}n.resolve(t).then(r,function(t){s||(s=!0,l.reject(h,t))})}}function b(t){var e=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var r=t.length,n=!1;if(!r)return this.resolve([]);for(var i=-1,s=new this(u);++i<r;)a(t[i]);return s;function a(t){e.resolve(t).then(function(t){n||(n=!0,l.resolve(s,t))},function(t){n||(n=!0,l.reject(s,t))})}}(e.exports=n).prototype.finally=function(r){if("function"!=typeof r)return this;var n=this.constructor;return this.then(t,e);function t(t){function e(){return t}return n.resolve(r()).then(e)}function e(t){function e(){throw t}return n.resolve(r()).then(e)}},n.prototype.catch=function(t){return this.then(null,t)},n.prototype.then=function(t,e){if("function"!=typeof t&&this.state===a||"function"!=typeof e&&this.state===s)return this;var r=new this.constructor(u),n;return this.state!==o?f(r,this.state===a?t:e,this.outcome):this.queue.push(new h(r,t,e)),r},h.prototype.callFulfilled=function(t){l.resolve(this.promise,t)},h.prototype.otherCallFulfilled=function(t){f(this.promise,this.onFulfilled,t)},h.prototype.callRejected=function(t){l.reject(this.promise,t)},h.prototype.otherCallRejected=function(t){f(this.promise,this.onRejected,t)},l.resolve=function(t,e){var r=p(d,e);if("error"===r.status)return l.reject(t,r.value);var n=r.value;if(n)c(t,n);else{t.state=a,t.outcome=e;for(var i=-1,s=t.queue.length;++i<s;)t.queue[i].callFulfilled(e)}return t},l.reject=function(t,e){t.state=s,t.outcome=e;for(var r=-1,n=t.queue.length;++r<n;)t.queue[r].callRejected(e);return t},n.resolve=m,n.reject=_,n.all=g,n.race=b},{immediate:36}],38:[function(t,e,r){"use strict";var n,i,s,a,o={};(0,t("./lib/utils/common").assign)(o,t("./lib/deflate"),t("./lib/inflate"),t("./lib/zlib/constants")),e.exports=o},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(t,e,r){"use strict";var a=t("./zlib/deflate"),o=t("./utils/common"),h=t("./utils/strings"),i=t("./zlib/messages"),s=t("./zlib/zstream"),u=Object.prototype.toString,n=0,l=4,f=0,d=1,c=2,p=-1,m=0,_=8;function g(t){if(!(this instanceof g))return new g(t);this.options=o.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},t||{});var e=this.options,r;if(e.raw&&0<e.windowBits?e.windowBits=-e.windowBits:e.gzip&&0<e.windowBits&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new s,(this.strm.avail_out=0)!==(r=a.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy)))throw new Error(i[r]);if(e.header&&a.deflateSetHeader(this.strm,e.header),e.dictionary){var n,n="string"==typeof e.dictionary?h.string2buf(e.dictionary):"[object ArrayBuffer]"===u.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,r;if(0!==(r=a.deflateSetDictionary(this.strm,n)))throw new Error(i[r]);this._dict_set=!0}}function b(t,e){var r=new g(e);if(r.push(t,!0),r.err)throw r.msg||i[r.err];return r.result}function v(t,e){return(e=e||{}).raw=!0,b(t,e)}function y(t,e){return(e=e||{}).gzip=!0,b(t,e)}g.prototype.push=function(t,e){var r=this.strm,n=this.options.chunkSize,i,s;if(this.ended)return!1;s=e===~~e?e:!0===e?4:0,"string"==typeof t?r.input=h.string2buf(t):"[object ArrayBuffer]"===u.call(t)?r.input=new Uint8Array(t):r.input=t,r.next_in=0,r.avail_in=r.input.length;do{if(0===r.avail_out&&(r.output=new o.Buf8(n),r.next_out=0,r.avail_out=n),1!==(i=a.deflate(r,s))&&0!==i)return this.onEnd(i),!(this.ended=!0)}while(0!==r.avail_out&&(0!==r.avail_in||4!==s&&2!==s)||("string"===this.options.to?this.onData(h.buf2binstring(o.shrinkBuf(r.output,r.next_out))):this.onData(o.shrinkBuf(r.output,r.next_out))),(0<r.avail_in||0===r.avail_out)&&1!==i);return 4===s?(i=a.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,0===i):2!==s||(this.onEnd(0),!(r.avail_out=0))},g.prototype.onData=function(t){this.chunks.push(t)},g.prototype.onEnd=function(t){0===t&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},r.Deflate=g,r.deflate=b,r.deflateRaw=v,r.gzip=y},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(t,e,r){"use strict";var d=t("./zlib/inflate"),c=t("./utils/common"),p=t("./utils/strings"),m=t("./zlib/constants"),n=t("./zlib/messages"),i=t("./zlib/zstream"),s=t("./zlib/gzheader"),_=Object.prototype.toString;function a(t){if(!(this instanceof a))return new a(t);this.options=c.assign({chunkSize:16384,windowBits:0,to:""},t||{});var e=this.options;e.raw&&0<=e.windowBits&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(0<=e.windowBits&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),15<e.windowBits&&e.windowBits<48&&0==(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new i,this.strm.avail_out=0;var r=d.inflateInit2(this.strm,e.windowBits);if(r!==m.Z_OK)throw new Error(n[r]);this.header=new s,d.inflateGetHeader(this.strm,this.header)}function o(t,e){var r=new a(e);if(r.push(t,!0),r.err)throw r.msg||n[r.err];return r.result}function h(t,e){return(e=e||{}).raw=!0,o(t,e)}a.prototype.push=function(t,e){var r=this.strm,n=this.options.chunkSize,i=this.options.dictionary,s,a,o,h,u,l,f=!1;if(this.ended)return!1;a=e===~~e?e:!0===e?m.Z_FINISH:m.Z_NO_FLUSH,"string"==typeof t?r.input=p.binstring2buf(t):"[object ArrayBuffer]"===_.call(t)?r.input=new Uint8Array(t):r.input=t,r.next_in=0,r.avail_in=r.input.length;do{if(0===r.avail_out&&(r.output=new c.Buf8(n),r.next_out=0,r.avail_out=n),(s=d.inflate(r,m.Z_NO_FLUSH))===m.Z_NEED_DICT&&i&&(l="string"==typeof i?p.string2buf(i):"[object ArrayBuffer]"===_.call(i)?new Uint8Array(i):i,s=d.inflateSetDictionary(this.strm,l)),s===m.Z_BUF_ERROR&&!0===f&&(s=m.Z_OK,f=!1),s!==m.Z_STREAM_END&&s!==m.Z_OK)return this.onEnd(s),!(this.ended=!0)}while(r.next_out&&(0!==r.avail_out&&s!==m.Z_STREAM_END&&(0!==r.avail_in||a!==m.Z_FINISH&&a!==m.Z_SYNC_FLUSH)||("string"===this.options.to?(o=p.utf8border(r.output,r.next_out),h=r.next_out-o,u=p.buf2string(r.output,o),r.next_out=h,r.avail_out=n-h,h&&c.arraySet(r.output,r.output,o,h,0),this.onData(u)):this.onData(c.shrinkBuf(r.output,r.next_out)))),0===r.avail_in&&0===r.avail_out&&(f=!0),(0<r.avail_in||0===r.avail_out)&&s!==m.Z_STREAM_END);return(a=s===m.Z_STREAM_END?m.Z_FINISH:a)===m.Z_FINISH?(s=d.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,s===m.Z_OK):a!==m.Z_SYNC_FLUSH||(this.onEnd(m.Z_OK),!(r.avail_out=0))},a.prototype.onData=function(t){this.chunks.push(t)},a.prototype.onEnd=function(t){t===m.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=c.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},r.Inflate=a,r.inflate=o,r.inflateRaw=h,r.ungzip=o},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(t,e,r){"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;r.assign=function(t){for(var e=Array.prototype.slice.call(arguments,1);e.length;){var r=e.shift();if(r){if("object"!=typeof r)throw new TypeError(r+"must be non-object");for(var n in r)r.hasOwnProperty(n)&&(t[n]=r[n])}}return t},r.shrinkBuf=function(t,e){return t.length===e?t:t.subarray?t.subarray(0,e):(t.length=e,t)};var i={arraySet:function(t,e,r,n,i){if(e.subarray&&t.subarray)t.set(e.subarray(r,r+n),i);else for(var s=0;s<n;s++)t[i+s]=e[r+s]},flattenChunks:function(t){for(var e,r,n,i,s,a,n=0,e=0,r=t.length;e<r;e++)n+=t[e].length;for(a=new Uint8Array(n),e=i=0,r=t.length;e<r;e++)s=t[e],a.set(s,i),i+=s.length;return a}},s={arraySet:function(t,e,r,n,i){for(var s=0;s<n;s++)t[i+s]=e[r+s]},flattenChunks:function(t){return[].concat.apply([],t)}};r.setTyped=function(t){t?(r.Buf8=Uint8Array,r.Buf16=Uint16Array,r.Buf32=Int32Array,r.assign(r,i)):(r.Buf8=Array,r.Buf16=Array,r.Buf32=Array,r.assign(r,s))},r.setTyped(n)},{}],42:[function(t,e,r){"use strict";var h=t("./common"),i=!0,s=!0;try{String.fromCharCode.apply(null,[0])}catch(t){i=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){s=!1}for(var u=new h.Buf8(256),n=0;n<256;n++)u[n]=252<=n?6:248<=n?5:240<=n?4:224<=n?3:192<=n?2:1;function l(t,e){if(e<65537&&(t.subarray&&s||!t.subarray&&i))return String.fromCharCode.apply(null,h.shrinkBuf(t,e));for(var r="",n=0;n<e;n++)r+=String.fromCharCode(t[n]);return r}u[254]=u[254]=1,r.string2buf=function(t){for(var e,r,n,i,s,a=t.length,o=0,i=0;i<a;i++)55296==(64512&(r=t.charCodeAt(i)))&&i+1<a&&56320==(64512&(n=t.charCodeAt(i+1)))&&(r=65536+(r-55296<<10)+(n-56320),i++),o+=r<128?1:r<2048?2:r<65536?3:4;for(e=new h.Buf8(o),i=s=0;s<o;i++)55296==(64512&(r=t.charCodeAt(i)))&&i+1<a&&56320==(64512&(n=t.charCodeAt(i+1)))&&(r=65536+(r-55296<<10)+(n-56320),i++),r<128?e[s++]=r:(r<2048?e[s++]=192|r>>>6:(r<65536?e[s++]=224|r>>>12:(e[s++]=240|r>>>18,e[s++]=128|r>>>12&63),e[s++]=128|r>>>6&63),e[s++]=128|63&r);return e},r.buf2binstring=function(t){return l(t,t.length)},r.binstring2buf=function(t){for(var e=new h.Buf8(t.length),r=0,n=e.length;r<n;r++)e[r]=t.charCodeAt(r);return e},r.buf2string=function(t,e){for(var r,n,i,s,a=e||t.length,o=new Array(2*a),n=0,r=0;r<a;)if((i=t[r++])<128)o[n++]=i;else if(4<(s=u[i]))o[n++]=65533,r+=s-1;else{for(i&=2===s?31:3===s?15:7;1<s&&r<a;)i=i<<6|63&t[r++],s--;1<s?o[n++]=65533:i<65536?o[n++]=i:(i-=65536,o[n++]=55296|i>>10&1023,o[n++]=56320|1023&i)}return l(o,n)},r.utf8border=function(t,e){for(var r,r=(e=(e=e||t.length)>t.length?t.length:e)-1;0<=r&&128==(192&t[r]);)r--;return!(r<0)&&0!==r&&r+u[t[r]]>e?r:e}},{"./common":41}],43:[function(t,e,r){"use strict";function n(t,e,r,n){for(var i=65535&t|0,s=t>>>16&65535|0,a=0;0!==r;){for(r-=a=2e3<r?2e3:r;s=s+(i=i+e[n++]|0)|0,--a;);i%=65521,s%=65521}return i|s<<16|0}e.exports=n},{}],44:[function(t,e,r){"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(t,e,r){"use strict";function n(){for(var t,e=[],r=0;r<256;r++){for(var t=r,n=0;n<8;n++)t=1&t?3988292384^t>>>1:t>>>1;e[r]=t}return e}var o=n();function i(t,e,r,n){var i=o,s=n+r;t^=-1;for(var a=n;a<s;a++)t=t>>>8^i[255&(t^e[a])];return-1^t}e.exports=i},{}],46:[function(t,e,r){"use strict";var f=t("../utils/common"),u=t("./trees"),d=t("./adler32"),l=t("./crc32"),n=t("./messages"),c=0,i=1,s=3,p=4,a=5,m=0,o=1,_=-2,h=-3,g=-5,b=-1,v=1,y=2,w=3,k=4,x=0,S=2,z=8,C=9,E=15,A=8,I=29,O=256,B=286,R=30,T=19,D=2*B+1,F=15,N=3,U=258,P=U+N+1,L=32,j=42,Z=69,W=73,M=91,H=103,G=113,K=666,Y=1,X=2,V=3,q=4,J=3,Q;function $(t,e){return t.msg=n[e],e}function tt(t){return(t<<1)-(4<t?9:0)}function et(t){for(var e=t.length;0<=--e;)t[e]=0}function rt(t){var e=t.state,r=e.pending;0!==(r=r>t.avail_out?t.avail_out:r)&&(f.arraySet(t.output,e.pending_buf,e.pending_out,r,t.next_out),t.next_out+=r,e.pending_out+=r,t.total_out+=r,t.avail_out-=r,e.pending-=r,0===e.pending&&(e.pending_out=0))}function nt(t,e){u._tr_flush_block(t,0<=t.block_start?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,rt(t.strm)}function it(t,e){t.pending_buf[t.pending++]=e}function st(t,e){t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e}function at(t,e,r,n){var i=t.avail_in;return 0===(i=n<i?n:i)?0:(t.avail_in-=i,f.arraySet(e,t.input,t.next_in,i,r),1===t.state.wrap?t.adler=d(t.adler,e,i,r):2===t.state.wrap&&(t.adler=l(t.adler,e,i,r)),t.next_in+=i,t.total_in+=i,i)}function ot(t,e){var r=t.max_chain_length,n=t.strstart,i,s,a=t.prev_length,o=t.nice_match,h=t.strstart>t.w_size-P?t.strstart-(t.w_size-P):0,u=t.window,l=t.w_mask,f=t.prev,d=t.strstart+U,c=u[n+a-1],p=u[n+a];t.prev_length>=t.good_match&&(r>>=2),o>t.lookahead&&(o=t.lookahead);do{if(u[(i=e)+a]===p&&u[i+a-1]===c&&u[i]===u[n]&&u[++i]===u[n+1]){for(n+=2,i++;u[++n]===u[++i]&&u[++n]===u[++i]&&u[++n]===u[++i]&&u[++n]===u[++i]&&u[++n]===u[++i]&&u[++n]===u[++i]&&u[++n]===u[++i]&&u[++n]===u[++i]&&n<d;);if(s=U-(d-n),n=d-U,a<s){if(t.match_start=e,o<=(a=s))break;c=u[n+a-1],p=u[n+a]}}}while((e=f[e&l])>h&&0!=--r);return a<=t.lookahead?a:t.lookahead}function ht(t){var e=t.w_size,r,n,i,s,a;do{if(s=t.window_size-t.lookahead-t.strstart,t.strstart>=e+(e-P)){for(f.arraySet(t.window,t.window,e,e,0),t.match_start-=e,t.strstart-=e,t.block_start-=e,r=n=t.hash_size;i=t.head[--r],t.head[r]=e<=i?i-e:0,--n;);for(r=n=e;i=t.prev[--r],t.prev[r]=e<=i?i-e:0,--n;);s+=e}if(0===t.strm.avail_in)break;if(n=at(t.strm,t.window,t.strstart+t.lookahead,s),t.lookahead+=n,t.lookahead+t.insert>=N)for(a=t.strstart-t.insert,t.ins_h=t.window[a],t.ins_h=(t.ins_h<<t.hash_shift^t.window[a+1])&t.hash_mask;t.insert&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[a+N-1])&t.hash_mask,t.prev[a&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=a,a++,t.insert--,!(t.lookahead+t.insert<N)););}while(t.lookahead<P&&0!==t.strm.avail_in)}function ut(t,e){var r=65535;for(r>t.pending_buf_size-5&&(r=t.pending_buf_size-5);;){if(t.lookahead<=1){if(ht(t),0===t.lookahead&&e===c)return Y;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;var n=t.block_start+r;if((0===t.strstart||t.strstart>=n)&&(t.lookahead=t.strstart-n,t.strstart=n,nt(t,!1),0===t.strm.avail_out))return Y;if(t.strstart-t.block_start>=t.w_size-P&&(nt(t,!1),0===t.strm.avail_out))return Y}return t.insert=0,e===p?(nt(t,!0),0===t.strm.avail_out?V:q):(t.strstart>t.block_start&&(nt(t,!1),t.strm.avail_out),Y)}function lt(t,e){for(var r,n;;){if(t.lookahead<P){if(ht(t),t.lookahead<P&&e===c)return Y;if(0===t.lookahead)break}if(r=0,t.lookahead>=N&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+N-1])&t.hash_mask,r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==r&&t.strstart-r<=t.w_size-P&&(t.match_length=ot(t,r)),t.match_length>=N)if(n=u._tr_tally(t,t.strstart-t.match_start,t.match_length-N),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=N){for(t.match_length--;t.strstart++,t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+N-1])&t.hash_mask,r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart,0!=--t.match_length;);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+1])&t.hash_mask;else n=u._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(n&&(nt(t,!1),0===t.strm.avail_out))return Y}return t.insert=t.strstart<N-1?t.strstart:N-1,e===p?(nt(t,!0),0===t.strm.avail_out?V:q):t.last_lit&&(nt(t,!1),0===t.strm.avail_out)?Y:X}function ft(t,e){for(var r,n,i;;){if(t.lookahead<P){if(ht(t),t.lookahead<P&&e===c)return Y;if(0===t.lookahead)break}if(r=0,t.lookahead>=N&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+N-1])&t.hash_mask,r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=N-1,0!==r&&t.prev_length<t.max_lazy_match&&t.strstart-r<=t.w_size-P&&(t.match_length=ot(t,r),t.match_length<=5&&(1===t.strategy||t.match_length===N&&4096<t.strstart-t.match_start)&&(t.match_length=N-1)),t.prev_length>=N&&t.match_length<=t.prev_length){for(i=t.strstart+t.lookahead-N,n=u._tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-N),t.lookahead-=t.prev_length-1,t.prev_length-=2;++t.strstart<=i&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+N-1])&t.hash_mask,r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!=--t.prev_length;);if(t.match_available=0,t.match_length=N-1,t.strstart++,n&&(nt(t,!1),0===t.strm.avail_out))return Y}else if(t.match_available){if((n=u._tr_tally(t,0,t.window[t.strstart-1]))&&nt(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return Y}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(n=u._tr_tally(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<N-1?t.strstart:N-1,e===p?(nt(t,!0),0===t.strm.avail_out?V:q):t.last_lit&&(nt(t,!1),0===t.strm.avail_out)?Y:X}function dt(t,e){for(var r,n,i,s,a=t.window;;){if(t.lookahead<=U){if(ht(t),t.lookahead<=U&&e===c)return Y;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=N&&0<t.strstart&&(n=a[i=t.strstart-1])===a[++i]&&n===a[++i]&&n===a[++i]){for(s=t.strstart+U;n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&i<s;);t.match_length=U-(s-i),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=N?(r=u._tr_tally(t,1,t.match_length-N),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(r=u._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),r&&(nt(t,!1),0===t.strm.avail_out))return Y}return t.insert=0,e===p?(nt(t,!0),0===t.strm.avail_out?V:q):t.last_lit&&(nt(t,!1),0===t.strm.avail_out)?Y:X}function ct(t,e){for(var r;;){if(0===t.lookahead&&(ht(t),0===t.lookahead)){if(e===c)return Y;break}if(t.match_length=0,r=u._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,r&&(nt(t,!1),0===t.strm.avail_out))return Y}return t.insert=0,e===p?(nt(t,!0),0===t.strm.avail_out?V:q):t.last_lit&&(nt(t,!1),0===t.strm.avail_out)?Y:X}function pt(t,e,r,n,i){this.good_length=t,this.max_lazy=e,this.nice_length=r,this.max_chain=n,this.func=i}function mt(t){t.window_size=2*t.w_size,et(t.head),t.max_lazy_match=Q[t.level].max_lazy,t.good_match=Q[t.level].good_length,t.nice_match=Q[t.level].nice_length,t.max_chain_length=Q[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=N-1,t.match_available=0,t.ins_h=0}function _t(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=z,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new f.Buf16(2*D),this.dyn_dtree=new f.Buf16(2*(2*R+1)),this.bl_tree=new f.Buf16(2*(2*T+1)),et(this.dyn_ltree),et(this.dyn_dtree),et(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new f.Buf16(F+1),this.heap=new f.Buf16(2*B+1),et(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new f.Buf16(2*B+1),et(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function gt(t){var e;return t&&t.state?(t.total_in=t.total_out=0,t.data_type=S,(e=t.state).pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?j:G,t.adler=2===e.wrap?0:1,e.last_flush=c,u._tr_init(e),m):$(t,_)}function bt(t){var e=gt(t);return e===m&&mt(t.state),e}function vt(t,e){return!t||!t.state||2!==t.state.wrap?_:(t.state.gzhead=e,m)}function yt(t,e,r,n,i,s){if(!t)return _;var a=1;if(e===b&&(e=6),n<0?(a=0,n=-n):15<n&&(a=2,n-=16),i<1||C<i||r!==z||n<8||15<n||e<0||9<e||s<0||k<s)return $(t,_);8===n&&(n=9);var o=new _t;return(t.state=o).strm=t,o.wrap=a,o.gzhead=null,o.w_bits=n,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=i+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+N-1)/N),o.window=new f.Buf8(2*o.w_size),o.head=new f.Buf16(o.hash_size),o.prev=new f.Buf16(o.w_size),o.lit_bufsize=1<<i+6,o.pending_buf_size=4*o.lit_bufsize,o.pending_buf=new f.Buf8(o.pending_buf_size),o.d_buf=+o.lit_bufsize,o.l_buf=3*o.lit_bufsize,o.level=e,o.strategy=s,o.method=r,bt(t)}function wt(t,e){return yt(t,e,z,15,8,0)}function kt(t,e){var r,n,i,s,a,o,o;if(!t||!t.state||5<e||e<0)return t?$(t,_):_;if(n=t.state,!t.output||!t.input&&0!==t.avail_in||n.status===K&&e!==p)return $(t,0===t.avail_out?-5:_);if(n.strm=t,r=n.last_flush,n.last_flush=e,n.status===j&&(2===n.wrap?(t.adler=0,it(n,31),it(n,139),it(n,8),n.gzhead?(it(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),it(n,255&n.gzhead.time),it(n,n.gzhead.time>>8&255),it(n,n.gzhead.time>>16&255),it(n,n.gzhead.time>>24&255),it(n,9===n.level?2:2<=n.strategy||n.level<2?4:0),it(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(it(n,255&n.gzhead.extra.length),it(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(t.adler=l(t.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69):(it(n,0),it(n,0),it(n,0),it(n,0),it(n,0),it(n,9===n.level?2:2<=n.strategy||n.level<2?4:0),it(n,3),n.status=G)):(a=z+(n.w_bits-8<<4)<<8,o=-1,a|=(o=2<=n.strategy||n.level<2?0:n.level<6?1:6===n.level?2:3)<<6,0!==n.strstart&&(a|=32),a+=31-a%31,n.status=G,st(n,a),0!==n.strstart&&(st(n,t.adler>>>16),st(n,65535&t.adler)),t.adler=1)),69===n.status)if(n.gzhead.extra){for(i=n.pending;n.gzindex<(65535&n.gzhead.extra.length)&&(n.pending!==n.pending_buf_size||(n.gzhead.hcrc&&n.pending>i&&(t.adler=l(t.adler,n.pending_buf,n.pending-i,i)),rt(t),i=n.pending,n.pending!==n.pending_buf_size));)it(n,255&n.gzhead.extra[n.gzindex]),n.gzindex++;n.gzhead.hcrc&&n.pending>i&&(t.adler=l(t.adler,n.pending_buf,n.pending-i,i)),n.gzindex===n.gzhead.extra.length&&(n.gzindex=0,n.status=73)}else n.status=73;if(73===n.status)if(n.gzhead.name){i=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>i&&(t.adler=l(t.adler,n.pending_buf,n.pending-i,i)),rt(t),i=n.pending,n.pending===n.pending_buf_size)){s=1;break}}while(s=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,it(n,s),0!==s);n.gzhead.hcrc&&n.pending>i&&(t.adler=l(t.adler,n.pending_buf,n.pending-i,i)),0===s&&(n.gzindex=0,n.status=91)}else n.status=91;if(91===n.status)if(n.gzhead.comment){i=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>i&&(t.adler=l(t.adler,n.pending_buf,n.pending-i,i)),rt(t),i=n.pending,n.pending===n.pending_buf_size)){s=1;break}}while(s=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,it(n,s),0!==s);n.gzhead.hcrc&&n.pending>i&&(t.adler=l(t.adler,n.pending_buf,n.pending-i,i)),0===s&&(n.status=H)}else n.status=H;if(n.status===H&&(n.gzhead.hcrc?(n.pending+2>n.pending_buf_size&&rt(t),n.pending+2<=n.pending_buf_size&&(it(n,255&t.adler),it(n,t.adler>>8&255),t.adler=0,n.status=G)):n.status=G),0!==n.pending){if(rt(t),0===t.avail_out)return n.last_flush=-1,m}else if(0===t.avail_in&&tt(e)<=tt(r)&&e!==p)return $(t,-5);if(n.status===K&&0!==t.avail_in)return $(t,-5);if(0!==t.avail_in||0!==n.lookahead||e!==c&&n.status!==K){var h=2===n.strategy?ct(n,e):3===n.strategy?dt(n,e):Q[n.level].func(n,e);if(h!==V&&h!==q||(n.status=K),h===Y||h===V)return 0===t.avail_out&&(n.last_flush=-1),m;if(h===X&&(1===e?u._tr_align(n):5!==e&&(u._tr_stored_block(n,0,0,!1),3===e&&(et(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),rt(t),0===t.avail_out))return n.last_flush=-1,m}return e!==p?m:n.wrap<=0?1:(2===n.wrap?(it(n,255&t.adler),it(n,t.adler>>8&255),it(n,t.adler>>16&255),it(n,t.adler>>24&255),it(n,255&t.total_in),it(n,t.total_in>>8&255),it(n,t.total_in>>16&255),it(n,t.total_in>>24&255)):(st(n,t.adler>>>16),st(n,65535&t.adler)),rt(t),0<n.wrap&&(n.wrap=-n.wrap),0!==n.pending?m:1)}function xt(t){var e;return t&&t.state?(e=t.state.status)!==j&&69!==e&&73!==e&&91!==e&&e!==H&&e!==G&&e!==K?$(t,_):(t.state=null,e===G?$(t,-3):m):_}function St(t,e){var r=e.length,n,i,s,a,o,h,u,l;if(!t||!t.state)return _;if(2===(a=(n=t.state).wrap)||1===a&&n.status!==j||n.lookahead)return _;for(1===a&&(t.adler=d(t.adler,e,r,0)),n.wrap=0,r>=n.w_size&&(0===a&&(et(n.head),n.strstart=0,n.block_start=0,n.insert=0),l=new f.Buf8(n.w_size),f.arraySet(l,e,r-n.w_size,n.w_size,0),e=l,r=n.w_size),o=t.avail_in,h=t.next_in,u=t.input,t.avail_in=r,t.next_in=0,t.input=e,ht(n);n.lookahead>=N;){for(i=n.strstart,s=n.lookahead-(N-1);n.ins_h=(n.ins_h<<n.hash_shift^n.window[i+N-1])&n.hash_mask,n.prev[i&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=i,i++,--s;);n.strstart=i,n.lookahead=N-1,ht(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=N-1,n.match_available=0,t.next_in=h,t.input=u,t.avail_in=o,n.wrap=a,m}Q=[new pt(0,0,0,0,ut),new pt(4,4,8,4,lt),new pt(4,5,16,8,lt),new pt(4,6,32,32,lt),new pt(4,4,16,16,ft),new pt(8,16,32,32,ft),new pt(8,16,128,128,ft),new pt(8,32,128,256,ft),new pt(32,128,258,1024,ft),new pt(32,258,258,4096,ft)],r.deflateInit=wt,r.deflateInit2=yt,r.deflateReset=bt,r.deflateResetKeep=gt,r.deflateSetHeader=vt,r.deflate=kt,r.deflateEnd=xt,r.deflateSetDictionary=St,r.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(t,e,r){"use strict";function n(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}e.exports=n},{}],48:[function(t,e,r){"use strict";var n=30,i=12;e.exports=function t(e,r){var n,i,s,a,o,h,u,l,f,d,c,p,m,_,g,b,v,y,w,k,x,S,z,C,E,n=e.state,i=e.next_in,C=e.input,s=i+(e.avail_in-5),a=e.next_out,E=e.output,o=a-(r-e.avail_out),h=a+(e.avail_out-257),u=n.dmax,l=n.wsize,f=n.whave,d=n.wnext,c=n.window,p=n.hold,m=n.bits,_=n.lencode,g=n.distcode,b=(1<<n.lenbits)-1,v=(1<<n.distbits)-1;t:do{m<15&&(p+=C[i++]<<m,m+=8,p+=C[i++]<<m,m+=8),y=_[p&b];e:for(;;){if(p>>>=w=y>>>24,m-=w,0===(w=y>>>16&255))E[a++]=65535&y;else{if(!(16&w)){if(0==(64&w)){y=_[(65535&y)+(p&(1<<w)-1)];continue}if(32&w){n.mode=12;break t}e.msg="invalid literal/length code",n.mode=30;break t}k=65535&y,(w&=15)&&(m<w&&(p+=C[i++]<<m,m+=8),k+=p&(1<<w)-1,p>>>=w,m-=w),m<15&&(p+=C[i++]<<m,m+=8,p+=C[i++]<<m,m+=8),y=g[p&v];r:for(;;){if(p>>>=w=y>>>24,m-=w,!(16&(w=y>>>16&255))){if(0==(64&w)){y=g[(65535&y)+(p&(1<<w)-1)];continue}e.msg="invalid distance code",n.mode=30;break t}if(x=65535&y,m<(w&=15)&&(p+=C[i++]<<m,(m+=8)<w&&(p+=C[i++]<<m,m+=8)),u<(x+=p&(1<<w)-1)){e.msg="invalid distance too far back",n.mode=30;break t}if(p>>>=w,m-=w,(w=a-o)<x){if(f<(w=x-w)&&n.sane){e.msg="invalid distance too far back",n.mode=30;break t}if(z=c,(S=0)===d){if(S+=l-w,w<k){for(k-=w;E[a++]=c[S++],--w;);S=a-x,z=E}}else if(d<w){if(S+=l+d-w,(w-=d)<k){for(k-=w;E[a++]=c[S++],--w;);if(S=0,d<k){for(k-=w=d;E[a++]=c[S++],--w;);S=a-x,z=E}}}else if(S+=d-w,w<k){for(k-=w;E[a++]=c[S++],--w;);S=a-x,z=E}for(;2<k;)E[a++]=z[S++],E[a++]=z[S++],E[a++]=z[S++],k-=3;k&&(E[a++]=z[S++],1<k&&(E[a++]=z[S++]))}else{for(S=a-x;E[a++]=E[S++],E[a++]=E[S++],E[a++]=E[S++],2<(k-=3););k&&(E[a++]=E[S++],1<k&&(E[a++]=E[S++]))}break}}break}}while(i<s&&a<h);p&=(1<<(m-=(k=m>>3)<<3))-1,e.next_in=i-=k,e.next_out=a,e.avail_in=i<s?s-i+5:5-(i-s),e.avail_out=a<h?h-a+257:257-(a-h),n.hold=p,n.bits=m}},{}],49:[function(t,e,r){"use strict";var I=t("../utils/common"),O=t("./adler32"),B=t("./crc32"),R=t("./inffast"),T=t("./inftrees"),n=0,D=1,F=2,i=4,s=5,a=6,N=0,o=1,h=2,U=-2,u=-3,l=-4,f=-5,d=8,P=1,c=2,p=3,m=4,_=5,g=6,b=7,v=8,y=9,w=10,k=11,x=12,S=13,z=14,C=15,E=16,A=17,L=18,j=19,Z=20,W=21,M=22,H=23,G=24,K=25,Y=26,X=27,V=28,q=29,J=30,Q=31,$=32,tt=852,et=592,rt=15,nt=15;function it(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}function st(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new I.Buf16(320),this.work=new I.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function at(t){var e;return t&&t.state?(e=t.state,t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=P,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new I.Buf32(tt),e.distcode=e.distdyn=new I.Buf32(et),e.sane=1,e.back=-1,N):U}function ot(t){var e;return t&&t.state?((e=t.state).wsize=0,e.whave=0,e.wnext=0,at(t)):U}function ht(t,e){var r,n;return t&&t.state?(n=t.state,e<0?(r=0,e=-e):(r=1+(e>>4),e<48&&(e&=15)),e&&(e<8||15<e)?U:(null!==n.window&&n.wbits!==e&&(n.window=null),n.wrap=r,n.wbits=e,ot(t))):U}function ut(t,e){var r,n;return t?(n=new st,(t.state=n).window=null,(r=ht(t,e))!==N&&(t.state=null),r):U}function lt(t){return ut(t,15)}var ft=!0,dt,ct;function pt(t){if(ft){var e;for(dt=new I.Buf32(512),ct=new I.Buf32(32),e=0;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(T(D,t.lens,0,288,dt,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;T(F,t.lens,0,32,ct,0,t.work,{bits:5}),ft=!1}t.lencode=dt,t.lenbits=9,t.distcode=ct,t.distbits=5}function mt(t,e,r,n){var i,s=t.state;return null===s.window&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new I.Buf8(s.wsize)),n>=s.wsize?(I.arraySet(s.window,e,r-s.wsize,s.wsize,0),s.wnext=0,s.whave=s.wsize):(n<(i=s.wsize-s.wnext)&&(i=n),I.arraySet(s.window,e,r-n,i,s.wnext),(n-=i)?(I.arraySet(s.window,e,r-n,n,0),s.wnext=n,s.whave=s.wsize):(s.wnext+=i,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=i))),0}function _t(t,e){var r,n,i,s,a,o,h,u,l,f,d,c,p,m,_=0,g,b,v,y,w,k,x,S,z=new I.Buf8(4),C,E,A=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return U;12===(r=t.state).mode&&(r.mode=13),a=t.next_out,i=t.output,h=t.avail_out,s=t.next_in,n=t.input,o=t.avail_in,u=r.hold,l=r.bits,f=o,d=h,S=N;t:for(;;)switch(r.mode){case P:if(0===r.wrap){r.mode=13;break}for(;l<16;){if(0===o)break t;o--,u+=n[s++]<<l,l+=8}if(2&r.wrap&&35615===u){z[r.check=0]=255&u,z[1]=u>>>8&255,r.check=B(r.check,z,2,0),l=u=0,r.mode=2;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&u)<<8)+(u>>8))%31){t.msg="incorrect header check",r.mode=30;break}if(8!=(15&u)){t.msg="unknown compression method",r.mode=30;break}if(l-=4,x=8+(15&(u>>>=4)),0===r.wbits)r.wbits=x;else if(x>r.wbits){t.msg="invalid window size",r.mode=30;break}r.dmax=1<<x,t.adler=r.check=1,r.mode=512&u?10:12,l=u=0;break;case 2:for(;l<16;){if(0===o)break t;o--,u+=n[s++]<<l,l+=8}if(r.flags=u,8!=(255&r.flags)){t.msg="unknown compression method",r.mode=30;break}if(57344&r.flags){t.msg="unknown header flags set",r.mode=30;break}r.head&&(r.head.text=u>>8&1),512&r.flags&&(z[0]=255&u,z[1]=u>>>8&255,r.check=B(r.check,z,2,0)),l=u=0,r.mode=3;case 3:for(;l<32;){if(0===o)break t;o--,u+=n[s++]<<l,l+=8}r.head&&(r.head.time=u),512&r.flags&&(z[0]=255&u,z[1]=u>>>8&255,z[2]=u>>>16&255,z[3]=u>>>24&255,r.check=B(r.check,z,4,0)),l=u=0,r.mode=4;case 4:for(;l<16;){if(0===o)break t;o--,u+=n[s++]<<l,l+=8}r.head&&(r.head.xflags=255&u,r.head.os=u>>8),512&r.flags&&(z[0]=255&u,z[1]=u>>>8&255,r.check=B(r.check,z,2,0)),l=u=0,r.mode=5;case 5:if(1024&r.flags){for(;l<16;){if(0===o)break t;o--,u+=n[s++]<<l,l+=8}r.length=u,r.head&&(r.head.extra_len=u),512&r.flags&&(z[0]=255&u,z[1]=u>>>8&255,r.check=B(r.check,z,2,0)),l=u=0}else r.head&&(r.head.extra=null);r.mode=6;case 6:if(1024&r.flags&&((c=o<(c=r.length)?o:c)&&(r.head&&(x=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Array(r.head.extra_len)),I.arraySet(r.head.extra,n,s,c,x)),512&r.flags&&(r.check=B(r.check,n,c,s)),o-=c,s+=c,r.length-=c),r.length))break t;r.length=0,r.mode=7;case 7:if(2048&r.flags){if(0===o)break t;for(c=0;x=n[s+c++],r.head&&x&&r.length<65536&&(r.head.name+=String.fromCharCode(x)),x&&c<o;);if(512&r.flags&&(r.check=B(r.check,n,c,s)),o-=c,s+=c,x)break t}else r.head&&(r.head.name=null);r.length=0,r.mode=8;case 8:if(4096&r.flags){if(0===o)break t;for(c=0;x=n[s+c++],r.head&&x&&r.length<65536&&(r.head.comment+=String.fromCharCode(x)),x&&c<o;);if(512&r.flags&&(r.check=B(r.check,n,c,s)),o-=c,s+=c,x)break t}else r.head&&(r.head.comment=null);r.mode=9;case 9:if(512&r.flags){for(;l<16;){if(0===o)break t;o--,u+=n[s++]<<l,l+=8}if(u!==(65535&r.check)){t.msg="header crc mismatch",r.mode=30;break}l=u=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),t.adler=r.check=0,r.mode=12;break;case 10:for(;l<32;){if(0===o)break t;o--,u+=n[s++]<<l,l+=8}t.adler=r.check=it(u),l=u=0,r.mode=11;case 11:if(0===r.havedict)return t.next_out=a,t.avail_out=h,t.next_in=s,t.avail_in=o,r.hold=u,r.bits=l,2;t.adler=r.check=1,r.mode=12;case 12:if(5===e||6===e)break t;case 13:if(r.last){u>>>=7&l,l-=7&l,r.mode=27;break}for(;l<3;){if(0===o)break t;o--,u+=n[s++]<<l,l+=8}switch(r.last=1&u,--l,3&(u>>>=1)){case 0:r.mode=14;break;case 1:if(pt(r),r.mode=20,6!==e)break;u>>>=2,l-=2;break t;case 2:r.mode=17;break;case 3:t.msg="invalid block type",r.mode=30}u>>>=2,l-=2;break;case 14:for(u>>>=7&l,l-=7&l;l<32;){if(0===o)break t;o--,u+=n[s++]<<l,l+=8}if((65535&u)!=(u>>>16^65535)){t.msg="invalid stored block lengths",r.mode=30;break}if(r.length=65535&u,l=u=0,r.mode=15,6===e)break t;case 15:r.mode=16;case 16:if(c=r.length){if(0===(c=h<(c=o<c?o:c)?h:c))break t;I.arraySet(i,n,s,c,a),o-=c,s+=c,h-=c,a+=c,r.length-=c;break}r.mode=12;break;case 17:for(;l<14;){if(0===o)break t;o--,u+=n[s++]<<l,l+=8}if(r.nlen=257+(31&u),u>>>=5,l-=5,r.ndist=1+(31&u),u>>>=5,l-=5,r.ncode=4+(15&u),u>>>=4,l-=4,286<r.nlen||30<r.ndist){t.msg="too many length or distance symbols",r.mode=30;break}r.have=0,r.mode=18;case 18:for(;r.have<r.ncode;){for(;l<3;){if(0===o)break t;o--,u+=n[s++]<<l,l+=8}r.lens[A[r.have++]]=7&u,u>>>=3,l-=3}for(;r.have<19;)r.lens[A[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,C={bits:r.lenbits},S=T(0,r.lens,0,19,r.lencode,0,r.work,C),r.lenbits=C.bits,S){t.msg="invalid code lengths set",r.mode=30;break}r.have=0,r.mode=19;case 19:for(;r.have<r.nlen+r.ndist;){for(;b=(_=r.lencode[u&(1<<r.lenbits)-1])>>>16&255,v=65535&_,!((g=_>>>24)<=l);){if(0===o)break t;o--,u+=n[s++]<<l,l+=8}if(v<16)u>>>=g,l-=g,r.lens[r.have++]=v;else{if(16===v){for(E=g+2;l<E;){if(0===o)break t;o--,u+=n[s++]<<l,l+=8}if(u>>>=g,l-=g,0===r.have){t.msg="invalid bit length repeat",r.mode=30;break}x=r.lens[r.have-1],c=3+(3&u),u>>>=2,l-=2}else if(17===v){for(E=g+3;l<E;){if(0===o)break t;o--,u+=n[s++]<<l,l+=8}l-=g,x=0,c=3+(7&(u>>>=g)),u>>>=3,l-=3}else{for(E=g+7;l<E;){if(0===o)break t;o--,u+=n[s++]<<l,l+=8}l-=g,x=0,c=11+(127&(u>>>=g)),u>>>=7,l-=7}if(r.have+c>r.nlen+r.ndist){t.msg="invalid bit length repeat",r.mode=30;break}for(;c--;)r.lens[r.have++]=x}}if(30===r.mode)break;if(0===r.lens[256]){t.msg="invalid code -- missing end-of-block",r.mode=30;break}if(r.lenbits=9,C={bits:r.lenbits},S=T(D,r.lens,0,r.nlen,r.lencode,0,r.work,C),r.lenbits=C.bits,S){t.msg="invalid literal/lengths set",r.mode=30;break}if(r.distbits=6,r.distcode=r.distdyn,C={bits:r.distbits},S=T(F,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,C),r.distbits=C.bits,S){t.msg="invalid distances set",r.mode=30;break}if(r.mode=20,6===e)break t;case 20:r.mode=21;case 21:if(6<=o&&258<=h){t.next_out=a,t.avail_out=h,t.next_in=s,t.avail_in=o,r.hold=u,r.bits=l,R(t,d),a=t.next_out,i=t.output,h=t.avail_out,s=t.next_in,n=t.input,o=t.avail_in,u=r.hold,l=r.bits,12===r.mode&&(r.back=-1);break}for(r.back=0;b=(_=r.lencode[u&(1<<r.lenbits)-1])>>>16&255,v=65535&_,!((g=_>>>24)<=l);){if(0===o)break t;o--,u+=n[s++]<<l,l+=8}if(b&&0==(240&b)){for(y=g,w=b,k=v;b=(_=r.lencode[k+((u&(1<<y+w)-1)>>y)])>>>16&255,v=65535&_,!(y+(g=_>>>24)<=l);){if(0===o)break t;o--,u+=n[s++]<<l,l+=8}u>>>=y,l-=y,r.back+=y}if(u>>>=g,l-=g,r.back+=g,r.length=v,0===b){r.mode=26;break}if(32&b){r.back=-1,r.mode=12;break}if(64&b){t.msg="invalid literal/length code",r.mode=30;break}r.extra=15&b,r.mode=22;case 22:if(r.extra){for(E=r.extra;l<E;){if(0===o)break t;o--,u+=n[s++]<<l,l+=8}r.length+=u&(1<<r.extra)-1,u>>>=r.extra,l-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=23;case 23:for(;b=(_=r.distcode[u&(1<<r.distbits)-1])>>>16&255,v=65535&_,!((g=_>>>24)<=l);){if(0===o)break t;o--,u+=n[s++]<<l,l+=8}if(0==(240&b)){for(y=g,w=b,k=v;b=(_=r.distcode[k+((u&(1<<y+w)-1)>>y)])>>>16&255,v=65535&_,!(y+(g=_>>>24)<=l);){if(0===o)break t;o--,u+=n[s++]<<l,l+=8}u>>>=y,l-=y,r.back+=y}if(u>>>=g,l-=g,r.back+=g,64&b){t.msg="invalid distance code",r.mode=30;break}r.offset=v,r.extra=15&b,r.mode=24;case 24:if(r.extra){for(E=r.extra;l<E;){if(0===o)break t;o--,u+=n[s++]<<l,l+=8}r.offset+=u&(1<<r.extra)-1,u>>>=r.extra,l-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){t.msg="invalid distance too far back",r.mode=30;break}r.mode=25;case 25:if(0===h)break t;if(r.offset>(c=d-h)){if((c=r.offset-c)>r.whave&&r.sane){t.msg="invalid distance too far back",r.mode=30;break}p=c>r.wnext?(c-=r.wnext,r.wsize-c):r.wnext-c,c>r.length&&(c=r.length),m=r.window}else m=i,p=a-r.offset,c=r.length;for(h-=c=h<c?h:c,r.length-=c;i[a++]=m[p++],--c;);0===r.length&&(r.mode=21);break;case 26:if(0===h)break t;i[a++]=r.length,h--,r.mode=21;break;case 27:if(r.wrap){for(;l<32;){if(0===o)break t;o--,u|=n[s++]<<l,l+=8}if(d-=h,t.total_out+=d,r.total+=d,d&&(t.adler=r.check=(r.flags?B:O)(r.check,i,d,a-d)),d=h,(r.flags?u:it(u))!==r.check){t.msg="incorrect data check",r.mode=30;break}l=u=0}r.mode=28;case 28:if(r.wrap&&r.flags){for(;l<32;){if(0===o)break t;o--,u+=n[s++]<<l,l+=8}if(u!==(4294967295&r.total)){t.msg="incorrect length check",r.mode=30;break}l=u=0}r.mode=29;case 29:S=1;break t;case 30:S=-3;break t;case 31:return-4;default:return U}return t.next_out=a,t.avail_out=h,t.next_in=s,t.avail_in=o,r.hold=u,r.bits=l,(r.wsize||d!==t.avail_out&&r.mode<30&&(r.mode<27||4!==e))&&mt(t,t.output,t.next_out,d-t.avail_out)?(r.mode=31,-4):(f-=t.avail_in,d-=t.avail_out,t.total_in+=f,t.total_out+=d,r.total+=d,r.wrap&&d&&(t.adler=r.check=(r.flags?B:O)(r.check,i,d,t.next_out-d)),t.data_type=r.bits+(r.last?64:0)+(12===r.mode?128:0)+(20===r.mode||15===r.mode?256:0),(0==f&&0===d||4===e)&&S===N?-5:S)}function gt(t){if(!t||!t.state)return U;var e=t.state;return e.window&&(e.window=null),t.state=null,N}function bt(t,e){var r;return!t||!t.state||0==(2&(r=t.state).wrap)?U:((r.head=e).done=!1,N)}function vt(t,e){var r=e.length,n,i,s;return!t||!t.state||0!==(n=t.state).wrap&&11!==n.mode?U:11===n.mode&&(i=O(i=1,e,r,0))!==n.check?-3:(s=mt(t,e,r,r))?(n.mode=31,-4):(n.havedict=1,N)}r.inflateReset=ot,r.inflateReset2=ht,r.inflateResetKeep=at,r.inflateInit=lt,r.inflateInit2=ut,r.inflate=_t,r.inflateEnd=gt,r.inflateGetHeader=bt,r.inflateSetDictionary=vt,r.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(t,e,r){"use strict";var F=t("../utils/common"),n=15,N=852,U=592,i=0,s=1,a=2,P=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],L=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],j=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],Z=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function t(e,r,n,i,s,a,o,h){for(var u=h.bits,l=0,f=0,d=0,c=0,p=0,m=0,_=0,g=0,b=0,v=0,y,w,k,x,S,z=null,C=0,E,A=new F.Buf16(16),I=new F.Buf16(16),O=null,B=0,R,T,D,l=0;l<=15;l++)A[l]=0;for(f=0;f<i;f++)A[r[n+f]]++;for(p=u,c=15;1<=c&&0===A[c];c--);if(c<p&&(p=c),0===c)return s[a++]=20971520,s[a++]=20971520,h.bits=1,0;for(d=1;d<c&&0===A[d];d++);for(p<d&&(p=d),l=g=1;l<=15;l++)if(g<<=1,(g-=A[l])<0)return-1;if(0<g&&(0===e||1!==c))return-1;for(I[1]=0,l=1;l<15;l++)I[l+1]=I[l]+A[l];for(f=0;f<i;f++)0!==r[n+f]&&(o[I[r[n+f]]++]=f);if(E=0===e?(z=O=o,19):1===e?(z=P,C-=257,O=L,B-=257,256):(z=j,O=Z,-1),l=d,S=a,_=f=v=0,k=-1,x=(b=1<<(m=p))-1,1===e&&N<b||2===e&&U<b)return 1;for(;;){for(D=o[f]<E?(T=0,o[f]):o[f]>E?(T=O[B+o[f]],z[C+o[f]]):(T=96,0),y=1<<(R=l-_),d=w=1<<m;s[S+(v>>_)+(w-=y)]=R<<24|T<<16|D|0,0!==w;);for(y=1<<l-1;v&y;)y>>=1;if(0!==y?(v&=y-1,v+=y):v=0,f++,0==--A[l]){if(l===c)break;l=r[n+o[f]]}if(p<l&&(v&x)!==k){for(S+=d,g=1<<(m=l-(_=0===_?p:_));m+_<c&&!((g-=A[m+_])<=0);)m++,g<<=1;if(b+=1<<m,1===e&&N<b||2===e&&U<b)return 1;s[k=v&x]=p<<24|m<<16|S-a|0}}return 0!==v&&(s[S+v]=l-_<<24|64<<16|0),h.bits=p,0}},{"../utils/common":41}],51:[function(t,e,r){"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(t,e,r){"use strict";var i=t("../utils/common"),n=4,s=0,a=1,o=2;function h(t){for(var e=t.length;0<=--e;)t[e]=0}var u=0,l=1,f=2,d=3,c=258,p=29,m=256,_=m+1+p,g=30,b=19,v=2*_+1,y=15,w=16,k=7,x=256,S=16,z=17,C=18,E=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],A=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],I=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],O=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],B=512,R=new Array(2*(_+2));h(R);var T=new Array(2*g);h(T);var D=new Array(B);h(D);var F=new Array(256);h(F);var N=new Array(p);h(N);var U=new Array(g),P,L,j;function Z(t,e,r,n,i){this.static_tree=t,this.extra_bits=e,this.extra_base=r,this.elems=n,this.max_length=i,this.has_stree=t&&t.length}function W(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}function M(t){return t<256?D[t]:D[256+(t>>>7)]}function H(t,e){t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255}function G(t,e,r){t.bi_valid>w-r?(t.bi_buf|=e<<t.bi_valid&65535,H(t,t.bi_buf),t.bi_buf=e>>w-t.bi_valid,t.bi_valid+=r-w):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=r)}function K(t,e,r){G(t,r[2*e],r[2*e+1])}function Y(t,e){for(var r=0;r|=1&t,t>>>=1,r<<=1,0<--e;);return r>>>1}function X(t){16===t.bi_valid?(H(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):8<=t.bi_valid&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}function V(t,e){for(var r=e.dyn_tree,n=e.max_code,i=e.stat_desc.static_tree,s=e.stat_desc.has_stree,a=e.stat_desc.extra_bits,o=e.stat_desc.extra_base,h=e.stat_desc.max_length,u,l,f,d,c,p,m=0,d=0;d<=y;d++)t.bl_count[d]=0;for(r[2*t.heap[t.heap_max]+1]=0,u=t.heap_max+1;u<v;u++)h<(d=r[2*r[2*(l=t.heap[u])+1]+1]+1)&&(d=h,m++),r[2*l+1]=d,n<l||(t.bl_count[d]++,c=0,o<=l&&(c=a[l-o]),p=r[2*l],t.opt_len+=p*(d+c),s&&(t.static_len+=p*(i[2*l+1]+c)));if(0!==m){do{for(d=h-1;0===t.bl_count[d];)d--}while(t.bl_count[d]--,t.bl_count[d+1]+=2,t.bl_count[h]--,0<(m-=2));for(d=h;0!==d;d--)for(l=t.bl_count[d];0!==l;)n<(f=t.heap[--u])||(r[2*f+1]!==d&&(t.opt_len+=(d-r[2*f+1])*r[2*f],r[2*f+1]=d),l--)}}function q(t,e,r){for(var n=new Array(y+1),i=0,s,a,s=1;s<=y;s++)n[s]=i=i+r[s-1]<<1;for(a=0;a<=e;a++){var o=t[2*a+1];0!==o&&(t[2*a]=Y(n[o]++,o))}}function J(){for(var t,e,r,n,i,s=new Array(y+1),r=0,n=0;n<p-1;n++)for(N[n]=r,t=0;t<1<<E[n];t++)F[r++]=n;for(F[r-1]=n,n=i=0;n<16;n++)for(U[n]=i,t=0;t<1<<A[n];t++)D[i++]=n;for(i>>=7;n<g;n++)for(U[n]=i<<7,t=0;t<1<<A[n]-7;t++)D[256+i++]=n;for(e=0;e<=y;e++)s[e]=0;for(t=0;t<=143;)R[2*t+1]=8,t++,s[8]++;for(;t<=255;)R[2*t+1]=9,t++,s[9]++;for(;t<=279;)R[2*t+1]=7,t++,s[7]++;for(;t<=287;)R[2*t+1]=8,t++,s[8]++;for(q(R,_+1,s),t=0;t<g;t++)T[2*t+1]=5,T[2*t]=Y(t,5);P=new Z(R,E,m+1,_,y),L=new Z(T,A,0,g,y),j=new Z(new Array(0),I,0,b,k)}function Q(t){for(var e,e=0;e<_;e++)t.dyn_ltree[2*e]=0;for(e=0;e<g;e++)t.dyn_dtree[2*e]=0;for(e=0;e<b;e++)t.bl_tree[2*e]=0;t.dyn_ltree[2*x]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0}function $(t){8<t.bi_valid?H(t,t.bi_buf):0<t.bi_valid&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0}function tt(t,e,r,n){$(t),n&&(H(t,r),H(t,~r)),i.arraySet(t.pending_buf,t.window,e,r,t.pending),t.pending+=r}function et(t,e,r,n){var i=2*e,s=2*r;return t[i]<t[s]||t[i]===t[s]&&n[e]<=n[r]}function rt(t,e,r){for(var n=t.heap[r],i=r<<1;i<=t.heap_len&&(i<t.heap_len&&et(e,t.heap[i+1],t.heap[i],t.depth)&&i++,!et(e,n,t.heap[i],t.depth));)t.heap[r]=t.heap[i],r=i,i<<=1;t.heap[r]=n}function nt(t,e,r){var n,i,s=0,a,o;if(0!==t.last_lit)for(;n=t.pending_buf[t.d_buf+2*s]<<8|t.pending_buf[t.d_buf+2*s+1],i=t.pending_buf[t.l_buf+s],s++,0==n?K(t,i,e):(K(t,(a=F[i])+m+1,e),0!==(o=E[a])&&G(t,i-=N[a],o),K(t,a=M(--n),r),0!==(o=A[a])&&G(t,n-=U[a],o)),s<t.last_lit;);K(t,x,e)}function it(t,e){var r=e.dyn_tree,n=e.stat_desc.static_tree,i=e.stat_desc.has_stree,s=e.stat_desc.elems,a,o,h=-1,u;for(t.heap_len=0,t.heap_max=v,a=0;a<s;a++)0!==r[2*a]?(t.heap[++t.heap_len]=h=a,t.depth[a]=0):r[2*a+1]=0;for(;t.heap_len<2;)r[2*(u=t.heap[++t.heap_len]=h<2?++h:0)]=1,t.depth[u]=0,t.opt_len--,i&&(t.static_len-=n[2*u+1]);for(e.max_code=h,a=t.heap_len>>1;1<=a;a--)rt(t,r,a);for(u=s;a=t.heap[1],t.heap[1]=t.heap[t.heap_len--],rt(t,r,1),o=t.heap[1],t.heap[--t.heap_max]=a,t.heap[--t.heap_max]=o,r[2*u]=r[2*a]+r[2*o],t.depth[u]=(t.depth[a]>=t.depth[o]?t.depth[a]:t.depth[o])+1,r[2*a+1]=r[2*o+1]=u,t.heap[1]=u++,rt(t,r,1),2<=t.heap_len;);t.heap[--t.heap_max]=t.heap[1],V(t,e),q(r,h,t.bl_count)}function st(t,e,r){var n,i=-1,s,a=e[1],o=0,h=7,u=4;for(0===a&&(h=138,u=3),e[2*(r+1)+1]=65535,n=0;n<=r;n++)s=a,a=e[2*(n+1)+1],++o<h&&s===a||(o<u?t.bl_tree[2*s]+=o:0!==s?(s!==i&&t.bl_tree[2*s]++,t.bl_tree[2*S]++):o<=10?t.bl_tree[2*z]++:t.bl_tree[2*C]++,i=s,u=(o=0)===a?(h=138,3):s===a?(h=6,3):(h=7,4))}function at(t,e,r){var n,i=-1,s,a=e[1],o=0,h=7,u=4;for(0===a&&(h=138,u=3),n=0;n<=r;n++)if(s=a,a=e[2*(n+1)+1],!(++o<h&&s===a)){if(o<u)for(;K(t,s,t.bl_tree),0!=--o;);else 0!==s?(s!==i&&(K(t,s,t.bl_tree),o--),K(t,S,t.bl_tree),G(t,o-3,2)):o<=10?(K(t,z,t.bl_tree),G(t,o-3,3)):(K(t,C,t.bl_tree),G(t,o-11,7));i=s,u=(o=0)===a?(h=138,3):s===a?(h=6,3):(h=7,4)}}function ot(t){var e;for(st(t,t.dyn_ltree,t.l_desc.max_code),st(t,t.dyn_dtree,t.d_desc.max_code),it(t,t.bl_desc),e=b-1;3<=e&&0===t.bl_tree[2*O[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e}function ht(t,e,r,n){var i;for(G(t,e-257,5),G(t,r-1,5),G(t,n-4,4),i=0;i<n;i++)G(t,t.bl_tree[2*O[i]+1],3);at(t,t.dyn_ltree,e-1),at(t,t.dyn_dtree,r-1)}function ut(t){for(var e=4093624447,r,r=0;r<=31;r++,e>>>=1)if(1&e&&0!==t.dyn_ltree[2*r])return s;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return a;for(r=32;r<m;r++)if(0!==t.dyn_ltree[2*r])return a;return s}h(U);var lt=!1;function ft(t){lt||(J(),lt=!0),t.l_desc=new W(t.dyn_ltree,P),t.d_desc=new W(t.dyn_dtree,L),t.bl_desc=new W(t.bl_tree,j),t.bi_buf=0,t.bi_valid=0,Q(t)}function dt(t,e,r,n){G(t,0+(n?1:0),3),tt(t,e,r,!0)}function ct(t){G(t,2,3),K(t,x,R),X(t)}function pt(t,e,r,n){var i,s,a=0;0<t.level?(2===t.strm.data_type&&(t.strm.data_type=ut(t)),it(t,t.l_desc),it(t,t.d_desc),a=ot(t),i=t.opt_len+3+7>>>3,(s=t.static_len+3+7>>>3)<=i&&(i=s)):i=s=r+5,r+4<=i&&-1!==e?dt(t,e,r,n):4===t.strategy||s===i?(G(t,2+(n?1:0),3),nt(t,R,T)):(G(t,4+(n?1:0),3),ht(t,t.l_desc.max_code+1,t.d_desc.max_code+1,a+1),nt(t,t.dyn_ltree,t.dyn_dtree)),Q(t),n&&$(t)}function mt(t,e,r){return t.pending_buf[t.d_buf+2*t.last_lit]=e>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&e,t.pending_buf[t.l_buf+t.last_lit]=255&r,t.last_lit++,0===e?t.dyn_ltree[2*r]++:(t.matches++,e--,t.dyn_ltree[2*(F[r]+m+1)]++,t.dyn_dtree[2*M(e)]++),t.last_lit===t.lit_bufsize-1}r._tr_init=ft,r._tr_stored_block=dt,r._tr_flush_block=pt,r._tr_tally=mt,r._tr_align=ct},{"../utils/common":41}],53:[function(t,e,r){"use strict";function n(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}e.exports=n},{}],54:[function(t,e,r){"use strict";e.exports="function"==typeof setImmediate?setImmediate:function t(){var e=[].slice.apply(arguments);e.splice(1,0,0),setTimeout.apply(null,e)}},{}]},{},[10])(10)});gapp.register("ext", [], (root, exports) => {
const url = "data:text/javascript;base64,dmFyIE1vZHVsZT0oKCk9Pnt2YXIgTmE9aW1wb3J0Lm1ldGEudXJsO3JldHVybiBhc3luYyBmdW5jdGlvbihyPXt9KXt2YXIgeT1yLHQsbjt5LnJlYWR5PW5ldyBQcm9taXNlKChyLGUpPT57dD1yLG49ZX0pO3ZhciBnPSExO3kuc2V0dXA9ZnVuY3Rpb24oKXtpZighZyl7Zz0hMDtjb25zdCBtPXkuQ3Jvc3NTZWN0aW9uO3kuQ3Jvc3NTZWN0aW9uLnByb3RvdHlwZS50cmFuc2xhdGU9ZnVuY3Rpb24oLi4ucil7cmV0dXJuIHRoaXMuX1RyYW5zbGF0ZSh1KHIpKX0seS5Dcm9zc1NlY3Rpb24ucHJvdG90eXBlLnNjYWxlPWZ1bmN0aW9uKHIpe3JldHVybiJudW1iZXIiPT10eXBlb2Ygcj90aGlzLl9TY2FsZSh7eDpyLHk6cn0pOnRoaXMuX1NjYWxlKHUoW3JdKSl9LHkuQ3Jvc3NTZWN0aW9uLnByb3RvdHlwZS5taXJyb3I9ZnVuY3Rpb24ocil7cmV0dXJuIHRoaXMuX01pcnJvcih1KFtyXSkpfSx5LkNyb3NzU2VjdGlvbi5wcm90b3R5cGUud2FycD1mdW5jdGlvbihvKXt2YXIgcj1zbyhmdW5jdGlvbihyKXt2YXIgZSx0LG49W3ByKHIsImZsb2F0IikscHIocis0LCJmbG9hdCIpXTtvKG4pLG1yKHIsblswXSwiZmxvYXQiKSxtcihyKzQsblsxXSwiZmxvYXQiKX0sInZpIiksZT10aGlzLl9XYXJwKHIpO3JldHVybiB1byhyKSxlfSx5LkNyb3NzU2VjdGlvbi5wcm90b3R5cGUuZGVjb21wb3NlPWZ1bmN0aW9uKCl7Y29uc3Qgcj10aGlzLl9EZWNvbXBvc2UoKTt2YXIgZT1hKHIpO3JldHVybiByLmRlbGV0ZSgpLGV9LHkuQ3Jvc3NTZWN0aW9uLnByb3RvdHlwZS5ib3VuZHM9ZnVuY3Rpb24oKXtjb25zdCBlPXRoaXMuX0JvdW5kcygpO3JldHVybnttaW46WyJ4IiwieSJdLm1hcChyPT5lLm1pbltyXSksbWF4OlsieCIsInkiXS5tYXAocj0+ZS5tYXhbcl0pfX0seS5Dcm9zc1NlY3Rpb24ucHJvdG90eXBlLm9mZnNldD1mdW5jdGlvbihyLGU9IlNxdWFyZSIsdD0yLG49MCl7cmV0dXJuIHRoaXMuX09mZnNldChyLGQoZSksdCxuKX0seS5Dcm9zc1NlY3Rpb24ucHJvdG90eXBlLmV4dHJ1ZGU9ZnVuY3Rpb24ocixlPTAsdD0wLG49WzEsMV0sbz0hMSl7bj11KFtuXSk7Y29uc3QgYT15Ll9FeHRydWRlKHRoaXMscixlLHQsbik7cmV0dXJuIG8/YS50cmFuc2xhdGUoWzAsMCwtci8yXSk6YX0seS5Dcm9zc1NlY3Rpb24ucHJvdG90eXBlLnJldm9sdmU9ZnVuY3Rpb24ocj0wLGU9MzYwKXtyZXR1cm4geS5fUmV2b2x2ZSh0aGlzLHIsZSl9LHkuQ3Jvc3NTZWN0aW9uLnByb3RvdHlwZS5hZGQ9ZnVuY3Rpb24ocil7cmV0dXJuIHRoaXMuX2FkZChmKHIpKX0seS5Dcm9zc1NlY3Rpb24ucHJvdG90eXBlLnN1YnRyYWN0PWZ1bmN0aW9uKHIpe3JldHVybiB0aGlzLl9zdWJ0cmFjdChmKHIpKX0seS5Dcm9zc1NlY3Rpb24ucHJvdG90eXBlLmludGVyc2VjdD1mdW5jdGlvbihyKXtyZXR1cm4gdGhpcy5faW50ZXJzZWN0KGYocikpfSx5LkNyb3NzU2VjdGlvbi5wcm90b3R5cGUudG9Qb2x5Z29ucz1mdW5jdGlvbigpe2NvbnN0IHI9dGhpcy5fVG9Qb2x5Z29ucygpO3ZhciBlPXQocik7cmV0dXJuIHIuZGVsZXRlKCksZX0seS5NYW5pZm9sZC5wcm90b3R5cGUuc21vb3RoT3V0PWZ1bmN0aW9uKHI9NjAsZT0wKXtyZXR1cm4gdGhpcy5fU21vb3RoT3V0KHIsZSl9LHkuTWFuaWZvbGQucHJvdG90eXBlLndhcnA9ZnVuY3Rpb24oYSl7dmFyIHI9c28oZnVuY3Rpb24ocil7dmFyIGUsdCxuLG89W3ByKHIsImZsb2F0IikscHIocis0LCJmbG9hdCIpLHByKHIrOCwiZmxvYXQiKV07YShvKSxtcihyLG9bMF0sImZsb2F0IiksbXIocis0LG9bMV0sImZsb2F0IiksbXIocis4LG9bMl0sImZsb2F0Iil9LCJ2aSIpO2NvbnN0IGU9dGhpcy5fV2FycChyKTt1byhyKTt2YXIgdD1lLnN0YXR1cygpO2lmKDAhPT10LnZhbHVlKXRocm93IG5ldyB5Lk1hbmlmb2xkRXJyb3IodC52YWx1ZSk7cmV0dXJuIGV9LHkuTWFuaWZvbGQucHJvdG90eXBlLmNhbGN1bGF0ZU5vcm1hbHM9ZnVuY3Rpb24ocixlPTYwKXtyZXR1cm4gdGhpcy5fQ2FsY3VsYXRlTm9ybWFscyhyLGUpfSx5Lk1hbmlmb2xkLnByb3RvdHlwZS5zZXRQcm9wZXJ0aWVzPWZ1bmN0aW9uKHMscil7Y29uc3QgdT10aGlzLm51bVByb3AoKTt2YXIgZT1zbyhmdW5jdGlvbihlLHQsbil7Y29uc3Qgbz1bXTtmb3IobGV0IHI9MDtyPHM7KytyKW9bcl09cHIoZSs0KnIsImZsb2F0Iik7Y29uc3QgYT1bXTtmb3IobGV0IHI9MDtyPDM7KytyKWFbcl09cHIodCs0KnIsImZsb2F0Iik7Y29uc3QgaT1bXTtmb3IobGV0IHI9MDtyPHU7KytyKWlbcl09cHIobis0KnIsImZsb2F0Iik7cihvLGEsaSk7Zm9yKGxldCByPTA7cjxzOysrciltcihlKzQqcixvW3JdLCJmbG9hdCIpfSwidmlpaSIpLHQ9dGhpcy5fU2V0UHJvcGVydGllcyhzLGUpO3JldHVybiB1byhlKSx0fSx5Lk1hbmlmb2xkLnByb3RvdHlwZS50cmFuc2xhdGU9ZnVuY3Rpb24oLi4ucil7cmV0dXJuIHRoaXMuX1RyYW5zbGF0ZShsKHIpKX0seS5NYW5pZm9sZC5wcm90b3R5cGUucm90YXRlPWZ1bmN0aW9uKHIsZSx0KXtyZXR1cm4gQXJyYXkuaXNBcnJheShyKT90aGlzLl9Sb3RhdGUoLi4ucik6dGhpcy5fUm90YXRlKHIsZXx8MCx0fHwwKX0seS5NYW5pZm9sZC5wcm90b3R5cGUuc2NhbGU9ZnVuY3Rpb24ocil7cmV0dXJuIm51bWJlciI9PXR5cGVvZiByP3RoaXMuX1NjYWxlKHt4OnIseTpyLHo6cn0pOnRoaXMuX1NjYWxlKGwoW3JdKSl9LHkuTWFuaWZvbGQucHJvdG90eXBlLm1pcnJvcj1mdW5jdGlvbihyKXtyZXR1cm4gdGhpcy5fTWlycm9yKGwoW3JdKSl9LHkuTWFuaWZvbGQucHJvdG90eXBlLnRyaW1CeVBsYW5lPWZ1bmN0aW9uKHIsZT0wKXtyZXR1cm4gdGhpcy5fVHJpbUJ5UGxhbmUobChbcl0pLGUpfSx5Lk1hbmlmb2xkLnByb3RvdHlwZS5zbGljZT1mdW5jdGlvbihyPTApe3JldHVybiB0aGlzLl9TbGljZShyKX0seS5NYW5pZm9sZC5wcm90b3R5cGUuc3BsaXQ9ZnVuY3Rpb24ocil7Y29uc3QgZT10aGlzLl9TcGxpdChyKTt2YXIgdD1hKGUpO3JldHVybiBlLmRlbGV0ZSgpLHR9LHkuTWFuaWZvbGQucHJvdG90eXBlLnNwbGl0QnlQbGFuZT1mdW5jdGlvbihyLGU9MCl7Y29uc3QgdD10aGlzLl9TcGxpdEJ5UGxhbmUobChbcl0pLGUpO3ZhciBuPWEodCk7cmV0dXJuIHQuZGVsZXRlKCksbn0seS5NYW5pZm9sZC5wcm90b3R5cGUuZGVjb21wb3NlPWZ1bmN0aW9uKCl7Y29uc3Qgcj10aGlzLl9EZWNvbXBvc2UoKTt2YXIgZT1hKHIpO3JldHVybiByLmRlbGV0ZSgpLGV9LHkuTWFuaWZvbGQucHJvdG90eXBlLmJvdW5kaW5nQm94PWZ1bmN0aW9uKCl7Y29uc3QgZT10aGlzLl9ib3VuZGluZ0JveCgpO3JldHVybnttaW46WyJ4IiwieSIsInoiXS5tYXAocj0+ZS5taW5bcl0pLG1heDpbIngiLCJ5IiwieiJdLm1hcChyPT5lLm1heFtyXSl9fTtjbGFzcyBue2NvbnN0cnVjdG9yKHtudW1Qcm9wOnI9Myx0cmlWZXJ0czplPW5ldyBVaW50MzJBcnJheSx2ZXJ0UHJvcGVydGllczp0PW5ldyBGbG9hdDMyQXJyYXksbWVyZ2VGcm9tVmVydDpuLG1lcmdlVG9WZXJ0Om8scnVuSW5kZXg6YSxydW5PcmlnaW5hbElEOmksZmFjZUlEOnMsaGFsZmVkZ2VUYW5nZW50OnUscnVuVHJhbnNmb3JtOmx9PXt9KXt0aGlzLm51bVByb3A9cix0aGlzLnRyaVZlcnRzPWUsdGhpcy52ZXJ0UHJvcGVydGllcz10LHRoaXMubWVyZ2VGcm9tVmVydD1uLHRoaXMubWVyZ2VUb1ZlcnQ9byx0aGlzLnJ1bkluZGV4PWEsdGhpcy5ydW5PcmlnaW5hbElEPWksdGhpcy5mYWNlSUQ9cyx0aGlzLmhhbGZlZGdlVGFuZ2VudD11LHRoaXMucnVuVHJhbnNmb3JtPWx9Z2V0IG51bVRyaSgpe3JldHVybiB0aGlzLnRyaVZlcnRzLmxlbmd0aC8zfWdldCBudW1WZXJ0KCl7cmV0dXJuIHRoaXMudmVydFByb3BlcnRpZXMubGVuZ3RoL3RoaXMubnVtUHJvcH1nZXQgbnVtUnVuKCl7cmV0dXJuIHRoaXMucnVuT3JpZ2luYWxJRC5sZW5ndGh9bWVyZ2UoKXt2YXJ7Y2hhbmdlZDpyLG1lc2g6ZX09eS5fTWVyZ2UodGhpcyk7cmV0dXJuIE9iamVjdC5hc3NpZ24odGhpcyx7Li4uZX0pLHJ9dmVydHMocil7cmV0dXJuIHRoaXMudHJpVmVydHMuc3ViYXJyYXkoMypyLDMqKHIrMSkpfXBvc2l0aW9uKHIpe3JldHVybiB0aGlzLnZlcnRQcm9wZXJ0aWVzLnN1YmFycmF5KG51bVByb3AqcixudW1Qcm9wKnIrMyl9ZXh0cmFzKHIpe3JldHVybiB0aGlzLnZlcnRQcm9wZXJ0aWVzLnN1YmFycmF5KG51bVByb3AqciszLG51bVByb3AqKHIrMSkpfXRhbmdlbnQocil7cmV0dXJuIHRoaXMuaGFsZmVkZ2VUYW5nZW50LnN1YmFycmF5KDQqciw0KihyKzEpKX10cmFuc2Zvcm0ocil7Y29uc3QgZT1uZXcgQXJyYXkoMTYpO2Zvcihjb25zdCB0IG9mWzAsMSwyLDNdKWZvcihjb25zdCBuIG9mWzAsMSwyXSllWzQqdCtuXT10aGlzLnJ1blRyYW5zZm9ybVsxMipyKzMqdCtuXTtyZXR1cm4gZVsxNV09MSxlfX15Lk1lc2g9bix5Lk1hbmlmb2xkLnByb3RvdHlwZS5nZXRNZXNoPWZ1bmN0aW9uKHI9WzAsMCwwXSl7cmV0dXJuIHIgaW5zdGFuY2VvZiBBcnJheSYmKHI9ezA6clswXSwxOnJbMV0sMjpyWzJdfSksbmV3IG4odGhpcy5fR2V0TWVzaEpTKHIpKX0seS5NYW5pZm9sZEVycm9yPWZ1bmN0aW9uIHIoZSwuLi50KXtsZXQgbj0iVW5rbm93biBlcnJvciI7c3dpdGNoKGUpe2Nhc2UgeS5zdGF0dXMuTm9uRmluaXRlVmVydGV4LnZhbHVlOm49Ik5vbi1maW5pdGUgdmVydGV4IjticmVhaztjYXNlIHkuc3RhdHVzLk5vdE1hbmlmb2xkLnZhbHVlOm49Ik5vdCBtYW5pZm9sZCI7YnJlYWs7Y2FzZSB5LnN0YXR1cy5WZXJ0ZXhPdXRPZkJvdW5kcy52YWx1ZTpuPSJWZXJ0ZXggaW5kZXggb3V0IG9mIGJvdW5kcyI7YnJlYWs7Y2FzZSB5LnN0YXR1cy5Qcm9wZXJ0aWVzV3JvbmdMZW5ndGgudmFsdWU6bj0iUHJvcGVydGllcyBoYXZlIHdyb25nIGxlbmd0aCI7YnJlYWs7Y2FzZSB5LnN0YXR1cy5NaXNzaW5nUG9zaXRpb25Qcm9wZXJ0aWVzLnZhbHVlOm49Ikxlc3MgdGhhbiB0aHJlZSBwcm9wZXJ0aWVzIjticmVhaztjYXNlIHkuc3RhdHVzLk1lcmdlVmVjdG9yc0RpZmZlcmVudExlbmd0aHMudmFsdWU6bj0iTWVyZ2UgdmVjdG9ycyBoYXZlIGRpZmZlcmVudCBsZW5ndGhzIjticmVhaztjYXNlIHkuc3RhdHVzLk1lcmdlSW5kZXhPdXRPZkJvdW5kcy52YWx1ZTpuPSJNZXJnZSBpbmRleCBvdXQgb2YgYm91bmRzIjticmVhaztjYXNlIHkuc3RhdHVzLlRyYW5zZm9ybVdyb25nTGVuZ3RoLnZhbHVlOm49IlRyYW5zZm9ybSB2ZWN0b3IgaGFzIHdyb25nIGxlbmd0aCI7YnJlYWs7Y2FzZSB5LnN0YXR1cy5SdW5JbmRleFdyb25nTGVuZ3RoLnZhbHVlOm49IlJ1biBpbmRleCB2ZWN0b3IgaGFzIHdyb25nIGxlbmd0aCI7YnJlYWs7Y2FzZSB5LnN0YXR1cy5GYWNlSURXcm9uZ0xlbmd0aC52YWx1ZTpuPSJGYWNlIElEIHZlY3RvciBoYXMgd3JvbmcgbGVuZ3RoIjtjYXNlIHkuc3RhdHVzLkludmFsaWRDb25zdHJ1Y3Rpb24udmFsdWU6bj0iTWFuaWZvbGQgY29uc3RydWN0ZWQgd2l0aCBpbnZhbGlkIHBhcmFtZXRlcnMifWNvbnN0IG89RXJyb3IuYXBwbHkodGhpcyxbbiwuLi50XSk7by5uYW1lPXRoaXMubmFtZT0iTWFuaWZvbGRFcnJvciIsdGhpcy5tZXNzYWdlPW8ubWVzc2FnZSx0aGlzLnN0YWNrPW8uc3RhY2ssdGhpcy5jb2RlPWV9LHkuTWFuaWZvbGRFcnJvci5wcm90b3R5cGU9T2JqZWN0LmNyZWF0ZShFcnJvci5wcm90b3R5cGUse2NvbnN0cnVjdG9yOnt2YWx1ZTp5Lk1hbmlmb2xkRXJyb3Isd3JpdGFibGU6ITAsY29uZmlndXJhYmxlOiEwfX0pLHkuQ3Jvc3NTZWN0aW9uPWZ1bmN0aW9uKHIsZT0iUG9zaXRpdmUiKXt2YXIgdD1pKHIpLG49bmV3IG0odCxjKGUpKTtyZXR1cm4gcyh0KSxufSx5LkNyb3NzU2VjdGlvbi5vZlBvbHlnb25zPWZ1bmN0aW9uKHIsZT0iUG9zaXRpdmUiKXtyZXR1cm4gbmV3IHkuQ3Jvc3NTZWN0aW9uKHIsZSl9LHkuQ3Jvc3NTZWN0aW9uLnNxdWFyZT1mdW5jdGlvbiguLi5yKXtsZXQgZT12b2lkIDA7ZT0wPT1yLmxlbmd0aD97eDoxLHk6MX06Im51bWJlciI9PXR5cGVvZiByWzBdP3t4OnJbMF0seTpyWzBdfTp1KHIpO3ZhciB0PXJbMV18fCExO3JldHVybiB5Ll9TcXVhcmUoZSx0KX0seS5Dcm9zc1NlY3Rpb24uY2lyY2xlPWZ1bmN0aW9uKHIsZT0wKXtyZXR1cm4geS5fQ2lyY2xlKHIsZSl9LHkuQ3Jvc3NTZWN0aW9uLmNvbXBvc2U9cigiQ29tcG9zZSIpLHkuQ3Jvc3NTZWN0aW9uLnVuaW9uPXIoIlVuaW9uTiIpLHkuQ3Jvc3NTZWN0aW9uLmRpZmZlcmVuY2U9cigiRGlmZmVyZW5jZU4iKSx5LkNyb3NzU2VjdGlvbi5pbnRlcnNlY3Rpb249cigiSW50ZXJzZWN0aW9uTiIpLHkuQ3Jvc3NTZWN0aW9uLmh1bGw9ZnVuY3Rpb24oLi4ucil7MT09ci5sZW5ndGgmJihyPXJbMF0pO2xldCBlPW5ldyB5LlZlY3Rvcl92ZWMyO2Zvcihjb25zdCBhIG9mIHIpaWYoYSBpbnN0YW5jZW9mIG0peS5fY3Jvc3NTZWN0aW9uQ29sbGVjdFZlcnRpY2VzKGUsYSk7ZWxzZSBpZihhIGluc3RhbmNlb2YgQXJyYXkmJjI9PWEubGVuZ3RoJiYibnVtYmVyIj09dHlwZW9mIGFbMF0pZS5wdXNoX2JhY2soe3g6YVswXSx5OmFbMV19KTtlbHNlIGlmKGEueCllLnB1c2hfYmFjayhhKTtlbHNle3ZhciB0LG47Zm9yKGNvbnN0IGkgb2YgMj09YVswXS5sZW5ndGgmJiJudW1iZXIiPT10eXBlb2YgYVswXVswXXx8YVswXS54P1thXTphKWgoZSxpKX12YXIgbz15Ll9jcm9zc1NlY3Rpb25IdWxsUG9pbnRzKGUpO3JldHVybiBlLmRlbGV0ZSgpLG99LHkuQ3Jvc3NTZWN0aW9uLnByb3RvdHlwZT1PYmplY3QuY3JlYXRlKG0ucHJvdG90eXBlKSxPYmplY3QuZGVmaW5lUHJvcGVydHkoeS5Dcm9zc1NlY3Rpb24sU3ltYm9sLmhhc0luc3RhbmNlLHtnZXQ6KCk9PnI9PnIgaW5zdGFuY2VvZiBtfSk7Y29uc3Qgdj15Lk1hbmlmb2xkO2Z1bmN0aW9uIG8ocixlLHQ9cj0+cil7aWYoZSlmb3IodmFyIG4gb2YgZSlyLnB1c2hfYmFjayh0KG4pKTtyZXR1cm4gcn1mdW5jdGlvbiBhKGUsdD1yPT5yKXtjb25zdCBuPVtdO3ZhciBvPWUuc2l6ZSgpO2ZvcihsZXQgcj0wO3I8bztyKyspbi5wdXNoKHQoZS5nZXQocikpKTtyZXR1cm4gbn1mdW5jdGlvbiB0KGUsdD1yPT5yKXtjb25zdCBuPVtdO3ZhciBvPWUuc2l6ZSgpO2ZvcihsZXQgcj0wO3I8bztyKyspe2NvbnN0IGk9ZS5nZXQocik7dmFyIGE9aS5zaXplKCk7Y29uc3Qgcz1bXTtmb3IobGV0IHI9MDtyPGE7cisrKXMucHVzaCh0KGkuZ2V0KHIpKSk7bi5wdXNoKHMpfXJldHVybiBufWZ1bmN0aW9uIGkocil7cmV0dXJuIHJbMF0ubGVuZ3RoPDMmJihyPVtyXSksbyhuZXcgeS5WZWN0b3IyX3ZlYzIscixyPT5vKG5ldyB5LlZlY3Rvcl92ZWMyLHIscj0+ciBpbnN0YW5jZW9mIEFycmF5P3t4OnJbMF0seTpyWzFdfTpyKSl9ZnVuY3Rpb24gcyhlKXtmb3IobGV0IHI9MDtyPGUuc2l6ZSgpO3IrKyllLmdldChyKS5kZWxldGUoKTtlLmRlbGV0ZSgpfWZ1bmN0aW9uIHUocil7cmV0dXJuIHJbMF1pbnN0YW5jZW9mIEFycmF5P3t4OnJbMF1bMF0seTpyWzBdWzFdfToibnVtYmVyIj09dHlwZW9mIHJbMF0/e3g6clswXXx8MCx5OnJbMV18fDB9OnJbMF19ZnVuY3Rpb24gbChyKXtyZXR1cm4gclswXWluc3RhbmNlb2YgQXJyYXk/e3g6clswXVswXSx5OnJbMF1bMV0sejpyWzBdWzJdfToibnVtYmVyIj09dHlwZW9mIHJbMF0/e3g6clswXXx8MCx5OnJbMV18fDAsejpyWzJdfHwwfTpyWzBdfWZ1bmN0aW9uIGMocil7cmV0dXJuIkV2ZW5PZGQiPT1yPzA6Ik5vblplcm8iPT1yPzE6Ik5lZ2F0aXZlIj09cj8zOjJ9ZnVuY3Rpb24gZChyKXtyZXR1cm4iUm91bmQiPT1yPzE6Ik1pdGVyIj09cj8yOjB9ZnVuY3Rpb24gZihyLGU9IlBvc2l0aXZlIil7aWYociBpbnN0YW5jZW9mIG0pcmV0dXJuIHI7dmFyIHQ9aShyKSxuPW5ldyBtKHQsYyhlKSk7cmV0dXJuIHModCksbn1mdW5jdGlvbiByKG8pe3JldHVybiBmdW5jdGlvbiguLi5yKXsxPT1yLmxlbmd0aCYmKHI9clswXSk7Y29uc3QgZT1uZXcgeS5WZWN0b3JfY3Jvc3NTZWN0aW9uO2Zvcihjb25zdCBuIG9mIHIpZS5wdXNoX2JhY2soZihuKSk7dmFyIHQ9eVsiX2Nyb3NzU2VjdGlvbiIrb10oZSk7cmV0dXJuIGUuZGVsZXRlKCksdH19ZnVuY3Rpb24gaChyLGUpe28ocixlLHI9PnIgaW5zdGFuY2VvZiBBcnJheT97eDpyWzBdLHk6clsxXX06cil9ZnVuY3Rpb24gZShvKXtyZXR1cm4gZnVuY3Rpb24oLi4ucil7MT09ci5sZW5ndGgmJihyPXJbMF0pO2NvbnN0IGU9bmV3IHkuVmVjdG9yX21hbmlmb2xkO2Zvcihjb25zdCBuIG9mIHIpZS5wdXNoX2JhY2sobik7dmFyIHQ9eVsiX21hbmlmb2xkIitvKyJOIl0oZSk7cmV0dXJuIGUuZGVsZXRlKCksdH19ZnVuY3Rpb24gcChyLGUpe28ocixlLHI9PnIgaW5zdGFuY2VvZiBBcnJheT97eDpyWzBdLHk6clsxXSx6OnJbMl19OnIpfXkuTWFuaWZvbGQ9ZnVuY3Rpb24ocil7Y29uc3QgZT1uZXcgdihyKTt2YXIgdD1lLnN0YXR1cygpO2lmKDAhPT10LnZhbHVlKXRocm93IG5ldyB5Lk1hbmlmb2xkRXJyb3IodC52YWx1ZSk7cmV0dXJuIGV9LHkuTWFuaWZvbGQub2ZNZXNoPWZ1bmN0aW9uKHIpe3JldHVybiBuZXcgeS5NYW5pZm9sZChyKX0seS5NYW5pZm9sZC50ZXRyYWhlZHJvbj1mdW5jdGlvbigpe3JldHVybiB5Ll9UZXRyYWhlZHJvbigpfSx5Lk1hbmlmb2xkLmN1YmU9ZnVuY3Rpb24oLi4ucil7bGV0IGU9dm9pZCAwO2U9MD09ci5sZW5ndGg/e3g6MSx5OjEsejoxfToibnVtYmVyIj09dHlwZW9mIHJbMF0/e3g6clswXSx5OnJbMF0sejpyWzBdfTpsKHIpO3ZhciB0PXJbMV18fCExO3JldHVybiB5Ll9DdWJlKGUsdCl9LHkuTWFuaWZvbGQuY3lsaW5kZXI9ZnVuY3Rpb24ocixlLHQ9LTEsbj0wLG89ITEpe3JldHVybiB5Ll9DeWxpbmRlcihyLGUsdCxuLG8pfSx5Lk1hbmlmb2xkLnNwaGVyZT1mdW5jdGlvbihyLGU9MCl7cmV0dXJuIHkuX1NwaGVyZShyLGUpfSx5Lk1hbmlmb2xkLnNtb290aD1mdW5jdGlvbihyLGU9W10pe2NvbnN0IHQ9bmV3IHkuVmVjdG9yX3Ntb290aG5lc3M7byh0LGUpO3ZhciBuPXkuX1Ntb290aChyLHQpO3JldHVybiB0LmRlbGV0ZSgpLG59LHkuTWFuaWZvbGQuZXh0cnVkZT1mdW5jdGlvbihyLGUsdD0wLG49MCxvPVsxLDFdLGE9ITEpe2NvbnN0IGk9ciBpbnN0YW5jZW9mIG0/cjp5LkNyb3NzU2VjdGlvbihyLCJQb3NpdGl2ZSIpO3JldHVybiBpLmV4dHJ1ZGUoZSx0LG4sbyxhKX0seS5NYW5pZm9sZC5yZXZvbHZlPWZ1bmN0aW9uKHIsZT0wLHQ9MzYwKXtjb25zdCBuPXIgaW5zdGFuY2VvZiBtP3I6eS5Dcm9zc1NlY3Rpb24ociwiUG9zaXRpdmUiKTtyZXR1cm4gbi5yZXZvbHZlKGUsdCl9LHkuTWFuaWZvbGQucmVzZXJ2ZUlEcz1mdW5jdGlvbihyKXtyZXR1cm4geS5fUmVzZXJ2ZUlEcyhyKX0seS5NYW5pZm9sZC5jb21wb3NlPWZ1bmN0aW9uKHIpe2NvbnN0IGU9bmV3IHkuVmVjdG9yX21hbmlmb2xkO28oZSxyKTt2YXIgdD15Ll9tYW5pZm9sZENvbXBvc2UoZSk7cmV0dXJuIGUuZGVsZXRlKCksdH0seS5NYW5pZm9sZC51bmlvbj1lKCJVbmlvbiIpLHkuTWFuaWZvbGQuZGlmZmVyZW5jZT1lKCJEaWZmZXJlbmNlIikseS5NYW5pZm9sZC5pbnRlcnNlY3Rpb249ZSgiSW50ZXJzZWN0aW9uIikseS5NYW5pZm9sZC5sZXZlbFNldD1mdW5jdGlvbihhLHIsZSx0PTApe3ZhciBuPXttaW46e3g6ci5taW5bMF0seTpyLm1pblsxXSx6OnIubWluWzJdfSxtYXg6e3g6ci5tYXhbMF0seTpyLm1heFsxXSx6OnIubWF4WzJdfX0sbz1zbyhmdW5jdGlvbihyKXt2YXIgZT1wcihyLCJmbG9hdCIpLHQ9cHIocis0LCJmbG9hdCIpLG49cHIocis4LCJmbG9hdCIpLG87cmV0dXJuIGEoW2UsdCxuXSl9LCJmaSIpLGk9eS5fTGV2ZWxTZXQobyxuLGUsdCk7cmV0dXJuIHVvKG8pLGl9LHkuTWFuaWZvbGQuaHVsbD1mdW5jdGlvbiguLi5yKXsxPT1yLmxlbmd0aCYmKHI9clswXSk7bGV0IGU9bmV3IHkuVmVjdG9yX3ZlYzM7Zm9yKGNvbnN0IG4gb2YgciluIGluc3RhbmNlb2Ygdj95Ll9tYW5pZm9sZENvbGxlY3RWZXJ0aWNlcyhlLG4pOm4gaW5zdGFuY2VvZiBBcnJheSYmMz09bi5sZW5ndGgmJiJudW1iZXIiPT10eXBlb2YgblswXT9lLnB1c2hfYmFjayh7eDpuWzBdLHk6blsxXSx6Om5bMl19KTpuLng/ZS5wdXNoX2JhY2sobik6cChlLG4pO3ZhciB0PXkuX21hbmlmb2xkSHVsbFBvaW50cyhlKTtyZXR1cm4gZS5kZWxldGUoKSx0fSx5Lk1hbmlmb2xkLnByb3RvdHlwZT1PYmplY3QuY3JlYXRlKHYucHJvdG90eXBlKSxPYmplY3QuZGVmaW5lUHJvcGVydHkoeS5NYW5pZm9sZCxTeW1ib2wuaGFzSW5zdGFuY2Use2dldDooKT0+cj0+ciBpbnN0YW5jZW9mIHZ9KSx5LnRyaWFuZ3VsYXRlPWZ1bmN0aW9uKHIsZT0tMSl7dmFyIHQ9aShyKSxuPWEoeS5fVHJpYW5ndWxhdGUodCxlKSxyPT5bclswXSxyWzFdLHJbMl1dKTtyZXR1cm4gcyh0KSxufX19O3ZhciBlPU9iamVjdC5hc3NpZ24oe30seSksbz1bXSxhPSIuL3RoaXMucHJvZ3JhbSIsaT0ocixlKT0+e3Rocm93IGV9LHM9Im9iamVjdCI9PXR5cGVvZiB3aW5kb3csZj0iZnVuY3Rpb24iPT10eXBlb2YgaW1wb3J0U2NyaXB0cyx1PSJvYmplY3QiPT10eXBlb2YgcHJvY2VzcyYmIm9iamVjdCI9PXR5cGVvZiBwcm9jZXNzLnZlcnNpb25zJiYic3RyaW5nIj09dHlwZW9mIHByb2Nlc3MudmVyc2lvbnMubm9kZSxsPSIiLGMsZCxoLHA7ZnVuY3Rpb24gbShyKXtyZXR1cm4geS5sb2NhdGVGaWxlP3kubG9jYXRlRmlsZShyLGwpOmwrcn1pZih1KXtjb25zdHtjcmVhdGVSZXF1aXJlOnphfT1hd2FpdCBpbXBvcnQoIm1vZHVsZSIpO3ZhciB2PXphKGltcG9ydC5tZXRhLnVybCksdz12KCJmcyIpLF89digicGF0aCIpLGw9Zj9fLmRpcm5hbWUobCkrIi8iOnYoInVybCIpLmZpbGVVUkxUb1BhdGgobmV3IFVSTCgiLi8iLGltcG9ydC5tZXRhLnVybCkpLGM9KHIsZSk9PihyPXNyKHIpP25ldyBVUkwocik6Xy5ub3JtYWxpemUociksdy5yZWFkRmlsZVN5bmMocixlP3ZvaWQgMDoidXRmOCIpKSxoPXI9Pnt2YXIgZT1jKHIsITApO3JldHVybiBlPSFlLmJ1ZmZlcj9uZXcgVWludDhBcnJheShlKTplfSxkPShyLHQsbixvPSEwKT0+e3I9c3Iocik/bmV3IFVSTChyKTpfLm5vcm1hbGl6ZShyKSx3LnJlYWRGaWxlKHIsbz92b2lkIDA6InV0ZjgiLChyLGUpPT57cj9uKHIpOnQobz9lLmJ1ZmZlcjplKX0pfTsheS50aGlzUHJvZ3JhbSYmMTxwcm9jZXNzLmFyZ3YubGVuZ3RoJiYoYT1wcm9jZXNzLmFyZ3ZbMV0ucmVwbGFjZSgvXFwvZywiLyIpKSxvPXByb2Nlc3MuYXJndi5zbGljZSgyKSxpPShyLGUpPT57dGhyb3cgcHJvY2Vzcy5leGl0Q29kZT1yLGV9LHkuaW5zcGVjdD0oKT0+IltFbXNjcmlwdGVuIE1vZHVsZSBvYmplY3RdIn1lbHNlKHN8fGYpJiYoZj9sPXNlbGYubG9jYXRpb24uaHJlZjoidW5kZWZpbmVkIiE9dHlwZW9mIGRvY3VtZW50JiZkb2N1bWVudC5jdXJyZW50U2NyaXB0JiYobD1kb2N1bWVudC5jdXJyZW50U2NyaXB0LnNyYyksbD0wIT09KGw9TmE/TmE6bCkuaW5kZXhPZigiYmxvYjoiKT9sLnN1YnN0cigwLGwucmVwbGFjZSgvWz8jXS4qLywiIikubGFzdEluZGV4T2YoIi8iKSsxKToiIixjPXI9Pnt2YXIgZT1uZXcgWE1MSHR0cFJlcXVlc3Q7cmV0dXJuIGUub3BlbigiR0VUIixyLCExKSxlLnNlbmQobnVsbCksZS5yZXNwb25zZVRleHR9LGYmJihoPXI9Pnt2YXIgZT1uZXcgWE1MSHR0cFJlcXVlc3Q7cmV0dXJuIGUub3BlbigiR0VUIixyLCExKSxlLnJlc3BvbnNlVHlwZT0iYXJyYXlidWZmZXIiLGUuc2VuZChudWxsKSxuZXcgVWludDhBcnJheShlLnJlc3BvbnNlKX0pLGQ9KHIsZSx0KT0+e3ZhciBuPW5ldyBYTUxIdHRwUmVxdWVzdDtuLm9wZW4oIkdFVCIsciwhMCksbi5yZXNwb25zZVR5cGU9ImFycmF5YnVmZmVyIixuLm9ubG9hZD0oKT0+ezIwMD09bi5zdGF0dXN8fDA9PW4uc3RhdHVzJiZuLnJlc3BvbnNlP2Uobi5yZXNwb25zZSk6dCgpfSxuLm9uZXJyb3I9dCxuLnNlbmQobnVsbCl9LHA9cj0+ZG9jdW1lbnQudGl0bGU9cik7dmFyIGI9eS5wcmludHx8Y29uc29sZS5sb2cuYmluZChjb25zb2xlKSxFPXkucHJpbnRFcnJ8fGNvbnNvbGUuZXJyb3IuYmluZChjb25zb2xlKSxrO09iamVjdC5hc3NpZ24oeSxlKSxlPW51bGwseS5hcmd1bWVudHMmJihvPXkuYXJndW1lbnRzKSx5LnRoaXNQcm9ncmFtJiYoYT15LnRoaXNQcm9ncmFtKSx5LnF1aXQmJihpPXkucXVpdCkseS53YXNtQmluYXJ5JiYoaz15Lndhc21CaW5hcnkpO3ZhciBQPXkubm9FeGl0UnVudGltZXx8ITAsQzsib2JqZWN0IiE9dHlwZW9mIFdlYkFzc2VtYmx5JiZlcigibm8gbmF0aXZlIHdhc20gc3VwcG9ydCBkZXRlY3RlZCIpO3ZhciBUPSExLFMsTSwkLEYsQSxELHgsaixPLFI7ZnVuY3Rpb24gVyhyLGUpe3J8fGVyKGUpfWZ1bmN0aW9uIHooKXt2YXIgcj1DLmJ1ZmZlcjt5LkhFQVA4PU09bmV3IEludDhBcnJheShyKSx5LkhFQVAxNj1GPW5ldyBJbnQxNkFycmF5KHIpLHkuSEVBUFU4PSQ9bmV3IFVpbnQ4QXJyYXkocikseS5IRUFQVTE2PUE9bmV3IFVpbnQxNkFycmF5KHIpLHkuSEVBUDMyPUQ9bmV3IEludDMyQXJyYXkocikseS5IRUFQVTMyPXg9bmV3IFVpbnQzMkFycmF5KHIpLHkuSEVBUEYzMj1qPW5ldyBGbG9hdDMyQXJyYXkocikseS5IRUFQRjY0PU89bmV3IEZsb2F0NjRBcnJheShyKX12YXIgTj1bXSxJPVtdLFY9W10sTD0hMTtmdW5jdGlvbiBCKCl7aWYoeS5wcmVSdW4pZm9yKCJmdW5jdGlvbiI9PXR5cGVvZiB5LnByZVJ1biYmKHkucHJlUnVuPVt5LnByZVJ1bl0pO3kucHJlUnVuLmxlbmd0aDspcSh5LnByZVJ1bi5zaGlmdCgpKTtocihOKX1mdW5jdGlvbiBVKCl7TD0hMCx5Lm5vRlNJbml0fHxBbi5pbml0LmluaXRpYWxpemVkfHxBbi5pbml0KCksQW4uaWdub3JlUGVybWlzc2lvbnM9ITEsRW4uaW5pdCgpLGhyKEkpfWZ1bmN0aW9uIEgoKXtpZih5LnBvc3RSdW4pZm9yKCJmdW5jdGlvbiI9PXR5cGVvZiB5LnBvc3RSdW4mJih5LnBvc3RSdW49W3kucG9zdFJ1bl0pO3kucG9zdFJ1bi5sZW5ndGg7KUcoeS5wb3N0UnVuLnNoaWZ0KCkpO2hyKFYpfWZ1bmN0aW9uIHEocil7Ti51bnNoaWZ0KHIpfWZ1bmN0aW9uIFkocil7SS51bnNoaWZ0KHIpfWZ1bmN0aW9uIEcocil7Vi51bnNoaWZ0KHIpfXZhciBYPTAsSz1udWxsLEo9bnVsbDtmdW5jdGlvbiBaKHIpe3JldHVybiByfWZ1bmN0aW9uIFEocil7WCsrLHkubW9uaXRvclJ1bkRlcGVuZGVuY2llcyYmeS5tb25pdG9yUnVuRGVwZW5kZW5jaWVzKFgpfWZ1bmN0aW9uIHJyKHIpe3ZhciBlO1gtLSx5Lm1vbml0b3JSdW5EZXBlbmRlbmNpZXMmJnkubW9uaXRvclJ1bkRlcGVuZGVuY2llcyhYKSwwPT1YJiYobnVsbCE9PUsmJihjbGVhckludGVydmFsKEspLEs9bnVsbCksSiYmKGU9SixKPW51bGwsZSgpKSl9ZnVuY3Rpb24gZXIocil7eS5vbkFib3J0JiZ5Lm9uQWJvcnQociksRShyPSJBYm9ydGVkKCIrcisiKSIpLFQ9ITAscis9Ii4gQnVpbGQgd2l0aCAtc0FTU0VSVElPTlMgZm9yIG1vcmUgaW5mby4iO3ZhciBlPW5ldyBXZWJBc3NlbWJseS5SdW50aW1lRXJyb3Iocik7dGhyb3cgbihlKSxlfXZhciB0cj0iZGF0YTphcHBsaWNhdGlvbi9vY3RldC1zdHJlYW07YmFzZTY0LCIsbnIsb3IsYXI7ZnVuY3Rpb24gaXIocil7cmV0dXJuIHIuc3RhcnRzV2l0aCh0cil9ZnVuY3Rpb24gc3Iocil7cmV0dXJuIHIuc3RhcnRzV2l0aCgiZmlsZTovLyIpfWZ1bmN0aW9uIHVyKHIpe2lmKHI9PW5yJiZrKXJldHVybiBuZXcgVWludDhBcnJheShrKTtpZihoKXJldHVybiBoKHIpO3Rocm93ImJvdGggYXN5bmMgYW5kIHN5bmMgZmV0Y2hpbmcgb2YgdGhlIHdhc20gZmFpbGVkIn1mdW5jdGlvbiBscih0KXtpZighayYmKHN8fGYpKXtpZigiZnVuY3Rpb24iPT10eXBlb2YgZmV0Y2gmJiFzcih0KSlyZXR1cm4gZmV0Y2godCx7Y3JlZGVudGlhbHM6InNhbWUtb3JpZ2luIn0pLnRoZW4ocj0+e2lmKCFyLm9rKXRocm93ImZhaWxlZCB0byBsb2FkIHdhc20gYmluYXJ5IGZpbGUgYXQgJyIrdCsiJyI7cmV0dXJuIHIuYXJyYXlCdWZmZXIoKX0pLmNhdGNoKCgpPT51cih0KSk7aWYoZClyZXR1cm4gbmV3IFByb21pc2UoKGUscik9PntkKHQscj0+ZShuZXcgVWludDhBcnJheShyKSkscil9KX1yZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCkudGhlbigoKT0+dXIodCkpfWZ1bmN0aW9uIGNyKHIsZSx0KXtyZXR1cm4gbHIocikudGhlbihyPT5XZWJBc3NlbWJseS5pbnN0YW50aWF0ZShyLGUpKS50aGVuKHI9PnIpLnRoZW4odCxyPT57RSgiZmFpbGVkIHRvIGFzeW5jaHJvbm91c2x5IHByZXBhcmUgd2FzbTogIityKSxlcihyKX0pfWZ1bmN0aW9uIGRyKHIsdCxuLG8pe3JldHVybiByfHwiZnVuY3Rpb24iIT10eXBlb2YgV2ViQXNzZW1ibHkuaW5zdGFudGlhdGVTdHJlYW1pbmd8fGlyKHQpfHxzcih0KXx8dXx8ImZ1bmN0aW9uIiE9dHlwZW9mIGZldGNoP2NyKHQsbixvKTpmZXRjaCh0LHtjcmVkZW50aWFsczoic2FtZS1vcmlnaW4ifSkudGhlbihyPT57dmFyIGU7cmV0dXJuIFdlYkFzc2VtYmx5Lmluc3RhbnRpYXRlU3RyZWFtaW5nKHIsbikudGhlbihvLGZ1bmN0aW9uKHIpe3JldHVybiBFKCJ3YXNtIHN0cmVhbWluZyBjb21waWxlIGZhaWxlZDogIityKSxFKCJmYWxsaW5nIGJhY2sgdG8gQXJyYXlCdWZmZXIgaW5zdGFudGlhdGlvbiIpLGNyKHQsbixvKX0pfSl9ZnVuY3Rpb24gZnIoKXt2YXIgcj17YTpob307ZnVuY3Rpb24gZShyLGUpe3ZhciB0PXIuZXhwb3J0cztyZXR1cm4gQz0ocG89dCkuVGEseigpLFI9cG8uVmEsWShwby5VYSkscnIoIndhc20taW5zdGFudGlhdGUiKSx0fWZ1bmN0aW9uIHQocil7ZShyLmluc3RhbmNlKX1pZihRKCJ3YXNtLWluc3RhbnRpYXRlIikseS5pbnN0YW50aWF0ZVdhc20pdHJ5e3JldHVybiB5Lmluc3RhbnRpYXRlV2FzbShyLGUpfWNhdGNoKHIpe0UoIk1vZHVsZS5pbnN0YW50aWF0ZVdhc20gY2FsbGJhY2sgZmFpbGVkIHdpdGggZXJyb3I6ICIrciksbihyKX1yZXR1cm4gZHIoayxucixyLHQpLmNhdGNoKG4pLHt9fXkubG9jYXRlRmlsZT9pcihucj0ibWFuaWZvbGQud2FzbSIpfHwobnI9bShucikpOm5yPW5ldyBVUkwoIm1hbmlmb2xkLndhc20iLGltcG9ydC5tZXRhLnVybCkuaHJlZjt2YXIgaHI9cj0+e2Zvcig7MDxyLmxlbmd0aDspci5zaGlmdCgpKHkpfTtmdW5jdGlvbiBwcihyLGU9Imk4Iil7c3dpdGNoKGU9ZS5lbmRzV2l0aCgiKiIpPyIqIjplKXtjYXNlImkxIjpjYXNlImk4IjpyZXR1cm4gTVtyPj4wXTtjYXNlImkxNiI6cmV0dXJuIEZbcj4+MV07Y2FzZSJpMzIiOnJldHVybiBEW3I+PjJdO2Nhc2UiaTY0IjplcigidG8gZG8gZ2V0VmFsdWUoaTY0KSB1c2UgV0FTTV9CSUdJTlQiKTtjYXNlImZsb2F0IjpyZXR1cm4galtyPj4yXTtjYXNlImRvdWJsZSI6cmV0dXJuIE9bcj4+M107Y2FzZSIqIjpyZXR1cm4geFtyPj4yXTtkZWZhdWx0OmVyKCJpbnZhbGlkIHR5cGUgZm9yIGdldFZhbHVlOiAiK2UpfX1mdW5jdGlvbiBtcihyLGUsdD0iaTgiKXtzd2l0Y2godD10LmVuZHNXaXRoKCIqIik/IioiOnQpe2Nhc2UiaTEiOmNhc2UiaTgiOk1bcj4+MF09ZTticmVhaztjYXNlImkxNiI6RltyPj4xXT1lO2JyZWFrO2Nhc2UiaTMyIjpEW3I+PjJdPWU7YnJlYWs7Y2FzZSJpNjQiOmVyKCJ0byBkbyBzZXRWYWx1ZShpNjQpIHVzZSBXQVNNX0JJR0lOVCIpO2Nhc2UiZmxvYXQiOmpbcj4+Ml09ZTticmVhaztjYXNlImRvdWJsZSI6T1tyPj4zXT1lO2JyZWFrO2Nhc2UiKiI6eFtyPj4yXT1lO2JyZWFrO2RlZmF1bHQ6ZXIoImludmFsaWQgdHlwZSBmb3Igc2V0VmFsdWU6ICIrdCl9fXZhciB2cj1bXSx5cj0wLGdyPXI9Pnt2YXIgZT1uZXcgYnIocik7cmV0dXJuIGUuZ2V0X2NhdWdodCgpfHwoZS5zZXRfY2F1Z2h0KCEwKSx5ci0tKSxlLnNldF9yZXRocm93bighMSksdnIucHVzaChlKSxTbyhlLmV4Y1B0ciksZS5nZXRfZXhjZXB0aW9uX3B0cigpfSx3cj0wLF9yPSgpPT57RW8oMCwwKTt2YXIgcj12ci5wb3AoKTtUbyhyLmV4Y1B0ciksd3I9MH07ZnVuY3Rpb24gYnIocil7dGhpcy5leGNQdHI9cix0aGlzLnB0cj1yLTI0LHRoaXMuc2V0X3R5cGU9ZnVuY3Rpb24ocil7eFt0aGlzLnB0cis0Pj4yXT1yfSx0aGlzLmdldF90eXBlPWZ1bmN0aW9uKCl7cmV0dXJuIHhbdGhpcy5wdHIrND4+Ml19LHRoaXMuc2V0X2Rlc3RydWN0b3I9ZnVuY3Rpb24ocil7eFt0aGlzLnB0cis4Pj4yXT1yfSx0aGlzLmdldF9kZXN0cnVjdG9yPWZ1bmN0aW9uKCl7cmV0dXJuIHhbdGhpcy5wdHIrOD4+Ml19LHRoaXMuc2V0X2NhdWdodD1mdW5jdGlvbihyKXtNW3RoaXMucHRyKzEyPj4wXT1yPXI/MTowfSx0aGlzLmdldF9jYXVnaHQ9ZnVuY3Rpb24oKXtyZXR1cm4gMCE9TVt0aGlzLnB0cisxMj4+MF19LHRoaXMuc2V0X3JldGhyb3duPWZ1bmN0aW9uKHIpe01bdGhpcy5wdHIrMTM+PjBdPXI9cj8xOjB9LHRoaXMuZ2V0X3JldGhyb3duPWZ1bmN0aW9uKCl7cmV0dXJuIDAhPU1bdGhpcy5wdHIrMTM+PjBdfSx0aGlzLmluaXQ9ZnVuY3Rpb24ocixlKXt0aGlzLnNldF9hZGp1c3RlZF9wdHIoMCksdGhpcy5zZXRfdHlwZShyKSx0aGlzLnNldF9kZXN0cnVjdG9yKGUpfSx0aGlzLnNldF9hZGp1c3RlZF9wdHI9ZnVuY3Rpb24ocil7eFt0aGlzLnB0cisxNj4+Ml09cn0sdGhpcy5nZXRfYWRqdXN0ZWRfcHRyPWZ1bmN0aW9uKCl7cmV0dXJuIHhbdGhpcy5wdHIrMTY+PjJdfSx0aGlzLmdldF9leGNlcHRpb25fcHRyPWZ1bmN0aW9uKCl7dmFyIHI7aWYoJG8odGhpcy5nZXRfdHlwZSgpKSlyZXR1cm4geFt0aGlzLmV4Y1B0cj4+Ml07dmFyIGU9dGhpcy5nZXRfYWRqdXN0ZWRfcHRyKCk7cmV0dXJuIDAhPT1lP2U6dGhpcy5leGNQdHJ9fXZhciBFcj1yPT57dGhyb3cgd3I9d3J8fHJ9LGtyPXI9Pnt2YXIgZT13cjtpZighZSlyZXR1cm4ga28oMCksMDt2YXIgdD1uZXcgYnIoZSk7dC5zZXRfYWRqdXN0ZWRfcHRyKGUpO3ZhciBuPXQuZ2V0X3R5cGUoKSxvO2lmKCFuKXJldHVybiBrbygwKSxlO2ZvcihvIGluIHIpe3ZhciBhPXJbb107aWYoMD09PWF8fGE9PT1uKWJyZWFrO3ZhciBpPXQucHRyKzE2O2lmKE1vKGEsbixpKSlyZXR1cm4ga28oYSksZX1yZXR1cm4ga28obiksZX0sUHI9KCk9PmtyKFtdKSxDcj1yPT5rcihbcl0pLFRyPSgpPT57dmFyIHI9dnIucG9wKCk7cnx8ZXIoIm5vIGV4Y2VwdGlvbiB0byB0aHJvdyIpO3ZhciBlPXIuZXhjUHRyO3Rocm93IHIuZ2V0X3JldGhyb3duKCl8fCh2ci5wdXNoKHIpLHIuc2V0X3JldGhyb3duKCEwKSxyLnNldF9jYXVnaHQoITEpLHlyKyspLHdyPWV9LFNyPShyLGUsdCk9Pnt2YXIgbjt0aHJvdyBuZXcgYnIocikuaW5pdChlLHQpLHlyKyssd3I9cn0sTXI9KCk9PnlyLCRyPXt9LEZyPXI9Pntmb3IoO3IubGVuZ3RoOyl7dmFyIGU9ci5wb3AoKSx0O3IucG9wKCkoZSl9fTtmdW5jdGlvbiBBcihyKXtyZXR1cm4gdGhpcy5mcm9tV2lyZVR5cGUoRFtyPj4yXSl9dmFyIERyPXt9LHhyPXt9LGpyPXt9LE9yPXZvaWQgMCxScj1yPT57dGhyb3cgbmV3IE9yKHIpfSxXcj0obixlLG8pPT57ZnVuY3Rpb24gdChyKXt2YXIgZT1vKHIpO2UubGVuZ3RoIT09bi5sZW5ndGgmJlJyKCJNaXNtYXRjaGVkIHR5cGUgY29udmVydGVyIGNvdW50Iik7Zm9yKHZhciB0PTA7dDxuLmxlbmd0aDsrK3QpcXIoblt0XSxlW3RdKX1uLmZvckVhY2goZnVuY3Rpb24ocil7anJbcl09ZX0pO3ZhciBhPW5ldyBBcnJheShlLmxlbmd0aCksaT1bXSxzPTA7ZS5mb3JFYWNoKChyLGUpPT57eHIuaGFzT3duUHJvcGVydHkocik/YVtlXT14cltyXTooaS5wdXNoKHIpLERyLmhhc093blByb3BlcnR5KHIpfHwoRHJbcl09W10pLERyW3JdLnB1c2goKCk9PnthW2VdPXhyW3JdLCsrcz09PWkubGVuZ3RoJiZ0KGEpfSkpfSksMD09PWkubGVuZ3RoJiZ0KGEpfSx6cj1yPT57dmFyIGU9JHJbcl07ZGVsZXRlICRyW3JdO3ZhciBvPWUucmF3Q29uc3RydWN0b3IsYT1lLnJhd0Rlc3RydWN0b3IsZD1lLmZpZWxkcyx0PWQubWFwKHI9PnIuZ2V0dGVyUmV0dXJuVHlwZSkuY29uY2F0KGQubWFwKHI9PnIuc2V0dGVyQXJndW1lbnRUeXBlKSk7V3IoW3JdLHQsbD0+e3ZhciBjPXt9O3JldHVybiBkLmZvckVhY2goKHIsZSk9Pnt2YXIgdD1yLmZpZWxkTmFtZSxuPWxbZV0sbz1yLmdldHRlcixhPXIuZ2V0dGVyQ29udGV4dCxpPWxbZStkLmxlbmd0aF0scz1yLnNldHRlcix1PXIuc2V0dGVyQ29udGV4dDtjW3RdPXtyZWFkOnI9Pm4uZnJvbVdpcmVUeXBlKG8oYSxyKSksd3JpdGU6KHIsZSk9Pnt2YXIgdD1bXTtzKHUscixpLnRvV2lyZVR5cGUodCxlKSksRnIodCl9fX0pLFt7bmFtZTplLm5hbWUsZnJvbVdpcmVUeXBlOnI9Pnt2YXIgZT17fSx0O2Zvcih0IGluIGMpZVt0XT1jW3RdLnJlYWQocik7cmV0dXJuIGEociksZX0sdG9XaXJlVHlwZToocixlKT0+e2Zvcih2YXIgdCBpbiBjKWlmKCEodCBpbiBlKSl0aHJvdyBuZXcgVHlwZUVycm9yKGBNaXNzaW5nIGZpZWxkOiAiJHt0fSJgKTt2YXIgbj1vKCk7Zm9yKHQgaW4gYyljW3RdLndyaXRlKG4sZVt0XSk7cmV0dXJuIG51bGwhPT1yJiZyLnB1c2goYSxuKSxufSxhcmdQYWNrQWR2YW5jZTo4LHJlYWRWYWx1ZUZyb21Qb2ludGVyOkFyLGRlc3RydWN0b3JGdW5jdGlvbjphfV19KX0sTnI9KHIsZSx0LG4sbyk9Pnt9LElyPSgpPT57Zm9yKHZhciByPW5ldyBBcnJheSgyNTYpLGU9MDtlPDI1NjsrK2UpcltlXT1TdHJpbmcuZnJvbUNoYXJDb2RlKGUpO1ZyPXJ9LFZyPXZvaWQgMCxMcj1yPT57Zm9yKHZhciBlPSIiLHQ9cjskW3RdOyllKz1WclskW3QrK11dO3JldHVybiBlfSxCcj12b2lkIDAsVXI9cj0+e3Rocm93IG5ldyBCcihyKX07ZnVuY3Rpb24gSHIocixlLHQ9e30pe3ZhciBuPWUubmFtZSxvO2lmKHJ8fFVyKGB0eXBlICIke259IiBtdXN0IGhhdmUgYSBwb3NpdGl2ZSBpbnRlZ2VyIHR5cGVpZCBwb2ludGVyYCkseHIuaGFzT3duUHJvcGVydHkocikpe2lmKHQuaWdub3JlRHVwbGljYXRlUmVnaXN0cmF0aW9ucylyZXR1cm47VXIoYENhbm5vdCByZWdpc3RlciB0eXBlICcke259JyB0d2ljZWApfXhyW3JdPWUsZGVsZXRlIGpyW3JdLERyLmhhc093blByb3BlcnR5KHIpJiYobz1EcltyXSxkZWxldGUgRHJbcl0sby5mb3JFYWNoKHI9PnIoKSkpfWZ1bmN0aW9uIHFyKHIsZSx0PXt9KXtpZighKCJhcmdQYWNrQWR2YW5jZSJpbiBlKSl0aHJvdyBuZXcgVHlwZUVycm9yKCJyZWdpc3RlclR5cGUgcmVnaXN0ZXJlZEluc3RhbmNlIHJlcXVpcmVzIGFyZ1BhY2tBZHZhbmNlIik7cmV0dXJuIEhyKHIsZSx0KX12YXIgWXI9OCxHcj0ocixlLHQsbik9PntxcihyLHtuYW1lOmU9THIoZSksZnJvbVdpcmVUeXBlOmZ1bmN0aW9uKHIpe3JldHVybiEhcn0sdG9XaXJlVHlwZTpmdW5jdGlvbihyLGUpe3JldHVybiBlP3Q6bn0sYXJnUGFja0FkdmFuY2U6OCxyZWFkVmFsdWVGcm9tUG9pbnRlcjpmdW5jdGlvbihyKXtyZXR1cm4gdGhpcy5mcm9tV2lyZVR5cGUoJFtyXSl9LGRlc3RydWN0b3JGdW5jdGlvbjpudWxsfSl9O2Z1bmN0aW9uIFhyKHIpe2lmKCEodGhpcyBpbnN0YW5jZW9mIEVlKSlyZXR1cm4hMTtpZighKHIgaW5zdGFuY2VvZiBFZSkpcmV0dXJuITE7Zm9yKHZhciBlPXRoaXMuJCQucHRyVHlwZS5yZWdpc3RlcmVkQ2xhc3MsdD10aGlzLiQkLnB0cixuPXIuJCQucHRyVHlwZS5yZWdpc3RlcmVkQ2xhc3Msbz1yLiQkLnB0cjtlLmJhc2VDbGFzczspdD1lLnVwY2FzdCh0KSxlPWUuYmFzZUNsYXNzO2Zvcig7bi5iYXNlQ2xhc3M7KW89bi51cGNhc3Qobyksbj1uLmJhc2VDbGFzcztyZXR1cm4gZT09PW4mJnQ9PT1vfXZhciBLcj1yPT4oe2NvdW50OnIuY291bnQsZGVsZXRlU2NoZWR1bGVkOnIuZGVsZXRlU2NoZWR1bGVkLHByZXNlcnZlUG9pbnRlck9uRGVsZXRlOnIucHJlc2VydmVQb2ludGVyT25EZWxldGUscHRyOnIucHRyLHB0clR5cGU6ci5wdHJUeXBlLHNtYXJ0UHRyOnIuc21hcnRQdHIsc21hcnRQdHJUeXBlOnIuc21hcnRQdHJUeXBlfSksSnI9cj0+e2Z1bmN0aW9uIGUocil7cmV0dXJuIHIuJCQucHRyVHlwZS5yZWdpc3RlcmVkQ2xhc3MubmFtZX1VcihlKHIpKyIgaW5zdGFuY2UgYWxyZWFkeSBkZWxldGVkIil9LFpyPSExLFFyPXI9Pnt9LHJlPXI9PntyLnNtYXJ0UHRyP3Iuc21hcnRQdHJUeXBlLnJhd0Rlc3RydWN0b3Ioci5zbWFydFB0cik6ci5wdHJUeXBlLnJlZ2lzdGVyZWRDbGFzcy5yYXdEZXN0cnVjdG9yKHIucHRyKX0sZWU9cj0+e3ZhciBlOy0tci5jb3VudC52YWx1ZSwwPT09ci5jb3VudC52YWx1ZSYmcmUocil9LHRlPShyLGUsdCk9PntpZihlPT09dClyZXR1cm4gcjtpZih2b2lkIDA9PT10LmJhc2VDbGFzcylyZXR1cm4gbnVsbDt2YXIgbj10ZShyLGUsdC5iYXNlQ2xhc3MpO3JldHVybiBudWxsPT09bj9udWxsOnQuZG93bmNhc3Qobil9LG5lPXt9LG9lPSgpPT5PYmplY3Qua2V5cyhkZSkubGVuZ3RoLGFlPSgpPT57dmFyIHI9W10sZTtmb3IoZSBpbiBkZSlkZS5oYXNPd25Qcm9wZXJ0eShlKSYmci5wdXNoKGRlW2VdKTtyZXR1cm4gcn0saWU9W10sc2U9KCk9Pntmb3IoO2llLmxlbmd0aDspe3ZhciByPWllLnBvcCgpO3IuJCQuZGVsZXRlU2NoZWR1bGVkPSExLHIuZGVsZXRlKCl9fSx1ZT12b2lkIDAsbGU9cj0+e3VlPXIsaWUubGVuZ3RoJiZ1ZSYmdWUoc2UpfSxjZT0oKT0+e3kuZ2V0SW5oZXJpdGVkSW5zdGFuY2VDb3VudD1vZSx5LmdldExpdmVJbmhlcml0ZWRJbnN0YW5jZXM9YWUseS5mbHVzaFBlbmRpbmdEZWxldGVzPXNlLHkuc2V0RGVsYXlGdW5jdGlvbj1sZX0sZGU9e30sZmU9KHIsZSk9Pntmb3Iodm9pZCAwPT09ZSYmVXIoInB0ciBzaG91bGQgbm90IGJlIHVuZGVmaW5lZCIpO3IuYmFzZUNsYXNzOyllPXIudXBjYXN0KGUpLHI9ci5iYXNlQ2xhc3M7cmV0dXJuIGV9LGhlPShyLGUpPT4oZT1mZShyLGUpLGRlW2VdKSxwZT0ocixlKT0+e3ZhciB0LG47cmV0dXJuIGUucHRyVHlwZSYmZS5wdHJ8fFJyKCJtYWtlQ2xhc3NIYW5kbGUgcmVxdWlyZXMgcHRyIGFuZCBwdHJUeXBlIiksISFlLnNtYXJ0UHRyVHlwZSE9ISFlLnNtYXJ0UHRyJiZScigiQm90aCBzbWFydFB0clR5cGUgYW5kIHNtYXJ0UHRyIG11c3QgYmUgc3BlY2lmaWVkIiksZS5jb3VudD17dmFsdWU6MX0sdmUoT2JqZWN0LmNyZWF0ZShyLHskJDp7dmFsdWU6ZX19KSl9O2Z1bmN0aW9uIG1lKHIpe3ZhciBlPXRoaXMuZ2V0UG9pbnRlZShyKTtpZighZSlyZXR1cm4gdGhpcy5kZXN0cnVjdG9yKHIpLG51bGw7dmFyIHQ9aGUodGhpcy5yZWdpc3RlcmVkQ2xhc3MsZSk7aWYodm9pZCAwIT09dCl7aWYoMD09PXQuJCQuY291bnQudmFsdWUpcmV0dXJuIHQuJCQucHRyPWUsdC4kJC5zbWFydFB0cj1yLHQuY2xvbmUoKTt2YXIgbj10LmNsb25lKCk7cmV0dXJuIHRoaXMuZGVzdHJ1Y3RvcihyKSxufWZ1bmN0aW9uIG8oKXtyZXR1cm4gdGhpcy5pc1NtYXJ0UG9pbnRlcj9wZSh0aGlzLnJlZ2lzdGVyZWRDbGFzcy5pbnN0YW5jZVByb3RvdHlwZSx7cHRyVHlwZTp0aGlzLnBvaW50ZWVUeXBlLHB0cjplLHNtYXJ0UHRyVHlwZTp0aGlzLHNtYXJ0UHRyOnJ9KTpwZSh0aGlzLnJlZ2lzdGVyZWRDbGFzcy5pbnN0YW5jZVByb3RvdHlwZSx7cHRyVHlwZTp0aGlzLHB0cjpyfSl9dmFyIGE9dGhpcy5yZWdpc3RlcmVkQ2xhc3MuZ2V0QWN0dWFsVHlwZShlKSxpPW5lW2FdLHM7aWYoIWkpcmV0dXJuIG8uY2FsbCh0aGlzKTt2YXIgcz10aGlzLmlzQ29uc3Q/aS5jb25zdFBvaW50ZXJUeXBlOmkucG9pbnRlclR5cGUsdT10ZShlLHRoaXMucmVnaXN0ZXJlZENsYXNzLHMucmVnaXN0ZXJlZENsYXNzKTtyZXR1cm4gbnVsbD09PXU/by5jYWxsKHRoaXMpOnRoaXMuaXNTbWFydFBvaW50ZXI/cGUocy5yZWdpc3RlcmVkQ2xhc3MuaW5zdGFuY2VQcm90b3R5cGUse3B0clR5cGU6cyxwdHI6dSxzbWFydFB0clR5cGU6dGhpcyxzbWFydFB0cjpyfSk6cGUocy5yZWdpc3RlcmVkQ2xhc3MuaW5zdGFuY2VQcm90b3R5cGUse3B0clR5cGU6cyxwdHI6dX0pfXZhciB2ZT1yPT4idW5kZWZpbmVkIj09dHlwZW9mIEZpbmFsaXphdGlvblJlZ2lzdHJ5Pyh2ZT1yPT5yLHIpOihacj1uZXcgRmluYWxpemF0aW9uUmVnaXN0cnkocj0+e2VlKHIuJCQpfSksUXI9cj0+WnIudW5yZWdpc3RlcihyKSwodmU9cj0+e3ZhciBlPXIuJCQsdCxuO3JldHVybiEhZS5zbWFydFB0ciYmWnIucmVnaXN0ZXIocix7JCQ6ZX0scikscn0pKHIpKTtmdW5jdGlvbiB5ZSgpe2lmKHRoaXMuJCQucHRyfHxKcih0aGlzKSx0aGlzLiQkLnByZXNlcnZlUG9pbnRlck9uRGVsZXRlKXJldHVybiB0aGlzLiQkLmNvdW50LnZhbHVlKz0xLHRoaXM7dmFyIHI9dmUoT2JqZWN0LmNyZWF0ZShPYmplY3QuZ2V0UHJvdG90eXBlT2YodGhpcykseyQkOnt2YWx1ZTpLcih0aGlzLiQkKX19KSk7cmV0dXJuIHIuJCQuY291bnQudmFsdWUrPTEsci4kJC5kZWxldGVTY2hlZHVsZWQ9ITEscn1mdW5jdGlvbiBnZSgpe3RoaXMuJCQucHRyfHxKcih0aGlzKSx0aGlzLiQkLmRlbGV0ZVNjaGVkdWxlZCYmIXRoaXMuJCQucHJlc2VydmVQb2ludGVyT25EZWxldGUmJlVyKCJPYmplY3QgYWxyZWFkeSBzY2hlZHVsZWQgZm9yIGRlbGV0aW9uIiksUXIodGhpcyksZWUodGhpcy4kJCksdGhpcy4kJC5wcmVzZXJ2ZVBvaW50ZXJPbkRlbGV0ZXx8KHRoaXMuJCQuc21hcnRQdHI9dm9pZCAwLHRoaXMuJCQucHRyPXZvaWQgMCl9ZnVuY3Rpb24gd2UoKXtyZXR1cm4hdGhpcy4kJC5wdHJ9ZnVuY3Rpb24gX2UoKXtyZXR1cm4gdGhpcy4kJC5wdHJ8fEpyKHRoaXMpLHRoaXMuJCQuZGVsZXRlU2NoZWR1bGVkJiYhdGhpcy4kJC5wcmVzZXJ2ZVBvaW50ZXJPbkRlbGV0ZSYmVXIoIk9iamVjdCBhbHJlYWR5IHNjaGVkdWxlZCBmb3IgZGVsZXRpb24iKSxpZS5wdXNoKHRoaXMpLDE9PT1pZS5sZW5ndGgmJnVlJiZ1ZShzZSksdGhpcy4kJC5kZWxldGVTY2hlZHVsZWQ9ITAsdGhpc312YXIgYmU9KCk9PntFZS5wcm90b3R5cGUuaXNBbGlhc09mPVhyLEVlLnByb3RvdHlwZS5jbG9uZT15ZSxFZS5wcm90b3R5cGUuZGVsZXRlPWdlLEVlLnByb3RvdHlwZS5pc0RlbGV0ZWQ9d2UsRWUucHJvdG90eXBlLmRlbGV0ZUxhdGVyPV9lfTtmdW5jdGlvbiBFZSgpe312YXIga2U9NDgsUGU9NTcsQ2U9cj0+e2lmKHZvaWQgMD09PXIpcmV0dXJuIl91bmtub3duIjt2YXIgZT0ocj1yLnJlcGxhY2UoL1teYS16QS1aMC05X10vZywiJCIpKS5jaGFyQ29kZUF0KDApO3JldHVybiBrZTw9ZSYmZTw9UGU/Il8iK3I6cn07ZnVuY3Rpb24gVGUocixlKXtyZXR1cm57W3I9Q2UocildOmZ1bmN0aW9uKCl7cmV0dXJuIGUuYXBwbHkodGhpcyxhcmd1bWVudHMpfX1bcl19dmFyIFNlPShyLGUsdCk9Pnt2YXIgbjt2b2lkIDA9PT1yW2VdLm92ZXJsb2FkVGFibGUmJihuPXJbZV0scltlXT1mdW5jdGlvbigpe3JldHVybiByW2VdLm92ZXJsb2FkVGFibGUuaGFzT3duUHJvcGVydHkoYXJndW1lbnRzLmxlbmd0aCl8fFVyKGBGdW5jdGlvbiAnJHt0fScgY2FsbGVkIHdpdGggYW4gaW52YWxpZCBudW1iZXIgb2YgYXJndW1lbnRzICgke2FyZ3VtZW50cy5sZW5ndGh9KSAtIGV4cGVjdHMgb25lIG9mICgke3JbZV0ub3ZlcmxvYWRUYWJsZX0pIWApLHJbZV0ub3ZlcmxvYWRUYWJsZVthcmd1bWVudHMubGVuZ3RoXS5hcHBseSh0aGlzLGFyZ3VtZW50cyl9LHJbZV0ub3ZlcmxvYWRUYWJsZT1bXSxyW2VdLm92ZXJsb2FkVGFibGVbbi5hcmdDb3VudF09bil9LE1lPShyLGUsdCk9Pnt5Lmhhc093blByb3BlcnR5KHIpPygodm9pZCAwPT09dHx8dm9pZCAwIT09eVtyXS5vdmVybG9hZFRhYmxlJiZ2b2lkIDAhPT15W3JdLm92ZXJsb2FkVGFibGVbdF0pJiZVcihgQ2Fubm90IHJlZ2lzdGVyIHB1YmxpYyBuYW1lICcke3J9JyB0d2ljZWApLFNlKHkscixyKSx5Lmhhc093blByb3BlcnR5KHQpJiZVcihgQ2Fubm90IHJlZ2lzdGVyIG11bHRpcGxlIG92ZXJsb2FkcyBvZiBhIGZ1bmN0aW9uIHdpdGggdGhlIHNhbWUgbnVtYmVyIG9mIGFyZ3VtZW50cyAoJHt0fSkhYCkseVtyXS5vdmVybG9hZFRhYmxlW3RdPWUpOih5W3JdPWUsdm9pZCAwIT09dCYmKHlbcl0ubnVtQXJndW1lbnRzPXQpKX07ZnVuY3Rpb24gJGUocixlLHQsbixvLGEsaSxzKXt0aGlzLm5hbWU9cix0aGlzLmNvbnN0cnVjdG9yPWUsdGhpcy5pbnN0YW5jZVByb3RvdHlwZT10LHRoaXMucmF3RGVzdHJ1Y3Rvcj1uLHRoaXMuYmFzZUNsYXNzPW8sdGhpcy5nZXRBY3R1YWxUeXBlPWEsdGhpcy51cGNhc3Q9aSx0aGlzLmRvd25jYXN0PXMsdGhpcy5wdXJlVmlydHVhbEZ1bmN0aW9ucz1bXX12YXIgRmU9KHIsZSx0KT0+e2Zvcig7ZSE9PXQ7KWUudXBjYXN0fHxVcihgRXhwZWN0ZWQgbnVsbCBvciBpbnN0YW5jZSBvZiAke3QubmFtZX0sIGdvdCBhbiBpbnN0YW5jZSBvZiBgK2UubmFtZSkscj1lLnVwY2FzdChyKSxlPWUuYmFzZUNsYXNzO3JldHVybiByfTtmdW5jdGlvbiBBZShyLGUpe2lmKG51bGw9PT1lKXJldHVybiB0aGlzLmlzUmVmZXJlbmNlJiZVcigibnVsbCBpcyBub3QgYSB2YWxpZCAiK3RoaXMubmFtZSksMDtlLiQkfHxVcihgQ2Fubm90IHBhc3MgIiR7bXQoZSl9IiBhcyBhIGArdGhpcy5uYW1lKSxlLiQkLnB0cnx8VXIoIkNhbm5vdCBwYXNzIGRlbGV0ZWQgb2JqZWN0IGFzIGEgcG9pbnRlciBvZiB0eXBlICIrdGhpcy5uYW1lKTt2YXIgdD1lLiQkLnB0clR5cGUucmVnaXN0ZXJlZENsYXNzLG47cmV0dXJuIEZlKGUuJCQucHRyLHQsdGhpcy5yZWdpc3RlcmVkQ2xhc3MpfWZ1bmN0aW9uIERlKHIsZSl7dmFyIHQ7aWYobnVsbD09PWUpcmV0dXJuIHRoaXMuaXNSZWZlcmVuY2UmJlVyKCJudWxsIGlzIG5vdCBhIHZhbGlkICIrdGhpcy5uYW1lKSx0aGlzLmlzU21hcnRQb2ludGVyPyh0PXRoaXMucmF3Q29uc3RydWN0b3IoKSxudWxsIT09ciYmci5wdXNoKHRoaXMucmF3RGVzdHJ1Y3Rvcix0KSx0KTowO2UuJCR8fFVyKGBDYW5ub3QgcGFzcyAiJHttdChlKX0iIGFzIGEgYCt0aGlzLm5hbWUpLGUuJCQucHRyfHxVcigiQ2Fubm90IHBhc3MgZGVsZXRlZCBvYmplY3QgYXMgYSBwb2ludGVyIG9mIHR5cGUgIit0aGlzLm5hbWUpLCF0aGlzLmlzQ29uc3QmJmUuJCQucHRyVHlwZS5pc0NvbnN0JiZVcihgQ2Fubm90IGNvbnZlcnQgYXJndW1lbnQgb2YgdHlwZSAkeyhlLiQkLnNtYXJ0UHRyVHlwZXx8ZS4kJC5wdHJUeXBlKS5uYW1lfSB0byBwYXJhbWV0ZXIgdHlwZSBgK3RoaXMubmFtZSk7dmFyIG49ZS4kJC5wdHJUeXBlLnJlZ2lzdGVyZWRDbGFzcyxvLHQ7aWYodD1GZShlLiQkLnB0cixuLHRoaXMucmVnaXN0ZXJlZENsYXNzKSx0aGlzLmlzU21hcnRQb2ludGVyKXN3aXRjaCh2b2lkIDA9PT1lLiQkLnNtYXJ0UHRyJiZVcigiUGFzc2luZyByYXcgcG9pbnRlciB0byBzbWFydCBwb2ludGVyIGlzIGlsbGVnYWwiKSx0aGlzLnNoYXJpbmdQb2xpY3kpe2Nhc2UgMDplLiQkLnNtYXJ0UHRyVHlwZT09PXRoaXM/dD1lLiQkLnNtYXJ0UHRyOlVyKGBDYW5ub3QgY29udmVydCBhcmd1bWVudCBvZiB0eXBlICR7KGUuJCQuc21hcnRQdHJUeXBlfHxlLiQkLnB0clR5cGUpLm5hbWV9IHRvIHBhcmFtZXRlciB0eXBlIGArdGhpcy5uYW1lKTticmVhaztjYXNlIDE6dD1lLiQkLnNtYXJ0UHRyO2JyZWFrO2Nhc2UgMjplLiQkLnNtYXJ0UHRyVHlwZT09PXRoaXM/dD1lLiQkLnNtYXJ0UHRyOihvPWUuY2xvbmUoKSx0PXRoaXMucmF3U2hhcmUodCxsdC50b0hhbmRsZSgoKT0+by5kZWxldGUoKSkpLG51bGwhPT1yJiZyLnB1c2godGhpcy5yYXdEZXN0cnVjdG9yLHQpKTticmVhaztkZWZhdWx0OlVyKCJVbnN1cHBvcnRpbmcgc2hhcmluZyBwb2xpY3kiKX1yZXR1cm4gdH1mdW5jdGlvbiB4ZShyLGUpe2lmKG51bGw9PT1lKXJldHVybiB0aGlzLmlzUmVmZXJlbmNlJiZVcigibnVsbCBpcyBub3QgYSB2YWxpZCAiK3RoaXMubmFtZSksMDtlLiQkfHxVcihgQ2Fubm90IHBhc3MgIiR7bXQoZSl9IiBhcyBhIGArdGhpcy5uYW1lKSxlLiQkLnB0cnx8VXIoIkNhbm5vdCBwYXNzIGRlbGV0ZWQgb2JqZWN0IGFzIGEgcG9pbnRlciBvZiB0eXBlICIrdGhpcy5uYW1lKSxlLiQkLnB0clR5cGUuaXNDb25zdCYmVXIoYENhbm5vdCBjb252ZXJ0IGFyZ3VtZW50IG9mIHR5cGUgJHtlLiQkLnB0clR5cGUubmFtZX0gdG8gcGFyYW1ldGVyIHR5cGUgYCt0aGlzLm5hbWUpO3ZhciB0PWUuJCQucHRyVHlwZS5yZWdpc3RlcmVkQ2xhc3MsbjtyZXR1cm4gRmUoZS4kJC5wdHIsdCx0aGlzLnJlZ2lzdGVyZWRDbGFzcyl9ZnVuY3Rpb24gamUocil7cmV0dXJuIHRoaXMuZnJvbVdpcmVUeXBlKHhbcj4+Ml0pfWZ1bmN0aW9uIE9lKHIpe3JldHVybiByPXRoaXMucmF3R2V0UG9pbnRlZT90aGlzLnJhd0dldFBvaW50ZWUocik6cn1mdW5jdGlvbiBSZShyKXt0aGlzLnJhd0Rlc3RydWN0b3ImJnRoaXMucmF3RGVzdHJ1Y3RvcihyKX12YXIgV2U9cj0+e251bGwhPT1yJiZyLmRlbGV0ZSgpfSx6ZT0oKT0+e05lLnByb3RvdHlwZS5nZXRQb2ludGVlPU9lLE5lLnByb3RvdHlwZS5kZXN0cnVjdG9yPVJlLE5lLnByb3RvdHlwZS5hcmdQYWNrQWR2YW5jZT04LE5lLnByb3RvdHlwZS5yZWFkVmFsdWVGcm9tUG9pbnRlcj1qZSxOZS5wcm90b3R5cGUuZGVsZXRlT2JqZWN0PVdlLE5lLnByb3RvdHlwZS5mcm9tV2lyZVR5cGU9bWV9O2Z1bmN0aW9uIE5lKHIsZSx0LG4sbyxhLGkscyx1LGwsYyl7dGhpcy5uYW1lPXIsdGhpcy5yZWdpc3RlcmVkQ2xhc3M9ZSx0aGlzLmlzUmVmZXJlbmNlPXQsdGhpcy5pc0NvbnN0PW4sdGhpcy5pc1NtYXJ0UG9pbnRlcj1vLHRoaXMucG9pbnRlZVR5cGU9YSx0aGlzLnNoYXJpbmdQb2xpY3k9aSx0aGlzLnJhd0dldFBvaW50ZWU9cyx0aGlzLnJhd0NvbnN0cnVjdG9yPXUsdGhpcy5yYXdTaGFyZT1sLHRoaXMucmF3RGVzdHJ1Y3Rvcj1jLG98fHZvaWQgMCE9PWUuYmFzZUNsYXNzP3RoaXMudG9XaXJlVHlwZT1EZToodGhpcy50b1dpcmVUeXBlPW4/QWU6eGUsdGhpcy5kZXN0cnVjdG9yRnVuY3Rpb249bnVsbCl9dmFyIEllPShyLGUsdCk9Pnt5Lmhhc093blByb3BlcnR5KHIpfHxScigiUmVwbGFjaW5nIG5vbmV4aXN0YW50IHB1YmxpYyBzeW1ib2wiKSx2b2lkIDAhPT15W3JdLm92ZXJsb2FkVGFibGUmJnZvaWQgMCE9PXQ/eVtyXS5vdmVybG9hZFRhYmxlW3RdPWU6KHlbcl09ZSx5W3JdLmFyZ0NvdW50PXQpfSxWZT0ocixlLHQpPT57dmFyIG49eVsiZHluQ2FsbF8iK3JdO3JldHVybiB0JiZ0Lmxlbmd0aD9uLmFwcGx5KG51bGwsW2VdLmNvbmNhdCh0KSk6bi5jYWxsKG51bGwsZSl9LExlPVtdLEJlPXI9Pnt2YXIgZT1MZVtyXTtyZXR1cm4gZXx8KHI+PUxlLmxlbmd0aCYmKExlLmxlbmd0aD1yKzEpLExlW3JdPWU9Ui5nZXQocikpLGV9LFVlPShyLGUsdCk9PntyZXR1cm4gci5pbmNsdWRlcygiaiIpP1ZlKHIsZSx0KTpCZShlKS5hcHBseShudWxsLHQpO3ZhciBufSxIZT0ocixlKT0+e3ZhciB0PVtdO3JldHVybiBmdW5jdGlvbigpe3JldHVybiB0Lmxlbmd0aD0wLE9iamVjdC5hc3NpZ24odCxhcmd1bWVudHMpLFVlKHIsZSx0KX19LHFlPShyLGUpPT57ZnVuY3Rpb24gdCgpe3JldHVybiByLmluY2x1ZGVzKCJqIik/SGUocixlKTpCZShlKX1yPUxyKHIpO3ZhciBuPXQoKTtyZXR1cm4iZnVuY3Rpb24iIT10eXBlb2YgbiYmVXIoYHVua25vd24gZnVuY3Rpb24gcG9pbnRlciB3aXRoIHNpZ25hdHVyZSAke3J9OiBgK2UpLG59LFllPShyLHQpPT57dmFyIGU9VGUodCxmdW5jdGlvbihyKXt0aGlzLm5hbWU9dCx0aGlzLm1lc3NhZ2U9cjt2YXIgZT1uZXcgRXJyb3Iocikuc3RhY2s7dm9pZCAwIT09ZSYmKHRoaXMuc3RhY2s9dGhpcy50b1N0cmluZygpKyJcbiIrZS5yZXBsYWNlKC9eRXJyb3IoOlteXG5dKik/XG4vLCIiKSl9KTtyZXR1cm4gZS5wcm90b3R5cGU9T2JqZWN0LmNyZWF0ZShyLnByb3RvdHlwZSksKGUucHJvdG90eXBlLmNvbnN0cnVjdG9yPWUpLnByb3RvdHlwZS50b1N0cmluZz1mdW5jdGlvbigpe3JldHVybiB2b2lkIDA9PT10aGlzLm1lc3NhZ2U/dGhpcy5uYW1lOnRoaXMubmFtZSsiOiAiK3RoaXMubWVzc2FnZX0sZX0sR2U9dm9pZCAwLFhlPXI9Pnt2YXIgZT13byhyKSx0PUxyKGUpO3JldHVybiBnbyhlKSx0fSxLZT0ocixlKT0+e3ZhciB0PVtdLG49e307ZnVuY3Rpb24gbyhyKXtuW3JdfHx4cltyXXx8KGpyW3JdP2pyW3JdLmZvckVhY2gobyk6KHQucHVzaChyKSxuW3JdPSEwKSl9dGhyb3cgZS5mb3JFYWNoKG8pLG5ldyBHZShyKyI6ICIrdC5tYXAoWGUpLmpvaW4oWyIsICJdKSl9LEplPShsLHIsZSxjLHQsZCxuLGYsbyxoLHAsYSxtKT0+e3A9THIocCksZD1xZSh0LGQpLGY9ZiYmcWUobixmKSxoPWgmJnFlKG8saCksbT1xZShhLG0pO3ZhciB2PUNlKHApO01lKHYsZnVuY3Rpb24oKXtLZShgQ2Fubm90IGNvbnN0cnVjdCAke3B9IGR1ZSB0byB1bmJvdW5kIHR5cGVzYCxbY10pfSksV3IoW2wscixlXSxjP1tjXTpbXSxmdW5jdGlvbihyKXt2YXIgZSx0O3I9clswXTt2YXIgdD1jPyhlPXIucmVnaXN0ZXJlZENsYXNzKS5pbnN0YW5jZVByb3RvdHlwZTpFZS5wcm90b3R5cGUsbj1UZSh2LGZ1bmN0aW9uKCl7aWYoT2JqZWN0LmdldFByb3RvdHlwZU9mKHRoaXMpIT09byl0aHJvdyBuZXcgQnIoIlVzZSAnbmV3JyB0byBjb25zdHJ1Y3QgIitwKTtpZih2b2lkIDA9PT1hLmNvbnN0cnVjdG9yX2JvZHkpdGhyb3cgbmV3IEJyKHArIiBoYXMgbm8gYWNjZXNzaWJsZSBjb25zdHJ1Y3RvciIpO3ZhciByPWEuY29uc3RydWN0b3JfYm9keVthcmd1bWVudHMubGVuZ3RoXTtpZih2b2lkIDA9PT1yKXRocm93IG5ldyBCcihgVHJpZWQgdG8gaW52b2tlIGN0b3Igb2YgJHtwfSB3aXRoIGludmFsaWQgbnVtYmVyIG9mIHBhcmFtZXRlcnMgKCR7YXJndW1lbnRzLmxlbmd0aH0pIC0gZXhwZWN0ZWQgKCR7T2JqZWN0LmtleXMoYS5jb25zdHJ1Y3Rvcl9ib2R5KS50b1N0cmluZygpfSkgcGFyYW1ldGVycyBpbnN0ZWFkIWApO3JldHVybiByLmFwcGx5KHRoaXMsYXJndW1lbnRzKX0pLG89T2JqZWN0LmNyZWF0ZSh0LHtjb25zdHJ1Y3Rvcjp7dmFsdWU6bn19KTtuLnByb3RvdHlwZT1vO3ZhciBhPW5ldyAkZShwLG4sbyxtLGUsZCxmLGgpO2EuYmFzZUNsYXNzJiYodm9pZCAwPT09YS5iYXNlQ2xhc3MuX19kZXJpdmVkQ2xhc3NlcyYmKGEuYmFzZUNsYXNzLl9fZGVyaXZlZENsYXNzZXM9W10pLGEuYmFzZUNsYXNzLl9fZGVyaXZlZENsYXNzZXMucHVzaChhKSk7dmFyIGk9bmV3IE5lKHAsYSwhMCwhMSwhMSkscz1uZXcgTmUocCsiKiIsYSwhMSwhMSwhMSksdT1uZXcgTmUocCsiIGNvbnN0KiIsYSwhMSwhMCwhMSk7cmV0dXJuIG5lW2xdPXtwb2ludGVyVHlwZTpzLGNvbnN0UG9pbnRlclR5cGU6dX0sSWUodixuKSxbaSxzLHVdfSl9LFplPShyLGUpPT57Zm9yKHZhciB0PVtdLG49MDtuPHI7bisrKXQucHVzaCh4W2UrNCpuPj4yXSk7cmV0dXJuIHR9O2Z1bmN0aW9uIFFlKHIsZSl7aWYoIShyIGluc3RhbmNlb2YgRnVuY3Rpb24pKXRocm93IG5ldyBUeXBlRXJyb3IoYG5ld18gY2FsbGVkIHdpdGggY29uc3RydWN0b3IgdHlwZSAke3R5cGVvZiByfSB3aGljaCBpcyBub3QgYSBmdW5jdGlvbmApO3ZhciB0PVRlKHIubmFtZXx8InVua25vd25GdW5jdGlvbk5hbWUiLGZ1bmN0aW9uKCl7fSk7dC5wcm90b3R5cGU9ci5wcm90b3R5cGU7dmFyIG49bmV3IHQsbz1yLmFwcGx5KG4sZSk7cmV0dXJuIG8gaW5zdGFuY2VvZiBPYmplY3Q/bzpufWZ1bmN0aW9uIHJ0KHIsZSx0LG4sbyxhKXt2YXIgaT1lLmxlbmd0aDtpPDImJlVyKCJhcmdUeXBlcyBhcnJheSBzaXplIG1pc21hdGNoISBNdXN0IGF0IGxlYXN0IGdldCByZXR1cm4gdmFsdWUgYW5kICd0aGlzJyB0eXBlcyEiKTtmb3IodmFyIHM9bnVsbCE9PWVbMV0mJm51bGwhPT10LHU9ITEsbD0xO2w8ZS5sZW5ndGg7KytsKWlmKG51bGwhPT1lW2xdJiZ2b2lkIDA9PT1lW2xdLmRlc3RydWN0b3JGdW5jdGlvbil7dT0hMDticmVha31mb3IodmFyIGM9InZvaWQiIT09ZVswXS5uYW1lLGQ9IiIsZj0iIixsPTA7bDxpLTI7KytsKWQrPSgwIT09bD8iLCAiOiIiKSsiYXJnIitsLGYrPSgwIT09bD8iLCAiOiIiKSsiYXJnIitsKyJXaXJlZCI7dmFyIGg9YAogICAgICAgIHJldHVybiBmdW5jdGlvbiAke0NlKHIpfSgke2R9KSB7CiAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggIT09ICR7aS0yfSkgewogICAgICAgICAgdGhyb3dCaW5kaW5nRXJyb3IoJ2Z1bmN0aW9uICR7cn0gY2FsbGVkIHdpdGggJyArIGFyZ3VtZW50cy5sZW5ndGggKyAnIGFyZ3VtZW50cywgZXhwZWN0ZWQgJHtpLTJ9Jyk7CiAgICAgICAgfWA7dSYmKGgrPSJ2YXIgZGVzdHJ1Y3RvcnMgPSBbXTtcbiIpO3ZhciBwPXU/ImRlc3RydWN0b3JzIjoibnVsbCIsbT1bInRocm93QmluZGluZ0Vycm9yIiwiaW52b2tlciIsImZuIiwicnVuRGVzdHJ1Y3RvcnMiLCJyZXRUeXBlIiwiY2xhc3NQYXJhbSJdLHY9W1VyLG4sbyxGcixlWzBdLGVbMV1dO3MmJihoKz0idmFyIHRoaXNXaXJlZCA9IGNsYXNzUGFyYW0udG9XaXJlVHlwZSgiK3ArIiwgdGhpcyk7XG4iKTtmb3IodmFyIGw9MDtsPGktMjsrK2wpaCs9InZhciBhcmciK2wrIldpcmVkID0gYXJnVHlwZSIrbCsiLnRvV2lyZVR5cGUoIitwKyIsIGFyZyIrbCsiKTsgLy8gIitlW2wrMl0ubmFtZSsiXG4iLG0ucHVzaCgiYXJnVHlwZSIrbCksdi5wdXNoKGVbbCsyXSk7aWYoaCs9KGN8fGE/InZhciBydiA9ICI6IiIpKyJpbnZva2VyKGZuIisoMDwoZj1zPyJ0aGlzV2lyZWQiKygwPGYubGVuZ3RoPyIsICI6IiIpK2Y6ZikubGVuZ3RoPyIsICI6IiIpK2YrIik7XG4iLHUpaCs9InJ1bkRlc3RydWN0b3JzKGRlc3RydWN0b3JzKTtcbiI7ZWxzZSBmb3IodmFyIGw9cz8xOjI7bDxlLmxlbmd0aDsrK2wpe3ZhciB5PTE9PT1sPyJ0aGlzV2lyZWQiOiJhcmciKyhsLTIpKyJXaXJlZCI7bnVsbCE9PWVbbF0uZGVzdHJ1Y3RvckZ1bmN0aW9uJiYoaCs9eSsiX2R0b3IoIit5KyIpOyAvLyAiK2VbbF0ubmFtZSsiXG4iLG0ucHVzaCh5KyJfZHRvciIpLHYucHVzaChlW2xdLmRlc3RydWN0b3JGdW5jdGlvbikpfXJldHVybiBjJiYoaCs9InZhciByZXQgPSByZXRUeXBlLmZyb21XaXJlVHlwZShydik7XG5yZXR1cm4gcmV0O1xuIiksbS5wdXNoKGgrPSJ9XG4iKSxRZShGdW5jdGlvbixtKS5hcHBseShudWxsLHYpfXZhciBldD0ocixuLGUsdCxvLGEpPT57dmFyIGk9WmUobixlKTtvPXFlKHQsbyksV3IoW10sW3JdLGZ1bmN0aW9uKGUpe3ZhciB0PSJjb25zdHJ1Y3RvciAiKyhlPWVbMF0pLm5hbWU7aWYodm9pZCAwPT09ZS5yZWdpc3RlcmVkQ2xhc3MuY29uc3RydWN0b3JfYm9keSYmKGUucmVnaXN0ZXJlZENsYXNzLmNvbnN0cnVjdG9yX2JvZHk9W10pLHZvaWQgMCE9PWUucmVnaXN0ZXJlZENsYXNzLmNvbnN0cnVjdG9yX2JvZHlbbi0xXSl0aHJvdyBuZXcgQnIoYENhbm5vdCByZWdpc3RlciBtdWx0aXBsZSBjb25zdHJ1Y3RvcnMgd2l0aCBpZGVudGljYWwgbnVtYmVyIG9mIHBhcmFtZXRlcnMgKCR7bi0xfSkgZm9yIGNsYXNzICcke2UubmFtZX0nISBPdmVybG9hZCByZXNvbHV0aW9uIGlzIGN1cnJlbnRseSBvbmx5IHBlcmZvcm1lZCB1c2luZyB0aGUgcGFyYW1ldGVyIGNvdW50LCBub3QgYWN0dWFsIHR5cGUgaW5mbyFgKTtyZXR1cm4gZS5yZWdpc3RlcmVkQ2xhc3MuY29uc3RydWN0b3JfYm9keVtuLTFdPSgpPT57S2UoYENhbm5vdCBjb25zdHJ1Y3QgJHtlLm5hbWV9IGR1ZSB0byB1bmJvdW5kIHR5cGVzYCxpKX0sV3IoW10saSxyPT4oci5zcGxpY2UoMSwwLG51bGwpLGUucmVnaXN0ZXJlZENsYXNzLmNvbnN0cnVjdG9yX2JvZHlbbi0xXT1ydCh0LHIsbnVsbCxvLGEpLFtdKSksW119KX0sdHQ9KHIsYSxpLGUsdCxzLHUsbCxjKT0+e3ZhciBkPVplKGksZSk7YT1McihhKSxzPXFlKHQscyksV3IoW10sW3JdLGZ1bmN0aW9uKHQpe3ZhciBuPSh0PXRbMF0pLm5hbWUrIi4iK2E7ZnVuY3Rpb24gcigpe0tlKGBDYW5ub3QgY2FsbCAke259IGR1ZSB0byB1bmJvdW5kIHR5cGVzYCxkKX1hLnN0YXJ0c1dpdGgoIkBAIikmJihhPVN5bWJvbFthLnN1YnN0cmluZygyKV0pLGwmJnQucmVnaXN0ZXJlZENsYXNzLnB1cmVWaXJ0dWFsRnVuY3Rpb25zLnB1c2goYSk7dmFyIG89dC5yZWdpc3RlcmVkQ2xhc3MuaW5zdGFuY2VQcm90b3R5cGUsZT1vW2FdO3JldHVybiB2b2lkIDA9PT1lfHx2b2lkIDA9PT1lLm92ZXJsb2FkVGFibGUmJmUuY2xhc3NOYW1lIT09dC5uYW1lJiZlLmFyZ0NvdW50PT09aS0yPyhyLmFyZ0NvdW50PWktMixyLmNsYXNzTmFtZT10Lm5hbWUsb1thXT1yKTooU2UobyxhLG4pLG9bYV0ub3ZlcmxvYWRUYWJsZVtpLTJdPXIpLFdyKFtdLGQsZnVuY3Rpb24ocil7dmFyIGU9cnQobixyLHQscyx1LGMpO3JldHVybiB2b2lkIDA9PT1vW2FdLm92ZXJsb2FkVGFibGU/KGUuYXJnQ291bnQ9aS0yLG9bYV09ZSk6b1thXS5vdmVybG9hZFRhYmxlW2ktMl09ZSxbXX0pLFtdfSl9O2Z1bmN0aW9uIG50KCl7T2JqZWN0LmFzc2lnbihvdC5wcm90b3R5cGUse2dldChyKXtyZXR1cm4gdGhpcy5hbGxvY2F0ZWRbcl19LGhhcyhyKXtyZXR1cm4gdm9pZCAwIT09dGhpcy5hbGxvY2F0ZWRbcl19LGFsbG9jYXRlKHIpe3ZhciBlPXRoaXMuZnJlZWxpc3QucG9wKCl8fHRoaXMuYWxsb2NhdGVkLmxlbmd0aDtyZXR1cm4gdGhpcy5hbGxvY2F0ZWRbZV09cixlfSxmcmVlKHIpe3RoaXMuYWxsb2NhdGVkW3JdPXZvaWQgMCx0aGlzLmZyZWVsaXN0LnB1c2gocil9fSl9ZnVuY3Rpb24gb3QoKXt0aGlzLmFsbG9jYXRlZD1bdm9pZCAwXSx0aGlzLmZyZWVsaXN0PVtdfXZhciBhdD1uZXcgb3QsaXQ9cj0+e3I+PWF0LnJlc2VydmVkJiYwPT0tLWF0LmdldChyKS5yZWZjb3VudCYmYXQuZnJlZShyKX0sc3Q9KCk9Pntmb3IodmFyIHI9MCxlPWF0LnJlc2VydmVkO2U8YXQuYWxsb2NhdGVkLmxlbmd0aDsrK2Updm9pZCAwIT09YXQuYWxsb2NhdGVkW2VdJiYrK3I7cmV0dXJuIHJ9LHV0PSgpPT57YXQuYWxsb2NhdGVkLnB1c2goe3ZhbHVlOnZvaWQgMH0se3ZhbHVlOm51bGx9LHt2YWx1ZTohMH0se3ZhbHVlOiExfSksYXQucmVzZXJ2ZWQ9YXQuYWxsb2NhdGVkLmxlbmd0aCx5LmNvdW50X2VtdmFsX2hhbmRsZXM9c3R9LGx0PXt0b1ZhbHVlOnI9PihyfHxVcigiQ2Fubm90IHVzZSBkZWxldGVkIHZhbC4gaGFuZGxlID0gIityKSxhdC5nZXQocikudmFsdWUpLHRvSGFuZGxlOnI9Pntzd2l0Y2gocil7Y2FzZSB2b2lkIDA6cmV0dXJuIDE7Y2FzZSBudWxsOnJldHVybiAyO2Nhc2UhMDpyZXR1cm4gMztjYXNlITE6cmV0dXJuIDQ7ZGVmYXVsdDpyZXR1cm4gYXQuYWxsb2NhdGUoe3JlZmNvdW50OjEsdmFsdWU6cn0pfX19LGN0PShyLGUpPT57cXIocix7bmFtZTplPUxyKGUpLGZyb21XaXJlVHlwZTpyPT57dmFyIGU9bHQudG9WYWx1ZShyKTtyZXR1cm4gaXQociksZX0sdG9XaXJlVHlwZToocixlKT0+bHQudG9IYW5kbGUoZSksYXJnUGFja0FkdmFuY2U6OCxyZWFkVmFsdWVGcm9tUG9pbnRlcjpBcixkZXN0cnVjdG9yRnVuY3Rpb246bnVsbH0pfSxkdD0ocixlLHQpPT57c3dpdGNoKGUpe2Nhc2UgMTpyZXR1cm4gdD9mdW5jdGlvbihyKXtyZXR1cm4gdGhpcy5mcm9tV2lyZVR5cGUoTVtyPj4wXSl9OmZ1bmN0aW9uKHIpe3JldHVybiB0aGlzLmZyb21XaXJlVHlwZSgkW3I+PjBdKX07Y2FzZSAyOnJldHVybiB0P2Z1bmN0aW9uKHIpe3JldHVybiB0aGlzLmZyb21XaXJlVHlwZShGW3I+PjFdKX06ZnVuY3Rpb24ocil7cmV0dXJuIHRoaXMuZnJvbVdpcmVUeXBlKEFbcj4+MV0pfTtjYXNlIDQ6cmV0dXJuIHQ/ZnVuY3Rpb24ocil7cmV0dXJuIHRoaXMuZnJvbVdpcmVUeXBlKERbcj4+Ml0pfTpmdW5jdGlvbihyKXtyZXR1cm4gdGhpcy5mcm9tV2lyZVR5cGUoeFtyPj4yXSl9O2RlZmF1bHQ6dGhyb3cgbmV3IFR5cGVFcnJvcihgaW52YWxpZCBpbnRlZ2VyIHdpZHRoICgke2V9KTogYCtyKX19LGZ0PShyLGUsdCxuKT0+e2Z1bmN0aW9uIG8oKXt9ZT1McihlKSxvLnZhbHVlcz17fSxxcihyLHtuYW1lOmUsY29uc3RydWN0b3I6byxmcm9tV2lyZVR5cGU6ZnVuY3Rpb24ocil7cmV0dXJuIHRoaXMuY29uc3RydWN0b3IudmFsdWVzW3JdfSx0b1dpcmVUeXBlOihyLGUpPT5lLnZhbHVlLGFyZ1BhY2tBZHZhbmNlOjgscmVhZFZhbHVlRnJvbVBvaW50ZXI6ZHQoZSx0LG4pLGRlc3RydWN0b3JGdW5jdGlvbjpudWxsfSksTWUoZSxvKX0saHQ9KHIsZSk9Pnt2YXIgdD14cltyXTtyZXR1cm4gdm9pZCAwPT09dCYmVXIoZSsiIGhhcyB1bmtub3duIHR5cGUgIitYZShyKSksdH0scHQ9KHIsZSx0KT0+e3ZhciBuPWh0KHIsImVudW0iKTtlPUxyKGUpO3ZhciBvPW4uY29uc3RydWN0b3IsYT1PYmplY3QuY3JlYXRlKG4uY29uc3RydWN0b3IucHJvdG90eXBlLHt2YWx1ZTp7dmFsdWU6dH0sY29uc3RydWN0b3I6e3ZhbHVlOlRlKG4ubmFtZSsiXyIrZSxmdW5jdGlvbigpe30pfX0pO28udmFsdWVzW3RdPWEsb1tlXT1hfSxtdD1yPT57aWYobnVsbD09PXIpcmV0dXJuIm51bGwiO3ZhciBlPXR5cGVvZiByO3JldHVybiJvYmplY3QiPT1lfHwiYXJyYXkiPT1lfHwiZnVuY3Rpb24iPT1lP3IudG9TdHJpbmcoKToiIityfSx2dD0ocixlKT0+e3N3aXRjaChlKXtjYXNlIDQ6cmV0dXJuIGZ1bmN0aW9uKHIpe3JldHVybiB0aGlzLmZyb21XaXJlVHlwZShqW3I+PjJdKX07Y2FzZSA4OnJldHVybiBmdW5jdGlvbihyKXtyZXR1cm4gdGhpcy5mcm9tV2lyZVR5cGUoT1tyPj4zXSl9O2RlZmF1bHQ6dGhyb3cgbmV3IFR5cGVFcnJvcihgaW52YWxpZCBmbG9hdCB3aWR0aCAoJHtlfSk6IGArcil9fSx5dD0ocixlLHQpPT57cXIocix7bmFtZTplPUxyKGUpLGZyb21XaXJlVHlwZTpyPT5yLHRvV2lyZVR5cGU6KHIsZSk9PmUsYXJnUGFja0FkdmFuY2U6OCxyZWFkVmFsdWVGcm9tUG9pbnRlcjp2dChlLHQpLGRlc3RydWN0b3JGdW5jdGlvbjpudWxsfSl9LGd0PSh0LG4scixlLG8sYSxpKT0+e3ZhciBzPVplKG4scik7dD1Mcih0KSxvPXFlKGUsbyksTWUodCxmdW5jdGlvbigpe0tlKGBDYW5ub3QgY2FsbCAke3R9IGR1ZSB0byB1bmJvdW5kIHR5cGVzYCxzKX0sbi0xKSxXcihbXSxzLGZ1bmN0aW9uKHIpe3ZhciBlPVtyWzBdLG51bGxdLmNvbmNhdChyLnNsaWNlKDEpKTtyZXR1cm4gSWUodCxydCh0LGUsbnVsbCxvLGEsaSksbi0xKSxbXX0pfSx3dD0ocixlLHQpPT57c3dpdGNoKGUpe2Nhc2UgMTpyZXR1cm4gdD9yPT5NW3I+PjBdOnI9PiRbcj4+MF07Y2FzZSAyOnJldHVybiB0P3I9PkZbcj4+MV06cj0+QVtyPj4xXTtjYXNlIDQ6cmV0dXJuIHQ/cj0+RFtyPj4yXTpyPT54W3I+PjJdO2RlZmF1bHQ6dGhyb3cgbmV3IFR5cGVFcnJvcihgaW52YWxpZCBpbnRlZ2VyIHdpZHRoICgke2V9KTogYCtyKX19LF90PShyLGUsdCxuLG8pPT57ZT1McihlKSwtMT09PW8mJihvPTQyOTQ5NjcyOTUpO3ZhciBhPXI9PnIsaSxhOzA9PT1uJiYoaT0zMi04KnQsYT1yPT5yPDxpPj4+aSk7dmFyIHM9ZS5pbmNsdWRlcygidW5zaWduZWQiKSx1PShyLGUpPT57fSxsLGw9cz9mdW5jdGlvbihyLGUpe3JldHVybiB0aGlzLm5hbWUsZT4+PjB9OmZ1bmN0aW9uKHIsZSl7cmV0dXJuIHRoaXMubmFtZSxlfTtxcihyLHtuYW1lOmUsZnJvbVdpcmVUeXBlOmEsdG9XaXJlVHlwZTpsLGFyZ1BhY2tBZHZhbmNlOjgscmVhZFZhbHVlRnJvbVBvaW50ZXI6d3QoZSx0LDAhPT1uKSxkZXN0cnVjdG9yRnVuY3Rpb246bnVsbH0pfSxidD0ocixlLHQpPT57dmFyIG4sbz1bSW50OEFycmF5LFVpbnQ4QXJyYXksSW50MTZBcnJheSxVaW50MTZBcnJheSxJbnQzMkFycmF5LFVpbnQzMkFycmF5LEZsb2F0MzJBcnJheSxGbG9hdDY0QXJyYXldW2VdO2Z1bmN0aW9uIGEocil7dmFyIGU9eFtyPj4yXSx0PXhbcis0Pj4yXTtyZXR1cm4gbmV3IG8oTS5idWZmZXIsdCxlKX1xcihyLHtuYW1lOnQ9THIodCksZnJvbVdpcmVUeXBlOmEsYXJnUGFja0FkdmFuY2U6OCxyZWFkVmFsdWVGcm9tUG9pbnRlcjphfSx7aWdub3JlRHVwbGljYXRlUmVnaXN0cmF0aW9uczohMH0pfSxFdD0ocixlLHQsbik9PntpZighKDA8bikpcmV0dXJuIDA7Zm9yKHZhciBvPXQsYT10K24tMSxpPTA7aTxyLmxlbmd0aDsrK2kpe3ZhciBzPXIuY2hhckNvZGVBdChpKSx1LHM7aWYoKHM9NTUyOTY8PXMmJnM8PTU3MzQzPzY1NTM2KygoMTAyMyZzKTw8MTApfDEwMjMmci5jaGFyQ29kZUF0KCsraSk6cyk8PTEyNyl7aWYoYTw9dClicmVhaztlW3QrK109c31lbHNlIGlmKHM8PTIwNDcpe2lmKGE8PXQrMSlicmVhaztlW3QrK109MTkyfHM+PjYsZVt0KytdPTEyOHw2MyZzfWVsc2UgaWYoczw9NjU1MzUpe2lmKGE8PXQrMilicmVhaztlW3QrK109MjI0fHM+PjEyLGVbdCsrXT0xMjh8cz4+NiY2MyxlW3QrK109MTI4fDYzJnN9ZWxzZXtpZihhPD10KzMpYnJlYWs7ZVt0KytdPTI0MHxzPj4xOCxlW3QrK109MTI4fHM+PjEyJjYzLGVbdCsrXT0xMjh8cz4+NiY2MyxlW3QrK109MTI4fDYzJnN9fXJldHVybiBlW3RdPTAsdC1vfSxrdD0ocixlLHQpPT5FdChyLCQsZSx0KSxQdD1yPT57Zm9yKHZhciBlPTAsdD0wO3Q8ci5sZW5ndGg7Kyt0KXt2YXIgbj1yLmNoYXJDb2RlQXQodCk7bjw9MTI3P2UrKzpuPD0yMDQ3P2UrPTI6NTUyOTY8PW4mJm48PTU3MzQzPyhlKz00LCsrdCk6ZSs9M31yZXR1cm4gZX0sQ3Q9InVuZGVmaW5lZCIhPXR5cGVvZiBUZXh0RGVjb2Rlcj9uZXcgVGV4dERlY29kZXIoInV0ZjgiKTp2b2lkIDAsVHQ9KHIsZSx0KT0+e2Zvcih2YXIgbj1lK3Qsbz1lO3Jbb10mJiEobjw9byk7KSsrbztpZigxNjxvLWUmJnIuYnVmZmVyJiZDdClyZXR1cm4gQ3QuZGVjb2RlKHIuc3ViYXJyYXkoZSxvKSk7Zm9yKHZhciBhPSIiO2U8bzspe3ZhciBpPXJbZSsrXSxzLHUsbCxpOzEyOCZpPyhzPTYzJnJbZSsrXSwxOTIhPSgyMjQmaSk/KHU9NjMmcltlKytdLChpPTIyND09KDI0MCZpKT8oMTUmaSk8PDEyfHM8PDZ8dTooNyZpKTw8MTh8czw8MTJ8dTw8Nnw2MyZyW2UrK10pPDY1NTM2P2ErPVN0cmluZy5mcm9tQ2hhckNvZGUoaSk6KGw9aS02NTUzNixhKz1TdHJpbmcuZnJvbUNoYXJDb2RlKDU1Mjk2fGw+PjEwLDU2MzIwfDEwMjMmbCkpKTphKz1TdHJpbmcuZnJvbUNoYXJDb2RlKCgzMSZpKTw8NnxzKSk6YSs9U3RyaW5nLmZyb21DaGFyQ29kZShpKX1yZXR1cm4gYX0sU3Q9KHIsZSk9PnI/VHQoJCxyLGUpOiIiLE10PShyLGUpPT57dmFyIGM9InN0ZDo6c3RyaW5nIj09PShlPUxyKGUpKTtxcihyLHtuYW1lOmUsZnJvbVdpcmVUeXBlOnI9Pnt2YXIgZT14W3I+PjJdLHQ9cis0LG47aWYoYylmb3IodmFyIG89dCxhPTA7YTw9ZTsrK2Epe3ZhciBpPXQrYSxzLHU7YSE9ZSYmMCE9JFtpXXx8KHU9U3QobyxpLW8pLHZvaWQgMD09PW4/bj11OihuKz1TdHJpbmcuZnJvbUNoYXJDb2RlKDApLG4rPXUpLG89aSsxKX1lbHNle2Zvcih2YXIgbD1uZXcgQXJyYXkoZSksYT0wO2E8ZTsrK2EpbFthXT1TdHJpbmcuZnJvbUNoYXJDb2RlKCRbdCthXSk7bj1sLmpvaW4oIiIpfXJldHVybiBnbyhyKSxufSx0b1dpcmVUeXBlOihyLGUpPT57dmFyIHQsbj0ic3RyaW5nIj09dHlwZW9mKGU9ZSBpbnN0YW5jZW9mIEFycmF5QnVmZmVyP25ldyBVaW50OEFycmF5KGUpOmUpO258fGUgaW5zdGFuY2VvZiBVaW50OEFycmF5fHxlIGluc3RhbmNlb2YgVWludDhDbGFtcGVkQXJyYXl8fGUgaW5zdGFuY2VvZiBJbnQ4QXJyYXl8fFVyKCJDYW5ub3QgcGFzcyBub24tc3RyaW5nIHRvIHN0ZDo6c3RyaW5nIik7dmFyIHQ9YyYmbj9QdChlKTplLmxlbmd0aCxvPXlvKDQrdCsxKSxhPW8rNDtpZih4W28+PjJdPXQsYyYmbilrdChlLGEsdCsxKTtlbHNlIGlmKG4pZm9yKHZhciBpPTA7aTx0OysraSl7dmFyIHM9ZS5jaGFyQ29kZUF0KGkpOzI1NTxzJiYoZ28oYSksVXIoIlN0cmluZyBoYXMgVVRGLTE2IGNvZGUgdW5pdHMgdGhhdCBkbyBub3QgZml0IGluIDggYml0cyIpKSwkW2EraV09c31lbHNlIGZvcih2YXIgaT0wO2k8dDsrK2kpJFthK2ldPWVbaV07cmV0dXJuIG51bGwhPT1yJiZyLnB1c2goZ28sbyksb30sYXJnUGFja0FkdmFuY2U6OCxyZWFkVmFsdWVGcm9tUG9pbnRlcjpqZSxkZXN0cnVjdG9yRnVuY3Rpb246cj0+Z28ocil9KX0sJHQ9InVuZGVmaW5lZCIhPXR5cGVvZiBUZXh0RGVjb2Rlcj9uZXcgVGV4dERlY29kZXIoInV0Zi0xNmxlIik6dm9pZCAwLEZ0PShyLGUpPT57Zm9yKHZhciB0PXIsbj1yPj4xLG89bitlLzI7IShvPD1uKSYmQVtuXTspKytuO2lmKDMyPCh0PW48PDEpLXImJiR0KXJldHVybiAkdC5kZWNvZGUoJC5zdWJhcnJheShyLHQpKTtmb3IodmFyIGE9IiIsaT0wOyEoZS8yPD1pKTsrK2kpe3ZhciBzPUZbcisyKmk+PjFdO2lmKDA9PXMpYnJlYWs7YSs9U3RyaW5nLmZyb21DaGFyQ29kZShzKX1yZXR1cm4gYX0sQXQ9KHIsZSx0KT0+e2lmKCh0PXZvaWQgMD09PXQ/MjE0NzQ4MzY0Nzp0KTwyKXJldHVybiAwO2Zvcih2YXIgbj1lLG89KHQtPTIpPDIqci5sZW5ndGg/dC8yOnIubGVuZ3RoLGE9MDthPG87KythKXt2YXIgaT1yLmNoYXJDb2RlQXQoYSk7RltlPj4xXT1pLGUrPTJ9cmV0dXJuIEZbZT4+MV09MCxlLW59LER0PXI9PjIqci5sZW5ndGgseHQ9KHIsZSk9Pntmb3IodmFyIHQ9MCxuPSIiOyEoZS80PD10KTspe3ZhciBvPURbcis0KnQ+PjJdLGE7aWYoMD09bylicmVhazsrK3QsNjU1MzY8PW8/KGE9by02NTUzNixuKz1TdHJpbmcuZnJvbUNoYXJDb2RlKDU1Mjk2fGE+PjEwLDU2MzIwfDEwMjMmYSkpOm4rPVN0cmluZy5mcm9tQ2hhckNvZGUobyl9cmV0dXJuIG59LGp0PShyLGUsdCk9PntpZigodD12b2lkIDA9PT10PzIxNDc0ODM2NDc6dCk8NClyZXR1cm4gMDtmb3IodmFyIG49ZSxvPW4rdC00LGE9MDthPHIubGVuZ3RoOysrYSl7dmFyIGk9ci5jaGFyQ29kZUF0KGEpLHMsaTtpZig1NTI5Njw9aSYmaTw9NTczNDMmJihpPTY1NTM2KygoMTAyMyZpKTw8MTApfDEwMjMmci5jaGFyQ29kZUF0KCsrYSkpLERbZT4+Ml09aSxvPChlKz00KSs0KWJyZWFrfXJldHVybiBEW2U+PjJdPTAsZS1ufSxPdD1yPT57Zm9yKHZhciBlPTAsdD0wO3Q8ci5sZW5ndGg7Kyt0KXt2YXIgbj1yLmNoYXJDb2RlQXQodCk7NTUyOTY8PW4mJm48PTU3MzQzJiYrK3QsZSs9NH1yZXR1cm4gZX0sUnQ9KHIsbCxvKT0+e3ZhciBjLGEsZCxpLGY7bz1McihvKSwyPT09bD8oYz1GdCxhPUF0LGk9RHQsZD0oKT0+QSxmPTEpOjQ9PT1sJiYoYz14dCxhPWp0LGk9T3QsZD0oKT0+eCxmPTIpLHFyKHIse25hbWU6byxmcm9tV2lyZVR5cGU6cj0+e2Zvcih2YXIgZT14W3I+PjJdLHQ9ZCgpLG4sbz1yKzQsYT0wO2E8PWU7KythKXt2YXIgaT1yKzQrYSpsLHMsdTthIT1lJiYwIT10W2k+PmZdfHwodT1jKG8saS1vKSx2b2lkIDA9PT1uP249dToobis9U3RyaW5nLmZyb21DaGFyQ29kZSgwKSxuKz11KSxvPWkrbCl9cmV0dXJuIGdvKHIpLG59LHRvV2lyZVR5cGU6KHIsZSk9Pnsic3RyaW5nIiE9dHlwZW9mIGUmJlVyKCJDYW5ub3QgcGFzcyBub24tc3RyaW5nIHRvIEMrKyBzdHJpbmcgdHlwZSAiK28pO3ZhciB0PWkoZSksbj15byg0K3QrbCk7cmV0dXJuIHhbbj4+Ml09dD4+ZixhKGUsbis0LHQrbCksbnVsbCE9PXImJnIucHVzaChnbyxuKSxufSxhcmdQYWNrQWR2YW5jZTo4LHJlYWRWYWx1ZUZyb21Qb2ludGVyOkFyLGRlc3RydWN0b3JGdW5jdGlvbjpyPT5nbyhyKX0pfSxXdD0ocixlLHQsbixvLGEpPT57JHJbcl09e25hbWU6THIoZSkscmF3Q29uc3RydWN0b3I6cWUodCxuKSxyYXdEZXN0cnVjdG9yOnFlKG8sYSksZmllbGRzOltdfX0senQ9KHIsZSx0LG4sbyxhLGkscyx1LGwpPT57JHJbcl0uZmllbGRzLnB1c2goe2ZpZWxkTmFtZTpMcihlKSxnZXR0ZXJSZXR1cm5UeXBlOnQsZ2V0dGVyOnFlKG4sbyksZ2V0dGVyQ29udGV4dDphLHNldHRlckFyZ3VtZW50VHlwZTppLHNldHRlcjpxZShzLHUpLHNldHRlckNvbnRleHQ6bH0pfSxOdD0ocixlKT0+e3FyKHIse2lzVm9pZDohMCxuYW1lOmU9THIoZSksYXJnUGFja0FkdmFuY2U6MCxmcm9tV2lyZVR5cGU6KCk9Pnt9LHRvV2lyZVR5cGU6KHIsZSk9Pnt9fSl9LEl0PShyLGUsdCk9PntyPWx0LnRvVmFsdWUociksZT1odChlLCJlbXZhbDo6YXMiKTt2YXIgbj1bXSxvPWx0LnRvSGFuZGxlKG4pO3JldHVybiB4W3Q+PjJdPW8sZS50b1dpcmVUeXBlKG4scil9LFZ0PXI9Pnt2YXIgZT1bXTtyZXR1cm4geFtyPj4yXT1sdC50b0hhbmRsZShlKSxlfSxMdD17fSxCdD1yPT57dmFyIGU9THRbcl07cmV0dXJuIHZvaWQgMD09PWU/THIocik6ZX0sVXQ9W10sSHQ9KHIsZSx0LG4sbyk9PihyPVV0W3JdKShlPWx0LnRvVmFsdWUoZSksdD1CdCh0KSxWdChuKSxvKSxxdD0ocixlLHQsbik9Pnsocj1VdFtyXSkoZT1sdC50b1ZhbHVlKGUpLHQ9QnQodCksbnVsbCxuKX0sWXQ9KHIsZSk9PihyPWx0LnRvVmFsdWUocikpPT0oZT1sdC50b1ZhbHVlKGUpKSxHdD1yPT57dmFyIGU9VXQubGVuZ3RoO3JldHVybiBVdC5wdXNoKHIpLGV9LFh0PShyLGUpPT57Zm9yKHZhciB0PW5ldyBBcnJheShyKSxuPTA7bjxyOysrbil0W25dPWh0KHhbZSs0Km4+PjJdLCJwYXJhbWV0ZXIgIituKTtyZXR1cm4gdH0sS3Q9W10sSnQ9KHIsZSk9Pnt2YXIgdD1YdChyLGUpLG49dFswXSxvPW4ubmFtZSsiXyQiK3Quc2xpY2UoMSkubWFwKGZ1bmN0aW9uKHIpe3JldHVybiByLm5hbWV9KS5qb2luKCJfIikrIiQiLGE7aWYodm9pZCAwIT09KGE9S3Rbb10pKXJldHVybiBhO2Zvcih2YXIgaT1bInJldFR5cGUiXSxzPVtuXSx1PSIiLGw9MDtsPHItMTsrK2wpdSs9KDAhPT1sPyIsICI6IiIpKyJhcmciK2wsaS5wdXNoKCJhcmdUeXBlIitsKSxzLnB1c2godFsxK2xdKTtmb3IodmFyIGMsZD0icmV0dXJuIGZ1bmN0aW9uICIrQ2UoIm1ldGhvZENhbGxlcl8iK28pKyIoaGFuZGxlLCBuYW1lLCBkZXN0cnVjdG9ycywgYXJncykge1xuIixmPTAsbD0wO2w8ci0xOysrbClkKz0iICAgIHZhciBhcmciK2wrIiA9IGFyZ1R5cGUiK2wrIi5yZWFkVmFsdWVGcm9tUG9pbnRlcihhcmdzIisoZj8iKyIrZjoiIikrIik7XG4iLGYrPXRbbCsxXS5hcmdQYWNrQWR2YW5jZTtkKz0iICAgIHZhciBydiA9IGhhbmRsZVtuYW1lXSgiK3UrIik7XG4iO2Zvcih2YXIgbD0wO2w8ci0xOysrbCl0W2wrMV0uZGVsZXRlT2JqZWN0JiYoZCs9IiAgICBhcmdUeXBlIitsKyIuZGVsZXRlT2JqZWN0KGFyZyIrbCsiKTtcbiIpO24uaXNWb2lkfHwoZCs9IiAgICByZXR1cm4gcmV0VHlwZS50b1dpcmVUeXBlKGRlc3RydWN0b3JzLCBydik7XG4iKSxpLnB1c2goZCs9In07XG4iKTt2YXIgaD1RZShGdW5jdGlvbixpKS5hcHBseShudWxsLHMpLGE9R3QoaCk7cmV0dXJuIEt0W29dPWF9LFp0PShyLGUpPT4ocj1sdC50b1ZhbHVlKHIpLGU9bHQudG9WYWx1ZShlKSxsdC50b0hhbmRsZShyW2VdKSksUXQ9cj0+ezQ8ciYmKGF0LmdldChyKS5yZWZjb3VudCs9MSl9LHJuPXI9Pmx0LnRvSGFuZGxlKEJ0KHIpKSxlbj0oKT0+bHQudG9IYW5kbGUoe30pLHRuPXI9Pnt2YXIgZT1sdC50b1ZhbHVlKHIpO0ZyKGUpLGl0KHIpfSxubj0ocixlLHQpPT57cj1sdC50b1ZhbHVlKHIpLGU9bHQudG9WYWx1ZShlKSx0PWx0LnRvVmFsdWUodCkscltlXT10fSxvbj0ocixlKT0+e3ZhciB0PShyPWh0KHIsIl9lbXZhbF90YWtlX3ZhbHVlIikpLnJlYWRWYWx1ZUZyb21Qb2ludGVyKGUpO3JldHVybiBsdC50b0hhbmRsZSh0KX0sYW49KCk9PntlcigiIil9LHNuPShyLGUsdCk9PiQuY29weVdpdGhpbihyLGUsZSt0KSx1bj0oKT0+MjE0NzQ4MzY0OCxsbj1yPT57dmFyIGUsdD0oci1DLmJ1ZmZlci5ieXRlTGVuZ3RoKzY1NTM1KS82NTUzNjt0cnl7cmV0dXJuIEMuZ3Jvdyh0KSx6KCksMX1jYXRjaChyKXt9fSxjbj1yPT57dmFyIGU9JC5sZW5ndGgsdD11bigpO2lmKHQ8KHI+Pj49MCkpcmV0dXJuITE7Zm9yKHZhciBuPShyLGUpPT5yKyhlLXIlZSklZSxvPTE7bzw9NDtvKj0yKXt2YXIgYT1lKigxKy4yL28pLGE9TWF0aC5taW4oYSxyKzEwMDY2MzI5NiksaT1NYXRoLm1pbih0LG4oTWF0aC5tYXgocixhKSw2NTUzNikpLHM7aWYobG4oaSkpcmV0dXJuITB9cmV0dXJuITF9LGRuPXt9LGZuPSgpPT5hfHwiLi90aGlzLnByb2dyYW0iLGhuPSgpPT57aWYoIWhuLnN0cmluZ3Mpe3ZhciByLGU9e1VTRVI6IndlYl91c2VyIixMT0dOQU1FOiJ3ZWJfdXNlciIsUEFUSDoiLyIsUFdEOiIvIixIT01FOiIvaG9tZS93ZWJfdXNlciIsTEFORzooIm9iamVjdCI9PXR5cGVvZiBuYXZpZ2F0b3ImJm5hdmlnYXRvci5sYW5ndWFnZXMmJm5hdmlnYXRvci5sYW5ndWFnZXNbMF18fCJDIikucmVwbGFjZSgiLSIsIl8iKSsiLlVURi04IixfOmZuKCl9LHQ7Zm9yKHQgaW4gZG4pdm9pZCAwPT09ZG5bdF0/ZGVsZXRlIGVbdF06ZVt0XT1kblt0XTt2YXIgbj1bXSx0O2Zvcih0IGluIGUpbi5wdXNoKHQrIj0iK2VbdF0pO2huLnN0cmluZ3M9bn1yZXR1cm4gaG4uc3RyaW5nc30scG49KHIsZSk9Pntmb3IodmFyIHQ9MDt0PHIubGVuZ3RoOysrdClNW2UrKz4+MF09ci5jaGFyQ29kZUF0KHQpO01bZT4+MF09MH0sbW49e2lzQWJzOnI9PiIvIj09PXIuY2hhckF0KDApLHNwbGl0UGF0aDpyPT57dmFyIGU7cmV0dXJuL14oXC8/fCkoW1xzXFNdKj8pKCg/OlwuezEsMn18W15cL10rP3wpKFwuW14uXC9dKnwpKSg/OltcL10qKSQvLmV4ZWMocikuc2xpY2UoMSl9LG5vcm1hbGl6ZUFycmF5OihyLGUpPT57Zm9yKHZhciB0PTAsbj1yLmxlbmd0aC0xOzA8PW47bi0tKXt2YXIgbz1yW25dOyIuIj09PW8/ci5zcGxpY2UobiwxKToiLi4iPT09bz8oci5zcGxpY2UobiwxKSx0KyspOnQmJihyLnNwbGljZShuLDEpLHQtLSl9aWYoZSlmb3IoO3Q7dC0tKXIudW5zaGlmdCgiLi4iKTtyZXR1cm4gcn0sbm9ybWFsaXplOnI9Pnt2YXIgZT1tbi5pc0FicyhyKSx0PSIvIj09PXIuc3Vic3RyKC0xKTtyZXR1cm4ocj0hKHI9bW4ubm9ybWFsaXplQXJyYXkoci5zcGxpdCgiLyIpLmZpbHRlcihyPT4hIXIpLCFlKS5qb2luKCIvIikpJiYhZT8iLiI6cikmJnQmJihyKz0iLyIpLChlPyIvIjoiIikrcn0sZGlybmFtZTpyPT57dmFyIGU9bW4uc3BsaXRQYXRoKHIpLHQ9ZVswXSxuPWVbMV07cmV0dXJuIHR8fG4/dCsobj1uJiZuLnN1YnN0cigwLG4ubGVuZ3RoLTEpKToiLiJ9LGJhc2VuYW1lOnI9PntpZigiLyI9PT1yKXJldHVybiIvIjt2YXIgZT0ocj0ocj1tbi5ub3JtYWxpemUocikpLnJlcGxhY2UoL1wvJC8sIiIpKS5sYXN0SW5kZXhPZigiLyIpO3JldHVybi0xPT09ZT9yOnIuc3Vic3RyKGUrMSl9LGpvaW46ZnVuY3Rpb24oKXt2YXIgcj1BcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMpO3JldHVybiBtbi5ub3JtYWxpemUoci5qb2luKCIvIikpfSxqb2luMjoocixlKT0+bW4ubm9ybWFsaXplKHIrIi8iK2UpfSx2bj0oKT0+e2lmKCJvYmplY3QiPT10eXBlb2YgY3J5cHRvJiYiZnVuY3Rpb24iPT10eXBlb2YgY3J5cHRvLmdldFJhbmRvbVZhbHVlcylyZXR1cm4gcj0+Y3J5cHRvLmdldFJhbmRvbVZhbHVlcyhyKTtpZih1KXRyeXt2YXIgZT12KCJjcnlwdG8iKSxyO2lmKGUucmFuZG9tRmlsbFN5bmMpcmV0dXJuIHI9PmUucmFuZG9tRmlsbFN5bmMocik7dmFyIHQ9ZS5yYW5kb21CeXRlcztyZXR1cm4gcj0+KHIuc2V0KHQoci5ieXRlTGVuZ3RoKSkscil9Y2F0Y2gocil7fWVyKCJpbml0UmFuZG9tRGV2aWNlIil9LHluPXI9Pih5bj12bigpKShyKSxnbj17cmVzb2x2ZTpmdW5jdGlvbigpe2Zvcih2YXIgcj0iIixlPSExLHQ9YXJndW1lbnRzLmxlbmd0aC0xOy0xPD10JiYhZTt0LS0pe3ZhciBuPTA8PXQ/YXJndW1lbnRzW3RdOkFuLmN3ZCgpO2lmKCJzdHJpbmciIT10eXBlb2Ygbil0aHJvdyBuZXcgVHlwZUVycm9yKCJBcmd1bWVudHMgdG8gcGF0aC5yZXNvbHZlIG11c3QgYmUgc3RyaW5ncyIpO2lmKCFuKXJldHVybiIiO3I9bisiLyIrcixlPW1uLmlzQWJzKG4pfXJldHVybihlPyIvIjoiIikrKHI9bW4ubm9ybWFsaXplQXJyYXkoci5zcGxpdCgiLyIpLmZpbHRlcihyPT4hIXIpLCFlKS5qb2luKCIvIikpfHwiLiJ9LHJlbGF0aXZlOihyLGUpPT57ZnVuY3Rpb24gdChyKXtmb3IodmFyIGU9MDtlPHIubGVuZ3RoJiYiIj09PXJbZV07ZSsrKTtmb3IodmFyIHQ9ci5sZW5ndGgtMTswPD10JiYiIj09PXJbdF07dC0tKTtyZXR1cm4gdDxlP1tdOnIuc2xpY2UoZSx0LWUrMSl9cj1nbi5yZXNvbHZlKHIpLnN1YnN0cigxKSxlPWduLnJlc29sdmUoZSkuc3Vic3RyKDEpO2Zvcih2YXIgbj10KHIuc3BsaXQoIi8iKSksbz10KGUuc3BsaXQoIi8iKSksYT1NYXRoLm1pbihuLmxlbmd0aCxvLmxlbmd0aCksaT1hLHM9MDtzPGE7cysrKWlmKG5bc10hPT1vW3NdKXtpPXM7YnJlYWt9Zm9yKHZhciB1PVtdLHM9aTtzPG4ubGVuZ3RoO3MrKyl1LnB1c2goIi4uIik7cmV0dXJuKHU9dS5jb25jYXQoby5zbGljZShpKSkpLmpvaW4oIi8iKX19LHduPVtdO2Z1bmN0aW9uIF9uKHIsZSx0KXt2YXIgbj0wPHQ/dDpQdChyKSsxLG89bmV3IEFycmF5KG4pLGE9RXQocixvLDAsby5sZW5ndGgpO3JldHVybiBlJiYoby5sZW5ndGg9YSksb312YXIgYm49KCk9PntpZighd24ubGVuZ3RoKXt2YXIgcj1udWxsO2lmKHUpe3ZhciBlLHQ9QnVmZmVyLmFsbG9jKDI1Niksbj0wLG89cHJvY2Vzcy5zdGRpbi5mZDt0cnl7bj13LnJlYWRTeW5jKG8sdCl9Y2F0Y2gocil7aWYoIXIudG9TdHJpbmcoKS5pbmNsdWRlcygiRU9GIikpdGhyb3cgcjtuPTB9cj0wPG4/dC5zbGljZSgwLG4pLnRvU3RyaW5nKCJ1dGYtOCIpOm51bGx9ZWxzZSJ1bmRlZmluZWQiIT10eXBlb2Ygd2luZG93JiYiZnVuY3Rpb24iPT10eXBlb2Ygd2luZG93LnByb21wdD9udWxsIT09KHI9d2luZG93LnByb21wdCgiSW5wdXQ6ICIpKSYmKHIrPSJcbiIpOiJmdW5jdGlvbiI9PXR5cGVvZiByZWFkbGluZSYmbnVsbCE9PShyPXJlYWRsaW5lKCkpJiYocis9IlxuIik7aWYoIXIpcmV0dXJuIG51bGw7d249X24ociwhMCl9cmV0dXJuIHduLnNoaWZ0KCl9LEVuPXt0dHlzOltdLGluaXQoKXt9LHNodXRkb3duKCl7fSxyZWdpc3RlcihyLGUpe0VuLnR0eXNbcl09e2lucHV0OltdLG91dHB1dDpbXSxvcHM6ZX0sQW4ucmVnaXN0ZXJEZXZpY2UocixFbi5zdHJlYW1fb3BzKX0sc3RyZWFtX29wczp7b3BlbihyKXt2YXIgZT1Fbi50dHlzW3Iubm9kZS5yZGV2XTtpZighZSl0aHJvdyBuZXcgQW4uRXJybm9FcnJvcig0Myk7ci50dHk9ZSxyLnNlZWthYmxlPSExfSxjbG9zZShyKXtyLnR0eS5vcHMuZnN5bmMoci50dHkpfSxmc3luYyhyKXtyLnR0eS5vcHMuZnN5bmMoci50dHkpfSxyZWFkKHIsZSx0LG4sbyl7aWYoIXIudHR5fHwhci50dHkub3BzLmdldF9jaGFyKXRocm93IG5ldyBBbi5FcnJub0Vycm9yKDYwKTtmb3IodmFyIGE9MCxpPTAscztpPG47aSsrKXt0cnl7cz1yLnR0eS5vcHMuZ2V0X2NoYXIoci50dHkpfWNhdGNoKHIpe3Rocm93IG5ldyBBbi5FcnJub0Vycm9yKDI5KX1pZih2b2lkIDA9PT1zJiYwPT09YSl0aHJvdyBuZXcgQW4uRXJybm9FcnJvcig2KTtpZihudWxsPT1zKWJyZWFrO2ErKyxlW3QraV09c31yZXR1cm4gYSYmKHIubm9kZS50aW1lc3RhbXA9RGF0ZS5ub3coKSksYX0sd3JpdGUocixlLHQsbixvKXtpZighci50dHl8fCFyLnR0eS5vcHMucHV0X2NoYXIpdGhyb3cgbmV3IEFuLkVycm5vRXJyb3IoNjApO3RyeXtmb3IodmFyIGE9MDthPG47YSsrKXIudHR5Lm9wcy5wdXRfY2hhcihyLnR0eSxlW3QrYV0pfWNhdGNoKHIpe3Rocm93IG5ldyBBbi5FcnJub0Vycm9yKDI5KX1yZXR1cm4gbiYmKHIubm9kZS50aW1lc3RhbXA9RGF0ZS5ub3coKSksYX19LGRlZmF1bHRfdHR5X29wczp7Z2V0X2NoYXIocil7cmV0dXJuIGJuKCl9LHB1dF9jaGFyKHIsZSl7bnVsbD09PWV8fDEwPT09ZT8oYihUdChyLm91dHB1dCwwKSksci5vdXRwdXQ9W10pOjAhPWUmJnIub3V0cHV0LnB1c2goZSl9LGZzeW5jKHIpe3Iub3V0cHV0JiYwPHIub3V0cHV0Lmxlbmd0aCYmKGIoVHQoci5vdXRwdXQsMCkpLHIub3V0cHV0PVtdKX0saW9jdGxfdGNnZXRzKHIpe3JldHVybntjX2lmbGFnOjI1ODU2LGNfb2ZsYWc6NSxjX2NmbGFnOjE5MSxjX2xmbGFnOjM1Mzg3LGNfY2M6WzMsMjgsMTI3LDIxLDQsMCwxLDAsMTcsMTksMjYsMCwxOCwxNSwyMywyMiwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwXX19LGlvY3RsX3Rjc2V0cyhyLGUsdCl7cmV0dXJuIDB9LGlvY3RsX3Rpb2Nnd2luc3oocil7cmV0dXJuWzI0LDgwXX19LGRlZmF1bHRfdHR5MV9vcHM6e3B1dF9jaGFyKHIsZSl7bnVsbD09PWV8fDEwPT09ZT8oRShUdChyLm91dHB1dCwwKSksci5vdXRwdXQ9W10pOjAhPWUmJnIub3V0cHV0LnB1c2goZSl9LGZzeW5jKHIpe3Iub3V0cHV0JiYwPHIub3V0cHV0Lmxlbmd0aCYmKEUoVHQoci5vdXRwdXQsMCkpLHIub3V0cHV0PVtdKX19fSxrbj1yPT57ZXIoKX0sUG49e29wc190YWJsZTpudWxsLG1vdW50KHIpe3JldHVybiBQbi5jcmVhdGVOb2RlKG51bGwsIi8iLDE2ODk1LDApfSxjcmVhdGVOb2RlKHIsZSx0LG4pe2lmKEFuLmlzQmxrZGV2KHQpfHxBbi5pc0ZJRk8odCkpdGhyb3cgbmV3IEFuLkVycm5vRXJyb3IoNjMpO1BuLm9wc190YWJsZXx8KFBuLm9wc190YWJsZT17ZGlyOntub2RlOntnZXRhdHRyOlBuLm5vZGVfb3BzLmdldGF0dHIsc2V0YXR0cjpQbi5ub2RlX29wcy5zZXRhdHRyLGxvb2t1cDpQbi5ub2RlX29wcy5sb29rdXAsbWtub2Q6UG4ubm9kZV9vcHMubWtub2QscmVuYW1lOlBuLm5vZGVfb3BzLnJlbmFtZSx1bmxpbms6UG4ubm9kZV9vcHMudW5saW5rLHJtZGlyOlBuLm5vZGVfb3BzLnJtZGlyLHJlYWRkaXI6UG4ubm9kZV9vcHMucmVhZGRpcixzeW1saW5rOlBuLm5vZGVfb3BzLnN5bWxpbmt9LHN0cmVhbTp7bGxzZWVrOlBuLnN0cmVhbV9vcHMubGxzZWVrfX0sZmlsZTp7bm9kZTp7Z2V0YXR0cjpQbi5ub2RlX29wcy5nZXRhdHRyLHNldGF0dHI6UG4ubm9kZV9vcHMuc2V0YXR0cn0sc3RyZWFtOntsbHNlZWs6UG4uc3RyZWFtX29wcy5sbHNlZWsscmVhZDpQbi5zdHJlYW1fb3BzLnJlYWQsd3JpdGU6UG4uc3RyZWFtX29wcy53cml0ZSxhbGxvY2F0ZTpQbi5zdHJlYW1fb3BzLmFsbG9jYXRlLG1tYXA6UG4uc3RyZWFtX29wcy5tbWFwLG1zeW5jOlBuLnN0cmVhbV9vcHMubXN5bmN9fSxsaW5rOntub2RlOntnZXRhdHRyOlBuLm5vZGVfb3BzLmdldGF0dHIsc2V0YXR0cjpQbi5ub2RlX29wcy5zZXRhdHRyLHJlYWRsaW5rOlBuLm5vZGVfb3BzLnJlYWRsaW5rfSxzdHJlYW06e319LGNocmRldjp7bm9kZTp7Z2V0YXR0cjpQbi5ub2RlX29wcy5nZXRhdHRyLHNldGF0dHI6UG4ubm9kZV9vcHMuc2V0YXR0cn0sc3RyZWFtOkFuLmNocmRldl9zdHJlYW1fb3BzfX0pO3ZhciBvPUFuLmNyZWF0ZU5vZGUocixlLHQsbik7cmV0dXJuIEFuLmlzRGlyKG8ubW9kZSk/KG8ubm9kZV9vcHM9UG4ub3BzX3RhYmxlLmRpci5ub2RlLG8uc3RyZWFtX29wcz1Qbi5vcHNfdGFibGUuZGlyLnN0cmVhbSxvLmNvbnRlbnRzPXt9KTpBbi5pc0ZpbGUoby5tb2RlKT8oby5ub2RlX29wcz1Qbi5vcHNfdGFibGUuZmlsZS5ub2RlLG8uc3RyZWFtX29wcz1Qbi5vcHNfdGFibGUuZmlsZS5zdHJlYW0sby51c2VkQnl0ZXM9MCxvLmNvbnRlbnRzPW51bGwpOkFuLmlzTGluayhvLm1vZGUpPyhvLm5vZGVfb3BzPVBuLm9wc190YWJsZS5saW5rLm5vZGUsby5zdHJlYW1fb3BzPVBuLm9wc190YWJsZS5saW5rLnN0cmVhbSk6QW4uaXNDaHJkZXYoby5tb2RlKSYmKG8ubm9kZV9vcHM9UG4ub3BzX3RhYmxlLmNocmRldi5ub2RlLG8uc3RyZWFtX29wcz1Qbi5vcHNfdGFibGUuY2hyZGV2LnN0cmVhbSksby50aW1lc3RhbXA9RGF0ZS5ub3coKSxyJiYoci5jb250ZW50c1tlXT1vLHIudGltZXN0YW1wPW8udGltZXN0YW1wKSxvfSxnZXRGaWxlRGF0YUFzVHlwZWRBcnJheShyKXtyZXR1cm4gci5jb250ZW50cz9yLmNvbnRlbnRzLnN1YmFycmF5P3IuY29udGVudHMuc3ViYXJyYXkoMCxyLnVzZWRCeXRlcyk6bmV3IFVpbnQ4QXJyYXkoci5jb250ZW50cyk6bmV3IFVpbnQ4QXJyYXkoMCl9LGV4cGFuZEZpbGVTdG9yYWdlKHIsZSl7dmFyIHQ9ci5jb250ZW50cz9yLmNvbnRlbnRzLmxlbmd0aDowLG4sbztlPD10fHwoZT1NYXRoLm1heChlLHQqKHQ8MTA0ODU3Nj8yOjEuMTI1KT4+PjApLDAhPXQmJihlPU1hdGgubWF4KGUsMjU2KSksbz1yLmNvbnRlbnRzLHIuY29udGVudHM9bmV3IFVpbnQ4QXJyYXkoZSksMDxyLnVzZWRCeXRlcyYmci5jb250ZW50cy5zZXQoby5zdWJhcnJheSgwLHIudXNlZEJ5dGVzKSwwKSl9LHJlc2l6ZUZpbGVTdG9yYWdlKHIsZSl7dmFyIHQ7ci51c2VkQnl0ZXMhPWUmJigwPT1lPyhyLmNvbnRlbnRzPW51bGwsci51c2VkQnl0ZXM9MCk6KHQ9ci5jb250ZW50cyxyLmNvbnRlbnRzPW5ldyBVaW50OEFycmF5KGUpLHQmJnIuY29udGVudHMuc2V0KHQuc3ViYXJyYXkoMCxNYXRoLm1pbihlLHIudXNlZEJ5dGVzKSkpLHIudXNlZEJ5dGVzPWUpKX0sbm9kZV9vcHM6e2dldGF0dHIocil7dmFyIGU9e307cmV0dXJuIGUuZGV2PUFuLmlzQ2hyZGV2KHIubW9kZSk/ci5pZDoxLGUuaW5vPXIuaWQsZS5tb2RlPXIubW9kZSxlLm5saW5rPTEsZS51aWQ9MCxlLmdpZD0wLGUucmRldj1yLnJkZXYsQW4uaXNEaXIoci5tb2RlKT9lLnNpemU9NDA5NjpBbi5pc0ZpbGUoci5tb2RlKT9lLnNpemU9ci51c2VkQnl0ZXM6QW4uaXNMaW5rKHIubW9kZSk/ZS5zaXplPXIubGluay5sZW5ndGg6ZS5zaXplPTAsZS5hdGltZT1uZXcgRGF0ZShyLnRpbWVzdGFtcCksZS5tdGltZT1uZXcgRGF0ZShyLnRpbWVzdGFtcCksZS5jdGltZT1uZXcgRGF0ZShyLnRpbWVzdGFtcCksZS5ibGtzaXplPTQwOTYsZS5ibG9ja3M9TWF0aC5jZWlsKGUuc2l6ZS9lLmJsa3NpemUpLGV9LHNldGF0dHIocixlKXt2b2lkIDAhPT1lLm1vZGUmJihyLm1vZGU9ZS5tb2RlKSx2b2lkIDAhPT1lLnRpbWVzdGFtcCYmKHIudGltZXN0YW1wPWUudGltZXN0YW1wKSx2b2lkIDAhPT1lLnNpemUmJlBuLnJlc2l6ZUZpbGVTdG9yYWdlKHIsZS5zaXplKX0sbG9va3VwKHIsZSl7dGhyb3cgQW4uZ2VuZXJpY0Vycm9yc1s0NF19LG1rbm9kKHIsZSx0LG4pe3JldHVybiBQbi5jcmVhdGVOb2RlKHIsZSx0LG4pfSxyZW5hbWUocixlLHQpe2lmKEFuLmlzRGlyKHIubW9kZSkpe3ZhciBuO3RyeXtuPUFuLmxvb2t1cE5vZGUoZSx0KX1jYXRjaChyKXt9aWYobilmb3IodmFyIG8gaW4gbi5jb250ZW50cyl0aHJvdyBuZXcgQW4uRXJybm9FcnJvcig1NSl9ZGVsZXRlIHIucGFyZW50LmNvbnRlbnRzW3IubmFtZV0sci5wYXJlbnQudGltZXN0YW1wPURhdGUubm93KCksci5uYW1lPXQsZS5jb250ZW50c1t0XT1yLGUudGltZXN0YW1wPXIucGFyZW50LnRpbWVzdGFtcCxyLnBhcmVudD1lfSx1bmxpbmsocixlKXtkZWxldGUgci5jb250ZW50c1tlXSxyLnRpbWVzdGFtcD1EYXRlLm5vdygpfSxybWRpcihyLGUpe3ZhciB0LG47Zm9yKG4gaW4gQW4ubG9va3VwTm9kZShyLGUpLmNvbnRlbnRzKXRocm93IG5ldyBBbi5FcnJub0Vycm9yKDU1KTtkZWxldGUgci5jb250ZW50c1tlXSxyLnRpbWVzdGFtcD1EYXRlLm5vdygpfSxyZWFkZGlyKHIpe3ZhciBlPVsiLiIsIi4uIl0sdDtmb3IodCBpbiByLmNvbnRlbnRzKXIuY29udGVudHMuaGFzT3duUHJvcGVydHkodCkmJmUucHVzaCh0KTtyZXR1cm4gZX0sc3ltbGluayhyLGUsdCl7dmFyIG49UG4uY3JlYXRlTm9kZShyLGUsNDE0NzEsMCk7cmV0dXJuIG4ubGluaz10LG59LHJlYWRsaW5rKHIpe2lmKCFBbi5pc0xpbmsoci5tb2RlKSl0aHJvdyBuZXcgQW4uRXJybm9FcnJvcigyOCk7cmV0dXJuIHIubGlua319LHN0cmVhbV9vcHM6e3JlYWQocixlLHQsbixvKXt2YXIgYT1yLm5vZGUuY29udGVudHM7aWYobz49ci5ub2RlLnVzZWRCeXRlcylyZXR1cm4gMDt2YXIgaT1NYXRoLm1pbihyLm5vZGUudXNlZEJ5dGVzLW8sbik7aWYoODxpJiZhLnN1YmFycmF5KWUuc2V0KGEuc3ViYXJyYXkobyxvK2kpLHQpO2Vsc2UgZm9yKHZhciBzPTA7czxpO3MrKyllW3Qrc109YVtvK3NdO3JldHVybiBpfSx3cml0ZShyLGUsdCxuLG8sYSl7aWYoZS5idWZmZXI9PT1NLmJ1ZmZlciYmKGE9ITEpLCFuKXJldHVybiAwO3ZhciBpPXIubm9kZTtpZihpLnRpbWVzdGFtcD1EYXRlLm5vdygpLGUuc3ViYXJyYXkmJighaS5jb250ZW50c3x8aS5jb250ZW50cy5zdWJhcnJheSkpe2lmKGEpcmV0dXJuIGkuY29udGVudHM9ZS5zdWJhcnJheSh0LHQrbiksaS51c2VkQnl0ZXM9bjtpZigwPT09aS51c2VkQnl0ZXMmJjA9PT1vKXJldHVybiBpLmNvbnRlbnRzPWUuc2xpY2UodCx0K24pLGkudXNlZEJ5dGVzPW47aWYobytuPD1pLnVzZWRCeXRlcylyZXR1cm4gaS5jb250ZW50cy5zZXQoZS5zdWJhcnJheSh0LHQrbiksbyksbn1pZihQbi5leHBhbmRGaWxlU3RvcmFnZShpLG8rbiksaS5jb250ZW50cy5zdWJhcnJheSYmZS5zdWJhcnJheSlpLmNvbnRlbnRzLnNldChlLnN1YmFycmF5KHQsdCtuKSxvKTtlbHNlIGZvcih2YXIgcz0wO3M8bjtzKyspaS5jb250ZW50c1tvK3NdPWVbdCtzXTtyZXR1cm4gaS51c2VkQnl0ZXM9TWF0aC5tYXgoaS51c2VkQnl0ZXMsbytuKSxufSxsbHNlZWsocixlLHQpe3ZhciBuPWU7aWYoMT09PXQ/bis9ci5wb3NpdGlvbjoyPT09dCYmQW4uaXNGaWxlKHIubm9kZS5tb2RlKSYmKG4rPXIubm9kZS51c2VkQnl0ZXMpLG48MCl0aHJvdyBuZXcgQW4uRXJybm9FcnJvcigyOCk7cmV0dXJuIG59LGFsbG9jYXRlKHIsZSx0KXtQbi5leHBhbmRGaWxlU3RvcmFnZShyLm5vZGUsZSt0KSxyLm5vZGUudXNlZEJ5dGVzPU1hdGgubWF4KHIubm9kZS51c2VkQnl0ZXMsZSt0KX0sbW1hcChyLGUsdCxuLG8pe2lmKCFBbi5pc0ZpbGUoci5ub2RlLm1vZGUpKXRocm93IG5ldyBBbi5FcnJub0Vycm9yKDQzKTt2YXIgYSxpLHM9ci5ub2RlLmNvbnRlbnRzO2lmKDImb3x8cy5idWZmZXIhPT1NLmJ1ZmZlcil7aWYoKDA8dHx8dCtlPHMubGVuZ3RoKSYmKHM9cy5zdWJhcnJheT9zLnN1YmFycmF5KHQsdCtlKTpBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChzLHQsdCtlKSksaT0hMCwhKGE9a24oZSkpKXRocm93IG5ldyBBbi5FcnJub0Vycm9yKDQ4KTtNLnNldChzLGEpfWVsc2UgaT0hMSxhPXMuYnl0ZU9mZnNldDtyZXR1cm57cHRyOmEsYWxsb2NhdGVkOml9fSxtc3luYyhyLGUsdCxuLG8pe3JldHVybiBQbi5zdHJlYW1fb3BzLndyaXRlKHIsZSwwLG4sdCwhMSksMH19fSxDbj0oZSx0LG4scik9Pnt2YXIgbz1yPyIiOiJhbCAiK2U7ZChlLHI9PntXKHIsYExvYWRpbmcgZGF0YSBmaWxlICIke2V9IiBmYWlsZWQgKG5vIGFycmF5QnVmZmVyKS5gKSx0KG5ldyBVaW50OEFycmF5KHIpKSxvJiZycihvKX0scj0+e2lmKCFuKXRocm93YExvYWRpbmcgZGF0YSBmaWxlICIke2V9IiBmYWlsZWQuYDtuKCl9KSxvJiZRKG8pfSxUbj15LnByZWxvYWRQbHVnaW5zfHxbXSxTbj0oZSx0LG4sbyk9PnsidW5kZWZpbmVkIiE9dHlwZW9mIEJyb3dzZXImJkJyb3dzZXIuaW5pdCgpO3ZhciBhPSExO3JldHVybiBUbi5mb3JFYWNoKHI9PnthfHxyLmNhbkhhbmRsZSh0KSYmKHIuaGFuZGxlKGUsdCxuLG8pLGE9ITApfSksYX0sTW49KHQsbixyLG8sYSxpLHMsdSxsLGMpPT57dmFyIGQ9bj9nbi5yZXNvbHZlKG1uLmpvaW4yKHQsbikpOnQsZj0iY3AgIitkO2Z1bmN0aW9uIGUocil7ZnVuY3Rpb24gZShyKXtjJiZjKCksdXx8QW4uY3JlYXRlRGF0YUZpbGUodCxuLHIsbyxhLGwpLGkmJmkoKSxycihmKX1TbihyLGQsZSwoKT0+e3MmJnMoKSxycihmKX0pfHxlKHIpfVEoZiksInN0cmluZyI9PXR5cGVvZiByP0NuKHIscj0+ZShyKSxzKTplKHIpfSwkbj1yPT57dmFyIGUsdD17cjowLCJyKyI6Mix3OjU3NywidysiOjU3OCxhOjEwODksImErIjoxMDkwfVtyXTtpZih2b2lkIDA9PT10KXRocm93IG5ldyBFcnJvcigiVW5rbm93biBmaWxlIG9wZW4gbW9kZTogIityKTtyZXR1cm4gdH0sRm49KHIsZSk9Pnt2YXIgdD0wO3JldHVybiByJiYodHw9MzY1KSxlJiYodHw9MTQ2KSx0fSxBbj17cm9vdDpudWxsLG1vdW50czpbXSxkZXZpY2VzOnt9LHN0cmVhbXM6W10sbmV4dElub2RlOjEsbmFtZVRhYmxlOm51bGwsY3VycmVudFBhdGg6Ii8iLGluaXRpYWxpemVkOiExLGlnbm9yZVBlcm1pc3Npb25zOiEwLEVycm5vRXJyb3I6bnVsbCxnZW5lcmljRXJyb3JzOnt9LGZpbGVzeXN0ZW1zOm51bGwsc3luY0ZTUmVxdWVzdHM6MCxsb29rdXBQYXRoKHIsZT17fSl7aWYoIShyPWduLnJlc29sdmUocikpKXJldHVybntwYXRoOiIiLG5vZGU6bnVsbH07dmFyIHQ7aWYoODwoZT1PYmplY3QuYXNzaWduKHtmb2xsb3dfbW91bnQ6ITAscmVjdXJzZV9jb3VudDowfSxlKSkucmVjdXJzZV9jb3VudCl0aHJvdyBuZXcgQW4uRXJybm9FcnJvcigzMik7Zm9yKHZhciBuPXIuc3BsaXQoIi8iKS5maWx0ZXIocj0+ISFyKSxvPUFuLnJvb3QsYT0iLyIsaT0wO2k8bi5sZW5ndGg7aSsrKXt2YXIgcz1pPT09bi5sZW5ndGgtMTtpZihzJiZlLnBhcmVudClicmVhaztpZihvPUFuLmxvb2t1cE5vZGUobyxuW2ldKSxhPW1uLmpvaW4yKGEsbltpXSksQW4uaXNNb3VudHBvaW50KG8pJiYocyYmIWUuZm9sbG93X21vdW50fHwobz1vLm1vdW50ZWQucm9vdCkpLCFzfHxlLmZvbGxvdylmb3IodmFyIHU9MDtBbi5pc0xpbmsoby5tb2RlKTspe3ZhciBsPUFuLnJlYWRsaW5rKGEpLGE9Z24ucmVzb2x2ZShtbi5kaXJuYW1lKGEpLGwpLGMsbz1Bbi5sb29rdXBQYXRoKGEse3JlY3Vyc2VfY291bnQ6ZS5yZWN1cnNlX2NvdW50KzF9KS5ub2RlO2lmKDQwPHUrKyl0aHJvdyBuZXcgQW4uRXJybm9FcnJvcigzMil9fXJldHVybntwYXRoOmEsbm9kZTpvfX0sZ2V0UGF0aChyKXtmb3IodmFyIGU7Oyl7aWYoQW4uaXNSb290KHIpKXt2YXIgdD1yLm1vdW50Lm1vdW50cG9pbnQ7cmV0dXJuIGU/Ii8iIT09dFt0Lmxlbmd0aC0xXT90KyIvIitlOnQrZTp0fWU9ZT9yLm5hbWUrIi8iK2U6ci5uYW1lLHI9ci5wYXJlbnR9fSxoYXNoTmFtZShyLGUpe2Zvcih2YXIgdD0wLG49MDtuPGUubGVuZ3RoO24rKyl0PSh0PDw1KS10K2UuY2hhckNvZGVBdChuKXwwO3JldHVybihyK3Q+Pj4wKSVBbi5uYW1lVGFibGUubGVuZ3RofSxoYXNoQWRkTm9kZShyKXt2YXIgZT1Bbi5oYXNoTmFtZShyLnBhcmVudC5pZCxyLm5hbWUpO3IubmFtZV9uZXh0PUFuLm5hbWVUYWJsZVtlXSxBbi5uYW1lVGFibGVbZV09cn0saGFzaFJlbW92ZU5vZGUocil7dmFyIGU9QW4uaGFzaE5hbWUoci5wYXJlbnQuaWQsci5uYW1lKTtpZihBbi5uYW1lVGFibGVbZV09PT1yKUFuLm5hbWVUYWJsZVtlXT1yLm5hbWVfbmV4dDtlbHNlIGZvcih2YXIgdD1Bbi5uYW1lVGFibGVbZV07dDspe2lmKHQubmFtZV9uZXh0PT09cil7dC5uYW1lX25leHQ9ci5uYW1lX25leHQ7YnJlYWt9dD10Lm5hbWVfbmV4dH19LGxvb2t1cE5vZGUocixlKXt2YXIgdD1Bbi5tYXlMb29rdXAocik7aWYodCl0aHJvdyBuZXcgQW4uRXJybm9FcnJvcih0LHIpO2Zvcih2YXIgbj1Bbi5oYXNoTmFtZShyLmlkLGUpLG89QW4ubmFtZVRhYmxlW25dO287bz1vLm5hbWVfbmV4dCl7dmFyIGE9by5uYW1lO2lmKG8ucGFyZW50LmlkPT09ci5pZCYmYT09PWUpcmV0dXJuIG99cmV0dXJuIEFuLmxvb2t1cChyLGUpfSxjcmVhdGVOb2RlKHIsZSx0LG4pe3ZhciBvPW5ldyBBbi5GU05vZGUocixlLHQsbik7cmV0dXJuIEFuLmhhc2hBZGROb2RlKG8pLG99LGRlc3Ryb3lOb2RlKHIpe0FuLmhhc2hSZW1vdmVOb2RlKHIpfSxpc1Jvb3Qocil7cmV0dXJuIHI9PT1yLnBhcmVudH0saXNNb3VudHBvaW50KHIpe3JldHVybiEhci5tb3VudGVkfSxpc0ZpbGUocil7cmV0dXJuIDMyNzY4PT0oNjE0NDAmcil9LGlzRGlyKHIpe3JldHVybiAxNjM4ND09KDYxNDQwJnIpfSxpc0xpbmsocil7cmV0dXJuIDQwOTYwPT0oNjE0NDAmcil9LGlzQ2hyZGV2KHIpe3JldHVybiA4MTkyPT0oNjE0NDAmcil9LGlzQmxrZGV2KHIpe3JldHVybiAyNDU3Nj09KDYxNDQwJnIpfSxpc0ZJRk8ocil7cmV0dXJuIDQwOTY9PSg2MTQ0MCZyKX0saXNTb2NrZXQocil7cmV0dXJuIDQ5MTUyPT0oNDkxNTImcil9LGZsYWdzVG9QZXJtaXNzaW9uU3RyaW5nKHIpe3ZhciBlPVsiciIsInciLCJydyJdWzMmcl07cmV0dXJuIDUxMiZyJiYoZSs9InciKSxlfSxub2RlUGVybWlzc2lvbnMocixlKXtyZXR1cm4gQW4uaWdub3JlUGVybWlzc2lvbnN8fCghZS5pbmNsdWRlcygiciIpfHwyOTImci5tb2RlKSYmKCFlLmluY2x1ZGVzKCJ3Iil8fDE0NiZyLm1vZGUpJiYoIWUuaW5jbHVkZXMoIngiKXx8NzMmci5tb2RlKT8wOjJ9LG1heUxvb2t1cChyKXt2YXIgZT1Bbi5ub2RlUGVybWlzc2lvbnMociwieCIpO3JldHVybiBlfHwoci5ub2RlX29wcy5sb29rdXA/MDoyKX0sbWF5Q3JlYXRlKHIsZSl7dHJ5e3ZhciB0PUFuLmxvb2t1cE5vZGUocixlKTtyZXR1cm4gMjB9Y2F0Y2gocil7fXJldHVybiBBbi5ub2RlUGVybWlzc2lvbnMociwid3giKX0sbWF5RGVsZXRlKHIsZSx0KXt2YXIgbjt0cnl7bj1Bbi5sb29rdXBOb2RlKHIsZSl9Y2F0Y2gocil7cmV0dXJuIHIuZXJybm99dmFyIG89QW4ubm9kZVBlcm1pc3Npb25zKHIsInd4Iik7aWYobylyZXR1cm4gbztpZih0KXtpZighQW4uaXNEaXIobi5tb2RlKSlyZXR1cm4gNTQ7aWYoQW4uaXNSb290KG4pfHxBbi5nZXRQYXRoKG4pPT09QW4uY3dkKCkpcmV0dXJuIDEwfWVsc2UgaWYoQW4uaXNEaXIobi5tb2RlKSlyZXR1cm4gMzE7cmV0dXJuIDB9LG1heU9wZW4ocixlKXtyZXR1cm4gcj9Bbi5pc0xpbmsoci5tb2RlKT8zMjpBbi5pc0RpcihyLm1vZGUpJiYoInIiIT09QW4uZmxhZ3NUb1Blcm1pc3Npb25TdHJpbmcoZSl8fDUxMiZlKT8zMTpBbi5ub2RlUGVybWlzc2lvbnMocixBbi5mbGFnc1RvUGVybWlzc2lvblN0cmluZyhlKSk6NDR9LE1BWF9PUEVOX0ZEUzo0MDk2LG5leHRmZCgpe2Zvcih2YXIgcj0wO3I8PUFuLk1BWF9PUEVOX0ZEUztyKyspaWYoIUFuLnN0cmVhbXNbcl0pcmV0dXJuIHI7dGhyb3cgbmV3IEFuLkVycm5vRXJyb3IoMzMpfSxnZXRTdHJlYW1DaGVja2VkKHIpe3ZhciBlPUFuLmdldFN0cmVhbShyKTtpZighZSl0aHJvdyBuZXcgQW4uRXJybm9FcnJvcig4KTtyZXR1cm4gZX0sZ2V0U3RyZWFtOnI9PkFuLnN0cmVhbXNbcl0sY3JlYXRlU3RyZWFtKHIsZT0tMSl7cmV0dXJuIEFuLkZTU3RyZWFtfHwoQW4uRlNTdHJlYW09ZnVuY3Rpb24oKXt0aGlzLnNoYXJlZD17fX0sQW4uRlNTdHJlYW0ucHJvdG90eXBlPXt9LE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKEFuLkZTU3RyZWFtLnByb3RvdHlwZSx7b2JqZWN0OntnZXQoKXtyZXR1cm4gdGhpcy5ub2RlfSxzZXQocil7dGhpcy5ub2RlPXJ9fSxpc1JlYWQ6e2dldCgpe3JldHVybiAxIT0oMjA5NzE1NSZ0aGlzLmZsYWdzKX19LGlzV3JpdGU6e2dldCgpe3JldHVybiAwIT0oMjA5NzE1NSZ0aGlzLmZsYWdzKX19LGlzQXBwZW5kOntnZXQoKXtyZXR1cm4gMTAyNCZ0aGlzLmZsYWdzfX0sZmxhZ3M6e2dldCgpe3JldHVybiB0aGlzLnNoYXJlZC5mbGFnc30sc2V0KHIpe3RoaXMuc2hhcmVkLmZsYWdzPXJ9fSxwb3NpdGlvbjp7Z2V0KCl7cmV0dXJuIHRoaXMuc2hhcmVkLnBvc2l0aW9ufSxzZXQocil7dGhpcy5zaGFyZWQucG9zaXRpb249cn19fSkpLHI9T2JqZWN0LmFzc2lnbihuZXcgQW4uRlNTdHJlYW0sciksLTE9PWUmJihlPUFuLm5leHRmZCgpKSxyLmZkPWUsQW4uc3RyZWFtc1tlXT1yfSxjbG9zZVN0cmVhbShyKXtBbi5zdHJlYW1zW3JdPW51bGx9LGNocmRldl9zdHJlYW1fb3BzOntvcGVuKHIpe3ZhciBlPUFuLmdldERldmljZShyLm5vZGUucmRldik7ci5zdHJlYW1fb3BzPWUuc3RyZWFtX29wcyxyLnN0cmVhbV9vcHMub3BlbiYmci5zdHJlYW1fb3BzLm9wZW4ocil9LGxsc2Vlaygpe3Rocm93IG5ldyBBbi5FcnJub0Vycm9yKDcwKX19LG1ham9yOnI9PnI+PjgsbWlub3I6cj0+MjU1JnIsbWFrZWRldjoocixlKT0+cjw8OHxlLHJlZ2lzdGVyRGV2aWNlKHIsZSl7QW4uZGV2aWNlc1tyXT17c3RyZWFtX29wczplfX0sZ2V0RGV2aWNlOnI9PkFuLmRldmljZXNbcl0sZ2V0TW91bnRzKHIpe2Zvcih2YXIgZT1bXSx0PVtyXTt0Lmxlbmd0aDspe3ZhciBuPXQucG9wKCk7ZS5wdXNoKG4pLHQucHVzaC5hcHBseSh0LG4ubW91bnRzKX1yZXR1cm4gZX0sc3luY2ZzKGUsdCl7ImZ1bmN0aW9uIj09dHlwZW9mIGUmJih0PWUsZT0hMSksQW4uc3luY0ZTUmVxdWVzdHMrKywxPEFuLnN5bmNGU1JlcXVlc3RzJiZFKGB3YXJuaW5nOiAke0FuLnN5bmNGU1JlcXVlc3RzfSBGUy5zeW5jZnMgb3BlcmF0aW9ucyBpbiBmbGlnaHQgYXQgb25jZSwgcHJvYmFibHkganVzdCBkb2luZyBleHRyYSB3b3JrYCk7dmFyIG49QW4uZ2V0TW91bnRzKEFuLnJvb3QubW91bnQpLG89MDtmdW5jdGlvbiBhKHIpe3JldHVybiBBbi5zeW5jRlNSZXF1ZXN0cy0tLHQocil9ZnVuY3Rpb24gaShyKXtpZihyKXJldHVybiBpLmVycm9yZWQ/dm9pZCAwOihpLmVycm9yZWQ9ITAsYShyKSk7KytvPj1uLmxlbmd0aCYmYShudWxsKX1uLmZvckVhY2gocj0+ci50eXBlLnN5bmNmcz92b2lkIHIudHlwZS5zeW5jZnMocixlLGkpOmkobnVsbCkpfSxtb3VudChyLGUsdCl7dmFyIG49Ii8iPT09dCxvPSF0LGE7aWYobiYmQW4ucm9vdCl0aHJvdyBuZXcgQW4uRXJybm9FcnJvcigxMCk7aWYoIW4mJiFvKXt2YXIgaT1Bbi5sb29rdXBQYXRoKHQse2ZvbGxvd19tb3VudDohMX0pO2lmKHQ9aS5wYXRoLGE9aS5ub2RlLEFuLmlzTW91bnRwb2ludChhKSl0aHJvdyBuZXcgQW4uRXJybm9FcnJvcigxMCk7aWYoIUFuLmlzRGlyKGEubW9kZSkpdGhyb3cgbmV3IEFuLkVycm5vRXJyb3IoNTQpfXZhciBzPXt0eXBlOnIsb3B0czplLG1vdW50cG9pbnQ6dCxtb3VudHM6W119LHU9ci5tb3VudChzKTtyZXR1cm4odS5tb3VudD1zKS5yb290PXUsbj9Bbi5yb290PXU6YSYmKGEubW91bnRlZD1zLGEubW91bnQmJmEubW91bnQubW91bnRzLnB1c2gocykpLHV9LHVubW91bnQocil7dmFyIGU9QW4ubG9va3VwUGF0aChyLHtmb2xsb3dfbW91bnQ6ITF9KTtpZighQW4uaXNNb3VudHBvaW50KGUubm9kZSkpdGhyb3cgbmV3IEFuLkVycm5vRXJyb3IoMjgpO3ZhciB0PWUubm9kZSxuPXQubW91bnRlZCxvPUFuLmdldE1vdW50cyhuKTtPYmplY3Qua2V5cyhBbi5uYW1lVGFibGUpLmZvckVhY2gocj0+e2Zvcih2YXIgZT1Bbi5uYW1lVGFibGVbcl07ZTspe3ZhciB0PWUubmFtZV9uZXh0O28uaW5jbHVkZXMoZS5tb3VudCkmJkFuLmRlc3Ryb3lOb2RlKGUpLGU9dH19KSx0Lm1vdW50ZWQ9bnVsbDt2YXIgYT10Lm1vdW50Lm1vdW50cy5pbmRleE9mKG4pO3QubW91bnQubW91bnRzLnNwbGljZShhLDEpfSxsb29rdXAocixlKXtyZXR1cm4gci5ub2RlX29wcy5sb29rdXAocixlKX0sbWtub2QocixlLHQpe3ZhciBuLG89QW4ubG9va3VwUGF0aChyLHtwYXJlbnQ6ITB9KS5ub2RlLGE9bW4uYmFzZW5hbWUocik7aWYoIWF8fCIuIj09PWF8fCIuLiI9PT1hKXRocm93IG5ldyBBbi5FcnJub0Vycm9yKDI4KTt2YXIgaT1Bbi5tYXlDcmVhdGUobyxhKTtpZihpKXRocm93IG5ldyBBbi5FcnJub0Vycm9yKGkpO2lmKCFvLm5vZGVfb3BzLm1rbm9kKXRocm93IG5ldyBBbi5FcnJub0Vycm9yKDYzKTtyZXR1cm4gby5ub2RlX29wcy5ta25vZChvLGEsZSx0KX0sY3JlYXRlKHIsZSl7cmV0dXJuIGU9dm9pZCAwIT09ZT9lOjQzOCxlJj00MDk1LEFuLm1rbm9kKHIsZXw9MzI3NjgsMCl9LG1rZGlyKHIsZSl7cmV0dXJuIGU9dm9pZCAwIT09ZT9lOjUxMSxlJj0xMDIzLEFuLm1rbm9kKHIsZXw9MTYzODQsMCl9LG1rZGlyVHJlZShyLGUpe2Zvcih2YXIgdD1yLnNwbGl0KCIvIiksbj0iIixvPTA7bzx0Lmxlbmd0aDsrK28paWYodFtvXSl7bis9Ii8iK3Rbb107dHJ5e0FuLm1rZGlyKG4sZSl9Y2F0Y2gocil7aWYoMjAhPXIuZXJybm8pdGhyb3cgcn19fSxta2RldihyLGUsdCl7cmV0dXJuIHZvaWQgMD09PXQmJih0PWUsZT00MzgpLEFuLm1rbm9kKHIsZXw9ODE5Mix0KX0sc3ltbGluayhyLGUpe2lmKCFnbi5yZXNvbHZlKHIpKXRocm93IG5ldyBBbi5FcnJub0Vycm9yKDQ0KTt2YXIgdCxuPUFuLmxvb2t1cFBhdGgoZSx7cGFyZW50OiEwfSkubm9kZTtpZighbil0aHJvdyBuZXcgQW4uRXJybm9FcnJvcig0NCk7dmFyIG89bW4uYmFzZW5hbWUoZSksYT1Bbi5tYXlDcmVhdGUobixvKTtpZihhKXRocm93IG5ldyBBbi5FcnJub0Vycm9yKGEpO2lmKCFuLm5vZGVfb3BzLnN5bWxpbmspdGhyb3cgbmV3IEFuLkVycm5vRXJyb3IoNjMpO3JldHVybiBuLm5vZGVfb3BzLnN5bWxpbmsobixvLHIpfSxyZW5hbWUocixlKXt2YXIgdD1tbi5kaXJuYW1lKHIpLG49bW4uZGlybmFtZShlKSxvPW1uLmJhc2VuYW1lKHIpLGE9bW4uYmFzZW5hbWUoZSksaSxzLHUsaT1Bbi5sb29rdXBQYXRoKHIse3BhcmVudDohMH0pLHM9aS5ub2RlLHU9KGk9QW4ubG9va3VwUGF0aChlLHtwYXJlbnQ6ITB9KSkubm9kZTtpZighc3x8IXUpdGhyb3cgbmV3IEFuLkVycm5vRXJyb3IoNDQpO2lmKHMubW91bnQhPT11Lm1vdW50KXRocm93IG5ldyBBbi5FcnJub0Vycm9yKDc1KTt2YXIgbD1Bbi5sb29rdXBOb2RlKHMsbyksYz1nbi5yZWxhdGl2ZShyLG4pLGQ7aWYoIi4iIT09Yy5jaGFyQXQoMCkpdGhyb3cgbmV3IEFuLkVycm5vRXJyb3IoMjgpO2lmKCIuIiE9PShjPWduLnJlbGF0aXZlKGUsdCkpLmNoYXJBdCgwKSl0aHJvdyBuZXcgQW4uRXJybm9FcnJvcig1NSk7dHJ5e2Q9QW4ubG9va3VwTm9kZSh1LGEpfWNhdGNoKHIpe31pZihsIT09ZCl7dmFyIGY9QW4uaXNEaXIobC5tb2RlKSxoPUFuLm1heURlbGV0ZShzLG8sZik7aWYoaCl0aHJvdyBuZXcgQW4uRXJybm9FcnJvcihoKTtpZihoPWQ/QW4ubWF5RGVsZXRlKHUsYSxmKTpBbi5tYXlDcmVhdGUodSxhKSl0aHJvdyBuZXcgQW4uRXJybm9FcnJvcihoKTtpZighcy5ub2RlX29wcy5yZW5hbWUpdGhyb3cgbmV3IEFuLkVycm5vRXJyb3IoNjMpO2lmKEFuLmlzTW91bnRwb2ludChsKXx8ZCYmQW4uaXNNb3VudHBvaW50KGQpKXRocm93IG5ldyBBbi5FcnJub0Vycm9yKDEwKTtpZih1IT09cyYmKGg9QW4ubm9kZVBlcm1pc3Npb25zKHMsInciKSkpdGhyb3cgbmV3IEFuLkVycm5vRXJyb3IoaCk7QW4uaGFzaFJlbW92ZU5vZGUobCk7dHJ5e3Mubm9kZV9vcHMucmVuYW1lKGwsdSxhKX1jYXRjaChyKXt0aHJvdyByfWZpbmFsbHl7QW4uaGFzaEFkZE5vZGUobCl9fX0scm1kaXIocil7dmFyIGUsdD1Bbi5sb29rdXBQYXRoKHIse3BhcmVudDohMH0pLm5vZGUsbj1tbi5iYXNlbmFtZShyKSxvPUFuLmxvb2t1cE5vZGUodCxuKSxhPUFuLm1heURlbGV0ZSh0LG4sITApO2lmKGEpdGhyb3cgbmV3IEFuLkVycm5vRXJyb3IoYSk7aWYoIXQubm9kZV9vcHMucm1kaXIpdGhyb3cgbmV3IEFuLkVycm5vRXJyb3IoNjMpO2lmKEFuLmlzTW91bnRwb2ludChvKSl0aHJvdyBuZXcgQW4uRXJybm9FcnJvcigxMCk7dC5ub2RlX29wcy5ybWRpcih0LG4pLEFuLmRlc3Ryb3lOb2RlKG8pfSxyZWFkZGlyKHIpe3ZhciBlLHQ9QW4ubG9va3VwUGF0aChyLHtmb2xsb3c6ITB9KS5ub2RlO2lmKCF0Lm5vZGVfb3BzLnJlYWRkaXIpdGhyb3cgbmV3IEFuLkVycm5vRXJyb3IoNTQpO3JldHVybiB0Lm5vZGVfb3BzLnJlYWRkaXIodCl9LHVubGluayhyKXt2YXIgZSx0PUFuLmxvb2t1cFBhdGgocix7cGFyZW50OiEwfSkubm9kZTtpZighdCl0aHJvdyBuZXcgQW4uRXJybm9FcnJvcig0NCk7dmFyIG49bW4uYmFzZW5hbWUociksbz1Bbi5sb29rdXBOb2RlKHQsbiksYT1Bbi5tYXlEZWxldGUodCxuLCExKTtpZihhKXRocm93IG5ldyBBbi5FcnJub0Vycm9yKGEpO2lmKCF0Lm5vZGVfb3BzLnVubGluayl0aHJvdyBuZXcgQW4uRXJybm9FcnJvcig2Myk7aWYoQW4uaXNNb3VudHBvaW50KG8pKXRocm93IG5ldyBBbi5FcnJub0Vycm9yKDEwKTt0Lm5vZGVfb3BzLnVubGluayh0LG4pLEFuLmRlc3Ryb3lOb2RlKG8pfSxyZWFkbGluayhyKXt2YXIgZSx0PUFuLmxvb2t1cFBhdGgocikubm9kZTtpZighdCl0aHJvdyBuZXcgQW4uRXJybm9FcnJvcig0NCk7aWYoIXQubm9kZV9vcHMucmVhZGxpbmspdGhyb3cgbmV3IEFuLkVycm5vRXJyb3IoMjgpO3JldHVybiBnbi5yZXNvbHZlKEFuLmdldFBhdGgodC5wYXJlbnQpLHQubm9kZV9vcHMucmVhZGxpbmsodCkpfSxzdGF0KHIsZSl7dmFyIHQsbj1Bbi5sb29rdXBQYXRoKHIse2ZvbGxvdzohZX0pLm5vZGU7aWYoIW4pdGhyb3cgbmV3IEFuLkVycm5vRXJyb3IoNDQpO2lmKCFuLm5vZGVfb3BzLmdldGF0dHIpdGhyb3cgbmV3IEFuLkVycm5vRXJyb3IoNjMpO3JldHVybiBuLm5vZGVfb3BzLmdldGF0dHIobil9LGxzdGF0KHIpe3JldHVybiBBbi5zdGF0KHIsITApfSxjaG1vZChyLGUsdCl7dmFyIG4sbyxuO2lmKCEobj0ic3RyaW5nIj09dHlwZW9mIHI/QW4ubG9va3VwUGF0aChyLHtmb2xsb3c6IXR9KS5ub2RlOnIpLm5vZGVfb3BzLnNldGF0dHIpdGhyb3cgbmV3IEFuLkVycm5vRXJyb3IoNjMpO24ubm9kZV9vcHMuc2V0YXR0cihuLHttb2RlOjQwOTUmZXwtNDA5NiZuLm1vZGUsdGltZXN0YW1wOkRhdGUubm93KCl9KX0sbGNobW9kKHIsZSl7QW4uY2htb2QocixlLCEwKX0sZmNobW9kKHIsZSl7dmFyIHQ9QW4uZ2V0U3RyZWFtQ2hlY2tlZChyKTtBbi5jaG1vZCh0Lm5vZGUsZSl9LGNob3duKHIsZSx0LG4pe3ZhciBvLGEsbztpZighKG89InN0cmluZyI9PXR5cGVvZiByP0FuLmxvb2t1cFBhdGgocix7Zm9sbG93OiFufSkubm9kZTpyKS5ub2RlX29wcy5zZXRhdHRyKXRocm93IG5ldyBBbi5FcnJub0Vycm9yKDYzKTtvLm5vZGVfb3BzLnNldGF0dHIobyx7dGltZXN0YW1wOkRhdGUubm93KCl9KX0sbGNob3duKHIsZSx0KXtBbi5jaG93bihyLGUsdCwhMCl9LGZjaG93bihyLGUsdCl7dmFyIG49QW4uZ2V0U3RyZWFtQ2hlY2tlZChyKTtBbi5jaG93bihuLm5vZGUsZSx0KX0sdHJ1bmNhdGUocixlKXtpZihlPDApdGhyb3cgbmV3IEFuLkVycm5vRXJyb3IoMjgpO3ZhciB0LG4sdDtpZighKHQ9InN0cmluZyI9PXR5cGVvZiByP0FuLmxvb2t1cFBhdGgocix7Zm9sbG93OiEwfSkubm9kZTpyKS5ub2RlX29wcy5zZXRhdHRyKXRocm93IG5ldyBBbi5FcnJub0Vycm9yKDYzKTtpZihBbi5pc0Rpcih0Lm1vZGUpKXRocm93IG5ldyBBbi5FcnJub0Vycm9yKDMxKTtpZighQW4uaXNGaWxlKHQubW9kZSkpdGhyb3cgbmV3IEFuLkVycm5vRXJyb3IoMjgpO3ZhciBvPUFuLm5vZGVQZXJtaXNzaW9ucyh0LCJ3Iik7aWYobyl0aHJvdyBuZXcgQW4uRXJybm9FcnJvcihvKTt0Lm5vZGVfb3BzLnNldGF0dHIodCx7c2l6ZTplLHRpbWVzdGFtcDpEYXRlLm5vdygpfSl9LGZ0cnVuY2F0ZShyLGUpe3ZhciB0PUFuLmdldFN0cmVhbUNoZWNrZWQocik7aWYoMD09KDIwOTcxNTUmdC5mbGFncykpdGhyb3cgbmV3IEFuLkVycm5vRXJyb3IoMjgpO0FuLnRydW5jYXRlKHQubm9kZSxlKX0sdXRpbWUocixlLHQpe3ZhciBuLG89QW4ubG9va3VwUGF0aChyLHtmb2xsb3c6ITB9KS5ub2RlO28ubm9kZV9vcHMuc2V0YXR0cihvLHt0aW1lc3RhbXA6TWF0aC5tYXgoZSx0KX0pfSxvcGVuKHIsZSx0KXtpZigiIj09PXIpdGhyb3cgbmV3IEFuLkVycm5vRXJyb3IoNDQpO3ZhciBuO2lmKHQ9dm9pZCAwPT09dD80Mzg6dCx0PTY0JihlPSJzdHJpbmciPT10eXBlb2YgZT8kbihlKTplKT80MDk1JnR8MzI3Njg6MCwib2JqZWN0Ij09dHlwZW9mIHIpbj1yO2Vsc2V7cj1tbi5ub3JtYWxpemUocik7dHJ5e3ZhciBvLG49QW4ubG9va3VwUGF0aChyLHtmb2xsb3c6ISgxMzEwNzImZSl9KS5ub2RlfWNhdGNoKHIpe319dmFyIGE9ITE7aWYoNjQmZSlpZihuKXtpZigxMjgmZSl0aHJvdyBuZXcgQW4uRXJybm9FcnJvcigyMCl9ZWxzZSBuPUFuLm1rbm9kKHIsdCwwKSxhPSEwO2lmKCFuKXRocm93IG5ldyBBbi5FcnJub0Vycm9yKDQ0KTtpZihBbi5pc0NocmRldihuLm1vZGUpJiYoZSY9LTUxMyksNjU1MzYmZSYmIUFuLmlzRGlyKG4ubW9kZSkpdGhyb3cgbmV3IEFuLkVycm5vRXJyb3IoNTQpO2lmKCFhKXt2YXIgaT1Bbi5tYXlPcGVuKG4sZSk7aWYoaSl0aHJvdyBuZXcgQW4uRXJybm9FcnJvcihpKX01MTImZSYmIWEmJkFuLnRydW5jYXRlKG4sMCksZSY9LTEzMTcxMzt2YXIgcz1Bbi5jcmVhdGVTdHJlYW0oe25vZGU6bixwYXRoOkFuLmdldFBhdGgobiksZmxhZ3M6ZSxzZWVrYWJsZTohMCxwb3NpdGlvbjowLHN0cmVhbV9vcHM6bi5zdHJlYW1fb3BzLHVuZ290dGVuOltdLGVycm9yOiExfSk7cmV0dXJuIHMuc3RyZWFtX29wcy5vcGVuJiZzLnN0cmVhbV9vcHMub3BlbihzKSwheS5sb2dSZWFkRmlsZXN8fDEmZXx8KEFuLnJlYWRGaWxlc3x8KEFuLnJlYWRGaWxlcz17fSksciBpbiBBbi5yZWFkRmlsZXN8fChBbi5yZWFkRmlsZXNbcl09MSkpLHN9LGNsb3NlKHIpe2lmKEFuLmlzQ2xvc2VkKHIpKXRocm93IG5ldyBBbi5FcnJub0Vycm9yKDgpO3IuZ2V0ZGVudHMmJihyLmdldGRlbnRzPW51bGwpO3RyeXtyLnN0cmVhbV9vcHMuY2xvc2UmJnIuc3RyZWFtX29wcy5jbG9zZShyKX1jYXRjaChyKXt0aHJvdyByfWZpbmFsbHl7QW4uY2xvc2VTdHJlYW0oci5mZCl9ci5mZD1udWxsfSxpc0Nsb3NlZChyKXtyZXR1cm4gbnVsbD09PXIuZmR9LGxsc2VlayhyLGUsdCl7aWYoQW4uaXNDbG9zZWQocikpdGhyb3cgbmV3IEFuLkVycm5vRXJyb3IoOCk7aWYoIXIuc2Vla2FibGV8fCFyLnN0cmVhbV9vcHMubGxzZWVrKXRocm93IG5ldyBBbi5FcnJub0Vycm9yKDcwKTtpZigwIT10JiYxIT10JiYyIT10KXRocm93IG5ldyBBbi5FcnJub0Vycm9yKDI4KTtyZXR1cm4gci5wb3NpdGlvbj1yLnN0cmVhbV9vcHMubGxzZWVrKHIsZSx0KSxyLnVuZ290dGVuPVtdLHIucG9zaXRpb259LHJlYWQocixlLHQsbixvKXtpZihuPDB8fG88MCl0aHJvdyBuZXcgQW4uRXJybm9FcnJvcigyOCk7aWYoQW4uaXNDbG9zZWQocikpdGhyb3cgbmV3IEFuLkVycm5vRXJyb3IoOCk7aWYoMT09KDIwOTcxNTUmci5mbGFncykpdGhyb3cgbmV3IEFuLkVycm5vRXJyb3IoOCk7aWYoQW4uaXNEaXIoci5ub2RlLm1vZGUpKXRocm93IG5ldyBBbi5FcnJub0Vycm9yKDMxKTtpZighci5zdHJlYW1fb3BzLnJlYWQpdGhyb3cgbmV3IEFuLkVycm5vRXJyb3IoMjgpO3ZhciBhPXZvaWQgMCE9PW87aWYoYSl7aWYoIXIuc2Vla2FibGUpdGhyb3cgbmV3IEFuLkVycm5vRXJyb3IoNzApfWVsc2Ugbz1yLnBvc2l0aW9uO3ZhciBpPXIuc3RyZWFtX29wcy5yZWFkKHIsZSx0LG4sbyk7cmV0dXJuIGF8fChyLnBvc2l0aW9uKz1pKSxpfSx3cml0ZShyLGUsdCxuLG8sYSl7aWYobjwwfHxvPDApdGhyb3cgbmV3IEFuLkVycm5vRXJyb3IoMjgpO2lmKEFuLmlzQ2xvc2VkKHIpKXRocm93IG5ldyBBbi5FcnJub0Vycm9yKDgpO2lmKDA9PSgyMDk3MTU1JnIuZmxhZ3MpKXRocm93IG5ldyBBbi5FcnJub0Vycm9yKDgpO2lmKEFuLmlzRGlyKHIubm9kZS5tb2RlKSl0aHJvdyBuZXcgQW4uRXJybm9FcnJvcigzMSk7aWYoIXIuc3RyZWFtX29wcy53cml0ZSl0aHJvdyBuZXcgQW4uRXJybm9FcnJvcigyOCk7ci5zZWVrYWJsZSYmMTAyNCZyLmZsYWdzJiZBbi5sbHNlZWsociwwLDIpO3ZhciBpPXZvaWQgMCE9PW87aWYoaSl7aWYoIXIuc2Vla2FibGUpdGhyb3cgbmV3IEFuLkVycm5vRXJyb3IoNzApfWVsc2Ugbz1yLnBvc2l0aW9uO3ZhciBzPXIuc3RyZWFtX29wcy53cml0ZShyLGUsdCxuLG8sYSk7cmV0dXJuIGl8fChyLnBvc2l0aW9uKz1zKSxzfSxhbGxvY2F0ZShyLGUsdCl7aWYoQW4uaXNDbG9zZWQocikpdGhyb3cgbmV3IEFuLkVycm5vRXJyb3IoOCk7aWYoZTwwfHx0PD0wKXRocm93IG5ldyBBbi5FcnJub0Vycm9yKDI4KTtpZigwPT0oMjA5NzE1NSZyLmZsYWdzKSl0aHJvdyBuZXcgQW4uRXJybm9FcnJvcig4KTtpZighQW4uaXNGaWxlKHIubm9kZS5tb2RlKSYmIUFuLmlzRGlyKHIubm9kZS5tb2RlKSl0aHJvdyBuZXcgQW4uRXJybm9FcnJvcig0Myk7aWYoIXIuc3RyZWFtX29wcy5hbGxvY2F0ZSl0aHJvdyBuZXcgQW4uRXJybm9FcnJvcigxMzgpO3Iuc3RyZWFtX29wcy5hbGxvY2F0ZShyLGUsdCl9LG1tYXAocixlLHQsbixvKXtpZigwIT0oMiZuKSYmMD09KDImbykmJjIhPSgyMDk3MTU1JnIuZmxhZ3MpKXRocm93IG5ldyBBbi5FcnJub0Vycm9yKDIpO2lmKDE9PSgyMDk3MTU1JnIuZmxhZ3MpKXRocm93IG5ldyBBbi5FcnJub0Vycm9yKDIpO2lmKCFyLnN0cmVhbV9vcHMubW1hcCl0aHJvdyBuZXcgQW4uRXJybm9FcnJvcig0Myk7cmV0dXJuIHIuc3RyZWFtX29wcy5tbWFwKHIsZSx0LG4sbyl9LG1zeW5jKHIsZSx0LG4sbyl7cmV0dXJuIHIuc3RyZWFtX29wcy5tc3luYz9yLnN0cmVhbV9vcHMubXN5bmMocixlLHQsbixvKTowfSxtdW5tYXA6cj0+MCxpb2N0bChyLGUsdCl7aWYoIXIuc3RyZWFtX29wcy5pb2N0bCl0aHJvdyBuZXcgQW4uRXJybm9FcnJvcig1OSk7cmV0dXJuIHIuc3RyZWFtX29wcy5pb2N0bChyLGUsdCl9LHJlYWRGaWxlKHIsZT17fSl7aWYoZS5mbGFncz1lLmZsYWdzfHwwLGUuZW5jb2Rpbmc9ZS5lbmNvZGluZ3x8ImJpbmFyeSIsInV0ZjgiIT09ZS5lbmNvZGluZyYmImJpbmFyeSIhPT1lLmVuY29kaW5nKXRocm93IG5ldyBFcnJvcihgSW52YWxpZCBlbmNvZGluZyB0eXBlICIke2UuZW5jb2Rpbmd9ImApO3ZhciB0LG49QW4ub3BlbihyLGUuZmxhZ3MpLG8sYT1Bbi5zdGF0KHIpLnNpemUsaT1uZXcgVWludDhBcnJheShhKTtyZXR1cm4gQW4ucmVhZChuLGksMCxhLDApLCJ1dGY4Ij09PWUuZW5jb2Rpbmc/dD1UdChpLDApOiJiaW5hcnkiPT09ZS5lbmNvZGluZyYmKHQ9aSksQW4uY2xvc2UobiksdH0sd3JpdGVGaWxlKHIsZSx0PXt9KXt0LmZsYWdzPXQuZmxhZ3N8fDU3Nzt2YXIgbj1Bbi5vcGVuKHIsdC5mbGFncyx0Lm1vZGUpO2lmKCJzdHJpbmciPT10eXBlb2YgZSl7dmFyIG89bmV3IFVpbnQ4QXJyYXkoUHQoZSkrMSksYT1FdChlLG8sMCxvLmxlbmd0aCk7QW4ud3JpdGUobixvLDAsYSx2b2lkIDAsdC5jYW5Pd24pfWVsc2V7aWYoIUFycmF5QnVmZmVyLmlzVmlldyhlKSl0aHJvdyBuZXcgRXJyb3IoIlVuc3VwcG9ydGVkIGRhdGEgdHlwZSIpO0FuLndyaXRlKG4sZSwwLGUuYnl0ZUxlbmd0aCx2b2lkIDAsdC5jYW5Pd24pfUFuLmNsb3NlKG4pfSxjd2Q6KCk9PkFuLmN1cnJlbnRQYXRoLGNoZGlyKHIpe3ZhciBlPUFuLmxvb2t1cFBhdGgocix7Zm9sbG93OiEwfSk7aWYobnVsbD09PWUubm9kZSl0aHJvdyBuZXcgQW4uRXJybm9FcnJvcig0NCk7aWYoIUFuLmlzRGlyKGUubm9kZS5tb2RlKSl0aHJvdyBuZXcgQW4uRXJybm9FcnJvcig1NCk7dmFyIHQ9QW4ubm9kZVBlcm1pc3Npb25zKGUubm9kZSwieCIpO2lmKHQpdGhyb3cgbmV3IEFuLkVycm5vRXJyb3IodCk7QW4uY3VycmVudFBhdGg9ZS5wYXRofSxjcmVhdGVEZWZhdWx0RGlyZWN0b3JpZXMoKXtBbi5ta2RpcigiL3RtcCIpLEFuLm1rZGlyKCIvaG9tZSIpLEFuLm1rZGlyKCIvaG9tZS93ZWJfdXNlciIpfSxjcmVhdGVEZWZhdWx0RGV2aWNlcygpe0FuLm1rZGlyKCIvZGV2IiksQW4ucmVnaXN0ZXJEZXZpY2UoQW4ubWFrZWRldigxLDMpLHtyZWFkOigpPT4wLHdyaXRlOihyLGUsdCxuLG8pPT5ufSksQW4ubWtkZXYoIi9kZXYvbnVsbCIsQW4ubWFrZWRldigxLDMpKSxFbi5yZWdpc3RlcihBbi5tYWtlZGV2KDUsMCksRW4uZGVmYXVsdF90dHlfb3BzKSxFbi5yZWdpc3RlcihBbi5tYWtlZGV2KDYsMCksRW4uZGVmYXVsdF90dHkxX29wcyksQW4ubWtkZXYoIi9kZXYvdHR5IixBbi5tYWtlZGV2KDUsMCkpLEFuLm1rZGV2KCIvZGV2L3R0eTEiLEFuLm1ha2VkZXYoNiwwKSk7dmFyIHI9bmV3IFVpbnQ4QXJyYXkoMTAyNCksZT0wLHQ9KCk9PigwPT09ZSYmKGU9eW4ocikuYnl0ZUxlbmd0aCksclstLWVdKTtBbi5jcmVhdGVEZXZpY2UoIi9kZXYiLCJyYW5kb20iLHQpLEFuLmNyZWF0ZURldmljZSgiL2RldiIsInVyYW5kb20iLHQpLEFuLm1rZGlyKCIvZGV2L3NobSIpLEFuLm1rZGlyKCIvZGV2L3NobS90bXAiKX0sY3JlYXRlU3BlY2lhbERpcmVjdG9yaWVzKCl7QW4ubWtkaXIoIi9wcm9jIik7dmFyIGU9QW4ubWtkaXIoIi9wcm9jL3NlbGYiKTtBbi5ta2RpcigiL3Byb2Mvc2VsZi9mZCIpLEFuLm1vdW50KHttb3VudCgpe3ZhciByPUFuLmNyZWF0ZU5vZGUoZSwiZmQiLDE2ODk1LDczKTtyZXR1cm4gci5ub2RlX29wcz17bG9va3VwKHIsZSl7dmFyIHQsbj1Bbi5nZXRTdHJlYW1DaGVja2VkKCtlKSxvPXtwYXJlbnQ6bnVsbCxtb3VudDp7bW91bnRwb2ludDoiZmFrZSJ9LG5vZGVfb3BzOntyZWFkbGluazooKT0+bi5wYXRofX07cmV0dXJuIG8ucGFyZW50PW99fSxyfX0se30sIi9wcm9jL3NlbGYvZmQiKX0sY3JlYXRlU3RhbmRhcmRTdHJlYW1zKCl7eS5zdGRpbj9Bbi5jcmVhdGVEZXZpY2UoIi9kZXYiLCJzdGRpbiIseS5zdGRpbik6QW4uc3ltbGluaygiL2Rldi90dHkiLCIvZGV2L3N0ZGluIikseS5zdGRvdXQ/QW4uY3JlYXRlRGV2aWNlKCIvZGV2Iiwic3Rkb3V0IixudWxsLHkuc3Rkb3V0KTpBbi5zeW1saW5rKCIvZGV2L3R0eSIsIi9kZXYvc3Rkb3V0IikseS5zdGRlcnI/QW4uY3JlYXRlRGV2aWNlKCIvZGV2Iiwic3RkZXJyIixudWxsLHkuc3RkZXJyKTpBbi5zeW1saW5rKCIvZGV2L3R0eTEiLCIvZGV2L3N0ZGVyciIpO3ZhciByPUFuLm9wZW4oIi9kZXYvc3RkaW4iLDApLGU9QW4ub3BlbigiL2Rldi9zdGRvdXQiLDEpLHQ9QW4ub3BlbigiL2Rldi9zdGRlcnIiLDEpfSxlbnN1cmVFcnJub0Vycm9yKCl7QW4uRXJybm9FcnJvcnx8KEFuLkVycm5vRXJyb3I9ZnVuY3Rpb24gcihlLHQpe3RoaXMubmFtZT0iRXJybm9FcnJvciIsdGhpcy5ub2RlPXQsdGhpcy5zZXRFcnJubz1mdW5jdGlvbihyKXt0aGlzLmVycm5vPXJ9LHRoaXMuc2V0RXJybm8oZSksdGhpcy5tZXNzYWdlPSJGUyBlcnJvciJ9LEFuLkVycm5vRXJyb3IucHJvdG90eXBlPW5ldyBFcnJvcixBbi5FcnJub0Vycm9yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvcj1Bbi5FcnJub0Vycm9yLFs0NF0uZm9yRWFjaChyPT57QW4uZ2VuZXJpY0Vycm9yc1tyXT1uZXcgQW4uRXJybm9FcnJvcihyKSxBbi5nZW5lcmljRXJyb3JzW3JdLnN0YWNrPSI8Z2VuZXJpYyBlcnJvciwgbm8gc3RhY2s+In0pKX0sc3RhdGljSW5pdCgpe0FuLmVuc3VyZUVycm5vRXJyb3IoKSxBbi5uYW1lVGFibGU9bmV3IEFycmF5KDQwOTYpLEFuLm1vdW50KFBuLHt9LCIvIiksQW4uY3JlYXRlRGVmYXVsdERpcmVjdG9yaWVzKCksQW4uY3JlYXRlRGVmYXVsdERldmljZXMoKSxBbi5jcmVhdGVTcGVjaWFsRGlyZWN0b3JpZXMoKSxBbi5maWxlc3lzdGVtcz17TUVNRlM6UG59fSxpbml0KHIsZSx0KXtBbi5pbml0LmluaXRpYWxpemVkPSEwLEFuLmVuc3VyZUVycm5vRXJyb3IoKSx5LnN0ZGluPXJ8fHkuc3RkaW4seS5zdGRvdXQ9ZXx8eS5zdGRvdXQseS5zdGRlcnI9dHx8eS5zdGRlcnIsQW4uY3JlYXRlU3RhbmRhcmRTdHJlYW1zKCl9LHF1aXQoKXtBbi5pbml0LmluaXRpYWxpemVkPSExO2Zvcih2YXIgcj0wO3I8QW4uc3RyZWFtcy5sZW5ndGg7cisrKXt2YXIgZT1Bbi5zdHJlYW1zW3JdO2UmJkFuLmNsb3NlKGUpfX0sZmluZE9iamVjdChyLGUpe3ZhciB0PUFuLmFuYWx5emVQYXRoKHIsZSk7cmV0dXJuIHQuZXhpc3RzP3Qub2JqZWN0Om51bGx9LGFuYWx5emVQYXRoKHIsZSl7dHJ5e3ZhciB0O3I9KHQ9QW4ubG9va3VwUGF0aChyLHtmb2xsb3c6IWV9KSkucGF0aH1jYXRjaChyKXt9dmFyIG49e2lzUm9vdDohMSxleGlzdHM6ITEsZXJyb3I6MCxuYW1lOm51bGwscGF0aDpudWxsLG9iamVjdDpudWxsLHBhcmVudEV4aXN0czohMSxwYXJlbnRQYXRoOm51bGwscGFyZW50T2JqZWN0Om51bGx9O3RyeXt2YXIgdD1Bbi5sb29rdXBQYXRoKHIse3BhcmVudDohMH0pO24ucGFyZW50RXhpc3RzPSEwLG4ucGFyZW50UGF0aD10LnBhdGgsbi5wYXJlbnRPYmplY3Q9dC5ub2RlLG4ubmFtZT1tbi5iYXNlbmFtZShyKSx0PUFuLmxvb2t1cFBhdGgocix7Zm9sbG93OiFlfSksbi5leGlzdHM9ITAsbi5wYXRoPXQucGF0aCxuLm9iamVjdD10Lm5vZGUsbi5uYW1lPXQubm9kZS5uYW1lLG4uaXNSb290PSIvIj09PXQucGF0aH1jYXRjaChyKXtuLmVycm9yPXIuZXJybm99cmV0dXJuIG59LGNyZWF0ZVBhdGgocixlLHQsbil7cj0ic3RyaW5nIj09dHlwZW9mIHI/cjpBbi5nZXRQYXRoKHIpO2Zvcih2YXIgbz1lLnNwbGl0KCIvIikucmV2ZXJzZSgpO28ubGVuZ3RoOyl7dmFyIGE9by5wb3AoKTtpZihhKXt2YXIgaT1tbi5qb2luMihyLGEpO3RyeXtBbi5ta2RpcihpKX1jYXRjaChyKXt9cj1pfX1yZXR1cm4gaX0sY3JlYXRlRmlsZShyLGUsdCxuLG8pe3ZhciBhPW1uLmpvaW4yKCJzdHJpbmciPT10eXBlb2Ygcj9yOkFuLmdldFBhdGgociksZSksaT1GbihuLG8pO3JldHVybiBBbi5jcmVhdGUoYSxpKX0sY3JlYXRlRGF0YUZpbGUocixlLHQsbixvLGEpe3ZhciBpPWU7ciYmKHI9InN0cmluZyI9PXR5cGVvZiByP3I6QW4uZ2V0UGF0aChyKSxpPWU/bW4uam9pbjIocixlKTpyKTt2YXIgcz1GbihuLG8pLHU9QW4uY3JlYXRlKGkscyk7aWYodCl7aWYoInN0cmluZyI9PXR5cGVvZiB0KXtmb3IodmFyIGw9bmV3IEFycmF5KHQubGVuZ3RoKSxjPTAsZD10Lmxlbmd0aDtjPGQ7KytjKWxbY109dC5jaGFyQ29kZUF0KGMpO3Q9bH1Bbi5jaG1vZCh1LDE0NnxzKTt2YXIgZj1Bbi5vcGVuKHUsNTc3KTtBbi53cml0ZShmLHQsMCx0Lmxlbmd0aCwwLGEpLEFuLmNsb3NlKGYpLEFuLmNobW9kKHUscyl9cmV0dXJuIHV9LGNyZWF0ZURldmljZShyLGUsdSxpKXt2YXIgdD1tbi5qb2luMigic3RyaW5nIj09dHlwZW9mIHI/cjpBbi5nZXRQYXRoKHIpLGUpLG49Rm4oISF1LCEhaSk7QW4uY3JlYXRlRGV2aWNlLm1ham9yfHwoQW4uY3JlYXRlRGV2aWNlLm1ham9yPTY0KTt2YXIgbz1Bbi5tYWtlZGV2KEFuLmNyZWF0ZURldmljZS5tYWpvcisrLDApO3JldHVybiBBbi5yZWdpc3RlckRldmljZShvLHtvcGVuKHIpe3Iuc2Vla2FibGU9ITF9LGNsb3NlKHIpe2kmJmkuYnVmZmVyJiZpLmJ1ZmZlci5sZW5ndGgmJmkoMTApfSxyZWFkKHIsZSx0LG4sbyl7Zm9yKHZhciBhPTAsaT0wLHM7aTxuO2krKyl7dHJ5e3M9dSgpfWNhdGNoKHIpe3Rocm93IG5ldyBBbi5FcnJub0Vycm9yKDI5KX1pZih2b2lkIDA9PT1zJiYwPT09YSl0aHJvdyBuZXcgQW4uRXJybm9FcnJvcig2KTtpZihudWxsPT1zKWJyZWFrO2ErKyxlW3QraV09c31yZXR1cm4gYSYmKHIubm9kZS50aW1lc3RhbXA9RGF0ZS5ub3coKSksYX0sd3JpdGUocixlLHQsbixvKXtmb3IodmFyIGE9MDthPG47YSsrKXRyeXtpKGVbdCthXSl9Y2F0Y2gocil7dGhyb3cgbmV3IEFuLkVycm5vRXJyb3IoMjkpfXJldHVybiBuJiYoci5ub2RlLnRpbWVzdGFtcD1EYXRlLm5vdygpKSxhfX0pLEFuLm1rZGV2KHQsbixvKX0sZm9yY2VMb2FkRmlsZShyKXtpZihyLmlzRGV2aWNlfHxyLmlzRm9sZGVyfHxyLmxpbmt8fHIuY29udGVudHMpcmV0dXJuITA7aWYoInVuZGVmaW5lZCIhPXR5cGVvZiBYTUxIdHRwUmVxdWVzdCl0aHJvdyBuZXcgRXJyb3IoIkxhenkgbG9hZGluZyBzaG91bGQgaGF2ZSBiZWVuIHBlcmZvcm1lZCAoY29udGVudHMgc2V0KSBpbiBjcmVhdGVMYXp5RmlsZSwgYnV0IGl0IHdhcyBub3QuIExhenkgbG9hZGluZyBvbmx5IHdvcmtzIGluIHdlYiB3b3JrZXJzLiBVc2UgLS1lbWJlZC1maWxlIG9yIC0tcHJlbG9hZC1maWxlIGluIGVtY2Mgb24gdGhlIG1haW4gdGhyZWFkLiIpO2lmKCFjKXRocm93IG5ldyBFcnJvcigiQ2Fubm90IGxvYWQgd2l0aG91dCByZWFkKCkgb3IgWE1MSHR0cFJlcXVlc3QuIik7dHJ5e3IuY29udGVudHM9X24oYyhyLnVybCksITApLHIudXNlZEJ5dGVzPXIuY29udGVudHMubGVuZ3RofWNhdGNoKHIpe3Rocm93IG5ldyBBbi5FcnJub0Vycm9yKDI5KX19LGNyZWF0ZUxhenlGaWxlKHIsZSxsLHQsbil7ZnVuY3Rpb24gbygpe3RoaXMubGVuZ3RoS25vd249ITEsdGhpcy5jaHVua3M9W119aWYoby5wcm90b3R5cGUuZ2V0PWZ1bmN0aW9uIHIoZSl7aWYoIShlPnRoaXMubGVuZ3RoLTF8fGU8MCkpe3ZhciB0PWUldGhpcy5jaHVua1NpemUsbj1lL3RoaXMuY2h1bmtTaXplfDA7cmV0dXJuIHRoaXMuZ2V0dGVyKG4pW3RdfX0sby5wcm90b3R5cGUuc2V0RGF0YUdldHRlcj1mdW5jdGlvbiByKGUpe3RoaXMuZ2V0dGVyPWV9LG8ucHJvdG90eXBlLmNhY2hlTGVuZ3RoPWZ1bmN0aW9uIHIoKXt2YXIgZT1uZXcgWE1MSHR0cFJlcXVlc3Q7aWYoZS5vcGVuKCJIRUFEIixsLCExKSxlLnNlbmQobnVsbCksISgyMDA8PWUuc3RhdHVzJiZlLnN0YXR1czwzMDB8fDMwND09PWUuc3RhdHVzKSl0aHJvdyBuZXcgRXJyb3IoIkNvdWxkbid0IGxvYWQgIitsKyIuIFN0YXR1czogIitlLnN0YXR1cyk7dmFyIG49TnVtYmVyKGUuZ2V0UmVzcG9uc2VIZWFkZXIoIkNvbnRlbnQtbGVuZ3RoIikpLHQsbz0odD1lLmdldFJlc3BvbnNlSGVhZGVyKCJBY2NlcHQtUmFuZ2VzIikpJiYiYnl0ZXMiPT09dCxhPSh0PWUuZ2V0UmVzcG9uc2VIZWFkZXIoIkNvbnRlbnQtRW5jb2RpbmciKSkmJiJnemlwIj09PXQsaT0xMDQ4NTc2O298fChpPW4pO3ZhciBzPShyLGUpPT57aWYoZTxyKXRocm93IG5ldyBFcnJvcigiaW52YWxpZCByYW5nZSAoIityKyIsICIrZSsiKSBvciBubyBieXRlcyByZXF1ZXN0ZWQhIik7aWYobi0xPGUpdGhyb3cgbmV3IEVycm9yKCJvbmx5ICIrbisiIGJ5dGVzIGF2YWlsYWJsZSEgcHJvZ3JhbW1lciBlcnJvciEiKTt2YXIgdD1uZXcgWE1MSHR0cFJlcXVlc3Q7aWYodC5vcGVuKCJHRVQiLGwsITEpLG4hPT1pJiZ0LnNldFJlcXVlc3RIZWFkZXIoIlJhbmdlIiwiYnl0ZXM9IityKyItIitlKSx0LnJlc3BvbnNlVHlwZT0iYXJyYXlidWZmZXIiLHQub3ZlcnJpZGVNaW1lVHlwZSYmdC5vdmVycmlkZU1pbWVUeXBlKCJ0ZXh0L3BsYWluOyBjaGFyc2V0PXgtdXNlci1kZWZpbmVkIiksdC5zZW5kKG51bGwpLCEoMjAwPD10LnN0YXR1cyYmdC5zdGF0dXM8MzAwfHwzMDQ9PT10LnN0YXR1cykpdGhyb3cgbmV3IEVycm9yKCJDb3VsZG4ndCBsb2FkICIrbCsiLiBTdGF0dXM6ICIrdC5zdGF0dXMpO3JldHVybiB2b2lkIDAhPT10LnJlc3BvbnNlP25ldyBVaW50OEFycmF5KHQucmVzcG9uc2V8fFtdKTpfbih0LnJlc3BvbnNlVGV4dHx8IiIsITApfSx1PXRoaXM7dS5zZXREYXRhR2V0dGVyKHI9Pnt2YXIgZT1yKmksdD0ocisxKSppLTEsdD1NYXRoLm1pbih0LG4tMSk7aWYodm9pZCAwPT09dS5jaHVua3Nbcl0mJih1LmNodW5rc1tyXT1zKGUsdCkpLHZvaWQgMD09PXUuY2h1bmtzW3JdKXRocm93IG5ldyBFcnJvcigiZG9YSFIgZmFpbGVkISIpO3JldHVybiB1LmNodW5rc1tyXX0pLCFhJiZufHwoaT1uPTEsbj10aGlzLmdldHRlcigwKS5sZW5ndGgsaT1uLGIoIkxhenlGaWxlcyBvbiBnemlwIGZvcmNlcyBkb3dubG9hZCBvZiB0aGUgd2hvbGUgZmlsZSB3aGVuIGxlbmd0aCBpcyBhY2Nlc3NlZCIpKSx0aGlzLl9sZW5ndGg9bix0aGlzLl9jaHVua1NpemU9aSx0aGlzLmxlbmd0aEtub3duPSEwfSwidW5kZWZpbmVkIiE9dHlwZW9mIFhNTEh0dHBSZXF1ZXN0KXtpZighZil0aHJvdyJDYW5ub3QgZG8gc3luY2hyb25vdXMgYmluYXJ5IFhIUnMgb3V0c2lkZSB3ZWJ3b3JrZXJzIGluIG1vZGVybiBicm93c2Vycy4gVXNlIC0tZW1iZWQtZmlsZSBvciAtLXByZWxvYWQtZmlsZSBpbiBlbWNjIjt2YXIgYT1uZXcgbztPYmplY3QuZGVmaW5lUHJvcGVydGllcyhhLHtsZW5ndGg6e2dldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmxlbmd0aEtub3dufHx0aGlzLmNhY2hlTGVuZ3RoKCksdGhpcy5fbGVuZ3RofX0sY2h1bmtTaXplOntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5sZW5ndGhLbm93bnx8dGhpcy5jYWNoZUxlbmd0aCgpLHRoaXMuX2NodW5rU2l6ZX19fSk7dmFyIGk9e2lzRGV2aWNlOiExLGNvbnRlbnRzOmF9fWVsc2UgdmFyIGk9e2lzRGV2aWNlOiExLHVybDpsfTt2YXIgcz1Bbi5jcmVhdGVGaWxlKHIsZSxpLHQsbik7aS5jb250ZW50cz9zLmNvbnRlbnRzPWkuY29udGVudHM6aS51cmwmJihzLmNvbnRlbnRzPW51bGwscy51cmw9aS51cmwpLE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHMse3VzZWRCeXRlczp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuY29udGVudHMubGVuZ3RofX19KTt2YXIgdT17fSxjO2Z1bmN0aW9uIGQocixlLHQsbixvKXt2YXIgYT1yLm5vZGUuY29udGVudHM7aWYobz49YS5sZW5ndGgpcmV0dXJuIDA7dmFyIGk9TWF0aC5taW4oYS5sZW5ndGgtbyxuKTtpZihhLnNsaWNlKWZvcih2YXIgcz0wO3M8aTtzKyspZVt0K3NdPWFbbytzXTtlbHNlIGZvcih2YXIgcz0wO3M8aTtzKyspZVt0K3NdPWEuZ2V0KG8rcyk7cmV0dXJuIGl9cmV0dXJuIE9iamVjdC5rZXlzKHMuc3RyZWFtX29wcykuZm9yRWFjaChyPT57dmFyIGU9cy5zdHJlYW1fb3BzW3JdO3Vbcl09ZnVuY3Rpb24gcigpe3JldHVybiBBbi5mb3JjZUxvYWRGaWxlKHMpLGUuYXBwbHkobnVsbCxhcmd1bWVudHMpfX0pLHUucmVhZD0ocixlLHQsbixvKT0+KEFuLmZvcmNlTG9hZEZpbGUocyksZChyLGUsdCxuLG8pKSx1Lm1tYXA9KHIsZSx0LG4sbyk9PntBbi5mb3JjZUxvYWRGaWxlKHMpO3ZhciBhPWtuKGUpO3Rocm93IG5ldyBBbi5FcnJub0Vycm9yKDQ4KX0scy5zdHJlYW1fb3BzPXUsc319LERuPXtERUZBVUxUX1BPTExNQVNLOjUsY2FsY3VsYXRlQXQocixlLHQpe2lmKG1uLmlzQWJzKGUpKXJldHVybiBlO3ZhciBuLG8sbjtpZihuPS0xMDA9PT1yP0FuLmN3ZCgpOkRuLmdldFN0cmVhbUZyb21GRChyKS5wYXRoLDAhPWUubGVuZ3RoKXJldHVybiBtbi5qb2luMihuLGUpO2lmKCF0KXRocm93IG5ldyBBbi5FcnJub0Vycm9yKDQ0KTtyZXR1cm4gbn0sZG9TdGF0KHIsZSx0KXt0cnl7dmFyIG49cihlKX1jYXRjaChyKXtpZihyJiZyLm5vZGUmJm1uLm5vcm1hbGl6ZShlKSE9PW1uLm5vcm1hbGl6ZShBbi5nZXRQYXRoKHIubm9kZSkpKXJldHVybi01NDt0aHJvdyByfURbdD4+Ml09bi5kZXYsRFt0KzQ+PjJdPW4ubW9kZSx4W3QrOD4+Ml09bi5ubGluayxEW3QrMTI+PjJdPW4udWlkLERbdCsxNj4+Ml09bi5naWQsRFt0KzIwPj4yXT1uLnJkZXYsYXI9W24uc2l6ZT4+PjAsKG9yPW4uc2l6ZSwxPD0rTWF0aC5hYnMob3IpPzA8b3I/K01hdGguZmxvb3Iob3IvNDI5NDk2NzI5Nik+Pj4wOn5+K01hdGguY2VpbCgob3ItKH5+b3I+Pj4wKSkvNDI5NDk2NzI5Nik+Pj4wOjApXSxEW3QrMjQ+PjJdPWFyWzBdLERbdCsyOD4+Ml09YXJbMV0sRFt0KzMyPj4yXT00MDk2LERbdCszNj4+Ml09bi5ibG9ja3M7dmFyIG89bi5hdGltZS5nZXRUaW1lKCksYT1uLm10aW1lLmdldFRpbWUoKSxpPW4uY3RpbWUuZ2V0VGltZSgpO3JldHVybiBhcj1bTWF0aC5mbG9vcihvLzFlMyk+Pj4wLChvcj1NYXRoLmZsb29yKG8vMWUzKSwxPD0rTWF0aC5hYnMob3IpPzA8b3I/K01hdGguZmxvb3Iob3IvNDI5NDk2NzI5Nik+Pj4wOn5+K01hdGguY2VpbCgob3ItKH5+b3I+Pj4wKSkvNDI5NDk2NzI5Nik+Pj4wOjApXSxEW3QrNDA+PjJdPWFyWzBdLERbdCs0ND4+Ml09YXJbMV0seFt0KzQ4Pj4yXT1vJTFlMyoxZTMsYXI9W01hdGguZmxvb3IoYS8xZTMpPj4+MCwob3I9TWF0aC5mbG9vcihhLzFlMyksMTw9K01hdGguYWJzKG9yKT8wPG9yPytNYXRoLmZsb29yKG9yLzQyOTQ5NjcyOTYpPj4+MDp+fitNYXRoLmNlaWwoKG9yLSh+fm9yPj4+MCkpLzQyOTQ5NjcyOTYpPj4+MDowKV0sRFt0KzU2Pj4yXT1hclswXSxEW3QrNjA+PjJdPWFyWzFdLHhbdCs2ND4+Ml09YSUxZTMqMWUzLGFyPVtNYXRoLmZsb29yKGkvMWUzKT4+PjAsKG9yPU1hdGguZmxvb3IoaS8xZTMpLDE8PStNYXRoLmFicyhvcik/MDxvcj8rTWF0aC5mbG9vcihvci80Mjk0OTY3Mjk2KT4+PjA6fn4rTWF0aC5jZWlsKChvci0ofn5vcj4+PjApKS80Mjk0OTY3Mjk2KT4+PjA6MCldLERbdCs3Mj4+Ml09YXJbMF0sRFt0Kzc2Pj4yXT1hclsxXSx4W3QrODA+PjJdPWklMWUzKjFlMyxhcj1bbi5pbm8+Pj4wLChvcj1uLmlubywxPD0rTWF0aC5hYnMob3IpPzA8b3I/K01hdGguZmxvb3Iob3IvNDI5NDk2NzI5Nik+Pj4wOn5+K01hdGguY2VpbCgob3ItKH5+b3I+Pj4wKSkvNDI5NDk2NzI5Nik+Pj4wOjApXSxEW3QrODg+PjJdPWFyWzBdLERbdCs5Mj4+Ml09YXJbMV0sMH0sZG9Nc3luYyhyLGUsdCxuLG8pe2lmKCFBbi5pc0ZpbGUoZS5ub2RlLm1vZGUpKXRocm93IG5ldyBBbi5FcnJub0Vycm9yKDQzKTtpZigyJm4pcmV0dXJuIDA7dmFyIGE9JC5zbGljZShyLHIrdCk7QW4ubXN5bmMoZSxhLG8sdCxuKX0sdmFyYXJnczp2b2lkIDAsZ2V0KCl7dmFyIHI9RFtEbi52YXJhcmdzPj4yXTtyZXR1cm4gRG4udmFyYXJncys9NCxyfSxnZXRwKCl7cmV0dXJuIERuLmdldCgpfSxnZXRTdHIocil7dmFyIGU7cmV0dXJuIFN0KHIpfSxnZXRTdHJlYW1Gcm9tRkQocil7dmFyIGU7cmV0dXJuIEFuLmdldFN0cmVhbUNoZWNrZWQocil9fSx4bj0obixvKT0+e3ZhciBhPTA7cmV0dXJuIGhuKCkuZm9yRWFjaCgocixlKT0+e3ZhciB0PW8rYTt4W24rNCplPj4yXT10LHBuKHIsdCksYSs9ci5sZW5ndGgrMX0pLDB9LGpuPShyLGUpPT57dmFyIHQ9aG4oKTt4W3I+PjJdPXQubGVuZ3RoO3ZhciBuPTA7cmV0dXJuIHQuZm9yRWFjaChyPT5uKz1yLmxlbmd0aCsxKSx4W2U+PjJdPW4sMH07ZnVuY3Rpb24gT24ocil7dHJ5e3ZhciBlPURuLmdldFN0cmVhbUZyb21GRChyKTtyZXR1cm4gQW4uY2xvc2UoZSksMH1jYXRjaChyKXtpZih2b2lkIDA9PT1Bbnx8IkVycm5vRXJyb3IiIT09ci5uYW1lKXRocm93IHI7cmV0dXJuIHIuZXJybm99fXZhciBSbj0ocixlLHQsbik9Pntmb3IodmFyIG89MCxhPTA7YTx0O2ErKyl7dmFyIGk9eFtlPj4yXSxzPXhbZSs0Pj4yXTtlKz04O3ZhciB1PUFuLnJlYWQocixNLGkscyxuKTtpZih1PDApcmV0dXJuLTE7aWYobys9dSx1PHMpYnJlYWs7dm9pZCAwIT09biYmKG4rPXUpfXJldHVybiBvfTtmdW5jdGlvbiBXbihyLGUsdCxuKXt0cnl7dmFyIG89RG4uZ2V0U3RyZWFtRnJvbUZEKHIpLGE9Um4obyxlLHQpO3JldHVybiB4W24+PjJdPWEsMH1jYXRjaChyKXtpZih2b2lkIDA9PT1Bbnx8IkVycm5vRXJyb3IiIT09ci5uYW1lKXRocm93IHI7cmV0dXJuIHIuZXJybm99fXZhciB6bj0ocixlKT0+ZSsyMDk3MTUyPj4+MDw0MTk0MzA1LSEhcj8ocj4+PjApKzQyOTQ5NjcyOTYqZTpOYU47ZnVuY3Rpb24gTm4ocixlLHQsbixvKXt2YXIgYT16bihlLHQpO3RyeXtpZihpc05hTihhKSlyZXR1cm4gNjE7dmFyIGk9RG4uZ2V0U3RyZWFtRnJvbUZEKHIpO3JldHVybiBBbi5sbHNlZWsoaSxhLG4pLGFyPVtpLnBvc2l0aW9uPj4+MCwob3I9aS5wb3NpdGlvbiwxPD0rTWF0aC5hYnMob3IpPzA8b3I/K01hdGguZmxvb3Iob3IvNDI5NDk2NzI5Nik+Pj4wOn5+K01hdGguY2VpbCgob3ItKH5+b3I+Pj4wKSkvNDI5NDk2NzI5Nik+Pj4wOjApXSxEW28+PjJdPWFyWzBdLERbbys0Pj4yXT1hclsxXSxpLmdldGRlbnRzJiYwPT09YSYmMD09PW4mJihpLmdldGRlbnRzPW51bGwpLDB9Y2F0Y2gocil7aWYodm9pZCAwPT09QW58fCJFcnJub0Vycm9yIiE9PXIubmFtZSl0aHJvdyByO3JldHVybiByLmVycm5vfX12YXIgSW49KHIsZSx0LG4pPT57Zm9yKHZhciBvPTAsYT0wO2E8dDthKyspe3ZhciBpPXhbZT4+Ml0scz14W2UrND4+Ml07ZSs9ODt2YXIgdT1Bbi53cml0ZShyLE0saSxzLG4pO2lmKHU8MClyZXR1cm4tMTtvKz11LHZvaWQgMCE9PW4mJihuKz11KX1yZXR1cm4gb307ZnVuY3Rpb24gVm4ocixlLHQsbil7dHJ5e3ZhciBvPURuLmdldFN0cmVhbUZyb21GRChyKSxhPUluKG8sZSx0KTtyZXR1cm4geFtuPj4yXT1hLDB9Y2F0Y2gocil7aWYodm9pZCAwPT09QW58fCJFcnJub0Vycm9yIiE9PXIubmFtZSl0aHJvdyByO3JldHVybiByLmVycm5vfX12YXIgTG49cj0+cixCbj1yPT5yJTQ9PTAmJihyJTEwMCE9MHx8ciU0MDA9PTApLFVuPShyLGUpPT57Zm9yKHZhciB0PTAsbj0wO248PWU7dCs9cltuKytdKTtyZXR1cm4gdH0sSG49WzMxLDI5LDMxLDMwLDMxLDMwLDMxLDMxLDMwLDMxLDMwLDMxXSxxbj1bMzEsMjgsMzEsMzAsMzEsMzAsMzEsMzEsMzAsMzEsMzAsMzFdLFluPShyLGUpPT57Zm9yKHZhciB0PW5ldyBEYXRlKHIuZ2V0VGltZSgpKTswPGU7KXt2YXIgbj1Cbih0LmdldEZ1bGxZZWFyKCkpLG89dC5nZXRNb250aCgpLGE9KG4/SG46cW4pW29dO2lmKCEoZT5hLXQuZ2V0RGF0ZSgpKSlyZXR1cm4gdC5zZXREYXRlKHQuZ2V0RGF0ZSgpK2UpLHQ7ZS09YS10LmdldERhdGUoKSsxLHQuc2V0RGF0ZSgxKSxvPDExP3Quc2V0TW9udGgobysxKToodC5zZXRNb250aCgwKSx0LnNldEZ1bGxZZWFyKHQuZ2V0RnVsbFllYXIoKSsxKSl9cmV0dXJuIHR9LEduPShyLGUpPT57TS5zZXQocixlKX0sWG49KHIsZSx0LG4pPT57dmFyIG89eFtuKzQwPj4yXSxhPXt0bV9zZWM6RFtuPj4yXSx0bV9taW46RFtuKzQ+PjJdLHRtX2hvdXI6RFtuKzg+PjJdLHRtX21kYXk6RFtuKzEyPj4yXSx0bV9tb246RFtuKzE2Pj4yXSx0bV95ZWFyOkRbbisyMD4+Ml0sdG1fd2RheTpEW24rMjQ+PjJdLHRtX3lkYXk6RFtuKzI4Pj4yXSx0bV9pc2RzdDpEW24rMzI+PjJdLHRtX2dtdG9mZjpEW24rMzY+PjJdLHRtX3pvbmU6bz9TdChvKToiIn0saT1TdCh0KSxzPXsiJWMiOiIlYSAlYiAlZCAlSDolTTolUyAlWSIsIiVEIjoiJW0vJWQvJXkiLCIlRiI6IiVZLSVtLSVkIiwiJWgiOiIlYiIsIiVyIjoiJUk6JU06JVMgJXAiLCIlUiI6IiVIOiVNIiwiJVQiOiIlSDolTTolUyIsIiV4IjoiJW0vJWQvJXkiLCIlWCI6IiVIOiVNOiVTIiwiJUVjIjoiJWMiLCIlRUMiOiIlQyIsIiVFeCI6IiVtLyVkLyV5IiwiJUVYIjoiJUg6JU06JVMiLCIlRXkiOiIleSIsIiVFWSI6IiVZIiwiJU9kIjoiJWQiLCIlT2UiOiIlZSIsIiVPSCI6IiVIIiwiJU9JIjoiJUkiLCIlT20iOiIlbSIsIiVPTSI6IiVNIiwiJU9TIjoiJVMiLCIlT3UiOiIldSIsIiVPVSI6IiVVIiwiJU9WIjoiJVYiLCIlT3ciOiIldyIsIiVPVyI6IiVXIiwiJU95IjoiJXkifSx1O2Zvcih1IGluIHMpaT1pLnJlcGxhY2UobmV3IFJlZ0V4cCh1LCJnIiksc1t1XSk7dmFyIGw9WyJTdW5kYXkiLCJNb25kYXkiLCJUdWVzZGF5IiwiV2VkbmVzZGF5IiwiVGh1cnNkYXkiLCJGcmlkYXkiLCJTYXR1cmRheSJdLGM9WyJKYW51YXJ5IiwiRmVicnVhcnkiLCJNYXJjaCIsIkFwcmlsIiwiTWF5IiwiSnVuZSIsIkp1bHkiLCJBdWd1c3QiLCJTZXB0ZW1iZXIiLCJPY3RvYmVyIiwiTm92ZW1iZXIiLCJEZWNlbWJlciJdO2Z1bmN0aW9uIGQocixlLHQpe2Zvcih2YXIgbj0ibnVtYmVyIj09dHlwZW9mIHI/ci50b1N0cmluZygpOnJ8fCIiO24ubGVuZ3RoPGU7KW49dFswXStuO3JldHVybiBufWZ1bmN0aW9uIGYocixlKXtyZXR1cm4gZChyLGUsIjAiKX1mdW5jdGlvbiBoKHIsZSl7ZnVuY3Rpb24gdChyKXtyZXR1cm4gcjwwPy0xOjA8cj8xOjB9dmFyIG47cmV0dXJuIG49MD09PShuPXQoci5nZXRGdWxsWWVhcigpLWUuZ2V0RnVsbFllYXIoKSkpJiYwPT09KG49dChyLmdldE1vbnRoKCktZS5nZXRNb250aCgpKSk/dChyLmdldERhdGUoKS1lLmdldERhdGUoKSk6bn1mdW5jdGlvbiBwKHIpe3N3aXRjaChyLmdldERheSgpKXtjYXNlIDA6cmV0dXJuIG5ldyBEYXRlKHIuZ2V0RnVsbFllYXIoKS0xLDExLDI5KTtjYXNlIDE6cmV0dXJuIHI7Y2FzZSAyOnJldHVybiBuZXcgRGF0ZShyLmdldEZ1bGxZZWFyKCksMCwzKTtjYXNlIDM6cmV0dXJuIG5ldyBEYXRlKHIuZ2V0RnVsbFllYXIoKSwwLDIpO2Nhc2UgNDpyZXR1cm4gbmV3IERhdGUoci5nZXRGdWxsWWVhcigpLDAsMSk7Y2FzZSA1OnJldHVybiBuZXcgRGF0ZShyLmdldEZ1bGxZZWFyKCktMSwxMSwzMSk7Y2FzZSA2OnJldHVybiBuZXcgRGF0ZShyLmdldEZ1bGxZZWFyKCktMSwxMSwzMCl9fWZ1bmN0aW9uIG0ocil7dmFyIGU9WW4obmV3IERhdGUoci50bV95ZWFyKzE5MDAsMCwxKSxyLnRtX3lkYXkpLHQ9bmV3IERhdGUoZS5nZXRGdWxsWWVhcigpLDAsNCksbj1uZXcgRGF0ZShlLmdldEZ1bGxZZWFyKCkrMSwwLDQpLG89cCh0KSxhPXAobik7cmV0dXJuIGgobyxlKTw9MD9oKGEsZSk8PTA/ZS5nZXRGdWxsWWVhcigpKzE6ZS5nZXRGdWxsWWVhcigpOmUuZ2V0RnVsbFllYXIoKS0xfXZhciB2PXsiJWEiOnI9Pmxbci50bV93ZGF5XS5zdWJzdHJpbmcoMCwzKSwiJUEiOnI9Pmxbci50bV93ZGF5XSwiJWIiOnI9PmNbci50bV9tb25dLnN1YnN0cmluZygwLDMpLCIlQiI6cj0+Y1tyLnRtX21vbl0sIiVDIjpyPT57dmFyIGU7cmV0dXJuIGYoKHIudG1feWVhcisxOTAwKS8xMDB8MCwyKX0sIiVkIjpyPT5mKHIudG1fbWRheSwyKSwiJWUiOnI9PmQoci50bV9tZGF5LDIsIiAiKSwiJWciOnI9Pm0ocikudG9TdHJpbmcoKS5zdWJzdHJpbmcoMiksIiVHIjpyPT5tKHIpLCIlSCI6cj0+ZihyLnRtX2hvdXIsMiksIiVJIjpyPT57dmFyIGU9ci50bV9ob3VyO3JldHVybiAwPT1lP2U9MTI6MTI8ZSYmKGUtPTEyKSxmKGUsMil9LCIlaiI6cj0+ZihyLnRtX21kYXkrVW4oQm4oci50bV95ZWFyKzE5MDApP0huOnFuLHIudG1fbW9uLTEpLDMpLCIlbSI6cj0+ZihyLnRtX21vbisxLDIpLCIlTSI6cj0+ZihyLnRtX21pbiwyKSwiJW4iOigpPT4iXG4iLCIlcCI6cj0+MDw9ci50bV9ob3VyJiZyLnRtX2hvdXI8MTI/IkFNIjoiUE0iLCIlUyI6cj0+ZihyLnRtX3NlYywyKSwiJXQiOigpPT4iXHQiLCIldSI6cj0+ci50bV93ZGF5fHw3LCIlVSI6cj0+e3ZhciBlPXIudG1feWRheSs3LXIudG1fd2RheTtyZXR1cm4gZihNYXRoLmZsb29yKGUvNyksMil9LCIlViI6cj0+e3ZhciBlPU1hdGguZmxvb3IoKHIudG1feWRheSs3LShyLnRtX3dkYXkrNiklNykvNyksdCxlLG47cmV0dXJuKHIudG1fd2RheSszNzEtci50bV95ZGF5LTIpJTc8PTImJmUrKyxlPzUzPT1lJiYoND09KHQ9KHIudG1fd2RheSszNzEtci50bV95ZGF5KSU3KXx8Mz09dCYmQm4oci50bV95ZWFyKXx8KGU9MSkpOihlPTUyLCg0PT0obj0oci50bV93ZGF5Kzctci50bV95ZGF5LTEpJTcpfHw1PT1uJiZCbihyLnRtX3llYXIlNDAwLTEpKSYmZSsrKSxmKGUsMil9LCIldyI6cj0+ci50bV93ZGF5LCIlVyI6cj0+e3ZhciBlPXIudG1feWRheSs3LShyLnRtX3dkYXkrNiklNztyZXR1cm4gZihNYXRoLmZsb29yKGUvNyksMil9LCIleSI6cj0+KHIudG1feWVhcisxOTAwKS50b1N0cmluZygpLnN1YnN0cmluZygyKSwiJVkiOnI9PnIudG1feWVhcisxOTAwLCIleiI6cj0+e3ZhciBlLHQ9MDw9KGU9ci50bV9nbXRvZmYpLGU9TWF0aC5hYnMoZSkvNjA7cmV0dXJuKHQ/IisiOiItIikrU3RyaW5nKCIwMDAwIisoZT1lLzYwKjEwMCtlJTYwKSkuc2xpY2UoLTQpfSwiJVoiOnI9PnIudG1fem9uZSwiJSUiOigpPT4iJSJ9LHUsaT1pLnJlcGxhY2UoLyUlL2csIlwwXDAiKTtmb3IodSBpbiB2KWkuaW5jbHVkZXModSkmJihpPWkucmVwbGFjZShuZXcgUmVnRXhwKHUsImciKSx2W3VdKGEpKSk7dmFyIHk9X24oaT1pLnJlcGxhY2UoL1wwXDAvZywiJSIpLCExKTtyZXR1cm4geS5sZW5ndGg+ZT8wOihHbih5LHIpLHkubGVuZ3RoLTEpfSxLbj0ocixlLHQsbixvKT0+WG4ocixlLHQsbiksSm49KHIsZSk9PntyPDEyOD9lLnB1c2gocik6ZS5wdXNoKHIlMTI4fDEyOCxyPj43KX0sWm49cj0+e2Zvcih2YXIgZT17aToiaTMyIixqOiJpNjQiLGY6ImYzMiIsZDoiZjY0IixwOiJpMzIifSx0PXtwYXJhbWV0ZXJzOltdLHJlc3VsdHM6InYiPT1yWzBdP1tdOltlW3JbMF1dXX0sbj0xO248ci5sZW5ndGg7KytuKXQucGFyYW1ldGVycy5wdXNoKGVbcltuXV0pO3JldHVybiB0fSxRbj0ocixlKT0+e3ZhciB0PXIuc2xpY2UoMCwxKSxuPXIuc2xpY2UoMSksbz17aToxMjcscDoxMjcsajoxMjYsZjoxMjUsZDoxMjR9O2UucHVzaCg5NiksSm4obi5sZW5ndGgsZSk7Zm9yKHZhciBhPTA7YTxuLmxlbmd0aDsrK2EpZS5wdXNoKG9bblthXV0pOyJ2Ij09dD9lLnB1c2goMCk6ZS5wdXNoKDEsb1t0XSl9LHJvPShyLGUpPT57aWYoImZ1bmN0aW9uIj09dHlwZW9mIFdlYkFzc2VtYmx5LkZ1bmN0aW9uKXJldHVybiBuZXcgV2ViQXNzZW1ibHkuRnVuY3Rpb24oWm4oZSkscik7dmFyIHQ9WzFdO1FuKGUsdCk7dmFyIG49WzAsOTcsMTE1LDEwOSwxLDAsMCwwLDFdO0puKHQubGVuZ3RoLG4pLG4ucHVzaC5hcHBseShuLHQpLG4ucHVzaCgyLDcsMSwxLDEwMSwxLDEwMiwwLDAsNyw1LDEsMSwxMDIsMCwwKTt2YXIgbz1uZXcgV2ViQXNzZW1ibHkuTW9kdWxlKG5ldyBVaW50OEFycmF5KG4pKSxhLGk7cmV0dXJuIG5ldyBXZWJBc3NlbWJseS5JbnN0YW5jZShvLHtlOntmOnJ9fSkuZXhwb3J0cy5mfSxlbz0ocixlKT0+e2lmKHRvKWZvcih2YXIgdD1yO3Q8citlO3QrKyl7dmFyIG49QmUodCk7biYmdG8uc2V0KG4sdCl9fSx0bz12b2lkIDAsbm89cj0+KHRvfHwodG89bmV3IFdlYWtNYXAsZW8oMCxSLmxlbmd0aCkpLHRvLmdldChyKXx8MCksb289W10sYW89KCk9PntpZihvby5sZW5ndGgpcmV0dXJuIG9vLnBvcCgpO3RyeXtSLmdyb3coMSl9Y2F0Y2gocil7aWYoIShyIGluc3RhbmNlb2YgUmFuZ2VFcnJvcikpdGhyb3cgcjt0aHJvdyJVbmFibGUgdG8gZ3JvdyB3YXNtIHRhYmxlLiBTZXQgQUxMT1dfVEFCTEVfR1JPV1RILiJ9cmV0dXJuIFIubGVuZ3RoLTF9LGlvPShyLGUpPT57Ui5zZXQocixlKSxMZVtyXT1SLmdldChyKX0sc289KGUsdCk9Pnt2YXIgcj1ubyhlKTtpZihyKXJldHVybiByO3ZhciBuPWFvKCk7dHJ5e2lvKG4sZSl9Y2F0Y2gocil7aWYoIShyIGluc3RhbmNlb2YgVHlwZUVycm9yKSl0aHJvdyByO3ZhciBvPXJvKGUsdCk7aW8obixvKX1yZXR1cm4gdG8uc2V0KGUsbiksbn0sdW89cj0+e3RvLmRlbGV0ZShCZShyKSksb28ucHVzaChyKX0sT3I9eS5JbnRlcm5hbEVycm9yPWNsYXNzIE9yIGV4dGVuZHMgRXJyb3J7Y29uc3RydWN0b3Iocil7c3VwZXIociksdGhpcy5uYW1lPSJJbnRlcm5hbEVycm9yIn19O0lyKCksQnI9eS5CaW5kaW5nRXJyb3I9Y2xhc3MgQnIgZXh0ZW5kcyBFcnJvcntjb25zdHJ1Y3RvcihyKXtzdXBlcihyKSx0aGlzLm5hbWU9IkJpbmRpbmdFcnJvciJ9fSxiZSgpLGNlKCksemUoKSxHZT15LlVuYm91bmRUeXBlRXJyb3I9WWUoRXJyb3IsIlVuYm91bmRUeXBlRXJyb3IiKSxudCgpLHV0KCk7dmFyIGxvPWZ1bmN0aW9uKHIsZSx0LG4pe3RoaXMucGFyZW50PXI9cnx8dGhpcyx0aGlzLm1vdW50PXIubW91bnQsdGhpcy5tb3VudGVkPW51bGwsdGhpcy5pZD1Bbi5uZXh0SW5vZGUrKyx0aGlzLm5hbWU9ZSx0aGlzLm1vZGU9dCx0aGlzLm5vZGVfb3BzPXt9LHRoaXMuc3RyZWFtX29wcz17fSx0aGlzLnJkZXY9bn0sY289MzY1LGZvPTE0NjtPYmplY3QuZGVmaW5lUHJvcGVydGllcyhsby5wcm90b3R5cGUse3JlYWQ6e2dldDpmdW5jdGlvbigpe3JldHVybih0aGlzLm1vZGUmY28pPT1jb30sc2V0OmZ1bmN0aW9uKHIpe3I/dGhpcy5tb2RlfD1jbzp0aGlzLm1vZGUmPX5jb319LHdyaXRlOntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4odGhpcy5tb2RlJmZvKT09Zm99LHNldDpmdW5jdGlvbihyKXtyP3RoaXMubW9kZXw9Zm86dGhpcy5tb2RlJj1+Zm99fSxpc0ZvbGRlcjp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIEFuLmlzRGlyKHRoaXMubW9kZSl9fSxpc0RldmljZTp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIEFuLmlzQ2hyZGV2KHRoaXMubW9kZSl9fX0pLEFuLkZTTm9kZT1sbyxBbi5jcmVhdGVQcmVsb2FkZWRGaWxlPU1uLEFuLnN0YXRpY0luaXQoKTt2YXIgaG89e0I6Z3IsTTpfcixhOlByLGs6Q3IsVTpUcixoOlNyLHBhOk1yLGM6RXIsSmE6enIsZGE6TnIsdWE6R3IseTpKZSx4OmV0LGo6dHQsc2E6Y3QsUTpmdCx1OnB0LFc6eXQscDpndCxBOl90LHM6YnQsVjpNdCxPOlJ0LEY6V3QsS2E6enQsdmE6TnQsUGE6SXQsRWE6SHQsTWE6cXQsUmE6aXQsT2E6WXQsSWE6SnQsUWE6WnQsTmE6UXQsSDpybixhYTplbix0YTp0bixTYTpubix6Om9uLE46YW4scmE6c24scWE6Y24sbGE6eG4sbWE6am4sbmE6T24sb2E6V24sY2E6Tm4sVDpWbixBYTpiYSxHOnRhLEo6WW8sQzpVbyxFOm5hLCQ6cmEseWE6a2EsUjpTYSx4YTpQYSxyOnlhLGQ6cW8sYjpCbyxuOkpvLGw6S28sUDpkYSxEOkNhLFM6VGEsTDpNYSxiYTpSYSxpOmVhLGY6SG8sR2E6dWEsZzpHbyxEYTpnYSxJOnNhLF86YWEsSGE6aWEsdDpjYSxDYTp3YSxCYTpfYSxGYTpsYSxlOkxvLExhOlpvLG06WG8sbzpvYSx6YTpFYSxaOmhhLHY6ZmEsdzptYSxYOnZhLHE6UW8sSzokYSxZOnBhLGhhOkRhLGphOkZhLGlhOkFhLGZhOmphLGdhOnhhLGVhOk9hLHdhOkxuLGthOktufSxwbz1mcigpLG1vPSgpPT4obW89cG8uVWEpKCksdm89cj0+KHZvPXBvLl9fY3hhX2ZyZWVfZXhjZXB0aW9uKShyKSx5bz1yPT4oeW89cG8uV2EpKHIpLGdvPXI9Pihnbz1wby5YYSkociksd289cj0+KHdvPXBvLllhKShyKSxfbz15Ll9fZW1iaW5kX2luaXRpYWxpemVfYmluZGluZ3M9KCk9Pihfbz15Ll9fZW1iaW5kX2luaXRpYWxpemVfYmluZGluZ3M9cG8uWmEpKCksYm89KCk9Pihibz1wby5fX2Vycm5vX2xvY2F0aW9uKSgpLEVvPShyLGUpPT4oRW89cG8uX2EpKHIsZSksa289cj0+KGtvPXBvLiRhKShyKSxQbz0oKT0+KFBvPXBvLmFiKSgpLENvPXI9PihDbz1wby5iYikociksVG89cj0+KFRvPXBvLmNiKShyKSxTbz1yPT4oU289cG8uZGIpKHIpLE1vPShyLGUsdCk9PihNbz1wby5lYikocixlLHQpLCRvPXI9Pigkbz1wby5mYikociksRm89eS5keW5DYWxsX3ZpaWppPShyLGUsdCxuLG8sYSk9PihGbz15LmR5bkNhbGxfdmlpamk9cG8uZ2IpKHIsZSx0LG4sbyxhKSxBbz15LmR5bkNhbGxfdmlpamlpPShyLGUsdCxuLG8sYSxpKT0+KEFvPXkuZHluQ2FsbF92aWlqaWk9cG8uaGIpKHIsZSx0LG4sbyxhLGkpLERvPXkuZHluQ2FsbF92aWlpaj0ocixlLHQsbixvLGEpPT4oRG89eS5keW5DYWxsX3ZpaWlqPXBvLmliKShyLGUsdCxuLG8sYSkseG89eS5keW5DYWxsX3ZpamlpaT0ocixlLHQsbixvLGEsaSk9Pih4bz15LmR5bkNhbGxfdmlqaWlpPXBvLmpiKShyLGUsdCxuLG8sYSxpKSxqbz15LmR5bkNhbGxfdmlqaWk9KHIsZSx0LG4sbyxhKT0+KGpvPXkuZHluQ2FsbF92aWppaT1wby5rYikocixlLHQsbixvLGEpLE9vPXkuZHluQ2FsbF92aWppaj0ocixlLHQsbixvLGEsaSk9PihPbz15LmR5bkNhbGxfdmlqaWo9cG8ubGIpKHIsZSx0LG4sbyxhLGkpLFJvPXkuZHluQ2FsbF9qaWppPShyLGUsdCxuLG8pPT4oUm89eS5keW5DYWxsX2ppamk9cG8ubWIpKHIsZSx0LG4sbyksV289eS5keW5DYWxsX2ppaWlpPShyLGUsdCxuLG8pPT4oV289eS5keW5DYWxsX2ppaWlpPXBvLm5iKShyLGUsdCxuLG8pLHpvPXkuZHluQ2FsbF9paWlpaWo9KHIsZSx0LG4sbyxhLGkpPT4oem89eS5keW5DYWxsX2lpaWlpaj1wby5vYikocixlLHQsbixvLGEsaSksTm89eS5keW5DYWxsX2lpaWlpamo9KHIsZSx0LG4sbyxhLGkscyx1KT0+KE5vPXkuZHluQ2FsbF9paWlpaWpqPXBvLnBiKShyLGUsdCxuLG8sYSxpLHMsdSksSW89eS5keW5DYWxsX2lpaWlpaWpqPShyLGUsdCxuLG8sYSxpLHMsdSxsKT0+KElvPXkuZHluQ2FsbF9paWlpaWlqaj1wby5xYikocixlLHQsbixvLGEsaSxzLHUsbCksVm87ZnVuY3Rpb24gTG8ocixlLHQsbil7dmFyIG89UG8oKTt0cnl7QmUocikoZSx0LG4pfWNhdGNoKHIpe2lmKENvKG8pLHIhPT1yKzApdGhyb3cgcjtFbygxLDApfX1mdW5jdGlvbiBCbyhyLGUsdCl7dmFyIG49UG8oKTt0cnl7cmV0dXJuIEJlKHIpKGUsdCl9Y2F0Y2gocil7aWYoQ28obiksciE9PXIrMCl0aHJvdyByO0VvKDEsMCl9fWZ1bmN0aW9uIFVvKHIsZSx0LG4sbyxhKXt2YXIgaT1QbygpO3RyeXtyZXR1cm4gQmUocikoZSx0LG4sbyxhKX1jYXRjaChyKXtpZihDbyhpKSxyIT09ciswKXRocm93IHI7RW8oMSwwKX19ZnVuY3Rpb24gSG8ocixlKXt2YXIgdD1QbygpO3RyeXtCZShyKShlKX1jYXRjaChyKXtpZihDbyh0KSxyIT09ciswKXRocm93IHI7RW8oMSwwKX19ZnVuY3Rpb24gcW8ocixlKXt2YXIgdD1QbygpO3RyeXtyZXR1cm4gQmUocikoZSl9Y2F0Y2gocil7aWYoQ28odCksciE9PXIrMCl0aHJvdyByO0VvKDEsMCl9fWZ1bmN0aW9uIFlvKHIsZSx0LG4pe3ZhciBvPVBvKCk7dHJ5e3JldHVybiBCZShyKShlLHQsbil9Y2F0Y2gocil7aWYoQ28obyksciE9PXIrMCl0aHJvdyByO0VvKDEsMCl9fWZ1bmN0aW9uIEdvKHIsZSx0KXt2YXIgbj1QbygpO3RyeXtCZShyKShlLHQpfWNhdGNoKHIpe2lmKENvKG4pLHIhPT1yKzApdGhyb3cgcjtFbygxLDApfX1mdW5jdGlvbiBYbyhyLGUsdCxuLG8pe3ZhciBhPVBvKCk7dHJ5e0JlKHIpKGUsdCxuLG8pfWNhdGNoKHIpe2lmKENvKGEpLHIhPT1yKzApdGhyb3cgcjtFbygxLDApfX1mdW5jdGlvbiBLbyhyLGUsdCxuLG8pe3ZhciBhPVBvKCk7dHJ5e3JldHVybiBCZShyKShlLHQsbixvKX1jYXRjaChyKXtpZihDbyhhKSxyIT09ciswKXRocm93IHI7RW8oMSwwKX19ZnVuY3Rpb24gSm8ocixlLHQsbil7dmFyIG89UG8oKTt0cnl7cmV0dXJuIEJlKHIpKGUsdCxuKX1jYXRjaChyKXtpZihDbyhvKSxyIT09ciswKXRocm93IHI7RW8oMSwwKX19ZnVuY3Rpb24gWm8ocixlLHQsbixvLGEsaSl7dmFyIHM9UG8oKTt0cnl7QmUocikoZSx0LG4sbyxhLGkpfWNhdGNoKHIpe2lmKENvKHMpLHIhPT1yKzApdGhyb3cgcjtFbygxLDApfX1mdW5jdGlvbiBRbyhyLGUsdCxuLG8sYSxpLHMsdSxsLGMpe3ZhciBkPVBvKCk7dHJ5e0JlKHIpKGUsdCxuLG8sYSxpLHMsdSxsLGMpfWNhdGNoKHIpe2lmKENvKGQpLHIhPT1yKzApdGhyb3cgcjtFbygxLDApfX1mdW5jdGlvbiByYShyLGUsdCl7dmFyIG49UG8oKTt0cnl7cmV0dXJuIEJlKHIpKGUsdCl9Y2F0Y2gocil7aWYoQ28obiksciE9PXIrMCl0aHJvdyByO0VvKDEsMCl9fWZ1bmN0aW9uIGVhKHIpe3ZhciBlPVBvKCk7dHJ5e0JlKHIpKCl9Y2F0Y2gocil7aWYoQ28oZSksciE9PXIrMCl0aHJvdyByO0VvKDEsMCl9fWZ1bmN0aW9uIHRhKHIsZSx0KXt2YXIgbj1QbygpO3RyeXtyZXR1cm4gQmUocikoZSx0KX1jYXRjaChyKXtpZihDbyhuKSxyIT09ciswKXRocm93IHI7RW8oMSwwKX19ZnVuY3Rpb24gbmEocixlKXt2YXIgdD1QbygpO3RyeXtyZXR1cm4gQmUocikoZSl9Y2F0Y2gocil7aWYoQ28odCksciE9PXIrMCl0aHJvdyByO0VvKDEsMCl9fWZ1bmN0aW9uIG9hKHIsZSx0LG4sbyxhKXt2YXIgaT1QbygpO3RyeXtCZShyKShlLHQsbixvLGEpfWNhdGNoKHIpe2lmKENvKGkpLHIhPT1yKzApdGhyb3cgcjtFbygxLDApfX1mdW5jdGlvbiBhYShyLGUsdCxuLG8pe3ZhciBhPVBvKCk7dHJ5e0JlKHIpKGUsdCxuLG8pfWNhdGNoKHIpe2lmKENvKGEpLHIhPT1yKzApdGhyb3cgcjtFbygxLDApfX1mdW5jdGlvbiBpYShyLGUsdCxuLG8sYSxpLHMsdSl7dmFyIGw9UG8oKTt0cnl7QmUocikoZSx0LG4sbyxhLGkscyx1KX1jYXRjaChyKXtpZihDbyhsKSxyIT09ciswKXRocm93IHI7RW8oMSwwKX19ZnVuY3Rpb24gc2EocixlLHQsbixvLGEpe3ZhciBpPVBvKCk7dHJ5e0JlKHIpKGUsdCxuLG8sYSl9Y2F0Y2gocil7aWYoQ28oaSksciE9PXIrMCl0aHJvdyByO0VvKDEsMCl9fWZ1bmN0aW9uIHVhKHIsZSx0LG4pe3ZhciBvPVBvKCk7dHJ5e0JlKHIpKGUsdCxuKX1jYXRjaChyKXtpZihDbyhvKSxyIT09ciswKXRocm93IHI7RW8oMSwwKX19ZnVuY3Rpb24gbGEocixlLHQsbixvLGEsaSl7dmFyIHM9UG8oKTt0cnl7QmUocikoZSx0LG4sbyxhLGkpfWNhdGNoKHIpe2lmKENvKHMpLHIhPT1yKzApdGhyb3cgcjtFbygxLDApfX1mdW5jdGlvbiBjYShyLGUsdCxuKXt2YXIgbz1QbygpO3RyeXtCZShyKShlLHQsbil9Y2F0Y2gocil7aWYoQ28obyksciE9PXIrMCl0aHJvdyByO0VvKDEsMCl9fWZ1bmN0aW9uIGRhKHIsZSx0LG4sbyxhKXt2YXIgaT1QbygpO3RyeXtyZXR1cm4gQmUocikoZSx0LG4sbyxhKX1jYXRjaChyKXtpZihDbyhpKSxyIT09ciswKXRocm93IHI7RW8oMSwwKX19ZnVuY3Rpb24gZmEocixlLHQsbixvLGEsaSl7dmFyIHM9UG8oKTt0cnl7QmUocikoZSx0LG4sbyxhLGkpfWNhdGNoKHIpe2lmKENvKHMpLHIhPT1yKzApdGhyb3cgcjtFbygxLDApfX1mdW5jdGlvbiBoYShyLGUsdCxuLG8sYSxpKXt2YXIgcz1QbygpO3RyeXtCZShyKShlLHQsbixvLGEsaSl9Y2F0Y2gocil7aWYoQ28ocyksciE9PXIrMCl0aHJvdyByO0VvKDEsMCl9fWZ1bmN0aW9uIHBhKHIsZSx0LG4sbyxhLGkscyx1LGwsYyxkLGYsaCxwLG0sdix5LGcpe3ZhciB3PVBvKCk7dHJ5e0JlKHIpKGUsdCxuLG8sYSxpLHMsdSxsLGMsZCxmLGgscCxtLHYseSxnKX1jYXRjaChyKXtpZihDbyh3KSxyIT09ciswKXRocm93IHI7RW8oMSwwKX19ZnVuY3Rpb24gbWEocixlLHQsbixvLGEsaSxzKXt2YXIgdT1QbygpO3RyeXtCZShyKShlLHQsbixvLGEsaSxzKX1jYXRjaChyKXtpZihDbyh1KSxyIT09ciswKXRocm93IHI7RW8oMSwwKX19ZnVuY3Rpb24gdmEocixlLHQsbixvLGEsaSxzLHUsbCl7dmFyIGM9UG8oKTt0cnl7QmUocikoZSx0LG4sbyxhLGkscyx1LGwpfWNhdGNoKHIpe2lmKENvKGMpLHIhPT1yKzApdGhyb3cgcjtFbygxLDApfX1mdW5jdGlvbiB5YShyKXt2YXIgZT1QbygpO3RyeXtyZXR1cm4gQmUocikoKX1jYXRjaChyKXtpZihDbyhlKSxyIT09ciswKXRocm93IHI7RW8oMSwwKX19ZnVuY3Rpb24gZ2EocixlLHQsbil7dmFyIG89UG8oKTt0cnl7QmUocikoZSx0LG4pfWNhdGNoKHIpe2lmKENvKG8pLHIhPT1yKzApdGhyb3cgcjtFbygxLDApfX1mdW5jdGlvbiB3YShyLGUsdCxuLG8pe3ZhciBhPVBvKCk7dHJ5e0JlKHIpKGUsdCxuLG8pfWNhdGNoKHIpe2lmKENvKGEpLHIhPT1yKzApdGhyb3cgcjtFbygxLDApfX1mdW5jdGlvbiBfYShyLGUsdCxuLG8sYSl7dmFyIGk9UG8oKTt0cnl7QmUocikoZSx0LG4sbyxhKX1jYXRjaChyKXtpZihDbyhpKSxyIT09ciswKXRocm93IHI7RW8oMSwwKX19ZnVuY3Rpb24gYmEocil7dmFyIGU9UG8oKTt0cnl7cmV0dXJuIEJlKHIpKCl9Y2F0Y2gocil7aWYoQ28oZSksciE9PXIrMCl0aHJvdyByO0VvKDEsMCl9fWZ1bmN0aW9uIEVhKHIsZSx0LG4sbyxhLGkpe3ZhciBzPVBvKCk7dHJ5e0JlKHIpKGUsdCxuLG8sYSxpKX1jYXRjaChyKXtpZihDbyhzKSxyIT09ciswKXRocm93IHI7RW8oMSwwKX19ZnVuY3Rpb24ga2EocixlLHQsbil7dmFyIG89UG8oKTt0cnl7cmV0dXJuIEJlKHIpKGUsdCxuKX1jYXRjaChyKXtpZihDbyhvKSxyIT09ciswKXRocm93IHI7RW8oMSwwKX19ZnVuY3Rpb24gUGEocixlLHQsbixvKXt2YXIgYT1QbygpO3RyeXtyZXR1cm4gQmUocikoZSx0LG4sbyl9Y2F0Y2gocil7aWYoQ28oYSksciE9PXIrMCl0aHJvdyByO0VvKDEsMCl9fWZ1bmN0aW9uIENhKHIsZSx0LG4sbyxhLGkpe3ZhciBzPVBvKCk7dHJ5e3JldHVybiBCZShyKShlLHQsbixvLGEsaSl9Y2F0Y2gocil7aWYoQ28ocyksciE9PXIrMCl0aHJvdyByO0VvKDEsMCl9fWZ1bmN0aW9uIFRhKHIsZSx0LG4sbyxhLGkscyl7dmFyIHU9UG8oKTt0cnl7cmV0dXJuIEJlKHIpKGUsdCxuLG8sYSxpLHMpfWNhdGNoKHIpe2lmKENvKHUpLHIhPT1yKzApdGhyb3cgcjtFbygxLDApfX1mdW5jdGlvbiBTYShyLGUsdCxuKXt2YXIgbz1QbygpO3RyeXtyZXR1cm4gQmUocikoZSx0LG4pfWNhdGNoKHIpe2lmKENvKG8pLHIhPT1yKzApdGhyb3cgcjtFbygxLDApfX1mdW5jdGlvbiBNYShyLGUsdCxuLG8sYSxpLHMsdSxsLGMsZCl7dmFyIGY9UG8oKTt0cnl7cmV0dXJuIEJlKHIpKGUsdCxuLG8sYSxpLHMsdSxsLGMsZCl9Y2F0Y2gocil7aWYoQ28oZiksciE9PXIrMCl0aHJvdyByO0VvKDEsMCl9fWZ1bmN0aW9uICRhKHIsZSx0LG4sbyxhLGkscyx1LGwsYyxkLGYsaCxwLG0pe3ZhciB2PVBvKCk7dHJ5e0JlKHIpKGUsdCxuLG8sYSxpLHMsdSxsLGMsZCxmLGgscCxtKX1jYXRjaChyKXtpZihDbyh2KSxyIT09ciswKXRocm93IHI7RW8oMSwwKX19ZnVuY3Rpb24gRmEocixlLHQsbixvLGEpe3ZhciBpPVBvKCk7dHJ5e0ZvKHIsZSx0LG4sbyxhKX1jYXRjaChyKXtpZihDbyhpKSxyIT09ciswKXRocm93IHI7RW8oMSwwKX19ZnVuY3Rpb24gQWEocixlLHQsbixvLGEsaSl7dmFyIHM9UG8oKTt0cnl7QW8ocixlLHQsbixvLGEsaSl9Y2F0Y2gocil7aWYoQ28ocyksciE9PXIrMCl0aHJvdyByO0VvKDEsMCl9fWZ1bmN0aW9uIERhKHIsZSx0LG4sbyxhKXt2YXIgaT1QbygpO3RyeXtEbyhyLGUsdCxuLG8sYSl9Y2F0Y2gocil7aWYoQ28oaSksciE9PXIrMCl0aHJvdyByO0VvKDEsMCl9fWZ1bmN0aW9uIHhhKHIsZSx0LG4sbyxhLGkpe3ZhciBzPVBvKCk7dHJ5e3hvKHIsZSx0LG4sbyxhLGkpfWNhdGNoKHIpe2lmKENvKHMpLHIhPT1yKzApdGhyb3cgcjtFbygxLDApfX1mdW5jdGlvbiBqYShyLGUsdCxuLG8sYSl7dmFyIGk9UG8oKTt0cnl7am8ocixlLHQsbixvLGEpfWNhdGNoKHIpe2lmKENvKGkpLHIhPT1yKzApdGhyb3cgcjtFbygxLDApfX1mdW5jdGlvbiBPYShyLGUsdCxuLG8sYSxpKXt2YXIgcz1QbygpO3RyeXtPbyhyLGUsdCxuLG8sYSxpKX1jYXRjaChyKXtpZihDbyhzKSxyIT09ciswKXRocm93IHI7RW8oMSwwKX19ZnVuY3Rpb24gUmEocixlLHQsbixvKXt2YXIgYT1QbygpO3RyeXtyZXR1cm4gV28ocixlLHQsbixvKX1jYXRjaChyKXtpZihDbyhhKSxyIT09ciswKXRocm93IHI7RW8oMSwwKX19ZnVuY3Rpb24gV2EoKXtmdW5jdGlvbiByKCl7Vm98fChWbz0hMCx5LmNhbGxlZFJ1bj0hMCxUfHwoVSgpLHQoeSkseS5vblJ1bnRpbWVJbml0aWFsaXplZCYmeS5vblJ1bnRpbWVJbml0aWFsaXplZCgpLEgoKSkpfTA8WHx8KEIoKSwwPFh8fCh5LnNldFN0YXR1cz8oeS5zZXRTdGF0dXMoIlJ1bm5pbmcuLi4iKSxzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7c2V0VGltZW91dChmdW5jdGlvbigpe3kuc2V0U3RhdHVzKCIiKX0sMSkscigpfSwxKSk6cigpKSl9aWYoeS5hZGRGdW5jdGlvbj1zbyx5LnJlbW92ZUZ1bmN0aW9uPXVvLEo9ZnVuY3Rpb24gcigpe1ZvfHxXYSgpLFZvfHwoSj1yKX0seS5wcmVJbml0KWZvcigiZnVuY3Rpb24iPT10eXBlb2YgeS5wcmVJbml0JiYoeS5wcmVJbml0PVt5LnByZUluaXRdKTswPHkucHJlSW5pdC5sZW5ndGg7KXkucHJlSW5pdC5wb3AoKSgpO3JldHVybiBXYSgpLHIucmVhZHl9fSkoKTtleHBvcnQgZGVmYXVsdCBNb2R1bGU7";
exports({ ["manifold"]: import(url) });
});!function(t){var e,e;"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):(e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).png=t()}(function(){var t,e,r;return f({1:[function(t,e,r){!function(d){"use strict";let p=t("./interlace"),u=[function(){},function(t,e,r,n){if(n===e.length)throw new Error("Ran out of data");var i=e[n];t[r]=i,t[r+1]=i,t[r+2]=i,t[r+3]=255},function(t,e,r,n){if(n+1>=e.length)throw new Error("Ran out of data");var i=e[n];t[r]=i,t[r+1]=i,t[r+2]=i,t[r+3]=e[n+1]},function(t,e,r,n){if(n+2>=e.length)throw new Error("Ran out of data");t[r]=e[n],t[r+1]=e[n+1],t[r+2]=e[n+2],t[r+3]=255},function(t,e,r,n){if(n+3>=e.length)throw new Error("Ran out of data");t[r]=e[n],t[r+1]=e[n+1],t[r+2]=e[n+2],t[r+3]=e[n+3]}],c=[function(){},function(t,e,r,n){var i=e[0];t[r]=i,t[r+1]=i,t[r+2]=i,t[r+3]=n},function(t,e,r){var n=e[0];t[r]=n,t[r+1]=n,t[r+2]=n,t[r+3]=e[1]},function(t,e,r,n){t[r]=e[0],t[r+1]=e[1],t[r+2]=e[2],t[r+3]=n},function(t,e,r){t[r]=e[0],t[r+1]=e[1],t[r+2]=e[2],t[r+3]=e[3]}];function _(h,f){let u=[],c=0;function r(){if(c===h.length)throw new Error("Ran out of data");var t=h[c];c++;let e,r,n,i,s,a,o,l;switch(f){default:throw new Error("unrecognised depth");case 16:o=h[c],c++,u.push((t<<8)+o);break;case 4:o=15&t,l=t>>4,u.push(l,o);break;case 2:s=3&t,a=t>>2&3,o=t>>4&3,l=t>>6&3,u.push(l,o,a,s);break;case 1:e=1&t,r=t>>1&1,n=t>>2&1,i=t>>3&1,s=t>>4&1,a=t>>5&1,o=t>>6&1,l=t>>7&1,u.push(l,o,a,s,i,n,r,e)}}return{get:function(t){for(;u.length<t;)r();var e=u.slice(0,t);return u=u.slice(t),e},resetAfterLine:function(){u.length=0},end:function(){if(c!==h.length)throw new Error("extra data found")}}}function g(t,r,n,i,s,a){var o=t.width,l=t.height,h=t.index;for(let e=0;e<l;e++)for(let t=0;t<o;t++){var f=n(t,e,h);u[i](r,s,f,a),a+=i}return a}function b(t,r,n,i,s,a){var o=t.width,l=t.height,h=t.index;for(let e=0;e<l;e++){for(let t=0;t<o;t++){var f=s.get(i),u=n(t,e,h);c[i](r,f,u,a)}s.resetAfterLine()}}r.dataToBitMap=function(e,t){var r=t.width,n=t.height,i=t.depth,s=t.bpp,a=t.interlace;let o;8!==i&&(o=_(e,i));let l;l=i<=8?d.alloc(r*n*4):new Uint16Array(r*n*4);var h=Math.pow(2,i)-1;let f=0,u,c;if(a)u=p.getImagePasses(r,n),c=p.getInterlaceIterator(r,n);else{let e=0;c=function(){var t=e;return e+=4,t},u=[{width:r,height:n}]}for(let t=0;t<u.length;t++)8===i?f=g(u[t],l,c,s,e,f):b(u[t],l,c,s,o,h);if(8===i){if(f!==e.length)throw new Error("extra data found")}else o.end();return l}}.call(this,t("buffer").Buffer)},{"./interlace":11,buffer:31}],2:[function(t,e,r){!function(m){"use strict";let y=t("./constants");e.exports=function(t,e,r,i){let s=-1!==[y.COLORTYPE_COLOR_ALPHA,y.COLORTYPE_ALPHA].indexOf(i.colorType);if(i.colorType===i.inputColorType){var n=(a=new ArrayBuffer(2),new DataView(a).setInt16(0,256,!0),256!==new Int16Array(a)[0]);if(8===i.bitDepth||16===i.bitDepth&&n)return t}var a;let o=16!==i.bitDepth?t:new Uint16Array(t.buffer),l=255,h=y.COLORTYPE_TO_BPP_MAP[i.inputColorType];4!==h||i.inputHasAlpha||(h=3);let f=y.COLORTYPE_TO_BPP_MAP[i.colorType];16===i.bitDepth&&(l=65535,f*=2);let u=m.alloc(e*r*f),c=0,d=0,p=i.bgColor||{};function _(){let t,e,r,n=l;switch(i.inputColorType){case y.COLORTYPE_COLOR_ALPHA:n=o[c+3],t=o[c],e=o[c+1],r=o[c+2];break;case y.COLORTYPE_COLOR:t=o[c],e=o[c+1],r=o[c+2];break;case y.COLORTYPE_ALPHA:n=o[c+1],t=o[c],e=t,r=t;break;case y.COLORTYPE_GRAYSCALE:t=o[c],e=t,r=t;break;default:throw new Error("input color type:"+i.inputColorType+" is not supported at present")}return i.inputHasAlpha&&(s||(n/=l,t=Math.min(Math.max(Math.round((1-n)*p.red+n*t),0),l),e=Math.min(Math.max(Math.round((1-n)*p.green+n*e),0),l),r=Math.min(Math.max(Math.round((1-n)*p.blue+n*r),0),l))),{red:t,green:e,blue:r,alpha:n}}void 0===p.red&&(p.red=l),void 0===p.green&&(p.green=l),void 0===p.blue&&(p.blue=l);for(let t=0;t<r;t++)for(let t=0;t<e;t++){var g=_(o,c);switch(i.colorType){case y.COLORTYPE_COLOR_ALPHA:case y.COLORTYPE_COLOR:8===i.bitDepth?(u[d]=g.red,u[d+1]=g.green,u[d+2]=g.blue,s&&(u[d+3]=g.alpha)):(u.writeUInt16BE(g.red,d),u.writeUInt16BE(g.green,d+2),u.writeUInt16BE(g.blue,d+4),s&&u.writeUInt16BE(g.alpha,d+6));break;case y.COLORTYPE_ALPHA:case y.COLORTYPE_GRAYSCALE:var b=(g.red+g.green+g.blue)/3;8===i.bitDepth?(u[d]=b,s&&(u[d+1]=g.alpha)):(u.writeUInt16BE(b,d),s&&u.writeUInt16BE(g.alpha,d+2));break;default:throw new Error("unrecognised color Type "+i.colorType)}c+=h,d+=f}return u}}.call(this,t("buffer").Buffer)},{"./constants":4,buffer:31}],3:[function(i,s,t){!function(r,a){"use strict";let t=i("util"),e=i("stream");var n=s.exports=function(){e.call(this),this._buffers=[],this._buffered=0,this._reads=[],this._paused=!1,this._encoding="utf8",this.writable=!0};t.inherits(n,e),n.prototype.read=function(t,e){this._reads.push({length:Math.abs(t),allowLess:t<0,func:e}),r.nextTick(function(){this._process(),this._paused&&this._reads&&0<this._reads.length&&(this._paused=!1,this.emit("drain"))}.bind(this))},n.prototype.write=function(t,e){if(!this.writable)return this.emit("error",new Error("Stream not writable")),!1;let r;return r=a.isBuffer(t)?t:a.from(t,e||this._encoding),this._buffers.push(r),this._buffered+=r.length,this._process(),this._reads&&0===this._reads.length&&(this._paused=!0),this.writable&&!this._paused},n.prototype.end=function(t,e){t&&this.write(t,e),this.writable=!1,this._buffers&&(0===this._buffers.length?this._end():(this._buffers.push(null),this._process()))},n.prototype.destroySoon=n.prototype.end,n.prototype._end=function(){0<this._reads.length&&this.emit("error",new Error("Unexpected end of input")),this.destroy()},n.prototype.destroy=function(){this._buffers&&(this.writable=!1,this._reads=null,this._buffers=null,this.emit("close"))},n.prototype._processReadAllowingLess=function(t){this._reads.shift();let e=this._buffers[0];e.length>t.length?(this._buffered-=t.length,this._buffers[0]=e.slice(t.length),t.func.call(this,e.slice(0,t.length))):(this._buffered-=e.length,this._buffers.shift(),t.func.call(this,e))},n.prototype._processRead=function(e){this._reads.shift();let r=0,n=0;for(var i=a.alloc(e.length);r<e.length;){let t=this._buffers[n++];var s=Math.min(t.length,e.length-r);t.copy(i,r,0,s),r+=s,s!==t.length&&(this._buffers[--n]=t.slice(s))}0<n&&this._buffers.splice(0,n),this._buffered-=e.length,e.func.call(this,i)},n.prototype._process=function(){try{for(;0<this._buffered&&this._reads&&0<this._reads.length;){var t=this._reads[0];if(t.allowLess)this._processReadAllowingLess(t);else{if(!(this._buffered>=t.length))break;this._processRead(t)}}this._buffers&&!this.writable&&this._end()}catch(t){this.emit("error",t)}}}.call(this,i("_process"),i("buffer").Buffer)},{_process:51,buffer:31,stream:67,util:72}],4:[function(t,e,r){"use strict";e.exports={PNG_SIGNATURE:[137,80,78,71,13,10,26,10],TYPE_IHDR:1229472850,TYPE_IEND:1229278788,TYPE_IDAT:1229209940,TYPE_PLTE:1347179589,TYPE_tRNS:1951551059,TYPE_gAMA:1732332865,COLORTYPE_GRAYSCALE:0,COLORTYPE_PALETTE:1,COLORTYPE_COLOR:2,COLORTYPE_ALPHA:4,COLORTYPE_PALETTE_COLOR:3,COLORTYPE_COLOR_ALPHA:6,COLORTYPE_TO_BPP_MAP:{0:1,2:3,3:1,4:2,6:4},GAMMA_DIVISION:1e5}},{}],5:[function(t,e,r){"use strict";let n=[];!function(){for(let t=0;t<256;t++){let e=t;for(let t=0;t<8;t++)1&e?e=3988292384^e>>>1:e>>>=1;n[t]=e}}();var i=e.exports=function(){this._crc=-1};i.prototype.write=function(e){for(let t=0;t<e.length;t++)this._crc=n[255&(this._crc^e[t])]^this._crc>>>8;return!0},i.prototype.crc32=function(){return-1^this._crc},i.crc32=function(e){let r=-1;for(let t=0;t<e.length;t++)r=n[255&(r^e[t])]^r>>>8;return-1^r}},{}],6:[function(f,_,t){!function(c){"use strict";let u=f("./paeth-predictor");function t(e,r,n,i,s){for(let t=0;t<n;t++)i[s+t]=e[r+t]}function e(e,r,t){let n=0;var i=r+t;for(let t=r;t<i;t++)n+=Math.abs(e[t]);return n}function r(e,r,n,i,s,a){for(let t=0;t<n;t++){var o=t>=a?e[r+t-a]:0,l=e[r+t]-o;i[s+t]=l}}function n(e,r,n,i){let s=0;for(let t=0;t<n;t++){var a=t>=i?e[r+t-i]:0,o=e[r+t]-a;s+=Math.abs(o)}return s}function i(e,r,n,i,s){for(let t=0;t<n;t++){var a=0<r?e[r+t-n]:0,o=e[r+t]-a;i[s+t]=o}}function s(e,r,n){let i=0;var s=r+n;for(let t=r;t<s;t++){var a=0<r?e[t-n]:0,o=e[t]-a;i+=Math.abs(o)}return i}function a(e,r,n,i,s,a){for(let t=0;t<n;t++){var o=t>=a?e[r+t-a]:0,l=0<r?e[r+t-n]:0,h=e[r+t]-(o+l>>1);i[s+t]=h}}function o(e,r,n,i){let s=0;for(let t=0;t<n;t++){var a=t>=i?e[r+t-i]:0,o=0<r?e[r+t-n]:0,l=e[r+t]-(a+o>>1);s+=Math.abs(l)}return s}function l(e,r,n,i,s,a){for(let t=0;t<n;t++){var o=t>=a?e[r+t-a]:0,l=0<r?e[r+t-n]:0,h=0<r&&t>=a?e[r+t-(n+a)]:0,f=e[r+t]-u(o,l,h);i[s+t]=f}}function h(e,r,n,i){let s=0;for(let t=0;t<n;t++){var a=t>=i?e[r+t-i]:0,o=0<r?e[r+t-n]:0,l=0<r&&t>=i?e[r+t-(n+i)]:0,h=e[r+t]-u(a,o,l);s+=Math.abs(h)}return s}let d={0:t,1:r,2:i,3:a,4:l},p={0:e,1:n,2:s,3:o,4:h};_.exports=function(r,t,e,n,i){let s;if("filterType"in n&&-1!==n.filterType){if("number"!=typeof n.filterType)throw new Error("unrecognised filter types");s=[n.filterType]}else s=[0,1,2,3,4];16===n.bitDepth&&(i*=2);var a=t*i;let o=0,l=0,h=c.alloc((1+a)*e),f=s[0];for(let t=0;t<e;t++){if(1<s.length){let e=1/0;for(let t=0;t<s.length;t++){var u=p[s[t]](r,l,a,i);u<e&&(f=s[t],e=u)}}h[o]=f,o++,d[f](r,l,a,h,o,i),o+=a,l+=a}return h}}.call(this,f("buffer").Buffer)},{"./paeth-predictor":15,buffer:31}],7:[function(r,a,t){!function(n){"use strict";let t=r("util"),i=r("./chunkstream"),s=r("./filter-parse");var e=a.exports=function(t){i.call(this);let e=[],r=this;this._filter=new s(t,{read:this.read.bind(this),write:function(t){e.push(t)},complete:function(){r.emit("complete",n.concat(e))}}),this._filter.start()};t.inherits(e,i)}.call(this,r("buffer").Buffer)},{"./chunkstream":3,"./filter-parse":9,buffer:31,util:72}],8:[function(t,e,r){!function(s){"use strict";let a=t("./sync-reader"),o=t("./filter-parse");r.process=function(t,e){let r=[],n=new a(t),i=new o(e,{read:n.read.bind(n),write:function(t){r.push(t)},complete:function(){}});return i.start(),n.process(),s.concat(r)}}.call(this,t("buffer").Buffer)},{"./filter-parse":9,"./sync-reader":22,buffer:31}],9:[function(e,r,t){!function(s){"use strict";let l=e("./interlace"),c=e("./paeth-predictor");function h(t,e,r){let n=t*e;return 8!==r&&(n=Math.ceil(n/(8/r))),n}var t=r.exports=function(t,e){var r=t.width,n=t.height,i=t.interlace,s=t.bpp,a=t.depth;if(this.read=e.read,this.write=e.write,this.complete=e.complete,this._imageIndex=0,this._images=[],i){var o=l.getImagePasses(r,n);for(let t=0;t<o.length;t++)this._images.push({byteWidth:h(o[t].width,s,a),height:o[t].height,lineIndex:0})}else this._images.push({byteWidth:h(r,s,a),height:n,lineIndex:0});this._xComparison=8===a?s:16===a?2*s:1};t.prototype.start=function(){this.read(this._images[this._imageIndex].byteWidth+1,this._reverseFilterLine.bind(this))},t.prototype._unFilterType1=function(e,r,n){var i=this._xComparison,s=i-1;for(let t=0;t<n;t++){var a=e[1+t],o=t>s?r[t-i]:0;r[t]=a+o}},t.prototype._unFilterType2=function(e,r,n){var i=this._lastLine;for(let t=0;t<n;t++){var s=e[1+t],a=i?i[t]:0;r[t]=s+a}},t.prototype._unFilterType3=function(e,r,n){var i=this._xComparison,s=i-1,a=this._lastLine;for(let t=0;t<n;t++){var o=e[1+t],l=a?a[t]:0,h=t>s?r[t-i]:0,f=Math.floor((h+l)/2);r[t]=o+f}},t.prototype._unFilterType4=function(e,r,n){var i=this._xComparison,s=i-1,a=this._lastLine;for(let t=0;t<n;t++){var o=e[1+t],l=a?a[t]:0,h=t>s?r[t-i]:0,f=t>s&&a?a[t-i]:0,u=c(h,l,f);r[t]=o+u}},t.prototype._reverseFilterLine=function(t){var e=t[0];let r,n=this._images[this._imageIndex];var i=n.byteWidth;if(0===e)r=t.slice(1,i+1);else switch(r=s.alloc(i),e){case 1:this._unFilterType1(t,r,i);break;case 2:this._unFilterType2(t,r,i);break;case 3:this._unFilterType3(t,r,i);break;case 4:this._unFilterType4(t,r,i);break;default:throw new Error("Unrecognised filter type - "+e)}this.write(r),n.lineIndex++,n.lineIndex>=n.height?(this._lastLine=null,this._imageIndex++,n=this._images[this._imageIndex]):this._lastLine=r,n?this.read(n.byteWidth+1,this._reverseFilterLine.bind(this)):(this._lastLine=null,this.complete())}}.call(this,e("buffer").Buffer)},{"./interlace":11,"./paeth-predictor":15,buffer:31}],10:[function(t,e,r){!function(h){"use strict";function f(e,r,n,i,s){let a=0;for(let t=0;t<i;t++)for(let t=0;t<n;t++){var o=s[e[a]];if(!o)throw new Error("index "+e[a]+" not in palette");for(let t=0;t<4;t++)r[a+t]=o[t];a+=4}}function u(e,r,n,i,s){let a=0;for(let t=0;t<i;t++)for(let t=0;t<n;t++){let t=!1;if(1===s.length?s[0]===e[a]&&(t=!0):s[0]===e[a]&&s[1]===e[a+1]&&s[2]===e[a+2]&&(t=!0),t)for(let t=0;t<4;t++)r[a+t]=0;a+=4}}function c(e,r,n,i,t){var s=255,a=Math.pow(2,t)-1;let o=0;for(let t=0;t<i;t++)for(let t=0;t<n;t++){for(let t=0;t<4;t++)r[o+t]=Math.floor(e[o+t]*s/a+.5);o+=4}}e.exports=function(t,e){var r=e.depth,n=e.width,i=e.height,s=e.colorType,a=e.transColor,o=e.palette;let l=t;return 3===s?f(t,l,n,i,o):(a&&u(t,l,n,i,a),8!==r&&(16===r&&(l=h.alloc(n*i*4)),c(t,l,n,i,r))),l}}.call(this,t("buffer").Buffer)},{buffer:31}],11:[function(t,e,r){"use strict";let h=[{x:[0],y:[0]},{x:[4],y:[0]},{x:[0,4],y:[4]},{x:[2,6],y:[0,4]},{x:[0,2,4,6],y:[2,6]},{x:[1,3,5,7],y:[0,2,4,6]},{x:[0,1,2,3,4,5,6,7],y:[1,3,5,7]}];r.getImagePasses=function(t,e){let n=[];var i=t%8,s=e%8,a=(t-i)/8,o=(e-s)/8;for(let t=0;t<h.length;t++){var l=h[t];let e=a*l.x.length,r=o*l.y.length;for(let t=0;t<l.x.length&&l.x[t]<i;t++)e++;for(let t=0;t<l.y.length&&l.y[t]<s;t++)r++;0<e&&0<r&&n.push({width:e,height:r,index:t})}return n},r.getInterlaceIterator=function(o){return function(t,e,r){var n=t%h[r].x.length,i=(t-n)/h[r].x.length*8+h[r].x[n],s=e%h[r].y.length,a;return 4*i+((e-s)/h[r].y.length*8+h[r].y[s])*o*4}}},{}],12:[function(i,o,t){!function(s){"use strict";let t=i("util"),r=i("stream"),a=i("./constants"),n=i("./packer");var e=o.exports=function(t){r.call(this);var e=t||{};this._packer=new n(e),this._deflate=this._packer.createDeflate(),this.readable=!0};t.inherits(e,r),e.prototype.pack=function(t,e,r,n){this.emit("data",s.from(a.PNG_SIGNATURE)),this.emit("data",this._packer.packIHDR(e,r)),n&&this.emit("data",this._packer.packGAMA(n));var i=this._packer.filterData(t,e,r);this._deflate.on("error",this.emit.bind(this,"error")),this._deflate.on("data",function(t){this.emit("data",this._packer.packIDAT(t))}.bind(this)),this._deflate.on("end",function(){this.emit("data",this._packer.packIEND()),this.emit("end")}.bind(this)),this._deflate.end(i)}}.call(this,i("buffer").Buffer)},{"./constants":4,"./packer":14,buffer:31,stream:67,util:72}],13:[function(t,e,r){!function(o){"use strict";let l=!0,h=t("zlib");h.deflateSync||(l=!1);let f=t("./constants"),u=t("./packer");e.exports=function(t,e){if(!l)throw new Error("To use the sync capability of this library in old node versions, please pin pngjs to v2.3.0");var r=e||{};let n=new u(r),i=[];i.push(o.from(f.PNG_SIGNATURE)),i.push(n.packIHDR(t.width,t.height)),t.gamma&&i.push(n.packGAMA(t.gamma));var s=n.filterData(t.data,t.width,t.height),a=h.deflateSync(s,n.getDeflateOptions()),s=null;if(!a||!a.length)throw new Error("bad png - invalid compressed data response");return i.push(n.packIDAT(a)),i.push(n.packIEND()),o.concat(i)}}.call(this,t("buffer").Buffer)},{"./constants":4,"./packer":14,buffer:31,zlib:30}],14:[function(r,n,t){!function(i){"use strict";let a=r("./constants"),s=r("./crc"),o=r("./bitpacker"),l=r("./filter-pack"),e=r("zlib");var t=n.exports=function(t){if((this._options=t).deflateChunkSize=t.deflateChunkSize||32768,t.deflateLevel=null!=t.deflateLevel?t.deflateLevel:9,t.deflateStrategy=null!=t.deflateStrategy?t.deflateStrategy:3,t.inputHasAlpha=null==t.inputHasAlpha||t.inputHasAlpha,t.deflateFactory=t.deflateFactory||e.createDeflate,t.bitDepth=t.bitDepth||8,t.colorType="number"==typeof t.colorType?t.colorType:a.COLORTYPE_COLOR_ALPHA,t.inputColorType="number"==typeof t.inputColorType?t.inputColorType:a.COLORTYPE_COLOR_ALPHA,-1===[a.COLORTYPE_GRAYSCALE,a.COLORTYPE_COLOR,a.COLORTYPE_COLOR_ALPHA,a.COLORTYPE_ALPHA].indexOf(t.colorType))throw new Error("option color type:"+t.colorType+" is not supported at present");if(-1===[a.COLORTYPE_GRAYSCALE,a.COLORTYPE_COLOR,a.COLORTYPE_COLOR_ALPHA,a.COLORTYPE_ALPHA].indexOf(t.inputColorType))throw new Error("option input color type:"+t.inputColorType+" is not supported at present");if(8!==t.bitDepth&&16!==t.bitDepth)throw new Error("option bit depth:"+t.bitDepth+" is not supported at present")};t.prototype.getDeflateOptions=function(){return{chunkSize:this._options.deflateChunkSize,level:this._options.deflateLevel,strategy:this._options.deflateStrategy}},t.prototype.createDeflate=function(){return this._options.deflateFactory(this.getDeflateOptions())},t.prototype.filterData=function(t,e,r){var n=o(t,e,r,this._options),i=a.COLORTYPE_TO_BPP_MAP[this._options.colorType],s;return l(n,e,r,this._options,i)},t.prototype._packChunk=function(t,e){var r=e?e.length:0;let n=i.alloc(r+12);return n.writeUInt32BE(r,0),n.writeUInt32BE(t,4),e&&e.copy(n,8),n.writeInt32BE(s.crc32(n.slice(4,n.length-4)),n.length-4),n},t.prototype.packGAMA=function(t){let e=i.alloc(4);return e.writeUInt32BE(Math.floor(t*a.GAMMA_DIVISION),0),this._packChunk(a.TYPE_gAMA,e)},t.prototype.packIHDR=function(t,e){let r=i.alloc(13);return r.writeUInt32BE(t,0),r.writeUInt32BE(e,4),r[8]=this._options.bitDepth,r[9]=this._options.colorType,r[10]=0,r[11]=0,r[12]=0,this._packChunk(a.TYPE_IHDR,r)},t.prototype.packIDAT=function(t){return this._packChunk(a.TYPE_IDAT,t)},t.prototype.packIEND=function(){return this._packChunk(a.TYPE_IEND,null)}}.call(this,r("buffer").Buffer)},{"./bitpacker":2,"./constants":4,"./crc":5,"./filter-pack":6,buffer:31,zlib:30}],15:[function(t,e,r){"use strict";e.exports=function t(e,r,n){var i=e+r-n,s=Math.abs(i-e),a=Math.abs(i-r),o=Math.abs(i-n);return s<=a&&s<=o?e:a<=o?r:n}},{}],16:[function(t,e,r){"use strict";let n=t("util"),o=t("zlib"),i=t("./chunkstream"),s=t("./filter-parse-async"),a=t("./parser"),l=t("./bitmapper"),h=t("./format-normaliser");var f=e.exports=function(t){i.call(this),this._parser=new a(t,{read:this.read.bind(this),error:this._handleError.bind(this),metadata:this._handleMetaData.bind(this),gamma:this.emit.bind(this,"gamma"),palette:this._handlePalette.bind(this),transColor:this._handleTransColor.bind(this),finished:this._finished.bind(this),inflateData:this._inflateData.bind(this),simpleTransparency:this._simpleTransparency.bind(this),headersFinished:this._headersFinished.bind(this)}),this._options=t,this.writable=!0,this._parser.start()};n.inherits(f,i),f.prototype._handleError=function(t){this.emit("error",t),this.writable=!1,this.destroy(),this._inflate&&this._inflate.destroy&&this._inflate.destroy(),this._filter&&(this._filter.destroy(),this._filter.on("error",function(){})),this.errord=!0},f.prototype._inflateData=function(t){if(!this._inflate)if(this._bitmapInfo.interlace)this._inflate=o.createInflate(),this._inflate.on("error",this.emit.bind(this,"error")),this._filter.on("complete",this._complete.bind(this)),this._inflate.pipe(this._filter);else{var i,s=(1+(this._bitmapInfo.width*this._bitmapInfo.bpp*this._bitmapInfo.depth+7>>3))*this._bitmapInfo.height,a=Math.max(s,o.Z_MIN_CHUNK);this._inflate=o.createInflate({chunkSize:a});let e=s,r=this.emit.bind(this,"error");this._inflate.on("error",function(t){e&&r(t)}),this._filter.on("complete",this._complete.bind(this));let n=this._filter.write.bind(this._filter);this._inflate.on("data",function(t){e&&(t.length>e&&(t=t.slice(0,e)),e-=t.length,n(t))}),this._inflate.on("end",this._filter.end.bind(this._filter))}this._inflate.write(t)},f.prototype._handleMetaData=function(t){this._metaData=t,this._bitmapInfo=Object.create(t),this._filter=new s(this._bitmapInfo)},f.prototype._handleTransColor=function(t){this._bitmapInfo.transColor=t},f.prototype._handlePalette=function(t){this._bitmapInfo.palette=t},f.prototype._simpleTransparency=function(){this._metaData.alpha=!0},f.prototype._headersFinished=function(){this.emit("metadata",this._metaData)},f.prototype._finished=function(){this.errord||(this._inflate?this._inflate.end():this.emit("error","No Inflate block"))},f.prototype._complete=function(e){if(!this.errord){let t;try{var r=l.dataToBitMap(e,this._bitmapInfo);t=h(r,this._bitmapInfo),r=null}catch(t){return void this._handleError(t)}this.emit("parsed",t)}}},{"./bitmapper":1,"./chunkstream":3,"./filter-parse-async":7,"./format-normaliser":10,"./parser":18,util:72,zlib:30}],17:[function(t,e,r){!function(E){"use strict";let k=!0,x=t("zlib"),T=t("./sync-inflate");x.deflateSync||(k=!1);let S=t("./sync-reader"),L=t("./filter-parse-sync"),A=t("./parser"),O=t("./bitmapper"),R=t("./format-normaliser");e.exports=function(t,e){if(!k)throw new Error("To use the sync capability of this library in old node versions, please pin pngjs to v2.3.0");let r;function n(t){r=t}let i;function s(t){i=t}function a(t){i.transColor=t}function o(t){i.palette=t}function l(){i.alpha=!0}let h;function f(t){h=t}let u=[];function c(t){u.push(t)}let d=new S(t),p=new A(e,{read:d.read.bind(d),error:n,metadata:s,gamma:f,palette:o,transColor:a,inflateData:c,simpleTransparency:l});if(p.start(),d.process(),r)throw r;let _=E.concat(u);u.length=0;let g;var b,m;if(g=i.interlace?x.inflateSync(_):(m=(1+(i.width*i.bpp*i.depth+7>>3))*i.height,T(_,{chunkSize:m,maxLength:m})),_=null,!g||!g.length)throw new Error("bad png - invalid inflate data response");var y=L.process(g,i);_=null;var w=O.dataToBitMap(y,i),y=null,v=R(w,i);return i.data=v,i.gamma=h||0,i}}.call(this,t("buffer").Buffer)},{"./bitmapper":1,"./filter-parse-sync":8,"./format-normaliser":10,"./parser":18,"./sync-inflate":21,"./sync-reader":22,buffer:31,zlib:30}],18:[function(e,r,t){!function(s){"use strict";let h=e("./constants"),a=e("./crc");var t=r.exports=function(t,e){(this._options=t).checkCRC=!1!==t.checkCRC,this._hasIHDR=!1,this._hasIEND=!1,this._emittedHeadersFinished=!1,this._palette=[],this._colorType=0,this._chunks={},this._chunks[h.TYPE_IHDR]=this._handleIHDR.bind(this),this._chunks[h.TYPE_IEND]=this._handleIEND.bind(this),this._chunks[h.TYPE_IDAT]=this._handleIDAT.bind(this),this._chunks[h.TYPE_PLTE]=this._handlePLTE.bind(this),this._chunks[h.TYPE_tRNS]=this._handleTRNS.bind(this),this._chunks[h.TYPE_gAMA]=this._handleGAMA.bind(this),this.read=e.read,this.error=e.error,this.metadata=e.metadata,this.gamma=e.gamma,this.transColor=e.transColor,this.palette=e.palette,this.parsed=e.parsed,this.inflateData=e.inflateData,this.finished=e.finished,this.simpleTransparency=e.simpleTransparency,this.headersFinished=e.headersFinished||function(){}};t.prototype.start=function(){this.read(h.PNG_SIGNATURE.length,this._parseSignature.bind(this))},t.prototype._parseSignature=function(e){var r=h.PNG_SIGNATURE;for(let t=0;t<r.length;t++)if(e[t]!==r[t])return void this.error(new Error("Invalid file signature"));this.read(8,this._parseChunkBegin.bind(this))},t.prototype._parseChunkBegin=function(e){var t=e.readUInt32BE(0),r=e.readUInt32BE(4);let n="";for(let t=4;t<8;t++)n+=String.fromCharCode(e[t]);var i=Boolean(32&e[4]);if(this._hasIHDR||r===h.TYPE_IHDR){if(this._crc=new a,this._crc.write(s.from(n)),this._chunks[r])return this._chunks[r](t);i?this.read(t+4,this._skipChunk.bind(this)):this.error(new Error("Unsupported critical chunk type "+n))}else this.error(new Error("Expected IHDR on beggining"))},t.prototype._skipChunk=function(){this.read(8,this._parseChunkBegin.bind(this))},t.prototype._handleChunkEnd=function(){this.read(4,this._parseChunkEnd.bind(this))},t.prototype._parseChunkEnd=function(t){var e=t.readInt32BE(0),r=this._crc.crc32();this._options.checkCRC&&r!==e?this.error(new Error("Crc error - "+e+" - "+r)):this._hasIEND||this.read(8,this._parseChunkBegin.bind(this))},t.prototype._handleIHDR=function(t){this.read(t,this._parseIHDR.bind(this))},t.prototype._parseIHDR=function(t){this._crc.write(t);var e=t.readUInt32BE(0),r=t.readUInt32BE(4),n=t[8],i=t[9],s=t[10],a=t[11],o=t[12],l;8===n||4===n||2===n||1===n||16===n?i in h.COLORTYPE_TO_BPP_MAP?0===s?0===a?0===o||1===o?(this._colorType=i,l=h.COLORTYPE_TO_BPP_MAP[this._colorType],this._hasIHDR=!0,this.metadata({width:e,height:r,depth:n,interlace:Boolean(o),palette:Boolean(i&h.COLORTYPE_PALETTE),color:Boolean(i&h.COLORTYPE_COLOR),alpha:Boolean(i&h.COLORTYPE_ALPHA),bpp:l,colorType:i}),this._handleChunkEnd()):this.error(new Error("Unsupported interlace method")):this.error(new Error("Unsupported filter method")):this.error(new Error("Unsupported compression method")):this.error(new Error("Unsupported color type")):this.error(new Error("Unsupported bit depth "+n))},t.prototype._handlePLTE=function(t){this.read(t,this._parsePLTE.bind(this))},t.prototype._parsePLTE=function(e){this._crc.write(e);var r=Math.floor(e.length/3);for(let t=0;t<r;t++)this._palette.push([e[3*t],e[3*t+1],e[3*t+2],255]);this.palette(this._palette),this._handleChunkEnd()},t.prototype._handleTRNS=function(t){this.simpleTransparency(),this.read(t,this._parseTRNS.bind(this))},t.prototype._parseTRNS=function(e){if(this._crc.write(e),this._colorType===h.COLORTYPE_PALETTE_COLOR){if(0===this._palette.length)return void this.error(new Error("Transparency chunk must be after palette"));if(e.length>this._palette.length)return void this.error(new Error("More transparent colors than palette size"));for(let t=0;t<e.length;t++)this._palette[t][3]=e[t];this.palette(this._palette)}this._colorType===h.COLORTYPE_GRAYSCALE&&this.transColor([e.readUInt16BE(0)]),this._colorType===h.COLORTYPE_COLOR&&this.transColor([e.readUInt16BE(0),e.readUInt16BE(2),e.readUInt16BE(4)]),this._handleChunkEnd()},t.prototype._handleGAMA=function(t){this.read(t,this._parseGAMA.bind(this))},t.prototype._parseGAMA=function(t){this._crc.write(t),this.gamma(t.readUInt32BE(0)/h.GAMMA_DIVISION),this._handleChunkEnd()},t.prototype._handleIDAT=function(t){this._emittedHeadersFinished||(this._emittedHeadersFinished=!0,this.headersFinished()),this.read(-t,this._parseIDAT.bind(this,t))},t.prototype._parseIDAT=function(t,e){if(this._crc.write(e),this._colorType===h.COLORTYPE_PALETTE_COLOR&&0===this._palette.length)throw new Error("Expected palette not found");this.inflateData(e);var r=t-e.length;0<r?this._handleIDAT(r):this._handleChunkEnd()},t.prototype._handleIEND=function(t){this.read(t,this._parseIEND.bind(this))},t.prototype._parseIEND=function(t){this._crc.write(t),this._hasIEND=!0,this._handleChunkEnd(),this.finished&&this.finished()}}.call(this,e("buffer").Buffer)},{"./constants":4,"./crc":5,buffer:31}],19:[function(t,e,r){"use strict";let n=t("./parser-sync"),i=t("./packer-sync");r.read=function(t,e){return n(t,e||{})},r.write=function(t,e){return i(t,e)}},{"./packer-sync":13,"./parser-sync":17}],20:[function(l,t,h){!function(t,e){"use strict";let r=l("util"),n=l("stream"),i=l("./parser-async"),s=l("./packer-async");var a=l("./png-sync");let o=h.PNG=function(t){n.call(this),this.width=0|(t=t||{}).width,this.height=0|t.height,this.data=0<this.width&&0<this.height?e.alloc(4*this.width*this.height):null,t.fill&&this.data&&this.data.fill(0),this.gamma=0,this.readable=this.writable=!0,this._parser=new i(t),this._parser.on("error",this.emit.bind(this,"error")),this._parser.on("close",this._handleClose.bind(this)),this._parser.on("metadata",this._metadata.bind(this)),this._parser.on("gamma",this._gamma.bind(this)),this._parser.on("parsed",function(t){this.data=t,this.emit("parsed",t)}.bind(this)),this._packer=new s(t),this._packer.on("data",this.emit.bind(this,"data")),this._packer.on("end",this.emit.bind(this,"end")),this._parser.on("close",this._handleClose.bind(this)),this._packer.on("error",this.emit.bind(this,"error"))};r.inherits(o,n),o.sync=a,o.prototype.pack=function(){return this.data&&this.data.length?t.nextTick(function(){this._packer.pack(this.data,this.width,this.height,this.gamma)}.bind(this)):this.emit("error","No data provided"),this},o.prototype.parse=function(t,n){if(n){let e,r;e=function(t){this.removeListener("error",r),this.data=t,n(null,this)}.bind(this),r=function(t){this.removeListener("parsed",e),n(t,null)}.bind(this),this.once("parsed",e),this.once("error",r)}return this.end(t),this},o.prototype.write=function(t){return this._parser.write(t),!0},o.prototype.end=function(t){this._parser.end(t)},o.prototype._metadata=function(t){this.width=t.width,this.height=t.height,this.emit("metadata",t)},o.prototype._gamma=function(t){this.gamma=t},o.prototype._handleClose=function(){this._parser.writable||this._packer.readable||this.emit("close")},o.bitblt=function(e,r,n,i,s,a,o,l){if(i|=0,s|=0,a|=0,o|=0,l|=0,(n|=0)>e.width||i>e.height||n+s>e.width||i+a>e.height)throw new Error("bitblt reading outside image");if(o>r.width||l>r.height||o+s>r.width||l+a>r.height)throw new Error("bitblt writing outside image");for(let t=0;t<a;t++)e.data.copy(r.data,(l+t)*r.width+o<<2,(i+t)*e.width+n<<2,(i+t)*e.width+n+s<<2)},o.prototype.bitblt=function(t,e,r,n,i,s,a){return o.bitblt(this,t,e,r,n,i,s,a),this},o.adjustGamma=function(r){if(r.gamma){for(let e=0;e<r.height;e++)for(let t=0;t<r.width;t++){var n=r.width*e+t<<2;for(let t=0;t<3;t++){var i=r.data[n+t]/255,i=Math.pow(i,1/2.2/r.gamma);r.data[n+t]=Math.round(255*i)}}r.gamma=0}},o.prototype.adjustGamma=function(){o.adjustGamma(this)}}.call(this,l("_process"),l("buffer").Buffer)},{"./packer-async":12,"./parser-async":16,"./png-sync":19,_process:51,buffer:31,stream:67,util:72}],21:[function(a,o,l){!function(r,p){"use strict";let _=a("assert").ok,g=a("zlib"),t=a("util"),b=a("buffer").kMaxLength;function n(t){if(!(this instanceof n))return new n(t);t&&t.chunkSize<g.Z_MIN_CHUNK&&(t.chunkSize=g.Z_MIN_CHUNK),g.Inflate.call(this,t),this._offset=void 0===this._offset?this._outOffset:this._offset,this._buffer=this._buffer||this._outBuffer,t&&null!=t.maxLength&&(this._maxLength=t.maxLength)}function e(t){return new n(t)}function m(t,e){e&&r.nextTick(e),t._handle&&(t._handle.close(),t._handle=null)}function i(t,e){if(!((e="string"==typeof e?p.from(e):e)instanceof p))throw new TypeError("Not a string or buffer");let r=t._finishFlushFlag;return null==r&&(r=g.Z_FINISH),t._processChunk(e,r)}function s(t,e){return i(new n(e),t)}n.prototype._processChunk=function(t,e,r){if("function"==typeof r)return g.Inflate._processChunk.call(this,t,e,r);let n=this,i=t&&t.length,s=this._chunkSize-this._offset,a=this._maxLength,o=0,l=[],h=0,f;function u(t,e){if(!n._hadError){var r=s-e;if(_(0<=r,"have should not go down"),0<r){let t=n._buffer.slice(n._offset,n._offset+r);if(n._offset+=r,t.length>a&&(t=t.slice(0,a)),l.push(t),h+=t.length,a-=t.length,0===a)return}return(0===e||n._offset>=n._chunkSize)&&(s=n._chunkSize,n._offset=0,n._buffer=p.allocUnsafe(n._chunkSize)),0===e&&(o+=i-t,i=t,1)}}var c;for(this.on("error",function(t){f=t}),_(this._handle,"zlib binding closed");c=(c=this._handle.writeSync(e,t,o,i,this._buffer,this._offset,s))||this._writeState,!this._hadError&&u(c[0],c[1]););if(this._hadError)throw f;if(h>=b)throw m(this),new RangeError("Cannot create final Buffer. It would be larger than 0x"+b.toString(16)+" bytes");var d=p.concat(l,h);return m(this),d},t.inherits(n,g.Inflate),o.exports=l=s,l.Inflate=n,l.createInflate=e,l.inflateSync=s}.call(this,a("_process"),a("buffer").Buffer)},{_process:51,assert:23,buffer:31,util:72,zlib:30}],22:[function(t,e,r){"use strict";var n=e.exports=function(t){this._buffer=t,this._reads=[]};n.prototype.read=function(t,e){this._reads.push({length:Math.abs(t),allowLess:t<0,func:e})},n.prototype.process=function(){for(;0<this._reads.length&&this._buffer.length;){let e=this._reads[0];if(!this._buffer.length||!(this._buffer.length>=e.length||e.allowLess))break;{this._reads.shift();let t=this._buffer;this._buffer=t.slice(e.length),e.func.call(this,t.slice(0,e.length))}}return 0<this._reads.length?new Error("There are some read requests waitng on finished stream"):0<this._buffer.length?new Error("unrecognised content at end of stream"):void 0}},{}],23:[function(L,A,t){!function(e){"use strict";var t=L("object-assign");function s(t,e){if(t===e)return 0;for(var r=t.length,n=e.length,i=0,s=Math.min(r,n);i<s;++i)if(t[i]!==e[i]){r=t[i],n=e[i];break}return r<n?-1:n<r?1:0}function a(t){return e.Buffer&&"function"==typeof e.Buffer.isBuffer?e.Buffer.isBuffer(t):!(null==t||!t._isBuffer)}var f=L("util/"),n=Object.prototype.hasOwnProperty,u=Array.prototype.slice,i="foo"===function t(){}.name;function o(t){return Object.prototype.toString.call(t)}function l(t){return!a(t)&&("function"==typeof e.ArrayBuffer&&("function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(t):t&&(t instanceof DataView||!!(t.buffer&&t.buffer instanceof ArrayBuffer))))}var h=A.exports=b,c=/\s*function\s+([^\(\s]*)\s*/;function d(t){if(f.isFunction(t)){if(i)return t.name;var e,r=t.toString().match(c);return r&&r[1]}}function r(t,e){return"string"!=typeof t||t.length<e?t:t.slice(0,e)}function p(t){if(i||!f.isFunction(t))return f.inspect(t);var e=d(t),r;return"[Function"+(e?": "+e:"")+"]"}function _(t){return r(p(t.actual),128)+" "+t.operator+" "+r(p(t.expected),128)}function g(t,e,r,n,i){throw new h.AssertionError({message:r,actual:t,expected:e,operator:n,stackStartFunction:i})}function b(t,e){t||g(t,!0,e,"==",h.ok)}function m(t,e,r,n){if(t===e)return!0;if(a(t)&&a(e))return 0===s(t,e);if(f.isDate(t)&&f.isDate(e))return t.getTime()===e.getTime();if(f.isRegExp(t)&&f.isRegExp(e))return t.source===e.source&&t.global===e.global&&t.multiline===e.multiline&&t.lastIndex===e.lastIndex&&t.ignoreCase===e.ignoreCase;if(null!==t&&"object"==typeof t||null!==e&&"object"==typeof e){if(l(t)&&l(e)&&o(t)===o(e)&&!(t instanceof Float32Array||t instanceof Float64Array))return 0===s(new Uint8Array(t.buffer),new Uint8Array(e.buffer));if(a(t)!==a(e))return!1;var i=(n=n||{actual:[],expected:[]}).actual.indexOf(t);return-1!==i&&i===n.expected.indexOf(e)||(n.actual.push(t),n.expected.push(e),w(t,e,r,n))}return r?t===e:t==e}function y(t){return"[object Arguments]"==Object.prototype.toString.call(t)}function w(t,e,r,n){if(null==t||null==e)return!1;if(f.isPrimitive(t)||f.isPrimitive(e))return t===e;if(r&&Object.getPrototypeOf(t)!==Object.getPrototypeOf(e))return!1;var i=y(t),s=y(e);if(i&&!s||!i&&s)return!1;if(i)return m(t=u.call(t),e=u.call(e),r);var a=S(t),o=S(e),l,h;if(a.length!==o.length)return!1;for(a.sort(),o.sort(),h=a.length-1;0<=h;h--)if(a[h]!==o[h])return!1;for(h=a.length-1;0<=h;h--)if(!m(t[l=a[h]],e[l],r,n))return!1;return!0}function v(t,e,r){m(t,e,!0)&&g(t,e,r,"notDeepStrictEqual",v)}function E(t,e){if(t&&e){if("[object RegExp]"==Object.prototype.toString.call(e))return e.test(t);try{if(t instanceof e)return 1}catch(t){}return Error.isPrototypeOf(e)?void 0:!0===e.call({},t)}}function k(t){var e;try{t()}catch(t){e=t}return e}function x(t,e,r,n){var i;if("function"!=typeof e)throw new TypeError('"block" argument must be a function');"string"==typeof r&&(n=r,r=null),i=k(e),n=(r&&r.name?" ("+r.name+").":".")+(n?" "+n:"."),t&&!i&&g(i,r,"Missing expected exception"+n);var s="string"==typeof n,a,o=!t&&i&&!r;if((!t&&f.isError(i)&&s&&E(i,r)||o)&&g(i,r,"Got unwanted exception"+n),t&&i&&r&&!E(i,r)||!t&&i)throw i}function T(t,e){t||g(t,!0,e,"==",T)}h.AssertionError=function t(e){this.name="AssertionError",this.actual=e.actual,this.expected=e.expected,this.operator=e.operator,e.message?(this.message=e.message,this.generatedMessage=!1):(this.message=_(this),this.generatedMessage=!0);var r=e.stackStartFunction||g,n,i,s,a,o,i;Error.captureStackTrace?Error.captureStackTrace(this,r):(n=new Error).stack&&(i=n.stack,s=d(r),0<=(a=i.indexOf("\n"+s))&&(o=i.indexOf("\n",a+1),i=i.substring(o+1)),this.stack=i)},f.inherits(h.AssertionError,Error),h.fail=g,h.ok=b,h.equal=function t(e,r,n){e!=r&&g(e,r,n,"==",h.equal)},h.notEqual=function t(e,r,n){e==r&&g(e,r,n,"!=",h.notEqual)},h.deepEqual=function t(e,r,n){m(e,r,!1)||g(e,r,n,"deepEqual",h.deepEqual)},h.deepStrictEqual=function t(e,r,n){m(e,r,!0)||g(e,r,n,"deepStrictEqual",h.deepStrictEqual)},h.notDeepEqual=function t(e,r,n){m(e,r,!1)&&g(e,r,n,"notDeepEqual",h.notDeepEqual)},h.notDeepStrictEqual=v,h.strictEqual=function t(e,r,n){e!==r&&g(e,r,n,"===",h.strictEqual)},h.notStrictEqual=function t(e,r,n){e===r&&g(e,r,n,"!==",h.notStrictEqual)},h.throws=function(t,e,r){x(!0,t,e,r)},h.doesNotThrow=function(t,e,r){x(!1,t,e,r)},h.ifError=function(t){if(t)throw t},h.strict=t(T,h,{equal:h.strictEqual,deepEqual:h.deepStrictEqual,notEqual:h.notStrictEqual,notDeepEqual:h.notDeepStrictEqual}),h.strict.strict=h.strict;var S=Object.keys||function(t){var e=[],r;for(r in t)n.call(t,r)&&e.push(r);return e}}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"object-assign":38,"util/":26}],24:[function(t,e,r){"function"==typeof Object.create?e.exports=function t(e,r){e.super_=r,e.prototype=Object.create(r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function t(e,r){e.super_=r;var n=function(){};n.prototype=r.prototype,e.prototype=new n,e.prototype.constructor=e}},{}],25:[function(t,e,r){e.exports=function t(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},{}],26:[function(M,t,N){!function(i,s){var o=/%[sdj%]/g;N.format=function(t){if(!v(t)){for(var e=[],r=0;r<arguments.length;r++)e.push(l(arguments[r]));return e.join(" ")}for(var r=1,n=arguments,i=n.length,s=String(t).replace(o,function(t){if("%%"===t)return"%";if(i<=r)return t;switch(t){case"%s":return String(n[r++]);case"%d":return Number(n[r++]);case"%j":try{return JSON.stringify(n[r++])}catch(t){return"[Circular]"}default:return t}}),a=n[r];r<i;a=n[++r])u(a)||!x(a)?s+=" "+a:s+=" "+l(a);return s},N.deprecate=function(t,e){if(E(s.process))return function(){return N.deprecate(t,e).apply(this,arguments)};if(!0===i.noDeprecation)return t;var r=!1;function n(){if(!r){if(i.throwDeprecation)throw new Error(e);i.traceDeprecation?console.trace(e):console.error(e),r=!0}return t.apply(this,arguments)}return n};var t={},n;function l(t,e){var r={seen:[],stylize:h};return 3<=arguments.length&&(r.depth=arguments[2]),4<=arguments.length&&(r.colors=arguments[3]),f(e)?r.showHidden=e:e&&N._extend(r,e),E(r.showHidden)&&(r.showHidden=!1),E(r.depth)&&(r.depth=2),E(r.colors)&&(r.colors=!1),E(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=a),p(r,t,r.depth)}function a(t,e){var r=l.styles[e];return r?"["+l.colors[r][0]+"m"+t+"["+l.colors[r][1]+"m":t}function h(t,e){return t}function d(t){var r={};return t.forEach(function(t,e){r[t]=!0}),r}function p(e,r,n){if(e.customInspect&&r&&L(r.inspect)&&r.inspect!==N.inspect&&(!r.constructor||r.constructor.prototype!==r)){var t=r.inspect(n,e);return t=!v(t)?p(e,t,n):t}var i=_(e,r);if(i)return i;var s=Object.keys(r),a=d(s);if(e.showHidden&&(s=Object.getOwnPropertyNames(r)),S(r)&&(0<=s.indexOf("message")||0<=s.indexOf("description")))return g(r);if(0===s.length){if(L(r)){var o=r.name?": "+r.name:"";return e.stylize("[Function"+o+"]","special")}if(k(r))return e.stylize(RegExp.prototype.toString.call(r),"regexp");if(T(r))return e.stylize(Date.prototype.toString.call(r),"date");if(S(r))return g(r)}var l="",h=!1,f=["{","}"],u,l,c;return w(r)&&(h=!0,f=["[","]"]),L(r)&&(l=" [Function"+(r.name?": "+r.name:"")+"]"),k(r)&&(l=" "+RegExp.prototype.toString.call(r)),T(r)&&(l=" "+Date.prototype.toUTCString.call(r)),S(r)&&(l=" "+g(r)),0!==s.length||h&&0!=r.length?n<0?k(r)?e.stylize(RegExp.prototype.toString.call(r),"regexp"):e.stylize("[Object]","special"):(e.seen.push(r),c=h?b(e,r,n,a,s):s.map(function(t){return m(e,r,n,a,t,h)}),e.seen.pop(),y(c,l,f)):f[0]+l+f[1]}function _(t,e){if(E(e))return t.stylize("undefined","undefined");if(v(e)){var r="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(r,"string")}return c(e)?t.stylize(""+e,"number"):f(e)?t.stylize(""+e,"boolean"):u(e)?t.stylize("null","null"):void 0}function g(t){return"["+Error.prototype.toString.call(t)+"]"}function b(e,r,n,i,t){for(var s=[],a=0,o=r.length;a<o;++a)B(r,String(a))?s.push(m(e,r,n,i,String(a),!0)):s.push("");return t.forEach(function(t){t.match(/^\d+$/)||s.push(m(e,r,n,i,t,!0))}),s}function m(t,e,r,n,i,s){var a,o,l,l=Object.getOwnPropertyDescriptor(e,i)||{value:e[i]};if(l.get?o=l.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):l.set&&(o=t.stylize("[Setter]","special")),B(n,i)||(a="["+i+"]"),o||(t.seen.indexOf(l.value)<0?-1<(o=u(r)?p(t,l.value,null):p(t,l.value,r-1)).indexOf("\n")&&(o=s?o.split("\n").map(function(t){return"  "+t}).join("\n").substr(2):"\n"+o.split("\n").map(function(t){return"   "+t}).join("\n")):o=t.stylize("[Circular]","special")),E(a)){if(s&&i.match(/^\d+$/))return o;a=(a=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),t.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),t.stylize(a,"string"))}return a+": "+o}function y(t,e,r){var n=0,i;return 60<t.reduce(function(t,e){return n++,0<=e.indexOf("\n")&&n++,t+e.replace(/\u001b\[\d\d?m/g,"").length+1},0)?r[0]+(""===e?"":e+"\n ")+" "+t.join(",\n  ")+" "+r[1]:r[0]+e+" "+t.join(", ")+" "+r[1]}function w(t){return Array.isArray(t)}function f(t){return"boolean"==typeof t}function u(t){return null===t}function e(t){return null==t}function c(t){return"number"==typeof t}function v(t){return"string"==typeof t}function r(t){return"symbol"==typeof t}function E(t){return void 0===t}function k(t){return x(t)&&"[object RegExp]"===O(t)}function x(t){return"object"==typeof t&&null!==t}function T(t){return x(t)&&"[object Date]"===O(t)}function S(t){return x(t)&&("[object Error]"===O(t)||t instanceof Error)}function L(t){return"function"==typeof t}function A(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t}function O(t){return Object.prototype.toString.call(t)}function R(t){return t<10?"0"+t.toString(10):t.toString(10)}N.debuglog=function(e){var r;return E(n)&&(n=i.env.NODE_DEBUG||""),e=e.toUpperCase(),t[e]||(new RegExp("\\b"+e+"\\b","i").test(n)?(r=i.pid,t[e]=function(){var t=N.format.apply(N,arguments);console.error("%s %d: %s",e,r,t)}):t[e]=function(){}),t[e]},(N.inspect=l).colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},l.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},N.isArray=w,N.isBoolean=f,N.isNull=u,N.isNullOrUndefined=e,N.isNumber=c,N.isString=v,N.isSymbol=r,N.isUndefined=E,N.isRegExp=k,N.isObject=x,N.isDate=T,N.isError=S,N.isFunction=L,N.isPrimitive=A,N.isBuffer=M("./support/isBuffer");var I=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function C(){var t=new Date,e=[R(t.getHours()),R(t.getMinutes()),R(t.getSeconds())].join(":");return[t.getDate(),I[t.getMonth()],e].join(" ")}function B(t,e){return Object.prototype.hasOwnProperty.call(t,e)}N.log=function(){console.log("%s - %s",C(),N.format.apply(N,arguments))},N.inherits=M("inherits"),N._extend=function(t,e){if(!e||!x(e))return t;for(var r=Object.keys(e),n=r.length;n--;)t[r[n]]=e[r[n]];return t}}.call(this,M("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":25,_process:51,inherits:24}],27:[function(t,e,r){"use strict";r.byteLength=a,r.toByteArray=o,r.fromByteArray=_;for(var l=[],h=[],f="undefined"!=typeof Uint8Array?Uint8Array:Array,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0,s=n.length;i<s;++i)l[i]=n[i],h[n.charCodeAt(i)]=i;function u(t){var e=t.length;if(0<e%4)throw new Error("Invalid string. Length must be a multiple of 4");var r=t.indexOf("="),n;return[r=-1===r?e:r,r===e?0:4-r%4]}function a(t){var e=u(t),r=e[0],n=e[1];return 3*(r+n)/4-n}function c(t,e,r){return 3*(e+r)/4-r}function o(t){for(var e,r=u(t),n=r[0],i=r[1],s=new f(c(t,n,i)),a=0,o=0<i?n-4:n,l,l=0;l<o;l+=4)e=h[t.charCodeAt(l)]<<18|h[t.charCodeAt(l+1)]<<12|h[t.charCodeAt(l+2)]<<6|h[t.charCodeAt(l+3)],s[a++]=e>>16&255,s[a++]=e>>8&255,s[a++]=255&e;return 2===i&&(e=h[t.charCodeAt(l)]<<2|h[t.charCodeAt(l+1)]>>4,s[a++]=255&e),1===i&&(e=h[t.charCodeAt(l)]<<10|h[t.charCodeAt(l+1)]<<4|h[t.charCodeAt(l+2)]>>2,s[a++]=e>>8&255,s[a++]=255&e),s}function d(t){return l[t>>18&63]+l[t>>12&63]+l[t>>6&63]+l[63&t]}function p(t,e,r){for(var n,i=[],s=e;s<r;s+=3)n=(t[s]<<16&16711680)+(t[s+1]<<8&65280)+(255&t[s+2]),i.push(d(n));return i.join("")}function _(t){for(var e,r=t.length,n=r%3,i=[],s=16383,a=0,o=r-n;a<o;a+=s)i.push(p(t,a,o<a+s?o:a+s));return 1==n?(e=t[r-1],i.push(l[e>>2]+l[e<<4&63]+"==")):2==n&&(e=(t[r-2]<<8)+t[r-1],i.push(l[e>>10]+l[e>>4&63]+l[e<<2&63]+"=")),i.join("")}h["-".charCodeAt(0)]=62,h["_".charCodeAt(0)]=63},{}],28:[function(t,e,r){},{}],29:[function(l,t,c){!function(h,f){"use strict";var u=l("assert"),s=l("pako/lib/zlib/zstream"),a=l("pako/lib/zlib/deflate.js"),o=l("pako/lib/zlib/inflate.js"),t=l("pako/lib/zlib/constants"),e;for(e in t)c[e]=t[e];c.NONE=0,c.DEFLATE=1,c.INFLATE=2,c.GZIP=3,c.GUNZIP=4,c.DEFLATERAW=5,c.INFLATERAW=6,c.UNZIP=7;var r=31,n=139;function i(t){if("number"!=typeof t||t<c.DEFLATE||t>c.UNZIP)throw new TypeError("Bad argument");this.dictionary=null,this.err=0,this.flush=0,this.init_done=!1,this.level=0,this.memLevel=0,this.mode=t,this.strategy=0,this.windowBits=0,this.write_in_progress=!1,this.pending_close=!1,this.gzip_id_bytes_read=0}i.prototype.close=function(){this.write_in_progress?this.pending_close=!0:(this.pending_close=!1,u(this.init_done,"close before init"),u(this.mode<=c.UNZIP),this.mode===c.DEFLATE||this.mode===c.GZIP||this.mode===c.DEFLATERAW?a.deflateEnd(this.strm):this.mode!==c.INFLATE&&this.mode!==c.GUNZIP&&this.mode!==c.INFLATERAW&&this.mode!==c.UNZIP||o.inflateEnd(this.strm),this.mode=c.NONE,this.dictionary=null)},i.prototype.write=function(t,e,r,n,i,s,a){return this._write(!0,t,e,r,n,i,s,a)},i.prototype.writeSync=function(t,e,r,n,i,s,a){return this._write(!1,t,e,r,n,i,s,a)},i.prototype._write=function(t,e,r,n,i,s,a,o){if(u.equal(arguments.length,8),u(this.init_done,"write before init"),u(this.mode!==c.NONE,"already finalized"),u.equal(!1,this.write_in_progress,"write already in progress"),u.equal(!1,this.pending_close,"close is pending"),this.write_in_progress=!0,u.equal(!1,void 0===e,"must provide flush value"),this.write_in_progress=!0,e!==c.Z_NO_FLUSH&&e!==c.Z_PARTIAL_FLUSH&&e!==c.Z_SYNC_FLUSH&&e!==c.Z_FULL_FLUSH&&e!==c.Z_FINISH&&e!==c.Z_BLOCK)throw new Error("Invalid flush value");if(null==r&&(r=f.alloc(0),n=i=0),this.strm.avail_in=i,this.strm.input=r,this.strm.next_in=n,this.strm.avail_out=o,this.strm.output=s,this.strm.next_out=a,this.flush=e,!t)return this._process(),this._checkError()?this._afterSync():void 0;var l=this;return h.nextTick(function(){l._process(),l._after()}),this},i.prototype._afterSync=function(){var t=this.strm.avail_out,e=this.strm.avail_in;return this.write_in_progress=!1,[e,t]},i.prototype._process=function(){var t=null;switch(this.mode){case c.DEFLATE:case c.GZIP:case c.DEFLATERAW:this.err=a.deflate(this.strm,this.flush);break;case c.UNZIP:switch(0<this.strm.avail_in&&(t=this.strm.next_in),this.gzip_id_bytes_read){case 0:if(null===t)break;if(31!==this.strm.input[t]){this.mode=c.INFLATE;break}if(t++,(this.gzip_id_bytes_read=1)===this.strm.avail_in)break;case 1:if(null===t)break;this.strm.input[t]===n?(this.gzip_id_bytes_read=2,this.mode=c.GUNZIP):this.mode=c.INFLATE;break;default:throw new Error("invalid number of gzip magic number bytes read")}case c.INFLATE:case c.GUNZIP:case c.INFLATERAW:for(this.err=o.inflate(this.strm,this.flush),this.err===c.Z_NEED_DICT&&this.dictionary&&(this.err=o.inflateSetDictionary(this.strm,this.dictionary),this.err===c.Z_OK?this.err=o.inflate(this.strm,this.flush):this.err===c.Z_DATA_ERROR&&(this.err=c.Z_NEED_DICT));0<this.strm.avail_in&&this.mode===c.GUNZIP&&this.err===c.Z_STREAM_END&&0!==this.strm.next_in[0];)this.reset(),this.err=o.inflate(this.strm,this.flush);break;default:throw new Error("Unknown mode "+this.mode)}},i.prototype._checkError=function(){switch(this.err){case c.Z_OK:case c.Z_BUF_ERROR:if(0!==this.strm.avail_out&&this.flush===c.Z_FINISH)return this._error("unexpected end of file"),!1;break;case c.Z_STREAM_END:break;case c.Z_NEED_DICT:return null==this.dictionary?this._error("Missing dictionary"):this._error("Bad dictionary"),!1;default:return this._error("Zlib error"),!1}return!0},i.prototype._after=function(){var t,e;this._checkError()&&(t=this.strm.avail_out,e=this.strm.avail_in,this.write_in_progress=!1,this.callback(e,t),this.pending_close&&this.close())},i.prototype._error=function(t){this.strm.msg&&(t=this.strm.msg),this.onerror(t,this.err),this.write_in_progress=!1,this.pending_close&&this.close()},i.prototype.init=function(t,e,r,n,i){u(4===arguments.length||5===arguments.length,"init(windowBits, level, memLevel, strategy, [dictionary])"),u(8<=t&&t<=15,"invalid windowBits"),u(-1<=e&&e<=9,"invalid compression level"),u(1<=r&&r<=9,"invalid memlevel"),u(n===c.Z_FILTERED||n===c.Z_HUFFMAN_ONLY||n===c.Z_RLE||n===c.Z_FIXED||n===c.Z_DEFAULT_STRATEGY,"invalid strategy"),this._init(e,t,r,n,i),this._setDictionary()},i.prototype.params=function(){throw new Error("deflateParams Not supported")},i.prototype.reset=function(){this._reset(),this._setDictionary()},i.prototype._init=function(t,e,r,n,i){switch(this.level=t,this.windowBits=e,this.memLevel=r,this.strategy=n,this.flush=c.Z_NO_FLUSH,this.err=c.Z_OK,this.mode!==c.GZIP&&this.mode!==c.GUNZIP||(this.windowBits+=16),this.mode===c.UNZIP&&(this.windowBits+=32),this.mode!==c.DEFLATERAW&&this.mode!==c.INFLATERAW||(this.windowBits=-1*this.windowBits),this.strm=new s,this.mode){case c.DEFLATE:case c.GZIP:case c.DEFLATERAW:this.err=a.deflateInit2(this.strm,this.level,c.Z_DEFLATED,this.windowBits,this.memLevel,this.strategy);break;case c.INFLATE:case c.GUNZIP:case c.INFLATERAW:case c.UNZIP:this.err=o.inflateInit2(this.strm,this.windowBits);break;default:throw new Error("Unknown mode "+this.mode)}this.err!==c.Z_OK&&this._error("Init error"),this.dictionary=i,this.write_in_progress=!1,this.init_done=!0},i.prototype._setDictionary=function(){if(null!=this.dictionary){switch(this.err=c.Z_OK,this.mode){case c.DEFLATE:case c.DEFLATERAW:this.err=a.deflateSetDictionary(this.strm,this.dictionary)}this.err!==c.Z_OK&&this._error("Failed to set dictionary")}},i.prototype._reset=function(){switch(this.err=c.Z_OK,this.mode){case c.DEFLATE:case c.DEFLATERAW:case c.GZIP:this.err=a.deflateReset(this.strm);break;case c.INFLATE:case c.INFLATERAW:case c.GUNZIP:this.err=o.inflateReset(this.strm)}this.err!==c.Z_OK&&this._error("Failed to reset stream")},c.Zlib=i}.call(this,l("_process"),l("buffer").Buffer)},{_process:51,assert:23,buffer:31,"pako/lib/zlib/constants":41,"pako/lib/zlib/deflate.js":43,"pako/lib/zlib/inflate.js":45,"pako/lib/zlib/zstream":49}],30:[function(A,t,O){!function(i){"use strict";var g=A("buffer").Buffer,a=A("stream").Transform,o=A("./binding"),t=A("util"),b=A("assert").ok,m=A("buffer").kMaxLength,y="Cannot create final Buffer. It would be larger than 0x"+m.toString(16)+" bytes";o.Z_MIN_WINDOWBITS=8,o.Z_MAX_WINDOWBITS=15,o.Z_DEFAULT_WINDOWBITS=15,o.Z_MIN_CHUNK=64,o.Z_MAX_CHUNK=1/0,o.Z_DEFAULT_CHUNK=16384,o.Z_MIN_MEMLEVEL=1,o.Z_MAX_MEMLEVEL=9,o.Z_DEFAULT_MEMLEVEL=8,o.Z_MIN_LEVEL=-1,o.Z_MAX_LEVEL=9,o.Z_DEFAULT_LEVEL=o.Z_DEFAULT_COMPRESSION;for(var e=Object.keys(o),r=0;r<e.length;r++){var n=e[r];n.match(/^Z/)&&Object.defineProperty(O,n,{enumerable:!0,value:o[n],writable:!1})}for(var s={Z_OK:o.Z_OK,Z_STREAM_END:o.Z_STREAM_END,Z_NEED_DICT:o.Z_NEED_DICT,Z_ERRNO:o.Z_ERRNO,Z_STREAM_ERROR:o.Z_STREAM_ERROR,Z_DATA_ERROR:o.Z_DATA_ERROR,Z_MEM_ERROR:o.Z_MEM_ERROR,Z_BUF_ERROR:o.Z_BUF_ERROR,Z_VERSION_ERROR:o.Z_VERSION_ERROR},l=Object.keys(s),h=0;h<l.length;h++){var f=l[h];s[s[f]]=f}function u(r,t,n){var i=[],s=0;function e(){for(var t;null!==(t=r.read());)i.push(t),s+=t.length;r.once("readable",e)}function a(t){r.removeListener("end",o),r.removeListener("readable",e),n(t)}function o(){var t,e=null;m<=s?e=new RangeError(y):t=g.concat(i,s),i=[],r.close(),n(e,t)}r.on("error",a),r.on("end",o),r.end(t),e()}function c(t,e){if("string"==typeof e&&(e=g.from(e)),!g.isBuffer(e))throw new TypeError("Not a string or buffer");var r=t._finishFlushFlag;return t._processChunk(e,r)}function d(t){if(!(this instanceof d))return new d(t);T.call(this,t,o.DEFLATE)}function p(t){if(!(this instanceof p))return new p(t);T.call(this,t,o.INFLATE)}function _(t){if(!(this instanceof _))return new _(t);T.call(this,t,o.GZIP)}function w(t){if(!(this instanceof w))return new w(t);T.call(this,t,o.GUNZIP)}function v(t){if(!(this instanceof v))return new v(t);T.call(this,t,o.DEFLATERAW)}function E(t){if(!(this instanceof E))return new E(t);T.call(this,t,o.INFLATERAW)}function k(t){if(!(this instanceof k))return new k(t);T.call(this,t,o.UNZIP)}function x(t){return t===o.Z_NO_FLUSH||t===o.Z_PARTIAL_FLUSH||t===o.Z_SYNC_FLUSH||t===o.Z_FULL_FLUSH||t===o.Z_FINISH||t===o.Z_BLOCK}function T(t,e){var r=this;if(this._opts=t=t||{},this._chunkSize=t.chunkSize||O.Z_DEFAULT_CHUNK,a.call(this,t),t.flush&&!x(t.flush))throw new Error("Invalid flush flag: "+t.flush);if(t.finishFlush&&!x(t.finishFlush))throw new Error("Invalid flush flag: "+t.finishFlush);if(this._flushFlag=t.flush||o.Z_NO_FLUSH,this._finishFlushFlag=void 0!==t.finishFlush?t.finishFlush:o.Z_FINISH,t.chunkSize&&(t.chunkSize<O.Z_MIN_CHUNK||t.chunkSize>O.Z_MAX_CHUNK))throw new Error("Invalid chunk size: "+t.chunkSize);if(t.windowBits&&(t.windowBits<O.Z_MIN_WINDOWBITS||t.windowBits>O.Z_MAX_WINDOWBITS))throw new Error("Invalid windowBits: "+t.windowBits);if(t.level&&(t.level<O.Z_MIN_LEVEL||t.level>O.Z_MAX_LEVEL))throw new Error("Invalid compression level: "+t.level);if(t.memLevel&&(t.memLevel<O.Z_MIN_MEMLEVEL||t.memLevel>O.Z_MAX_MEMLEVEL))throw new Error("Invalid memLevel: "+t.memLevel);if(t.strategy&&t.strategy!=O.Z_FILTERED&&t.strategy!=O.Z_HUFFMAN_ONLY&&t.strategy!=O.Z_RLE&&t.strategy!=O.Z_FIXED&&t.strategy!=O.Z_DEFAULT_STRATEGY)throw new Error("Invalid strategy: "+t.strategy);if(t.dictionary&&!g.isBuffer(t.dictionary))throw new Error("Invalid dictionary: it should be a Buffer instance");this._handle=new o.Zlib(e);var n=this;this._hadError=!1,this._handle.onerror=function(t,e){S(n),n._hadError=!0;var r=new Error(t);r.errno=e,r.code=O.codes[e],n.emit("error",r)};var i=O.Z_DEFAULT_COMPRESSION;"number"==typeof t.level&&(i=t.level);var s=O.Z_DEFAULT_STRATEGY;"number"==typeof t.strategy&&(s=t.strategy),this._handle.init(t.windowBits||O.Z_DEFAULT_WINDOWBITS,i,t.memLevel||O.Z_DEFAULT_MEMLEVEL,s,t.dictionary),this._buffer=g.allocUnsafe(this._chunkSize),this._offset=0,this._level=i,this._strategy=s,this.once("end",this.close),Object.defineProperty(this,"_closed",{get:function(){return!r._handle},configurable:!0,enumerable:!0})}function S(t,e){e&&i.nextTick(e),t._handle&&(t._handle.close(),t._handle=null)}function L(t){t.emit("close")}Object.defineProperty(O,"codes",{enumerable:!0,value:Object.freeze(s),writable:!1}),O.Deflate=d,O.Inflate=p,O.Gzip=_,O.Gunzip=w,O.DeflateRaw=v,O.InflateRaw=E,O.Unzip=k,O.createDeflate=function(t){return new d(t)},O.createInflate=function(t){return new p(t)},O.createDeflateRaw=function(t){return new v(t)},O.createInflateRaw=function(t){return new E(t)},O.createGzip=function(t){return new _(t)},O.createGunzip=function(t){return new w(t)},O.createUnzip=function(t){return new k(t)},O.deflate=function(t,e,r){return"function"==typeof e&&(r=e,e={}),u(new d(e),t,r)},O.deflateSync=function(t,e){return c(new d(e),t)},O.gzip=function(t,e,r){return"function"==typeof e&&(r=e,e={}),u(new _(e),t,r)},O.gzipSync=function(t,e){return c(new _(e),t)},O.deflateRaw=function(t,e,r){return"function"==typeof e&&(r=e,e={}),u(new v(e),t,r)},O.deflateRawSync=function(t,e){return c(new v(e),t)},O.unzip=function(t,e,r){return"function"==typeof e&&(r=e,e={}),u(new k(e),t,r)},O.unzipSync=function(t,e){return c(new k(e),t)},O.inflate=function(t,e,r){return"function"==typeof e&&(r=e,e={}),u(new p(e),t,r)},O.inflateSync=function(t,e){return c(new p(e),t)},O.gunzip=function(t,e,r){return"function"==typeof e&&(r=e,e={}),u(new w(e),t,r)},O.gunzipSync=function(t,e){return c(new w(e),t)},O.inflateRaw=function(t,e,r){return"function"==typeof e&&(r=e,e={}),u(new E(e),t,r)},O.inflateRawSync=function(t,e){return c(new E(e),t)},t.inherits(T,a),T.prototype.params=function(t,e,r){if(t<O.Z_MIN_LEVEL||t>O.Z_MAX_LEVEL)throw new RangeError("Invalid compression level: "+t);if(e!=O.Z_FILTERED&&e!=O.Z_HUFFMAN_ONLY&&e!=O.Z_RLE&&e!=O.Z_FIXED&&e!=O.Z_DEFAULT_STRATEGY)throw new TypeError("Invalid strategy: "+e);var n;this._level!==t||this._strategy!==e?(n=this).flush(o.Z_SYNC_FLUSH,function(){b(n._handle,"zlib binding closed"),n._handle.params(t,e),n._hadError||(n._level=t,n._strategy=e,r&&r())}):i.nextTick(r)},T.prototype.reset=function(){return b(this._handle,"zlib binding closed"),this._handle.reset()},T.prototype._flush=function(t){this._transform(g.alloc(0),"",t)},T.prototype.flush=function(t,e){var r=this,n=this._writableState;"function"!=typeof t&&(void 0!==t||e)||(e=t,t=o.Z_FULL_FLUSH),n.ended?e&&i.nextTick(e):n.ending?e&&this.once("end",e):n.needDrain?e&&this.once("drain",function(){return r.flush(t,e)}):(this._flushFlag=t,this.write(g.alloc(0),"",e))},T.prototype.close=function(t){S(this,t),i.nextTick(L,this)},T.prototype._transform=function(t,e,r){var n,i=this._writableState,s,a=(i.ending||i.ended)&&(!t||i.length===t.length);return null===t||g.isBuffer(t)?this._handle?(a?n=this._finishFlushFlag:(n=this._flushFlag,t.length>=i.length&&(this._flushFlag=this._opts.flush||o.Z_NO_FLUSH)),void this._processChunk(t,n,r)):r(new Error("zlib binding closed")):r(new Error("invalid input"))},T.prototype._processChunk=function(s,a,o){var l=s&&s.length,h=this._chunkSize-this._offset,f=0,u=this,c="function"==typeof o;if(!c){var d=[],p=0,e;this.on("error",function(t){e=t}),b(this._handle,"zlib binding closed");do{var t=this._handle.writeSync(a,s,f,l,this._buffer,this._offset,h)}while(!this._hadError&&_(t[0],t[1]));if(this._hadError)throw e;if(m<=p)throw S(this),new RangeError(y);var r=g.concat(d,p);return S(this),r}b(this._handle,"zlib binding closed");var n=this._handle.write(a,s,f,l,this._buffer,this._offset,h);function _(t,e){if(this&&(this.buffer=null,this.callback=null),!u._hadError){var r=h-e,n;if(b(0<=r,"have should not go down"),0<r&&(n=u._buffer.slice(u._offset,u._offset+r),u._offset+=r,c?u.push(n):(d.push(n),p+=n.length)),(0===e||u._offset>=u._chunkSize)&&(h=u._chunkSize,u._offset=0,u._buffer=g.allocUnsafe(u._chunkSize)),0===e){if(f+=l-t,l=t,!c)return!0;var i=u._handle.write(a,s,f,l,u._buffer,u._offset,u._chunkSize);return i.callback=_,void(i.buffer=s)}if(!c)return!1;o()}}n.buffer=s,n.callback=_},t.inherits(d,T),t.inherits(p,T),t.inherits(_,T),t.inherits(w,T),t.inherits(v,T),t.inherits(E,T),t.inherits(k,T)}.call(this,A("_process"))},{"./binding":29,_process:51,assert:23,buffer:31,stream:67,util:72}],31:[function(X,t,J){!function(c){"use strict";var n=X("base64-js"),s=X("ieee754");J.Buffer=c,J.SlowBuffer=_,J.INSPECT_MAX_BYTES=50;var r=2147483647;function t(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()}catch(t){return!1}}function a(t){if(r<t)throw new RangeError('The value "'+t+'" is invalid for option "size"');var e=new Uint8Array(t);return e.__proto__=c.prototype,e}function c(t,e,r){if("number"!=typeof t)return i(t,e,r);if("string"==typeof e)throw new TypeError('The "string" argument must be of type string. Received type number');return l(t)}function i(t,e,r){if("string"==typeof t)return h(t,e);if(ArrayBuffer.isView(t))return f(t);if(null==t)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t);if(K(t,ArrayBuffer)||t&&K(t.buffer,ArrayBuffer))return u(t,e,r);if("number"==typeof t)throw new TypeError('The "value" argument must not be of type number. Received type number');var n=t.valueOf&&t.valueOf();if(null!=n&&n!==t)return c.from(n,e,r);var i=d(t);if(i)return i;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof t[Symbol.toPrimitive])return c.from(t[Symbol.toPrimitive]("string"),e,r);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t)}function o(t){if("number"!=typeof t)throw new TypeError('"size" argument must be of type number');if(t<0)throw new RangeError('The value "'+t+'" is invalid for option "size"')}function e(t,e,r){return o(t),!(t<=0)&&void 0!==e?"string"==typeof r?a(t).fill(e,r):a(t).fill(e):a(t)}function l(t){return o(t),a(t<0?0:0|p(t))}function h(t,e){if(!c.isEncoding(e="string"!=typeof e||""===e?"utf8":e))throw new TypeError("Unknown encoding: "+e);var r=0|g(t,e),n=a(r),i=n.write(t,e);return n=i!==r?n.slice(0,i):n}function f(t){for(var e=t.length<0?0:0|p(t.length),r=a(e),n=0;n<e;n+=1)r[n]=255&t[n];return r}function u(t,e,r){if(e<0||t.byteLength<e)throw new RangeError('"offset" is outside of buffer bounds');if(t.byteLength<e+(r||0))throw new RangeError('"length" is outside of buffer bounds');var n,n=void 0===e&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,e):new Uint8Array(t,e,r);return n.__proto__=c.prototype,n}function d(t){if(c.isBuffer(t)){var e=0|p(t.length),r=a(e);return 0===r.length?r:(t.copy(r,0,0,e),r)}return void 0!==t.length?"number"!=typeof t.length||V(t.length)?a(0):f(t):"Buffer"===t.type&&Array.isArray(t.data)?f(t.data):void 0}function p(t){if(r<=t)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+r.toString(16)+" bytes");return 0|t}function _(t){return c.alloc(+(t=+t!=t?0:t))}function g(t,e){if(c.isBuffer(t))return t.length;if(ArrayBuffer.isView(t)||K(t,ArrayBuffer))return t.byteLength;if("string"!=typeof t)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof t);var r=t.length,n=2<arguments.length&&!0===arguments[2];if(!n&&0===r)return 0;for(var i=!1;;)switch(e){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return H(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return W(t).length;default:if(i)return n?-1:H(t).length;e=(""+e).toLowerCase(),i=!0}}function b(t,e,r){var n=!1;if((e=void 0===e||e<0?0:e)>this.length)return"";if((r=void 0===r||r>this.length?this.length:r)<=0)return"";if((r>>>=0)<=(e>>>=0))return"";for(t=t||"utf8";;)switch(t){case"hex":return B(this,e,r);case"utf8":case"utf-8":return A(this,e,r);case"ascii":return I(this,e,r);case"latin1":case"binary":return C(this,e,r);case"base64":return L(this,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return M(this,e,r);default:if(n)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),n=!0}}function m(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function y(t,e,r,n,i){if(0===t.length)return-1;if("string"==typeof r?(n=r,r=0):2147483647<r?r=2147483647:r<-2147483648&&(r=-2147483648),(r=(r=V(r=+r)?i?0:t.length-1:r)<0?t.length+r:r)>=t.length){if(i)return-1;r=t.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof e&&(e=c.from(e,n)),c.isBuffer(e))return 0===e.length?-1:w(t,e,r,n,i);if("number"==typeof e)return e&=255,"function"==typeof Uint8Array.prototype.indexOf?(i?Uint8Array.prototype.indexOf:Uint8Array.prototype.lastIndexOf).call(t,e,r):w(t,[e],r,n,i);throw new TypeError("val must be string, number or Buffer")}function w(t,e,r,n,i){var s=1,a=t.length,o=e.length,l;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(t.length<2||e.length<2)return-1;a/=s=2,o/=2,r/=2}function h(t,e){return 1===s?t[e]:t.readUInt16BE(e*s)}if(i)for(var f=-1,l=r;l<a;l++)if(h(t,l)===h(e,-1===f?0:l-f)){if(l-(f=-1===f?l:f)+1===o)return f*s}else-1!==f&&(l-=l-f),f=-1;else for(l=r=a<r+o?a-o:r;0<=l;l--){for(var u=!0,c=0;c<o;c++)if(h(t,l+c)!==h(e,c)){u=!1;break}if(u)return l}return-1}function v(t,e,r,n){r=Number(r)||0;var i=t.length-r;(!n||i<(n=Number(n)))&&(n=i);var s=e.length;s/2<n&&(n=s/2);for(var a=0;a<n;++a){var o=parseInt(e.substr(2*a,2),16);if(V(o))return a;t[r+a]=o}return a}function E(t,e,r,n){return G(H(e,t.length-r),t,r,n)}function k(t,e,r,n){return G(Y(e),t,r,n)}function x(t,e,r,n){return k(t,e,r,n)}function T(t,e,r,n){return G(W(e),t,r,n)}function S(t,e,r,n){return G(q(e,t.length-r),t,r,n)}function L(t,e,r){return 0===e&&r===t.length?n.fromByteArray(t):n.fromByteArray(t.slice(e,r))}function A(t,e,r){r=Math.min(t.length,r);for(var n=[],i=e;i<r;){var s=t[i],a=null,o=239<s?4:223<s?3:191<s?2:1,l,h,f,u;if(i+o<=r)switch(o){case 1:s<128&&(a=s);break;case 2:128==(192&(l=t[i+1]))&&127<(u=(31&s)<<6|63&l)&&(a=u);break;case 3:l=t[i+1],h=t[i+2],128==(192&l)&&128==(192&h)&&2047<(u=(15&s)<<12|(63&l)<<6|63&h)&&(u<55296||57343<u)&&(a=u);break;case 4:l=t[i+1],h=t[i+2],f=t[i+3],128==(192&l)&&128==(192&h)&&128==(192&f)&&65535<(u=(15&s)<<18|(63&l)<<12|(63&h)<<6|63&f)&&u<1114112&&(a=u)}null===a?(a=65533,o=1):65535<a&&(a-=65536,n.push(a>>>10&1023|55296),a=56320|1023&a),n.push(a),i+=o}return R(n)}J.kMaxLength=r,(c.TYPED_ARRAY_SUPPORT=t())||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(c.prototype,"parent",{enumerable:!0,get:function(){if(c.isBuffer(this))return this.buffer}}),Object.defineProperty(c.prototype,"offset",{enumerable:!0,get:function(){if(c.isBuffer(this))return this.byteOffset}}),"undefined"!=typeof Symbol&&null!=Symbol.species&&c[Symbol.species]===c&&Object.defineProperty(c,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),c.poolSize=8192,c.from=i,c.prototype.__proto__=Uint8Array.prototype,c.__proto__=Uint8Array,c.alloc=e,c.allocUnsafe=l,c.allocUnsafeSlow=l,c.isBuffer=function t(e){return null!=e&&!0===e._isBuffer&&e!==c.prototype},c.compare=function t(e,r){if(K(e,Uint8Array)&&(e=c.from(e,e.offset,e.byteLength)),K(r,Uint8Array)&&(r=c.from(r,r.offset,r.byteLength)),!c.isBuffer(e)||!c.isBuffer(r))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===r)return 0;for(var n=e.length,i=r.length,s=0,a=Math.min(n,i);s<a;++s)if(e[s]!==r[s]){n=e[s],i=r[s];break}return n<i?-1:i<n?1:0},c.isEncoding=function t(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function t(e,r){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return c.alloc(0);var n;if(void 0===r)for(n=r=0;n<e.length;++n)r+=e[n].length;for(var i=c.allocUnsafe(r),s=0,n=0;n<e.length;++n){var a=e[n];if(K(a,Uint8Array)&&(a=c.from(a)),!c.isBuffer(a))throw new TypeError('"list" argument must be an Array of Buffers');a.copy(i,s),s+=a.length}return i},c.byteLength=g,c.prototype._isBuffer=!0,c.prototype.swap16=function t(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var r=0;r<e;r+=2)m(this,r,r+1);return this},c.prototype.swap32=function t(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var r=0;r<e;r+=4)m(this,r,r+3),m(this,r+1,r+2);return this},c.prototype.swap64=function t(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var r=0;r<e;r+=8)m(this,r,r+7),m(this,r+1,r+6),m(this,r+2,r+5),m(this,r+3,r+4);return this},c.prototype.toLocaleString=c.prototype.toString=function t(){var e=this.length;return 0===e?"":0===arguments.length?A(this,0,e):b.apply(this,arguments)},c.prototype.equals=function t(e){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===c.compare(this,e)},c.prototype.inspect=function t(){var e="",r=J.INSPECT_MAX_BYTES,e=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim();return this.length>r&&(e+=" ... "),"<Buffer "+e+">"},c.prototype.compare=function t(e,r,n,i,s){if(K(e,Uint8Array)&&(e=c.from(e,e.offset,e.byteLength)),!c.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===n&&(n=e?e.length:0),void 0===i&&(i=0),void 0===s&&(s=this.length),(r=void 0===r?0:r)<0||n>e.length||i<0||s>this.length)throw new RangeError("out of range index");if(s<=i&&n<=r)return 0;if(s<=i)return-1;if(n<=r)return 1;if(this===e)return 0;for(var a=(s>>>=0)-(i>>>=0),o=(n>>>=0)-(r>>>=0),l=Math.min(a,o),h=this.slice(i,s),f=e.slice(r,n),u=0;u<l;++u)if(h[u]!==f[u]){a=h[u],o=f[u];break}return a<o?-1:o<a?1:0},c.prototype.includes=function t(e,r,n){return-1!==this.indexOf(e,r,n)},c.prototype.indexOf=function t(e,r,n){return y(this,e,r,n,!0)},c.prototype.lastIndexOf=function t(e,r,n){return y(this,e,r,n,!1)},c.prototype.write=function t(e,r,n,i){if(void 0===r)i="utf8",n=this.length,r=0;else if(void 0===n&&"string"==typeof r)i=r,n=this.length,r=0;else{if(!isFinite(r))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");r>>>=0,isFinite(n)?(n>>>=0,void 0===i&&(i="utf8")):(i=n,n=void 0)}var s=this.length-r;if((void 0===n||s<n)&&(n=s),0<e.length&&(n<0||r<0)||r>this.length)throw new RangeError("Attempt to write outside buffer bounds");i=i||"utf8";for(var a=!1;;)switch(i){case"hex":return v(this,e,r,n);case"utf8":case"utf-8":return E(this,e,r,n);case"ascii":return k(this,e,r,n);case"latin1":case"binary":return x(this,e,r,n);case"base64":return T(this,e,r,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return S(this,e,r,n);default:if(a)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),a=!0}},c.prototype.toJSON=function t(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var O=4096;function R(t){var e=t.length;if(e<=O)return String.fromCharCode.apply(String,t);for(var r="",n=0;n<e;)r+=String.fromCharCode.apply(String,t.slice(n,n+=O));return r}function I(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;i<r;++i)n+=String.fromCharCode(127&t[i]);return n}function C(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;i<r;++i)n+=String.fromCharCode(t[i]);return n}function B(t,e,r){var n=t.length;(!r||r<0||n<r)&&(r=n);for(var i="",s=e=!e||e<0?0:e;s<r;++s)i+=Z(t[s]);return i}function M(t,e,r){for(var n=t.slice(e,r),i="",s=0;s<n.length;s+=2)i+=String.fromCharCode(n[s]+256*n[s+1]);return i}function N(t,e,r){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(r<t+e)throw new RangeError("Trying to access beyond buffer length")}function D(t,e,r,n,i,s){if(!c.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(i<e||e<s)throw new RangeError('"value" argument is out of bounds');if(r+n>t.length)throw new RangeError("Index out of range")}function z(t,e,r,n,i,s){if(r+n>t.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function P(t,e,r,n,i){return e=+e,r>>>=0,i||z(t,e,r,4,34028234663852886e22,-34028234663852886e22),s.write(t,e,r,n,23,4),r+4}function U(t,e,r,n,i){return e=+e,r>>>=0,i||z(t,e,r,8,17976931348623157e292,-17976931348623157e292),s.write(t,e,r,n,52,8),r+8}c.prototype.slice=function t(e,r){var n=this.length;(e=~~e)<0?(e+=n)<0&&(e=0):n<e&&(e=n),(r=void 0===r?n:~~r)<0?(r+=n)<0&&(r=0):n<r&&(r=n),r<e&&(r=e);var i=this.subarray(e,r);return i.__proto__=c.prototype,i},c.prototype.readUIntLE=function t(e,r,n){e>>>=0,r>>>=0,n||N(e,r,this.length);for(var i=this[e],s=1,a=0;++a<r&&(s*=256);)i+=this[e+a]*s;return i},c.prototype.readUIntBE=function t(e,r,n){e>>>=0,r>>>=0,n||N(e,r,this.length);for(var i=this[e+--r],s=1;0<r&&(s*=256);)i+=this[e+--r]*s;return i},c.prototype.readUInt8=function t(e,r){return e>>>=0,r||N(e,1,this.length),this[e]},c.prototype.readUInt16LE=function t(e,r){return e>>>=0,r||N(e,2,this.length),this[e]|this[e+1]<<8},c.prototype.readUInt16BE=function t(e,r){return e>>>=0,r||N(e,2,this.length),this[e]<<8|this[e+1]},c.prototype.readUInt32LE=function t(e,r){return e>>>=0,r||N(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},c.prototype.readUInt32BE=function t(e,r){return e>>>=0,r||N(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},c.prototype.readIntLE=function t(e,r,n){e>>>=0,r>>>=0,n||N(e,r,this.length);for(var i=this[e],s=1,a=0;++a<r&&(s*=256);)i+=this[e+a]*s;return(s*=128)<=i&&(i-=Math.pow(2,8*r)),i},c.prototype.readIntBE=function t(e,r,n){e>>>=0,r>>>=0,n||N(e,r,this.length);for(var i=r,s=1,a=this[e+--i];0<i&&(s*=256);)a+=this[e+--i]*s;return(s*=128)<=a&&(a-=Math.pow(2,8*r)),a},c.prototype.readInt8=function t(e,r){return e>>>=0,r||N(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},c.prototype.readInt16LE=function t(e,r){e>>>=0,r||N(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt16BE=function t(e,r){e>>>=0,r||N(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt32LE=function t(e,r){return e>>>=0,r||N(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},c.prototype.readInt32BE=function t(e,r){return e>>>=0,r||N(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},c.prototype.readFloatLE=function t(e,r){return e>>>=0,r||N(e,4,this.length),s.read(this,e,!0,23,4)},c.prototype.readFloatBE=function t(e,r){return e>>>=0,r||N(e,4,this.length),s.read(this,e,!1,23,4)},c.prototype.readDoubleLE=function t(e,r){return e>>>=0,r||N(e,8,this.length),s.read(this,e,!0,52,8)},c.prototype.readDoubleBE=function t(e,r){return e>>>=0,r||N(e,8,this.length),s.read(this,e,!1,52,8)},c.prototype.writeUIntLE=function t(e,r,n,i){var s;e=+e,r>>>=0,n>>>=0,i||D(this,e,r,n,Math.pow(2,8*n)-1,0);var a=1,o=0;for(this[r]=255&e;++o<n&&(a*=256);)this[r+o]=e/a&255;return r+n},c.prototype.writeUIntBE=function t(e,r,n,i){var s;e=+e,r>>>=0,n>>>=0,i||D(this,e,r,n,Math.pow(2,8*n)-1,0);var a=n-1,o=1;for(this[r+a]=255&e;0<=--a&&(o*=256);)this[r+a]=e/o&255;return r+n},c.prototype.writeUInt8=function t(e,r,n){return e=+e,r>>>=0,n||D(this,e,r,1,255,0),this[r]=255&e,r+1},c.prototype.writeUInt16LE=function t(e,r,n){return e=+e,r>>>=0,n||D(this,e,r,2,65535,0),this[r]=255&e,this[r+1]=e>>>8,r+2},c.prototype.writeUInt16BE=function t(e,r,n){return e=+e,r>>>=0,n||D(this,e,r,2,65535,0),this[r]=e>>>8,this[r+1]=255&e,r+2},c.prototype.writeUInt32LE=function t(e,r,n){return e=+e,r>>>=0,n||D(this,e,r,4,4294967295,0),this[r+3]=e>>>24,this[r+2]=e>>>16,this[r+1]=e>>>8,this[r]=255&e,r+4},c.prototype.writeUInt32BE=function t(e,r,n){return e=+e,r>>>=0,n||D(this,e,r,4,4294967295,0),this[r]=e>>>24,this[r+1]=e>>>16,this[r+2]=e>>>8,this[r+3]=255&e,r+4},c.prototype.writeIntLE=function t(e,r,n,i){var s;e=+e,r>>>=0,i||D(this,e,r,n,(s=Math.pow(2,8*n-1))-1,-s);var a=0,o=1,l=0;for(this[r]=255&e;++a<n&&(o*=256);)e<0&&0===l&&0!==this[r+a-1]&&(l=1),this[r+a]=(e/o>>0)-l&255;return r+n},c.prototype.writeIntBE=function t(e,r,n,i){var s;e=+e,r>>>=0,i||D(this,e,r,n,(s=Math.pow(2,8*n-1))-1,-s);var a=n-1,o=1,l=0;for(this[r+a]=255&e;0<=--a&&(o*=256);)e<0&&0===l&&0!==this[r+a+1]&&(l=1),this[r+a]=(e/o>>0)-l&255;return r+n},c.prototype.writeInt8=function t(e,r,n){return e=+e,r>>>=0,n||D(this,e,r,1,127,-128),this[r]=255&(e=e<0?255+e+1:e),r+1},c.prototype.writeInt16LE=function t(e,r,n){return e=+e,r>>>=0,n||D(this,e,r,2,32767,-32768),this[r]=255&e,this[r+1]=e>>>8,r+2},c.prototype.writeInt16BE=function t(e,r,n){return e=+e,r>>>=0,n||D(this,e,r,2,32767,-32768),this[r]=e>>>8,this[r+1]=255&e,r+2},c.prototype.writeInt32LE=function t(e,r,n){return e=+e,r>>>=0,n||D(this,e,r,4,2147483647,-2147483648),this[r]=255&e,this[r+1]=e>>>8,this[r+2]=e>>>16,this[r+3]=e>>>24,r+4},c.prototype.writeInt32BE=function t(e,r,n){return e=+e,r>>>=0,n||D(this,e,r,4,2147483647,-2147483648),this[r]=(e=e<0?4294967295+e+1:e)>>>24,this[r+1]=e>>>16,this[r+2]=e>>>8,this[r+3]=255&e,r+4},c.prototype.writeFloatLE=function t(e,r,n){return P(this,e,r,!0,n)},c.prototype.writeFloatBE=function t(e,r,n){return P(this,e,r,!1,n)},c.prototype.writeDoubleLE=function t(e,r,n){return U(this,e,r,!0,n)},c.prototype.writeDoubleBE=function t(e,r,n){return U(this,e,r,!1,n)},c.prototype.copy=function t(e,r,n,i){if(!c.isBuffer(e))throw new TypeError("argument should be a Buffer");if(n=n||0,i||0===i||(i=this.length),r>=e.length&&(r=e.length),(i=0<i&&i<n?n:i)===n)return 0;if(0===e.length||0===this.length)return 0;if((r=r||0)<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length);var s=(i=e.length-r<i-n?e.length-r+n:i)-n;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(r,n,i);else if(this===e&&n<r&&r<i)for(var a=s-1;0<=a;--a)e[a+r]=this[a+n];else Uint8Array.prototype.set.call(e,this.subarray(n,i),r);return s},c.prototype.fill=function t(e,r,n,i){if("string"==typeof e){if("string"==typeof r?(i=r,r=0,n=this.length):"string"==typeof n&&(i=n,n=this.length),void 0!==i&&"string"!=typeof i)throw new TypeError("encoding must be a string");if("string"==typeof i&&!c.isEncoding(i))throw new TypeError("Unknown encoding: "+i);var s;1===e.length&&(s=e.charCodeAt(0),("utf8"===i&&s<128||"latin1"===i)&&(e=s))}else"number"==typeof e&&(e&=255);if(r<0||this.length<r||this.length<n)throw new RangeError("Out of range index");if(n<=r)return this;var a;if(r>>>=0,n=void 0===n?this.length:n>>>0,"number"==typeof(e=e||0))for(a=r;a<n;++a)this[a]=e;else{var o=c.isBuffer(e)?e:c.from(e,i),l=o.length;if(0===l)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(a=0;a<n-r;++a)this[a+r]=o[a%l]}return this};var j=/[^+/0-9A-Za-z-_]/g;function F(t){if((t=(t=t.split("=")[0]).trim().replace(j,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}function Z(t){return t<16?"0"+t.toString(16):t.toString(16)}function H(t,e){var r;e=e||1/0;for(var n=t.length,i=null,s=[],a=0;a<n;++a){if(55295<(r=t.charCodeAt(a))&&r<57344){if(!i){if(56319<r){-1<(e-=3)&&s.push(239,191,189);continue}if(a+1===n){-1<(e-=3)&&s.push(239,191,189);continue}i=r;continue}if(r<56320){-1<(e-=3)&&s.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&-1<(e-=3)&&s.push(239,191,189);if(i=null,r<128){if(--e<0)break;s.push(r)}else if(r<2048){if((e-=2)<0)break;s.push(r>>6|192,63&r|128)}else if(r<65536){if((e-=3)<0)break;s.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;s.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return s}function Y(t){for(var e=[],r=0;r<t.length;++r)e.push(255&t.charCodeAt(r));return e}function q(t,e){for(var r,n,i,s=[],a=0;a<t.length&&!((e-=2)<0);++a)n=(r=t.charCodeAt(a))>>8,s.push(i=r%256),s.push(n);return s}function W(t){return n.toByteArray(F(t))}function G(t,e,r,n){for(var i=0;i<n&&!(i+r>=e.length||i>=t.length);++i)e[i+r]=t[i];return i}function K(t,e){return t instanceof e||null!=t&&null!=t.constructor&&null!=t.constructor.name&&t.constructor.name===e.name}function V(t){return t!=t}}.call(this,X("buffer").Buffer)},{"base64-js":27,buffer:31,ieee754:34}],32:[function(t,e,g){!function(t){function e(t){return Array.isArray?Array.isArray(t):"[object Array]"===_(t)}function r(t){return"boolean"==typeof t}function n(t){return null===t}function i(t){return null==t}function s(t){return"number"==typeof t}function a(t){return"string"==typeof t}function o(t){return"symbol"==typeof t}function l(t){return void 0===t}function h(t){return"[object RegExp]"===_(t)}function f(t){return"object"==typeof t&&null!==t}function u(t){return"[object Date]"===_(t)}function c(t){return"[object Error]"===_(t)||t instanceof Error}function d(t){return"function"==typeof t}function p(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t}function _(t){return Object.prototype.toString.call(t)}g.isArray=e,g.isBoolean=r,g.isNull=n,g.isNullOrUndefined=i,g.isNumber=s,g.isString=a,g.isSymbol=o,g.isUndefined=l,g.isRegExp=h,g.isObject=f,g.isDate=u,g.isError=c,g.isFunction=d,g.isPrimitive=p,g.isBuffer=t.isBuffer}.call(this,{isBuffer:t("../../is-buffer/index.js")})},{"../../is-buffer/index.js":36}],33:[function(t,e,r){var l=Object.create||x,o=Object.keys||T,s=Function.prototype.bind||S;function n(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=l(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}((e.exports=n).EventEmitter=n).prototype._events=void 0,n.prototype._maxListeners=void 0;var i=10,a;try{var h={};Object.defineProperty&&Object.defineProperty(h,"x",{value:0}),a=0===h.x}catch(t){a=!1}function f(t){return void 0===t._maxListeners?n.defaultMaxListeners:t._maxListeners}function u(t,e,r){if(e)t.call(r);else for(var n=t.length,i=E(t,n),s=0;s<n;++s)i[s].call(r)}function c(t,e,r,n){if(e)t.call(r,n);else for(var i=t.length,s=E(t,i),a=0;a<i;++a)s[a].call(r,n)}function d(t,e,r,n,i){if(e)t.call(r,n,i);else for(var s=t.length,a=E(t,s),o=0;o<s;++o)a[o].call(r,n,i)}function p(t,e,r,n,i,s){if(e)t.call(r,n,i,s);else for(var a=t.length,o=E(t,a),l=0;l<a;++l)o[l].call(r,n,i,s)}function _(t,e,r,n){if(e)t.apply(r,n);else for(var i=t.length,s=E(t,i),a=0;a<i;++a)s[a].apply(r,n)}function g(t,e,r,n){var i,s,a,o,i;if("function"!=typeof r)throw new TypeError('"listener" argument must be a function');return(s=t._events)?(s.newListener&&(t.emit("newListener",e,r.listener||r),s=t._events),a=s[e]):(s=t._events=l(null),t._eventsCount=0),a?("function"==typeof a?a=s[e]=n?[r,a]:[a,r]:n?a.unshift(r):a.push(r),a.warned||(i=f(t))&&0<i&&a.length>i&&(a.warned=!0,(o=new Error("Possible EventEmitter memory leak detected. "+a.length+' "'+String(e)+'" listeners added. Use emitter.setMaxListeners() to increase limit.')).name="MaxListenersExceededWarning",o.emitter=t,o.type=e,o.count=a.length,"object"==typeof console&&console.warn&&console.warn("%s: %s",o.name,o.message))):(a=s[e]=r,++t._eventsCount),t}function b(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var t=new Array(arguments.length),e=0;e<t.length;++e)t[e]=arguments[e];this.listener.apply(this.target,t)}}function m(t,e,r){var n={fired:!1,wrapFn:void 0,target:t,type:e,listener:r},i=s.call(b,n);return i.listener=r,n.wrapFn=i}function y(t,e,r){var n=t._events;if(!n)return[];var i=n[e];return i?"function"==typeof i?r?[i.listener||i]:[i]:r?k(i):E(i,i.length):[]}function w(t){var e=this._events;if(e){var r=e[t];if("function"==typeof r)return 1;if(r)return r.length}return 0}function v(t,e){for(var r=e,n=r+1,i=t.length;n<i;r+=1,n+=1)t[r]=t[n];t.pop()}function E(t,e){for(var r=new Array(e),n=0;n<e;++n)r[n]=t[n];return r}function k(t){for(var e=new Array(t.length),r=0;r<e.length;++r)e[r]=t[r].listener||t[r];return e}function x(t){var e=function(){};return e.prototype=t,new e}function T(t){var e=[],r;for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.push(r);return r}function S(t){var e=this;return function(){return e.apply(t,arguments)}}a?Object.defineProperty(n,"defaultMaxListeners",{enumerable:!0,get:function(){return i},set:function(t){if("number"!=typeof t||t<0||t!=t)throw new TypeError('"defaultMaxListeners" must be a positive number');i=t}}):n.defaultMaxListeners=i,n.prototype.setMaxListeners=function t(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},n.prototype.getMaxListeners=function t(){return f(this)},n.prototype.emit=function t(e){var r,n,i,s,a,o,l="error"===e,o=this._events;if(o)l=l&&null==o.error;else if(!l)return!1;if(l){if((r=1<arguments.length?arguments[1]:r)instanceof Error)throw r;var h=new Error('Unhandled "error" event. ('+r+")");throw h.context=r,h}if(!(n=o[e]))return!1;var f="function"==typeof n,i;switch(i=arguments.length){case 1:u(n,f,this);break;case 2:c(n,f,this,arguments[1]);break;case 3:d(n,f,this,arguments[1],arguments[2]);break;case 4:p(n,f,this,arguments[1],arguments[2],arguments[3]);break;default:for(s=new Array(i-1),a=1;a<i;a++)s[a-1]=arguments[a];_(n,f,this,s)}return!0},n.prototype.on=n.prototype.addListener=function t(e,r){return g(this,e,r,!1)},n.prototype.prependListener=function t(e,r){return g(this,e,r,!0)},n.prototype.once=function t(e,r){if("function"!=typeof r)throw new TypeError('"listener" argument must be a function');return this.on(e,m(this,e,r)),this},n.prototype.prependOnceListener=function t(e,r){if("function"!=typeof r)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,m(this,e,r)),this},n.prototype.removeListener=function t(e,r){var n,i,s,a,o;if("function"!=typeof r)throw new TypeError('"listener" argument must be a function');if(!(i=this._events))return this;if(!(n=i[e]))return this;if(n===r||n.listener===r)0==--this._eventsCount?this._events=l(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||r));else if("function"!=typeof n){for(s=-1,a=n.length-1;0<=a;a--)if(n[a]===r||n[a].listener===r){o=n[a].listener,s=a;break}if(s<0)return this;0===s?n.shift():v(n,s),1===n.length&&(i[e]=n[0]),i.removeListener&&this.emit("removeListener",e,o||r)}return this},n.prototype.removeAllListeners=function t(e){var r,n,i,n=this._events;if(!n)return this;if(!n.removeListener)return 0===arguments.length?(this._events=l(null),this._eventsCount=0):n[e]&&(0==--this._eventsCount?this._events=l(null):delete n[e]),this;if(0===arguments.length){for(var s=o(n),a,i=0;i<s.length;++i)"removeListener"!==(a=s[i])&&this.removeAllListeners(a);return this.removeAllListeners("removeListener"),this._events=l(null),this._eventsCount=0,this}if("function"==typeof(r=n[e]))this.removeListener(e,r);else if(r)for(i=r.length-1;0<=i;i--)this.removeListener(e,r[i]);return this},n.prototype.listeners=function t(e){return y(this,e,!0)},n.prototype.rawListeners=function t(e){return y(this,e,!1)},n.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):w.call(t,e)},n.prototype.listenerCount=w,n.prototype.eventNames=function t(){return 0<this._eventsCount?Reflect.ownKeys(this._events):[]}},{}],34:[function(t,e,r){r.read=function(t,e,r,n,i){var s,a,o=8*i-n-1,l=(1<<o)-1,h=l>>1,f=-7,u=r?i-1:0,c=r?-1:1,d=t[e+u];for(u+=c,s=d&(1<<-f)-1,d>>=-f,f+=o;0<f;s=256*s+t[e+u],u+=c,f-=8);for(a=s&(1<<-f)-1,s>>=-f,f+=n;0<f;a=256*a+t[e+u],u+=c,f-=8);if(0===s)s=1-h;else{if(s===l)return a?NaN:1/0*(d?-1:1);a+=Math.pow(2,n),s-=h}return(d?-1:1)*a*Math.pow(2,s-n)},r.write=function(t,e,r,n,i,s){var a,o,l,h=8*s-i-1,f=(1<<h)-1,u=f>>1,c=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,d=n?0:s-1,p=n?1:-1,_=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(o=isNaN(e)?1:0,a=f):(a=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-a))<1&&(a--,l*=2),2<=(e+=1<=a+u?c/l:c*Math.pow(2,1-u))*l&&(a++,l/=2),f<=a+u?(o=0,a=f):1<=a+u?(o=(e*l-1)*Math.pow(2,i),a+=u):(o=e*Math.pow(2,u-1)*Math.pow(2,i),a=0));8<=i;t[r+d]=255&o,d+=p,o/=256,i-=8);for(a=a<<i|o,h+=i;0<h;t[r+d]=255&a,d+=p,a/=256,h-=8);t[r+d-p]|=128*_}},{}],35:[function(t,e,r){"function"==typeof Object.create?e.exports=function t(e,r){r&&(e.super_=r,e.prototype=Object.create(r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function t(e,r){var n;r&&(e.super_=r,(n=function(){}).prototype=r.prototype,e.prototype=new n,e.prototype.constructor=e)}},{}],36:[function(t,e,r){function n(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}function i(t){return"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&n(t.slice(0,0))}e.exports=function(t){return null!=t&&(n(t)||i(t)||!!t._isBuffer)}},{}],37:[function(t,e,r){var n={}.toString;e.exports=Array.isArray||function(t){return"[object Array]"==n.call(t)}},{}],38:[function(t,e,r){"use strict";var l=Object.getOwnPropertySymbols,h=Object.prototype.hasOwnProperty,f=Object.prototype.propertyIsEnumerable;function u(t){if(null==t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}function n(){try{if(!Object.assign)return;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return;for(var e={},r=0,n;r<10;r++)e["_"+String.fromCharCode(r)]=r;if("0123456789"!==Object.getOwnPropertyNames(e).map(function(t){return e[t]}).join(""))return;var i={};return"abcdefghijklmnopqrst".split("").forEach(function(t){i[t]=t}),"abcdefghijklmnopqrst"!==Object.keys(Object.assign({},i)).join("")?void 0:1}catch(t){return}}e.exports=n()?Object.assign:function(t,e){for(var r,n=u(t),i,s=1;s<arguments.length;s++){for(var a in r=Object(arguments[s]))h.call(r,a)&&(n[a]=r[a]);if(l)for(var i=l(r),o=0;o<i.length;o++)f.call(r,i[o])&&(n[i[o]]=r[i[o]])}return n}},{}],39:[function(t,e,r){"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function i(t,e){return Object.prototype.hasOwnProperty.call(t,e)}r.assign=function(t){for(var e=Array.prototype.slice.call(arguments,1);e.length;){var r=e.shift();if(r){if("object"!=typeof r)throw new TypeError(r+"must be non-object");for(var n in r)i(r,n)&&(t[n]=r[n])}}return t},r.shrinkBuf=function(t,e){return t.length===e?t:t.subarray?t.subarray(0,e):(t.length=e,t)};var s={arraySet:function(t,e,r,n,i){if(e.subarray&&t.subarray)t.set(e.subarray(r,r+n),i);else for(var s=0;s<n;s++)t[i+s]=e[r+s]},flattenChunks:function(t){for(var e,r,n,i,s,a,n=0,e=0,r=t.length;e<r;e++)n+=t[e].length;for(a=new Uint8Array(n),e=i=0,r=t.length;e<r;e++)s=t[e],a.set(s,i),i+=s.length;return a}},a={arraySet:function(t,e,r,n,i){for(var s=0;s<n;s++)t[i+s]=e[r+s]},flattenChunks:function(t){return[].concat.apply([],t)}};r.setTyped=function(t){t?(r.Buf8=Uint8Array,r.Buf16=Uint16Array,r.Buf32=Int32Array,r.assign(r,s)):(r.Buf8=Array,r.Buf16=Array,r.Buf32=Array,r.assign(r,a))},r.setTyped(n)},{}],40:[function(t,e,r){"use strict";function n(t,e,r,n){for(var i=65535&t|0,s=t>>>16&65535|0,a=0;0!==r;){for(r-=a=2e3<r?2e3:r;s=s+(i=i+e[n++]|0)|0,--a;);i%=65521,s%=65521}return i|s<<16|0}e.exports=n},{}],41:[function(t,e,r){"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],42:[function(t,e,r){"use strict";function n(){for(var t,e=[],r=0;r<256;r++){for(var t=r,n=0;n<8;n++)t=1&t?3988292384^t>>>1:t>>>1;e[r]=t}return e}var o=n();function i(t,e,r,n){var i=o,s=n+r;t^=-1;for(var a=n;a<s;a++)t=t>>>8^i[255&(t^e[a])];return-1^t}e.exports=i},{}],43:[function(t,e,r){"use strict";var u=t("../utils/common"),h=t("./trees"),c=t("./adler32"),f=t("./crc32"),n=t("./messages"),d=0,i=1,s=3,p=4,a=5,_=0,o=1,g=-2,l=-3,b=-5,m=-1,y=1,w=2,v=3,E=4,k=0,x=2,T=8,S=9,L=15,A=8,O=29,R=256,I=286,C=30,B=19,M=2*I+1,N=15,D=3,z=258,P=z+D+1,U=32,j=42,F=69,Z=73,H=91,Y=103,q=113,W=666,G=1,K=2,V=3,X=4,J=3,$;function Q(t,e){return t.msg=n[e],e}function tt(t){return(t<<1)-(4<t?9:0)}function et(t){for(var e=t.length;0<=--e;)t[e]=0}function rt(t){var e=t.state,r=e.pending;0!==(r=r>t.avail_out?t.avail_out:r)&&(u.arraySet(t.output,e.pending_buf,e.pending_out,r,t.next_out),t.next_out+=r,e.pending_out+=r,t.total_out+=r,t.avail_out-=r,e.pending-=r,0===e.pending&&(e.pending_out=0))}function nt(t,e){h._tr_flush_block(t,0<=t.block_start?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,rt(t.strm)}function it(t,e){t.pending_buf[t.pending++]=e}function st(t,e){t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e}function at(t,e,r,n){var i=t.avail_in;return 0===(i=n<i?n:i)?0:(t.avail_in-=i,u.arraySet(e,t.input,t.next_in,i,r),1===t.state.wrap?t.adler=c(t.adler,e,i,r):2===t.state.wrap&&(t.adler=f(t.adler,e,i,r)),t.next_in+=i,t.total_in+=i,i)}function ot(t,e){var r=t.max_chain_length,n=t.strstart,i,s,a=t.prev_length,o=t.nice_match,l=t.strstart>t.w_size-P?t.strstart-(t.w_size-P):0,h=t.window,f=t.w_mask,u=t.prev,c=t.strstart+z,d=h[n+a-1],p=h[n+a];t.prev_length>=t.good_match&&(r>>=2),o>t.lookahead&&(o=t.lookahead);do{if(h[(i=e)+a]===p&&h[i+a-1]===d&&h[i]===h[n]&&h[++i]===h[n+1]){for(n+=2,i++;h[++n]===h[++i]&&h[++n]===h[++i]&&h[++n]===h[++i]&&h[++n]===h[++i]&&h[++n]===h[++i]&&h[++n]===h[++i]&&h[++n]===h[++i]&&h[++n]===h[++i]&&n<c;);if(s=z-(c-n),n=c-z,a<s){if(t.match_start=e,o<=(a=s))break;d=h[n+a-1],p=h[n+a]}}}while((e=u[e&f])>l&&0!=--r);return a<=t.lookahead?a:t.lookahead}function lt(t){var e=t.w_size,r,n,i,s,a;do{if(s=t.window_size-t.lookahead-t.strstart,t.strstart>=e+(e-P)){for(u.arraySet(t.window,t.window,e,e,0),t.match_start-=e,t.strstart-=e,t.block_start-=e,r=n=t.hash_size;i=t.head[--r],t.head[r]=e<=i?i-e:0,--n;);for(r=n=e;i=t.prev[--r],t.prev[r]=e<=i?i-e:0,--n;);s+=e}if(0===t.strm.avail_in)break;if(n=at(t.strm,t.window,t.strstart+t.lookahead,s),t.lookahead+=n,t.lookahead+t.insert>=D)for(a=t.strstart-t.insert,t.ins_h=t.window[a],t.ins_h=(t.ins_h<<t.hash_shift^t.window[a+1])&t.hash_mask;t.insert&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[a+D-1])&t.hash_mask,t.prev[a&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=a,a++,t.insert--,!(t.lookahead+t.insert<D)););}while(t.lookahead<P&&0!==t.strm.avail_in)}function ht(t,e){var r=65535;for(r>t.pending_buf_size-5&&(r=t.pending_buf_size-5);;){if(t.lookahead<=1){if(lt(t),0===t.lookahead&&e===d)return G;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;var n=t.block_start+r;if((0===t.strstart||t.strstart>=n)&&(t.lookahead=t.strstart-n,t.strstart=n,nt(t,!1),0===t.strm.avail_out))return G;if(t.strstart-t.block_start>=t.w_size-P&&(nt(t,!1),0===t.strm.avail_out))return G}return t.insert=0,e===p?(nt(t,!0),0===t.strm.avail_out?V:X):(t.strstart>t.block_start&&(nt(t,!1),t.strm.avail_out),G)}function ft(t,e){for(var r,n;;){if(t.lookahead<P){if(lt(t),t.lookahead<P&&e===d)return G;if(0===t.lookahead)break}if(r=0,t.lookahead>=D&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+D-1])&t.hash_mask,r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==r&&t.strstart-r<=t.w_size-P&&(t.match_length=ot(t,r)),t.match_length>=D)if(n=h._tr_tally(t,t.strstart-t.match_start,t.match_length-D),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=D){for(t.match_length--;t.strstart++,t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+D-1])&t.hash_mask,r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart,0!=--t.match_length;);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+1])&t.hash_mask;else n=h._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(n&&(nt(t,!1),0===t.strm.avail_out))return G}return t.insert=t.strstart<D-1?t.strstart:D-1,e===p?(nt(t,!0),0===t.strm.avail_out?V:X):t.last_lit&&(nt(t,!1),0===t.strm.avail_out)?G:K}function ut(t,e){for(var r,n,i;;){if(t.lookahead<P){if(lt(t),t.lookahead<P&&e===d)return G;if(0===t.lookahead)break}if(r=0,t.lookahead>=D&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+D-1])&t.hash_mask,r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=D-1,0!==r&&t.prev_length<t.max_lazy_match&&t.strstart-r<=t.w_size-P&&(t.match_length=ot(t,r),t.match_length<=5&&(1===t.strategy||t.match_length===D&&4096<t.strstart-t.match_start)&&(t.match_length=D-1)),t.prev_length>=D&&t.match_length<=t.prev_length){for(i=t.strstart+t.lookahead-D,n=h._tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-D),t.lookahead-=t.prev_length-1,t.prev_length-=2;++t.strstart<=i&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+D-1])&t.hash_mask,r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!=--t.prev_length;);if(t.match_available=0,t.match_length=D-1,t.strstart++,n&&(nt(t,!1),0===t.strm.avail_out))return G}else if(t.match_available){if((n=h._tr_tally(t,0,t.window[t.strstart-1]))&&nt(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return G}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(n=h._tr_tally(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<D-1?t.strstart:D-1,e===p?(nt(t,!0),0===t.strm.avail_out?V:X):t.last_lit&&(nt(t,!1),0===t.strm.avail_out)?G:K}function ct(t,e){for(var r,n,i,s,a=t.window;;){if(t.lookahead<=z){if(lt(t),t.lookahead<=z&&e===d)return G;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=D&&0<t.strstart&&(n=a[i=t.strstart-1])===a[++i]&&n===a[++i]&&n===a[++i]){for(s=t.strstart+z;n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&i<s;);t.match_length=z-(s-i),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=D?(r=h._tr_tally(t,1,t.match_length-D),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(r=h._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),r&&(nt(t,!1),0===t.strm.avail_out))return G}return t.insert=0,e===p?(nt(t,!0),0===t.strm.avail_out?V:X):t.last_lit&&(nt(t,!1),0===t.strm.avail_out)?G:K}function dt(t,e){for(var r;;){if(0===t.lookahead&&(lt(t),0===t.lookahead)){if(e===d)return G;break}if(t.match_length=0,r=h._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,r&&(nt(t,!1),0===t.strm.avail_out))return G}return t.insert=0,e===p?(nt(t,!0),0===t.strm.avail_out?V:X):t.last_lit&&(nt(t,!1),0===t.strm.avail_out)?G:K}function pt(t,e,r,n,i){this.good_length=t,this.max_lazy=e,this.nice_length=r,this.max_chain=n,this.func=i}function _t(t){t.window_size=2*t.w_size,et(t.head),t.max_lazy_match=$[t.level].max_lazy,t.good_match=$[t.level].good_length,t.nice_match=$[t.level].nice_length,t.max_chain_length=$[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=D-1,t.match_available=0,t.ins_h=0}function gt(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=T,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new u.Buf16(2*M),this.dyn_dtree=new u.Buf16(2*(2*C+1)),this.bl_tree=new u.Buf16(2*(2*B+1)),et(this.dyn_ltree),et(this.dyn_dtree),et(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new u.Buf16(N+1),this.heap=new u.Buf16(2*I+1),et(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new u.Buf16(2*I+1),et(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function bt(t){var e;return t&&t.state?(t.total_in=t.total_out=0,t.data_type=x,(e=t.state).pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?j:q,t.adler=2===e.wrap?0:1,e.last_flush=d,h._tr_init(e),_):Q(t,g)}function mt(t){var e=bt(t);return e===_&&_t(t.state),e}function yt(t,e){return!t||!t.state||2!==t.state.wrap?g:(t.state.gzhead=e,_)}function wt(t,e,r,n,i,s){if(!t)return g;var a=1;if(e===m&&(e=6),n<0?(a=0,n=-n):15<n&&(a=2,n-=16),i<1||S<i||r!==T||n<8||15<n||e<0||9<e||s<0||E<s)return Q(t,g);8===n&&(n=9);var o=new gt;return(t.state=o).strm=t,o.wrap=a,o.gzhead=null,o.w_bits=n,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=i+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+D-1)/D),o.window=new u.Buf8(2*o.w_size),o.head=new u.Buf16(o.hash_size),o.prev=new u.Buf16(o.w_size),o.lit_bufsize=1<<i+6,o.pending_buf_size=4*o.lit_bufsize,o.pending_buf=new u.Buf8(o.pending_buf_size),o.d_buf=+o.lit_bufsize,o.l_buf=3*o.lit_bufsize,o.level=e,o.strategy=s,o.method=r,mt(t)}function vt(t,e){return wt(t,e,T,15,8,0)}function Et(t,e){var r,n,i,s,a,o,o;if(!t||!t.state||5<e||e<0)return t?Q(t,g):g;if(n=t.state,!t.output||!t.input&&0!==t.avail_in||n.status===W&&e!==p)return Q(t,0===t.avail_out?-5:g);if(n.strm=t,r=n.last_flush,n.last_flush=e,n.status===j&&(2===n.wrap?(t.adler=0,it(n,31),it(n,139),it(n,8),n.gzhead?(it(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),it(n,255&n.gzhead.time),it(n,n.gzhead.time>>8&255),it(n,n.gzhead.time>>16&255),it(n,n.gzhead.time>>24&255),it(n,9===n.level?2:2<=n.strategy||n.level<2?4:0),it(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(it(n,255&n.gzhead.extra.length),it(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(t.adler=f(t.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69):(it(n,0),it(n,0),it(n,0),it(n,0),it(n,0),it(n,9===n.level?2:2<=n.strategy||n.level<2?4:0),it(n,3),n.status=q)):(a=T+(n.w_bits-8<<4)<<8,o=-1,a|=(o=2<=n.strategy||n.level<2?0:n.level<6?1:6===n.level?2:3)<<6,0!==n.strstart&&(a|=32),a+=31-a%31,n.status=q,st(n,a),0!==n.strstart&&(st(n,t.adler>>>16),st(n,65535&t.adler)),t.adler=1)),69===n.status)if(n.gzhead.extra){for(i=n.pending;n.gzindex<(65535&n.gzhead.extra.length)&&(n.pending!==n.pending_buf_size||(n.gzhead.hcrc&&n.pending>i&&(t.adler=f(t.adler,n.pending_buf,n.pending-i,i)),rt(t),i=n.pending,n.pending!==n.pending_buf_size));)it(n,255&n.gzhead.extra[n.gzindex]),n.gzindex++;n.gzhead.hcrc&&n.pending>i&&(t.adler=f(t.adler,n.pending_buf,n.pending-i,i)),n.gzindex===n.gzhead.extra.length&&(n.gzindex=0,n.status=73)}else n.status=73;if(73===n.status)if(n.gzhead.name){i=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>i&&(t.adler=f(t.adler,n.pending_buf,n.pending-i,i)),rt(t),i=n.pending,n.pending===n.pending_buf_size)){s=1;break}}while(s=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,it(n,s),0!==s);n.gzhead.hcrc&&n.pending>i&&(t.adler=f(t.adler,n.pending_buf,n.pending-i,i)),0===s&&(n.gzindex=0,n.status=91)}else n.status=91;if(91===n.status)if(n.gzhead.comment){i=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>i&&(t.adler=f(t.adler,n.pending_buf,n.pending-i,i)),rt(t),i=n.pending,n.pending===n.pending_buf_size)){s=1;break}}while(s=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,it(n,s),0!==s);n.gzhead.hcrc&&n.pending>i&&(t.adler=f(t.adler,n.pending_buf,n.pending-i,i)),0===s&&(n.status=Y)}else n.status=Y;if(n.status===Y&&(n.gzhead.hcrc?(n.pending+2>n.pending_buf_size&&rt(t),n.pending+2<=n.pending_buf_size&&(it(n,255&t.adler),it(n,t.adler>>8&255),t.adler=0,n.status=q)):n.status=q),0!==n.pending){if(rt(t),0===t.avail_out)return n.last_flush=-1,_}else if(0===t.avail_in&&tt(e)<=tt(r)&&e!==p)return Q(t,-5);if(n.status===W&&0!==t.avail_in)return Q(t,-5);if(0!==t.avail_in||0!==n.lookahead||e!==d&&n.status!==W){var l=2===n.strategy?dt(n,e):3===n.strategy?ct(n,e):$[n.level].func(n,e);if(l!==V&&l!==X||(n.status=W),l===G||l===V)return 0===t.avail_out&&(n.last_flush=-1),_;if(l===K&&(1===e?h._tr_align(n):5!==e&&(h._tr_stored_block(n,0,0,!1),3===e&&(et(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),rt(t),0===t.avail_out))return n.last_flush=-1,_}return e!==p?_:n.wrap<=0?1:(2===n.wrap?(it(n,255&t.adler),it(n,t.adler>>8&255),it(n,t.adler>>16&255),it(n,t.adler>>24&255),it(n,255&t.total_in),it(n,t.total_in>>8&255),it(n,t.total_in>>16&255),it(n,t.total_in>>24&255)):(st(n,t.adler>>>16),st(n,65535&t.adler)),rt(t),0<n.wrap&&(n.wrap=-n.wrap),0!==n.pending?_:1)}function kt(t){var e;return t&&t.state?(e=t.state.status)!==j&&69!==e&&73!==e&&91!==e&&e!==Y&&e!==q&&e!==W?Q(t,g):(t.state=null,e===q?Q(t,-3):_):g}function xt(t,e){var r=e.length,n,i,s,a,o,l,h,f;if(!t||!t.state)return g;if(2===(a=(n=t.state).wrap)||1===a&&n.status!==j||n.lookahead)return g;for(1===a&&(t.adler=c(t.adler,e,r,0)),n.wrap=0,r>=n.w_size&&(0===a&&(et(n.head),n.strstart=0,n.block_start=0,n.insert=0),f=new u.Buf8(n.w_size),u.arraySet(f,e,r-n.w_size,n.w_size,0),e=f,r=n.w_size),o=t.avail_in,l=t.next_in,h=t.input,t.avail_in=r,t.next_in=0,t.input=e,lt(n);n.lookahead>=D;){for(i=n.strstart,s=n.lookahead-(D-1);n.ins_h=(n.ins_h<<n.hash_shift^n.window[i+D-1])&n.hash_mask,n.prev[i&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=i,i++,--s;);n.strstart=i,n.lookahead=D-1,lt(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=D-1,n.match_available=0,t.next_in=l,t.input=h,t.avail_in=o,n.wrap=a,_}$=[new pt(0,0,0,0,ht),new pt(4,4,8,4,ft),new pt(4,5,16,8,ft),new pt(4,6,32,32,ft),new pt(4,4,16,16,ut),new pt(8,16,32,32,ut),new pt(8,16,128,128,ut),new pt(8,32,128,256,ut),new pt(32,128,258,1024,ut),new pt(32,258,258,4096,ut)],r.deflateInit=vt,r.deflateInit2=wt,r.deflateReset=mt,r.deflateResetKeep=bt,r.deflateSetHeader=yt,r.deflate=Et,r.deflateEnd=kt,r.deflateSetDictionary=xt,r.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":39,"./adler32":40,"./crc32":42,"./messages":47,"./trees":48}],44:[function(t,e,r){"use strict";var n=30,i=12;e.exports=function t(e,r){var n,i,s,a,o,l,h,f,u,c,d,p,_,g,b,m,y,w,v,E,k,x,T,S,L,n=e.state,i=e.next_in,S=e.input,s=i+(e.avail_in-5),a=e.next_out,L=e.output,o=a-(r-e.avail_out),l=a+(e.avail_out-257),h=n.dmax,f=n.wsize,u=n.whave,c=n.wnext,d=n.window,p=n.hold,_=n.bits,g=n.lencode,b=n.distcode,m=(1<<n.lenbits)-1,y=(1<<n.distbits)-1;t:do{_<15&&(p+=S[i++]<<_,_+=8,p+=S[i++]<<_,_+=8),w=g[p&m];e:for(;;){if(p>>>=v=w>>>24,_-=v,0===(v=w>>>16&255))L[a++]=65535&w;else{if(!(16&v)){if(0==(64&v)){w=g[(65535&w)+(p&(1<<v)-1)];continue}if(32&v){n.mode=12;break t}e.msg="invalid literal/length code",n.mode=30;break t}E=65535&w,(v&=15)&&(_<v&&(p+=S[i++]<<_,_+=8),E+=p&(1<<v)-1,p>>>=v,_-=v),_<15&&(p+=S[i++]<<_,_+=8,p+=S[i++]<<_,_+=8),w=b[p&y];r:for(;;){if(p>>>=v=w>>>24,_-=v,!(16&(v=w>>>16&255))){if(0==(64&v)){w=b[(65535&w)+(p&(1<<v)-1)];continue}e.msg="invalid distance code",n.mode=30;break t}if(k=65535&w,_<(v&=15)&&(p+=S[i++]<<_,(_+=8)<v&&(p+=S[i++]<<_,_+=8)),h<(k+=p&(1<<v)-1)){e.msg="invalid distance too far back",n.mode=30;break t}if(p>>>=v,_-=v,(v=a-o)<k){if(u<(v=k-v)&&n.sane){e.msg="invalid distance too far back",n.mode=30;break t}if(T=d,(x=0)===c){if(x+=f-v,v<E){for(E-=v;L[a++]=d[x++],--v;);x=a-k,T=L}}else if(c<v){if(x+=f+c-v,(v-=c)<E){for(E-=v;L[a++]=d[x++],--v;);if(x=0,c<E){for(E-=v=c;L[a++]=d[x++],--v;);x=a-k,T=L}}}else if(x+=c-v,v<E){for(E-=v;L[a++]=d[x++],--v;);x=a-k,T=L}for(;2<E;)L[a++]=T[x++],L[a++]=T[x++],L[a++]=T[x++],E-=3;E&&(L[a++]=T[x++],1<E&&(L[a++]=T[x++]))}else{for(x=a-k;L[a++]=L[x++],L[a++]=L[x++],L[a++]=L[x++],2<(E-=3););E&&(L[a++]=L[x++],1<E&&(L[a++]=L[x++]))}break}}break}}while(i<s&&a<l);p&=(1<<(_-=(E=_>>3)<<3))-1,e.next_in=i-=E,e.next_out=a,e.avail_in=i<s?s-i+5:5-(i-s),e.avail_out=a<l?l-a+257:257-(a-l),n.hold=p,n.bits=_}},{}],45:[function(t,e,r){"use strict";var O=t("../utils/common"),R=t("./adler32"),I=t("./crc32"),C=t("./inffast"),B=t("./inftrees"),n=0,M=1,N=2,i=4,s=5,a=6,D=0,o=1,l=2,z=-2,h=-3,f=-4,u=-5,c=8,P=1,d=2,p=3,_=4,g=5,b=6,m=7,y=8,w=9,v=10,E=11,k=12,x=13,T=14,S=15,L=16,A=17,U=18,j=19,F=20,Z=21,H=22,Y=23,q=24,W=25,G=26,K=27,V=28,X=29,J=30,$=31,Q=32,tt=852,et=592,rt=15,nt=15;function it(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}function st(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new O.Buf16(320),this.work=new O.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function at(t){var e;return t&&t.state?(e=t.state,t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=P,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new O.Buf32(tt),e.distcode=e.distdyn=new O.Buf32(et),e.sane=1,e.back=-1,D):z}function ot(t){var e;return t&&t.state?((e=t.state).wsize=0,e.whave=0,e.wnext=0,at(t)):z}function lt(t,e){var r,n;return t&&t.state?(n=t.state,e<0?(r=0,e=-e):(r=1+(e>>4),e<48&&(e&=15)),e&&(e<8||15<e)?z:(null!==n.window&&n.wbits!==e&&(n.window=null),n.wrap=r,n.wbits=e,ot(t))):z}function ht(t,e){var r,n;return t?(n=new st,(t.state=n).window=null,(r=lt(t,e))!==D&&(t.state=null),r):z}function ft(t){return ht(t,15)}var ut=!0,ct,dt;function pt(t){if(ut){var e;for(ct=new O.Buf32(512),dt=new O.Buf32(32),e=0;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(B(M,t.lens,0,288,ct,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;B(N,t.lens,0,32,dt,0,t.work,{bits:5}),ut=!1}t.lencode=ct,t.lenbits=9,t.distcode=dt,t.distbits=5}function _t(t,e,r,n){var i,s=t.state;return null===s.window&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new O.Buf8(s.wsize)),n>=s.wsize?(O.arraySet(s.window,e,r-s.wsize,s.wsize,0),s.wnext=0,s.whave=s.wsize):(n<(i=s.wsize-s.wnext)&&(i=n),O.arraySet(s.window,e,r-n,i,s.wnext),(n-=i)?(O.arraySet(s.window,e,r-n,n,0),s.wnext=n,s.whave=s.wsize):(s.wnext+=i,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=i))),0}function gt(t,e){var r,n,i,s,a,o,l,h,f,u,c,d,p,_,g=0,b,m,y,w,v,E,k,x,T=new O.Buf8(4),S,L,A=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return z;12===(r=t.state).mode&&(r.mode=13),a=t.next_out,i=t.output,l=t.avail_out,s=t.next_in,n=t.input,o=t.avail_in,h=r.hold,f=r.bits,u=o,c=l,x=D;t:for(;;)switch(r.mode){case P:if(0===r.wrap){r.mode=13;break}for(;f<16;){if(0===o)break t;o--,h+=n[s++]<<f,f+=8}if(2&r.wrap&&35615===h){T[r.check=0]=255&h,T[1]=h>>>8&255,r.check=I(r.check,T,2,0),f=h=0,r.mode=2;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&h)<<8)+(h>>8))%31){t.msg="incorrect header check",r.mode=30;break}if(8!=(15&h)){t.msg="unknown compression method",r.mode=30;break}if(f-=4,k=8+(15&(h>>>=4)),0===r.wbits)r.wbits=k;else if(k>r.wbits){t.msg="invalid window size",r.mode=30;break}r.dmax=1<<k,t.adler=r.check=1,r.mode=512&h?10:12,f=h=0;break;case 2:for(;f<16;){if(0===o)break t;o--,h+=n[s++]<<f,f+=8}if(r.flags=h,8!=(255&r.flags)){t.msg="unknown compression method",r.mode=30;break}if(57344&r.flags){t.msg="unknown header flags set",r.mode=30;break}r.head&&(r.head.text=h>>8&1),512&r.flags&&(T[0]=255&h,T[1]=h>>>8&255,r.check=I(r.check,T,2,0)),f=h=0,r.mode=3;case 3:for(;f<32;){if(0===o)break t;o--,h+=n[s++]<<f,f+=8}r.head&&(r.head.time=h),512&r.flags&&(T[0]=255&h,T[1]=h>>>8&255,T[2]=h>>>16&255,T[3]=h>>>24&255,r.check=I(r.check,T,4,0)),f=h=0,r.mode=4;case 4:for(;f<16;){if(0===o)break t;o--,h+=n[s++]<<f,f+=8}r.head&&(r.head.xflags=255&h,r.head.os=h>>8),512&r.flags&&(T[0]=255&h,T[1]=h>>>8&255,r.check=I(r.check,T,2,0)),f=h=0,r.mode=5;case 5:if(1024&r.flags){for(;f<16;){if(0===o)break t;o--,h+=n[s++]<<f,f+=8}r.length=h,r.head&&(r.head.extra_len=h),512&r.flags&&(T[0]=255&h,T[1]=h>>>8&255,r.check=I(r.check,T,2,0)),f=h=0}else r.head&&(r.head.extra=null);r.mode=6;case 6:if(1024&r.flags&&((d=o<(d=r.length)?o:d)&&(r.head&&(k=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Array(r.head.extra_len)),O.arraySet(r.head.extra,n,s,d,k)),512&r.flags&&(r.check=I(r.check,n,d,s)),o-=d,s+=d,r.length-=d),r.length))break t;r.length=0,r.mode=7;case 7:if(2048&r.flags){if(0===o)break t;for(d=0;k=n[s+d++],r.head&&k&&r.length<65536&&(r.head.name+=String.fromCharCode(k)),k&&d<o;);if(512&r.flags&&(r.check=I(r.check,n,d,s)),o-=d,s+=d,k)break t}else r.head&&(r.head.name=null);r.length=0,r.mode=8;case 8:if(4096&r.flags){if(0===o)break t;for(d=0;k=n[s+d++],r.head&&k&&r.length<65536&&(r.head.comment+=String.fromCharCode(k)),k&&d<o;);if(512&r.flags&&(r.check=I(r.check,n,d,s)),o-=d,s+=d,k)break t}else r.head&&(r.head.comment=null);r.mode=9;case 9:if(512&r.flags){for(;f<16;){if(0===o)break t;o--,h+=n[s++]<<f,f+=8}if(h!==(65535&r.check)){t.msg="header crc mismatch",r.mode=30;break}f=h=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),t.adler=r.check=0,r.mode=12;break;case 10:for(;f<32;){if(0===o)break t;o--,h+=n[s++]<<f,f+=8}t.adler=r.check=it(h),f=h=0,r.mode=11;case 11:if(0===r.havedict)return t.next_out=a,t.avail_out=l,t.next_in=s,t.avail_in=o,r.hold=h,r.bits=f,2;t.adler=r.check=1,r.mode=12;case 12:if(5===e||6===e)break t;case 13:if(r.last){h>>>=7&f,f-=7&f,r.mode=27;break}for(;f<3;){if(0===o)break t;o--,h+=n[s++]<<f,f+=8}switch(r.last=1&h,--f,3&(h>>>=1)){case 0:r.mode=14;break;case 1:if(pt(r),r.mode=20,6!==e)break;h>>>=2,f-=2;break t;case 2:r.mode=17;break;case 3:t.msg="invalid block type",r.mode=30}h>>>=2,f-=2;break;case 14:for(h>>>=7&f,f-=7&f;f<32;){if(0===o)break t;o--,h+=n[s++]<<f,f+=8}if((65535&h)!=(h>>>16^65535)){t.msg="invalid stored block lengths",r.mode=30;break}if(r.length=65535&h,f=h=0,r.mode=15,6===e)break t;case 15:r.mode=16;case 16:if(d=r.length){if(0===(d=l<(d=o<d?o:d)?l:d))break t;O.arraySet(i,n,s,d,a),o-=d,s+=d,l-=d,a+=d,r.length-=d;break}r.mode=12;break;case 17:for(;f<14;){if(0===o)break t;o--,h+=n[s++]<<f,f+=8}if(r.nlen=257+(31&h),h>>>=5,f-=5,r.ndist=1+(31&h),h>>>=5,f-=5,r.ncode=4+(15&h),h>>>=4,f-=4,286<r.nlen||30<r.ndist){t.msg="too many length or distance symbols",r.mode=30;break}r.have=0,r.mode=18;case 18:for(;r.have<r.ncode;){for(;f<3;){if(0===o)break t;o--,h+=n[s++]<<f,f+=8}r.lens[A[r.have++]]=7&h,h>>>=3,f-=3}for(;r.have<19;)r.lens[A[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,S={bits:r.lenbits},x=B(0,r.lens,0,19,r.lencode,0,r.work,S),r.lenbits=S.bits,x){t.msg="invalid code lengths set",r.mode=30;break}r.have=0,r.mode=19;case 19:for(;r.have<r.nlen+r.ndist;){for(;m=(g=r.lencode[h&(1<<r.lenbits)-1])>>>16&255,y=65535&g,!((b=g>>>24)<=f);){if(0===o)break t;o--,h+=n[s++]<<f,f+=8}if(y<16)h>>>=b,f-=b,r.lens[r.have++]=y;else{if(16===y){for(L=b+2;f<L;){if(0===o)break t;o--,h+=n[s++]<<f,f+=8}if(h>>>=b,f-=b,0===r.have){t.msg="invalid bit length repeat",r.mode=30;break}k=r.lens[r.have-1],d=3+(3&h),h>>>=2,f-=2}else if(17===y){for(L=b+3;f<L;){if(0===o)break t;o--,h+=n[s++]<<f,f+=8}f-=b,k=0,d=3+(7&(h>>>=b)),h>>>=3,f-=3}else{for(L=b+7;f<L;){if(0===o)break t;o--,h+=n[s++]<<f,f+=8}f-=b,k=0,d=11+(127&(h>>>=b)),h>>>=7,f-=7}if(r.have+d>r.nlen+r.ndist){t.msg="invalid bit length repeat",r.mode=30;break}for(;d--;)r.lens[r.have++]=k}}if(30===r.mode)break;if(0===r.lens[256]){t.msg="invalid code -- missing end-of-block",r.mode=30;break}if(r.lenbits=9,S={bits:r.lenbits},x=B(M,r.lens,0,r.nlen,r.lencode,0,r.work,S),r.lenbits=S.bits,x){t.msg="invalid literal/lengths set",r.mode=30;break}if(r.distbits=6,r.distcode=r.distdyn,S={bits:r.distbits},x=B(N,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,S),r.distbits=S.bits,x){t.msg="invalid distances set",r.mode=30;break}if(r.mode=20,6===e)break t;case 20:r.mode=21;case 21:if(6<=o&&258<=l){t.next_out=a,t.avail_out=l,t.next_in=s,t.avail_in=o,r.hold=h,r.bits=f,C(t,c),a=t.next_out,i=t.output,l=t.avail_out,s=t.next_in,n=t.input,o=t.avail_in,h=r.hold,f=r.bits,12===r.mode&&(r.back=-1);break}for(r.back=0;m=(g=r.lencode[h&(1<<r.lenbits)-1])>>>16&255,y=65535&g,!((b=g>>>24)<=f);){if(0===o)break t;o--,h+=n[s++]<<f,f+=8}if(m&&0==(240&m)){for(w=b,v=m,E=y;m=(g=r.lencode[E+((h&(1<<w+v)-1)>>w)])>>>16&255,y=65535&g,!(w+(b=g>>>24)<=f);){if(0===o)break t;o--,h+=n[s++]<<f,f+=8}h>>>=w,f-=w,r.back+=w}if(h>>>=b,f-=b,r.back+=b,r.length=y,0===m){r.mode=26;break}if(32&m){r.back=-1,r.mode=12;break}if(64&m){t.msg="invalid literal/length code",r.mode=30;break}r.extra=15&m,r.mode=22;case 22:if(r.extra){for(L=r.extra;f<L;){if(0===o)break t;o--,h+=n[s++]<<f,f+=8}r.length+=h&(1<<r.extra)-1,h>>>=r.extra,f-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=23;case 23:for(;m=(g=r.distcode[h&(1<<r.distbits)-1])>>>16&255,y=65535&g,!((b=g>>>24)<=f);){if(0===o)break t;o--,h+=n[s++]<<f,f+=8}if(0==(240&m)){for(w=b,v=m,E=y;m=(g=r.distcode[E+((h&(1<<w+v)-1)>>w)])>>>16&255,y=65535&g,!(w+(b=g>>>24)<=f);){if(0===o)break t;o--,h+=n[s++]<<f,f+=8}h>>>=w,f-=w,r.back+=w}if(h>>>=b,f-=b,r.back+=b,64&m){t.msg="invalid distance code",r.mode=30;break}r.offset=y,r.extra=15&m,r.mode=24;case 24:if(r.extra){for(L=r.extra;f<L;){if(0===o)break t;o--,h+=n[s++]<<f,f+=8}r.offset+=h&(1<<r.extra)-1,h>>>=r.extra,f-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){t.msg="invalid distance too far back",r.mode=30;break}r.mode=25;case 25:if(0===l)break t;if(r.offset>(d=c-l)){if((d=r.offset-d)>r.whave&&r.sane){t.msg="invalid distance too far back",r.mode=30;break}p=d>r.wnext?(d-=r.wnext,r.wsize-d):r.wnext-d,d>r.length&&(d=r.length),_=r.window}else _=i,p=a-r.offset,d=r.length;for(l-=d=l<d?l:d,r.length-=d;i[a++]=_[p++],--d;);0===r.length&&(r.mode=21);break;case 26:if(0===l)break t;i[a++]=r.length,l--,r.mode=21;break;case 27:if(r.wrap){for(;f<32;){if(0===o)break t;o--,h|=n[s++]<<f,f+=8}if(c-=l,t.total_out+=c,r.total+=c,c&&(t.adler=r.check=(r.flags?I:R)(r.check,i,c,a-c)),c=l,(r.flags?h:it(h))!==r.check){t.msg="incorrect data check",r.mode=30;break}f=h=0}r.mode=28;case 28:if(r.wrap&&r.flags){for(;f<32;){if(0===o)break t;o--,h+=n[s++]<<f,f+=8}if(h!==(4294967295&r.total)){t.msg="incorrect length check",r.mode=30;break}f=h=0}r.mode=29;case 29:x=1;break t;case 30:x=-3;break t;case 31:return-4;default:return z}return t.next_out=a,t.avail_out=l,t.next_in=s,t.avail_in=o,r.hold=h,r.bits=f,(r.wsize||c!==t.avail_out&&r.mode<30&&(r.mode<27||4!==e))&&_t(t,t.output,t.next_out,c-t.avail_out)?(r.mode=31,-4):(u-=t.avail_in,c-=t.avail_out,t.total_in+=u,t.total_out+=c,r.total+=c,r.wrap&&c&&(t.adler=r.check=(r.flags?I:R)(r.check,i,c,t.next_out-c)),t.data_type=r.bits+(r.last?64:0)+(12===r.mode?128:0)+(20===r.mode||15===r.mode?256:0),(0==u&&0===c||4===e)&&x===D?-5:x)}function bt(t){if(!t||!t.state)return z;var e=t.state;return e.window&&(e.window=null),t.state=null,D}function mt(t,e){var r;return!t||!t.state||0==(2&(r=t.state).wrap)?z:((r.head=e).done=!1,D)}function yt(t,e){var r=e.length,n,i,s;return!t||!t.state||0!==(n=t.state).wrap&&11!==n.mode?z:11===n.mode&&(i=R(i=1,e,r,0))!==n.check?-3:(s=_t(t,e,r,r))?(n.mode=31,-4):(n.havedict=1,D)}r.inflateReset=ot,r.inflateReset2=lt,r.inflateResetKeep=at,r.inflateInit=ft,r.inflateInit2=ht,r.inflate=gt,r.inflateEnd=bt,r.inflateGetHeader=mt,r.inflateSetDictionary=yt,r.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":39,"./adler32":40,"./crc32":42,"./inffast":44,"./inftrees":46}],46:[function(t,e,r){"use strict";var N=t("../utils/common"),n=15,D=852,z=592,i=0,s=1,a=2,P=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],U=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],j=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],F=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function t(e,r,n,i,s,a,o,l){for(var h=l.bits,f=0,u=0,c=0,d=0,p=0,_=0,g=0,b=0,m=0,y=0,w,v,E,k,x,T=null,S=0,L,A=new N.Buf16(16),O=new N.Buf16(16),R=null,I=0,C,B,M,f=0;f<=15;f++)A[f]=0;for(u=0;u<i;u++)A[r[n+u]]++;for(p=h,d=15;1<=d&&0===A[d];d--);if(d<p&&(p=d),0===d)return s[a++]=20971520,s[a++]=20971520,l.bits=1,0;for(c=1;c<d&&0===A[c];c++);for(p<c&&(p=c),f=b=1;f<=15;f++)if(b<<=1,(b-=A[f])<0)return-1;if(0<b&&(0===e||1!==d))return-1;for(O[1]=0,f=1;f<15;f++)O[f+1]=O[f]+A[f];for(u=0;u<i;u++)0!==r[n+u]&&(o[O[r[n+u]]++]=u);if(L=0===e?(T=R=o,19):1===e?(T=P,S-=257,R=U,I-=257,256):(T=j,R=F,-1),f=c,x=a,g=u=y=0,E=-1,k=(m=1<<(_=p))-1,1===e&&D<m||2===e&&z<m)return 1;for(;;){for(M=o[u]<L?(B=0,o[u]):o[u]>L?(B=R[I+o[u]],T[S+o[u]]):(B=96,0),w=1<<(C=f-g),c=v=1<<_;s[x+(y>>g)+(v-=w)]=C<<24|B<<16|M|0,0!==v;);for(w=1<<f-1;y&w;)w>>=1;if(0!==w?(y&=w-1,y+=w):y=0,u++,0==--A[f]){if(f===d)break;f=r[n+o[u]]}if(p<f&&(y&k)!==E){for(x+=c,b=1<<(_=f-(g=0===g?p:g));_+g<d&&!((b-=A[_+g])<=0);)_++,b<<=1;if(m+=1<<_,1===e&&D<m||2===e&&z<m)return 1;s[E=y&k]=p<<24|_<<16|x-a|0}}return 0!==y&&(s[x+y]=f-g<<24|64<<16|0),l.bits=p,0}},{"../utils/common":39}],47:[function(t,e,r){"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],48:[function(t,e,r){"use strict";var i=t("../utils/common"),n=4,s=0,a=1,o=2;function l(t){for(var e=t.length;0<=--e;)t[e]=0}var h=0,f=1,u=2,c=3,d=258,p=29,_=256,g=_+1+p,b=30,m=19,y=2*g+1,w=15,v=16,E=7,k=256,x=16,T=17,S=18,L=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],A=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],O=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],R=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],I=512,C=new Array(2*(g+2));l(C);var B=new Array(2*b);l(B);var M=new Array(I);l(M);var N=new Array(256);l(N);var D=new Array(p);l(D);var z=new Array(b),P,U,j;function F(t,e,r,n,i){this.static_tree=t,this.extra_bits=e,this.extra_base=r,this.elems=n,this.max_length=i,this.has_stree=t&&t.length}function Z(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}function H(t){return t<256?M[t]:M[256+(t>>>7)]}function Y(t,e){t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255}function q(t,e,r){t.bi_valid>v-r?(t.bi_buf|=e<<t.bi_valid&65535,Y(t,t.bi_buf),t.bi_buf=e>>v-t.bi_valid,t.bi_valid+=r-v):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=r)}function W(t,e,r){q(t,r[2*e],r[2*e+1])}function G(t,e){for(var r=0;r|=1&t,t>>>=1,r<<=1,0<--e;);return r>>>1}function K(t){16===t.bi_valid?(Y(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):8<=t.bi_valid&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}function V(t,e){for(var r=e.dyn_tree,n=e.max_code,i=e.stat_desc.static_tree,s=e.stat_desc.has_stree,a=e.stat_desc.extra_bits,o=e.stat_desc.extra_base,l=e.stat_desc.max_length,h,f,u,c,d,p,_=0,c=0;c<=w;c++)t.bl_count[c]=0;for(r[2*t.heap[t.heap_max]+1]=0,h=t.heap_max+1;h<y;h++)l<(c=r[2*r[2*(f=t.heap[h])+1]+1]+1)&&(c=l,_++),r[2*f+1]=c,n<f||(t.bl_count[c]++,d=0,o<=f&&(d=a[f-o]),p=r[2*f],t.opt_len+=p*(c+d),s&&(t.static_len+=p*(i[2*f+1]+d)));if(0!==_){do{for(c=l-1;0===t.bl_count[c];)c--}while(t.bl_count[c]--,t.bl_count[c+1]+=2,t.bl_count[l]--,0<(_-=2));for(c=l;0!==c;c--)for(f=t.bl_count[c];0!==f;)n<(u=t.heap[--h])||(r[2*u+1]!==c&&(t.opt_len+=(c-r[2*u+1])*r[2*u],r[2*u+1]=c),f--)}}function X(t,e,r){for(var n=new Array(w+1),i=0,s,a,s=1;s<=w;s++)n[s]=i=i+r[s-1]<<1;for(a=0;a<=e;a++){var o=t[2*a+1];0!==o&&(t[2*a]=G(n[o]++,o))}}function J(){for(var t,e,r,n,i,s=new Array(w+1),r=0,n=0;n<p-1;n++)for(D[n]=r,t=0;t<1<<L[n];t++)N[r++]=n;for(N[r-1]=n,n=i=0;n<16;n++)for(z[n]=i,t=0;t<1<<A[n];t++)M[i++]=n;for(i>>=7;n<b;n++)for(z[n]=i<<7,t=0;t<1<<A[n]-7;t++)M[256+i++]=n;for(e=0;e<=w;e++)s[e]=0;for(t=0;t<=143;)C[2*t+1]=8,t++,s[8]++;for(;t<=255;)C[2*t+1]=9,t++,s[9]++;for(;t<=279;)C[2*t+1]=7,t++,s[7]++;for(;t<=287;)C[2*t+1]=8,t++,s[8]++;for(X(C,g+1,s),t=0;t<b;t++)B[2*t+1]=5,B[2*t]=G(t,5);P=new F(C,L,_+1,g,w),U=new F(B,A,0,b,w),j=new F(new Array(0),O,0,m,E)}function $(t){for(var e,e=0;e<g;e++)t.dyn_ltree[2*e]=0;for(e=0;e<b;e++)t.dyn_dtree[2*e]=0;for(e=0;e<m;e++)t.bl_tree[2*e]=0;t.dyn_ltree[2*k]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0}function Q(t){8<t.bi_valid?Y(t,t.bi_buf):0<t.bi_valid&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0}function tt(t,e,r,n){Q(t),n&&(Y(t,r),Y(t,~r)),i.arraySet(t.pending_buf,t.window,e,r,t.pending),t.pending+=r}function et(t,e,r,n){var i=2*e,s=2*r;return t[i]<t[s]||t[i]===t[s]&&n[e]<=n[r]}function rt(t,e,r){for(var n=t.heap[r],i=r<<1;i<=t.heap_len&&(i<t.heap_len&&et(e,t.heap[i+1],t.heap[i],t.depth)&&i++,!et(e,n,t.heap[i],t.depth));)t.heap[r]=t.heap[i],r=i,i<<=1;t.heap[r]=n}function nt(t,e,r){var n,i,s=0,a,o;if(0!==t.last_lit)for(;n=t.pending_buf[t.d_buf+2*s]<<8|t.pending_buf[t.d_buf+2*s+1],i=t.pending_buf[t.l_buf+s],s++,0==n?W(t,i,e):(W(t,(a=N[i])+_+1,e),0!==(o=L[a])&&q(t,i-=D[a],o),W(t,a=H(--n),r),0!==(o=A[a])&&q(t,n-=z[a],o)),s<t.last_lit;);W(t,k,e)}function it(t,e){var r=e.dyn_tree,n=e.stat_desc.static_tree,i=e.stat_desc.has_stree,s=e.stat_desc.elems,a,o,l=-1,h;for(t.heap_len=0,t.heap_max=y,a=0;a<s;a++)0!==r[2*a]?(t.heap[++t.heap_len]=l=a,t.depth[a]=0):r[2*a+1]=0;for(;t.heap_len<2;)r[2*(h=t.heap[++t.heap_len]=l<2?++l:0)]=1,t.depth[h]=0,t.opt_len--,i&&(t.static_len-=n[2*h+1]);for(e.max_code=l,a=t.heap_len>>1;1<=a;a--)rt(t,r,a);for(h=s;a=t.heap[1],t.heap[1]=t.heap[t.heap_len--],rt(t,r,1),o=t.heap[1],t.heap[--t.heap_max]=a,t.heap[--t.heap_max]=o,r[2*h]=r[2*a]+r[2*o],t.depth[h]=(t.depth[a]>=t.depth[o]?t.depth[a]:t.depth[o])+1,r[2*a+1]=r[2*o+1]=h,t.heap[1]=h++,rt(t,r,1),2<=t.heap_len;);t.heap[--t.heap_max]=t.heap[1],V(t,e),X(r,l,t.bl_count)}function st(t,e,r){var n,i=-1,s,a=e[1],o=0,l=7,h=4;for(0===a&&(l=138,h=3),e[2*(r+1)+1]=65535,n=0;n<=r;n++)s=a,a=e[2*(n+1)+1],++o<l&&s===a||(o<h?t.bl_tree[2*s]+=o:0!==s?(s!==i&&t.bl_tree[2*s]++,t.bl_tree[2*x]++):o<=10?t.bl_tree[2*T]++:t.bl_tree[2*S]++,i=s,h=(o=0)===a?(l=138,3):s===a?(l=6,3):(l=7,4))}function at(t,e,r){var n,i=-1,s,a=e[1],o=0,l=7,h=4;for(0===a&&(l=138,h=3),n=0;n<=r;n++)if(s=a,a=e[2*(n+1)+1],!(++o<l&&s===a)){if(o<h)for(;W(t,s,t.bl_tree),0!=--o;);else 0!==s?(s!==i&&(W(t,s,t.bl_tree),o--),W(t,x,t.bl_tree),q(t,o-3,2)):o<=10?(W(t,T,t.bl_tree),q(t,o-3,3)):(W(t,S,t.bl_tree),q(t,o-11,7));i=s,h=(o=0)===a?(l=138,3):s===a?(l=6,3):(l=7,4)}}function ot(t){var e;for(st(t,t.dyn_ltree,t.l_desc.max_code),st(t,t.dyn_dtree,t.d_desc.max_code),it(t,t.bl_desc),e=m-1;3<=e&&0===t.bl_tree[2*R[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e}function lt(t,e,r,n){var i;for(q(t,e-257,5),q(t,r-1,5),q(t,n-4,4),i=0;i<n;i++)q(t,t.bl_tree[2*R[i]+1],3);at(t,t.dyn_ltree,e-1),at(t,t.dyn_dtree,r-1)}function ht(t){for(var e=4093624447,r,r=0;r<=31;r++,e>>>=1)if(1&e&&0!==t.dyn_ltree[2*r])return s;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return a;for(r=32;r<_;r++)if(0!==t.dyn_ltree[2*r])return a;return s}l(z);var ft=!1;function ut(t){ft||(J(),ft=!0),t.l_desc=new Z(t.dyn_ltree,P),t.d_desc=new Z(t.dyn_dtree,U),t.bl_desc=new Z(t.bl_tree,j),t.bi_buf=0,t.bi_valid=0,$(t)}function ct(t,e,r,n){q(t,0+(n?1:0),3),tt(t,e,r,!0)}function dt(t){q(t,2,3),W(t,k,C),K(t)}function pt(t,e,r,n){var i,s,a=0;0<t.level?(2===t.strm.data_type&&(t.strm.data_type=ht(t)),it(t,t.l_desc),it(t,t.d_desc),a=ot(t),i=t.opt_len+3+7>>>3,(s=t.static_len+3+7>>>3)<=i&&(i=s)):i=s=r+5,r+4<=i&&-1!==e?ct(t,e,r,n):4===t.strategy||s===i?(q(t,2+(n?1:0),3),nt(t,C,B)):(q(t,4+(n?1:0),3),lt(t,t.l_desc.max_code+1,t.d_desc.max_code+1,a+1),nt(t,t.dyn_ltree,t.dyn_dtree)),$(t),n&&Q(t)}function _t(t,e,r){return t.pending_buf[t.d_buf+2*t.last_lit]=e>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&e,t.pending_buf[t.l_buf+t.last_lit]=255&r,t.last_lit++,0===e?t.dyn_ltree[2*r]++:(t.matches++,e--,t.dyn_ltree[2*(N[r]+_+1)]++,t.dyn_dtree[2*H(e)]++),t.last_lit===t.lit_bufsize-1}r._tr_init=ut,r._tr_stored_block=ct,r._tr_flush_block=pt,r._tr_tally=_t,r._tr_align=dt},{"../utils/common":39}],49:[function(t,e,r){"use strict";function n(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}e.exports=n},{}],50:[function(t,e,r){!function(o){"use strict";function t(e,r,n,i){if("function"!=typeof e)throw new TypeError('"callback" argument must be a function');var t=arguments.length,s,a;switch(t){case 0:case 1:return o.nextTick(e);case 2:return o.nextTick(function t(){e.call(null,r)});case 3:return o.nextTick(function t(){e.call(null,r,n)});case 4:return o.nextTick(function t(){e.call(null,r,n,i)});default:for(s=new Array(t-1),a=0;a<s.length;)s[a++]=arguments[a];return o.nextTick(function t(){e.apply(null,s)})}}void 0===o||!o.version||0===o.version.indexOf("v0.")||0===o.version.indexOf("v1.")&&0!==o.version.indexOf("v1.8.")?e.exports={nextTick:t}:e.exports=o}.call(this,t("_process"))},{_process:51}],51:[function(t,e,r){var n=e.exports={},i,s;function a(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function l(e){if(i===setTimeout)return setTimeout(e,0);if((i===a||!i)&&setTimeout)return i=setTimeout,setTimeout(e,0);try{return i(e,0)}catch(t){try{return i.call(null,e,0)}catch(t){return i.call(this,e,0)}}}function h(e){if(s===clearTimeout)return clearTimeout(e);if((s===o||!s)&&clearTimeout)return s=clearTimeout,clearTimeout(e);try{return s(e)}catch(t){try{return s.call(null,e)}catch(t){return s.call(this,e)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:a}catch(t){i=a}try{s="function"==typeof clearTimeout?clearTimeout:o}catch(t){s=o}}();var f=[],u=!1,c,d=-1;function p(){u&&c&&(u=!1,c.length?f=c.concat(f):d=-1,f.length&&_())}function _(){if(!u){var t=l(p);u=!0;for(var e=f.length;e;){for(c=f,f=[];++d<e;)c&&c[d].run();d=-1,e=f.length}c=null,u=!1,h(t)}}function g(t,e){this.fun=t,this.array=e}function b(){}n.nextTick=function(t){var e=new Array(arguments.length-1);if(1<arguments.length)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];f.push(new g(t,e)),1!==f.length||u||l(_)},g.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=b,n.addListener=b,n.once=b,n.off=b,n.removeListener=b,n.removeAllListeners=b,n.emit=b,n.prependListener=b,n.prependOnceListener=b,n.listeners=function(t){return[]},n.binding=function(t){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(t){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}},{}],52:[function(t,e,r){e.exports=t("./lib/_stream_duplex.js")},{"./lib/_stream_duplex.js":53}],53:[function(t,e,r){"use strict";var n=t("process-nextick-args"),i=Object.keys||function(t){var e=[],r;for(r in t)e.push(r);return e};e.exports=u;var s=Object.create(t("core-util-is"));s.inherits=t("inherits");var a=t("./_stream_readable"),o=t("./_stream_writable");s.inherits(u,a);for(var l=i(o.prototype),h=0;h<l.length;h++){var f=l[h];u.prototype[f]||(u.prototype[f]=o.prototype[f])}function u(t){if(!(this instanceof u))return new u(t);a.call(this,t),o.call(this,t),t&&!1===t.readable&&(this.readable=!1),t&&!1===t.writable&&(this.writable=!1),this.allowHalfOpen=!0,t&&!1===t.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",c)}function c(){this.allowHalfOpen||this._writableState.ended||n.nextTick(d,this)}function d(t){t.end()}Object.defineProperty(u.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(u.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(t){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=t,this._writableState.destroyed=t)}}),u.prototype._destroy=function(t,e){this.push(null),this.end(),n.nextTick(e,t)}},{"./_stream_readable":55,"./_stream_writable":57,"core-util-is":32,inherits:35,"process-nextick-args":50}],54:[function(t,e,r){"use strict";e.exports=s;var n=t("./_stream_transform"),i=Object.create(t("core-util-is"));function s(t){if(!(this instanceof s))return new s(t);n.call(this,t)}i.inherits=t("inherits"),i.inherits(s,n),s.prototype._transform=function(t,e,r){r(null,t)}},{"./_stream_transform":56,"core-util-is":32,inherits:35}],55:[function(W,G,t){!function(b,t){"use strict";var m=W("process-nextick-args");G.exports=g;var n=W("isarray"),a;g.ReadableState=_;var e=W("events").EventEmitter,y=function(t,e){return t.listeners(e).length},i=W("./internal/streams/stream"),o=W("safe-buffer").Buffer,r=t.Uint8Array||function(){};function l(t){return o.from(t)}function s(t){return o.isBuffer(t)||t instanceof r}var h=Object.create(W("core-util-is"));h.inherits=W("inherits");var f=W("util"),w=void 0,w=f&&f.debuglog?f.debuglog("stream"):function(){},u=W("./internal/streams/BufferList"),c=W("./internal/streams/destroy"),d;h.inherits(g,i);var p=["error","close","destroy","pause","resume"];function v(t,e,r){if("function"==typeof t.prependListener)return t.prependListener(e,r);t._events&&t._events[e]?n(t._events[e])?t._events[e].unshift(r):t._events[e]=[r,t._events[e]]:t.on(e,r)}function _(t,e){var r=e instanceof(a=a||W("./_stream_duplex"));this.objectMode=!!(t=t||{}).objectMode,r&&(this.objectMode=this.objectMode||!!t.readableObjectMode);var n=t.highWaterMark,i=t.readableHighWaterMark,s=this.objectMode?16:16384;this.highWaterMark=n||0===n?n:r&&(i||0===i)?i:s,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new u,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=t.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(d=d||W("string_decoder/").StringDecoder,this.decoder=new d(t.encoding),this.encoding=t.encoding)}function g(t){if(a=a||W("./_stream_duplex"),!(this instanceof g))return new g(t);this._readableState=new _(t,this),this.readable=!0,t&&("function"==typeof t.read&&(this._read=t.read),"function"==typeof t.destroy&&(this._destroy=t.destroy)),i.call(this)}function E(t,e,r,n,i){var s=t._readableState,a;return null===e?(s.reading=!1,O(t,s)):(a=!i?x(s,e):a)?t.emit("error",a):s.objectMode||e&&0<e.length?("string"==typeof e||s.objectMode||Object.getPrototypeOf(e)===o.prototype||(e=l(e)),n?s.endEmitted?t.emit("error",new Error("stream.unshift() after end event")):k(t,s,e,!0):s.ended?t.emit("error",new Error("stream.push() after EOF")):(s.reading=!1,s.decoder&&!r?(e=s.decoder.write(e),s.objectMode||0!==e.length?k(t,s,e,!1):C(t,s)):k(t,s,e,!1))):n||(s.reading=!1),T(s)}function k(t,e,r,n){e.flowing&&0===e.length&&!e.sync?(t.emit("data",r),t.read(0)):(e.length+=e.objectMode?1:r.length,n?e.buffer.unshift(r):e.buffer.push(r),e.needReadable&&R(t)),C(t,e)}function x(t,e){var r;return r=!s(e)&&"string"!=typeof e&&void 0!==e&&!t.objectMode?new TypeError("Invalid non-string/buffer chunk"):r}function T(t){return!t.ended&&(t.needReadable||t.length<t.highWaterMark||0===t.length)}Object.defineProperty(g.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(t){this._readableState&&(this._readableState.destroyed=t)}}),g.prototype.destroy=c.destroy,g.prototype._undestroy=c.undestroy,g.prototype._destroy=function(t,e){this.push(null),e(t)},g.prototype.push=function(t,e){var r=this._readableState,n;return r.objectMode?n=!0:"string"==typeof t&&((e=e||r.defaultEncoding)!==r.encoding&&(t=o.from(t,e),e=""),n=!0),E(this,t,e,!1,n)},g.prototype.unshift=function(t){return E(this,t,null,!0,!1)},g.prototype.isPaused=function(){return!1===this._readableState.flowing},g.prototype.setEncoding=function(t){return d=d||W("string_decoder/").StringDecoder,this._readableState.decoder=new d(t),this._readableState.encoding=t,this};var S=8388608;function L(t){return S<=t?t=S:(t--,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,t|=t>>>16,t++),t}function A(t,e){return t<=0||0===e.length&&e.ended?0:e.objectMode?1:t!=t?(e.flowing&&e.length?e.buffer.head.data:e).length:(t>e.highWaterMark&&(e.highWaterMark=L(t)),t<=e.length?t:e.ended?e.length:(e.needReadable=!0,0))}function O(t,e){var r;e.ended||(!e.decoder||(r=e.decoder.end())&&r.length&&(e.buffer.push(r),e.length+=e.objectMode?1:r.length),e.ended=!0,R(t))}function R(t){var e=t._readableState;e.needReadable=!1,e.emittedReadable||(w("emitReadable",e.flowing),e.emittedReadable=!0,e.sync?m.nextTick(I,t):I(t))}function I(t){w("emit readable"),t.emit("readable"),P(t)}function C(t,e){e.readingMore||(e.readingMore=!0,m.nextTick(B,t,e))}function B(t,e){for(var r=e.length;!e.reading&&!e.flowing&&!e.ended&&e.length<e.highWaterMark&&(w("maybeReadMore read 0"),t.read(0),r!==e.length);)r=e.length;e.readingMore=!1}function M(e){return function(){var t=e._readableState;w("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&y(e,"data")&&(t.flowing=!0,P(e))}}function N(t){w("readable nexttick read 0"),t.read(0)}function D(t,e){e.resumeScheduled||(e.resumeScheduled=!0,m.nextTick(z,t,e))}function z(t,e){e.reading||(w("resume read 0"),t.read(0)),e.resumeScheduled=!1,e.awaitDrain=0,t.emit("resume"),P(t),e.flowing&&!e.reading&&t.read(0)}function P(t){var e=t._readableState;for(w("flow",e.flowing);e.flowing&&null!==t.read(););}function U(t,e){return 0===e.length?null:(e.objectMode?r=e.buffer.shift():!t||t>=e.length?(r=e.decoder?e.buffer.join(""):1===e.buffer.length?e.buffer.head.data:e.buffer.concat(e.length),e.buffer.clear()):r=j(t,e.buffer,e.decoder),r);var r}function j(t,e,r){var n;return t<e.head.data.length?(n=e.head.data.slice(0,t),e.head.data=e.head.data.slice(t)):n=t===e.head.data.length?e.shift():(r?F:Z)(t,e),n}function F(t,e){var r=e.head,n=1,i=r.data;for(t-=i.length;r=r.next;){var s=r.data,a=t>s.length?s.length:t;if(a===s.length?i+=s:i+=s.slice(0,t),0===(t-=a)){a===s.length?(++n,r.next?e.head=r.next:e.head=e.tail=null):(e.head=r).data=s.slice(a);break}++n}return e.length-=n,i}function Z(t,e){var r=o.allocUnsafe(t),n=e.head,i=1;for(n.data.copy(r),t-=n.data.length;n=n.next;){var s=n.data,a=t>s.length?s.length:t;if(s.copy(r,r.length-t,0,a),0===(t-=a)){a===s.length?(++i,n.next?e.head=n.next:e.head=e.tail=null):(e.head=n).data=s.slice(a);break}++i}return e.length-=i,r}function H(t){var e=t._readableState;if(0<e.length)throw new Error('"endReadable()" called on non-empty stream');e.endEmitted||(e.ended=!0,m.nextTick(Y,e,t))}function Y(t,e){t.endEmitted||0!==t.length||(t.endEmitted=!0,e.readable=!1,e.emit("end"))}function q(t,e){for(var r=0,n=t.length;r<n;r++)if(t[r]===e)return r;return-1}g.prototype.read=function(t){w("read",t),t=parseInt(t,10);var e=this._readableState,r=t;if(0!==t&&(e.emittedReadable=!1),0===t&&e.needReadable&&(e.length>=e.highWaterMark||e.ended))return w("read: emitReadable",e.length,e.ended),(0===e.length&&e.ended?H:R)(this),null;if(0===(t=A(t,e))&&e.ended)return 0===e.length&&H(this),null;var n=e.needReadable,i;return w("need readable",n),(0===e.length||e.length-t<e.highWaterMark)&&w("length less than watermark",n=!0),e.ended||e.reading?w("reading or ended",n=!1):n&&(w("do read"),e.reading=!0,e.sync=!0,0===e.length&&(e.needReadable=!0),this._read(e.highWaterMark),e.sync=!1,e.reading||(t=A(r,e))),null===(i=0<t?U(t,e):null)?(e.needReadable=!0,t=0):e.length-=t,0===e.length&&(e.ended||(e.needReadable=!0),r!==t&&e.ended&&H(this)),null!==i&&this.emit("data",i),i},g.prototype._read=function(t){this.emit("error",new Error("_read() is not implemented"))},g.prototype.pipe=function(r,t){var n=this,i=this._readableState;switch(i.pipesCount){case 0:i.pipes=r;break;case 1:i.pipes=[i.pipes,r];break;default:i.pipes.push(r)}i.pipesCount+=1,w("pipe count=%d opts=%j",i.pipesCount,t);var e,s=(!t||!1!==t.end)&&r!==b.stdout&&r!==b.stderr?o:g;function a(t,e){w("onunpipe"),t===n&&e&&!1===e.hasUnpiped&&(e.hasUnpiped=!0,f())}function o(){w("onend"),r.end()}i.endEmitted?m.nextTick(s):n.once("end",s),r.on("unpipe",a);var l=M(n);r.on("drain",l);var h=!1;function f(){w("cleanup"),r.removeListener("close",p),r.removeListener("finish",_),r.removeListener("drain",l),r.removeListener("error",d),r.removeListener("unpipe",a),n.removeListener("end",o),n.removeListener("end",g),n.removeListener("data",c),h=!0,!i.awaitDrain||r._writableState&&!r._writableState.needDrain||l()}var u=!1;function c(t){var e;w("ondata"),(u=!1)!==r.write(t)||u||((1===i.pipesCount&&i.pipes===r||1<i.pipesCount&&-1!==q(i.pipes,r))&&!h&&(w("false write response, pause",n._readableState.awaitDrain),n._readableState.awaitDrain++,u=!0),n.pause())}function d(t){w("onerror",t),g(),r.removeListener("error",d),0===y(r,"error")&&r.emit("error",t)}function p(){r.removeListener("finish",_),g()}function _(){w("onfinish"),r.removeListener("close",p),g()}function g(){w("unpipe"),n.unpipe(r)}return n.on("data",c),v(r,"error",d),r.once("close",p),r.once("finish",_),r.emit("pipe",n),i.flowing||(w("pipe resume"),n.resume()),r},g.prototype.unpipe=function(t){var e=this._readableState,r={hasUnpiped:!1};if(0===e.pipesCount)return this;if(1===e.pipesCount)return t&&t!==e.pipes||(t=t||e.pipes,e.pipes=null,e.pipesCount=0,e.flowing=!1,t&&t.emit("unpipe",this,r)),this;if(!t){var n=e.pipes,i=e.pipesCount;e.pipes=null,e.pipesCount=0,e.flowing=!1;for(var s=0;s<i;s++)n[s].emit("unpipe",this,r);return this}var a=q(e.pipes,t);return-1===a||(e.pipes.splice(a,1),--e.pipesCount,1===e.pipesCount&&(e.pipes=e.pipes[0]),t.emit("unpipe",this,r)),this},g.prototype.addListener=g.prototype.on=function(t,e){var r=i.prototype.on.call(this,t,e),n;return"data"===t?!1!==this._readableState.flowing&&this.resume():"readable"===t&&((n=this._readableState).endEmitted||n.readableListening||(n.readableListening=n.needReadable=!0,n.emittedReadable=!1,n.reading?n.length&&R(this):m.nextTick(N,this))),r},g.prototype.resume=function(){var t=this._readableState;return t.flowing||(w("resume"),t.flowing=!0,D(this,t)),this},g.prototype.pause=function(){return w("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(w("pause"),this._readableState.flowing=!1,this.emit("pause")),this},g.prototype.wrap=function(r){var n=this,i=this._readableState,s=!1,t;for(t in r.on("end",function(){var t;w("wrapped end"),!i.decoder||i.ended||(t=i.decoder.end())&&t.length&&n.push(t),n.push(null)}),r.on("data",function(t){var e;w("wrapped data"),i.decoder&&(t=i.decoder.write(t)),i.objectMode&&null==t||(i.objectMode||t&&t.length)&&(n.push(t)||(s=!0,r.pause()))}),r)void 0===this[t]&&"function"==typeof r[t]&&(this[t]=function(t){return function(){return r[t].apply(r,arguments)}}(t));for(var e=0;e<p.length;e++)r.on(p[e],this.emit.bind(this,p[e]));return this._read=function(t){w("wrapped _read",t),s&&(s=!1,r.resume())},this},Object.defineProperty(g.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),g._fromList=U}.call(this,W("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./_stream_duplex":53,"./internal/streams/BufferList":58,"./internal/streams/destroy":59,"./internal/streams/stream":60,_process:51,"core-util-is":32,events:33,inherits:35,isarray:37,"process-nextick-args":50,"safe-buffer":61,"string_decoder/":62,util:28}],56:[function(t,e,r){"use strict";e.exports=a;var n=t("./_stream_duplex"),i=Object.create(t("core-util-is"));function s(t,e){var r=this._transformState;r.transforming=!1;var n=r.writecb;if(!n)return this.emit("error",new Error("write callback called multiple times"));r.writechunk=null,(r.writecb=null)!=e&&this.push(e),n(t);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}function a(t){if(!(this instanceof a))return new a(t);n.call(this,t),this._transformState={afterTransform:s.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,t&&("function"==typeof t.transform&&(this._transform=t.transform),"function"==typeof t.flush&&(this._flush=t.flush)),this.on("prefinish",o)}function o(){var r=this;"function"==typeof this._flush?this._flush(function(t,e){l(r,t,e)}):l(this,null,null)}function l(t,e,r){if(e)return t.emit("error",e);if(null!=r&&t.push(r),t._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(t._transformState.transforming)throw new Error("Calling transform done when still transforming");return t.push(null)}i.inherits=t("inherits"),i.inherits(a,n),a.prototype.push=function(t,e){return this._transformState.needTransform=!1,n.prototype.push.call(this,t,e)},a.prototype._transform=function(t,e,r){throw new Error("_transform() is not implemented")},a.prototype._write=function(t,e,r){var n=this._transformState,i;n.writecb=r,n.writechunk=t,n.writeencoding=e,n.transforming||(i=this._readableState,(n.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark))},a.prototype._read=function(t){var e=this._transformState;null!==e.writechunk&&e.writecb&&!e.transforming?(e.transforming=!0,this._transform(e.writechunk,e.writeencoding,e.afterTransform)):e.needTransform=!0},a.prototype._destroy=function(t,e){var r=this;n.prototype._destroy.call(this,t,function(t){e(t),r.emit("close")})}},{"./_stream_duplex":53,"core-util-is":32,inherits:35}],57:[function(z,P,t){!function(t,e,r){"use strict";var a=z("process-nextick-args");function n(t,e,r){this.chunk=t,this.encoding=e,this.callback=r,this.next=null}function c(t){var e=this;this.next=null,this.entry=null,this.finish=function(){D(e,t)}}P.exports=y;var o=!t.browser&&-1<["v0.10","v0.9."].indexOf(t.version.slice(0,5))?r:a.nextTick,l;y.WritableState=m;var i=Object.create(z("core-util-is"));i.inherits=z("inherits");var s={deprecate:z("util-deprecate")},h=z("./internal/streams/stream"),f=z("safe-buffer").Buffer,u=e.Uint8Array||function(){};function d(t){return f.from(t)}function p(t){return f.isBuffer(t)||t instanceof u}var _=z("./internal/streams/destroy"),g;function b(){}function m(t,e){l=l||z("./_stream_duplex");var r=e instanceof l;this.objectMode=!!(t=t||{}).objectMode,r&&(this.objectMode=this.objectMode||!!t.writableObjectMode);var n=t.highWaterMark,i=t.writableHighWaterMark,s=this.objectMode?16:16384;this.highWaterMark=n||0===n?n:r&&(i||0===i)?i:s,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var a=(this.destroyed=!1)===t.decodeStrings;this.decodeStrings=!a,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(t){L(e,t)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new c(this)}function y(t){if(l=l||z("./_stream_duplex"),!(g.call(y,this)||this instanceof l))return new y(t);this._writableState=new m(t,this),this.writable=!0,t&&("function"==typeof t.write&&(this._write=t.write),"function"==typeof t.writev&&(this._writev=t.writev),"function"==typeof t.destroy&&(this._destroy=t.destroy),"function"==typeof t.final&&(this._final=t.final)),h.call(this)}function w(t,e){var r=new Error("write after end");t.emit("error",r),a.nextTick(e,r)}function v(t,e,r,n){var i=!0,s=!1;return null===r?s=new TypeError("May not write null values to stream"):"string"==typeof r||void 0===r||e.objectMode||(s=new TypeError("Invalid non-string/buffer chunk")),s&&(t.emit("error",s),a.nextTick(n,s),i=!1),i}function E(t,e,r){return e=!t.objectMode&&!1!==t.decodeStrings&&"string"==typeof e?f.from(e,r):e}function k(t,e,r,n,i,s){var a;r||n!==(a=E(e,n,i))&&(r=!0,i="buffer",n=a);var o=e.objectMode?1:n.length;e.length+=o;var l=e.length<e.highWaterMark,h;return l||(e.needDrain=!0),e.writing||e.corked?(h=e.lastBufferedRequest,e.lastBufferedRequest={chunk:n,encoding:i,isBuf:r,callback:s,next:null},h?h.next=e.lastBufferedRequest:e.bufferedRequest=e.lastBufferedRequest,e.bufferedRequestCount+=1):x(t,e,!1,o,n,i,s),l}function x(t,e,r,n,i,s,a){e.writelen=n,e.writecb=a,e.writing=!0,e.sync=!0,r?t._writev(i,e.onwrite):t._write(i,s,e.onwrite),e.sync=!1}function T(t,e,r,n,i){--e.pendingcb,r?(a.nextTick(i,n),a.nextTick(M,t,e),t._writableState.errorEmitted=!0,t.emit("error",n)):(i(n),t._writableState.errorEmitted=!0,t.emit("error",n),M(t,e))}function S(t){t.writing=!1,t.writecb=null,t.length-=t.writelen,t.writelen=0}function L(t,e){var r=t._writableState,n=r.sync,i=r.writecb,s;S(r),e?T(t,r,n,e,i):((s=I(r))||r.corked||r.bufferProcessing||!r.bufferedRequest||R(t,r),n?o(A,t,r,s,i):A(t,r,s,i))}function A(t,e,r,n){r||O(t,e),e.pendingcb--,n(),M(t,e)}function O(t,e){0===e.length&&e.needDrain&&(e.needDrain=!1,t.emit("drain"))}function R(t,e){e.bufferProcessing=!0;var r=e.bufferedRequest;if(t._writev&&r&&r.next){var n=e.bufferedRequestCount,i=new Array(n),s=e.corkedRequestsFree;s.entry=r;for(var a=0,o=!0;r;)(i[a]=r).isBuf||(o=!1),r=r.next,a+=1;i.allBuffers=o,x(t,e,!0,e.length,i,"",s.finish),e.pendingcb++,e.lastBufferedRequest=null,s.next?(e.corkedRequestsFree=s.next,s.next=null):e.corkedRequestsFree=new c(e),e.bufferedRequestCount=0}else{for(;r;){var l=r.chunk,h=r.encoding,f=r.callback,u;if(x(t,e,!1,e.objectMode?1:l.length,l,h,f),r=r.next,e.bufferedRequestCount--,e.writing)break}null===r&&(e.lastBufferedRequest=null)}e.bufferedRequest=r,e.bufferProcessing=!1}function I(t){return t.ending&&0===t.length&&null===t.bufferedRequest&&!t.finished&&!t.writing}function C(e,r){e._final(function(t){r.pendingcb--,t&&e.emit("error",t),r.prefinished=!0,e.emit("prefinish"),M(e,r)})}function B(t,e){e.prefinished||e.finalCalled||("function"==typeof t._final?(e.pendingcb++,e.finalCalled=!0,a.nextTick(C,t,e)):(e.prefinished=!0,t.emit("prefinish")))}function M(t,e){var r=I(e);return r&&(B(t,e),0===e.pendingcb&&(e.finished=!0,t.emit("finish"))),r}function N(t,e,r){e.ending=!0,M(t,e),r&&(e.finished?a.nextTick(r):t.once("finish",r)),e.ended=!0,t.writable=!1}function D(t,e,r){var n=t.entry;for(t.entry=null;n;){var i=n.callback;e.pendingcb--,i(r),n=n.next}e.corkedRequestsFree?e.corkedRequestsFree.next=t:e.corkedRequestsFree=t}i.inherits(y,h),m.prototype.getBuffer=function t(){for(var e=this.bufferedRequest,r=[];e;)r.push(e),e=e.next;return r},function(){try{Object.defineProperty(m.prototype,"buffer",{get:s.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(t){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(g=Function.prototype[Symbol.hasInstance],Object.defineProperty(y,Symbol.hasInstance,{value:function(t){return!!g.call(this,t)||this===y&&(t&&t._writableState instanceof m)}})):g=function(t){return t instanceof this},y.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},y.prototype.write=function(t,e,r){var n=this._writableState,i=!1,s=!n.objectMode&&p(t);return s&&!f.isBuffer(t)&&(t=d(t)),"function"==typeof e&&(r=e,e=null),e=s?"buffer":e||n.defaultEncoding,"function"!=typeof r&&(r=b),n.ended?w(this,r):(s||v(this,n,t,r))&&(n.pendingcb++,i=k(this,n,s,t,e,r)),i},y.prototype.cork=function(){var t;this._writableState.corked++},y.prototype.uncork=function(){var t=this._writableState;t.corked&&(t.corked--,t.writing||t.corked||t.finished||t.bufferProcessing||!t.bufferedRequest||R(this,t))},y.prototype.setDefaultEncoding=function t(e){if("string"==typeof e&&(e=e.toLowerCase()),!(-1<["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(y.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),y.prototype._write=function(t,e,r){r(new Error("_write() is not implemented"))},y.prototype._writev=null,y.prototype.end=function(t,e,r){var n=this._writableState;"function"==typeof t?(r=t,e=t=null):"function"==typeof e&&(r=e,e=null),null!=t&&this.write(t,e),n.corked&&(n.corked=1,this.uncork()),n.ending||n.finished||N(this,n,r)},Object.defineProperty(y.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(t){this._writableState&&(this._writableState.destroyed=t)}}),y.prototype.destroy=_.destroy,y.prototype._undestroy=_.undestroy,y.prototype._destroy=function(t,e){this.end(),e(t)}}.call(this,z("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},z("timers").setImmediate)},{"./_stream_duplex":53,"./internal/streams/destroy":59,"./internal/streams/stream":60,_process:51,"core-util-is":32,inherits:35,"process-nextick-args":50,"safe-buffer":61,timers:68,"util-deprecate":69}],58:[function(t,e,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var s=t("safe-buffer").Buffer,i=t("util");function a(t,e,r){t.copy(e,r)}function o(){n(this,o),this.head=null,this.tail=null,this.length=0}e.exports=(o.prototype.push=function t(e){var r={data:e,next:null};0<this.length?this.tail.next=r:this.head=r,this.tail=r,++this.length},o.prototype.unshift=function t(e){var r={data:e,next:this.head};0===this.length&&(this.tail=r),this.head=r,++this.length},o.prototype.shift=function t(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}},o.prototype.clear=function t(){this.head=this.tail=null,this.length=0},o.prototype.join=function t(e){if(0===this.length)return"";for(var r=this.head,n=""+r.data;r=r.next;)n+=e+r.data;return n},o.prototype.concat=function t(e){if(0===this.length)return s.alloc(0);if(1===this.length)return this.head.data;for(var r=s.allocUnsafe(e>>>0),n=this.head,i=0;n;)a(n.data,r,i),i+=n.data.length,n=n.next;return r},o),i&&i.inspect&&i.inspect.custom&&(e.exports.prototype[i.inspect.custom]=function(){var t=i.inspect({length:this.length});return this.constructor.name+" "+t})},{"safe-buffer":61,util:28}],59:[function(t,e,r){"use strict";var s=t("process-nextick-args");function n(t,e){var r=this,n=this._readableState&&this._readableState.destroyed,i=this._writableState&&this._writableState.destroyed;return n||i?e?e(t):!t||this._writableState&&this._writableState.errorEmitted||s.nextTick(a,this,t):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(t||null,function(t){!e&&t?(s.nextTick(a,r,t),r._writableState&&(r._writableState.errorEmitted=!0)):e&&e(t)})),this}function i(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function a(t,e){t.emit("error",e)}e.exports={destroy:n,undestroy:i}},{"process-nextick-args":50}],60:[function(t,e,r){e.exports=t("events").EventEmitter},{events:33}],61:[function(t,e,r){var n=t("buffer"),i=n.Buffer;function s(t,e){for(var r in t)e[r]=t[r]}function a(t,e,r){return i(t,e,r)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?e.exports=n:(s(n,r),r.Buffer=a),s(i,a),a.from=function(t,e,r){if("number"==typeof t)throw new TypeError("Argument must not be a number");return i(t,e,r)},a.alloc=function(t,e,r){if("number"!=typeof t)throw new TypeError("Argument must be a number");var n=i(t);return void 0!==e?"string"==typeof r?n.fill(e,r):n.fill(e):n.fill(0),n},a.allocUnsafe=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return i(t)},a.allocUnsafeSlow=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return n.SlowBuffer(t)}},{buffer:31}],62:[function(t,e,r){"use strict";var n=t("safe-buffer").Buffer,i=n.isEncoding||function(t){switch((t=""+t)&&t.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function s(t){if(!t)return"utf8";for(var e;;)switch(t){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return t;default:if(e)return;t=(""+t).toLowerCase(),e=!0}}function a(t){var e=s(t);if("string"!=typeof e&&(n.isEncoding===i||!i(t)))throw new Error("Unknown encoding: "+t);return e||t}function o(t){var e;switch(this.encoding=a(t),this.encoding){case"utf16le":this.text=p,this.end=_,e=4;break;case"utf8":this.fillLast=u,e=4;break;case"base64":this.text=g,this.end=b,e=3;break;default:return this.write=m,void(this.end=y)}this.lastNeed=0,this.lastTotal=0,this.lastChar=n.allocUnsafe(e)}function l(t){return t<=127?0:t>>5==6?2:t>>4==14?3:t>>3==30?4:t>>6==2?-1:-2}function h(t,e,r){var n=e.length-1;if(n<r)return 0;var i=l(e[n]);return 0<=i?(0<i&&(t.lastNeed=i-1),i):--n<r||-2===i?0:0<=(i=l(e[n]))?(0<i&&(t.lastNeed=i-2),i):!(--n<r||-2===i)&&0<=(i=l(e[n]))?(0<i&&(2===i?i=0:t.lastNeed=i-3),i):0}function f(t,e,r){return 128!=(192&e[0])?(t.lastNeed=0,""):1<t.lastNeed&&1<e.length?128!=(192&e[1])?(t.lastNeed=1,""):2<t.lastNeed&&2<e.length&&128!=(192&e[2])?(t.lastNeed=2,""):void 0:void 0}function u(t){var e=this.lastTotal-this.lastNeed,r=f(this,t,e);return void 0!==r?r:this.lastNeed<=t.length?(t.copy(this.lastChar,e,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(t.copy(this.lastChar,e,0,t.length),void(this.lastNeed-=t.length))}function c(t,e){var r=h(this,t,e);if(!this.lastNeed)return t.toString("utf8",e);this.lastTotal=r;var n=t.length-(r-this.lastNeed);return t.copy(this.lastChar,0,n),t.toString("utf8",e,n)}function d(t){var e=t&&t.length?this.write(t):"";return this.lastNeed?e+"":e}function p(t,e){if((t.length-e)%2!=0)return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=t[t.length-1],t.toString("utf16le",e,t.length-1);var r=t.toString("utf16le",e);if(r){var n=r.charCodeAt(r.length-1);if(55296<=n&&n<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1],r.slice(0,-1)}return r}function _(t){var e=t&&t.length?this.write(t):"";if(this.lastNeed){var r=this.lastTotal-this.lastNeed;return e+this.lastChar.toString("utf16le",0,r)}return e}function g(t,e){var r=(t.length-e)%3;return 0==r?t.toString("base64",e):(this.lastNeed=3-r,this.lastTotal=3,1==r?this.lastChar[0]=t[t.length-1]:(this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1]),t.toString("base64",e,t.length-r))}function b(t){var e=t&&t.length?this.write(t):"";return this.lastNeed?e+this.lastChar.toString("base64",0,3-this.lastNeed):e}function m(t){return t.toString(this.encoding)}function y(t){return t&&t.length?this.write(t):""}(r.StringDecoder=o).prototype.write=function(t){if(0===t.length)return"";var e,r;if(this.lastNeed){if(void 0===(e=this.fillLast(t)))return"";r=this.lastNeed,this.lastNeed=0}else r=0;return r<t.length?e?e+this.text(t,r):this.text(t,r):e||""},o.prototype.end=d,o.prototype.text=c,o.prototype.fillLast=function(t){if(this.lastNeed<=t.length)return t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,t.length),this.lastNeed-=t.length}},{"safe-buffer":61}],63:[function(t,e,r){e.exports=t("./readable").PassThrough},{"./readable":64}],64:[function(t,e,r){(((r=e.exports=t("./lib/_stream_readable.js")).Stream=r).Readable=r).Writable=t("./lib/_stream_writable.js"),r.Duplex=t("./lib/_stream_duplex.js"),r.Transform=t("./lib/_stream_transform.js"),r.PassThrough=t("./lib/_stream_passthrough.js")},{"./lib/_stream_duplex.js":53,"./lib/_stream_passthrough.js":54,"./lib/_stream_readable.js":55,"./lib/_stream_transform.js":56,"./lib/_stream_writable.js":57}],65:[function(t,e,r){e.exports=t("./readable").Transform},{"./readable":64}],66:[function(t,e,r){e.exports=t("./lib/_stream_writable.js")},{"./lib/_stream_writable.js":57}],67:[function(t,e,r){e.exports=i;var f=t("events").EventEmitter,n;function i(){f.call(this)}t("inherits")(i,f),i.Readable=t("readable-stream/readable.js"),i.Writable=t("readable-stream/writable.js"),i.Duplex=t("readable-stream/duplex.js"),i.Transform=t("readable-stream/transform.js"),i.PassThrough=t("readable-stream/passthrough.js"),(i.Stream=i).prototype.pipe=function(e,t){var r=this;function n(t){e.writable&&!1===e.write(t)&&r.pause&&r.pause()}function i(){r.readable&&r.resume&&r.resume()}r.on("data",n),e.on("drain",i),e._isStdio||t&&!1===t.end||(r.on("end",a),r.on("close",o));var s=!1;function a(){s||(s=!0,e.end())}function o(){s||(s=!0,"function"==typeof e.destroy&&e.destroy())}function l(t){if(h(),0===f.listenerCount(this,"error"))throw t}function h(){r.removeListener("data",n),e.removeListener("drain",i),r.removeListener("end",a),r.removeListener("close",o),r.removeListener("error",l),e.removeListener("error",l),r.removeListener("end",h),r.removeListener("close",h),e.removeListener("close",h)}return r.on("error",l),e.on("error",l),r.on("end",h),r.on("close",h),e.on("close",h),e.emit("pipe",r),e}},{events:33,inherits:35,"readable-stream/duplex.js":52,"readable-stream/passthrough.js":63,"readable-stream/readable.js":64,"readable-stream/transform.js":65,"readable-stream/writable.js":66}],68:[function(l,t,h){!function(t,e){var i=l("process/browser.js").nextTick,r=Function.prototype.apply,s=Array.prototype.slice,a={},o=0;function n(t,e){this._id=t,this._clearFn=e}h.setTimeout=function(){return new n(r.call(setTimeout,window,arguments),clearTimeout)},h.setInterval=function(){return new n(r.call(setInterval,window,arguments),clearInterval)},h.clearTimeout=h.clearInterval=function(t){t.close()},n.prototype.unref=n.prototype.ref=function(){},n.prototype.close=function(){this._clearFn.call(window,this._id)},h.enroll=function(t,e){clearTimeout(t._idleTimeoutId),t._idleTimeout=e},h.unenroll=function(t){clearTimeout(t._idleTimeoutId),t._idleTimeout=-1},h._unrefActive=h.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;0<=t&&(e._idleTimeoutId=setTimeout(function t(){e._onTimeout&&e._onTimeout()},t))},h.setImmediate="function"==typeof t?t:function(e){var r=o++,n=!(arguments.length<2)&&s.call(arguments,1);return a[r]=!0,i(function t(){a[r]&&(n?e.apply(null,n):e.call(null),h.clearImmediate(r))}),r},h.clearImmediate="function"==typeof e?e:function(t){delete a[t]}}.call(this,l("timers").setImmediate,l("timers").clearImmediate)},{"process/browser.js":51,timers:68}],69:[function(t,e,r){!function(r){function t(t,e){if(i("noDeprecation"))return t;var r=!1;function n(){if(!r){if(i("throwDeprecation"))throw new Error(e);i("traceDeprecation")?console.trace(e):console.warn(e),r=!0}return t.apply(this,arguments)}return n}function i(t){try{if(!r.localStorage)return}catch(t){return}var e=r.localStorage[t];return null!=e&&"true"===String(e).toLowerCase()}e.exports=t}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],70:[function(t,e,r){arguments[4][24][0].apply(r,arguments)},{dup:24}],71:[function(t,e,r){arguments[4][25][0].apply(r,arguments)},{dup:25}],72:[function(t,e,r){arguments[4][26][0].apply(r,arguments)},{"./support/isBuffer":71,_process:51,dup:26,inherits:70}]},{},[20])(20);function f(s,a,o){function l(r,t){if(!a[r]){if(!s[r]){var e="function"==typeof require&&require;if(!t&&e)return e(r,!0);if(h)return h(r,!0);var n=new Error("Cannot find module '"+r+"'");throw n.code="MODULE_NOT_FOUND",n}var i=a[r]={exports:{}};s[r][0].call(i.exports,function(t){var e;return l(s[r][1][t]||t)},i,i.exports,f,s,a,o)}return a[r].exports}for(var h="function"==typeof require&&require,t=0;t<o.length;t++)l(o[t]);return l}});"use strict";gapp.register("geo.base",[],(e,t)=>{const I=e.base={},n=5;function r(){return Date.now()}function i(e,t,n,r){var i=Math.sign(t-e),o=Math.abs(t-e),a;let c=Math.floor(o/n),u=o/c;o%n&&(c++,u=o/c);let l=r?[e]:[];for(;0<c--;)e+=u*i,l.push(e);return l}async function o(t,n){let r=0;if(n)for(var e of t)e.then(e=>{n(r++,t.length,e)});await Promise.all(t)}function a(n){return new Promise((e,t)=>{setTimeout(e,n)})}function c(e,t){return void 0!==e?e:t}function u(e,t,n,r){let i,o;for(i=0;i<e.length;i++)for(o=e===t?i+1:0;o<t.length;o++)r(e[i],t[o],n);return n}function l(e,t,n){return 0<y(e,t,n)}function s(e,t,n){return y(e,t,n)<0}function f(e,t){return(t.x-e.x)*(t.y+e.y)}function y(e,t,n){return f(e,t)+f(t,n)+f(n,e)}function p(e,t,n){return Math.abs(e-t)<=(n||I.config.precision_merge)}function w(e,t,n){return(p(e,t)||t<=e)&&(p(e,n)||e<=n)}function h(e){return e*e}function x(e,t,n){return[e*Math.cos(n)-t*Math.sin(n),t*Math.cos(n)+e*Math.sin(n)]}const _=Math.PI/180,g=180/Math.PI;function M(e){return e*_}function d(e){return e*g}function m(e,t){return Math.sqrt(v(e,t))}function v(e,t){return h(t.x-e.x)+h(t.y-e.y)}function E(e,t,n,r){return h(n-e)+h(r-t)}function b(e,t){return Math.abs(e)-t}function P(e,t,n){var r=parseFloat(e);return t<=r&&r<=n}function R(e,t){if("object"==typeof e){for(var[n,r]of Object.entries(e))"number"==typeof r&&(e[n]=R(r,t));return e}var i=void 0!==t?t:5;if(0===i)return 0|e;var o=Math.pow(10,i);return Math.round(e*o)/o}function z(e,t,n){return Math.max(t,Math.min(n,e))}function A(e,t,n,r,i,o){var a=I.key,c=e.x,u=e.y,l=t.x,s=t.y,f=n.x,y=n.y,p,h,x=l-c,_=s-u,g=r.x-f,M=r.y-y,d=M*x-g*_;if(Math.abs(d)<1e-4)return i&&!o?null:a.PARALLEL;var m=u-y,w,v=g*m-M*(w=c-f),E,m,w=(x*m-_*w)/d,b,P,R=-1e-4<=(m=v/d)&&m<=1.0001&&(-1e-4<=w&&w<=1.0001),z=0<=m&&0<=w;if(i===a.SEGINT&&!R)return null;if(i===a.RAYINT&&!z)return null;let A=I.newPoint(c+m*x,u+m*_,n.z||r.z,R?a.SEGINT:z?a.RAYINT:a.PROJECT);return A.dist=m,A.p1=n,A.p2=r,A}function T(t,e,n,r,i){var o=I.key,a=t.x,c=t.y,u=e.dx,l=e.dy,s=n.x,f=n.y,y,p,h=r.x-s,x=r.y-f,_=x*u-h*l,g=c-f,M=a-s,d=h*g-x*M,m=u*g-l*M;if(Math.abs(_)<1e-12)return null;if(g=d/_,i||w(M=m/_,0,1)&&0<=g){let e=I.newPoint(a+g*u,c+g*l,r.z||t.z,o.NONE);return e.dist=g,e.p1=n,e.p2=r,e}return null}function q(e,t,n,r){var i=t.x-e.x,o=t.y-e.y,a=r.x-n.x,c;return(r.y-n.y)*i-a*o}function C(e,t,n,r,i){let o=new THREE.Vector3(t.x-e.x,t.y-e.y,t.z-e.z);var a=new THREE.Vector3(n.x-e.x,n.y-e.y,n.z-e.z);if(o.cross(a),0!==o.z)return(o.x*(r-e.x)+o.y*(i-e.y))/-o.z+e.z}function N(e,t,n){var r=2*L([[e.x,e.y,1],[t.x,t.y,1],[n.x,n.y,1]]),i=[[e.x*e.x+e.y*e.y,e.y,1],[t.x*t.x+t.y*t.y,t.y,1],[n.x*n.x+n.y*n.y,n.y,1]],o=[[e.x,e.x*e.x+e.y*e.y,1],[t.x,t.x*t.x+t.y*t.y,1],[n.x,n.x*n.x+n.y*n.y,1]],a={x:L(i)/r,y:L(o)/r,z:e.z};if(0!=r)return a}function L(e){var t,n,r;return e[0][0]*(e[1][1]*e[2][2]-e[1][2]*e[2][1])+-e[0][1]*(e[1][0]*e[2][2]-e[1][2]*e[2][0])+e[0][2]*(e[1][0]*e[2][1]-e[1][1]*e[2][0])}function k(e,t,n,r){let i=N(e,t,n);var o,a;return i&&r&&(o=i.x-e.x,a=i.y-e.y,i.r=Math.sqrt(o*o+a*a)),i}function D(e,t,n,r){let i=e.x,o=t.x,a=e.y,c=t.y,u=Math.sqrt(Math.pow(o-i,2)+Math.pow(c-a,2)),l=(a+c)/2,s=(i+o)/2,f=Math.sqrt(Math.pow(n,2)-Math.pow(u/2,2))*(a-c)/u,y=Math.sqrt(Math.pow(n,2)-Math.pow(u/2,2))*(o-i)/u,p=s+f,h=l+y,x=s-f,_=l-y,g=new THREE.Vector2(o-i,c-a),M=new THREE.Vector2(p-i,h-a),d=new THREE.Vector2(x-i,_-i);return r?0<g.cross(M)?{x:p,y:h}:{x:x,y:_}:g.cross(M)<0?{x:p,y:h}:{x:x,y:_}}function S(e,t,n){let r=t-e;for(;r<-Math.PI;)r+=2*Math.PI;for(;r>Math.PI;)r-=2*Math.PI;return n&&0<r&&(r-=2*Math.PI),!n&&r<0&&(r+=2*Math.PI),r}function O(i,o,a){if(!i.length)return i;let e=new Array(i.length),c=0,u=0;for(a||(a=i[u++],e[c++]=a);;){let t,n,r=1/0;for(let e=u;e<i.length;e++){var l=i[e],s;l&&((s=o(a,l))<r&&(r=s,n=e,t=l))}if(!t)break;i[n]=void 0,a=e[c++]=t}return e}function G(c,e,u,t){let l,s;if(2===u)l=c;else{let r=new Array(u).fill(1/0),i=new Array(u).fill(-1/0);for(let n=0,e=c.length;n<e;)for(let e=0,t;e<u;e++)t=c[n++],r[e]=Math.min(r[e],t),i[e]=Math.max(i[e],t);let t=new Array(u);for(let e=0;e<u;e++)t[e]=i[e]-r[e];let n=0,o,a;for(let e=0;e<u;e++)t[e]>n&&(n=t[e],o=e);s={d1:o,d2:a,dmax:n,delta:t.slice()};for(let e=t[o]=n=0;e<u;e++)t[e]>n&&(n=t[e],a=e);l=new Array(c.length/u*2);for(let e=0,t=0;e<c.length;e+=u)l[t++]=c[e+o],l[t++]=c[e+a]}var i=earcut(l,e,2);if(t)return i;let o=new Array(i.length*u);for(let e=0,t=0,n=i.length,r;e<n;e++){r=i[e]*u;for(let e=0;e<u;e++)o[t++]=c[r+e]}return 0===o.length&&console.log("debug_triangulate",{array:c,oa:o,info:s}),o}function H(e){return e.reduce((e,t)=>Array.isArray(t)?e.concat(H(t)):e.concat(t),[])}function V(e){if(!e)return e;let[t,n]=e.toString().split(".");return t=t.toString().split("").reverse().map((e,t,n)=>t<n.length-1&&t%3==2?","+e:e).reverse().join(""),n?t+"."+n:t}I.key={NONE:"",PROJECT:"project",SEGINT:"segint",RAYINT:"rayint",PARALLEL:"parallel"},I.config={debug_arrow:.25,gcode_decimals:4,bridgeLineGapDistance:.05,bridgeLineGapDistanceMax:25,precision_offset:.05,precision_poly_area:.05,precision_poly_bounds:.01,precision_poly_merge:.05,precision_merge:.005,precision_slice_z:1e-4,precision_merge_sq:25e-6,precision_bounds:1e-4,precision_slope:.02,precision_slope_merge:.25,precision_fill_merge:.001,precision_decimate:.05,decimate_threshold:5e5,precision_point_on_line:.01,precision_circularity:.001,hint_len_min:9,hint_len_max:400,hint_min_circ:.15,precision_mask_tolerance:.001,precision_close_to_poly_sq:1e-6,precision_midpoint_check_dist:1,precision_nested_sq:1e-4,clipper:1e5,clipperClean:250},I.util={sqr:h,lerp:i,time:r,clamp:z,comma:V,round:R,area2:y,pwait:o,ptimer:a,flatten:H,rotate:x,distSq:v,dist2D:m,distSqv2:E,center2d:k,center2pr:D,determinant:q,orderClosest:O,doCombinations:u,offsetPrecision:b,circleCenter:N,numOrDefault:c,toRadians:M,toDegrees:d,thetaDiff:S,intersect:A,inRange:P,isCloseTo:p,inCloseRange:w,isClockwise:l,isCounterClockwise:s,intersectRayLine:T,triangulate:G,zInPlane:C}});"use strict";gapp.register("geo.bounds",[],(i,t)=>{const{base:s}=i,{config:h,util:n}=s;class m{constructor(){this.minx=1e8,this.miny=1e8,this.maxx=-1e8,this.maxy=-1e8}set(i,t,s,h){return this.minx=i,this.miny=s,this.maxx=t,this.maxy=h,this}clone(){let i=new m;return i.minx=this.minx,i.miny=this.miny,i.maxx=this.maxx,i.maxy=this.maxy,i.maxy=this.maxy,i}equals(i,t){return t=t||h.precision_offset,n.isCloseTo(this.minx,i.minx,t)&&n.isCloseTo(this.miny,i.miny,t)&&n.isCloseTo(this.maxx,i.maxx,t)&&n.isCloseTo(this.maxy,i.maxy,t)}delta(i){return 0+Math.abs(this.minx-i.minx)+Math.abs(this.miny-i.miny)+Math.abs(this.maxx-i.maxx)+Math.abs(this.maxy-i.maxy)}merge(i){return this.minx=Math.min(this.minx,i.minx),this.maxx=Math.max(this.maxx,i.maxx),this.miny=Math.min(this.miny,i.miny),this.maxy=Math.max(this.maxy,i.maxy),this}update(i){return this.minx=Math.min(this.minx,i.x),this.maxx=Math.max(this.maxx,i.x),this.miny=Math.min(this.miny,i.y),this.maxy=Math.max(this.maxy,i.y),this}contains(i){return i.isNested(this)}containsXY(i,t){return i>=this.minx&&i<=this.maxx&&t>=this.miny&&t<=this.maxy}containsOffsetXY(i,t,s){return i>=this.minx-s&&i<=this.maxx+s&&t>=this.miny-s&&t<=this.maxy+s}isNested(i,t=h.precision_bounds){return this.minx>=i.minx-t&&this.maxx<=i.maxx+t&&this.miny>=i.miny-t&&this.maxy<=i.maxy+t}overlaps(i,t=h.precision_bounds){return 2*Math.abs(this.centerx()-i.centerx())-t<this.width()+i.width()&&2*Math.abs(this.centery()-i.centery())-t<this.height()+i.height()}width(){return this.maxx-this.minx}height(){return this.maxy-this.miny}center(i=0){return s.newPoint(this.centerx(),this.centery(),i)}centerx(){return this.minx+this.width()/2}centery(){return this.miny+this.height()/2}}gapp.overlay(s,{Bounds:m,newBounds(){return new m}})});"use strict";gapp.register("geo.csg",[],(e,t)=>{const{base:n,ext:r}=e;var o=!0,i=.001;const a=1e3;function c(){e?.mesh?.log?e.mesh.log(...arguments):!0===e.debug&&console.log(...arguments)}const s={union(){return s.moduleOp("manifold.union","union",...arguments)},subtract(){return s.moduleOp("manifold.subtract","difference",...arguments)},intersect(){return s.moduleOp("manifold.intersect","intersection",...arguments)},difference(){return s.moduleOp("manifold.difference","difference",...arguments)},moduleOp(e,t){c(e+` ${arguments.length} meshes`);var n=[...arguments].slice(2).map(e=>new u.Manifold(e));if(n.length<2)throw"missing one or more meshes";const r=u.Manifold[t](...n);var o=r.getMesh(),i;const s=[...n,r].map(e=>e.status().value);for(i of[...n,r])i.delete();if(s.reduce((e,t)=>e+t))throw""+s;return o},toPositionArray(e){var{vertProperties:t,triVerts:r}=e,o=t;if(o&&r){const s=new Float32Array(3*r.length);for(let e=0,t=0,n=r.length;t<n;t++){var i=3*r[t];s[e++]=o[i++],s[e++]=o[i++],s[e++]=o[i++]}return s.map(e=>e/a)}throw"mesh missing required fields"},fromPositionArray(e){const{index:t,vertices:n}=l(e);var r;return new u.Mesh({vertProperties:n.map(e=>e*a|0).toFloat32(),triVerts:t.toUint32()})},toBox3(e){var{min:t,max:n}=e._boundingBox(),r=new THREE.Vector3(t.x,t.y,t.z),o=new THREE.Vector3(n.x,n.y,n.z);return new THREE.Box3(r,o)},indexVertices:l};function l(n){c(`indexing ${n.length/3} vertices`);let r=0;const o=[],i=[],s={},a={x:0,y:0,z:0};for(let e=0,t=n.length;e<t;){a.x=n[e++],a.y=n[e++],a.z=n[e++];var l=[1e5*a.x|0,1e5*a.y|0,1e5*a.z|0].join(""),u=s[l];0<=u?o.push(u):(o.push(r),s[l]=r++,i.push(a.x,a.y,a.z))}return{index:o,vertices:i}}let u;r.manifold.then(e=>{e.default({locateFile(){return"/wasm/manifold.wasm"}}).then(e=>{e.setup(),u=e,s.Instance=()=>u})}),gapp.overlay(n,{CSG:s})});"use strict";gapp.register("geo.gyroid",[],(t,l)=>{var{base:e}=t;const j=2*Math.PI;let z={},A,B=0,C=0;function r(t,l,e){var r=Date.now();(l!==B||e!==A||2e4<r-C)&&(z={}),A=e,B=l,C=r;let h=parseInt(l||200),a=j/h;var n=j*t,s=(n%j).round(3),o=z[s];if(o)return o;let u=e||0,i=[],p=[],f=0,g=0,v=0;for(let r=0;r<j;r+=a){let l=[],e=[];i.push(e),p.push(l);for(let t=0;t<j;t+=a)e.push(0),l.push(Math.sin(r)*Math.cos(t)+Math.sin(t)*Math.cos(n)+Math.sin(n)*Math.cos(r))}p.forEach((t,l)=>{let e=i[l],r=t[t.length-1];t.forEach((t,l)=>{(r<=u&&t>=u||r>=u&&t<=u||r<=-u&&t>=-u||r>=-u&&t<=-u)&&(e[l]=1,f++,g++),r=t})});for(let e=0;e<h;e++){let l=p[p.length-1][e];for(let t=0;t<h;t++){var c=p[t][e];(l<=u&&c>=u||l>=u&&c<=u||l<=-u&&c>=-u||l>=-u&&c<=-u)&&(i[t][e]?i[t][e]=3:(i[t][e]=2,f++),v++),l=c}}var d=v>g?"lr":"td";let y=[],M=h/2;i.forEach((t,a)=>{t.forEach((t,l)=>{var e,r;t&&(e=Math.abs(l-M),r=Math.abs(a-M),y.push({x:l/h,y:a/h,val:t,dist:Math.max(e,r)}))})}),y.sort((t,l)=>l.dist-t.dist);let x=[],b,E,m=0;var w=.05;do{b=null;for(let t=0;t<y.length;t++)if(y[t]){b=[y[t]],x.push(b),y[t]=null,m++;break}do{E=!1;var k=b[b.length-1];let l=null,e=null,r=1/0;for(let t=0;t<y.length;t++){var I=y[t],q;I&&(q=G(k,I,d),(null===e||q<r)&&(e=t,l=I,r=q))}if(l){if(r>w)break;y[e]=null,m++,b.push(l),E=!0}}while(E)}while(m<y.length);var D=x.map(t=>F(t,0)).map(t=>F(t,a)),P={edge:i,points:f,dir:d,polys:D};return z[s]=P}function F(l,e){if(l.length<=2)return l;let r=[l[0]],a=l[1],h=null;var n=l.length-2;for(let t=1;t<l.length;t++){var s=l[t],o;(e?G(a,s)<=e:a.x===s.x||a.y===s.y)&&(h=s,t<n)||(h?(r.push({x:(a.x+h.x)/2,y:(a.y+h.y)/2}),h=null):(r.push(a),t===n&&r.push(s)),a=s)}return r.push(l[l.length-1]),r}function G(t,l,e){let r=t.x-l.x,a=t.y-l.y;return"lr"===e&&(r/=2),"td"===e&&(a/=2),Math.sqrt(r*r+a*a)}gapp.overlay(e,{gyroid:{slice:r}})});"use strict";gapp.register("geo.line",[],(t,e)=>{const{base:i}=t;class s{constructor(t,e,i){i=i||[t.key,e.key].join(";"),this.p1=t,this.p2=e,this.key=i}length(){return Math.sqrt(this.length2())}length2(){return this.p1.distToSq2D(this.p2)}slope(){return i.newSlope(this.p1.slopeTo(this.p2))}reverse(){var t=this.p1;return this.p1=this.p2,this.p2=t,this}midpoint(){return this.p1.midPointTo(this.p2)}isCollinear(t){var e=this.p1,i=this.p2,s=t.p1,r=t.p2,n=i.x-e.x,p=i.y-e.y,h=r.x-s.x,o=r.y-s.y;return Math.abs(o*n-h*p)<1e-4}}function r(t,e,i){return new s(t,e,i)}function n(t,e,i){return t.key<e.key?r(t,e,i):r(e,t,i)}gapp.overlay(i,{Line:s,newLine:r,newOrderedLine:n})});"use strict";gapp.register("geo.point",[],(t,i)=>{const{base:x}=t,{util:e,config:n,key:a}=x;var{round:s}=e;class h{constructor(t=0,i=0,s=0,r){this.x=t,this.y=i,this.z=s,r&&(this._key=r)}get key(){return this._key||(this._key=[1e5*this.x|0,1e5*this.y|0,1e5*this.z|0].join(""))}toClipper(){return{X:this.x*n.clipper,Y:this.y*n.clipper}}toArray(){return[this.x,this.y,this.z]}toVector3(){return new THREE.Vector3(this.x,this.y,this.z)}set(t,i,s){return this.x=t,this.y=i,this.z=s,delete this._key,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setA(t){return this.a=t,this}swapXZ(){var t=this,i=t.x;return t.x=t.z,t.z=i,this}swapYZ(){var t=this,i=t.y;return t.y=t.z,t.z=i,this}scale(t=1,i=1,s=1){return this.x*=t,this.y*=i,this.z*=s,this}round(t){return d(this.x.round(t),this.y.round(t),this.z.round(t))}addFacet(t){return this.group||(this.group=[]),this.group.push(t),this}rekey(){this._key=void 0}toString(){return this.key}clone(){let t=d(this.x,this.y,this.z,this._key);return void 0!==this.a&&(t.a=this.a),t}slopeTo(t){return x.newSlope(this,t)}lineTo(t,i){return x.newLine(this,t,i)}isNear(t,i){return e.isCloseTo(this.x,t.x,i)&&e.isCloseTo(this.y,t.y,i)}distToLine(t,i){return Math.sqrt(this.distToLineSq(t,i))}distToLine3D(t,i){var s=[this.x,this.y,this.z],r=[t.x,t.y,t.z],n=[i.x,i.y,i.z],e=[n[0]-r[0],n[1]-r[1],n[2]-r[2]],h=[s[0]-r[0],s[1]-r[1],s[2]-r[2]],o=[e[1]*h[2]-e[2]*h[1],e[2]*h[0]-e[0]*h[2],e[0]*h[1]-e[1]*h[0]],y,u,x;return Math.sqrt(o[0]**2+o[1]**2+o[2]**2)/Math.sqrt(e[0]**2+e[1]**2+e[2]**2)}distToLineNew(t,i){return o(this,t,i)}distToLineSq(t,i){var s=this,r=e.distSq(t,i),n=((s.x-t.x)*(i.x-t.x)+(s.y-t.y)*(i.y-t.y))/r;return n<0?e.distSq(s,t):1<n?e.distSq(s,i):e.distSqv2(s.x,s.y,t.x+n*(i.x-t.x),t.y+n*(i.y-t.y))}withinDist2(t,i,s){let r=t.distToSq2D(i),n=this.distToSq2D(t),e=this.distToSq2D(i);return!(r<s&&(r+=s,n>r&&e>r))&&(!(n>r&&e>r)&&this.distToLineSq(t,i)<s)}midPointTo(t){return d((this.x+t.x)/2,(this.y+t.y)/2,this.z)}midPointTo3D(t){return d((this.x+t.x)/2,(this.y+t.y)/2,(this.z+t.z)/2)}projectOnSlope(t,i){return d(this.x+t.dx*i,this.y+t.dy*i,this.z)}followTo(t,i){return this.follow(this.slopeTo(t),i)}offsetPointFrom(t,i){var s=this,r=t.x-s.x,n=t.y-s.y,e=i/Math.sqrt(r*r+n*n),h,o;return d(t.x-r*e,t.y-n*e,t.z,a.NONE)}offsetPointTo(t,i){var s=this,r=t.x-s.x,n=t.y-s.y;if(0==r&&0==n)return this;var e=i/Math.sqrt(r*r+n*n),h,o;return d(s.x+r*e,s.y+n*e,t.z,a.NONE)}offsetLineTo(t,i){let s=this,r=t.x-s.x,n=t.y-s.y,e=i/Math.sqrt(r*r+n*n),h=r*e,o=n*e,y=d(s.x-o,s.y+h,s.z,a.NONE),u=d(t.x-o,t.y+h,t.z,a.NONE);return y.op=s,u.op=t,x.newLine(y,u,a.NONE)}offset(t,i,s){return d(this.x+t,this.y+i,this.z+s)}inPolygon(t){if(!t.bounds.containsXY(this.x,this.y))return!1;let i=t.points,s=i.length,r,n,e,h=!1;for(e=0;e<s;e++)r=i[e],n=i[(e+1)%s],r.y>=this.y!=n.y>=this.y&&this.x<=(n.x-r.x)*(this.y-r.y)/(n.y-r.y)+r.x&&(h=!h);return h}isInPolygon(t){let i=this,s;if(Array.isArray(t)){for(s=0;s<t.length;s++)if(i.isInPolygon(t[s]))return!0;return!1}var r=t.inner;if(i.inPolygon(t)||i.nearPolygon(t,n.precision_merge_sq)){for(s=0;r&&s<r.length;s++)if(i.inPolygon(r[s])&&!i.nearPolygon(r[s],n.precision_merge_sq))return!1;return!0}return!1}isInPolygonOnly(t){let i=this,s;if(Array.isArray(t)){for(s=0;s<t.length;s++)if(i.isInPolygonOnly(t[s]))return!0;return!1}var r=t.inner;if(i.inPolygon(t)){for(s=0;r&&s<r.length;s++)if(i.inPolygon(r[s]))return!1;return!0}return!1}nearPolygon(r,n,t){for(let t=0,i=r.points,s=i.length;t<s;t++)if(this.withinDist2(i[t],i[(t+1)%s],n))return!0;if(t&&r.inner)for(let t=0;t<r.inner.length;t++)if(this.nearPolygon(r.inner[t],n))return!0;return!1}insideOffset(t,i,s){return this.inPolygon(t)===0<i&&!this.nearPolygon(t,s)}follow(t,i){var s=i/Math.sqrt(t.dx*t.dx+t.dy*t.dy);return d(this.x+t.dx*s,this.y+t.dy*s,this.z)}intersectZ(t,i){var s=t.x-this.x,r=t.y-this.y,n=t.z-this.z,e=1-(t.z-i)/n;return d(this.x+s*e,this.y+r*e,this.z+n*e)}isEqual2D(t){return this===t||this.x===t.x&&this.y===t.y}isMergable2D(t){return this.isEqual2D(t)||this.distToSq2D(t)<n.precision_merge_sq}isEqual(t){return this===t||this.x===t.x&&this.y===t.y&&this.z===t.z}isEqual2D(t){return this===t||this.x===t.x&&this.y===t.y}isMergable3D(t){return this.isEqual(t)||this.distToSq3D(t)<n.precision_merge_sq}isInBox(t,i){return Math.abs(this.x-t.x)<i&&Math.abs(this.y-t.y)<i}distToPolySegments(t,r){let n=this,e=1/0;return t.forEachSegment(function(t,i){var s=Math.min(e,n.distToLine(t,i));if(e=Math.min(s,e),e<=r)return!0}),e}distToPolyPoints(t,i){let s=this,r=1/0;return t.forEachPoint(function(t){if(r=Math.min(r,s.distTo2D(t)),r<i)return!0}),r}nearestTo(t,i){if(!i)throw"missing max";let s=1/0,r=null,n,e,h;for(n=0;n<t.length;n++)(e=t[n])===this||e.del||(h=this.distToSq2D(e))<i&&h<s&&(s=h,r=e);return r}averageDistTo(t){let i=0,s=0,r;for(r=0;r<t.length;r++)t[r]!=this&&(i+=this.distToSq2D(t[r]),s++);return i/s}distTo2D(t){var i=this.x-t.x,s=this.y-t.y;return Math.sqrt(i*i+s*s)}distToSq2D(t){var i=this.x-t.x,s=this.y-t.y;return i*i+s*s}distTo3D(t){var i=this.x-t.x,s=this.y-t.y,r=this.z-t.z;return Math.sqrt(i*i+s*s+r*r)}distToSq3D(t){var i=this.x-t.x,s=this.y-t.y,r=this.z-t.z;return i*i+s*s+r*r}inTriangle(t,i,s){var r=this.x-t.x,n=this.y-t.y,e=0<(i.x-t.x)*n-(i.y-t.y)*r;return 0<(s.x-t.x)*n-(s.y-t.y)*r!=e&&0<(s.x-i.x)*(this.y-i.y)-(s.y-i.y)*(this.x-i.x)==e}onLine(t,i){return this.distToLine(t,i)<n.precision_point_on_line}add(t){return d(this.x+t.x,this.y+t.y,this.z+t.z)}sub(t){return d(this.x-t.x,this.y-t.y,this.z-t.z)}move(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}rotate(t){var{x:i,y:s}=this;this.x=i*Math.cos(t)-s*Math.sin(t),this.y=s*Math.cos(t)+i*Math.sin(t)}}function u(t,i){return t.x*i.x+t.y*i.y}function r(t){return Math.sqrt(u(t,t))}function l(t,i){return r({x:t.x-i.x,y:t.y-i.y})}function o(t,i,s){var r={x:s.x-i.x,y:s.y-i.y},n,e,h,o;let y=u({x:t.x-i.x,y:t.y-i.y},r)/u(r,r);return isNaN(y)&&(y=0),l(t,{x:i.x+y*r.x,y:i.y+y*r.y})}function d(t,i,s,r){return new h(t,i,s,r)}function y(t,i){return d(t.X/n.clipper,t.Y/n.clipper,i)}gapp.overlay(x,{Point:h,newPoint:d,pointFromClipper:y})});"use strict";gapp.register("geo.paths",[],(t,s)=>{const{base:e}=t;var{util:p,config:n}=e,{sqr:r,numOrDefault:h}=p,o=Math.PI/180;function u(t,s,e){let p,n,r,h=0;for(;r=null,p=1/0,t.forEach(function(t){t.delete||(n=s.distTo2D(t.first),n<p&&(r={el:t,first:t.first,last:t.last},p=n),n=s.distTo2D(t.last),n<p&&(r={el:t,first:t.last,last:t.first},p=n))}),r;)r.el.delete=!0,s=r.last,e(r.el,r.first,++h);return s}function d(t,n,s,r={}){let e=r.mark||"delete",h,o,u,p=0;for(;;){u=null,h=1/0;for(let p of t)if(!p[e])if(p.isOpen()){var d=n.distTo2D(p.first()),a=n.distTo2D(p.last());d>h&&a>h||(a<h&&a<d&&!1!==r.swapdir?(p.reverse(),u={poly:p,index:0,point:p.first()},h=a):d<h&&(u={poly:p,index:0,point:p.first()},h=d))}else{let e=p.open?1:p.area();p.forEachPoint(function(t,s){o=r.weight?n.distTo3D(t)*e*e:n.distTo2D(t),o<h&&(u={poly:p,index:s,point:t},h=o)})}if(!u||r.term)break;u.poly[e]=!0,n=s(u.poly,u.index,++p,n)||u.point}return!0!==r.perm&&t.forEach(function(t){t[e]=!1}),n}function Q(t,s){var e=s.x-t.x,p=s.y-t.y,n=Math.sqrt(e*e+p*p),r=1/n;return{dx:p*=r,dy:-(e*=r),p1:t,p2:s,len:n}}function U(t,s,e,p){let n,r;return r=p?(n=s.dx*e,s.dy*e):(n=t.dx*e,t.dy*e),{dx:n,dy:r,vp:t.p2}}function W(t,s,e,p){let n,r,h,o,u,d;return d=t.dx*s.dx+t.dy*s.dy+1,u=e/d,u===1/0&&(u=0),n=(t.dx+s.dx)*u,r=(t.dy+s.dy)*u,h=t.dx*s.dy-s.dx*t.dy,o=Math.sqrt(n*n+r*r),{dx:n,dy:r,vp:p||t.p2,io:h,vl:o}}function Y(t){let s=t.vp.clone();return s.x+=t.dx,s.y+=t.dy,s.vp=t.vp,s}function Z(t){let s=t.vp.clone();return s.x-=t.dx,s.y-=t.dy,s.vp=t.vp,s}function a(u,d,a,l=1.5){var y=Math.abs(d);const e=[];var p=u.length;if(2===p&&u[0].isEqual(u[1]))return{};var n=a&&2<p||!a&&3<p;for(let s=0;s<p;s++){let t=u[s];var r=u[(s+1)%p];t.normal=Q(t,r),n&&0===t.normal.len&&s!==p-1&&(t.normal=Q(t,u[(s+2)%p]),s++),e.push(t)}1===e.length&&console.log({points:u,nupoints:e});const x=[],i=[],c=[],f=[];var t=-1,s,h,o,v;let m,z;for(let h=0,o=(u=e).length;h<o;h++){var g=u[(h+o-1)%o].normal,M=u[(h+o)%o].normal,k=!a||0!==h&&h!==o-1?W(g,M,d):U(g,M,d,0===h);let{p1:e,p2:t}=M,{io:s,vl:p}=k;d<0&&(s=-s);let n=!1,r=!1;0<s?(n=y*l<p,r=p>Math.min(g.len,M.len)+y):(r=y*l<p,n=p>Math.min(g.len,M.len)+y);var E=x.peek(1),T=i.peek(1),w,P,D,b;if(n||r){var H=.1;let t=e.clone().move({x:.1*g.dy,y:.1*-g.dx,z:0}),s=e.clone().move({x:.1*-M.dy,y:.1*M.dx,z:0});var I=t.normal=Q(t,s),R=s.normal=e.normal,q=W(g.p1.normal,I,d,t),A=W(I,R,d,s),V,F,N,O,G,S;r?i.push(Z(q),Z(A)):i.push(Z(k)),n?x.push(Y(q),Y(A)):x.push(Y(k)),c&&(V=x.peek(1),F=i.peek(1),N=x.peek(2),O=i.peek(2),G=V.vp.normal,S=F.vp.normal,n&&r?(c.push(V,N,F),c.push(O,F,N),m=m||N,z=z||O,f.push(G.dx,G.dy,-1),f.push(G.dx,G.dy,-1),f.push(-S.dx,-S.dy,-1),f.push(-S.dx,-S.dy,-1),f.push(-S.dx,-S.dy,-1),f.push(G.dx,G.dy,-1)):n?(c.push(V,N,F),m=m||N,z=z||F,f.push(G.dx,G.dy,-1),f.push(G.dx,G.dy,-1),f.push(-S.dx,-S.dy,-1)):(c.push(O,F,V),m=m||V,z=z||O,f.push(-S.dx,-S.dy,-1),f.push(-S.dx,-S.dy,-1),f.push(G.dx,G.dy,-1)))}else x.push(Y(k)),i.push(Z(k)),m=m||x.peek(1),z=z||i.peek(1);c&&E&&T&&(w=x.peek(n?2:1),P=i.peek(r?2:1),c.push(w,E,P),c.push(T,P,E),D=E.vp.normal,b=T.vp.normal,f.push(D.dx,D.dy,-1),f.push(D.dx,D.dy,-1),f.push(-b.dx,-b.dy,-1),f.push(-b.dx,-b.dy,-1),f.push(-b.dx,-b.dy,-1),f.push(D.dx,D.dy,-1))}if(a){var X=u[0].normal;const C=x[0],J=i[0];var j=.99*d;C.x+=X.dy*j,C.y-=X.dx*j,J.x+=X.dy*j,J.y-=X.dx*j;var B=u.peek(2).normal;const K=x.peek(),L=i.peek();K.x-=B.dy*j,K.y+=B.dx*j,L.x-=B.dy*j,L.y+=B.dx*j}return!a&&c&&(s=x.peek(1),h=i.peek(1),o=s.vp.normal,v=h.vp.normal,c.push(m,s,z),c.push(h,z,s),f.push(o.dx,o.dy,-1),f.push(o.dx,o.dy,-1),f.push(-v.dx,-v.dy,-1),f.push(-v.dx,-v.dy,-1),f.push(-v.dx,-v.dy,-1),f.push(o.dx,o.dy,-1)),{left:x,right:i,faces:c,normals:f,open:a}}function l(t,p,s){const{faces:e,normals:n,left:r,right:h,open:o}=t,u=[],d=[];if(!(e&&r&&h))return[];if(void 0!==s)for(var a of e)a.z=s;for(var l of e)u.push(l.x,l.y,l.z-p);for(var y of e.slice().reverse())u.push(y.x,y.y,y.z+p);d.appendAll(n);for(let t=n.length-1;0<t;t-=3)d.push(n[t-2]),d.push(n[t-1]),d.push(-n[+t]);for(let t=0,s=r.length,e=o?s-1:s;t<e;t++){var x=r[t],i=r[(t+1)%s];u.push(x.x,x.y,x.z+p),u.push(x.x,x.y,x.z-p),u.push(i.x,i.y,i.z-p),u.push(i.x,i.y,i.z-p),u.push(i.x,i.y,i.z+p),u.push(x.x,x.y,x.z+p);var c=x.vp.normal;d.push(c.dx,c.dy,-1),d.push(c.dx,c.dy,1),d.push(c.dx,c.dy,1),d.push(c.dx,c.dy,1),d.push(c.dx,c.dy,-1),d.push(c.dx,c.dy,-1)}for(let t=0,s=h.length,e=o?s-1:s;t<e;t++){var f=h[t],v=h[(t+1)%s];u.push(f.x,f.y,f.z+p),u.push(v.x,v.y,v.z-p),u.push(f.x,f.y,f.z-p),u.push(v.x,v.y,v.z-p),u.push(f.x,f.y,f.z+p),u.push(v.x,v.y,v.z+p);var m=f.vp.normal;d.push(-m.dy,m.dx,1),d.push(-m.dy,m.dx,-1),d.push(-m.dy,m.dx,-1),d.push(-m.dy,m.dx,-1),d.push(-m.dy,m.dx,1),d.push(-m.dy,m.dx,1)}var z,g,M,k,E;return o&&(z=r[0],g=h[0],u.push(z.x,z.y,z.z+p),u.push(g.x,g.y,g.z-p),u.push(z.x,z.y,z.z-p),u.push(g.x,g.y,g.z+p),u.push(g.x,g.y,g.z-p),u.push(z.x,z.y,z.z+p),M=z.vp.normal,d.push(-M.dy,M.dx,1),d.push(-M.dy,M.dx,-1),d.push(-M.dy,M.dx,-1),d.push(-M.dy,M.dx,1),d.push(-M.dy,M.dx,-1),d.push(-M.dy,M.dx,1),k=r.peek(),E=h.peek(),u.push(k.x,k.y,k.z+p),u.push(k.x,k.y,k.z-p),u.push(E.x,E.y,E.z-p),u.push(E.x,E.y,E.z+p),u.push(k.x,k.y,k.z+p),u.push(E.x,E.y,E.z-p),M=E.vp.normal,d.push(-M.dy,M.dx,1),d.push(-M.dy,M.dx,-1),d.push(-M.dy,M.dx,-1),d.push(-M.dy,M.dx,1),d.push(-M.dy,M.dx,1),d.push(-M.dy,M.dx,-1)),{faces:u,normals:d}}function y(t,p,n){n=void 0===n||n;const s=new THREE.ShapeGeometry(t);s.rotateX(.5*Math.PI);const r=s.attributes.position,h=new Float32Array(r.count*p.length*3);for(let e=0;e<p.length;e++){const q=(new THREE.Vector2).subVectors(p[e-1<0?p.length-1:e-1],p[e]),A=(new THREE.Vector2).subVectors(p[e+1==p.length?0:e+1],p[e]);var o,u;let t=.5*(A.angle()-q.angle()),s=A.angle()+.5*Math.PI;n||(0!=e&&e!=p.length-1||(t=.5*Math.PI),e==p.length-1&&(s=q.angle()-.5*Math.PI));var d=Math.tan(t-.5*Math.PI),a=(new THREE.Matrix4).set(1,0,0,0,-d,1,0,0,0,0,1,0,0,0,0,1),l=s,y=(new THREE.Matrix4).set(Math.cos(l),-Math.sin(l),0,0,Math.sin(l),Math.cos(l),0,0,0,0,1,0,0,0,0,1),x=(new THREE.Matrix4).set(1,0,0,p[e].x,0,1,0,p[e].y,0,0,1,0,0,0,0,1);const V=r.clone();V.applyMatrix4(a),V.applyMatrix4(y),V.applyMatrix4(x),h.set(V.array,V.count*e*3)}const e=[];var i=0==n?p.length-1:p.length,c,f,v,m,z,g,M,k,E;for(let s=0;s<i;s++)for(let t=0;t<r.count;t++){var T=s,w=s+1==p.length?0:s+1,P=t,D=t+1==r.count?0:t+1,b=D+r.count*T,H=P+r.count*T,I=P+r.count*w,R=D+r.count*w;e.push(b,H,R),e.push(H,I,R)}return n||(c=0+0*r.count,f=1+0*r.count,v=2+0*r.count,m=3+0*r.count,e.push(c,f,v),e.push(c,v,m),g=0+r.count*i,M=1+r.count*i,k=2+r.count*i,E=3+r.count*i,e.push(k,M,g),e.push(E,k,g)),{index:e,faces:h}}class x{constructor(t,s){this.size=t,this.factor=Math.min(s||1.2,1.1),this.array=new Float32Array(t),this.pos=0}push(){const s=this.array;var e=this.size,p=arguments.length;if(this.pos+p>=e){var n=(e*this.factor|0)+p;let t=new Float32Array(n);t.set(s),this.array=t,this.size=n}for(let t=0;t<p;t++)s[this.pos++]=arguments[t]}finalize(){return.9<=this.pos/this.size?this.array.subarray(0,this.pos):this.array.slice(0,this.pos)}}e.paths={poly2polyEmit:d,tip2tipEmit:u,shapeToPath:y,pointsToPath:a,pathTo3D:l,vertexNormal:W,segmentNormal:Q}});"use strict";gapp.register("geo.points",[],(e,o)=>{const{base:m}=e,{config:y}=m;function t(p,e){let n=new Array(p.length/3),r=0,i=0,o=Date.now(),s={},l=0,t=0,a,h=n.length,f,{threshold:g,precision:c,maxpass:d}=e||{};if(g=0<g?g:y.decimate_threshold,c=0<=c?c:y.precision_decimate,d=0<=d?d:0,d)for(;r<p.length;){let e=m.newPoint(p[r++],p[r++],p[r++]),o=e.key,t=s[o];t||(t=e,s[o]=e,l++),n[i++]=t}else for(;r<p.length;)n[i++]=m.newPoint(p[r++],p[r++],p[r++]);if(d&&0<c)for(;n.length>g;){let p=[],e,o=0;for(r=0;r<h;){let e=n[r++],o=n[r++],t=n[r++];p.push({p1:e,p2:o,d:Math.sqrt(e.distToSq3D(o))}),p.push({p1:e,p2:t,d:Math.sqrt(e.distToSq3D(t))}),p.push({p1:o,p2:t,d:Math.sqrt(o.distToSq3D(t))})}for(p.sort(function(e,o){return e.d-o.d}),r=0;r<p.length&&(e=p[r],!(e.d>=c));r++)e.p1.op||e.p2.op||(e.p1.op=e.p2.op=e.p1.midPointTo3D(e.p2),o++);if(0===o)break;for(t++,a=new Array(h),f=0,r=0;r<h;){var u=n[r++],q=n[r++],w=n[r++];u.op&&u.op===q.op||u.op&&u.op===w.op||q.op&&q.op===w.op||(a[f++]=u.op||u,a[f++]=q.op||q,a[f++]=w.op||w)}if(n=a.slice(0,f),h=f,t>=d)break}return t&&console.log({before:p.length/3,after:n.length,unique:l,decimations:t,time:Date.now()-o}),n}function p(e){let o=new Float32Array(3*e.length),t=0,p=0;for(;t<e.length;)o[p++]=e[t].x,o[p++]=e[t].y,o[p++]=e[t++].z;return o}gapp.overlay(m,{verticesToPoints:t,pointsToVertices:p})});"use strict";gapp.register("geo.polygons",[],(e,n)=>{const{base:S}=e,{util:v,paths:b,config:Z,newPoint:F}=S,{sqr:r,numOrDefault:w}=v,q=Math.PI/180,X=Math.sqrt,J=v.sqr,R=Math.abs,U=self.ClipperLib,W=U.Clipper,t=U.ClipType,l=U.PolyType,o=U.PolyFillType,i=W.CleanPolygon,A=W.CleanPolygons,P=W.SimplifyPolygons,Y=o.pftNonZero,B=o.pftEvenOdd,G=l.ptSubject,H=l.ptClip,_=U.EndType,M=U.JoinType,K=U.PolyTree,a=t.ctXor,c=t.ctDifference,p=t.ctUnion,Q=t.ctIntersection,T=U.ClipperOffset;var f=S.polygons={clearInner:g,rayIntersect:pe,alignWindings:j,setWinding:k,fillArea:ae,subtract:L,flatten:O,offset:oe,trimTo:re,expand:le,points:N,length:h,renest:E,route:ce,union:$,inset:ie,outer:u,inner:s,nest:I,diff:ee,xor:ne,setZ:d,filter:C,toClipper:V,fromClipperNode:m,fromClipperTree:z,fromClipperTreeUnion:y,cleanClipperTree:x,fingerprintCompare:se,fingerprint:ue};function u(e){for(var n of e)n.inner=void 0;return e}function s(e){const n=[];for(var r of e)r.inner&&n.push(r.inner);return n}function h(e){let n=0;for(var r of e)n+=r.deepLength;return n}function d(e,n){for(var r of e)r.setZ(n);return e}function g(e){for(var n of e)n.clearInner()}function V(e=[]){var n=[],r;for(r of e)r.toClipper(n);return n}function m(e,n){let r=S.newPolygon();for(var t of e.m_polygon)r.push(S.pointFromClipper(t,n));return r.open=e.IsOpen,r}function z(e,n,r,t,l){let o,i=r||[],a=w(l,.1);for(var p of e.m_Childs)o=m(p,n),!o.open&&o.area()<a||(t?t.addInner(o):i.push(o),p.m_Childs&&z(p,n,i,t?null:o,l));return i}function y(e,n,r,t,l){let o=t||[],i;for(var a of e.m_Childs)i=m(a,n),!i.open&&r&&i.area()<r||(l?l.addInner(i):o.push(i),a.m_Childs&&y(a,n,r,o,l?null:i));return o}function x(e){if(e.m_Childs)for(var n of e.m_Childs)n.m_polygon=i(n.m_polygon,Z.clipperClean),x(n.m_Childs);return e}function C(e,n,r){for(var t of e)t=r(t),t&&(Array.isArray(t)?n.appendAll(t):n.push(t));return n}function N(e){return e.length?e.map(e=>e.deepLength).reduce((e,n)=>e+n):0}function E(e,n){return I(O(e,[],!0),n)}function I(r,e,t){if(!r)return r;r.sort(function(e,n){return e.area()-n.area()});let l,o;for(l=0;l<r.length;l++)o=r[l],o.parent=null,o.inner=null;for(l=0;l<r.length-1;l++){o=r[l];for(let n=l+1;n<r.length;n++){let e=r[n];if((!t||!e.isOpen())&&o.isNested(e)){e.addInner(o);break}}}let n=[],i;for(l=0;l<r.length;l++){for(i=r[l],o=i,o.depth=0;i.parent;)o.depth++,i=i.parent;e?0===o.depth&&n.push(o):o.depth%2==0?n.push(o):o.inner=null}return n}function k(r,t,l){if(r){let e,n=0;for(;n<r.length;)e=r[n++],e.isClockwise()!==t&&e.reverse(),l&&e.inner&&k(e.inner,!t,!1);return r}}function j(e){let n=e.length,r=0,t=0,l=0,o,i;for(;l<n;)i=e[l++],t+=i.length,i.isClockwise()&&(r+=i.length);for(l=0,o=r>t/2;l<n;)i=e[l++],i.isClockwise()!=o&&i.reverse();return o}function D(n,r){for(let e=0;e<n.length;e++)if(n[e].contains(r))return 1}function O(e,n,r){n=n||[];for(var t of e)t.flattenTo(n),r&&(t.inner=null);return n}function L(l,o,i,a,p,e,n={}){let f=w(e,.1),r=[];function u(e,n=[]){return e.forEach(function(e){e.area()>=f&&(n.push(e),r.push(e))}),n}var t,s;n.prof&&(0!==l.length&&0!==o.length||console.log("sub_zero",{setA:l,setB:o}),n.prof.pin=(n.prof.pin||0)+N(l)+N(o),n.prof.call=(n.prof.call||0)+1);{let e=new W,n=new K,r=V(l),t=V(o);e.StrictlySimple=!0,i&&(e.AddPaths(r,G,!0),e.AddPaths(t,H,!0),e.Execute(c,n,B,B)&&(x(n),u(z(n,p,null,null,f),i))),a&&(i&&(n.Clear(),e.Clear()),e.AddPaths(t,G,!0),e.AddPaths(r,H,!0),e.Execute(c,n,B,B)&&(x(n),u(z(n,p,null,null,f),a)))}return n.prof&&(n.prof.pout=(n.prof.pout||0)+N(r)),r}function $(r,t,l,e={}){if(r.length<2)return r;var o=h(r);if(e.wasm&&geo.wasm){let n=t??.01;try{var i=geo.wasm.js.union(r,r[0].getZ()).filter(e=>e.area()>n);return e.changes=h(i)-o,i}catch(e){console.log({union_fail:r,minarea:t,all:l})}}let n=r.slice(),a,p,f,u=[],s,c;e:for(a=0;a<n.length;a++)if(n[a])for(p=a+1;p<n.length;p++)if(n[p]&&(f=n[a].union(n[p],t,l))&&f.length){e.onmerge&&(s=n[a],c=n[p]),n[a]=null,n[p]=null,l?n.appendAll(f):n.push(f),e.onmerge&&e.onmerge(s,c,f);continue e}for(a=0;a<n.length;a++)n[a]&&u.push(n[a]);return e.changes=h(u)-o,u}function ee(e,n,r){let t=new W,l=new K,o=V(e),i=V(n);return t.AddPaths(o,G,!0),t.AddPaths(i,H,!0),t.Execute(c,l,B,B)?z(l,r):null}function ne(o,e){e=e||o[0].getZ();e:for(;;){o.sort((e,n)=>n.area()-e.area());for(let l=0;l<o.length;l++){let t=o[l];for(let r=l+1;r<o.length;r++){let n=o[r];if(n.overlaps(t)&&n.intersects(t)){let e=t.xor(n);if(2===e.length){var i=Math.abs(t.area()-e[0].area())+Math.abs(n.area()-e[1].area())<.01,a=Math.abs(n.area()-e[0].area())+Math.abs(t.area()-e[1].area())<.01;if(i||a)continue}o[l]=null,o[r]=null,(o=o.filter(e=>e)).appendAll(e);continue e}}}break}return o}function re(e,n){if(e===n||null===e||null===n)return null;let r=[],t;return v.doCombinations(e,n,{},function(e,n){(t=e.mask(n))&&r.appendAll(t)}),r}function te(e){let n=0;return e.forEach(function(e){n+=e.circularityDeep()}),n}function le(e,n,r,t,l,o,i,a){return oe(e,[n,o||n],{z:r,outs:t,call:i,minArea:a,count:l,flat:!0})}function oe(r,n,t={}){let e=t.open?r.filter(e=>e.open):[];e.length&&(e=e.map(e=>b.pointsToPath(e.points,n,!0)),e=e.map(e=>S.newPolygon().setOpen().addPoints(e.right))),j(r=r.filter(e=>!e.open));for(var l of r)l.inner&&k(l.inner,!l.isClockwise());var o=r,i=w(t.count,1),a=w(t.depth,0),p=!1!==t.clean,f=!1!==t.simple,u=w(t.fill,Y),s=w(t.join,M.jtMiter),c=w(t.type,_.etClosedPolygon),h=Array.isArray(n)?1<n.length?n.shift():n[0]:n,d=w(t.minArea,.1),g=t.z||0,m,y,v;if(t.wasm&&geo.wasm)try{r=geo.wasm.js.offset(r,h,g,p?Z.clipperClean:0,f?1:0),e.length&&r.appendAll(e)}catch(e){return console.log("wasm error",e.message||e),t.wasm=!1,oe(r,n,t)}else{let e=new T(t.miter,t.arc),n=new K;for(var x of r)x=x.toClipper(),p&&(x=A(x,Z.clipperClean)),f&&(x=P(x,u)),e.AddPaths(x,s,c);e.Execute(n,h*Z.clipper),r=z(n,g,null,null,d)}t.gaps&&r.length&&(y=[],v=L(o,oe(r,-h,{fill:t.fill,join:t.join,type:t.type,z:t.z,minArea:d}),y,null,g),t.gaps.append(y,t.flat)),t.gaps&&!r.length&&t.gaps.append(o,t.flat),r.length&&(t.outs=t.outs||[],t.outs.append(r,t.flat),t.call&&t.call(r,i,a),1<i&&(t.count=i-1,t.depth=a+1,oe(r,n,t)));let C=t.flat?t.outs:r;return e.length&&C.appendAll(e),C}function ie(e,n,r,t,l){var o=r;let i=[],a=e,p=0;for(;0<r--&&a&&a.length;){var f=oe(a,-n,{z:t,wasm:l}),u=oe(f,n/2,{z:t,wasm:l});let e=oe(f,n,{z:t,wasm:l});var s=[],c=a.map(e=>e.areaDeep()).reduce((e,n)=>e+n),h=e.length?e.map(e=>e.areaDeep()).reduce((e,n)=>e+n):0,d;Math.abs(c-h)>1-Math.abs(c/h)/1e3&&L(a,e,s,null,t),i.push({idx:o-r,off:f,mid:u,gap:s});for(d of u)if(d.depth=p++,d.inner)for(var g of d.inner)g.depth=d.depth;a=f}return i}function ae(C,b,w,A,P,_){if(0!==C.length){let e=1,n=C[0],r=n.getZ(),t=n.bounds.clone(),l=!1,o;for(1e3<=b&&(l=!0,b-=1e3),b%=180;b<-90;)b+=180;for(;90<b;)b-=180;for(o=S.newSlope(0,0,Math.cos(b*q)*w,Math.sin(b*q)*w);e<C.length;)t.merge(C[e++].bounds);var M,T,M,T,z,N,z,N,E;l&&(M=(M=t.minx/w)-(0|M)+(M<0?1:0),T=(T=t.miny/w)-(0|T)+(T<0?1:0),t.minx-=M*w,t.miny-=T*w,z=(z=t.maxx/w)-(0|z)+(z<0?1:0),N=(N=t.maxy/w)-(0|N)+(N<0?1:0),t.maxx=t.maxx-z*w+w,t.maxy=t.maxy-N*w+w);let i=A||[],a=-o.dy,p=o.dx,f=R(0<R(a)?t.width()/a:0),u=R(0<R(p)?t.height()/p:0),s=X(J(f*a)+J(u*p)),c=X(J(a)+J(p)),h=s/c,d=b<0?{x:t.minx,y:t.miny,z:r}:{x:t.maxx,y:t.miny,z:r},g=new W,m=new K,y=S.config.clipper*(P||0),v=S.config.clipper*(_||0),x=[];for(i.origin=F(d.x,d.y,d.z),e=0;e<h;e++)x.push([{X:(d.x-1e3*o.dx)*Z.clipper,Y:(d.y-1e3*o.dy)*Z.clipper},{X:(d.x+1e3*o.dx)*Z.clipper,Y:(d.y+1e3*o.dy)*Z.clipper}]),d.x+=a,d.y+=p;if(g.AddPaths(x,G,!1),g.AddPaths(V(C),H,!0),x=[],g.Execute(Q,m,Y,B))for(var I of m.m_AllPolys){if(y||v){var k=U.JS.PerimeterOfPath(I.m_polygon,!1,1);if(y&&k<y)continue;if(v&&v<k)continue}var j=S.pointFromClipper(I.m_polygon[0],r),D=S.pointFromClipper(I.m_polygon[1],r),O=i.origin.distToLineNew(j,D)/w;x.push([j,D,O])}x.sort(function(e,n){return e[2]-n[2]});for(E of x){var L=Math.round(E[2]);E[0].index=L,E[1].index=L,i.push(E[0]),i.push(E[1])}return i}}function pe(l,o,e,n){let r=0,t=[],i=[],a=S.config,p=n?a.precision_fill_merge:a.precision_merge;for(e.forEach(function(e){e.flattenTo(t)}),e=t;r<e.length;){var f=e[r++],u=f.points,s=u.length;for(let r=0;r<s;r++){let e=(r+1)%s,n=v.intersectRayLine(l,o,u[r],u[e]);n&&(n.group=f,i.push(n),n.isNear(u[r],p)?(n.pos=r,n.mod=s):n.isNear(u[e],p)&&(n.pos=e,n.mod=s))}}if(0<i.length){let t=!1;if(i.sort(function(n,r){if(!n.del&&!r.del&&n.isNear(r,p)){let e=[];n.isNear(n.p1,p)||e.push(n.p1),n.isNear(n.p2,p)||e.push(n.p2),r.isNear(r.p1,p)||e.push(r.p1),r.isNear(r.p2,p)||e.push(r.p2),e.length<2?console.log("sliceInt: line common ep fail: "+e.length):2<e.length?(n.del=!0,r.del=!0):v.intersectRayLine(l,o,e[0],e[1])?(t=!0,n.del=!0):(t=!0,n.del=!0,r.del=!0)}return n.dist-r.dist}),n){let e,n;for(r=0,pl=i.length;r<pl;){for(e=i[r++];e&&e.del&&r<pl;)e=i[r++];for(n=i[r++];n&&n.del&&r<pl;)n=i[r++];var c,h,d,g,m;e&&n&&e.group&&e.group&&(c=e.group,h=n.group,d=c.depth%2==0,c.depth===h.depth&&c===h&&e.mod&&n.mod&&(1!==(m=R(e.pos-n.pos))&&m!==e.mod-1||(e.del=!0,n.del=!0,t=!0)))}}if(t){let e=[];for(r=0;r<i.length;r++){var y=i[r];y.del||e.push(y)}i=e}}return i}function fe(e,n){return n<e?Math.abs(1-n/e):Math.abs(1-e/n)}function ue(e){let n=O(e).map(e=>({l:e.length,a:e.area(),p:e.perimeter(),c:e.circularity(),b:e.bounds}));return n.sort((e,n)=>.005<fe(e.a,n.a)?n.a-e.a:.005<fe(e.p,n.p)?n.p-e.p:.02<fe(e.c,n.c)?n.c-e.c:.1<Math.abs(e.b.minx-n.b.minx)?n.b.minx-e.b.minx:n.b.miny-e.b.miny),n}function se(r,t){if(r===t)return!0;if(!r||!t)return!1;if(r.length!==t.length)return!1;for(let n=0;n<r.length;n++){let e=r[n];var l=t[n];if(1<Math.abs(e.a-l.a))return!1;if(.02<fe(e.c,l.c))return!1;if(.005<fe(e.p,l.p))return!1;if(.1<e.b.delta(l.b))return!1;if(r.length<20&&.05<fe(e.l,l.l))return!1}return!0}function ce(e,n){let r=[],t,l=1/0;for(var o of e){let e=o.average();var i={poly:o,center:e,used:!1},a=e.distTo2D(n);a<l&&(t=i,l=a),r.push(i)}t.used=!0;let p=[t];for(;;){let e,n=1/0;for(var f of r){var u;f.used||(u=f.center.distTo2D(t.center))<n&&(n=u,e=f)}if(!e)break;e.used=!0,p.push(t=e)}return p.map(e=>e.poly)}});"use strict";gapp.register("geo.polygon",[],(t,e)=>{const{base:J}=t,{config:p,util:K,polygons:i,newBounds:r,newPoint:Q}=J,T=i,n=new THREE.Vector3(1,0,0),o=Math.PI/180,s=self.ClipperLib,a=s.Clipper,h=s.ClipType,l=s.PolyType,u=s.PolyFillType,f=a.CleanPolygon,c=u.pftNonZero,d=u.pftEvenOdd,g=l.ptSubject,y=l.ptClip,v=s.EndType,x=s.JoinType,m=s.PolyTree,z=h.ctXor,w=h.ctDifference,_=h.ctUnion,C=h.ctIntersection,b=s.ClipperOffset;let P=Math.round(4294967295*Math.random());class E{constructor(t){this.id=P++,this.open=!1,this.points=[],this.depth=0,t&&this.addPoints(t)}get length(){return this.points.length}get deepLength(){let t=this.length;if(this.inner)for(var e of this.inner)t+=e.length;return t}get bounds(){if(this._bounds)return this._bounds;let t=this._bounds=r();for(var e of this.points)t.update(e);return t}toPath2D(t){return J.paths.pointsToPath(this.points,t,this.open)}toPath3D(t,e,i){return J.paths.pathTo3D(this.toPath2D(t),e,i)}toString(e){let t;return t=this.inner&&this.inner.length?"/"+this.inner.map(t=>t.toString(e)).join(","):"",e?`P[{${this.area().toFixed(2)}}[${this.points.length}](${this.points.map(t=>t.x+","+t.y).join("|")})${t}]`:`P[${this.points.length,this.area().toFixed(2)}${t}]`}toArray(){let i=this.open?1:0;return this.points.map((t,e)=>0===e?[i,t.x,t.y,t.z]:[t.x,t.y,t.z]).flat()}fromArray(e){this.open=1===e[0];for(let t=1;t<e.length;)this.add(e[t++],e[t++],e[t++]);return this}fromVectors(t){return this.addVerts(t.map(t=>[...t]).flat())}toObject(){return{points:this.toArray(),inner:this.inner?.map(t=>t.toArray())}}fromObject(t){return this.fromArray(t.points),this.inner=t.inner?.map(t=>M().fromArray(t)),this}matches(t){var e=Array.isArray(t)?t:t.toArray(),i=this.toArray();if(e.length!==i.length)return!1;for(let t=0;t<e.length;t++)if(1e-4<Math.abs(e[t]-i[t]))return!1;return!0}xray(t){const e={id:this.id,len:this.points.length,open:this.open,depth:this.depth,parent:!!this.parent};return this.inner&&(e.inner=t?this.inner.xray(t):this.inner),e}alignment(){if(this._aligned)return this._aligned;let e={x:!1,y:!1,z:!1},i=void 0;return this.points.forEach(t=>{i&&(e.x=e.x||i.x!==t.x,e.y=e.y||i.y!==t.y,e.z=e.z||i.z!==t.z),i=t}),this._aligned=!1===e.x?"yz":!1===e.y?"xz":"xy"}ensureXY(){if(this._swapped)return this;switch(this.alignment()){case"xy":break;case"yz":this.swap(!0,!1)._swapped=!0;break;case"xz":this.swap(!1,!0)._swapped=!0;break;default:throw"invalid alignment"}return this}restoreXY(){if(!this._swapped)return this;switch(this.alignment()){case"xy":break;case"yz":this.swap(!0,!1)._swapped=!1;break;case"xz":this.swap(!1,!0)._swapped=!1}return this}earcut(){let r=[],e=[];this.points.forEach(t=>{r.push(t.x,t.y,t.z)}),this.inner&&this.inner.forEach(t=>{e.push(r.length/3),t.points.forEach(t=>{r.push(t.x,t.y,t.z)})});var n=self.earcut(r,e,3);let t=[];for(let i=0;i<n.length;i+=3){let e=new E;e._aligned=this._aligned,e._swapped=this._swapped;for(let t=0;t<3;t++){var s=3*n[i+t];e.add(r[s],r[1+s],r[2+s])}t.push(e)}return t}setInner(t){return this.inner=t,this}noodle(e){var i=this.inner,t=this.clone().offset(e);let r=[this.clone().setInner(t)],n=[];if(i){r=T.subtract(r,i,[]);let t=[];for(var s of i){var o=s.clone().offset(-e),h=T.trimTo(o,[this]),l=T.subtract(h,[...r,s],[]);t.push(...l)}n=T.union(t,0,!0)}var a=T.union([...r,...n],0,!0),p;return{noodle:a,remain:T.subtract([this],a,[])}}centers(t,n,s,o,e={}){let h=[],i=this.bounds,l=e.lines||!1,r=t/2,a=[this.points];if(this.inner)for(var p of this.inner)a.push(p.points);for(var u of K.lerp(i.miny+r,i.maxy-r,t,!0)){let e=[];for(var f of a){var c=f.length;for(let t=0;t<c;t++){var d=f[t%c],g=f[(t+1)%c];(d.y<=u&&g.y>u||d.y>u&&g.y<=u)&&e.push([d,g])}}let i=[];if(e.length&&e.length%2==0)for(var y of e){let[t,e]=y;var v;e.y<t.y&&(v=t,t=e,e=v);var x=Math.min(t.x,e.x),m=Math.max(t.x,e.x),z=Math.min(t.y,e.y),w=Math.max(t.y,e.y),_=e.x-t.x,C,b=(u-z)/(w-z),P=t.x+b*_;i.push(P)}i.sort((t,e)=>e-t);let t,r=0;for(var T of i){var E=Q(T,u,n),A;r++%2?s<=(A=t.distTo2D(E))&&A<=o&&(l?(h.push(t),h.push(E)):h.push(Q((t.x+E.x)/2,u,n))):t=E}}for(var k of K.lerp(i.minx+r,i.maxx-r,t,!0)){let e=[];for(var M of a){var Z=M.length;for(let t=0;t<Z;t++){var D=M[t%Z],S=M[(t+1)%Z];(D.x<=k&&S.x>k||D.x>k&&S.x<=k)&&e.push([D,S])}}let i=[];if(e.length&&e.length%2==0)for(var q of e){let[t,e]=q;var O;e.x<t.x&&(O=t,t=e,e=O);var j=Math.min(t.x,e.x),I=Math.max(t.x,e.x),R=Math.min(t.y,e.y),N=Math.max(t.y,e.y),V,F=e.y-t.y,$=(k-j)/(I-j),L=t.y+$*F;i.push(L)}i.sort((t,e)=>e-t);let t,r=0;for(var W of i){var X=Q(k,W,n),U;r++%2?s<=(U=t.distTo2D(X))&&U<=o&&(l?(h.push(t),h.push(X)):h.push(Q(k,(t.y+X.y)/2,n))):t=X}}if(l)return h;let Y=e.mindist||1.5*t;function H(t){var e=t.last(),i;let r,n=1/0;for(i of h){var s=i.distTo2D(e);s<Y&&s<n&&(n=s,r=i)}return r&&(h=h.filter(t=>t!==r),t.push(r),1)}let B=[],G=[];for(;h.length;)if(0!==G.length){if(!H(G))if(G.flip){if(!G.length)throw"whoop there it is";G=[]}else G.reverse(),G.flip=!0}else G=[h.shift()],B.push(G);return B.filter(t=>1<t.length).map(t=>{let e=J.newPolygon().setOpen();for(var i of t)e.push(i);return e.last().distTo2D(e.first())<=o&&e.setClosed(),e=e.clean(),e})}debur(t){if(this.len<2)return null;const e=this.points,i=e.length,r=this.open,n=M().copyZ(this.z),s=t||J.config.precision_merge;let o;n.push(o=e[0]);for(let t=1;t<i;t++)o.distTo2D(e[t])>=s&&n.push(o=e[t]);return n.open=r,n.parent=this.parent,n.length<2?null:n}miter(t){if(this.length<3)return this;const e=[],i=this.points,r=i.length,n=this.open;let s;for(let t=1;t<r;t++)e.push(i[t-1].slopeTo(s=i[t]));n||e.push(s.slopeTo(i[0]));const o=new Array(r).fill(0);let h=!1;var l=n?r-1:r;for(let t=1;t<l;t++)o[t]=A(e[t-1],e[t]),h|=90<o[t];if(n||(o[0]=A(e[r-1],e[0]),h|=90<o[r-1],h|=90<o[0]),h){const g=M().copyZ(this.z);g.open=n;for(let t=0;t<r;t++){const y=i[(t+r)%r];var a=o[(t+r)%r],p,u,f;if(179<a){const v=e[(t+r)%r];var c=i[(t+r-1)%r],d=e[(t+r-1)%r];g.push(y.follow(y.slopeTo(c).normal(),.001)),g.push(y.follow(v.clone().normal().invert(),.001))}else{90<a?(p=e[(t+r)%r],u=i[(t+r-1)%r],f=e[(t+r-1)%r],g.push(y.follow(y.slopeTo(u),.001)),g.push(y.follow(p,.001))):(y.parent=g,g.push(y))}}return g}return this}createConvexHull(e){function i(t,e,i){var r=(t.x-e.x)*(i.y-e.y)-(t.y-e.y)*(i.x-e.x),n=(t.x-e.x)*(i.x-e.x)+(t.y-e.y)*(i.y-e.y);return r<0||0==r&&n<=0}e.sort(function(t,e){return t.x!=e.x?t.x-e.x:t.y-e.y});var r=e.length;let n=[];for(let t=0;t<2*r;t++){for(var s=t<r?t:2*r-1-t;2<=n.length&&i(n[n.length-2],n[n.length-1],e[s]);)n.pop();n.push(e[s])}return n.pop(),this.addPoints(n),this}stepsFromRoot(){let t=this.parent,e=0;for(;t;)t.inner&&1<t.inner.length&&e++,t=t.parent;return e}first(){return this.points[0]}last(){return this.points[this.length-1]}flip(t){for(var e of this.points)e[t]=-e[t];for(var i of this.inner||[])i.flip(t);return this}swap(t,e){if(this._bounds=void 0,t)for(var i of this.points)i.swapXZ();else if(e)for(var r of this.points)r.swapYZ();if(this.inner)for(var n of this.inner)n.swap(t,e);return this}average(){let e=Q(0,0,0,null);return this.points.forEach(t=>{e.x+=t.x,e.y+=t.y,e.z+=t.z}),e.x/=this.points.length,e.y/=this.points.length,e.z/=this.points.length,e}center(t){return this.bounds.center(this.getZ())}calcCircleCenter(){let t=this.perimeter(),e=t/3,i=2*e,r=this.points,n=r.length,s=1,o=0,h=r[0],l=[h];for(;s<n;){var a=r[s++],p=h.distTo2D(a);if(o+=p,1===l.length&&o>=e)l.push(a);else if(2===l.length&&o>=i){l.push(a);break}h=a}var u=K.center2d(...l);return Q(u.x,u.y,r[0].z,null)}findArcCenters(t={}){if(this.length<6)return[];let i=t.tolerance||.01,r=t.inside??!0,n=this.points.slice(),s=J.util;this.isClosed()&&n.appendAll(n.slice(0,5));let o=[],h=[];for(let e=3;e<n.length;e++){let t=s.circleCenter(...n.slice(e-3,e));var l=h.peek();r&&!Q(t.x,t.y).inPolygon(this)&&(t=null),!t||l?t?s.dist2D(t,l)<i?h.push(t):(3<=h.length&&o.push(h.peek()),h=[t]):h.length=0:h.push(t)}return 3<=h.length&&o.push(h.peek()),o.sort((t,e)=>s.dist2D(t,e)),o=o.filter((t,e)=>0<e&&s.dist2D(t,o[e-1])<10*i?null:t),o}centerRectangle(t,e,i){return e/=2,i/=2,this.push(Q(t.x-e,t.y-i,t.z)),this.push(Q(t.x+e,t.y-i,t.z)),this.push(Q(t.x+e,t.y+i,t.z)),this.push(Q(t.x-e,t.y+i,t.z)),this}centerSpiral(t,e,i,r,n){n*=4,r/=2;let s={x:t.x-e/2,y:t.y+i/2,z:t.z},o={x:1,y:0,i:0},h;for(;0<n--;){switch(this.push(Q(s.x,s.y,s.z)),s.x+=o.x*e,s.y+=o.y*i,o.i++){case 0:h=o.x,o.x=o.y,o.y=-h;break;case 1:h=o.x,o.x=o.y,o.y=h;break;case 2:h=o.x,o.x=o.y,o.y=-h;break;case 3:h=o.x,o.x=o.y,o.y=h}e-=r/2,i-=r/2,o.i=o.i%4}return this}centerCircle(t,e,i,r){let n=0,s=360/i;for(r&&(s=-s);0<i--;)this.push(Q(K.round(Math.cos(n*o)*e,7)+t.x,K.round(Math.sin(n*o)*e,7)+t.y,t.z)),n+=s;return this}move(e,t){if(this._bounds=void 0,this.points=this.points.map(t=>t.move(e)),!t&&this.inner)for(var i of this.inner)i.move(e);return this}scale(t,e){let i,r,n;if("number"==typeof t?i=r=n=t:(i=t.x,r=t.y,n=t.z),this._bounds=void 0,this.points.forEach(t=>{e?(t.x=(t.x*i).round(e),t.y=(t.y*r).round(e),t.z=(t.z*n).round(e)):(t.x=t.x*i,t.y=t.y*r,t.z=t.z*n)}),this.inner)for(var s of this.inner)s.scale(t,e);return this}rotate(t){let r=t*o;return r&&(this.points=this.points.map(t=>{var[e,i]=J.util.rotate(t.x,t.y,r);return t.x=e,t.y=i,t})),this}hintFillAngle(){let t=0,e=this.points,i=e.length,r,n,s,o,h=p.hint_min_circ,l=p.hint_len_min,a=p.hint_len_max||1/0;for(;t<i;)r=e[t],n=e[++t%i],l<=(s=r.distToSq2D(n))&&s<=a&&(!o||s>o.len)&&(o={p1:r,p2:n,len:s});return o&&this.circularity()>=h&&(this.fillang=o.p1.slopeTo(o.p2).normal()),this.fillang}clone(t,e){let i=M().copyZ(this.getZ()),r=this.length,n=0;for(;n<r;)i.push(this.points[n++]);return e&&e.forEach(t=>i[t]=this[t]),this.fillang&&(i.fillang=this.fillang),i.depth=this.depth,i.open=this.open,t&&this.inner&&(i.inner=this.inner.clone(!1,e)),i}cloneZ(e,t=!0){let i=M();return i.z=e,i.open=this.open,i.points=this.points,t&&this.inner&&(i.inner=this.inner.map(t=>t.cloneZ(e,!1))),i}copyZ(t){return void 0!==t&&(this.z=t),this}setA(t){for(var e of this.points)e.setA(t);if(this.inner)for(var i of this.inner)i.setA(t);return this}setZ(e){let t=this.points,i=t.length,r=0;for(;r<i;)t[r++].z=e;return this.z=e,this.inner&&this.inner.forEach(t=>t.setZ(e)),this}getZ(t){return void 0!==this.z?this.z:this.points[t||0]?.z||0}render(t,e,i,r){t.poly(this,e,i,r)}renderSolid(t,e){t.solid(this,e)}add(t,e,i){return this.push(Q(t,e,i)),this}addObj(t){if(Array.isArray(t)){for(var e of t)this.addObj(e);return this}return this.add(t.x,t.y,t.z)}addPoints(t){let e=this,i=t.length,r=0;for(;r<i;)e.push(t[r++]);return this}addVerts(e){for(let t=0;t<e.length;)this.add(e[t++],e[t++],e[t++]);return this}push(t){return((t=t.poly?t.clone():t).poly=this).points.push(t),t}append(t){return this.push(t),this}setClosed(){return this.open=!1,this}setOpen(){return this.open=!0,this}setOpenValue(t){return this.open=t,this}isOpen(){return this.open}isClosed(){return!this.open}appearsClosed(){return this.first().isEqual(this.last())}setClockwise(){return this.isClockwise()||this.reverse(),this}setCounterClockwise(){return this.isClockwise()&&this.reverse(),this}isClockwise(){return 0<this.area(!0)}showKey(){return[this.first().key,this.last().key,this.length].join("~~")}applyRotations(){for(var t of this.points){var e;t.a&&(e=new THREE.Vector3(t.x,t.y,t.z).applyAxisAngle(n,t.a*o),t.x=e.x,t.y=e.y,t.z=e.z)}return this}alignWinding(t,e){return e&&this.length>t.length?t.alignWinding(this,!1):this.isClockwise()!==t.isClockwise()&&this.reverse(),this}opposeWinding(t,e){return e&&this.length>t.length?t.opposeWinding(this,!1):this.isClockwise()===t.isClockwise()&&this.reverse(),this}sameWindings(t){return this.isClockwise()===t.isClockwise()}reverse(){return this.area2&&(this.area2=-this.area2),this.points=this.points.reverse(),this}isNested(t){return!!t.bounds.contains(this.bounds)&&this.isInside(t,p.precision_nested_sq)}forEachPointEaseDown(t,e,i=45){let r=this.findClosestPointTo(e).index,n=e.z,s=0,o=this.points,h=o.length,l=-1,a=o[0].z,p,u,f,c;for(var d=Math.tan(i*Math.PI/180),g=2,y,v,x;;){if(f=o[r%h],u&&f.z<n?((y=n-f.z)<(v=(p=u.distTo2D(f))*d)?t(u.followTo(f,p*y/v).setZ(f.z),s++):f=f.clone().setZ(n-v),n=f.z):0===s&&f.z<n&&(x=n-f.z,n=f.z+Math.min(x,2),f=f.clone().setZ(n)),u=f,t(f,s++),r%h===l)break;l<0&&f.z<=a&&(l=(r+h)%h),r++}return u}forEachPoint(t,e,i){let r=i||0,n=this.points,s=n.length,o=e?s+1:s,h=0,l;for(;0<o--;){if(t(n[l=r%s],l,n,h++))return;r++}}forEachSegment(t,e,i){let r=i||0,n=this.points,s=n.length,o=e?s-1:s,h,l;for(;0<o--;){if(h=r%s,l=(r+1)%s,t(n[h],n[l],h,l))return;r++}}intersections(s,o,t){let h=[];return this.forEachSegment(function(t,e,i,r){var n=K.intersect(s,o,t,e,J.key.SEGINT,!1);n&&(h.push(n),t.pos=i,e.pos=r)}),h.sort(function(t,e){return K.distSq(s,t)-K.distSq(s,e)}),t&&this.inner&&this.inner.forEach(t=>{var e=t.intersections(s,o);e&&h.appendAll(e)}),h}intersects(t){let e=this.points.slice();e.push(e[0]);let i=t.points.slice();i.push(i[0]);for(let t=1;t<e.length;t++){var r=e[t-1],n=e[t];for(let t=1;t<i.length;t++){var s=i[t-1],o=i[t];if(K.intersect(r,n,s,o,J.key.SEGINT))return!0}}return!1}bisect(t,e){if(this.isOpen())return null;let i=this.clone().setClockwise();var r=i.intersections(t,e);return r&&2===r.length?[i.emitSegment(r[0],r[1]),i.emitSegment(r[1],r[0]).reverse()]:null}emitSegment(t,i){let r=M(),e=t.p2.pos,n=i.p1.pos;return r.setOpen(),r.push(t),this.forEachPoint(function(t,e){if(r.push(t),t===i.p1)return!0},!0,e),r.push(i),r}hasPointsInside(i,r){if(!i.overlaps(this))return!1;let n,s=!1;return this.forEachSegment((t,e)=>t.distTo2D(e)>p.precision_midpoint_check_dist&&(n=t.midPointTo(e),n.inPolygon(i)||n.nearPolygon(i,r||p.precision_close_to_poly_sq))||(e.inPolygon(i)||e.nearPolygon(i,r||p.precision_close_to_poly_sq))?s=!0:void 0),s}isNear(i,t,e){const r=p.precision_midpoint_check_dist,n=t||p.precision_close_to_poly_sq;let s=!1,o=e?this.cacheNear=this.cacheNear||{}:void 0;return o&&void 0!==o[i.id]?o[i.id]:(this.forEachSegment((t,e)=>t.distToSq2D(e)>r&&t.midPointTo(e).nearPolygon(i,n)||e.nearPolygon(i,n)?s=!0:void 0),o&&(o[i.id]=s),s)}isInside(i,t){const r=t||p.precision_close_to_poly_sq;if(!this.bounds.isNested(i.bounds,3*r))return!1;let n,s=p.precision_midpoint_check_dist,o=!0;return this.forEachSegment((t,e)=>(!(t.distTo2D(e)>s)||(n=t.midPointTo(e),n.inPolygon(i)||n.nearPolygon(i,r)))&&(e.inPolygon(i)||e.nearPolygon(i,r))?void 0:!(o=!1),this.open),o}containedBySet(e){if(!e)return!1;for(let t=0;t<e.length;t++)if(e[t].contains(this))return!0;return!1}addInner(t){return(t.parent=this).inner?this.inner.push(t):this.inner=[t],this}innerCount(){return this.inner?this.inner.length:0}hasInner(){return this.inner&&0<this.inner.length}clearInner(){return this.inner=null,this}freeParentRefs(){if(this.inner&&0<this.inner.length)for(var t of this.inner)t.freeParentRefs(),delete t.parent;for(var e of this.points)delete e.poly}newUndeleted(){let e=M();return this.forEachPoint(t=>{t.del||e.push(t)}),e}circularity(){return 4*Math.PI*this.area()/K.sqr(this.perimeter())}circularityDeep(){return 4*Math.PI*this.areaDeep()/K.sqr(this.perimeter())}perimeter(){if(this.perim)return this.perim;let i=0;return this.forEachSegment((t,e)=>{i+=Math.sqrt(t.distToSq2D(e))},this.open),this.perim=i}perimeterDeep(){let e=this.perimeter();return this.inner&&this.inner.forEach(t=>{e+=t.perimeter()}),e}area(t){if(this.length<3)return 0;if(void 0===this.area2){this.area2=0;for(let t=this.points,e=t.length,i=0,r,n;i<e;i++)r=t[i],n=t[(i+1)%e],this.area2+=(n.x-r.x)*(n.y+r.y)}return t?this.area2:Math.abs(this.area2/2)}areaDeep(){if(!this.inner)return this.area();let t,e=this.inner,i=this.area();for(t=0;t<e.length;t++)i-=e[t].area();return i}overlaps(t){return this.bounds.overlaps(t.bounds,p.precision_merge)}fromXYArray(t,e){let i=0;for(;i<t.length;)this.add(t[i++],t[i++],e||0);return this}simple(){return this.clean(!0,void 0,Math.min(p.clipper/10,5*p.clipperClean))}clean(t,e,i=p.clipperClean){let r=f(this.toClipper()[0],i),n=k(r,this.getZ());if(0===n.length)return this;if(t&&this.inner&&(n.inner=this.inner.map(t=>t.clean(!1,n,i))),n.parent=e||this.parent,n.area2=this.area2,n.open=this.open,this.open){var s=this.points[0];let i=n.points;var o=i.length;let r,e=1/0;for(let t=0;t<o;t++){var h=i[t].distTo2D(s);h<e&&(e=h,r=t)}if(r){let e=[];for(let t=r;t<o;t++)e.push(i[t]);for(let t=0;t<r;t++)e.push(i[t]);n.points=e}}return n}toClipper(t){let e=this,i=t||[];if(i.push(e.points.map(t=>t.toClipper())),e.inner)for(var r of e.inner)r.toClipper(i);return i}offset(t,e){return T.expand([this],-t,this.getZ(),e)}offset_open(s,o="miter",h=2){if(this.isOpen()){let t=new b,e=t.MiterLimit=h,i=new m,r={square:v.etOpenSquare,round:v.etOpenRound,miter:v.etOpenSquare}[o]||v.etOpenSquare,n={square:x.jtSquare,round:x.jtRound,miter:x.jtMiter}[o]||x.jtMiter;return t.AddPaths(this.toClipper(),n,r),t.Execute(i,s*p.clipper),T.fromClipperTree(i,this.getZ(),null,null,0)}return this.offset(s)}isEquivalent(o,e,t){var i=Math.abs(this.area()),r=Math.abs(o.area());if(K.isCloseTo(i,r,t||p.precision_poly_area)&&this.bounds.equals(o.bounds,t||p.precision_poly_bounds)){var h=this.circularity(),l=o.circularity();if(Math.abs(h-l)<p.precision_circularity&&1-h<p.precision_circularity)return!0;if(e){let t,e=this.inner,i=o.inner;if(e!==i){if(null===e||null===i||e.length!=i.length)return!1;for(t=0;t<e.length;t++)if(!e[t].isEquivalent(i[t]))return!1}}let t=!0,r,n,s;return this.forEachPoint(i=>{if(r=!1,o.forEachSegment((t,e)=>(n=i.distToLine(t,e))<p.precision_poly_merge?r=!0:void(s=Math.min(s,n))),!r)return!(t=!1)}),t}return!1}findClosestPointTo(i){let r,n,s,o=1/0;return this.forEachPoint((t,e)=>{r=Math.sqrt(t.distToSq2D(i)),r<o&&(n=e,o=r,s=t)}),{point:s,distance:o,index:n}}flattenTo(t,e,i){if(t.push(this),e){if(e.contains(this))return void console.log("flat recursion @",this);e.push(this)}if(this.inner)for(var r of this.inner)r.flattenTo(t,e,i);return i&&(this.inner=void 0),t}shortestSegmentLength(){let i=1/0;return this.forEachSegment((t,e)=>{i=Math.min(i,t.distTo2D(e))}),i}diff(t){let e=(this.fillang&&this.area()>t.area()?this:t).fillang,i=new a,r=new m,n=this.toClipper(),s=t.toClipper();return i.AddPaths(n,g,!0),i.AddPaths(s,y,!0),i.Execute(w,r,d,d)?((t=T.fromClipperTree(r,t.getZ())).forEach(t=>t.fillang=e),t):null}xor(t){let e=(this.fillang&&this.area()>t.area()?this:t).fillang,i=new a,r=new m,n=this.toClipper(),s=t.toClipper();return i.AddPaths(n,g,!0),i.AddPaths(s,y,!0),i.Execute(z,r,c,c)?((t=T.fromClipperTree(r,t.getZ())).forEach(t=>t.fillang=e),t):null}mask(t,e,i){let r=(this.fillang&&this.area()>t.area()?this:t).fillang,n=new a,s=new m,o=this.toClipper(),h=t.toClipper();return n.AddPaths(o,g,!0),n.AddPaths(h,y,!0),n.Execute(C,s,d,d)?((t=T.fromClipperTree(s,this.getZ(),void 0,void 0,i)).forEach(t=>{t.fillang=r}),e&&1===t.length&&t[0].isEquivalent(this)?null:t):null}cut(t,e){let i=this;i.open||(i=this.clone(!0).setOpen(),i.push(i.first()),i.inner&&i.inner.forEach(t=>{t.setOpen(),t.push(t.first())}));let r=new a,n=new m,s=e?C:w,o=i.toClipper(),h=T.toClipper(t);if(r.AddPaths(o,g,!1),r.AddPaths(h,y,!0),r.Execute(s,n,d,d)){let t=T.fromClipperTree(n,i.getZ(),null,null,0);return t.forEach(t=>{t.open&&t.first().distTo2D(t.last())<.001&&(t.open=!1,t.points.pop()),t.depth=this.depth}),t}return null}intersect(t,e){if(!this.overlaps(t))return null;if(this.isInside(t))return[this];let i=new a,r=new m,n=this.toClipper(),s=t.toClipper(),o=0<=e?e:.1;var h;return i.AddPaths(n,g,!0),i.AddPaths(s,y,!0),i.Execute(C,r,c,c)?T.fromClipperTreeUnion(r,t.getZ(),o).filter(t=>t.isInside(this)):null}areaDiff(t){var e=this.area(),i=t.area();return i<e?i/e:e/i}simplify(t={}){let r=this.getZ();if(t.pump){var e=T.offset([this],t.pump,{z:r});return e?e=T.offset(e,-t.pump,{z:r}):null}let i=this.toClipper(),n=a.SimplifyPolygons(i,c);return n&&n.length?n.map(t=>{let e=M();for(var i of t)e.push(J.pointFromClipper(i,r));return e}):null}unionMatch(t){return t.filter(t=>t.isEquivalent(this)).length}union(e,t,i){if(!this.overlaps(e))return null;let r=(this.fillang&&this.area()>e.area()?this:e).fillang,n=new a,s=new m,o=this.toClipper(),h=e.toClipper(),l=t??.1;if(n.AddPaths(o,g,!0),n.AddPaths(h,y,!0),n.Execute(_,s,d,d)){let t=T.fromClipperTreeUnion(s,e.getZ(),l);if(i)return 2===t.length?null:t;if(1===t.length)return t=t[0],t.fillang=r,t;console.trace({check_union_call_path:t,this:this,poly:e})}return null}annotate(t={}){return Object.assign(this,t),this}ribbonZ(e=1,i=0,t){var r;let n=[],s=this.clone().setClockwise().points;var o=s.length;t&&(s=s.slice().reverse());for(let t=0;t<o;t++){var h=s[t],l=s[(t+1)%o];n.push(h.x,h.y,h.z+i),n.push(l.x,l.y,l.z+e+i),n.push(l.x,l.y,h.z+i),n.push(h.x,h.y,h.z+i),n.push(h.x,h.y,h.z+e+i),n.push(l.x,l.y,l.z+e+i)}return n}ribbonMesh(p){if(this.inner&&1===this.inner.length){let t=this.clone().setClockwise(),e=this.inner[0].clone().setClockwise();var u=t.circularity(),f=e.circularity(),c=t.points.length,d=e.points.length;let i=t.points.slice(),r=e.points.slice(),n={d:1/0,i:0,j:0};for(let e=0;e<i.length;e++)for(let t=0;t<r.length;t++){var g=i[e].distTo2D(r[t]);g<n.d&&(n={d:g,i:e,j:t})}i=i.slice(n.i).concat(i.slice(0,n.i)),i.push(i[0]),r=r.slice(n.j).concat(r.slice(0,n.j)),r.push(r[0]);let s=[],o=0,h=0,l=i[o],a=r[h];for(;;){var y=i[o+1],v=r[h+1];if(!y&&v||v&&l.distTo2D(v)<a.distTo2D(y))s.push(l.x,l.y,l.z),p?(s.push(a.x,a.y,a.z),s.push(v.x,v.y,v.z)):(s.push(v.x,v.y,v.z),s.push(a.x,a.y,a.z)),h++,a=r[h];else{if(!y)break;s.push(l.x,l.y,l.z),p?(s.push(a.x,a.y,a.z),s.push(y.x,y.y,y.z)):(s.push(y.x,y.y,y.z),s.push(a.x,a.y,a.z)),o++,l=i[o]}}return s}}extrude(e=1,t={}){let i=this.earcut();if(0===e)return i.map(t=>t.points.map(t=>[t.x,t.y,t.z])).flat().flat();var r=e<0;r&&(e=-e);var n=t.chamfer||0,s;let o=t.chamfer_top||n,h=t.chamfer_bottom||n;r&&(s=o,o=h,h=s);var l="number"==typeof t?t:t.zadd||0;let a=[],p=i,u=i;var f=e+l,c=l,d,g,y,v,x,m;let z=e,w=c;if(n<0&&(o=0,h=-n),o){let t=this.offset(o);if(1===t.length){t[0].setZ(f),p=t[0].earcut(),z-=o;for(g of T.renest([this.clone(!0).setZ(z),t[0]]))a.appendAll(g.ribbonMesh(!0))}}if(h){let t=this.offset(h);if(1===t.length){t[0].setZ(0),u=t[0].earcut(),z-=o||h,w+=h;for(v of T.renest([this.clone(!0).setZ(w),t[0]]))a.appendAll(v.ribbonMesh(!1))}}for(x of p)for(var _ of x.points)a.push(_.x,_.y,f);for(m of u)for(var C of m.points.reverse())a.push(C.x,C.y,c);var b=e-o-h,P;a.appendAll(this.ribbonZ(b,w));for(P of this.inner||[])a.appendAll(P.ribbonZ(b,w,!0));if(r)for(let t=2;t<a.length;t+=3)a[t]-=e;return a}segment(n=1){const s=[];var o=this.points,h=o.length,l=this.open?h-1:h;for(let t=0,e=o,i=h,r=i+1;t<l;t++){var a=e[t],p=e[(t+1)%i],u=p.x-a.x,f=p.y-a.y,c=Math.sqrt(u*u+f*f);if(s.push(a),!(c<n)){var d,g=0|c/n,y=g-1,v=u/g,x=f/g;let e=a.x+v,i=a.y+x;for(let t=0;t<y;t++)s.push(Q(e,i,(a.z+p.z)/2)),e+=v,i+=x}}return s.length>h?M().addPoints(s.map(t=>t.clone())).setOpenValue(this.open):this}midpoints(i=.01){const r=[];var n=this.points,s=n.length,o=this.open?s-1:s;let h=0;for(let t=0,e=n;t<o;t++){const f=e[t];var l=e[(t+1)%s],a=l.x-f.x,p=l.y-f.y,u;Math.sqrt(a*a+p*p)<i?(r.push(f.midPointTo(l)),h++):r.push(f)}return h?M().addPoints(r.map(t=>t.clone())).setOpenValue(this.open):this}}function A(t,e){var i=t.angle,r;let n=e.angle-i;for(;n<-180;)n+=360;for(;180<n;)n-=360;return Math.abs(n)}function k(t,e){let i=M(),r=0,n=t.length;for(;r<n;)i.push(J.pointFromClipper(t[r++],e));return i}function M(t){return new E(t)}E.fromArray=function(t){return M().fromArray(t)},gapp.overlay(J,{Polygon:E,newPolygon:M})});"use strict";gapp.register("geo.slicer",[],(G,e)=>{const{base:D}=G,{config:_,util:E,polygons:t}=D,{newOrderedLine:g,newPolygon:Z,newPoint:j}=D,P=D.polygons;function B(e,t){return void 0!==e?e:t}async function n(n,e={}){let t=e.zMin||0,u=e.zMax||0,o=e.zInc||0,r=e.zGen,g=e.indices||[],l=e.minstep||0,s={},i={},a=[],p,h=0,f=[],d=e.overlap||.75,c=e.bucketMax||100,z=e.onupdate||function(){},v=B(e.slicer,H),{debug:m,flat:M,autoDim:x}=e,k,y,b,w,D;if(!n||!n.length)throw"missing points array";if(M){let e=[];for(k=0,y=n.length;k<y;)e.push(j(n[k++].round(3),n[k++].round(3),n[k++].round(3)));n=e}else for(k=0;k<n.length;k++)n[k]=n[k].round(3);for(k=0;k<n.length;){var P,S;b=n[k++],w=n[k++],D=n[k++],h+=Math.abs(b.z-w.z)+Math.abs(w.z-D.z)+Math.abs(D.z-b.z),b.z===w.z&&w.z===D.z&&b.z>=t?(P=b.z,S=Math.abs(E.area2(b,w,D))/2,s[P]?s[P]+=S:s[P]=S,a[P]=(a[P]||0)+1):b.z===w.z?a[b.z]=(a[b.z]||0)+1:w.z===D.z?a[w.z]=(a[w.z]||0)+1:D.z===b.z&&(a[D.z]=(a[D.z]||0)+1),x&&(t=Math.min(t,b.z,w.z,D.z),u=Math.max(u,b.z,w.z,D.z)),i[b.z]=b.z,i[w.z]=w.z,i[D.z]=D.z}if(o)for(k=t;k<=u;k+=o)g.push(k);else if(!g.length&&(g=Object.values(i).sort((e,t)=>e-t),0<l)){let t;g=g.filter(e=>!(void 0!==t&&e-t<l)&&(t=e,!0))}r&&(g=r({zMin:t,zMax:u,zLine:a,zFlat:s,zIndexes:g,options:e})),g=g.map(e=>e.round(3));var T=u-t,q=h/n.length;let A=!1!==e.bucket?Math.min(c,Math.max(1,Math.floor(T/q))):1;if(p=1/(u/A),m&&console.log({zMin:t,zMax:u,zIndexes:g,zScale:p,zSum:h,zSpanAvg:q,points:n,bucketCount:A,options:e,buckets:f}),0==T||0==h||0==n.length)return{};for(k=0;k<A;k++)f.push({points:[],slices:[]});if(1<A){let e=n.length*d|0,t;e:for(k=0;k<n.length;){b=n[k++],w=n[k++],D=n[k++];var I=Math.max(0,Math.min(b.z,w.z,D.z)),L=Math.max(b.z,w.z,D.z),O=Math.floor(I*p),C=Math.min(Math.ceil(L*p),A);for(y=O;y<C;y++)if(t=f[y].points,t.push(b),t.push(w),t.push(D),t.length>e){m&&console.log({bucketFail:t.length}),A=1;break e}}}1===A&&(f=[{points:n,slices:[]}]);for(let o=0,e=g.length;o<e;o++){let e=g[o],t=A<=1?0:Math.min(Math.floor(e*p),A-1),n=f[t];n?n.slices.push(e):console.log({missing_bucket:e,index:t}),z(o/g.length*.1)}async function F(){let n=[],o=0;var r={...e,zMin:t,zMax:u,zIndexes:g};let l=[];for(let e=0,t=f.length;e<t;e++){var s,{points:i,slices:a}=f[e];a.length&&l.push(v(a,i,{...r,each(e){n.push(e),z(.1+o++/g.length*.9)}}))}return await Promise.all(l),n}let G=v?await F():[];return G=G.sort((e,t)=>e.z-t.z),{slices:G,points:n,zMin:t,zMax:u,zIndexes:g,zFlat:s}}function S(e,t,n){var o=e.z-t;(Math.abs(o)<_.precision_slice_z?n.on:o<0?n.under:n.over).push(e)}function T(n,o,r){let l=[];for(let t=0;t<n.length;t++)for(let e=0;e<o.length;e++)l.push(n[t].intersectZ(o[e],r));return l}function s(e,t){var n=e[t.key];return n||(e[t.key]=t)}function q(e,t,n,o,r){t=s(e,t),n=s(e,n);let l=g(t,n);return l.coplanar=o||!1,l.edge=r||!1,l}async function H(t,n,r={}){if(Array.isArray(t))return Promise.all(t.map(e=>H(e,n,r)));let{zMin:o,zMax:l,under:s,over:i,both:a,each:e}=r,u=B(r.groupr,a?null:A),g={},p=[],h,f,d;s||a||(i=!0);for(let e=0;e<n.length;){h=n[e++],f=n[e++],d=n[e++];var c={under:[],over:[],on:[]},z;if(S(h,t,c),S(f,t,c),S(d,t,c),3!==c.under.length&&3!==c.over.length)if(2===c.on.length){(a||i&&(1===c.over.length||t===l)||s&&(1===c.under.length||t===o))&&p.push(q(g,c.on[0],c.on[1],!1,!0))}else if(3!==c.on.length&&0!==c.under.length&&0!==c.over.length){let e=T(c.over,c.under,t);e.length<2&&1===c.on.length&&e.push(c.on[0]),2===e.length?p.push(q(g,e[0],e[1])):console.log({msg:"invalid ips",line:e,where:c})}}if(0!=p.length||!r.noEmpty){p=I(p);let o={z:t,lines:p};if(u){let n=u(p,t,r);if(r.xor&&(n=P.xor(n)),r.union){let e=n.map(e=>e.length);1<e.length&&(e=e.reduce((e,t)=>e+t));var v={x:1};let t=P.union(P.nest(n),.1,!0,v);var m=v.changes<0?Math.abs(v.changes/e):0,M;2===n.length&&.4<=m&&(M=n[0].xor(n[1]),console.log({points:e,pct:(v.changes/e).round(3),xor:M.length}),M.length&&(t=M)),o.changes=v.changes,n=P.flatten(t,null,!0)}o.groups=n}if(r.post){let e=D.slicePost[r.post];e&&e(o,r)}var x,k,y,b,w;return e&&e(o),o}}function A(e,t,n={}){let{debug:d,both:o}=n;if(o)return d&&console.log('unable to connect lines sliced with "both" option'),[];let r={},l=[],s=[],u=[],i=0,a=!1,g=!1,p=_.bridgeLineGapDistance,h=_.bridgeLineGapDistanceMax,f,c,z;function v(e){var t=r[e.key];return t||(l.push(e),r[e.key]=e)}function m(e,t){e.group?e.group.push(t):e.group=[t]}function M(e){return e.perimeter||(e.perimeter=Z().addPoints(e).perimeter()),e.perimeter}function x(e,t,n,o=1){let r=[];for(t&&t.push(r);;){e.del=!0,r.push(e);var l=e.group.filter(e=>!e.del);if(2!==l.length||1!==o){var s=!t,i,a,u;if(1<l.length){if(s&&(t=[r],n=[]),n.length<500)for(var g of l){n.push(i=t.slice());for(u of x(g,i,n,o+1))u.del=!1}var p=n.map(e=>e.flat()).sort((e,t)=>M(t)-M(e)),h=p[0];if(d&&console.log({root:s,branches:n.slice(),flat:p,path:r,npath:h}),s){for(var f of h)f.del=!0;return h}return r}if(!(e=l[0])||e.del)return r}else e=l[0]}throw"invalid state"}function k(e){i+=e.length,(e=!n.dirty?e.clean():e).length,s.push(e),d&&console.log("xray",e)}function y(e){var t,n;0<=e[0].group.indexOf(e.peek())&&2<e.length?(d&&console.log({closed:e.length,path:e}),k(Z().addPoints(e))):1<e.length&&(n=e[0].distTo2D(e.peek()).round(4),d&&console.log({open:e.length,gap:n,path:e}),u.push(e))}e.forEach(function(e){f=v(e.p1),c=v(e.p2),m(f,c),m(c,f)});for(var b of l)z=b.group.length,a=a||2<z,g=g||z<2;if(d&&(a||g)&&console.log({forks:a,frays:g}),a){d&&console.log("process forks");for(var w of l){var D;!w.del&&2<w.group.length&&((D=x(w))&&y(D))}}if(g){d&&console.log("process frays");for(var P of l){var S;P.del||1!==P.group.length||(S=x(P))&&y(S)}}d&&console.log("process mids");for(var T of l){var q;T.del||(q=x(T))&&y(q)}d&&console.log({points:l,emitted:i,used:l.filter(e=>e.del),free:l.filter(e=>!e.del)}),d&&u.length&&console.log({connect:u}),d&&(u=u.map(e=>e.slice()));let A=1e3,I;do{I=1/0;e:for(let a=0;a<u.length;a++)if(p)t:for(;;){let n=u[a];if(n.delete)break;let o=n[0],r=n.peek(),l=o.distToSq2D(r),s={dist:l};for(let t=a+1;t<u.length;t++){let e=u[t];var L,O;e.delete||(L=e[0],O=e.peek(),l=r.distToSq2D(L),I=Math.min(I,l),l<s.dist&&l<=p&&(s={dist:l,next:e}),l=r.distToSq2D(O),I=Math.min(I,l),l<s.dist&&l<=p&&(s={dist:l,next:e,reverse:e}),l=o.distToSq2D(L),I=Math.min(I,l),l<s.dist&&l<=p&&(s={dist:l,next:e,reverse:n}),l=o.distToSq2D(O),I=Math.min(I,l),l<s.dist&&l<=p&&(s={dist:l,next:e,swap:t}))}let{next:e,reverse:t,swap:i}=s;if(!(e&&s.dist<p))break;d&&console.log({rollup:n.slice(),next:e.slice(),reverse:t,swap:i}),t&&t.reverse(),i?(e.appendAll(n),u[a]=e,u[i]=n,n.delete=!0,e.merged=!0):(n.appendAll(e),e.delete=!0,n.merged=!0)}else k(Z().addPoints(G).setOpen())}while(p=I<1/0?Math.max(I+.01,p+.1):p+.1,d&&console.log({iter:A,bridge:p,mingap:I,bridgeMax:h}),0<A--&&p&&p<h&&I<h);d&&console.log({remain:u.filter(e=>!e.delete)});for(var C of u)if(!C.delete){if(d){let e=C[0];var F=C.peek();let t=e.distToSq2D(F);console.log({dist:t.round(4),merged:C.merged||!1,array:C})}k(Z().addPoints(C))}return d&&console.log({emitted:i,output:s}),d&&i<l.length&&console.log({leftovers:l.length-i}),s}function I(e){let t=[],l=[],n=[],o={};function r(e){var t=o[e.key];return t||(n.push(e),o[e.key]=e)}function s(e,t){r(e),e.group?e.group.push(t):e.group=[t]}e.sort(function(e,t){return e.key===t.key?(e.del=!e.edge,t.del=!t.edge,0):e.key<t.key?-1:1});for(var i of e)i.del||(l.push(i),s(i.p1,i),s(i.p2,i));for(var a of n)if(2==a.group.length){let o=a.group[0],r=a.group[1];if(o.isCollinear(r)){o.del=!0,r.del=!0;let e=o.p1!=a?o.p1:o.p2,t=r.p1!=a?r.p1:r.p2,n=g(e,t);e.group.remove(o),e.group.remove(r),t.group.remove(o),t.group.remove(r),e.group.push(n),t.group.push(n),n.edge=o.edge||r.edge,l.push(n)}}l.sort(function(e,t){return e.key===t.key?(e.del=!0,t.del=!t.edge,0):e.key<t.key?-1:1});for(var u of l)u.del||(t.push(u),u.p1.group=null,u.p2.group=null);return t}gapp.overlay(D,{slice:n,sliceZ:H,slicePost:{},sliceDedup:I,sliceConnect:A})});"use strict";gapp.register("geo.slope",[],(t,i)=>{var{base:s}=t;const{config:e}=s,h=Math.abs,n=Math.PI/180,r=180/Math.PI;class a{constructor(t,i,s,e){this.dx=t&&i?i.x-t.x:s,this.dy=t&&i?i.y-t.y:e,this.angle=Math.atan2(this.dy,this.dx)*r}toString(){return[this.dx,this.dy,this.angle].join(",")}clone(){return new a(null,null,this.dx,this.dy)}isSame(t){if(h(this.dx)<=e.precision_merge&&h(t.dx)<=e.precision_merge)return!0;if(h(this.dy)<=e.precision_merge&&h(t.dy)<=e.precision_merge)return!0;var i=Math.min(1/Math.sqrt(this.dx*this.dx+this.dy*this.dy),e.precision_slope_merge);return o(this.angle,t.angle,i||e.precision_slope)}normal(){var t=this.dx;return this.dx=-this.dy,this.dy=t,this.angle=Math.atan2(this.dy,this.dx)*r,this}invert(){return this.dx=-this.dx,this.dy=-this.dy,this.angle=Math.atan2(this.dy,this.dx)*r,this}toUnit(){var t=Math.max(h(this.dx),h(this.dy));return this.dx=this.dx/t,this.dy=this.dy/t,this}factor(t){return this.dx*=t,this.dy*=t,this}invert(){return this.dx=-this.dx,this.dy=-this.dy,this.angle=180-this.angle,this}angleDiff(t,i){var s=this.angle,e;let h=t.angle-s;for(;h<-180;)h+=360;for(;180<h;)h-=360;return i?h:Math.abs(h)}}function d(t,i,s){return h(t-i)<s}function o(t,i,s){return h(t-i)<=s||360-h(t-i)<=s}function l(t,i,s,e){return new a(t,i,s,e)}function g(t){return l(0,0,Math.cos(t*n),Math.sin(t*n))}gapp.overlay(s,{Slope:a,newSlope:l,newSlopeFromAngle:g})});"use strict";gapp.register("geo.wasm",[],(e,n)=>{const{base:d}=e,{config:c}=d,u=c.clipper,p={enable:o,disable:m,count:{offset:0,union:0,diff:0}};function t(){console.log(...arguments)}function w(e,n){let t=0;for(var r of n)t+=i(e,r);return t}function i(t,e,n){n?e.setCounterClockwise():e.setClockwise();let r=1;var a=e.points,o=e.inner;t.writeU16(a.length,!0);for(let e=0,n=a.length;e<n;e++){var f=a[e];t.writeI32(f.x*u|0,!0),t.writeI32(f.y*u|0,!0)}if(o)for(let e=0,n=o.length;e<n;e++)r+=i(t,o[e],!0);return r}function a(n,t){let r=n.readU16(!0);if(0!==r){let e=self.base.newPolygon();for(;0<r--;)e.add(n.readI32(!0)/u,n.readI32(!0)/u,t||0);return e}}function h(e,n,t=[]){for(;;){var r=a(e,n);if(!r)break;t.push(r)}return t}function f(e,n,t,r,a){p.count.offset++;let o=d.wasm,f=o.shared,i=w(new DataWriter(o.heap,f),e),s=o.fn.offset(f,i,n*u,r,a),l=h(new DataReader(o.heap,s),t);return g(l)}function s(e,n){p.count.union++;let t=d.wasm,r=t.shared,a=w(new DataWriter(t.heap,r),e),o=t.fn.union(r,a),f=h(new DataReader(t.heap,o),n);return g(f)}function l(e,n,t,r,a){p.count.diff++;let o=d.wasm,f=o.shared,i=new DataWriter(o.heap,f),s=w(i,e),l=w(i,n),u=o.fn.diff(f,s,l,r?1:0,a?1:0,c.clipperClean),m=new DataReader(o.heap,u);r&&r.appendAll(g(h(m,t))),a&&a.appendAll(g(h(m,t)))}function g(r){r.sort((e,n)=>n.bounds.minx-e.bounds.minx);for(let e=0,t=r.length;e<t;e++){var a=r[e];if(!a.inner)for(let n=e+1;n<t;n++){let e=r[n];if(e.bounds.contains(a.bounds)){e.addInner(a);break}}}let t=[];for(let e=0,n=r.length;e<n;e++){var o=r[e];o.parent||t.push(o)}return t}function r(e,n){let t=new DataReader(d.wasm.heap,e),r=[];for(;0<n--;)r.push(String.fromCharCode(t.readU8()));return r.join("")}function o(){d.wasm||d._wasm||(d._wasm="loading",fetch("/wasm/kiri-geo.wasm").then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,{env:{debug_string:(e,n)=>{console.log("wasm",r(n,e))}},wasi_snapshot_preview1:{proc_exit:e=>e}})).then(e=>{delete d._wasm;var{module:n,instance:t}=e,{exports:r}=t,a=new DataView(r.memory.buffer);let o=d.wasm={heap:a,exports:r,memory:r.memory,memmax:r.memory.buffer.byteLength,malloc:r.mem_get,free:r.mem_clr};o.shared=o.malloc(31457280),o.fn={diff:r.poly_diff,union:r.poly_union,offset:r.poly_offset},o.js={diff:l,union:s,offset:f}}))}function m(){d.wasm&&delete d.wasm}gapp.overlay(d,{wasm_ctrl:p})});"use strict";gapp.register("kiri-mode.cam.driver",[],(e,c)=>{const{kiri:o}=e,{driver:s}=o,i=s.CAM={process:{LEVEL:1,ROUGH:2,OUTLINE:3,CONTOUR_X:4,CONTOUR_Y:5,TRACE:6,DRILL:7}};o.load(t=>{o.client&&(i.surface_prep=function(e,c){o.client.sync();var s=t.conf.get();o.client.send("cam_surfaces",{settings:s,index:e},e=>{c(e)})},i.surface_show=function(e){e.selectFaces(Object.values(e._surfaces).flat())},i.surface_toggle=function(c,s,e,r){let t=c._surfaces=c._surfaces||{};for(var[a,n]of Object.entries(t))if(n.contains(s))return delete t[a],i.surface_show(c),void r(Object.keys(t).map(e=>parseInt(e)));o.client.send("cam_surface_find",{id:c.id,face:s,radians:e},e=>{e.length&&(t[s]=e,i.surface_show(c)),r(Object.keys(t).map(e=>parseInt(e)))})},i.surface_clear=function(e){e.selectFaces([]),e._surfaces={}},i.traces=function(s,e){o.client.sync();var c=t.conf.get();const r=t.widgets.map();o.client.send("cam_traces",{settings:c,single:e},e=>{const c=[];o.codec.decode(e).forEach(e=>{c.push(e.id),r[e.id].traces=e.traces}),s(c)})},i.traces_clear=function(e){o.client.send("cam_traces_clear",{},()=>{})}),o.worker&&(i.surface_prep=function(c,s){if(!c.tool){let e=c.tool=new mesh.tool;var r;e.index(c.getGeoVertices({unroll:!0,translate:!!s}))}},i.surface_find=function(e,c,s){return i.surface_prep(e),e.tool.findConnectedSurface(c,s||0,0)},o.worker.cam_surfaces=function(e,c){var{settings:s,index:r}=e,t,a;for(a of Object.values(o.worker.cache))r?(a.setIndexed(!0),a.setAxisIndex(-r)):(a.setIndexed(!1),a.setAxisIndex(0)),i.surface_prep(a,r);c.done({})},o.worker.cam_surface_find=function(e,c){var{id:s,face:r,radians:t}=e,a=o.worker.cache[s],n=i.surface_find(a,[r],t);c.done(n)},o.worker.cam_traces=async function(e,c){var{settings:s,single:r}=e,t,a;const n=[];for(a of Object.values(o.worker.cache))await i.traces(s,a,r)&&n.push(a);c.done(o.codec.encode(n.map(e=>({id:e.id,traces:e.traces}))))},o.worker.cam_traces_clear=function(e,c){for(var s of Object.values(o.worker.cache))delete s.traces,delete s.topo;c.done({})})})});"use strict";gapp.register("kiri-mode.cam.animate2",[],A=>{const{kiri:q}=A;var{driver:e}=q;const{CAM:C}=e;q.load(()=>{if(q.client){let y={},o={},x={},d,s=[0,0,0,0,0],t=[1,2,4,8,32],a=["1x","2x","4x","8x","!!"],i=t.length-1,n=0,r,b,l=0;var{moto:e}=A;const{space:I}=e,{api:T}=q;function u(e){let{anim:t}=e.ui;q.client.animate_cleanup2(),Object.keys(y).forEach(e=>M(e)),e.widgets.setAxisIndex(0),e.uc.setVisible(t.laba,!0),e.uc.setVisible(t.vala,!0),t.vala.value="0.0"}function h(s,a){let i=s.alerts.show("building animation"),n=s.conf.get();q.client.animate_setup2(n,e=>{var t;z(e),e||({anim:t}=s.ui,Object.assign(o,{replay:t.replay,play:t.play,step:t.step,pause:t.pause,speed:t.speed,trans:t.trans,model:t.model,shade:t.shade}),Object.assign(x,{progress:t.progress,speed:t.labspd,x:t.valx,y:t.valy,z:t.valz,a:t.vala}),E(0),setTimeout(m,a||0),f(void 0,!1),b=n.origin,o.replay.onclick=B,o.play.onclick=v,o.step.onclick=m,o.pause.onclick=k,o.speed.onclick=_,o.trans.onclick=f,o.model.onclick=p,o.shade.onclick=c,o.play.style.display="",o.pause.style.display="none",s.event.emit("animate","CAM"),s.alerts.hide(i))})}function g(e,t,s,a,i){const n=new THREE.BufferGeometry;var o=i?s.subarray(0,3*i):s,r=a?t.subarray(0,a):t;n.setAttribute("position",new THREE.BufferAttribute(o,3)),n.setIndex(new THREE.BufferAttribute(r,1));const l=new THREE.Mesh(n,d);l.pos=s,l.ind=t,I.world.add(l),y[e]=l}function w(e,t,s,a,i){const n=y[e];if(n){const o=n.geometry;n.pos=s||n.pos,n.ind=t||n.ind,o.setAttribute("position",new THREE.BufferAttribute(n.pos.subarray(0,3*i),3)),o.setIndex(new THREE.BufferAttribute(n.ind.subarray(0,a),1)),o.attributes.position.needsUpdate=!0,o.index.needsUpdate=!0,I.update()}}function M(e){I.world.remove(y[e]),delete y[e]}function p(e,t){T.local.toggle("cam.anim.model",t),T.widgets.all().forEach(e=>e.toggleVisibility(t))}function c(e,t,s){return!1!==s&&T.local.toggle("cam.anim.stock",t),T.event.emit("cam.stock.toggle",t??void 0)}function f(e,t){t=T.local.toggle("cam.anim.trans",t),d.transparent=t,d.needsUpdate=!0}function m(){E(),q.client.animate2({speed:r,steps:1},z)}function v(e){var{steps:t}=e;E(),1!==t&&(o.play.style.display="none",o.pause.style.display=""),q.client.animate2({speed:r,steps:t||1/0,pause:s[n]},z)}function _(e){var{steps:t}=e;E(1),o.play.style.display="none",o.pause.style.display="",q.client.animate2({speed:r,steps:t||1/0,pause:s[n]},z)}function k(){o.play.style.display="",o.pause.style.display="none",q.client.animate2({speed:0},z)}function z(e){if(e){var t,s,a,i,n,o,r,l,d,u;if(e.mesh_add&&({id:t,ind:s,pos:a,ilen:i,plen:n}=e.mesh_add,g(t,s,a,i,n),I.refresh()),e.mesh_del&&M(e.mesh_del),e.mesh_move){var{id:h,pos:p}=e.mesh_move;const m=y[h];m&&(m.position.x=p.x,m.position.y=p.y,m.position.z=p.z,I.refresh()),x.x.value=(p.x-b.x).toFixed(2),x.y.value=(p.y+b.y).toFixed(2),x.z.value=(p.z-b.z).toFixed(2)}if(void 0!==e.stock_index&&(T.widgets.setAxisIndex(e.stock_index),x.a.value=-e.stock_index.toFixed(1)),e.mesh_index){var{id:c,index:f}=e.mesh_index;const v=y[c];v&&(v.rotation.x=Math.PI/180*f,I.refresh())}e.mesh_update&&({id:o,ind:r,pos:l,ilen:d,plen:u}=e.mesh_update,w(o,r,l,d,u)),e&&e.progress&&(x.progress.value=(100*e.progress).toFixed(1))}}function E(e=0){e===1/0?n=i:0<e&&(n=(n+e)%t.length),T.local.set("cam.anim.speed",n),r=t[n],x.speed.value=a[n]}function B(){u(T),setTimeout(()=>{h(T,50)},250)}gapp.overlay(q.client,{animate2(e,t){q.client.send("animate2",e,t)},animate_setup2(e,t){l=e.controller.dark?8947848:0,d=new THREE.MeshMatcapMaterial({flatShading:!0,transparent:!1,opacity:.9,color:8947848,side:THREE.DoubleSide}),q.client.send("animate_setup2",{settings:e},t)},animate_cleanup2(e,t){q.client.send("animate_cleanup2",e,t)}}),gapp.overlay(C,{animate2:h,animate_clear2:u})}});const{CSG:O}=A.base;let a=1;class G{constructor(e,t,s){this.id=a++,this.vbuf=void 0,this.ibuf=void 0,this.ilen=0,this.sends=0,this.newbuf=!0,this.subtracts=0,this.mesh=O.Instance().Manifold.cube([e,t,s],!0)}send(e){var t=this.newbuf,s=0==this.sends++?"mesh_add":"mesh_update";e.data({[s]:{id:this.id,ind:t?this.ibuf:void 0,pos:t?this.vbuf:void 0,ilen:this.ilen,plen:this.plen}}),this.newbuf=!1,this.sends++}translate(e,t,s){const a=this.mesh;return this.mesh=this.mesh.translate(e,t,s),this.bounds=O.toBox3(this.mesh),a.delete(),this}updateMesh(e){var t,s,a,i;0<this.sends&&0===this.subtracts||(t=this.subtracts,this.subtracts=0,s=Date.now(),a=this.mesh.getMesh(),this.sharedVertexBuffer(3*a.numVert),this.sharedIndexBuffer(3*a.numTri),this.vbuf.set(a.vertProperties),this.ibuf.set(a.triVerts),i=Date.now(),e.push(this))}subtractTool(e){const t=this.mesh;this.mesh=this.mesh.subtract(e.mesh),t.delete(),this.subtracts++}sharedVertexBuffer(e){var t=this.vbuf;if(this.plen=e,t&&t.length>=e)return t;var s=new Float32Array(new SharedArrayBuffer(4*e+1048576));return this.newbuf=!0,this.vbuf=s}sharedIndexBuffer(e){var t=this.ibuf;if(this.ilen=e,t&&t.length>=e)return t;var s=new Uint32Array(new SharedArrayBuffer(4*e+1048576));return this.newbuf=!0,this.ibuf=s}}q.load(()=>{if(q.worker){let g,e,w,M,_,k,m,z,v,n=!1,c,f,E,B=-1,y,x,I,T=!1,A=!1,D=0,r=0,H=!1,l=10,R=0,V=0,t=0,b=0;function F(t){if(!H){if(0==R--)return A=!1,void F(t);if(!1===A||T||0===V)return P(t),H=!0,A=!1,T=!1,void t.done();let e=M[_];for(;e&&"laser"===e.type;)z=e,e=M[++_];if(!e)return console.log("animation completed in ",((Date.now()-E)/1e3).round(2)),A=!1,void F(t);var s;_++,!e.tool||k&&k.getID()===e.tool.getID()||(k&&z.point&&(U(z.point={x:z.point.x,y:z.point.y,z:g.z}),t.data(I)),j(e.tool.getID(),t));var a=B,i=2*w;if(z){var n=z.point,o=e.point;if(z=e,!o||!n)return F(t);var r=o.x-n.x,l=o.y-n.y,d=o.z-n.z,u,h=Math.abs((o.a||0)-(n.a||0))/360*(2*Math.PI*Math.max(o.z,n.z)),p=Math.sqrt(r*r+l*l+d*d+h*h);if(D+=p,D<i)F(t);else{var c=Math.max(Math.abs(r),Math.abs(l),Math.abs(d),h),f=Math.ceil(c/i),m=r/f,v=l/f,y=d/f,x=Math.sqrt(m*m+v*v+Math.min(1,y*y)+h*h);const b=[];for(let e=0,t=n.x,s=n.y,a=n.z;e<f;e++)b.push({x:t,y:s,z:a,a:n.a,md:x}),t+=m,s+=v,a+=y;D=0,b.push({...e.point,md:x}),S(a,b,t)}}else z=e,k&&U(e.point),F(t)}}function S(s,a,i,e=0){for(let t=e;t<a.length;t++){var n=a[t],o;if(!n)throw`no pos @ ${t} of `+a.length;U(n);let e=0;for(o of c)o.bounds.intersectsBox(y.bounds)&&(o.subtractTool(y),e++);if(r+=n.md,V&&r>=V)return r=0,P(i),void setTimeout(()=>{S(s,a,i,t+1)},l)}F(i)}function P(e){var t=[],s,a;for(s of c)s.updateMesh(t);for(a of t)a.send(e);if(I&&e.data(I),n){e.data({stock_index:f});for(var i of c)e.data({mesh_index:{id:i.id,index:-f}});n=!1}e.data({progress:_/M.length}),b++}function U(e){var t;I={mesh_move:{id:B,pos:{x:e.x,y:e.y,z:e.z}}},y.mesh&&y.mesh.delete(),y.mesh=y.root.translate(e.x,e.y,e.z),void 0!==e.a&&(t=y.mesh.rotate([e.a,0,0]),y.mesh.delete(),y.mesh=t,e.a!==f&&(n=!0,f=e.a)),y.bounds=O.toBox3(y.mesh)}function j(e,t){k&&t.data({mesh_del:B}),k=new C.Tool({tools:m},e);var s=O.Instance(),a=k.shaftLength()||15,i=k.shaftDiameter()/2,n=k.fluteLength()||15,o=x=k.fluteDiameter()/2,r=a+n,l;let{cylinder:d,sphere:u}=s.Manifold,h;h=k.isBallMill()?d(r-2*o,o,o,20,!0).add(u(o,20).translate(0,0,-(r-2*o)/2)).add(d(a,i,i,20,!0).translate(0,0,n/2)):k.isTaperMill()?(l=Math.max(k.tipDiameter()/2,.001),d(a,i,i,20,!0).translate(0,0,a/2).add(d(n,l,o,20,!0).translate(0,0,-n/2))):d(r,o,o,20,!0).add(d(a,i,i,20,!0).translate(0,0,n/2)),h=h.translate(0,0,(r-v)/2);var p=h.getMesh(),c=p.vertProperties,f=p.triVerts;y={root:h,index:f,vertex:c,bounds:O.toBox3(h)},t.data({mesh_add:{id:--B,ind:f,pos:c}})}q.worker.animate_setup2=function(e,s){var{settings:t}=e,{process:a}=t;const i=worker.print;var n=1e3*parseInt(t.controller.animesh),o=a.camStockIndexed;_=0,M=i.output.flat(),m=t.tools,g=t.stock,w=1/Math.sqrt(n/(g.x*g.y)),k=null,z=null,A=!1,T=!1,f=0,E=0,b=0,v=o?0:g.z,c=[];var{x:r,y:l,z:d}=g,u=parseInt(t.controller.animesh||2e3)/100,h=g.x/u;for(let t=0;t<u;t++){var p=-r/2+t*h+h/2;let e=new G(h,l,d).translate(p,0,0);c.push(e),e.updateMesh([]),e.send(s)}s.done()},q.worker.animate2=function(e,t){if(l=e.pause||l,V=e.speed||0,A)return t.done();R=e.steps||1,H=!1,A=0<V,E=E||Date.now(),F(t)},q.worker.animate_cleanup2=function(e,t){A&&(T=!0)}}})});"use strict";gapp.register("kiri-mode.cam.animate",[],(F,e)=>{const{kiri:V}=F;var{driver:t}=V;const{CAM:W}=t,a=!1,n=!1;function I(e){return e.onBeforeCompile=e=>{e.vertexShader=e.vertexShader.replace("#include <worldpos_vertex>",`
            #include <worldpos_vertex>
            vWorldPosition = vec3(transformed);
            `),e.vertexShader=`
            varying vec3 vWorldPosition;
        `+e.vertexShader,e.fragmentShader=`
            varying vec3 vWorldPosition;
        `+e.fragmentShader,e.fragmentShader=e.fragmentShader.replace("#include <dithering_fragment>",`
            #include <dithering_fragment>
            if (vWorldPosition.z < 0.0) {
                gl_FragColor.rgb += vec3(0.5, 0.0, 0.0); // Add red tint
            }
            `)},e}V.load(()=>{if(V.client){let d={},r={},p={},s=1,t=[1,2,4,8,32],a=[30,20,10,5,0],n=["1x","2x","4x","8x","!!"],o=t.length-1,l=0,i,c=0,m,u,f={x:0,y:0,z:0};const{moto:B}=F,{space:O}=B,{api:D}=V;function e(e){var{anim:t}=e.ui;B.space.platform.showGridBelow(!0),V.client.animate_cleanup(),Object.keys(d).forEach(e=>y(e)),_(void 0,!0,!1),e.uc.setVisible(t.laba,!1),e.uc.setVisible(t.vala,!1)}function v(a,n){let o=a.alerts.show("building animation"),i=a.conf.get();V.client.animate_setup(i,e=>{var t;T(e),e&&e.mesh_add&&({anim:t}=a.ui,Object.assign(r,{replay:t.replay,play:t.play,step:t.step,pause:t.pause,speed:t.speed,trans:t.trans,model:t.model,shade:t.shade}),Object.assign(p,{progress:t.progress,speed:t.labspd,x:t.valx,y:t.valy,z:t.valz}),u=i.origin,l=a.local.getInt("cam.anim.speed")||0,A(),setTimeout(b,n||0),r.replay.onclick=S,r.play.onclick=z,r.step.onclick=b,r.pause.onclick=M,r.speed.onclick=k,r.trans.onclick=w,r.model.onclick=x,r.shade.onclick=_,r.play.style.display="",r.pause.style.display="none",a.event.emit("animate","CAM"),a.alerts.hide(o),B.space.platform.showGridBelow(!1),w(0,a.local.getBoolean("cam.anim.trans",!0)),x(0,a.local.getBoolean("cam.anim.model",!1)),_(0,a.local.getBoolean("cam.anim.stock",!1)))})}function h(e,t,a,n){const o=new THREE.BufferGeometry;n&&(a=new Float32Array(n)),o.setAttribute("position",new THREE.BufferAttribute(a,3)),t.length&&o.setIndex(new THREE.BufferAttribute(new Uint32Array(t),1));let i;var r,s;o.computeVertexNormals(),i=new THREE.Mesh(o,m),i.renderOrder=-10,O.world.add(i),d[e]=i}function g(e){const t=d[e];t&&(t.geometry.attributes.position.needsUpdate=!0,O.update())}function y(e){O.world.remove(d[e]),delete d[e]}function x(e,t){D.local.toggle("cam.anim.model",t),D.widgets.all().forEach(e=>e.toggleVisibility(t))}function _(e,t,a){return!1!==a&&D.local.toggle("cam.anim.stock",t),D.event.emit("cam.stock.toggle",t??void 0)}function w(e,t){t=D.local.toggle("cam.anim.trans",t),m.transparent=t,m.needsUpdate=!0}function b(){A(),V.client.animate({speed:i,steps:1},E)}function z(e){var{steps:t}=e;A(),1!==t&&(r.play.style.display="none",r.pause.style.display=""),V.client.animate({speed:i,steps:t||1/0,pause:a[l]},E)}function k(e){var{steps:t}=e;A(1),r.play.style.display="none",r.pause.style.display="",V.client.animate({speed:i,steps:t||1/0,pause:a[l]},E)}function M(){r.play.style.display="",r.pause.style.display="none",V.client.animate({speed:0},E)}function E(e){T(e),e&&e.progress&&(p.progress.value=(100*e.progress).toFixed(1))}function A(e=0){e===1/0?l=o:0<e&&(l=(l+e)%t.length),D.local.set("cam.anim.speed",l),i=t[l],p.speed.value=n[l]}function S(){e(D),setTimeout(()=>{v(D,50)},250)}function T(e){if(e){var t,a,n,o,i;if(e.mesh_add&&({id:t,ind:a,pos:n,offset:o,sab:i}=e.mesh_add,h(t,a,n,i),O.refresh(),o&&(f=o)),e.mesh_del&&y(e.mesh_del),e.mesh_move){var{id:r,pos:s}=e.mesh_move;const l=d[r];l&&(l.position.x=s.x,l.position.y=s.y,l.position.z=s.z,O.update()),p.x.value=(s.x-u.x).toFixed(2),p.y.value=(s.y+u.y).toFixed(2),p.z.value=(s.z-u.z).toFixed(2)}e.mesh_update&&g(e.id)}}gapp.overlay(V.client,{animate(e,t){V.client.send("animate",e,t)},animate_setup(e,t){c=e.controller.dark?4743291:6324132,s="in"===e.controller.units?1/25.4:1;var a=!0,n=!0,o=.9,i=THREE.DoubleSide;m=new THREE.MeshPhongMaterial({flatShading:!0,transparent:!0,opacity:.9,color:c,side:i}),I(m),V.client.send("animate_setup",{settings:e},t)},animate_cleanup(e,t){V.client.send("animate_cleanup",e,t)}}),gapp.overlay(W,{animate:v,animate_clear:e})}}),V.load(()=>{if(!V.worker)return;let x,y,_,w,b,z,k,M,E,f,A,S=1;function v(e,n,o,i,r){var t,a=new SharedArrayBuffer(3*(e*n)*4);const s=new Float32Array(a),l=[];var d=o.x/2,p=o.y/2,c=e-1,m=n-1;for(let t=0,a=0;t<e;t++)for(let e=0;e<n;e++){var u=s[a++]=t*i-d+i/2,f=s[a++]=e*i-p+i/2,v,h,g,y;s[a++]=!r||t*e!=0&&t!==c&&e!==m?o.z:0,0<t&&0<e&&(v=n*(t-1)+e-1,h=n*+t+e-1,g=n*+t+e,y=n*(t-1)+e,l.appendAll([v,h,g,v,g,y]))}return{pos:s,ind:l,sab:a}}V.worker.animate_setup=function(e,t){var{settings:a}=e,{process:n}=a;const o=worker.print;var i=1e3*parseInt(a.controller.animesh);M=0,k=o.output.flat(),f=a.tools,x=a.stock,z=1/Math.sqrt(i/(x.x*x.y));var r=z,s=Math.floor(x.x/r),l=Math.floor(x.y/r),{pos:d,ind:p,sab:c}=v(s,l,x,r,!0),m={x:n.camOriginCenter?0:x.x/2,y:n.camOriginCenter?0:x.y/2,z:n.camOriginTop?-x.z:0};_=d,w=s,b=l,E=null,A=null,B=!1,T=!1,y=Object.assign({},x.center),y.z-=x.z/2,t.data({mesh_add:{id:0,ind:p,offset:m,sab:c}},[]),t.data({mesh_move:{id:0,pos:y}}),t.done()},V.worker.animate=function(e,t){if(r=e.pause||r,I=e.speed||0,B)return t.done();F=e.steps||1,D=!1,B=0<I,P(t)};let T=!(V.worker.animate_cleanup=function(e,t){B&&(T=!0)}),B=!1,O=0,D=!1,r=10,F=0,I=0;var e=null;let C,s=0;function H(e){C&&e.data(C),e.data({progress:M/k.length,id:0,mesh_update:1})}function P(t){if(!D){if(0==F--)return B=!1,void P(t);if(!1===B||T||0===I)return H(t),D=!0,B=!1,T=!1,void t.done();let e=k[M];for(;e&&"laser"===e.type;)A=e,e=k[++M];if(!e)return B=!1,void P(t);M++;var a=!E&&e.tool,n=!a&&E.getID()!==e.tool.getID(),o;(a||n)&&(E&&A.point&&(o=A.point={x:A.point.x,y:A.point.y,z:x.z},t.data({mesh_move:{toolID:S,pos:o}})),j(e.tool,t));var i=S,r=z;if(A){var s=A.point,l=e.point;if(A=e,!l||!s)return P(t);var d=l.x-s.x,p=l.y-s.y,c=l.z-s.z,m=Math.sqrt(d*d+p*p+c*c);if(O+=m,O<r)P(t);else{var u=Math.max(Math.abs(d),Math.abs(p),Math.abs(c)),f=Math.ceil(u/r),v=d/f,h=p/f,g=c/f;const y=[];for(let e=0,t=s.x,a=s.y,n=s.z;e<f;e++)y.push({x:t,y:a,z:n}),t+=v,a+=h,n+=g;y.push(e.point),R(i,y,t)}}else A=e,E&&(E.pos=e.point,C={mesh_move:{id:i,pos:e.point}}),P(t)}}function R(t,a,n,o=0){for(let e=o;e<a.length;e++){var i=a[e];if(!i)throw`no pos @ ${e} of `+a.length;if(l(E.pos=i,n),C={mesh_move:{id:t,pos:i}},I&&O>=I||600<s)return O=s=0,H(n),void setTimeout(()=>{R(t,a,n,e)},r)}s++,P(n)}function l(e,t){var a=E.profile,{size:n,pix:o}=E.profileDim,i=Math.floor(o/2),r=Math.floor((e.x+x.x/2-n/2-y.x)/z),s=Math.floor((e.y+x.y/2-n/2-y.y)/z);let l=0;for(let e=0,t=a.length;e<t;){var d=i+a[e++],p=i+a[e++],c=a[e++],m=r+d,u=s+p,f,v,h,g;m<0||u<0||m>w-1||u>b-1||(v=3*(m*b+u)+2,h=_[v],(g=E.pos.z-c)<h&&(l++,_[v]=g))}}function j(e,t){E&&t.data({mesh_del:S}),E=new W.Tool({tools:f},e.getID()),E.generateProfile(z);var a=E.fluteLength()||15,n=E.shaftLength()||15,o=E.profile,{size:i,pix:r}=E.profileDim;const{pos:s,ind:l,sab:d}=v(r,r,{x:i,y:i,z:a+n},z);var p=Math.floor(r/2);for(let e=0,t=o.length;e<t;){var c=p+o[e++],m=p+o[e++],u=o[e++];s[3*(c*r+m)+2]=-u}t.data({mesh_add:{id:++S,ind:l,sab:d}})}})});"use strict";gapp.register("kiri-mode.cam.export",(e,t)=>{const{base:ce,kiri:ye}=e,{polygons:o,util:fe}=ce;var{driver:n}=ye;const{CAM:i}=n;var a=o,r=i.process;i.export=function(U,W){const J=U.widgets[0];if(J){var{settings:q}=U,K,V;const{device:se,tools:le}=q;let o,u=0,i=0,a=0,e=0,z=1,r=[],h=0,v=0,M=0,b=se.spindleMax,t=q.origin||{x:0,y:0,z:0},O=se.gcodeSpace?" ":"",A="rml"===se.gcodeFExt?.toLowerCase(),n=se.gcodeStrip||!1,S=se.gcodeChange||["M6 T{tool}"],_=se.gcodeSpindle||["M3 S{speed}"],E=se.gcodeDwell||["G4 P{time}"],C={X:"X",Y:"Y",Z:"Z",A:"A",F:"F"},d=q.device,F=q.process,I=F.camFastFeedZ,T=F.camFastFeed,D=ce.config.gcode_decimals||3,Z={x:null,y:null,z:null,a:void 0,f:null,t:null,emit:null},p,s,l,x,P=0,X="",m=!1,k=!1,w=!1,Y,c=q.stock||{},y=c.z-J.track.top,f=J.getBoundingBox(),g=c.z,$={max:{x:-1/0,y:-1/0,z:-1/0},min:{x:1/0,y:1/0,z:1/0}},G={x:-t.x,y:t.y,z:F.camOriginTop?t.z-g:t.z},N={x:1,y:1,z:1},j={box:$,tool:0,tool_name:"unknown",top:(G,d.bedDepth),left:(G,0),right:(G,d.bedWidth),bottom:(G,0),time_sec:0,time_ms:0,time:0},R=[];for(K of se.gcodePre)if(0===K.indexOf(";; SCALE "))try{var H=JSON.parse(K.substring(9));H.X&&(N.x=H.X),H.Y&&(N.y=H.Y),H.Z&&(N.z=H.Z),H.A&&(N.a=H.A),void 0!==H.DEC&&(D=parseInt(H.DEC)),console.log("export scaling applied",H)}catch(e){console.log("malformed scale directive",K)}else if(0===K.indexOf(";; REWRITE-COMMENTS-PARENS"))m=!0;else if(0===K.indexOf(";; DECIMALS"))D=parseInt(K.split("=")[1].trim()||3)||3;else if(0===K.indexOf(";; COMPACT-OUTPUT"))k=!0,n=!0,O="";else if(0===K.indexOf(";; AXISMAP ")){var Q=JSON.parse(K.substring(11).trim()),ee;for(ee in Q)C[ee]=Q[ee]}else R.push(K);if(ie("header"),!n)for(var te in ae("; Generated by Kiri:Moto "+ye.version),ae("; "+(new Date).toString()),re(["; Bed left:{left} right:{right} top:{top} bottom:{bottom}"],j),ae(`; Stock X:${c.x.round(2)} Y:${c.y.round(2)} Z:`+c.z.round(2)),ae("; Target: "+q.filter[q.mode]),ae("; --- process ---"),F)"ops"!==te&&"op2"!==te&&ae("; "+te+" = "+F[te]);let B={},L;const xe=(G,G.x||G.y);U.output.forEach(e=>{Array.isArray(e)&&e.forEach(e=>{e.gcode||"lerp"===e.type||(e.tool&&e.tool!==L&&(L=e.tool,B[e.tool]=L),x=e.point,x&&!x.mod&&(x.mod=1,xe&&(x.x+=G.x,x.y+=G.y),N&&(x.x*=N.x,x.y*=N.y,x.z*=N.z),x.a&&N.a&&(x.a*=N.a),F.outputInvertX&&(x.x=-x.x),F.outputInvertY&&(x.y=-x.y),F.camOriginTop&&(x.z=x.z-g)))})}),n||(ae("; --- tools ---"),Object.keys(B).sort().forEach(e=>{var{number:t,flute_diam:o,flute_len:n,metric:i}=B[e].tool;ae(`; tool#=${t} flute=${o} len=${n} unit=`+(i?"metric":"imperial"))})),re(R,j);for(V of U.output){var oe=V.mode;oe&&("laser on"===oe.type?Y=oe:"laser off"===oe.type&&(Y=void 0,Z.t=void 0));var ne=V[0];const me=oe&&!oe.silent&&l!==oe;me&&(l&&!n&&ae("; ending "+l.type+" op after "+Math.round(u)+" seconds"),l=oe,l&&ie(`op-${e++}-`+l.type),!n&&l&&ae("; starting "+l.type+" op")),v=V.spindle,V.forEach((e,t)=>{"lerp"!==e.type&&(e.gcode&&Array.isArray(e.gcode)?re(e.gcode,j):pe(e,{newOp:0===t&&me}))}),w&&Y&&(re(Y.off,j),w=!1)}function ie(e){ae(),W({section:e})}function ae(e){if(e){if(i++,a+=e.length,m){var t=e.indexOf(";");if(0<=t){const o=e.substring(0,t),n="("+e.substring(t).replace(/; /g,"").replace(/;/g,"")+")";e=[o,n].join("")}}r.append(e)}(!e||1e3<r.length)&&(W(r.join("\r\n")),r=[])}function re(e,t){if(e)for("string"==typeof e&&(e=e.split("\n")),o=0;o<e.length;o++)p=U.constReplace(e[o],t),!A&&n&&0<=(s=p.indexOf(";"))&&(p=p.substring(0,s).trim(),0===p.length)||(0===p.indexOf("G20")?(z=1/25.4,t.top=(G,d.bedDepth*z),t.left=(G,0*z),t.right=(G,d.bedWidth*z),t.bottom=(G,0*z)):0===p.indexOf("G21")&&(z=1),ae(p))}function de(e,t){let o=e.toString(),n=o.indexOf(".");return n<0&&0<D?t?o:o+".0":e.toFixed(D)}function pe(e,t={}){var o="laser"===e.type;let n=e.point;if(!n)return u+=e.speed/60,j.time_sec=e.speed/1e3,j.time_ms=e.speed,j.time=j.time_sec,void re(E,j);n.x=fe.round(n.x,D),n.y=fe.round(n.y,D),n.z=fe.round(n.z,D);var i=!(e.tool&&Z.t)||e.tool.getID()!==Z.t.getID(),a;if(i&&(Z.t=e.tool,j.tool=Z.t.getNumber(),j.tool_name=Z.t.getName(),!Y&&(F.camToolInit||0<M)&&re(S,{...j,spindle:v}),M++),b&&v&&(i||v!==h||t.newOp)&&(h=v,Y||(0<h?(a=Math.abs(h),re(_,{speed:a,spindle:a,rpm:a})):ae("M4"))),0!==P&&!i||(Z.x=Z.y=Z.z=0),0===P||i)return P++,F.camFirstZMax?(pe({tool:e.tool,point:{x:Z.x,y:Z.y,z:n.z,a:n.a}},{dx:0,dy:0,dz:1,time:0}),pe({tool:e.tool,point:{x:n.x,y:n.y,z:n.z,a:Z.a}},{dx:1,dy:1,dz:0,time:0})):(pe({tool:e.tool,point:{x:n.x,y:n.y,z:Z.z,a:Z.a}},{dx:1,dy:1,dz:0,time:0}),pe({tool:e.tool,point:{x:n.x,y:n.y,z:n.z,a:n.a}},{dx:0,dy:0,dz:1,time:0})),void P--;let r=e.speed,d=r?"G1":"G0",p=k&&X===d?[]:[d],s=t.dx||n.x-Z.x,l=t.dy||n.y-Z.y,x=t.dz||n.z-Z.z,m=n.a!=Z.a,c=x?I:T,y=Math.min(r||c,c),f=Math.sqrt(s*s+l*l+x*x),g=y&&y!==Z.f;(s||l||x||m)&&(X=d,!s&&n.x===Z.x||(Z.x=n.x,$.min.x=Math.min($.min.x,Z.x),$.max.x=Math.max($.max.x,Z.x),p.append(O).append(C.X).append(de(j.pos_x=Z.x*z))),!l&&n.y===Z.y||(Z.y=n.y,$.min.y=Math.min($.min.y,Z.y),$.max.y=Math.max($.max.y,Z.y),p.append(O).append(C.Y).append(de(j.pos_y=Z.y*z))),!x&&n.z===Z.z||(Z.z=n.z,$.min.z=Math.min($.min.z,Z.z),$.max.z=Math.max($.max.z,Z.z),p.append(O).append(C.Z).append(de(j.pos_z=Z.z*z))),m&&(Z.a=n.a,p.append(O).append(C.A).append(de(j.pos_a=Z.a*-z))),g&&(Z.f=y,p.append(O).append(C.F).append(de(j.feed=y*z,!0))),A&&(p=r?(g&&ae(`VS${y};`),[C.Z,de(Z.x*z),",",de(Z.y*z),",",de(Z.z*z),";"]):["PU",de(Z.x*z),",",de(Z.y*z),";"]),!w&&o&&re(Y.on,j),o&&p.append(O).append("S"+de(e.emit)),o&&(Z.emit=e.emit),w&&!o&&re(Y.off,j),w=o,u+=0<=t.time?t.time:f/(Z.f||1e3)*60,j.time=Math.round(u),ae(p.join("")),P++)}l&&!n&&ae("; ending "+l.type+" op after "+Math.round(u)+" seconds"),ie("footer"),re(se.gcodePost,j),ae(),U.time=u,U.lines=i,U.bytes=a+i-1,U.bounds=$}}});"use strict";gapp.register("kiri.slice",[],(t,s)=>{const{base:l,kiri:i}=t;var{key:e,polygons:n}=l,{util:r}=l;const o=l.polygons;var p=e.NONE;let h;function a(t){return h=t}class f{constructor(t,s){this.z=t,this.index=0,this.lines=null,this.groups=null,this.up=null,this.down=null,this.tops=[],this.view=s,this.finger=null,this.layers=null}output(){if(this.layers)return this.layers;let t=this.layers=new i.Layers;return h&&t.setRotation(-h.rotation||0),t}clone(s){const t=this,l=y(t.z,t.view);return t.tops?.forEach(function(t){l.addTop(t.poly.clone(s))}),l}topPolys(){return this.tops.map(t=>t.poly)}topSimples(){return this.tops.map(t=>t.simple)}topPolysFlat(){return this.topFlatPolys||(this.topFlatPolys=o.flatten(this.topPolys().clone(!0),[],!0))}topRouteFlat(){if(this.topFlatRoutes)return this.topFlatRoutes;let t=this.tops.map(t=>t.shells[0]).filter(t=>t);return this.topFlatRoutes=o.flatten(t.clone(!0),[],!0)}topPolyInners(){return this.tops.map(t=>t.poly.inner).flat().filter(t=>t)}topInners(){return this.tops.map(t=>t.last).flat().filter(t=>t)}topFillOff(){return this.tops.map(t=>t.fill_off).flat().filter(t=>t)}topFill(){return this.tops.map(t=>t.fill_lines).flat().filter(t=>t)}topShells(){return this.tops.map(t=>t.shells).flat().filter(t=>t)}fingerprint(){return this.finger||(this.finger=o.fingerprint(this.topPolys()))}fingerprintSame(t){return!!t&&o.fingerprintCompare(this.fingerprint(),t.fingerprint())}addTops(t){return t.forEach(t=>{this.addTop(t)}),this}addTop(s){if(s.length){let t=new u(s);return this.tops.push(t),t.simple=s,t}{let t=new u(s.poly);return t.thin_fill=s.thin_fill?s.thin_fill.map(t=>l.newPoint(t.x,t.y,t.z)):void 0,t.fill_lines=s.fill_lines,t.fill_sparse=s.fill_sparse,t.fill_off=s.fill_off,t.last=s.last,t.gaps=s.gaps,t.shells=s.shells,t.simple=s.simple,this.tops.push(t),t}}findClosestPointTo(s){let l,i;return this.tops&&this.tops.length?this.tops.forEach(function(t){i=t.poly.findClosestPointTo(s),(!l||i.distance<l.distance)&&(l=i)}):this.supports&&this.supports.forEach(function(t){i=t.findClosestPointTo(s),(!l||i.distance<l.distance)&&(l=i)}),l}setFields(t={}){return Object.assign(this,t),this}}class u{constructor(t){this.poly=t}clone(t){var s;return new u(this.poly.clone(t))}innerShells(){let t=this.shells,s=[];return t&&t.forEach(function(t){t.inner&&s.appendAll(t.inner)}),s}shellsAtDepth(s){return this.shells?this.shells.filter(t=>t.depth===s):[]}}function c(t){return new u(t)}function y(t,s){return new f(t,s)}gapp.overlay(i,{Top:u,Slice:f,newTop:c,newSlice:y,setSliceTracker:a})});"use strict";gapp.register("kiri-mode.cam.ops",(root,exports)=>{const{base,kiri}=root,{paths,polygons,newPoint,newPolygon,sliceConnect}=base,{poly2polyEmit,tip2tipEmit,segmentNormal,vertexNormal}=paths,{driver,newSlice}=kiri,{CAM}=driver,POLY=polygons;class CamOp{constructor(e,t){this.state=e,this.op=t}type(){return this.op.type}weight(){return 1}async slice(){}prepare(){}}class OpIndex extends CamOp{constructor(e,t){super(e,t)}slice(){let{op:e,state:t}=this;if(!t.isIndexed)throw"index op requires indexed stock";this.degrees=t.setAxisIndex(e.degrees,e.absolute)}prepare(e,t){const{lastPoint:o,zmax:s,zclear:n,camOut:a,stock:i}=e;let r=o();var l,c;r&&(l=Math.max(i.y,i.z)*Math.sqrt(2)/2+n,c=Math.max(l,s),a(r=r.clone().setZ(c),0),a(r=r.clone().setY(0).setA(this.degrees),0))}}class OpGCode extends CamOp{constructor(e,t){super(e,t)}prepare(e,t){e.addGCode(this.op.gcode)}}class OpLaserOn extends CamOp{constructor(e,t){super(e,t)}prepare(e,t){const{printPoint:o,setPrintPoint:s,setTool:n,zmax:a,camOut:i}=e;this.op.silent=!0,n(0),e.addGCode(this.op.enable),e.setLasering(!0,this.op.power)}}class OpLaserOff extends CamOp{constructor(e,t){super(e,t)}prepare(e,t){const{printPoint:o,zmax:s,camOut:n}=e;this.op.silent=!0,e.addGCode(this.op.disable),e.setLasering(!1),n(o.clone().setZ(s),0)}}class OpLevel extends CamOp{constructor(e,t){super(e,t)}async slice(e){var{op:t,state:o}=this;let{settings:s,widget:n,addSlices:a}=o,{updateToolDiams:i,tabs:r,cutTabs:l}=o;var{bounds:c,zMax:p,ztOff:f,color:d,tshadow:u}=o,{stock:h}=s,m=new CAM.Tool(s,t.tool).fluteDiameter(),w=this.stepOver=m*t.step,O=p+f-t.down;i(m);var P=[],v=t.stock?[newPolygon().centerRectangle({x:0,y:0,z:0},h.x,h.y)]:POLY.outer(POLY.offset(u,m*(t.over||0)));POLY.fillArea(v,90,w,P);let g=this.lines=[];for(let t=0;t<P.length;t+=2){let e=newSlice(O);g.push(newPolygon().setOpen().addPoints([P[t],P[t+1]]).setZ(O)),e.output().setLayer("level",{face:d,line:d}).addPolys(this.lines),a(e)}}prepare(e,t){let{op:o,state:s,lines:n,stepOver:a}=this,{setTool:i,setSpindle:r,printPoint:l,setPrintPoint:c}=e,{polyEmit:p,newLayer:f,tip2tipEmit:d,camOut:u}=e;i(o.tool,o.rate),r(o.spindle),n=n.map(e=>({first:e.first(),last:e.last(),poly:e})),l=d(n,l,(e,t,o)=>{let s=e.poly;s.last()===t&&s.reverse(),s.forEachPoint((e,t)=>{u(e.clone(),!0,a)},!1)}),c(l),f()}}class OpRough extends CamOp{constructor(e,t){super(e,t)}async slice(r){let{op:l,state:t}=this,{settings:e,slicer:s,addSlices:n,unsafe:o,color:a}=t,{updateToolDiams:i,thruHoles:c,tabs:p,cutTabs:f,cutPolys:d}=t,{ztOff:u,zMax:h,shadowAt:m,isIndexed:w}=t,{workarea:O}=t,{process:P,stock:v}=e;if(l.down<=0)throw`invalid step down "${l.down}"`;let g=l.inside;var L=l.down;let y=l.leave||0,x=l.leavez||0,z=l.all&&w,Y=new CAM.Tool(e,l.tool).fluteDiameter(),T=!0===P.camTrueShadow;if(i(Y),O.top_z>O.top_part){var b=t.shadow.base.clone(),k=Y*l.step,E=z?POLY.offset([newPolygon().centerRectangle(v.center,v.x,v.y)],k):POLY.offset(b,g?k:k+y+Y/2);let o=POLY.offset(E,-k,{count:999,flat:!0});w&&(u=v.z/2-h);var C=u/L,A=0<C%1?u/(Math.floor(C)+1):L,D;0===u&&(u=A);let e=Math.round(u/A),s=this.camFaces=[];for(let t=h+u-A;0<e;e--){let e=newSlice();e.z=t,e.camLines=POLY.setZ(o.clone(!0),e.z+x),e.output().setLayer("face",{face:a,line:a}).addPolys(e.camLines),n(e),s.push(e),t-=A}}let M=[],S=[],Z=[],_=s.interval(L,{down:!0,min:0,fit:!0,off:.01});if(_.shift(),l.flats){let t=Math.PI*(Y/2)*(Y/2)/2,o=Object.entries(s.zFlat).filter(e=>e[1]>t).map(e=>e[0]).map(e=>parseFloat(e).round(5)).filter(e=>e>=O.bottom_z);o.forEach(e=>{_.contains(e)||_.push(e)}),_=_.sort((e,t)=>t-e);for(let e=1;e<_.length-1;e++){var F=_[e-1],I=_[e],R=_[e+1];!o.contains(I)&&o.contains(R)&&(_[e]=R+(F-R)/2)}}else M=Object.keys(s.zFlat).map(e=>(parseFloat(e)-.01).round(5)).filter(e=>0<e&&_.indexOf(e)<0),_=_.appendAll(M).sort((e,t)=>t-e);_=_.filter(e=>e>=O.bottom_z);let j=0,G=0;if(await s.slice(_,{each:e=>{S=o?e.tops:POLY.union(S.slice().appendAll(e.tops),.01,!0),0<=M.indexOf(e.z)||e.z>O.top_z||(e.shadow=T?m(e.z):S.clone(!0),e.slice.shadow=e.shadow,Z.push(e.slice),r(++j/G*.25+.25))},progress:(e,t)=>{G=t,r(e/t*.25)}}),S=T?t.shadow.base.clone(!0):POLY.union(S.appendAll(t.shadow.base),.01,!0),S=POLY.flatten(S.clone(!0),[],!0),c.forEach(o=>{S=S.map(e=>{if(e.isEquivalent(o)){var t=POLY.offset([e],-(Y/2+y+.01));return t?t[0]:void 0}return e}).filter(e=>e)}),S=POLY.nest(S),l.voids)for(var H of S)H.inner=void 0;var W=(g,Y/2);const q=z?POLY.offset([newPolygon().centerRectangle(v.center,v.x,v.y)],W):POLY.offset(S,W+y);Z.forEach((e,t)=>{let o=[q.clone(!0),e.shadow.clone(!0)].flat();var s=POLY.flatten(o,[],!0),n=POLY.setZ(POLY.nest(s),e.z),a;if(o=POLY.offset(n,[-(Y/2+y),-Y*l.step],{minArea:Math.min(.01,Y*l.step/4),z:e.z,count:999,flat:!0,call:(e,t,o)=>{e.forEach(e=>{e.depth=o,e.inner&&e.inner.forEach(e=>e.depth=o)})}})||[],!g&&!z){const i=POLY.offset(S.clone(),Y/2+y,{z:e.z});i&&(i.forEach(e=>e.depth=-e.depth),o.appendAll(i))}p&&(p.forEach(e=>{e.off=POLY.expand([e.poly],Y/2).flat()}),o=f(p,o,e.z)),o&&(P.camStockClipTo&&v.x&&v.y&&v.center&&(a=newPolygon().centerRectangle(v.center,v.x,v.y),o=d([a],o,e.z,!0)),o.forEach(e=>{if(e.inner){let s=e.perimeter(),n=[];e.inner.forEach(e=>{var t=e.perimeter(),o;(s>t?t/s:s/t)<.98&&n.push(e)}),e.inner=n}}),e.camLines=o,x&&e.camLines.forEach(e=>{e.setZ(e.getZ()+x)}),r(.5+t/Z.length*.5))});let N=Z[Z.length-1];if(O.bottom_z<0)for(var X of base.util.lerp(0,-O.bottom_cut,l.down))if(N){let t=N.clone(!0);t.z-=X,t.camLines=N.camLines.clone(!0),t.camLines.forEach(e=>e.setZ(t.z+x)),Z.push(t)}Z.forEach(e=>{e.output().setLayer("roughing",{face:a,line:a}).addPolys(e.camLines)}),this.sliceOut=Z.filter(e=>e.camLines),n(this.sliceOut)}prepare(e,o){var{op:t,state:s,sliceOut:n,camFaces:a}=this;let{setTool:i,setSpindle:r,setPrintPoint:l,sliceOutput:c}=e,{camOut:p,newLayer:f,printPoint:d}=e;var{settings:u}=s,{process:h}=u,m=h.camEaseDown,w=t.ov_conv,O=h.camDepthFirst&&!s.isIndexed,P=[],v;i(t.tool,t.rate,t.plunge),r(t.spindle);for(v of a||[]){const L=[];for(var g of v.camLines)L.push(g),g.inner&&g.inner.forEach(function(e){L.push(e)});POLY.setWinding(L,w,!1),d=poly2polyEmit(L,d,function(e,t,o){const n=1===o?.5:1;e.forEachPoint(function(e,t,o,s){p(e.clone(),0!==s,void 0,n)},!0,t)}),f()}l(d),c(n,{cutdir:w,depthFirst:O,easeDown:t.down&&m?.001:0,progress:(e,t)=>o(e/t,"routing")})}}class OpOutline extends CamOp{constructor(e,t){super(e,t)}async slice(o){let{op:i,state:e}=this,{settings:t,widget:s,slicer:n,addSlices:a,tshadow:r,thruHoles:l,unsafe:c,color:p}=e,{updateToolDiams:f,tabs:d,cutTabs:u,cutPolys:h,workarea:m}=e,{zMax:w}=e,{process:O,stock:P}=t;if(i.down<=0)throw`invalid step down "${i.down}"`;let v=this.toolDiam=new CAM.Tool(t,i.tool).fluteDiameter();f(v);let g=[],L=[];var y={off:.01,fit:!0,down:!0,min:Math.max(0,m.bottom_z),max:m.top_z},x;let z=n.interval(i.down,y),Y=!0===O.camTrueShadow;z.shift();const T=Object.keys(n.zFlat).map(e=>(parseFloat(e)-.01).round(5)).filter(e=>0<e&&z.indexOf(e)<0);z=z.appendAll(T).sort((e,t)=>t-e);let b=0,k=0;if(i.outside&&!i.inside?z.forEach((t,e)=>{if(!(0<=T.indexOf(t))){let e=newSlice(t);e.shadow=g.clone(!0),L.push(e)}}):await n.slice(z,{each:e=>{g=c?e.tops:POLY.union(g.slice().appendAll(e.tops),.01,!0),0<=T.indexOf(e.z)||(e.shadow=Y?CAM.shadowAt(s,e.z):g.clone(!0),e.slice.shadow=e.shadow,L.push(e.slice),o(++b/k*.5+.5))},progress:(e,t)=>{k=t,o(e/t*.5)}}),g=POLY.union(g.appendAll(e.shadow.base),.01,!0),i.top){let e=L[0],t=L.map(e=>e.z);for(var E of z.filter(e=>e>=w))if(!t.contains(E)){let t=e.clone(!0);t.tops.forEach(e=>e.poly.setZ(t.z)),t.shadow=e.shadow.clone(!0),t.z=E,L.splice(0,0,t)}}if(m.bottom_z<0){let e=L[L.length-1];for(var C of base.util.lerp(0,-m.bottom_cut,i.down))if(e){let t=e.clone(!0);t.tops.forEach(e=>e.poly.setZ(t.z)),t.shadow=e.shadow.clone(!0),t.z-=C,L.push(t)}}L.forEach(o=>{let e=o.shadow;if(i.outside&&(e=r),i.omitthru)for(let t of l)for(var s of e)s.inner&&(s.inner=s.inner.filter(e=>!e.isEquivalent(t,!1,.1)));if(i.omitvoid)for(var t of e)delete t.inner;let n=POLY.expand(e,v/2,o.z);if(n&&n.length){if(i.inside){let o=POLY.expand(e.clone(),v/2);n=POLY.filter(n,[],function(t){if(t.area()<1)return null;for(let e=0;e<o.length;e++)if(t.isEquivalent(o[e]))return t.inner||null;return t})}else if(i.wide){let t=v*i.step;for(let e=i.steps||1;0<e;e--)n.slice().forEach(e=>{POLY.expand([e.clone(!0)],t,o.z,n,1)})}var a;i.dogbones&&!i.wide&&CAM.addDogbones(n,v/5),d&&(d.forEach(e=>{e.off=POLY.expand([e.poly],v/2).flat()}),n=u(d,n,o.z)),O.camStockClipTo&&P.x&&P.y&&P.center&&(a=newPolygon().centerRectangle(P.center,P.x,P.y),n=h([a],n,o.z,!0)),o.camLines=n}}),L=L.filter(e=>e.camLines);for(x of L)x.output().setLayer("outline",{face:p,line:p}).addPolys(x.camLines);a(L),this.sliceOut=L}prepare(e,t){var{op:o,state:s,sliceOut:n}=this;let{setTool:a,setSpindle:i,setPrintPoint:r}=e,{polyEmit:l,depthOutlinePath:c}=e,{camOut:p,newLayer:f,printPoint:d}=e;var{settings:u,widget:h}=s,{process:m,controller:w}=u,O=m.camEaseDown,P=this.toolDiam,v,g;let L=o.ov_conv,y=m.camDepthFirst,x=[];a(o.tool,o.rate,o.plunge),i(o.spindle),m.camOutlinePocket||(L=!L);for(v of n){let o=[],s=[],n=[];POLY.flatten(v.camLines).forEach(function(e){var t=e.parent;y&&((e=e.clone()).parent=t?1:0),(t?n:s).push(e),e.layer=x.layer,o.push(e)}),POLY.setWinding(s,L),POLY.setWinding(n,!L),y?x.push(o):(d=poly2polyEmit(o,d,function(e,t,o){e.forEachPoint(function(e,t,o,s){p(e.clone(),0!==s)},e.isClosed(),t)},{swapdir:!1}),f())}if(y){let e=x.map(e=>POLY.flatten(e.clone(!0),[],!0).filter(e=>!(e.depth=0))).filter(e=>0<e.length);e.length&&e[0].length&&(d=e[0].sort((e,t)=>e.area()-t.area())[0].average(),g=o.down&&O?.001:0,d=c(d,0,e,P,l,!1,g),d=c(d,0,e,P,l,!0,g))}r(d)}}function createFilter(op){let filter=e=>e;if(op.filter)try{const obj=eval(`( ${op.filter.join("\n")} )`);let idx=0;if(obj&&obj.slices){const nadd=[];filter=function(e){for(var t of e)obj.slices(t,idx++)&&nadd.push(t);return nadd}}}catch(e){console.log("filter parse error",e,op.filter)}return filter}class OpContour extends CamOp{constructor(e,t){super(e,t)}async slice(s){var{op:e,state:t}=this;let{addSlices:o}=t,n=createFilter(e);var a=await CAM.Topo({onupdate:(e,t,o)=>{s(e/t,o)},ondone:e=>{e=n(e),this.sliceOut=e,o(e)},contour:e,state:t});this.tolerance=a.tolerance}prepare(e,t){var{op:o,state:s,sliceOut:n}=this,{settings:a,widget:i}=s,{process:r}=a;let{setTolerance:l,setTool:c,setSpindle:p,setPrintPoint:f}=e,{camOut:d,polyEmit:u,newLayer:h,printPoint:m,lastPoint:w}=e;var{bounds:O,zmax:P}=e,v,g;let L=(this.toolDiam=new CAM.Tool(a,o.tool).fluteDiameter())*o.step*2,y=r.camDepthFirst,x=[];c(o.tool,o.rate,r.camFastFeedZ),p(o.spindle),l(this.tolerance),m=newPoint(O.min.x,O.min.y,P);for(g of n)if(g.camLines){let t=[],s,e;g.camLines.forEach(function(e){y&&(e=e.clone(!0)),t.push({first:e.first(),last:e.last(),poly:e})}),y?x.appendAll(t):(m=tip2tipEmit(t,m,function(e,t,o){s=e.poly,s.last()===t&&s.reverse(),s.forEachPoint(function(e,t){d(e.clone(),0<t,L)},!1)}),h())}y&&(m=tip2tipEmit(x,m,function(e,t,o){let s=e.poly;return s.last()===t&&s.reverse(),s.forEachPoint(function(e,t){d(e.clone(),0<t,L)},!1),h(),w()})),f(m)}}class OpLathe extends CamOp{constructor(e,t){super(e,t)}async slice(o){var{op:e,state:t}=this;let{addSlices:s}=t,n=createFilter(e);this.topo=await CAM.Topo4({op:e,state:t,onupdate:(e,t)=>{o(e,t)},ondone:e=>{e=n(e),this.slices=e,s(e,!1)}})}prepare(e,t){var{op:o,state:s,slices:n,topo:a}=this,{settings:i}=s,r,l;let{setTool:c,setSpindle:p,setPrintPoint:f}=e,{camOut:d,newLayer:u,printPoint:h}=e,{zmax:m}=e,w=new CAM.Tool(i,o.tool).fluteDiameter()*o.step*2,O=a.resolution;c(o.tool,o.rate,o.plunge),p(o.spindle),h=newPoint(0,0,m);for(l of n)if(l.camLines){let n;for(var P of l.camLines){let s;P.forEachPoint((e,t)=>{if(n){var o;if(Math.abs(n.z-e.z)<O)return void(s=e.clone());s&&(d(s,!0,w),s=void 0)}d(n=e.clone(),0<t,w)},!1),s&&d(s,!0,w)}u()}var v=e.lastPoint(),g=(360*Math.round(v.a/360)).round(2);u(),e.addGCode(["G0 Z"+m.round(2),"G0 A"+g,"G92 A0"]),f(v)}}class OpTrace extends CamOp{constructor(e,t){super(e,t)}async slice(e){let{op:s,state:t}=this,{tool:r,rate:l,down:o,plunge:c,offset:a,offover:i,thru:p}=s;var{ov_conv:n}=s;let{settings:f,widget:d,addSlices:u,zThru:h,tabs:m,workarea:w}=t,{updateToolDiams:O,cutTabs:P,cutPolys:v,healPolys:g,color:L}=t;var{process:y,stock:x}=f;let{camStockClipTo:z}=y;if(t.isIndexed)throw"trace op not supported with indexed stock";let Y=w.top_z,T=w.bottom_z,b=this.sliceOut=[];var k=s.areas[d.id]||[];let E=new CAM.Tool(f,r),C=E.fluteDiameter(),A=C*s.step;var D=E.traceOffset(),M,S,Z;let _=n,F=[],I=x.center&&x.x&&x.y?newPolygon().centerRectangle(x.center,x.x,x.y):void 0;O(C),m&&m.forEach(e=>{e.off=POLY.expand([e.poly],C/2).flat()});for(M of k){var R=newPolygon().fromArray(M);POLY.setWinding([R],_,!1),F.push(R)}function j(e){var t=newSlice(e);return u(t),b.push(t),t}function G(e){return T?Math.max(T,e-p):e-p}function H(e){s.dogbone&&CAM.addDogbones(e,C/5,!s.revbone);var t=e.getZ();let o=j(t);o.camTrace={tool:r,rate:l,plunge:c},m?o.camLines=P(m,[e],t):o.camLines=[e],z&&I&&(o.camLines=v([I],o.camLines,t,!0)),o.output().setLayer("trace follow",{line:L},!1).addPolys(o.camLines)}function W(e,t,o){var s=o?base.util.lerp(Y,t,o):[t],n,a;for(a of POLY.nest(e))for(var i of s){let e=j(i);e.camTrace={tool:r,rate:l,plunge:c},POLY.offset([a],[-C/2,-A],{count:999,outs:e.camLines=[],flat:!0,z:i,minArea:0}),m?e.camLines=P(m,POLY.flatten(e.camLines,null,!0),i):e.camLines=POLY.flatten(e.camLines,null,!0),POLY.setWinding(e.camLines,_,!1),e.output().setLayer("trace clear",{line:L},!1).addPolys(e.camLines)}}function q(e,t,o=.01){return Math.abs(e-t)<=o}function N(e,t){var o,s;t.length>e.length&&(o=e,e=t,t=o);let n=newPolygon().setOpen(!0);for(s of e.points){var a=t.findClosestPointTo(s);n.push(s.midPointTo3D(a.point))}return n}function X(e){let n=e.filter(e=>e.isOpen()).sort((e,t)=>t.perimeter()-e.perimeter());if(n.length<2)return e;let t=newPoint(0,0,0);n.forEach(e=>{e.last().distTo2D(t)<e.first().distTo2D(t)&&e.reverse()});let a=e.filter(e=>e.isClosed());e:for(let s=0,e=n.length;s<e-1;s++){let o=n[s];if(o)for(let t=s+1;t<e;t++){let e=n[t];if(e&&(q(o.perimeter(),e.perimeter(),.1)&&q(o.first().distTo2D(e.first()),C)&&q(o.last().distTo2D(e.last()),C))){a.push(N(o,e)),n[s]=void 0,n[t]=void 0;continue e}}}return a.appendAll(n.filter(e=>e)),a}switch(0,F=g(F),F=X(F),s.mode){case"follow":let n=[];poly2polyEmit(F,newPoint(0,0,0),(e,t,o,s)=>{n.push(e)});let t=[];for(var V of POLY.nest(n)){let e="none"!==a?i:0;if(e)"inside"===a&&(e=-e);else switch(a){case"outside":e=D;break;case"inside":e=-D}if(e){var $=POLY.offset([V],e,{minArea:0,open:!0});if(!$)continue;V=POLY.setZ($,V.getZ())}else V=[V];for(var B of POLY.flatten(V,[],!0))if(o){let e=G(B.getZ());h&&q(e,0)&&(e-=h);for(var U of base.util.lerp(Y,e,o))t.push(B.clone().setZ(U))}else p&&B.setZ(B.getZ()-p),t.push(B);!o&&s.merge&&(S=POLY.nest(t),Z=POLY.union(S,0,!0),t=POLY.flatten(Z,[],!0))}for(var J of t)H(J);break;case"clear":var K=d.track.top-d.track.box.d,Q,ee,te;let e={};for(Q of F){var oe=G(Q.getZ());if(i){var se=POLY.offset([Q],-i,{minArea:0,open:!0});if(!se)continue;Q=POLY.setZ(se,Q.getZ())}else Q=[Q];(e[oe]=e[oe]||[]).appendAll(Q)}for([ee,te]of Object.entries(e))W(te,parseFloat(ee),o)}}prepare(e,t){var{op:o,state:s}=this,{settings:n}=s,a;let{setTool:i,setSpindle:r}=e;i(o.tool,o.rate),r(o.spindle);for(a of this.sliceOut)e.emitTrace(a)}}class OpPocket extends CamOp{constructor(e,t){super(e,t)}async slice(f){const d=this,u=!1;let{op:h,state:e}=this,{tool:m,rate:w,down:t,plunge:O,expand:P,contour:v,smooth:g,tolerance:o}=h;var{ov_botz:s,ov_conv:n}=h;let{settings:a,widget:i,addSlices:L,zBottom:r,zThru:l,tabs:y,color:x}=e,{updateToolDiams:c,cutTabs:z,healPolys:p,shadowAt:Y,workarea:T}=e;var{process:b}=a;r=s?T.bottom_stock+s:r;let k,E=this.pockets=[],C=new CAM.Tool(a,m),A=C.fluteDiameter(),D=A*h.step,M=n,S=v&&h.engrave,Z=T.top_z;function _(){E.push(k=[])}function F(e){var t=newSlice(e);return k.push(t),t}function I(e,t,o){var s,n=(o=o?(s=Z-t)/Math.ceil(s/o):o)?base.util.lerp(Z,t,o):[t],a;S&&(A=D),v?P=S?0:P:P&&(e=POLY.offset(e,P));let i=0,r=1/(e.length*n.length);for(a of e){_();for(var l of n){let t=[],o;if(v?t=g?POLY.offset(POLY.offset([a],g),-g):[a]:(o=Y(l),g&&(o=POLY.setZ(POLY.offset(POLY.offset(o,g),-g),l)),POLY.subtract([a],o,t,void 0,void 0,0),h.outline&&POLY.clearInner(t)),0!==t.length){let e=F(l);var c=S?1:999,p;e.camTrace={tool:m,rate:w,plunge:O},A?(p=v?[P||-.02,-D]:[-A/2,-D],POLY.offset(t,p,{count:c,outs:e.camLines=[],flat:!0,z:l,minArea:0})):e.camLines=t,y?e.camLines=z(y,POLY.flatten(e.camLines,null,!0),l):e.camLines=POLY.flatten(e.camLines,null,!0),POLY.setWinding(e.camLines,M,!1),v&&(e.camLines=d.conform(e.camLines,h.refine,S,e=>{f(.9+.1*(i+r*e),"conform")})),e.output().setLayer("pocket",{line:x},!1).addPolys(e.camLines),u&&o&&e.output().setLayer("pocket shadow",{line:16746513},!1).addPolys(o),v||f(i,"pocket"),i+=r,L(e)}}}}v&&(t=0,this.topo=await CAM.Topo({onupdate:(e,t,o)=>{f(e/t*.9,o)},ondone:e=>{},contour:{tool:m,tolerance:o,inside:!0,axis:"-"},state:e})),c(A),y&&y.forEach(e=>{e.off=POLY.expand([e.poly],A/2).flat()});var R=h.surfaces[i.id]||[],j=i.getGeoVertices({unroll:!0,translate:!0}).map(e=>e.round(4));let G=[];var H=CAM.surface_find(i,R,.1);let W=1/0;var q=0,N=H.length,X;for(X of H){var V=9*X;G.push(newPolygon().add(j[V++],j[V++],W=Math.min(W,j[V++])).add(j[V++],j[V++],W=Math.min(W,j[V++])).add(j[V++],j[V++],W=Math.min(W,j[V++])))}W=Math.max(r,W),G=POLY.union(G,1e-4,!0),G=POLY.setWinding(G,M,!1),G=p(G),g&&(G=POLY.offset(POLY.offset(G,g),-g)),G.length&&(h.outline&&POLY.clearInner(G),u&&F(W).output().setLayer("pocket area",{line:1149183},!1).addPolys(G),I(G,W+1e-4,t),f(1,"pocket"))}conform(e,t,o,s){const n=this.topo;var a=e.map(e=>e.segment(2*n.tolerance)),i;let r=a.length,l=0;for(i of a){for(var c of i.points)c.z=o?n.zAtXY(c.x,c.y):n.toolAtXY(c.x,c.y);s(l++/r*.8)}r*=t;for(let e=l=0;e<t;e++)for(var p of a){var f=p.points,d=f.length;let o=[];for(let e=0;e<d;e++){var u=f[e],h=f[(e+1)%d];o.push(segmentNormal(u,h))}let e=[];for(let t=0;t<d;t++){var m=o[(t+d-1)%d],w=o[t],O=vertexNormal(m,w,1),P;if(e.push(O),0===Math.abs(1-O.vl).round(2)){var v=f[(t+d-1)%d];let e=f[t];var g=f[(t+1)%d];e.z=(v.z+g.z+e.z)/3}}s(l++/r*.2+.8)}return a}prepare(e,o){let{op:s,state:n,pockets:a}=this,{setTool:t,setSpindle:i,setTolerance:r,sliceOutput:l,getPrintPoint:c}=e;var{process:p}=n.settings;for(t(s.tool,s.rate),i(s.spindle),this.topo&&r(this.topo.tolerance),a=a.filter(e=>e.length);;){var f=c(),d,u;let t={dist:1/0,pocket:void 0};for(d of a.filter(e=>!e.used)){let e=d[0].camLines.slice().sort((e,t)=>t.area()-e.area())[0];e&&((u=e.findClosestPointTo(f)).distance<t.dist&&(t.pocket=d,t.dist=u.distance))}if(!t.pocket)break;t.pocket.used=!0,l(t.pocket,{cutdir:s.ov_conv,depthFirst:p.camDepthFirst&&!n.isIndexed,easeDown:s.down&&p.easeDown?s.down:0,progress:(e,t)=>o(e/t,"pocket")})}}}class OpDrill extends CamOp{constructor(e,t){super(e,t)}async slice(e){let{op:s,state:t}=this,{settings:o,addSlices:n,tslices:a,updateToolDiams:i}=t,{zBottom:r,zThru:l,thruHoles:c,color:p}=t,f=[],d=new CAM.Tool(o,s.tool),u=d.fluteDiameter(),h=.1*u,m=u/2*(u/2)*Math.PI,w=s.mark?1/0:.05*m,O=this.sliceOut=[];i(u);for(var P of a){var v,g,L,y;if(!(P.z<r))for(g of P.topPolyInners([]))if(.985<=g.circularity()&&Math.abs(g.area()-m)<=w){let e=g.calcCircleCenter(),t=!1,o=1/0,s;if(!e.isInPolygon(P.shadow)){for(var x of f)t||((s=x.last().distTo2D(e))<=h&&(t=!0,x.push(e)),o=Math.min(o,s));t||f.push(newPolygon().append(e))}}else if(s.arcs){for(y of g.findArcCenters())f.push(newPolygon().add(y.x,y.y,y.z||0))}}f.forEach(function(t){let o=t.center(!0),e=newSlice(0,null);if(s.mark){let e=t.points;e=[e[0],e[0].clone().sub({x:0,y:0,z:s.down})],t.points=e}t.points.forEach(function(e){e.x=o.x,e.y=o.y}),l&&o.isInPolygon(c)&&t.points.push(t.points.last().sub({x:0,y:0,z:l})),e.camLines=[t],e.output().setLayer("drill",{face:p,line:p}).addPolys(t),n(e),O.push(e)})}prepare(e,t){var{op:o,state:s}=this,{settings:n,widget:a,addSlices:i,updateToolDiams:r}=s;let{setTool:l,setSpindle:c,setDrill:p,emitDrills:f}=e;l(o.tool,void 0,o.rate),p(o.down,o.lift,o.dwell),c(o.spindle),f(this.sliceOut.map(e=>e.camLines).flat())}}class OpRegister extends CamOp{constructor(e,t){super(e,t)}async slice(e){var{op:p,state:t}=this;let{settings:o,widget:s,bounds:n,addSlices:f,zMax:a,zThru:i,color:d}=t,{updateToolDiams:r}=t,u=new CAM.Tool(o,p.tool),h=this.sliceOut=[];r(u.fluteDiameter());let{stock:l}=o,c=s.track.pos.z,m=n.min.x,w=n.max.x,O=n.min.y,P=n.max.y,v=2*u.fluteDiameter(),g=(m+w)/2,L=(O+P)/2,y=p.thru||i||0,x=(l.x-(w-m))/4,z=(l.y-(P-O))/4,Y=l.z,T=[],b=l.z-n.max.z,k=n.max.z+b+c,E=c-y;if(l.x&&l.y&&l.z){switch(p.axis){case"X":case"x":3==p.points?(T.push(newPoint(m-x,L,0)),T.push(newPoint(w+x,L-v,0)),T.push(newPoint(w+x,L+v,0))):(T.push(newPoint(m-x,L,0)),T.push(newPoint(w+x,L,0)));break;case"Y":case"y":3==p.points?(T.push(newPoint(g,O-z,0)),T.push(newPoint(g-v,P+z,0)),T.push(newPoint(g+v,P+z,0))):(T.push(newPoint(g,O-z,0)),T.push(newPoint(g,P+z,0)));break;case"-":let t=v/2,o=m-x,e=w+x,s=O-z-t,n=P+z+t,a=(e-o-t)/4,i=(n-s-3*t)/4,r,l,c;function C(e){c=e,l={x:o+.5*t,y:s+1.5*t},r=newPolygon().add(l.x,l.y,e)}function A(e,t){l.x+=e,l.y+=t,r.add(l.x,l.y,c)}function D(e,t,o){for(;0<e--;)o(t,0===e),t=-t}for(var M of base.util.lerp(k,E,p.down)){let e=newSlice(M);f(e),h.push(e),C(M),D(4,t,e=>{A(0,-e),A(a,0)}),D(4,t,e=>{A(e,0),A(0,i)}),D(4,t,e=>{A(0,e),A(-a,0)}),D(4,t,e=>{A(-e,0),A(0,-i)}),r.points.pop(),e.camTrace={tool:u.getID(),rate:p.feed,plunge:p.rate},e.camLines=[r],e.output().setLayer("register",{line:d},!1).addPolys(e.camLines)}}if(T.length){let e=newSlice(0,null),t=[];T.forEach(e=>{t.push(newPolygon().append(e.clone().setZ(k)).append(e.clone().setZ(E)))}),e.camLines=t,e.output().setLayer("register",{face:d,line:d}).addPolys(t),f(e),h.push(e)}}}prepare(e,t){var{op:o,state:s}=this,{settings:n,widget:a,addSlices:i,updateToolDiams:r}=s;let{setTool:l,setSpindle:c,setDrill:p,emitDrills:f}=e;if("-"===o.axis){l(o.tool,o.feed,o.rate),c(o.spindle);for(var d of this.sliceOut)e.emitTrace(d)}else l(o.tool,void 0,o.rate),p(o.down,o.lift,o.dwell),c(o.spindle),f(this.sliceOut.map(e=>e.camLines).flat())}}class OpXRay extends CamOp{constructor(e,t){super(e,t)}async slice(e){let{widget:t,addSlices:o}=this.state,s=new kiri.cam_slicer(t);var n=Object.keys(s.zLine).map(e=>parseFloat(e).round(5)).sort((e,t)=>e-t),a;await s.slice(n,{each:e=>{let t=newSlice(e.z);t.addTops(e.tops),t.lines=e.lines,t.xray(),o(t)},over:!1,flatoff:0,edges:!0,openok:!0})}}class OpShadow extends CamOp{constructor(e,t){super(e,t)}async slice(s){let e=this.state,{ops:t,slicer:o,widget:n,unsafe:a,addSlices:i,shadowAt:r}=e,l=t.map(e=>e.op).filter(e=>e),c=!0===e.settings.process.camTrueShadow;var p=l.map(e=>(e.down||3)/(c?1:3)).reduce((e,t)=>Math.min(e,t,1));let f=[],d=[],u=o.interval(p,{fit:!0,off:.01,down:!0,flats:!0});var h=a;h&&(console.log("skipping terrain generation"),u=[u.pop()]);let m,w=0,O=0;var P=await o.slice(u,{each:e=>{var t=c?r(e.z,m):[];d=POLY.union(d.slice().appendAll(e.tops).appendAll(t),.01,!0),f.push(e.slice),e.slice.shadow=d;{const o=void 0}m=e.z,s(++w/O*.5+.5)},progress:(e,t)=>{O=t,s(e/t*.5)}});if(0===P.length)throw"invalid widget shadow";e.center=d[0].bounds.center(),e.tshadow=d,e.terrain=P,e.tslices=f,e.skipTerrain=h,e.shadow={base:d,stack:P,slices:f,skip:h},e.thruHoles=d.map(e=>e.inner||[]).flat()}}CAM.shadowAt=function(e,t,o){var s=e.cache.geo,n=s.length;if(!e.cache.shadow){const p=[];for(let e=0,t=0;e<n;e+=3){var a=new THREE.Vector3(s[t++],s[t++],s[t++]),i=new THREE.Vector3(s[t++],s[t++],s[t++]),r=new THREE.Vector3(s[t++],s[t++],s[t++]),l;.001<THREE.computeFaceNormal(a,i,r).z&&p.push(a,i,r)}e.cache.shadow=p}const c=[],p=e.cache.shadow,{checkOverUnderOn:f,intersectPoints:d}=self.kiri.cam_slicer;for(let e=0;e<p.length;){var u=p[e++],h=p[e++],m=p[e++],w=void 0,O,P;o&&u.z>o&&h.z>o&&m.z>o||u.z<t&&h.z<t&&m.z<t||(u.z>t&&h.z>t&&m.z>t?c.push([u,h,m]):(O={under:[],over:[],on:[]},f(newPoint(u.x,u.y,u.z),t,O),f(newPoint(h.x,h.y,h.z),t,O),f(newPoint(m.x,m.y,m.z),t,O),0!==O.on.length||2!==O.over.length&&2!==O.under.length||(2===(P=d(O.over,O.under,t)).length?2===O.over.length?(c.push([O.over[1],P[0],P[1]]),c.push([O.over[0],O.over[1],P[0]])):c.push([O.over[0],P[0],P[1]]):console.log({msg:"invalid ips",line:P,where:O}))))}var v=c.map(e=>newPolygon().add(e[0].x,e[0].y,e[0].z).add(e[1].x,e[1].y,e[1].z).add(e[2].x,e[2].y,e[2].z)),v;return v=POLY.union(v,.001,!0)},CAM.OPS=CamOp.MAP={xray:OpXRay,shadow:OpShadow,level:OpLevel,rough:OpRough,outline:OpOutline,contour:OpContour,pocket:OpPocket,lathe:OpLathe,trace:OpTrace,drill:OpDrill,register:OpRegister,"laser on":OpLaserOn,"laser off":OpLaserOff,gcode:OpGCode,index:OpIndex,flip:CamOp}});"use strict";gapp.register("kiri.render",[],(e,r)=>{const{base:D,kiri:G}=e,{config:t,util:o,newPolygon:J}=D,a=.9,K=new THREE.Vector3(1,0,0),Q=Math.PI/180;function n(){return"CAM"===e.worker.print.settings.mode}function c(){return!!e.worker.print.settings.controller.dark}function U(e,r){return(n()?c()?h:g:c()?p:l)(e/r,1,a)}async function s(z,L,x={}){if(0===(z=z.filter(e=>e.length)).length)return self.worker.print.maxSpeed=0,[];const A=c(),O=x.tools||{},C=x.flat,P=x.thin&&!C,S=!1!==x.speed,_=8947848;var e=0<=x.move?x.move:A?6710886:11184810,r=0<=x.print?x.print:7829248,t;const o=!0,E=.2,M=[],a=x.toolMode,Z=x.lineWidth,j={face:e,line:C?1:e,opacity:C?.5:1},T={face:r,line:C?1:r,opacity:C?.5:1};let n=1/0,s=x.maxspeed||0,i=[];for(t of z)for(var l of t)l.speed&&(n=Math.min(n,l.speed),s=Math.max(s,l.speed)),a&&void 0!==l.tool&&i.indexOf(l.tool)<0&&i.push(l.tool);self.worker.print.minSpeed=n,self.worker.print.maxSpeed=s,self.worker.print.thinColor=P,self.worker.print.flatColor=C;let F=null,H=null,R=null,V=null,I=null,N=null,W=!1,q=0;function B(e){return a?U(i.indexOf(e.tool),i.length):U(e.speed,s)}return z.forEach((e,r)=>{const a={},s=[],i=[],l=[],c=[],p=[],g=[];var t=[];const o=new G.Layers;M.push(o);const h=(e,r)=>{e=e||0;const t=a[e]=a[e]||[];var o=O[e]||{};t.width=(Z||o.extNozzle||1)/2,t.push(r),u++};var n=e.height/2,f=1,d,b;let u=0;if(e.forEach(r=>{if(!r.gcode){W&&r.emit&&(W=!1,p.push(V));let e=r.point;var t,o,a,n;e&&void 0!==e.a&&({point:t}=r,o=new THREE.Vector3(t.x,t.y,t.z).applyAxisAngle(K,t.a*Q),e=D.newPoint(o.x,o.y,o.z)),r.tool!==F&&(F=r.tool,l.push(e)),r.retract&&(c.push(e),W=!0,q++),e&&(R?(i.push({p1:V,p2:e}),a=e,n=V,r.emit?(!R.emit||S&&r.speed!==R.speed||H)&&(I=J().setOpen(),I.push(V),I.color=B(r),h(r.tool,I)):(R.emit||H)&&(I=J().setOpen(),I.push(V),s.push(I)),I.push(e),"laser"===r.type&&(I.isLaser=!0,r.emit&&(R.emit&&r.emit===R.emit||(N=J().setOpen(),N.push(V),N.color=U(r.emit,1),g.push(N)),N.push(e))),H=null):(I=J().setOpen(),I.push(e),r.emit?(I.color=B(r),h(r.tool,I)):s.push(I)),R=r,V=e)}}),R){if(H=R,R.emit&&!u&&h(R.tool,I),g.length)for(var k of g)o.setLayer("power",{line:85,face:255,opacity:.5},!0).addPolys([k],{thin:!0,z:x.z,color:k.color});l.length&&o.setLayer("tool",{line:85,face:255,opacity:.5},!0).addAreas(l.map(e=>J().centerCircle(e,.2,4).setZ(e.z+.03)),{outline:!0}),c.length&&o.setLayer("retract",{line:5570560,face:16711680,opacity:.5},!0).addAreas(c.map(e=>J().centerCircle(e,.2,5).setZ(e.z+.01)),{outline:!0}),p.length&&o.setLayer("engage",{line:21760,face:65280,opacity:.5},!0).addAreas(p.map(e=>J().centerCircle(e,.2,7).setZ(e.z+.02)),{outline:!0}),P&&t.length&&(d=A?16777215:1122867,o.setLayer("sparks",{face:_,line:d,opacity:.75},!0).addLines(t,{thin:!0})),P&&i.length&&(b=A?16777215:1122867,o.setLayer("arrows",{face:_,line:b,opacity:.75},!0).addAreas(i.map(e=>{const{p1:r,p2:t}=e;var o=t.slopeTo(r),a=D.newSlopeFromAngle(o.angle+20),n=D.newSlopeFromAngle(o.angle-20),s=e.p2.projectOnSlope(a,E),i=e.p2.projectOnSlope(n,E);return J().addPoints([t,s,i]).setZ(t.z+.01)}),{thin:!0,outline:!0})),o.setLayer(x.other||"move",j,!0!==x.moves).addPolys(s,{thin:!0,z:x.z});var m=e.z?e.z-n:x.z,y;for(y of Object.values(a))for(var v of y){C&&v.appearsClosed()&&(v.setClosed(),v.points.pop());var w=v.isLaser?"speed":x.action||"print";o.setLayer(w,T).addPolys([v],P?{thin:P,z:x.z,color:v.color}:C?{flat:C,z:m,color:v.color,outline:!0,offset:y.width,open:v.open}:{offset:y.width,height:n,z:m,color:{face:v.color,line:v.color}})}L(r/z.length,o)}}),M}r({path:s,is_dark:c,rate_to_color:U});var i={simple:f.bind({seg:3,fn:m}),light:f.bind({seg:4,fn:b}),light2:f.bind({seg:4,fn:u}),light_cam:f.bind({seg:2,fn:b}),dark:f.bind({seg:4,fn:k}),dark_cam:f.bind({seg:2,fn:k})};let l=i.light2,p=i.dark,g=i.light_cam,h=i.dark_cam;function f(e,r,t){var o,a=1/this.seg,n=Math.floor(e/a),s,i=(e-n*a)/a,l=1-i;const c={r:0,g:0,b:0};return this.fn(c,i,n),c.r=(255*c.r*t&255)<<16,c.g=(255*c.g*t&255)<<8,c.b=255*c.b*t&255,c.r|c.g|c.b}function d(e,r,t){var o=1-r;switch(t){case 0:e.r=1,e.g=r,e.b=0;break;case 1:e.r=o,e.g=1,e.b=0;break;case 2:e.r=0,e.g=o,e.b=r;break;case 3:e.r=r,e.g=0,e.b=1;break;case 4:e.r=o,e.g=0,e.b=o}}function b(e,r,t){var o=1-r;switch(t){case 0:e.r=.8,e.g=.75*r,e.b=0;break;case 1:e.r=.8*o,e.g=.75,e.b=0;break;case 2:e.r=0,e.g=.75*o,e.b=r;break;case 3:e.r=.75*r,e.g=0,e.b=1;break;case 4:e.r=.85,e.g=0,e.b=1}}function u(e,r,t){var o=1-r;switch(t){case 0:e.r=.9,e.g=.9*r,e.b=0;break;case 1:e.r=.9*o,e.g=.8,e.b=0;break;case 2:e.r=0,e.g=.8*o,e.b=r;break;case 3:e.r=.9*r,e.g=0,e.b=1;break;case 4:e.r=.9,e.g=0,e.b=1}}function k(e,r,t){var o=1-r;switch(t){case 0:e.r=1,e.g=r,e.b=0;break;case 1:e.r=o,e.g=1,e.b=0;break;case 2:e.r=0,e.g=.85*o+.25,e.b=r;break;case 3:e.r=.85*r,e.g=.25,e.b=1;break;case 4:e.r=.85,e.g=.25,e.b=1}}function m(e,r,t){var o=1-r;switch(t){case 0:e.r=0,e.g=r,e.b=1;break;case 1:e.r=r,e.g=1,e.b=0;break;case 2:e.r=1,e.g=o,e.b=0;break;case 3:e.r=o,e.g=0,e.b=0}}});"use strict";gapp.register("kiri-mode.cam.prepare",(e,t)=>{const{base:Se,kiri:p}=e,{paths:n,polygons:r,newPoint:_e}=Se,{tip2tipEmit:je,poly2polyEmit:Ie}=n,{driver:i,render:c}=p,{CAM:Le}=i,Be=r;function f(e,a,u,t,i){if(0===e.camops.length||e.meta.disabled)return;let n=a.device,r=a.process,O=r.camStockIndexed,o=r.camOriginCenter,l=a.controller.alignTop,m=a.stock||{},P=m.z*(O?.5:1),s=a.bounds||e.getPositionBox(),p=s.max.z,c=e.slices,Z=r.camZClearance||1,E=r.camForceZMax||!1,f=P+Z,d=e.track.top,T=P-d,h=e.getBoundingBox(),z=O?m.z/2:h.max.z+T,A=O?l?p-z:0:m.z-z,D=p+Z+r.camOriginOffZ,g=e.track.pos,b=g.x,C=g.y,v=(o?0:-m.x/2)+r.camOriginOffX,y=(o?0:-m.y/2)+r.camOriginOffY,x=_e(v+b,y+C,D),k=u.output,w=r.camEaseDown,M=r.camEaseAngle,F=r.camDepthFirst,S=r.camFullEngage,_=0,j=0,I=0,L=0,B=!1,U=0,W=u.output||[],G=[],N,R,X,Y,q,H,J,K,Q,V,$,ee=r.camFastFeedZ,te,ne,re,ie,oe,ae=!0,le=!1,se=0,pe=n.spindleMax,ce=e.maxToolDiam,fe=e.terrain?e.terrain.map(e=>({z:e.z,tops:e.tops})):D;function ue(e){(G.length||G.mode)&&W.push(G),G=[],G.mode=e||oe,G.spindle=se}function me(e){e&&e.length&&(Array.isArray(e)||(e=e.trim().split("\n")),W.push([{gcode:e}]),G.length&&(G=[],G.mode=oe,G.spindle=se))}function de(e){_=e,Y&&($=oe.step*V*1.5)}function he(e){Ze.printPoint=N=e}function ze(e){se=Math.min(e,pe)}function ge(e,t,n){e!==ne&&(K=new Le.Tool(a,e),Q=K.getType(),V=K.fluteDiameter(),$="endmill"===Q?V:2*_,ne=e),te=t||te||n,ee=Math.min(te||n,n||ee||te)}function ve(e,t=0){B=e?oe:void 0,U=t}function ye(e,t,n){j=e,I=t,L=n}function xe(o){for(o=o.slice();;){let t=1/0,n,r=null,i;for(let e=0;e<o.length;e++)o[e]&&(i=o[e].first().distTo2D(N))<t&&(t=i,r=o[e],n=e);if(!r)return;o[n]=null,N=r.first(),ke(r,j,I,L)}}function ke(e,t,n,r){let i=e.first().z-e.last().z,o=[],a=e.first();for(t<=0&&(t=i);;){if(!(i>2*t)){if(i<t){o.push(a.clone()),a.z-=i,o.push(a.clone());break}o.push(a.clone()),a.z-=i/2,o.push(a.clone()),a.z-=i/2,o.push(a.clone());break}o.push(a.clone()),a.z-=t,i-=t}Oe(a.clone().setZ(D)),o.forEach(function(e,t){Oe(e,1),0<t&&t<o.length-1&&(r&&Me(r),n&&Oe(e.clone().setZ(e.z+n),0))}),Oe(a.clone().setZ(D)),ue()}function we(n,e,r,i,t){var o;if((n&&re&&re.point?n.z-re.point.z:0)<0&&r>ee&&(r=ee),G.mode=oe,B){let t=e?U:0;if(e&&B.adapt){var{minz:a,maxz:l,minp:s,maxp:p,adaptrp:c}=B,l,f=(l=l||d)-a;let{z:e}=n;if(c){for(;e>l;)e-=f;for(;e<a;)e+=f}else if(e<a||e>l)return n;e-=a,t=s<p?s+e/f*(p-s):s-e/f*(s-p)}B.flat&&(n.z=(m&&m.z?m.z:d)+B.flatz),u.addOutput(G,n,t,r,i,"laser")}else u.addOutput(G,n,e,r,i,t);return re={point:n,emit:e,speed:r,tool:i},n}function Me(e){we(null,0,e,K)}function Oe(o,e,t=$,n=1){(o=o.clone()).x+=b,o.y+=C,o.z+=A,ae&&(e=0,ae=!1);let r=te*n;if(void 0===o.a&&ie)o.a=ie.a;else if(ie&&void 0!==o.a&&void 0!==ie.a){var i=ie.a-o.a,a=Math.max(ie.z,o.z),l=Math.abs(i)/360*(2*Math.PI*a),s,p;if(1<=l)for(p of Se.util.lerp(ie.a,o.a,1)){var c=o.clone().setA(p);ie=we(c,e?1:0,r,K,"lerp")}}var f,u,m;ie||(f=o.clone().setZ(P+Z),ie=we(f,0,0,K));let d=ie.distTo2D(o),h=o.z-ie.z,z=Math.abs(h),g=!e;if(H||!(d<.001)||o.z!==ie.z){if(!q&&g&&d<=t&&h<=0&&!B){var v=0<_,y;z<.001||v&&z<=_?(e=1,g=!1):h<=-_&&(we(o.clone().setZ(ie.z),0,0,K),d=0)}else if(g&&H)o.z>ie.z?we(ie.clone().setZ(o.z),0,0,K):o.z<ie.z&&we(o.clone().setZ(ie.z),0,0,K);else if(g){var x=d>t&&!B,k=h>V/2&&d>_,w=_&&z>=_&&!Y,M;if(x||k||w){let e=Ue(fe,ie.x-b,ie.y-C,o.x-b,o.y-C,Math.max(o.z,ie.z),A,ce/2,Z),t=Math.max(e-o.z,e-ie.z),n=t>=_,r=e,i=o.z<=e;E&&(r=e=D+A,i=!0),(n||i)&&(M=r+(O?0:T),i&&we(ie.clone().setZ(M),0,0,K),we(o.clone().setZ(M),0,0,K),d=0)}else q&&h<0&&we(o.clone().setZ(ie.z),0,0,K)}!B&&h<-_&&!H&&(m=(u=Math.min(d/2,z))/z,le&&u&&m&&d>_?(r=Math.round(ee+(te-ee)*m),e=1):r=Math.min(te,ee)),G.mode=oe,G.spindle=se,ie=we(o,e?1:0,r,K)}}function Pe(e,t={}){const{cutdir:o,depthFirst:a,easeDown:n,progress:l}=t;let s=0,p=[];for(var c of e){let n=[],r=[],i=[];Be.flatten(c.camLines).forEach(function(e){var t=e.parent;a&&((e=e.clone()).parent=t?1:0),(t?i:r).push(e),e.layer=p.layer,n.push(e)}),Be.setWinding(r,o),Be.setWinding(i,!o),a?p.push(n):(N=Ie(n,N,function(e,t,i){e.forEachPoint(function(e,t,n,r){Oe(e.clone(),0!==r,void 0,1===i?S:1)},e.isClosed(),t)},{swapdir:!1}),ue()),l(++s,e.length)}function r(e){return e<0||0===e&&1/e==-1/0}if(a){let e=p.map(e=>e.filter(e=>!r(e.depth)));var i=e.map(e=>Be.nest(e.filter(e=>0===e.depth).clone()));let t=p.map(e=>e.filter(e=>r(e.depth)));var f=t.map(e=>Be.nest(e.filter(e=>0===e.depth).clone()));N=be(N,0,e,i,De,!1,n),N=be(N,0,t,f,De,!1,n)}}ie=t,N=t||x;let Ze={stock:m,setTool:ge,setDrill:ye,setSpindle:ze,setTolerance:de,setPrintPoint:he,setLasering:ve,getPrintPoint(){return N},printPoint:N,newLayer:ue,addGCode:me,camOut:Oe,polyEmit:De,poly2polyEmit:Ie,tip2tipEmit:je,depthRoughPath:be,depthOutlinePath:Ce,sliceOutput:Pe,emitDrills:xe,emitTrace:Ae,bounds:h,zclear:Z,zmax:D,lastPoint:()=>ie},Ee=0,Te=e.camops.map(e=>e.weight()).reduce((e,t)=>e+t);for(let r of e.camops){de(0),ae=!0,oe=r.op,J="index"===oe.type,H="lathe"===oe.type,q="rough"===oe.type,X="pocket"===oe.type,Y="contour"===oe.type||X&&oe.contour;let n=r.weight();ue(r.op),r.prepare(Ze,(e,t)=>{i((Ee+e*n)/Te,t||r.type(),t)}),Ee+=n,K&&ie&&(ue(),J||(we(N=ie.clone().setZ(f),0,0,K),ue()))}function Ae(e){var{tool:t,rate:n,plunge:r}=e.camTrace;ge(t,n,r);let i=new Le.Tool(a,t);var o=i.fluteDiameter();N=Ie(e.camLines,N,De,{swapdir:!1}),ue()}function De(e,t,n,r){let i=null,o=(q||X)&&1===n?S:1;return w&&e.isClosed()?i=e.forEachPointEaseDown(function(e,t){Oe(e.clone(),0<t,void 0,o)},r,M):e.forEachPoint(function(e,t,n,r){Oe((i=e).clone(),0!==r,void 0,o)},e.isClosed(),t),ue(),i}function be(e,o,a,l,s,t,p){let c=a[o];if(!c||!c.length)return e;let n=l[o],r=t?n.filter(e=>e.isInside(t,.05)):n,i=r.filter(e=>!e.level_emit);function f(t,e,n,r){t.level_emit=!0;var i=c.filter(e=>e.isInside(t));return p&&(r.z+=p),r=Ie(i,r,s,{mark:"emark",perm:!0,swapdir:!1}),p&&(r.z+=p),r=be(r,o+1,a,l,s,t,p)}1<i.length&&(i=Be.route(i,e));var u=i.filter(e=>e.open),m=i.filter(e=>!e.open);return Ie(m,e,f,{mark:"emark",swapdir:!1}),Ie(u,e,f,{mark:"emark",swapdir:!1}),e}function Ce(e,i,o,a,l,s,p){var t=i<o.length-1?o[o.length-1]:null;let n=o[i-1],r=o[i];return r?(n&&(r=r.filter(t=>{var e;return 0===n.filter(e=>!e.level_emit&&t.isNear(e,a,!0)).length})),r=r.filter(e=>!e.level_emit),r=r.filter(e=>e.isClockwise()===s),e=Ie(r,e,(e,t,n,r)=>(e.level_emit=!0,p&&(r.z+=p),r=De(e,t,n,r),p&&(r.z+=p),r=Ce(r,i+1,o,a,l,s,p),r=Ce(r,i+1,o,a,l,!s,p)),{weight:!1,swapdir:!1})):e}var Fe;return ie&&W.length&&(Fe=W.filter(e=>Array.isArray(e)).peek(),Array.isArray(Fe)&&u.addOutput(Fe,N=ie.clone().setZ(f),0,0,K)),u.output=W,N}function Ue(t,n,o,a,l,r,s,p,c){if(0<t)return t;let f=r,u=[];for(let e=0;e<t.length;e++){var i=t[e];if(u.push(i),i.z+s<r)break}u.reverse();for(let t=0;t<u.length;t++){let e=u[t],r=_e(n,o),i=_e(a,l);var m;if((m=e.tops.map(e=>e.intersections(r,i,!0)).flat()).length)f=Math.max(f,e.z+s+c);else{var d=r.slopeTo(i).toUnit().normal(),h=i.slopeTo(r).toUnit().normal();let t=r.projectOnSlope(d,p),n=i.projectOnSlope(d,p);(m=e.tops.map(e=>e.intersections(t,n,!0)).flat()).length?f=Math.max(f,e.z+s+c):(t=r.projectOnSlope(h,p),n=i.projectOnSlope(h,p),(m=e.tops.map(e=>e.intersections(t,n,!0)).flat()).length&&(f=Math.max(f,e.z+s+c)))}}return f}Le.prepare=async function(e,t,r){const n=e.filter(e=>!e.track.ignore&&!e.meta.disabled);var i;const o=1/n.length,a=self.worker.print=p.newPrint(t,n);a.output=[];let l;n.forEach((e,n)=>{l=f(e,t,a,l,(e,t)=>{r(.75*(n*o+e*o),t||"prepare")})});var s=a.output.filter(e=>Array.isArray(e));if(c)return c.path(s,(e,t)=>{r(.75+.25*e,"render",t)},{thin:!0,print:0,move:5601177,speed:!1,moves:!0,other:"moving",action:"milling",maxspeed:t.process.camFastFeed||6e3})}});"use strict";gapp.register("kiri-mode.cam.slice",(e,t)=>{const{base:g,kiri:pe}=e,{util:ce}=g,{driver:o,newSlice:n,setSliceTracker:fe}=pe,{polygons:r,newPoint:ue,newPolygon:de}=g,{CAM:me}=o,{OPS:he}=me;var a=me.process;const ge=r;function ze(e,t,o,n){return be(e=e.filter(e=>o<e.pos.z+e.dim.z/2).map(e=>e.off).flat(),t,o,!1)}function be(t,e,o,n){let r=[];return e.forEach(e=>r.appendAll(e.cut(ge.union(t,0,!0),n))),ve(r)}function ve(t){if(1<t.length){let e=0;e:for(;;e++){let r=t,e=r.length;for(let n=0;n<e;n++){let o=r[n];if(o)for(let t=n+1;t<e;t++){let e=r[t];if(e&&(!(.01<Math.abs(o.getZ()-e.getZ()))&&o.open&&e.open)){if(o.last().isMergable2D(e.first())){o.addPoints(e.points.slice(1)),r[t]=null;continue e}if(e.last().isMergable2D(o.first())){e.addPoints(o.points.slice(1)),r[n]=null;continue e}if(o.first().isMergable2D(e.first())){o.reverse(),o.addPoints(e.points.slice(1)),r[t]=null;continue e}if(o.last().isMergable2D(e.last())){e.reverse(),o.addPoints(e.points.slice(1)),r[t]=null;continue e}}}}break}for(var o of t=0<e?t.filter(e=>e):t)o.open&&o.first().isMergable2D(o.last())&&(o.points.pop(),o.open=!1)}return t}me.slice=async function(e,s,r,t){let o=e.process,n=e.stock||{},a=o.camStockIndexed,i=s.camops=[],l=s.slices=[],p=s.getBoundingBox(),c=s.track,{camZTop:f,camZBottom:u,camZThru:d}=o,m=c.top,h=a?0:n.z-m,g=a?0:m-c.box.d,z=a?u:u-g,b=a?p.min.z:Math.max(p.min.z,z),v=p.max.z,x=d,w=v+h,y=1/0,k=-1/0,_=!!e.controller.dark,A=_?12303291:0,M=s.anno.tab,E=o.camExpertFast,T="in"===e.controller.units?25.4:1,D,P,S=p.dim,O=g,Z=0,F=-O,j=x,I=Math.max((u?F+u:0)-j,u?F+u:F-j),R=Math.max(I,-x),B=w,C=v,L=h,H=f?F+f:B,Q=ce.round({top_stock:B,top_part:C,top_gap:L,top_z:H,bottom_stock:F,bottom_part:0,bottom_gap:O,bottom_z:I,bottom_cut:R},3);function U(e){t(e)}if(M&&M.forEach(e=>{let t=ue(0,0,0),o=ue(e.pos.x,e.pos.y,e.pos.z),n=de().centerRectangle(t,e.dim.x,e.dim.y),[r,a,s,i]=e.rot,l=(new THREE.Matrix4).makeRotationFromQuaternion(new THREE.Quaternion(r,a,s,i));n.points=n.points.map(e=>new THREE.Vector3(e.x,e.y,e.z).applyMatrix4(l)).map(e=>ue(e.x,e.y,e.z)),n.move(o),e.poly=n}),E&&console.log("disabling overhang safeties"),!o.ops||0===o.ops.length)return U("no processes specified");if(n.x&&n.y&&n.z){if(n.x+1e-5<p.max.x-p.min.x)return U("stock X too small for part. resize stock or use offset stock");if(n.y+1e-5<p.max.y-p.min.y)return U("stock Y too small for part. resize stock or use offset stock");if(n.z+1e-5<p.max.z-p.min.z)return U("stock Z too small for part. resize stock or use offset stock")}if(b>=p.max.z)return U(`invalid z bottom ${(b/T).round(3)} >= bounds z max `+(v/T).round(3));var q=Date.now(),V=new pe.cam_slicer(s),X;function Y(e){y=Math.min(y,e),k=Math.max(k,e)}let $={};function G(t){var e=$[t],o,n;if(e)return e;let r;for(n of Object.keys($).map(e=>parseFloat(e)).filter(e=>t<e))r=(r&&(n,r),n);let a=me.shadowAt(s,t,r);return r&&(a=ge.union([...a,...$[r]],.001,!0)),$[t]=ge.setZ(a,t)}function J(e=0,t=!0){return P=t?e:P+e,D=Math.PI/180*P,s.setAxisIndex(a?-P:0),a?-P:0}function K(e,t){if(e)if(Array.isArray(e))for(var o of e)K(o,t);else{for(var n of e.points)n.a=t;K(e.inner,t)}}function N(e,t=a){if(Array.isArray(e)||(e=[e]),l.appendAll(e),t&&void 0!==P)for(var o of e.filter(e=>e.camLines))K(o.camLines,-P)}let W={settings:e,widget:s,bounds:p,tabs:M,cutTabs:ze,cutPolys:be,healPolys:ve,shadowAt:G,slicer:V,addSlices:N,isIndexed:a,setAxisIndex:J,updateToolDiams:Y,zBottom:z,zThru:x,ztOff:h,zMax:v,zTop:w,unsafe:E,color:A,dark:_},ee=[new me.OPS.shadow(W,{type:"shadow",silent:!0})];let te=0,oe=ee.length?ee.map(e=>e.weight()).reduce((e,t)=>e+t):0;for(X of o.ops.filter(e=>!e.disabled)){if("|"===X.type)break;let t=he[X.type];if(t){let e=new t(W,X);ee.push(e),oe+=e.weight()}}W.ops=ee;let ne=fe({rotation:0});var re=structuredClone(Q);J();for(let n of ee){let o=n.weight(),e=structuredClone(re);var ae=n.op;ae.ov_topz&&(e.top_z=F+ae.ov_topz),ae.ov_botz&&(e.bottom_z=F+ae.ov_botz,e.bottom_cut=Math.max(e.bottom_z,-x)),W.workarea=e,await n.slice((e,t)=>{r((te+e*o)/oe,t||n.type())}),ne.rotation=a?D:0,"index"===n.op.type&&(s.topo=void 0,W.slicer=new pe.cam_slicer(s),$={},await new me.OPS.shadow(W,{type:"shadow",silent:!0}).slice(e=>{})),i.push(n),te+=o}fe(),l.forEach((e,t)=>e.index=t),M&&W.terrain.forEach(o=>{M.forEach(e=>{var t;e.pos.z+e.dim.z/2>=o.z&&(t=[...o.tops,e.poly],o.tops=ge.union(t,0,!0))})});var se=M?M.map(e=>e.poly):[],ie=ge.union([...W.shadow.base,...se],0,!0);let le=k<0?ie:ge.offset(ie,[y/2,k/2],{count:2,flat:!0,minArea:0});W.terrain.forEach(e=>e.tops.appendAll(le)),s.terrain=W.skipTerrain?null:W.terrain,s.minToolDiam=y,s.maxToolDiam=k,t()},me.addDogbones=function(e,t,o){if(Array.isArray(e))return e.forEach(e=>me.addDogbones(e,t));var n=e.open;let r=e.isClockwise();(o||e.parent)&&(r=!r);var a=e.points.slice();let s=a[a.length-1],i=s.slopeTo(a[0]).toUnit();var l=a.length+(n?0:1);let p=[];for(let e=0;e<l;e++){var c=a[e%a.length],f=s.slopeTo(c).toUnit(),u=i.angleDiff(f,!0),d=(u<0?180-u:180+u)/2+180,m,h;(!n||1<e&&e<l)&&(r&&45<u?(m=g.newSlopeFromAngle(i.angle+d),p.push(s.projectOnSlope(m,t)),p.push(s.clone())):!r&&u<-45&&(h=g.newSlopeFromAngle(i.angle-d),p.push(s.projectOnSlope(h,t)),p.push(s.clone()))),i=f,s=c,e<a.length&&p.push(c)}e.points=p,e.inner&&me.addDogbones(e.inner,t,!0)},me.traces=async function(e,t,o){if(t.traces&&t.trace_single===o)return!1;let n=new pe.cam_slicer(t);var r=Object.assign({},n.zFlat,n.zLine),a=[...new Set(Object.keys(r).map(e=>parseFloat(e).round(5)).appendAll(Object.entries(o?n.zLine:{}).map(e=>{var[t,o]=e;return 1<o?parseFloat(t).round(5):null}).filter(e=>null!==e)))].sort((e,t)=>t-e),s;let i=[],l={each:e=>{if(o)for(var t of e.lines)1<t.p1.distTo2D(t.p2)&&i.push(de().append(t.p1).append(t.p2).setOpen());else g.polygons.flatten(e.tops).forEach(o=>{o.inner=null,o.parent=null;var n=o.getZ();for(let t=0,e=i.length;t<e;t++){let e=i[t];var r=Math.abs(n-e.getZ());if(!(.01<r)&&(i[t].isEquivalent(o)&&r<.1))return}i.push(o)})},over:!1,flatoff:0,edges:!0,openok:!0,lines:!0};return await n.slice(a,l),l.over=!0,await n.slice(a,l),t.traces=i,t.trace_single=o,!0}});"use strict";gapp.register("moto.broker",[],(t,i)=>{class s{constructor(){this.topics={},this.used={},this.send={}}topics(){return Object.keys(this.topics)}listeners(t,i){for(var[s,e]of Object.entries(t))"function"==typeof e&&(s=i?i+"_"+s:s,this.subscribe(s,e))}subscribe(s,e){if(Array.isArray(s)){for(var t of s)this.subscribe(t,e);return this}if("string"==typeof s){let t=this.topics,i=t[s];if(i=i||(t[s]=[]),i.indexOf(e)<0){let t=this.send;var r=s.replace(/[\\ \.-]/g,"_");t[r]=t[r]=this.bind(s),i.push(e),this.publish(".topic.add",s)}return this}console.trace({invalid_topic:s})}unsubscribe(t,i){let s=this.topics[t];var e;s&&((e=s.indexOf(i))<0||(s.splice(e,1),0===s.length&&(delete this.topics[t],this.publish(".topic.remove",t))))}publish(t,i,s={}){if(!Array.isArray(t)){".topic.publish"!==t&&this.publish(".topic.publish",{topic:t,message:i,options:s}),this.used[t]=i;var e=this.topics[t];if(e&&e.length)for(var r of e)try{r(i,t,s)}catch(t){setTimeout(()=>{throw t},1)}else t.indexOf(".topic.")<0&&(self.dbug?self.dbug.debug(`undelivered '${t}'`,i):console.log(`undelivered '${t}'`,i));return i}for(var o of t)this.publish(o,i,s)}bind(s,e,r){let o=this;return function(t,i){o.publish(s,e||t,r||i)}}wrap(t,i){let s=this;return function(){return s.publish(t,i(...arguments))}}wrapObject(t,i){for(var[s,e]of Object.entries(t))"function"==typeof e&&(t[s]=this.wrap(i+"_"+s,e))}}const{moto:e}=t;gapp.broker=e.broker=new s});"use strict";gapp.register("kiri-mode.cam.slicer",[],(e,t)=>{const{base:s,kiri:P,moto:n}=e,{config:i,util:B,polygons:o,newOrderedLine:r,newPoint:L,newLine:l}=s,{sliceConnect:f,sliceDedup:z}=s,{newSlice:A}=P,m=o,c=!1,E=function(){0},Z=function(){0};class a{constructor(e,t={zlist:!0,zline:!0,lines:!1}){this.options={},this.setOptions(t),e&&(this.setPoints(e.getGeoVertices({unroll:!0,translate:!0})),this.computeFeatures())}get threaded(){return this.options.threaded}setOptions(e){return Object.assign(this.options,e||{}),this.options}setPoints(e){return this.bounds=null,this.points=e,this.zFlat={},this.zLine={},this.zList={},this}computeFeatures(e){E("compute features");var s=this.setOptions(e);const n=this.bounds=new THREE.Box3;var i=this.points,o,r,l,c,a,h,u,p;const d=this.zFlat,f=this.zLine,t=this.zList;function z(e){e=e.round(5),t[e]=(t[e]||0)+1}let m=L(0,0,0),g=L(0,0,0),b=L(0,0,0);for(let e=0,t=i.length;e<t;){m.set(i[e++],i[e++],i[e++]),g.set(i[e++],i[e++],i[e++]),b.set(i[e++],i[e++],i[e++]),n.expandByPoint(m),n.expandByPoint(g),n.expandByPoint(b),s.zlist&&(z(m.z),z(g.z),z(b.z)),m.z===g.z&&g.z===b.z?(o=m.z.toFixed(5),r=Math.abs(B.area2(m,g,b))/2,d[o]?d[o]+=r:d[o]=r):s.zline&&(m.z===g.z&&(l=m.z.toFixed(5),c=f[l],f[l]=(c||0)+1),g.z===b.z&&(a=g.z.toFixed(5),h=f[a],f[a]=(h||0)+1),b.z===m.z&&(u=b.z.toFixed(5),p=f[u],f[u]=(p||0)+1))}return Z("compute features"),this}async slice(s,e){const n=this.setOptions(e);if(!Array.isArray(s))throw"slice zs parameter must be ab array";const i=B.numOrDefault(n.flatoff,.01);s=s.sort((e,t)=>e-t).map(e=>{if(!i)return e;var t=e.toFixed(5);return this.zFlat[t]?e+i:e});var{points:o}=this,t=o.length,r=s.length,l=t/r,c=25,a=Math.ceil(r/25);const h=[];for(let e=0,t=0;e<25&&!(t>=r);e++)h.push({zs:s.slice(t,t+a),index:[]}),t+=a;let u=L(0,0,0),p=L(0,0,0),d=L(0,0,0),f=.001;E("create buckets");for(let e=0,t=o.length;e<t;){u.set(o[e++],o[e++],o[e++]),p.set(o[e++],o[e++],o[e++]),d.set(o[e++],o[e++],o[e++]);var z=Math.min(u.z,p.z,d.z),m=Math.max(u.z,p.z,d.z),g;for(g of h){const{zs:s,index:O}=g;var b=Math.min(...s),v=Math.max(...s);z<b&&m<b&&Math.abs(z-b)>f&&Math.abs(m-b)>f||v<z&&v<m&&Math.abs(z-v)>f&&Math.abs(m-v)>f||O.push(u.x,u.y,u.z,p.x,p.y,p.z,d.x,d.y,d.z)}}Z("create buckets"),E("slicing");const{minions:y}=P;var x=y&&y.running,k;const w=(x?this.sliceBucketMinion:this.sliceBucket).bind(this),F={count:0,total:s.length};x&&y.broadcast("cam_slice_init",{});const M=[];for(k of h)M.push(w(k,{...n,minZ:this.bounds.min.z},e=>{F.count++,n.progress&&n.progress(F.count,F.total)}));const _=(await Promise.all(M)).flat();return _.sort((e,t)=>t.z-e.z).forEach((e,t)=>{e.tops=e.polys,e.slice=A(e.z).addTops(e.tops),n.each&&n.each(e,t,_.length)}),x&&y.broadcast("cam_slice_cleanup"),Z("slicing"),_}async sliceBucketMinion(t,s,e){const{decode:n,decodePointArray:i}=P.codec;var o=(await new Promise(e=>{P.minions.queue({cmd:"cam_slice",opt:Object.clone(s),bucket:t},e)})).slices,r;for(r of o)r.polys=n(r.polys),r.lines&&(r.lines=i(r.lines).group(2).map(e=>l(e[0],e[1]))),e(r);return o}async sliceBucket(e,t,s){var{zs:n,index:i}=e,o;const r=[];for(o of n){var l=this.sliceZ(o,i,t);l&&r.push(l),s(l)}return r}sliceZ(s,e,t){let n=!1!==t.links,i=!1!==t.dedup,o=t.edges||!1,r=t.over||s<=t.minZ,l=t.debug,c={},a=[];const h=e,u=L(0,0,0),p=L(0,0,0),d=L(0,0,0);for(let e=0;e<h.length;){u.set(h[e++],h[e++],h[e++]),p.set(h[e++],h[e++],h[e++]),d.set(h[e++],h[e++],h[e++]);let t={under:[],over:[],on:[]};if(g(u,s,t),g(p,s,t),g(d,s,t),3!==t.under.length&&3!==t.over.length)if(2===t.on.length)(r&&1===t.over.length||!r&&1===t.under.length)&&a.push(v(c,t.on[0],t.on[1],!1,!0));else if(3!==t.on.length&&0!==t.under.length&&0!==t.over.length&&!o){let e=b(t.over,t.under,s);e.length<2&&1===t.on.length&&e.push(t.on[0].clone()),2===e.length?a.push(v(c,e[0],e[1])):console.log({msg:"invalid ips",line:e,where:t})}}return i&&(a=z(a,l)),a.length?{z:s,lines:!1!==t.lines?a:void 0,polys:n?m.nest(f(a,t,l)):void 0}:null}interval(t,e){let s=e||{},n=this.bounds,i=s.boff||s.off||0,o=s.toff||s.off||0,r=void 0!==s.min?s.min:n.min.z+i,l=(s.max||n.max.z)-o,c=(l-r)/t,a=c%1!=0?0:1,h=Math.floor(c)+a,u=[];if(s.fit&&(h++,t=(l-r)/h),s.down)for(let e=0;e<h;e++)u.push(l),l-=t;else for(let e=0;e<h;e++)u.push(r),r+=t;if(s.fit&&u.push(s.down?l:r),s.flats&&s.off){let t=[];Object.keys(this.zFlat).forEach(e=>{e=parseFloat(e),t.push(e+s.off),e>r&&t.push(e-s.off)}),u.appendAll(t).sort((e,t)=>s.down?t-e:e-t)}return u=u.map(e=>e.round(5)).filter((e,t,s)=>t<1||s[t-1]!==s[t]),u.map(e=>parseFloat(e.toFixed(5)))}}function g(e,t,s){var n=e.z-t;(Math.abs(n)<i.precision_slice_z?s.on:n<0?s.under:s.over).push(e)}function b(s,n,i){let o=[];for(let t=0;t<s.length;t++)for(let e=0;e<n.length;e++)o.push(s[t].intersectZ(n[e],i));return o}function h(e,t){var s=e[t.key];return s||(e[t.key]=t)}function v(e,t,s,n,i){t=h(e,t.clone()),s=h(e,s.clone());let o=r(t,s);return o.coplanar=n||!1,o.edge=i||!1,o}a.checkOverUnderOn=g,a.intersectPoints=b,P.cam_slicer=a,n.broker.subscribe("minion.started",e=>{const{funcs:t,cache:r,reply:l,log:s}=e;t.cam_slice_init=()=>{r.slicer=new a},t.cam_slice_cleanup=()=>{delete r.slicer},t.cam_slice=(e,t)=>{var{bucket:s,opt:n}=e;const{encode:i,encodePointArray:o}=P.codec;r.slicer.sliceBucket(s,n,e=>{}).then(e=>{e.forEach(e=>{var t;e.polys=i(e.polys),e.lines&&(t=e.lines.map(e=>[e.p1,e.p2]).flat(),e.lines=o(t))}),l({seq:t,slices:e})})}})});"use strict";gapp.register("kiri-mode.cam.slicer2",[],(e,n)=>{const{base:u,kiri:t}=e,{config:i,newOrderedLine:s,newPoint:x}=u;class r{static intersectPoints=f;static checkOverUnderOn=d;static removeDuplicateLines=k;constructor(e=0){this.min=1/0,this.max=-1/0,this.index=e}setFromArray(n,t={}){var r=t.min||-1/0,i=t.max||1/0,o=n.length;const s=this.points=[];for(let e=0;e<o;){var h=n[e++],u=n[e++],l=n[e++],p=n[e++],a=n[e++],g=n[e++],c=n[e++],m=n[e++],d=n[e++],f=Math.min(l,g,d),v=Math.max(l,g,d);v<r||i<f||(s.push(x(h,u,l),x(p,a,g),x(c,m,d)),this.min=t.min||Math.min(this.min,f),this.max=t.max||Math.max(this.max,v))}return this}setFromPoints(n,t={}){const r=this.points=[];var i=n.length,o=t.min||-1/0,s=t.max||1/0;for(let e=0;e<i;){var h=n[e++],u=n[e++],l=n[e++],p=Math.min(h.z,u.z,l.z),a=Math.max(h.z,u.z,l.z);a<o||s<p||(r.push(h,u,l),this.min=t.min||Math.min(this.min,p),this.max=t.max||Math.max(this.max,a))}return this}slice(n=1){const t=[];for(let e=this.min;e<this.max;e+=n)t.push({z:e,index:this.index++,lines:this.sliceZ(e)});return t}sliceZ(n,e={}){var t=this.points,r=this.min,i=this.max,o={},s,h,u;const l=[];let{under:p,over:a,both:g}=e;p||g||(a=!0);for(let e=0;e<t.length;){var s=t[e++],h=t[e++],u=t[e++],c={under:[],over:[],on:[]},m;if(d(s,n,c),d(h,n,c),d(u,n,c),3!==c.under.length&&3!==c.over.length)if(2===c.on.length){(g||a&&(1===c.over.length||n===i)||p&&(1===c.under.length||n===r))&&l.push(v(o,c.on[0],c.on[1],!1,!0))}else if(3!==c.on.length&&0!==c.under.length&&0!==c.over.length){let e=f(c.over,c.under,n);e.length<2&&1===c.on.length&&e.push(c.on[0]),2===e.length?l.push(v(o,e[0],e[1])):console.log({msg:"invalid ips",line:e,where:c})}}if(0!=l.length||!e.noEmpty)return k(l)}}function d(e,n,t){var r=e.z-n;(Math.abs(r)<i.precision_slice_z?t.on:r<0?t.under:t.over).push(e)}function f(t,r,i){let o=[];for(let n=0;n<t.length;n++)for(let e=0;e<r.length;e++)o.push(t[n].intersectZ(r[e],i));return o}function h(e,n){var t=e[n.key];return t||(e[n.key]=n)}function v(e,n,t,r,i){n=h(e,n),t=h(e,t);let o=s(n,t);return o.coplanar=r||!1,o.edge=i||!1,o}function k(e,t){let n=[],s=[],r=[],i={};function o(e){var n=i[e.key];return n||(r.push(e),i[e.key]=e)}function h(e,n){o(e),e.group?e.group.push(n):e.group=[n]}return e.sort(function(e,n){return e.key===n.key?(e.del=!e.edge,n.del=!n.edge,t&&(e.del||n.del)&&console.log("dup",e,n),0):e.key<n.key?-1:1}),e.forEach(function(e){e.del||(s.push(e),h(e.p1,e),h(e.p2,e))}),r.forEach(function(o){if(2==o.group.length){let r=o.group[0],i=o.group[1];if(r.isCollinear(i)){r.del=!0,i.del=!0;let e=r.p1!=o?r.p1:r.p2,n=i.p1!=o?i.p1:i.p2,t=u.newOrderedLine(e,n);e.group.remove(r),e.group.remove(i),n.group.remove(r),n.group.remove(i),e.group.push(t),n.group.push(t),t.edge=r.edge||i.edge,s.push(t)}}}),s.sort(function(e,n){return e.key===n.key?(e.del=!0,n.del=!n.edge,0):e.key<n.key?-1:1}),s.forEach(function(e){e.del||(n.push(e),e.p1.group=null,e.p2.group=null)}),n}t.topo_slicer=r});"use strict";gapp.register("kiri-mode.cam.tools",[],(t,e)=>{var{kiri:i}=t,{driver:r}=i;const{CAM:l}=r;var a=Math.PI/2;const s=180/Math.PI;class h{constructor(t,e,i){this.tool=(0<=i?t.tools.filter(t=>t.number==i):t.tools.filter(t=>t.id==e))[0],this.tool||(this.tool=Object.assign({},t.tools[0]),this.tool.number=0<=i?i:this.tool.number,this.tool.id=0<=e?e:this.tool.id)}getID(){return this.tool.id}getName(){return this.tool.name}getType(){return this.tool.type}getNumber(){return this.tool.number}isMetric(){return this.tool.metric}unitScale(){return this.isMetric()?1:25.4}fluteLength(){return this.unitScale()*this.tool.flute_len}fluteDiameter(){return this.unitScale()*this.tool.flute_diam}tipDiameter(){return this.unitScale()*this.tool.taper_tip}maxDiameter(){return Math.max(this.fluteDiameter(),this.tipDiameter(),this.shaftDiameter())}traceOffset(){return(this.isTaperMill()?this.tipDiameter():this.fluteDiameter())/2}contourOffset(t){var e=Math.min(this.isTaperMill()?this.tipDiameter():this.fluteDiameter());return e?e*t:t}setTaperLengthFromAngle(t){var e=(this.flute_diam-this.taper_tip)/2;return this.flute_len=l.calcTaperLength(e,t)}getTaperAngle(){return l.calcTaperAngle((this.flute_diam-this.taper_tip)/2,this.flute_len)}shaftLength(){return this.unitScale()*this.tool.shaft_len}shaftDiameter(){return this.unitScale()*this.tool.shaft_diam}isBallMill(){return"ballmill"===this.tool.type}isTaperMill(){return"tapermill"===this.tool.type}generateProfile(i){let r=this.isBallMill(),l=this.isTaperMill(),t=this.tipDiameter(),a=this.fluteLength(),e=this.fluteDiameter(),s=this.shaftDiameter(),h=Math.max(e,s),o=h/i,n=Math.round(o),u=o/2,m=e/2,f=e/i,p=f/2,c=t/i,g=c/2,M=p-g,D=n+(1-n%2),T=(n-n%2)/2,d=[],_=.001<s-e,b=p*p,A=-1/0;for(let e=0;e<D;e++)for(let t=0;t<D;t++){var S=e-T,v=t-T,x=Math.sqrt(S*S+v*v),y;if(x<=p){A=Math.max(A,S,v);let t=0;r?t=Math.sqrt(b-x*x)*i-m:l&&g<=x&&(t=(x-g)/M*-a),d.push(S,v,t)}else a&&_&&x<=u&&d.push(S,v,-a)}const L=new Float32Array(new SharedArrayBuffer(4*d.length));return L.set(d),this.profile=L,this.profileDim={size:s,pix:D+2,maxo:A},this}}l.Tool=h,l.calcTaperAngle=function(t,e){return Math.atan(t/e)*s},l.calcTaperLength=function(t,e){return t/Math.tan(e)},l.getToolDiameter=function(t,e){return new l.Tool(t,e).fluteDiameter()}});"use strict";gapp.register("kiri-mode.cam.topo",[],(t,e)=>{const{base:o,kiri:k,moto:s}=t,{driver:n,newSlice:mt}=k,{CAM:xt}=n,{polygons:a,newLine:r,newSlope:i,newPoint:C,newPolygon:g}=o;var c=xt.process;const ft=a,v=180/Math.PI;var l=Math.PI/180;class p{constructor(){}async generate(t={}){let{state:e,contour:o,onupdate:s,ondone:n}=t,{widget:a,settings:r,tshadow:i,center:c,tabs:l,color:p}=t.state,{controller:d,process:u}=r,h=2500*parseInt(d.animesh||100),m=o.axis.toLowerCase(),x="x"===m,f="y"===m,y=a.getBoundingBox().clone(),b=o.tolerance,g=o.flatness||b/100,v=i,w=y.min.x,z=y.max.x,M=y.min.y,X=y.max.y,Y=o.bottom?e.zBottom:0,T=Math.max(y.min.z,Y)+1e-4,_=z-w,A=X-M,Z=o.inside,E=1+(o.reduction||0),P=b||1/Math.sqrt(h/(_*A)),H=new xt.Tool(r,o.tool),B=H.generateProfile(P).profile,L=H.fluteDiameter(),q=L*o.step,C=o.leave||0,O=o.angle,S=o.curves,R=o.bridging||0,k=Math.ceil(_/P),V=Math.ceil(A/P),D=a.topo,I=D&&D.resolution===P&&D.diameter===L?D:void 0,j=a.topo=I||{data:new Float32Array(new SharedArrayBuffer(k*V*4)),stepsX:k,stepsY:V,bounds:y,diameter:L,resolution:P,profile:B,widget:a,raster:!0,slices:null},F=j.data,G=[],J=l?Math.max(...l.map(t=>t.dim.z/2+t.pos.z)):0,K=l,N=Math.max(u.camTabsHeight+Y,J),Q=K?[]:null,U=Z?v:ft.expand(v,L/2+3*P),W=Z?0:L/2+P,$=Math.floor(W/P),tt=!1,et=tt&&!0,ot=tt&&!0,st=tt&&!0,nt=tt&&!0,at=Date.now;if(0!==b||I||console.log(a.id,"topo auto tolerance",P.round(4)),this.tolerance=P,l&&Q.appendAll(l.map(e=>{let t=ft.expand([e.poly],L/2);return t.forEach(t=>t.z=e.dim.z/2+e.pos.z),t}).flat()),et){const tt=mt(-1),ht=tt.output();U&&ht.setLayer("clip.to",{line:56576}).addPolys(U),G.push(tt)}var rt=this.probe=new yt({profile:B,data:F,stepsX:k,stepsY:V,boundsX:_,boundsY:A,minX:w,minY:M,zMin:T}),{toolAtZ:it,toolAtXY:ct,zAtXY:lt}=rt;this.toolAtZ=it,this.toolAtXY=ct,this.zAtXY=lt;var pt=this.trace=new bt(rt,{curvesOnly:S,maxangle:O,flatness:g,bridge:R,contourX:x}),dt,ut;return j.raster&&(dt=j.box=new THREE.Box2,ut={resolution:P,curvesOnly:S,flatness:g,stepsY:V,minY:M,maxY:X,zMin:T,data:F,box:dt},s(0,1,"raster"),await this.raster(a,ut,(t,e,o)=>{s(t/2,e,o)}),j.raster=!1),await this.contour({box:j.box,minX:w,maxX:z,minY:M,maxY:X,stepsX:k,stepsY:V,boundsX:_,boundsY:A,partOff:W,gridDelta:$,resolution:P,toolStep:q,contourX:x,contourY:f,density:E,clipTo:U,clipTab:Q,clipTabZ:Q?Q.map(t=>t.z):void 0,tabHeight:N,newslices:G,leave:C,color:p},(t,e,o)=>{s(e/2+t/2,e,o)}),n(G),this}async raster(o,a,s){var{resolution:e}=a;const{box:r}=a,{worker:t,minions:n}=k,i=o.getGeoVertices({unroll:!0,translate:!0}).toShared(),c={min:1/0,max:-1/0};for(let t=0,e=i.length;t<e;t+=3){var l=i[t],p=i[t+2];i[t]=p,i[t+2]=l,c.min=Math.min(c.min,l),c.max=Math.max(c.max,l)}var d=Math.ceil(Math.min(25,i.length/27e3)),u=(c.max-c.min)/d;let h=[],m=0,x={min:c.min,max:c.min+u,index:m};for(let t=c.min;t<c.max;t+=e)t>x.max&&(h.push(x),x={min:t,max:t+u,index:m}),m++;h.push(x);let f=0;if(1<n.running){t.putCache({key:o.id,data:i},{done:t=>{}});var y=h.map(t=>new Promise(e=>{n.queue({cmd:"topo_raster",id:o.id,params:a,slice:t},t=>{e(t),s(++f,h.length,"raster")})}));(await Promise.all(y)).map(t=>t.box).map(t=>new THREE.Box2(new THREE.Vector2(t.min.x,t.min.y),new THREE.Vector2(t.max.x,t.max.y))).map(t=>(r.union(t),t)),t.clearCache({},{done:t=>{}})}else for(var b of h)new k.topo_slicer(b.index).setFromArray(i,b).slice(e).map(t=>{const e=k.newSlice(t.z);e.index=t.index,e.lines=t.lines;for(var o of t.lines){const{p1:s,p2:n}=o;s.swapped||(s.swapXZ(),s.swapped=!0),n.swapped||(n.swapXZ(),n.swapped=!0)}return w({...a,box:r,lines:t.lines,gridx:t.index}),e}),s(++f,h.length,"raster")}async contour(a,r){const i=this.trace,c=k.minions.running;var{minX:l,maxX:p,minY:d,maxY:u,boundsX:h,boundsY:m,stepsX:x,stepsY:f}=a,{gridDelta:y,resolution:b,density:g,partOff:v,toolStep:w,contourX:z,contourY:M}=a;const{clipTo:X,clipTab:Y,clipTabZ:T,tabHeight:_,newslices:A,color:Z,leave:E}=a;let P=0,H=0;if(z&&(H+=(u-d+2*v)/w|0),M&&(H+=(p-l+2*v)/w|0),0!==H){var B=a.box.clone().expandByVector(new THREE.Vector3(v,v,0));i.init({box:B,leave:E,clipTo:X,clipTab:Y,clipTabZ:T,tabHeight:_,resolution:b,concurrent:c,density:g});let e,t=0,o=[],s=[];var L=new Promise(t=>{e=()=>{o.sort((t,e)=>t.z-e.z),s.sort((t,e)=>t.z-e.z),A.appendAll(o),A.appendAll(s),t()}}),q=()=>{t++},C,O;let n=()=>{0==--t&&c&&e()};if(M){r(0,H,"contour y");for(let t=l-v;t<=p+v;t+=w)if(!(t<B.min.x||t>B.max.x)){const S=Math.round((t-l)/h*x);q(),i.crossY({from:d-v,to:u+v,x:t,gridx:S,gridy:-y},e=>{if(0<e.length){let t=mt(S);t.camLines=e,t.output().setLayer("contour y",{face:Z,line:Z}).addPolys(e),o.push(t)}r(++P,H,"contour y"),n()})}}if(z){r(0,H,"contour x");for(let t=d-v;t<=u+v;t+=w)if(!(t<B.min.y||t>B.max.y)){const R=Math.round((t-d)/m*f);q(),i.crossX({from:l-v,to:p+v,y:t,gridx:-y,gridy:R},e=>{if(0<e.length){let t=mt(R);t.camLines=e,t.output().setLayer("contour x",{face:Z,line:Z}).addPolys(e),s.push(t)}r(++P,H,"contour x"),n()})}}c||e(),await L,i.cleanup()}}}class yt{constructor(t){const{data:u,profile:h}=t,{stepsX:m,stepsY:x,boundsX:e,zMin:f,minX:n,minY:a}=t;this.params=t;const o=this.toolAtZ=function(t,e){var o=m,s=x,n=o-1,a=s-1;let r,i=0,c=-1/0;for(;i<h.length;){var l=h[i++]+t,p=h[i++]+e,d=h[i++];r=!(l<0||n<l||p<0||a<p)&&u[l*s+p]||f,c=Math.max(d+r,c)}return Math.max(c,f)},r=m/e,i=m/e;var s=this.toolAtXY=function(t,e){return t=Math.round(r*(t-n)),e=Math.round(i*(e-a)),o(t,e)},c=this.zAtXY=function(t,e){var o=Math.round(r*(t-n)),s=Math.round(i*(e-a));return u[o*x+s]||f}}}class bt{constructor(t,e){const{curvesOnly:p,maxangle:d,flatness:u,bridge:o,contourX:h,leave:s}=e;this.params=e,this.probe=t;let m,n,x,f,y;var a=this.newslice=()=>{this.slice=n=[]};const r=this.newtrace=function(){m=g().setOpen()},b=this.end_poly=function(t){x&&m.push(x),0<m.length&&(1<m.length&&n.push(m),r()),f=void 0,x=void 0,y=void 0,t&&(m.push(t),f=t)};var i=function(t){for(var e in t){const o=t[e];"number"==typeof o&&(t[e]=o.round(4))}console.log(...arguments)},c=this.push_point=function(t,e,o){var s=C(t,e,o),n=f,a,r,i,c,l;n?(a=t-n.x||e-n.y,r=o-n.z,i=Math.atan2(r,a),p&&Math.abs(r)<u?b(s):void 0!==y&&Math.abs(y-i)<.001?x=s:(x&&(m.push(x),x=void 0),p&&(c=h?Math.abs(n.x-t):Math.abs(n.y-e),Math.atan2(Math.abs(r),c)*v>d&&b()),m.push(s)),y=i):m.push(s),f=s};const l=this.object=this;this.inClip=function(e,o,s){for(let t=0;t<e.length;t++){var n=e[t],a=!o||o<=n.z;if(l.tabZ=n.z,a&&s.isInPolygon(n))return!0}return!1}}init(t){this.cross=t;const{minions:e}=k,{clipTab:o,clipTabZ:s}=t;if(o)for(let t=0,e=o.length;t<e;t++)o[t].z=s[t];if(e&&this.cross.concurrent){const{codec:n}=k;e.broadcast("trace_init",n.encode({probe:this.probe.params,trace:this.params,cross:t}))}}cleanup(){const{minions:t}=k;t&&this.cross.concurrent&&t.broadcast("trace_cleanup")}crossY(t,e){const{minions:o}=k;o&&this.cross.concurrent?o.queue({cmd:"trace_y",params:t},t=>{e(k.codec.decode(t.slice))}):this.crossY_sync(t,e)}crossX(t,e){const{minions:o}=k;o&&this.cross.concurrent?o.queue({cmd:"trace_x",params:t},t=>{e(k.codec.decode(t.slice))}):this.crossX_sync(t,e)}crossY_sync(t,e){const{push_point:o,end_poly:s,newtrace:n,newslice:a,inClip:r}=this.object;var{clipTab:i,tabHeight:c,clipTo:l,box:p,resolution:d,density:u,leave:h}=this.cross;const{toolAtZ:m}=this.probe;let{from:x,to:f,x:y,gridx:b,gridy:g}=t;var v=d*u;const w=C(0,0);a(),n();for(let e=x;e<f;e+=v)if(e<p.min.y||e>p.max.y)g+=u;else{let t=m(b,g);w.x=y,w.y=e,i&&t<c&&r(i,t,w)&&(t=this.tabZ),!l||r(l,void 0,w)?o(y,e,t+h):s(),g+=u}s(),e(this.slice)}crossX_sync(t,e){const{push_point:o,end_poly:s,newtrace:n,newslice:a,inClip:r}=this.object;var{clipTab:i,tabHeight:c,clipTo:l,box:p,resolution:d,density:u,leave:h}=this.cross;const{toolAtZ:m}=this.probe;let{from:x,to:f,y,gridx:b,gridy:g}=t;var v=d*u;const w=C(0,0);a(),n();for(let e=x;e<f;e+=v)if(e<p.min.x||e>p.max.x)b+=u;else{let t=m(b,g);w.x=e,w.y=y,i&&t<c&&r(i,t,w)&&(t=this.tabZ),!l||r(l,void 0,w)?o(e,y,t+h):s(),b+=u}s(),e(this.slice)}}function w(t){const{lines:r,data:e,box:o,resolution:s,curvesOnly:n}=t;var{flatness:i,zMin:c,minY:a,maxY:l,stepsY:p,gridx:d}=t;const{slice:u}=t;let h,m,x,f,y,b,g,v,w,z=[];var M=r.length,X,Y;t:for(let e=0;e<M;e++){let t=r[e],n=t.p1,a=t.p2;if(!(Math.abs(n.y-a.y)<i)&&!(n.z<c&&a.z<c)){n.y>a.y&&(X=n,n=a,a=X);for(let s=0;s<M;s++)if(!(s>=e-1&&s<=e+1)){let t=r[s],e=t.p1,o=t.p2;if(e.y>o.y&&(Y=e,e=o,o=Y),Math.max(n.z,a.z)<Math.min(e.z,o.z)&&n.y>=e.y&&a.y<=o.y)continue t}z.push(n,a),o.expandByPoint(n),o.expandByPoint(a)}}for(h=0,v=a;v<l&&h<p;v+=s){for(m=d*p+h,x=e[m]||c,f=0,y=z.length;f<y;f+=2){var T=z[f],_=z[f+1],A=T.z>x||_.z>x,Z=T.y<=v&&_.y>=v,E,P,H,B;A&&Z&&(E=T.y-_.y,P=T.z-_.z,H=(T.y-v)/E,(B=T.z-P*H)>x&&(x=e[m]=Math.max(B,c),u&&u.output().setLayer("heights",{face:0,line:0}).addLine(C(T.x,v,0),C(T.x,v,x))))}h++}if(n){let s=[];for(let t=0,e=z,o=e.length;t<o;t+=2){var L=e[t],q=e[t+1];Math.abs(L.z-q.z)>=i&&s.push(L,q)}z=s}return z}xt.Topo=async function(t){return(new p).generate(t)},s.broker.subscribe("minion.started",t=>{const{funcs:e,cache:r,reply:l,log:o}=t;e.topo_raster=(t,e)=>{const{id:o,slice:s,params:i}=t;var{resolution:n}=i,a=r[o];const c=new THREE.Box2;new k.topo_slicer(s.index).setFromArray(a,s).slice(n).forEach(t=>{var{z:e,index:o,lines:s}=t,n;for(n of s){const{p1:a,p2:r}=n;a.swapped||(a.swapXZ(),a.swapped=!0),r.swapped||(r.swapXZ(),r.swapped=!0)}w({...i,box:c,lines:s,gridx:o})}),l({seq:e,box:c})},e.trace_init=t=>{const{cache:e}=self,{codec:o}=k;t.cross.clipTo=o.decode(t.cross.clipTo),t.cross.clipTab=o.decode(t.cross.clipTab);var s=new yt(t.probe);const n=new bt(s,t.trace);e.trace={probe:s,trace:n,cross:t.cross},n.init(t.cross)},e.trace_y=(t,e)=>{var{cache:o}=self;const{trace:s}=o.trace;s.crossY_sync(t.params,t=>{t=k.codec.encode(t),l({seq:e,slice:t})})},e.trace_x=(t,e)=>{var{cache:o}=self;const{trace:s}=o.trace;s.crossX_sync(t.params,t=>{t=k.codec.encode(t),l({seq:e,slice:t})})},e.trace_cleanup=()=>{delete r.trace}})});"use strict";gapp.register("kiri-mode.cam.topo",[],(e,t)=>{const{base:s,kiri:g,moto:a}=e,{driver:o,newSlice:T}=g,{CAM:b}=o,{polygons:n,newPoint:B,newPolygon:R,sliceConnect:m}=s;var i=b.process,r=n;const q=180/Math.PI,F=Math.PI/180;function H(s,a=1,o=0){return(e,t)=>{s(o+e*a,t)}}class u{constructor(){}async generate(e={}){let{state:t,op:s,onupdate:a,ondone:o}=e,{widget:n,settings:i,tabs:r}=e.state;var{controller:l,process:h}=i,c,p;let m=s.axis.toLowerCase(),u=new b.Tool(i,s.tool),d=n.getBoundingBox().clone(),f=2500*parseInt(l.animesh||100),{min:g,max:v}=d,x,w=v.x-g.x,y=v.y-g.y,z={x:"x"===m,y:"y"===m},M=g.z+1e-4,A=s.tolerance,P=A||1/Math.sqrt(f/(w*y)),E=this.step=2*u.traceOffset()*s.step,k=this.angle=s.angle||1;u.isTaperMill()&&0===E&&(E=this.step=s.step*u.unitScale()),0===A&&console.log(n.id,"topo4 auto tolerance",P.round(4)),this.zBottom=t.zBottom,this.resolution=P,this.vertices=n.getGeoVertices({unroll:!0,translate:!0}),this.tabverts=n.getTabVertices(),this.tool=u.generateProfile(P).profile,this.maxo=u.profileDim.maxo*P,this.diam=u.fluteDiameter(),this.zoff=n.track.top||0,this.leave=s.leave||0,this.linear=s.linear||!1,this.lineColor=t.settings.controller.dark?16776960:5592320,a(0,"lathe");const C=this.range={min:1/0,max:-1/0};for(p of this.sliced=await this.slice(H(a,.25,0)))C.min=Math.min(C.min,p.z),C.max=Math.max(C.max,p.z),p.output().setLayer("lathe",{line:8947848}).addPolys(p.topPolys());var L=await this.lathe(H(a,.75,.25));return a(1,"lathe"),o(L),this}async slice(e){const{vertices:s,resolution:t,tabverts:a,zoff:o}=this,n=this.range={min:1/0,max:-1/0};var i=this.box=new THREE.Box2;for(let e=0,t=s.length;e<t;e+=3){var r=s[e],l=s[e+2]+o;s[e]=l,s[e+2]=r,n.min=Math.min(n.min,r),n.max=Math.max(n.max,r)}n.min-=this.diam/2,n.max+=this.diam/2;for(let e=0,t=a.length;e<t;e+=3){var h=a[e],c=a[e+2]+o;a[e]=c,a[e+2]=h}this.vertices=[].appendAll(s).appendAll(a).toFloat32().toShared();var p=Math.ceil(Math.min(25,s.length/27e3)),m=(n.max-n.min)/p;let u=0,d=this.slices=[],f={min:n.min,max:n.min+m,index:u};for(let e=n.min;e<n.max;e+=t)e>f.max&&(d.push(f),f={min:e,max:e+m,index:u}),u++;return d.push(f),1<g.minions.running?this.sliceMinions(e):this.sliceWorker(e)}async sliceWorker(e){var{vertices:t,slices:s,resolution:a}=this,o;const{codec:r}=g;let n=[],i=0;for(o of s){var l=new g.topo_slicer(o.index).setFromArray(t,o).slice(a).map(e=>{const t=g.newSlice(e.z);for(var s of e.lines){const{p1:n,p2:i}=s;n.swapped||(n.swapXZ(),n.swapped=!0),i.swapped||(i.swapXZ(),i.swapped=!0)}t.index=e.index,t.addTops(m(e.lines));var a=r.encodePointArray(e.lines.map(e=>[e.p1,e.p2]).flat());const o=new Float32Array(new SharedArrayBuffer(4*a.length));return o.set(a),t.shared=o,t});n.appendAll(l),e(++i/s.length)}return n}async sliceMinions(t){const{codec:e}=g,{queue:s,putCache:a,clearCache:o}=this,{vertices:n,slices:i,resolution:r}=this;a("vertices",n);let l=0;var h=i.map(e=>s("topo4_slice",{resolution:r,slice:e}).then(e=>(t(++l/i.length),e))),c=e.decode(await Promise.all(h)).map(e=>e.recs).flat().map(e=>T(e.z).addTops(e.polys).setFields({shared:e.shared})).sort((e,t)=>e.z-t.z);return o(),c}async lathe(e){return 1<g.minions.running?this.latheMinions(e):this.latheWorker(e)}lathePath(e,a){var{resolution:o,step:t,zBottom:n,maxo:s}=this,i=a.length,r=e.length,l=Math.max(1,Math.ceil(t/o)),h;const c=[],p=[];for(h of e){var m=h.lines,u=m.length;const F={z:h.z,lines:[]};for(let e=0;e<u;){++e;var d=m[e++],f=m[e++];++e;var g=m[e++],v=m[e++];d<-s&&g<-s||s<d&&s<g||F.lines.push(0,d,f,0,g,v)}p.push(F)}let x=0;for(let s=0;s<r;s+=l){var w=p[s].z;let t=-1/0;for(let e=0;e<i;){var y=a[e++],z=a[e++]*o,M=a[e++],A=s+y;if(!(A<0||r-1<=A)){var P,E=p[A].lines,k=E.length;for(let e=0;e<k;){++e;var C=E[e++],L=E[e++];++e;var b=E[e++],T=E[e++];if(C<=z&&z<=b||b<=z&&z<=C){var B=T-L,R=Math.abs(b-C),q;if(0!==R){const x=L+B*(Math.abs(z-C)/R)+M;t=Math.max(t,x)}}}t}}(t===-1/0||n&&t<n)&&(t=n),c.push(w,0,x=t)}return c}async latheWorker(e){const{sliced:t,tool:s,zoff:a,leave:o}=this;var n=this.angle*F,i=2*Math.PI/n,r=new THREE.Vector3(1,0,0),l=(new THREE.Matrix4).makeRotationAxis(r,n),h,c;const p=t.map(e=>({z:e.z,lines:e.shared})),m=[],u=[];let d=0,f=0;for(;f++<i;){var g=this.lathePath(p,s,m),v;u.push({angle:d,heights:g,degrees:d*q}),d-=n;for(v of p.map(e=>e.lines))M(v,l);e(f/i)}for(f=u[0].heights.length/3;0<f--;){let e=T(f);e.camLines=[R().setOpen()],m.push(e)}for(h of u){const{degrees:x,heights:w}=h;[...w].group(3).forEach((e,t)=>{m[t].camLines[0].push(B(e[0],e[1],e[2]+o).setA(x+-360*t))})}for(c of m){const y=c.camLines[0];if(y.length){const z=y.points[0];c.camLines[0].push(z.clone().setA(z.a-360)),c.output().setLayer("lathe",{line:this.lineColor}).addPoly(y.clone().applyRotations().move({z:-a,x:0,y:0}))}else console.log("empty",c)}return m}async latheMinions(s){const{sliced:e,tool:t,zoff:a,leave:o,maxo:n,zBottom:i,step:r,resolution:l,linear:h}=this,{putCache:c,clearCache:p,queue:m}=this;var u=this.angle*F;const d=2*Math.PI/u;var f=e.map(e=>({z:e.z,lines:e.shared})),g;const v=[],x=[];c("lathe",{maxo:n,tool:t,step:r,slices:f,zBottom:i,resolution:l});let w=0,y=0,z=0,M=[];for(;z++<d;){const E=y;var A=new Promise(t=>{m("topo4_lathe",{angle:E}).then(e=>{x.push({angle:E,heights:e.heights,degrees:E*q}),s(++w/d),t()})});M.push(A),y-=u}for(await Promise.all(M),x.sort((e,t)=>t.angle-e.angle),z=h?x.length:x[0].heights.length/3;0<z--;){let e=T(z);e.camLines=[R().setOpen()],v.push(e)}if(h)x.forEach((e,t)=>{const{degrees:s,heights:a}=e;[...a].group(3).forEach(e=>{v[t].camLines[0].push(B(e[0],e[1],e[2]+o).setA(s))}),t%2==1&&v[t].camLines[0].reverse()});else for(var P of x){const{degrees:k,heights:C}=P;[...C].group(3).forEach((e,t)=>{v[t].camLines[0].push(B(e[0],e[1],e[2]+o).setA(k+-360*t))})}for(g of v){const L=g.camLines[0];if(L.length){if(!h){const b=L.points[0];g.camLines[0].push(b.clone().setA(b.a-360))}g.output().setLayer("lathe",{line:this.lineColor}).addPoly(L.clone().applyRotations().move({z:-a,x:0,y:0}))}else console.log("empty",g)}return p(),v}putCache(e,t){g.worker.putCache({key:e,data:t},{done:e=>{}})}clearCache(){g.worker.clearCache({},{done:e=>{}})}queue(t,s){return new Promise(e=>{g.minions.queue({cmd:t,...s},e)})}}function M(e,t){new THREE.BufferAttribute(e,3).applyMatrix4(t)}b.Topo4=function(e){return(new u).generate(e)},a.broker.subscribe("minion.started",e=>{const{funcs:t,cache:c,reply:p,log:s}=e,{codec:h}=g;t.topo4_slice=(e,t)=>{var{slice:s,resolution:a}=e,o=c.vertices,n=new g.topo_slicer(s.index).setFromArray(o,s).slice(a).map(e=>{const{z:t,index:s,lines:a}=e;for(var o of a){const{p1:r,p2:l}=o;r.swapped||(r.swapXZ(),r.swapped=!0),l.swapped||(l.swapXZ(),l.swapped=!0)}var n=h.encodePointArray(a.map(e=>[e.p1,e.p2]).flat());const i=new Float32Array(new SharedArrayBuffer(4*n.length));return i.set(n),{z:t,index:s,shared:i,polys:h.encode(m(a))}});p({seq:t,recs:n})},t.topo4_lathe=(e,t)=>{var{angle:s}=e;const{slices:a,tool:o}=c.lathe;var n=new THREE.Vector3(1,0,0);const i=(new THREE.Matrix4).makeRotationAxis(n,-s);var r=a.map(e=>{var t=e.lines.slice();return M(t,i),{z:e.z,lines:t}});const l=Object.assign(new u,c.lathe);var h=l.lathePath(r,o);p({seq:t,heights:h})}})});"use strict";gapp.register("kiri-mode.laser.driver",[],(e,t)=>{const{base:pe,kiri:fe}=e,{driver:o,newSlice:d}=fe,{polygons:n,newPoint:ue}=pe,x=n;var r={LASER:0,DRAG:1,WJET:2,WEDM:3};function i(o,e,t){e.event.on("settings.saved",e=>{var t=o.api.ui})}function s(e,t){console.log("label",t)}function ce(l,a,o,e={}){let t=l.settings.process,{ctOutMark:p,ctOutStack:n,ctOutGroup:r,ctOutShaper:i,outputLaserLabel:s}=t,f=p||r,u=!1,c=e.simple||!1,h={in:[],out:[],mark:[]},d=e.lastEmit,x=l.settings.process.ctOutZColor;function v(t,o,n,r){if(t)if(Array.isArray(t))t.forEach((e,t)=>{v(e,o,n,r?t:void 0)});else{let e=x?{extrude:a.z,rate:a.z}:{extrude:1,rate:1};var i;if("mark"===n&&(e.rate=.001,e.extrude=2),c&&(e.simple=!0),t.open&&(e.open=!0),h[n].push(t),l.PPP(t,o,e),p&&"out"===n&&d)for(var s of d.out)s.isInside(t)&&v(s,o,"mark")}}if(f){let e=[],t=a.offset;var y=t.map(e=>e.inner||[]).flat();e.thick=a.thick,v(y,e,"in",1<t.length),v(t,e,"out",1<t.length),o.push(e)}else for(var g of a.offset){let e=[];e.thick=a.thick,v([g],e,"in"),v(g.inner||[],e,"out"),o.push(e)}return h}function c(e,t,o,n,r){let i=o.angle;var s=5,l=o.angleDiff(n,!0);let a=Math.abs(Math.floor(l/5));var p=Math.sign(l),f=l%5/2;for(0==f?a++:r.push(e.projectOnSlope(o,t));0<a--;)r.push(e.projectOnSlope(pe.newSlopeFromAngle(i+f),t)),i+=5*p;r.push(e.projectOnSlope(n,t))}function he(e,t){e.setClockwise();let o=e.points.slice(),n=o[0],r=0;for(let e=1;e<o.length;e++){var i=o[e];(i.x<n.x||i.y>n.y)&&(n=i,r=e)}0<r&&(o=o.slice(r,o.length).appendAll(o.slice(0,r)));let s=o[0].clone().move({x:-t,y:0,z:0}),l=s.slopeTo(o[0]).toUnit(),a=[s,s=o[0].clone()],p;for(let e=1;e<o.length+1;e++){var f=o[e%o.length],u=s.slopeTo(f).toUnit();10<=l.angleDiff(u)&&s.distTo2D(f)>=t&&c(s,t,l,u,a),a.push(f),l=u,s=f}a.push(p=s.projectOnSlope(l,t)),a.push(p.clone().move({x:t,y:0,z:0})),e.open=!0,e.points=a}function l(e,t,o,n){var r=e.process;let l=r.ctSliceKerf||0,a=e.controller.dark?12303291:0;if(r.ctSliceHeight<0)return n("invalid slice height");let{ctSliceSingle:i,ctSliceHeight:s,ctSliceHeightMin:p,ctOmitInner:f}=r;var u=t.getBoundingBox(),c=t.getPoints();let h=[];pe.slice(c,{zMin:u.min.z,zMax:u.max.z,zGen(e){var{zMin:t,zMax:o,zIndexes:n}=e;if(i)h=[s];else if(s){for(let e=t+s/2;e<o;e+=s)h.push(e);h}else{for(let e=1;e<n.length;e++)h.push((n[e-1]+n[e])/2);if(p){let o;h=h.filter(e=>{let t=!0;return void 0!==o&&Math.abs(e-o)<p?t=!1:o=e,t})}}return h},onupdate(e){o(e)}}).then(e=>{t.slices=e.slices.map(e=>{var{z:t,lines:o,groups:n}=e;let r=x.nest(n);f&&r.forEach(e=>delete e.inner);let i=d(t).addTops(r);i.index=h.indexOf(t);var s=i.offset=l?x.offset(r,l,{z:i.z,miter:2/l}):r;return i.output().setLayer("object",{line:8947712}).addPolys(r),i.output().setLayer("cut",{line:a}).addPolys(s),i}).sort((e,t)=>t.z-e.z),n()})}async function a(e,t,r){let o=t.device,n=t.process,i=self.worker.print=fe.newPrint(t,e),s="WEDM"===self.worker.mode,l="DRAG"===self.worker.mode,a=i.output=[],p=0,f=0,u=0,{bedWidth:c,bedDepth:h}=o,{ctOutLayer:d,ctOutTileSpacing:x}=n,{ctOriginCenter:v,ctOriginBounds:y}=n,{ctOriginOffX:g,ctOriginOffY:m}=n,{ctOutStack:E,ctOutMerged:O,ctOutKnifeTip:w,ctOutShaper:S}=n,k=[],z=[],P=[];i.PPP=function(e,t,o){k.contains(t)||(k.push(t),P.push(z=[]),z.num=P.length),z.push({poly:e,group:t,options:o})};for(var D of e=e.filter(e=>!e.track.ignore&&!e.meta.disabled))p+=D.slices.length,u=Math.max(u,D.bounds.max.z);let $=[];for(var T of e)if(E)for(var b of T.slices){var C=[],M,A;let e=[];for(M of b.offset)M.inner&&e.push(...M.inner),e.push(M);for(A of e)i.PPP(A,C,{extrude:1,rate:1})}else if(O){let n=[];for(var L of T.slices){let t=[];L.offset.clone(!0).forEach(e=>e.flattenTo(t));for(var G of t){let o=!1;for(let t=0;t<n.length;t++){let e=n[t];G.isEquivalent(e)&&(o=!0,e.depth++)}o||(G.depth=1,n.push(G))}r(f++/p*.5,"prepare")}var I=[],N;for(N of n)l&&he(N,w),i.PPP(N,I,{extrude:N.depth,rate:10*N.depth});$.push(I)}else{if(l)for(var j of T.slices)for(var B of j.offset)he(B,w),B.inner&&B.inner.forEach(e=>{he(e,w)});let e;for(var F of T.slices.reverse())e=ce(i,F,$,{simple:l,lastEmit:e}),r(f++/p*.5,"prepare")}var W=o.bedWidth/2,K=o.bedDepth/2,R=!d,Y=x,Z;for(Z of P){let t=pe.newBounds();Z.forEach(e=>t.merge(e.poly.bounds)),Z.w=t.width(),Z.h=t.height(),Z.bounds=t}var X=new fe.Pack(W,K,Y,{invy:s,simple:!R}).pack(P,e=>e.rescale(1.1,1.1)),H;if(!E)for(var U of P){var{fit:V,bounds:J}=U,q,Q;for({poly:q}of U)q.setZ(0),q.move({x:V.x-X.max.w/2-J.minx,y:V.y-X.max.h/2-J.miny,z:0},!0);U.bounds=pe.newBounds();for({poly:Q}of U)U.bounds.merge(Q.bounds)}let _=v?ue(0,0,0):y?ue(-X.max.w/2-(g||0),-X.max.h/2-(m||0),0):ue(-W,-K,0),ee=P.slice();for(;ee.length;){let e=E?{dist:0,tile:ee[0]}:{dist:1/0};for(var te of ee)for(var{poly:oe}of te)for(var ne of oe.points){var re=_.distTo2D(ne);re<e.dist&&(e.dist=re,e.tile=te)}if(!e.tile)throw"no closest found";for(var{poly:ie,group:se,options:le}of e.tile)_=i.polyPrintPath(ie,_,se,le),a.contains(se)||a.push(se);ee.remove(e.tile)}for(H of a)for(var ae of H)ae.point=ae.point.clone();return fe.render.path(a,(e,t)=>{if(S)for(var o of a)for(var n of o)n.point.zi=u-n.point.z;r(.5+.5*e,"render",t)},{thin:!0,z:E?void 0:0,action:"cut",moves:n.knifeOn})}function p(e,t,o){o(e.output)}function m(e,i,t,s,o,l,a){let{process:n,device:r}=e,{bedWidth:p,bedDepth:f}=r,{ctOriginCenter:u,ctOriginBounds:c}=n,{outputInvertX:h,outputInvertY:d}=n,{ctOriginOffX:x,ctOriginOffY:v}=n,{ctOutPower:y,ctOutSpeed:g,maxZ:m}=n,E,O,w=[],S=c?{x:x||0,y:v||0}:{x:0,y:0},k={x:0,y:0},z={x:0,y:0},P={w:0,h:0};i.forEach(e=>{e.forEach(e=>{O=e.point,h&&(O.x=-O.x),d&&(O.y=-O.y),k.x=Math.min(k.x,O.x),z.x=Math.max(z.x,O.x),k.y=Math.min(k.y,O.y),z.y=Math.max(z.y,O.y)})}),P.w=z.x-k.x,P.h=z.y-k.y;let D=pe.newBounds();if(u){for(var $ of i)for(var T of $)O=T.point,O.x=O.x-k.x-P.w/2+S.x,O.y=O.y-k.y-P.h/2+S.y,D.update(O);z.x=z.x-k.x+S.x,z.y=z.y-k.y+S.y,k.x=0,k.y=0}else if(c){for(var b of i)for(var C of b)O=C.point,O.x=O.x-k.x+S.x,O.y=O.y-k.y+S.y,D.update(O);z.x=z.x-k.x+S.x,z.y=z.y-k.y+S.y,k.x=0,k.y=0}else{var M=p,A=f,L;for(L of i)for(var G of L)O=G.point,O.x+=M/2+S.x,O.y+=A/2+S.y,D.update(O);z.x=M+S.x,z.y=A+S.y,k.x=0,k.y=0}t(k,z,y,g),i.forEach((e,o)=>{let n=0,r=0;e.forEach((e,t)=>{n=e.thick,O=e.point,a&&a(o,O.z,e.thick,i.length),e.emit?(r=e.emit,E&&0===w.length&&w.push(l(E)),w.push(l(O))):0<w.length&&(s(w,r,n),w=[]),E=O}),0<w.length&&(s(w,r,n),w=[])}),o()}function f(e,t){let s=[],l=0,a=0,i=0,p,f=e.device;var o=e.process;let u=f.gcodeSpace?" ":"",c=f.laserMaxPower||255,h=c,d=f.gcodeLaserOn||f.gcodeWaterOn||f.gcodeKnifeDn||[],x=f.gcodeLaserOff||f.gcodeWaterOff||f.gcodeKnifeUp||[],v=o.knifeOn,y=o.ctOutKnifeDepth,g=v?o.ctOutKnifePasses:1;return m(e,t,function(e,t,o,n){var r=t.x-e.x,i=t.y-e.y;l=e.x,a=e.y,p=u+"F"+n,h=(c*(o/100)).toFixed(3),(f.gcodePre||[]).forEach(e=>{s.push(e)})},function(e,n,r){v&&s.push(`; start new poly id=${e.id} len=`+e.length);for(let o=1;o<g+1;o++)e.forEach(function(e,t){0===t?(v&&s.appendAll(["; drag-knife lift",`G0${u}Z5`]),s.push("G0"+u+e),v&&s.appendAll(["; drag-knife down",`G0${u}Z`+-o*y])):1===t?(d.forEach(e=>{e=(e=(e=(e=e.replace("{power}",h)).replace("{color}",n)).replace("{thick}",r)).replace("{z}",i),s.push(e)}),s.push("G1"+u+e+p)):s.push("G1"+u+e)}),x.forEach(e=>{s.push(e)});v&&s.appendAll([`G0${u}Z5`])},function(){(f.gcodePost||[]).forEach(e=>{s.push(e)})},function(e){return i=e.z,`X${(e.x-l).toFixed(3)}${u}Y`+(e.y-a).toFixed(3)},function(e,t,o,n){}),s.join("\n")}function u(e,t,o){var{process:n}=e;let{ctOutInches:i,ctOutStack:s,ctOutShaper:l}=n,r="0.1mm",a=n.ctOutZColor?1:0,p=[],f=0,u=0,c,h=0,d=["black","purple","blue","red","orange","yellow","green","brown","gray"];return m(e,t,function(e,t){let o=t.x-e.x,n=t.y-e.y;f=e.x,u=e.y,c=t.y,p.push('<?xml version="1.0" standalone="no"?>'),p.push('<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">');let r=['<svg xmlns="http://www.w3.org/2000/svg"'];l&&r.push('xmlns:shaper="http://www.shapertools.com/namespaces/shaper"'),i?(o=(o/25.4).round(2),n=(n/25.4).round(2),r.push(`width="${o}in" height="${n}in" viewBox="0 0 ${o} ${n}"`)):r.push(`width="${o}mm" height="${n}mm" viewBox="0 0 ${o} ${n}"`),p.push(r.join(" ")+' version="1.1">')},function(o,e,t){var n=a||d[(e-1)%d.length];if(s){let e=["path"];void 0!==h&&l?(i?e.push(`shaper:cutDepth="${(h/25.4).toFixed(2)}in"`):e.push(`shaper:cutDepth="${h.toFixed(2)}mm"`),e.push('shaper:cutType="online"')):void 0!==h&&e.push(`z="${h}"`);let t=o.map((e,t)=>0<t?"L"+e:"M"+e);var r=l?"":`fill="none" stroke="${n}" stroke-width="0.1mm" `;p.push(`<${e.join(" ")} d="${t.join(" ")}" ${r}/>`)}else{let e=["polyline"];void 0!==h&&e.push(`z="${h}"`),void 0!==t&&e.push(`h="${t}"`),p.push(`<${e.join(" ")} points="${o.join(" ")}" fill="none" stroke="${n}" stroke-width="0.1mm" />`)}},function(){p.push("</svg>")},function(e){h=s?e.zi??e.z:void 0;let t=e.x-f,o=c-e.y-u;return i&&(t/=25.4,o/=25.4),pe.util.round(t,3)+","+pe.util.round(o,3)},function(e,t,o,n){a&&(a=Math.round((e+1)/n*16777215).toString(16),a="#"+a.padStart(6,0))}),p.join("\n")}function h(e,t){let o=[];return m(e,t,function(e,t){o.appendAll(["  0","SECTION","  2","HEADER","  0","ENDSEC","  0","SECTION","  2","TABLES","  0","ENDSEC","  0","SECTION","  2","BLOCKS","  0","ENDSEC","  0","SECTION","  2","ENTITIES"])},function(e){o.appendAll(["  0","POLYLINE","  8","0","  66","1","  70","1"]),e.forEach(e=>{o.appendAll(["  0","VERTEX","  8","0"," 10",e.x," 20",e.y])}),o.appendAll(["  0","SEQEND"])},function(){o.appendAll(["  0","ENDSEC","  0","SECTION","  2","OBJECTS","  0","ENDSEC","  0","EOF"])},function(e){return{x:e.x,y:e.y}}),o.join("\n")}o.LASER={TYPE:r,type:r.LASER,name:"Laser",init:i,slice:l,prepare:a,export:p,exportGCode:f,exportSVG:u,exportDXF:h}});"use strict";gapp.register("kiri-mode.drag.driver",[],(r,e)=>{const i=r.kiri.driver;var{LASER:a}=i,{TYPE:s}=a;i.DRAG=Object.assign({},a,{name:"DragKnife",type:s.DRAG})});"use strict";gapp.register("kiri-mode.fdm.driver",[],(e,r)=>{const{base:t,kiri:i}=e,{driver:n}=i,{util:o}=t,a=n.FDM={getRangeParameters:s,extrudePerMM:c,extrudeMM:u};function s(e,r){if(null==r||r<0)return e;var t=e.ranges,n;if(!t||!t.length)return e;let o=Object.clone(e);for(n of t)if(r>=n.lo&&r<=n.hi)for(var[s,i]of Object.entries(n.fields))o[s]=i,o._range=!0;return o}function c(e,r,t){return Math.PI*o.sqr(e/2)/(Math.PI*o.sqr(r/2))*(t/e)}function u(e,r,t){return e*r*t}i.load(o=>{const{client:r,worker:s}=i;r&&(a.support_generate=function(t){r.clear(),r.sync();var e=o.conf.get();const n=o.widgets.map();r.send("fdm_support_generate",{settings:e},e=>{if(e&&e.error)return o.show.alert("support generation canceled"),t([]);for(var r of e)r.widget=n[r.id];t(e)})}),s&&(s.fdm_support_generate=function(e,r){const{settings:t}=e,n=Object.values(s.cache),o=n.filter(e=>a.supports(t,e));r.done(i.codec.encode(o.map(e=>({id:e.id,supports:e.supports}))))})})});"use strict";gapp.register("kiri.utils",[],(t,n)=>{function e(n){let e={},t,r;return n.replace(/&/g,",").split(",").forEach(function(n){t=decodeURIComponent(n).split(":"),2===t.length&&(r=e[t[0]]=e[t[0]]||[],r.push(decodeURIComponent(t[1])))}),e}function r(t){let r=[];return Object.keys(t).forEach(n=>{var e;"ver"!==n&&(e=t[n],r.push(encodeURIComponent(n)+":"+encodeURIComponent(e)))}),r.length?"?"+r.join(","):""}function o(n,e,t,r,o){return moto.ajax.new(e,t).request(n,r,o)}function u(n,e){return n?JSON.stringify(n):e||null}function c(e,t){try{return e?JSON.parse(e):t||null}catch(n){return console.log({malformed_json:e}),t||null}}function i(n,e){return c(t.data.local.getItem(n),e)}function a(n){return[n>>16&255,n>>8&255,255&n]}function f(n){return n[0]<<16|n[1]<<8|n[0]}function l(n,e,t=3){var r=a(n),o=a(e),u=t+2;return(r[0]*t+o[0])/u<<16|(r[1]*t+o[1])/u<<8|(r[2]*t+o[2])/u}function s(e,t){if(e==t)return!0;if(Array.isArray(e)&&Array.isArray(t)){if(e.length===t.length){for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}}else if("object"==typeof e&&"object"==typeof t){var n,r;for(r of Object.keys(Object.assign({},e,t)))if(e[r]!==t[r])return!1;return!0}return!1}function p(n,e){return function(){console.log(e,...arguments),n(...arguments)}}n({trackFn:p,areEqual:s,parseOpt:e,encodeOpt:r,ajax:o,o2js:u,js2o:c,ls2o:i,avgc:l,rgb:a,a2c:f})});"use strict";gapp.register("kiri-mode.fdm.export",[],(e,t)=>{const{base:r,kiri:or}=e,{util:ar,config:dr}=r,{FDM:sr}=or.driver;var{getRangeParameters:n}=sr;const i=!1;sr.export=function(i,t,e,r){var{widgets:n,settings:o,belty:a,tools:d,firstTool:s}=i;const{bounds:u,controller:p,device:f,process:l,filter:c,mode:x}=o,{extruders:h,fwRetract:m}=f;var{bedWidth:y,bedDepth:g,bedRound:M,bedBelt:z,maxHeight:b}=f,{gcodeFan:v,gcodeLayer:_,gcodeTrack:E,gcodePause:S,gcodeFeature:T,gcodeChange:F}=f,O;let w=[];for(O of n)w.push(O.track.grid_id);let P=i.output,L=f.extras||{},R=L.bbl,{extrudeAbs:$}=f,{exportThumb:k}=p,G=Object.keys(i.extruders).map(e=>parseInt(e)),D=1.5*(f.gcodeTime||1),B=dr.gcode_decimals||4,I=f.deviceZMax||0,j=z,A=j?"belt":"fixed",N=0,H=0,X=0,Y=[],Z=[],C=0,V=0,q=0,J=0,W=0,K=0,U={X:" X",Y:" Y",Z:" Z",E:" E"},Q={x:0,y:0,z:0,f:0},ee={x:0,y:0,z:0},te=null,re=0,ne=0,ie=0,oe=(l.firstLayerYOffset||0)-(a||0),ae=l.outputLoops||0,de=l.zHopDistance||0,se=l.sliceLineWidth||0,ue=60*l.outputSeekrate,pe=l.outputRetractDist||0,fe=60*l.outputRetractSpeed||1,le=l.outputRetractDwell||0,ce=le/1e3,xe=!j&&l.arcTolerance||0,he=1,me=20,ye=.5,ge=40,Me=f.originCenter||M,ze=Me?{x:0,y:0,z:0}:{x:y/2,y:j?0:g/2,z:0},be=s||0,ve=h[be],_e=ve.extOffsetX,Ee=ve.extOffsetY,Se=!1,Te=l.firstLayerNozzleTemp||l.outputTemp,Fe=l.firstLayerBedTemp||l.outputBedTemp,Oe=void 0,we=0,Pe=0,Le=void 0,Re=Te,$e=Fe,ke=Pe,Ge={minx:u.min.x+ze.x,maxx:u.max.x+ze.x,miny:u.min.y+ze.y,maxy:u.max.y+ze.y,travel_speed:ue,retract_speed:fe,retract_distance:pe,temp:Te,temp_bed:Fe,bed_temp:Fe,fan_speed_base:we,fan_speed:Pe,speed:Pe,top:ze.y?g:g/2,left:ze.x?0:-y/2,right:ze.x?y:y/2,bottom:ze.y?0:-g/2,z_max:b,layers:P.length,progress:0,nozzle:be,tool:be,model_labels:w.sort().join(",")},De,Be,Ie,je,Ae,Ne,He,Xe,Ye,Ze=0,Ce=0,Ve=Math.cos(Math.PI/4),qe=1/Ve,Je=0,We=[],Ke={x:1/0,y:1/0,z:1/0},Ue=[],Qe=sr.extrudeMM,et=sr.extrudePerMM;var tt=Object.keys(d),rt;for(rt of tt)Ge["tool_used_"+rt]=!0;function nt(e){let t=new Uint8Array(8);var r=Math.floor(e/8),n;return t[r]|=1<<e%8,btoa(String.fromCharCode(...t))}function it(e){0<e?(Oe=0<=Oe?Oe:Pe,Pe=e,Ge.fan_speed=Pe,Ge.fan_speed_base=e):(Pe=0<=Oe?Oe:Pe,Oe=void 0,Ge.fan_speed=Pe,Ge.fan_speed_base=we)}function ot(e,t){de=t.zHopDistance||0,pe=t.outputRetractDist||0,fe=60*t.outputRetractSpeed||1,le=t.outputRetractDwell||0,ce=le/1e3,Te=0===e?t.firstLayerNozzleTemp||t.outputTemp:t.outputTemp||t.firstLayerNozzleTemp,Fe=0===e?t.firstLayerBedTemp||t.outputBedTemp:t.outputBedTemp||t.firstLayerBedTemp,we=t.firstLayerFanSpeed||0,Pe=e>=(t.outputFanLayer??1)?t.outputFanSpeed||0:we,Object.assign(Ge,{temp_bed:Fe,bed_temp:Fe,fan_speed:Pe,fan_speed_base:we,speed:Pe,retract_speed:fe,retract_distance:pe,temp:t.outputTemp,temp_bed:t.outputBedTemp,bed_temp:t.outputBedTemp})}Ge.tool_count=tt.length;let at=[];if(0<ae?at.push({start:P[0].slice.index,end:1/0,iter:ae-1}):ae<0&&at.push({start:P[0].slice.index,end:1/0,iter:0}),l.ranges)for(var dt of l.ranges)dt.fields.outputLoops&&at.push({start:dt.lo,end:dt.hi,iter:dt.fields.outputLoops-1});var st=j&&at.length?at:void 0,ut,pt;function ft(e){e&&(Ze++,Ce+=e.length,Z.append(e)),(!e||1e3<Z.length)&&(t(Z.join("\n")),Z=[])}function lt(e,t){ht(e,!0)}let ct=!0,xt=!1;function ht(e,t){var r,n;0===e.indexOf(";; DEFINE ")||(0===e.indexOf(";; IF ")?(e=e.substring(6).trim(),r=i.constReplace(e,Ge,0,666),ct=r,xt=ct):0===e.indexOf(";; ELIF ")?(e=e.substring(6).trim(),n=i.constReplace(e,Ge,0,666),ct=!ct&&n,xt=xt||ct):0===e.indexOf(";; ELSE")?ct=!xt&&!ct:0===e.indexOf(";; END")?(ct=!0,xt=!1):ct&&ft(i.constReplace(e,Ge,0,t)))}function mt(e){e&&(e=!Array.isArray(e)?[e]:e).forEach(function(e){ft(e)})}function yt(e,t){e&&0!==e.length&&(e=!Array.isArray(e)?[e]:e).forEach(function(e){ht(e,t)})}function gt(){let e=[...arguments].map(e=>"object"==typeof e?JSON.stringify(e):e);ft(e.join(""))}function Mt(){if(ft("; Generated by Kiri:Moto "+or.version),ft("; "+(new Date).toString()),ht("; Bed left:{left} right:{right} top:{top} bottom:{bottom}"),ft("; Bed type: "+A),ft("; Target: "+c[x]),k&&worker.snap){let{width:e,height:t,url:r}=worker.snap,n=r.substring(r.indexOf(",")+1);ft(`; thumbnail begin ${e} ${t} `+n.length);for(let e=0;e<n.length;e+=78)ft("; "+n.substring(e,e+78));ft("; thumbnail end")}for(var e in ft("; --- process ---"),l)gt("; ",e," = ",l[e]);ft("; --- startup ---")}let zt=0,bt=[];for(ut of f.gcodePre)if(ut=ut.trim(),0===ut.indexOf(";; PREAMBLE"))";; PREAMBLE OFF"===ut?zt=1:";; PREAMBLE END"===ut?zt=2:bt.push(zt=123);else if(0===ut.indexOf(";; AXISMAP ")){var vt=JSON.parse(ut.substring(11).trim()),_t;for(_t in vt)U[_t]=" "+vt[_t]}else bt.push(ut);0===zt&&Mt();let Et=!1,St=!1;for(pt of bt)pt!==zt?(0===pt.indexOf("T0")?Et=!0:0===pt.indexOf("T1")?St=!0:0===pt.indexOf("M82")?($=!0,Se=!0):0===pt.indexOf("M83")?($=!1,Se=!0):0!==pt.indexOf("G90")||Se?0!==pt.indexOf("G91")||Se?0===pt.indexOf("G92")&&pt.split(";")[0].split(" ").forEach(function(e){var t=parseFloat(e.substring(1)||0)||0;switch(e[0]){case"X":Q.x=t;break;case"Y":Q.y=t;break;case"Z":Q.z=t;break;case"E":C=t}}):$=!1:$=!0,0<pt.indexOf("E")&&pt.split(";")[0].split(" ").forEach(function(e){"E"==e[0]&&($?(C=Math.max(C,parseFloat(e.substring(1))||0),W=C):W+=parseFloat(e.substring(1)||0))}),lt(pt)):Mt();function Tt(e){for(N+=e/1e3;0<e;){var t=Math.min(4e3,e);ft("G4 P"+t),(e-=t)&&ft("G1")}}function Ft(e){K||(K=pe,m?ft("G10"):Bt({e:-K},fe,"e-retract "+pe),e&&Bt({z:re+e},ue,"z-hop start"),N+=pe/fe*60*2)}function Ot(){K&&(nr(),de&&Q.z!=re&&Bt({z:re},ue,"z-hop end"),m?ft("G11"):Bt({e:K},fe,"e-engage "+K),K=0,le&&Tt(le),N+=pe/fe*60*2)}2===zt&&Mt();var wt=new THREE.Vector3(1,0,0),Pt=new THREE.Vector2(0,0),Lt=-Math.PI/4,Rt,$t;let kt=Q;function Gt(e,t,r){kt=Object.clone(Q),Bt({x:e.x+ze.x,y:e.y+ze.y,z:e.z+ze.z},t,r)}function Dt(e,t){Bt(kt,e,t)}function Bt(e,t,r){let n=[t||e.e?"G1":"G0"],i={x:!1,y:!1,z:!1};"number"==typeof e.x&&e.x!==Q.x&&(Q.x=e.x,i.x=!0),"number"==typeof e.y&&e.y!==Q.y&&(Q.y=e.y,i.y=!0,j&&(i.z=!0)),"number"==typeof e.z&&e.z!==Q.z&&(Q.z=e.z,i.z=!0,j&&(i.y=!0));let o=j?{x:Q.x,y:Q.y,z:Q.z}:Q;var a,d;j&&(a=Be&&Be.height||0,o.x=Me?-Q.x:f.bedWidth-Q.x,o.z=ie=Q.z*qe,o.y=-Q.y+o.z*Ve+oe,ee=o),i.x&&n.append(U.X).append(o.x.toFixed(B)),i.y&&n.append(U.Y).append(o.y.toFixed(B)),i.z&&n.append(U.Z).append(o.z.toFixed(B)),"number"==typeof e.e&&(C+=e.e,$?n.append(U.E).append(C.toFixed(B)):n.append(U.E).append(e.e.toFixed(B))),(t=I&&i.z?60*Math.min(I,t):t)&&t!=Q.f&&(n.append(" F").append(Math.round(t)),Q.f=t),r&&n.append(" ; "+r),1!==n.length&&(d=n.join(""),te!=d&&(te=d,Ge.pos_x=o.x.round(B),Ge.pos_y=o.y.round(B),Ge.pos_z=o.z.round(B),ft(d)))}let It=[],jt=0;for(P.forEach(function(e){It.appendAll(e)}),It.forEachPair(function(e,t){jt+=e.point.distTo2D(t.point)},1),Ft();H<P.length;){Be=P[H],X=Be.slice.index,0<=Be.layer&&ot(Be.layer,Be.params),Ne=et(se||ve.extNozzle,ve.extFilament,0===Be.layer?l.firstSliceHeight||l.sliceHeight:Be.height),re=Be.z||re,ne=Math.max(ne,Q.z*qe),Ge.z=Ge.Z=re.round(3),Ge.e=Ge.E=C,Ge.layer=H,Ge.height=Be.height,j&&(Q.z=re),S&&0<=Y.indexOf(H)&&yt(S);let e=0;if(st)for(var At of st)X!==At.start||At.started||(At.started=!0,ft("M808 L"+At.iter),$?ft(`G92 Z${ee.z.round(B)} E`+C.round(B)):ft("G92 Z"+ee.z.round(B)),Je++),X!==At.end||At.ended||(At.ended=!0,e++,Je--);_&&_.length?yt(_):ft(`;; --- layer ${H} (${Ge.height.toFixed(3)} @ ${Ge.z.round(3)}) ---`),Pe!==ke&&(yt(v),ke=Pe),Fe!==$e&&(ft(`M140 S${Fe} T0`),$e=Fe),Te!==Re&&(Et&&ft(`M104 S${Te} T0`),St&&ft(`M104 S${Te} T1`),Et||St||ft(`M104 S${Te} T`+be),Re=Te),(0<H||!j)&&Bt({z:re},ue);let t;for(De=0;De<Be.length;De++){if(je=60*((Ie=Be[De]).speed||l.outputFeedrate),Ie.widget!==t&&(t&&(ft("; end object id: "+t.track.grid_id),R&&ft("M625")),Ie.widget&&($t=nt(w.indexOf(Ie.widget.track.grid_id)),ft("; start object id: "+Ie.widget.track.grid_id),R&&ft("M624 "+$t)),t=Ie.widget),te&&Ie.type!==te.type&&(Le=Ge.feature=Ie.type,T&&T.length?yt(T):ft("; feature "+Ie.type)),void 0!==Ie.tool&&Ie.tool!=be&&(Ue.push({emitted:W,tool:be}),Ge.last_tool=be,be=Ie.tool,Ge.nozzle=Ge.tool=be,ve=h[be],_e=ve.extOffsetX,Ee=ve.extOffsetY,Ne=et(se||ve.extNozzle,ve.extFilament,0===Be.layer?l.firstSliceHeight||l.sliceHeight:Be.height),yt(F??["T{tool}"])),Ie.point){let e=Ie.point.x+_e,t=Ie.point.y+Ee,r=Ie.point.z;if(l.outputInvertX&&(e=-e),l.outputInvertY&&(t=-t),ze&&(e+=ze.x,t+=ze.y),Ye=He?He.distTo2D(Ie.point):0,Ie.emit&&K&&Ot(),j&&(it(Ie.fan),Pe!==ke&&(yt(v),ke=Pe)),He&&Ie.emit)if(xe){var Nt={e:Ie.emit,x:e,y:t,z:r,dist:Ye,emitPerMM:Ne,speedMMM:je},Ht;We.push(Nt);let n=!1,i=!1,o=!1;if(1<We.length&&(Ht=We.length,n=We[0].e!==Nt.e,i=We[0].emitPerMM!==Nt.emitPerMM,o=We[0].speedMMM!==Nt.speedMMM),2<We.length){var Xt=We.length,Yt=We[0],Zt=We[Math.floor(Xt/2)],Ct=We[Xt-1],Vt=We[Xt-2],qt=We[Xt-3];let e=ar.center2d(Yt,Zt,Ct,1);var Jt=ar.center2d(Ct,Vt,qt,1),Wt,Kt,Ut,Qt,er,tr;let t=0,r=!1;r=!Jt||(Wt=2*Math.asin(Ye/(2*Jt.r)),Math.abs(Wt)>2*Math.PI/20),e?([e.x,e.y,e.z,e.r].hasNaN()&&console.log({cc:e,e1:Yt,e2:Zt,e3:Ct}),3===We.length?(We.center=[e],We.xSum=e.x,We.ySum=e.y,We.rSum=e.r):(We.xSum=We.center.reduce(function(e,t){return e+t.x},0),We.ySum=We.center.reduce(function(e,t){return e+t.y},0),We.rSum=We.center.reduce(function(e,t){return e+t.r},0),Kt=e.x-We.xSum/We.center.length,Ut=e.y-We.ySum/We.center.length,t=Math.sqrt(Kt*Kt+Ut*Ut)),n||i||o||t*We.center.length/We.rSum>xe||Ye>e.r||40<e.r||r||!ir()?4===We.length?(rr(We.shift()),(Qt=ar.center2d(We[0],We[1],We[2],1))?(We.center=[Qt],er=2*Math.asin(We[1].dist/(2*Qt.r)),Math.abs(er)>2*Math.PI/20&&rr(We.shift())):rr(We.shift())):(tr=We.pop(),nr(),We.push(tr)):We.center.push(e)):nr()}}else Ae=Qe(Ye,Ne,Ie.emit),Bt({x:e,y:t,e:Ae},je),W+=Ae;else nr(),Bt({x:e,y:t},ue);Ie.retract&&(nr(),Ft(de)),Ye&&je&&(N+=Ye/je*60*D),J+=Ye,Ge.progress=q=Math.round(J/jt*100),E&&q!=V&&(yt(E),V=q),He=Ie.point,Xe=Ie.emit}else Tt(Ie.speed)}for(H++,t&&(ft("; end object id: "+t.track.grid_id),R&&ft("M625"),t=void 0);0<e--;)ft("M808");nr()}function rr(e){var{e:t,x:r,y:n,dist:i,emitPerMM:o,speedMMM:a}=e;Ae=Qe(i,o,t),Bt({x:r,y:n,e:Ae},a),W+=Ae}function nr(){if(xe){if(4<We.length){let e=new THREE.Vector2(We[1].x-We[0].x,We[1].y-We[0].y);var o=new THREE.Vector2(We.center[0].x-We[0].x,We.center[0].y-We[0].y),a=e.cross(o)<0?"G2":"G3",d=We[0];let t=We.peek();We.xSum=We.center.reduce(function(e,t){return e+t.x},0),We.ySum=We.center.reduce(function(e,t){return e+t.y},0),We.rSum=We.center.reduce(function(e,t){return e+t.r},0);var s=We.center.length;let r;var u=ar.thetaDiff(Math.atan2(d.y-We.ySum/s,d.x-We.xSum/s),Math.atan2(t.y-We.ySum/s,t.x-We.xSum/s),"G2"==a),p,f;Math.abs(u)<=3*Math.PI/4&&(r=ar.center2pr(d,t,We.rSum/s,"G3"==a)),r=r||{x:We.xSum/s,y:We.ySum/s,z:We[0].z,r:We.rSum/s},rr(d);let n=We.slice(1).map(e=>e.dist).reduce((e,t)=>e+t),i=d.e;i=d.emitPerMM*i*n,C+=i,W+=i,$&&(i=C),ft(a+` X${t.x.toFixed(B)} Y${t.y.toFixed(B)} I${(r.x-Q.x).toFixed(B)} J${(r.y-Q.y).toFixed(B)} E`+i.toFixed(B)+(Q.f!==d.speedMMM?" E"+d.speedMMM:"")+` ; merged=${s-1} len=${n.toFixed(B)} cp=${r.x.round(2)},`+r.y.round(2)),Q.x=t.x,Q.y=t.y,Q.z=t.z}else for(var e of We)rr(e);We.length=0,We.center=void 0}}function ir(){if(!(We.length<3)){let t=[];for(let e=0;e<We.length-2;e++){var a=ar.center2d(We[0],We[e+1],We[We.length-1],1);if(!a)return;t.push(a)}let e,r=t.reduce((e,t)=>e+t.x,0)/t.length,n=t.reduce((e,t)=>e+t.y,0)/t.length,i=t.reduce((e,t)=>e+t.z,0)/t.length,o=t.reduce((e,t)=>e+t.r,0)/t.length;for(var d of t){var s;if(Math.sqrt(Math.pow(d.x-r,2)+Math.pow(d.y-n,2))/o>xe)return}for(var u of We){var p=Math.sqrt(Math.pow(u.x-r,2)+Math.pow(u.y-n,2));if(Math.abs(p-o)>o*xe)return}for(let e=1;e<We.length;e++){var f=2*Math.asin(We[e].dist/(2*o));if(Math.abs(f)>2*Math.PI/20)return}for(let e=0;e<We.length-2;e++){var l=ar.center2d(We[e],We[e+1],We[e+2],1);if(!l||.5<Math.abs((l.r-o)/l.r))return}return 1}}Je&&ft("M808"),Ue.push({emitted:W,tool:be}),Ge.material=ar.round(W,2),Ge.time=ar.round(N,2),Ge.print_time=Ge.time,ft("; --- shutdown ---"),yt(f.gcodePost),ft(`; --- filament used: ${Ge.material} mm ---`),ft(`; --- print time: ${N.toFixed(0)}s ---`),ft(),i.distance=W,i.lines=Ze,i.bytes=Ce+Ze-1,i.time=N,i.labels=w}});"use strict";gapp.register("kiri-mode.fdm.fill",[],(i,e)=>{const{base:v,kiri:n}=i;var{util:t}=v;const y=Math.PI/180,m=n.fill={hex:o,grid:x,gyroid:a,triangle:d,linear:s,cubic:f},l=n.fill_fixed={hex:o,grid:x,triangle:d};function o(i){r(i,!0)}function r(i,e){var n=i.offset(),t=1/i.density()*i.lineWidth()*.5,m=(Math.cos(30*y)*t).round(7),l=(Math.sin(30*y)*t).round(7),o=i.bounds();let r=!0;var a=i.zIndex()%2==0,x=o.max.y+(t+2*l);let f,s;if(e||a)for(f=o.min.x;!(r&&f>o.max.x)&&(r||!(f>o.max.x+m+n));){for(s=o.min.y,i.newline();s<=x;)i.emit(f,s),s+=t,i.emit(f,s),r?f+=m:f-=m,s+=l,i.emit(f,s),s+=t,i.emit(f,s),r?f-=m:f+=m,s+=l;f+=n,r&&(f+=2*m),r=!r,i.newline()}else for(s=o.min.y+t;!(r&&s>o.max.y)&&(r||!(s>o.max.y+l));){for(f=o.min.x,i.newline();f<o.max.x;)i.emit(f,s),r?s+=l:s-=l,f+=m,i.emit(f,s),f+=n,i.emit(f,s),r?s-=l:s+=l,f+=m,i.emit(f,s),f+=n;s+=t,r&&(s+=2*l),r=!r,i.newline()}}function a(i){let t=i.bounds();var e=i.zHeight(),n=t.max.x-t.min.x,m=t.max.y-t.min.y,l=i.density();let o=1+15*(1-l);var r=n/o,a=m/o,x=1/o,f=v.gyroid.slice(i.zValue()*x,500*(1-l)),s;let y=[];if("lr"==f.dir)for(let n=0;n<=a;n++){for(let e=0;e<=r;e++)for(var d of f.polys){i.newline();var u=d.map(i=>({x:i.x*o+e*o+t.min.x,y:i.y*o+n*o+t.min.y,z:0}));y.push(v.newPolygon().setOpen(!0).addObj(u))}y=w(y)}else for(let n=0;n<=r;n++){for(let e=0;e<=a;e++)for(var h of f.polys){i.newline();var p=h.map(i=>({x:i.x*o+n*o+t.min.x,y:i.y*o+e*o+t.min.y,z:0}));y.push(v.newPolygon().setOpen(!0).addObj(p))}y=w(y)}for(s of y.filter(i=>2<i.perimeter())){i.newline();for(var c of s.points)i.emit(c.x,c.y)}}function w(e,l=.1){if(e.length<=1)return e;let i=0;i:for(;;i++){let m=e,i=m.length;for(let t=0;t<i;t++){let n=m[t];if(n&&n.open)for(let e=t+1;e<i;e++){let i=m[e];if(i&&i.open){if(n.last().distTo2D(i.first())<=l){n.addPoints(i.points),m[e]=null;continue i}if(n.first().distTo2D(i.last())<=l){i.addPoints(n.points),m[t]=null;continue i}if(n.first().distTo2D(i.first())<=l){n.reverse(),n.addPoints(i.points),m[e]=null;continue i}if(n.last().distTo2D(i.last())<=l){i.reverse(),n.addPoints(i.points),m[e]=null;continue i}}}}break}return e=0<i?e.filter(i=>i):e}function x(n){var t=n.bounds(),i=n.zHeight(),e=t.max.x-t.min.x,m=t.max.y-t.min.y,l=n.offset()/2,o=1/n.density()*n.lineWidth(),r=o+l,a=e/r,x=m/o;for(let e=0;e<=a;e++){n.newline();for(let i=0;i<=x;i++){var f=e*r+t.min.x,s=i*o+t.min.y;(e+i)%2?(n.emit(f,s),n.emit(f+r-l,s+o)):(n.emit(f+r-l,s),n.emit(f,s+o))}}}function f(e){var n=e.bounds(),i=Math.max(n.max.x-n.min.x,n.max.y-n.min.y),t,m=i/Math.floor(i/e.lineWidth()*e.density()),l=Math.floor(e.zIndex()/e.repeat())%3;if(1==l)for(let i=n.min.x;i<=n.max.x;i+=m)e.newline(),e.emit(i,n.min.y),e.emit(i,n.max.y);else if(0==l)for(let i=n.min.y;i<=n.max.y;i+=m)e.newline(),e.emit(n.min.x,i),e.emit(n.max.x,i);else{Math.sqrt(2);for(let i=n.min.x;i<=n.max.x;i+=m)e.newline(),e.emit(i,n.min.y),e.emit(i+1e3,n.max.y+1e3);for(let i=n.min.y;i<=n.max.y;i+=m)e.newline(),e.emit(n.min.x,i),e.emit(n.min.x+1e3,i+1e3)}}function s(e){var n=e.bounds(),i=Math.max(n.max.x-n.min.x,n.max.y-n.min.y),t,m=i/Math.floor(i/e.lineWidth()*e.density()),l=Math.floor(e.zIndex()/e.repeat())%2;if(1==l)for(let i=n.min.x;i<=n.max.x;i+=m)e.newline(),e.emit(i,n.min.y),e.emit(i,n.max.y);else if(0==l)for(let i=n.min.y;i<=n.max.y;i+=m)e.newline(),e.emit(n.min.x,i),e.emit(n.max.x,i)}function d(n){var t=n.bounds(),i=t.max.x-t.min.x,e=t.max.y-t.min.y,m=n.offset(),l=n.lineWidth()/2,o=1/n.density()*(1.25*n.lineWidth()),r=o+2*m+l,a=i/r,x=e/o;for(let e=0;e<=a;e++){n.newline();for(let i=0;i<=x;i++){var f=e*r+t.min.x,s=i*o+t.min.y;(e+i)%2?(n.emit(f,s),n.emit(f+r-m-l,s+o)):(n.emit(f+r-m-l,s),n.emit(f,s+o))}}for(let i=0;i<=a;i++){var y,d=i*r+t.min.x+r-l/2-m/2;n.newline(),n.emit(d,t.min.y),n.emit(d,t.max.y)}}});"use strict";gapp.register("kiri-mode.fdm.post",[],(e,t)=>{const{base:f,kiri:l}=e;var{driver:s}=l,{polygons:o}=f;const{fillArea:c}=o,{FDM:x}=s,G=o;function h(e){let{z:t,top:l,count:o,top_poly:s,offset1:f,offsetN:p,wasm:a,last:n,gaps:i}=e;return G.offset(s,[-f,-p],{z:t,wasm:a,count:o,outs:l.shells,flat:!0,call:(e,t)=>{for(var l of n=e)if(l.depth=o-t,l.fill_off&&l.fill_off.forEach(function(e){e.depth=-(o-t)}),l.inner)for(var s of l.inner)s.depth=l.depth}}),{last:n,gaps:i}}function u(e){let{z:t,top:l,count:s,top_poly:o,offsetN:f,last:p,gaps:a}=e;l.thin_fill=[],l.fill_sparse=[];let n=G.inset(o,f,s,t,!0);p=n.last().mid,l.shells=n.map(e=>e.mid).flat(),l.gaps=n.map(e=>e.gap).flat();var i=f,r=.75*i,c=4*i,h;for(h of n.map(e=>e.gap).flat()){var u=h.centers(i/2,t,r,c,{lines:!1});l.fill_sparse.appendAll(u)}return{last:p,gaps:a}}function d(e){let{z:s,top:o,count:t,top_poly:l,offset1:f,offsetN:p,last:a,gaps:n,wasm:i}=e;o.gaps=n,o.thin_fill=[];let r={z:s,count:t,gaps:[],outs:[],minArea:.05,wasm:i};return G.offset(l,[-f,-p],r),r.outs.forEach((e,l)=>{e.forEach(e=>{if(e.depth=l,e.fill_off&&e.fill_off.forEach(e=>e.depth=l),e.inner)for(var t of e.inner)t.depth=e.depth;o.shells.push(e)}),a=e}),r.gaps.forEach((e,t)=>{var l=0==t?f:p;e=G.offset(e,.8*-l,{z:s,minArea:0,wasm:i}),o.thin_fill.appendAll(y(c(e,45,l/2,[],.01,2*l),c(e,135,l/2,[],.01,2*l))),n.push(...e)}),{last:a,gaps:n}}function g(e){let{z:t,top:l,count:s,offsetN:o,last:f,gaps:p}=e;l.thin_fill=[],l.fill_sparse=[];var{noodle:a,remain:n}=l.poly.noodle(o);return l.shells=a,l.gaps=n,{last:f,gaps:p}}function y(){function e(l){let s=[];for(let e=0,t=l.length;e<t;e+=2)s.push({a:l[e],b:l[e+1],l:l[e].distTo2D(l[e+1])});return s}let t=[...arguments].filter(e=>e);if(!(t.length<1)){let o=e(t.shift());for(;t.length;){let s=e(t.shift());e:for(let e=0,t=o.length;e<t;e++){let l=o[e];if(!l.del)for(let t=0,e=s.length;t<e;t++){let e=s[t];e.del||f.util.intersect(l.a,l.b,e.a,e.b,f.key.SEGINT)&&(l.l<e.l?e.del=!0:l.del=!0)}}o=o.filter(e=>!e.del).concat(s.filter(e=>!e.del))}let l=[];for(let e=0,t=o.length;e<t;e++){var s=o[e];l.push(s.a),l.push(s.b)}return 2<l.length?l:[]}}f.slicePost.FDM=function(e,t){var{z:l,lines:s,groups:o}=e;const{useAssembly:f,post_args:p,zIndexes:a}=t,{process:n,isSynth:i,vaseMode:r}=p;var{shellOffset:c,fillOffset:h,clipOffset:u}=p;if(e.tops=G.nest(o),i){const n=p.process;return 0<n.sliceSupportGrow&&(e.tops=G.expand(e.tops,n.sliceSupportGrow,e.z,[])),void delete e.groups}var d=a.indexOf(l),g=x.getRangeParameters(n,d),y=g.sliceShells-(0|g.sliceShells),m,v,_,z,b;let w=0|g.sliceShells;y&&(m=.5<y?1-y:y,_=Math.round((1-m)/m)+1,w+=(.5<y?1:_-1)<=d%_?1:0);var N,S=n.sliceHeight,A=0===d&&n.firstLayerLineMult||1,E=i?1:w,T=c*A,M=h*A,k=i?void 0:n.sliceDetectThin,O;const D=[];for(O of e.tops)D.push(x.doTopShells(l,O,E,T/2,T,M,{thinType:k,vaseMode:r,useAssembly:f}));e.clip=u?G.offset(D.map(e=>e.simple),u):void 0,e.tops=D,delete e.groups},x.doTopShells=function(t,l,s,o,f,p,a={}){(l=!l.poly?{poly:l}:l).simple=l.poly.simple();var n=a.useAssembly,e;let i=[l.poly];a.vaseMode&&(l.poly=l.poly.clone(!1)),l.shells=[],l.fill_off=[],l.fill_lines=[];let r=[],c=[];if(s)if(0===o&&1===s)r=i.clone(!0),l.shells=r;else{i.forEach(e=>{var t;e.open&&e.first().distTo2D(e.last())<1&&(e.open=!1)});let e={last:r,gaps:c};switch(a.thinType){case"type 1":e=u({z:t,top:l,count:s,top_poly:i,offsetN:f,fillOffset:p});break;case"type 2":e=d({z:t,top:l,count:s,top_poly:i,offset1:o,offsetN:f,fillOffset:p,gaps:c,wasm:n});break;case"type 3":e=g({z:t,top:l,count:s,top_poly:i,offsetN:f}),p=0;break;default:e=h({z:t,top:l,count:s,top_poly:i,offset1:o,offsetN:f,wasm:n})}r=e.last||r,c=e.gaps||c}else r=[l.poly];return p&&0<r.length&&(c.length&&(e=[],G.subtract(r,c,e,null,t),r=e),r.forEach(function(e){G.offset([e],-p,{outs:l.fill_off,flat:!0,z:t})})),l.last=r,l}});"use strict";gapp.register("kiri.consts",(e,a)=>{var n,m,i,t,o,r;a({PMODES:{SPEED:1,TOOLS:2},COLOR:{wireframe:4473924,wireframe_opacity:.25,selected:[12320512,12316160,12311808,12294400],deselected:[16776960,16768256,16759552,16750848],model_opacity:1,preview_opacity:0,slicing:16755370,slicing_opacity:.5,sliced_opacity:0,cam_preview:8947848,cam_preview_opacity_dark:.2,cam_preview_opacity:.1,cam_sliced_opacity:.2},LISTS:{shell:[{name:"in-out"},{name:"out-in"},{name:"alternate"}],start:[{name:"last"},{name:"center"},{name:"origin"},{name:"random"}],infill:[{name:"none"},{name:"hex"},{name:"grid"},{name:"linear"},{name:"triangle"},{name:"gyroid"},{name:"vase"}],units:[{name:"mm"},{name:"in"}],antialias:[{name:"1",id:1},{name:"2",id:2},{name:"4",id:4},{name:"8",id:8}],detail:[{name:"100"},{name:"75"},{name:"50"},{name:"25"}],linetype:[{name:"path"},{name:"flat"},{name:"line"}],animesh:[{name:"100"},{name:"200"},{name:"300"},{name:"400"},{name:"500"},{name:"600"},{name:"700"},{name:"800"},{name:"900"},{name:"1000"},{name:"1500"},{name:"2000"},{name:"2500"},{name:"3000"},{name:"4000"}],select:[{name:"loops"},{name:"lines"}],trace:[{name:"follow"},{name:"clear"}],traceoff:[{name:"none"},{name:"inside"},{name:"outside"}],zanchor:[{name:"top"},{name:"middle"},{name:"bottom"}],xyaxis:[{name:"X"},{name:"Y"}],regaxis:[{name:"X"},{name:"Y"},{name:"-"}],regpoints:[{name:"2"},{name:"3"}],thin:[{name:"off"},{name:"type 1"},{name:"type 2"},{name:"type 3"}]},MODES:{FDM:1,LASER:2,CAM:3,SLA:4,DRAG:5,WJET:6,WEDM:7},VIEWS:{ARRANGE:1,SLICE:2,PREVIEW:3,ANIMATE:4},SEED:"kiri-seed",beltfact:Math.cos(Math.PI/4)})});"use strict";gapp.register("kiri-mode.fdm.prepare",[],(t,e)=>{const{base:ne,kiri:se}=t,{consts:r,driver:l,newSlice:ae,render:pe}=se,{polygons:o,paths:n,util:rt,newPoint:ue,newPolygon:de,Polygon:lt}=ne,{poly2polyEmit:fe,tip2tipEmit:ot}=n,{numOrDefault:nt}=rt,{fillArea:ce}=o;var{beltfact:s}=r;const{FDM:a}=l,{getRangeParameters:he}=a,xe=o;function ye(w,z,k,e,t,u={}){var{settings:r}=w,{device:l}=r,{bedWidth:o,bedDepth:n,bedRound:s}=l,a,p;let L=[],d=u.params||r.process,f=l.originCenter||s,R=parseInt(z.extruder||0),c=d.sliceLineWidth||l.extruders[R].extNozzle,h=!!u.first&&!u.support,E=c*(u.thinWall||1.75),B=u.retractOver||5*c,F=u.mult||d.outputFillMult,x=u.mult||d.outputShellMult||(0<=d.ctSliceHeight?1:0),y={"out-in":-1,"in-out":1,alternate:-2}[d.sliceShellOrder]||-1,m=d.outputSparseMult,g=d.outputCoastDist||0,v=u.speed||d.outputFinishrate,b=d.firstLayerRate,T=d.firstLayerFillRate,M=d.firstLayerPrintMult,P=u.speed||(h?b:d.outputFeedrate),_=u.speed||u.fillSpeed||(h?T||b:d.outputFeedrate),O=d.sliceFillRate||u.infillSpeed||_||P,A=d.outputSeekrate,S=k.add(e),W=d.zHopDistance||0,C=d.antiBacklash,D=d.outputRetractWipe||0,I=l.bedBelt,N=f?{x:0,y:0,z:0}:{x:o/2,y:I?0:n/2,z:0},Z=d.outputBeltFirst||!1,q=k.clone(),G=u.seedPoint||k,H=w.lastPoly&&w.lastPoly.perimeter()<d.outputShortPoly,j=z.z,X;function Y(){let i=L.length?L:t;if(i.length){let e=i.last();if(e.retract=!0,D&&X&&e.point){var r=X.center(!0),l=e.point.distTo2D(r),o=Math.min(D,l);let t=e.point.followTo(r,o);t.inPolygon(X)&&w.addOutput(i,t,null,null,e.tool)}}else u.pretract?u.pretract(D):console.log("unable to retract. no preout or output")}function J(i,r){if(z.index<0)return!1;let l=!1;return z.topPolysFlat().forEach(t=>{l||t.forEachSegment((t,e)=>{if(rt.intersect(i,r,t,e,ne.key.SEGINT))return l=!0})}),l&&u.routeAround?!K(i,r):l}function K(a,p){var t=!1,e;!1===z.index&&console.log(z.index,{p1:a,p2:p,d:a.distTo2D(p)});let u=[];for(let r of z.topRouteFlat())r.forEachSegment((t,e)=>{var i=rt.intersect(a,p,t,e,ne.key.SEGINT);i&&u.push({ip:i,poly:r})});if(0!==u.length)if(u.length&&u.length%2!=0)!1===z.index&&console.log(z.index,{odd_intersects:u});else{u.sort((t,e)=>t.ip.dist-e.ip.dist),!1===z.index&&console.log(z.index,{ints:u});for(let e=0;e<u.length;e+=2){let t=u[e];var i=u[e+1];if(t.poly!==i.poly)return void(!1===z.index&&console.log(z.index,{int_diff_poly:u,i:e}));t.ip.distTo2D(i.ip)<B&&(!1===z.index&&console.log(z.index,{int_dist_too_small:t.ip.distTo2D(i.ip),retractDist:B}),u[e]=void 0,u[e+1]=void 0)}if(u=u.filter(t=>t),2<u.length)!1===z.index&&console.log(z.index,{complex_route:u.length});else if(2===u.length){for(let t=0;t<u.length;t+=2){var d=u[0],f=u[1];w.addOutput(L,d.ip,0,A,R);let t=d.poly;var c=t.isClockwise();let e=t.points,i=c?e:e.slice().reverse(),r=c?e.slice().reverse():e;var h=i.indexOf(c?d.ip.p2:d.ip.p1),x=i.indexOf(c?f.ip.p1:f.ip.p2);let l=h===x?[i[h]]:h<x?[...i.slice(h,x+1)]:[...i.slice(h),...i.slice(0,x+1)],o=0;for(let t=1;t<l.length;t++)o+=l[t-1].distTo2D(l[t]);var y=r.indexOf(c?d.ip.p1:d.ip.p2),m=r.indexOf(c?f.ip.p2:f.ip.p1);let n=y===m?[r[y]]:y<m?[...r.slice(y,m+1)]:[...r.slice(y),...r.slice(0,m+1)],s=0;for(let t=1;t<n.length;t++)s+=n[t-1].distTo2D(n[t]);var g=o<=s?l:n,v;!1===z.index&&console.log(z.index,{ints:u.map(t=>t.ip.dist),i1:d,i2:f,same:d.poly===f.poly,route:g,p1:a,p2:p,dist:a.distTo2D(p),r1:l,r1d:o,r1s:h,r1e:x,r2:n,r2d:s,r2s:y,r2e:m,isCW:c});for(v of g)w.addOutput(L,v,0,A,R);w.addOutput(L,f.ip,0,A,R)}return 1}}else!1===z.index&&console.log(z.index,"no ints")}function Q(t,r={}){if(t)if(Array.isArray(t))if(r.sort){let e=t.slice().sort((t,e)=>(t.perimeter()-e.perimeter())*r.sort);var l=3<e.length;let i;for(;e.length;){let t;for(var o of e){if(!i){t=o;break}if(0<r.sort){if(i.isInside(o)){t=o;break}}else if(o.isInside(i)){t=o;break}}t?(i=t,e.remove(t),Q(t,r)):i=null}}else tt(t,function(t){Q(t,r)},null);else{var e=0===t.depth&&!h;k=w.polyPrintPath(t,k,L,{ccw:r.shell&&d.outputAlternating&&z.index%2,tool:R,rate:e?v:P,accel:e,wipe:d.outputWipeDistance||0,coast:h?0:g,extrude:nt(r.extrude,x),onfirst:function(t){let e=G||k;e.distTo2D(t)>B&&J(e,t)&&Y(),G=null}}),X=z.lastPoly=t}}function U(t,a,p){if(t){var e=t.map(t=>({poly:t,first:t.first(),last:t.last()}));let s=k;k=ot(e,k,(t,e,i)=>{let n=t.poly;return n.last()===e&&n.reverse(),n.forEachPoint((t,e)=>{var i=s.distTo2D(t),r,l=i>B&&J(s,t);let o=a;0===e&&(l?(Y(),o=0):i>c&&(o=0)),void 0!==n.z&&(t=t.clone().setZ(n.z)),w.addOutput(L,t,o,p||P,R),s=t},!n.open),s})}}function V(t){if(t){var e=t.group(2).map(t=>{var[e,i]=t;return ue((e.x+i.x)/2,(e.y+i.y)/2,(e.z+i.z)/2)}),i=rt.orderClosest(e,(t,e)=>t.distTo2D(e));if(0!==i.length){var r=e[0],l,o;let t=r;k&&k.distTo2D(r)>E&&J(k,r)&&Y(),w.addOutput(L,r,0,A,R);for(l of i){(t?t.distTo2D(l):0)>E&&(Y(),w.addOutput(L,l,0,A,R)),w.addOutput(L,l,1,_,R),k=t=l}t&&t.distTo2D(r)<=E&&(w.addOutput(L,r,1,_,R),k=r)}}}function $(b,T={}){if(b&&0!==b.length){let e,r,l,o,t,n,s,a,p,u,d=0,f=0,c=!1,h=-1,x=T.raft||!1,y=T.flow||1,m=T.near||!C,g=T.fast||!1,v=(0<=T.fill?T.fill:F)*y,z=E;for(;b&&d<b.length;){if(s=null,n=!1,a=1/0,m)for(let t=0;t<b.length;t+=2){var M,P,O,S;p=b[t],p.del||(u=b[t+1],M=p.distToSq2D(k),P=u.distToSq2D(k),O=k.index?Math.abs(k.index-p.index):1,(S=Math.min(M,P)*(1!==O?10:1))<a&&(P<M?(l=p,r=u):(r=p,l=u),a=S))}if(!m)for(let t=f;t<b.length;t+=2)if(!(e=b[t]).del&&(null===s&&e.index>h&&(s=e.index),null!==s)){if(e.index!==s)break;e.index%2==0?(p=b[t],u=b[t+1]):(u=b[t],p=b[t+1]),o=Math.min(p.distTo2D(k),u.distTo2D(k)),o<a&&(r=p,l=u,a=o),f=t,n=!0}if(m||n){var D;o=k.distToSq2D(r),t=r.distToSq2D(l),m||g||c||!(o>B)?(c=!1,D=h<0,r.del=!0,l.del=!0,d+=2,h=r.index,o<=z&&t<=z?l=r.midPointTo(l):(!g&&o>B&&(W||J(k,r))&&Y(),!g&&C&&o>B&&w.addOutput(L,r.add({x:C,y:-C,z:0}),0,A,R),o<z||x&&!D?w.addOutput(L,r,v,_,R):w.addOutput(L,r,0,A,R)),w.addOutput(L,l,v,_,R),k=l):(c=!0,f=0,h=-1)}else{if(0===f&&-1===h){console.log("infinite loop",b,{marked:d,i:i,group:s,start:f,lastIndex:h,points:b.map(t=>t.index).join(", ")});break}f=0,h=-1}}b&&b.forEach(t=>{t.del=!1})}}function tt(e,t,i){if(1===e.length)return t(e[0]);e=e.slice();let r,l,o,n,s,a=0;for(;;){n=[],r=null;for(let t=0;t<e.length;t++)(o=e[t])&&(s=i?i(o):o,l=s.findClosestPointTo(k),n.push({i:t,n:o,d:l.distance-s.depth*E}));if(0===n.length)return;H?(H=!1,n.sort((t,e)=>e.d-t.d)):n.sort((t,e)=>t.d-e.d),e[n[0].i]=null,t(n[0].n)}}1<Math.abs(y)&&z.index%2==1&&(y=-y),z.finishSolids&&(_=d.sliceSolidRate||v),h&&(F*=M,x*=M,m*=M);let et=[];z.tops&&et.appendAll(z.tops),u.support&&z.supports&&et.appendAll(z.supports);let it=null;tt(et,function(e){if(e instanceof lt)w.setType("support"),e.setZ(j),!1!==d.sliceSupportOutline&&Q([e].appendAll(e.inner||[])),e.fill&&(e.fill.forEach(t=>{t.z=j}),$(e.fill,{fast:!0,near:!0}));else{var i=e,t=i.isRaft;switch(w.setType("shells"),it&&it!==e&&Y(),d.sliceLayerStart){case"last":break;case"random":let t=i.poly.bounds;var r=t.center(),l=Math.max(t.width(),t.height()),o=Math.random()*Math.PI*2,n=r.x+Math.cos(o)*l,s=r.y+Math.sin(o)*l;k=ue(n,s,k.z);break;case"center":k=ue(0,0,k.z);break;case"origin":k=ue(-N.x,-N.y,k.z);break;case"position":k=ue(-N.x+d.sliceLayerStartX,-N.y+d.sliceLayerStartY,k.z)}I&&u.onBelt&&(k=q,Z&&(y=-1)),i.traces&&Q(i.traces);var a=e.innerShells()||[],p=e.shells||[];0<y&&Q(a,{sort:y,shell:!0}),Q(p,{sort:y,shell:!0}),y<0&&Q(a,{sort:y,shell:!0}),w.setType("thin fill"),V(e.thin_fill),w.setType("solid fill"),$(e.fill_lines,{flow:F,raft:t}),w.setType("sparse infill"),U(e.fill_sparse,m,O),it=e}},function(t){return t instanceof lt?t:t.poly}),z.tops&&z.tops.length&&z.tops[0].polish&&({x:a,y:p}=z.tops[0].polish,a&&U(a,0,d.polishSpeed),p&&U(p,0,d.polishSpeed));for(let t=0;t<L.length;t++)L[t].point=L[t].point.add(e);return w.addPrintPoints(L,t,S,R),k.add(e)}a.prepare=async function(i,t,l){i=i.filter(t=>!t.track.ignore&&!t.meta.disabled);let{device:u,process:m,controller:e,bounds:v}=t,{sliceHeight:r,firstSliceHeight:o,firstLayerRate:d}=m,{outputSeekrate:f,outputDraftShield:s,outputPurgeTower:g}=m,{bedWidth:a,bedDepth:p}=u,{lineType:n}=e,c=ue(0,0,0),z=self.worker.print=se.newPrint(t,i),b=m.sliceLineWidth||u.extruders[0].extNozzle,T=u.bedBelt,h="line"===n,x="flat"===n,y=m.outputRaft||!1,M=!T&&o||r,P=0,O=0,S=0,D=0,w,k=[],L=[];var R=null,E,B,F,_,A,W,C,I;if(!v){v=new THREE.Box3;for(var N of i){var Z=N.track.pos;let t=N.bounds.clone();t.min.x+=Z.x,t.max.x+=Z.x,t.min.y+=Z.y,t.max.y+=Z.y,v.union(t)}t.bounds=v}if(!T&&(m.outputBrimCount||y)){let o=[],n=m.outputBrimOffset||(y?4:0);if(i.filter(t=>t.slices.length).forEach(function(i){let e=[],t=[];s?t.appendAll(i.slices):t.push(i.slices[0]);for(var r of t)r.tops&&r.tops.forEach(function(t){e.push(t.poly.clone())}),r.supports&&r.supports.forEach(function(t){e.push(t.clone())});s&&(e=xe.union(e,1,!0)),xe.nest(e).forEach(function(t){let e=t.offset(-n+b/2);e&&e.forEach(function(t){t.move(i.track.pos),o.push(t)})})}),o=xe.union(o,void 0,!0),1<o.length&&n>=b&&(E=m.sliceSupportExtra+2,B=o[0].getZ(),o=xe.expand(o,E,B,null,1),o=xe.expand(o,-E,B,null,1)),y){let a=ue(0,0,0),t=b,e=m.sliceFillAngle,i=d/3,r=m.outputFeedrate,p=m.outputBrimCount?xe.expand(o,4*b,0,null,1):o;function q(t,e,i,r,l,o){let n=ae(S+t/2);for(var s of p){null===c&&(c=s.first());let t=n.addTop(s);o&&(t.traces=[s]),t.inner=xe.expand([s],-.8*b,0,null,1),t.fill_lines=ce(t.inner,e,i,[]),t.isRaft=!0}a.z=n.z,c=ye(z,n,c,a,L,{speed:r,mult:l}),L.z=S+t,L.height=t,k.append(L),L=[],S+=t,O=t/2}c=null,q(1.5*b,e+0,6*b,i,2.5,!0),q(.5*b,e+90,2*b,r,1.5,!0),q(.5*b,e+0,+b,r,1),q(.5*b,e+90,.75*b,r,.75),M+=m.outputRaftSpacing||0,S+=m.outputRaftSpacing||0,k.last().last().retract=!0}if(m.outputBrimCount){let t=[],l=[];xe.offset(o,b,{outs:t,flat:!0,count:m.outputBrimCount,z:M/2+S-O}),z.setType("brim"),w=xe.nest(t.clone(),!0).clone();var G=n<2*b?ue(-a,-p,0):c;c=fe(t,G,(t,e,i,r)=>z.polyPrintPath(t,r,l,{rate:d,onfirst:function(t){l.length&&2<t.distTo2D(r)&&(l.last().retract=!0)}})),z.addPrintPoints(l,L,null),l.length&&(l.last().retract=!0)}let e=ne.newBounds();o.forEach(t=>{e.merge(t.bounds)}),v.min.x=Math.min(v.min.x,e.minx),v.min.y=Math.min(v.min.y,e.miny),v.max.x=Math.max(v.max.x,e.maxx),v.max.y=Math.max(v.max.y,e.maxy)}for(F of i.slice()){let e=[];if(F.slices){for(var H of F.slices)if(D=Math.min(D,H.z),H.supports){let t=ae(H.z);t.extruder=m.sliceSupportNozzle,t.supports=H.supports.slice(),t.height=H.height,e.push(t)}if(e.length){let t=se.newWidget(null,F.group);t.slices=e,t.support=!0,t.belt=F.belt,t.track=Object.clone(F.track),t.mesh={widget:t,position:t.track.pos},F.anno.extruder=m.sliceSupportNozzle,i.push(t)}}else console.log("invalid widget",F)}let j,X,Y,J=z.extruders=[],K=0;for(_ of i){var Q=_.anno.extruder??0;J[Q]||(J[Q]={},K++)}let U=Math.sqrt(g||0),V=U,$,tt,et;function it(t,e){var i=K-1,r=b,l,o,n,s,a,p,u,d,f,c,h,x,y,m,g;et=T?(l=t+r,o=(v.max.y+v.min.y)/2,n=v.max.y-v.min.y,a=t/2-(t*i+r*(i-1))-r/2,$={y:a,x:v.max.x+2+e/2},tt={y:l,x:0},{x:e,y:t}):(tt=v.min.x<v.min.y?(p=e+r,u=(v.max.x+v.min.x)/2,d=v.max.x-v.min.x,c=u-(e*i+r*(i-1))/2+p/2,$={x:c,y:v.max.y+2+t/2},{x:p,y:0}):(h=t+r,x=(v.max.y+v.min.y)/2,y=v.max.y-v.min.y,g=x-(t*i+r*(i-1))/2+h/2,$={y:g,x:v.max.x+2+e/2},{y:h,x:0}),{x:t,y:e})}function rt(t,e=45,i=6){let r=u.extruders[t],l=r.extNozzle,o={x:$.x+tt.x*t,y:$.y+tt.y*t,z:0},n=de().centerRectangle(o,et.x,et.y),s=ot(ce([de().centerRectangle(o,et.x-l,et.y-l)],e,l)),a=10<n.area()?ot(ce([de().centerRectangle(o,et.x-l,et.y-l)],e+90,l*i)):de(),p={extruder:t,diameter:r.extNozzle,rect:n,full:s,sparse:a,pause:ue(o.x+tt.y,o.y+tt.x,o.z)};return p}it(U,V);let lt=J.slice(1).map((t,e)=>t&&rt(e));function ot(e){let i=de().setOpen(),r=0;for(let t=0;t<e.length;t+=2){var l=e[t],o=e[t+1];r++%2==0?(i.push(l),i.push(o)):(i.push(o),i.push(l))}return i}let nt=!1,st;function at(t,e,l,o,n,i,s){if(!g||K<2)return o;let a=e.shift();var p=0<=i||st===t,u=0<=i?i:t,d=T?!nt&&0<=l.slice.index:0===l.slice.index,f,c,h;let x=d?m.firstLayerRate:m.outputFeedrate,y=!0;if(st=u,a){z.setType("purge tower"),l.last()&&(l.last().retract=!0),nt=nt||d;let e=d||!p;T&&n<0&&(f=1-n/D,it(U*f,V),a=rt(a.extruder,0,10),x=(m.outputFeedrate-m.firstLayerRate)*f+m.firstLayerRate,y=!1);let t=a.rect.clone().setZ(n),i=a.pause.clone().setZ(n),r=(0<=n&&e?a.full:a.sparse).clone().setZ(n);return T&&(c={x:0,y:n,z:0},t.move(c),i.move(c),r&&r.move(c),s&&(h={x:0,y:s.y,z:s.z},t.move(h),i.move(h),r&&r.move(h))),o=z.polyPrintPath(t,o,l,{tool:u,rate:x,simple:!0,open:!1,onfirstout:t=>t.overate=T?x:0}),r&&r.length&&(o=z.polyPrintPath(r,o,l,{tool:u,rate:x,simple:!0,open:!0,onfirst:t=>{t.purgeOn=e?i:void 0}})),l.last().retract=!0,y&&(o=z.polyPrintPath(t,o,l,{tool:u,rate:x,simple:!0,open:!1,extrude:0})),l.last().overate=0,o}return console.log({no_purge_tower_for:t,using:i,track:e,layer:l}),o}for(A of i){var{belt:pt}=A;let t=Object.clone(A.track.pos);T?t={x:pt.xpos,y:pt.ypos*pt.cosf,z:pt.ypos*pt.sinf}:t.z=S,A.offset=t}let ut=[],dt={};for(W of i)if(W.mesh)for(var ft of W.slices){ft.widget=W;var ct=(ft.z+W.offset.z).round(2);let t=dt[ct]=dt[ct]||{z:ct,slices:[]};0===t.slices.length&&ut.push(t),t.slices.push(ft)}ut.sort((t,e)=>t.z-e.z);let ht,xt,yt,mt;for(C of ut){let r=lt.slice();for(;;){let e=[];for(var gt of C.slices)if(!gt.prep){var vt=Y=gt.widget.offset,zt=gt.findClosestPointTo(c.sub(vt));if(zt){var bt=gt.extruder,Tt=yt;let t=Math.abs(zt.distance);bt!==Tt&&(t*=1e4),void 0===yt&&0<bt&&(t*=1e4),e.push({dst:t,slice:gt,offset:vt,z:C.z})}}if(0===e.length)break;e.sort((t,e)=>t.dst-e.dst);let{z:t,slice:i,offset:n}=e[0];void 0===ht&&(ht=i.extruder),mt&&mt.widget!==i.widget&&k.length&&(k.last().last().retract=!0);var Mt=he(m,i.index);i.prep=!0,L.length&&i.widget!==xt&&(L.last().retract=!0),xt=i.widget,L.z=t+i.height/2,L.height=L.height||i.height,L.slice=i,L.params=Mt,L.anchor=i.belt&&i.belt.anchor,mt&&mt.extruder===i.extruder||0<=i.extruder&&(c=at(i.extruder,r,L,c,i.z,void 0,n));var Pt=i.widget.track.box,Ot=i.belt&&i.belt.touch;z.setType("layer"),z.setWidget(xt),c=ye(z,i,Ot?ue(-5e3,5e3,0):c.sub(n),n,L,{routeAround:m.outputAvoidGaps,seedPoint:c.sub(n),params:Mt,first:0===i.index,support:i.widget.support,onBelt:Ot,pretract:i=>{if(X&&X.length){let e=X.last().set_retract();if(i&&j&&e.point){var r=j.center(!0).add(n),l=e.point.distTo2D(r),o=Math.min(i,l);let t=e.point.followTo(r,o);t.inPolygon(j)&&z.addOutput(X,t,null,null,e.tool)}}}}),z.setWidget(null),mt=i,yt=mt.extruder,j=i.lastPoly,X=L,Mt.outputLayerRetract&&L.length&&(L.last().retract=!0)}for(var St of i)if(St.mesh)for(var Dt of St.slices)Dt.prep=!1;if(0<P&&w&&s){z.setType("shield"),w=xe.setZ(w.clone(),c.z);let l=[];c=fe(w,c,(t,e,i,r)=>z.polyPrintPath(t,r,l,{onfirst:function(t){l.length&&2<t.distTo2D(r)&&(l.last().retract=!0)}})),l.last().retract=!0,L.appendAll(l)}mt&&r.slice().forEach(t=>{c=at(t.extruder,r,L,c,mt.z,yt,Y)}),L.length&&k.append(L),P===ut.length-1&&L.length&&(L.last().retract=!0),L.layer=P++,l(P/ut.length*.5,"prepare"),L=[]}if(z.output=k,z.firstTool=ht,T){var wt=i[0].belt,kt,Lt,Rt;let u=1/0;for(kt of k)for(var Et of kt){var Bt=Et.point;u=Math.min(u,wt.slope*Bt.z-Bt.y)}z.belty=u,u=Math.max(0,u)+M*wt.slope;for(Rt of k){var Ft=he(m,Rt.layer||0),_t=Ft.firstLayerBrim<0,At=Math.abs(Ft.firstLayerBrim),Wt=Ft.firstLayerBrimIn||0,Ct=Ft.firstLayerBrimTrig||0,It=Ft.firstLayerBrimGap||0,Nt;let t,i=!1,r=1/0,l=-1/0,o=1/0,n=-1/0,e=1/0,s=1/0,a=[],p=0;for(Nt of Rt){p=0<=Nt.overate?Nt.overate:p;var Zt=Ft.firstLayerRate||d,qt=Ft.firstLayerPrintMult||Ft.firstLayerPrintMult,Gt=Nt.point,Ht=Nt.belty=-Gt.y+Gt.z*wt.slope,jt=!(Ht<=u)&&p||Zt;s=Math.min(s,Ht),Rt.anchor&&(Nt.speed=Math.min(Nt.speed,jt)),Nt.emit&&Ht<=u&&t&&Math.abs(t.belty-Ht)<.01&&(Nt.speed=Ft.firstLayerRate||Math.min(Nt.speed,jt),Nt.emit*=qt,Nt.fan=Ft.firstLayerFanSpeed,o=Math.min(o,Gt.x,t.point.x),n=Math.max(n,Gt.x,t.point.x),l=Math.max(l,Gt.y),r=Math.min(r,Gt.z),i=Nt,e=Math.min(e,t.point.distTo2D(Nt.point)),1<Gt.x-t.point.x&&a.push([t.point.x,Gt.x])),t=Nt}if(i&&!Rt.anchor){var Xt=[],Yt=0===Ct||Ct&&e<=Ct,Jt;if(Math.max(At,Wt)&&Yt){var{emit:Kt,tool:Qt}=i,Ut=l,Vt=r,$t=It||0,te=Math.max(At,1)+$t,ee=Math.max(Wt,1)+$t;let e=Rt.last();if(e.retract=!0,m.outputAvoidGaps){let t=e.point.clone();t.y=Ut,z.addOutput(Xt,t,0,f,Qt)}if(At&&!_t&&(z.addOutput(Xt,ue(n+te,Ut,Vt),0,f,Qt),z.addOutput(Xt,ue(n+$t,Ut,Vt),Kt,d,Qt).retract=!0),Wt&&1<a.length){var ie=[],re;let t=a[0];for(re of a.slice(1)){var le=t[1],oe=re[0];t=re,2*ee<oe-le?(z.addOutput(Xt,ue(oe-$t,Ut,Vt),0,f,Qt),z.addOutput(Xt,ue(oe-ee,Ut,Vt),Kt,d,Qt).retract=!0,z.addOutput(Xt,ue(le+ee,Ut,Vt),0,f,Qt),z.addOutput(Xt,ue(le+$t,Ut,Vt),Kt,d,Qt).retract=!0):ee/3<oe-le&&(z.addOutput(Xt,ue(oe-$t,Ut,Vt),0,f,Qt),z.addOutput(Xt,ue(le+$t,Ut,Vt),Kt,d,Qt).retract=!0)}}At&&(z.addOutput(Xt,ue(o-te,Ut,Vt),0,f,Qt),z.addOutput(Xt,ue(o-$t,Ut,Vt),Kt,d,Qt).retract=!1),Rt[0].emit&&e&&z.addOutput(Xt,Rt[0].point.clone(),0,f,Qt),Rt.splice(0,0,...Xt)}Lt=Rt.peek()}}}!1!==t.render&&await pe.path(k,(t,e)=>{l(.5+.5*t,"render",e)},{lineWidth:t.process.sliceLineWidth,toolMode:2===t.pmode,tools:u.extruders,thin:h,flat:x,fdm:!0})}});"use strict";gapp.register("kiri-mode.fdm.slice",[],(e,t)=>{const{base:Ge,kiri:R,noop:l}=e,{consts:i,driver:s,fill:H,fill_fixed:B,newSlice:qe,utils:o}=R,{config:Ue,polygons:n,util:$e,newPoint:D}=Ge,{fillArea:a}=n,{FDM:r}=s,{doTopShells:f,getRangeParameters:Je}=r,Ke=n,Qe=$e.pwait,p=.6,c=1,d=1.5,g={anchor:{check:10066227,face:10066227,line:10066227,opacity:1,lopacity:p,fat:d},fill:{check:47991,face:47991,line:47991,opacity:1,lopacity:p,fat:d},gaps:{check:11154278,face:11154278,line:11154278,opacity:1,lopacity:p,fat:d},infill:{check:3351227,face:3351227,line:3351227,opacity:1,lopacity:p,fat:d},inset:{line:11184810,check:11184810,face:0},shell:{check:30651,face:30651,line:30651,opacity:1,lopacity:p,fat:d},support:{check:11162931,face:11162931,line:11162931,opacity:1,lopacity:p,fat:d},part:{line:3355443,check:3355443},thin:{check:12290048,face:12290048,line:12290048,opacity:1,lopacity:p,fat:d}},h=Object.assign({},g,{fill:{check:34901,face:34901,line:34901,opacity:1,lopacity:p,fat:d},infill:{check:3351227,face:3351227,line:3351227,opacity:1,lopacity:p,fat:d},inset:{line:5592405,check:5592405},part:{line:7829367,check:7829367,face:0},thin:{check:12290048,face:12290048,line:12290048,opacity:1,lopacity:p,fat:d}}),y=Object.clone(g),u=!1,Xe=l,Ye=l,v=!1;let m=!1,z=!1,b=0;function x(e){if(e){if(z)return e.flat=!0,e.outline=!0,e;if(m)return null}return e}function w(i,s=1/0){const o=[];let n,a=0;for(let l=0;l<i.length;l+=2){let e=i[l],t=i[l+1];var r,f;a++%2==1&&(r=e,e=t,t=r),n&&e.distTo2D(n)<=s&&(f=e.clone(),o.push(n),o.push(f)),o.push(e),o.push(t),n=t.clone()}let e=0;for(var t of o)t.index=e++/2|0;return o}function S(e,t,l){return Math.max(t,Math.min(l,e))}function et(i,t,e,l={}){const{dark:s,devel:o}=l,n=s?h:g,a=i.output(),r=i.height/2,f=e.sliceFillWidth||1;if(i.tops&&i.tops.forEach(e=>{m&&a.setLayer("part",n.part).addPolys([e.poly]),a.setLayer(t?"support":"shells",t?n.support:n.shell).addPolys(e.shells||[],x({offset:b,height:r,clean:!0})),a.setLayer("solid fill",t?n.support:n.fill).addLines(e.fill_lines||[],x({offset:b*f,height:r,z:i.z})),i.belt&&i.belt.anchor||a.setLayer("sparse fill",n.infill).addPolys(e.fill_sparse||[],x({offset:b,height:r,outline:!0,trace:!0})),i.belt&&i.belt.anchor&&a.setLayer("anchor",n.anchor).addPolys(e.fill_sparse||[],x({offset:b,height:r,outline:!0,trace:!0})),e.thin_fill&&a.setLayer("thin fill",n.thin).addLines(e.thin_fill,x({offset:b,height:r})),e.gaps&&o&&a.setLayer("gaps",n.gaps).addPolys(e.gaps,x({offset:b,height:r,thin:!0})),m&&o&&e.fill_off&&e.fill_off.length&&i.output().setLayer("fill inset",n.inset).addPolys(e.fill_off)}),m&&o&&(i.solids&&i.solids.length&&a.setLayer("solids",{face:12303104,check:12303104}).addAreas(i.solids),i.bridges&&i.bridges.length&&a.setLayer("bridges",{face:52428,line:52428,check:52428}).addAreas(i.bridges),i.flats&&i.flats.length&&a.setLayer("flats",{face:11141290,line:11141290,check:11141290}).addAreas(i.flats)),i.supports&&e.sliceSupportOutline&&a.setLayer("support",n.support).addPolys(i.supports,x({offset:b,height:r})),i.supports&&i.supports.forEach(e=>{e.fill&&a.setLayer("support",n.support).addLines(e.fill,x({offset:b,height:r}))}),i.xray){const p=[16711680,43520,255,11184640,16711935,0];i.lines&&i.lines.forEach((e,t)=>{var l=t%5;i.output().setLayer("l"+l,p[l]).addLine(e.p1,e.p2)}),i.groups&&Ke.nest(i.groups).forEach((e,t)=>{var l=t%5;i.addTop(e),i.output().setLayer("g"+t,p[l]).addPoly(e)})}}function tt(e,t,l,i,s,o={}){for(var n of e.tops)f(e.z,n,t,l,i,s,o)}function lt(e,l,i){e.xray||(0!==e.tops.length&&"number"==typeof i?(e.tops.forEach(function(e){var t;e.fill_off&&(t=a(e.fill_off,i,l,null),e.fill_lines.appendAll(t))}),e.isSolidLayer=!0):e.isSolidLayer=!1)}function it(z,b={}){if(!z.xray&&"none"!==b.type){let g=b.process,t=b.spacing,y=b.density,v=b.bounds,m=b.height,x=!(!1===b.cache),w=b.type||"hex";if(0===z.tops.length||0===y||z.isSolidLayer||z.index<0)z.isSparseFill=!1;else{let l=z.tops,i=z.down,e=self.ClipperLib,s=e.ClipType,o=e.PolyType,n=e.PolyFillType,a=new e.Clipper,r=new e.PolyTree,f,p=[],c=[],d=[],h=[],u={slice:function(){return z},zIndex:function(){return z.index},zValue:function(){return z.z},options:function(){return b},lineWidth:function(){return b.lineWidth},bounds:function(){return v},zHeight:function(){return m},offset:function(){return t},density:function(){return y},repeat:function(){return g.sliceFillRepeat},emit:function(e,t){isNaN(e)?h.push(e):(d.push(D(e,t,z.z)),z.isSparseFill=!0)},newline:function(){0<d.length&&(c.push(d),d=[])}};if(w&&H[w]){H[w](u),u.newline();for(var S of l)S.fill_sparse=S.fill_sparse||[],p.appendAll(S.fill_off),p.appendAll(S.solids);z._fill_finger=Ke.fingerprint(p);var E=!(!x||!B[w]);let t=!1;if(E&&z.fingerprintSame(i)&&i._fill_finger&&Ke.fingerprintCompare(z._fill_finger,i._fill_finger)){for(let e=0;e<l.length;e++)i.tops[e].fill_sparse||(t=!0);if(!t)return void(z._clone_sparse=!0)}var M=z.isSparseFill;if(h.length)for(let i of l){if(!i.fill_off)return;let l=i.fill_off.slice();i.solids&&(l=Ke.subtract(l,i.solids,[],null,z.z));var _=g.sliceFillAngle*(z.index%2+1),T,P;for(T of h){let e=[],t=[];for(var L of l){var k=T.mask(L);k&&k.length&&e.appendAll(k)}if(e.length&&Ke.expand(e,-b.lineWidth/2,z.z,t),e.length){z.isSparseFill=!0;for(var A of e)A.forEachSegment((e,t)=>{i.fill_lines.push(e,t)})}t.length&&(P=Ke.fillArea(t,_,b.lineWidth),i.fill_lines.appendAll(P))}}if(M)if(b.promises)b.promises.push(R.minions.clip(z,p,c));else if(c=c.map(e=>e.map(e=>e.toClipper())),a.AddPaths(c,o.ptSubject,!1),a.AddPaths(Ke.toClipper(p),o.ptClip,!0),a.Execute(s.ctIntersection,r,n.pftNonZero,n.pftEvenOdd))for(var O of r.m_AllPolys){f=Ke.fromClipperNode(O,z.z);for(var F of l)f.isInside(F.poly)&&F.fill_sparse.push(f)}}else console.log({missing_infill:w})}}}function st(l,e={}){const{sla:i,fakedown:s,grow:o,min:n}=e;if(!(l.index<=0&&!s||l.xray)){const a=l,r=l.down||(s?qe(-1):null),f=i?a.topPolys():a.topInners(),p=i?r.topPolys():r.topInners(),c=a.bridges=[],d=r.flats=[];if(l.fingerprintSame(r))return a.bridges=c,void(r.flats=d);let e=[],t=[];Ke.subtract(f,p,e,t,l.z,n,{wasm:!0}),e=e.filter(e=>e.areaDeep()>=n),t=t.filter(e=>e.areaDeep()>=n),0<o&&e.length&&(e=Ke.offset(e,o)),0<o&&t.length&&(t=Ke.offset(t,o)),c.appendAll(e),d.appendAll(t)}}function E(e,t){e.solids?e.solids.appendAll(t):t&&t.length&&console.log({no_solids_in:e,for:t})}function ot(e,t,l){var i;e.down&&e.flats&&(e.flats.length&&(e.finishSolids=!0),e&&e.flats&&e.flats.length&&M(e,l?Ke.expand(e.flats,l):e.flats,t,!1,!0))}function nt(e,t){e.up&&e.bridges&&(e.bridges.length&&(e.finishSolids=!0),M(e,e.bridges,t,!0,!0))}function at(i,s,o,e,n){let a=e||1,r=i.tops,f=i.solids;if(r&&f&&!i.isSolidLayer&&!i.xray){var p=Ke.union(f,void 0,!0,{wasm:!0}).flat(),c=void 0===s&&void 0===o;if(0!==f.length&&0!==p.length){let e=[],t=c?i.topPolys():i.topFillOff();for(var d of p){d.setZ(i.z);for(var h of t){var u=d.mask(h);u&&0<u.length&&e.appendAll(u)}}r.forEach(e=>{e.solids=[]}),i.solids=f=e;let l=!1;var g=r.length?r.map(e=>e.poly.areaDeep()).reduce((e,t)=>e+t):0,y,v,m;for(y of f)for(var x of r){let e=[];if(x.poly.overlaps(y)&&(!y.parent||y.parent.area()>x.poly.area())){if(y.areaDeep()<a)continue;y.parent=x.poly,x.solids.push(y),e.push(y)}}if(l){for(var w of r)w.solids=[];lt(i,s,o)}else{if(c)return 1;for(var z of r)if(z.fill_lines){const M=[],_=[];var b=z.fill_lines=[],S;for(S of f)S.parent===z.poly&&(S.fillang?_:M).push(S);if(0<M.length&&T(n,M,o,s,b),0<_.length){z.fill_lines_ang={spacing:s,list:[],poly:[]};for(var E of _)T(n,[E],E.fillang.angle+45,s,b)}}}}}}function T(e,t,l,i,s,o,n){e?e.push(R.minions.fill(t,l,i,s,o,n)):Ke.fillArea(t,l,i,s,o,n)}async function rt(i,e,t,l={}){let r=e.sliceSupportSpan||5,s=e.supportMinArea||.1,o=e.sliceSupportSize,n=e.sliceSupportOffset||0,a=e.sliceSupportGap,f=o||1,p=i.topPolys(),c=p,d=Ke.flatten(i.topShells().clone(!0)),h=i.topFill(),u=[],g=i.down,y=g?g.topPolys():null,v=g?Ke.flatten(g.topShells().clone(!0)):null;var m;l.exp&&y&&200<y.map(e=>e.deepLength).reduce((e,t)=>e+t)&&(y=g.topSimples(),v=v.map(e=>e.clean(!0,void 0,Ue.clipper/10)));let x=!1,w=x?[]:void 0,z=x?[]:void 0,b=x?[]:void 0;function S(l){x&&w.push(l);for(let e=0;e<u.length;e++)if(l.distTo2D(u[e])<f/4)return;let i=l.isInPolygonOnly(y);x&&i&&z.push(l);let s=!1;i||v.forEach(function(e){return e.forEachSegment(function(e,t){if(l.distToLine(e,t)<n)return s=!0,i=!0}),i}),x&&s&&b.push(l),i||u.push(l)}function E(e,t,l){let i,s=1;if((i=e.distTo2D(t))>=r)for(var o=e.slopeTo(t).factor(1/i),n=Math.floor(i/r)+1,a=i/n;s<n;)S(e.projectOnSlope(o,s++*a));l&&S(t)}let M=[];if(i.down&&function(){if(d.forEach(function(e){e.forEachSegment(function(e,t){E(e,t,!0)})}),h.forEachPair(function(e,t){E(e,t,!1)}),u.length||M.length){let t=[];u.forEach(function(e){t.push(Ge.newPolygon().centerRectangle(e,f/2,f/2))}),M.appendAll(Ke.union(t,null,!0,{wasm:!1})),t=Ke.union(t,null,!0,{wasm:!1}).forEach(function(e){M.push(Ge.newPolygon().createConvexHull(e.points))})}}(),x&&v&&i.output().setLayer("cks",{line:15619379,check:15619379}).addPolys(w.map(e=>Ge.newPolygon().centerRectangle(e,.25,.25))).setLayer("pip",{line:14500898,check:14500898}).addPolys(z.map(e=>Ge.newPolygon().centerRectangle(e,.4,.4))).setLayer("pcl",{line:13382417,check:13382417}).addPolys(b.map(e=>Ge.newPolygon().centerRectangle(e,.3,.3))).setLayer("pts",{line:14496733,check:14496733}).addPolys(u.map(e=>Ge.newPolygon().centerRectangle(e,.8,.8))).setLayer("dtr",{line:0,check:0}).addPolys(Ke.setZ(v.clone(!0),i.z)),0!==M.length){M=10<M.length?await R.minions.union(M):Ke.union(M,null,!0,{wasm:!1}),M=Ke.trimTo(M,t);let l=0;for(;g&&0<M.length;){g.supports=g.supports||[];let e=[],t=[];if(Ke.subtract(M,g.topSimples(),e,null,i.z,s,{wasm:!1}),e.forEach(function(e){e.area()<s||t.push(e.setZ(g.z))}),0===t.length)break;l>=a&&g.supports.appendAll(t),M=t,g=g.down,l++}}}function ft(e){const{promises:t,slice:l,lineWidth:i,density:s,minArea:o,isBelt:n,angle:a,outline:r}=e;let f=l.supports,p=[],c=[],d=o||.1;f&&(f=Ke.setZ(Ke.union(f,void 0,!0,{wasm:!1}),l.z),Ke.subtract(f,l.clips,p,null,l.z,d,{wasm:!1}),f=p,l.down&&l.down.clips&&(Ke.subtract(p,l.down.clips,c,null,l.z,d,{wasm:!1}),f=c),f&&pt({promises:t,polys:f,lineWidth:i,density:s,z:l.z,isBelt:n,angle:a,outline:r}),l.supportOutline=f,l.supports=f)}function pt(e){const{promises:i,polys:t,lineWidth:s,density:l,z:o,isBelt:n,angle:a,outline:r}=e;let f=s*(1/l);t.forEach(function(e){var t=n||1<e.bounds.width()/e.bounds.height()?1090:1e3,l=Ke.offset([e],-s/3,{flat:!0,z:o,wasm:!0});return l&&0<l.length&&(T(i,l,a||t,f,e.fill=[]),!r&&e.fill.length&&(e.fill=w(e.fill,2*f))),!0})}function M(t,l,i,s,o){if(t&&!(i<=0)){let e=l.clone(!0);o&&e.forEach(function(e){e.hintFillAngle()}),E(t,e),0<i&&(s?M(t.up,l,i-1,!0,!1):M(t.down,l,i-1,!1,!1))}}r.sliceAll=function(e,t){let l=Object.values(R.worker.cache).filter(e=>!e.meta.disabled).sort((e,t)=>e.slices[0].z-t.slices[0].z);var{bounds:i}=e,s,o,n;for(s of l){var{pos:a,box:r}=s.track;let e,t=Math.round((a.x-r.w/2-i.min.x)/10)+1,l=Math.round((a.y-r.h/2-i.min.y)/10)+1;s.track.grid_id=100*t+l}let f=[];for(o of l){o.anno&&0<=o.anno.extruder&&(n=o.anno.extruder,f.indexOf(n)<0&&f.push(n))}if(l.sort((e,t)=>e.slices[0].z-t.slices[0].z),l.shift(),1<f.length)for(var p of l)p.slices=p.slices.filter(e=>0<=e.index)},r.slice=function(xe,we,ze,e){let be=!1!==xe.render,{process:Se,device:Ee,controller:Me}=xe,_e=Ee.bedBelt,Te=Me.devel&&Se.sliceZInterleave,Pe=we.track.synth,Le=we.track.support,t=Me.assembly,ke=Me.threaded&&R.minions.concurrent,Ae=Se.sliceTopLayers||0,Oe=Se.sliceBottomLayers||0,Fe="vase"===Se.sliceFillType&&!Pe,l=we.anno,i=Math.max(0,Ee.extruders.length-1),Re=Math.min(i,parseInt(Pe?Se.sliceSupportNozzle:l.extruder||0)),He=Se.sliceHeight,Be=(_e?He:Se.firstSliceHeight)||He,De=Se.sliceLineWidth||Ee.extruders[Re].extNozzle,s=1-S(Se.sliceFillOverlap,0,.8),We=De,je=De,Ce=De*s,o=Se.sliceSupportOffset,Ie=Se.sliceFillAngle,Ve=Se.sliceSupportDensity;if(z="flat"===Me.lineType,m=!z&&"line"===Me.lineType,b=De/2,0<=Se.sliceSupportFill&&(Se.sliceSupportFill+=1e3),z?Object.values(g).forEach(e=>{e.flat=!0,e.line=1,e.opacity=1}):Object.keys(g).forEach(e=>{const t=g[e];var l=y[e];t.flat=l.flat,t.line=l.line,t.opacity=l.opacity}),!(0<He&&He<100))return e("invalid slice height");if(!(.01<=De&&De<100))return e("invalid nozzle size");const n=Se.sliceAdaptive&&0<Se.sliceMinHeight?Math.min(Se.sliceMinHeight,He):0;Be<=0&&(console.log("invalid first layer height < slice height"),console.log("reverting to min valid slice height"),Be=n||He);var a=we.getBoundingBox(),r=we.getPoints();let x=[],w=[],Ze=!1;var f=_e&&Se.firstLayerFlatten||0,p=we.track.zcut||0,{belt:c}=we,d;if(p||f)for(var h of r){h._z||(h._z=h.z,f&&(_e?0<(d=c.slope*h.z-h.y)&&d<=f&&(h.y+=d*c.cosf,h.z-=d*c.sinf):h.z<=f&&(h.z=0)),p&&!_e&&(h.z-=p))}async function Ne(e){if(!we.shadow){let t=we.group[0];if(t.shadow)we.shadow=t.shadow;else{var l=we.group.filter(e=>!e.track.synth).map(e=>e.slices).flat().map(e=>e.tops).flat().map(e=>e.simple);let e=ke?await R.minions.union(l,.1):Ke.union(l,.1,!0);Se.sliceSupportExtra&&(e=Ke.offset(e,Se.sliceSupportExtra)),we.shadow=t.shadow=Ke.setZ(e,0)}}}async function u(c){Ze&&ze(null,null,"part may not be manifold");let t=!1;c=c.reverse().filter(e=>e.tops.length?t=!0:t).reverse();for(let e=1;e<c.length;e++)c[e-1].up=c[e],c[e].down=c[e-1];if((we.slices=c)&&0!==c.length){for(var e of c)e.params=Je(Se,e.index);if(!_e&&(Pe||!Pe&&Ve&&Se.sliceSupportEnable)&&await Ne(c),Pe)for(var l of c){var i=He*Se.sliceSupportGap,s,o;let t=l.topPolys();for(s of we.group)if(s!==we&&s.slices){for(var n of s.slices)if(!(.1<Math.abs(Math.abs(n.z-l.z)-i))){let e=n.clips;n.supportOutline&&e.appendAll(n.supportOutline);var a=[];Ke.subtract(t,e,a,null,l.z,0),t=a}_e||(t=Ke.setZ(Ke.trimTo(t,we.shadow),l.z))}l.tops=[];for(o of t)l.addTop(o);tt(l,1,We/2)}if(Ue.hint_len_max=$e.sqr(Se.sliceBridgeMax),c.forEach(e=>{e.widget=we,e.extruder=Re,e.solids=[]}),me(.15,.2,e=>{var t=e.params,l=0===e.index&&Se.firstLayerLineMult||1,i=e.index<Oe,s=Ae&&e.index>c.length-Ae-1,o=.995<t.sliceFillSparse,n,a=(i||(s||o)&&!Fe)&&!Pe?t.sliceFillWidth||1:0,r;a&&lt(e,je*l*a,Ie),Ie=(Ie+90)%360},"solid layers"),_e&&!Pe){var{cosf:r,slope:f}=we.belt,d,h;let p=1/0;for(d of c){let e=1/0;for(var u of d.topPolys()){var g=u.bounds.maxy,y,v=f*d.z-g;v<e&&(e=v),v<p&&(p=v)}d.belt={miny:e,touch:e.round(3)<Be}}let l,i=1/0,s=-1/0,e=0;for(h of c){if(h.tops.length&&e++<5)for(var m of h.topPolys())i=Math.min(i,m.bounds.minx),s=Math.max(s,m.bounds.maxx);!l&&h.belt.touch&&(l=h)}for(;l&&l.up&&0===l.topShells().length;)l=l.up;var x=Je(Se,0).firstLayerBrim||0;x&&(i-=x,s+=x);let o=[];var w=He;let t=(Se.beltAnchor||Se.firstLayerBeltLead)*r;for(;t&&l&&t>=He;){let e=l.down;e?e.belt||(console.log({addto_missing_belt:e}),e.belt={}):(e=qe(l.z-w),e.extruder=Re,e.belt={},e.height=l.height,e.up=l,l.down=e,c.splice(0,0,e)),e.index=-1,e.belt.anchor=!0,e.belt.touch=!1;var z=e.z,b=f*z-p-De/2,S=Ge.newPolygon().add(i,b,z).add(s,b,z).setOpen(),E=e.addTop(S).fill_sparse=[S];o.push(E),l=e,t-=w*f}var M=Se.firstLayerBeltBump;if(M){o=o.reverse().slice(1,o.length-1);let t=1;for(var _ of o){let e=_[0];var T=t++*-l.height*2;M<-T&&t--;var P=e.first();if(e.push(e.last().add({x:0,y:T,z:0})),e.push(e.first().add({x:0,y:T,z:0})),e.setClosed(),2<t&&10<s-i){var L=(s+i)/2,k=s-i-2,k=3*Math.floor(k/3)/2,A=P.y,O=P.z,F=De/2;for(let e=L-k;e<=L+k;e+=3)_.push(Ge.newPolygon().add(e,A-F,O).add(e,A+T+F,O).setOpen())}}}if(Se.pooch&&self.OffscreenCanvas){var{length:R,width:H,height:B,text:D}=Se.pooch,W;let i,a,s,o,r=0,n=0,f=0;for(W of c){var{belt:j}=W;if(j.touch){var C=W.index,I=W.z;e:for(var V of W.topPolys())for(let e=0,t=V.points,l=t.length;e<l;e++){var Z=t[e],N=t[(e+1)%l],G=I-Z.y,q=I-N.y,U=!o||C-o==1,$=0<G&&G<3&&Math.abs(G-q)<.01,J=Math.abs(H-Math.abs(N.x-Z.x))<1;if($&&J){if(U){i=i||I,a=a||C,s=I,o=C,r=Math.min(Z.x,N.x),n=Math.max(Z.x,N.x),f=G;break e}i=o=0}}}}var K=Math.abs(B-f*(1/Math.sqrt(2))),Q=Math.abs(R-(s-i)*Math.sqrt(2));if(K<.1&&Q<1){var X=o-a-2,Y=2*H;let e=new self.OffscreenCanvas(X,Y),t=e.getContext("2d");t.scale(1.2,1),t.font="24px sans-serif",t.textBaseline="bottom",t.fillText(D,1,Y-1);var ee=t.getImageData(0,0,X,Y).data.buffer,te=new Uint32Array(ee);for(let n=0;n<X;n++){let t="",l=0,i=[],s,o;for(let e=Y-1;0<=e;e--){var le,le=(((le=te[e*X+n])>>24&255)+(le>>16&255)+(le>>8&255))/3;t+=30<le?"*":"-",l=Math.max(l,le),30<le?0<=s?o=Y-e:s=Y-e:(0<=s&&o>s&&i.push({start:s,end:o}),s=o=void 0)}if(console.log(n.toString().padStart(2,0),t,0|l,i),i.length){let e=c[a+n+1],t=e.supports=e.supports||[];var ie=e.z,se=ie-p-De/2,oe;for(oe of i)t.push(Ge.newPolygon().add(r+oe.start/2,se,ie).add(r+oe.end/2,se,ie).setOpen())}}}}}if(!Fe&&!Pe){Xe("delta"),me(.2,.34,e=>{var t=e.params||Se,l,i;st(e,{min:t.sliceSolidMinArea,grow:t.sliceFillGrow})},"layer deltas"),Ye(),Xe("delta-project"),me(.34,.35,e=>{var t=e.params||Se;Ae=t.sliceTopLayers||0,Oe=t.sliceBottomLayers||0,Ae&&ot(e,Ae),Oe&&nt(e,Oe)},"layer deltas"),Ye(),Xe("solid-fill");let a=ke?[]:void 0;me(.35,a?.4:.5,e=>{var t=e.params||Se,l=0===e.index,i=t.sliceFillWidth||1,s=l&&t.firstLayerLineMult||1,o=je*s*i,n=t.sliceSolidMinArea;at(e,o,Ie,n,a),Ie=(Ie+90)%360},"fill solids"),c.last().finishSolids=!0,a&&await Qe(a,(e,t)=>{ve(e/t,.4,.5)}),Ye()}if(Pe||Fe){if(Pe&&Le){let o=Se.sliceSupportOutline||!1,n=ke?[]:void 0,a=[];me(.5,n?.6:.7,e=>{var t,l=(e.params||Se).sliceSupportDensity,i=e.topShells();e.supports=i,e.tops=void 0;var s=[];l&&(o?Ke.expand(i,-De/4,e.z,s):Ke.expand(i,De,e.z,s)),pt({promises:n,polys:s,lineWidth:De,density:l,z:e.z,isBelt:_e,angle:Se.sliceSupportFill}),a.push({slice:e,polys:s})},"infill"),n&&await Qe(n,(e,t)=>{ve(e/t,.6,.7)});for(var p of a){var{slice:ne,polys:ae}=p;p.supports=ae}}}else{let i,s=ke?[]:void 0;me(.5,s?.55:.7,e=>{var t=e.params||Se,l;t.sliceFillSparse&&(l=t.sliceFillType,it(e,{settings:xe,process:Se,device:Ee,lineWidth:De,spacing:Ce,density:t.sliceFillSparse,bounds:we.getBoundingBox(),height:He,type:l,cache:!0!==t._range&&i===l,promises:s}),i=l)},"infill"),s&&await Qe(s,(e,t)=>{ve(e/t,.55,.7)});for(let i of c)if(i._clone_sparse){let t=i.tops,l=i.down.tops;for(let e=0;e<t.length;e++)t[e].fill_sparse=l[e].fill_sparse.map(e=>e.cloneZ(i.z))}}if(!_e&&!Pe&&Ve&&Se.sliceSupportEnable){Ne(c),Xe("support");let t=[];me(.7,.75,e=>{t.push(rt(e,Se,we.shadow,{}))},"support"),await Qe(t,(e,t)=>{ve(e/t,.75,.8)}),Ye()}if(Ve){Xe("support-fill");let i=void 0;me(.8,(i,.9),e=>{var t,l=(e.params||Se).sliceSupportDensity;ft({promises:i,slice:e,lineWidth:De,density:l,minArea:Se.sliceSupportArea,isBelt:_e,angle:Se.sliceSupportFill,outline:!1!==Se.sliceSupportOutline})},"support"),i,Ye()}if(Te){var re=c.map(e=>e.index),fe=re[1],pe=re[re.length-2],ce;let t=[];for(ce of c)if(!(ce.index<fe||ce.index>pe)){let i=ce.clone();i.z-=ce.height/2,ce.index===fe?(i.z=ce.z-ce.height/4,i.height=ce.height/2):i.height=ce.height,t.push(i);let e=0;for(var de of ce.tops||[]){let l=i.tops[e++];l.shells=[],de.shells=de.shells.filter((e,t)=>t%2==0||(l.shells.push(e),!1))}if(ce.index===pe){let e=i.clone();e.z+=.75*ce.height,e.height=ce.height/2,t.push(e),e.tops?.forEach((e,t)=>{e.shells=i.tops[t].shells.clone()})}}c.appendAll(t),c.sort((e,t)=>e.z-t.z),c.forEach((e,t)=>e.index=t)}if(be&&me(.9,1,e=>{var t=e.params||Se;et(e,Pe,t,{dark:Me.dark,devel:Me.devel})},"render"),_e){let e=Ge.newBounds();var he=c[0];if(he.tops)for(var ue of he.tops)e.merge(ue.poly.bounds);else if(he.supports)for(var ge of he.supports)e.merge(ge);we.belt.miny=-e.miny,we.belt.midy=(e.miny+e.maxy)/2}}function ye(e,t,l,i){ve(e/c.length,t,l,i)}function ve(e,t,l,i){ze(.5+.5*(t+e*(l-t)),i)}function me(t,l,i,s){c.forEach(e=>{i(e),ye(e.index,t,l,s)})}}Ge.slice(r,{debug:Se.xray,xray:Se.xray,zMin:a.min.z,zMax:a.max.z-p,union:Me.healMesh||Pe,indices:Se.indices||Se.xray,useAssembly:t,post:"FDM",post_args:{shellOffset:We,fillOffset:Ce,clipOffset:o,lineWidth:De,vaseMode:Fe,isSynth:Pe,process:Se},zGen(p){if(Se.xray)return p.zIndexes;var{zMin:e,zMax:c}=p,d=He,h=Be||d,u=n||0;let t=h,l=h,i=x,s=w;if(u){var g=h,y=d,v=u;let e=w,t=x;var m=Object.values(p.zIndexes).map(e=>parseFloat(e));let l=g,i=0,s,o,n,a,r,f=l;for(e.push(g),t.push(g);l<c&&i<m.length;)if(r=m[i++],!(l>=r||(s=r-l)<v))for(o=Math.floor(s/v),n=Math.floor(s/y),a=n&&n<=o?(.01<s%y&&n++,s/n):s;l<r;)e.push(a),t.push(l+a),l+=a}else for(;;){var o=(l-t/2).round(3);if(c<o)break;s.push(t),i.push(o),t=d,l+=t}return i},slicer(e,t,l){return(ke?R.minions:Ge).sliceZ(e,t,l)},onupdate(e){return ze(0+.5*e)}}).then(e=>e.slices.map(e=>{var{z:t,clip:l,lines:i,groups:s,changes:o}=e;if(!e.tops)return null;let n=qe(t).addTops(e.tops);return n.index=x.indexOf(t),n.height=w[n.index],n.clips=l,o&&!Pe&&(Ze=!0,n.changes=o,self.debug&&console.log("slice healed",n.index,n.z,o)),Se.xray&&(n.index=Se.xrayi.shift(),n.lines=i,n.groups=s,n.xray=Se.xray),n}).filter(e=>e)).then(e=>u(e)).then(e)},r.share={doShells:tt,doTopShells:f,doDiff:st,projectFlats:ot,projectBridges:nt},r.supports=function(e,t){var l=e.device.bedBelt,i;let c=e.process.sliceSupportSize,d=c/9,n=c/4,a=.45*c;var s=.01;let o=new THREE.BufferGeometry;o.setAttribute("position",new THREE.BufferAttribute(t.vertices,3));var r=Math.PI/180,f=180/Math.PI,p=r*e.process.sliceSupportAngle;let h=-Math.sin(p),u=new THREE.Vector3(0,0,-1),g=[];var y=new THREE.MeshBasicMaterial;let v=new THREE.Mesh(o,y),m=new THREE.Mesh(new THREE.PlaneGeometry(1e4,1e4,1),y);var x=Date.now();function w(t){if(!t.added){for(var l of g){let e=new THREE.Vector2(t.x,t.y);var i=new THREE.Vector2(l.mid.x,l.mid.y);if(Math.abs(t.z-l.from.z)<a&&e.distanceTo(i)<n)return}let e=new THREE.Raycaster(t,u);var s=e.intersectObjects([v,m],!1),o;s&&s.length&&.5<s[0].distance&&(o=(new THREE.Vector3).add(t).add(s[0].point).divideScalar(2),g.push({from:t,to:s[0].point,mid:o}),t.added=!0)}}function z(e,t,l){var i=e.distanceTo(t),s=t.distanceTo(l),o=l.distanceTo(e),n=Math.max(i,s,o),a,r,f,p;if(n<c)return!(Math.min(i,s,o)<d&&Math.random()<.5)&&(w((new THREE.Vector3).add(e).add(t).add(l).divideScalar(3)),0);i===n?(z(r=(new THREE.Vector3).add(e).add(t).divideScalar(2),t,l),z(e,r,l)):s===n?(z(e,f=(new THREE.Vector3).add(t).add(l).divideScalar(2),l),z(e,t,f)):(z(e,t,p=(new THREE.Vector3).add(l).add(e).divideScalar(2)),z(p,t,l))}let b=l?e=>e.z<=h&&e.y<0:e=>e.z<h;var{position:S}=o.attributes,{itemSize:E,count:M,array:_}=S;for(let e=0;e<M;e+=3){var T=e*E,P=new THREE.Vector3(_[T++],_[T++],_[T++]),L=new THREE.Vector3(_[T++],_[T++],_[T++]),k=new THREE.Vector3(_[T++],_[T++],_[T++]),A=THREE.computeFaceNormal(P,L,k);b(A)&&(Math.max(P.z,L.z,k.z)<.1||z(P,L,k))}return console.log(`support generated in ${Date.now()-x} ms`),t.supports=g,0<g.length};class _{constructor(){this.cache={}}get(e,t,l){var i=[e.round(4),t.round(4),l.round(4)].join(",");let s=this.cache[i];return s||(s=new THREE.Vector3(e,t,l),this.cache[i]=s),s}}class P{constructor(){this.cache={}}put(e,t,l,i){var s=i.round(7).toString();let o=this.cache[s];o||(o=[],this.cache[s]=o),o.push([e,t,l])}group(e){let l={};for(var i in this.cache){var s,o;let t=[];for(o of this.cache[i]){let e=void 0;e:for(var n of t)for(var a of n)if(0<=a.indexOf(o[0])||0<=a.indexOf(o[1])||0<=a.indexOf(o[2])){e=n;break e}e?e.push(o):t.push([o])}e&&(t=t.map(e=>{var t=e.map(e=>Ge.newPolygon().add(e[0].x,e[0].y,e[0].z).add(e[1].x,e[1].y,e[1].z).add(e[2].x,e[2].y,e[2].z));let l=1===t.length?t:Ke.union(t,0,!0,{wasm:!1});return l.merged=t.length,l.face=e[0],l})),l[i]=t}return l}}});"use strict";gapp.register("kiri-mode.sla.driver",[],(o,e)=>{const{kiri:i}=o,{driver:r}=i,a=r.SLA={prepare:n,legacy:!1};async function n(e,r,n){o.worker.print=i.newPrint(r,e),a.wasm||fetch("/wasm/kiri-sla.wasm").then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,{env:{reportf:(e,r)=>{console.log("[f]",e,r)},reporti:(e,r)=>{console.log("[i]",e,r)}}})).then(e=>{var{module:r,instance:n}=e,{exports:o}=n,i=new Uint8Array(o.memory.buffer);a.wasm={heap:i,memory:o.memory,render:o.render,rle_encode:o.rle_encode}}),n(1)}a.legacy&&console.log("SLA Driver in Legacy Mode")});"use strict";gapp.register("kiri-mode.sla.x_cxdlp",[],(root,exports)=>{const default_values={magic1:"CXSW3DV2",magic2:"CXSW3DV2",model:"CL-89",version:1,layer_count:0,res_x:3840,res_y:2400,height:0,thumb:void 0,preview1:void 0,preview2:void 0,dim_x:"192.000000",dim_y:"120.000000",layer:"0.050000",light_on:6,light_off:2,light_pwm:255,lift_dist:6,lift_speed:60,down_speed:150,base_layers:8,base_light_on:60,base_light_pwm:255,base_lift_dist:5,base_lift_speed:60},data_term=3338;class CXDLP{constructor(){Object.assign(this,default_values)}read(t){let r=new DataReader(t,0);function e(e){let t=r.readU32(),i="";for(;0<--t;)e&&(r.readU8(),t--),i+=String.fromCharCode(r.readU8());return e||r.skip(1),i}let i={view:t,magic1:e(),version:r.readU16(),model:e(),layer_count:r.readU16(),res_x:r.readU16(),res_y:r.readU16(),height:r.readU32(),skip:r.skip(60),thumb:r.readBytes(26912),skip:r.skip(2),preview1:r.readBytes(168200),skip:r.skip(2),preview2:r.readBytes(168200),skip:r.skip(2),dim_x:e(!0),dim_y:e(!0),layer:e(!0),light_on:r.readU16(),light_off:r.readU16(),base_light_on:r.readU16(),base_layers:r.readU16(),base_lift_dist:r.readU16(),base_lift_speed:r.readU16(),lift_dist:r.readU16(),lift_speed:r.readU16(),down_speed:r.readU16(),base_light_pwm:r.readU16(),light_pwm:r.readU16()},s=this.layers=[];for(let e=0;e<i.layer_count;e++)s.push({length:r.readU32()});if(r.readU16()!==data_term)throw"invalid data term @ "+(r.pos-2);for(let e=0;e<i.layer_count;e++){var a=r.readU32();if(a!==s[e].length)throw`layer length mismatch: ${a} != ${s[e].length} @ i=`+e;var l=r.readU32();if(s[e].lines=l,s[e].pos=r.pos,r.skip(6*l),r.readU16()!==data_term)throw"invalid data term @ "+(r.pos-2)}i.magic2=e();let n=0;for(let e=0;e<r.pos;e++)n^=t.getUint8(e);if(i.checksum=n,n!==r.readU32())throw"checksum mismatch";return delete i.skip,Object.assign(this,i),this}get_layer_lines(e){if(this.view){if(e>this.layers.length)throw"layer out of range 0-"+this.layers.length;let t=[];var s;let{lines:i,pos:r}=this.layers[e];for(let e=0;e<i;e++){var a=this.view.getUint16(r);r+=2;var l=this.view.getUint16(r);r+=2;var n=this.view.getUint16(r),o,d,h,_;r+=2,t.push({y_start:a>>3,y_end:(7&a)<<10|l>>6,x_end:(63&l)<<8|n>>8,color:255&n})}return t}throw"missing data view"}write(){let a=new ArrayWriter;a.write_string=function e(t,i=!1){var r=t.length;a.writeU32(i?2*r:r+1);let s=0;for(;s<r;)i&&a.writeU8(0),a.writeU8(t.charCodeAt(s++));i||a.writeU8(0)},a.write_bytes=function(i,e){if(i)if(i.byteLength){if(e!==i.byteLength)throw`invalid array length: ${i.byteLength} != `+e;let t=new DataReader(i);for(let e=0;e<i.byteLength;e++)a.writeU8(t.readU8())}else{if(!i.length)throw"invalid byte array";if(e!==i.length)throw`invalid array length: ${i.length} != `+e;a.writeBytes(i)}else a.skip(e)};var e=this.layers,t,i;this.layer_count=e.length,a.write_string(this.magic1),a.writeU16(this.version),a.write_string(this.model),a.writeU16(this.layer_count),a.writeU16(this.res_x),a.writeU16(this.res_y),a.writeU32(this.height),a.skip(60),a.write_bytes(this.thumb,26912),a.writeU16(data_term),a.write_bytes(this.preview1,168200),a.writeU16(data_term),a.write_bytes(this.preview2,168200),a.writeU16(data_term),a.write_string(this.dim_x,!0),a.write_string(this.dim_y,!0),a.write_string(this.layer,!0),a.writeU16(this.light_on),a.writeU16(this.light_off),a.writeU16(this.base_light_on),a.writeU16(this.base_layers),a.writeU16(this.base_lift_dist),a.writeU16(this.base_lift_speed),a.writeU16(this.lift_dist),a.writeU16(this.lift_speed),a.writeU16(this.down_speed),a.writeU16(this.base_light_pwm),a.writeU16(this.light_pwm);for(t of e)t.l1=a.pos,a.writeU32(0);a.writeU16(data_term);for(i of e){i.l2=a.pos,a.writeU32(0),a.writeU32(i.lines.length);var r=a.pos,s;for(s of i.lines){var l=s.y_start>>5,n=255&(s.y_start<<3|s.y_end>>10),o=s.y_end>>2&255,d=255&(s.y_end<<6|s.x_end>>8),h=255&s.x_end;a.writeU8(l),a.writeU8(n),a.writeU8(o),a.writeU8(d),a.writeU8(h),a.writeU8(s.color)}i.length=a.pos-r,a.writeU16(data_term)}a.write_string(this.magic2);var _=a.pos,w;for(w of e)a.seek(w.l1),a.writeU32(w.length),a.seek(w.l2),a.writeU32(w.length);a.seek(_);let f=0;var g=a.array;for(let e=0;e<g.length;e++)f^=g[e]||0;return a.writeU32(f),a.toBuffer()}}if(CXDLP.export=function(e){let{settings:t,width:i,height:r,slices:s}=e;var{thumb:a,preview1:l,preview2:n}=e;let{device:o,process:d}=t,h=new CXDLP;if(1620===i&&2560===r)h.model="CL-60";else if(3840===i&&2400===r)h.model="CL-89";else{if(3840!==i||2160!==r)throw`invalid printer dimensions ${i} x `+r;h.model="CL-133"}return h.layers=s.map(e=>({lines:e})),h.res_x=o.resolutionX,h.res_y=o.resolutionY,h.dim_x=o.bedWidth.toFixed(5),h.dim_y=o.bedDepth.toFixed(5),h.layer=d.slaSlice.toFixed(5),h.thumb=a,h.preview1=l,h.preview2=n,h.light_on=d.slaLayerOn,h.light_off=d.slaLayerOff,h.lift_dist=d.slaPeelDist,h.lift_speed=60*d.slaPeelLiftRate,h.base_layers=d.slaBaseLayers,h.base_light_on=d.slaBaseOn,h.base_lift_dist=d.slaBasePeelDist,h.base_lift_speed=60*d.slaBasePeelLiftRate,h.write()},CXDLP.render=function(e){let{width:t,height:s,index:r,widgets:i,scaleX:a,scaleY:l}=e,n=t/2,o=s/2,d=[],h=0,_=0;function w(r){var i=r.points;r._bounds=void 0;for(let t=0,e=i.length;t<e;t++){let e=i[t];e.y=s-(e.y*l+o),e.x=e.x*a+n}if(r.inner)for(let e=0,t=r.inner,i=r.inner.length;e<i;e++)w(t[e])}function f(i,e){var t=i.skip(2),r=e.inner;i.writeU16(r?r.length:0,!0);var s=e.points,a=e.bounds;i.writeU16(s.length,!0),i.writeU16(a.minx,!0),i.writeU16(a.maxx,!0),i.writeU16(a.miny,!0),i.writeU16(a.maxy,!0);for(let e=0,t=s.length;e<t;e++){var l=s[e];i.writeF32(l.x,!0),i.writeF32(l.y,!0)}if(r&&r.length)for(let e=0,t=r.length;e<t;e++)f(i,r[e]);i.view.setUint16(t,i.pos-t,!0)}i.forEach(t=>{let i=t.slices[r];if(i){i.synth&&h++;let e=i.unioned;e=e||i.tops.map(e=>e.poly),i.supports&&e.appendAll(i.supports),d.appendAll(e.map(e=>e.clone(!0).move(t.track.pos))),h+=e.length}});let g=kiri.driver.SLA.wasm;var p=t*s;let U=new self.DataWriter(new DataView(g.memory.buffer),p);U.writeU16(t,!0),U.writeU16(s,!0),U.writeU16(d.length,!0);for(let t=0,e=d.length;t<e;t++){let e=d[t];_+=e.areaDeep(),w(e),f(U,e)}g.render(0,p,0);var y=g.heap;let v=[];for(let r=0;r<t;r++){let t=0,i=0;for(let e=0;e<s;e++){var c=y[r*s+e];c!==i&&(i&&v.push({y_start:t,y_end:e,x_end:r,color:i}),c&&(t=e)),i=c}}return{lines:v,area:_}},!self.navigator&&self.process&&self.process.env){let fs=require("fs");eval(fs.readFileSync("src/add/class.js").toString());let args=process.argv.slice(2),file=args.shift(),view=new DataView(fs.readFileSync(file).buffer),read=new DataReader(view,0),cxdlp=(new CXDLP).read(view);console.log({cxdlp:cxdlp,layers5:cxdlp.layers.slice(0,5),lines1:cxdlp.get_layer_lines(1)})}else self.navigator&&(self.CXDLP=CXDLP)});"use strict";gapp.register("kiri-mode.sla.x_photons",[],(e,t)=>{var{base:r,kiri:s}=e,{driver:a}=s,{util:l}=r;const{SLA:S}=a;function i(e,t,f){let r=e.settings,s=r.process,a=r.device,l=t.width,i=t.height,n=t.lines.length,o=l*i,h=t.small,w=t.large,p=t.slices,g=s.slaAntiAlias||1,u=[],c;if(S.legacy||1<g){var U=8/g;for(let e=0;e<g;e++)u.push((1<<8-e*U)-1);let h=0,w=t.lines.length*g;var y=t.lines.map((e,t)=>{var r=e.length;let s=new DataView(e.buffer),a=new Uint8Array(e.length);var l=new DataView(a.buffer);let i=[{data:a,view:l}];for(let e=1;e<g;e++)a=a.slice(),l=new DataView(a.buffer),i.push({data:a,view:l});for(let e=0;e<g;e++){let t=i[e].view;var n=u[e];for(let e=0;e<r;e++){var o=s.getUint8(e);t.setUint8(e,o/g&n?1:0)}f(h++/w*.4,"layer_convert")}return{subs:i}});c=X(y,"photon",e=>{f(.4*e+.4,"layer_encode")})}else{var v=p.reduce((e,t)=>e+t.reduce((e,t)=>e+t.length,0),0);c={layers:p.map(e=>({sublayers:e})),length:v}}var d=c.layers.length,F=3e3+c.length+d*g*28+h.byteLength+w.byteLength,m=new ArrayBuffer(F);let b=new self.DataWriter(new DataView(m));var L=s.slaBaseLayers*s.slaBaseOn+(c.layers.length-s.slaBaseLayers)*s.slaLayerOn;b.writeU32(419495186),b.writeU32(2,!0),b.writeF32(68.04,!0),b.writeF32(120.96,!0),b.writeF32(150,!0),b.skip(12),b.writeF32(s.slaSlice,!0),b.writeF32(s.slaLayerOn,!0),b.writeF32(s.slaBaseOn,!0),b.writeF32(s.slaLayerOff,!0),b.writeU32(s.slaBaseLayers,!0),b.writeU32(1440,!0),b.writeU32(2560,!0);var k=b.skip(4),D=b.skip(4);b.writeU32(d,!0);var B=b.skip(4);b.writeU32(L,!0),b.writeU32(1,!0);var O=b.skip(4),x=b.skip(4);b.writeU32(g,!0),b.writeU16(255,!0),b.writeU16(255,!0);var P=b.pos;b.view.setUint32(O,b.pos,!0),b.writeF32(s.slaBasePeelDist,!0),b.writeF32(60*s.slaBasePeelLiftRate,!0),b.writeF32(s.slaPeelDist,!0),b.writeF32(60*s.slaPeelLiftRate,!0),b.writeF32(60*s.slaPeelDropRate,!0),b.writeF32(0,!0),b.writeF32(0,!0),b.writeF32(0,!0),b.writeF32(0,!0),b.writeF32(0,!0),b.writeU32(s.slaBaseLayers,!0),b.writeF32(0,!0),b.writeF32(0,!0),b.writeF32(0,!0),b.writeF32(0,!0),b.view.setUint32(x,b.pos-P,!0),b.view.setUint32(D,b.pos,!0);var A=c.layers;let V=[];for(let r=0;r<g;r++)for(let t=0;t<A.length;t++){let e=A[t].sublayers[r];b.writeF32(s.slaFirstOffset+s.slaSlice*t,!0),b.writeF32(t<s.slaBaseLayers?s.slaBaseOn:s.slaLayerOn,!0),b.writeF32(t<s.slaBaseLayers?s.slaBaseOff:s.slaLayerOff,!0),V.push(e.repos=b.skip(4)),b.writeU32(e.length,!0),b.skip(16)}let E=0;var C=A.length*g;for(let t=0;t<g;t++)for(let e=0;e<A.length;e++){var _=A[e].sublayers[t];b.view.setUint32(_.repos,b.pos,!0);for(let e=0;e<_.length;e++)b.writeU8(_[e],!1);f(E++/C*.1+.9,"layer_write")}return b.view.setUint32(k,b.pos,!0),Y({width:400,height:300,data:t.large},b),b.view.setUint32(B,b.pos,!0),Y({width:200,height:125,data:t.small},b),m}function n(e,i,n){let t=e.settings,o=t.process,r=t.device,s=i.width,a=i.height,l=i.slices,h=i.lines.length,w=s*a,f;var p,g;f=S.legacy?X(p=i.lines.map((e,t)=>{var r=e.length/4,s=new Uint8Array(e.length/4);let a=new DataView(s.buffer),l=new DataView(e.buffer);for(let e=0;e<r;e++)a.setUint8(e,0<l.getUint8(4*e)?1:0);return n(t/i.lines.length),{subs:[{exposureTime:o.slaLayerOn,data:s}]}}),"photons"):(g=l.reduce((e,t)=>e+t.reduce((e,t)=>e+t.length,0),0),{layers:l.map(e=>({sublayers:e})),length:g});var u=new ArrayBuffer(75366+f.length+28*h);let c=new DataView(u),U=0;c.setUint32(0,2,!1),c.setUint32(4,3227560,!1),c.setUint32(8,824633720,!1),c.setUint16(12,10,!1),c.setFloat64(14,o.slaSlice,!1),c.setFloat64(22,o.slaLayerOn,!1),c.setFloat64(30,o.slaLayerOff,!1),c.setFloat64(38,o.slaBaseOn,!1),c.setUint32(46,o.slaBaseLayers,!1),c.setFloat64(50,o.slaPeelDist,!1),c.setFloat64(58,o.slaPeelLift,!1),c.setFloat64(66,o.slaPeelDrop,!1),c.setFloat64(74,69420,!1),c.setUint32(82,224,!1),c.setUint32(86,42,!1),c.setUint32(90,168,!1),c.setUint32(94,10,!1),c.setUint32(75362,h,!1),U=75366;for(let e=0;e<h;e++){var y,v=f.layers[e].sublayers[0],d=v.length;c.setUint32(U+0,69420,!1),c.setFloat64(U+4,0),c.setUint32(U+12,a,!1),c.setUint32(U+16,s,!1),c.setUint32(U+20,8*d+32,!1),c.setUint32(U+24,2684702720,!1),U+=28;for(let e=0;e<d;e++)c.setUint8(U+e,v[e],!1);U+=d,n(e/h/2+.5)}return u}function X(a,l,i){let n=[],o=0,h=0,w=0;a.forEach(e=>{e.subs.forEach(e=>h++)});for(let e=0;e<a.length;e++){let t=a[e].subs,r=[],s=0;for(let e=0;e<t.length;e++){var f,p=g(t[e].data,l);if(s+=p.length,r.push(p),i&&i(w++/h),"photons"==l)break}o+=s,n.push({sublength:s,sublayers:r})}return{length:o,layers:n}}function g(t,r){let s="photons"===r?128:125,a=t[0],l=1,i=[];for(let e=1;e<t.length;e++){var n=t[e];n!==a?(i.push(o(a,l,r)),a=n,l=1):l===s?(i.push(o(a,l,r)),l=1):l++}return 0<l&&i.push(o(a,l,r)),i}function o(e,t,r){switch(r){case"photon":return 127&t|e<<7&128;case"photons":return(1&--t?128:0)|(2&t?64:0)|(4&t?32:0)|(8&t?16:0)|(16&t?8:0)|(32&t?4:0)|(64&t?2:0)|e}}function h(t,e){let r=[];if("photon"===e)for(let e=0;e<t.length;e++){var s=t[e],a=s>>7,l=127&s;for(let e=0;e<l;e++)r.push(a)}else for(let e=0;e<t.length;e++){var i=t[e],n=1&i,o=1+((128&i?1:0)|(64&i?2:0)|(32&i?4:0)|(16&i?8:0)|(8&i?16:0)|(4&i?32:0)|(2&i?64:0));for(let e=0;e<o;e++)r.push(n)}return r}function Y(e,t){var r=new Uint8Array(e.data),s=r.byteLength;t.writeU32(e.width,!0),t.writeU32(e.height,!0);var a=t.skip(4);t.writeU32(s/2,!0),t.view.setUint32(a,t.pos,!0);let l=0;for(;l<s;){var i=r[l++],n=r[l++],o=r[l++],h=r[l++],w;t.writeU16((i/4&31)<<11|(n/4&31)<<6|(o/4&31)<<0,!0)}}function w(e){let{width:t,height:a,index:s,widgets:r,scaleX:l,scaleY:i,masks:n}=e,o=t/2,h=a/2,w=[],f=0,p=0;function g(s){var r=s.points;s._bounds=void 0;for(let t=0,e=r.length;t<e;t++){let e=r[t];e.y=a-(e.y*i+h),e.x=e.x*l+o}if(s.inner)for(let e=0,t=s.inner,r=s.inner.length;e<r;e++)g(t[e])}function u(r,e){var t=r.skip(2),s=e.inner;r.writeU16(s?s.length:0,!0);var a=e.points,l=e.bounds;r.writeU16(a.length,!0),r.writeU16(l.minx,!0),r.writeU16(l.maxx,!0),r.writeU16(l.miny,!0),r.writeU16(l.maxy,!0);for(let e=0,t=a.length;e<t;e++){var i=a[e];r.writeF32(i.x,!0),r.writeF32(i.y,!0)}if(s&&s.length)for(let e=0,t=s.length;e<t;e++)u(r,s[e]);r.view.setUint16(t,r.pos-t,!0)}r.forEach(t=>{let r=t.slices[s];if(r){r.synth&&f++;let e=r.unioned;e=e||r.tops.map(e=>e.poly),r.supports&&e.appendAll(r.supports),w.appendAll(e.map(e=>e.clone(!0).move(t.track.pos))),f+=e.length}});let c=S.wasm;var U=t*a;let y=new self.DataWriter(new DataView(c.memory.buffer),U);y.writeU16(t,!0),y.writeU16(a,!0),y.writeU16(w.length,!0);for(let t=0,e=w.length;t<e;t++){let e=w[t];p+=e.areaDeep(),g(e),u(y,e)}c.render(0,U,0);let v=c.heap.slice(0,U),d=[];for(let e=0;e<n.length;e++){var F=c.rle_encode(0,0,U,n[e],U,0);d.push(c.heap.slice(U,U+F))}return{image:v,layers:d,end:0===f,area:p}}function f(e){let{width:t,height:r,index:s,widgets:a,scaleX:l,scaleY:i}=e,n=new OffscreenCanvas(r,t),o={scaleX:l,scaleY:i,width:t,height:r,width2:t/2,height2:r/2},h=n.getContext("2d");h.fillStyle="rgb(200, 0, 0)";let w=0,f=0;a.forEach(t=>{let r=t.slices[s];if(r){r.synth&&w++;let e=r.unioned;e=e||r.tops.map(e=>e.poly),r.supports&&e.appendAll(r.supports),e.forEach(e=>{f+=e.areaDeep(),e.move(t.track.pos),h.beginPath(),u(e.setClockwise(),h,o),e.inner&&e.inner.forEach(e=>{u(e.setCounterClockwise(),h,o)}),h.fill(),w++})}});var p=h.getImageData(0,0,r,t).data;let g=new Uint8ClampedArray(p.length/4);for(let e=0;e<g.length;e++)g[e]=p[4*e];return{image:g,end:0===w,area:f}}function u(e,r,t){let{scaleX:s,scaleY:a,width:l,height:i,width2:n,height2:o}=t;e.forEachPoint((e,t)=>{0===t?r.moveTo(i-(e.y*a+o),e.x*s+n):r.lineTo(i-(e.y*a+o),e.x*s+n)},!0),r.closePath()}self.photon={generatePhoton:i,generatePhotons:n,renderLayer:f,renderLayerWasm:w}});"use strict";gapp.register("kiri-mode.sla.export",[],(e,t)=>{var{base:r,kiri:a}=e,{driver:s}=a,{util:i}=r;const{SLA:I}=s;function o(e,t,r){console.log({generateCXDLP:e,conf:t,progress:r})}I.export=function(n,h,g){let c=n.widgets,e=n.settings,p=e.device,t=e.process,d=p.resolutionX,v=p.resolutionY,u=d/p.bedWidth,m=v/p.bedDepth,w=t.slaSlice,f=t.slaAntiAlias||1,r=Date.now(),b=0,y=0;c=c.filter(e=>!e.track.ignore&&!e.meta.disabled),c.forEach(e=>{b=Math.max(e.slices.length)});let a=!1;switch(p.deviceName){case"Anycubic.Photon":case"Anycubic.Photon.S":a=!0}if(a){let e=I.legacy||1<f,r=e?.25:.85,a=1-r,t=[],s=[];var P=8/f;let i=[];for(let e=0;e<f;e++)i.push((1<<8-e*P)-1);let o=e?photon.renderLayer:photon.renderLayerWasm;for(let e=0;e<b;e++){var L={index:e,width:d,height:v,widgets:c,scaleX:u,scaleY:m,masks:i},{image:x,layers:A,end:k,area:D}=o(L);if(y+=D*w,t.push(x),s.push(A),h({progress:e/b*r,message:"image_gen"}),k)break}let l={"Anycubic.Photon":photon.generatePhoton,"Anycubic.Photon.S":photon.generatePhotons}[p.deviceName]||photon.generatePhoton;var S=l(n,{width:d,height:v,small:I.previewSmall.data,large:I.previewLarge.data,lines:t,slices:s},(e,t)=>{h({progress:e*a+r,message:t})});g({width:d,height:v,file:S,layers:t.length,volume:y},[S])}else{var s=.95,i=1-s;let t=[];for(let e=0;e<b;e++){var o={index:e,width:d,height:v,widgets:c,scaleX:u,scaleY:m},{lines:l,area:X}=CXDLP.render(o);if(y+=X*w,t.push(l),h({progress:e/b*s,message:"image_gen"}),0===l.length)break}let r=[];var C=I.previewSmall.data;for(let t=0;t<116;t++)for(let e=0;e<116;e++){var Y=4*(116*t+e),N,W,_,E=65535&(C[0+Y]>>3<<11|C[1+Y]>>2<<5|C[2+Y]>>3);r.push(E>>8&255),r.push(255&E)}let a=[];var M=I.previewLarge.data;for(let t=0;t<290;t++)for(let e=0;e<290;e++){var j=4*(290*t+e),q,z,B,F=65535&(M[0+j]>>3<<11|M[1+j]>>2<<5|M[2+j]>>3);a.push(F>>8&255),a.push(255&F)}var G=a,H=CXDLP.export({settings:e,width:d,height:v,slices:t,thumb:r,preview1:a,preview2:G});g({width:d,height:v,file:H,layers:t.length,volume:y},[H])}console.log("print.export",Date.now()-r)}});"use strict";gapp.register("kiri-mode.sla.slice",[],(e,t)=>{const{base:z,kiri:E}=e,{driver:n,newSlice:v,newTop:M}=E,{util:l,newPoint:s,newPolygon:d,polygons:a}=z,{SLA:_}=n,D=a,P=n.FDM.share,A=l.pwait;let L;function T(e){e.slices.forEach(e=>{const n=e.output(),t=.6,l=65793;e.unioned?e.unioned.forEach(e=>{e=e.clone(!0),n.setLayer("layers",{line:l,face:39372,lopacity:.6}).addAreas([e],{outline:!0})}):e.tops&&e.tops.forEach(e=>{var t=e.poly;n.setLayer("layers",{line:l,face:16562691,lopacity:.6}).addAreas([t],{outline:!0})}),e.supports&&e.supports.forEach(e=>{n.setLayer("support",{line:l,face:16562691,lopacity:.6}).addAreas([e],{outline:!0})})})}function k(e,n,l){let t=e.union.reduce((e,t)=>e+t.areaDeep(),0),s=e.union.reduce((e,t)=>e+t.perimeter(),0),a=e.slices,r=a.length,o=0,i=0,p=a.filter(e=>!e.synth);p.forEach(e=>{e.mass=e.unioned.reduce((e,t)=>e+t.areaDeep(),0),e.up&&e.up.bridges?(e.bear=e.up.bridges.reduce((e,t)=>e+t.areaDeep(),0),e.bear_up=e.up.bridges,i+=e.bear):e.bear=0,o+=e.mass});let c=o/i*(1/n.slaSupportDensity),h;p.slice().map((e,t)=>(!h&&e.bear&&(e.ord_first=h=!0),e.ord_weight=Math.pow(30,(p.length-t)/p.length),e)).sort((e,t)=>e.ord_first?-1:t.ord_first?1:t.bear*t.ord_weight-e.bear*e.ord_weight).forEach((e,t)=>{e.ord_bear=t});let u=o,f=i;var d,y,g=0,m=[];p.forEach(e=>{e.rem_mass=u,e.rem_bear=f,e.can_bear=e.bear*c,u-=e.mass,f-=e.bear});var x=p.sort((e,t)=>e.ord_bear-t.ord_bear);u=o,f=i;for(let e=0;e<x.length;e++){let t=x[e],n=Math.min(t.can_bear,t.rem_mass);for(let e=t.index-1;e>p[0].index;e--)a[e].rem_mass-=n;if(u-=n,t.can_emit=!0,u<=0)break}let S=0,b=0,w=10*(1-n.slaSupportDensity),E=Math.bound(n.slaSupportSize/2,.25,1);a.forEach((t,e)=>{t.can_emit&&(0===S||5<t.index-b?(t.bear_up.map(e=>e.clone(!0).setZ(t.z)).forEach(e=>{C(n,t,e,E,w)}),S++):5<S?S=0:S++,b=t.index),l(1/a.length)}),a.forEach(e=>{e.supports&&(e.supports=D.union(e.supports,0,!0))})}function C(n,l,s,a,p){let c=.1<s.circularityDeep(),h=[s];for(;h.length;){s=h.shift();let r=[],o=[],e=s.perimeter(),i=0,t=s.clone(!0).flattenTo([]);for(t.forEach(e=>e.forEachSegment((e,t)=>{var n={dist:e.distTo2D(t),p1:e,p2:t};(p<=n.dist||l.ord_first)&&i++,o.push(n)})),o.sort((e,t)=>t.dist-e.dist);o.length&&(0<i||r.length<3);){let{dist:l,p1:s,p2:a}=o.shift();if(p<=l){let e=Math.ceil(l/p)+1,t=l/e,n=s;for(;0<=e--;)r.push(n),n=n.offsetPointTo(a,t);i--}else r.push(s.offsetPointTo(a,l/2))}if(!l.ord_first)e:for(let t=0;t<r.length;t++){for(let e=t+1;e<r.length;e++)if(r[t].distTo2D(r[e])<=a){r[t]=null;continue e}l.pillars&&l.pillars.forEach(e=>{r[t]&&r[t].distTo2D(e.point)<=a&&(r[t]=null)})}r.filter(e=>null!==e).forEach(e=>{let t=y(n,l,e,a,[]);t.length&&!(t.max||t.synth||t.merged)&&t.forEach(e=>{let t=e.slice.supports;var n=t.indexOf(e.pillar);0<=n&&t.splice(n,1)})}),c&&s.offset(Math.max(.2,1-n.slaSupportDensity),h)}}function y(e,l,s,t,a){l.supports||(l.supports=[]),l.pillars||(l.pillars=[]);let r=e.slaSupportPoints,o=d().centerCircle(s,t/2,r,!0).setZ(l.z),n=e.slaSupportSize,i=e.slaSlice/2,p=!1,c=[],h=[],u=l.index<e.slaSupportGap+e.slaSupportLayers;if(a.min=a.min?Math.min(a.min,t):t,a.max=!!a.max||t>=n,a.synth=a.synth||l.synth,l.tops.forEach(n=>{3<a.length&&s.isInPolygon(n.poly)&&(p=!0),o.points.forEach(e=>{var t;(e.isInPolygon(n.poly)?c:h).push(e)})}),p){if(!l.synth&&a.max){let l=a.min;for(;a.length;){let e=a.pop(),t=d().centerCircle(e.point,l/2,r,!0).setZ(e.slice.z),n=e.slice.supports.indexOf(e.pillar);if(0<=n&&(e.slice.supports[n]=t,l+=i),l>e.size)break}}return a}let f=s;if(c.length){if(h.length){let t=0,n=0;h.forEach(e=>{t+=e.x,n+=e.y}),t/=h.length,n/=h.length,f=s.offsetPointTo({x:t,y:n,z:l.z},i)}a.max&&(t-=i)}else a.max&&!u||(t+=i,u&&(n+=e.slaSupportGap*e.slaSlice*2));return t<a.min||(l.supports.push(o),l.pillars.push({point:s,pillar:o,size:t}),a.push({slice:l,point:s,pillar:o,size:t}),l.down&&y(e,l.down,f,Math.min(t,n),a)),a}function F(t,e){let n=e.process,l=e.device,s=t.unioned,a=e.bounds,r=a.max.x-a.min.x,o=a.max.y-a.min.y,i=Math.max(r,o),p=Math.round(n.slaFillLine/n.slaSlice),c=n.slaFillLine,h=r/c*n.slaFillDensity,u=o/c*n.slaFillDensity,f=r/h,d=o/u,y=-r/2,g=-o/2,m=r/2,x=o/2,S=[],b=Math.floor(t.index/p),w=b%4,E=L[w];if(!E&&1!=w)for(let e=y;e<m;e+=f)S.push(z.newPolygon().centerRectangle({x:e+f/2,y:0,z:t.z},c,o));if(!E&&3!=w)for(let e=g;e<x;e+=d)S.push(z.newPolygon().centerRectangle({x:0,y:e+d/2,z:t.z},r,c));E?S=E.slice().map(e=>e.clone(!0).setZ(t.z)):(S=D.union(S,0,!0),L[w]=S),S=D.trimTo(S,t.tops.map(e=>e.poly)),S=D.union(t.unioned.appendAll(S),0,!0),t.unioned=S}function h(e,t,n){var l=4*(t+e.width*n),s=e.data;return[s[l++],s[l++],s[l++],s[l++]]}function m(e,t,n,l,s){let a=[0,0,0,0],r=0,o,i,p,c;for(o=t;o<l;o++)for(i=n;i<s;i++){for(c=h(e,o,i),p=0;p<4;p++)a[p]+=c[p];r++}for(p=0;p<4;p++)a[p]=Math.abs(a[p]/r);return a}function O(n,e,t){let l=e,s=t,a=e/t,r=n.width/n.height,o=new Uint8Array(l*s*4),i,p,c,h,u,f,d,y,g;c=a<=r?(i=n.height/s,p=Math.round((n.width-l*i)/2),0):(i=n.width/l,p=0,Math.round((n.height-s*i)/2));for(let t=0;t<s;t++)if(!((f=Math.round(t*i+c))<0||f>n.height)){d=Math.round((t+1)*i+c);for(let e=0;e<l;e++)(h=Math.round(e*i+p))<0||h>n.width||(u=Math.round((e+1)*i+p),y=4*(t*l+e),g=m(n,h,f,u,d),o[0+y]=g[0],o[1+y]=g[1],o[2+y]=g[2],o[3+y]=g[3])}return{width:e,height:t,data:o,png:n}}_.slice=function(n,u,l,s){let{process:f,device:e,controller:t}=n,a=t.threaded&&E.minions.concurrent,r,o;if(_.legacy&&!self.OffscreenCanvas)return s("browser lacks support for OffscreenCanvas",!0);function i(e,t){l(.25+(r-o)/r*.75,t),o-=e}function d(n,l,s,a){n.forEach(function(e,t){s(e,t),i(l/n.length,a)})}let p={x:200,y:125},c={x:400,y:300};switch(e.deviceName){case"Anycubic.Photon":case"Anycubic.Photon.S":break;case"Creality.Halot.One":case"Creality.Halot.Max":case"Creality.Halot.Sky":p={x:116,y:116},c={x:290,y:290}}let h=self.worker.snap.url;var y=atob(h.substring(h.indexOf(",")+1)),g=Uint8Array.from(y,e=>e.charCodeAt(0));let m=new png.PNG;m.parse(g,(e,t)=>{_.preview=m,_.previewSmall=O(m,p.x,p.y),_.previewLarge=O(m,c.x,c.y)});let x=f.slaSlice||.05;async function S(p){if(p=u.slices=p.filter(e=>e.tops.length),!f.slaOpenTop&&!f.xray){let e=v(b.max.z+x);e.index=p.last().index+1,p.push(e)}if(f.slaSupportEnable&&f.slaSupportLayers){let n=f.slaSupportLayers,l=x/2,s=[],t=[],a=f.slaSupportGap,r=x,e=1-n*r;var c=p.forEach(e=>{t.appendAll(e.tops.map(e=>e.poly.clone()))}),h=D.union(t,void 0,!0).map(e=>e.clone());let o=D.expand(h,e,l,[],1),i;for(let e=0;e<n+a;e++){let t=v(l);t.height=x,t.index=s.length,e<n&&(t.synth=!0,o.forEach(e=>{t.tops.push(M(e.clone(!0).setZ(l)))}),o=D.expand(o,r,l,[],1),i=t),s.push(t),l+=x}l-=x/2,p=u.slices=s.concat(p.map(t=>(t.tops.forEach(e=>e.poly.setZ(t.z+l)),t.index+=s.length,t.z+=l,t))),u.union=h,u.lastraft=i}for(let e=1;e<p.length;e++)p[e-1].up=p[e],p[e].down=p[e-1];let t=Math.round(f.slaShell/f.slaSlice);if(p.forEach(function(e){e.solids=[]}),r=[5,10,t?10:0,t?10:0,t?0:10,f.slaFillDensity&&f.slaShell?60:0,f.slaSupportEnable&&f.slaSupportLayers&&f.slaSupportDensity?100:0].reduce((e,t)=>e+t),o=r,d(p,5,(e,t)=>{f.slaShell?P.doShells(e,2,0,f.slaShell):P.doShells(e,1,0)},"shells"),d(p,10,e=>{e.synth||P.doDiff(e,1e-6,{sla:!0,fakedown:!f.slaOpenBase})},"delta"),t){async function l(t){if(!t.synth){let e=D.nest(D.flatten(t.topShells()));var n;t.solids?(n=t.solids||[],e.appendAll(n),t.unioned=D.setZ(await E.minions.union(e),t.z)):t.unioned=e}}d(p,10,e=>{e.synth||(P.projectFlats(e,t),P.projectBridges(e,t))},"project");let n=p.map(e=>l(e));await A(n,(e,t)=>{i(10/n.length,"solid")})}else d(p,10,e=>{e.synth||(e.unioned=e.topPolys())},"solid");f.slaFillDensity&&f.slaShell&&(L=[],d(p,60,e=>{e.synth||F(e,n)},"infill")),f.slaSupportEnable&&f.slaSupportLayers&&f.slaSupportDensity&&k(u,f,e=>{i(100*e,"support")}),T(u)}let b=u.getBoundingBox();var w=u.getPoints();z.slice(w,{indices:f.indices||f.xray,union:t.healMesh,debug:f.xray,xray:f.xray,zMin:b.min.z+x/2,zMax:b.max.z,zInc:x,slicer(e,t,n){return(a?E.minions:z).sliceZ(e,t,n)},onupdate(e){return l(0+.25*e)}}).then(e=>{var t;S(u.slices=e.slices.map(e=>{var{z:t,lines:n,groups:l}=e,s=D.nest(l);return v(t).addTops(s)})).then(s)})}});"use strict";gapp.register("kiri-mode.wedm.driver",[],(e,r)=>{var{kiri:t,moto:i}=e;const a=t.driver,{CAM:o,LASER:c}=a;var{TYPE:n}=c,s=a.WEDM=Object.assign({},c,{name:"WireEDM",type:n.WEDM,init:g,prepare:v}),f=Math.PI/180;const u={api:void 0,alert:void 0,radians:0,surfaces:[],selecting:!1};function d(){if(u.selecting)return l();const{api:a,radians:n,surfaces:s}=u;o.surface_prep(n,()=>{a.hide.alert(alert),u.alert=a.show.alert("[esc] cancels surface selection");for(var[e,r]of Object.entries(s)){var t=a.widgets.forid(e);if(t&&r.length)for(var i of r)o.surface_toggle(t,i,n,e=>{})}a.feature.on_mouse_up=(e,r)=>{var{face:t}=e,i,a=Math.min(t.a,t.b,t.c)/3;let c=e.object.widget;o.surface_toggle(c,a,n,e=>{s[c.id]=e})},u.selecting=!0})}function l(){if(u.selecting){const{api:t,alert:i,surfaces:a}=u;for(var e of Object.keys(a)){var r=t.widgets.forid(e);r?o.surface_clear(r):delete a[e]}t.hide.alert(i),t.feature.on_mouse_up=void 0,t.ui.faceAdd.classList.remove("editing"),u.selecting=!1}}function g(e,i,r){c.init(e,i,r),(u.api=i).event.on("key.esc",()=>{u.selecting&&l()}),i.event.on("preview.view",e=>{var r,t;i.conf.get().process.ctOriginBounds&&(t=(new THREE.Box3).expandByObject(e),i.platform.set_bounds(new THREE.Box3(new THREE.Vector3(t.min.x,t.min.z,t.min.y),new THREE.Vector3(t.max.x,t.max.z,t.max.y))))}),i.event.on("button.click",e=>{var r=i.conf.get().process;switch(e){case i.ui.faceAdd:return e.classList.add("editing"),d();case i.ui.faceDun:return l();case i.ui.faceClr:i.uc.confirm("clear surface selection?").then(e=>{})}})}async function v(e,r,t){e=e.filter(e=>!e.track.ignore&&!e.meta.disabled),c.prepare(e,r,t)}});"use strict";gapp.register("kiri-mode.wjet.driver",[],(e,r)=>{const i=e.kiri.driver;var{LASER:t}=i,{TYPE:s}=t;i.WJET=Object.assign({},t,{name:"WaterJet",type:s.WJET})});"use strict";gapp.register("kiri.widget",[],(e,t)=>{const{base:i,kiri:h}=e,{api:n,driver:l,utils:s}=h;var{util:r,polygons:o}=i;const{Mesh:a,newPoint:c,verticesToPoints:d}=i,{inRange:u,time:m}=r,{avgc:p,trackFn:g}=s,f=1,v=[],x=self.SharedArrayBuffer||void 0,y=!!x;let w=0;function E(e,t){return new k(e,t)}function b(){return h.catalog}function M(){return b().index}class k{constructor(e,t){this.id=e||Date.now().toString(36)+w++,this.grouped=!!t,this.group=t||[],this.group.push(this),this.group.id||(this.group.id=this.id),v.indexOf(this.group)<0&&v.push(this.group),this.roto=[],this.adds=[],this.anno={},this.mesh=null,this.points=null,this.bounds=null,this.wire=null,this.slices=null,this.settings=null,this.modified=!0,this.track={box:{w:0,h:0,d:0},scale:{x:1,y:1,z:1},rot:{x:0,y:0,z:0},pos:{x:0,y:0,z:0},top:0,mirror:!1,indexed:!1},this.cache={},this.stats={slice_time:0,load_time:0,progress:0},this.meta={url:null,file:null,saved:!1},this.support=!1}saveToCatalog(e){if(this.grouped)return this;var t=this;const i=m(),s=t.getGeoVertices({unroll:!0}).slice();return t.meta.file=e,t.meta.save=i,b().putFile(e,s,()=>{console.log("saved mesh ["+s.length/3+"] time ["+(m()-i)+"]")}),this}saveState(t){if(!t)return clearTimeout(this._save_timer),void(this._save_timer=setTimeout(()=>{this._save_timer=void 0,this.saveState(()=>{})},1500));const i=this;M().put("ws-save-"+this.id,{geo:i.getGeoVertices({unroll:!1}).slice(),track:i.track,group:this.group.id,meta:this.meta,anno:this.annotations()},e=>{i.meta.saved=m(),t&&t()})}annotations(){var e=Object.clone(this.anno);if(e.support)for(var t of e.support)delete t.box;return e}#newBuffer(e){return new(y?SharedArrayBuffer:ArrayBuffer)(e)}loadVertices(e,t={index:!1}){let i,s=!1;if(!ArrayBuffer.isView(e)&&"object"==typeof e)throw i=e.vertices,"deprecated vertex data format";if(i=e,i.buffer&&y&&i.buffer instanceof x){let e=new Float32Array(this.#newBuffer(i.buffer.byteLength));e.set(i),i=e}switch(typeof s){case"boolean":s=t;break;case"object":s=t.autoscale}if(i){if(!0===s){let t=0;for(let e=0;e<i.length;e++)t=Math.max(t,Math.abs(i[e]));if(t<1)for(let e=0;e<i.length;e++)i[e]*=1e3}if(this.mesh){let e=this.mesh.geometry;return e.setAttribute("position",new THREE.BufferAttribute(i,3)),e.attributes.position.needsUpdate=!0,this.meta.vertices=i.length/3,this.points=null,this}{let e=new THREE.BufferGeometry;return e.setAttribute("position",new THREE.BufferAttribute(i,3)),this.meta.vertices=i.length/3,this.points=null,this.loadGeometry(e)}}console.log("missing vertices",{data:e,options:t})}loadData(){return this.loadVertices(...arguments)}setModified(){this.modified=!0,this.mesh&&this.mesh.geometry&&(this.mesh.geometry.boundingSphere=null)}getVertices(){return this.mesh.geometry.attributes.position}loadGeometry(e){const t=new THREE.Mesh(e,[new THREE.MeshPhongMaterial({side:THREE.DoubleSide,color:16776960,specular:2105376,shininess:120,transparent:!0,opacity:1,clipIntersection:!1,flatShading:!0}),new THREE.MeshPhongMaterial({side:THREE.DoubleSide,color:35054,specular:2105376,shininess:100,transparent:!0,opacity:1,flatShading:!0})]);return t.renderOrder=1,e.addGroup(0,1/0,0),(t.widget=this).mesh=t,this.center(!0),this}groupBounds(){return R.bounds(this.group)}setPoints(e){return this.points=e||null,this}clearSlices(){let e=this.slices,t=this.mesh;e&&t&&t.remove&&e.forEach(function(e){t.remove(e.view)}),this.slices=null}setColor(e,t,i=!0){t&&console.trace("legacy call with settings"),Array.isArray(e)&&(e=e[this.getExtruder()%e.length]),i&&(this.color=e);let s=this.getMaterial();s.color.set(this.meta.disabled?p(8947848,e,3):e)}getColor(){return this.color}getMaterial(){return this.mesh.material[0]}setZClip(e,t){let i=this.getMaterial();i.clippingPlanes=0<=e&&0<=t?[new THREE.Plane(new THREE.Vector3(0,1,0),-e),new THREE.Plane(new THREE.Vector3(0,-1,0),t)]:null,moto.space.refresh()}isVisible(){return this.getMaterial().visible}selectFaces(e){var t=mesh.util.facesToGroups(e||[]),i;let s=this.mesh.geometry;s.clearGroups();for(i of t)s.addGroup(3*i.start,3*i.count,i.mat||0)}setOpacity(e){var t=this.mesh;const i=this.getMaterial();e<=0?(i.transparent=!1,i.opacity=1,i.visible=!1):u(e,0,1)&&(i.transparent=e<1,i.opacity=e,i.visible=!0)}toggleVisibility(e){const t=this.getMaterial();t.visible=e??!t.visible}center(e){let t=e?this.mesh.getBoundingBox(!0):this.groupBounds(),i=t.min.clone(),s=t.max.clone(),r=s.sub(i).multiplyScalar(.5),o=i.x+r.x,a=i.y+r.y,n=i.z;return this.track.indexed&&(n+=r.z),this.track.center={dx:o,dy:a,dz:n},e||this.group.forEach(e=>{e.moveMesh(o,a,n)}),this}moveMesh(t,i,s){let e=this.mesh.geometry.attributes.position,r=e.array;if(t||i||s){for(let e=0;e<r.length;e+=3)r[e]-=t,r[e+1]-=i,r[e+2]-=s;e.needsUpdate=!0}var o=this.groupBounds();this.track.box={w:o.max.x-o.min.x,h:o.max.y-o.min.y,d:o.max.z-o.min.z},(t||i||s)&&(this.points=null,this.setModified())}get isIndexed(){return!!this.track.indexed}setIndexed(e){e!==this.track.indexed&&(this.track.indexed=e,this.center(!1),this._updateMeshPosition())}setAxisIndex(e){var t=e*(Math.PI/180);t!==this.track.indexRad&&(this.track.indexRad=t,this._updateMeshPosition())}setTopZ(e){let t=this.mesh,i=this.track,s=t.getBoundingBox(),r=s.max.z,o=this.isIndexed;i.top=o&&null!=e||!o&&e?e:r,i.tzoff=r-e,this._updateMeshPosition()}move(t,i,s,r){this.group.forEach(e=>{e._move(t,i,s,r)}),(t||i||s)&&n&&n.event&&n.event.emit("widget.move",{widget:this,pos:{x:t,y:i,z:s},abs:r})}_move(e,t,i,s){let r=this.mesh,o=this.getMaterial(),a=this.track.pos;o.visible&&(s?(a.x=e||0,a.y=t||0,a.z=i||0):(a.x+=e||0,a.y+=t||0,a.z+=i||0),(e||t||i)&&(this.setModified(),this._updateMeshPosition()))}_updateMeshPosition(){let e=this.mesh,t=this.track,i=t.tzoff,s=t.top,r=i!==s?-i:0,{x:o,y:a,z:n}=t.pos;var h,l,c,d;t.indexed?(h=t.indexRad,l=t.box.d/2,c=Math.sin(h)*l,d=l-Math.cos(h)*l,this.mesh.rotation.x=-h,n=s):(this.mesh.rotation.x=0,n+=r),e.position.set(o,a,n)}scale(t,i,s){this.group.forEach(e=>{e._scale(t,i,s)}),this.center(!1),n&&n.event&&n.event.emit("widget.scale",{widget:this,x:t,y:i,z:s})}_scale(e,t,i){let s=this.mesh,r=this.track.scale;this.bounds=null,this.setWireframe(!1),this.clearSlices(),s.geometry.applyMatrix4((new THREE.Matrix4).makeScale(e,t,i)),r.x*=e||1,r.y*=t||1,r.z*=i||1,this.setModified()}rotate(t,i,s,r,e=!0){this.group.forEach(e=>{e._rotate(t,i,s,r)}),e&&this.center(!1),(t||i||s)&&n&&n.event&&n.event.emit("widget.rotate",{widget:this,x:t,y:i,z:s})}_rotate(t,i,s,e){e||(this.bounds=null,this.setWireframe(!1),this.clearSlices());let r=new THREE.Matrix4;var o="number"==typeof t;if(r=o?r.makeRotationFromEuler(new THREE.Euler(t||0,i||0,s||0)):r.makeRotationFromQuaternion(t),this.roto.push(r),this.mesh.geometry.applyMatrix4(r),!e&&o){let e=this.track.rot;e.x+=t||0,e.y+=i||0,e.z+=s||0}this.setModified()}unrotate(){this.roto.reverse().forEach(e=>{this.mesh.geometry.applyMatrix4(e.clone().invert())}),this.roto=[],this.center(),this.setModified()}mirror(){this.group.forEach(e=>{e._mirror()}),this.center(),n&&n.event&&n.event.emit("widget.mirror",{widget:this})}_mirror(){this.clearSlices(),this.setWireframe(!1);let e=this.mesh.geometry,t=this.track,i=e.attributes.position,s=i.array;var r=i.count;for(let e=0;e<r;e++)s[3*e]=-s[3*e];for(let e=0;e<r;e+=3){var o=s[3*e+0],a=s[3*e+1],n=s[3*e+2];s[3*e+0]=s[3*e+6],s[3*e+1]=s[3*e+7],s[3*e+2]=s[3*e+8],s[3*e+6]=o,s[3*e+7]=a,s[3*e+8]=n}i.needsUpdate=!0,t.mirror=!t.mirror,this.setModified(),this.points=null}getTabVertices(){const e=[];if(this.anno&&this.anno.tab)for(var t of this.anno.tab){var{pos:i,dim:s,rot:r}=t;const a=new THREE.BoxGeometry(s.x,s.y,s.z).toNonIndexed();var o=new THREE.Quaternion(r.x,r.y,r.z,r.w);a.applyMatrix4((new THREE.Matrix4).makeRotationFromQuaternion(o)),a.translate(i.x,i.y,i.z),e.appendAll(a.attributes.position.array)}return e}getGeoVertices(e={}){var{unroll:t,translate:i}=e;let s=this.mesh.geometry,r=s.getAttribute("position");var o=this.track;if(i&&o.indexed&&(r=r.clone().applyMatrix4((new THREE.Matrix4).makeRotationX(-o.indexRad))),r=r.array,s.index&&!1!==t){var a=s.index.array,n=a.length;let t=new Float32Array(3*n),i=0;for(let e=0;e<n;e++){var h,l=3*a[e];t[i++]=r[l++],t[i++]=r[l++],t[i++]=r[l]}r=t}else i&&(r=r.slice());return this.cache.geo=r,this.cache.shadow=void 0,r}getPoints(){return this.points||(this.points=d(this.getGeoVertices(),{maxpass:0})),this.points}getBoundingBox(e){return this.bounds&&!e&&!this.modified||(this.bounds=(new THREE.Box3).setFromArray(this.getGeoVertices()),this.modified=!1),this.bounds}getPositionBox(){let e=this.getBoundingBox().clone();var t=this.track.pos;return e.min.x+=t.x,e.max.x+=t.x,e.min.y+=t.y,e.max.y+=t.y,e}getExtruder(e){return e&&console.trace("legacy call with settings"),this.anno.extruder||0}setInWorker(){return this.inWorker=!0,this}slice(t,i,s){let r=this,o=m();if(r.settings=t,r.clearSlices(),s(1e-4,"slicing"),h.client&&!r.inWorker&&(r.stack=h.stacks.create(r.id,r.mesh),r.stack.obj.view.position.z=r.track.zcut||0,r.slices=[],h.client.slice(t,this,function(e){e.alert&&s(null,null,e.alert),e.update&&s(e.update,e.updateStatus),e.send_start&&(r.xfer={start:e.send_start}),e.stats&&(r.stats=e.stats),e.send_end&&(r.stats.load_time=r.xfer.start-e.send_end),e.slice&&r.slices.push(h.codec.decode(e.slice,{mesh:r.mesh})),e.done&&i(!0),e.error&&i(!1,e.error)})),h.server){var a=function(e){if(e)return i(e);s(1,"transfer"),r.stats.slice_time=m()-o,i()},n=function(e,t,i){s(e,t,i)};let e=l[t.mode.toUpperCase()];e?e.slice(t,r,n,a):(console.log("invalid mode: "+t.mode),i("invalid mode: "+t.mode))}r.points=void 0}render(t){var e=Date.now();return this.slices&&this.slices.forEach(e=>{e.layers&&t.add(e.layers)}),Date.now()-e}setEdges(t){if(n&&n.conf){let e=this.mesh;var i,s,r,o;t&&t.toggle&&(t=!this.outline),this.outline&&(e.remove(this.outline),this.outline=null),t&&(i=n.space.is_dark(),s=n.conf.get().controller.edgeangle||20,r=new THREE.EdgesGeometry(e.geometry,s),o=new THREE.LineBasicMaterial({color:0}),this.outline=new THREE.LineSegments(r,o),this.outline.renderOrder=-20,e.add(this.outline))}}setWireframe(i,e,s){if(n&&n.conf){let e=this.mesh,t=this;var r,o,a;this.wire&&(this.setOpacity(1),e.remove(this.wire),this.wire=null),i&&(r=n.space.is_dark(),o=new THREE.MeshBasicMaterial({wireframe:!0,color:r?11184810:0,opacity:.5,transparent:!0}),a=t.wire=new THREE.Mesh(e.geometry.shallowClone(),o),e.add(a)),n.view.is_arrange()?this.setColor(this.color):this.setColor(8947848,void 0,!1),void 0!==s&&t.setOpacity(s)}}show(){this.mesh.visible=!0}hide(){this.mesh.visible=!1}}const R=k.Groups={list(){return v.slice()},merge(e){let t=e.map(e=>e.group).uniq();if(1<t.length){let e=t.shift();var i=e[0].track.pos,s;for(s of t){for(var r of s){var o=r.track.pos;r.group=e,r.moveMesh(i.x-o.x,i.y-o.y,i.z-o.z),r._move(i.x,i.y,i.z,!0),e.push(r)}v.splice(v.indexOf(s),1)}}},split(e){for(var t of e.map(e=>e.group).uniq()){v.splice(v.indexOf(t),1);for(var i of t){let e=R.forid(i.id);e.push(i),i.group=e}}},forid(t){for(let e=0;e<v.length;e++)if(v[e].id===t)return v[e];let e=[];return e.id=t,v.push(e),e},remove(i){v.slice().forEach(e=>{let t=e.indexOf(i);0<=t&&e.splice(t,1),0===e.length&&(t=v.indexOf(e),v.splice(t,1))})},blocks(){return v.map(e=>({w:e[0].track.box.w,h:e[0].track.box.h,move:(t,i,s,r)=>{e.forEach(e=>{e.getMaterial().visible=!0,e._move(t,i,s,r)})}}))},loadDone(){v.forEach(e=>{e.centered||(e[0].center(),e.centered=!0)})},bounds(e){let i=null;return e.forEach(e=>{var t=e.mesh.getBoundingBox(!0);i=i?i.union(t):t}),i},clear(){v.length=0}};k.loadFromCatalog=function(i,s){b().getFile(i,function(e){let t=E().loadVertices(e);t.meta.file=i,s(t)})},k.loadFromState=function(h,l,c){M().get("ws-save-"+h,function(n){if(n){let e=n.geo||n,t=n.track||void 0,i=n.group||h,s=n.anno||void 0,r=E(h,R.forid(i)),o=n.meta||r.meta,a=r.loadVertices(e);r.meta=o,r.anno=s||r.anno,c&&t&&t.pos&&(r.track=t,r.move(t.pos.x,t.pos.y,t.pos.z,!0)),l(a)}else l(null)})},k.deleteFromState=function(e,t){M().remove("ws-save-"+e,t)},h.Widget=k,h.newWidget=E});"use strict";gapp.register("kiri.layers",[],(t,e)=>{const{base:o,kiri:s}=t,{polygons:a,newPolygon:g}=o,r=o.polygons;class n{constructor(){this.init()}init(){this.layers={},this.profiles={},this.stats={contour:0,flat_line:0,flat_poly:0,line_poly:0,line:0}}getLayer(t){return this.layers[t]}setRotation(t=0,e=0,s=0){return this.rotation={x:t,y:e,z:s},this}setPosition(t=0,e=0,s=0){return this.position={x:t,y:e,z:s},this}setLayer(t,e,s){let o=this.layers;return"number"==typeof e&&(e={line:e,face:e,opacity:1}),this.current=o[t]=o[t]||{rotation:this.rotation,position:this.position,off:!0===s,lines:[],polys:[],faces:[],norms:void 0,cface:void 0,paths:void 0,cpath:void 0,color:e||{fat:0,line:0,face:0,opacity:1}},this}addLine(t,e){return this.current.lines.push(t,e),this}addLines(e,t){if(t){t.open=!0;const s=[];for(let t=0;t<e.length-1;t+=2)s.push((new o.Polygon).append(e[t]).append(e[t+1]).setOpen());return this.addPolys(s,t)}for(let t=0;t<e.length-1;t+=2)this.addLine(e[t],e[t+1]),this.stats.line++;return this}addPoly(t,e){return this.addPolys([t],e)}addPolys(t,e){if(0===t.length)return this;if(e&&e.clean&&(t=t.map(t=>t.clean(!0))),e&&e.flat)return this.addFlats(t,e);if(e&&!e.thin)return this.addPaths(t,e);if(t=v(t),e)for(var s of t)switch(void 0!==e.z&&s.setZ(e.z),typeof e.color){case"number":s.color=e.color;break;case"object":s.color=e.color.line}return this.current.polys.appendAll(t),this.stats.line_poly+=t.length,this}addAreas(t,e){const s=this.current.faces;for(var o of t=Array.isArray(t)?t:[t])for(var a of o.earcut())for(var r of a.points)s.push(r.x,r.y,r.z);e&&e.outline&&this.addPolys(t.clone(!0))}addFlats(t,e){var s=e||{},o=s.offset||1;if((t=v(t)).length){const p=this.current,u=p.faces,d=[];for(var a of t){var r=u.length/3,n=a.toPath2D(.95*o),{left:i,right:c,normals:l}=n,h;for(h of n.faces)u.push(h.x,h.y,h.z);if(d.push(l),s.outline){let t=g().addPoints(i).setOpenValue(a.open),e=g().addPoints(c).setOpenValue(a.open);a.z&&(t.setZ(a.z),e.setZ(a.z)),this.addPolys(t),this.addPolys(e)}var f=s.color?"number"==typeof s.color?{line:s.color,face:s.color}:s.color:p.color;if(p.cface){const y=p.cface[p.cface.length-1];y.face===f.face&&y.opacity===f.opacity||(y.count=r,p.cface.push(Object.assign({start:r,count:1/0},f)))}else p.cface=[Object.assign({start:r,count:1/0},f)]}return p.norms?p.norms.appendAll(d.flat()):p.norms=d.flat(),this}}addPaths(t,e){var s=e||{},o=s.height||1,a=s.offset||1;if((t=v(t)).length){for(var r of t)if(!(r.length<(r.open?2:3))){var n=s.z||r.getZ(),{faces:i,normals:c}=r.toPath3D(a,o,0);const f=this.current,p=f.paths;if(i&&c){if(p){var l=p.faces.length/3;const u=new Float32Array(p.faces.length+i.length);var h=p.faces.length/3;if(u.set(p.faces),u.set(i,p.faces.length),p.faces=u,s.color){f.cpath||(f.cpath=[Object.assign({start:0,count:h-1},f.color)]);const d=f.cpath[f.cpath.length-1];d.face===s.color.face&&d.opacity===s.color.opacity||(d.count=h,f.cpath.push(Object.assign({start:h,count:1/0},s.color)))}c&&p.norms.appendAll(c)}else f.paths={faces:i,z:n,norms:c},s.color&&(f.cpath=[Object.assign({start:0,count:1/0},s.color)]);this.stats.contour++}}return this}}}function v(t){return Array.isArray(t)?r.flatten(t.clone(!0),[],!0):r.flatten([t.clone(!0)],[],!0)}s.Layers=n});"use strict";gapp.register("kiri.codec",[],(r,e)=>{const{base:a,kiri:s}=r,o={},t=!0,c=e({undef:void 0,encode:f,decode:u,registerDecoder:p,allocFloat32Array:l,encodePointArray:d,decodePointArray:v,encodePointArray2D:A,decodePointArray2D:g,toCodable:i}),n={WIDGET:100,SLICE:200,TOP:300,POLY:400,LAYERS:500};function i(r){switch(typeof r){case"function":return;case"string":case"number":return r;case"object":if(Array.isArray(r))return r.map(r=>i(r))}let e={};for(var[t,o]of Object.entries(r))switch(typeof o){case"function":break;case"object":o=Array.isArray(o)?o.map(r=>i(r)):i(o);default:e[t]=o}return e}function l(e,t){if(void 0!==e){if(0===e.length)return[];let r;return r=e.byteLength?e:(Array.isArray(e),new Float32Array(e)),t&&0<r.byteLength&&t.push(r.buffer),r}}function f(t,o){if(o=o||{},null===t)return null;if(void 0!==t){if(Array.isArray(t)){let r=new Array(t.length),e=0;for(;e<t.length;)r[e]=f(t[e++],o);return r}switch(typeof t){case"boolean":case"string":case"number":return t;case"object":return t.encode?t.encode(o):y(t,o)}return null}}function u(e,t){if(t=t||{},null===e)return null;if(void 0!==e){if(Array.isArray(e)){for(let r=0;r<e.length;r++)e[r]=u(e[r],t);return e}switch(typeof e){case"boolean":case"string":case"number":return e;case"object":return e.type&&o[e.type]?o[e.type](e,t):h(e,t)}return null}}function p(r,e){o[r]=e}function y(r,e){if(r instanceof Float32Array)return r;let t={};for(var o in r)r.hasOwnProperty(o)&&(t[o]=f(r[o],e));return t}function h(r,e){if(r instanceof Float32Array)return r;let t={};for(var o in r)r.hasOwnProperty(o)&&(t[o]=u(r[o],e));return t}function d(o,r,n){if(!o)return null;var i=o.length;if(0===i)return o;var e=r?r.zeros:void 0;const l=c.allocFloat32Array(3*i,e);for(let r=0,e=0,t;r<i;r++)t=o[r],l[e++]=t.x,l[e++]=t.y,l[e++]=n||t.z;return l}function A(o,r){if(!o)return null;var n=o.length;if(0===n)return o;var e=r?r.zeros:void 0;const i=c.allocFloat32Array(2*n,e);for(let r=0,e=0,t;r<n;r++)t=o[r],i[e++]=t.x,i[e++]=t.y;return i}function v(t){if(!t)return null;var o=t.length;const n=new Array(o/3);for(let r=0,e=0;r<o;)n[e++]=a.newPoint(t[r++],t[r++],t[r++]);return n}function g(t,o,n){if(!t)return null;var i=t.length;const l=new Array(i/2);for(let r=0,e=0;r<i;)l[e++]=n?n(t[r++],t[r++]):a.newPoint(t[r++],t[r++],o);return l}function w(r,e){return r.map(r=>({open:r.open,color:r.color,points:c.encodePointArray(r.points,e.zeros)}))}s.Widget.prototype.encode=function(r){var e=r._json_,t=this.getGeoVertices(),o;return{type:n.WIDGET,id:this.id,ver:1,json:e,group:this.group.id,track:this.track,geo:e?Array.from(t):t}},p(n.WIDGET,function(r,e){const t=r.id,o=r.group||t,n=r.track||void 0,i=s.newWidget(t,s.Widget.Groups.forid(o));return i.loadVertices(r.json?r.geo.toFloat32():r.geo),i.saved=Date.now(),n&&n.pos&&(i.track=n,i.move(n.pos.x,n.pos.y,n.pos.z,!0)),i}),s.Slice.prototype.encode=function(r){var e={type:n.SLICE,z:this.z,index:this.index,layers:f(this.layers,r)};return this.layers=void 0,e},p(n.SLICE,function(r,e){let t=s.newSlice(r.z,e.mesh?e.mesh.newGroup():null);return t.index=r.index,t.layers=u(r.layers,e),t}),s.Top.prototype.encode=function(r){let e={type:n.TOP,poly:f(this.poly,r)};return r.full&&(e.last=f(this.last,r),e.shells=f(this.shells,r),e.fill_off=f(this.fill_off,r),e.fill_lines=f(this.fill_lines,r)),e},p(n.TOP,function(r,e){let t=s.newTop(u(r.poly,e));return e.full&&(t.last=u(r.last,e),t.shells=u(r.shells,e),t.fill_off=u(r.fill_off,e),t.fill_lines=u(r.fill_lines,e)),t}),a.Polygon.prototype.encode=function(r){var e;return r.poly||(r.poly={}),r.poly[this.id]?{type:n.POLY,ref:this.id}:(r.poly[this.id]=this,{type:n.POLY,id:this.id,array:d(this.points,r,this.z),inner:f(this.inner,r),parent:f(this.parent,r),depth:this.depth,color:this.color,open:this.open})},p(n.POLY,function(r,e){if(e.poly||(e.poly={}),r.ref)return e.poly[r.ref];var t=r.array,o=t.length;const n=a.newPolygon();for(let r=0;r<o;)n.push(a.newPoint(t[r++],t[r++],t[r++]));return e.poly[r.id]=n,n.id=r.id,n.open=r.open,n.inner=u(r.inner,e),n.parent=u(r.parent,e),n.depth=r.depth,n.color=r.color,n}),s.Layers.prototype.encode=function(t){let o=t.zeros;var r={type:n.LAYERS,layers:Object.keys(this.layers),data:Object.values(this.layers).map(r=>{var e=r.paths;return{off:r.off,color:r.color,polys:w(r.polys,t),lines:d(r.lines,t),faces:c.allocFloat32Array(r.faces,o),norms:c.allocFloat32Array(r.norms,o),cface:r.cface||c.undef,paths:e?{z:e.z,index:e.index,faces:c.allocFloat32Array(e.faces,o),norms:c.allocFloat32Array(e.norms,o)}:void 0,cpath:r.cpath||c.undef,rotation:r.rotation,position:r.position}})};return this.init(),r},p(n.LAYERS,function(e,r){const t=new s.Layers;var{layers:o}=e;for(let r=0;r<o.length;r++){var n=e.data[r],i=n.paths;const l=t.layers[o[r]]={off:n.off,color:n.color,polys:n.polys,lines:n.lines,faces:c.allocFloat32Array(n.faces),norms:c.allocFloat32Array(n.norms),cface:n.cface,paths:i?{z:i.z,index:i.index,faces:c.allocFloat32Array(i.faces),norms:c.allocFloat32Array(i.norms)}:void 0,cpath:n.cpath,rotation:n.rotation,position:n.position};l.cface&&l.cface.forEach(r=>{null===r.count&&(r.count=1/0)}),l.cpath&&l.cpath.forEach(r=>{null===r.count&&(r.count=1/0)})}return t})});!function(){var e="undefined"!=typeof self,s={COPYRIGHT:"Copyright (C) Stewart Allen <sa@grid.space> - All Rights Reserved",LICENSE:"See the license.md file included with the source distribution",VERSION:(e?self:this).debug_version||"4.1.5"};if("object"==typeof module&&(module.exports=s),e&&self.gapp){let e=self.gapp;e.license=s.LICENSE,e.version=s.VERSION,e.copyright=s.COPYRIGHT,gapp.register("moto.license"),(self.module=self.module||{}).exports=s}}();"use strict";gapp.register("kiri-run.worker",[],(e,t)=>{const{base:d,kiri:f,moto:n}=e,{util:r,polygons:o,wasm_ctrl:a}=d,{codec:m}=f,{time:c}=r,p=o;let s=!0===self.debug,i=this.navigator&&navigator.hardwareConcurrency||0,u=Math.min(4,self.Worker&&3<i?i-1:0),v=self.worker={print:null,snap:null,mode:null},b={},h={},l={},g=[],k=[],y={},w=0;function x(e){var t=e.data,n=t.seq;let r=y[n];if(!r)throw"missing dispatch "+n;delete y[n],r(t)}f.version=gapp.version,self.alert=function(e){console.log(e)},self.uuid=(Math.random()*Date.now()|0).toString(36);const _=f.minions={get concurrent(){return u},get running(){return g.length},start(){if(!g.length&&u){for(let t=0;t<u;t++){var n=s?"_":"";let e=new Worker("/code/kiri_pool.js?"+n+self.kiri.version);e.onmessage=x,e.postMessage({cmd:"label",name:"#"+t}),g.push(e)}console.log(`kiri | init pool | ${gapp.version||"rogue"} | `+(u+1))}},stop(){for(var e of g)e.terminate();g.length=0},union(i,l){return new Promise((o,e)=>{if(u<2||i.length<2*u||p.points(i)<50*u)o(p.union(i,l,!0));else{var t=Math.ceil(i.length/u);let n=0,r=[];var a=function(e){var t=m.decode(e.union);r.appendAll(t),0==--n&&o(p.union(r,l,!0))};for(let e=0;e<i.length;e+=t){var s={zeros:[]};n++,_.queue({cmd:"union",minarea:l,polys:m.encode(i.slice(e,e+t),s)},a,s.zeros)}}})},fill(r,o,a,s,i,l){return new Promise((t,e)=>{var n;u<2?t(p.fillArea(r,o,a,[],i,l)):(n={zeros:[]},_.queue({cmd:"fill",polys:m.encode(r,n),angle:o,spacing:a,minLen:i,maxLen:l},e=>{var n=e.fill;let r=[];for(let t=0;t<n.length;){let e=d.newPoint(n[t++],n[t++],n[t++]);e.index=n[t++],r.push(e)}s.appendAll(r),t(r)},n.zeros))})},clip(a,n,r){return new Promise((o,e)=>{u<2&&e("concurrent clip unavailable");const t={zeros:[]};_.queue({cmd:"clip",polys:m.encode(p.flatten(n).map(e=>m.encodePointArray2D(e.points,t)),t),lines:m.encode(r.map(e=>m.encodePointArray2D(e,t)),t),z:a.z},e=>{var t=m.decode(e.clips),n;for(n of a.tops)for(var r of t)r.isInside(n.poly)&&n.fill_sparse.push(r);o(t)},t.zeros)})},sliceZ(s,i,l){return new Promise((r,e)=>{u<2&&e("concurrent slice unavaiable");let{each:o}=l,t=0,n=new Float32Array(3*i.length);for(var a of i)n[t++]=a.x,n[t++]=a.y,n[t++]=a.z;_.queue({cmd:"sliceZ",z:s,points:n,options:m.toCodable(l)},e=>{var t=m.decode(e.output);if(o)for(var n of t)o(n);r(t)},[n.buffer])})},queue(e,t,n){k.push({work:e,ondone:t,direct:n}),_.kick()},queueAsync(t,n){return new Promise(e=>{_.queue(t,e,n)})},kick(){if(g.length&&k.length){let t=k.shift(),n=g.shift();var e=w++;t.work.seq=e,y[e]=e=>{t.ondone(e),g.push(n),_.kick()},n.postMessage(t.work,t.direct)}},broadcast(e,t,n){for(var r of g)r.postMessage({cmd:e,...t},n)}};console.log("kiri | init work | "+(gapp.version||"rogue"));const M=f.server=f.worker={pool_start(e,t){_.start(),t.done({})},pool_stop(e,t){_.stop(),t.done({})},group:b,cache:h,snap(e,t){v.snap=e,t.done()},png(e,r){if(v.snap){let e=v.snap.url;var o=atob(e.substring(e.indexOf(",")+1));let n=Uint8Array.from(o,e=>e.charCodeAt(0)),t=new png.PNG;t.parse(n,(e,t)=>{r.done({png:n},[n])})}else r.done({error:"missing snapshot"})},clear(e,t){v.print=null,M.group=b={},M.cache=h={},f.Widget.Groups.clear(),t.done({clear:!0})},sync(e,t){let n=b[e.group];n||(n=[],n.id=e.group,b[e.group]=n);let r=e.vertices,o=f.newWidget(e.id,n).setInWorker().loadVertices(r);h[e.id]=o,o.vertices=r,o.meta=e.meta,o.track=e.track,t.done(e.id)},rotate(e,t){var{settings:n}=e,r;if(!n.device.bedBelt)return t.done({});function o(n,e={}){let r=e.miny||1/0,o=e.maxy||-1/0;for(let e=0,t=n.length;e<t;){var a=n[e++],s=n[e++],i=n[e++];r=Math.min(r,s),o=Math.max(o,s)}return{miny:r,maxy:o}}function a(e){let t={};for(var n of e)t=o(n.vertices,t);return t}for(r of Object.values(b)){var{miny:s,maxy:i}=a(r);let e=r[0];var l=n.process,d=e.track,c=l.sliceAngle,p=d.pos.x,u=l.beltAnchor||l.firstLayerBeltLead||0,g=n.device.bedDepth/2+d.pos.y+s+u,f=Math.PI/180,m=f*c,v,h;for(v of r)v.moveMesh(0,s,0);e.rotate(m,0,0,!0,!1),e.belt={angle:c,xpos:p,ypos:g,dy:-s-u,dz:0,cosf:Math.cos(f*c),sinf:Math.sin(f*c),slope:Math.tan(f*(90-c))};for(h of r.slice(1))h.belt=e.belt;t.data({group:r.id,belt:e.belt})}t.done({})},slice(e,r){r.data({update:.001,updateStatus:"slicing"});let t=e.settings,n=h[e.id],o=c(),a;v.print=null,v.mode=t.mode.toUpperCase(),n.anno=e.anno||n.anno,n.slice(t,function(e){if(e)r.data({error:e});else{const t=n.slices||[];r.data({send_start:c()}),r.data({stats:n.stats,slices:t.length}),t.forEach((e,t)=>{var n={zeros:[]};r.data({index:t,slice:e.encode(n)},n.zeros)}),r.data({send_end:c()})}r.done({done:!0})},function(e,t,n){a=c(),n&&r.data({alert:n}),a-o<10&&e<.99||((e||t)&&r.data({update:.05+.95*e,updateStatus:t}),o=a)})},sliceAll(e,t){var{settings:n}=e,{mode:r}=n;const o=f.driver[r];o.sliceAll&&o.sliceAll(n,t.data),t.done({done:!0})},prepare(e,a){var t=Object.values(h);a.data({update:.05,updateStatus:"preview"});const{settings:o}=e;var{mode:n}=o;const r=f.driver[n];if(!r||!r.prepare)return console.log({invalid_print_driver:n,driver:r});r.prepare(t,o,(e,t,n)=>{var r={zeros:[]},o={progress:e,message:t,layer:n?n.encode(r):void 0};a.data(o,r.zeros)}).then(()=>{var e="in"===o.controller.units?1/25.4:1,t=v.print||{},n=(t.minSpeed||0)*e,r=(t.maxSpeed||0)*e;a.data({progress:1,message:"transfer"}),a.done({done:!0,minSpeed:n,maxSpeed:r})})},export(e,n){var t=e.settings.mode;const r=f.driver[t];if(!r||!r.export)return console.log({missing_export_driver:t}),n.done();let o;r.export(v.print,function(e,t){n.data({line:e},t)},function(e){o=e},function(e){n.data({debug:e})});var{bounds:a,time:s,lines:i,bytes:l,distance:d,settings:c,segments:p,purges:u,labels:g}=v.print;n.done({done:!0,output:o||{bounds:a,time:s,lines:i,bytes:l,distance:d,settings:c,segments:p,purges:u,labels:g}})},colors(e,t){const{colors:n,max:r}=e,o={};n.forEach(e=>{o[e]=f.render.rate_to_color(e,r)}),t.done(o)},parse(e,r){var{settings:t,code:n,type:o}=e,a=t.origin,s={x:a.x,y:-a.y,z:a.z},i=t.device;const l=v.print=f.newPrint(t,Object.values(h)),d=i.extruders;var c=t.mode;const p="line"===t.controller.lineType||"FDM"!==c,u="flat"===t.controller.lineType&&"FDM"===c;var g=l.parseGCode(n,s,e=>{r.data({progress:.25*e})},e=>{const t=l.minSpeed,n=l.maxSpeed;f.render.path(e.output,e=>{r.data({progress:.25+.75*e})},{thin:p||l.belt,flat:u,tools:d}).then(e=>{r.done({parsed:m.encode(e),maxSpeed:n,minSpeed:t})})},{fdm:"FDM"===c,cam:"CAM"===c,belt:i.bedBelt})},parse_svg(e,t){e.forEach(e=>{e.forEach(e=>{var{x:t,y:n,z:r}=e.point;e.point=d.newPoint(t,n,r||0)})});var n=v.print=f.newPrint(null,Object.values(h));f.render.path(e,e=>{t.data({progress:e})},{thin:!0}).then(e=>{t.done({parsed:m.encode(e)})})},config(e,t){const n={};e.base?(n.base=e.base,Object.assign(d.config,e.base)):console.log({invalid:e});for(var r of g)r.postMessage({cmd:"config",base:e.base});t.done({config:n})},image2mesh(e,t){var{device:n}=e.settings;load.PNG.parse(e.png,{outWidth:n.bedDepth,outHeight:n.bedWidth,inv_image:e.inv_image,inv_alpha:e.inv_alpha,border:e.border,blur:e.blur,base:e.base,progress(e){t.data({progress:e})},done(e){t.done({vertices:e},[e.buffer])}})},gerber2mesh(e,t){var n=load.GBR.toMesh(e,{progress(e){t.data({progress:e/100})}});t.data({vertices:n},[n.buffer])},zip(e,t){var{files:n}=e,r;let o=new JSZip;for(r of n)o.file(r.name,r.data);o.generateAsync({type:"uint8array",compression:"DEFLATE",compressionOptions:{level:6},streamFiles:!0},e=>{t.data(e)}).then(e=>{t.done(e)})},wasm(e,t){e.enable?a.enable():a.disable(),_.broadcast("wasm",{enable:!!e.enable}),t.done({wasm:e})},putCache(e,t){var{key:n,data:r}=e;r?l[n]=r:delete l[n],_.broadcast("putCache",e),t.done({ok:!0})},clearCache(e,t){l={},_.broadcast("clearCache",e),t.done({ok:!0})}};function z(e){return"AsyncFunction"===e.constructor.name}M.send=(e,t)=>{self.postMessage(e,t)},M.onmessage=self.onmessage=async function(e){let t=c(),n=e.data||{},r=M[n.task],o={data:function(e,t){M.send({seq:n.seq,task:n.task,done:!1,data:e},t)},done:function(e,t){M.send({seq:n.seq,task:n.task,done:!0,data:e},t)}};if(r)try{var a=t-n.time,s=z(r)?await r(n.data,o):r(n.data,o),i,l=c()-t;s&&M.send({seq:n.seq,task:n.task,time_send:a,time_proc:l,time_recv:c(),data:s})}catch(e){console.trace(e.stack),o.done({error:e.toString()})}else console.log({worker_unhandled:e,msg:n,fn:M[n.task]})},n.broker.publish("worker.started",{dispatch:M,minions:_})});"use strict";gapp.register("kiri.pack",[],(t,i)=>{const{kiri:h}=t;class s{constructor(t,i,h,s={}){this.w=t,this.h=i,this.spacing=h,this.opt=s,this.init()}init(){var{w:t,h:i,spacing:h,opt:s}=this;this.root={x:0,y:0,w:t,h:i},this.max={w:0,h:0},this.packed=!1,this.spacing="number"==typeof h?h:1,this.opt=s,this.pad=this.spacing/2}get size(){return{w:this.w,h:this.h}}resize(t,i){return this.w=t,this.h=i,this}rescale(t,i){return this.w*=t,this.h*=i,this}pack(t,i){for(;;){var h=this.opt.simple;if(this.fit(t,h),this.packed||!i||!i(this))return this;this.init()}}fit(t,i){return i?this.#fit_simple(t):this.#fit_split(t)}#fit_simple(t){let i=0,h=0,s=0,r=0,a=0;var e=this.spacing,o;for(o of t)if(o.fit={x:i,y:h},this.max.w=Math.max(this.max.w,i+o.w),this.max.h=Math.max(this.max.h,h+o.h),r=Math.max(r,i),a=Math.max(a,h),s=Math.max(s,o.h),i+=o.w,i>this.root.w?(i=0,h=h+s+e,s=0):i+=e,h>this.root.h)return this;if(this.opt.invx)for(var n of t)n.fit.x=r-n.fit.x;if(this.opt.invy)for(var f of t)f.fit.y=a-f.fit.y;return this.packed=!0,this}#fit_split(t){var i,h,s,r;for(r of t){if(h=r.w,s=r.h,!(i=this.#findNode(this.root,h,s)))return this;r.fit=this.#splitNode(i,h,s)}return this.packed=!0,this}#findNode(t,i,h){return t.used?this.#findNode(t.right,i,h)||this.#findNode(t.down,i,h):i<=t.w&&h<=t.h?t:null}#splitNode(t,i,h){var s=this.spacing;return t.used=!0,t.down={x:t.x,y:t.y+h+s,w:t.w,h:t.h-h},t.right={x:t.x+i+s,y:t.y,w:t.w-i,h:h},this.max.w=Math.max(this.max.w,t.x+i),this.max.h=Math.max(this.max.h,t.y+h),t}}h.Pack=s});"use strict";gapp.register("kiri.print",[],(root,evets)=>{const{base,kiri}=self,{paths,util,newPoint}=base,{numOrDefault}=util,{beltfact}=kiri.consts,XAXIS=new THREE.Vector3(1,0,0),DEG2RAD=Math.PI/180;class Print{constructor(t,e,s){this.id=s||(new Date).getTime().toString(36),this.settings=t,this.widgets=e,this.lastPoint=null,this.lastPoly=null,this.lastEmit=null,this.lastOut=null,this.lastPos=null,this.tools={},this.debugE=t&&t.controller.devel?1:0}setType(t){this.nextType=t}setWidget(t){this.widget=t}addOutput(t,e,s,a,r,i){let{lastPoint:o,lastEmit:n,lastOut:l}=this;if(o&&e&&"lerp"!==i){var{x:h,y:c,z:u}=o;if(e.x==h&&e.y==c&&e.z==u&&n==s)return l}return this.lastPoint=e,this.lastEmit=s,this.lastOut=l=new Output(e,s,a,r,i||this.nextType),void 0!==r&&(this.tools[r]=!0),l.widget=this.widget,t.push(l),this.nextType=void 0,l}addPrintPoints(t,e,s,a){this.startPoint&&0<t.length&&(this.lastPoint=this.startPoint),e.appendAll(t)}polyPrintPath(t,e,h,c={}){c.ccw?t.setCounterClockwise():t.setClockwise();const u=this;var{settings:s}=u,{process:a}=s;let r=a.outputShortDistance,p=numOrDefault(c.extrude,a.outputShellMult),x=c.rate||a.outputFeedrate,d=a.outputSeekrate,i=a.outputMinSpeed,f=c.coast||0,o=c.simple?t.first():t.findClosestPointTo(e),m=t.perimeter(),n=!c.open,y=c.tool,g=e,b=!0;return m<a.outputShortPoly&&(x=i+(x-i)*(m/a.outputShortPoly)),t.forEachPoint((t,e,s,a)=>{var r,i,o,n,l;b?(c.onfirst&&c.onfirst(t),r=u.addOutput(h,t,0,d,y),c.onfirstout&&c.onfirstout(r),b=!1):(i=g.distTo2D(t),f&&p&&m-i<=f&&(n=i-(m-f),l=g.offsetPointFrom(t,n),u.addOutput(h,l,p,x,y),p=0),m-=i,u.addOutput(h,t,p,x,y)),g=t},n,o.index),this.lastPoly=t,h.last().point}constReplace(str,consts,start,pad,short){let cs=str.indexOf("{",start||0),ce=str.indexOf("}",cs),tok,nutok,nustr;if(0<=cs&&ce>cs){tok=str.substring(cs+1,ce);let eva=[];for(var[k,v]of Object.entries(consts))switch(typeof v){case"object":eva.push(`let ${k} = ${JSON.stringify(v)};`);break;case"number":case"boolean":eva.push(`let ${k} = ${v};`);break;default:void 0===v&&(v=""),eva.push(`let ${k} = "${v.replace(/\"/g,'\\"')}";`)}eva.push("function range(a,b) { return (a + (layer / layers) * (b-a)).round(4) }"),eva.push(`try {( ${tok} )} catch (e) {console.log(e);0}`);let scr=eva.join(""),evl=eval(`{ ${scr} }`);if(nutok=evl,666===pad)return evl;if(pad){nutok=nutok.toString();let oldln=ce-cs+1,tokln=nutok.length;tokln<oldln&&(short=(short||1)+(oldln-tokln))}return nustr=str.replace("{"+tok+"}",nutok),this.constReplace(nustr,consts,ce+1+(nustr.length-str.length),pad,short)}if(short){let si=str.indexOf(";");0<si&&(str=str.replace(";",";".padStart(short," ")))}return str}parseSVG(t,i){let o=this,e=(new DOMParser).parseFromString(t,"text/xml"),s=[...e.getElementsByTagName("polyline")],a=o.output=[],n=o.bounds={max:{x:-1/0,y:-1/0,z:-1/0},min:{x:1/0,y:1/0,z:1/0}};return s.forEach(t=>{let r=[],e=[...t.points];e.forEach(t=>{i&&(t.x+=i.x,t.y+=i.y),t.x&&(n.min.x=Math.min(n.min.x,t.x)),t.x&&(n.max.x=Math.max(n.max.x,t.x)),t.y&&(n.min.y=Math.min(n.min.y,t.y)),t.y&&(n.max.y=Math.max(n.max.y,t.y)),t.z&&(n.min.z=Math.min(n.min.z,t.z)),t.z&&(n.max.z=Math.max(n.max.z,t.z));var{x:e,y:s,z:a}=t;o.addOutput(r,{x:e,y:s,z:a},0<r.length)}),a.push(r)}),o.imported=t,o.lines=s.length,o.bytes=t.length,o.output}parseGCode(t,e,s,a,r={}){const u=r.fdm;var i=r.cam,o;const p=r.belt,n=t.toUpperCase().replaceAll("X"," X").replaceAll("Y"," Y").replaceAll("Z"," Z").replaceAll("A"," A").replaceAll("E"," E").replaceAll("F"," F").replaceAll("G"," G").replaceAll("I"," I").replaceAll("J"," J").replaceAll("  "," ").split("\n"),x=this,d=!0,f=x.bounds={max:{x:-1/0,y:-1/0,z:-1/0},min:{x:1/0,y:1/0,z:1/0}},y={X:0,Y:0,Z:0,A:0,F:0,E:0},l=0,h=e&&e.x||0,c=e&&e.y||0,m=e&&e.z||0,g={X:0,Y:0,Z:0};let b=0,v=!0,M=!0,X=0,E=0,k=1,P=0,Y=0,A=1/0,z=0,O=[],F=!0,w=!1,Z=Math.PI/24,G=!1,S="G1";const I=x.output=[O],R={X:"X",Y:"Z",Z:"Y",E:"E",F:"F"};function D(){console.log(...[...arguments].map(t=>Object.clone(t)))}function T(r,t,e){const i={};t.forEach(t=>{i[t.charAt(0)]=parseFloat(t.substring(1))});let o={x:0,y:0,r:0};if(void 0!==i.X||i.X!==i.Y){if(void 0!==i.I&&void 0!==i.J)o.x=y.X+i.I,o.y=y.Y+i.J,o.r=Math.sqrt(i.I*i.I+i.J*i.J);else if(void 0!==i.R){let t,e=i.X-y.X,s=i.Y-y.Y;var n=Math.sqrt(e*e+s*s)/2;let a;a=Math.abs(n-i.R)<.001?{x:(i.X+y.X)/2,y:(i.Y+y.Y)/2}:base.util.center2pr({x:y.X,y:y.Y},{x:i.X,y:i.Y},i.R,r),o.x=a.x,o.y=a.y,o.r=i.R}else console.log({malfomed_arc:t});var s=Math.atan2(o.y-y.Y,o.x-y.X)+Math.PI,l=Math.atan2(o.y-i.Y,o.x-i.X)+Math.PI,h=base.util.thetaDiff(s,l,r),c=Math.max(Math.floor(Math.abs(h)/Z),3),u=(.001<Math.abs(h)?h:2*Math.PI)/c;let a=s+u;var p=Math.abs(s-l),x=y.X-i.X,d=y.Y-i.Y,f=Math.sqrt(x*x+d*d);if(p<.005&&f<5)$(!1,["X"+i.X,"Y"+i.Y,"E1"]);else{var m={X:y.X,Y:y.Y};for(let t=0;t<=c-2;t++){let t,e=o.x+Math.cos(a)*o.r,s=o.y+Math.sin(a)*o.r;a+=u,$(!1,["X"+e,"Y"+s,"E1"])}$(!1,["X"+i.X,"Y"+i.Y,"E1"]),y.X=i.X,y.Y=i.Y}}}function $(t,e){const a={},r={};S=t?"G0":"G1",e.forEach(t=>{let e=t.charAt(0);d&&p&&(e=R[e]);var s=parseFloat(t.substring(1));r[e]=s,v?y[e]=s:(a[e]=s,y[e]+=s)});const s=newPoint(k*y.X+g.X,k*y.Y+g.Y,k*y.Z+g.Z+b);var i;d&&p&&(s.y-=s.z*beltfact,s.z*=beltfact),y.A&&(i=new THREE.Vector3(y.X,y.Y,y.Z).applyAxisAngle(XAXIS,-y.A*DEG2RAD),s.x=i.x,s.y=i.y,s.z=i.z);var o=u&&y.E<0||void 0,n=t||u&&(y.E<=0||!(r.X||r.Y||r.Z));if(!n&&s.x&&(f.min.x=Math.min(f.min.x,s.x)),!n&&s.x&&(f.max.x=Math.max(f.max.x,s.x)),!n&&s.y&&(f.min.y=Math.min(f.min.y,s.y)),!n&&s.y&&(f.max.y=Math.max(f.max.y,s.y)),!n&&s.z&&(f.min.z=Math.min(f.min.z,s.z)),!n&&s.z&&(f.max.z=Math.max(f.max.z,s.z)),y.F&&(A=Math.min(A,y.F)),z=Math.max(z,y.F),n)return x.addOutput(O,s,!1,y.F,P).retract=o,void(x.lastPos=Object.assign({},y));if(void 0===O.Z&&(O.Z=y.Z),u&&0===E&&(O.height=X=E=y.Z),w||F&&O.Z!=y.Z){w=!1;let t=y.Z-O.Z;var l=0<t?t:X;O=[],O.height=E=l,u&&(t=-E/2),I.push(O)}G||n||(O.height=O.Z=y.Z,G=!0);var h=x.lastPos,c;if(x.debugE&&u&&h&&y.E){let t=M?y.E-x.lastPosE:y.E,e=Math.sqrt(Math.pow(y.X-h.X,2)+Math.pow(y.Y-h.Y,2));Y+=e*y.F/1e3;let s=t/e;2<e&&.001<t&&(c=(M?"aA":"rR")[x.debugE++%2],console.log(c,E.toFixed(2),e.toFixed(2),t.toFixed(3),s.toFixed(4),y.F.toFixed(0)))}x.addOutput(O,s,!0,y.F,P).retract=o,x.lastPos=Object.assign({},y),x.lastPosE=y.E}const J=i?Math.ceil(n.length/2500):0;n.forEach((e,s)=>{var t;if(J&&s%J==0&&(w=!0,F=!1),0===e.indexOf(";LAYER:")&&(w=!0,F=!1),0<e.indexOf("- LAYER ")&&(O.height=X,t=e.replace("(","").replace(")","").split(" "),X=parseFloat(t[4]),u&&(b=-X/2),w=!0,F=!1),(e=e.trim().split(";")[0].split(" ").filter(t=>t)).length){var a=e[0].charAt(0),r,i;let t=0<=["X","Y","Z"].indexOf(a)?S:e.shift();if(t)switch("T"===t.charAt(0)&&(r=x.settings.device.extruders,i=parseInt(t.charAt(1)),r&&r[i]&&(g.X=-r[i].extOffsetX,g.Y=-r[i].extOffsetY)),y.E=0,t){case"M82":M=!0;break;case"M83":M=!1;break;case"G20":k=25.4;break;case"G21":k=1;break;case"G90":v=!0;break;case"G91":v=!1;break;case"G92":e.forEach(t=>{y[t.charAt(0)]=parseFloat(t.substring(1))});break;case"G10":O&&O.length&&(O.last().retract=!0);break;case"G11":break;case"G0":$(!0,e);break;case"G1":$(!1,e);break;case"G2":T(!0,e,s);break;case"G3":T(!1,e,s);break;case"M6":P=parseInt(e[0].substring(1))}}});for(o of I)for(var j of o){let t=j.point;t.x+=h,t.y+=c,t.z+=m}x.imported=t,x.lines=n.length,x.bytes=t.length,x.minSpeed=Math.floor(A/60),x.maxSpeed=Math.floor(z/60),x.belt=p,x.debugE&&console.log({bounds:f,print_time:Y.round(2)}),a({output:x.output})}}class Output{constructor(t,e,s,a,r){this.point=t,this.emit=e,this.speed=s,this.tool=a,this.type=r}clone(t){let e=new Output(this.point.clone(),this.emit,this.speed,this.tool,this.type);return void 0!==t&&e.point.setZ(t),e}set_retract(){return this.retract=!0,this}}function newPrint(t,e,s){return new Print(t,e,s)}gapp.overlay(kiri,{Print:Print,newPrint:newPrint})});gapp.register("load.gbr",(e,o)=>{const{load:t}=e,F=base.polygons,G=base.CSG;function r(e,o={}){const t=o.progress||function(){},r=o.debug?console.log:function(){},{open:n,closed:a,circs:s,rects:c}=I(e);t(5);var i=F.nest([...a,...s,...c],!0),l;if(r({nest:i}),0===i.length)return[].toFloat32();const p=[];for(l of i)l.flattenTo(p,[],!0);t(8),r({flat:p});var f=o.z||o.z0||1,d=o.z1||.25,u,h;if(1<i.length){var g=2*(o.offset||2),y;const B=i[0].bounds;for(y of i)B.merge(y.bounds);var b=base.newPolygon().centerRectangle(B.center(0),B.width()+g,B.height()+g),m;for(m of i)m.depth++;p.push(b),r({bounds:B,flat:p}),o.raise=d}const x=[];for(u of p.filter(e=>0===e.depth))x.push(u.extrude(f));if(t(15),r({top:x}),0===x.length)return[].toFloat32();const v=[];for(h of p.filter(e=>1===e.depth))v.push(h.extrude(d,{zadd:f-d}));if(t(20),r({mid:v}),0===v.length)return x[0];var z=n.map(e=>{var o=e.tool?.shape?.diameter;return o?e.offset_open(o/2,"round"):null}).filter(e=>e).flat(),P,w;const k=[];for(P of F.union(z,0,!0)){var S=P.tool;k.push(P.extrude(f+(o.raise||0)))}t(25),r({opn:k});const A=[];for(w of p.filter(e=>2===e.depth))A.push(w.extrude(d,{zadd:f-d}));t(30);var C=G.fromPositionArray(x[0]),O=v.map(e=>G.fromPositionArray(e)),T,D;t(35);let R=G.subtract(C,...O);return t(50),k.length&&(T=k.map(e=>G.fromPositionArray(e)),R=G.union(R,...T)),t(70),A.length&&(D=A.map(e=>G.fromPositionArray(e)),R=G.union(R,...D)),t(90),G.toPositionArray(R)}function I(e){let c=1e6,o={},t,i,l=[],p=[],f=[],d={},u=base.newBounds(),r=TracespaceParser.createParser();r.feed(e);let n=r.results();var a=n.children.filter(e=>{switch(e.type){case"toolDefinition":o[e.code]=e.shape;break;case"toolChange":t={code:e.code,shape:o[e.code]};break;case"graphic":return e.tool=t,!0}return!1}).map(e=>({type:e.graphic,tool:e.tool,x:parseInt(e.coordinates.x),y:parseInt(e.coordinates.y)})).map(e=>{var{x:o,y:t,tool:r,type:n}=e,a={x:o/c,y:t/c,z:0};switch(u.update(a),n){case"move":i&&d.x===o&&d.y===t&&d.tool===r||(i=base.newPolygon().setOpen().add(a.x,a.y,0),i.tool=r,l.push(i));break;case"segment":i.add(a.x,a.y,0);break;case"shape":i=void 0;var{shape:s}=r;switch(s.type){case"obround":s.xSize===s.ySize?p.push(base.newPolygon().centerCircle(a,s.xSize/2,20)):console.log("TODO",s);break;case"circle":p.push(base.newPolygon().centerCircle(a,s.diameter/2,20));break;case"rectangle":f.push(base.newPolygon().centerRectangle(a,s.xSize,s.ySize));break;default:console.log("TODO",s)}}return d={x:o,y:t,tool:r},e}),{minx:s,maxx:h,miny:g,maxy:y}=u,b,m;for(b of[...l,...p,...f])b.move({x:-((h-s)/2+s),y:-((y-g)/2+g),z:0});const x=[],v=[];for(m of l)m.appearsClosed()?v.push(...m.simplify()):x.push(m);return{open:x,closed:v,circs:p,rects:f}}t.GBR={parse:I,toMesh:r}});gapp.register("load.png",(r,a)=>{const{load:e}=r;function t(e,t){return new Promise((a,r)=>{n(e,{...t,done(r){a(r)}})})}function n(r,yr={}){let a=new png.PNG,Ar=yr.progress||noop,mr=yr.done||noop;a.parse(r,(r,a)=>{var{width:n,height:o,data:l}=a,e=yr.outHeight||o,t=yr.outWidth||n,v,i;let f=1;f=o/n<e/t?n/t:o/e;var p=n*o+2*o+2*n,s=(o-1)*(n-1)+2*(o-1)+2*(n-1)+1;let h=new Uint8Array(n*o),w=new Uint8Array(n*o),d=0;var g=!!yr.inv_image,y=!!yr.inv_alpha,A=yr.border||0;for(let t=0;t<o;t++)for(let e=0;e<n;e++){var m=4*(e+n*t),u=l[m],c=l[1+m],M=l[2+m];let r=l[3+m],a=(u+c+M)/3;y&&(r=255-r),g&&(a=255-a),A&&(e<A||t<A||e>n-A-1||t>o-A-1)&&(a=255),w[d]=r,h[d++]=a*(r/255)}let U=parseInt(yr.blur||0);for(;0<U--;){let e=new Uint8Array(n*o);for(let a=0;a<o;a++)for(let r=0;r<n;r++){var b=Math.max(r-1,0),P=Math.min(r+1,n-1),x=Math.max(a-1,0),F=Math.min(a+1,o-1),G=r+n*a;e[G]=(h[b+n*x]+h[r+n*x]+h[P+n*x]+h[b+n*a]+8*h[r+n*a]+h[P+n*a]+h[b+n*F]+h[r+n*F]+h[P+n*F])/16}h=e}var I=parseInt(yr.base||0);let N=new Float32Array(3*p),_=new Uint32Array(6*s);var H=n/2,W=o/2;let j=0,k=0,q=0,z=0;for(let a=0;a<n;a++){for(let r=0;r<o;r++){var B=a+n*r,C=h[B],D,E,J,K;N[j++]=(-H+a)/f,N[j++]=(W-r)/f,N[j++]=C/50+I*w[B]/255,q++,0<a&&0<r&&(D=(a-1)*o+ +r,E=+a*o+(r-1),J=+a*o+ +r,K=(a-1)*o+(r-1),_[k++]=D,_[k++]=J,_[k++]=E,_[k++]=D,_[k++]=E,_[k++]=K)}Ar(a/n)}z=q;var L=q;for(let r=0;r<n;r++){var O=0,Q,R,S,T;N[j++]=(-H+r)/f,N[j++]=W/f,N[j++]=0,q++,0<r&&(Q=z+(r-1),R=z+ +r,S=r*o,T=(r-1)*o,_[k++]=Q,_[k++]=S,_[k++]=R,_[k++]=Q,_[k++]=T,_[k++]=S)}z=q;var V=q;for(let r=0;r<n;r++){var X=o-1,Y,Z,$,rr;N[j++]=(-H+r)/f,N[j++]=(W-X)/f,N[j++]=0,q++,0<r&&(Y=z+(r-1),Z=z+ +r,$=r*o+X,rr=(r-1)*o+X,_[k++]=Y,_[k++]=Z,_[k++]=$,_[k++]=Y,_[k++]=$,_[k++]=rr)}z=q;for(let r=0;r<o;r++){var ar=0,er,tr,nr,or;N[j++]=(0-H)/f,N[j++]=(W-r)/f,N[j++]=0,q++,0<r&&(er=z+(r+0),tr=z+(r-1),nr=r-1,or=+r+0,_[k++]=er,_[k++]=nr,_[k++]=tr,_[k++]=er,_[k++]=or,_[k++]=nr)}z=q;var lr=q;for(let r=0;r<o;r++){var vr=n-1,ir,fr,pr,sr;N[j++]=(vr-H)/f,N[j++]=(W-r)/f,N[j++]=0,q++,0<r&&(ir=z+(r+0),fr=z+(r-1),pr=vr*o+(r-1),sr=vr*o+ +r,_[k++]=ir,_[k++]=fr,_[k++]=pr,_[k++]=ir,_[k++]=pr,_[k++]=sr)}var hr=q-1;_[k++]=L,_[k++]=lr,_[k++]=hr,_[k++]=L,_[k++]=hr,_[k++]=V;let wr=new Float32Array(3*k),dr=0;for(let r=0;r<k;r++){var gr=3*_[r];wr[dr++]=N[gr],wr[dr++]=N[1+gr],wr[dr++]=N[2+gr]}mr(wr)})}e.PNG={parseAsync:t,parse:n}});"use strict";gapp.register("mesh.geom",[],(e,r)=>{const{Matrix4:a,Matrix3:t,Vector3:i,Box3:l}=THREE,s=r({areaSigned(t,n=3){let s=0;var o=t.length;for(let e,r,a=0;a<o;)e=t.slice(a,a+n),a+=n,r=a<o-n?t.slice(a,a+n):t.slice(0,n),s+=(r[0]-e[0])*(r[1]+e[1]);return s/2},area(e){return Math.abs(s.areaSigned(e))},bounds(t,n=3){let s=new l,o=new i;for(let e,r=0,a=t.length;r<a;r+=n)s.expandByPoint(o.fromArray(t,r));return s},isInside(e,r){return e.bounds.containsBox(r.bounds)},nest(e){let t=e.map(e=>({points:e,area:0,depth:0,inner:[],bounds:s.bounds(e)}));t=t.sort((e,r)=>(e.area=e.area||s.areaSigned(e.points),r.area=r.area||s.areaSigned(r.points),Math.abs(e.area)-Math.abs(r.area)));var n=t.length,a;e:for(let e=0;e<n-1;e++){let a=t[e];for(let r=e+1;r<n;r++){let e=t[r];if(s.isInside(e,a)){a.parent=e,e.inner.push(a);break e}}}for(a of t)for(let e=a.parent,r=0;e;e=e.parent)a.depth++;return t}})});"use strict";gapp.register("mesh.tool",[],(e,t)=>{const{mesh:b}=e,{geom:U}=b,{Vector3:a}=THREE,O=4294967295;b.tool=class s{constructor(e={}){this.precision=Math.pow(10,e.precision||6)}checkVertices(e,t){if(!e)throw"missing vertices";if(t&&e.length%t!=0)throw"invalid vertices";return e}getIndex(){if(!this.indexed)throw"missing index";return this.indexed}listZ(){var e=this.checkVertices(this.uvert).group(3),t;let s=new Set;for(t of e)s.add(t[2]);return Array.from(s).sort((e,t)=>e-t)}flattenZ(e){let{uvert:t,faces:s}=this,r=0,n=[];for(var a of e){var i=s[3*a+0],h=s[3*a+1],o=s[3*a+2],l=t[i+2],u=t[h+2],c=t[o+2];n.push(l,u,c),r=r+l+u+c}var f=(r/(3*e.length)*1e4|0)/1e4,v;for(v of e){var p=s[3*v+0],d=s[3*v+1],g=s[3*v+2];t[p+2]=f,t[d+2]=f,t[g+2]=f}return{unique:n.sort().uniq(),average:f}}generateFaces(s,e={}){this.checkVertices(s,3);var r=!1!==e.clean,n=!1!==e.dedup,a=Math.pow(10,e.round||0);let i=[],h={},o=[],l=[],u={};var c=this.precision;let f=0,v=0;if(1<a)for(let e=0,t=s.length;e<t;e++)s[e]=(s[e]*a|0)/a;for(let t=0,e=s.length;t<e;t+=3){var p=s[t],d=s[t+1],g=s[t+2],x=[p*c|0,d*c|0,g*c|0].join(""),M;let e=u[x];void 0===e&&(u[x]=e=l.length,l.push(p),l.push(d),l.push(g)),r?(o.push(e),3===o.length&&(o[0]!==o[1]&&o[0]!==o[2]&&o[1]!==o[2]?(n?(M=o.slice().sort().join("-"),h[M]?f++:(i.appendAll(o),h[M]=M)):i.appendAll(o),o=[]):(o=[],v++))):i.push(e)}return this.stats={cull:v,dups:f,faces:i.length/3},this.uvert=l,this.faces=i,this}index(e){this.vertices=this.checkVertices(e,3);const t=this.precision;var s,r=e.length/3/3,u=e.map(e=>e*t|0);const c=new Uint32Array(4*r*3).fill(O),f={},v={},p=new Float32Array(6*r),d={};var n={};const g={},x=[0,0,0],M=[0,0,0],m=[new a,new a,new a];for(let t=0,e=u.length,a=0,s=0,i=0,r=0,n=0,h,o,l;t<e;){var w=t;m[n].set(h=u[t++],o=u[t++],l=u[t++]);var A=h+","+o+","+l;let e=d[A];if(void 0===e&&(e=d[A]=s++),M[n]=w,x[n++]=e,3===n){var V=THREE.computeFaceNormal(...m),[j,y,F]=x;const U=j<y?j+","+y:y+","+j,q=y<F?y+","+F:F+","+y,z=F<j?F+","+j:j+","+F;var[b,k,I]=M,E=[U,q,z].map((e,t)=>{let s=g[e],r,n;return void 0===s?(s=g[e]=i++,n=f[s]=1,r=4*s,c[r]=M[t],c[r+1]=M[(t+1)%3]):(r=4*s,n=++f[s]),2<n?(v[s]=v[s]||[c[r],c[r+1],c[r+2],c[r+3]]).push(a):c[r+n+1]=a,s});p[r++]=V.x,p[r++]=V.y,p[r++]=V.z,p[r++]=E[0],p[r++]=E[1],p[r++]=E[2],n=0,a++}}this.indexed={faces:p,sides:c,sideExt:v}}getAdjacentFaces(t){const{faces:e,sides:s}=this.getIndex();var r=6*t,n=e[3+r],a=e[4+r],i=e[5+r],h=[s[4*n+2],s[4*n+3],s[4*a+2],s[4*a+3],s[4*i+2],s[4*i+3]].filter(e=>e!==O&&e!==t);return h.length?h:(console.log("no adjacent faces to "+t),[])}findConnectedSurface(e,s,t,r={}){const n=this.getIndex().faces,a={},i=(e=void 0!==t?e.filter(e=>n[6*e+2]>=t):e).slice();for(var h of e)r[h]=1;for(;i.length;){var o=i.shift(),l=6*o,u,c;if(!(void 0!==t&&n[2+l]<t))for(c of this.getAdjacentFaces(o))if(!r[c]&&!a[c]){var f=6*c,v;let t=0;for(let e=0;e<3;e++)t+=Math.pow(n[l+e]-n[f+e],2);Math.sqrt(t)<=s&&(e.push(c),i.push(c),a[c]=1,r[c]=1)}}return e}generateOutlines(e){const{faces:t,sides:a}=this.getIndex(),i=this.precision,h=this.vertices,o={},l={},u={};let c=0;function f(e){var t=h[e],s=h[e+1],r=h[e+2],n=(t*i|0)+","+(s*i|0)+","+(r*i|0),a=l[n];return void 0===a?(u[c]={x:t,y:s,z:r,to:[]},l[n]=c++):a}function s(e){if(e!==O){var t=f(a[4*e]),s=f(a[4*e+1]),r=t<s?t+","+s:s+","+t;const n=o[r];n?n.del=!0:o[r]={v0:t,v1:s}}}for(var r of e){var n=6*r;s(t[3+n]),s(t[4+n]),s(t[5+n])}var v,p,d;for(p of Object.values(o).filter(e=>!e.del)){var{v0:g,v1:x}=p;const b=u[g],k=u[x];b.to.push(x),k.to.push(g)}let M,m=[];for(d of Object.values(u))if(!d.used&&0!==d.to.length)for(m.push(M=[]);d;){var{to:w,x:A,y:V,z:j}=d;if(w.length<2)throw`invalid to ${w.length} @ ${A},${V},`+j;d.used=!0,M.push({x:A,y:V,z:j});var y=u[w[0]],F=u[w[1]];d=y.used?F.used?void 0:F:y}return m}isolateBodies(){const s=this.checkVertices(this.vertices),r=[];var n={};for(let e=0,t=s.length/9;e<t;e++)if(!n[e]){var a=this.findConnectedSurface([e],1/0,void 0,n);if(a.length){const h=[];for(var i of a)h.push(...s.slice(9*i,9*i+9));r.push(h)}}return r}patch(e={merge:!0}){let f=this.checkVertices(this.uvert);var s=this.faces;let i={},h={},o=[];class l{constructor(e,t){this.v1=e,this.v2=t,this.faces=[]}addFace(e){return this.faces.indexOf(e)<0&&this.faces.push(e),this}adjacentUnused(){return h[this.v1].concat(h[this.v2]).filter(e=>e!==this&&!e.used&&1===e.faces.length)}adjacentUsed(){return h[this.v1].concat(h[this.v2]).filter(e=>e!==this&&e.used&&1===e.faces.length)}touches(e){return this.v1===e.v1||this.v1===e.v2||this.v2===e.v1||this.v2===e.v2}unitVector(){if(void 0!==this.unit)return this.unit;var e=this.v1,t=this.v2;let s=[f[e]-f[t],f[e+1]-f[t+1],f[e+2]-f[t+2]],r=Math.max(...s.map(e=>Math.abs(e)));return this.unit=s.map(e=>e/r)}}function t(t,s){let r=0;for(let e=0;e<3;e++)r+=Math.abs(t[e]-s[e]);return r}function r(s,r){var e,t,n=(f[s]+1e3*f[s+1]+1e5*f[s+2]<=f[r]+1e3*f[r+1]+1e5*f[r+2]?[s,r]:[r,s]).join("-");let a=i[n];if(!a){a=i[n]=new l(s,r),a.key=n,o.push(a);let e=h[s]=h[s]||[],t=h[r]=h[r]||[];e.push(a),t.push(a)}return a}function n(e){return f[e],f[e+1],f[e+2],1}for(let e=0,t=this.faces.length;e<t;e+=3)var a=s[e],u=s[e+1],c=s[e+2],v=r(a,u).addFace(e),p=r(u,c).addFace(e),d=r(c,a).addFace(e);this.lines=o;var g=this.edges=o.filter(e=>1===e.faces.length),x,M,m;let w=this.loops=[];for(let e=0,t=g.length;e<t;e++){let s=g[e];if(!s.used&&!(2<s.adjacentUnused().length)){let t=[];for(;;){let e=s.adjacentUnused();if(0===e.length){var A=t[0],V=t.last();t.open=t.length<3||A.v1!==V.v1&&A.v2!==V.v2&&A.v1!==V.v2&&A.v2!==V.v1;break}s=1===e.length?(s.v2!==e[0].v1&&(x=e[0].v1,e[0].v1=e[0].v2,e[0].v2=x),e[0]):2===e.length?e[0].v1===s.v2?e[0]:e[1]:(s.split=e,e[0]),t.push(s),s.used=!0}t.length&&w.push(t)}}if(1<w.length)e:for(let n=0;n<w.length-1;n++){let r=w[n];if(r&&r.open)for(let s=n+1;s<w.length;s++){let t=w[s];if(t&&t.open){let e;if(r[0].touches(t[0])?e=[...t.reverse(),...r]:r[0].touches(t.last())?e=[...t,...r]:r.last().touches(t[0])?e=[...r,...t]:r.last().touches(t.last())&&(e=[...r,...t.reverse()]),e){e.open=!0,w.push(e),w[n]=w[s]=void 0;continue e}}}}function j(e){let s,r=[],n=[],a=0,i=0,h=0,o=e.slice();o.push(e[0]);for(let t=0;t<o.length;t++){var l=o[t];let e;e=l.v1===s?l.v2:l.v1,t<o.length-1&&(r.push(e),n.push([f[e],f[e+1],f[e+2]])),0<=s&&(a=Math.max(a,Math.abs(f[s]-f[e])),i=Math.max(i,Math.abs(f[s+1]-f[e+1])),h=Math.max(h,Math.abs(f[s+2]-f[e+2]))),s=e}let t=2;if(i<a&&i<h?t=1:a<i&&a<h&&(t=0),t<2)for(var u of n){var c=u[2];u[2]=u[t],u[t]=c}return{index:r,points:n.flat(),swap:t}}function y(e){let{index:t,points:s}=e,r=earcut(s,void 0,3);return r.map(e=>t[e])}function F(e){let t=e.loop.points.slice(),s=e.loop.index.slice(),r=[];for(var n of e.inner)r.push(t.length/3),t.appendAll(n.loop.points),s.appendAll(n.loop.index);let a=earcut(t,r,3);return a.map(e=>s[e])}this.shorts=w.filter(e=>e&&e.length<=2),this.loops=w=w.filter(e=>e&&2<e.length);let b=this.areas=[];if(e.compound){let e=w.map(e=>j(e)),s=U.nest(e.map(e=>e.points));for(let t of s)t.loop=e.filter(e=>e.points===t.points)[0];for(m of s.filter(e=>e.depth%2==0))b.push(F(m))}else for(var k of w){var I,E=y(j(k));b.push(E)}return e.merge&&this.merge(),e.mapped&&(this.mapped={edges:this.expandLoop(this.edges),areas:this.areas.map(e=>this.expandArray(e))}),this}appendVertex(e,t=[]){var s=this.uvert;return t.push(s[e++]),t.push(s[e++]),t.push(s[e]),t}expandArray(e,t=[]){for(var s of e)this.appendVertex(s,t);return t}expandLoop(e,t=[]){for(var s of e)this.appendVertex(s.v1,t),this.appendVertex(s.v2,t);return t}merge(){for(var e of this.areas||[])this.faces.appendAll(e)}unrolled(){var e=[],t;for(t of this.faces)this.appendVertex(t,e);return e}generateGear(t,e,s,r){const n=Math.PI;function a(e){return e/180*n}function i(e,t){return[e*Math.sin(t),e*Math.cos(t)]}function h(e,t,s,r){return i(r,t*(o(e,r)+s))}function o(e,t){return Math.sqrt(t/e*(t/e)-1)-Math.acos(e/t)}function l(e,t,s,r,n,a){return h(s,a,n,(1-e)*Math.max(s,t)+e*r)}function u(e,t,s,r,n,a){let i=[];var h=1/e;for(let e=0;e<=1;e+=h)i.push(l(e,t,s,r,n,a));return i}function c(t,s){let r=[];for(let e=0;e<t.length;e++){var n=t[e][0],a=t[e][1],i=n*Math.cos(s)-a*Math.sin(s),h=a*Math.cos(s)+n*Math.sin(s);r.push([i,h])}return r}var f=e*n,v=r/2||0,p=r||0,d=a(s),g;let x=[];{let e=f*t/n/2;for(var M=e+f/n-v,m=e*Math.cos(d),w=e-(M-e)-v,A=f/2-p/2,V=-o(m,e)-A/2/e,j=10+(e/5|0),y=[i(w,-n/t),i(w,w<m?V:-n/t),...u(j,w,m,M,V,1),...u(j,w,m,M,V,-1).reverse(),i(w,w<m?-V:n/t)],F=0;F<t;F++)x.appendAll(c(y,2*-F*n/t));g=e.round(3),b.log("gear pitch radius: "+g)}return{gear:x,pitch:g}}generateThreads(e,s,r,n,a,i){let h=[];var o=e/r,l=2*Math.PI/a,u=o/a;let c=[],f=0;var v=r*a+a,p=Math.round(2.5*a),d=v-p;for(let t=0;t<r;t++)for(let e=0;e<a;e++){f++;var g=f+a,x=s-n,M=i&&f<p?x+f/p*n:i&&f>d?x+(v-f)/p*n:s,m=i&&g<p?x+g/p*n:i&&d<g?x+(v-g)/p*n:s,w=l*e-Math.PI/2,A=o*t+u*e,V=Math.cos(w)*x,j=Math.sin(w)*x,y=Math.cos(w)*M,F=Math.sin(w)*M,b,k,I=[Math.cos(w)*m,Math.sin(w)*m,A+o/2],E=[V,j,A],U=[y,F,A-o/2],[q,z,O]=c;q&&z&&O&&(h.push(...q,...z,...I),h.push(...I,...z,...E),h.push(...z,...O,...E),h.push(...E,...O,...U)),c=[I,E,U]}return h}}});"use strict";gapp.register("mesh.util",[],(t,e)=>{const{Matrix4:l,Matrix3:r,Vector3:c,Box3:d}=THREE,{mesh:i}=t,a=[],m={},p=e({uuid(t=1){let e=[];for(;0<t--;)e.push(Math.round(4294967295*Math.random()).toString(36));return e.join("-")},toHexRGB(t){return[(t>>16&255).toString(16).padStart(2,0),(t>>8&255).toString(16).padStart(2,0),(t>>0&255).toString(16).padStart(2,0)].join("")},fromHexRGB(t){return 0+parseInt(t.substring(0,2),16)<<16|parseInt(t.substring(2,4),16)<<8|parseInt(t.substring(4,6),16)},comma(t){let e=t.toString().split(".");return e[0]=e[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),e.join(".")},defer(t,e=50){for(var r of a)if(r.fn===t){clearTimeout(r.timer),a.remove(r);break}let o={fn:t};o.timer=setTimeout(()=>{a.remove(o),t()},e),a.push(o)},deferWrap(t,e){return function(){p.defer(t,e)}},bounds(t){var e=new d;if(Array.isArray(t))for(var r of t)p.box3expand(e,r instanceof i.object?r.object:r);else{if(!t)return e;p.box3expand(e,t instanceof i.object?t.object:t)}let o={min:{x:e.min.x,y:e.min.z,z:e.min.y},max:{x:e.max.x,y:e.max.z,z:e.max.y}};return o.size=o.dim={x:o.max.x-o.min.x,y:o.max.y-o.min.y,z:o.max.z-o.min.z},o.center=o.mid={x:(o.max.x+o.min.x)/2,y:-(o.max.y+o.min.y)/2,z:(o.max.z+o.min.z)/2},o},box3expand(n,i){if(!i._no_bounds){let a=i.geometry;if(i.updateWorldMatrix(!!a,!1),a){let e=i.matrixWorld;var s=[e.elements.map(t=>t.round(5))].join(",");let r=m[i.id];if(!r||r.bkey!==s||a._model_invalid){let t=a.attributes.position.clone();t.applyMatrix4((new l).extractRotation(e));var u=(new d).setFromBufferAttribute(t);r=m[i.id]={bkey:s,bounds:u},a._model_invalid=void 0}let t=r.bounds.clone(),o=new l;o.setPosition((new c).setFromMatrixPosition(i.matrixWorld)),t.applyMatrix4(o),n.union(t)}var r=i.children;for(let t=0,e=r.length;t<e;t++)p.box3expand(n,r[t])}},extract(e,r={}){var t=r.fields||["x","y","z"],o;let a=[];for(o of t){let t=e[o]||0;void 0!==r.round&&(t=t.round(r.round)),void 0!==r.fixed&&(t=t.toFixed(r.fixed)),a.push(t)}return r.map?{[t[0]]:a[0],[t[1]]:a[1],[t[2]]:a[2]}:a},average(t,e={}){var r=e.fields||["x","y","z"],o,a;let n={};for(o of t)for(var i of r)n[i]=(n[i]||0)+o[i];for(a of r)n[a]=(n[a]||0)/t.length;return n},faceNormals(t,s={}){const u=new THREE.Vector3,l=new THREE.Vector3,c=new THREE.Vector3;var e=new THREE.Vector3;const d=new THREE.Vector3;var r=new THREE.Matrix3,o=i.api.prefs.map,a=o.normals;const m=o.space.dark?a.color_dark:a.color_lite,p=a.length||1;class n extends THREE.LineSegments{constructor(t,e=s.size||p,r=s.color||m){var o,a=t.geometry.attributes.position.count/3;const n=new THREE.BufferGeometry;var i=new THREE.Float32BufferAttribute(3*a*2,3);n.setAttribute("position",i),super(n,new THREE.LineBasicMaterial({color:r,toneMapped:!1})),this.object=t,this.size=e,this.type="FaceNormalsHelper",this.matrixAutoUpdate=!1,this._no_bounds=!0,this.update()}update(){this.object.updateMatrixWorld(!0);const o=this.geometry.attributes.position;var t,a=this.object.geometry.attributes.position.array;let n=0;for(let e=0,t=0,r=a.length;n<r;){u.set(a[n++],a[n++],a[n++]),l.set(a[n++],a[n++],a[n++]),c.set(a[n++],a[n++],a[n++]);let t=THREE.computeFaceNormal(u,l,c);var i=u.add(l).add(c).divideScalar(3);d.copy(i).add(t.multiplyScalar(this.size)),o.setXYZ(e++,i.x,i.y,i.z),o.setXYZ(e++,d.x,d.y,d.z)}o.needsUpdate=!0}}return new n(t)},vertexNormals(t){const i=new c,s=new c,u=new r;class e extends THREE.LineSegments{constructor(t,e=1,r=16711680){var o,a=t.geometry.attributes.normal.count;const n=new THREE.BufferGeometry;var i=new THREE.Float32BufferAttribute(2*a*3,3);n.setAttribute("position",i),super(n,new THREE.LineBasicMaterial({color:r,toneMapped:!1})),this.object=t,this.size=e,this.type="VertexNormalsHelper",this.matrixAutoUpdate=!1,this.update()}update(){this.object.updateMatrixWorld(!0);const o=this.geometry.attributes.position;var t=this.object.geometry;const a=t.attributes.position,n=t.attributes.normal;for(let t=0,e=0,r=a.count;e<r;e++)i.set(a.getX(e),a.getY(e),a.getZ(e)),s.set(n.getX(e),n.getY(e),n.getZ(e)),s.applyMatrix3(u).normalize().multiplyScalar(this.size).add(i),o.setXYZ(t++,i.x,i.y,i.z),o.setXYZ(t++,s.x,s.y,s.z);o.needsUpdate=!0}}return new e(t)},facesToGroups(e){let r=[];if(e&&e.length){var o=(e=e.sort((t,e)=>t-e).slice()).shift(),a;0<o&&r.push({start:0,count:o,mat:0});let t={start:o,count:1,mat:1};r.push(t);for(a of e)a===t.start+t.count?t.count++:(r.push(t={start:t.start+t.count,count:a-t.start-t.count}),r.push(t={start:a,count:1,mat:1}));r.push({start:t.start+t.count,count:1/0})}else r.push({start:0,count:1/0});return r},toSharedF32(t){if(t.buffer instanceof SharedArrayBuffer)return t;var{buffer:e}=t;let r=new Float32Array(new SharedArrayBuffer(e.byteLength));return r.set(t),r},toLocal32(t){if(!(t.buffer instanceof SharedArrayBuffer))return t;let e=new Float32Array(t.length);return e.set(t),e},diagram(t,e=0){var r="|".padStart(3*e,"-"),o,a,n;for([a,n]of Object.entries(t).sort((t,e)=>t[0]>e[0]?1:-1))console.log(r,a),n&&"object"==typeof n&&!Array.isArray(n)&&p.diagram(n,e+1)}})});"use strict";gapp.main({app:"kiri",pre(i){let e=i.kirimod=i.kirimod||[],a=i.kiri={beta:0,driver:{},load(i){e.push(i)},load_exec(o){const r=i=>{try{i(o||a.api)}catch(i){console.log({module_error:i})}};e.forEach(i=>r(i)),a.load=i=>r(i)}}},post(i){i.kiri.load_exec()}});